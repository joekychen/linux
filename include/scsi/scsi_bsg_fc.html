<!DOCTYPE html>
<html><head><title>joekychen/linux » include › scsi › scsi_bsg_fc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>scsi_bsg_fc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  FC Transport BSG Interface</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 2008   James Smart, Emulex Corporation</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *  (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef SCSI_BSG_FC_H</span>
<span class="cp">#define SCSI_BSG_FC_H</span>

<span class="cm">/*</span>
<span class="cm"> * This file intended to be included by both kernel and user space</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;scsi/scsi.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * FC Transport SGIO v4 BSG Message Support</span>
<span class="cm"> */</span>

<span class="cm">/* Default BSG request timeout (in seconds) */</span>
<span class="cp">#define FC_DEFAULT_BSG_TIMEOUT		(10 * HZ)</span>


<span class="cm">/*</span>
<span class="cm"> * Request Message Codes supported by the FC Transport</span>
<span class="cm"> */</span>

<span class="cm">/* define the class masks for the message codes */</span>
<span class="cp">#define FC_BSG_CLS_MASK		0xF0000000	</span><span class="cm">/* find object class */</span><span class="cp"></span>
<span class="cp">#define FC_BSG_HST_MASK		0x80000000	</span><span class="cm">/* fc host class */</span><span class="cp"></span>
<span class="cp">#define FC_BSG_RPT_MASK		0x40000000	</span><span class="cm">/* fc rport class */</span><span class="cp"></span>

	<span class="cm">/* fc_host Message Codes */</span>
<span class="cp">#define FC_BSG_HST_ADD_RPORT		(FC_BSG_HST_MASK | 0x00000001)</span>
<span class="cp">#define FC_BSG_HST_DEL_RPORT		(FC_BSG_HST_MASK | 0x00000002)</span>
<span class="cp">#define FC_BSG_HST_ELS_NOLOGIN		(FC_BSG_HST_MASK | 0x00000003)</span>
<span class="cp">#define FC_BSG_HST_CT			(FC_BSG_HST_MASK | 0x00000004)</span>
<span class="cp">#define FC_BSG_HST_VENDOR		(FC_BSG_HST_MASK | 0x000000FF)</span>

	<span class="cm">/* fc_rport Message Codes */</span>
<span class="cp">#define FC_BSG_RPT_ELS			(FC_BSG_RPT_MASK | 0x00000001)</span>
<span class="cp">#define FC_BSG_RPT_CT			(FC_BSG_RPT_MASK | 0x00000002)</span>



<span class="cm">/*</span>
<span class="cm"> * FC Address Identifiers in Message Structures :</span>
<span class="cm"> *</span>
<span class="cm"> *   Whenever a command payload contains a FC Address Identifier</span>
<span class="cm"> *   (aka port_id), the value is effectively in big-endian</span>
<span class="cm"> *   order, thus the array elements are decoded as follows:</span>
<span class="cm"> *     element [0] is bits 23:16 of the FC Address Identifier</span>
<span class="cm"> *     element [1] is bits 15:8 of the FC Address Identifier</span>
<span class="cm"> *     element [2] is bits 7:0 of the FC Address Identifier</span>
<span class="cm"> */</span>


<span class="cm">/*</span>
<span class="cm"> * FC Host Messages</span>
<span class="cm"> */</span>

<span class="cm">/* FC_BSG_HST_ADDR_PORT : */</span>

<span class="cm">/* Request:</span>
<span class="cm"> * This message requests the FC host to login to the remote port</span>
<span class="cm"> * at the specified N_Port_Id.  The remote port is to be enumerated</span>
<span class="cm"> * with the transport upon completion of the login.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fc_bsg_host_add_rport</span> <span class="p">{</span>
	<span class="kt">uint8_t</span>		<span class="n">reserved</span><span class="p">;</span>

	<span class="cm">/* FC Address Identier of the remote port to login to */</span>
	<span class="kt">uint8_t</span>		<span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Response:</span>
<span class="cm"> * There is no additional response data - fc_bsg_reply-&gt;result is sufficient</span>
<span class="cm"> */</span>


<span class="cm">/* FC_BSG_HST_DEL_RPORT : */</span>

<span class="cm">/* Request:</span>
<span class="cm"> * This message requests the FC host to remove an enumerated</span>
<span class="cm"> * remote port and to terminate the login to it.</span>
<span class="cm"> *</span>
<span class="cm"> * Note: The driver is free to reject this request if it desires to</span>
<span class="cm"> * remain logged in with the remote port.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fc_bsg_host_del_rport</span> <span class="p">{</span>
	<span class="kt">uint8_t</span>		<span class="n">reserved</span><span class="p">;</span>

	<span class="cm">/* FC Address Identier of the remote port to logout of */</span>
	<span class="kt">uint8_t</span>		<span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Response:</span>
<span class="cm"> * There is no additional response data - fc_bsg_reply-&gt;result is sufficient</span>
<span class="cm"> */</span>


<span class="cm">/* FC_BSG_HST_ELS_NOLOGIN : */</span>

<span class="cm">/* Request:</span>
<span class="cm"> * This message requests the FC_Host to send an ELS to a specific</span>
<span class="cm"> * N_Port_ID. The host does not need to log into the remote port,</span>
<span class="cm"> * nor does it need to enumerate the rport for further traffic</span>
<span class="cm"> * (although, the FC host is free to do so if it desires).</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fc_bsg_host_els</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * ELS Command Code being sent (must be the same as byte 0</span>
<span class="cm">	 * of the payload)</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span> 	<span class="n">command_code</span><span class="p">;</span>

	<span class="cm">/* FC Address Identier of the remote port to send the ELS to */</span>
	<span class="kt">uint8_t</span>		<span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Response:</span>
<span class="cm"> */</span>
<span class="cm">/* fc_bsg_ctels_reply-&gt;status values */</span>
<span class="cp">#define FC_CTELS_STATUS_OK	0x00000000</span>
<span class="cp">#define FC_CTELS_STATUS_REJECT	0x00000001</span>
<span class="cp">#define FC_CTELS_STATUS_P_RJT	0x00000002</span>
<span class="cp">#define FC_CTELS_STATUS_F_RJT	0x00000003</span>
<span class="cp">#define FC_CTELS_STATUS_P_BSY	0x00000004</span>
<span class="cp">#define FC_CTELS_STATUS_F_BSY	0x00000006</span>
<span class="k">struct</span> <span class="n">fc_bsg_ctels_reply</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * Note: An ELS LS_RJT may be reported in 2 ways:</span>
<span class="cm">	 *  a) A status of FC_CTELS_STATUS_OK is returned. The caller</span>
<span class="cm">	 *     is to look into the ELS receive payload to determine</span>
<span class="cm">	 *     LS_ACC or LS_RJT (by contents of word 0). The reject</span>
<span class="cm">	 *     data will be in word 1.</span>
<span class="cm">	 *  b) A status of FC_CTELS_STATUS_REJECT is returned, The</span>
<span class="cm">	 *     rjt_data field will contain valid data.</span>
<span class="cm">	 *</span>
<span class="cm">	 * Note: ELS LS_ACC is determined by an FC_CTELS_STATUS_OK, and</span>
<span class="cm">	 *   the receive payload word 0 indicates LS_ACC</span>
<span class="cm">	 *   (e.g. value is 0x02xxxxxx).</span>
<span class="cm">	 *</span>
<span class="cm">	 * Note: Similarly, a CT Reject may be reported in 2 ways:</span>
<span class="cm">	 *  a) A status of FC_CTELS_STATUS_OK is returned. The caller</span>
<span class="cm">	 *     is to look into the CT receive payload to determine</span>
<span class="cm">	 *     Accept or Reject (by contents of word 2). The reject</span>
<span class="cm">	 *     data will be in word 3.</span>
<span class="cm">	 *  b) A status of FC_CTELS_STATUS_REJECT is returned, The</span>
<span class="cm">	 *     rjt_data field will contain valid data.</span>
<span class="cm">	 *</span>
<span class="cm">	 * Note: x_RJT/BSY status will indicae that the rjt_data field</span>
<span class="cm">	 *   is valid and contains the reason/explanation values.</span>
<span class="cm">	 */</span>
	<span class="kt">uint32_t</span>	<span class="n">status</span><span class="p">;</span>		<span class="cm">/* See FC_CTELS_STATUS_xxx */</span>

	<span class="cm">/* valid if status is not FC_CTELS_STATUS_OK */</span>
	<span class="k">struct</span>	<span class="p">{</span>
		<span class="kt">uint8_t</span>	<span class="n">action</span><span class="p">;</span>		<span class="cm">/* fragment_id for CT REJECT */</span>
		<span class="kt">uint8_t</span>	<span class="n">reason_code</span><span class="p">;</span>
		<span class="kt">uint8_t</span>	<span class="n">reason_explanation</span><span class="p">;</span>
		<span class="kt">uint8_t</span>	<span class="n">vendor_unique</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">rjt_data</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/* FC_BSG_HST_CT : */</span>

<span class="cm">/* Request:</span>
<span class="cm"> * This message requests that a CT Request be performed with the</span>
<span class="cm"> * indicated N_Port_ID. The driver is responsible for logging in with</span>
<span class="cm"> * the fabric and/or N_Port_ID, etc as per FC rules. This request does</span>
<span class="cm"> * not mandate that the driver must enumerate the destination in the</span>
<span class="cm"> * transport. The driver is allowed to decide whether to enumerate it,</span>
<span class="cm"> * and whether to tear it down after the request.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fc_bsg_host_ct</span> <span class="p">{</span>
	<span class="kt">uint8_t</span>		<span class="n">reserved</span><span class="p">;</span>

	<span class="cm">/* FC Address Identier of the remote port to send the ELS to */</span>
	<span class="kt">uint8_t</span>		<span class="n">port_id</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * We need words 0-2 of the generic preamble for the LLD&#39;s</span>
<span class="cm">	 */</span>
	<span class="kt">uint32_t</span>	<span class="n">preamble_word0</span><span class="p">;</span>	<span class="cm">/* revision &amp; IN_ID */</span>
	<span class="kt">uint32_t</span>	<span class="n">preamble_word1</span><span class="p">;</span>	<span class="cm">/* GS_Type, GS_SubType, Options, Rsvd */</span>
	<span class="kt">uint32_t</span>	<span class="n">preamble_word2</span><span class="p">;</span>	<span class="cm">/* Cmd Code, Max Size */</span>

<span class="p">};</span>
<span class="cm">/* Response:</span>
<span class="cm"> *</span>
<span class="cm"> * The reply structure is an fc_bsg_ctels_reply structure</span>
<span class="cm"> */</span>


<span class="cm">/* FC_BSG_HST_VENDOR : */</span>

<span class="cm">/* Request:</span>
<span class="cm"> * Note: When specifying vendor_id, be sure to read the Vendor Type and ID</span>
<span class="cm"> *   formatting requirements specified in scsi_netlink.h</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fc_bsg_host_vendor</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * Identifies the vendor that the message is formatted for. This</span>
<span class="cm">	 * should be the recipient of the message.</span>
<span class="cm">	 */</span>
	<span class="kt">uint64_t</span> <span class="n">vendor_id</span><span class="p">;</span>

	<span class="cm">/* start of vendor command area */</span>
	<span class="kt">uint32_t</span> <span class="n">vendor_cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Response:</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fc_bsg_host_vendor_reply</span> <span class="p">{</span>
	<span class="cm">/* start of vendor response area */</span>
	<span class="kt">uint32_t</span> <span class="n">vendor_rsp</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>



<span class="cm">/*</span>
<span class="cm"> * FC Remote Port Messages</span>
<span class="cm"> */</span>

<span class="cm">/* FC_BSG_RPT_ELS : */</span>

<span class="cm">/* Request:</span>
<span class="cm"> * This message requests that an ELS be performed with the rport.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fc_bsg_rport_els</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * ELS Command Code being sent (must be the same as</span>
<span class="cm">	 * byte 0 of the payload)</span>
<span class="cm">	 */</span>
	<span class="kt">uint8_t</span> <span class="n">els_code</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Response:</span>
<span class="cm"> *</span>
<span class="cm"> * The reply structure is an fc_bsg_ctels_reply structure</span>
<span class="cm"> */</span>


<span class="cm">/* FC_BSG_RPT_CT : */</span>

<span class="cm">/* Request:</span>
<span class="cm"> * This message requests that a CT Request be performed with the rport.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fc_bsg_rport_ct</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * We need words 0-2 of the generic preamble for the LLD&#39;s</span>
<span class="cm">	 */</span>
	<span class="kt">uint32_t</span>	<span class="n">preamble_word0</span><span class="p">;</span>	<span class="cm">/* revision &amp; IN_ID */</span>
	<span class="kt">uint32_t</span>	<span class="n">preamble_word1</span><span class="p">;</span>	<span class="cm">/* GS_Type, GS_SubType, Options, Rsvd */</span>
	<span class="kt">uint32_t</span>	<span class="n">preamble_word2</span><span class="p">;</span>	<span class="cm">/* Cmd Code, Max Size */</span>
<span class="p">};</span>
<span class="cm">/* Response:</span>
<span class="cm"> *</span>
<span class="cm"> * The reply structure is an fc_bsg_ctels_reply structure</span>
<span class="cm"> */</span>




<span class="cm">/* request (CDB) structure of the sg_io_v4 */</span>
<span class="k">struct</span> <span class="n">fc_bsg_request</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">msgcode</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">fc_bsg_host_add_rport</span>	<span class="n">h_addrport</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">fc_bsg_host_del_rport</span>	<span class="n">h_delrport</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">fc_bsg_host_els</span>		<span class="n">h_els</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">fc_bsg_host_ct</span>		<span class="n">h_ct</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">fc_bsg_host_vendor</span>	<span class="n">h_vendor</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">fc_bsg_rport_els</span>		<span class="n">r_els</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">fc_bsg_rport_ct</span>		<span class="n">r_ct</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">rqst_data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>


<span class="cm">/* response (request sense data) structure of the sg_io_v4 */</span>
<span class="k">struct</span> <span class="n">fc_bsg_reply</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * The completion result. Result exists in two forms:</span>
<span class="cm">	 *  if negative, it is an -Exxx system errno value. There will</span>
<span class="cm">	 *    be no further reply information supplied.</span>
<span class="cm">	 *  else, it&#39;s the 4-byte scsi error result, with driver, host,</span>
<span class="cm">	 *    msg and status fields. The per-msgcode reply structure</span>
<span class="cm">	 *    will contain valid data.</span>
<span class="cm">	 */</span>
	<span class="kt">uint32_t</span> <span class="n">result</span><span class="p">;</span>

	<span class="cm">/* If there was reply_payload, how much was recevied ? */</span>
	<span class="kt">uint32_t</span> <span class="n">reply_payload_rcv_len</span><span class="p">;</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">fc_bsg_host_vendor_reply</span>		<span class="n">vendor_reply</span><span class="p">;</span>

		<span class="k">struct</span> <span class="n">fc_bsg_ctels_reply</span>		<span class="n">ctels_reply</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">reply_data</span><span class="p">;</span>
<span class="p">};</span>


<span class="cp">#endif </span><span class="cm">/* SCSI_BSG_FC_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
