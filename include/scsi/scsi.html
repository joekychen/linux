<!DOCTYPE html>
<html><head><title>joekychen/linux » include › scsi › scsi.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>scsi.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This header file contains public constants and structures used by</span>
<span class="cm"> * the scsi code for linux.</span>
<span class="cm"> *</span>
<span class="cm"> * For documentation on the OPCODES, MESSAGES, and SENSE values,</span>
<span class="cm"> * please consult the SCSI standard.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _SCSI_SCSI_H</span>
<span class="cp">#define _SCSI_SCSI_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/scatterlist.h&gt;</span>

<span class="k">struct</span> <span class="n">scsi_cmnd</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * The maximum number of SG segments that we will put inside a</span>
<span class="cm"> * scatterlist (unless chaining is used). Should ideally fit inside a</span>
<span class="cm"> * single page, to avoid a higher order allocation.  We could define this</span>
<span class="cm"> * to SG_MAX_SINGLE_ALLOC to pack correctly at the highest order.  The</span>
<span class="cm"> * minimum value is 32</span>
<span class="cm"> */</span>
<span class="cp">#define SCSI_MAX_SG_SEGMENTS	128</span>

<span class="cm">/*</span>
<span class="cm"> * Like SCSI_MAX_SG_SEGMENTS, but for archs that have sg chaining. This limit</span>
<span class="cm"> * is totally arbitrary, a setting of 2048 will get you at least 8mb ios.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef ARCH_HAS_SG_CHAIN</span>
<span class="cp">#define SCSI_MAX_SG_CHAIN_SEGMENTS	2048</span>
<span class="cp">#else</span>
<span class="cp">#define SCSI_MAX_SG_CHAIN_SEGMENTS	SCSI_MAX_SG_SEGMENTS</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * DIX-capable adapters effectively support infinite chaining for the</span>
<span class="cm"> * protection information scatterlist</span>
<span class="cm"> */</span>
<span class="cp">#define SCSI_MAX_PROT_SG_SEGMENTS	0xFFFF</span>

<span class="cm">/*</span>
<span class="cm"> * Special value for scanning to specify scanning or rescanning of all</span>
<span class="cm"> * possible channels, (target) ids, or luns on a given shost.</span>
<span class="cm"> */</span>
<span class="cp">#define SCAN_WILD_CARD	~0</span>

<span class="cm">/*</span>
<span class="cm"> *      SCSI opcodes</span>
<span class="cm"> */</span>

<span class="cp">#define TEST_UNIT_READY       0x00</span>
<span class="cp">#define REZERO_UNIT           0x01</span>
<span class="cp">#define REQUEST_SENSE         0x03</span>
<span class="cp">#define FORMAT_UNIT           0x04</span>
<span class="cp">#define READ_BLOCK_LIMITS     0x05</span>
<span class="cp">#define REASSIGN_BLOCKS       0x07</span>
<span class="cp">#define INITIALIZE_ELEMENT_STATUS 0x07</span>
<span class="cp">#define READ_6                0x08</span>
<span class="cp">#define WRITE_6               0x0a</span>
<span class="cp">#define SEEK_6                0x0b</span>
<span class="cp">#define READ_REVERSE          0x0f</span>
<span class="cp">#define WRITE_FILEMARKS       0x10</span>
<span class="cp">#define SPACE                 0x11</span>
<span class="cp">#define INQUIRY               0x12</span>
<span class="cp">#define RECOVER_BUFFERED_DATA 0x14</span>
<span class="cp">#define MODE_SELECT           0x15</span>
<span class="cp">#define RESERVE               0x16</span>
<span class="cp">#define RELEASE               0x17</span>
<span class="cp">#define COPY                  0x18</span>
<span class="cp">#define ERASE                 0x19</span>
<span class="cp">#define MODE_SENSE            0x1a</span>
<span class="cp">#define START_STOP            0x1b</span>
<span class="cp">#define RECEIVE_DIAGNOSTIC    0x1c</span>
<span class="cp">#define SEND_DIAGNOSTIC       0x1d</span>
<span class="cp">#define ALLOW_MEDIUM_REMOVAL  0x1e</span>

<span class="cp">#define READ_FORMAT_CAPACITIES 0x23</span>
<span class="cp">#define SET_WINDOW            0x24</span>
<span class="cp">#define READ_CAPACITY         0x25</span>
<span class="cp">#define READ_10               0x28</span>
<span class="cp">#define WRITE_10              0x2a</span>
<span class="cp">#define SEEK_10               0x2b</span>
<span class="cp">#define POSITION_TO_ELEMENT   0x2b</span>
<span class="cp">#define WRITE_VERIFY          0x2e</span>
<span class="cp">#define VERIFY                0x2f</span>
<span class="cp">#define SEARCH_HIGH           0x30</span>
<span class="cp">#define SEARCH_EQUAL          0x31</span>
<span class="cp">#define SEARCH_LOW            0x32</span>
<span class="cp">#define SET_LIMITS            0x33</span>
<span class="cp">#define PRE_FETCH             0x34</span>
<span class="cp">#define READ_POSITION         0x34</span>
<span class="cp">#define SYNCHRONIZE_CACHE     0x35</span>
<span class="cp">#define LOCK_UNLOCK_CACHE     0x36</span>
<span class="cp">#define READ_DEFECT_DATA      0x37</span>
<span class="cp">#define MEDIUM_SCAN           0x38</span>
<span class="cp">#define COMPARE               0x39</span>
<span class="cp">#define COPY_VERIFY           0x3a</span>
<span class="cp">#define WRITE_BUFFER          0x3b</span>
<span class="cp">#define READ_BUFFER           0x3c</span>
<span class="cp">#define UPDATE_BLOCK          0x3d</span>
<span class="cp">#define READ_LONG             0x3e</span>
<span class="cp">#define WRITE_LONG            0x3f</span>
<span class="cp">#define CHANGE_DEFINITION     0x40</span>
<span class="cp">#define WRITE_SAME            0x41</span>
<span class="cp">#define UNMAP		      0x42</span>
<span class="cp">#define READ_TOC              0x43</span>
<span class="cp">#define READ_HEADER           0x44</span>
<span class="cp">#define GET_EVENT_STATUS_NOTIFICATION 0x4a</span>
<span class="cp">#define LOG_SELECT            0x4c</span>
<span class="cp">#define LOG_SENSE             0x4d</span>
<span class="cp">#define XDWRITEREAD_10        0x53</span>
<span class="cp">#define MODE_SELECT_10        0x55</span>
<span class="cp">#define RESERVE_10            0x56</span>
<span class="cp">#define RELEASE_10            0x57</span>
<span class="cp">#define MODE_SENSE_10         0x5a</span>
<span class="cp">#define PERSISTENT_RESERVE_IN 0x5e</span>
<span class="cp">#define PERSISTENT_RESERVE_OUT 0x5f</span>
<span class="cp">#define VARIABLE_LENGTH_CMD   0x7f</span>
<span class="cp">#define REPORT_LUNS           0xa0</span>
<span class="cp">#define SECURITY_PROTOCOL_IN  0xa2</span>
<span class="cp">#define MAINTENANCE_IN        0xa3</span>
<span class="cp">#define MAINTENANCE_OUT       0xa4</span>
<span class="cp">#define MOVE_MEDIUM           0xa5</span>
<span class="cp">#define EXCHANGE_MEDIUM       0xa6</span>
<span class="cp">#define READ_12               0xa8</span>
<span class="cp">#define WRITE_12              0xaa</span>
<span class="cp">#define READ_MEDIA_SERIAL_NUMBER 0xab</span>
<span class="cp">#define WRITE_VERIFY_12       0xae</span>
<span class="cp">#define VERIFY_12	      0xaf</span>
<span class="cp">#define SEARCH_HIGH_12        0xb0</span>
<span class="cp">#define SEARCH_EQUAL_12       0xb1</span>
<span class="cp">#define SEARCH_LOW_12         0xb2</span>
<span class="cp">#define SECURITY_PROTOCOL_OUT 0xb5</span>
<span class="cp">#define READ_ELEMENT_STATUS   0xb8</span>
<span class="cp">#define SEND_VOLUME_TAG       0xb6</span>
<span class="cp">#define WRITE_LONG_2          0xea</span>
<span class="cp">#define EXTENDED_COPY         0x83</span>
<span class="cp">#define RECEIVE_COPY_RESULTS  0x84</span>
<span class="cp">#define ACCESS_CONTROL_IN     0x86</span>
<span class="cp">#define ACCESS_CONTROL_OUT    0x87</span>
<span class="cp">#define READ_16               0x88</span>
<span class="cp">#define WRITE_16              0x8a</span>
<span class="cp">#define READ_ATTRIBUTE        0x8c</span>
<span class="cp">#define WRITE_ATTRIBUTE	      0x8d</span>
<span class="cp">#define VERIFY_16	      0x8f</span>
<span class="cp">#define SYNCHRONIZE_CACHE_16  0x91</span>
<span class="cp">#define WRITE_SAME_16	      0x93</span>
<span class="cp">#define SERVICE_ACTION_IN     0x9e</span>
<span class="cm">/* values for service action in */</span>
<span class="cp">#define	SAI_READ_CAPACITY_16  0x10</span>
<span class="cp">#define SAI_GET_LBA_STATUS    0x12</span>
<span class="cm">/* values for VARIABLE_LENGTH_CMD service action codes</span>
<span class="cm"> * see spc4r17 Section D.3.5, table D.7 and D.8 */</span>
<span class="cp">#define VLC_SA_RECEIVE_CREDENTIAL 0x1800</span>
<span class="cm">/* values for maintenance in */</span>
<span class="cp">#define MI_REPORT_IDENTIFYING_INFORMATION 0x05</span>
<span class="cp">#define MI_REPORT_TARGET_PGS  0x0a</span>
<span class="cp">#define MI_REPORT_ALIASES     0x0b</span>
<span class="cp">#define MI_REPORT_SUPPORTED_OPERATION_CODES 0x0c</span>
<span class="cp">#define MI_REPORT_SUPPORTED_TASK_MANAGEMENT_FUNCTIONS 0x0d</span>
<span class="cp">#define MI_REPORT_PRIORITY   0x0e</span>
<span class="cp">#define MI_REPORT_TIMESTAMP  0x0f</span>
<span class="cp">#define MI_MANAGEMENT_PROTOCOL_IN 0x10</span>
<span class="cm">/* values for maintenance out */</span>
<span class="cp">#define MO_SET_IDENTIFYING_INFORMATION 0x06</span>
<span class="cp">#define MO_SET_TARGET_PGS     0x0a</span>
<span class="cp">#define MO_CHANGE_ALIASES     0x0b</span>
<span class="cp">#define MO_SET_PRIORITY       0x0e</span>
<span class="cp">#define MO_SET_TIMESTAMP      0x0f</span>
<span class="cp">#define MO_MANAGEMENT_PROTOCOL_OUT 0x10</span>
<span class="cm">/* values for variable length command */</span>
<span class="cp">#define XDREAD_32	      0x03</span>
<span class="cp">#define XDWRITE_32	      0x04</span>
<span class="cp">#define XPWRITE_32	      0x06</span>
<span class="cp">#define XDWRITEREAD_32	      0x07</span>
<span class="cp">#define READ_32		      0x09</span>
<span class="cp">#define VERIFY_32	      0x0a</span>
<span class="cp">#define WRITE_32	      0x0b</span>
<span class="cp">#define WRITE_SAME_32	      0x0d</span>

<span class="cm">/* Values for T10/04-262r7 */</span>
<span class="cp">#define	ATA_16		      0x85	</span><span class="cm">/* 16-byte pass-thru */</span><span class="cp"></span>
<span class="cp">#define	ATA_12		      0xa1	</span><span class="cm">/* 12-byte pass-thru */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	SCSI command lengths</span>
<span class="cm"> */</span>

<span class="cp">#define SCSI_MAX_VARLEN_CDB_SIZE 260</span>

<span class="cm">/* defined in T10 SCSI Primary Commands-2 (SPC2) */</span>
<span class="k">struct</span> <span class="n">scsi_varlen_cdb_hdr</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">opcode</span><span class="p">;</span>        <span class="cm">/* opcode always == VARIABLE_LENGTH_CMD */</span>
	<span class="n">__u8</span> <span class="n">control</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">misc</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="n">__u8</span> <span class="n">additional_cdb_length</span><span class="p">;</span>         <span class="cm">/* total cdb length - 8 */</span>
	<span class="n">__be16</span> <span class="n">service_action</span><span class="p">;</span>
	<span class="cm">/* service specific data follows */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span>
<span class="nf">scsi_varlen_cdb_length</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">((</span><span class="k">struct</span> <span class="n">scsi_varlen_cdb_hdr</span> <span class="o">*</span><span class="p">)</span><span class="n">hdr</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">additional_cdb_length</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">scsi_command_size_tbl</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="cp">#define COMMAND_SIZE(opcode) scsi_command_size_tbl[((opcode) &gt;&gt; 5) &amp; 7]</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span>
<span class="nf">scsi_command_size</span><span class="p">(</span><span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cmnd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">cmnd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">VARIABLE_LENGTH_CMD</span><span class="p">)</span> <span class="o">?</span>
		<span class="n">scsi_varlen_cdb_length</span><span class="p">(</span><span class="n">cmnd</span><span class="p">)</span> <span class="o">:</span> <span class="n">COMMAND_SIZE</span><span class="p">(</span><span class="n">cmnd</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> *  SCSI Architecture Model (SAM) Status codes. Taken from SAM-3 draft</span>
<span class="cm"> *  T10/1561-D Revision 4 Draft dated 7th November 2002.</span>
<span class="cm"> */</span>
<span class="cp">#define SAM_STAT_GOOD            0x00</span>
<span class="cp">#define SAM_STAT_CHECK_CONDITION 0x02</span>
<span class="cp">#define SAM_STAT_CONDITION_MET   0x04</span>
<span class="cp">#define SAM_STAT_BUSY            0x08</span>
<span class="cp">#define SAM_STAT_INTERMEDIATE    0x10</span>
<span class="cp">#define SAM_STAT_INTERMEDIATE_CONDITION_MET 0x14</span>
<span class="cp">#define SAM_STAT_RESERVATION_CONFLICT 0x18</span>
<span class="cp">#define SAM_STAT_COMMAND_TERMINATED 0x22	</span><span class="cm">/* obsolete in SAM-3 */</span><span class="cp"></span>
<span class="cp">#define SAM_STAT_TASK_SET_FULL   0x28</span>
<span class="cp">#define SAM_STAT_ACA_ACTIVE      0x30</span>
<span class="cp">#define SAM_STAT_TASK_ABORTED    0x40</span>

<span class="cm">/** scsi_status_is_good - check the status return.</span>
<span class="cm"> *</span>
<span class="cm"> * @status: the status passed up from the driver (including host and</span>
<span class="cm"> *          driver components)</span>
<span class="cm"> *</span>
<span class="cm"> * This returns true for known good conditions that may be treated as</span>
<span class="cm"> * command completed normally</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">scsi_status_is_good</span><span class="p">(</span><span class="kt">int</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * FIXME: bit0 is listed as reserved in SCSI-2, but is</span>
<span class="cm">	 * significant in SCSI-3.  For now, we follow the SCSI-2</span>
<span class="cm">	 * behaviour and ignore reserved bits.</span>
<span class="cm">	 */</span>
	<span class="n">status</span> <span class="o">&amp;=</span> <span class="mh">0xfe</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">((</span><span class="n">status</span> <span class="o">==</span> <span class="n">SAM_STAT_GOOD</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">SAM_STAT_INTERMEDIATE</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">SAM_STAT_INTERMEDIATE_CONDITION_MET</span><span class="p">)</span> <span class="o">||</span>
		<span class="cm">/* FIXME: this is obsolete in SAM-3 */</span>
		<span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="n">SAM_STAT_COMMAND_TERMINATED</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> *  Status codes. These are deprecated as they are shifted 1 bit right</span>
<span class="cm"> *  from those found in the SCSI standards. This causes confusion for</span>
<span class="cm"> *  applications that are ported to several OSes. Prefer SAM Status codes</span>
<span class="cm"> *  above.</span>
<span class="cm"> */</span>

<span class="cp">#define GOOD                 0x00</span>
<span class="cp">#define CHECK_CONDITION      0x01</span>
<span class="cp">#define CONDITION_GOOD       0x02</span>
<span class="cp">#define BUSY                 0x04</span>
<span class="cp">#define INTERMEDIATE_GOOD    0x08</span>
<span class="cp">#define INTERMEDIATE_C_GOOD  0x0a</span>
<span class="cp">#define RESERVATION_CONFLICT 0x0c</span>
<span class="cp">#define COMMAND_TERMINATED   0x11</span>
<span class="cp">#define QUEUE_FULL           0x14</span>
<span class="cp">#define ACA_ACTIVE           0x18</span>
<span class="cp">#define TASK_ABORTED         0x20</span>

<span class="cp">#define STATUS_MASK          0xfe</span>

<span class="cm">/*</span>
<span class="cm"> *  SENSE KEYS</span>
<span class="cm"> */</span>

<span class="cp">#define NO_SENSE            0x00</span>
<span class="cp">#define RECOVERED_ERROR     0x01</span>
<span class="cp">#define NOT_READY           0x02</span>
<span class="cp">#define MEDIUM_ERROR        0x03</span>
<span class="cp">#define HARDWARE_ERROR      0x04</span>
<span class="cp">#define ILLEGAL_REQUEST     0x05</span>
<span class="cp">#define UNIT_ATTENTION      0x06</span>
<span class="cp">#define DATA_PROTECT        0x07</span>
<span class="cp">#define BLANK_CHECK         0x08</span>
<span class="cp">#define COPY_ABORTED        0x0a</span>
<span class="cp">#define ABORTED_COMMAND     0x0b</span>
<span class="cp">#define VOLUME_OVERFLOW     0x0d</span>
<span class="cp">#define MISCOMPARE          0x0e</span>


<span class="cm">/*</span>
<span class="cm"> *  DEVICE TYPES</span>
<span class="cm"> *  Please keep them in 0x%02x format for $MODALIAS to work</span>
<span class="cm"> */</span>

<span class="cp">#define TYPE_DISK           0x00</span>
<span class="cp">#define TYPE_TAPE           0x01</span>
<span class="cp">#define TYPE_PRINTER        0x02</span>
<span class="cp">#define TYPE_PROCESSOR      0x03    </span><span class="cm">/* HP scanners use this */</span><span class="cp"></span>
<span class="cp">#define TYPE_WORM           0x04    </span><span class="cm">/* Treated as ROM by our system */</span><span class="cp"></span>
<span class="cp">#define TYPE_ROM            0x05</span>
<span class="cp">#define TYPE_SCANNER        0x06</span>
<span class="cp">#define TYPE_MOD            0x07    </span><span class="cm">/* Magneto-optical disk - </span>
<span class="cm">				     * - treated as TYPE_DISK */</span><span class="cp"></span>
<span class="cp">#define TYPE_MEDIUM_CHANGER 0x08</span>
<span class="cp">#define TYPE_COMM           0x09    </span><span class="cm">/* Communications device */</span><span class="cp"></span>
<span class="cp">#define TYPE_RAID           0x0c</span>
<span class="cp">#define TYPE_ENCLOSURE      0x0d    </span><span class="cm">/* Enclosure Services Device */</span><span class="cp"></span>
<span class="cp">#define TYPE_RBC	    0x0e</span>
<span class="cp">#define TYPE_OSD            0x11</span>
<span class="cp">#define TYPE_NO_LUN         0x7f</span>

<span class="cm">/* SCSI protocols; these are taken from SPC-3 section 7.5 */</span>
<span class="k">enum</span> <span class="n">scsi_protocol</span> <span class="p">{</span>
	<span class="n">SCSI_PROTOCOL_FCP</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* Fibre Channel */</span>
	<span class="n">SCSI_PROTOCOL_SPI</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* parallel SCSI */</span>
	<span class="n">SCSI_PROTOCOL_SSA</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Serial Storage Architecture - Obsolete */</span>
	<span class="n">SCSI_PROTOCOL_SBP</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>	<span class="cm">/* firewire */</span>
	<span class="n">SCSI_PROTOCOL_SRP</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Infiniband RDMA */</span>
	<span class="n">SCSI_PROTOCOL_ISCSI</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">SCSI_PROTOCOL_SAS</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">SCSI_PROTOCOL_ADT</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>	<span class="cm">/* Media Changers */</span>
	<span class="n">SCSI_PROTOCOL_ATA</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="n">SCSI_PROTOCOL_UNSPEC</span> <span class="o">=</span> <span class="mh">0xf</span><span class="p">,</span> <span class="cm">/* No specific protocol */</span>
<span class="p">};</span>

<span class="cm">/* Returns a human-readable name for the device */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">scsi_device_type</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">type</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * standard mode-select header prepended to all mode-select commands</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">ccs_modesel_head</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">_r1</span><span class="p">;</span>			<span class="cm">/* reserved */</span>
	<span class="n">__u8</span> <span class="n">medium</span><span class="p">;</span>		<span class="cm">/* device-specific medium type */</span>
	<span class="n">__u8</span> <span class="n">_r2</span><span class="p">;</span>			<span class="cm">/* reserved */</span>
	<span class="n">__u8</span> <span class="n">block_desc_length</span><span class="p">;</span>	<span class="cm">/* block descriptor length */</span>
	<span class="n">__u8</span> <span class="n">density</span><span class="p">;</span>		<span class="cm">/* device-specific density code */</span>
	<span class="n">__u8</span> <span class="n">number_blocks_hi</span><span class="p">;</span>	<span class="cm">/* number of blocks in this block desc */</span>
	<span class="n">__u8</span> <span class="n">number_blocks_med</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">number_blocks_lo</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">_r3</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">block_length_hi</span><span class="p">;</span>	<span class="cm">/* block length for blocks in this desc */</span>
	<span class="n">__u8</span> <span class="n">block_length_med</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">block_length_lo</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * ScsiLun: 8 byte LUN.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">scsi_lun</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">scsi_lun</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * The Well Known LUNS (SAM-3) in our int representation of a LUN</span>
<span class="cm"> */</span>
<span class="cp">#define SCSI_W_LUN_BASE 0xc100</span>
<span class="cp">#define SCSI_W_LUN_REPORT_LUNS (SCSI_W_LUN_BASE + 1)</span>
<span class="cp">#define SCSI_W_LUN_ACCESS_CONTROL (SCSI_W_LUN_BASE + 2)</span>
<span class="cp">#define SCSI_W_LUN_TARGET_LOG_PAGE (SCSI_W_LUN_BASE + 3)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">scsi_is_wlun</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lun</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">lun</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">==</span> <span class="n">SCSI_W_LUN_BASE</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> *  MESSAGE CODES</span>
<span class="cm"> */</span>

<span class="cp">#define COMMAND_COMPLETE    0x00</span>
<span class="cp">#define EXTENDED_MESSAGE    0x01</span>
<span class="cp">#define     EXTENDED_MODIFY_DATA_POINTER    0x00</span>
<span class="cp">#define     EXTENDED_SDTR                   0x01</span>
<span class="cp">#define     EXTENDED_EXTENDED_IDENTIFY      0x02    </span><span class="cm">/* SCSI-I only */</span><span class="cp"></span>
<span class="cp">#define     EXTENDED_WDTR                   0x03</span>
<span class="cp">#define     EXTENDED_PPR                    0x04</span>
<span class="cp">#define     EXTENDED_MODIFY_BIDI_DATA_PTR   0x05</span>
<span class="cp">#define SAVE_POINTERS       0x02</span>
<span class="cp">#define RESTORE_POINTERS    0x03</span>
<span class="cp">#define DISCONNECT          0x04</span>
<span class="cp">#define INITIATOR_ERROR     0x05</span>
<span class="cp">#define ABORT_TASK_SET      0x06</span>
<span class="cp">#define MESSAGE_REJECT      0x07</span>
<span class="cp">#define NOP                 0x08</span>
<span class="cp">#define MSG_PARITY_ERROR    0x09</span>
<span class="cp">#define LINKED_CMD_COMPLETE 0x0a</span>
<span class="cp">#define LINKED_FLG_CMD_COMPLETE 0x0b</span>
<span class="cp">#define TARGET_RESET        0x0c</span>
<span class="cp">#define ABORT_TASK          0x0d</span>
<span class="cp">#define CLEAR_TASK_SET      0x0e</span>
<span class="cp">#define INITIATE_RECOVERY   0x0f            </span><span class="cm">/* SCSI-II only */</span><span class="cp"></span>
<span class="cp">#define RELEASE_RECOVERY    0x10            </span><span class="cm">/* SCSI-II only */</span><span class="cp"></span>
<span class="cp">#define CLEAR_ACA           0x16</span>
<span class="cp">#define LOGICAL_UNIT_RESET  0x17</span>
<span class="cp">#define SIMPLE_QUEUE_TAG    0x20</span>
<span class="cp">#define HEAD_OF_QUEUE_TAG   0x21</span>
<span class="cp">#define ORDERED_QUEUE_TAG   0x22</span>
<span class="cp">#define IGNORE_WIDE_RESIDUE 0x23</span>
<span class="cp">#define ACA                 0x24</span>
<span class="cp">#define QAS_REQUEST         0x55</span>

<span class="cm">/* Old SCSI2 names, don&#39;t use in new code */</span>
<span class="cp">#define BUS_DEVICE_RESET    TARGET_RESET</span>
<span class="cp">#define ABORT               ABORT_TASK_SET</span>

<span class="cm">/*</span>
<span class="cm"> * Host byte codes</span>
<span class="cm"> */</span>

<span class="cp">#define DID_OK          0x00	</span><span class="cm">/* NO error                                */</span><span class="cp"></span>
<span class="cp">#define DID_NO_CONNECT  0x01	</span><span class="cm">/* Couldn&#39;t connect before timeout period  */</span><span class="cp"></span>
<span class="cp">#define DID_BUS_BUSY    0x02	</span><span class="cm">/* BUS stayed busy through time out period */</span><span class="cp"></span>
<span class="cp">#define DID_TIME_OUT    0x03	</span><span class="cm">/* TIMED OUT for other reason              */</span><span class="cp"></span>
<span class="cp">#define DID_BAD_TARGET  0x04	</span><span class="cm">/* BAD target.                             */</span><span class="cp"></span>
<span class="cp">#define DID_ABORT       0x05	</span><span class="cm">/* Told to abort for some other reason     */</span><span class="cp"></span>
<span class="cp">#define DID_PARITY      0x06	</span><span class="cm">/* Parity error                            */</span><span class="cp"></span>
<span class="cp">#define DID_ERROR       0x07	</span><span class="cm">/* Internal error                          */</span><span class="cp"></span>
<span class="cp">#define DID_RESET       0x08	</span><span class="cm">/* Reset by somebody.                      */</span><span class="cp"></span>
<span class="cp">#define DID_BAD_INTR    0x09	</span><span class="cm">/* Got an interrupt we weren&#39;t expecting.  */</span><span class="cp"></span>
<span class="cp">#define DID_PASSTHROUGH 0x0a	</span><span class="cm">/* Force command past mid-layer            */</span><span class="cp"></span>
<span class="cp">#define DID_SOFT_ERROR  0x0b	</span><span class="cm">/* The low level driver just wish a retry  */</span><span class="cp"></span>
<span class="cp">#define DID_IMM_RETRY   0x0c	</span><span class="cm">/* Retry without decrementing retry count  */</span><span class="cp"></span>
<span class="cp">#define DID_REQUEUE	0x0d	</span><span class="cm">/* Requeue command (no immediate retry) also</span>
<span class="cm">				 * without decrementing the retry count	   */</span><span class="cp"></span>
<span class="cp">#define DID_TRANSPORT_DISRUPTED 0x0e </span><span class="cm">/* Transport error disrupted execution</span>
<span class="cm">				      * and the driver blocked the port to</span>
<span class="cm">				      * recover the link. Transport class will</span>
<span class="cm">				      * retry or fail IO */</span><span class="cp"></span>
<span class="cp">#define DID_TRANSPORT_FAILFAST	0x0f </span><span class="cm">/* Transport class fastfailed the io */</span><span class="cp"></span>
<span class="cp">#define DID_TARGET_FAILURE 0x10 </span><span class="cm">/* Permanent target failure, do not retry on</span>
<span class="cm">				 * other paths */</span><span class="cp"></span>
<span class="cp">#define DID_NEXUS_FAILURE 0x11  </span><span class="cm">/* Permanent nexus failure, retry on other</span>
<span class="cm">				 * paths might yield different results */</span><span class="cp"></span>
<span class="cp">#define DRIVER_OK       0x00	</span><span class="cm">/* Driver status                           */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *  These indicate the error that occurred, and what is available.</span>
<span class="cm"> */</span>

<span class="cp">#define DRIVER_BUSY         0x01</span>
<span class="cp">#define DRIVER_SOFT         0x02</span>
<span class="cp">#define DRIVER_MEDIA        0x03</span>
<span class="cp">#define DRIVER_ERROR        0x04</span>

<span class="cp">#define DRIVER_INVALID      0x05</span>
<span class="cp">#define DRIVER_TIMEOUT      0x06</span>
<span class="cp">#define DRIVER_HARD         0x07</span>
<span class="cp">#define DRIVER_SENSE	    0x08</span>

<span class="cm">/*</span>
<span class="cm"> * Internal return values.</span>
<span class="cm"> */</span>

<span class="cp">#define NEEDS_RETRY     0x2001</span>
<span class="cp">#define SUCCESS         0x2002</span>
<span class="cp">#define FAILED          0x2003</span>
<span class="cp">#define QUEUED          0x2004</span>
<span class="cp">#define SOFT_ERROR      0x2005</span>
<span class="cp">#define ADD_TO_MLQUEUE  0x2006</span>
<span class="cp">#define TIMEOUT_ERROR   0x2007</span>
<span class="cp">#define SCSI_RETURN_NOT_HANDLED   0x2008</span>
<span class="cp">#define FAST_IO_FAIL	0x2009</span>
<span class="cp">#define TARGET_ERROR    0x200A</span>

<span class="cm">/*</span>
<span class="cm"> * Midlevel queue return values.</span>
<span class="cm"> */</span>
<span class="cp">#define SCSI_MLQUEUE_HOST_BUSY   0x1055</span>
<span class="cp">#define SCSI_MLQUEUE_DEVICE_BUSY 0x1056</span>
<span class="cp">#define SCSI_MLQUEUE_EH_RETRY    0x1057</span>
<span class="cp">#define SCSI_MLQUEUE_TARGET_BUSY 0x1058</span>

<span class="cm">/*</span>
<span class="cm"> *  Use these to separate status msg and our bytes</span>
<span class="cm"> *</span>
<span class="cm"> *  These are set by:</span>
<span class="cm"> *</span>
<span class="cm"> *      status byte = set from target device</span>
<span class="cm"> *      msg_byte    = return status from host adapter itself.</span>
<span class="cm"> *      host_byte   = set by low-level driver to indicate status.</span>
<span class="cm"> *      driver_byte = set by mid-level.</span>
<span class="cm"> */</span>
<span class="cp">#define status_byte(result) (((result) &gt;&gt; 1) &amp; 0x7f)</span>
<span class="cp">#define msg_byte(result)    (((result) &gt;&gt; 8) &amp; 0xff)</span>
<span class="cp">#define host_byte(result)   (((result) &gt;&gt; 16) &amp; 0xff)</span>
<span class="cp">#define driver_byte(result) (((result) &gt;&gt; 24) &amp; 0xff)</span>

<span class="cp">#define sense_class(sense)  (((sense) &gt;&gt; 4) &amp; 0x7)</span>
<span class="cp">#define sense_error(sense)  ((sense) &amp; 0xf)</span>
<span class="cp">#define sense_valid(sense)  ((sense) &amp; 0x80)</span>

<span class="cm">/*</span>
<span class="cm"> * default timeouts</span>
<span class="cm">*/</span>
<span class="cp">#define FORMAT_UNIT_TIMEOUT		(2 * 60 * 60 * HZ)</span>
<span class="cp">#define START_STOP_TIMEOUT		(60 * HZ)</span>
<span class="cp">#define MOVE_MEDIUM_TIMEOUT		(5 * 60 * HZ)</span>
<span class="cp">#define READ_ELEMENT_STATUS_TIMEOUT	(5 * 60 * HZ)</span>
<span class="cp">#define READ_DEFECT_DATA_TIMEOUT	(60 * HZ )</span>


<span class="cp">#define IDENTIFY_BASE       0x80</span>
<span class="cp">#define IDENTIFY(can_disconnect, lun)   (IDENTIFY_BASE |\</span>
<span class="cp">		     ((can_disconnect) ?  0x40 : 0) |\</span>
<span class="cp">		     ((lun) &amp; 0x07))</span>

<span class="cm">/*</span>
<span class="cm"> *  struct scsi_device::scsi_level values. For SCSI devices other than those</span>
<span class="cm"> *  prior to SCSI-2 (i.e. over 12 years old) this value is (resp[2] + 1)</span>
<span class="cm"> *  where &quot;resp&quot; is a byte array of the response to an INQUIRY. The scsi_level</span>
<span class="cm"> *  variable is visible to the user via sysfs.</span>
<span class="cm"> */</span>

<span class="cp">#define SCSI_UNKNOWN    0</span>
<span class="cp">#define SCSI_1          1</span>
<span class="cp">#define SCSI_1_CCS      2</span>
<span class="cp">#define SCSI_2          3</span>
<span class="cp">#define SCSI_3          4        </span><span class="cm">/* SPC */</span><span class="cp"></span>
<span class="cp">#define SCSI_SPC_2      5</span>
<span class="cp">#define SCSI_SPC_3      6</span>

<span class="cm">/*</span>
<span class="cm"> * INQ PERIPHERAL QUALIFIERS</span>
<span class="cm"> */</span>
<span class="cp">#define SCSI_INQ_PQ_CON         0x00</span>
<span class="cp">#define SCSI_INQ_PQ_NOT_CON     0x01</span>
<span class="cp">#define SCSI_INQ_PQ_NOT_CAP     0x03</span>


<span class="cm">/*</span>
<span class="cm"> * Here are some scsi specific ioctl commands which are sometimes useful.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that include/linux/cdrom.h also defines IOCTL 0x5300 - 0x5395</span>
<span class="cm"> */</span>

<span class="cm">/* Used to obtain PUN and LUN info.  Conflicts with CDROMAUDIOBUFSIZ */</span>
<span class="cp">#define SCSI_IOCTL_GET_IDLUN		0x5382</span>

<span class="cm">/* 0x5383 and 0x5384 were used for SCSI_IOCTL_TAGGED_{ENABLE,DISABLE} */</span>

<span class="cm">/* Used to obtain the host number of a device. */</span>
<span class="cp">#define SCSI_IOCTL_PROBE_HOST		0x5385</span>

<span class="cm">/* Used to obtain the bus number for a device */</span>
<span class="cp">#define SCSI_IOCTL_GET_BUS_NUMBER	0x5386</span>

<span class="cm">/* Used to obtain the PCI location of a device */</span>
<span class="cp">#define SCSI_IOCTL_GET_PCI		0x5387</span>

<span class="cm">/* Pull a u32 out of a SCSI message (using BE SCSI conventions) */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">__u32</span> <span class="nf">scsi_to_u32</span><span class="p">(</span><span class="n">__u8</span> <span class="o">*</span><span class="n">ptr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* _SCSI_SCSI_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
