<!DOCTYPE html>
<html><head><title>joekychen/linux » include › scsi › fc › fc_fcp.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>fc_fcp.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright(c) 2007 Intel Corporation. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms and conditions of the GNU General Public License,</span>
<span class="cm"> * version 2, as published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope it will be useful, but WITHOUT</span>
<span class="cm"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm"> * more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along with</span>
<span class="cm"> * this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> * 51 Franklin St - Fifth Floor, Boston, MA 02110-1301 USA.</span>
<span class="cm"> *</span>
<span class="cm"> * Maintained at www.Open-FCoE.org</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _FC_FCP_H_</span>
<span class="cp">#define	_FC_FCP_H_</span>

<span class="cp">#include &lt;scsi/scsi.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Fibre Channel Protocol for SCSI.</span>
<span class="cm"> * From T10 FCP-3, T10 project 1560-D Rev 4, Sept. 13, 2005.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * fc/fs.h defines FC_TYPE_FCP.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Service parameter page parameters (word 3 bits) for Process Login.</span>
<span class="cm"> */</span>
<span class="cp">#define	FCP_SPPF_TASK_RETRY_ID	0x0200	</span><span class="cm">/* task retry ID requested */</span><span class="cp"></span>
<span class="cp">#define	FCP_SPPF_RETRY		0x0100	</span><span class="cm">/* retry supported */</span><span class="cp"></span>
<span class="cp">#define	FCP_SPPF_CONF_COMPL	0x0080	</span><span class="cm">/* confirmed completion allowed */</span><span class="cp"></span>
<span class="cp">#define	FCP_SPPF_OVLY_ALLOW	0x0040	</span><span class="cm">/* data overlay allowed */</span><span class="cp"></span>
<span class="cp">#define	FCP_SPPF_INIT_FCN	0x0020	</span><span class="cm">/* initiator function */</span><span class="cp"></span>
<span class="cp">#define	FCP_SPPF_TARG_FCN	0x0010	</span><span class="cm">/* target function */</span><span class="cp"></span>
<span class="cp">#define	FCP_SPPF_RD_XRDY_DIS	0x0002	</span><span class="cm">/* disable XFER_RDY for reads */</span><span class="cp"></span>
<span class="cp">#define	FCP_SPPF_WR_XRDY_DIS	0x0001	</span><span class="cm">/* disable XFER_RDY for writes */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * FCP_CMND IU Payload.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fcp_cmnd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">scsi_lun</span>	<span class="n">fc_lun</span><span class="p">;</span>		<span class="cm">/* logical unit number */</span>
	<span class="n">__u8</span>		<span class="n">fc_cmdref</span><span class="p">;</span>	<span class="cm">/* command reference number */</span>
	<span class="n">__u8</span>		<span class="n">fc_pri_ta</span><span class="p">;</span>	<span class="cm">/* priority and task attribute */</span>
	<span class="n">__u8</span>		<span class="n">fc_tm_flags</span><span class="p">;</span>	<span class="cm">/* task management flags */</span>
	<span class="n">__u8</span>		<span class="n">fc_flags</span><span class="p">;</span>	<span class="cm">/* additional len &amp; flags */</span>
	<span class="n">__u8</span>		<span class="n">fc_cdb</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>	<span class="cm">/* base CDB */</span>
	<span class="n">__be32</span>		<span class="n">fc_dl</span><span class="p">;</span>		<span class="cm">/* data length (must follow fc_cdb) */</span>
<span class="p">};</span>

<span class="cp">#define	FCP_CMND_LEN	32	</span><span class="cm">/* expected length of structure */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">fcp_cmnd32</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">scsi_lun</span>	<span class="n">fc_lun</span><span class="p">;</span>		<span class="cm">/* logical unit number */</span>
	<span class="n">__u8</span>		<span class="n">fc_cmdref</span><span class="p">;</span>	<span class="cm">/* command reference number */</span>
	<span class="n">__u8</span>		<span class="n">fc_pri_ta</span><span class="p">;</span>	<span class="cm">/* priority and task attribute */</span>
	<span class="n">__u8</span>		<span class="n">fc_tm_flags</span><span class="p">;</span>	<span class="cm">/* task management flags */</span>
	<span class="n">__u8</span>		<span class="n">fc_flags</span><span class="p">;</span>	<span class="cm">/* additional len &amp; flags */</span>
	<span class="n">__u8</span>		<span class="n">fc_cdb</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>	<span class="cm">/* base CDB */</span>
	<span class="n">__be32</span>		<span class="n">fc_dl</span><span class="p">;</span>		<span class="cm">/* data length (must follow fc_cdb) */</span>
<span class="p">};</span>

<span class="cp">#define	FCP_CMND32_LEN	    48	</span><span class="cm">/* expected length of structure */</span><span class="cp"></span>
<span class="cp">#define	FCP_CMND32_ADD_LEN  (16 / 4)	</span><span class="cm">/* Additional cdb length */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * fc_pri_ta.</span>
<span class="cm"> */</span>
<span class="cp">#define	FCP_PTA_SIMPLE	    0	</span><span class="cm">/* simple task attribute */</span><span class="cp"></span>
<span class="cp">#define	FCP_PTA_HEADQ	    1	</span><span class="cm">/* head of queue task attribute */</span><span class="cp"></span>
<span class="cp">#define	FCP_PTA_ORDERED     2	</span><span class="cm">/* ordered task attribute */</span><span class="cp"></span>
<span class="cp">#define	FCP_PTA_ACA	    4	</span><span class="cm">/* auto. contingent allegiance */</span><span class="cp"></span>
<span class="cp">#define	FCP_PTA_MASK	    7	</span><span class="cm">/* mask for task attribute field */</span><span class="cp"></span>
<span class="cp">#define	FCP_PRI_SHIFT	    3	</span><span class="cm">/* priority field starts in bit 3 */</span><span class="cp"></span>
<span class="cp">#define	FCP_PRI_RESVD_MASK  0x80	</span><span class="cm">/* reserved bits in priority field */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * fc_tm_flags - task management flags field.</span>
<span class="cm"> */</span>
<span class="cp">#define	FCP_TMF_CLR_ACA		0x40	</span><span class="cm">/* clear ACA condition */</span><span class="cp"></span>
<span class="cp">#define	FCP_TMF_TGT_RESET	0x20	</span><span class="cm">/* target reset task management,</span>
<span class="cm">					   deprecated as of FCP-3 */</span><span class="cp"></span>
<span class="cp">#define	FCP_TMF_LUN_RESET	0x10	</span><span class="cm">/* logical unit reset task management */</span><span class="cp"></span>
<span class="cp">#define	FCP_TMF_CLR_TASK_SET	0x04	</span><span class="cm">/* clear task set */</span><span class="cp"></span>
<span class="cp">#define	FCP_TMF_ABT_TASK_SET	0x02	</span><span class="cm">/* abort task set */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * fc_flags.</span>
<span class="cm"> *  Bits 7:2 are the additional FCP_CDB length / 4.</span>
<span class="cm"> */</span>
<span class="cp">#define	FCP_CFL_LEN_MASK	0xfc	</span><span class="cm">/* mask for additional length */</span><span class="cp"></span>
<span class="cp">#define	FCP_CFL_LEN_SHIFT	2	</span><span class="cm">/* shift bits for additional length */</span><span class="cp"></span>
<span class="cp">#define	FCP_CFL_RDDATA		0x02	</span><span class="cm">/* read data */</span><span class="cp"></span>
<span class="cp">#define	FCP_CFL_WRDATA		0x01	</span><span class="cm">/* write data */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * FCP_TXRDY IU - transfer ready payload.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fcp_txrdy</span> <span class="p">{</span>
	<span class="n">__be32</span>		<span class="n">ft_data_ro</span><span class="p">;</span>	<span class="cm">/* data relative offset */</span>
	<span class="n">__be32</span>		<span class="n">ft_burst_len</span><span class="p">;</span>	<span class="cm">/* burst length */</span>
	<span class="n">__u8</span>		<span class="n">_ft_resvd</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* reserved */</span>
<span class="p">};</span>

<span class="cp">#define	FCP_TXRDY_LEN	12	</span><span class="cm">/* expected length of structure */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * FCP_RESP IU - response payload.</span>
<span class="cm"> *</span>
<span class="cm"> * The response payload comes in three parts: the flags/status, the</span>
<span class="cm"> * sense/response lengths and the sense data/response info section.</span>
<span class="cm"> *</span>
<span class="cm"> * From FCP3r04, note 6 of section 9.5.13:</span>
<span class="cm"> *</span>
<span class="cm"> * Some early implementations presented the FCP_RSP IU without the FCP_RESID,</span>
<span class="cm"> * FCP_SNS_LEN, and FCP_RSP_LEN fields if the FCP_RESID_UNDER, FCP_RESID_OVER,</span>
<span class="cm"> * FCP_SNS_LEN_VALID, and FCP_RSP_LEN_VALID bits were all set to zero. This</span>
<span class="cm"> * non-standard behavior should be tolerated.</span>
<span class="cm"> *</span>
<span class="cm"> * All response frames will always contain the fcp_resp template.  Some</span>
<span class="cm"> * will also include the fcp_resp_len template.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fcp_resp</span> <span class="p">{</span>
	<span class="n">__u8</span>		<span class="n">_fr_resvd</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>	<span class="cm">/* reserved */</span>
	<span class="n">__be16</span>		<span class="n">fr_retry_delay</span><span class="p">;</span>	<span class="cm">/* retry delay timer */</span>
	<span class="n">__u8</span>		<span class="n">fr_flags</span><span class="p">;</span>	<span class="cm">/* flags */</span>
	<span class="n">__u8</span>		<span class="n">fr_status</span><span class="p">;</span>	<span class="cm">/* SCSI status code */</span>
<span class="p">};</span>

<span class="cp">#define	FCP_RESP_LEN	12	</span><span class="cm">/* expected length of structure */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">fcp_resp_ext</span> <span class="p">{</span>
	<span class="n">__be32</span>		<span class="n">fr_resid</span><span class="p">;</span>	<span class="cm">/* Residual value */</span>
	<span class="n">__be32</span>		<span class="n">fr_sns_len</span><span class="p">;</span>	<span class="cm">/* SCSI Sense length */</span>
	<span class="n">__be32</span>		<span class="n">fr_rsp_len</span><span class="p">;</span>	<span class="cm">/* Response Info length */</span>

	<span class="cm">/*</span>
<span class="cm">	 * Optionally followed by RSP info and/or SNS info and/or</span>
<span class="cm">	 * bidirectional read residual length, if any.</span>
<span class="cm">	 */</span>
<span class="p">};</span>

<span class="cp">#define FCP_RESP_EXT_LEN    12  </span><span class="cm">/* expected length of the structure */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">fcp_resp_rsp_info</span> <span class="p">{</span>
    <span class="n">__u8</span>      <span class="n">_fr_resvd</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>       <span class="cm">/* reserved */</span>
    <span class="n">__u8</span>      <span class="n">rsp_code</span><span class="p">;</span>           <span class="cm">/* Response Info Code */</span>
    <span class="n">__u8</span>      <span class="n">_fr_resvd2</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>      <span class="cm">/* reserved */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fcp_resp_with_ext</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fcp_resp</span> <span class="n">resp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fcp_resp_ext</span> <span class="n">ext</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define	FCP_RESP_WITH_EXT   (FCP_RESP_LEN + FCP_RESP_EXT_LEN)</span>

<span class="cm">/*</span>
<span class="cm"> * fr_flags.</span>
<span class="cm"> */</span>
<span class="cp">#define	FCP_BIDI_RSP	    0x80	</span><span class="cm">/* bidirectional read response */</span><span class="cp"></span>
<span class="cp">#define	FCP_BIDI_READ_UNDER 0x40	</span><span class="cm">/* bidir. read less than requested */</span><span class="cp"></span>
<span class="cp">#define	FCP_BIDI_READ_OVER  0x20	</span><span class="cm">/* DL insufficient for full transfer */</span><span class="cp"></span>
<span class="cp">#define	FCP_CONF_REQ	    0x10	</span><span class="cm">/* confirmation requested */</span><span class="cp"></span>
<span class="cp">#define	FCP_RESID_UNDER     0x08	</span><span class="cm">/* transfer shorter than expected */</span><span class="cp"></span>
<span class="cp">#define	FCP_RESID_OVER	    0x04	</span><span class="cm">/* DL insufficient for full transfer */</span><span class="cp"></span>
<span class="cp">#define	FCP_SNS_LEN_VAL     0x02	</span><span class="cm">/* SNS_LEN field is valid */</span><span class="cp"></span>
<span class="cp">#define	FCP_RSP_LEN_VAL     0x01	</span><span class="cm">/* RSP_LEN field is valid */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * rsp_codes</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">fcp_resp_rsp_codes</span> <span class="p">{</span>
	<span class="n">FCP_TMF_CMPL</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">FCP_DATA_LEN_INVALID</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">FCP_CMND_FIELDS_INVALID</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">FCP_DATA_PARAM_MISMATCH</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">FCP_TMF_REJECTED</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">FCP_TMF_FAILED</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">FCP_TMF_INVALID_LUN</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * FCP SRR Link Service request - Sequence Retransmission Request.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fcp_srr</span> <span class="p">{</span>
	<span class="n">__u8</span>		<span class="n">srr_op</span><span class="p">;</span>		<span class="cm">/* opcode ELS_SRR */</span>
	<span class="n">__u8</span>		<span class="n">srr_resvd</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>	<span class="cm">/* opcode / reserved - must be zero */</span>
	<span class="n">__be16</span>		<span class="n">srr_ox_id</span><span class="p">;</span>	<span class="cm">/* OX_ID of failed command */</span>
	<span class="n">__be16</span>		<span class="n">srr_rx_id</span><span class="p">;</span>	<span class="cm">/* RX_ID of failed command */</span>
	<span class="n">__be32</span>		<span class="n">srr_rel_off</span><span class="p">;</span>	<span class="cm">/* relative offset */</span>
	<span class="n">__u8</span>		<span class="n">srr_r_ctl</span><span class="p">;</span>	<span class="cm">/* r_ctl for the information unit */</span>
	<span class="n">__u8</span>		<span class="n">srr_resvd2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>	<span class="cm">/* reserved */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Feature bits in name server FC-4 Features object.</span>
<span class="cm"> */</span>
<span class="cp">#define	FCP_FEAT_TARG	(1 &lt;&lt; 0)	</span><span class="cm">/* target function supported */</span><span class="cp"></span>
<span class="cp">#define	FCP_FEAT_INIT	(1 &lt;&lt; 1)	</span><span class="cm">/* initiator function supported */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _FC_FCP_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
