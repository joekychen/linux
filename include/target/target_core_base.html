<!DOCTYPE html>
<html><head><title>joekychen/linux » include › target › target_core_base.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>target_core_base.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef TARGET_CORE_BASE_H</span>
<span class="cp">#define TARGET_CORE_BASE_H</span>

<span class="cp">#include &lt;linux/in.h&gt;</span>
<span class="cp">#include &lt;linux/configfs.h&gt;</span>
<span class="cp">#include &lt;linux/dma-mapping.h&gt;</span>
<span class="cp">#include &lt;linux/blkdev.h&gt;</span>
<span class="cp">#include &lt;scsi/scsi_cmnd.h&gt;</span>
<span class="cp">#include &lt;net/sock.h&gt;</span>
<span class="cp">#include &lt;net/tcp.h&gt;</span>

<span class="cp">#define TARGET_CORE_MOD_VERSION		&quot;v4.1.0-rc2-ml&quot;</span>
<span class="cp">#define TARGET_CORE_VERSION		TARGET_CORE_MOD_VERSION</span>

<span class="cm">/* Maximum Number of LUNs per Target Portal Group */</span>
<span class="cm">/* Don&#39;t raise above 511 or REPORT_LUNS needs to handle &gt;1 page */</span>
<span class="cp">#define TRANSPORT_MAX_LUNS_PER_TPG		256</span>
<span class="cm">/*</span>
<span class="cm"> * By default we use 32-byte CDBs in TCM Core and subsystem plugin code.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that both include/scsi/scsi_cmnd.h:MAX_COMMAND_SIZE and</span>
<span class="cm"> * include/linux/blkdev.h:BLOCK_MAX_CDB as of v2.6.36-rc4 still use</span>
<span class="cm"> * 16-byte CDBs by default and require an extra allocation for</span>
<span class="cm"> * 32-byte CDBs to because of legacy issues.</span>
<span class="cm"> *</span>
<span class="cm"> * Within TCM Core there are no such legacy limitiations, so we go ahead</span>
<span class="cm"> * use 32-byte CDBs by default and use include/scsi/scsi.h:scsi_command_size()</span>
<span class="cm"> * within all TCM Core and subsystem plugin code.</span>
<span class="cm"> */</span>
<span class="cp">#define TCM_MAX_COMMAND_SIZE			32</span>
<span class="cm">/*</span>
<span class="cm"> * From include/scsi/scsi_cmnd.h:SCSI_SENSE_BUFFERSIZE, currently</span>
<span class="cm"> * defined 96, but the real limit is 252 (or 260 including the header)</span>
<span class="cm"> */</span>
<span class="cp">#define TRANSPORT_SENSE_BUFFER			SCSI_SENSE_BUFFERSIZE</span>
<span class="cm">/* Used by transport_send_check_condition_and_sense() */</span>
<span class="cp">#define SPC_SENSE_KEY_OFFSET			2</span>
<span class="cp">#define SPC_ADD_SENSE_LEN_OFFSET		7</span>
<span class="cp">#define SPC_ASC_KEY_OFFSET			12</span>
<span class="cp">#define SPC_ASCQ_KEY_OFFSET			13</span>
<span class="cp">#define TRANSPORT_IQN_LEN			224</span>
<span class="cm">/* Used by target_core_store_alua_lu_gp() and target_core_alua_lu_gp_show_attr_members() */</span>
<span class="cp">#define LU_GROUP_NAME_BUF			256</span>
<span class="cm">/* Used by core_alua_store_tg_pt_gp_info() and target_core_alua_tg_pt_gp_show_attr_members() */</span>
<span class="cp">#define TG_PT_GROUP_NAME_BUF			256</span>
<span class="cm">/* Used to parse VPD into struct t10_vpd */</span>
<span class="cp">#define VPD_TMP_BUF_SIZE			128</span>
<span class="cm">/* Used by transport_generic_cmd_sequencer() */</span>
<span class="cp">#define READ_BLOCK_LEN          		6</span>
<span class="cp">#define READ_CAP_LEN            		8</span>
<span class="cp">#define READ_POSITION_LEN       		20</span>
<span class="cp">#define INQUIRY_LEN				36</span>
<span class="cm">/* Used by transport_get_inquiry_vpd_serial() */</span>
<span class="cp">#define INQUIRY_VPD_SERIAL_LEN			254</span>
<span class="cm">/* Used by transport_get_inquiry_vpd_device_ident() */</span>
<span class="cp">#define INQUIRY_VPD_DEVICE_IDENTIFIER_LEN	254</span>

<span class="cm">/* Attempts before moving from SHORT to LONG */</span>
<span class="cp">#define PYX_TRANSPORT_WINDOW_CLOSED_THRESHOLD	3</span>
<span class="cp">#define PYX_TRANSPORT_WINDOW_CLOSED_WAIT_SHORT	3  </span><span class="cm">/* In milliseconds */</span><span class="cp"></span>
<span class="cp">#define PYX_TRANSPORT_WINDOW_CLOSED_WAIT_LONG	10 </span><span class="cm">/* In milliseconds */</span><span class="cp"></span>

<span class="cp">#define PYX_TRANSPORT_STATUS_INTERVAL		5 </span><span class="cm">/* In seconds */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * struct se_subsystem_dev-&gt;su_dev_flags</span>
<span class="cm">*/</span>
<span class="cp">#define SDF_FIRMWARE_VPD_UNIT_SERIAL		0x00000001</span>
<span class="cp">#define SDF_EMULATED_VPD_UNIT_SERIAL		0x00000002</span>
<span class="cp">#define SDF_USING_UDEV_PATH			0x00000004</span>
<span class="cp">#define SDF_USING_ALIAS				0x00000008</span>

<span class="cm">/*</span>
<span class="cm"> * struct se_device-&gt;dev_flags</span>
<span class="cm"> */</span>
<span class="cp">#define DF_SPC2_RESERVATIONS			0x00000001</span>
<span class="cp">#define DF_SPC2_RESERVATIONS_WITH_ISID		0x00000002</span>

<span class="cm">/* struct se_dev_attrib sanity values */</span>
<span class="cm">/* Default max_unmap_lba_count */</span>
<span class="cp">#define DA_MAX_UNMAP_LBA_COUNT			0</span>
<span class="cm">/* Default max_unmap_block_desc_count */</span>
<span class="cp">#define DA_MAX_UNMAP_BLOCK_DESC_COUNT		0</span>
<span class="cm">/* Default unmap_granularity */</span>
<span class="cp">#define DA_UNMAP_GRANULARITY_DEFAULT		0</span>
<span class="cm">/* Default unmap_granularity_alignment */</span>
<span class="cp">#define DA_UNMAP_GRANULARITY_ALIGNMENT_DEFAULT	0</span>
<span class="cm">/* Default max transfer length */</span>
<span class="cp">#define DA_FABRIC_MAX_SECTORS			8192</span>
<span class="cm">/* Emulation for Direct Page Out */</span>
<span class="cp">#define DA_EMULATE_DPO				0</span>
<span class="cm">/* Emulation for Forced Unit Access WRITEs */</span>
<span class="cp">#define DA_EMULATE_FUA_WRITE			1</span>
<span class="cm">/* Emulation for Forced Unit Access READs */</span>
<span class="cp">#define DA_EMULATE_FUA_READ			0</span>
<span class="cm">/* Emulation for WriteCache and SYNCHRONIZE_CACHE */</span>
<span class="cp">#define DA_EMULATE_WRITE_CACHE			0</span>
<span class="cm">/* Emulation for UNIT ATTENTION Interlock Control */</span>
<span class="cp">#define DA_EMULATE_UA_INTLLCK_CTRL		0</span>
<span class="cm">/* Emulation for TASK_ABORTED status (TAS) by default */</span>
<span class="cp">#define DA_EMULATE_TAS				1</span>
<span class="cm">/* Emulation for Thin Provisioning UNMAP using block/blk-lib.c:blkdev_issue_discard() */</span>
<span class="cp">#define DA_EMULATE_TPU				0</span>
<span class="cm">/*</span>
<span class="cm"> * Emulation for Thin Provisioning WRITE_SAME w/ UNMAP=1 bit using</span>
<span class="cm"> * block/blk-lib.c:blkdev_issue_discard()</span>
<span class="cm"> */</span>
<span class="cp">#define DA_EMULATE_TPWS				0</span>
<span class="cm">/* No Emulation for PSCSI by default */</span>
<span class="cp">#define DA_EMULATE_RESERVATIONS			0</span>
<span class="cm">/* No Emulation for PSCSI by default */</span>
<span class="cp">#define DA_EMULATE_ALUA				0</span>
<span class="cm">/* Enforce SCSI Initiator Port TransportID with &#39;ISID&#39; for PR */</span>
<span class="cp">#define DA_ENFORCE_PR_ISIDS			1</span>
<span class="cp">#define DA_STATUS_MAX_SECTORS_MIN		16</span>
<span class="cp">#define DA_STATUS_MAX_SECTORS_MAX		8192</span>
<span class="cm">/* By default don&#39;t report non-rotating (solid state) medium */</span>
<span class="cp">#define DA_IS_NONROT				0</span>
<span class="cm">/* Queue Algorithm Modifier default for restricted reordering in control mode page */</span>
<span class="cp">#define DA_EMULATE_REST_REORD			0</span>

<span class="cp">#define SE_INQUIRY_BUF				512</span>
<span class="cp">#define SE_MODE_PAGE_BUF			512</span>

<span class="cm">/* struct se_hba-&gt;hba_flags */</span>
<span class="k">enum</span> <span class="n">hba_flags_table</span> <span class="p">{</span>
	<span class="n">HBA_FLAGS_INTERNAL_USE</span>	<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">HBA_FLAGS_PSCSI_MODE</span>	<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* struct se_lun-&gt;lun_status */</span>
<span class="k">enum</span> <span class="n">transport_lun_status_table</span> <span class="p">{</span>
	<span class="n">TRANSPORT_LUN_STATUS_FREE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">TRANSPORT_LUN_STATUS_ACTIVE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* struct se_portal_group-&gt;se_tpg_type */</span>
<span class="k">enum</span> <span class="n">transport_tpg_type_table</span> <span class="p">{</span>
	<span class="n">TRANSPORT_TPG_TYPE_NORMAL</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">TRANSPORT_TPG_TYPE_DISCOVERY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Special transport agnostic struct se_cmd-&gt;t_states */</span>
<span class="k">enum</span> <span class="n">transport_state_table</span> <span class="p">{</span>
	<span class="n">TRANSPORT_NO_STATE</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">TRANSPORT_NEW_CMD</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">TRANSPORT_WRITE_PENDING</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">TRANSPORT_PROCESS_WRITE</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">TRANSPORT_PROCESSING</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">TRANSPORT_COMPLETE</span>	<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">TRANSPORT_PROCESS_TMR</span>	<span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
	<span class="n">TRANSPORT_ISTATE_PROCESSING</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
	<span class="n">TRANSPORT_NEW_CMD_MAP</span>	<span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="n">TRANSPORT_COMPLETE_QF_WP</span> <span class="o">=</span> <span class="mi">18</span><span class="p">,</span>
	<span class="n">TRANSPORT_COMPLETE_QF_OK</span> <span class="o">=</span> <span class="mi">19</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Used for struct se_cmd-&gt;se_cmd_flags */</span>
<span class="k">enum</span> <span class="n">se_cmd_flags_table</span> <span class="p">{</span>
	<span class="n">SCF_SUPPORTED_SAM_OPCODE</span>	<span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
	<span class="n">SCF_TRANSPORT_TASK_SENSE</span>	<span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
	<span class="n">SCF_EMULATED_TASK_SENSE</span>		<span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span>
	<span class="n">SCF_SCSI_DATA_SG_IO_CDB</span>		<span class="o">=</span> <span class="mh">0x00000008</span><span class="p">,</span>
	<span class="n">SCF_SCSI_CONTROL_SG_IO_CDB</span>	<span class="o">=</span> <span class="mh">0x00000010</span><span class="p">,</span>
	<span class="n">SCF_SCSI_NON_DATA_CDB</span>		<span class="o">=</span> <span class="mh">0x00000020</span><span class="p">,</span>
	<span class="n">SCF_SCSI_TMR_CDB</span>		<span class="o">=</span> <span class="mh">0x00000040</span><span class="p">,</span>
	<span class="n">SCF_SCSI_CDB_EXCEPTION</span>		<span class="o">=</span> <span class="mh">0x00000080</span><span class="p">,</span>
	<span class="n">SCF_SCSI_RESERVATION_CONFLICT</span>	<span class="o">=</span> <span class="mh">0x00000100</span><span class="p">,</span>
	<span class="n">SCF_FUA</span>				<span class="o">=</span> <span class="mh">0x00000200</span><span class="p">,</span>
	<span class="n">SCF_SE_LUN_CMD</span>			<span class="o">=</span> <span class="mh">0x00000800</span><span class="p">,</span>
	<span class="n">SCF_SE_ALLOW_EOO</span>		<span class="o">=</span> <span class="mh">0x00001000</span><span class="p">,</span>
	<span class="n">SCF_BIDI</span>			<span class="o">=</span> <span class="mh">0x00002000</span><span class="p">,</span>
	<span class="n">SCF_SENT_CHECK_CONDITION</span>	<span class="o">=</span> <span class="mh">0x00004000</span><span class="p">,</span>
	<span class="n">SCF_OVERFLOW_BIT</span>		<span class="o">=</span> <span class="mh">0x00008000</span><span class="p">,</span>
	<span class="n">SCF_UNDERFLOW_BIT</span>		<span class="o">=</span> <span class="mh">0x00010000</span><span class="p">,</span>
	<span class="n">SCF_SENT_DELAYED_TAS</span>		<span class="o">=</span> <span class="mh">0x00020000</span><span class="p">,</span>
	<span class="n">SCF_ALUA_NON_OPTIMIZED</span>		<span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>
	<span class="n">SCF_DELAYED_CMD_FROM_SAM_ATTR</span>	<span class="o">=</span> <span class="mh">0x00080000</span><span class="p">,</span>
	<span class="n">SCF_UNUSED</span>			<span class="o">=</span> <span class="mh">0x00100000</span><span class="p">,</span>
	<span class="n">SCF_PASSTHROUGH_SG_TO_MEM_NOALLOC</span> <span class="o">=</span> <span class="mh">0x00200000</span><span class="p">,</span>
	<span class="n">SCF_ACK_KREF</span>			<span class="o">=</span> <span class="mh">0x00400000</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* struct se_dev_entry-&gt;lun_flags and struct se_lun-&gt;lun_access */</span>
<span class="k">enum</span> <span class="n">transport_lunflags_table</span> <span class="p">{</span>
	<span class="n">TRANSPORT_LUNFLAGS_NO_ACCESS</span>		<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="n">TRANSPORT_LUNFLAGS_INITIATOR_ACCESS</span>	<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">TRANSPORT_LUNFLAGS_READ_ONLY</span>		<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">TRANSPORT_LUNFLAGS_READ_WRITE</span>		<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* struct se_device-&gt;dev_status */</span>
<span class="k">enum</span> <span class="n">transport_device_status_table</span> <span class="p">{</span>
	<span class="n">TRANSPORT_DEVICE_ACTIVATED</span>		<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">TRANSPORT_DEVICE_DEACTIVATED</span>		<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">TRANSPORT_DEVICE_QUEUE_FULL</span>		<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">TRANSPORT_DEVICE_SHUTDOWN</span>		<span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">TRANSPORT_DEVICE_OFFLINE_ACTIVATED</span>	<span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">TRANSPORT_DEVICE_OFFLINE_DEACTIVATED</span>	<span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Used by transport_send_check_condition_and_sense() and se_cmd-&gt;scsi_sense_reason</span>
<span class="cm"> * to signal which ASC/ASCQ sense payload should be built.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">tcm_sense_reason_table</span> <span class="p">{</span>
	<span class="n">TCM_NON_EXISTENT_LUN</span>			<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">TCM_UNSUPPORTED_SCSI_OPCODE</span>		<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">TCM_INCORRECT_AMOUNT_OF_DATA</span>		<span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="n">TCM_UNEXPECTED_UNSOLICITED_DATA</span>		<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">TCM_SERVICE_CRC_ERROR</span>			<span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="n">TCM_SNACK_REJECTED</span>			<span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
	<span class="n">TCM_SECTOR_COUNT_TOO_MANY</span>		<span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span>
	<span class="n">TCM_INVALID_CDB_FIELD</span>			<span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">TCM_INVALID_PARAMETER_LIST</span>		<span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>
	<span class="n">TCM_LOGICAL_UNIT_COMMUNICATION_FAILURE</span>	<span class="o">=</span> <span class="mh">0x0a</span><span class="p">,</span>
	<span class="n">TCM_UNKNOWN_MODE_PAGE</span>			<span class="o">=</span> <span class="mh">0x0b</span><span class="p">,</span>
	<span class="n">TCM_WRITE_PROTECTED</span>			<span class="o">=</span> <span class="mh">0x0c</span><span class="p">,</span>
	<span class="n">TCM_CHECK_CONDITION_ABORT_CMD</span>		<span class="o">=</span> <span class="mh">0x0d</span><span class="p">,</span>
	<span class="n">TCM_CHECK_CONDITION_UNIT_ATTENTION</span>	<span class="o">=</span> <span class="mh">0x0e</span><span class="p">,</span>
	<span class="n">TCM_CHECK_CONDITION_NOT_READY</span>		<span class="o">=</span> <span class="mh">0x0f</span><span class="p">,</span>
	<span class="n">TCM_RESERVATION_CONFLICT</span>		<span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">target_sc_flags_table</span> <span class="p">{</span>
	<span class="n">TARGET_SCF_BIDI_OP</span>		<span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">TARGET_SCF_ACK_KREF</span>		<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">TARGET_SCF_UNKNOWN_SIZE</span>		<span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* fabric independent task management function values */</span>
<span class="k">enum</span> <span class="n">tcm_tmreq_table</span> <span class="p">{</span>
	<span class="n">TMR_ABORT_TASK</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">TMR_ABORT_TASK_SET</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">TMR_CLEAR_ACA</span>		<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">TMR_CLEAR_TASK_SET</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">TMR_LUN_RESET</span>		<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">TMR_TARGET_WARM_RESET</span>	<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">TMR_TARGET_COLD_RESET</span>	<span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">TMR_FABRIC_TMR</span>		<span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* fabric independent task management response values */</span>
<span class="k">enum</span> <span class="n">tcm_tmrsp_table</span> <span class="p">{</span>
	<span class="n">TMR_FUNCTION_COMPLETE</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">TMR_TASK_DOES_NOT_EXIST</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">TMR_LUN_DOES_NOT_EXIST</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">TMR_TASK_STILL_ALLEGIANT</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">TMR_TASK_FAILOVER_NOT_SUPPORTED</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">TMR_TASK_MGMT_FUNCTION_NOT_SUPPORTED</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">TMR_FUNCTION_AUTHORIZATION_FAILED</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">TMR_FUNCTION_REJECTED</span>		<span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_obj</span> <span class="p">{</span>
	<span class="n">atomic_t</span> <span class="n">obj_access_count</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Used by TCM Core internally to signal if ALUA emulation is enabled or</span>
<span class="cm"> * disabled, or running in with TCM/pSCSI passthrough mode</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">SPC_ALUA_PASSTHROUGH</span><span class="p">,</span>
	<span class="n">SPC2_ALUA_DISABLED</span><span class="p">,</span>
	<span class="n">SPC3_ALUA_EMULATED</span>
<span class="p">}</span> <span class="n">t10_alua_index_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Used by TCM Core internally to signal if SAM Task Attribute emulation</span>
<span class="cm"> * is enabled or disabled, or running in with TCM/pSCSI passthrough mode</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">SAM_TASK_ATTR_PASSTHROUGH</span><span class="p">,</span>
	<span class="n">SAM_TASK_ATTR_UNTAGGED</span><span class="p">,</span>
	<span class="n">SAM_TASK_ATTR_EMULATED</span>
<span class="p">}</span> <span class="n">t10_task_attr_index_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Used for target SCSI statistics</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">SCSI_INST_INDEX</span><span class="p">,</span>
	<span class="n">SCSI_DEVICE_INDEX</span><span class="p">,</span>
	<span class="n">SCSI_AUTH_INTR_INDEX</span><span class="p">,</span>
	<span class="n">SCSI_INDEX_TYPE_MAX</span>
<span class="p">}</span> <span class="n">scsi_index_t</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">se_cmd</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">t10_alua</span> <span class="p">{</span>
	<span class="n">t10_alua_index_t</span> <span class="n">alua_type</span><span class="p">;</span>
	<span class="cm">/* ALUA Target Port Group ID */</span>
	<span class="n">u16</span>	<span class="n">alua_tg_pt_gps_counter</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">alua_tg_pt_gps_count</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">tg_pt_gps_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_subsystem_dev</span> <span class="o">*</span><span class="n">t10_sub_dev</span><span class="p">;</span>
	<span class="cm">/* Used for default ALUA Target Port Group */</span>
	<span class="k">struct</span> <span class="n">t10_alua_tg_pt_gp</span> <span class="o">*</span><span class="n">default_tg_pt_gp</span><span class="p">;</span>
	<span class="cm">/* Used for default ALUA Target Port Group ConfigFS group */</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">alua_tg_pt_gps_group</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">alua_state_check</span><span class="p">)(</span><span class="k">struct</span> <span class="n">se_cmd</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">tg_pt_gps_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">t10_alua_lu_gp</span> <span class="p">{</span>
	<span class="n">u16</span>	<span class="n">lu_gp_id</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">lu_gp_valid_id</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">lu_gp_members</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">lu_gp_ref_cnt</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">lu_gp_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">lu_gp_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">lu_gp_node</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">lu_gp_mem_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">t10_alua_lu_gp_member</span> <span class="p">{</span>
	<span class="n">bool</span> <span class="n">lu_gp_assoc</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">lu_gp_mem_ref_cnt</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">lu_gp_mem_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">t10_alua_lu_gp</span> <span class="o">*</span><span class="n">lu_gp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_device</span> <span class="o">*</span><span class="n">lu_gp_mem_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">lu_gp_mem_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">t10_alua_tg_pt_gp</span> <span class="p">{</span>
	<span class="n">u16</span>	<span class="n">tg_pt_gp_id</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">tg_pt_gp_valid_id</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">tg_pt_gp_alua_access_status</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">tg_pt_gp_alua_access_type</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">tg_pt_gp_nonop_delay_msecs</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">tg_pt_gp_trans_delay_msecs</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">tg_pt_gp_implict_trans_secs</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">tg_pt_gp_pref</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">tg_pt_gp_write_metadata</span><span class="p">;</span>
	<span class="cm">/* Used by struct t10_alua_tg_pt_gp-&gt;tg_pt_gp_md_buf_len */</span>
<span class="cp">#define ALUA_MD_BUF_LEN				1024</span>
	<span class="n">u32</span>	<span class="n">tg_pt_gp_md_buf_len</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">tg_pt_gp_members</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">tg_pt_gp_alua_access_state</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">tg_pt_gp_ref_cnt</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">tg_pt_gp_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">tg_pt_gp_md_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_subsystem_dev</span> <span class="o">*</span><span class="n">tg_pt_gp_su_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">tg_pt_gp_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">tg_pt_gp_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">tg_pt_gp_mem_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">t10_alua_tg_pt_gp_member</span> <span class="p">{</span>
	<span class="n">bool</span> <span class="n">tg_pt_gp_assoc</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">tg_pt_gp_mem_ref_cnt</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">tg_pt_gp_mem_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">t10_alua_tg_pt_gp</span> <span class="o">*</span><span class="n">tg_pt_gp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_port</span> <span class="o">*</span><span class="n">tg_pt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">tg_pt_gp_mem_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">t10_vpd</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">device_identifier</span><span class="p">[</span><span class="n">INQUIRY_VPD_DEVICE_IDENTIFIER_LEN</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">protocol_identifier_set</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">protocol_identifier</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">device_identifier_code_set</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">association</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">device_identifier_type</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">vpd_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">t10_wwn</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">vendor</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">model</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">revision</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">unit_serial</span><span class="p">[</span><span class="n">INQUIRY_VPD_SERIAL_LEN</span><span class="p">];</span>
	<span class="n">spinlock_t</span> <span class="n">t10_vpd_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_subsystem_dev</span> <span class="o">*</span><span class="n">t10_sub_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">t10_wwn_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">t10_vpd_list</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * Used by TCM Core internally to signal if &gt;= SPC-3 persistent reservations</span>
<span class="cm"> * emulation is enabled or disabled, or running in with TCM/pSCSI passthrough</span>
<span class="cm"> * mode</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">SPC_PASSTHROUGH</span><span class="p">,</span>
	<span class="n">SPC2_RESERVATIONS</span><span class="p">,</span>
	<span class="n">SPC3_PERSISTENT_RESERVATIONS</span>
<span class="p">}</span> <span class="n">t10_reservations_index_t</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">t10_pr_registration</span> <span class="p">{</span>
	<span class="cm">/* Used for fabrics that contain WWN+ISID */</span>
<span class="cp">#define PR_REG_ISID_LEN				16</span>
	<span class="cm">/* PR_REG_ISID_LEN + &#39;,i,0x&#39; */</span>
<span class="cp">#define PR_REG_ISID_ID_LEN			(PR_REG_ISID_LEN + 5)</span>
	<span class="kt">char</span> <span class="n">pr_reg_isid</span><span class="p">[</span><span class="n">PR_REG_ISID_LEN</span><span class="p">];</span>
	<span class="cm">/* Used during APTPL metadata reading */</span>
<span class="cp">#define PR_APTPL_MAX_IPORT_LEN			256</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pr_iport</span><span class="p">[</span><span class="n">PR_APTPL_MAX_IPORT_LEN</span><span class="p">];</span>
	<span class="cm">/* Used during APTPL metadata reading */</span>
<span class="cp">#define PR_APTPL_MAX_TPORT_LEN			256</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pr_tport</span><span class="p">[</span><span class="n">PR_APTPL_MAX_TPORT_LEN</span><span class="p">];</span>
	<span class="cm">/* For writing out live meta data */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pr_aptpl_buf</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pr_aptpl_rpti</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pr_reg_tpgt</span><span class="p">;</span>
	<span class="cm">/* Reservation effects all target ports */</span>
	<span class="kt">int</span> <span class="n">pr_reg_all_tg_pt</span><span class="p">;</span>
	<span class="cm">/* Activate Persistence across Target Power Loss */</span>
	<span class="kt">int</span> <span class="n">pr_reg_aptpl</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pr_res_holder</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pr_res_type</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pr_res_scope</span><span class="p">;</span>
	<span class="cm">/* Used for fabric initiator WWPNs using a ISID */</span>
	<span class="n">bool</span> <span class="n">isid_present_at_reg</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pr_res_mapped_lun</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pr_aptpl_target_lun</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pr_res_generation</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">pr_reg_bin_isid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">pr_res_key</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">pr_res_holders</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_node_acl</span> <span class="o">*</span><span class="n">pr_reg_nacl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_dev_entry</span> <span class="o">*</span><span class="n">pr_reg_deve</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_lun</span> <span class="o">*</span><span class="n">pr_reg_tg_pt_lun</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">pr_reg_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">pr_reg_abort_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">pr_reg_aptpl_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">pr_reg_atp_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">pr_reg_atp_mem_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * This set of function pointer ops is set based upon SPC3_PERSISTENT_RESERVATIONS,</span>
<span class="cm"> * SPC2_RESERVATIONS or SPC_PASSTHROUGH in drivers/target/target_core_pr.c:</span>
<span class="cm"> * core_setup_reservations()</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">t10_reservation_ops</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">t10_reservation_check</span><span class="p">)(</span><span class="k">struct</span> <span class="n">se_cmd</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">t10_seq_non_holder</span><span class="p">)(</span><span class="k">struct</span> <span class="n">se_cmd</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">t10_pr_register</span><span class="p">)(</span><span class="k">struct</span> <span class="n">se_cmd</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">t10_pr_clear</span><span class="p">)(</span><span class="k">struct</span> <span class="n">se_cmd</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">t10_reservation</span> <span class="p">{</span>
	<span class="cm">/* Reservation effects all target ports */</span>
	<span class="kt">int</span> <span class="n">pr_all_tg_pt</span><span class="p">;</span>
	<span class="cm">/* Activate Persistence across Target Power Loss enabled</span>
<span class="cm">	 * for SCSI device */</span>
	<span class="kt">int</span> <span class="n">pr_aptpl_active</span><span class="p">;</span>
	<span class="cm">/* Used by struct t10_reservation-&gt;pr_aptpl_buf_len */</span>
<span class="cp">#define PR_APTPL_BUF_LEN			8192</span>
	<span class="n">u32</span> <span class="n">pr_aptpl_buf_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pr_generation</span><span class="p">;</span>
	<span class="n">t10_reservations_index_t</span> <span class="n">res_type</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">registration_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">aptpl_reg_lock</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * This will always be set by one individual I_T Nexus.</span>
<span class="cm">	 * However with all_tg_pt=1, other I_T Nexus from the</span>
<span class="cm">	 * same initiator can access PR reg/res info on a different</span>
<span class="cm">	 * target port.</span>
<span class="cm">	 *</span>
<span class="cm">	 * There is also the &#39;All Registrants&#39; case, where there is</span>
<span class="cm">	 * a single *pr_res_holder of the reservation, but all</span>
<span class="cm">	 * registrations are considered reservation holders.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">se_node_acl</span> <span class="o">*</span><span class="n">pr_res_holder</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">registration_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">aptpl_reg_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">t10_reservation_ops</span> <span class="n">pr_ops</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_queue_obj</span> <span class="p">{</span>
	<span class="n">atomic_t</span>		<span class="n">queue_cnt</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">cmd_queue_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">qobj_list</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span>	<span class="n">thread_wq</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_tmr_req</span> <span class="p">{</span>
	<span class="cm">/* Task Management function to be performed */</span>
	<span class="n">u8</span>			<span class="n">function</span><span class="p">;</span>
	<span class="cm">/* Task Management response to send */</span>
	<span class="n">u8</span>			<span class="n">response</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">call_transport</span><span class="p">;</span>
	<span class="cm">/* Reference to ITT that Task Mgmt should be performed */</span>
	<span class="n">u32</span>			<span class="n">ref_task_tag</span><span class="p">;</span>
	<span class="cm">/* 64-bit encoded SAM LUN from $FABRIC_MOD TMR header */</span>
	<span class="n">u64</span>			<span class="n">ref_task_lun</span><span class="p">;</span>
	<span class="kt">void</span> 			<span class="o">*</span><span class="n">fabric_tmr_ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_cmd</span>		<span class="o">*</span><span class="n">task_cmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_cmd</span>		<span class="o">*</span><span class="n">ref_cmd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_device</span>	<span class="o">*</span><span class="n">tmr_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_lun</span>		<span class="o">*</span><span class="n">tmr_lun</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">tmr_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_cmd</span> <span class="p">{</span>
	<span class="cm">/* SAM response code being sent to initiator */</span>
	<span class="n">u8</span>			<span class="n">scsi_status</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">scsi_asc</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">scsi_ascq</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">scsi_sense_reason</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">scsi_sense_length</span><span class="p">;</span>
	<span class="cm">/* Delay for ALUA Active/NonOptimized state access in milliseconds */</span>
	<span class="kt">int</span>			<span class="n">alua_nonop_delay</span><span class="p">;</span>
	<span class="cm">/* See include/linux/dma-mapping.h */</span>
	<span class="k">enum</span> <span class="n">dma_data_direction</span>	<span class="n">data_direction</span><span class="p">;</span>
	<span class="cm">/* For SAM Task Attribute */</span>
	<span class="kt">int</span>			<span class="n">sam_task_attr</span><span class="p">;</span>
	<span class="cm">/* Transport protocol dependent state, see transport_state_table */</span>
	<span class="k">enum</span> <span class="n">transport_state_table</span> <span class="n">t_state</span><span class="p">;</span>
	<span class="cm">/* Used to signal cmd-&gt;se_tfo-&gt;check_release_cmd() usage per cmd */</span>
	<span class="kt">unsigned</span>		<span class="n">check_release</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>		<span class="n">cmd_wait_set</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>		<span class="n">unknown_data_length</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="cm">/* See se_cmd_flags_table */</span>
	<span class="n">u32</span>			<span class="n">se_cmd_flags</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">se_ordered_id</span><span class="p">;</span>
	<span class="cm">/* Total size in bytes associated with command */</span>
	<span class="n">u32</span>			<span class="n">data_length</span><span class="p">;</span>
	<span class="cm">/* SCSI Presented Data Transfer Length */</span>
	<span class="n">u32</span>			<span class="n">cmd_spdtl</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">residual_count</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">orig_fe_lun</span><span class="p">;</span>
	<span class="cm">/* Persistent Reservation key */</span>
	<span class="n">u64</span>			<span class="n">pr_res_key</span><span class="p">;</span>
	<span class="cm">/* Used for sense data */</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">sense_buffer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">se_delayed_node</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">se_lun_node</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">se_qf_node</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_device</span>      <span class="o">*</span><span class="n">se_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_dev_entry</span>   <span class="o">*</span><span class="n">se_deve</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_lun</span>		<span class="o">*</span><span class="n">se_lun</span><span class="p">;</span>
	<span class="cm">/* Only used for internal passthrough and legacy TCM fabric modules */</span>
	<span class="k">struct</span> <span class="n">se_session</span>	<span class="o">*</span><span class="n">se_sess</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_tmr_req</span>	<span class="o">*</span><span class="n">se_tmr_req</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">se_queue_node</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">se_cmd_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span>	<span class="n">cmd_wait_comp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kref</span>		<span class="n">cmd_kref</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">target_core_fabric_ops</span> <span class="o">*</span><span class="n">se_tfo</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">execute_cmd</span><span class="p">)(</span><span class="k">struct</span> <span class="n">se_cmd</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">transport_complete_callback</span><span class="p">)(</span><span class="k">struct</span> <span class="n">se_cmd</span> <span class="o">*</span><span class="p">);</span>

	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="o">*</span><span class="n">t_task_cdb</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">__t_task_cdb</span><span class="p">[</span><span class="n">TCM_MAX_COMMAND_SIZE</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span>	<span class="n">t_task_lba</span><span class="p">;</span>
	<span class="n">atomic_t</span>		<span class="n">t_fe_count</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">transport_state</span><span class="p">;</span>
<span class="cp">#define CMD_T_ABORTED		(1 &lt;&lt; 0)</span>
<span class="cp">#define CMD_T_ACTIVE		(1 &lt;&lt; 1)</span>
<span class="cp">#define CMD_T_COMPLETE		(1 &lt;&lt; 2)</span>
<span class="cp">#define CMD_T_QUEUED		(1 &lt;&lt; 3)</span>
<span class="cp">#define CMD_T_SENT		(1 &lt;&lt; 4)</span>
<span class="cp">#define CMD_T_STOP		(1 &lt;&lt; 5)</span>
<span class="cp">#define CMD_T_FAILED		(1 &lt;&lt; 6)</span>
<span class="cp">#define CMD_T_LUN_STOP		(1 &lt;&lt; 7)</span>
<span class="cp">#define CMD_T_LUN_FE_STOP	(1 &lt;&lt; 8)</span>
<span class="cp">#define CMD_T_DEV_ACTIVE	(1 &lt;&lt; 9)</span>
<span class="cp">#define CMD_T_REQUEST_STOP	(1 &lt;&lt; 10)</span>
<span class="cp">#define CMD_T_BUSY		(1 &lt;&lt; 11)</span>
	<span class="n">spinlock_t</span>		<span class="n">t_state_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span>	<span class="n">t_transport_stop_comp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span>	<span class="n">transport_lun_fe_stop_comp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span>	<span class="n">transport_lun_stop_comp</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span>	<span class="n">work</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">scatterlist</span>	<span class="o">*</span><span class="n">t_data_sg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_data_nents</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">t_data_vmap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scatterlist</span>	<span class="o">*</span><span class="n">t_bidi_data_sg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_bidi_data_nents</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">execute_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">state_list</span><span class="p">;</span>
	<span class="n">bool</span>			<span class="n">state_active</span><span class="p">;</span>

	<span class="cm">/* old task stop completion, consider merging with some of the above */</span>
	<span class="k">struct</span> <span class="n">completion</span>	<span class="n">task_stop_comp</span><span class="p">;</span>

	<span class="cm">/* backend private data */</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">priv</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_ua</span> <span class="p">{</span>
	<span class="n">u8</span>			<span class="n">ua_asc</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">ua_ascq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_node_acl</span>	<span class="o">*</span><span class="n">ua_nacl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">ua_dev_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">ua_nacl_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_node_acl</span> <span class="p">{</span>
	<span class="kt">char</span>			<span class="n">initiatorname</span><span class="p">[</span><span class="n">TRANSPORT_IQN_LEN</span><span class="p">];</span>
	<span class="cm">/* Used to signal demo mode created ACL, disabled by default */</span>
	<span class="n">bool</span>			<span class="n">dynamic_node_acl</span><span class="p">;</span>
	<span class="n">bool</span>			<span class="n">acl_stop</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">queue_depth</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">acl_index</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">num_cmds</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">read_bytes</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">write_bytes</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">stats_lock</span><span class="p">;</span>
	<span class="cm">/* Used for PR SPEC_I_PT=1 and REGISTER_AND_MOVE */</span>
	<span class="n">atomic_t</span>		<span class="n">acl_pr_ref_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_dev_entry</span>	<span class="o">**</span><span class="n">device_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_session</span>	<span class="o">*</span><span class="n">nacl_sess</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_portal_group</span> <span class="o">*</span><span class="n">se_tpg</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">device_list_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">nacl_sess_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">acl_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">acl_attrib_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">acl_auth_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">acl_param_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">acl_fabric_stat_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="o">*</span><span class="n">acl_default_groups</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">acl_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">acl_sess_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span>	<span class="n">acl_free_comp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kref</span>		<span class="n">acl_kref</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_session</span> <span class="p">{</span>
	<span class="kt">unsigned</span>		<span class="n">sess_tearing_down</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">sess_bin_isid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_node_acl</span>	<span class="o">*</span><span class="n">se_node_acl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_portal_group</span> <span class="o">*</span><span class="n">se_tpg</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">fabric_sess_ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">sess_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">sess_acl_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">sess_cmd_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">sess_wait_list</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">sess_cmd_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kref</span>		<span class="n">sess_kref</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_device</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">se_transform_info</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">scatterlist</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">se_ml_stat_grps</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">stat_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">scsi_auth_intr_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">scsi_att_intr_port_group</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_lun_acl</span> <span class="p">{</span>
	<span class="kt">char</span>			<span class="n">initiatorname</span><span class="p">[</span><span class="n">TRANSPORT_IQN_LEN</span><span class="p">];</span>
	<span class="n">u32</span>			<span class="n">mapped_lun</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_node_acl</span>	<span class="o">*</span><span class="n">se_lun_nacl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_lun</span>		<span class="o">*</span><span class="n">se_lun</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">lacl_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">se_lun_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_ml_stat_grps</span>	<span class="n">ml_stat_grps</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_dev_entry</span> <span class="p">{</span>
	<span class="n">bool</span>			<span class="n">def_pr_registered</span><span class="p">;</span>
	<span class="cm">/* See transport_lunflags_table */</span>
	<span class="n">u32</span>			<span class="n">lun_flags</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">deve_cmds</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">mapped_lun</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">average_bytes</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">last_byte_count</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">total_cmds</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">total_bytes</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">pr_res_key</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">creation_time</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">attach_count</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">read_bytes</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">write_bytes</span><span class="p">;</span>
	<span class="n">atomic_t</span>		<span class="n">ua_count</span><span class="p">;</span>
	<span class="cm">/* Used for PR SPEC_I_PT=1 and REGISTER_AND_MOVE */</span>
	<span class="n">atomic_t</span>		<span class="n">pr_ref_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_lun_acl</span>	<span class="o">*</span><span class="n">se_lun_acl</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">ua_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_lun</span>		<span class="o">*</span><span class="n">se_lun</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">alua_port_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">ua_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_dev_limits</span> <span class="p">{</span>
	<span class="cm">/* Max supported HW queue depth */</span>
	<span class="n">u32</span>		<span class="n">hw_queue_depth</span><span class="p">;</span>
	<span class="cm">/* Max supported virtual queue depth */</span>
	<span class="n">u32</span>		<span class="n">queue_depth</span><span class="p">;</span>
	<span class="cm">/* From include/linux/blkdev.h for the other HW/SW limits. */</span>
	<span class="k">struct</span> <span class="n">queue_limits</span> <span class="n">limits</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_dev_attrib</span> <span class="p">{</span>
	<span class="kt">int</span>		<span class="n">emulate_dpo</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">emulate_fua_write</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">emulate_fua_read</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">emulate_write_cache</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">emulate_ua_intlck_ctrl</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">emulate_tas</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">emulate_tpu</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">emulate_tpws</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">emulate_reservations</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">emulate_alua</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">enforce_pr_isids</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">is_nonrot</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">emulate_rest_reord</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">hw_block_size</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">block_size</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">hw_max_sectors</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">fabric_max_sectors</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">optimal_sectors</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">hw_queue_depth</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">queue_depth</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">max_unmap_lba_count</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">max_unmap_block_desc_count</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">unmap_granularity</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">unmap_granularity_alignment</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_subsystem_dev</span> <span class="o">*</span><span class="n">da_sub_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">da_group</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_dev_stat_grps</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">stat_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">scsi_dev_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">scsi_tgt_dev_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">scsi_lu_group</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_subsystem_dev</span> <span class="p">{</span>
<span class="cm">/* Used for struct se_subsystem_dev--&gt;se_dev_alias, must be less than PAGE_SIZE */</span>
<span class="cp">#define SE_DEV_ALIAS_LEN		512</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">se_dev_alias</span><span class="p">[</span><span class="n">SE_DEV_ALIAS_LEN</span><span class="p">];</span>
<span class="cm">/* Used for struct se_subsystem_dev-&gt;se_dev_udev_path[], must be less than PAGE_SIZE */</span>
<span class="cp">#define SE_UDEV_PATH_LEN		512</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">se_dev_udev_path</span><span class="p">[</span><span class="n">SE_UDEV_PATH_LEN</span><span class="p">];</span>
	<span class="n">u32</span>		<span class="n">su_dev_flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_hba</span> <span class="o">*</span><span class="n">se_dev_hba</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_device</span> <span class="o">*</span><span class="n">se_dev_ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_dev_attrib</span> <span class="n">se_dev_attrib</span><span class="p">;</span>
	<span class="cm">/* T10 Asymmetric Logical Unit Assignment for Target Ports */</span>
	<span class="k">struct</span> <span class="n">t10_alua</span>	<span class="n">t10_alua</span><span class="p">;</span>
	<span class="cm">/* T10 Inquiry and VPD WWN Information */</span>
	<span class="k">struct</span> <span class="n">t10_wwn</span>	<span class="n">t10_wwn</span><span class="p">;</span>
	<span class="cm">/* T10 SPC-2 + SPC-3 Reservations */</span>
	<span class="k">struct</span> <span class="n">t10_reservation</span> <span class="n">t10_pr</span><span class="p">;</span>
	<span class="n">spinlock_t</span>      <span class="n">se_dev_lock</span><span class="p">;</span>
	<span class="kt">void</span>            <span class="o">*</span><span class="n">se_dev_su_ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">se_dev_group</span><span class="p">;</span>
	<span class="cm">/* For T10 Reservations */</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">se_dev_pr_group</span><span class="p">;</span>
	<span class="cm">/* For target_core_stat.c groups */</span>
	<span class="k">struct</span> <span class="n">se_dev_stat_grps</span> <span class="n">dev_stat_grps</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_device</span> <span class="p">{</span>
	<span class="cm">/* RELATIVE TARGET PORT IDENTIFER Counter */</span>
	<span class="n">u16</span>			<span class="n">dev_rpti_counter</span><span class="p">;</span>
	<span class="cm">/* Used for SAM Task Attribute ordering */</span>
	<span class="n">u32</span>			<span class="n">dev_cur_ordered_id</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">dev_flags</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">dev_port_count</span><span class="p">;</span>
	<span class="cm">/* See transport_device_status_table */</span>
	<span class="n">u32</span>			<span class="n">dev_status</span><span class="p">;</span>
	<span class="cm">/* Physical device queue depth */</span>
	<span class="n">u32</span>			<span class="n">queue_depth</span><span class="p">;</span>
	<span class="cm">/* Used for SPC-2 reservations enforce of ISIDs */</span>
	<span class="n">u64</span>			<span class="n">dev_res_bin_isid</span><span class="p">;</span>
	<span class="n">t10_task_attr_index_t</span>	<span class="n">dev_task_attr_type</span><span class="p">;</span>
	<span class="cm">/* Pointer to transport specific device structure */</span>
	<span class="kt">void</span> 			<span class="o">*</span><span class="n">dev_ptr</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">dev_index</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">creation_time</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">num_resets</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">num_cmds</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">read_bytes</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">write_bytes</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">stats_lock</span><span class="p">;</span>
	<span class="cm">/* Active commands on this virtual SE device */</span>
	<span class="n">atomic_t</span>		<span class="n">simple_cmds</span><span class="p">;</span>
	<span class="n">atomic_t</span>		<span class="n">dev_ordered_id</span><span class="p">;</span>
	<span class="n">atomic_t</span>		<span class="n">execute_tasks</span><span class="p">;</span>
	<span class="n">atomic_t</span>		<span class="n">dev_ordered_sync</span><span class="p">;</span>
	<span class="n">atomic_t</span>		<span class="n">dev_qf_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_obj</span>		<span class="n">dev_obj</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_obj</span>		<span class="n">dev_access_obj</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_obj</span>		<span class="n">dev_export_obj</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_queue_obj</span>	<span class="n">dev_queue_obj</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">delayed_cmd_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">execute_task_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">dev_reservation_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">dev_status_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">se_port_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">se_tmr_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">qf_cmd_lock</span><span class="p">;</span>
	<span class="cm">/* Used for legacy SPC-2 reservationsa */</span>
	<span class="k">struct</span> <span class="n">se_node_acl</span>	<span class="o">*</span><span class="n">dev_reserved_node_acl</span><span class="p">;</span>
	<span class="cm">/* Used for ALUA Logical Unit Group membership */</span>
	<span class="k">struct</span> <span class="n">t10_alua_lu_gp_member</span> <span class="o">*</span><span class="n">dev_alua_lu_gp_mem</span><span class="p">;</span>
	<span class="cm">/* Used for SPC-3 Persistent Reservations */</span>
	<span class="k">struct</span> <span class="n">t10_pr_registration</span> <span class="o">*</span><span class="n">dev_pr_res_holder</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">dev_sep_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">dev_tmr_list</span><span class="p">;</span>
	<span class="cm">/* Pointer to descriptor for processing thread */</span>
	<span class="k">struct</span> <span class="n">task_struct</span>	<span class="o">*</span><span class="n">process_thread</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	<span class="n">qf_work_queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">delayed_cmd_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">execute_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">state_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">qf_cmd_list</span><span class="p">;</span>
	<span class="cm">/* Pointer to associated SE HBA */</span>
	<span class="k">struct</span> <span class="n">se_hba</span>		<span class="o">*</span><span class="n">se_hba</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_subsystem_dev</span> <span class="o">*</span><span class="n">se_sub_dev</span><span class="p">;</span>
	<span class="cm">/* Pointer to template of function pointers for transport */</span>
	<span class="k">struct</span> <span class="n">se_subsystem_api</span> <span class="o">*</span><span class="n">transport</span><span class="p">;</span>
	<span class="cm">/* Linked list for struct se_hba struct se_device list */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">dev_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_hba</span> <span class="p">{</span>
	<span class="n">u16</span>			<span class="n">hba_tpgt</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">hba_id</span><span class="p">;</span>
	<span class="cm">/* See hba_flags_table */</span>
	<span class="n">u32</span>			<span class="n">hba_flags</span><span class="p">;</span>
	<span class="cm">/* Virtual iSCSI devices attached. */</span>
	<span class="n">u32</span>			<span class="n">dev_count</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">hba_index</span><span class="p">;</span>
	<span class="cm">/* Pointer to transport specific host structure. */</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">hba_ptr</span><span class="p">;</span>
	<span class="cm">/* Linked list for struct se_device */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">hba_dev_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">hba_node</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">device_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">hba_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>		<span class="n">hba_access_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_subsystem_api</span> <span class="o">*</span><span class="n">transport</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_port_stat_grps</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">stat_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">scsi_port_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">scsi_tgt_port_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span> <span class="n">scsi_transport_group</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_lun</span> <span class="p">{</span>
	<span class="cm">/* See transport_lun_status_table */</span>
	<span class="k">enum</span> <span class="n">transport_lun_status_table</span> <span class="n">lun_status</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">lun_access</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">lun_flags</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">unpacked_lun</span><span class="p">;</span>
	<span class="n">atomic_t</span>		<span class="n">lun_acl_count</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">lun_acl_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">lun_cmd_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">lun_sep_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span>	<span class="n">lun_shutdown_comp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">lun_cmd_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">lun_acl_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_device</span>	<span class="o">*</span><span class="n">lun_se_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_port</span>		<span class="o">*</span><span class="n">lun_sep</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">lun_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_port_stat_grps</span> <span class="n">port_stat_grps</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">scsi_port_stats</span> <span class="p">{</span>
       <span class="n">u64</span>     <span class="n">cmd_pdus</span><span class="p">;</span>
       <span class="n">u64</span>     <span class="n">tx_data_octets</span><span class="p">;</span>
       <span class="n">u64</span>     <span class="n">rx_data_octets</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_port</span> <span class="p">{</span>
	<span class="cm">/* RELATIVE TARGET PORT IDENTIFER */</span>
	<span class="n">u16</span>		<span class="n">sep_rtpi</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sep_tg_pt_secondary_stat</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">sep_tg_pt_secondary_write_md</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">sep_index</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">scsi_port_stats</span> <span class="n">sep_stats</span><span class="p">;</span>
	<span class="cm">/* Used for ALUA Target Port Groups membership */</span>
	<span class="n">atomic_t</span>	<span class="n">sep_tg_pt_secondary_offline</span><span class="p">;</span>
	<span class="cm">/* Used for PR ALL_TG_PT=1 */</span>
	<span class="n">atomic_t</span>	<span class="n">sep_tg_pt_ref_cnt</span><span class="p">;</span>
	<span class="n">spinlock_t</span>	<span class="n">sep_alua_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>	<span class="n">sep_tg_pt_md_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">t10_alua_tg_pt_gp_member</span> <span class="o">*</span><span class="n">sep_alua_tg_pt_gp_mem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_lun</span> <span class="o">*</span><span class="n">sep_lun</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_portal_group</span> <span class="o">*</span><span class="n">sep_tpg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sep_alua_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sep_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_tpg_np</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">se_portal_group</span> <span class="o">*</span><span class="n">tpg_np_parent</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">tpg_np_group</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_portal_group</span> <span class="p">{</span>
	<span class="cm">/* Type of target portal group, see transport_tpg_type_table */</span>
	<span class="k">enum</span> <span class="n">transport_tpg_type_table</span> <span class="n">se_tpg_type</span><span class="p">;</span>
	<span class="cm">/* Number of ACLed Initiator Nodes for this TPG */</span>
	<span class="n">u32</span>			<span class="n">num_node_acls</span><span class="p">;</span>
	<span class="cm">/* Used for PR SPEC_I_PT=1 and REGISTER_AND_MOVE */</span>
	<span class="n">atomic_t</span>		<span class="n">tpg_pr_ref_count</span><span class="p">;</span>
	<span class="cm">/* Spinlock for adding/removing ACLed Nodes */</span>
	<span class="n">spinlock_t</span>		<span class="n">acl_node_lock</span><span class="p">;</span>
	<span class="cm">/* Spinlock for adding/removing sessions */</span>
	<span class="n">spinlock_t</span>		<span class="n">session_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		<span class="n">tpg_lun_lock</span><span class="p">;</span>
	<span class="cm">/* Pointer to $FABRIC_MOD portal group */</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">se_tpg_fabric_ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">se_tpg_node</span><span class="p">;</span>
	<span class="cm">/* linked list for initiator ACL list */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">acl_node_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_lun</span>		<span class="o">**</span><span class="n">tpg_lun_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_lun</span>		<span class="n">tpg_virt_lun0</span><span class="p">;</span>
	<span class="cm">/* List of TCM sessions associated wth this TPG */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">tpg_sess_list</span><span class="p">;</span>
	<span class="cm">/* Pointer to $FABRIC_MOD dependent code */</span>
	<span class="k">struct</span> <span class="n">target_core_fabric_ops</span> <span class="o">*</span><span class="n">se_tpg_tfo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">se_wwn</span>		<span class="o">*</span><span class="n">se_tpg_wwn</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">tpg_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="o">*</span><span class="n">tpg_default_groups</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">tpg_lun_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">tpg_np_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">tpg_acl_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">tpg_attrib_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">tpg_param_group</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">se_wwn</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">target_fabric_configfs</span> <span class="o">*</span><span class="n">wwn_tf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">wwn_group</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="o">*</span><span class="n">wwn_default_groups</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">config_group</span>	<span class="n">fabric_stat_group</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="cm">/* TARGET_CORE_BASE_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
