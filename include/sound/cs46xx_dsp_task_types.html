<!DOCTYPE html>
<html><head><title>joekychen/linux » include › sound › cs46xx_dsp_task_types.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>cs46xx_dsp_task_types.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  The driver for the Cirrus Logic&#39;s Sound Fusion CS46XX based soundcards</span>
<span class="cm"> *  Copyright (c) by Jaroslav Kysela &lt;perex@perex.cz&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * NOTE: comments are copy/paste from cwcemb80.lst </span>
<span class="cm"> * provided by Tom Woller at Cirrus (my only</span>
<span class="cm"> * documentation about the SP OS running inside</span>
<span class="cm"> * the DSP) </span>
<span class="cm"> */</span>

<span class="cp">#ifndef __CS46XX_DSP_TASK_TYPES_H__</span>
<span class="cp">#define __CS46XX_DSP_TASK_TYPES_H__</span>

<span class="cp">#include &quot;cs46xx_dsp_scb_types.h&quot;</span>

<span class="cm">/*********************************************************************************************</span>
<span class="cm">Example hierarchy of stream control blocks in the SP</span>

<span class="cm">hfgTree</span>
<span class="cm">Ptr____Call (c)</span>
<span class="cm">       \</span>
<span class="cm"> -------+------         -------------      -------------      -------------      -----</span>
<span class="cm">| SBlaster IF  |______\| Foreground  |___\| Middlegr&#39;nd |___\| Background  |___\| Nul |</span>
<span class="cm">|              |Goto  /| tree header |g  /| tree header |g  /| tree header |g  /| SCB |r</span>
<span class="cm"> -------------- (g)     -------------      -------------      -------------      -----</span>
<span class="cm">       |c                     |c                 |c                 |c</span>
<span class="cm">       |                      |                  |                  |</span>
<span class="cm">      \/                  -------------      -------------      -------------   </span>
<span class="cm">                       | Foreground  |_\  | Middlegr&#39;nd |_\  | Background  |_\</span>
<span class="cm">                       |     tree    |g/  |    tree     |g/  |     tree    |g/</span>
<span class="cm">                        -------------      -------------      -------------   </span>
<span class="cm">                              |c                 |c                 |c</span>
<span class="cm">                              |                  |                  | </span>
<span class="cm">                             \/                 \/                 \/ </span>

<span class="cm">*********************************************************************************************/</span>

<span class="cp">#define		HFG_FIRST_EXECUTE_MODE			0x0001</span>
<span class="cp">#define		HFG_FIRST_EXECUTE_MODE_BIT		0</span>
<span class="cp">#define		HFG_CONTEXT_SWITCH_MODE			0x0002</span>
<span class="cp">#define		HFG_CONTEXT_SWITCH_MODE_BIT		1</span>

<span class="cp">#define MAX_FG_STACK_SIZE 	32			</span><span class="cm">/* THESE NEED TO BE COMPUTED PROPERLY */</span><span class="cp"></span>
<span class="cp">#define MAX_MG_STACK_SIZE 	16</span>
<span class="cp">#define MAX_BG_STACK_SIZE 	9</span>
<span class="cp">#define MAX_HFG_STACK_SIZE	4</span>

<span class="cp">#define SLEEP_ACTIVE_INCREMENT		0		</span><span class="cm">/* Enable task tree thread to go to sleep</span>
<span class="cm">											   This should only ever be used on the Background thread */</span><span class="cp"></span>
<span class="cp">#define STANDARD_ACTIVE_INCREMENT	1		</span><span class="cm">/* Task tree thread normal operation */</span><span class="cp"></span>
<span class="cp">#define SUSPEND_ACTIVE_INCREMENT	2		</span><span class="cm">/* Cause execution to suspend in the task tree thread</span>
<span class="cm">                                               This should only ever be used on the Background thread */</span><span class="cp"></span>

<span class="cp">#define HOSTFLAGS_DISABLE_BG_SLEEP  0       </span><span class="cm">/* Host-controlled flag that determines whether we go to sleep</span>
<span class="cm">                                               at the end of BG */</span><span class="cp"></span>

<span class="cm">/* Minimal context save area for Hyper Forground */</span>
<span class="k">struct</span> <span class="n">dsp_hf_save_area</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">r10_save</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">r54_save</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">r98_save</span><span class="p">;</span>

	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	    <span class="n">status_save</span><span class="p">,</span>
	    <span class="n">ind_save</span>
	<span class="p">)</span>

	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	    <span class="n">rci1_save</span><span class="p">,</span>
	    <span class="n">rci0_save</span>
	<span class="p">)</span>

	<span class="n">u32</span>	<span class="n">r32_save</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">r76_save</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rsd2_save</span><span class="p">;</span>

       	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	      <span class="n">rsi2_save</span><span class="p">,</span>	  <span class="cm">/* See TaskTreeParameterBlock for </span>
<span class="cm">				     remainder of registers  */</span>
	      <span class="n">rsa2Save</span>
	<span class="p">)</span>
	<span class="cm">/* saved as part of HFG context  */</span>
<span class="p">};</span>


<span class="cm">/* Task link data structure */</span>
<span class="k">struct</span> <span class="n">dsp_tree_link</span> <span class="p">{</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	<span class="cm">/* Pointer to sibling task control block */</span>
	    <span class="n">next_scb</span><span class="p">,</span>
	<span class="cm">/* Pointer to child task control block */</span>
	    <span class="n">sub_ptr</span>
	<span class="p">)</span>
  
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	<span class="cm">/* Pointer to code entry point */</span>
	    <span class="n">entry_point</span><span class="p">,</span> 
	<span class="cm">/* Pointer to local data */</span>
	    <span class="n">this_spb</span>
	<span class="p">)</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">dsp_task_tree_data</span> <span class="p">{</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	<span class="cm">/* Initial tock count; controls task tree execution rate */</span>
	    <span class="n">tock_count_limit</span><span class="p">,</span>
	<span class="cm">/* Tock down counter */</span>
	    <span class="n">tock_count</span>
	<span class="p">)</span>

	<span class="cm">/* Add to ActiveCount when TockCountLimit reached: </span>
<span class="cm">	   Subtract on task tree termination */</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	    <span class="n">active_tncrement</span><span class="p">,</span>		
	<span class="cm">/* Number of pending activations for task tree */</span>
	    <span class="n">active_count</span>
	<span class="p">)</span>

        <span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	<span class="cm">/* BitNumber to enable modification of correct bit in ActiveTaskFlags */</span>
	    <span class="n">active_bit</span><span class="p">,</span>	    
	<span class="cm">/* Pointer to OS location for indicating current activity on task level */</span>
	    <span class="n">active_task_flags_ptr</span>
	<span class="p">)</span>

	<span class="cm">/* Data structure for controlling movement of memory blocks:- </span>
<span class="cm">	   currently unused */</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	    <span class="n">mem_upd_ptr</span><span class="p">,</span>
	<span class="cm">/* Data structure for controlling synchronous link update */</span>
	    <span class="n">link_upd_ptr</span>
	<span class="p">)</span>
  
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	<span class="cm">/* Save area for remainder of full context. */</span>
	    <span class="n">save_area</span><span class="p">,</span>
	<span class="cm">/* Address of start of local stack for data storage */</span>
	    <span class="n">data_stack_base_ptr</span>
	<span class="p">)</span>

<span class="p">};</span>


<span class="k">struct</span> <span class="n">dsp_interval_timer_data</span>
<span class="p">{</span>
	<span class="cm">/* These data items have the same relative locations to those */</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	     <span class="n">interval_timer_period</span><span class="p">,</span>
	     <span class="n">itd_unused</span>
	<span class="p">)</span>

	<span class="cm">/* used for this data in the SPOS control block for SPOS 1.0 */</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	     <span class="n">num_FG_ticks_this_interval</span><span class="p">,</span>        
	     <span class="n">num_intervals</span>
	<span class="p">)</span>
<span class="p">};</span>


<span class="cm">/* This structure contains extra storage for the task tree</span>
<span class="cm">   Currently, this additional data is related only to a full context save */</span>
<span class="k">struct</span> <span class="n">dsp_task_tree_context_block</span> <span class="p">{</span>
	<span class="cm">/* Up to 10 values are saved onto the stack.  8 for the task tree, 1 for</span>
<span class="cm">	   The access to the context switch (call or interrupt), and 1 spare that</span>
<span class="cm">	   users should never use.  This last may be required by the system */</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	     <span class="n">stack1</span><span class="p">,</span>
	     <span class="n">stack0</span>
	<span class="p">)</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	     <span class="n">stack3</span><span class="p">,</span>
	     <span class="n">stack2</span>
	<span class="p">)</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	     <span class="n">stack5</span><span class="p">,</span>
	     <span class="n">stack4</span>
	<span class="p">)</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	     <span class="n">stack7</span><span class="p">,</span>
	     <span class="n">stack6</span>
	<span class="p">)</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
	     <span class="n">stack9</span><span class="p">,</span>
	     <span class="n">stack8</span>
	<span class="p">)</span>

	<span class="n">u32</span>	  <span class="n">saverfe</span><span class="p">;</span>					

	<span class="cm">/* Value may be overwriten by stack save algorithm.</span>
<span class="cm">	   Retain the size of the stack data saved here if used */</span>
	<span class="n">___DSP_DUAL_16BIT_ALLOC</span><span class="p">(</span>
             <span class="n">reserved1</span><span class="p">,</span>	
  	     <span class="n">stack_size</span>
	<span class="p">)</span>
	<span class="n">u32</span>		<span class="n">saverba</span><span class="p">;</span>	  <span class="cm">/* (HFG) */</span>
	<span class="n">u32</span>		<span class="n">saverdc</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">savers_config_23</span><span class="p">;</span> <span class="cm">/* (HFG) */</span>
	<span class="n">u32</span>		<span class="n">savers_DMA23</span><span class="p">;</span>	  <span class="cm">/* (HFG) */</span>
	<span class="n">u32</span>		<span class="n">saversa0</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saversi0</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saversa1</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saversi1</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saversa3</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saversd0</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saversd1</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saversd3</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">savers_config01</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">savers_DMA01</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveacc0hl</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveacc1hl</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveacc0xacc1x</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveacc2hl</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveacc3hl</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveacc2xacc3x</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveaux0hl</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveaux1hl</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveaux0xaux1x</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveaux2hl</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveaux3hl</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">saveaux2xaux3x</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">savershouthl</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">savershoutxmacmode</span><span class="p">;</span>
<span class="p">};</span>
                

<span class="k">struct</span> <span class="n">dsp_task_tree_control_block</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">dsp_hf_save_area</span>			<span class="n">context</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dsp_tree_link</span>			<span class="n">links</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dsp_task_tree_data</span>		<span class="n">data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dsp_task_tree_context_block</span>	<span class="n">context_blk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dsp_interval_timer_data</span>		<span class="n">int_timer</span><span class="p">;</span>
<span class="p">};</span>


<span class="cp">#endif </span><span class="cm">/* __DSP_TASK_TYPES_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
