<!DOCTYPE html>
<html><head><title>joekychen/linux » include › sound › sb16_csp.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>sb16_csp.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __SOUND_SB16_CSP_H</span>
<span class="cp">#define __SOUND_SB16_CSP_H</span>

<span class="cm">/*</span>
<span class="cm"> *  Copyright (c) 1999 by Uros Bizjak &lt;uros@kss-loka.si&gt;</span>
<span class="cm"> *                        Takashi Iwai &lt;tiwai@suse.de&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  SB16ASP/AWE32 CSP control</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify </span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/* CSP modes */</span>
<span class="cp">#define SNDRV_SB_CSP_MODE_NONE		0x00</span>
<span class="cp">#define SNDRV_SB_CSP_MODE_DSP_READ	0x01	</span><span class="cm">/* Record from DSP */</span><span class="cp"></span>
<span class="cp">#define SNDRV_SB_CSP_MODE_DSP_WRITE	0x02	</span><span class="cm">/* Play to DSP */</span><span class="cp"></span>
<span class="cp">#define SNDRV_SB_CSP_MODE_QSOUND		0x04	</span><span class="cm">/* QSound */</span><span class="cp"></span>

<span class="cm">/* CSP load flags */</span>
<span class="cp">#define SNDRV_SB_CSP_LOAD_FROMUSER	0x01</span>
<span class="cp">#define SNDRV_SB_CSP_LOAD_INITBLOCK	0x02</span>

<span class="cm">/* CSP sample width */</span>
<span class="cp">#define SNDRV_SB_CSP_SAMPLE_8BIT		0x01</span>
<span class="cp">#define SNDRV_SB_CSP_SAMPLE_16BIT		0x02</span>

<span class="cm">/* CSP channels */</span>
<span class="cp">#define SNDRV_SB_CSP_MONO			0x01</span>
<span class="cp">#define SNDRV_SB_CSP_STEREO		0x02</span>

<span class="cm">/* CSP rates */</span>
<span class="cp">#define SNDRV_SB_CSP_RATE_8000		0x01</span>
<span class="cp">#define SNDRV_SB_CSP_RATE_11025		0x02</span>
<span class="cp">#define SNDRV_SB_CSP_RATE_22050		0x04</span>
<span class="cp">#define SNDRV_SB_CSP_RATE_44100		0x08</span>
<span class="cp">#define SNDRV_SB_CSP_RATE_ALL		0x0f</span>

<span class="cm">/* CSP running state */</span>
<span class="cp">#define SNDRV_SB_CSP_ST_IDLE		0x00</span>
<span class="cp">#define SNDRV_SB_CSP_ST_LOADED		0x01</span>
<span class="cp">#define SNDRV_SB_CSP_ST_RUNNING		0x02</span>
<span class="cp">#define SNDRV_SB_CSP_ST_PAUSED		0x04</span>
<span class="cp">#define SNDRV_SB_CSP_ST_AUTO		0x08</span>
<span class="cp">#define SNDRV_SB_CSP_ST_QSOUND		0x10</span>

<span class="cm">/* maximum QSound value (180 degrees right) */</span>
<span class="cp">#define SNDRV_SB_CSP_QSOUND_MAX_RIGHT	0x20</span>

<span class="cm">/* maximum microcode RIFF file size */</span>
<span class="cp">#define SNDRV_SB_CSP_MAX_MICROCODE_FILE_SIZE	0x3000</span>

<span class="cm">/* microcode header */</span>
<span class="k">struct</span> <span class="n">snd_sb_csp_mc_header</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">codec_name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>		<span class="cm">/* id name of codec */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">func_req</span><span class="p">;</span>	<span class="cm">/* requested function */</span>
<span class="p">};</span>

<span class="cm">/* microcode to be loaded */</span>
<span class="k">struct</span> <span class="n">snd_sb_csp_microcode</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_sb_csp_mc_header</span> <span class="n">info</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="n">SNDRV_SB_CSP_MAX_MICROCODE_FILE_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* start CSP with sample_width in mono/stereo */</span>
<span class="k">struct</span> <span class="n">snd_sb_csp_start</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">sample_width</span><span class="p">;</span>	<span class="cm">/* sample width, look above */</span>
	<span class="kt">int</span> <span class="n">channels</span><span class="p">;</span>		<span class="cm">/* channels, look above */</span>
<span class="p">};</span>

<span class="cm">/* CSP information */</span>
<span class="k">struct</span> <span class="n">snd_sb_csp_info</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">codec_name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>		<span class="cm">/* id name of codec */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">func_nr</span><span class="p">;</span>		<span class="cm">/* function number */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">acc_format</span><span class="p">;</span>	<span class="cm">/* accepted PCM formats */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">acc_channels</span><span class="p">;</span>	<span class="cm">/* accepted channels */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">acc_width</span><span class="p">;</span>	<span class="cm">/* accepted sample width */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">acc_rates</span><span class="p">;</span>	<span class="cm">/* accepted sample rates */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">csp_mode</span><span class="p">;</span>	<span class="cm">/* CSP mode, see above */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">run_channels</span><span class="p">;</span>	<span class="cm">/* current channels  */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">run_width</span><span class="p">;</span>	<span class="cm">/* current sample width */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">version</span><span class="p">;</span>		<span class="cm">/* version id: 0x10 - 0x1f */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">state</span><span class="p">;</span>		<span class="cm">/* state bits */</span>
<span class="p">};</span>

<span class="cm">/* HWDEP controls */</span>
<span class="cm">/* get CSP information */</span>
<span class="cp">#define SNDRV_SB_CSP_IOCTL_INFO		_IOR(&#39;H&#39;, 0x10, struct snd_sb_csp_info)</span>
<span class="cm">/* load microcode to CSP */</span>
<span class="cm">/* NOTE: struct snd_sb_csp_microcode overflows the max size (13 bits)</span>
<span class="cm"> * defined for some architectures like MIPS, and it leads to build errors.</span>
<span class="cm"> * (x86 and co have 14-bit size, thus it&#39;s valid, though.)</span>
<span class="cm"> * As a workaround for skipping the size-limit check, here we don&#39;t use the</span>
<span class="cm"> * normal _IOW() macro but _IOC() with the manual argument.</span>
<span class="cm"> */</span>
<span class="cp">#define SNDRV_SB_CSP_IOCTL_LOAD_CODE	\</span>
<span class="cp">	_IOC(_IOC_WRITE, &#39;H&#39;, 0x11, sizeof(struct snd_sb_csp_microcode))</span>
<span class="cm">/* unload microcode from CSP */</span>
<span class="cp">#define SNDRV_SB_CSP_IOCTL_UNLOAD_CODE	_IO(&#39;H&#39;, 0x12)</span>
<span class="cm">/* start CSP */</span>
<span class="cp">#define SNDRV_SB_CSP_IOCTL_START		_IOW(&#39;H&#39;, 0x13, struct snd_sb_csp_start)</span>
<span class="cm">/* stop CSP */</span>
<span class="cp">#define SNDRV_SB_CSP_IOCTL_STOP		_IO(&#39;H&#39;, 0x14)</span>
<span class="cm">/* pause CSP and DMA transfer */</span>
<span class="cp">#define SNDRV_SB_CSP_IOCTL_PAUSE		_IO(&#39;H&#39;, 0x15)</span>
<span class="cm">/* restart CSP and DMA transfer */</span>
<span class="cp">#define SNDRV_SB_CSP_IOCTL_RESTART	_IO(&#39;H&#39;, 0x16)</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#include &quot;sb.h&quot;</span>
<span class="cp">#include &quot;hwdep.h&quot;</span>
<span class="cp">#include &lt;linux/firmware.h&gt;</span>

<span class="k">struct</span> <span class="n">snd_sb_csp</span><span class="p">;</span>

<span class="cm">/* indices for the known CSP programs */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CSP_PROGRAM_MULAW</span><span class="p">,</span>
	<span class="n">CSP_PROGRAM_ALAW</span><span class="p">,</span>
	<span class="n">CSP_PROGRAM_ADPCM_INIT</span><span class="p">,</span>
	<span class="n">CSP_PROGRAM_ADPCM_PLAYBACK</span><span class="p">,</span>
	<span class="n">CSP_PROGRAM_ADPCM_CAPTURE</span><span class="p">,</span>

	<span class="n">CSP_PROGRAM_COUNT</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * CSP operators</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_sb_csp_ops</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">csp_use</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_sb_csp</span> <span class="o">*</span> <span class="n">p</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">csp_unuse</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_sb_csp</span> <span class="o">*</span> <span class="n">p</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">csp_autoload</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_sb_csp</span> <span class="o">*</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pcm_sfmt</span><span class="p">,</span> <span class="kt">int</span> <span class="n">play_rec_mode</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">csp_start</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_sb_csp</span> <span class="o">*</span> <span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sample_width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channels</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">csp_stop</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_sb_csp</span> <span class="o">*</span> <span class="n">p</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">csp_qsound_transfer</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_sb_csp</span> <span class="o">*</span> <span class="n">p</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * CSP private data</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_sb_csp</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_sb</span> <span class="o">*</span><span class="n">chip</span><span class="p">;</span>		<span class="cm">/* SB16 DSP */</span>
	<span class="kt">int</span> <span class="n">used</span><span class="p">;</span>		<span class="cm">/* usage flag - exclusive */</span>
	<span class="kt">char</span> <span class="n">codec_name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>	<span class="cm">/* name of codec */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">func_nr</span><span class="p">;</span>	<span class="cm">/* function number */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">acc_format</span><span class="p">;</span>	<span class="cm">/* accepted PCM formats */</span>
	<span class="kt">int</span> <span class="n">acc_channels</span><span class="p">;</span>	<span class="cm">/* accepted channels */</span>
	<span class="kt">int</span> <span class="n">acc_width</span><span class="p">;</span>		<span class="cm">/* accepted sample width */</span>
	<span class="kt">int</span> <span class="n">acc_rates</span><span class="p">;</span>		<span class="cm">/* accepted sample rates */</span>
	<span class="kt">int</span> <span class="n">mode</span><span class="p">;</span>		<span class="cm">/* MODE */</span>
	<span class="kt">int</span> <span class="n">run_channels</span><span class="p">;</span>	<span class="cm">/* current CSP channels */</span>
	<span class="kt">int</span> <span class="n">run_width</span><span class="p">;</span>		<span class="cm">/* current sample width */</span>
	<span class="kt">int</span> <span class="n">version</span><span class="p">;</span>		<span class="cm">/* CSP version (0x10 - 0x1f) */</span>
	<span class="kt">int</span> <span class="n">running</span><span class="p">;</span>		<span class="cm">/* running state */</span>

	<span class="k">struct</span> <span class="n">snd_sb_csp_ops</span> <span class="n">ops</span><span class="p">;</span>	<span class="cm">/* operators */</span>

	<span class="n">spinlock_t</span> <span class="n">q_lock</span><span class="p">;</span>	<span class="cm">/* locking */</span>
	<span class="kt">int</span> <span class="n">q_enabled</span><span class="p">;</span>		<span class="cm">/* enabled flag */</span>
	<span class="kt">int</span> <span class="n">qpos_left</span><span class="p">;</span>		<span class="cm">/* left position */</span>
	<span class="kt">int</span> <span class="n">qpos_right</span><span class="p">;</span>		<span class="cm">/* right position */</span>
	<span class="kt">int</span> <span class="n">qpos_changed</span><span class="p">;</span>	<span class="cm">/* position changed flag */</span>

	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">qsound_switch</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">qsound_space</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">access_mutex</span><span class="p">;</span>	<span class="cm">/* locking */</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">csp_programs</span><span class="p">[</span><span class="n">CSP_PROGRAM_COUNT</span><span class="p">];</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">snd_sb_csp_new</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_sb</span> <span class="o">*</span><span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">device</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_hwdep</span> <span class="o">**</span> <span class="n">rhwdep</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* __SOUND_SB16_CSP */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
