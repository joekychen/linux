<!DOCTYPE html>
<html><head><title>joekychen/linux » include › sound › trident.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>trident.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __SOUND_TRIDENT_H</span>
<span class="cp">#define __SOUND_TRIDENT_H</span>

<span class="cm">/*</span>
<span class="cm"> *  audio@tridentmicro.com</span>
<span class="cm"> *  Fri Feb 19 15:55:28 MST 1999</span>
<span class="cm"> *  Definitions for Trident 4DWave DX/NX chips</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;pcm.h&quot;</span>
<span class="cp">#include &quot;mpu401.h&quot;</span>
<span class="cp">#include &quot;ac97_codec.h&quot;</span>
<span class="cp">#include &quot;util_mem.h&quot;</span>

<span class="cp">#define TRIDENT_DEVICE_ID_DX		((PCI_VENDOR_ID_TRIDENT&lt;&lt;16)|PCI_DEVICE_ID_TRIDENT_4DWAVE_DX)</span>
<span class="cp">#define TRIDENT_DEVICE_ID_NX		((PCI_VENDOR_ID_TRIDENT&lt;&lt;16)|PCI_DEVICE_ID_TRIDENT_4DWAVE_NX)</span>
<span class="cp">#define TRIDENT_DEVICE_ID_SI7018	((PCI_VENDOR_ID_SI&lt;&lt;16)|PCI_DEVICE_ID_SI_7018)</span>

<span class="cp">#define SNDRV_TRIDENT_VOICE_TYPE_PCM		0</span>
<span class="cp">#define SNDRV_TRIDENT_VOICE_TYPE_SYNTH		1</span>
<span class="cp">#define SNDRV_TRIDENT_VOICE_TYPE_MIDI		2</span>

<span class="cp">#define SNDRV_TRIDENT_VFLG_RUNNING		(1&lt;&lt;0)</span>

<span class="cm">/* TLB code constants */</span>
<span class="cp">#define SNDRV_TRIDENT_PAGE_SIZE			4096</span>
<span class="cp">#define SNDRV_TRIDENT_PAGE_SHIFT			12</span>
<span class="cp">#define SNDRV_TRIDENT_PAGE_MASK			((1&lt;&lt;SNDRV_TRIDENT_PAGE_SHIFT)-1)</span>
<span class="cp">#define SNDRV_TRIDENT_MAX_PAGES			4096</span>

<span class="cm">/*</span>
<span class="cm"> * Direct registers</span>
<span class="cm"> */</span>

<span class="cp">#define TRID_REG(trident, x) ((trident)-&gt;port + (x))</span>

<span class="cp">#define ID_4DWAVE_DX        0x2000</span>
<span class="cp">#define ID_4DWAVE_NX        0x2001</span>

<span class="cm">/* Bank definitions */</span>

<span class="cp">#define T4D_BANK_A	0</span>
<span class="cp">#define T4D_BANK_B	1</span>
<span class="cp">#define T4D_NUM_BANKS	2</span>

<span class="cm">/* Register definitions */</span>

<span class="cm">/* Global registers */</span>

<span class="k">enum</span> <span class="n">global_control_bits</span> <span class="p">{</span>
	<span class="n">CHANNEL_IDX</span>	<span class="o">=</span> <span class="mh">0x0000003f</span><span class="p">,</span>
	<span class="n">OVERRUN_IE</span>	<span class="o">=</span> <span class="mh">0x00000400</span><span class="p">,</span>	<span class="cm">/* interrupt enable: capture overrun */</span>
	<span class="n">UNDERRUN_IE</span>	<span class="o">=</span> <span class="mh">0x00000800</span><span class="p">,</span>	<span class="cm">/* interrupt enable: playback underrun */</span>
	<span class="n">ENDLP_IE</span>	<span class="o">=</span> <span class="mh">0x00001000</span><span class="p">,</span>	<span class="cm">/* interrupt enable: end of buffer */</span>
	<span class="n">MIDLP_IE</span>	<span class="o">=</span> <span class="mh">0x00002000</span><span class="p">,</span>	<span class="cm">/* interrupt enable: middle buffer */</span>
	<span class="n">ETOG_IE</span>		<span class="o">=</span> <span class="mh">0x00004000</span><span class="p">,</span>	<span class="cm">/* interrupt enable: envelope toggling */</span>
	<span class="n">EDROP_IE</span>	<span class="o">=</span> <span class="mh">0x00008000</span><span class="p">,</span>	<span class="cm">/* interrupt enable: envelope drop */</span>
	<span class="n">BANK_B_EN</span>	<span class="o">=</span> <span class="mh">0x00010000</span><span class="p">,</span>	<span class="cm">/* SiS: enable bank B (64 channels) */</span>
	<span class="n">PCMIN_B_MIX</span>	<span class="o">=</span> <span class="mh">0x00020000</span><span class="p">,</span>	<span class="cm">/* SiS: PCM IN B mixing enable */</span>
	<span class="n">I2S_OUT_ASSIGN</span>	<span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>	<span class="cm">/* SiS: I2S Out contains surround PCM */</span>
	<span class="n">SPDIF_OUT_ASSIGN</span><span class="o">=</span> <span class="mh">0x00080000</span><span class="p">,</span>	<span class="cm">/* SiS: 0=S/PDIF L/R | 1=PCM Out FIFO */</span>
	<span class="n">MAIN_OUT_ASSIGN</span> <span class="o">=</span> <span class="mh">0x00100000</span><span class="p">,</span>	<span class="cm">/* SiS: 0=PCM Out FIFO | 1=MMC Out buffer */</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">miscint_bits</span> <span class="p">{</span>
	<span class="n">PB_UNDERRUN_IRQ</span> <span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span> <span class="n">REC_OVERRUN_IRQ</span> <span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
	<span class="n">SB_IRQ</span>		<span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span> <span class="n">MPU401_IRQ</span>      <span class="o">=</span> <span class="mh">0x00000008</span><span class="p">,</span>
	<span class="n">OPL3_IRQ</span>        <span class="o">=</span> <span class="mh">0x00000010</span><span class="p">,</span> <span class="n">ADDRESS_IRQ</span>     <span class="o">=</span> <span class="mh">0x00000020</span><span class="p">,</span>
	<span class="n">ENVELOPE_IRQ</span>    <span class="o">=</span> <span class="mh">0x00000040</span><span class="p">,</span> <span class="n">PB_UNDERRUN</span>     <span class="o">=</span> <span class="mh">0x00000100</span><span class="p">,</span>
	<span class="n">REC_OVERRUN</span>	<span class="o">=</span> <span class="mh">0x00000200</span><span class="p">,</span> <span class="n">MIXER_UNDERFLOW</span> <span class="o">=</span> <span class="mh">0x00000400</span><span class="p">,</span>
	<span class="n">MIXER_OVERFLOW</span>  <span class="o">=</span> <span class="mh">0x00000800</span><span class="p">,</span> <span class="n">NX_SB_IRQ_DISABLE</span> <span class="o">=</span> <span class="mh">0x00001000</span><span class="p">,</span>
        <span class="n">ST_TARGET_REACHED</span> <span class="o">=</span> <span class="mh">0x00008000</span><span class="p">,</span>
	<span class="n">PB_24K_MODE</span>     <span class="o">=</span> <span class="mh">0x00010000</span><span class="p">,</span> <span class="n">ST_IRQ_EN</span>       <span class="o">=</span> <span class="mh">0x00800000</span><span class="p">,</span>
	<span class="n">ACGPIO_IRQ</span>	<span class="o">=</span> <span class="mh">0x01000000</span>
<span class="p">};</span>

<span class="cm">/* T2 legacy dma control registers. */</span>
<span class="cp">#define LEGACY_DMAR0                0x00  </span><span class="c1">// ADR0</span>
<span class="cp">#define LEGACY_DMAR4                0x04  </span><span class="c1">// CNT0</span>
<span class="cp">#define LEGACY_DMAR6		    0x06  </span><span class="c1">// CNT0 - High bits</span>
<span class="cp">#define LEGACY_DMAR11               0x0b  </span><span class="c1">// MOD </span>
<span class="cp">#define LEGACY_DMAR15               0x0f  </span><span class="c1">// MMR </span>

<span class="cp">#define T4D_START_A		     0x80</span>
<span class="cp">#define T4D_STOP_A		     0x84</span>
<span class="cp">#define T4D_DLY_A		     0x88</span>
<span class="cp">#define T4D_SIGN_CSO_A		     0x8c</span>
<span class="cp">#define T4D_CSPF_A		     0x90</span>
<span class="cp">#define T4D_CSPF_B		     0xbc</span>
<span class="cp">#define T4D_CEBC_A		     0x94</span>
<span class="cp">#define T4D_AINT_A		     0x98</span>
<span class="cp">#define T4D_AINTEN_A		     0x9c</span>
<span class="cp">#define T4D_LFO_GC_CIR               0xa0</span>
<span class="cp">#define T4D_MUSICVOL_WAVEVOL         0xa8</span>
<span class="cp">#define T4D_SBDELTA_DELTA_R          0xac</span>
<span class="cp">#define T4D_MISCINT                  0xb0</span>
<span class="cp">#define T4D_START_B                  0xb4</span>
<span class="cp">#define T4D_STOP_B                   0xb8</span>
<span class="cp">#define T4D_SBBL_SBCL                0xc0</span>
<span class="cp">#define T4D_SBCTRL_SBE2R_SBDD        0xc4</span>
<span class="cp">#define T4D_STIMER		     0xc8</span>
<span class="cp">#define T4D_AINT_B                   0xd8</span>
<span class="cp">#define T4D_AINTEN_B                 0xdc</span>
<span class="cp">#define T4D_RCI                      0x70</span>

<span class="cm">/* MPU-401 UART */</span>
<span class="cp">#define T4D_MPU401_BASE             0x20</span>
<span class="cp">#define T4D_MPUR0                   0x20</span>
<span class="cp">#define T4D_MPUR1                   0x21</span>
<span class="cp">#define T4D_MPUR2                   0x22</span>
<span class="cp">#define T4D_MPUR3                   0x23</span>

<span class="cm">/* S/PDIF Registers */</span>
<span class="cp">#define NX_SPCTRL_SPCSO             0x24</span>
<span class="cp">#define NX_SPLBA                    0x28</span>
<span class="cp">#define NX_SPESO                    0x2c</span>
<span class="cp">#define NX_SPCSTATUS                0x64</span>

<span class="cm">/* Joystick */</span>
<span class="cp">#define GAMEPORT_GCR                0x30</span>
<span class="cp">#define GAMEPORT_MODE_ADC           0x80</span>
<span class="cp">#define GAMEPORT_LEGACY             0x31</span>
<span class="cp">#define GAMEPORT_AXES               0x34</span>

<span class="cm">/* NX Specific Registers */</span>
<span class="cp">#define NX_TLBC                     0x6c</span>

<span class="cm">/* Channel Registers */</span>

<span class="cp">#define CH_START		    0xe0</span>

<span class="cp">#define CH_DX_CSO_ALPHA_FMS         0xe0</span>
<span class="cp">#define CH_DX_ESO_DELTA             0xe8</span>
<span class="cp">#define CH_DX_FMC_RVOL_CVOL         0xec</span>

<span class="cp">#define CH_NX_DELTA_CSO             0xe0</span>
<span class="cp">#define CH_NX_DELTA_ESO             0xe8</span>
<span class="cp">#define CH_NX_ALPHA_FMS_FMC_RVOL_CVOL 0xec</span>

<span class="cp">#define CH_LBA                      0xe4</span>
<span class="cp">#define CH_GVSEL_PAN_VOL_CTRL_EC    0xf0</span>
<span class="cp">#define CH_EBUF1                    0xf4</span>
<span class="cp">#define CH_EBUF2                    0xf8</span>

<span class="cm">/* AC-97 Registers */</span>

<span class="cp">#define DX_ACR0_AC97_W              0x40</span>
<span class="cp">#define DX_ACR1_AC97_R              0x44</span>
<span class="cp">#define DX_ACR2_AC97_COM_STAT       0x48</span>

<span class="cp">#define NX_ACR0_AC97_COM_STAT       0x40</span>
<span class="cp">#define NX_ACR1_AC97_W              0x44</span>
<span class="cp">#define NX_ACR2_AC97_R_PRIMARY      0x48</span>
<span class="cp">#define NX_ACR3_AC97_R_SECONDARY    0x4c</span>

<span class="cp">#define SI_AC97_WRITE		    0x40</span>
<span class="cp">#define SI_AC97_READ		    0x44</span>
<span class="cp">#define SI_SERIAL_INTF_CTRL	    0x48</span>
<span class="cp">#define SI_AC97_GPIO		    0x4c</span>
<span class="cp">#define SI_ASR0			    0x50</span>
<span class="cp">#define SI_SPDIF_CS		    0x70</span>
<span class="cp">#define SI_GPIO			    0x7c</span>

<span class="k">enum</span> <span class="n">trident_nx_ac97_bits</span> <span class="p">{</span>
	<span class="cm">/* ACR1-3 */</span>
	<span class="n">NX_AC97_BUSY_WRITE</span> 	<span class="o">=</span> <span class="mh">0x0800</span><span class="p">,</span>
	<span class="n">NX_AC97_BUSY_READ</span>	<span class="o">=</span> <span class="mh">0x0800</span><span class="p">,</span>
	<span class="n">NX_AC97_BUSY_DATA</span> 	<span class="o">=</span> <span class="mh">0x0400</span><span class="p">,</span>
	<span class="n">NX_AC97_WRITE_SECONDARY</span> <span class="o">=</span> <span class="mh">0x0100</span><span class="p">,</span>
	<span class="cm">/* ACR0 */</span>
	<span class="n">NX_AC97_SECONDARY_READY</span> <span class="o">=</span> <span class="mh">0x0040</span><span class="p">,</span>
	<span class="n">NX_AC97_SECONDARY_RECORD</span> <span class="o">=</span> <span class="mh">0x0020</span><span class="p">,</span>
	<span class="n">NX_AC97_SURROUND_OUTPUT</span> <span class="o">=</span> <span class="mh">0x0010</span><span class="p">,</span>
	<span class="n">NX_AC97_PRIMARY_READY</span>	<span class="o">=</span> <span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">NX_AC97_PRIMARY_RECORD</span>	<span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">NX_AC97_PCM_OUTPUT</span>	<span class="o">=</span> <span class="mh">0x0002</span><span class="p">,</span>
	<span class="n">NX_AC97_WARM_RESET</span>	<span class="o">=</span> <span class="mh">0x0001</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">trident_dx_ac97_bits</span> <span class="p">{</span>
	<span class="n">DX_AC97_BUSY_WRITE</span>	<span class="o">=</span> <span class="mh">0x8000</span><span class="p">,</span>
	<span class="n">DX_AC97_BUSY_READ</span>	<span class="o">=</span> <span class="mh">0x8000</span><span class="p">,</span>
	<span class="n">DX_AC97_READY</span>		<span class="o">=</span> <span class="mh">0x0010</span><span class="p">,</span>
	<span class="n">DX_AC97_RECORD</span>		<span class="o">=</span> <span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">DX_AC97_PLAYBACK</span>	<span class="o">=</span> <span class="mh">0x0002</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">sis7018_ac97_bits</span> <span class="p">{</span>
	<span class="n">SI_AC97_BUSY_WRITE</span> <span class="o">=</span>	<span class="mh">0x00008000</span><span class="p">,</span>
	<span class="n">SI_AC97_AUDIO_BUSY</span> <span class="o">=</span>	<span class="mh">0x00004000</span><span class="p">,</span>
	<span class="n">SI_AC97_MODEM_BUSY</span> <span class="o">=</span>	<span class="mh">0x00002000</span><span class="p">,</span>
	<span class="n">SI_AC97_BUSY_READ</span> <span class="o">=</span>	<span class="mh">0x00008000</span><span class="p">,</span>
	<span class="n">SI_AC97_SECONDARY</span> <span class="o">=</span>	<span class="mh">0x00000080</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">serial_intf_ctrl_bits</span> <span class="p">{</span>
	<span class="n">WARM_RESET</span>	<span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
	<span class="n">COLD_RESET</span>	<span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
	<span class="n">I2S_CLOCK</span>	<span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span>
	<span class="n">PCM_SEC_AC97</span>	<span class="o">=</span> <span class="mh">0x00000008</span><span class="p">,</span>
	<span class="n">AC97_DBL_RATE</span>	<span class="o">=</span> <span class="mh">0x00000010</span><span class="p">,</span>
	<span class="n">SPDIF_EN</span>	<span class="o">=</span> <span class="mh">0x00000020</span><span class="p">,</span>
	<span class="n">I2S_OUTPUT_EN</span>	<span class="o">=</span> <span class="mh">0x00000040</span><span class="p">,</span>
	<span class="n">I2S_INPUT_EN</span>	<span class="o">=</span> <span class="mh">0x00000080</span><span class="p">,</span>
	<span class="n">PCMIN</span>		<span class="o">=</span> <span class="mh">0x00000100</span><span class="p">,</span>
	<span class="n">LINE1IN</span>		<span class="o">=</span> <span class="mh">0x00000200</span><span class="p">,</span>
	<span class="n">MICIN</span>		<span class="o">=</span> <span class="mh">0x00000400</span><span class="p">,</span>
	<span class="n">LINE2IN</span>		<span class="o">=</span> <span class="mh">0x00000800</span><span class="p">,</span>
	<span class="n">HEAD_SET_IN</span>	<span class="o">=</span> <span class="mh">0x00001000</span><span class="p">,</span>
	<span class="n">GPIOIN</span>		<span class="o">=</span> <span class="mh">0x00002000</span><span class="p">,</span>
	<span class="cm">/* 7018 spec says id = 01 but the demo board routed to 10</span>
<span class="cm">	   SECONDARY_ID= 0x00004000, */</span>
	<span class="n">SECONDARY_ID</span>	<span class="o">=</span> <span class="mh">0x00004000</span><span class="p">,</span>
	<span class="n">PCMOUT</span>		<span class="o">=</span> <span class="mh">0x00010000</span><span class="p">,</span>
	<span class="n">SURROUT</span>		<span class="o">=</span> <span class="mh">0x00020000</span><span class="p">,</span>
	<span class="n">CENTEROUT</span>	<span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>
	<span class="n">LFEOUT</span>		<span class="o">=</span> <span class="mh">0x00080000</span><span class="p">,</span>
	<span class="n">LINE1OUT</span>	<span class="o">=</span> <span class="mh">0x00100000</span><span class="p">,</span>
	<span class="n">LINE2OUT</span>	<span class="o">=</span> <span class="mh">0x00200000</span><span class="p">,</span>
	<span class="n">GPIOOUT</span>		<span class="o">=</span> <span class="mh">0x00400000</span><span class="p">,</span>
	<span class="n">SI_AC97_PRIMARY_READY</span> <span class="o">=</span> <span class="mh">0x01000000</span><span class="p">,</span>
	<span class="n">SI_AC97_SECONDARY_READY</span> <span class="o">=</span> <span class="mh">0x02000000</span><span class="p">,</span>
	<span class="n">SI_AC97_POWERDOWN</span> <span class="o">=</span> <span class="mh">0x04000000</span><span class="p">,</span>
<span class="p">};</span>
                                                                                                                                   
<span class="cm">/* PCM defaults */</span>

<span class="cp">#define T4D_DEFAULT_PCM_VOL	10	</span><span class="cm">/* 0 - 255 */</span><span class="cp"></span>
<span class="cp">#define T4D_DEFAULT_PCM_PAN	0	</span><span class="cm">/* 0 - 127 */</span><span class="cp"></span>
<span class="cp">#define T4D_DEFAULT_PCM_RVOL	127	</span><span class="cm">/* 0 - 127 */</span><span class="cp"></span>
<span class="cp">#define T4D_DEFAULT_PCM_CVOL	127	</span><span class="cm">/* 0 - 127 */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">snd_trident</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">snd_trident_voice</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">snd_trident_pcm_mixer</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">snd_trident_port</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span> <span class="n">chset</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span> <span class="n">trident</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mode</span><span class="p">;</span>		<span class="cm">/* operation mode */</span>
	<span class="kt">int</span> <span class="n">client</span><span class="p">;</span>		<span class="cm">/* sequencer client number */</span>
	<span class="kt">int</span> <span class="n">port</span><span class="p">;</span>		<span class="cm">/* sequencer port number */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">midi_has_voices</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_trident_memblk_arg</span> <span class="p">{</span>
	<span class="kt">short</span> <span class="n">first_page</span><span class="p">,</span> <span class="n">last_page</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_trident_tlb</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span> <span class="n">entries</span><span class="p">;</span>		<span class="cm">/* 16k-aligned TLB table */</span>
	<span class="n">dma_addr_t</span> <span class="n">entries_dmaaddr</span><span class="p">;</span>	<span class="cm">/* 16k-aligned PCI address to TLB table */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span> <span class="n">shadow_entries</span><span class="p">;</span>	<span class="cm">/* shadow entries with virtual addresses */</span>
	<span class="k">struct</span> <span class="n">snd_dma_buffer</span> <span class="n">buffer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_util_memhdr</span> <span class="o">*</span> <span class="n">memhdr</span><span class="p">;</span>	<span class="cm">/* page allocation list */</span>
	<span class="k">struct</span> <span class="n">snd_dma_buffer</span> <span class="n">silent_page</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_trident_voice</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">number</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">use</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
	    <span class="nl">pcm:</span> <span class="mi">1</span><span class="p">,</span>
	    <span class="nl">synth:</span><span class="mi">1</span><span class="p">,</span>
	    <span class="nl">midi:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">client</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">index</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_trident_sample_ops</span> <span class="o">*</span><span class="n">sample_ops</span><span class="p">;</span>

	<span class="cm">/* channel parameters */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">CSO</span><span class="p">;</span>		<span class="cm">/* 24 bits (16 on DX) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ESO</span><span class="p">;</span>		<span class="cm">/* 24 bits (16 on DX) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">LBA</span><span class="p">;</span>		<span class="cm">/* 30 bits */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">EC</span><span class="p">;</span>		<span class="cm">/* 12 bits */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">Alpha</span><span class="p">;</span>		<span class="cm">/* 12 bits */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">Delta</span><span class="p">;</span>		<span class="cm">/* 16 bits */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">Attribute</span><span class="p">;</span>	<span class="cm">/* 16 bits - SiS 7018 */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">Vol</span><span class="p">;</span>		<span class="cm">/* 12 bits (6.6) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">Pan</span><span class="p">;</span>		<span class="cm">/* 7 bits (1.4.2) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">GVSel</span><span class="p">;</span>		<span class="cm">/* 1 bit */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">RVol</span><span class="p">;</span>		<span class="cm">/* 7 bits (5.2) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">CVol</span><span class="p">;</span>		<span class="cm">/* 7 bits (5.2) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">FMC</span><span class="p">;</span>		<span class="cm">/* 2 bits */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">CTRL</span><span class="p">;</span>		<span class="cm">/* 4 bits */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">FMS</span><span class="p">;</span>		<span class="cm">/* 4 bits */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">LFO</span><span class="p">;</span>		<span class="cm">/* 8 bits */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">negCSO</span><span class="p">;</span>	<span class="cm">/* nonzero - use negative CSO */</span>

	<span class="k">struct</span> <span class="n">snd_util_memblk</span> <span class="o">*</span><span class="n">memblk</span><span class="p">;</span>	<span class="cm">/* memory block if TLB enabled */</span>

	<span class="cm">/* PCM data */</span>

	<span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span><span class="n">trident</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_trident_voice</span> <span class="o">*</span><span class="n">extra</span><span class="p">;</span>	<span class="cm">/* extra PCM voice (acts as interrupt generator) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">running</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nl">capture:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nl">spdif:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nl">foldback:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nl">isync:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nl">isync2:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="nl">isync3:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">foldback_chan</span><span class="p">;</span>		<span class="cm">/* foldback subdevice number */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stimer</span><span class="p">;</span>		<span class="cm">/* global sample timer (to detect spurious interrupts) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">spurious_threshold</span><span class="p">;</span> <span class="cm">/* spurious threshold */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">isync_mark</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">isync_max</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">isync_ESO</span><span class="p">;</span>

	<span class="cm">/* --- */</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">private_free</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_trident_voice</span> <span class="o">*</span><span class="n">voice</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_4dwave</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">seq_client</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_trident_port</span> <span class="n">seq_ports</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">snd_trident_voice</span> <span class="n">voices</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>	

	<span class="kt">int</span> <span class="n">ChanSynthCount</span><span class="p">;</span>		<span class="cm">/* number of allocated synth channels */</span>
	<span class="kt">int</span> <span class="n">max_size</span><span class="p">;</span>			<span class="cm">/* maximum synth memory size in bytes */</span>
	<span class="kt">int</span> <span class="n">current_size</span><span class="p">;</span>		<span class="cm">/* current allocated synth mem in bytes */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_trident_pcm_mixer</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_trident_voice</span> <span class="o">*</span><span class="n">voice</span><span class="p">;</span>	<span class="cm">/* active voice */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">vol</span><span class="p">;</span>		<span class="cm">/* front volume */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pan</span><span class="p">;</span>		<span class="cm">/* pan control */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">rvol</span><span class="p">;</span>		<span class="cm">/* rear volume */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cvol</span><span class="p">;</span>		<span class="cm">/* center volume */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pad</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_trident</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">device</span><span class="p">;</span>	<span class="cm">/* device ID */</span>

        <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">bDMAStart</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">midi_port</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">spurious_irq_count</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">spurious_irq_max_delta</span><span class="p">;</span>

        <span class="k">struct</span> <span class="n">snd_trident_tlb</span> <span class="n">tlb</span><span class="p">;</span>	<span class="cm">/* TLB entries for NX cards */</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">spdif_ctrl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">spdif_pcm_ctrl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">spdif_bits</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">spdif_pcm_bits</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">spdif_pcm_ctl</span><span class="p">;</span>	<span class="cm">/* S/PDIF settings */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ac97_ctrl</span><span class="p">;</span>
        
        <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ChanMap</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* allocation map for hardware channels */</span>
        
        <span class="kt">int</span> <span class="n">ChanPCM</span><span class="p">;</span>			<span class="cm">/* max number of PCM channels */</span>
	<span class="kt">int</span> <span class="n">ChanPCMcnt</span><span class="p">;</span>			<span class="cm">/* actual number of PCM channels */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ac97_detect</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* 1 = AC97 in detection phase */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">in_suspend</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* 1 during suspend/resume */</span>

	<span class="k">struct</span> <span class="n">snd_4dwave</span> <span class="n">synth</span><span class="p">;</span>	<span class="cm">/* synth specific variables */</span>

	<span class="n">spinlock_t</span> <span class="n">event_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">voice_alloc</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_dma_device</span> <span class="n">dma_dev</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">pcm</span><span class="p">;</span>		<span class="cm">/* ADC/DAC PCM */</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">foldback</span><span class="p">;</span>	<span class="cm">/* Foldback PCM */</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">spdif</span><span class="p">;</span>	<span class="cm">/* SPDIF PCM */</span>
	<span class="k">struct</span> <span class="n">snd_rawmidi</span> <span class="o">*</span><span class="n">rmidi</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_ac97_bus</span> <span class="o">*</span><span class="n">ac97_bus</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_ac97</span> <span class="o">*</span><span class="n">ac97</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_ac97</span> <span class="o">*</span><span class="n">ac97_sec</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">musicvol_wavevol</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_trident_pcm_mixer</span> <span class="n">pcm_mixer</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">ctl_vol</span><span class="p">;</span>	<span class="cm">/* front volume */</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">ctl_pan</span><span class="p">;</span>	<span class="cm">/* pan */</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">ctl_rvol</span><span class="p">;</span>	<span class="cm">/* rear volume */</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">ctl_cvol</span><span class="p">;</span>	<span class="cm">/* center volume */</span>

	<span class="n">spinlock_t</span> <span class="n">reg_lock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">gameport</span> <span class="o">*</span><span class="n">gameport</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">snd_trident_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span>
		       <span class="kt">int</span> <span class="n">pcm_streams</span><span class="p">,</span>
		       <span class="kt">int</span> <span class="n">pcm_spdif_device</span><span class="p">,</span>
		       <span class="kt">int</span> <span class="n">max_wavetable_size</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">**</span> <span class="n">rtrident</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_trident_create_gameport</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span><span class="n">trident</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">snd_trident_pcm</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span> <span class="n">trident</span><span class="p">,</span> <span class="kt">int</span> <span class="n">device</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">**</span><span class="n">rpcm</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_trident_foldback_pcm</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span> <span class="n">trident</span><span class="p">,</span> <span class="kt">int</span> <span class="n">device</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">**</span><span class="n">rpcm</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_trident_spdif_pcm</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span> <span class="n">trident</span><span class="p">,</span> <span class="kt">int</span> <span class="n">device</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">**</span><span class="n">rpcm</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_trident_attach_synthesizer</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span> <span class="n">trident</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">snd_trident_voice</span> <span class="o">*</span><span class="n">snd_trident_alloc_voice</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span> <span class="n">trident</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span>
					     <span class="kt">int</span> <span class="n">client</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_trident_free_voice</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span> <span class="n">trident</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_trident_voice</span> <span class="o">*</span><span class="n">voice</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_trident_start_voice</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span> <span class="n">trident</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">voice</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_trident_stop_voice</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span> <span class="n">trident</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">voice</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_trident_write_voice_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span> <span class="n">trident</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_trident_voice</span> <span class="o">*</span><span class="n">voice</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_trident_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span> <span class="n">pm_message_t</span> <span class="n">state</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_trident_resume</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">);</span>

<span class="cm">/* TLB memory allocation */</span>
<span class="k">struct</span> <span class="n">snd_util_memblk</span> <span class="o">*</span><span class="n">snd_trident_alloc_pages</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span><span class="n">trident</span><span class="p">,</span>
						<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_trident_free_pages</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span><span class="n">trident</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_util_memblk</span> <span class="o">*</span><span class="n">blk</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">snd_util_memblk</span> <span class="o">*</span><span class="n">snd_trident_synth_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span><span class="n">trident</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_trident_synth_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span><span class="n">trident</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_util_memblk</span> <span class="o">*</span><span class="n">blk</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_trident_synth_copy_from_user</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_trident</span> <span class="o">*</span><span class="n">trident</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_util_memblk</span> <span class="o">*</span><span class="n">blk</span><span class="p">,</span>
				     <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __SOUND_TRIDENT_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
