<!DOCTYPE html>
<html><head><title>joekychen/linux » include › sound › seq_midi_emul.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>seq_midi_emul.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __SOUND_SEQ_MIDI_EMUL_H</span>
<span class="cp">#define __SOUND_SEQ_MIDI_EMUL_H</span>

<span class="cm">/*</span>
<span class="cm"> *  Midi channel definition for optional channel management.</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 1999 Steve Ratcliffe</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;seq_kernel.h&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * This structure is used to keep track of the current state on each</span>
<span class="cm"> * channel.  All drivers for hardware that does not understand midi</span>
<span class="cm"> * directly will probably need to use this structure.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">private</span><span class="p">;</span>		<span class="cm">/* A back pointer to driver data */</span>
	<span class="kt">int</span>  <span class="n">number</span><span class="p">;</span>		<span class="cm">/* The channel number */</span>
	<span class="kt">int</span>  <span class="n">client</span><span class="p">;</span>		<span class="cm">/* The client associated with this channel */</span>
	<span class="kt">int</span>  <span class="n">port</span><span class="p">;</span>		<span class="cm">/* The port associated with this channel */</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">midi_mode</span><span class="p">;</span>	<span class="cm">/* GM, GS, XG etc */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> 
		<span class="n">drum_channel</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Drum channel */</span>
		<span class="nl">param_type:</span><span class="mi">1</span>		<span class="cm">/* RPN/NRPN */</span>
		<span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">midi_aftertouch</span><span class="p">;</span>	<span class="cm">/* Aftertouch (key pressure) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">midi_pressure</span><span class="p">;</span>	<span class="cm">/* Channel pressure */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">midi_program</span><span class="p">;</span>	<span class="cm">/* Instrument number */</span>
	<span class="kt">short</span> <span class="n">midi_pitchbend</span><span class="p">;</span>		<span class="cm">/* Pitch bend amount */</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">control</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>	<span class="cm">/* Current value of all controls */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">note</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>	<span class="cm">/* Current status for all notes */</span>

	<span class="kt">short</span> <span class="n">gm_rpn_pitch_bend_range</span><span class="p">;</span>	<span class="cm">/* Pitch bend range */</span>
	<span class="kt">short</span> <span class="n">gm_rpn_fine_tuning</span><span class="p">;</span> 	<span class="cm">/* Master fine tuning */</span>
	<span class="kt">short</span> <span class="n">gm_rpn_coarse_tuning</span><span class="p">;</span>	<span class="cm">/* Master coarse tuning */</span>

<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * A structure that represets a set of channels bound to a port.  There</span>
<span class="cm"> * would usually be 16 channels per port.  But fewer could be used for</span>
<span class="cm"> * particular cases.</span>
<span class="cm"> * The channel set consists of information describing the client and</span>
<span class="cm"> * port for this midi synth and an array of snd_midi_channel structures.</span>
<span class="cm"> * A driver that had no need for snd_midi_channel could still use the</span>
<span class="cm"> * channel set type if it wished with the channel array null.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">;</span>		<span class="cm">/* Driver data */</span>
	<span class="kt">int</span>  <span class="n">client</span><span class="p">;</span>			<span class="cm">/* Client for this port */</span>
	<span class="kt">int</span>  <span class="n">port</span><span class="p">;</span>			<span class="cm">/* The port number */</span>

	<span class="kt">int</span>  <span class="n">max_channels</span><span class="p">;</span>		<span class="cm">/* Size of the channels array */</span>
	<span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">channels</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">midi_mode</span><span class="p">;</span>	<span class="cm">/* MIDI operating mode */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gs_master_volume</span><span class="p">;</span>	<span class="cm">/* SYSEX master volume: 0-127 */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gs_chorus_mode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gs_reverb_mode</span><span class="p">;</span>

<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_midi_op</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">note_on</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">note</span><span class="p">,</span> <span class="kt">int</span> <span class="n">vel</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">note_off</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">,</span><span class="kt">int</span> <span class="n">note</span><span class="p">,</span> <span class="kt">int</span> <span class="n">vel</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">);</span> <span class="cm">/* release note */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">key_press</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">note</span><span class="p">,</span> <span class="kt">int</span> <span class="n">vel</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">note_terminate</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">note</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">);</span> <span class="cm">/* terminate note immediately */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">control</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">nrpn</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span><span class="n">chset</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">sysex</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">parsed</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span><span class="n">chset</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * These defines are used so that pitchbend, aftertouch etc, can be</span>
<span class="cm"> * distinguished from controller values.</span>
<span class="cm"> */</span>
<span class="cm">/* 0-127 controller values */</span>
<span class="cp">#define MIDI_CTL_PITCHBEND	0x80</span>
<span class="cp">#define MIDI_CTL_AFTERTOUCH	0x81</span>
<span class="cp">#define MIDI_CTL_CHAN_PRESSURE	0x82</span>

<span class="cm">/*</span>
<span class="cm"> * These names exist to allow symbolic access to the controls array.</span>
<span class="cm"> * The usage is eg: chan-&gt;gm_bank_select.  Another implementation would</span>
<span class="cm"> * be really have these members in the struct, and not the array.</span>
<span class="cm"> */</span>
<span class="cp">#define gm_bank_select		control[0]</span>
<span class="cp">#define gm_modulation		control[1]</span>
<span class="cp">#define gm_breath		control[2]</span>
<span class="cp">#define gm_foot_pedal		control[4]</span>
<span class="cp">#define gm_portamento_time	control[5]</span>
<span class="cp">#define gm_data_entry		control[6]</span>
<span class="cp">#define gm_volume		control[7]</span>
<span class="cp">#define gm_balance		control[8]</span>
<span class="cp">#define gm_pan			control[10]</span>
<span class="cp">#define gm_expression		control[11]</span>
<span class="cp">#define gm_effect_control1	control[12]</span>
<span class="cp">#define gm_effect_control2	control[13]</span>
<span class="cp">#define gm_slider1		control[16]</span>
<span class="cp">#define gm_slider2		control[17]</span>
<span class="cp">#define gm_slider3		control[18]</span>
<span class="cp">#define gm_slider4		control[19]</span>

<span class="cp">#define gm_bank_select_lsb	control[32]</span>
<span class="cp">#define gm_modulation_wheel_lsb	control[33]</span>
<span class="cp">#define gm_breath_lsb		control[34]</span>
<span class="cp">#define gm_foot_pedal_lsb	control[36]</span>
<span class="cp">#define gm_portamento_time_lsb	control[37]</span>
<span class="cp">#define gm_data_entry_lsb	control[38]</span>
<span class="cp">#define gm_volume_lsb		control[39]</span>
<span class="cp">#define gm_balance_lsb		control[40]</span>
<span class="cp">#define gm_pan_lsb		control[42]</span>
<span class="cp">#define gm_expression_lsb	control[43]</span>
<span class="cp">#define gm_effect_control1_lsb	control[44]</span>
<span class="cp">#define gm_effect_control2_lsb	control[45]</span>

<span class="cp">#define gm_sustain	 	control[MIDI_CTL_SUSTAIN]</span>
<span class="cp">#define gm_hold			gm_sustain</span>
<span class="cp">#define gm_portamento		control[MIDI_CTL_PORTAMENTO]</span>
<span class="cp">#define gm_sostenuto		control[MIDI_CTL_SOSTENUTO]</span>

<span class="cm">/*</span>
<span class="cm"> * These macros give the complete value of the controls that consist</span>
<span class="cm"> * of coarse and fine pairs.  Of course the fine controls are seldom used</span>
<span class="cm"> * but there is no harm in being complete.</span>
<span class="cm"> */</span>
<span class="cp">#define SNDRV_GM_BANK_SELECT(cp)		(((cp)-&gt;control[0]&lt;&lt;7)|((cp)-&gt;control[32]))</span>
<span class="cp">#define SNDRV_GM_MODULATION_WHEEL(cp)	(((cp)-&gt;control[1]&lt;&lt;7)|((cp)-&gt;control[33]))</span>
<span class="cp">#define SNDRV_GM_BREATH(cp)		(((cp)-&gt;control[2]&lt;&lt;7)|((cp)-&gt;control[34]))</span>
<span class="cp">#define SNDRV_GM_FOOT_PEDAL(cp)		(((cp)-&gt;control[4]&lt;&lt;7)|((cp)-&gt;control[36]))</span>
<span class="cp">#define SNDRV_GM_PORTAMENTO_TIME(cp)	(((cp)-&gt;control[5]&lt;&lt;7)|((cp)-&gt;control[37]))</span>
<span class="cp">#define SNDRV_GM_DATA_ENTRY(cp)		(((cp)-&gt;control[6]&lt;&lt;7)|((cp)-&gt;control[38]))</span>
<span class="cp">#define SNDRV_GM_VOLUME(cp)		(((cp)-&gt;control[7]&lt;&lt;7)|((cp)-&gt;control[39]))</span>
<span class="cp">#define SNDRV_GM_BALANCE(cp)		(((cp)-&gt;control[8]&lt;&lt;7)|((cp)-&gt;control[40]))</span>
<span class="cp">#define SNDRV_GM_PAN(cp)			(((cp)-&gt;control[10]&lt;&lt;7)|((cp)-&gt;control[42]))</span>
<span class="cp">#define SNDRV_GM_EXPRESSION(cp)		(((cp)-&gt;control[11]&lt;&lt;7)|((cp)-&gt;control[43]))</span>


<span class="cm">/* MIDI mode */</span>
<span class="cp">#define SNDRV_MIDI_MODE_NONE	0	</span><span class="cm">/* Generic midi */</span><span class="cp"></span>
<span class="cp">#define SNDRV_MIDI_MODE_GM	1</span>
<span class="cp">#define SNDRV_MIDI_MODE_GS	2</span>
<span class="cp">#define SNDRV_MIDI_MODE_XG	3</span>
<span class="cp">#define SNDRV_MIDI_MODE_MT32	4</span>

<span class="cm">/* MIDI note state */</span>
<span class="cp">#define SNDRV_MIDI_NOTE_OFF		0x00</span>
<span class="cp">#define SNDRV_MIDI_NOTE_ON		0x01</span>
<span class="cp">#define SNDRV_MIDI_NOTE_RELEASED		0x02</span>
<span class="cp">#define SNDRV_MIDI_NOTE_SOSTENUTO		0x04</span>
 
<span class="cp">#define SNDRV_MIDI_PARAM_TYPE_REGISTERED		0</span>
<span class="cp">#define SNDRV_MIDI_PARAM_TYPE_NONREGISTERED	1</span>

<span class="cm">/* SYSEX parse flag */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">SNDRV_MIDI_SYSEX_NOT_PARSED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SNDRV_MIDI_SYSEX_GM_ON</span><span class="p">,</span>	
	<span class="n">SNDRV_MIDI_SYSEX_GS_ON</span><span class="p">,</span>	
	<span class="n">SNDRV_MIDI_SYSEX_GS_RESET</span><span class="p">,</span>	
	<span class="n">SNDRV_MIDI_SYSEX_GS_CHORUS_MODE</span><span class="p">,</span>
	<span class="n">SNDRV_MIDI_SYSEX_GS_REVERB_MODE</span><span class="p">,</span>
	<span class="n">SNDRV_MIDI_SYSEX_GS_MASTER_VOLUME</span><span class="p">,</span>
	<span class="n">SNDRV_MIDI_SYSEX_GS_PROGRAM</span><span class="p">,</span>
	<span class="n">SNDRV_MIDI_SYSEX_GS_DRUM_CHANNEL</span><span class="p">,</span>
	<span class="n">SNDRV_MIDI_SYSEX_XG_ON</span><span class="p">,</span>	
<span class="p">};</span>

<span class="cm">/* Prototypes for midi_process.c */</span>
<span class="kt">void</span> <span class="n">snd_midi_process_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_midi_op</span> <span class="o">*</span><span class="n">ops</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_seq_event</span> <span class="o">*</span><span class="n">ev</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span><span class="n">chanset</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_midi_channel_set_clear</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span><span class="n">chset</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span><span class="n">snd_midi_channel_alloc_set</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_midi_channel_free_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span><span class="n">chset</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __SOUND_SEQ_MIDI_EMUL_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
