<!DOCTYPE html>
<html><head><title>joekychen/linux » include › sound › mpu401.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>mpu401.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __SOUND_MPU401_H</span>
<span class="cp">#define __SOUND_MPU401_H</span>

<span class="cm">/*</span>
<span class="cm"> *  Header file for MPU-401 and compatible cards</span>
<span class="cm"> *  Copyright (c) by Jaroslav Kysela &lt;perex@perex.cz&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;rawmidi.h&quot;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>

<span class="cp">#define MPU401_HW_MPU401		1	</span><span class="cm">/* native MPU401 */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_SB			2	</span><span class="cm">/* SoundBlaster MPU-401 UART */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_ES1688		3	</span><span class="cm">/* AudioDrive ES1688 MPU-401 UART */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_OPL3SA2		4	</span><span class="cm">/* Yamaha OPL3-SA2 */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_SONICVIBES		5	</span><span class="cm">/* S3 SonicVibes */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_CS4232		6	</span><span class="cm">/* CS4232 */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_ES18XX		7	</span><span class="cm">/* AudioDrive ES18XX MPU-401 UART */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_FM801			8	</span><span class="cm">/* ForteMedia FM801 */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_TRID4DWAVE		9	</span><span class="cm">/* Trident 4DWave */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_AZT2320		10	</span><span class="cm">/* Aztech AZT2320 */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_ALS100		11	</span><span class="cm">/* Avance Logic ALS100 */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_ICE1712		12	</span><span class="cm">/* Envy24 */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_VIA686A		13	</span><span class="cm">/* VIA 82C686A */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_YMFPCI		14	</span><span class="cm">/* YMF DS-XG PCI */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_CMIPCI		15	</span><span class="cm">/* CMIPCI MPU-401 UART */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_ALS4000		16	</span><span class="cm">/* Avance Logic ALS4000 */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_INTEL8X0		17	</span><span class="cm">/* Intel8x0 driver */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_PC98II		18	</span><span class="cm">/* Roland PC98II */</span><span class="cp"></span>
<span class="cp">#define MPU401_HW_AUREAL		19	</span><span class="cm">/* Aureal Vortex */</span><span class="cp"></span>

<span class="cp">#define MPU401_INFO_INPUT	(1 &lt;&lt; 0)	</span><span class="cm">/* input stream */</span><span class="cp"></span>
<span class="cp">#define MPU401_INFO_OUTPUT	(1 &lt;&lt; 1)	</span><span class="cm">/* output stream */</span><span class="cp"></span>
<span class="cp">#define MPU401_INFO_INTEGRATED	(1 &lt;&lt; 2)	</span><span class="cm">/* integrated h/w port */</span><span class="cp"></span>
<span class="cp">#define MPU401_INFO_MMIO	(1 &lt;&lt; 3)	</span><span class="cm">/* MMIO access */</span><span class="cp"></span>
<span class="cp">#define MPU401_INFO_TX_IRQ	(1 &lt;&lt; 4)	</span><span class="cm">/* independent TX irq */</span><span class="cp"></span>
<span class="cp">#define MPU401_INFO_IRQ_HOOK	(1 &lt;&lt; 5)	</span><span class="cm">/* mpu401 irq handler is called</span>
<span class="cm">						   from driver irq handler */</span><span class="cp"></span>
<span class="cp">#define MPU401_INFO_NO_ACK	(1 &lt;&lt; 6)	</span><span class="cm">/* No ACK cmd needed */</span><span class="cp"></span>
<span class="cp">#define MPU401_INFO_USE_TIMER	(1 &lt;&lt; 15)	</span><span class="cm">/* internal */</span><span class="cp"></span>

<span class="cp">#define MPU401_MODE_BIT_INPUT		0</span>
<span class="cp">#define MPU401_MODE_BIT_OUTPUT		1</span>
<span class="cp">#define MPU401_MODE_BIT_INPUT_TRIGGER	2</span>
<span class="cp">#define MPU401_MODE_BIT_OUTPUT_TRIGGER	3</span>

<span class="cp">#define MPU401_MODE_INPUT		(1&lt;&lt;MPU401_MODE_BIT_INPUT)</span>
<span class="cp">#define MPU401_MODE_OUTPUT		(1&lt;&lt;MPU401_MODE_BIT_OUTPUT)</span>
<span class="cp">#define MPU401_MODE_INPUT_TRIGGER	(1&lt;&lt;MPU401_MODE_BIT_INPUT_TRIGGER)</span>
<span class="cp">#define MPU401_MODE_OUTPUT_TRIGGER	(1&lt;&lt;MPU401_MODE_BIT_OUTPUT_TRIGGER)</span>

<span class="cp">#define MPU401_MODE_INPUT_TIMER		(1&lt;&lt;0)</span>
<span class="cp">#define MPU401_MODE_OUTPUT_TIMER	(1&lt;&lt;1)</span>

<span class="k">struct</span> <span class="n">snd_mpu401</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_rawmidi</span> <span class="o">*</span><span class="n">rmidi</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">hardware</span><span class="p">;</span>	<span class="cm">/* MPU401_HW_XXXX */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">info_flags</span><span class="p">;</span>	<span class="cm">/* MPU401_INFO_XXX */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">;</span>		<span class="cm">/* base port of MPU-401 chip */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cport</span><span class="p">;</span>		<span class="cm">/* port + 1 (usually) */</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">res</span><span class="p">;</span>		<span class="cm">/* port resource */</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>			<span class="cm">/* IRQ number of MPU-401 chip */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mode</span><span class="p">;</span>		<span class="cm">/* MPU401_MODE_XXXX */</span>
	<span class="kt">int</span> <span class="n">timer_invoked</span><span class="p">;</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">open_input</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_mpu401</span> <span class="o">*</span> <span class="n">mpu</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">close_input</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_mpu401</span> <span class="o">*</span> <span class="n">mpu</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">open_output</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_mpu401</span> <span class="o">*</span> <span class="n">mpu</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">close_output</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_mpu401</span> <span class="o">*</span> <span class="n">mpu</span><span class="p">);</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_rawmidi_substream</span> <span class="o">*</span><span class="n">substream_input</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_rawmidi_substream</span> <span class="o">*</span><span class="n">substream_output</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">input_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">output_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">timer_lock</span><span class="p">;</span>
	
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">timer</span><span class="p">;</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">write</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_mpu401</span> <span class="o">*</span> <span class="n">mpu</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="p">(</span><span class="o">*</span><span class="n">read</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_mpu401</span> <span class="o">*</span><span class="n">mpu</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* I/O ports */</span>

<span class="cp">#define MPU401C(mpu) (mpu)-&gt;cport</span>
<span class="cp">#define MPU401D(mpu) (mpu)-&gt;port</span>

<span class="cm">/*</span>
<span class="cm"> * control register bits</span>
<span class="cm"> */</span>
<span class="cm">/* read MPU401C() */</span>
<span class="cp">#define MPU401_RX_EMPTY		0x80</span>
<span class="cp">#define MPU401_TX_FULL		0x40</span>

<span class="cm">/* write MPU401C() */</span>
<span class="cp">#define MPU401_RESET		0xff</span>
<span class="cp">#define MPU401_ENTER_UART	0x3f</span>

<span class="cm">/* read MPU401D() */</span>
<span class="cp">#define MPU401_ACK		0xfe</span>


<span class="cm">/*</span>

<span class="cm"> */</span>

<span class="n">irqreturn_t</span> <span class="n">snd_mpu401_uart_interrupt</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dev_id</span><span class="p">);</span>
<span class="n">irqreturn_t</span> <span class="n">snd_mpu401_uart_interrupt_tx</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dev_id</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">snd_mpu401_uart_new</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">device</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">hardware</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">info_flags</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">irq</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">snd_rawmidi</span> <span class="o">**</span> <span class="n">rrawmidi</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __SOUND_MPU401_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
