<!DOCTYPE html>
<html><head><title>joekychen/linux » include › sound › compress_offload.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>compress_offload.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  compress_offload.h - compress offload header definations</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 2011 Intel Corporation</span>
<span class="cm"> *  Authors:	Vinod Koul &lt;vinod.koul@linux.intel.com&gt;</span>
<span class="cm"> *		Pierre-Louis Bossart &lt;pierre-louis.bossart@linux.intel.com&gt;</span>
<span class="cm"> *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; version 2 of the License.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> *  WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> *  General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License along</span>
<span class="cm"> *  with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.</span>
<span class="cm"> *</span>
<span class="cm"> * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __COMPRESS_OFFLOAD_H</span>
<span class="cp">#define __COMPRESS_OFFLOAD_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;sound/asound.h&gt;</span>
<span class="cp">#include &lt;sound/compress_params.h&gt;</span>


<span class="cp">#define SNDRV_COMPRESS_VERSION SNDRV_PROTOCOL_VERSION(0, 1, 0)</span>
<span class="cm">/**</span>
<span class="cm"> * struct snd_compressed_buffer: compressed buffer</span>
<span class="cm"> * @fragment_size: size of buffer fragment in bytes</span>
<span class="cm"> * @fragments: number of such fragments</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_compressed_buffer</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">fragment_size</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">fragments</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct snd_compr_params: compressed stream params</span>
<span class="cm"> * @buffer: buffer description</span>
<span class="cm"> * @codec: codec parameters</span>
<span class="cm"> * @no_wake_mode: dont wake on fragment elapsed</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_compr_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_compressed_buffer</span> <span class="n">buffer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_codec</span> <span class="n">codec</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">no_wake_mode</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct snd_compr_tstamp: timestamp descriptor</span>
<span class="cm"> * @byte_offset: Byte offset in ring buffer to DSP</span>
<span class="cm"> * @copied_total: Total number of bytes copied from/to ring buffer to/by DSP</span>
<span class="cm"> * @pcm_frames: Frames decoded or encoded by DSP. This field will evolve by</span>
<span class="cm"> *	large steps and should only be used to monitor encoding/decoding</span>
<span class="cm"> *	progress. It shall not be used for timing estimates.</span>
<span class="cm"> * @pcm_io_frames: Frames rendered or received by DSP into a mixer or an audio</span>
<span class="cm"> * output/input. This field should be used for A/V sync or time estimates.</span>
<span class="cm"> * @sampling_rate: sampling rate of audio</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_compr_tstamp</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">byte_offset</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">copied_total</span><span class="p">;</span>
	<span class="n">snd_pcm_uframes_t</span> <span class="n">pcm_frames</span><span class="p">;</span>
	<span class="n">snd_pcm_uframes_t</span> <span class="n">pcm_io_frames</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">sampling_rate</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct snd_compr_avail: avail descriptor</span>
<span class="cm"> * @avail: Number of bytes available in ring buffer for writing/reading</span>
<span class="cm"> * @tstamp: timestamp infomation</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_compr_avail</span> <span class="p">{</span>
	<span class="n">__u64</span> <span class="n">avail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_compr_tstamp</span> <span class="n">tstamp</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">snd_compr_direction</span> <span class="p">{</span>
	<span class="n">SND_COMPRESS_PLAYBACK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SND_COMPRESS_CAPTURE</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct snd_compr_caps: caps descriptor</span>
<span class="cm"> * @codecs: pointer to array of codecs</span>
<span class="cm"> * @direction: direction supported. Of type snd_compr_direction</span>
<span class="cm"> * @min_fragment_size: minimum fragment supported by DSP</span>
<span class="cm"> * @max_fragment_size: maximum fragment supported by DSP</span>
<span class="cm"> * @min_fragments: min fragments supported by DSP</span>
<span class="cm"> * @max_fragments: max fragments supported by DSP</span>
<span class="cm"> * @num_codecs: number of codecs supported</span>
<span class="cm"> * @reserved: reserved field</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_compr_caps</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">num_codecs</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">direction</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">min_fragment_size</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">max_fragment_size</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">min_fragments</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">max_fragments</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">codecs</span><span class="p">[</span><span class="n">MAX_NUM_CODECS</span><span class="p">];</span>
	<span class="n">__u32</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct snd_compr_codec_caps: query capability of codec</span>
<span class="cm"> * @codec: codec for which capability is queried</span>
<span class="cm"> * @num_descriptors: number of codec descriptors</span>
<span class="cm"> * @descriptor: array of codec capability descriptor</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_compr_codec_caps</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">codec</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">num_descriptors</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_codec_desc</span> <span class="n">descriptor</span><span class="p">[</span><span class="n">MAX_NUM_CODEC_DESCRIPTORS</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * compress path ioctl definitions</span>
<span class="cm"> * SNDRV_COMPRESS_GET_CAPS: Query capability of DSP</span>
<span class="cm"> * SNDRV_COMPRESS_GET_CODEC_CAPS: Query capability of a codec</span>
<span class="cm"> * SNDRV_COMPRESS_SET_PARAMS: Set codec and stream parameters</span>
<span class="cm"> * Note: only codec params can be changed runtime and stream params cant be</span>
<span class="cm"> * SNDRV_COMPRESS_GET_PARAMS: Query codec params</span>
<span class="cm"> * SNDRV_COMPRESS_TSTAMP: get the current timestamp value</span>
<span class="cm"> * SNDRV_COMPRESS_AVAIL: get the current buffer avail value.</span>
<span class="cm"> * This also queries the tstamp properties</span>
<span class="cm"> * SNDRV_COMPRESS_PAUSE: Pause the running stream</span>
<span class="cm"> * SNDRV_COMPRESS_RESUME: resume a paused stream</span>
<span class="cm"> * SNDRV_COMPRESS_START: Start a stream</span>
<span class="cm"> * SNDRV_COMPRESS_STOP: stop a running stream, discarding ring buffer content</span>
<span class="cm"> * and the buffers currently with DSP</span>
<span class="cm"> * SNDRV_COMPRESS_DRAIN: Play till end of buffers and stop after that</span>
<span class="cm"> * SNDRV_COMPRESS_IOCTL_VERSION: Query the API version</span>
<span class="cm"> */</span>
<span class="cp">#define SNDRV_COMPRESS_IOCTL_VERSION	_IOR(&#39;C&#39;, 0x00, int)</span>
<span class="cp">#define SNDRV_COMPRESS_GET_CAPS		_IOWR(&#39;C&#39;, 0x10, struct snd_compr_caps)</span>
<span class="cp">#define SNDRV_COMPRESS_GET_CODEC_CAPS	_IOWR(&#39;C&#39;, 0x11,\</span>
<span class="cp">						struct snd_compr_codec_caps)</span>
<span class="cp">#define SNDRV_COMPRESS_SET_PARAMS	_IOW(&#39;C&#39;, 0x12, struct snd_compr_params)</span>
<span class="cp">#define SNDRV_COMPRESS_GET_PARAMS	_IOR(&#39;C&#39;, 0x13, struct snd_codec)</span>
<span class="cp">#define SNDRV_COMPRESS_TSTAMP		_IOR(&#39;C&#39;, 0x20, struct snd_compr_tstamp)</span>
<span class="cp">#define SNDRV_COMPRESS_AVAIL		_IOR(&#39;C&#39;, 0x21, struct snd_compr_avail)</span>
<span class="cp">#define SNDRV_COMPRESS_PAUSE		_IO(&#39;C&#39;, 0x30)</span>
<span class="cp">#define SNDRV_COMPRESS_RESUME		_IO(&#39;C&#39;, 0x31)</span>
<span class="cp">#define SNDRV_COMPRESS_START		_IO(&#39;C&#39;, 0x32)</span>
<span class="cp">#define SNDRV_COMPRESS_STOP		_IO(&#39;C&#39;, 0x33)</span>
<span class="cp">#define SNDRV_COMPRESS_DRAIN		_IO(&#39;C&#39;, 0x34)</span>
<span class="cm">/*</span>
<span class="cm"> * TODO</span>
<span class="cm"> * 1. add mmap support</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#define SND_COMPR_TRIGGER_DRAIN 7 </span><span class="cm">/*FIXME move this to pcm.h */</span><span class="cp"></span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
