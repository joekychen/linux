<!DOCTYPE html>
<html><head><title>joekychen/linux » include › sound › ymfpci.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>ymfpci.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __SOUND_YMFPCI_H</span>
<span class="cp">#define __SOUND_YMFPCI_H</span>

<span class="cm">/*</span>
<span class="cm"> *  Copyright (c) by Jaroslav Kysela &lt;perex@perex.cz&gt;</span>
<span class="cm"> *  Definitions for Yahama YMF724/740/744/754 chips</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;pcm.h&quot;</span>
<span class="cp">#include &quot;rawmidi.h&quot;</span>
<span class="cp">#include &quot;ac97_codec.h&quot;</span>
<span class="cp">#include &quot;timer.h&quot;</span>
<span class="cp">#include &lt;linux/gameport.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> *  Direct registers</span>
<span class="cm"> */</span>

<span class="cp">#define YMFREG(chip, reg)		(chip-&gt;port + YDSXGR_##reg)</span>

<span class="cp">#define	YDSXGR_INTFLAG			0x0004</span>
<span class="cp">#define	YDSXGR_ACTIVITY			0x0006</span>
<span class="cp">#define	YDSXGR_GLOBALCTRL		0x0008</span>
<span class="cp">#define	YDSXGR_ZVCTRL			0x000A</span>
<span class="cp">#define	YDSXGR_TIMERCTRL		0x0010</span>
<span class="cp">#define	YDSXGR_TIMERCOUNT		0x0012</span>
<span class="cp">#define	YDSXGR_SPDIFOUTCTRL		0x0018</span>
<span class="cp">#define	YDSXGR_SPDIFOUTSTATUS		0x001C</span>
<span class="cp">#define	YDSXGR_EEPROMCTRL		0x0020</span>
<span class="cp">#define	YDSXGR_SPDIFINCTRL		0x0034</span>
<span class="cp">#define	YDSXGR_SPDIFINSTATUS		0x0038</span>
<span class="cp">#define	YDSXGR_DSPPROGRAMDL		0x0048</span>
<span class="cp">#define	YDSXGR_DLCNTRL			0x004C</span>
<span class="cp">#define	YDSXGR_GPIOININTFLAG		0x0050</span>
<span class="cp">#define	YDSXGR_GPIOININTENABLE		0x0052</span>
<span class="cp">#define	YDSXGR_GPIOINSTATUS		0x0054</span>
<span class="cp">#define	YDSXGR_GPIOOUTCTRL		0x0056</span>
<span class="cp">#define	YDSXGR_GPIOFUNCENABLE		0x0058</span>
<span class="cp">#define	YDSXGR_GPIOTYPECONFIG		0x005A</span>
<span class="cp">#define	YDSXGR_AC97CMDDATA		0x0060</span>
<span class="cp">#define	YDSXGR_AC97CMDADR		0x0062</span>
<span class="cp">#define	YDSXGR_PRISTATUSDATA		0x0064</span>
<span class="cp">#define	YDSXGR_PRISTATUSADR		0x0066</span>
<span class="cp">#define	YDSXGR_SECSTATUSDATA		0x0068</span>
<span class="cp">#define	YDSXGR_SECSTATUSADR		0x006A</span>
<span class="cp">#define	YDSXGR_SECCONFIG		0x0070</span>
<span class="cp">#define	YDSXGR_LEGACYOUTVOL		0x0080</span>
<span class="cp">#define	YDSXGR_LEGACYOUTVOLL		0x0080</span>
<span class="cp">#define	YDSXGR_LEGACYOUTVOLR		0x0082</span>
<span class="cp">#define	YDSXGR_NATIVEDACOUTVOL		0x0084</span>
<span class="cp">#define	YDSXGR_NATIVEDACOUTVOLL		0x0084</span>
<span class="cp">#define	YDSXGR_NATIVEDACOUTVOLR		0x0086</span>
<span class="cp">#define	YDSXGR_ZVOUTVOL			0x0088</span>
<span class="cp">#define	YDSXGR_ZVOUTVOLL		0x0088</span>
<span class="cp">#define	YDSXGR_ZVOUTVOLR		0x008A</span>
<span class="cp">#define	YDSXGR_SECADCOUTVOL		0x008C</span>
<span class="cp">#define	YDSXGR_SECADCOUTVOLL		0x008C</span>
<span class="cp">#define	YDSXGR_SECADCOUTVOLR		0x008E</span>
<span class="cp">#define	YDSXGR_PRIADCOUTVOL		0x0090</span>
<span class="cp">#define	YDSXGR_PRIADCOUTVOLL		0x0090</span>
<span class="cp">#define	YDSXGR_PRIADCOUTVOLR		0x0092</span>
<span class="cp">#define	YDSXGR_LEGACYLOOPVOL		0x0094</span>
<span class="cp">#define	YDSXGR_LEGACYLOOPVOLL		0x0094</span>
<span class="cp">#define	YDSXGR_LEGACYLOOPVOLR		0x0096</span>
<span class="cp">#define	YDSXGR_NATIVEDACLOOPVOL		0x0098</span>
<span class="cp">#define	YDSXGR_NATIVEDACLOOPVOLL	0x0098</span>
<span class="cp">#define	YDSXGR_NATIVEDACLOOPVOLR	0x009A</span>
<span class="cp">#define	YDSXGR_ZVLOOPVOL		0x009C</span>
<span class="cp">#define	YDSXGR_ZVLOOPVOLL		0x009E</span>
<span class="cp">#define	YDSXGR_ZVLOOPVOLR		0x009E</span>
<span class="cp">#define	YDSXGR_SECADCLOOPVOL		0x00A0</span>
<span class="cp">#define	YDSXGR_SECADCLOOPVOLL		0x00A0</span>
<span class="cp">#define	YDSXGR_SECADCLOOPVOLR		0x00A2</span>
<span class="cp">#define	YDSXGR_PRIADCLOOPVOL		0x00A4</span>
<span class="cp">#define	YDSXGR_PRIADCLOOPVOLL		0x00A4</span>
<span class="cp">#define	YDSXGR_PRIADCLOOPVOLR		0x00A6</span>
<span class="cp">#define	YDSXGR_NATIVEADCINVOL		0x00A8</span>
<span class="cp">#define	YDSXGR_NATIVEADCINVOLL		0x00A8</span>
<span class="cp">#define	YDSXGR_NATIVEADCINVOLR		0x00AA</span>
<span class="cp">#define	YDSXGR_NATIVEDACINVOL		0x00AC</span>
<span class="cp">#define	YDSXGR_NATIVEDACINVOLL		0x00AC</span>
<span class="cp">#define	YDSXGR_NATIVEDACINVOLR		0x00AE</span>
<span class="cp">#define	YDSXGR_BUF441OUTVOL		0x00B0</span>
<span class="cp">#define	YDSXGR_BUF441OUTVOLL		0x00B0</span>
<span class="cp">#define	YDSXGR_BUF441OUTVOLR		0x00B2</span>
<span class="cp">#define	YDSXGR_BUF441LOOPVOL		0x00B4</span>
<span class="cp">#define	YDSXGR_BUF441LOOPVOLL		0x00B4</span>
<span class="cp">#define	YDSXGR_BUF441LOOPVOLR		0x00B6</span>
<span class="cp">#define	YDSXGR_SPDIFOUTVOL		0x00B8</span>
<span class="cp">#define	YDSXGR_SPDIFOUTVOLL		0x00B8</span>
<span class="cp">#define	YDSXGR_SPDIFOUTVOLR		0x00BA</span>
<span class="cp">#define	YDSXGR_SPDIFLOOPVOL		0x00BC</span>
<span class="cp">#define	YDSXGR_SPDIFLOOPVOLL		0x00BC</span>
<span class="cp">#define	YDSXGR_SPDIFLOOPVOLR		0x00BE</span>
<span class="cp">#define	YDSXGR_ADCSLOTSR		0x00C0</span>
<span class="cp">#define	YDSXGR_RECSLOTSR		0x00C4</span>
<span class="cp">#define	YDSXGR_ADCFORMAT		0x00C8</span>
<span class="cp">#define	YDSXGR_RECFORMAT		0x00CC</span>
<span class="cp">#define	YDSXGR_P44SLOTSR		0x00D0</span>
<span class="cp">#define	YDSXGR_STATUS			0x0100</span>
<span class="cp">#define	YDSXGR_CTRLSELECT		0x0104</span>
<span class="cp">#define	YDSXGR_MODE			0x0108</span>
<span class="cp">#define	YDSXGR_SAMPLECOUNT		0x010C</span>
<span class="cp">#define	YDSXGR_NUMOFSAMPLES		0x0110</span>
<span class="cp">#define	YDSXGR_CONFIG			0x0114</span>
<span class="cp">#define	YDSXGR_PLAYCTRLSIZE		0x0140</span>
<span class="cp">#define	YDSXGR_RECCTRLSIZE		0x0144</span>
<span class="cp">#define	YDSXGR_EFFCTRLSIZE		0x0148</span>
<span class="cp">#define	YDSXGR_WORKSIZE			0x014C</span>
<span class="cp">#define	YDSXGR_MAPOFREC			0x0150</span>
<span class="cp">#define	YDSXGR_MAPOFEFFECT		0x0154</span>
<span class="cp">#define	YDSXGR_PLAYCTRLBASE		0x0158</span>
<span class="cp">#define	YDSXGR_RECCTRLBASE		0x015C</span>
<span class="cp">#define	YDSXGR_EFFCTRLBASE		0x0160</span>
<span class="cp">#define	YDSXGR_WORKBASE			0x0164</span>
<span class="cp">#define	YDSXGR_DSPINSTRAM		0x1000</span>
<span class="cp">#define	YDSXGR_CTRLINSTRAM		0x4000</span>

<span class="cp">#define YDSXG_AC97READCMD		0x8000</span>
<span class="cp">#define YDSXG_AC97WRITECMD		0x0000</span>

<span class="cp">#define PCIR_DSXG_LEGACY		0x40</span>
<span class="cp">#define PCIR_DSXG_ELEGACY		0x42</span>
<span class="cp">#define PCIR_DSXG_CTRL			0x48</span>
<span class="cp">#define PCIR_DSXG_PWRCTRL1		0x4a</span>
<span class="cp">#define PCIR_DSXG_PWRCTRL2		0x4e</span>
<span class="cp">#define PCIR_DSXG_FMBASE		0x60</span>
<span class="cp">#define PCIR_DSXG_SBBASE		0x62</span>
<span class="cp">#define PCIR_DSXG_MPU401BASE		0x64</span>
<span class="cp">#define PCIR_DSXG_JOYBASE		0x66</span>

<span class="cp">#define YDSXG_DSPLENGTH			0x0080</span>
<span class="cp">#define YDSXG_CTRLLENGTH		0x3000</span>

<span class="cp">#define YDSXG_DEFAULT_WORK_SIZE		0x0400</span>

<span class="cp">#define YDSXG_PLAYBACK_VOICES		64</span>
<span class="cp">#define YDSXG_CAPTURE_VOICES		2</span>
<span class="cp">#define YDSXG_EFFECT_VOICES		5</span>

<span class="cp">#define YMFPCI_LEGACY_SBEN	(1 &lt;&lt; 0)	</span><span class="cm">/* soundblaster enable */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY_FMEN	(1 &lt;&lt; 1)	</span><span class="cm">/* OPL3 enable */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY_JPEN	(1 &lt;&lt; 2)	</span><span class="cm">/* joystick enable */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY_MEN	(1 &lt;&lt; 3)	</span><span class="cm">/* MPU401 enable */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY_MIEN	(1 &lt;&lt; 4)	</span><span class="cm">/* MPU RX irq enable */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY_IOBITS	(1 &lt;&lt; 5)	</span><span class="cm">/* i/o bits range, 0 = 16bit, 1 =10bit */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY_SDMA	(3 &lt;&lt; 6)	</span><span class="cm">/* SB DMA select */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY_SBIRQ	(7 &lt;&lt; 8)	</span><span class="cm">/* SB IRQ select */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY_MPUIRQ	(7 &lt;&lt; 11)	</span><span class="cm">/* MPU IRQ select */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY_SIEN	(1 &lt;&lt; 14)	</span><span class="cm">/* serialized IRQ */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY_LAD	(1 &lt;&lt; 15)	</span><span class="cm">/* legacy audio disable */</span><span class="cp"></span>

<span class="cp">#define YMFPCI_LEGACY2_FMIO	(3 &lt;&lt; 0)	</span><span class="cm">/* OPL3 i/o address (724/740) */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY2_SBIO	(3 &lt;&lt; 2)	</span><span class="cm">/* SB i/o address (724/740) */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY2_MPUIO	(3 &lt;&lt; 4)	</span><span class="cm">/* MPU401 i/o address (724/740) */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY2_JSIO	(3 &lt;&lt; 6)	</span><span class="cm">/* joystick i/o address (724/740) */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY2_MAIM	(1 &lt;&lt; 8)	</span><span class="cm">/* MPU401 ack intr mask */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY2_SMOD	(3 &lt;&lt; 11)	</span><span class="cm">/* SB DMA mode */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY2_SBVER	(3 &lt;&lt; 13)	</span><span class="cm">/* SB version select */</span><span class="cp"></span>
<span class="cp">#define YMFPCI_LEGACY2_IMOD	(1 &lt;&lt; 15)	</span><span class="cm">/* legacy IRQ mode */</span><span class="cp"></span>
<span class="cm">/* SIEN:IMOD 0:0 = legacy irq, 0:1 = INTA, 1:0 = serialized IRQ */</span>

<span class="cp">#if defined(CONFIG_GAMEPORT) || (defined(MODULE) &amp;&amp; defined(CONFIG_GAMEPORT_MODULE))</span>
<span class="cp">#define SUPPORT_JOYSTICK</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">snd_ymfpci_playback_bank</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">format</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">loop_default</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">base</span><span class="p">;</span>			<span class="cm">/* 32-bit address */</span>
	<span class="n">u32</span> <span class="n">loop_start</span><span class="p">;</span>			<span class="cm">/* 32-bit offset */</span>
	<span class="n">u32</span> <span class="n">loop_end</span><span class="p">;</span>			<span class="cm">/* 32-bit offset */</span>
	<span class="n">u32</span> <span class="n">loop_frac</span><span class="p">;</span>			<span class="cm">/* 8-bit fraction - loop_start */</span>
	<span class="n">u32</span> <span class="n">delta_end</span><span class="p">;</span>			<span class="cm">/* pitch delta end */</span>
	<span class="n">u32</span> <span class="n">lpfK_end</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">eg_gain_end</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">left_gain_end</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">right_gain_end</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">eff1_gain_end</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">eff2_gain_end</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">eff3_gain_end</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lpfQ</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">num_of_frames</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">loop_count</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">start</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">start_frac</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">delta</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lpfK</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">eg_gain</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">left_gain</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">right_gain</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">eff1_gain</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">eff2_gain</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">eff3_gain</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lpfD1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lpfD2</span><span class="p">;</span>
 <span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_ymfpci_capture_bank</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">base</span><span class="p">;</span>			<span class="cm">/* 32-bit address */</span>
	<span class="n">u32</span> <span class="n">loop_end</span><span class="p">;</span>			<span class="cm">/* 32-bit offset */</span>
	<span class="n">u32</span> <span class="n">start</span><span class="p">;</span>			<span class="cm">/* 32-bit offset */</span>
	<span class="n">u32</span> <span class="n">num_of_loops</span><span class="p">;</span>		<span class="cm">/* counter */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_ymfpci_effect_bank</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">base</span><span class="p">;</span>			<span class="cm">/* 32-bit address */</span>
	<span class="n">u32</span> <span class="n">loop_end</span><span class="p">;</span>			<span class="cm">/* 32-bit offset */</span>
	<span class="n">u32</span> <span class="n">start</span><span class="p">;</span>			<span class="cm">/* 32-bit offset */</span>
	<span class="n">u32</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_ymfpci_pcm</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">snd_ymfpci</span><span class="p">;</span>

<span class="k">enum</span> <span class="n">snd_ymfpci_voice_type</span> <span class="p">{</span>
	<span class="n">YMFPCI_PCM</span><span class="p">,</span>
	<span class="n">YMFPCI_SYNTH</span><span class="p">,</span>
	<span class="n">YMFPCI_MIDI</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_ymfpci_voice</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">*</span><span class="n">chip</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">number</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">use</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
	    <span class="nl">pcm:</span> <span class="mi">1</span><span class="p">,</span>
	    <span class="nl">synth:</span> <span class="mi">1</span><span class="p">,</span>
	    <span class="nl">midi:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_ymfpci_playback_bank</span> <span class="o">*</span><span class="n">bank</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">bank_addr</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">interrupt</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">*</span><span class="n">chip</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ymfpci_voice</span> <span class="o">*</span><span class="n">voice</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_ymfpci_pcm</span> <span class="o">*</span><span class="n">ypcm</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">snd_ymfpci_pcm_type</span> <span class="p">{</span>
	<span class="n">PLAYBACK_VOICE</span><span class="p">,</span>
	<span class="n">CAPTURE_REC</span><span class="p">,</span>
	<span class="n">CAPTURE_AC97</span><span class="p">,</span>
	<span class="n">EFFECT_DRY_LEFT</span><span class="p">,</span>
	<span class="n">EFFECT_DRY_RIGHT</span><span class="p">,</span>
	<span class="n">EFFECT_EFF1</span><span class="p">,</span>
	<span class="n">EFFECT_EFF2</span><span class="p">,</span>
	<span class="n">EFFECT_EFF3</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_ymfpci_pcm</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">*</span><span class="n">chip</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">snd_ymfpci_pcm_type</span> <span class="n">type</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_ymfpci_voice</span> <span class="o">*</span><span class="n">voices</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* playback only */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">running</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		     <span class="nl">use_441_slot:</span> <span class="mi">1</span><span class="p">,</span>
	             <span class="nl">output_front:</span> <span class="mi">1</span><span class="p">,</span>
	             <span class="nl">output_rear:</span> <span class="mi">1</span><span class="p">,</span>
	             <span class="nl">swap_rear:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">update_pcm_vol</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">period_size</span><span class="p">;</span>		<span class="cm">/* cached from runtime-&gt;period_size */</span>
	<span class="n">u32</span> <span class="n">buffer_size</span><span class="p">;</span>		<span class="cm">/* cached from runtime-&gt;buffer_size */</span>
	<span class="n">u32</span> <span class="n">period_pos</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">last_pos</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">capture_bank_number</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">shift</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">device_id</span><span class="p">;</span>	<span class="cm">/* PCI device ID */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">rev</span><span class="p">;</span>	<span class="cm">/* PCI revision */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reg_area_phys</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">reg_area_virt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">res_reg_area</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">fm_res</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">mpu_res</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">old_legacy_ctrl</span><span class="p">;</span>
<span class="cp">#ifdef SUPPORT_JOYSTICK</span>
	<span class="k">struct</span> <span class="n">gameport</span> <span class="o">*</span><span class="n">gameport</span><span class="p">;</span>
<span class="cp">#endif</span>

	<span class="k">struct</span> <span class="n">snd_dma_buffer</span> <span class="n">work_ptr</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bank_size_playback</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bank_size_capture</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bank_size_effect</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">work_size</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">bank_base_playback</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">bank_base_capture</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">bank_base_effect</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">work_base</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">bank_base_playback_addr</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">bank_base_capture_addr</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">bank_base_effect_addr</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">work_base_addr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_dma_buffer</span> <span class="n">ac3_tmp_base</span><span class="p">;</span>

	<span class="n">u32</span> <span class="o">*</span><span class="n">ctrl_playback</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_ymfpci_playback_bank</span> <span class="o">*</span><span class="n">bank_playback</span><span class="p">[</span><span class="n">YDSXG_PLAYBACK_VOICES</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">snd_ymfpci_capture_bank</span> <span class="o">*</span><span class="n">bank_capture</span><span class="p">[</span><span class="n">YDSXG_CAPTURE_VOICES</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">snd_ymfpci_effect_bank</span> <span class="o">*</span><span class="n">bank_effect</span><span class="p">[</span><span class="n">YDSXG_EFFECT_VOICES</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>

	<span class="kt">int</span> <span class="n">start_count</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">active_bank</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_ymfpci_voice</span> <span class="n">voices</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">src441_used</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_ac97_bus</span> <span class="o">*</span><span class="n">ac97_bus</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_ac97</span> <span class="o">*</span><span class="n">ac97</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_rawmidi</span> <span class="o">*</span><span class="n">rawmidi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_timer</span> <span class="o">*</span><span class="n">timer</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">timer_ticks</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">pcm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">pcm2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">pcm_spdif</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">pcm_4ch</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">capture_substream</span><span class="p">[</span><span class="n">YDSXG_CAPTURE_VOICES</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">effect_substream</span><span class="p">[</span><span class="n">YDSXG_EFFECT_VOICES</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">ctl_vol_recsrc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">ctl_vol_adcrec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">ctl_vol_spdifrec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">spdif_bits</span><span class="p">,</span> <span class="n">spdif_pcm_bits</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">spdif_pcm_ctl</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mode_dup4ch</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rear_opened</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">spdif_opened</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_ymfpci_pcm_mixer</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">left</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">right</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">ctl</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pcm_mixer</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

	<span class="n">spinlock_t</span> <span class="n">reg_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">voice_lock</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">interrupt_sleep</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">interrupt_sleep_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_info_entry</span> <span class="o">*</span><span class="n">proc_entry</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">dsp_microcode</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">controller_microcode</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_PM</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">saved_regs</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">saved_ydsxgr_mode</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">saved_dsxg_legacy</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">saved_dsxg_elegacy</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">snd_ymfpci_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span>
		      <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">old_legacy_ctrl</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">**</span> <span class="n">rcodec</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_ymfpci_free_gameport</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">*</span><span class="n">chip</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">snd_ymfpci_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span> <span class="n">pm_message_t</span> <span class="n">state</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_ymfpci_resume</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">snd_ymfpci_pcm</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">*</span><span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">device</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">**</span><span class="n">rpcm</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_ymfpci_pcm2</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">*</span><span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">device</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">**</span><span class="n">rpcm</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_ymfpci_pcm_spdif</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">*</span><span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">device</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">**</span><span class="n">rpcm</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_ymfpci_pcm_4ch</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">*</span><span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">device</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">**</span><span class="n">rpcm</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_ymfpci_mixer</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">*</span><span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rear_switch</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_ymfpci_timer</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ymfpci</span> <span class="o">*</span><span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">device</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __SOUND_YMFPCI_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
