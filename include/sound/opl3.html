<!DOCTYPE html>
<html><head><title>joekychen/linux » include › sound › opl3.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>opl3.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __SOUND_OPL3_H</span>
<span class="cp">#define __SOUND_OPL3_H</span>

<span class="cm">/*</span>
<span class="cm"> * Definitions of the OPL-3 registers.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) by Jaroslav Kysela &lt;perex@perex.cz&gt;,</span>
<span class="cm"> *                  Hannu Savolainen 1993-1996</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *      The OPL-3 mode is switched on by writing 0x01, to the offset 5</span>
<span class="cm"> *      of the right side.</span>
<span class="cm"> *</span>
<span class="cm"> *      Another special register at the right side is at offset 4. It contains</span>
<span class="cm"> *      a bit mask defining which voices are used as 4 OP voices.</span>
<span class="cm"> *</span>
<span class="cm"> *      The percussive mode is implemented in the left side only.</span>
<span class="cm"> *</span>
<span class="cm"> *      With the above exceptions the both sides can be operated independently.</span>
<span class="cm"> *      </span>
<span class="cm"> *      A 4 OP voice can be created by setting the corresponding</span>
<span class="cm"> *      bit at offset 4 of the right side.</span>
<span class="cm"> *</span>
<span class="cm"> *      For example setting the rightmost bit (0x01) changes the</span>
<span class="cm"> *      first voice on the right side to the 4 OP mode. The fourth</span>
<span class="cm"> *      voice is made inaccessible.</span>
<span class="cm"> *</span>
<span class="cm"> *      If a voice is set to the 2 OP mode, it works like 2 OP modes</span>
<span class="cm"> *      of the original YM3812 (AdLib). In addition the voice can </span>
<span class="cm"> *      be connected the left, right or both stereo channels. It can</span>
<span class="cm"> *      even be left unconnected. This works with 4 OP voices also.</span>
<span class="cm"> *</span>
<span class="cm"> *      The stereo connection bits are located in the FEEDBACK_CONNECTION</span>
<span class="cm"> *      register of the voice (0xC0-0xC8). In 4 OP voices these bits are</span>
<span class="cm"> *      in the second half of the voice.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;sound/core.h&gt;</span>
<span class="cp">#include &lt;sound/hwdep.h&gt;</span>
<span class="cp">#include &lt;sound/timer.h&gt;</span>
<span class="cp">#include &lt;sound/seq_midi_emul.h&gt;</span>
<span class="cp">#ifdef CONFIG_SND_SEQUENCER_OSS</span>
<span class="cp">#include &lt;sound/seq_oss.h&gt;</span>
<span class="cp">#include &lt;sound/seq_oss_legacy.h&gt;</span>
<span class="cp">#endif</span>
<span class="cp">#include &lt;sound/seq_device.h&gt;</span>
<span class="cp">#include &lt;sound/asound_fm.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> *    Register numbers for the global registers</span>
<span class="cm"> */</span>

<span class="cp">#define OPL3_REG_TEST			0x01</span>
<span class="cp">#define   OPL3_ENABLE_WAVE_SELECT	0x20</span>

<span class="cp">#define OPL3_REG_TIMER1			0x02</span>
<span class="cp">#define OPL3_REG_TIMER2			0x03</span>
<span class="cp">#define OPL3_REG_TIMER_CONTROL		0x04	</span><span class="cm">/* Left side */</span><span class="cp"></span>
<span class="cp">#define   OPL3_IRQ_RESET		0x80</span>
<span class="cp">#define   OPL3_TIMER1_MASK		0x40</span>
<span class="cp">#define   OPL3_TIMER2_MASK		0x20</span>
<span class="cp">#define   OPL3_TIMER1_START		0x01</span>
<span class="cp">#define   OPL3_TIMER2_START		0x02</span>

<span class="cp">#define OPL3_REG_CONNECTION_SELECT	0x04	</span><span class="cm">/* Right side */</span><span class="cp"></span>
<span class="cp">#define   OPL3_LEFT_4OP_0		0x01</span>
<span class="cp">#define   OPL3_LEFT_4OP_1		0x02</span>
<span class="cp">#define   OPL3_LEFT_4OP_2		0x04</span>
<span class="cp">#define   OPL3_RIGHT_4OP_0		0x08</span>
<span class="cp">#define   OPL3_RIGHT_4OP_1		0x10</span>
<span class="cp">#define   OPL3_RIGHT_4OP_2		0x20</span>

<span class="cp">#define OPL3_REG_MODE			0x05	</span><span class="cm">/* Right side */</span><span class="cp"></span>
<span class="cp">#define   OPL3_OPL3_ENABLE		0x01	</span><span class="cm">/* OPL3 mode */</span><span class="cp"></span>
<span class="cp">#define   OPL3_OPL4_ENABLE		0x02	</span><span class="cm">/* OPL4 mode */</span><span class="cp"></span>

<span class="cp">#define OPL3_REG_KBD_SPLIT		0x08	</span><span class="cm">/* Left side */</span><span class="cp"></span>
<span class="cp">#define   OPL3_COMPOSITE_SINE_WAVE_MODE	0x80	</span><span class="cm">/* Don&#39;t use with OPL-3? */</span><span class="cp"></span>
<span class="cp">#define   OPL3_KEYBOARD_SPLIT		0x40</span>

<span class="cp">#define OPL3_REG_PERCUSSION		0xbd	</span><span class="cm">/* Left side only */</span><span class="cp"></span>
<span class="cp">#define   OPL3_TREMOLO_DEPTH		0x80</span>
<span class="cp">#define   OPL3_VIBRATO_DEPTH		0x40</span>
<span class="cp">#define	  OPL3_PERCUSSION_ENABLE	0x20</span>
<span class="cp">#define   OPL3_BASSDRUM_ON		0x10</span>
<span class="cp">#define   OPL3_SNAREDRUM_ON		0x08</span>
<span class="cp">#define   OPL3_TOMTOM_ON		0x04</span>
<span class="cp">#define   OPL3_CYMBAL_ON		0x02</span>
<span class="cp">#define   OPL3_HIHAT_ON			0x01</span>

<span class="cm">/*</span>
<span class="cm"> *    Offsets to the register banks for operators. To get the</span>
<span class="cm"> *      register number just add the operator offset to the bank offset</span>
<span class="cm"> *</span>
<span class="cm"> *      AM/VIB/EG/KSR/Multiple (0x20 to 0x35)</span>
<span class="cm"> */</span>
<span class="cp">#define OPL3_REG_AM_VIB			0x20</span>
<span class="cp">#define   OPL3_TREMOLO_ON		0x80</span>
<span class="cp">#define   OPL3_VIBRATO_ON		0x40</span>
<span class="cp">#define   OPL3_SUSTAIN_ON		0x20</span>
<span class="cp">#define   OPL3_KSR			0x10	</span><span class="cm">/* Key scaling rate */</span><span class="cp"></span>
<span class="cp">#define   OPL3_MULTIPLE_MASK		0x0f	</span><span class="cm">/* Frequency multiplier */</span><span class="cp"></span>

 <span class="cm">/*</span>
<span class="cm">  *   KSL/Total level (0x40 to 0x55)</span>
<span class="cm">  */</span>
<span class="cp">#define OPL3_REG_KSL_LEVEL		0x40</span>
<span class="cp">#define   OPL3_KSL_MASK			0xc0	</span><span class="cm">/* Envelope scaling bits */</span><span class="cp"></span>
<span class="cp">#define   OPL3_TOTAL_LEVEL_MASK		0x3f	</span><span class="cm">/* Strength (volume) of OP */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *    Attack / Decay rate (0x60 to 0x75)</span>
<span class="cm"> */</span>
<span class="cp">#define OPL3_REG_ATTACK_DECAY		0x60</span>
<span class="cp">#define   OPL3_ATTACK_MASK		0xf0</span>
<span class="cp">#define   OPL3_DECAY_MASK		0x0f</span>

<span class="cm">/*</span>
<span class="cm"> * Sustain level / Release rate (0x80 to 0x95)</span>
<span class="cm"> */</span>
<span class="cp">#define OPL3_REG_SUSTAIN_RELEASE	0x80</span>
<span class="cp">#define   OPL3_SUSTAIN_MASK		0xf0</span>
<span class="cp">#define   OPL3_RELEASE_MASK		0x0f</span>

<span class="cm">/*</span>
<span class="cm"> * Wave select (0xE0 to 0xF5)</span>
<span class="cm"> */</span>
<span class="cp">#define OPL3_REG_WAVE_SELECT		0xe0</span>
<span class="cp">#define   OPL3_WAVE_SELECT_MASK		0x07</span>

<span class="cm">/*</span>
<span class="cm"> *    Offsets to the register banks for voices. Just add to the</span>
<span class="cm"> *      voice number to get the register number.</span>
<span class="cm"> *</span>
<span class="cm"> *      F-Number low bits (0xA0 to 0xA8).</span>
<span class="cm"> */</span>
<span class="cp">#define OPL3_REG_FNUM_LOW		0xa0</span>

<span class="cm">/*</span>
<span class="cm"> *    F-number high bits / Key on / Block (octave) (0xB0 to 0xB8)</span>
<span class="cm"> */</span>
<span class="cp">#define OPL3_REG_KEYON_BLOCK		0xb0</span>
<span class="cp">#define	  OPL3_KEYON_BIT		0x20</span>
<span class="cp">#define	  OPL3_BLOCKNUM_MASK		0x1c</span>
<span class="cp">#define   OPL3_FNUM_HIGH_MASK		0x03</span>

<span class="cm">/*</span>
<span class="cm"> *    Feedback / Connection (0xc0 to 0xc8)</span>
<span class="cm"> *</span>
<span class="cm"> *      These registers have two new bits when the OPL-3 mode</span>
<span class="cm"> *      is selected. These bits controls connecting the voice</span>
<span class="cm"> *      to the stereo channels. For 4 OP voices this bit is</span>
<span class="cm"> *      defined in the second half of the voice (add 3 to the</span>
<span class="cm"> *      register offset).</span>
<span class="cm"> *</span>
<span class="cm"> *      For 4 OP voices the connection bit is used in the</span>
<span class="cm"> *      both halves (gives 4 ways to connect the operators).</span>
<span class="cm"> */</span>
<span class="cp">#define OPL3_REG_FEEDBACK_CONNECTION	0xc0</span>
<span class="cp">#define   OPL3_FEEDBACK_MASK		0x0e	</span><span class="cm">/* Valid just for 1st OP of a voice */</span><span class="cp"></span>
<span class="cp">#define   OPL3_CONNECTION_BIT		0x01</span>
<span class="cm">/*</span>
<span class="cm"> *    In the 4 OP mode there is four possible configurations how the</span>
<span class="cm"> *      operators can be connected together (in 2 OP modes there is just</span>
<span class="cm"> *      AM or FM). The 4 OP connection mode is defined by the rightmost</span>
<span class="cm"> *      bit of the FEEDBACK_CONNECTION (0xC0-0xC8) on the both halves.</span>
<span class="cm"> *</span>
<span class="cm"> *      First half      Second half     Mode</span>
<span class="cm"> *</span>
<span class="cm"> *                                       +---+</span>
<span class="cm"> *                                       v   |</span>
<span class="cm"> *      0               0               &gt;+-1-+--2--3--4--&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *                                      </span>
<span class="cm"> *                                       +---+</span>
<span class="cm"> *                                       |   |</span>
<span class="cm"> *      0               1               &gt;+-1-+--2-+</span>
<span class="cm"> *                                                |-&gt;</span>
<span class="cm"> *                                      &gt;--3----4-+</span>
<span class="cm"> *                                      </span>
<span class="cm"> *                                       +---+</span>
<span class="cm"> *                                       |   |</span>
<span class="cm"> *      1               0               &gt;+-1-+-----+</span>
<span class="cm"> *                                                 |-&gt;</span>
<span class="cm"> *                                      &gt;--2--3--4-+</span>
<span class="cm"> *</span>
<span class="cm"> *                                       +---+</span>
<span class="cm"> *                                       |   |</span>
<span class="cm"> *      1               1               &gt;+-1-+--+</span>
<span class="cm"> *                                              |</span>
<span class="cm"> *                                      &gt;--2--3-+-&gt;</span>
<span class="cm"> *                                              |</span>
<span class="cm"> *                                      &gt;--4----+</span>
<span class="cm"> */</span>
<span class="cp">#define   OPL3_STEREO_BITS		0x30	</span><span class="cm">/* OPL-3 only */</span><span class="cp"></span>
<span class="cp">#define     OPL3_VOICE_TO_LEFT		0x10</span>
<span class="cp">#define     OPL3_VOICE_TO_RIGHT		0x20</span>

<span class="cm">/*</span>

<span class="cm"> */</span>

<span class="cp">#define OPL3_LEFT		0x0000</span>
<span class="cp">#define OPL3_RIGHT		0x0100</span>

<span class="cp">#define OPL3_HW_AUTO		0x0000</span>
<span class="cp">#define OPL3_HW_OPL2		0x0200</span>
<span class="cp">#define OPL3_HW_OPL3		0x0300</span>
<span class="cp">#define OPL3_HW_OPL3_SV		0x0301	</span><span class="cm">/* S3 SonicVibes */</span><span class="cp"></span>
<span class="cp">#define OPL3_HW_OPL3_CS		0x0302	</span><span class="cm">/* CS4232/CS4236+ */</span><span class="cp"></span>
<span class="cp">#define OPL3_HW_OPL3_FM801	0x0303	</span><span class="cm">/* FM801 */</span><span class="cp"></span>
<span class="cp">#define OPL3_HW_OPL3_CS4281	0x0304	</span><span class="cm">/* CS4281 */</span><span class="cp"></span>
<span class="cp">#define OPL3_HW_OPL4		0x0400	</span><span class="cm">/* YMF278B/YMF295 */</span><span class="cp"></span>
<span class="cp">#define OPL3_HW_OPL4_ML		0x0401	</span><span class="cm">/* YMF704/YMF721 */</span><span class="cp"></span>
<span class="cp">#define OPL3_HW_MASK		0xff00</span>

<span class="cp">#define MAX_OPL2_VOICES		9</span>
<span class="cp">#define MAX_OPL3_VOICES		18</span>

<span class="k">struct</span> <span class="n">snd_opl3</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Instrument record, aka &quot;Patch&quot;</span>
<span class="cm"> */</span>

<span class="cm">/* FM operator */</span>
<span class="k">struct</span> <span class="n">fm_operator</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">am_vib</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ksl_level</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">attack_decay</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">sustain_release</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">wave_select</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cm">/* Instrument data */</span>
<span class="k">struct</span> <span class="n">fm_instrument</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fm_operator</span> <span class="n">op</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">feedback_connection</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">echo_delay</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">echo_atten</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">chorus_spread</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">trnsps</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">fix_dur</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">modes</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">fix_key</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* type */</span>
<span class="cp">#define FM_PATCH_OPL2	0x01		</span><span class="cm">/* OPL2 2 operators FM instrument */</span><span class="cp"></span>
<span class="cp">#define FM_PATCH_OPL3	0x02		</span><span class="cm">/* OPL3 4 operators FM instrument */</span><span class="cp"></span>

<span class="cm">/* Instrument record */</span>
<span class="k">struct</span> <span class="n">fm_patch</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">prog</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">bank</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">type</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fm_instrument</span> <span class="n">inst</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">fm_patch</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * A structure to keep track of each hardware voice</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">snd_opl3_voice</span> <span class="p">{</span>
	<span class="kt">int</span>  <span class="n">state</span><span class="p">;</span>		<span class="cm">/* status */</span>
<span class="cp">#define SNDRV_OPL3_ST_OFF		0	</span><span class="cm">/* Not playing */</span><span class="cp"></span>
<span class="cp">#define SNDRV_OPL3_ST_ON_2OP	1	</span><span class="cm">/* 2op voice is allocated */</span><span class="cp"></span>
<span class="cp">#define SNDRV_OPL3_ST_ON_4OP	2	</span><span class="cm">/* 4op voice is allocated */</span><span class="cp"></span>
<span class="cp">#define SNDRV_OPL3_ST_NOT_AVAIL	-1	</span><span class="cm">/* voice is not available */</span><span class="cp"></span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">time</span><span class="p">;</span>	<span class="cm">/* An allocation time */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">note</span><span class="p">;</span>	<span class="cm">/* Note currently assigned to this voice */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">note_off</span><span class="p">;</span>	<span class="cm">/* note-off time */</span>
	<span class="kt">int</span> <span class="n">note_off_check</span><span class="p">;</span>	<span class="cm">/* check note-off time */</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">keyon_reg</span><span class="p">;</span>	<span class="cm">/* KON register shadow */</span>

	<span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">;</span>	<span class="cm">/* Midi channel for this note */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_opl3</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">l_port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r_port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">res_l_port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">res_r_port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">hardware</span><span class="p">;</span>
	<span class="cm">/* hardware access */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">command</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">*</span> <span class="n">opl3</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">timer_enable</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">seq_dev_num</span><span class="p">;</span>	<span class="cm">/* sequencer device number */</span>
	<span class="k">struct</span> <span class="n">snd_timer</span> <span class="o">*</span><span class="n">timer1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_timer</span> <span class="o">*</span><span class="n">timer2</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">timer_lock</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">private_free</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">*</span><span class="p">);</span>

	<span class="k">struct</span> <span class="n">snd_hwdep</span> <span class="o">*</span><span class="n">hwdep</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">reg_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">;</span>		<span class="cm">/* The card that this belongs to */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">fm_mode</span><span class="p">;</span>		<span class="cm">/* OPL mode, see SNDRV_DM_FM_MODE_XXX */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">rhythm</span><span class="p">;</span>		<span class="cm">/* percussion mode flag */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">max_voices</span><span class="p">;</span>	<span class="cm">/* max number of voices */</span>
<span class="cp">#if defined(CONFIG_SND_SEQUENCER) || defined(CONFIG_SND_SEQUENCER_MODULE)</span>
<span class="cp">#define SNDRV_OPL3_MODE_SYNTH 0		</span><span class="cm">/* OSS - voices allocated by application */</span><span class="cp"></span>
<span class="cp">#define SNDRV_OPL3_MODE_SEQ 1		</span><span class="cm">/* ALSA - driver handles voice allocation */</span><span class="cp"></span>
	<span class="kt">int</span> <span class="n">synth_mode</span><span class="p">;</span>			<span class="cm">/* synth mode */</span>
	<span class="kt">int</span> <span class="n">seq_client</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_seq_device</span> <span class="o">*</span><span class="n">seq_dev</span><span class="p">;</span>	<span class="cm">/* sequencer device */</span>
	<span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span> <span class="n">chset</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_SND_SEQUENCER_OSS</span>
	<span class="k">struct</span> <span class="n">snd_seq_device</span> <span class="o">*</span><span class="n">oss_seq_dev</span><span class="p">;</span>	<span class="cm">/* OSS sequencer device */</span>
	<span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span> <span class="n">oss_chset</span><span class="p">;</span>
<span class="cp">#endif</span>
 
<span class="cp">#define OPL3_PATCH_HASH_SIZE	32</span>
	<span class="k">struct</span> <span class="n">fm_patch</span> <span class="o">*</span><span class="n">patch_table</span><span class="p">[</span><span class="n">OPL3_PATCH_HASH_SIZE</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">snd_opl3_voice</span> <span class="n">voices</span><span class="p">[</span><span class="n">MAX_OPL3_VOICES</span><span class="p">];</span> <span class="cm">/* Voices (OPL3 &#39;channel&#39;) */</span>
	<span class="kt">int</span> <span class="n">use_time</span><span class="p">;</span>			<span class="cm">/* allocation counter */</span>

	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">connection_reg</span><span class="p">;</span>	<span class="cm">/* connection reg shadow */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">drum_reg</span><span class="p">;</span>		<span class="cm">/* percussion reg shadow */</span>

	<span class="n">spinlock_t</span> <span class="n">voice_lock</span><span class="p">;</span>		<span class="cm">/* Lock for voice access */</span>

	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">tlist</span><span class="p">;</span>	<span class="cm">/* timer for note-offs and effects */</span>
	<span class="kt">int</span> <span class="n">sys_timer_status</span><span class="p">;</span>		<span class="cm">/* system timer run status */</span>
	<span class="n">spinlock_t</span> <span class="n">sys_timer_lock</span><span class="p">;</span>	<span class="cm">/* Lock for system timer access */</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="cm">/* opl3.c */</span>
<span class="kt">void</span> <span class="n">snd_opl3_interrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_hwdep</span> <span class="o">*</span> <span class="n">hw</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_opl3_new</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">hardware</span><span class="p">,</span>
		 <span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">**</span><span class="n">ropl3</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_opl3_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">*</span><span class="n">opl3</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_opl3_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">l_port</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r_port</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">hardware</span><span class="p">,</span>
		    <span class="kt">int</span> <span class="n">integrated</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">**</span> <span class="n">opl3</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_opl3_timer_new</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">*</span> <span class="n">opl3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">timer1_dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">timer2_dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_opl3_hwdep_new</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">*</span> <span class="n">opl3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">device</span><span class="p">,</span> <span class="kt">int</span> <span class="n">seq_device</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">snd_hwdep</span> <span class="o">**</span> <span class="n">rhwdep</span><span class="p">);</span>

<span class="cm">/* opl3_synth */</span>
<span class="kt">int</span> <span class="n">snd_opl3_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_hwdep</span> <span class="o">*</span> <span class="n">hw</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_opl3_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_hwdep</span> <span class="o">*</span> <span class="n">hw</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
		   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_opl3_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_hwdep</span> <span class="o">*</span> <span class="n">hw</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">snd_opl3_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">*</span> <span class="n">opl3</span><span class="p">);</span>

<span class="cp">#if defined(CONFIG_SND_SEQUENCER) || defined(CONFIG_SND_SEQUENCER_MODULE)</span>
<span class="kt">long</span> <span class="n">snd_opl3_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_hwdep</span> <span class="o">*</span><span class="n">hw</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">long</span> <span class="n">count</span><span class="p">,</span>
		    <span class="n">loff_t</span> <span class="o">*</span><span class="n">offset</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_opl3_load_patch</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">*</span><span class="n">opl3</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">prog</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bank</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span>
			<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ext</span><span class="p">,</span>
			<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">fm_patch</span> <span class="o">*</span><span class="n">snd_opl3_find_patch</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">*</span><span class="n">opl3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">prog</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bank</span><span class="p">,</span>
				     <span class="kt">int</span> <span class="n">create_patch</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_opl3_clear_patches</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">*</span><span class="n">opl3</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define snd_opl3_write	NULL</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">snd_opl3_clear_patches</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl3</span> <span class="o">*</span><span class="n">opl3</span><span class="p">)</span> <span class="p">{}</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* __SOUND_OPL3_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
