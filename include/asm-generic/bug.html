<!DOCTYPE html>
<html><head><title>joekychen/linux » include › asm-generic › bug.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>bug.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_GENERIC_BUG_H</span>
<span class="cp">#define _ASM_GENERIC_BUG_H</span>

<span class="cp">#include &lt;linux/compiler.h&gt;</span>

<span class="cp">#ifdef CONFIG_GENERIC_BUG</span>
<span class="cp">#define BUGFLAG_WARNING		(1 &lt;&lt; 0)</span>
<span class="cp">#define BUGFLAG_TAINT(taint)	(BUGFLAG_WARNING | ((taint) &lt;&lt; 8))</span>
<span class="cp">#define BUG_GET_TAINT(bug)	((bug)-&gt;flags &gt;&gt; 8)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>

<span class="cp">#ifdef CONFIG_BUG</span>

<span class="cp">#ifdef CONFIG_GENERIC_BUG</span>
<span class="k">struct</span> <span class="n">bug_entry</span> <span class="p">{</span>
<span class="cp">#ifndef CONFIG_GENERIC_BUG_RELATIVE_POINTERS</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">bug_addr</span><span class="p">;</span>
<span class="cp">#else</span>
	<span class="kt">signed</span> <span class="kt">int</span>	<span class="n">bug_addr_disp</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_DEBUG_BUGVERBOSE</span>
<span class="cp">#ifndef CONFIG_GENERIC_BUG_RELATIVE_POINTERS</span>
	<span class="k">const</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">file</span><span class="p">;</span>
<span class="cp">#else</span>
	<span class="kt">signed</span> <span class="kt">int</span>	<span class="n">file_disp</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">line</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">flags</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif	</span><span class="cm">/* CONFIG_GENERIC_BUG */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Don&#39;t use BUG() or BUG_ON() unless there&#39;s really no way out; one</span>
<span class="cm"> * example might be detecting data structure corruption in the middle</span>
<span class="cm"> * of an operation that can&#39;t be backed out of.  If the (sub)system</span>
<span class="cm"> * can somehow continue operating, perhaps with reduced functionality,</span>
<span class="cm"> * it&#39;s probably not BUG-worthy.</span>
<span class="cm"> *</span>
<span class="cm"> * If you&#39;re tempted to BUG(), think again:  is completely giving up</span>
<span class="cm"> * really the *only* solution?  There are usually better options, where</span>
<span class="cm"> * users don&#39;t need to reboot ASAP and can mostly shut down cleanly.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef HAVE_ARCH_BUG</span>
<span class="cp">#define BUG() do { \</span>
<span class="cp">	printk(&quot;BUG: failure at %s:%d/%s()!\n&quot;, __FILE__, __LINE__, __func__); \</span>
<span class="cp">	panic(&quot;BUG!&quot;); \</span>
<span class="cp">} while (0)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef HAVE_ARCH_BUG_ON</span>
<span class="cp">#define BUG_ON(condition) do { if (unlikely(condition)) BUG(); } while(0)</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * WARN(), WARN_ON(), WARN_ON_ONCE, and so on can be used to report</span>
<span class="cm"> * significant issues that need prompt attention if they should ever</span>
<span class="cm"> * appear at runtime.  Use the versions with printk format strings</span>
<span class="cm"> * to provide better diagnostics.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __WARN_TAINT</span>
<span class="k">extern</span> <span class="n">__printf</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="kt">void</span> <span class="n">warn_slowpath_fmt</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span>
		       <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="k">extern</span> <span class="n">__printf</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="kt">void</span> <span class="n">warn_slowpath_fmt_taint</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">line</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">taint</span><span class="p">,</span>
			     <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">warn_slowpath_null</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">line</span><span class="p">);</span>
<span class="cp">#define WANT_WARN_ON_SLOWPATH</span>
<span class="cp">#define __WARN()		warn_slowpath_null(__FILE__, __LINE__)</span>
<span class="cp">#define __WARN_printf(arg...)	warn_slowpath_fmt(__FILE__, __LINE__, arg)</span>
<span class="cp">#define __WARN_printf_taint(taint, arg...)				\</span>
<span class="cp">	warn_slowpath_fmt_taint(__FILE__, __LINE__, taint, arg)</span>
<span class="cp">#else</span>
<span class="cp">#define __WARN()		__WARN_TAINT(TAINT_WARN)</span>
<span class="cp">#define __WARN_printf(arg...)	do { printk(arg); __WARN(); } while (0)</span>
<span class="cp">#define __WARN_printf_taint(taint, arg...)				\</span>
<span class="cp">	do { printk(arg); __WARN_TAINT(taint); } while (0)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef WARN_ON</span>
<span class="cp">#define WARN_ON(condition) ({						\</span>
<span class="cp">	int __ret_warn_on = !!(condition);				\</span>
<span class="cp">	if (unlikely(__ret_warn_on))					\</span>
<span class="cp">		__WARN();						\</span>
<span class="cp">	unlikely(__ret_warn_on);					\</span>
<span class="cp">})</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef WARN</span>
<span class="cp">#define WARN(condition, format...) ({						\</span>
<span class="cp">	int __ret_warn_on = !!(condition);				\</span>
<span class="cp">	if (unlikely(__ret_warn_on))					\</span>
<span class="cp">		__WARN_printf(format);					\</span>
<span class="cp">	unlikely(__ret_warn_on);					\</span>
<span class="cp">})</span>
<span class="cp">#endif</span>

<span class="cp">#define WARN_TAINT(condition, taint, format...) ({			\</span>
<span class="cp">	int __ret_warn_on = !!(condition);				\</span>
<span class="cp">	if (unlikely(__ret_warn_on))					\</span>
<span class="cp">		__WARN_printf_taint(taint, format);			\</span>
<span class="cp">	unlikely(__ret_warn_on);					\</span>
<span class="cp">})</span>

<span class="cp">#else </span><span class="cm">/* !CONFIG_BUG */</span><span class="cp"></span>
<span class="cp">#ifndef HAVE_ARCH_BUG</span>
<span class="cp">#define BUG() do {} while(0)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef HAVE_ARCH_BUG_ON</span>
<span class="cp">#define BUG_ON(condition) do { if (condition) ; } while(0)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef HAVE_ARCH_WARN_ON</span>
<span class="cp">#define WARN_ON(condition) ({						\</span>
<span class="cp">	int __ret_warn_on = !!(condition);				\</span>
<span class="cp">	unlikely(__ret_warn_on);					\</span>
<span class="cp">})</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef WARN</span>
<span class="cp">#define WARN(condition, format...) ({					\</span>
<span class="cp">	int __ret_warn_on = !!(condition);				\</span>
<span class="cp">	unlikely(__ret_warn_on);					\</span>
<span class="cp">})</span>
<span class="cp">#endif</span>

<span class="cp">#define WARN_TAINT(condition, taint, format...) WARN_ON(condition)</span>

<span class="cp">#endif</span>

<span class="cp">#define WARN_ON_ONCE(condition)	({				\</span>
<span class="cp">	static bool __section(.data.unlikely) __warned;		\</span>
<span class="cp">	int __ret_warn_once = !!(condition);			\</span>
<span class="cp">								\</span>
<span class="cp">	if (unlikely(__ret_warn_once))				\</span>
<span class="cp">		if (WARN_ON(!__warned)) 			\</span>
<span class="cp">			__warned = true;			\</span>
<span class="cp">	unlikely(__ret_warn_once);				\</span>
<span class="cp">})</span>

<span class="cp">#define WARN_ONCE(condition, format...)	({			\</span>
<span class="cp">	static bool __section(.data.unlikely) __warned;		\</span>
<span class="cp">	int __ret_warn_once = !!(condition);			\</span>
<span class="cp">								\</span>
<span class="cp">	if (unlikely(__ret_warn_once))				\</span>
<span class="cp">		if (WARN(!__warned, format)) 			\</span>
<span class="cp">			__warned = true;			\</span>
<span class="cp">	unlikely(__ret_warn_once);				\</span>
<span class="cp">})</span>

<span class="cp">#define WARN_TAINT_ONCE(condition, taint, format...)	({	\</span>
<span class="cp">	static bool __section(.data.unlikely) __warned;		\</span>
<span class="cp">	int __ret_warn_once = !!(condition);			\</span>
<span class="cp">								\</span>
<span class="cp">	if (unlikely(__ret_warn_once))				\</span>
<span class="cp">		if (WARN_TAINT(!__warned, taint, format))	\</span>
<span class="cp">			__warned = true;			\</span>
<span class="cp">	unlikely(__ret_warn_once);				\</span>
<span class="cp">})</span>

<span class="cm">/*</span>
<span class="cm"> * WARN_ON_SMP() is for cases that the warning is either</span>
<span class="cm"> * meaningless for !SMP or may even cause failures.</span>
<span class="cm"> * This is usually used for cases that we have</span>
<span class="cm"> * WARN_ON(!spin_is_locked(&amp;lock)) checks, as spin_is_locked()</span>
<span class="cm"> * returns 0 for uniprocessor settings.</span>
<span class="cm"> * It can also be used with values that are only defined</span>
<span class="cm"> * on SMP:</span>
<span class="cm"> *</span>
<span class="cm"> * struct foo {</span>
<span class="cm"> *  [...]</span>
<span class="cm"> * #ifdef CONFIG_SMP</span>
<span class="cm"> *	int bar;</span>
<span class="cm"> * #endif</span>
<span class="cm"> * };</span>
<span class="cm"> *</span>
<span class="cm"> * void func(struct foo *zoot)</span>
<span class="cm"> * {</span>
<span class="cm"> *	WARN_ON_SMP(!zoot-&gt;bar);</span>
<span class="cm"> *</span>
<span class="cm"> * For CONFIG_SMP, WARN_ON_SMP() should act the same as WARN_ON(),</span>
<span class="cm"> * and should be a nop and return false for uniprocessor.</span>
<span class="cm"> *</span>
<span class="cm"> * if (WARN_ON_SMP(x)) returns true only when CONFIG_SMP is set</span>
<span class="cm"> * and x is true.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_SMP</span>
<span class="cp"># define WARN_ON_SMP(x)			WARN_ON(x)</span>
<span class="cp">#else</span>
<span class="cm">/*</span>
<span class="cm"> * Use of ({0;}) because WARN_ON_SMP(x) may be used either as</span>
<span class="cm"> * a stand alone line statement or as a condition in an if ()</span>
<span class="cm"> * statement.</span>
<span class="cm"> * A simple &quot;0&quot; would cause gcc to give a &quot;statement has no effect&quot;</span>
<span class="cm"> * warning.</span>
<span class="cm"> */</span>
<span class="cp"># define WARN_ON_SMP(x)			({0;})</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
