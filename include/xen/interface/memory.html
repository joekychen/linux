<!DOCTYPE html>
<html><head><title>joekychen/linux » include › xen › interface › memory.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>memory.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************************</span>
<span class="cm"> * memory.h</span>
<span class="cm"> *</span>
<span class="cm"> * Memory reservation and information.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2005, Keir Fraser &lt;keir@xensource.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __XEN_PUBLIC_MEMORY_H__</span>
<span class="cp">#define __XEN_PUBLIC_MEMORY_H__</span>

<span class="cp">#include &lt;linux/spinlock.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Increase or decrease the specified domain&#39;s memory reservation. Returns a</span>
<span class="cm"> * -ve errcode on failure, or the # extents successfully allocated or freed.</span>
<span class="cm"> * arg == addr of struct xen_memory_reservation.</span>
<span class="cm"> */</span>
<span class="cp">#define XENMEM_increase_reservation 0</span>
<span class="cp">#define XENMEM_decrease_reservation 1</span>
<span class="cp">#define XENMEM_populate_physmap     6</span>
<span class="k">struct</span> <span class="n">xen_memory_reservation</span> <span class="p">{</span>

    <span class="cm">/*</span>
<span class="cm">     * XENMEM_increase_reservation:</span>
<span class="cm">     *   OUT: MFN (*not* GMFN) bases of extents that were allocated</span>
<span class="cm">     * XENMEM_decrease_reservation:</span>
<span class="cm">     *   IN:  GMFN bases of extents to free</span>
<span class="cm">     * XENMEM_populate_physmap:</span>
<span class="cm">     *   IN:  GPFN bases of extents to populate with memory</span>
<span class="cm">     *   OUT: GMFN bases of extents that were allocated</span>
<span class="cm">     *   (NB. This command also updates the mach_to_phys translation table)</span>
<span class="cm">     */</span>
    <span class="n">GUEST_HANDLE</span><span class="p">(</span><span class="n">ulong</span><span class="p">)</span> <span class="n">extent_start</span><span class="p">;</span>

    <span class="cm">/* Number of extents, and size/alignment of each (2^extent_order pages). */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">nr_extents</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">extent_order</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Maximum # bits addressable by the user of the allocated region (e.g.,</span>
<span class="cm">     * I/O devices often have a 32-bit limitation even in 64-bit systems). If</span>
<span class="cm">     * zero then the user has no addressing restriction.</span>
<span class="cm">     * This field is not used by XENMEM_decrease_reservation.</span>
<span class="cm">     */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span>   <span class="n">address_bits</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Domain whose reservation is being changed.</span>
<span class="cm">     * Unprivileged domains can specify only DOMID_SELF.</span>
<span class="cm">     */</span>
    <span class="n">domid_t</span>        <span class="n">domid</span><span class="p">;</span>

<span class="p">};</span>
<span class="n">DEFINE_GUEST_HANDLE_STRUCT</span><span class="p">(</span><span class="n">xen_memory_reservation</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * An atomic exchange of memory pages. If return code is zero then</span>
<span class="cm"> * @out.extent_list provides GMFNs of the newly-allocated memory.</span>
<span class="cm"> * Returns zero on complete success, otherwise a negative error code.</span>
<span class="cm"> * On complete success then always @nr_exchanged == @in.nr_extents.</span>
<span class="cm"> * On partial success @nr_exchanged indicates how much work was done.</span>
<span class="cm"> */</span>
<span class="cp">#define XENMEM_exchange             11</span>
<span class="k">struct</span> <span class="n">xen_memory_exchange</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * [IN] Details of memory extents to be exchanged (GMFN bases).</span>
<span class="cm">     * Note that @in.address_bits is ignored and unused.</span>
<span class="cm">     */</span>
    <span class="k">struct</span> <span class="n">xen_memory_reservation</span> <span class="n">in</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * [IN/OUT] Details of new memory extents.</span>
<span class="cm">     * We require that:</span>
<span class="cm">     *  1. @in.domid == @out.domid</span>
<span class="cm">     *  2. @in.nr_extents  &lt;&lt; @in.extent_order ==</span>
<span class="cm">     *     @out.nr_extents &lt;&lt; @out.extent_order</span>
<span class="cm">     *  3. @in.extent_start and @out.extent_start lists must not overlap</span>
<span class="cm">     *  4. @out.extent_start lists GPFN bases to be populated</span>
<span class="cm">     *  5. @out.extent_start is overwritten with allocated GMFN bases</span>
<span class="cm">     */</span>
    <span class="k">struct</span> <span class="n">xen_memory_reservation</span> <span class="n">out</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * [OUT] Number of input extents that were successfully exchanged:</span>
<span class="cm">     *  1. The first @nr_exchanged input extents were successfully</span>
<span class="cm">     *     deallocated.</span>
<span class="cm">     *  2. The corresponding first entries in the output extent list correctly</span>
<span class="cm">     *     indicate the GMFNs that were successfully exchanged.</span>
<span class="cm">     *  3. All other input and output extents are untouched.</span>
<span class="cm">     *  4. If not all input exents are exchanged then the return code of this</span>
<span class="cm">     *     command will be non-zero.</span>
<span class="cm">     *  5. THIS FIELD MUST BE INITIALISED TO ZERO BY THE CALLER!</span>
<span class="cm">     */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">nr_exchanged</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">DEFINE_GUEST_HANDLE_STRUCT</span><span class="p">(</span><span class="n">xen_memory_exchange</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm"> * Returns the maximum machine frame number of mapped RAM in this system.</span>
<span class="cm"> * This command always succeeds (it never returns an error code).</span>
<span class="cm"> * arg == NULL.</span>
<span class="cm"> */</span>
<span class="cp">#define XENMEM_maximum_ram_page     2</span>

<span class="cm">/*</span>
<span class="cm"> * Returns the current or maximum memory reservation, in pages, of the</span>
<span class="cm"> * specified domain (may be DOMID_SELF). Returns -ve errcode on failure.</span>
<span class="cm"> * arg == addr of domid_t.</span>
<span class="cm"> */</span>
<span class="cp">#define XENMEM_current_reservation  3</span>
<span class="cp">#define XENMEM_maximum_reservation  4</span>

<span class="cm">/*</span>
<span class="cm"> * Returns a list of MFN bases of 2MB extents comprising the machine_to_phys</span>
<span class="cm"> * mapping table. Architectures which do not have a m2p table do not implement</span>
<span class="cm"> * this command.</span>
<span class="cm"> * arg == addr of xen_machphys_mfn_list_t.</span>
<span class="cm"> */</span>
<span class="cp">#define XENMEM_machphys_mfn_list    5</span>
<span class="k">struct</span> <span class="n">xen_machphys_mfn_list</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * Size of the &#39;extent_start&#39; array. Fewer entries will be filled if the</span>
<span class="cm">     * machphys table is smaller than max_extents * 2MB.</span>
<span class="cm">     */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max_extents</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Pointer to buffer to fill with list of extent starts. If there are</span>
<span class="cm">     * any large discontiguities in the machine address space, 2MB gaps in</span>
<span class="cm">     * the machphys table will be represented by an MFN base of zero.</span>
<span class="cm">     */</span>
    <span class="n">GUEST_HANDLE</span><span class="p">(</span><span class="n">ulong</span><span class="p">)</span> <span class="n">extent_start</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Number of extents written to the above array. This will be smaller</span>
<span class="cm">     * than &#39;max_extents&#39; if the machphys table is smaller than max_e * 2MB.</span>
<span class="cm">     */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nr_extents</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">DEFINE_GUEST_HANDLE_STRUCT</span><span class="p">(</span><span class="n">xen_machphys_mfn_list</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Returns the location in virtual address space of the machine_to_phys</span>
<span class="cm"> * mapping table. Architectures which do not have a m2p table, or which do not</span>
<span class="cm"> * map it by default into guest address space, do not implement this command.</span>
<span class="cm"> * arg == addr of xen_machphys_mapping_t.</span>
<span class="cm"> */</span>
<span class="cp">#define XENMEM_machphys_mapping     12</span>
<span class="k">struct</span> <span class="n">xen_machphys_mapping</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">v_start</span><span class="p">,</span> <span class="n">v_end</span><span class="p">;</span> <span class="cm">/* Start and end virtual addresses.   */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">max_mfn</span><span class="p">;</span>        <span class="cm">/* Maximum MFN that can be looked up. */</span>
<span class="p">};</span>
<span class="n">DEFINE_GUEST_HANDLE_STRUCT</span><span class="p">(</span><span class="n">xen_machphys_mapping_t</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Sets the GPFN at which a particular page appears in the specified guest&#39;s</span>
<span class="cm"> * pseudophysical address space.</span>
<span class="cm"> * arg == addr of xen_add_to_physmap_t.</span>
<span class="cm"> */</span>
<span class="cp">#define XENMEM_add_to_physmap      7</span>
<span class="k">struct</span> <span class="n">xen_add_to_physmap</span> <span class="p">{</span>
    <span class="cm">/* Which domain to change the mapping for. */</span>
    <span class="n">domid_t</span> <span class="n">domid</span><span class="p">;</span>

    <span class="cm">/* Source mapping space. */</span>
<span class="cp">#define XENMAPSPACE_shared_info 0 </span><span class="cm">/* shared info page */</span><span class="cp"></span>
<span class="cp">#define XENMAPSPACE_grant_table 1 </span><span class="cm">/* grant table page */</span><span class="cp"></span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">space</span><span class="p">;</span>

    <span class="cm">/* Index into source mapping space. */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">idx</span><span class="p">;</span>

    <span class="cm">/* GPFN where the source mapping page should appear. */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gpfn</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">DEFINE_GUEST_HANDLE_STRUCT</span><span class="p">(</span><span class="n">xen_add_to_physmap</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Translates a list of domain-specific GPFNs into MFNs. Returns a -ve error</span>
<span class="cm"> * code on failure. This call only works for auto-translated guests.</span>
<span class="cm"> */</span>
<span class="cp">#define XENMEM_translate_gpfn_list  8</span>
<span class="k">struct</span> <span class="n">xen_translate_gpfn_list</span> <span class="p">{</span>
    <span class="cm">/* Which domain to translate for? */</span>
    <span class="n">domid_t</span> <span class="n">domid</span><span class="p">;</span>

    <span class="cm">/* Length of list. */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">nr_gpfns</span><span class="p">;</span>

    <span class="cm">/* List of GPFNs to translate. */</span>
    <span class="n">GUEST_HANDLE</span><span class="p">(</span><span class="n">ulong</span><span class="p">)</span> <span class="n">gpfn_list</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Output list to contain MFN translations. May be the same as the input</span>
<span class="cm">     * list (in which case each input GPFN is overwritten with the output MFN).</span>
<span class="cm">     */</span>
    <span class="n">GUEST_HANDLE</span><span class="p">(</span><span class="n">ulong</span><span class="p">)</span> <span class="n">mfn_list</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">DEFINE_GUEST_HANDLE_STRUCT</span><span class="p">(</span><span class="n">xen_translate_gpfn_list</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Returns the pseudo-physical memory map as it was when the domain</span>
<span class="cm"> * was started (specified by XENMEM_set_memory_map).</span>
<span class="cm"> * arg == addr of struct xen_memory_map.</span>
<span class="cm"> */</span>
<span class="cp">#define XENMEM_memory_map           9</span>
<span class="k">struct</span> <span class="n">xen_memory_map</span> <span class="p">{</span>
    <span class="cm">/*</span>
<span class="cm">     * On call the number of entries which can be stored in buffer. On</span>
<span class="cm">     * return the number of entries which have been stored in</span>
<span class="cm">     * buffer.</span>
<span class="cm">     */</span>
    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nr_entries</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     * Entries in the buffer are in the same format as returned by the</span>
<span class="cm">     * BIOS INT 0x15 EAX=0xE820 call.</span>
<span class="cm">     */</span>
    <span class="n">GUEST_HANDLE</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="n">buffer</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">DEFINE_GUEST_HANDLE_STRUCT</span><span class="p">(</span><span class="n">xen_memory_map</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Returns the real physical memory map. Passes the same structure as</span>
<span class="cm"> * XENMEM_memory_map.</span>
<span class="cm"> * arg == addr of struct xen_memory_map.</span>
<span class="cm"> */</span>
<span class="cp">#define XENMEM_machine_memory_map   10</span>


<span class="cm">/*</span>
<span class="cm"> * Prevent the balloon driver from changing the memory reservation</span>
<span class="cm"> * during a driver critical region.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="n">spinlock_t</span> <span class="n">xen_reservation_lock</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* __XEN_PUBLIC_MEMORY_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
