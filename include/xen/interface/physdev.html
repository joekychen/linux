<!DOCTYPE html>
<html><head><title>joekychen/linux » include › xen › interface › physdev.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>physdev.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<span class="cm"> * of this software and associated documentation files (the &quot;Software&quot;), to</span>
<span class="cm"> * deal in the Software without restriction, including without limitation the</span>
<span class="cm"> * rights to use, copy, modify, merge, publish, distribute, sublicense, and/or</span>
<span class="cm"> * sell copies of the Software, and to permit persons to whom the Software is</span>
<span class="cm"> * furnished to do so, subject to the following conditions:</span>
<span class="cm"> *</span>
<span class="cm"> * The above copyright notice and this permission notice shall be included in</span>
<span class="cm"> * all copies or substantial portions of the Software.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<span class="cm"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<span class="cm"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<span class="cm"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class="cm"> * DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __XEN_PUBLIC_PHYSDEV_H__</span>
<span class="cp">#define __XEN_PUBLIC_PHYSDEV_H__</span>

<span class="cm">/*</span>
<span class="cm"> * Prototype for this hypercall is:</span>
<span class="cm"> *  int physdev_op(int cmd, void *args)</span>
<span class="cm"> * @cmd	 == PHYSDEVOP_??? (physdev operation).</span>
<span class="cm"> * @args == Operation-specific extra arguments (NULL if none).</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Notify end-of-interrupt (EOI) for the specified IRQ.</span>
<span class="cm"> * @arg == pointer to physdev_eoi structure.</span>
<span class="cm"> */</span>
<span class="cp">#define PHYSDEVOP_eoi			12</span>
<span class="k">struct</span> <span class="n">physdev_eoi</span> <span class="p">{</span>
	<span class="cm">/* IN */</span>
	<span class="kt">uint32_t</span> <span class="n">irq</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Register a shared page for the hypervisor to indicate whether the guest</span>
<span class="cm"> * must issue PHYSDEVOP_eoi. The semantics of PHYSDEVOP_eoi change slightly</span>
<span class="cm"> * once the guest used this function in that the associated event channel</span>
<span class="cm"> * will automatically get unmasked. The page registered is used as a bit</span>
<span class="cm"> * array indexed by Xen&#39;s PIRQ value.</span>
<span class="cm"> */</span>
<span class="cp">#define PHYSDEVOP_pirq_eoi_gmfn_v1       17</span>
<span class="cm">/*</span>
<span class="cm"> * Register a shared page for the hypervisor to indicate whether the</span>
<span class="cm"> * guest must issue PHYSDEVOP_eoi. This hypercall is very similar to</span>
<span class="cm"> * PHYSDEVOP_pirq_eoi_gmfn_v1 but it doesn&#39;t change the semantics of</span>
<span class="cm"> * PHYSDEVOP_eoi. The page registered is used as a bit array indexed by</span>
<span class="cm"> * Xen&#39;s PIRQ value.</span>
<span class="cm"> */</span>
<span class="cp">#define PHYSDEVOP_pirq_eoi_gmfn_v2       28</span>
<span class="k">struct</span> <span class="n">physdev_pirq_eoi_gmfn</span> <span class="p">{</span>
    <span class="cm">/* IN */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gmfn</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Query the status of an IRQ line.</span>
<span class="cm"> * @arg == pointer to physdev_irq_status_query structure.</span>
<span class="cm"> */</span>
<span class="cp">#define PHYSDEVOP_irq_status_query	 5</span>
<span class="k">struct</span> <span class="n">physdev_irq_status_query</span> <span class="p">{</span>
	<span class="cm">/* IN */</span>
	<span class="kt">uint32_t</span> <span class="n">irq</span><span class="p">;</span>
	<span class="cm">/* OUT */</span>
	<span class="kt">uint32_t</span> <span class="n">flags</span><span class="p">;</span> <span class="cm">/* XENIRQSTAT_* */</span>
<span class="p">};</span>

<span class="cm">/* Need to call PHYSDEVOP_eoi when the IRQ has been serviced? */</span>
<span class="cp">#define _XENIRQSTAT_needs_eoi	(0)</span>
<span class="cp">#define	 XENIRQSTAT_needs_eoi	(1U&lt;&lt;_XENIRQSTAT_needs_eoi)</span>

<span class="cm">/* IRQ shared by multiple guests? */</span>
<span class="cp">#define _XENIRQSTAT_shared	(1)</span>
<span class="cp">#define	 XENIRQSTAT_shared	(1U&lt;&lt;_XENIRQSTAT_shared)</span>

<span class="cm">/*</span>
<span class="cm"> * Set the current VCPU&#39;s I/O privilege level.</span>
<span class="cm"> * @arg == pointer to physdev_set_iopl structure.</span>
<span class="cm"> */</span>
<span class="cp">#define PHYSDEVOP_set_iopl		 6</span>
<span class="k">struct</span> <span class="n">physdev_set_iopl</span> <span class="p">{</span>
	<span class="cm">/* IN */</span>
	<span class="kt">uint32_t</span> <span class="n">iopl</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Set the current VCPU&#39;s I/O-port permissions bitmap.</span>
<span class="cm"> * @arg == pointer to physdev_set_iobitmap structure.</span>
<span class="cm"> */</span>
<span class="cp">#define PHYSDEVOP_set_iobitmap		 7</span>
<span class="k">struct</span> <span class="n">physdev_set_iobitmap</span> <span class="p">{</span>
	<span class="cm">/* IN */</span>
	<span class="kt">uint8_t</span> <span class="o">*</span> <span class="n">bitmap</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">nr_ports</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Read or write an IO-APIC register.</span>
<span class="cm"> * @arg == pointer to physdev_apic structure.</span>
<span class="cm"> */</span>
<span class="cp">#define PHYSDEVOP_apic_read		 8</span>
<span class="cp">#define PHYSDEVOP_apic_write		 9</span>
<span class="k">struct</span> <span class="n">physdev_apic</span> <span class="p">{</span>
	<span class="cm">/* IN */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">apic_physbase</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">reg</span><span class="p">;</span>
	<span class="cm">/* IN or OUT */</span>
	<span class="kt">uint32_t</span> <span class="n">value</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Allocate or free a physical upcall vector for the specified IRQ line.</span>
<span class="cm"> * @arg == pointer to physdev_irq structure.</span>
<span class="cm"> */</span>
<span class="cp">#define PHYSDEVOP_alloc_irq_vector	10</span>
<span class="cp">#define PHYSDEVOP_free_irq_vector	11</span>
<span class="k">struct</span> <span class="n">physdev_irq</span> <span class="p">{</span>
	<span class="cm">/* IN */</span>
	<span class="kt">uint32_t</span> <span class="n">irq</span><span class="p">;</span>
	<span class="cm">/* IN or OUT */</span>
	<span class="kt">uint32_t</span> <span class="n">vector</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define MAP_PIRQ_TYPE_MSI		0x0</span>
<span class="cp">#define MAP_PIRQ_TYPE_GSI		0x1</span>
<span class="cp">#define MAP_PIRQ_TYPE_UNKNOWN		0x2</span>
<span class="cp">#define MAP_PIRQ_TYPE_MSI_SEG		0x3</span>

<span class="cp">#define PHYSDEVOP_map_pirq		13</span>
<span class="k">struct</span> <span class="n">physdev_map_pirq</span> <span class="p">{</span>
    <span class="n">domid_t</span> <span class="n">domid</span><span class="p">;</span>
    <span class="cm">/* IN */</span>
    <span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
    <span class="cm">/* IN */</span>
    <span class="kt">int</span> <span class="n">index</span><span class="p">;</span>
    <span class="cm">/* IN or OUT */</span>
    <span class="kt">int</span> <span class="n">pirq</span><span class="p">;</span>
    <span class="cm">/* IN - high 16 bits hold segment for MAP_PIRQ_TYPE_MSI_SEG */</span>
    <span class="kt">int</span> <span class="n">bus</span><span class="p">;</span>
    <span class="cm">/* IN */</span>
    <span class="kt">int</span> <span class="n">devfn</span><span class="p">;</span>
    <span class="cm">/* IN */</span>
    <span class="kt">int</span> <span class="n">entry_nr</span><span class="p">;</span>
    <span class="cm">/* IN */</span>
    <span class="kt">uint64_t</span> <span class="n">table_base</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define PHYSDEVOP_unmap_pirq		14</span>
<span class="k">struct</span> <span class="n">physdev_unmap_pirq</span> <span class="p">{</span>
    <span class="n">domid_t</span> <span class="n">domid</span><span class="p">;</span>
    <span class="cm">/* IN */</span>
    <span class="kt">int</span> <span class="n">pirq</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define PHYSDEVOP_manage_pci_add	15</span>
<span class="cp">#define PHYSDEVOP_manage_pci_remove	16</span>
<span class="k">struct</span> <span class="n">physdev_manage_pci</span> <span class="p">{</span>
	<span class="cm">/* IN */</span>
	<span class="kt">uint8_t</span> <span class="n">bus</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">devfn</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define PHYSDEVOP_restore_msi            19</span>
<span class="k">struct</span> <span class="n">physdev_restore_msi</span> <span class="p">{</span>
	<span class="cm">/* IN */</span>
	<span class="kt">uint8_t</span> <span class="n">bus</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">devfn</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define PHYSDEVOP_manage_pci_add_ext	20</span>
<span class="k">struct</span> <span class="n">physdev_manage_pci_ext</span> <span class="p">{</span>
	<span class="cm">/* IN */</span>
	<span class="kt">uint8_t</span> <span class="n">bus</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">devfn</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">is_extfn</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">is_virtfn</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">uint8_t</span> <span class="n">bus</span><span class="p">;</span>
		<span class="kt">uint8_t</span> <span class="n">devfn</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">physfn</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Argument to physdev_op_compat() hypercall. Superceded by new physdev_op()</span>
<span class="cm"> * hypercall since 0x00030202.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">physdev_op</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">cmd</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">physdev_irq_status_query</span>	     <span class="n">irq_status_query</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">physdev_set_iopl</span>		     <span class="n">set_iopl</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">physdev_set_iobitmap</span>	     <span class="n">set_iobitmap</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">physdev_apic</span>		     <span class="n">apic_op</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">physdev_irq</span>		     <span class="n">irq_op</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define PHYSDEVOP_setup_gsi    21</span>
<span class="k">struct</span> <span class="n">physdev_setup_gsi</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">gsi</span><span class="p">;</span>
    <span class="cm">/* IN */</span>
    <span class="kt">uint8_t</span> <span class="n">triggering</span><span class="p">;</span>
    <span class="cm">/* IN */</span>
    <span class="kt">uint8_t</span> <span class="n">polarity</span><span class="p">;</span>
    <span class="cm">/* IN */</span>
<span class="p">};</span>

<span class="cp">#define PHYSDEVOP_get_nr_pirqs    22</span>
<span class="k">struct</span> <span class="n">physdev_nr_pirqs</span> <span class="p">{</span>
    <span class="cm">/* OUT */</span>
    <span class="kt">uint32_t</span> <span class="n">nr_pirqs</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* type is MAP_PIRQ_TYPE_GSI or MAP_PIRQ_TYPE_MSI</span>
<span class="cm"> * the hypercall returns a free pirq */</span>
<span class="cp">#define PHYSDEVOP_get_free_pirq    23</span>
<span class="k">struct</span> <span class="n">physdev_get_free_pirq</span> <span class="p">{</span>
    <span class="cm">/* IN */</span> 
    <span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
    <span class="cm">/* OUT */</span>
    <span class="kt">uint32_t</span> <span class="n">pirq</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define XEN_PCI_DEV_EXTFN              0x1</span>
<span class="cp">#define XEN_PCI_DEV_VIRTFN             0x2</span>
<span class="cp">#define XEN_PCI_DEV_PXM                0x4</span>

<span class="cp">#define PHYSDEVOP_pci_device_add        25</span>
<span class="k">struct</span> <span class="n">physdev_pci_device_add</span> <span class="p">{</span>
    <span class="cm">/* IN */</span>
    <span class="kt">uint16_t</span> <span class="n">seg</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">bus</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">devfn</span><span class="p">;</span>
    <span class="kt">uint32_t</span> <span class="n">flags</span><span class="p">;</span>
    <span class="k">struct</span> <span class="p">{</span>
        <span class="kt">uint8_t</span> <span class="n">bus</span><span class="p">;</span>
        <span class="kt">uint8_t</span> <span class="n">devfn</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">physfn</span><span class="p">;</span>
<span class="cp">#if defined(__STDC_VERSION__) &amp;&amp; __STDC_VERSION__ &gt;= 199901L</span>
    <span class="kt">uint32_t</span> <span class="n">optarr</span><span class="p">[];</span>
<span class="cp">#elif defined(__GNUC__)</span>
    <span class="kt">uint32_t</span> <span class="n">optarr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="cp">#define PHYSDEVOP_pci_device_remove     26</span>
<span class="cp">#define PHYSDEVOP_restore_msi_ext       27</span>
<span class="k">struct</span> <span class="n">physdev_pci_device</span> <span class="p">{</span>
    <span class="cm">/* IN */</span>
    <span class="kt">uint16_t</span> <span class="n">seg</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">bus</span><span class="p">;</span>
    <span class="kt">uint8_t</span> <span class="n">devfn</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Notify that some PIRQ-bound event channels have been unmasked.</span>
<span class="cm"> * ** This command is obsolete since interface version 0x00030202 and is **</span>
<span class="cm"> * ** unsupported by newer versions of Xen.				 **</span>
<span class="cm"> */</span>
<span class="cp">#define PHYSDEVOP_IRQ_UNMASK_NOTIFY	 4</span>

<span class="cm">/*</span>
<span class="cm"> * These all-capitals physdev operation names are superceded by the new names</span>
<span class="cm"> * (defined above) since interface version 0x00030202.</span>
<span class="cm"> */</span>
<span class="cp">#define PHYSDEVOP_IRQ_STATUS_QUERY	 PHYSDEVOP_irq_status_query</span>
<span class="cp">#define PHYSDEVOP_SET_IOPL		 PHYSDEVOP_set_iopl</span>
<span class="cp">#define PHYSDEVOP_SET_IOBITMAP		 PHYSDEVOP_set_iobitmap</span>
<span class="cp">#define PHYSDEVOP_APIC_READ		 PHYSDEVOP_apic_read</span>
<span class="cp">#define PHYSDEVOP_APIC_WRITE		 PHYSDEVOP_apic_write</span>
<span class="cp">#define PHYSDEVOP_ASSIGN_VECTOR		 PHYSDEVOP_alloc_irq_vector</span>
<span class="cp">#define PHYSDEVOP_FREE_VECTOR		 PHYSDEVOP_free_irq_vector</span>
<span class="cp">#define PHYSDEVOP_IRQ_NEEDS_UNMASK_NOTIFY XENIRQSTAT_needs_eoi</span>
<span class="cp">#define PHYSDEVOP_IRQ_SHARED		 XENIRQSTAT_shared</span>

<span class="cp">#endif </span><span class="cm">/* __XEN_PUBLIC_PHYSDEV_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
