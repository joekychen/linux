<!DOCTYPE html>
<html><head><title>joekychen/linux » include › media › v4l2-common.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>v4l2-common.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">    v4l2 common internal API header</span>

<span class="cm">    This header contains internal shared ioctl definitions for use by the</span>
<span class="cm">    internal low-level v4l2 drivers.</span>
<span class="cm">    Each ioctl begins with VIDIOC_INT_ to clearly mark that it is an internal</span>
<span class="cm">    define,</span>

<span class="cm">    Copyright (C) 2005  Hans Verkuil &lt;hverkuil@xs4all.nl&gt;</span>

<span class="cm">    This program is free software; you can redistribute it and/or modify</span>
<span class="cm">    it under the terms of the GNU General Public License as published by</span>
<span class="cm">    the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm">    (at your option) any later version.</span>

<span class="cm">    This program is distributed in the hope that it will be useful,</span>
<span class="cm">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">    GNU General Public License for more details.</span>

<span class="cm">    You should have received a copy of the GNU General Public License</span>
<span class="cm">    along with this program; if not, write to the Free Software</span>
<span class="cm">    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="cm"> */</span>

<span class="cp">#ifndef V4L2_COMMON_H_</span>
<span class="cp">#define V4L2_COMMON_H_</span>

<span class="cp">#include &lt;media/v4l2-dev.h&gt;</span>

<span class="cm">/* Common printk constucts for v4l-i2c drivers. These macros create a unique</span>
<span class="cm">   prefix consisting of the driver name, the adapter number and the i2c</span>
<span class="cm">   address. */</span>
<span class="cp">#define v4l_printk(level, name, adapter, addr, fmt, arg...) \</span>
<span class="cp">	printk(level &quot;%s %d-%04x: &quot; fmt, name, i2c_adapter_id(adapter), addr , ## arg)</span>

<span class="cp">#define v4l_client_printk(level, client, fmt, arg...)			    \</span>
<span class="cp">	v4l_printk(level, (client)-&gt;driver-&gt;driver.name, (client)-&gt;adapter, \</span>
<span class="cp">		   (client)-&gt;addr, fmt , ## arg)</span>

<span class="cp">#define v4l_err(client, fmt, arg...) \</span>
<span class="cp">	v4l_client_printk(KERN_ERR, client, fmt , ## arg)</span>

<span class="cp">#define v4l_warn(client, fmt, arg...) \</span>
<span class="cp">	v4l_client_printk(KERN_WARNING, client, fmt , ## arg)</span>

<span class="cp">#define v4l_info(client, fmt, arg...) \</span>
<span class="cp">	v4l_client_printk(KERN_INFO, client, fmt , ## arg)</span>

<span class="cm">/* These three macros assume that the debug level is set with a module</span>
<span class="cm">   parameter called &#39;debug&#39;. */</span>
<span class="cp">#define v4l_dbg(level, debug, client, fmt, arg...)			     \</span>
<span class="cp">	do { 								     \</span>
<span class="cp">		if (debug &gt;= (level))					     \</span>
<span class="cp">			v4l_client_printk(KERN_DEBUG, client, fmt , ## arg); \</span>
<span class="cp">	} while (0)</span>

<span class="cm">/* ------------------------------------------------------------------------- */</span>

<span class="cm">/* These printk constructs can be used with v4l2_device and v4l2_subdev */</span>
<span class="cp">#define v4l2_printk(level, dev, fmt, arg...) \</span>
<span class="cp">	printk(level &quot;%s: &quot; fmt, (dev)-&gt;name , ## arg)</span>

<span class="cp">#define v4l2_err(dev, fmt, arg...) \</span>
<span class="cp">	v4l2_printk(KERN_ERR, dev, fmt , ## arg)</span>

<span class="cp">#define v4l2_warn(dev, fmt, arg...) \</span>
<span class="cp">	v4l2_printk(KERN_WARNING, dev, fmt , ## arg)</span>

<span class="cp">#define v4l2_info(dev, fmt, arg...) \</span>
<span class="cp">	v4l2_printk(KERN_INFO, dev, fmt , ## arg)</span>

<span class="cm">/* These three macros assume that the debug level is set with a module</span>
<span class="cm">   parameter called &#39;debug&#39;. */</span>
<span class="cp">#define v4l2_dbg(level, debug, dev, fmt, arg...)			\</span>
<span class="cp">	do { 								\</span>
<span class="cp">		if (debug &gt;= (level))					\</span>
<span class="cp">			v4l2_printk(KERN_DEBUG, dev, fmt , ## arg); 	\</span>
<span class="cp">	} while (0)</span>

<span class="cm">/* ------------------------------------------------------------------------- */</span>

<span class="cm">/* Control helper functions */</span>

<span class="kt">int</span> <span class="n">v4l2_ctrl_check</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ext_control</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_queryctrl</span> <span class="o">*</span><span class="n">qctrl</span><span class="p">,</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">menu_items</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">v4l2_ctrl_get_name</span><span class="p">(</span><span class="n">u32</span> <span class="n">id</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">v4l2_ctrl_get_menu</span><span class="p">(</span><span class="n">u32</span> <span class="n">id</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_queryctrl</span> <span class="o">*</span><span class="n">qctrl</span><span class="p">,</span> <span class="n">s32</span> <span class="n">min</span><span class="p">,</span> <span class="n">s32</span> <span class="n">max</span><span class="p">,</span> <span class="n">s32</span> <span class="n">step</span><span class="p">,</span> <span class="n">s32</span> <span class="n">def</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">v4l2_ctrl_query_menu</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_querymenu</span> <span class="o">*</span><span class="n">qmenu</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">v4l2_queryctrl</span> <span class="o">*</span><span class="n">qctrl</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">menu_items</span><span class="p">);</span>
<span class="cp">#define V4L2_CTRL_MENU_IDS_END (0xffffffff)</span>
<span class="kt">int</span> <span class="n">v4l2_ctrl_query_menu_valid_items</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_querymenu</span> <span class="o">*</span><span class="n">qmenu</span><span class="p">,</span> <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">ids</span><span class="p">);</span>

<span class="cm">/* Note: ctrl_classes points to an array of u32 pointers. Each u32 array is a</span>
<span class="cm">   0-terminated array of control IDs. Each array must be sorted low to high</span>
<span class="cm">   and belong to the same control class. The array of u32 pointers must also</span>
<span class="cm">   be sorted, from low class IDs to high class IDs. */</span>
<span class="n">u32</span> <span class="n">v4l2_ctrl_next</span><span class="p">(</span><span class="k">const</span> <span class="n">u32</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">ctrl_classes</span><span class="p">,</span> <span class="n">u32</span> <span class="n">id</span><span class="p">);</span>

<span class="cm">/* ------------------------------------------------------------------------- */</span>

<span class="cm">/* Register/chip ident helper function */</span>

<span class="k">struct</span> <span class="n">i2c_client</span><span class="p">;</span> <span class="cm">/* forward reference */</span>
<span class="kt">int</span> <span class="n">v4l2_chip_match_i2c_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_dbg_match</span> <span class="o">*</span><span class="n">match</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">v4l2_chip_ident_i2c_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_dbg_chip_ident</span> <span class="o">*</span><span class="n">chip</span><span class="p">,</span>
		<span class="n">u32</span> <span class="n">ident</span><span class="p">,</span> <span class="n">u32</span> <span class="n">revision</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">v4l2_chip_match_host</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_dbg_match</span> <span class="o">*</span><span class="n">match</span><span class="p">);</span>

<span class="cm">/* ------------------------------------------------------------------------- */</span>

<span class="cm">/* I2C Helper functions */</span>

<span class="k">struct</span> <span class="n">i2c_driver</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">i2c_adapter</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">i2c_client</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">i2c_device_id</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">v4l2_device</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">v4l2_subdev</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">v4l2_subdev_ops</span><span class="p">;</span>


<span class="cm">/* Load an i2c module and return an initialized v4l2_subdev struct.</span>
<span class="cm">   The client_type argument is the name of the chip that&#39;s on the adapter. */</span>
<span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">v4l2_i2c_new_subdev</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_device</span> <span class="o">*</span><span class="n">v4l2_dev</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">client_type</span><span class="p">,</span>
		<span class="n">u8</span> <span class="n">addr</span><span class="p">,</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">probe_addrs</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">i2c_board_info</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">v4l2_i2c_new_subdev_board</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_device</span> <span class="o">*</span><span class="n">v4l2_dev</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
		<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">probe_addrs</span><span class="p">);</span>

<span class="cm">/* Initialize an v4l2_subdev with data from an i2c_client struct */</span>
<span class="kt">void</span> <span class="n">v4l2_i2c_subdev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_subdev_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">);</span>
<span class="cm">/* Return i2c client address of v4l2_subdev. */</span>
<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">v4l2_i2c_subdev_addr</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">);</span>

<span class="k">enum</span> <span class="n">v4l2_i2c_tuner_type</span> <span class="p">{</span>
	<span class="n">ADDRS_RADIO</span><span class="p">,</span>	<span class="cm">/* Radio tuner addresses */</span>
	<span class="n">ADDRS_DEMOD</span><span class="p">,</span>	<span class="cm">/* Demod tuner addresses */</span>
	<span class="n">ADDRS_TV</span><span class="p">,</span>	<span class="cm">/* TV tuner addresses */</span>
	<span class="cm">/* TV tuner addresses if demod is present, this excludes</span>
<span class="cm">	   addresses used by the demodulator from the list of</span>
<span class="cm">	   candidates. */</span>
	<span class="n">ADDRS_TV_WITH_DEMOD</span><span class="p">,</span>
<span class="p">};</span>
<span class="cm">/* Return a list of I2C tuner addresses to probe. Use only if the tuner</span>
<span class="cm">   addresses are unknown. */</span>
<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">v4l2_i2c_tuner_addrs</span><span class="p">(</span><span class="k">enum</span> <span class="n">v4l2_i2c_tuner_type</span> <span class="n">type</span><span class="p">);</span>

<span class="cm">/* ------------------------------------------------------------------------- */</span>

<span class="cm">/* SPI Helper functions */</span>
<span class="cp">#if defined(CONFIG_SPI)</span>

<span class="cp">#include &lt;linux/spi/spi.h&gt;</span>

<span class="k">struct</span> <span class="n">spi_device</span><span class="p">;</span>

<span class="cm">/* Load an spi module and return an initialized v4l2_subdev struct.</span>
<span class="cm">   The client_type argument is the name of the chip that&#39;s on the adapter. */</span>
<span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">v4l2_spi_new_subdev</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_device</span> <span class="o">*</span><span class="n">v4l2_dev</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">spi_master</span> <span class="o">*</span><span class="n">master</span><span class="p">,</span> <span class="k">struct</span> <span class="n">spi_board_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

<span class="cm">/* Initialize an v4l2_subdev with data from an spi_device struct */</span>
<span class="kt">void</span> <span class="n">v4l2_spi_subdev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">spi_device</span> <span class="o">*</span><span class="n">spi</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_subdev_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cm">/* ------------------------------------------------------------------------- */</span>

<span class="cm">/* Note: these remaining ioctls/structs should be removed as well, but they are</span>
<span class="cm">   still used in tuner-simple.c (TUNER_SET_CONFIG), cx18/ivtv (RESET) and</span>
<span class="cm">   v4l2-int-device.h (v4l2_routing). To remove these ioctls some more cleanup</span>
<span class="cm">   is needed in those modules. */</span>

<span class="cm">/* s_config */</span>
<span class="k">struct</span> <span class="n">v4l2_priv_tun_config</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">tuner</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define TUNER_SET_CONFIG           _IOW(&#39;d&#39;, 92, struct v4l2_priv_tun_config)</span>

<span class="cp">#define VIDIOC_INT_RESET            	_IOW (&#39;d&#39;, 102, u32)</span>

<span class="k">struct</span> <span class="n">v4l2_routing</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">input</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">output</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* ------------------------------------------------------------------------- */</span>

<span class="cm">/* Miscellaneous helper functions */</span>

<span class="kt">void</span> <span class="n">v4l_bound_align_image</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wmin</span><span class="p">,</span>
			   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wmax</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">walign</span><span class="p">,</span>
			   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">h</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hmin</span><span class="p">,</span>
			   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hmax</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">halign</span><span class="p">,</span>
			   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">salign</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">v4l_fill_dv_preset_info</span><span class="p">(</span><span class="n">u32</span> <span class="n">preset</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_dv_enum_preset</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">v4l2_discrete_probe</span> <span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_frmsize_discrete</span>	<span class="o">*</span><span class="n">sizes</span><span class="p">;</span>
	<span class="kt">int</span>					<span class="n">num_sizes</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_frmsize_discrete</span> <span class="o">*</span><span class="n">v4l2_find_nearest_format</span><span class="p">(</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_discrete_probe</span> <span class="o">*</span><span class="n">probe</span><span class="p">,</span>
		<span class="n">s32</span> <span class="n">width</span><span class="p">,</span> <span class="n">s32</span> <span class="n">height</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* V4L2_COMMON_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
