<!DOCTYPE html>
<html><head><title>joekychen/linux » include › trace › events › block.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>block.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#undef TRACE_SYSTEM</span>
<span class="cp">#define TRACE_SYSTEM block</span>

<span class="cp">#if !defined(_TRACE_BLOCK_H) || defined(TRACE_HEADER_MULTI_READ)</span>
<span class="cp">#define _TRACE_BLOCK_H</span>

<span class="cp">#include &lt;linux/blktrace_api.h&gt;</span>
<span class="cp">#include &lt;linux/blkdev.h&gt;</span>
<span class="cp">#include &lt;linux/tracepoint.h&gt;</span>

<span class="cp">#define RWBS_LEN	8</span>

<span class="n">DECLARE_EVENT_CLASS</span><span class="p">(</span><span class="n">block_rq_with_error</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">request</span> <span class="o">*</span><span class="n">rq</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rq</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__field</span><span class="p">(</span>  <span class="n">dev_t</span><span class="p">,</span>	<span class="n">dev</span>			<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span>  <span class="n">sector_t</span><span class="p">,</span>	<span class="n">sector</span>			<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span>  <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>	<span class="n">nr_sector</span>		<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span>  <span class="kt">int</span><span class="p">,</span>		<span class="n">errors</span>			<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span>  <span class="kt">char</span><span class="p">,</span>		<span class="n">rwbs</span><span class="p">,</span>	<span class="n">RWBS_LEN</span>	<span class="p">)</span>
		<span class="n">__dynamic_array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>	<span class="n">cmd</span><span class="p">,</span>	<span class="n">blk_cmd_buf_len</span><span class="p">(</span><span class="n">rq</span><span class="p">)</span>	<span class="p">)</span>
	<span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span>	   <span class="o">=</span> <span class="n">rq</span><span class="o">-&gt;</span><span class="n">rq_disk</span> <span class="o">?</span> <span class="n">disk_devt</span><span class="p">(</span><span class="n">rq</span><span class="o">-&gt;</span><span class="n">rq_disk</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span>    <span class="o">=</span> <span class="p">(</span><span class="n">rq</span><span class="o">-&gt;</span><span class="n">cmd_type</span> <span class="o">==</span> <span class="n">REQ_TYPE_BLOCK_PC</span><span class="p">)</span> <span class="o">?</span>
					<span class="mi">0</span> <span class="o">:</span> <span class="n">blk_rq_pos</span><span class="p">(</span><span class="n">rq</span><span class="p">);</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span> <span class="o">=</span> <span class="p">(</span><span class="n">rq</span><span class="o">-&gt;</span><span class="n">cmd_type</span> <span class="o">==</span> <span class="n">REQ_TYPE_BLOCK_PC</span><span class="p">)</span> <span class="o">?</span>
					<span class="mi">0</span> <span class="o">:</span> <span class="n">blk_rq_sectors</span><span class="p">(</span><span class="n">rq</span><span class="p">);</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">errors</span>    <span class="o">=</span> <span class="n">rq</span><span class="o">-&gt;</span><span class="n">errors</span><span class="p">;</span>

		<span class="n">blk_fill_rwbs</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span> <span class="n">rq</span><span class="o">-&gt;</span><span class="n">cmd_flags</span><span class="p">,</span> <span class="n">blk_rq_bytes</span><span class="p">(</span><span class="n">rq</span><span class="p">));</span>
		<span class="n">blk_dump_cmd</span><span class="p">(</span><span class="n">__get_str</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">rq</span><span class="p">);</span>
	<span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;%d,%d %s (%s) %llu + %u [%d]&quot;</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span> <span class="n">__get_str</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span><span class="p">,</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">errors</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_rq_abort - abort block operation request</span>
<span class="cm"> * @q: queue containing the block operation request</span>
<span class="cm"> * @rq: block IO operation request</span>
<span class="cm"> *</span>
<span class="cm"> * Called immediately after pending block IO operation request @rq in</span>
<span class="cm"> * queue @q is aborted. The fields in the operation request @rq</span>
<span class="cm"> * can be examined to determine which device and sectors the pending</span>
<span class="cm"> * operation would access.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_rq_with_error</span><span class="p">,</span> <span class="n">block_rq_abort</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">request</span> <span class="o">*</span><span class="n">rq</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rq</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_rq_requeue - place block IO request back on a queue</span>
<span class="cm"> * @q: queue holding operation</span>
<span class="cm"> * @rq: block IO operation request</span>
<span class="cm"> *</span>
<span class="cm"> * The block operation request @rq is being placed back into queue</span>
<span class="cm"> * @q.  For some reason the request was not completed and needs to be</span>
<span class="cm"> * put back in the queue.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_rq_with_error</span><span class="p">,</span> <span class="n">block_rq_requeue</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">request</span> <span class="o">*</span><span class="n">rq</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rq</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_rq_complete - block IO operation completed by device driver</span>
<span class="cm"> * @q: queue containing the block operation request</span>
<span class="cm"> * @rq: block operations request</span>
<span class="cm"> *</span>
<span class="cm"> * The block_rq_complete tracepoint event indicates that some portion</span>
<span class="cm"> * of operation request has been completed by the device driver.  If</span>
<span class="cm"> * the @rq-&gt;bio is %NULL, then there is absolutely no additional work to</span>
<span class="cm"> * do for the request. If @rq-&gt;bio is non-NULL then there is</span>
<span class="cm"> * additional work required to complete the request.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_rq_with_error</span><span class="p">,</span> <span class="n">block_rq_complete</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">request</span> <span class="o">*</span><span class="n">rq</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rq</span><span class="p">)</span>
<span class="p">);</span>

<span class="n">DECLARE_EVENT_CLASS</span><span class="p">(</span><span class="n">block_rq</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">request</span> <span class="o">*</span><span class="n">rq</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rq</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__field</span><span class="p">(</span>  <span class="n">dev_t</span><span class="p">,</span>	<span class="n">dev</span>			<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span>  <span class="n">sector_t</span><span class="p">,</span>	<span class="n">sector</span>			<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span>  <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>	<span class="n">nr_sector</span>		<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span>  <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>	<span class="n">bytes</span>			<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span>  <span class="kt">char</span><span class="p">,</span>		<span class="n">rwbs</span><span class="p">,</span>	<span class="n">RWBS_LEN</span>	<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span>  <span class="kt">char</span><span class="p">,</span>         <span class="n">comm</span><span class="p">,</span>   <span class="n">TASK_COMM_LEN</span>   <span class="p">)</span>
		<span class="n">__dynamic_array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>	<span class="n">cmd</span><span class="p">,</span>	<span class="n">blk_cmd_buf_len</span><span class="p">(</span><span class="n">rq</span><span class="p">)</span>	<span class="p">)</span>
	<span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span>	   <span class="o">=</span> <span class="n">rq</span><span class="o">-&gt;</span><span class="n">rq_disk</span> <span class="o">?</span> <span class="n">disk_devt</span><span class="p">(</span><span class="n">rq</span><span class="o">-&gt;</span><span class="n">rq_disk</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span>    <span class="o">=</span> <span class="p">(</span><span class="n">rq</span><span class="o">-&gt;</span><span class="n">cmd_type</span> <span class="o">==</span> <span class="n">REQ_TYPE_BLOCK_PC</span><span class="p">)</span> <span class="o">?</span>
					<span class="mi">0</span> <span class="o">:</span> <span class="n">blk_rq_pos</span><span class="p">(</span><span class="n">rq</span><span class="p">);</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span> <span class="o">=</span> <span class="p">(</span><span class="n">rq</span><span class="o">-&gt;</span><span class="n">cmd_type</span> <span class="o">==</span> <span class="n">REQ_TYPE_BLOCK_PC</span><span class="p">)</span> <span class="o">?</span>
					<span class="mi">0</span> <span class="o">:</span> <span class="n">blk_rq_sectors</span><span class="p">(</span><span class="n">rq</span><span class="p">);</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">bytes</span>     <span class="o">=</span> <span class="p">(</span><span class="n">rq</span><span class="o">-&gt;</span><span class="n">cmd_type</span> <span class="o">==</span> <span class="n">REQ_TYPE_BLOCK_PC</span><span class="p">)</span> <span class="o">?</span>
					<span class="n">blk_rq_bytes</span><span class="p">(</span><span class="n">rq</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>

		<span class="n">blk_fill_rwbs</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span> <span class="n">rq</span><span class="o">-&gt;</span><span class="n">cmd_flags</span><span class="p">,</span> <span class="n">blk_rq_bytes</span><span class="p">(</span><span class="n">rq</span><span class="p">));</span>
		<span class="n">blk_dump_cmd</span><span class="p">(</span><span class="n">__get_str</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span> <span class="n">rq</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">TASK_COMM_LEN</span><span class="p">);</span>
	<span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;%d,%d %s %u (%s) %llu + %u [%s]&quot;</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">bytes</span><span class="p">,</span> <span class="n">__get_str</span><span class="p">(</span><span class="n">cmd</span><span class="p">),</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span><span class="p">,</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_rq_insert - insert block operation request into queue</span>
<span class="cm"> * @q: target queue</span>
<span class="cm"> * @rq: block IO operation request</span>
<span class="cm"> *</span>
<span class="cm"> * Called immediately before block operation request @rq is inserted</span>
<span class="cm"> * into queue @q.  The fields in the operation request @rq struct can</span>
<span class="cm"> * be examined to determine which device and sectors the pending</span>
<span class="cm"> * operation would access.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_rq</span><span class="p">,</span> <span class="n">block_rq_insert</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">request</span> <span class="o">*</span><span class="n">rq</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rq</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_rq_issue - issue pending block IO request operation to device driver</span>
<span class="cm"> * @q: queue holding operation</span>
<span class="cm"> * @rq: block IO operation operation request</span>
<span class="cm"> *</span>
<span class="cm"> * Called when block operation request @rq from queue @q is sent to a</span>
<span class="cm"> * device driver for processing.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_rq</span><span class="p">,</span> <span class="n">block_rq_issue</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">request</span> <span class="o">*</span><span class="n">rq</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rq</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_bio_bounce - used bounce buffer when processing block operation</span>
<span class="cm"> * @q: queue holding the block operation</span>
<span class="cm"> * @bio: block operation</span>
<span class="cm"> *</span>
<span class="cm"> * A bounce buffer was used to handle the block operation @bio in @q.</span>
<span class="cm"> * This occurs when hardware limitations prevent a direct transfer of</span>
<span class="cm"> * data between the @bio data memory area and the IO device.  Use of a</span>
<span class="cm"> * bounce buffer requires extra copying of data and decreases</span>
<span class="cm"> * performance.</span>
<span class="cm"> */</span>
<span class="n">TRACE_EVENT</span><span class="p">(</span><span class="n">block_bio_bounce</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">dev_t</span><span class="p">,</span>		<span class="n">dev</span>			<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">sector_t</span><span class="p">,</span>	<span class="n">sector</span>			<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>	<span class="n">nr_sector</span>		<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">rwbs</span><span class="p">,</span>	<span class="n">RWBS_LEN</span>	<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">comm</span><span class="p">,</span>	<span class="n">TASK_COMM_LEN</span>	<span class="p">)</span>
	<span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span>		<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_bdev</span> <span class="o">?</span>
					  <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_bdev</span><span class="o">-&gt;</span><span class="n">bd_dev</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span>		<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_sector</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span>	<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_size</span> <span class="o">&gt;&gt;</span> <span class="mi">9</span><span class="p">;</span>
		<span class="n">blk_fill_rwbs</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_rw</span><span class="p">,</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_size</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">TASK_COMM_LEN</span><span class="p">);</span>
	<span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;%d,%d %s %llu + %u [%s]&quot;</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span><span class="p">,</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_bio_complete - completed all work on the block operation</span>
<span class="cm"> * @q: queue holding the block operation</span>
<span class="cm"> * @bio: block operation completed</span>
<span class="cm"> * @error: io error value</span>
<span class="cm"> *</span>
<span class="cm"> * This tracepoint indicates there is no further work to do on this</span>
<span class="cm"> * block IO operation @bio.</span>
<span class="cm"> */</span>
<span class="n">TRACE_EVENT</span><span class="p">(</span><span class="n">block_bio_complete</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="kt">int</span> <span class="n">error</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">,</span> <span class="n">error</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">dev_t</span><span class="p">,</span>		<span class="n">dev</span>		<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">sector_t</span><span class="p">,</span>	<span class="n">sector</span>		<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="kt">unsigned</span><span class="p">,</span>	<span class="n">nr_sector</span>	<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="kt">int</span><span class="p">,</span>		<span class="n">error</span>		<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">rwbs</span><span class="p">,</span>	<span class="n">RWBS_LEN</span><span class="p">)</span>
	<span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span>		<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_bdev</span><span class="o">-&gt;</span><span class="n">bd_dev</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span>		<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_sector</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span>	<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_size</span> <span class="o">&gt;&gt;</span> <span class="mi">9</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">error</span>		<span class="o">=</span> <span class="n">error</span><span class="p">;</span>
		<span class="n">blk_fill_rwbs</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_rw</span><span class="p">,</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_size</span><span class="p">);</span>
	<span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;%d,%d %s %llu + %u [%d]&quot;</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span><span class="p">,</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">)</span>
<span class="p">);</span>

<span class="n">DECLARE_EVENT_CLASS</span><span class="p">(</span><span class="n">block_bio</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">dev_t</span><span class="p">,</span>		<span class="n">dev</span>			<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">sector_t</span><span class="p">,</span>	<span class="n">sector</span>			<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>	<span class="n">nr_sector</span>		<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">rwbs</span><span class="p">,</span>	<span class="n">RWBS_LEN</span>	<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">comm</span><span class="p">,</span>	<span class="n">TASK_COMM_LEN</span>	<span class="p">)</span>
	<span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span>		<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_bdev</span><span class="o">-&gt;</span><span class="n">bd_dev</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span>		<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_sector</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span>	<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_size</span> <span class="o">&gt;&gt;</span> <span class="mi">9</span><span class="p">;</span>
		<span class="n">blk_fill_rwbs</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_rw</span><span class="p">,</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_size</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">TASK_COMM_LEN</span><span class="p">);</span>
	<span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;%d,%d %s %llu + %u [%s]&quot;</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span><span class="p">,</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_bio_backmerge - merging block operation to the end of an existing operation</span>
<span class="cm"> * @q: queue holding operation</span>
<span class="cm"> * @bio: new block operation to merge</span>
<span class="cm"> *</span>
<span class="cm"> * Merging block request @bio to the end of an existing block request</span>
<span class="cm"> * in queue @q.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_bio</span><span class="p">,</span> <span class="n">block_bio_backmerge</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_bio_frontmerge - merging block operation to the beginning of an existing operation</span>
<span class="cm"> * @q: queue holding operation</span>
<span class="cm"> * @bio: new block operation to merge</span>
<span class="cm"> *</span>
<span class="cm"> * Merging block IO operation @bio to the beginning of an existing block</span>
<span class="cm"> * operation in queue @q.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_bio</span><span class="p">,</span> <span class="n">block_bio_frontmerge</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_bio_queue - putting new block IO operation in queue</span>
<span class="cm"> * @q: queue holding operation</span>
<span class="cm"> * @bio: new block operation</span>
<span class="cm"> *</span>
<span class="cm"> * About to place the block IO operation @bio into queue @q.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_bio</span><span class="p">,</span> <span class="n">block_bio_queue</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">)</span>
<span class="p">);</span>

<span class="n">DECLARE_EVENT_CLASS</span><span class="p">(</span><span class="n">block_get_rq</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rw</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">,</span> <span class="n">rw</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">dev_t</span><span class="p">,</span>		<span class="n">dev</span>			<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">sector_t</span><span class="p">,</span>	<span class="n">sector</span>			<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>	<span class="n">nr_sector</span>		<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">rwbs</span><span class="p">,</span>	<span class="n">RWBS_LEN</span>	<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">comm</span><span class="p">,</span>	<span class="n">TASK_COMM_LEN</span>	<span class="p">)</span>
        <span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span>		<span class="o">=</span> <span class="n">bio</span> <span class="o">?</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_bdev</span><span class="o">-&gt;</span><span class="n">bd_dev</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span>		<span class="o">=</span> <span class="n">bio</span> <span class="o">?</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_sector</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span>	<span class="o">=</span> <span class="n">bio</span> <span class="o">?</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_size</span> <span class="o">&gt;&gt;</span> <span class="mi">9</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">blk_fill_rwbs</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span>
			      <span class="n">bio</span> <span class="o">?</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_rw</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">TASK_COMM_LEN</span><span class="p">);</span>
        <span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;%d,%d %s %llu + %u [%s]&quot;</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span><span class="p">,</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_getrq - get a free request entry in queue for block IO operations</span>
<span class="cm"> * @q: queue for operations</span>
<span class="cm"> * @bio: pending block IO operation</span>
<span class="cm"> * @rw: low bit indicates a read (%0) or a write (%1)</span>
<span class="cm"> *</span>
<span class="cm"> * A request struct for queue @q has been allocated to handle the</span>
<span class="cm"> * block IO operation @bio.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_get_rq</span><span class="p">,</span> <span class="n">block_getrq</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rw</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">,</span> <span class="n">rw</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_sleeprq - waiting to get a free request entry in queue for block IO operation</span>
<span class="cm"> * @q: queue for operation</span>
<span class="cm"> * @bio: pending block IO operation</span>
<span class="cm"> * @rw: low bit indicates a read (%0) or a write (%1)</span>
<span class="cm"> *</span>
<span class="cm"> * In the case where a request struct cannot be provided for queue @q</span>
<span class="cm"> * the process needs to wait for an request struct to become</span>
<span class="cm"> * available.  This tracepoint event is generated each time the</span>
<span class="cm"> * process goes to sleep waiting for request struct become available.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_get_rq</span><span class="p">,</span> <span class="n">block_sleeprq</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rw</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">,</span> <span class="n">rw</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_plug - keep operations requests in request queue</span>
<span class="cm"> * @q: request queue to plug</span>
<span class="cm"> *</span>
<span class="cm"> * Plug the request queue @q.  Do not allow block operation requests</span>
<span class="cm"> * to be sent to the device driver. Instead, accumulate requests in</span>
<span class="cm"> * the queue to improve throughput performance of the block device.</span>
<span class="cm"> */</span>
<span class="n">TRACE_EVENT</span><span class="p">(</span><span class="n">block_plug</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">comm</span><span class="p">,</span>	<span class="n">TASK_COMM_LEN</span>	<span class="p">)</span>
	<span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">TASK_COMM_LEN</span><span class="p">);</span>
	<span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;[%s]&quot;</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">)</span>
<span class="p">);</span>

<span class="n">DECLARE_EVENT_CLASS</span><span class="p">(</span><span class="n">block_unplug</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">depth</span><span class="p">,</span> <span class="n">bool</span> <span class="n">explicit</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">explicit</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__field</span><span class="p">(</span> <span class="kt">int</span><span class="p">,</span>		<span class="n">nr_rq</span>			<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">comm</span><span class="p">,</span>	<span class="n">TASK_COMM_LEN</span>	<span class="p">)</span>
	<span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_rq</span> <span class="o">=</span> <span class="n">depth</span><span class="p">;</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">TASK_COMM_LEN</span><span class="p">);</span>
	<span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;[%s] %d&quot;</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_rq</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_unplug - release of operations requests in request queue</span>
<span class="cm"> * @q: request queue to unplug</span>
<span class="cm"> * @depth: number of requests just added to the queue</span>
<span class="cm"> * @explicit: whether this was an explicit unplug, or one from schedule()</span>
<span class="cm"> *</span>
<span class="cm"> * Unplug request queue @q because device driver is scheduled to work</span>
<span class="cm"> * on elements in the request queue.</span>
<span class="cm"> */</span>
<span class="n">DEFINE_EVENT</span><span class="p">(</span><span class="n">block_unplug</span><span class="p">,</span> <span class="n">block_unplug</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">depth</span><span class="p">,</span> <span class="n">bool</span> <span class="n">explicit</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">explicit</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_split - split a single bio struct into two bio structs</span>
<span class="cm"> * @q: queue containing the bio</span>
<span class="cm"> * @bio: block operation being split</span>
<span class="cm"> * @new_sector: The starting sector for the new bio</span>
<span class="cm"> *</span>
<span class="cm"> * The bio request @bio in request queue @q needs to be split into two</span>
<span class="cm"> * bio requests. The newly created @bio request starts at</span>
<span class="cm"> * @new_sector. This split may be required due to hardware limitation</span>
<span class="cm"> * such as operation crossing device boundaries in a RAID system.</span>
<span class="cm"> */</span>
<span class="n">TRACE_EVENT</span><span class="p">(</span><span class="n">block_split</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span>
		 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">new_sector</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">,</span> <span class="n">new_sector</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">dev_t</span><span class="p">,</span>		<span class="n">dev</span>				<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">sector_t</span><span class="p">,</span>	<span class="n">sector</span>				<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">sector_t</span><span class="p">,</span>	<span class="n">new_sector</span>			<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">rwbs</span><span class="p">,</span>		<span class="n">RWBS_LEN</span>	<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">comm</span><span class="p">,</span>		<span class="n">TASK_COMM_LEN</span>	<span class="p">)</span>
	<span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span>		<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_bdev</span><span class="o">-&gt;</span><span class="n">bd_dev</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span>		<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_sector</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">new_sector</span>	<span class="o">=</span> <span class="n">new_sector</span><span class="p">;</span>
		<span class="n">blk_fill_rwbs</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_rw</span><span class="p">,</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_size</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">,</span> <span class="n">TASK_COMM_LEN</span><span class="p">);</span>
	<span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;%d,%d %s %llu / %llu [%s]&quot;</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span><span class="p">,</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">new_sector</span><span class="p">,</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_bio_remap - map request for a logical device to the raw device</span>
<span class="cm"> * @q: queue holding the operation</span>
<span class="cm"> * @bio: revised operation</span>
<span class="cm"> * @dev: device for the operation</span>
<span class="cm"> * @from: original sector for the operation</span>
<span class="cm"> *</span>
<span class="cm"> * An operation for a logical device has been mapped to the</span>
<span class="cm"> * raw block device.</span>
<span class="cm"> */</span>
<span class="n">TRACE_EVENT</span><span class="p">(</span><span class="n">block_bio_remap</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">bio</span><span class="p">,</span> <span class="n">dev_t</span> <span class="n">dev</span><span class="p">,</span>
		 <span class="n">sector_t</span> <span class="n">from</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">bio</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="n">from</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">dev_t</span><span class="p">,</span>		<span class="n">dev</span>		<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">sector_t</span><span class="p">,</span>	<span class="n">sector</span>		<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>	<span class="n">nr_sector</span>	<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">dev_t</span><span class="p">,</span>		<span class="n">old_dev</span>		<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">sector_t</span><span class="p">,</span>	<span class="n">old_sector</span>	<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">rwbs</span><span class="p">,</span>	<span class="n">RWBS_LEN</span><span class="p">)</span>
	<span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span>		<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_bdev</span><span class="o">-&gt;</span><span class="n">bd_dev</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span>		<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_sector</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span>	<span class="o">=</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_size</span> <span class="o">&gt;&gt;</span> <span class="mi">9</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">old_dev</span>	<span class="o">=</span> <span class="n">dev</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">old_sector</span>	<span class="o">=</span> <span class="n">from</span><span class="p">;</span>
		<span class="n">blk_fill_rwbs</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_rw</span><span class="p">,</span> <span class="n">bio</span><span class="o">-&gt;</span><span class="n">bi_size</span><span class="p">);</span>
	<span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;%d,%d %s %llu + %u &lt;- (%d,%d) %llu&quot;</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span><span class="p">,</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">old_dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">old_dev</span><span class="p">),</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">old_sector</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * block_rq_remap - map request for a block operation request</span>
<span class="cm"> * @q: queue holding the operation</span>
<span class="cm"> * @rq: block IO operation request</span>
<span class="cm"> * @dev: device for the operation</span>
<span class="cm"> * @from: original sector for the operation</span>
<span class="cm"> *</span>
<span class="cm"> * The block operation request @rq in @q has been remapped.  The block</span>
<span class="cm"> * operation request @rq holds the current information and @from hold</span>
<span class="cm"> * the original sector.</span>
<span class="cm"> */</span>
<span class="n">TRACE_EVENT</span><span class="p">(</span><span class="n">block_rq_remap</span><span class="p">,</span>

	<span class="n">TP_PROTO</span><span class="p">(</span><span class="k">struct</span> <span class="n">request_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">request</span> <span class="o">*</span><span class="n">rq</span><span class="p">,</span> <span class="n">dev_t</span> <span class="n">dev</span><span class="p">,</span>
		 <span class="n">sector_t</span> <span class="n">from</span><span class="p">),</span>

	<span class="n">TP_ARGS</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">rq</span><span class="p">,</span> <span class="n">dev</span><span class="p">,</span> <span class="n">from</span><span class="p">),</span>

	<span class="n">TP_STRUCT__entry</span><span class="p">(</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">dev_t</span><span class="p">,</span>		<span class="n">dev</span>		<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">sector_t</span><span class="p">,</span>	<span class="n">sector</span>		<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>	<span class="n">nr_sector</span>	<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">dev_t</span><span class="p">,</span>		<span class="n">old_dev</span>		<span class="p">)</span>
		<span class="n">__field</span><span class="p">(</span> <span class="n">sector_t</span><span class="p">,</span>	<span class="n">old_sector</span>	<span class="p">)</span>
		<span class="n">__array</span><span class="p">(</span> <span class="kt">char</span><span class="p">,</span>		<span class="n">rwbs</span><span class="p">,</span>	<span class="n">RWBS_LEN</span><span class="p">)</span>
	<span class="p">),</span>

	<span class="n">TP_fast_assign</span><span class="p">(</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span>		<span class="o">=</span> <span class="n">disk_devt</span><span class="p">(</span><span class="n">rq</span><span class="o">-&gt;</span><span class="n">rq_disk</span><span class="p">);</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span>		<span class="o">=</span> <span class="n">blk_rq_pos</span><span class="p">(</span><span class="n">rq</span><span class="p">);</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span>	<span class="o">=</span> <span class="n">blk_rq_sectors</span><span class="p">(</span><span class="n">rq</span><span class="p">);</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">old_dev</span>	<span class="o">=</span> <span class="n">dev</span><span class="p">;</span>
		<span class="n">__entry</span><span class="o">-&gt;</span><span class="n">old_sector</span>	<span class="o">=</span> <span class="n">from</span><span class="p">;</span>
		<span class="n">blk_fill_rwbs</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span> <span class="n">rq</span><span class="o">-&gt;</span><span class="n">cmd_flags</span><span class="p">,</span> <span class="n">blk_rq_bytes</span><span class="p">(</span><span class="n">rq</span><span class="p">));</span>
	<span class="p">),</span>

	<span class="n">TP_printk</span><span class="p">(</span><span class="s">&quot;%d,%d %s %llu + %u &lt;- (%d,%d) %llu&quot;</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">),</span> <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">rwbs</span><span class="p">,</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">sector</span><span class="p">,</span>
		  <span class="n">__entry</span><span class="o">-&gt;</span><span class="n">nr_sector</span><span class="p">,</span>
		  <span class="n">MAJOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">old_dev</span><span class="p">),</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">old_dev</span><span class="p">),</span>
		  <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">__entry</span><span class="o">-&gt;</span><span class="n">old_sector</span><span class="p">)</span>
<span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* _TRACE_BLOCK_H */</span><span class="cp"></span>

<span class="cm">/* This part must be outside protection */</span>
<span class="cp">#include &lt;trace/define_trace.h&gt;</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
