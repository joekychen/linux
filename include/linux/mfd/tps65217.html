<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › mfd › tps65217.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tps65217.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * linux/mfd/tps65217.h</span>
<span class="cm"> *</span>
<span class="cm"> * Functions to access TPS65217 power management chip.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2011 Texas Instruments Incorporated - http://www.ti.com/</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation version 2.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed &quot;as is&quot; WITHOUT ANY WARRANTY of any</span>
<span class="cm"> * kind, whether express or implied; without even the implied warranty</span>
<span class="cm"> * of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __LINUX_MFD_TPS65217_H</span>
<span class="cp">#define __LINUX_MFD_TPS65217_H</span>

<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/regulator/driver.h&gt;</span>
<span class="cp">#include &lt;linux/regulator/machine.h&gt;</span>

<span class="cm">/* I2C ID for TPS65217 part */</span>
<span class="cp">#define TPS65217_I2C_ID			0x24</span>

<span class="cm">/* All register addresses */</span>
<span class="cp">#define TPS65217_REG_CHIPID		0X00</span>
<span class="cp">#define TPS65217_REG_PPATH		0X01</span>
<span class="cp">#define TPS65217_REG_INT		0X02</span>
<span class="cp">#define TPS65217_REG_CHGCONFIG0		0X03</span>
<span class="cp">#define TPS65217_REG_CHGCONFIG1		0X04</span>
<span class="cp">#define TPS65217_REG_CHGCONFIG2		0X05</span>
<span class="cp">#define TPS65217_REG_CHGCONFIG3		0X06</span>
<span class="cp">#define TPS65217_REG_WLEDCTRL1		0X07</span>
<span class="cp">#define TPS65217_REG_WLEDCTRL2		0X08</span>
<span class="cp">#define TPS65217_REG_MUXCTRL		0X09</span>
<span class="cp">#define TPS65217_REG_STATUS		0X0A</span>
<span class="cp">#define TPS65217_REG_PASSWORD		0X0B</span>
<span class="cp">#define TPS65217_REG_PGOOD		0X0C</span>
<span class="cp">#define TPS65217_REG_DEFPG		0X0D</span>
<span class="cp">#define TPS65217_REG_DEFDCDC1		0X0E</span>
<span class="cp">#define TPS65217_REG_DEFDCDC2		0X0F</span>
<span class="cp">#define TPS65217_REG_DEFDCDC3		0X10</span>
<span class="cp">#define TPS65217_REG_DEFSLEW		0X11</span>
<span class="cp">#define TPS65217_REG_DEFLDO1		0X12</span>
<span class="cp">#define TPS65217_REG_DEFLDO2		0X13</span>
<span class="cp">#define TPS65217_REG_DEFLS1		0X14</span>
<span class="cp">#define TPS65217_REG_DEFLS2		0X15</span>
<span class="cp">#define TPS65217_REG_ENABLE		0X16</span>
<span class="cp">#define TPS65217_REG_DEFUVLO		0X18</span>
<span class="cp">#define TPS65217_REG_SEQ1		0X19</span>
<span class="cp">#define TPS65217_REG_SEQ2		0X1A</span>
<span class="cp">#define TPS65217_REG_SEQ3		0X1B</span>
<span class="cp">#define TPS65217_REG_SEQ4		0X1C</span>
<span class="cp">#define TPS65217_REG_SEQ5		0X1D</span>
<span class="cp">#define TPS65217_REG_SEQ6		0X1E</span>

<span class="cm">/* Register field definitions */</span>
<span class="cp">#define TPS65217_CHIPID_CHIP_MASK	0xF0</span>
<span class="cp">#define TPS65217_CHIPID_REV_MASK	0x0F</span>

<span class="cp">#define TPS65217_PPATH_ACSINK_ENABLE	BIT(7)</span>
<span class="cp">#define TPS65217_PPATH_USBSINK_ENABLE	BIT(6)</span>
<span class="cp">#define TPS65217_PPATH_AC_PW_ENABLE	BIT(5)</span>
<span class="cp">#define TPS65217_PPATH_USB_PW_ENABLE	BIT(4)</span>
<span class="cp">#define TPS65217_PPATH_AC_CURRENT_MASK	0x0C</span>
<span class="cp">#define TPS65217_PPATH_USB_CURRENT_MASK	0x03</span>

<span class="cp">#define TPS65217_INT_PBM		BIT(6)</span>
<span class="cp">#define TPS65217_INT_ACM		BIT(5)</span>
<span class="cp">#define TPS65217_INT_USBM		BIT(4)</span>
<span class="cp">#define TPS65217_INT_PBI		BIT(2)</span>
<span class="cp">#define TPS65217_INT_ACI		BIT(1)</span>
<span class="cp">#define TPS65217_INT_USBI		BIT(0)</span>

<span class="cp">#define TPS65217_CHGCONFIG0_TREG	BIT(7)</span>
<span class="cp">#define TPS65217_CHGCONFIG0_DPPM	BIT(6)</span>
<span class="cp">#define TPS65217_CHGCONFIG0_TSUSP	BIT(5)</span>
<span class="cp">#define TPS65217_CHGCONFIG0_TERMI	BIT(4)</span>
<span class="cp">#define TPS65217_CHGCONFIG0_ACTIVE	BIT(3)</span>
<span class="cp">#define TPS65217_CHGCONFIG0_CHGTOUT	BIT(2)</span>
<span class="cp">#define TPS65217_CHGCONFIG0_PCHGTOUT	BIT(1)</span>
<span class="cp">#define TPS65217_CHGCONFIG0_BATTEMP	BIT(0)</span>

<span class="cp">#define TPS65217_CHGCONFIG1_TMR_MASK	0xC0</span>
<span class="cp">#define TPS65217_CHGCONFIG1_TMR_ENABLE	BIT(5)</span>
<span class="cp">#define TPS65217_CHGCONFIG1_NTC_TYPE	BIT(4)</span>
<span class="cp">#define TPS65217_CHGCONFIG1_RESET	BIT(3)</span>
<span class="cp">#define TPS65217_CHGCONFIG1_TERM	BIT(2)</span>
<span class="cp">#define TPS65217_CHGCONFIG1_SUSP	BIT(1)</span>
<span class="cp">#define TPS65217_CHGCONFIG1_CHG_EN	BIT(0)</span>

<span class="cp">#define TPS65217_CHGCONFIG2_DYNTMR	BIT(7)</span>
<span class="cp">#define TPS65217_CHGCONFIG2_VPREGHG	BIT(6)</span>
<span class="cp">#define TPS65217_CHGCONFIG2_VOREG_MASK	0x30</span>

<span class="cp">#define TPS65217_CHGCONFIG3_ICHRG_MASK	0xC0</span>
<span class="cp">#define TPS65217_CHGCONFIG3_DPPMTH_MASK	0x30</span>
<span class="cp">#define TPS65217_CHGCONFIG2_PCHRGT	BIT(3)</span>
<span class="cp">#define TPS65217_CHGCONFIG2_TERMIF	0x06</span>
<span class="cp">#define TPS65217_CHGCONFIG2_TRANGE	BIT(0)</span>

<span class="cp">#define TPS65217_WLEDCTRL1_ISINK_ENABLE	BIT(3)</span>
<span class="cp">#define TPS65217_WLEDCTRL1_ISEL		BIT(2)</span>
<span class="cp">#define TPS65217_WLEDCTRL1_FDIM_MASK	0x03</span>

<span class="cp">#define TPS65217_WLEDCTRL2_DUTY_MASK	0x7F</span>

<span class="cp">#define TPS65217_MUXCTRL_MUX_MASK	0x07</span>

<span class="cp">#define TPS65217_STATUS_OFF		BIT(7)</span>
<span class="cp">#define TPS65217_STATUS_ACPWR		BIT(3)</span>
<span class="cp">#define TPS65217_STATUS_USBPWR		BIT(2)</span>
<span class="cp">#define TPS65217_STATUS_PB		BIT(0)</span>

<span class="cp">#define TPS65217_PASSWORD_REGS_UNLOCK	0x7D</span>

<span class="cp">#define TPS65217_PGOOD_LDO3_PG		BIT(6)</span>
<span class="cp">#define TPS65217_PGOOD_LDO4_PG		BIT(5)</span>
<span class="cp">#define TPS65217_PGOOD_DC1_PG		BIT(4)</span>
<span class="cp">#define TPS65217_PGOOD_DC2_PG		BIT(3)</span>
<span class="cp">#define TPS65217_PGOOD_DC3_PG		BIT(2)</span>
<span class="cp">#define TPS65217_PGOOD_LDO1_PG		BIT(1)</span>
<span class="cp">#define TPS65217_PGOOD_LDO2_PG		BIT(0)</span>

<span class="cp">#define TPS65217_DEFPG_LDO1PGM		BIT(3)</span>
<span class="cp">#define TPS65217_DEFPG_LDO2PGM		BIT(2)</span>
<span class="cp">#define TPS65217_DEFPG_PGDLY_MASK	0x03</span>

<span class="cp">#define TPS65217_DEFDCDCX_XADJX		BIT(7)</span>
<span class="cp">#define TPS65217_DEFDCDCX_DCDC_MASK	0x3F</span>

<span class="cp">#define TPS65217_DEFSLEW_GO		BIT(7)</span>
<span class="cp">#define TPS65217_DEFSLEW_GODSBL		BIT(6)</span>
<span class="cp">#define TPS65217_DEFSLEW_PFM_EN1	BIT(5)</span>
<span class="cp">#define TPS65217_DEFSLEW_PFM_EN2	BIT(4)</span>
<span class="cp">#define TPS65217_DEFSLEW_PFM_EN3	BIT(3)</span>
<span class="cp">#define TPS65217_DEFSLEW_SLEW_MASK	0x07</span>

<span class="cp">#define TPS65217_DEFLDO1_LDO1_MASK	0x0F</span>

<span class="cp">#define TPS65217_DEFLDO2_TRACK		BIT(6)</span>
<span class="cp">#define TPS65217_DEFLDO2_LDO2_MASK	0x3F</span>

<span class="cp">#define TPS65217_DEFLDO3_LDO3_EN	BIT(5)</span>
<span class="cp">#define TPS65217_DEFLDO3_LDO3_MASK	0x1F</span>

<span class="cp">#define TPS65217_DEFLDO4_LDO4_EN	BIT(5)</span>
<span class="cp">#define TPS65217_DEFLDO4_LDO4_MASK	0x1F</span>

<span class="cp">#define TPS65217_ENABLE_LS1_EN		BIT(6)</span>
<span class="cp">#define TPS65217_ENABLE_LS2_EN		BIT(5)</span>
<span class="cp">#define TPS65217_ENABLE_DC1_EN		BIT(4)</span>
<span class="cp">#define TPS65217_ENABLE_DC2_EN		BIT(3)</span>
<span class="cp">#define TPS65217_ENABLE_DC3_EN		BIT(2)</span>
<span class="cp">#define TPS65217_ENABLE_LDO1_EN		BIT(1)</span>
<span class="cp">#define TPS65217_ENABLE_LDO2_EN		BIT(0)</span>

<span class="cp">#define TPS65217_DEFUVLO_UVLOHYS	BIT(2)</span>
<span class="cp">#define TPS65217_DEFUVLO_UVLO_MASK	0x03</span>

<span class="cp">#define TPS65217_SEQ1_DC1_SEQ_MASK	0xF0</span>
<span class="cp">#define TPS65217_SEQ1_DC2_SEQ_MASK	0x0F</span>

<span class="cp">#define TPS65217_SEQ2_DC3_SEQ_MASK	0xF0</span>
<span class="cp">#define TPS65217_SEQ2_LDO1_SEQ_MASK	0x0F</span>

<span class="cp">#define TPS65217_SEQ3_LDO2_SEQ_MASK	0xF0</span>
<span class="cp">#define TPS65217_SEQ3_LDO3_SEQ_MASK	0x0F</span>

<span class="cp">#define TPS65217_SEQ4_LDO4_SEQ_MASK	0xF0</span>

<span class="cp">#define TPS65217_SEQ5_DLY1_MASK		0xC0</span>
<span class="cp">#define TPS65217_SEQ5_DLY2_MASK		0x30</span>
<span class="cp">#define TPS65217_SEQ5_DLY3_MASK		0x0C</span>
<span class="cp">#define TPS65217_SEQ5_DLY4_MASK		0x03</span>

<span class="cp">#define TPS65217_SEQ6_DLY5_MASK		0xC0</span>
<span class="cp">#define TPS65217_SEQ6_DLY6_MASK		0x30</span>
<span class="cp">#define TPS65217_SEQ6_SEQUP		BIT(2)</span>
<span class="cp">#define TPS65217_SEQ6_SEQDWN		BIT(1)</span>
<span class="cp">#define TPS65217_SEQ6_INSTDWN		BIT(0)</span>

<span class="cp">#define TPS65217_MAX_REGISTER		0x1E</span>
<span class="cp">#define TPS65217_PROTECT_NONE		0</span>
<span class="cp">#define TPS65217_PROTECT_L1		1</span>
<span class="cp">#define TPS65217_PROTECT_L2		2</span>


<span class="k">enum</span> <span class="n">tps65217_regulator_id</span> <span class="p">{</span>
	<span class="cm">/* DCDC&#39;s */</span>
	<span class="n">TPS65217_DCDC_1</span><span class="p">,</span>
	<span class="n">TPS65217_DCDC_2</span><span class="p">,</span>
	<span class="n">TPS65217_DCDC_3</span><span class="p">,</span>
	<span class="cm">/* LDOs */</span>
	<span class="n">TPS65217_LDO_1</span><span class="p">,</span>
	<span class="n">TPS65217_LDO_2</span><span class="p">,</span>
	<span class="n">TPS65217_LDO_3</span><span class="p">,</span>
	<span class="n">TPS65217_LDO_4</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define TPS65217_MAX_REG_ID		TPS65217_LDO_4</span>

<span class="cm">/* Number of step-down converters available */</span>
<span class="cp">#define TPS65217_NUM_DCDC		3</span>
<span class="cm">/* Number of LDO voltage regulators available */</span>
<span class="cp">#define TPS65217_NUM_LDO		4</span>
<span class="cm">/* Number of total regulators available */</span>
<span class="cp">#define TPS65217_NUM_REGULATOR		(TPS65217_NUM_DCDC + TPS65217_NUM_LDO)</span>

<span class="cm">/**</span>
<span class="cm"> * struct tps65217_board - packages regulator init data</span>
<span class="cm"> * @tps65217_regulator_data: regulator initialization values</span>
<span class="cm"> *</span>
<span class="cm"> * Board data may be used to initialize regulator.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">tps65217_board</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="o">*</span><span class="n">tps65217_init_data</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct tps_info - packages regulator constraints</span>
<span class="cm"> * @name:		Voltage regulator name</span>
<span class="cm"> * @min_uV:		minimum micro volts</span>
<span class="cm"> * @max_uV:		minimum micro volts</span>
<span class="cm"> * @vsel_to_uv:		Function pointer to get voltage from selector</span>
<span class="cm"> * @uv_to_vsel:		Function pointer to get selector from voltage</span>
<span class="cm"> * @table:		Table for non-uniform voltage step-size</span>
<span class="cm"> * @table_len:		Length of the voltage table</span>
<span class="cm"> * @enable_mask:	Regulator enable mask bits</span>
<span class="cm"> * @set_vout_reg:	Regulator output voltage set register</span>
<span class="cm"> * @set_vout_mask:	Regulator output voltage set mask</span>
<span class="cm"> *</span>
<span class="cm"> * This data is used to check the regualtor voltage limits while setting.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">tps_info</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">min_uV</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">max_uV</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">vsel_to_uv</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vsel</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">uv_to_vsel</span><span class="p">)(</span><span class="kt">int</span> <span class="n">uV</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">vsel</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">table</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">table_len</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">enable_mask</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">set_vout_reg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">set_vout_mask</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct tps65217 - tps65217 sub-driver chip access routines</span>
<span class="cm"> *</span>
<span class="cm"> * Device data may be used to access the TPS65217 chip</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">tps65217</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tps65217_board</span> <span class="o">*</span><span class="n">pdata</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">regulator_desc</span> <span class="n">desc</span><span class="p">[</span><span class="n">TPS65217_NUM_REGULATOR</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">regulator_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">[</span><span class="n">TPS65217_NUM_REGULATOR</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">tps_info</span> <span class="o">*</span><span class="n">info</span><span class="p">[</span><span class="n">TPS65217_NUM_REGULATOR</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">regmap</span> <span class="o">*</span><span class="n">regmap</span><span class="p">;</span>

	<span class="cm">/* Client devices */</span>
	<span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">regulator_pdev</span><span class="p">[</span><span class="n">TPS65217_NUM_REGULATOR</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">tps65217</span> <span class="o">*</span><span class="nf">dev_to_tps65217</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev_get_drvdata</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">tps65217_reg_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">tps65217</span> <span class="o">*</span><span class="n">tps</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">tps65217_reg_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">tps65217</span> <span class="o">*</span><span class="n">tps</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">level</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">tps65217_set_bits</span><span class="p">(</span><span class="k">struct</span> <span class="n">tps65217</span> <span class="o">*</span><span class="n">tps</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">level</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">tps65217_clear_bits</span><span class="p">(</span><span class="k">struct</span> <span class="n">tps65217</span> <span class="o">*</span><span class="n">tps</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">level</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/*  __LINUX_MFD_TPS65217_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
