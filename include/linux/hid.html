<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › hid.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>hid.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __HID_H</span>
<span class="cp">#define __HID_H</span>

<span class="cm">/*</span>
<span class="cm"> *  Copyright (c) 1999 Andreas Gal</span>
<span class="cm"> *  Copyright (c) 2000-2001 Vojtech Pavlik</span>
<span class="cm"> *  Copyright (c) 2006-2007 Jiri Kosina</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> * Should you need to contact me, the author, you can do so either by</span>
<span class="cm"> * e-mail - mail your message to &lt;vojtech@ucw.cz&gt;, or by paper mail:</span>
<span class="cm"> * Vojtech Pavlik, Simunkova 1594, Prague 8, 182 00 Czech Republic</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * USB HID (Human Interface Device) interface class code</span>
<span class="cm"> */</span>

<span class="cp">#define USB_INTERFACE_CLASS_HID		3</span>

<span class="cm">/*</span>
<span class="cm"> * USB HID interface subclass and protocol codes</span>
<span class="cm"> */</span>

<span class="cp">#define USB_INTERFACE_SUBCLASS_BOOT	1</span>
<span class="cp">#define USB_INTERFACE_PROTOCOL_KEYBOARD	1</span>
<span class="cp">#define USB_INTERFACE_PROTOCOL_MOUSE	2</span>

<span class="cm">/*</span>
<span class="cm"> * HID class requests</span>
<span class="cm"> */</span>

<span class="cp">#define HID_REQ_GET_REPORT		0x01</span>
<span class="cp">#define HID_REQ_GET_IDLE		0x02</span>
<span class="cp">#define HID_REQ_GET_PROTOCOL		0x03</span>
<span class="cp">#define HID_REQ_SET_REPORT		0x09</span>
<span class="cp">#define HID_REQ_SET_IDLE		0x0A</span>
<span class="cp">#define HID_REQ_SET_PROTOCOL		0x0B</span>

<span class="cm">/*</span>
<span class="cm"> * HID class descriptor types</span>
<span class="cm"> */</span>

<span class="cp">#define HID_DT_HID			(USB_TYPE_CLASS | 0x01)</span>
<span class="cp">#define HID_DT_REPORT			(USB_TYPE_CLASS | 0x02)</span>
<span class="cp">#define HID_DT_PHYSICAL			(USB_TYPE_CLASS | 0x03)</span>

<span class="cp">#define HID_MAX_DESCRIPTOR_SIZE		4096</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/mod_devicetable.h&gt; </span><span class="cm">/* hid_device_id */</span><span class="cp"></span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/workqueue.h&gt;</span>
<span class="cp">#include &lt;linux/input.h&gt;</span>
<span class="cp">#include &lt;linux/semaphore.h&gt;</span>
<span class="cp">#include &lt;linux/power_supply.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * We parse each description item into this structure. Short items data</span>
<span class="cm"> * values are expanded to 32-bit signed int, long items contain a pointer</span>
<span class="cm"> * into the data area.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">hid_item</span> <span class="p">{</span>
	<span class="kt">unsigned</span>  <span class="n">format</span><span class="p">;</span>
	<span class="n">__u8</span>      <span class="n">size</span><span class="p">;</span>
	<span class="n">__u8</span>      <span class="n">type</span><span class="p">;</span>
	<span class="n">__u8</span>      <span class="n">tag</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
	    <span class="n">__u8</span>   <span class="n">u8</span><span class="p">;</span>
	    <span class="n">__s8</span>   <span class="n">s8</span><span class="p">;</span>
	    <span class="n">__u16</span>  <span class="n">u16</span><span class="p">;</span>
	    <span class="n">__s16</span>  <span class="n">s16</span><span class="p">;</span>
	    <span class="n">__u32</span>  <span class="n">u32</span><span class="p">;</span>
	    <span class="n">__s32</span>  <span class="n">s32</span><span class="p">;</span>
	    <span class="n">__u8</span>  <span class="o">*</span><span class="n">longdata</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">data</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * HID report item format</span>
<span class="cm"> */</span>

<span class="cp">#define HID_ITEM_FORMAT_SHORT	0</span>
<span class="cp">#define HID_ITEM_FORMAT_LONG	1</span>

<span class="cm">/*</span>
<span class="cm"> * Special tag indicating long items</span>
<span class="cm"> */</span>

<span class="cp">#define HID_ITEM_TAG_LONG	15</span>

<span class="cm">/*</span>
<span class="cm"> * HID report descriptor item type (prefix bit 2,3)</span>
<span class="cm"> */</span>

<span class="cp">#define HID_ITEM_TYPE_MAIN		0</span>
<span class="cp">#define HID_ITEM_TYPE_GLOBAL		1</span>
<span class="cp">#define HID_ITEM_TYPE_LOCAL		2</span>
<span class="cp">#define HID_ITEM_TYPE_RESERVED		3</span>

<span class="cm">/*</span>
<span class="cm"> * HID report descriptor main item tags</span>
<span class="cm"> */</span>

<span class="cp">#define HID_MAIN_ITEM_TAG_INPUT			8</span>
<span class="cp">#define HID_MAIN_ITEM_TAG_OUTPUT		9</span>
<span class="cp">#define HID_MAIN_ITEM_TAG_FEATURE		11</span>
<span class="cp">#define HID_MAIN_ITEM_TAG_BEGIN_COLLECTION	10</span>
<span class="cp">#define HID_MAIN_ITEM_TAG_END_COLLECTION	12</span>

<span class="cm">/*</span>
<span class="cm"> * HID report descriptor main item contents</span>
<span class="cm"> */</span>

<span class="cp">#define HID_MAIN_ITEM_CONSTANT		0x001</span>
<span class="cp">#define HID_MAIN_ITEM_VARIABLE		0x002</span>
<span class="cp">#define HID_MAIN_ITEM_RELATIVE		0x004</span>
<span class="cp">#define HID_MAIN_ITEM_WRAP		0x008</span>
<span class="cp">#define HID_MAIN_ITEM_NONLINEAR		0x010</span>
<span class="cp">#define HID_MAIN_ITEM_NO_PREFERRED	0x020</span>
<span class="cp">#define HID_MAIN_ITEM_NULL_STATE	0x040</span>
<span class="cp">#define HID_MAIN_ITEM_VOLATILE		0x080</span>
<span class="cp">#define HID_MAIN_ITEM_BUFFERED_BYTE	0x100</span>

<span class="cm">/*</span>
<span class="cm"> * HID report descriptor collection item types</span>
<span class="cm"> */</span>

<span class="cp">#define HID_COLLECTION_PHYSICAL		0</span>
<span class="cp">#define HID_COLLECTION_APPLICATION	1</span>
<span class="cp">#define HID_COLLECTION_LOGICAL		2</span>

<span class="cm">/*</span>
<span class="cm"> * HID report descriptor global item tags</span>
<span class="cm"> */</span>

<span class="cp">#define HID_GLOBAL_ITEM_TAG_USAGE_PAGE		0</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_LOGICAL_MINIMUM	1</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_LOGICAL_MAXIMUM	2</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_PHYSICAL_MINIMUM	3</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_PHYSICAL_MAXIMUM	4</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_UNIT_EXPONENT	5</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_UNIT		6</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_REPORT_SIZE		7</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_REPORT_ID		8</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_REPORT_COUNT	9</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_PUSH		10</span>
<span class="cp">#define HID_GLOBAL_ITEM_TAG_POP			11</span>

<span class="cm">/*</span>
<span class="cm"> * HID report descriptor local item tags</span>
<span class="cm"> */</span>

<span class="cp">#define HID_LOCAL_ITEM_TAG_USAGE		0</span>
<span class="cp">#define HID_LOCAL_ITEM_TAG_USAGE_MINIMUM	1</span>
<span class="cp">#define HID_LOCAL_ITEM_TAG_USAGE_MAXIMUM	2</span>
<span class="cp">#define HID_LOCAL_ITEM_TAG_DESIGNATOR_INDEX	3</span>
<span class="cp">#define HID_LOCAL_ITEM_TAG_DESIGNATOR_MINIMUM	4</span>
<span class="cp">#define HID_LOCAL_ITEM_TAG_DESIGNATOR_MAXIMUM	5</span>
<span class="cp">#define HID_LOCAL_ITEM_TAG_STRING_INDEX		7</span>
<span class="cp">#define HID_LOCAL_ITEM_TAG_STRING_MINIMUM	8</span>
<span class="cp">#define HID_LOCAL_ITEM_TAG_STRING_MAXIMUM	9</span>
<span class="cp">#define HID_LOCAL_ITEM_TAG_DELIMITER		10</span>

<span class="cm">/*</span>
<span class="cm"> * HID usage tables</span>
<span class="cm"> */</span>

<span class="cp">#define HID_USAGE_PAGE		0xffff0000</span>

<span class="cp">#define HID_UP_UNDEFINED	0x00000000</span>
<span class="cp">#define HID_UP_GENDESK		0x00010000</span>
<span class="cp">#define HID_UP_SIMULATION	0x00020000</span>
<span class="cp">#define HID_UP_GENDEVCTRLS	0x00060000</span>
<span class="cp">#define HID_UP_KEYBOARD		0x00070000</span>
<span class="cp">#define HID_UP_LED		0x00080000</span>
<span class="cp">#define HID_UP_BUTTON		0x00090000</span>
<span class="cp">#define HID_UP_ORDINAL		0x000a0000</span>
<span class="cp">#define HID_UP_CONSUMER		0x000c0000</span>
<span class="cp">#define HID_UP_DIGITIZER	0x000d0000</span>
<span class="cp">#define HID_UP_PID		0x000f0000</span>
<span class="cp">#define HID_UP_HPVENDOR         0xff7f0000</span>
<span class="cp">#define HID_UP_MSVENDOR		0xff000000</span>
<span class="cp">#define HID_UP_CUSTOM		0x00ff0000</span>
<span class="cp">#define HID_UP_LOGIVENDOR	0xffbc0000</span>

<span class="cp">#define HID_USAGE		0x0000ffff</span>

<span class="cp">#define HID_GD_POINTER		0x00010001</span>
<span class="cp">#define HID_GD_MOUSE		0x00010002</span>
<span class="cp">#define HID_GD_JOYSTICK		0x00010004</span>
<span class="cp">#define HID_GD_GAMEPAD		0x00010005</span>
<span class="cp">#define HID_GD_KEYBOARD		0x00010006</span>
<span class="cp">#define HID_GD_KEYPAD		0x00010007</span>
<span class="cp">#define HID_GD_MULTIAXIS	0x00010008</span>
<span class="cp">#define HID_GD_X		0x00010030</span>
<span class="cp">#define HID_GD_Y		0x00010031</span>
<span class="cp">#define HID_GD_Z		0x00010032</span>
<span class="cp">#define HID_GD_RX		0x00010033</span>
<span class="cp">#define HID_GD_RY		0x00010034</span>
<span class="cp">#define HID_GD_RZ		0x00010035</span>
<span class="cp">#define HID_GD_SLIDER		0x00010036</span>
<span class="cp">#define HID_GD_DIAL		0x00010037</span>
<span class="cp">#define HID_GD_WHEEL		0x00010038</span>
<span class="cp">#define HID_GD_HATSWITCH	0x00010039</span>
<span class="cp">#define HID_GD_BUFFER		0x0001003a</span>
<span class="cp">#define HID_GD_BYTECOUNT	0x0001003b</span>
<span class="cp">#define HID_GD_MOTION		0x0001003c</span>
<span class="cp">#define HID_GD_START		0x0001003d</span>
<span class="cp">#define HID_GD_SELECT		0x0001003e</span>
<span class="cp">#define HID_GD_VX		0x00010040</span>
<span class="cp">#define HID_GD_VY		0x00010041</span>
<span class="cp">#define HID_GD_VZ		0x00010042</span>
<span class="cp">#define HID_GD_VBRX		0x00010043</span>
<span class="cp">#define HID_GD_VBRY		0x00010044</span>
<span class="cp">#define HID_GD_VBRZ		0x00010045</span>
<span class="cp">#define HID_GD_VNO		0x00010046</span>
<span class="cp">#define HID_GD_FEATURE		0x00010047</span>
<span class="cp">#define HID_GD_UP		0x00010090</span>
<span class="cp">#define HID_GD_DOWN		0x00010091</span>
<span class="cp">#define HID_GD_RIGHT		0x00010092</span>
<span class="cp">#define HID_GD_LEFT		0x00010093</span>

<span class="cp">#define HID_DC_BATTERYSTRENGTH	0x00060020</span>

<span class="cp">#define HID_DG_DIGITIZER	0x000d0001</span>
<span class="cp">#define HID_DG_PEN		0x000d0002</span>
<span class="cp">#define HID_DG_LIGHTPEN		0x000d0003</span>
<span class="cp">#define HID_DG_TOUCHSCREEN	0x000d0004</span>
<span class="cp">#define HID_DG_TOUCHPAD		0x000d0005</span>
<span class="cp">#define HID_DG_STYLUS		0x000d0020</span>
<span class="cp">#define HID_DG_PUCK		0x000d0021</span>
<span class="cp">#define HID_DG_FINGER		0x000d0022</span>
<span class="cp">#define HID_DG_TIPPRESSURE	0x000d0030</span>
<span class="cp">#define HID_DG_BARRELPRESSURE	0x000d0031</span>
<span class="cp">#define HID_DG_INRANGE		0x000d0032</span>
<span class="cp">#define HID_DG_TOUCH		0x000d0033</span>
<span class="cp">#define HID_DG_UNTOUCH		0x000d0034</span>
<span class="cp">#define HID_DG_TAP		0x000d0035</span>
<span class="cp">#define HID_DG_TABLETFUNCTIONKEY	0x000d0039</span>
<span class="cp">#define HID_DG_PROGRAMCHANGEKEY	0x000d003a</span>
<span class="cp">#define HID_DG_INVERT		0x000d003c</span>
<span class="cp">#define HID_DG_TIPSWITCH	0x000d0042</span>
<span class="cp">#define HID_DG_TIPSWITCH2	0x000d0043</span>
<span class="cp">#define HID_DG_BARRELSWITCH	0x000d0044</span>
<span class="cp">#define HID_DG_ERASER		0x000d0045</span>
<span class="cp">#define HID_DG_TABLETPICK	0x000d0046</span>
<span class="cm">/*</span>
<span class="cm"> * as of May 20, 2009 the usages below are not yet in the official USB spec</span>
<span class="cm"> * but are being pushed by Microsft as described in their paper &quot;Digitizer</span>
<span class="cm"> * Drivers for Windows Touch and Pen-Based Computers&quot;</span>
<span class="cm"> */</span>
<span class="cp">#define HID_DG_CONFIDENCE	0x000d0047</span>
<span class="cp">#define HID_DG_WIDTH		0x000d0048</span>
<span class="cp">#define HID_DG_HEIGHT		0x000d0049</span>
<span class="cp">#define HID_DG_CONTACTID	0x000d0051</span>
<span class="cp">#define HID_DG_INPUTMODE	0x000d0052</span>
<span class="cp">#define HID_DG_DEVICEINDEX	0x000d0053</span>
<span class="cp">#define HID_DG_CONTACTCOUNT	0x000d0054</span>
<span class="cp">#define HID_DG_CONTACTMAX	0x000d0055</span>

<span class="cm">/*</span>
<span class="cm"> * HID report types --- Ouch! HID spec says 1 2 3!</span>
<span class="cm"> */</span>

<span class="cp">#define HID_INPUT_REPORT	0</span>
<span class="cp">#define HID_OUTPUT_REPORT	1</span>
<span class="cp">#define HID_FEATURE_REPORT	2</span>

<span class="cm">/*</span>
<span class="cm"> * HID connect requests</span>
<span class="cm"> */</span>

<span class="cp">#define HID_CONNECT_HIDINPUT		0x01</span>
<span class="cp">#define HID_CONNECT_HIDINPUT_FORCE	0x02</span>
<span class="cp">#define HID_CONNECT_HIDRAW		0x04</span>
<span class="cp">#define HID_CONNECT_HIDDEV		0x08</span>
<span class="cp">#define HID_CONNECT_HIDDEV_FORCE	0x10</span>
<span class="cp">#define HID_CONNECT_FF			0x20</span>
<span class="cp">#define HID_CONNECT_DEFAULT	(HID_CONNECT_HIDINPUT|HID_CONNECT_HIDRAW| \</span>
<span class="cp">		HID_CONNECT_HIDDEV|HID_CONNECT_FF)</span>

<span class="cm">/*</span>
<span class="cm"> * HID device quirks.</span>
<span class="cm"> */</span>

<span class="cm">/* </span>
<span class="cm"> * Increase this if you need to configure more HID quirks at module load time</span>
<span class="cm"> */</span>
<span class="cp">#define MAX_USBHID_BOOT_QUIRKS 4</span>

<span class="cp">#define HID_QUIRK_INVERT			0x00000001</span>
<span class="cp">#define HID_QUIRK_NOTOUCH			0x00000002</span>
<span class="cp">#define HID_QUIRK_IGNORE			0x00000004</span>
<span class="cp">#define HID_QUIRK_NOGET				0x00000008</span>
<span class="cp">#define HID_QUIRK_HIDDEV_FORCE			0x00000010</span>
<span class="cp">#define HID_QUIRK_BADPAD			0x00000020</span>
<span class="cp">#define HID_QUIRK_MULTI_INPUT			0x00000040</span>
<span class="cp">#define HID_QUIRK_HIDINPUT_FORCE		0x00000080</span>
<span class="cp">#define HID_QUIRK_SKIP_OUTPUT_REPORTS		0x00010000</span>
<span class="cp">#define HID_QUIRK_FULLSPEED_INTERVAL		0x10000000</span>
<span class="cp">#define HID_QUIRK_NO_INIT_REPORTS		0x20000000</span>
<span class="cp">#define HID_QUIRK_NO_IGNORE			0x40000000</span>
<span class="cp">#define HID_QUIRK_NO_INPUT_SYNC			0x80000000</span>

<span class="cm">/*</span>
<span class="cm"> * HID device groups</span>
<span class="cm"> */</span>
<span class="cp">#define HID_GROUP_GENERIC			0x0001</span>
<span class="cp">#define HID_GROUP_MULTITOUCH			0x0002</span>

<span class="cm">/*</span>
<span class="cm"> * This is the global environment of the parser. This information is</span>
<span class="cm"> * persistent for main-items. The global environment can be saved and</span>
<span class="cm"> * restored with PUSH/POP statements.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">hid_global</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">usage_page</span><span class="p">;</span>
	<span class="n">__s32</span>    <span class="n">logical_minimum</span><span class="p">;</span>
	<span class="n">__s32</span>    <span class="n">logical_maximum</span><span class="p">;</span>
	<span class="n">__s32</span>    <span class="n">physical_minimum</span><span class="p">;</span>
	<span class="n">__s32</span>    <span class="n">physical_maximum</span><span class="p">;</span>
	<span class="n">__s32</span>    <span class="n">unit_exponent</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">unit</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">report_id</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">report_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">report_count</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * This is the local environment. It is persistent up the next main-item.</span>
<span class="cm"> */</span>

<span class="cp">#define HID_MAX_USAGES			12288</span>
<span class="cp">#define HID_DEFAULT_NUM_COLLECTIONS	16</span>

<span class="k">struct</span> <span class="n">hid_local</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">usage</span><span class="p">[</span><span class="n">HID_MAX_USAGES</span><span class="p">];</span> <span class="cm">/* usage array */</span>
	<span class="kt">unsigned</span> <span class="n">collection_index</span><span class="p">[</span><span class="n">HID_MAX_USAGES</span><span class="p">];</span> <span class="cm">/* collection index array */</span>
	<span class="kt">unsigned</span> <span class="n">usage_index</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">usage_minimum</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">delimiter_depth</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">delimiter_branch</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * This is the collection stack. We climb up the stack to determine</span>
<span class="cm"> * application and function of each field.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">hid_collection</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">usage</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">level</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hid_usage</span> <span class="p">{</span>
	<span class="kt">unsigned</span>  <span class="n">hid</span><span class="p">;</span>			<span class="cm">/* hid usage code */</span>
	<span class="kt">unsigned</span>  <span class="n">collection_index</span><span class="p">;</span>	<span class="cm">/* index into collection array */</span>
	<span class="cm">/* hidinput data */</span>
	<span class="n">__u16</span>     <span class="n">code</span><span class="p">;</span>			<span class="cm">/* input driver code */</span>
	<span class="n">__u8</span>      <span class="n">type</span><span class="p">;</span>			<span class="cm">/* input driver type */</span>
	<span class="n">__s8</span>	  <span class="n">hat_min</span><span class="p">;</span>		<span class="cm">/* hat switch fun */</span>
	<span class="n">__s8</span>	  <span class="n">hat_max</span><span class="p">;</span>		<span class="cm">/* ditto */</span>
	<span class="n">__s8</span>	  <span class="n">hat_dir</span><span class="p">;</span>		<span class="cm">/* ditto */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hid_input</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">hid_field</span> <span class="p">{</span>
	<span class="kt">unsigned</span>  <span class="n">physical</span><span class="p">;</span>		<span class="cm">/* physical usage for this field */</span>
	<span class="kt">unsigned</span>  <span class="n">logical</span><span class="p">;</span>		<span class="cm">/* logical usage for this field */</span>
	<span class="kt">unsigned</span>  <span class="n">application</span><span class="p">;</span>		<span class="cm">/* application usage for this field */</span>
	<span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">;</span>	<span class="cm">/* usage table for this function */</span>
	<span class="kt">unsigned</span>  <span class="n">maxusage</span><span class="p">;</span>		<span class="cm">/* maximum usage index */</span>
	<span class="kt">unsigned</span>  <span class="n">flags</span><span class="p">;</span>		<span class="cm">/* main-item flags (i.e. volatile,array,constant) */</span>
	<span class="kt">unsigned</span>  <span class="n">report_offset</span><span class="p">;</span>	<span class="cm">/* bit offset in the report */</span>
	<span class="kt">unsigned</span>  <span class="n">report_size</span><span class="p">;</span>		<span class="cm">/* size of this field in the report */</span>
	<span class="kt">unsigned</span>  <span class="n">report_count</span><span class="p">;</span>		<span class="cm">/* number of this field in the report */</span>
	<span class="kt">unsigned</span>  <span class="n">report_type</span><span class="p">;</span>		<span class="cm">/* (input,output,feature) */</span>
	<span class="n">__s32</span>    <span class="o">*</span><span class="n">value</span><span class="p">;</span>		<span class="cm">/* last known value(s) */</span>
	<span class="n">__s32</span>     <span class="n">logical_minimum</span><span class="p">;</span>
	<span class="n">__s32</span>     <span class="n">logical_maximum</span><span class="p">;</span>
	<span class="n">__s32</span>     <span class="n">physical_minimum</span><span class="p">;</span>
	<span class="n">__s32</span>     <span class="n">physical_maximum</span><span class="p">;</span>
	<span class="n">__s32</span>     <span class="n">unit_exponent</span><span class="p">;</span>
	<span class="kt">unsigned</span>  <span class="n">unit</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">;</span>	<span class="cm">/* associated report */</span>
	<span class="kt">unsigned</span> <span class="n">index</span><span class="p">;</span>			<span class="cm">/* index into report-&gt;field[] */</span>
	<span class="cm">/* hidinput data */</span>
	<span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hidinput</span><span class="p">;</span>	<span class="cm">/* associated input structure */</span>
	<span class="n">__u16</span> <span class="n">dpad</span><span class="p">;</span>			<span class="cm">/* dpad input code */</span>
<span class="p">};</span>

<span class="cp">#define HID_MAX_FIELDS 128</span>

<span class="k">struct</span> <span class="n">hid_report</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">id</span><span class="p">;</span>					<span class="cm">/* id of this report */</span>
	<span class="kt">unsigned</span> <span class="n">type</span><span class="p">;</span>					<span class="cm">/* report type */</span>
	<span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">[</span><span class="n">HID_MAX_FIELDS</span><span class="p">];</span>	<span class="cm">/* fields of the report */</span>
	<span class="kt">unsigned</span> <span class="n">maxfield</span><span class="p">;</span>				<span class="cm">/* maximum valid field index */</span>
	<span class="kt">unsigned</span> <span class="n">size</span><span class="p">;</span>					<span class="cm">/* size of the report (bits) */</span>
	<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">device</span><span class="p">;</span>			<span class="cm">/* associated device */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hid_report_enum</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">numbered</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">report_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report_id_hash</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define HID_REPORT_TYPES 3</span>

<span class="cp">#define HID_MIN_BUFFER_SIZE	64		</span><span class="cm">/* make sure there is at least a packet size of space */</span><span class="cp"></span>
<span class="cp">#define HID_MAX_BUFFER_SIZE	4096		</span><span class="cm">/* 4kb */</span><span class="cp"></span>
<span class="cp">#define HID_CONTROL_FIFO_SIZE	256		</span><span class="cm">/* to init devices with &gt;100 reports */</span><span class="cp"></span>
<span class="cp">#define HID_OUTPUT_FIFO_SIZE	64</span>

<span class="k">struct</span> <span class="n">hid_control_fifo</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">dir</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">raw_report</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hid_output_fifo</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">raw_report</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define HID_CLAIMED_INPUT	1</span>
<span class="cp">#define HID_CLAIMED_HIDDEV	2</span>
<span class="cp">#define HID_CLAIMED_HIDRAW	4</span>

<span class="cp">#define HID_STAT_ADDED		1</span>
<span class="cp">#define HID_STAT_PARSED		2</span>

<span class="k">struct</span> <span class="n">hid_input</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">input_dev</span> <span class="o">*</span><span class="n">input</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">hid_type</span> <span class="p">{</span>
	<span class="n">HID_TYPE_OTHER</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">HID_TYPE_USBMOUSE</span><span class="p">,</span>
	<span class="n">HID_TYPE_USBNONE</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hid_driver</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">hid_ll_driver</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">hid_device</span> <span class="p">{</span>							<span class="cm">/* device report descriptor */</span>
	<span class="n">__u8</span> <span class="o">*</span><span class="n">dev_rdesc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">dev_rsize</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="o">*</span><span class="n">rdesc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">rsize</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_collection</span> <span class="o">*</span><span class="n">collection</span><span class="p">;</span>				<span class="cm">/* List of HID collections */</span>
	<span class="kt">unsigned</span> <span class="n">collection_size</span><span class="p">;</span>					<span class="cm">/* Number of allocated hid_collections */</span>
	<span class="kt">unsigned</span> <span class="n">maxcollection</span><span class="p">;</span>						<span class="cm">/* Number of parsed collections */</span>
	<span class="kt">unsigned</span> <span class="n">maxapplication</span><span class="p">;</span>					<span class="cm">/* Number of applications */</span>
	<span class="n">__u16</span> <span class="n">bus</span><span class="p">;</span>							<span class="cm">/* BUS ID */</span>
	<span class="n">__u16</span> <span class="n">group</span><span class="p">;</span>							<span class="cm">/* Report group */</span>
	<span class="n">__u32</span> <span class="n">vendor</span><span class="p">;</span>							<span class="cm">/* Vendor ID */</span>
	<span class="n">__u32</span> <span class="n">product</span><span class="p">;</span>							<span class="cm">/* Product ID */</span>
	<span class="n">__u32</span> <span class="n">version</span><span class="p">;</span>							<span class="cm">/* HID version */</span>
	<span class="k">enum</span> <span class="n">hid_type</span> <span class="n">type</span><span class="p">;</span>						<span class="cm">/* device type (mouse, kbd, ...) */</span>
	<span class="kt">unsigned</span> <span class="n">country</span><span class="p">;</span>						<span class="cm">/* HID country */</span>
	<span class="k">struct</span> <span class="n">hid_report_enum</span> <span class="n">report_enum</span><span class="p">[</span><span class="n">HID_REPORT_TYPES</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">semaphore</span> <span class="n">driver_lock</span><span class="p">;</span>					<span class="cm">/* protects the current driver */</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="n">dev</span><span class="p">;</span>						<span class="cm">/* device */</span>
	<span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">driver</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_ll_driver</span> <span class="o">*</span><span class="n">ll_driver</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_HID_BATTERY_STRENGTH</span>
	<span class="cm">/*</span>
<span class="cm">	 * Power supply information for HID devices which report</span>
<span class="cm">	 * battery strength. power_supply is registered iff</span>
<span class="cm">	 * battery.name is non-NULL.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">power_supply</span> <span class="n">battery</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">battery_min</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">battery_max</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">battery_report_type</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">battery_report_id</span><span class="p">;</span>
<span class="cp">#endif</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>						<span class="cm">/* see STAT flags above */</span>
	<span class="kt">unsigned</span> <span class="n">claimed</span><span class="p">;</span>						<span class="cm">/* Claimed by hidinput, hiddev? */</span>
	<span class="kt">unsigned</span> <span class="n">quirks</span><span class="p">;</span>						<span class="cm">/* Various quirks the device can pull on us */</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">inputs</span><span class="p">;</span>					<span class="cm">/* The list of inputs */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">hiddev</span><span class="p">;</span>							<span class="cm">/* The hiddev structure */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">hidraw</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">minor</span><span class="p">;</span>							<span class="cm">/* Hiddev minor number */</span>

	<span class="kt">int</span> <span class="n">open</span><span class="p">;</span>							<span class="cm">/* is the device open by anyone? */</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>							<span class="cm">/* Device name */</span>
	<span class="kt">char</span> <span class="n">phys</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>							<span class="cm">/* Device physical location */</span>
	<span class="kt">char</span> <span class="n">uniq</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>							<span class="cm">/* Device unique identifier (serial #) */</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">driver_data</span><span class="p">;</span>

	<span class="cm">/* temporary hid_ff handling (until moved to the drivers) */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">ff_init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">);</span>

	<span class="cm">/* hiddev event handler */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">hiddev_connect</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">hiddev_disconnect</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">hiddev_hid_event</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="p">,</span> <span class="n">__s32</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">hiddev_report_event</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="p">);</span>

	<span class="cm">/* handler for raw input (Get_Report) data, used by hidraw */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">hid_get_raw_report</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="p">);</span>

	<span class="cm">/* handler for raw output data, used by hidraw */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">hid_output_raw_report</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="p">);</span>

	<span class="cm">/* debugging support via debugfs */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">debug</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">debug_dir</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">debug_rdesc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">debug_events</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">debug_list</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">debug_wait</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">hid_get_drvdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev_get_drvdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">hid_set_drvdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dev_set_drvdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define HID_GLOBAL_STACK_SIZE 4</span>
<span class="cp">#define HID_COLLECTION_STACK_SIZE 4</span>

<span class="k">struct</span> <span class="n">hid_parser</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_global</span>     <span class="n">global</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_global</span>     <span class="n">global_stack</span><span class="p">[</span><span class="n">HID_GLOBAL_STACK_SIZE</span><span class="p">];</span>
	<span class="kt">unsigned</span>              <span class="n">global_stack_ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_local</span>      <span class="n">local</span><span class="p">;</span>
	<span class="kt">unsigned</span>              <span class="n">collection_stack</span><span class="p">[</span><span class="n">HID_COLLECTION_STACK_SIZE</span><span class="p">];</span>
	<span class="kt">unsigned</span>              <span class="n">collection_stack_ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_device</span>    <span class="o">*</span><span class="n">device</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hid_class_descriptor</span> <span class="p">{</span>
	<span class="n">__u8</span>  <span class="n">bDescriptorType</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">wDescriptorLength</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">hid_descriptor</span> <span class="p">{</span>
	<span class="n">__u8</span>  <span class="n">bLength</span><span class="p">;</span>
	<span class="n">__u8</span>  <span class="n">bDescriptorType</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">bcdHID</span><span class="p">;</span>
	<span class="n">__u8</span>  <span class="n">bCountryCode</span><span class="p">;</span>
	<span class="n">__u8</span>  <span class="n">bNumDescriptors</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">hid_class_descriptor</span> <span class="n">desc</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define HID_DEVICE(b, g, ven, prod)					\</span>
<span class="cp">	.bus = (b), .group = (g), .vendor = (ven), .product = (prod)</span>
<span class="cp">#define HID_USB_DEVICE(ven, prod)				\</span>
<span class="cp">	.bus = BUS_USB, .vendor = (ven), .product = (prod)</span>
<span class="cp">#define HID_BLUETOOTH_DEVICE(ven, prod)					\</span>
<span class="cp">	.bus = BUS_BLUETOOTH, .vendor = (ven), .product = (prod)</span>

<span class="cp">#define HID_REPORT_ID(rep) \</span>
<span class="cp">	.report_type = (rep)</span>
<span class="cp">#define HID_USAGE_ID(uhid, utype, ucode) \</span>
<span class="cp">	.usage_hid = (uhid), .usage_type = (utype), .usage_code = (ucode)</span>
<span class="cm">/* we don&#39;t want to catch types and codes equal to 0 */</span>
<span class="cp">#define HID_TERMINATOR		(HID_ANY_ID - 1)</span>

<span class="k">struct</span> <span class="n">hid_report_id</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">report_type</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">hid_usage_id</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">usage_hid</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">usage_type</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">usage_code</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct hid_driver</span>
<span class="cm"> * @name: driver name (e.g. &quot;Footech_bar-wheel&quot;)</span>
<span class="cm"> * @id_table: which devices is this driver for (must be non-NULL for probe</span>
<span class="cm"> * 	      to be called)</span>
<span class="cm"> * @dyn_list: list of dynamically added device ids</span>
<span class="cm"> * @dyn_lock: lock protecting @dyn_list</span>
<span class="cm"> * @probe: new device inserted</span>
<span class="cm"> * @remove: device removed (NULL if not a hot-plug capable driver)</span>
<span class="cm"> * @report_table: on which reports to call raw_event (NULL means all)</span>
<span class="cm"> * @raw_event: if report in report_table, this hook is called (NULL means nop)</span>
<span class="cm"> * @usage_table: on which events to call event (NULL means all)</span>
<span class="cm"> * @event: if usage in usage_table, this hook is called (NULL means nop)</span>
<span class="cm"> * @report_fixup: called before report descriptor parsing (NULL means nop)</span>
<span class="cm"> * @input_mapping: invoked on input registering before mapping an usage</span>
<span class="cm"> * @input_mapped: invoked on input registering after mapping an usage</span>
<span class="cm"> * @feature_mapping: invoked on feature registering</span>
<span class="cm"> * @suspend: invoked on suspend (NULL means nop)</span>
<span class="cm"> * @resume: invoked on resume if device was not reset (NULL means nop)</span>
<span class="cm"> * @reset_resume: invoked on resume if device was reset (NULL means nop)</span>
<span class="cm"> *</span>
<span class="cm"> * raw_event and event should return 0 on no action performed, 1 when no</span>
<span class="cm"> * further processing should be done and negative on error</span>
<span class="cm"> *</span>
<span class="cm"> * input_mapping shall return a negative value to completely ignore this usage</span>
<span class="cm"> * (e.g. doubled or invalid usage), zero to continue with parsing of this</span>
<span class="cm"> * usage by generic code (no special handling needed) or positive to skip</span>
<span class="cm"> * generic parsing (needed special handling which was done in the hook already)</span>
<span class="cm"> * input_mapped shall return negative to inform the layer that this usage</span>
<span class="cm"> * should not be considered for further processing or zero to notify that</span>
<span class="cm"> * no processing was performed and should be done in a generic manner</span>
<span class="cm"> * Both these functions may be NULL which means the same behavior as returning</span>
<span class="cm"> * zero from them.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">hid_driver</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="o">*</span><span class="n">id_table</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">dyn_list</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">dyn_lock</span><span class="p">;</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">probe</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">remove</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">hid_report_id</span> <span class="o">*</span><span class="n">report_table</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">raw_event</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">,</span>
			<span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hid_usage_id</span> <span class="o">*</span><span class="n">usage_table</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">event</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">value</span><span class="p">);</span>

	<span class="n">__u8</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">report_fixup</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">size</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">input_mapping</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hidinput</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">**</span><span class="n">bit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">max</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">input_mapped</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hidinput</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">**</span><span class="n">bit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">max</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">feature_mapping</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_PM</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">suspend</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="n">pm_message_t</span> <span class="n">message</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">resume</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">reset_resume</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cm">/* private: */</span>
	<span class="k">struct</span> <span class="n">device_driver</span> <span class="n">driver</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * hid_ll_driver - low level driver callbacks</span>
<span class="cm"> * @start: called on probe to start the device</span>
<span class="cm"> * @stop: called on remove</span>
<span class="cm"> * @open: called by input layer on open</span>
<span class="cm"> * @close: called by input layer on close</span>
<span class="cm"> * @hidinput_input_event: event input event (e.g. ff or leds)</span>
<span class="cm"> * @parse: this method is called only once to parse the device data,</span>
<span class="cm"> *	   shouldn&#39;t allocate anything to not leak memory</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">hid_ll_driver</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">stop</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">open</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">close</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">power</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">hidinput_input_event</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">input_dev</span> <span class="o">*</span><span class="n">idev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">code</span><span class="p">,</span> <span class="kt">int</span> <span class="n">value</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">parse</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#define	PM_HINT_FULLON	1&lt;&lt;5</span>
<span class="cp">#define PM_HINT_NORMAL	1&lt;&lt;1</span>

<span class="cm">/* Applications from HID Usage Tables 4/8/99 Version 1.1 */</span>
<span class="cm">/* We ignore a few input applications that are not widely used */</span>
<span class="cp">#define IS_INPUT_APPLICATION(a) (((a &gt;= 0x00010000) &amp;&amp; (a &lt;= 0x00010008)) || (a == 0x00010080) || (a == 0x000c0001) || ((a &gt;= 0x000d0002) &amp;&amp; (a &lt;= 0x000d0006)))</span>

<span class="cm">/* HID core API */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">hid_debug</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">hid_add_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">hid_destroy_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">__must_check</span> <span class="n">__hid_register_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mod_name</span><span class="p">);</span>

<span class="cm">/* use a define to avoid include chaining to get THIS_MODULE &amp; friends */</span>
<span class="cp">#define hid_register_driver(driver) \</span>
<span class="cp">	__hid_register_driver(driver, THIS_MODULE, KBUILD_MODNAME)</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">hid_unregister_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">hidinput_hid_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="p">,</span> <span class="n">__s32</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">hidinput_report_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">hidinput_connect</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">force</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">hidinput_disconnect</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">hid_set_field</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span><span class="p">,</span> <span class="n">__s32</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hid_input_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hidinput_find_field</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">code</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">**</span><span class="n">field</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">hidinput_get_led_field</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hidinput_count_leds</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">hid_output_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid_allocate_device</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">hid_register_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">device</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">type</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">id</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hid_parse_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">start</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hid_open_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">device</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hid_check_keys_pressed</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hid_connect</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">connect_mask</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">hid_disconnect</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">);</span>
<span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="o">*</span><span class="n">hid_match_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span>
					 <span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * hid_map_usage - map usage input bits</span>
<span class="cm"> *</span>
<span class="cm"> * @hidinput: hidinput which we are interested in</span>
<span class="cm"> * @usage: usage to fill in</span>
<span class="cm"> * @bit: pointer to input-&gt;{}bit (out parameter)</span>
<span class="cm"> * @max: maximal valid usage-&gt;code to consider later (out parameter)</span>
<span class="cm"> * @type: input event type (EV_KEY, EV_REL, ...)</span>
<span class="cm"> * @c: code which corresponds to this usage and type</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">hid_map_usage</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hidinput</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">**</span><span class="n">bit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">max</span><span class="p">,</span>
		<span class="n">__u8</span> <span class="n">type</span><span class="p">,</span> <span class="n">__u16</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">input_dev</span> <span class="o">*</span><span class="n">input</span> <span class="o">=</span> <span class="n">hidinput</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">;</span>

	<span class="n">usage</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">usage</span><span class="o">-&gt;</span><span class="n">code</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">EV_ABS</span>:
		<span class="o">*</span><span class="n">bit</span> <span class="o">=</span> <span class="n">input</span><span class="o">-&gt;</span><span class="n">absbit</span><span class="p">;</span>
		<span class="o">*</span><span class="n">max</span> <span class="o">=</span> <span class="n">ABS_MAX</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">EV_REL</span>:
		<span class="o">*</span><span class="n">bit</span> <span class="o">=</span> <span class="n">input</span><span class="o">-&gt;</span><span class="n">relbit</span><span class="p">;</span>
		<span class="o">*</span><span class="n">max</span> <span class="o">=</span> <span class="n">REL_MAX</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">EV_KEY</span>:
		<span class="o">*</span><span class="n">bit</span> <span class="o">=</span> <span class="n">input</span><span class="o">-&gt;</span><span class="n">keybit</span><span class="p">;</span>
		<span class="o">*</span><span class="n">max</span> <span class="o">=</span> <span class="n">KEY_MAX</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">EV_LED</span>:
		<span class="o">*</span><span class="n">bit</span> <span class="o">=</span> <span class="n">input</span><span class="o">-&gt;</span><span class="n">ledbit</span><span class="p">;</span>
		<span class="o">*</span><span class="n">max</span> <span class="o">=</span> <span class="n">LED_MAX</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_map_usage_clear - map usage input bits and clear the input bit</span>
<span class="cm"> *</span>
<span class="cm"> * The same as hid_map_usage, except the @c bit is also cleared in supported</span>
<span class="cm"> * bits (@bit).</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">hid_map_usage_clear</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hidinput</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">**</span><span class="n">bit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">max</span><span class="p">,</span>
		<span class="n">__u8</span> <span class="n">type</span><span class="p">,</span> <span class="n">__u16</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hid_map_usage</span><span class="p">(</span><span class="n">hidinput</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
	<span class="n">clear_bit</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">*</span><span class="n">bit</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_parse - parse HW reports</span>
<span class="cm"> *</span>
<span class="cm"> * @hdev: hid device</span>
<span class="cm"> *</span>
<span class="cm"> * Call this from probe after you set up the device (if needed). Your</span>
<span class="cm"> * report_fixup will be called (if non-NULL) after reading raw report from</span>
<span class="cm"> * device before passing it to hid layer for real parsing.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">__must_check</span> <span class="nf">hid_parse</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">hid_open_report</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_hw_start - start underlaying HW</span>
<span class="cm"> *</span>
<span class="cm"> * @hdev: hid device</span>
<span class="cm"> * @connect_mask: which outputs to connect, see HID_CONNECT_*</span>
<span class="cm"> *</span>
<span class="cm"> * Call this in probe function *after* hid_parse. This will setup HW buffers</span>
<span class="cm"> * and start the device (if not deffered to device open). hid_hw_stop must be</span>
<span class="cm"> * called if this was successful.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">__must_check</span> <span class="nf">hid_hw_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">connect_mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">ll_driver</span><span class="o">-&gt;</span><span class="n">start</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">||</span> <span class="o">!</span><span class="n">connect_mask</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">hid_connect</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">connect_mask</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">ll_driver</span><span class="o">-&gt;</span><span class="n">stop</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_hw_stop - stop underlaying HW</span>
<span class="cm"> *</span>
<span class="cm"> * @hdev: hid device</span>
<span class="cm"> *</span>
<span class="cm"> * This is usually called from remove function or from probe when something</span>
<span class="cm"> * failed and hid_hw_start was called already.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">hid_hw_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hid_disconnect</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">ll_driver</span><span class="o">-&gt;</span><span class="n">stop</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_hw_open - signal underlaying HW to start delivering events</span>
<span class="cm"> *</span>
<span class="cm"> * @hdev: hid device</span>
<span class="cm"> *</span>
<span class="cm"> * Tell underlying HW to start delivering events from the device.</span>
<span class="cm"> * This function should be called sometime after successful call</span>
<span class="cm"> * to hid_hiw_start().</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">__must_check</span> <span class="nf">hid_hw_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">ll_driver</span><span class="o">-&gt;</span><span class="n">open</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_hw_close - signal underlaying HW to stop delivering events</span>
<span class="cm"> *</span>
<span class="cm"> * @hdev: hid device</span>
<span class="cm"> *</span>
<span class="cm"> * This function indicates that we are not interested in the events</span>
<span class="cm"> * from this device anymore. Delivery of events may or may not stop,</span>
<span class="cm"> * depending on the number of users still outstanding.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">hid_hw_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">ll_driver</span><span class="o">-&gt;</span><span class="n">close</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_hw_power - requests underlying HW to go into given power mode</span>
<span class="cm"> *</span>
<span class="cm"> * @hdev: hid device</span>
<span class="cm"> * @level: requested power level (one of %PM_HINT_* defines)</span>
<span class="cm"> *</span>
<span class="cm"> * This function requests underlying hardware to enter requested power</span>
<span class="cm"> * mode.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">hid_hw_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">ll_driver</span><span class="o">-&gt;</span><span class="n">power</span> <span class="o">?</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">ll_driver</span><span class="o">-&gt;</span><span class="n">power</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">hid_report_raw_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span>
		<span class="kt">int</span> <span class="n">interrupt</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">hid_generic_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">hid_generic_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* HID quirks API */</span>
<span class="n">u32</span> <span class="n">usbhid_lookup_quirk</span><span class="p">(</span><span class="k">const</span> <span class="n">u16</span> <span class="n">idVendor</span><span class="p">,</span> <span class="k">const</span> <span class="n">u16</span> <span class="n">idProduct</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">usbhid_quirks_init</span><span class="p">(</span><span class="kt">char</span> <span class="o">**</span><span class="n">quirks_param</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">usbhid_quirks_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">usbhid_set_leds</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_HID_PID</span>
<span class="kt">int</span> <span class="n">hid_pidff_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define hid_pidff_init NULL</span>
<span class="cp">#endif</span>

<span class="cp">#define dbg_hid(format, arg...)						\</span>
<span class="cp">do {									\</span>
<span class="cp">	if (hid_debug)							\</span>
<span class="cp">		printk(KERN_DEBUG &quot;%s: &quot; format, __FILE__, ##arg);	\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define hid_printk(level, hid, fmt, arg...)		\</span>
<span class="cp">	dev_printk(level, &amp;(hid)-&gt;dev, fmt, ##arg)</span>
<span class="cp">#define hid_emerg(hid, fmt, arg...)			\</span>
<span class="cp">	dev_emerg(&amp;(hid)-&gt;dev, fmt, ##arg)</span>
<span class="cp">#define hid_crit(hid, fmt, arg...)			\</span>
<span class="cp">	dev_crit(&amp;(hid)-&gt;dev, fmt, ##arg)</span>
<span class="cp">#define hid_alert(hid, fmt, arg...)			\</span>
<span class="cp">	dev_alert(&amp;(hid)-&gt;dev, fmt, ##arg)</span>
<span class="cp">#define hid_err(hid, fmt, arg...)			\</span>
<span class="cp">	dev_err(&amp;(hid)-&gt;dev, fmt, ##arg)</span>
<span class="cp">#define hid_notice(hid, fmt, arg...)			\</span>
<span class="cp">	dev_notice(&amp;(hid)-&gt;dev, fmt, ##arg)</span>
<span class="cp">#define hid_warn(hid, fmt, arg...)			\</span>
<span class="cp">	dev_warn(&amp;(hid)-&gt;dev, fmt, ##arg)</span>
<span class="cp">#define hid_info(hid, fmt, arg...)			\</span>
<span class="cp">	dev_info(&amp;(hid)-&gt;dev, fmt, ##arg)</span>
<span class="cp">#define hid_dbg(hid, fmt, arg...)			\</span>
<span class="cp">	dev_dbg(&amp;(hid)-&gt;dev, fmt, ##arg)</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
