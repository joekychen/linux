<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › acct.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>acct.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  BSD Process Accounting for Linux - Definitions</span>
<span class="cm"> *</span>
<span class="cm"> *  Author: Marco van Wieringen (mvw@planets.elm.net)</span>
<span class="cm"> *</span>
<span class="cm"> *  This header file contains the definitions needed to implement</span>
<span class="cm"> *  BSD-style process accounting. The kernel accounting code and all</span>
<span class="cm"> *  user-level programs that try to do something useful with the</span>
<span class="cm"> *  process accounting log must include this file.</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 1995 - 1997 Marco van Wieringen - ELM Consultancy B.V.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _LINUX_ACCT_H</span>
<span class="cp">#define _LINUX_ACCT_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#include &lt;asm/param.h&gt;</span>
<span class="cp">#include &lt;asm/byteorder.h&gt;</span>

<span class="cm">/* </span>
<span class="cm"> *  comp_t is a 16-bit &quot;floating&quot; point number with a 3-bit base 8</span>
<span class="cm"> *  exponent and a 13-bit fraction.</span>
<span class="cm"> *  comp2_t is 24-bit with 5-bit base 2 exponent and 20 bit fraction</span>
<span class="cm"> *  (leading 1 not stored).</span>
<span class="cm"> *  See linux/kernel/acct.c for the specific encoding systems used.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="n">__u16</span>	<span class="n">comp_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">__u32</span>	<span class="n">comp2_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> *   accounting file record</span>
<span class="cm"> *</span>
<span class="cm"> *   This structure contains all of the information written out to the</span>
<span class="cm"> *   process accounting file whenever a process exits.</span>
<span class="cm"> */</span>

<span class="cp">#define ACCT_COMM	16</span>

<span class="k">struct</span> <span class="n">acct</span>
<span class="p">{</span>
	<span class="kt">char</span>		<span class="n">ac_flag</span><span class="p">;</span>		<span class="cm">/* Flags */</span>
	<span class="kt">char</span>		<span class="n">ac_version</span><span class="p">;</span>		<span class="cm">/* Always set to ACCT_VERSION */</span>
	<span class="cm">/* for binary compatibility back until 2.0 */</span>
	<span class="n">__u16</span>		<span class="n">ac_uid16</span><span class="p">;</span>		<span class="cm">/* LSB of Real User ID */</span>
	<span class="n">__u16</span>		<span class="n">ac_gid16</span><span class="p">;</span>		<span class="cm">/* LSB of Real Group ID */</span>
	<span class="n">__u16</span>		<span class="n">ac_tty</span><span class="p">;</span>			<span class="cm">/* Control Terminal */</span>
	<span class="n">__u32</span>		<span class="n">ac_btime</span><span class="p">;</span>		<span class="cm">/* Process Creation Time */</span>
	<span class="n">comp_t</span>		<span class="n">ac_utime</span><span class="p">;</span>		<span class="cm">/* User Time */</span>
	<span class="n">comp_t</span>		<span class="n">ac_stime</span><span class="p">;</span>		<span class="cm">/* System Time */</span>
	<span class="n">comp_t</span>		<span class="n">ac_etime</span><span class="p">;</span>		<span class="cm">/* Elapsed Time */</span>
	<span class="n">comp_t</span>		<span class="n">ac_mem</span><span class="p">;</span>			<span class="cm">/* Average Memory Usage */</span>
	<span class="n">comp_t</span>		<span class="n">ac_io</span><span class="p">;</span>			<span class="cm">/* Chars Transferred */</span>
	<span class="n">comp_t</span>		<span class="n">ac_rw</span><span class="p">;</span>			<span class="cm">/* Blocks Read or Written */</span>
	<span class="n">comp_t</span>		<span class="n">ac_minflt</span><span class="p">;</span>		<span class="cm">/* Minor Pagefaults */</span>
	<span class="n">comp_t</span>		<span class="n">ac_majflt</span><span class="p">;</span>		<span class="cm">/* Major Pagefaults */</span>
	<span class="n">comp_t</span>		<span class="n">ac_swaps</span><span class="p">;</span>		<span class="cm">/* Number of Swaps */</span>
<span class="cm">/* m68k had no padding here. */</span>
<span class="cp">#if !defined(CONFIG_M68K) || !defined(__KERNEL__)</span>
	<span class="n">__u16</span>		<span class="n">ac_ahz</span><span class="p">;</span>			<span class="cm">/* AHZ */</span>
<span class="cp">#endif</span>
	<span class="n">__u32</span>		<span class="n">ac_exitcode</span><span class="p">;</span>		<span class="cm">/* Exitcode */</span>
	<span class="kt">char</span>		<span class="n">ac_comm</span><span class="p">[</span><span class="n">ACCT_COMM</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>	<span class="cm">/* Command Name */</span>
	<span class="n">__u8</span>		<span class="n">ac_etime_hi</span><span class="p">;</span>		<span class="cm">/* Elapsed Time MSB */</span>
	<span class="n">__u16</span>		<span class="n">ac_etime_lo</span><span class="p">;</span>		<span class="cm">/* Elapsed Time LSB */</span>
	<span class="n">__u32</span>		<span class="n">ac_uid</span><span class="p">;</span>			<span class="cm">/* Real User ID */</span>
	<span class="n">__u32</span>		<span class="n">ac_gid</span><span class="p">;</span>			<span class="cm">/* Real Group ID */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">acct_v3</span>
<span class="p">{</span>
	<span class="kt">char</span>		<span class="n">ac_flag</span><span class="p">;</span>		<span class="cm">/* Flags */</span>
	<span class="kt">char</span>		<span class="n">ac_version</span><span class="p">;</span>		<span class="cm">/* Always set to ACCT_VERSION */</span>
	<span class="n">__u16</span>		<span class="n">ac_tty</span><span class="p">;</span>			<span class="cm">/* Control Terminal */</span>
	<span class="n">__u32</span>		<span class="n">ac_exitcode</span><span class="p">;</span>		<span class="cm">/* Exitcode */</span>
	<span class="n">__u32</span>		<span class="n">ac_uid</span><span class="p">;</span>			<span class="cm">/* Real User ID */</span>
	<span class="n">__u32</span>		<span class="n">ac_gid</span><span class="p">;</span>			<span class="cm">/* Real Group ID */</span>
	<span class="n">__u32</span>		<span class="n">ac_pid</span><span class="p">;</span>			<span class="cm">/* Process ID */</span>
	<span class="n">__u32</span>		<span class="n">ac_ppid</span><span class="p">;</span>		<span class="cm">/* Parent Process ID */</span>
	<span class="n">__u32</span>		<span class="n">ac_btime</span><span class="p">;</span>		<span class="cm">/* Process Creation Time */</span>
<span class="cp">#ifdef __KERNEL__</span>
	<span class="n">__u32</span>		<span class="n">ac_etime</span><span class="p">;</span>		<span class="cm">/* Elapsed Time */</span>
<span class="cp">#else</span>
	<span class="kt">float</span>		<span class="n">ac_etime</span><span class="p">;</span>		<span class="cm">/* Elapsed Time */</span>
<span class="cp">#endif</span>
	<span class="n">comp_t</span>		<span class="n">ac_utime</span><span class="p">;</span>		<span class="cm">/* User Time */</span>
	<span class="n">comp_t</span>		<span class="n">ac_stime</span><span class="p">;</span>		<span class="cm">/* System Time */</span>
	<span class="n">comp_t</span>		<span class="n">ac_mem</span><span class="p">;</span>			<span class="cm">/* Average Memory Usage */</span>
	<span class="n">comp_t</span>		<span class="n">ac_io</span><span class="p">;</span>			<span class="cm">/* Chars Transferred */</span>
	<span class="n">comp_t</span>		<span class="n">ac_rw</span><span class="p">;</span>			<span class="cm">/* Blocks Read or Written */</span>
	<span class="n">comp_t</span>		<span class="n">ac_minflt</span><span class="p">;</span>		<span class="cm">/* Minor Pagefaults */</span>
	<span class="n">comp_t</span>		<span class="n">ac_majflt</span><span class="p">;</span>		<span class="cm">/* Major Pagefaults */</span>
	<span class="n">comp_t</span>		<span class="n">ac_swaps</span><span class="p">;</span>		<span class="cm">/* Number of Swaps */</span>
	<span class="kt">char</span>		<span class="n">ac_comm</span><span class="p">[</span><span class="n">ACCT_COMM</span><span class="p">];</span>	<span class="cm">/* Command Name */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *  accounting flags</span>
<span class="cm"> */</span>
				<span class="cm">/* bit set when the process ... */</span>
<span class="cp">#define AFORK		0x01	</span><span class="cm">/* ... executed fork, but did not exec */</span><span class="cp"></span>
<span class="cp">#define ASU		0x02	</span><span class="cm">/* ... used super-user privileges */</span><span class="cp"></span>
<span class="cp">#define ACOMPAT		0x04	</span><span class="cm">/* ... used compatibility mode (VAX only not used) */</span><span class="cp"></span>
<span class="cp">#define ACORE		0x08	</span><span class="cm">/* ... dumped core */</span><span class="cp"></span>
<span class="cp">#define AXSIG		0x10	</span><span class="cm">/* ... was killed by a signal */</span><span class="cp"></span>

<span class="cp">#ifdef __BIG_ENDIAN</span>
<span class="cp">#define ACCT_BYTEORDER	0x80	</span><span class="cm">/* accounting file is big endian */</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="cp">#define ACCT_BYTEORDER	0x00	</span><span class="cm">/* accounting file is little endian */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cp">#ifdef __KERNEL__</span>


<span class="cp">#ifdef CONFIG_BSD_PROCESS_ACCT</span>
<span class="k">struct</span> <span class="n">vfsmount</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">super_block</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">pacct_struct</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">pid_namespace</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">acct_parm</span><span class="p">[];</span> <span class="cm">/* for sysctl */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">acct_auto_close_mnt</span><span class="p">(</span><span class="k">struct</span> <span class="n">vfsmount</span> <span class="o">*</span><span class="n">m</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">acct_auto_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">acct_collect</span><span class="p">(</span><span class="kt">long</span> <span class="n">exitcode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">group_dead</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">acct_process</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">acct_exit_ns</span><span class="p">(</span><span class="k">struct</span> <span class="n">pid_namespace</span> <span class="o">*</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define acct_auto_close_mnt(x)	do { } while (0)</span>
<span class="cp">#define acct_auto_close(x)	do { } while (0)</span>
<span class="cp">#define acct_collect(x,y)	do { } while (0)</span>
<span class="cp">#define acct_process()		do { } while (0)</span>
<span class="cp">#define acct_exit_ns(ns)	do { } while (0)</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * ACCT_VERSION numbers as yet defined:</span>
<span class="cm"> * 0: old format (until 2.6.7) with 16 bit uid/gid</span>
<span class="cm"> * 1: extended variant (binary compatible on M68K)</span>
<span class="cm"> * 2: extended variant (binary compatible on everything except M68K)</span>
<span class="cm"> * 3: new binary incompatible format (64 bytes)</span>
<span class="cm"> * 4: new binary incompatible format (128 bytes)</span>
<span class="cm"> * 5: new binary incompatible format (128 bytes, second half)</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#undef ACCT_VERSION</span>
<span class="cp">#undef AHZ</span>

<span class="cp">#ifdef CONFIG_BSD_PROCESS_ACCT_V3</span>
<span class="cp">#define ACCT_VERSION	3</span>
<span class="cp">#define AHZ		100</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">acct_v3</span> <span class="n">acct_t</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="cp">#ifdef CONFIG_M68K</span>
<span class="cp">#define ACCT_VERSION	1</span>
<span class="cp">#else</span>
<span class="cp">#define ACCT_VERSION	2</span>
<span class="cp">#endif</span>
<span class="cp">#define AHZ		(USER_HZ)</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">acct</span> <span class="n">acct_t</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="cp">#else</span>
<span class="cp">#define ACCT_VERSION	2</span>
<span class="cp">#define AHZ		(HZ)</span>
<span class="cp">#endif	</span><span class="cm">/* __KERNEL */</span><span class="cp"></span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#include &lt;linux/jiffies.h&gt;</span>
<span class="cm">/*</span>
<span class="cm"> * Yet another set of HZ to *HZ helper functions.</span>
<span class="cm"> * See &lt;linux/jiffies.h&gt; for the original.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">jiffies_to_AHZ</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if (TICK_NSEC % (NSEC_PER_SEC / AHZ)) == 0</span>
<span class="cp"># if HZ &lt; AHZ</span>
	<span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="n">AHZ</span> <span class="o">/</span> <span class="n">HZ</span><span class="p">);</span>
<span class="cp"># else</span>
	<span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="n">HZ</span> <span class="o">/</span> <span class="n">AHZ</span><span class="p">);</span>
<span class="cp"># endif</span>
<span class="cp">#else</span>
        <span class="n">u64</span> <span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">u64</span><span class="p">)</span><span class="n">x</span> <span class="o">*</span> <span class="n">TICK_NSEC</span><span class="p">;</span>
        <span class="n">do_div</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="p">(</span><span class="n">NSEC_PER_SEC</span> <span class="o">/</span> <span class="n">AHZ</span><span class="p">));</span>
        <span class="k">return</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">tmp</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u64</span> <span class="nf">nsec_to_AHZ</span><span class="p">(</span><span class="n">u64</span> <span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if (NSEC_PER_SEC % AHZ) == 0</span>
	<span class="n">do_div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">NSEC_PER_SEC</span> <span class="o">/</span> <span class="n">AHZ</span><span class="p">));</span>
<span class="cp">#elif (AHZ % 512) == 0</span>
	<span class="n">x</span> <span class="o">*=</span> <span class="n">AHZ</span><span class="o">/</span><span class="mi">512</span><span class="p">;</span>
	<span class="n">do_div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">NSEC_PER_SEC</span> <span class="o">/</span> <span class="mi">512</span><span class="p">));</span>
<span class="cp">#else</span>
	<span class="cm">/*</span>
<span class="cm">         * max relative error 5.7e-8 (1.8s per year) for AHZ &lt;= 1024,</span>
<span class="cm">         * overflow after 64.99 years.</span>
<span class="cm">         * exact for AHZ=60, 72, 90, 120, 144, 180, 300, 600, 900, ...</span>
<span class="cm">         */</span>
	<span class="n">x</span> <span class="o">*=</span> <span class="mi">9</span><span class="p">;</span>
	<span class="n">do_div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)((</span><span class="mi">9ull</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span> <span class="o">+</span> <span class="p">(</span><span class="n">AHZ</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
	                          <span class="o">/</span> <span class="n">AHZ</span><span class="p">));</span>
<span class="cp">#endif</span>
	<span class="k">return</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif  </span><span class="cm">/* __KERNEL */</span><span class="cp"></span>

<span class="cp">#endif	</span><span class="cm">/* _LINUX_ACCT_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
