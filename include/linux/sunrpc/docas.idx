f | debug.h | s | 2.2K | 95 | Chuck Lever | chuck.lever@oracle.com | 1332336691 |  | SUNRPC: Kill compiler warning when RPC_DEBUG is unset  Loads of these:  linux/net/sunrpc/rpcb_clnt.c:942:2: warning: suggest braces around   empty body in ‘do’ statement [-Wempty-body]  show up when I unset CONFIG_PROC_SYSCTL.  Seen with    gcc (GCC) 4.6.1 20110908 (Red Hat 4.6.1-9)  Reported-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Chuck Lever <chuck.lever@oracle.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | rpc_pipe_fs.h | s | 2.5K | 80 | Stanislav Kinsbursky | skinsbursky@parallels.com | 1330367868 |  | SUNRPC: move waitq from RPC pipe to RPC inode  Currently, wait queue, used for polling of RPC pipe changes from user-space, is a part of RPC pipe. But the pipe data itself can be released on NFS umount prior to dentry-inode pair, connected to it (is case of this pair is open by some process). This is not a problem for almost all pipe users, because all PipeFS file operations checks pipe reference prior to using it. Except evenfd. This thing registers itself with "poll" file operation and thus has a reference to pipe wait queue. This leads to oopses on destroying eventfd after NFS umount (like rpc_idmapd do) since not pipe data left to the point already. The solution is to wait queue from pipe data to internal RPC inode data. This looks more logical, because this wiat queue used only for user-space processes, which already holds inode reference.  Note: upcalls have to get pipe->dentry prior to dereferecing wait queue to make sure, that mount point won't disappear from underneath us.  Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | gss_krb5.h | s | 11K | 286 | Trond Myklebust | Trond.Myklebust@netapp.com | 1273864173 |  | NFS: Don't use GFP_KERNEL in rpcsec_gss downcalls  Again, we can deadlock if the memory reclaim triggers a writeback that requires a rpcsec_gss credential lookup.  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | xprtrdma.h | s | 2.9K | 70 | Alexandros Batsakis | batsakis@netapp.com | 1252871175 |  | nfsd41: sunrpc: add new xprt class for nfsv4.1 backchannel  [sunrpc: change idle timeout value for the backchannel] Signed-off-by: Alexandros Batsakis <batsakis@netapp.com> Signed-off-by: Benny Halevy <bhalevy@panasas.com> Acked-by: Trond Myklebust <Trond.Myklebust@netapp.com> Signed-off-by: J. Bruce Fields <bfields@citi.umich.edu>
f | xprt.h | s | 12K | 354 | Trond Myklebust | Trond.Myklebust@netapp.com | 1330720601 |  | SUNRPC: Move clnt->cl_server into struct rpc_xprt  When the cl_xprt field is updated, the cl_server field will also have to change.  Since the contents of cl_server follow the remote endpoint of cl_xprt, just move that field to the rpc_xprt.  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com> [ cel: simplify check_gss_callback_principal(), whitespace changes ] [ cel: forward ported to 3.4 ] Signed-off-by: Chuck Lever <chuck.lever@oracle.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | gss_api.h | s | 3.9K | 121 | Bryan Schumaker | bjschuma@netapp.com | 1300989162 |  | NFS: Determine initial mount security  When sec=<something> is not presented as a mount option, we should attempt to determine what security flavor the server is using.  Signed-off-by: Bryan Schumaker <bjschuma@netapp.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | rpc_rdma.h | s | 3.8K | 102 | Boaz Harrosh | bharrosh@panasas.com | 1260832328 |  | sunrpc: Clean never used include files  Remove include of two headers never used by this file. Doing so exposed a missing #include <linux/types.h> in include/linux/sunrpc/rpc_rdma.h.  I did not see any other users dependency but if exist they should be fixed since these headers are totally irrelevant to here.  Signed-off-by: Boaz Harrosh <bharrosh@panasas.com> Signed-off-by: J. Bruce Fields <bfields@citi.umich.edu>
f | timer.h | s | 1.1K | 41 | Arun Sharma | asharma@fb.com | 1311724187 |  | atomic: use <linux/atomic.h>  This allows us to move duplicated code in <asm/atomic.h> (atomic_inc_not_zero() for now) to <linux/atomic.h>  Signed-off-by: Arun Sharma <asharma@fb.com> Reviewed-by: Eric Dumazet <eric.dumazet@gmail.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: David Miller <davem@davemloft.net> Cc: Eric Dumazet <eric.dumazet@gmail.com> Acked-by: Mike Frysinger <vapier@gentoo.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | stats.h | s | 2.0K | 69 | Trond Myklebust | Trond.Myklebust@netapp.com | 1328056100 |  | SUNRPC: constify the rpc_program  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | metrics.h | s | 3.2K | 78 | Weston Andros Adamson | dros@netapp.com | 1329503987 |  | NFS: include filelayout DS rpc stats in mountstats  Include RPC statistics from all data servers in /proc/self/mountstats for pNFS filelayout mounts.  Signed-off-by: Weston Andros Adamson <dros@netapp.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | types.h | s | 426B | 18 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | gss_err.h | s | 5.9K | 145 | J. Bruce Fields | bfields@fieldses.org | 1129702787 |  | RPCSEC_GSS remove all qop parameters   Not only are the qop parameters that are passed around throughout the gssapi  unused by any currently implemented mechanism, but there appears to be some  doubt as to whether they will ever be used.  Let's just kill them off for now.   Signed-off-by: J. Bruce Fields <bfields@citi.umich.edu>  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | bc_xprt.h | s | 2.2K | 55 | Trond Myklebust | Trond.Myklebust@netapp.com | 1331508602 |  | SUNRPC: Fix a few sparse warnings  net/sunrpc/svcsock.c:412:22: warning: incorrect type in assignment (different address spaces)  - svc_partial_recvfrom now takes a struct kvec, so the variable    save_iovbase needs to be an ordinary (void *)  Make a bunch of variables in net/sunrpc/xprtsock.c static  Fix a couple of "warning: symbol 'foo' was not declared. Should it be static?" reports.  Fix a couple of conflicting function declarations.  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | svc_xprt.h | s | 6.1K | 184 | Stanislav Kinsbursky | skinsbursky@parallels.com | 1328056099 |  | SUNRPC: search for service transports in network namespace context  Service transports are parametrized by network namespace. And thus lookup of transport instance have to take network namespace into account.  Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com> Acked-by: J. Bruce Fields <bfields@redhat.com>
f | xdr.h | s | 7.7K | 198 | Andy Adamson | andros@netapp.com | 1325778162 |  | NFSv4: include bitmap in nfsv4 get acl data  The NFSv4 bitmap size is unbounded: a server can return an arbitrary sized bitmap in an FATTR4_WORD0_ACL request.  Replace using the nfs4_fattr_bitmap_maxsz as a guess to the maximum bitmask returned by a server with the inclusion of the bitmap (xdr length plus bitmasks) and the acl data xdr length to the (cached) acl page data.  This is a general solution to commit e5012d1f "NFSv4.1: update nfs4_fattr_bitmap_maxsz" and fixes hitting a BUG_ON in xdr_shrink_bufhead when getting ACLs.  Fix a bug in decode_getacl that returned -EINVAL on ACLs > page when getxattr was called with a NULL buffer, preventing ACL > PAGE_SIZE from being retrieved.  Cc: stable@kernel.org Signed-off-by: Andy Adamson <andros@netapp.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | auth_gss.h | s | 2.2K | 77 | Trond Myklebust | Trond.Myklebust@netapp.com | 1325778158 |  | SUNRPC: Clean up the RPCSEC_GSS service ticket requests  Instead of hacking specific service names into gss_encode_v1_msg, we should just allow the caller to specify the service name explicitly.  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com> Acked-by: J. Bruce Fields <bfields@redhat.com>
f | cache.h | s | 7.6K | 223 | Stanislav Kinsbursky | skinsbursky@parallels.com | 1328056096 |  | SUNRPC: generic cache register routines removed  All cache users now uses network-namespace-aware routines, so generic ones are obsolete.  Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com> Acked-by: J. Bruce Fields <bfields@redhat.com>
f | svc_rdma.h | s | 10K | 275 | Dan Carpenter | dan.carpenter@oracle.com | 1331075613 |  | svcrdma: silence a Sparse warning  Sparse complains that the definition function definition and the implementation aren't anotated the same way.  Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com> Acked-by: Tom Tucker <tom@opengridcomputing.com> Signed-off-by: J. Bruce Fields <bfields@redhat.com>
f | auth.h | s | 5.0K | 139 | Stanislav Kinsbursky | skinsbursky@parallels.com | 1328052025 |  | SUNRPC: subscribe RPC clients to pipefs notifications  This patch subscribes RPC clients to RPC pipefs notifications. RPC clients notifier block is registering with pipefs initialization during SUNRPC module init. This notifier callback is responsible for RPC client PipeFS directory and GSS pipes creation. For pipes creation and destruction two additional callbacks were added to struct rpc_authops. Note that no locking required in notifier callback because PipeFS superblock pointer is passed as an argument from it's creation or destruction routine and thus we can be sure about it's validity.  Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | xprtsock.h | s | 459B | 16 | Trond Myklebust | Trond.Myklebust@netapp.com | 1331508602 |  | SUNRPC: Fix a few sparse warnings  net/sunrpc/svcsock.c:412:22: warning: incorrect type in assignment (different address spaces)  - svc_partial_recvfrom now takes a struct kvec, so the variable    save_iovbase needs to be an ordinary (void *)  Make a bunch of variables in net/sunrpc/xprtsock.c static  Fix a couple of "warning: symbol 'foo' was not declared. Should it be static?" reports.  Fix a couple of conflicting function declarations.  Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | clnt.h | s | 9.5K | 282 | Chuck Lever | chuck.lever@oracle.com | 1330720613 |  | SUNRPC: Add API to acquire source address  NFSv4.0 clients must send endpoint information for their callback service to NFSv4.0 servers during their first contact with a server. Traditionally on Linux, user space provides the callback endpoint IP address via the "clientaddr=" mount option.  During an NFSv4 migration event, it is possible that an FSID may be migrated to a destination server that is accessible via a different source IP address than the source server was.  The client must update callback endpoint information on the destination server so that it can maintain leases and allow delegation.  Without a new "clientaddr=" option from user space, however, the kernel itself must construct an appropriate IP address for the callback update.  Provide an API in the RPC client for upper layer RPC consumers to acquire a source address for a remote.  The mechanism used by the mount.nfs command is copied: set up a connected UDP socket to the designated remote, then scrape the source address off the socket.  We are careful to select the correct network namespace when setting up the temporary UDP socket.  Signed-off-by: Chuck Lever <chuck.lever@oracle.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | msg_prot.h | s | 5.9K | 183 | Chuck Lever | chuck.lever@ORACLE.COM | 1306532567 |  | SUNRPC: Support for RPC over AF_LOCAL transports  TI-RPC introduces the capability of performing RPC over AF_LOCAL sockets.  It uses this mainly for registering and unregistering local RPC services securely with the local rpcbind, but we could also conceivably use it as a generic upcall mechanism.  This patch provides a client-side only implementation for the moment. We might also consider a server-side implementation to provide AF_LOCAL access to NLM (for statd downcalls, and such like).  Autobinding is not supported on kernel AF_LOCAL transports at this time.  Kernel ULPs must specify the pathname of the remote endpoint when an AF_LOCAL transport is created.  rpcbind supports registering services available via AF_LOCAL, so the kernel could handle it with some adjustment to ->rpcbind and ->set_port.  But we don't need this feature for doing upcalls via well-known named sockets.  This has not been tested with ULPs that move a substantial amount of data.  Thus, I can't attest to how robust the write_space and congestion management logic is.  Signed-off-by: Chuck Lever <chuck.lever@oracle.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | Kbuild | g | 20B |  | Sam Ravnborg | sam@ravnborg.org | 1281817611 |  | include: replace unifdef-y with header-y  unifdef-y and header-y has same semantic. So there is no need to have both.  Drop the unifdef-y variant and sort all lines again  Signed-off-by: Sam Ravnborg <sam@ravnborg.org>
f | gss_krb5_enctypes.h | s | 123B | 4 | J. Bruce Fields | bfields@redhat.com | 1307387235 |  | nfsd: fix dependency of nfsd on auth_rpcgss  Commit b0b0c0a26e84 "nfsd: add proc file listing kernel's gss_krb5 enctypes" added an nunnecessary dependency of nfsd on the auth_rpcgss module.  It's a little ad hoc, but since the only piece of information nfsd needs from rpcsec_gss_krb5 is a single static string, one solution is just to share it with an include file.  Cc: stable@kernel.org Reported-by: Michael Guntsche <mike@it-loops.com> Cc: Kevin Coffman <kwc@citi.umich.edu> Signed-off-by: J. Bruce Fields <bfields@redhat.com>
f | svcauth.h | s | 5.9K | 172 | J. Bruce Fields | bfields@redhat.com | 1338510598 |  | nfsd4: move rq_flavor into svc_cred  Move the rq_flavor into struct svc_cred, and use it in setclientid and exchange_id comparisons as well.  Signed-off-by: J. Bruce Fields <bfields@redhat.com>
f | svc.h | s | 14K | 407 | J. Bruce Fields | bfields@redhat.com | 1338510598 |  | nfsd4: move rq_flavor into svc_cred  Move the rq_flavor into struct svc_cred, and use it in setclientid and exchange_id comparisons as well.  Signed-off-by: J. Bruce Fields <bfields@redhat.com>
f | svcsock.h | s | 1.6K | 51 | Stanislav Kinsbursky | skinsbursky@parallels.com | 1329283185 |  | SUNRPC: service destruction in network namespace context  v2: Added comment to BUG_ON's in svc_destroy() to make code looks clearer.  This patch introduces network namespace filter for service destruction function. Nothing special here - just do exactly the same operations, but only for tranports in passed networks namespace context. BTW, BUG_ON() checks for empty service transports lists were returned into svc_destroy() function. This is because of swithing generic svc_close_all() to networks namespace dependable svc_close_net().  Signed-off-by: Stanislav Kinsbursky <skinsbursky@parallels.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
f | gss_asn1.h | s | 3.1K | 72 | Linus Torvalds | torvalds@ppc970.osdl.org | 1113690036 |  | Linux-2.6.12-rc2  Initial git repository build. I'm not bothering with the full history, even though we have it. We can create a separate "historical" git archive of that later if we want to, and in the meantime it's about 3.2GB when imported into git - space that would just make the early git days unnecessarily complicated, when we don't have a lot of good infrastructure for it.  Let it rip!
f | svcauth_gss.h | s | 758B | 23 | J. Bruce Fields | bfields@redhat.com | 1338510595 |  | nfsd4: move principal name into svc_cred  Instead of keeping the principal name associated with a request in a structure that's private to auth_gss and using an accessor function, move it to svc_cred.  Signed-off-by: J. Bruce Fields <bfields@redhat.com>
f | sched.h | s | 9.0K | 259 | Weston Andros Adamson | dros@netapp.com | 1329503987 |  | NFS: include filelayout DS rpc stats in mountstats  Include RPC statistics from all data servers in /proc/self/mountstats for pNFS filelayout mounts.  Signed-off-by: Weston Andros Adamson <dros@netapp.com> Signed-off-by: Trond Myklebust <Trond.Myklebust@netapp.com>
