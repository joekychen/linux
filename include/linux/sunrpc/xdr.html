<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › sunrpc › xdr.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>xdr.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * XDR standard data types and function declarations</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1995-1997 Olaf Kirch &lt;okir@monad.swb.de&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Based on:</span>
<span class="cm"> *   RFC 4506 &quot;XDR: External Data Representation Standard&quot;, May 2006</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _SUNRPC_XDR_H_</span>
<span class="cp">#define _SUNRPC_XDR_H_</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;linux/uio.h&gt;</span>
<span class="cp">#include &lt;asm/byteorder.h&gt;</span>
<span class="cp">#include &lt;asm/unaligned.h&gt;</span>
<span class="cp">#include &lt;linux/scatterlist.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Buffer adjustment</span>
<span class="cm"> */</span>
<span class="cp">#define XDR_QUADLEN(l)		(((l) + 3) &gt;&gt; 2)</span>

<span class="cm">/*</span>
<span class="cm"> * Generic opaque `network object.&#39; At the kernel level, this type</span>
<span class="cm"> * is used only by lockd.</span>
<span class="cm"> */</span>
<span class="cp">#define XDR_MAX_NETOBJ		1024</span>
<span class="k">struct</span> <span class="n">xdr_netobj</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span>			<span class="n">data</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * This is the legacy generic XDR function. rqstp is either a rpc_rqst</span>
<span class="cm"> * (client side) or svc_rqst pointer (server side).</span>
<span class="cm"> * Encode functions always assume there&#39;s enough room in the buffer.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="kt">int</span>	<span class="p">(</span><span class="o">*</span><span class="n">kxdrproc_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Basic structure for transmission/reception of a client XDR message.</span>
<span class="cm"> * Features a header (for a linear buffer containing RPC headers</span>
<span class="cm"> * and the data payload for short messages), and then an array of</span>
<span class="cm"> * pages.</span>
<span class="cm"> * The tail iovec allows you to append data after the page array. Its</span>
<span class="cm"> * main interest is for appending padding to the pages in order to</span>
<span class="cm"> * satisfy the int_32-alignment requirements in RFC1832.</span>
<span class="cm"> *</span>
<span class="cm"> * For the future, we might want to string several of these together</span>
<span class="cm"> * in a list if anybody wants to make use of NFSv4 COMPOUND</span>
<span class="cm"> * operations and/or has a need for scatter/gather involving pages.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">xdr_buf</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">kvec</span>	<span class="n">head</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>	<span class="cm">/* RPC header + non-page data */</span>
			<span class="n">tail</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>	<span class="cm">/* Appended after page data */</span>

	<span class="k">struct</span> <span class="n">page</span> <span class="o">**</span>	<span class="n">pages</span><span class="p">;</span>		<span class="cm">/* Array of contiguous pages */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">page_base</span><span class="p">,</span>	<span class="cm">/* Start of page data */</span>
			<span class="n">page_len</span><span class="p">,</span>	<span class="cm">/* Length of page data */</span>
			<span class="n">flags</span><span class="p">;</span>		<span class="cm">/* Flags for data disposition */</span>
<span class="cp">#define XDRBUF_READ		0x01		</span><span class="cm">/* target of file read */</span><span class="cp"></span>
<span class="cp">#define XDRBUF_WRITE		0x02		</span><span class="cm">/* source of file write */</span><span class="cp"></span>

	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">buflen</span><span class="p">,</span>		<span class="cm">/* Total length of storage buffer */</span>
			<span class="n">len</span><span class="p">;</span>		<span class="cm">/* Length of XDR encoded message */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * pre-xdr&#39;ed macros.</span>
<span class="cm"> */</span>

<span class="cp">#define	xdr_zero	cpu_to_be32(0)</span>
<span class="cp">#define	xdr_one		cpu_to_be32(1)</span>
<span class="cp">#define	xdr_two		cpu_to_be32(2)</span>

<span class="cp">#define	rpc_success		cpu_to_be32(RPC_SUCCESS)</span>
<span class="cp">#define	rpc_prog_unavail	cpu_to_be32(RPC_PROG_UNAVAIL)</span>
<span class="cp">#define	rpc_prog_mismatch	cpu_to_be32(RPC_PROG_MISMATCH)</span>
<span class="cp">#define	rpc_proc_unavail	cpu_to_be32(RPC_PROC_UNAVAIL)</span>
<span class="cp">#define	rpc_garbage_args	cpu_to_be32(RPC_GARBAGE_ARGS)</span>
<span class="cp">#define	rpc_system_err		cpu_to_be32(RPC_SYSTEM_ERR)</span>
<span class="cp">#define	rpc_drop_reply		cpu_to_be32(RPC_DROP_REPLY)</span>

<span class="cp">#define	rpc_auth_ok		cpu_to_be32(RPC_AUTH_OK)</span>
<span class="cp">#define	rpc_autherr_badcred	cpu_to_be32(RPC_AUTH_BADCRED)</span>
<span class="cp">#define	rpc_autherr_rejectedcred cpu_to_be32(RPC_AUTH_REJECTEDCRED)</span>
<span class="cp">#define	rpc_autherr_badverf	cpu_to_be32(RPC_AUTH_BADVERF)</span>
<span class="cp">#define	rpc_autherr_rejectedverf cpu_to_be32(RPC_AUTH_REJECTEDVERF)</span>
<span class="cp">#define	rpc_autherr_tooweak	cpu_to_be32(RPC_AUTH_TOOWEAK)</span>
<span class="cp">#define	rpcsec_gsserr_credproblem	cpu_to_be32(RPCSEC_GSS_CREDPROBLEM)</span>
<span class="cp">#define	rpcsec_gsserr_ctxproblem	cpu_to_be32(RPCSEC_GSS_CTXPROBLEM)</span>
<span class="cp">#define	rpc_autherr_oldseqnum	cpu_to_be32(101)</span>

<span class="cm">/*</span>
<span class="cm"> * Miscellaneous XDR helper functions</span>
<span class="cm"> */</span>
<span class="n">__be32</span> <span class="o">*</span><span class="n">xdr_encode_opaque_fixed</span><span class="p">(</span><span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="n">__be32</span> <span class="o">*</span><span class="n">xdr_encode_opaque</span><span class="p">(</span><span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="n">__be32</span> <span class="o">*</span><span class="n">xdr_encode_string</span><span class="p">(</span><span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
<span class="n">__be32</span> <span class="o">*</span><span class="n">xdr_decode_string_inplace</span><span class="p">(</span><span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">sp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">lenp</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">maxlen</span><span class="p">);</span>
<span class="n">__be32</span> <span class="o">*</span><span class="n">xdr_encode_netobj</span><span class="p">(</span><span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">xdr_netobj</span> <span class="o">*</span><span class="p">);</span>
<span class="n">__be32</span> <span class="o">*</span><span class="n">xdr_decode_netobj</span><span class="p">(</span><span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_netobj</span> <span class="o">*</span><span class="p">);</span>

<span class="kt">void</span>	<span class="n">xdr_encode_pages</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>
			 <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span>	<span class="n">xdr_inline_pages</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span>	<span class="n">xdr_terminate_string</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">u32</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="o">*</span><span class="nf">xdr_encode_array</span><span class="p">(</span><span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">xdr_encode_opaque</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode 64bit quantities (NFSv3 support)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="o">*</span>
<span class="nf">xdr_encode_hyper</span><span class="p">(</span><span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">__u64</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">put_unaligned_be64</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">p</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="o">*</span>
<span class="nf">xdr_decode_hyper</span><span class="p">(</span><span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">__u64</span> <span class="o">*</span><span class="n">valp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="n">valp</span> <span class="o">=</span> <span class="n">get_unaligned_be64</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">__be32</span> <span class="o">*</span>
<span class="nf">xdr_decode_opaque_fixed</span><span class="p">(</span><span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">p</span> <span class="o">+</span> <span class="n">XDR_QUADLEN</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Adjust kvec to reflect end of xdr&#39;ed data (RPC client XDR)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span>
<span class="nf">xdr_adjust_iovec</span><span class="p">(</span><span class="k">struct</span> <span class="n">kvec</span> <span class="o">*</span><span class="n">iov</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">iov</span><span class="o">-&gt;</span><span class="n">iov_len</span> <span class="o">=</span> <span class="p">((</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">iov</span><span class="o">-&gt;</span><span class="n">iov_base</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * XDR buffer helper functions</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xdr_shift_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xdr_buf_from_iov</span><span class="p">(</span><span class="k">struct</span> <span class="n">kvec</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">xdr_buf_subsegment</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">xdr_buf_read_netobj</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_netobj</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">read_bytes_from_xdr_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">write_bytes_to_xdr_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Helper structure for copying from an sk_buff.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">xdr_skb_reader</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sk_buff</span>	<span class="o">*</span><span class="n">skb</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">offset</span><span class="p">;</span>
	<span class="kt">size_t</span>		<span class="n">count</span><span class="p">;</span>
	<span class="n">__wsum</span>		<span class="n">csum</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="kt">size_t</span> <span class="p">(</span><span class="o">*</span><span class="n">xdr_skb_read_actor</span><span class="p">)(</span><span class="k">struct</span> <span class="n">xdr_skb_reader</span> <span class="o">*</span><span class="n">desc</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">to</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>

<span class="kt">size_t</span> <span class="n">xdr_skb_read_bits</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_skb_reader</span> <span class="o">*</span><span class="n">desc</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">to</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">csum_partial_copy_to_xdr</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">ssize_t</span> <span class="n">xdr_partial_copy_from_skb</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">xdr_skb_reader</span> <span class="o">*</span><span class="p">,</span> <span class="n">xdr_skb_read_actor</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">xdr_encode_word</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">xdr_decode_word</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">xdr_array2_desc</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">xdr_xcode_elem_t</span><span class="p">)(</span><span class="k">struct</span> <span class="n">xdr_array2_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">elem</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">xdr_array2_desc</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">elem_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">array_len</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">array_maxlen</span><span class="p">;</span>
	<span class="n">xdr_xcode_elem_t</span> <span class="n">xcode</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">xdr_decode_array2</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">base</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">xdr_array2_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">xdr_encode_array2</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">base</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">xdr_array2_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">_copy_from_pages</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="n">pages</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">pgbase</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Provide some simple tools for XDR buffer overflow-checking etc.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>		<span class="cm">/* start of available buffer */</span>
	<span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>	<span class="cm">/* XDR buffer to read/write */</span>

	<span class="n">__be32</span> <span class="o">*</span><span class="n">end</span><span class="p">;</span>		<span class="cm">/* end of available buffer space */</span>
	<span class="k">struct</span> <span class="n">kvec</span> <span class="o">*</span><span class="n">iov</span><span class="p">;</span>	<span class="cm">/* pointer to the current kvec */</span>
	<span class="k">struct</span> <span class="n">kvec</span> <span class="n">scratch</span><span class="p">;</span>	<span class="cm">/* Scratch buffer */</span>
	<span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="n">page_ptr</span><span class="p">;</span>	<span class="cm">/* pointer to the current page */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * These are the xdr_stream style generic XDR encode and decode functions.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="kt">void</span>	<span class="p">(</span><span class="o">*</span><span class="n">kxdreproc_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">int</span>	<span class="p">(</span><span class="o">*</span><span class="n">kxdrdproc_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">obj</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">xdr_init_encode</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">xdr_reserve_space</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xdr_write_pages</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="n">pages</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">base</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xdr_init_decode</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xdr_init_decode_pages</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="n">pages</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xdr_set_scratch_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">buflen</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">xdr_inline_decode</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xdr_read_pages</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xdr_enter_page</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">xdr_process_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">actor</span><span class="p">)(</span><span class="k">struct</span> <span class="n">scatterlist</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">),</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _SUNRPC_XDR_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
