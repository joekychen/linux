<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › sunrpc › clnt.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>clnt.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  linux/include/linux/sunrpc/clnt.h</span>
<span class="cm"> *</span>
<span class="cm"> *  Declarations for the high-level RPC client interface</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 1995, 1996, Olaf Kirch &lt;okir@monad.swb.de&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _LINUX_SUNRPC_CLNT_H</span>
<span class="cp">#define _LINUX_SUNRPC_CLNT_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/socket.h&gt;</span>
<span class="cp">#include &lt;linux/in.h&gt;</span>
<span class="cp">#include &lt;linux/in6.h&gt;</span>

<span class="cp">#include &lt;linux/sunrpc/msg_prot.h&gt;</span>
<span class="cp">#include &lt;linux/sunrpc/sched.h&gt;</span>
<span class="cp">#include &lt;linux/sunrpc/xprt.h&gt;</span>
<span class="cp">#include &lt;linux/sunrpc/auth.h&gt;</span>
<span class="cp">#include &lt;linux/sunrpc/stats.h&gt;</span>
<span class="cp">#include &lt;linux/sunrpc/xdr.h&gt;</span>
<span class="cp">#include &lt;linux/sunrpc/timer.h&gt;</span>
<span class="cp">#include &lt;asm/signal.h&gt;</span>
<span class="cp">#include &lt;linux/path.h&gt;</span>
<span class="cp">#include &lt;net/ipv6.h&gt;</span>

<span class="k">struct</span> <span class="n">rpc_inode</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * The high-level client handle</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="p">{</span>
	<span class="n">atomic_t</span>		<span class="n">cl_count</span><span class="p">;</span>	<span class="cm">/* Number of references */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">cl_clients</span><span class="p">;</span>	<span class="cm">/* Global list of clients */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">cl_tasks</span><span class="p">;</span>	<span class="cm">/* List of tasks */</span>
	<span class="n">spinlock_t</span>		<span class="n">cl_lock</span><span class="p">;</span>	<span class="cm">/* spinlock */</span>
	<span class="k">struct</span> <span class="n">rpc_xprt</span> <span class="n">__rcu</span> <span class="o">*</span>	<span class="n">cl_xprt</span><span class="p">;</span>	<span class="cm">/* transport */</span>
	<span class="k">struct</span> <span class="n">rpc_procinfo</span> <span class="o">*</span>	<span class="n">cl_procinfo</span><span class="p">;</span>	<span class="cm">/* procedure info */</span>
	<span class="n">u32</span>			<span class="n">cl_prog</span><span class="p">,</span>	<span class="cm">/* RPC program number */</span>
				<span class="n">cl_vers</span><span class="p">,</span>	<span class="cm">/* RPC version number */</span>
				<span class="n">cl_maxproc</span><span class="p">;</span>	<span class="cm">/* max procedure number */</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span>		<span class="n">cl_protname</span><span class="p">;</span>	<span class="cm">/* protocol name */</span>
	<span class="k">struct</span> <span class="n">rpc_auth</span> <span class="o">*</span>	<span class="n">cl_auth</span><span class="p">;</span>	<span class="cm">/* authenticator */</span>
	<span class="k">struct</span> <span class="n">rpc_stat</span> <span class="o">*</span>	<span class="n">cl_stats</span><span class="p">;</span>	<span class="cm">/* per-program statistics */</span>
	<span class="k">struct</span> <span class="n">rpc_iostats</span> <span class="o">*</span>	<span class="n">cl_metrics</span><span class="p">;</span>	<span class="cm">/* per-client statistics */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">cl_softrtry</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span><span class="cm">/* soft timeouts */</span>
				<span class="n">cl_discrtry</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span><span class="cm">/* disconnect before retry */</span>
				<span class="n">cl_autobind</span> <span class="o">:</span> <span class="mi">1</span><span class="p">,</span><span class="cm">/* use getport() */</span>
				<span class="n">cl_chatty</span>   <span class="o">:</span> <span class="mi">1</span><span class="p">;</span><span class="cm">/* be verbose */</span>

	<span class="k">struct</span> <span class="n">rpc_rtt</span> <span class="o">*</span>	<span class="n">cl_rtt</span><span class="p">;</span>		<span class="cm">/* RTO estimator data */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">rpc_timeout</span> <span class="o">*</span><span class="n">cl_timeout</span><span class="p">;</span>	<span class="cm">/* Timeout strategy */</span>

	<span class="kt">int</span>			<span class="n">cl_nodelen</span><span class="p">;</span>	<span class="cm">/* nodename length */</span>
	<span class="kt">char</span> 			<span class="n">cl_nodename</span><span class="p">[</span><span class="n">UNX_MAXNODENAME</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span>		<span class="n">cl_dentry</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span>	<span class="n">cl_parent</span><span class="p">;</span>	<span class="cm">/* Points to parent of clones */</span>
	<span class="k">struct</span> <span class="n">rpc_rtt</span>		<span class="n">cl_rtt_default</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rpc_timeout</span>	<span class="n">cl_timeout_default</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">rpc_program</span> <span class="o">*</span><span class="n">cl_program</span><span class="p">;</span>
	<span class="kt">char</span>			<span class="o">*</span><span class="n">cl_principal</span><span class="p">;</span>	<span class="cm">/* target to authenticate to */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * General RPC program info</span>
<span class="cm"> */</span>
<span class="cp">#define RPC_MAXVERSION		4</span>
<span class="k">struct</span> <span class="n">rpc_program</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span>		<span class="n">name</span><span class="p">;</span>		<span class="cm">/* protocol name */</span>
	<span class="n">u32</span>			<span class="n">number</span><span class="p">;</span>		<span class="cm">/* program number */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">nrvers</span><span class="p">;</span>		<span class="cm">/* number of versions */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">rpc_version</span> <span class="o">**</span>	<span class="n">version</span><span class="p">;</span>	<span class="cm">/* version array */</span>
	<span class="k">struct</span> <span class="n">rpc_stat</span> <span class="o">*</span>	<span class="n">stats</span><span class="p">;</span>		<span class="cm">/* statistics */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span>		<span class="n">pipe_dir_name</span><span class="p">;</span>	<span class="cm">/* path to rpc_pipefs dir */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rpc_version</span> <span class="p">{</span>
	<span class="n">u32</span>			<span class="n">number</span><span class="p">;</span>		<span class="cm">/* version number */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">nrprocs</span><span class="p">;</span>	<span class="cm">/* number of procs */</span>
	<span class="k">struct</span> <span class="n">rpc_procinfo</span> <span class="o">*</span>	<span class="n">procs</span><span class="p">;</span>		<span class="cm">/* procedure array */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Procedure information</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">rpc_procinfo</span> <span class="p">{</span>
	<span class="n">u32</span>			<span class="n">p_proc</span><span class="p">;</span>		<span class="cm">/* RPC procedure number */</span>
	<span class="n">kxdreproc_t</span>		<span class="n">p_encode</span><span class="p">;</span>	<span class="cm">/* XDR encode function */</span>
	<span class="n">kxdrdproc_t</span>		<span class="n">p_decode</span><span class="p">;</span>	<span class="cm">/* XDR decode function */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">p_arglen</span><span class="p">;</span>	<span class="cm">/* argument hdr length (u32) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">p_replen</span><span class="p">;</span>	<span class="cm">/* reply hdr length (u32) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">p_count</span><span class="p">;</span>	<span class="cm">/* call count */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">p_timer</span><span class="p">;</span>	<span class="cm">/* Which RTT timer to use */</span>
	<span class="n">u32</span>			<span class="n">p_statidx</span><span class="p">;</span>	<span class="cm">/* Which procedure to account */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span>		<span class="n">p_name</span><span class="p">;</span>		<span class="cm">/* name of procedure */</span>
<span class="p">};</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="k">struct</span> <span class="n">rpc_create_args</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">net</span>		<span class="o">*</span><span class="n">net</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">protocol</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sockaddr</span>		<span class="o">*</span><span class="n">address</span><span class="p">;</span>
	<span class="kt">size_t</span>			<span class="n">addrsize</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sockaddr</span>		<span class="o">*</span><span class="n">saddress</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">rpc_timeout</span> <span class="o">*</span><span class="n">timeout</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span>		<span class="o">*</span><span class="n">servername</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">rpc_program</span> <span class="o">*</span><span class="n">program</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">prognumber</span><span class="p">;</span>	<span class="cm">/* overrides program-&gt;number */</span>
	<span class="n">u32</span>			<span class="n">version</span><span class="p">;</span>
	<span class="n">rpc_authflavor_t</span>	<span class="n">authflavor</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">flags</span><span class="p">;</span>
	<span class="kt">char</span>			<span class="o">*</span><span class="n">client_name</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">svc_xprt</span>		<span class="o">*</span><span class="n">bc_xprt</span><span class="p">;</span>	<span class="cm">/* NFSv4.1 backchannel */</span>
<span class="p">};</span>

<span class="cm">/* Values for &quot;flags&quot; field */</span>
<span class="cp">#define RPC_CLNT_CREATE_HARDRTRY	(1UL &lt;&lt; 0)</span>
<span class="cp">#define RPC_CLNT_CREATE_AUTOBIND	(1UL &lt;&lt; 2)</span>
<span class="cp">#define RPC_CLNT_CREATE_NONPRIVPORT	(1UL &lt;&lt; 3)</span>
<span class="cp">#define RPC_CLNT_CREATE_NOPING		(1UL &lt;&lt; 4)</span>
<span class="cp">#define RPC_CLNT_CREATE_DISCRTRY	(1UL &lt;&lt; 5)</span>
<span class="cp">#define RPC_CLNT_CREATE_QUIET		(1UL &lt;&lt; 6)</span>

<span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="n">rpc_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_create_args</span> <span class="o">*</span><span class="n">args</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">rpc_clnt</span>	<span class="o">*</span><span class="n">rpc_bind_new_program</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">,</span>
				<span class="k">const</span> <span class="k">struct</span> <span class="n">rpc_program</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">rpc_task_reset_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_task</span> <span class="o">*</span><span class="n">task</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="n">clnt</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="n">rpc_clone_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">rpc_shutdown_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">rpc_release_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">rpc_task_release_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_task</span> <span class="o">*</span><span class="p">);</span>

<span class="kt">int</span>		<span class="n">rpcb_create_local</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">rpcb_put_local</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">rpcb_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">rpcb_v4_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="n">net</span><span class="p">,</span> <span class="k">const</span> <span class="n">u32</span> <span class="n">program</span><span class="p">,</span>
				 <span class="k">const</span> <span class="n">u32</span> <span class="n">version</span><span class="p">,</span>
				 <span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">address</span><span class="p">,</span>
				 <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">netid</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">rpcb_getport_async</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_task</span> <span class="o">*</span><span class="p">);</span>

<span class="kt">void</span>		<span class="n">rpc_call_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_task</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">rpc_call_async</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="n">clnt</span><span class="p">,</span>
			       <span class="k">const</span> <span class="k">struct</span> <span class="n">rpc_message</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span>
			       <span class="k">const</span> <span class="k">struct</span> <span class="n">rpc_call_ops</span> <span class="o">*</span><span class="n">tk_ops</span><span class="p">,</span>
			       <span class="kt">void</span> <span class="o">*</span><span class="n">calldata</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">rpc_call_sync</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="n">clnt</span><span class="p">,</span>
			      <span class="k">const</span> <span class="k">struct</span> <span class="n">rpc_message</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">rpc_task</span> <span class="o">*</span><span class="n">rpc_call_null</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="n">clnt</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rpc_cred</span> <span class="o">*</span><span class="n">cred</span><span class="p">,</span>
			       <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">rpc_restart_call_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_task</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">rpc_restart_call</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_task</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">rpc_setbufsize</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">rpc_protocol</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">net</span> <span class="o">*</span>	<span class="n">rpc_net_ns</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">size_t</span>		<span class="n">rpc_max_payload</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">rpc_force_rebind</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">size_t</span>		<span class="n">rpc_peeraddr</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">rpc_peeraddr2str</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">,</span> <span class="k">enum</span> <span class="n">rpc_display_format_t</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">rpc_localaddr</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_clnt</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">);</span>

<span class="kt">size_t</span>		<span class="n">rpc_ntop</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span><span class="p">);</span>
<span class="kt">size_t</span>		<span class="n">rpc_pton</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span><span class="p">);</span>
<span class="kt">char</span> <span class="o">*</span>		<span class="n">rpc_sockaddr2uaddr</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">,</span> <span class="n">gfp_t</span><span class="p">);</span>
<span class="kt">size_t</span>		<span class="n">rpc_uaddr2sockaddr</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">size_t</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="nf">rpc_get_port</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sap</span><span class="o">-&gt;</span><span class="n">sa_family</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AF_INET</span>:
		<span class="k">return</span> <span class="n">ntohs</span><span class="p">(((</span><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">)</span><span class="n">sap</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sin_port</span><span class="p">);</span>
	<span class="k">case</span> <span class="n">AF_INET6</span>:
		<span class="k">return</span> <span class="n">ntohs</span><span class="p">(((</span><span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="p">)</span><span class="n">sap</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sin6_port</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rpc_set_port</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sap</span><span class="p">,</span>
				<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sap</span><span class="o">-&gt;</span><span class="n">sa_family</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AF_INET</span>:
		<span class="p">((</span><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">)</span><span class="n">sap</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sin_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AF_INET6</span>:
		<span class="p">((</span><span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="p">)</span><span class="n">sap</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sin6_port</span> <span class="o">=</span> <span class="n">htons</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cp">#define IPV6_SCOPE_DELIMITER		&#39;%&#39;</span>
<span class="cp">#define IPV6_SCOPE_ID_LEN		sizeof(&quot;%nnnnnnnnnn&quot;)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">__rpc_cmp_addr4</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sap1</span><span class="p">,</span>
				   <span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sap2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="n">sin1</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">)</span><span class="n">sap1</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="n">sin2</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">)</span><span class="n">sap2</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">sin1</span><span class="o">-&gt;</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">==</span> <span class="n">sin2</span><span class="o">-&gt;</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">__rpc_copy_addr4</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
				    <span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="n">ssin</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">)</span> <span class="n">src</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="n">dsin</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in</span> <span class="o">*</span><span class="p">)</span> <span class="n">dst</span><span class="p">;</span>

	<span class="n">dsin</span><span class="o">-&gt;</span><span class="n">sin_family</span> <span class="o">=</span> <span class="n">ssin</span><span class="o">-&gt;</span><span class="n">sin_family</span><span class="p">;</span>
	<span class="n">dsin</span><span class="o">-&gt;</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span> <span class="o">=</span> <span class="n">ssin</span><span class="o">-&gt;</span><span class="n">sin_addr</span><span class="p">.</span><span class="n">s_addr</span><span class="p">;</span>
	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#if IS_ENABLED(CONFIG_IPV6)</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">__rpc_cmp_addr6</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sap1</span><span class="p">,</span>
				   <span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sap2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="n">sin1</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="p">)</span><span class="n">sap1</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="n">sin2</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="p">)</span><span class="n">sap2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ipv6_addr_equal</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sin1</span><span class="o">-&gt;</span><span class="n">sin6_addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sin2</span><span class="o">-&gt;</span><span class="n">sin6_addr</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ipv6_addr_type</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sin1</span><span class="o">-&gt;</span><span class="n">sin6_addr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">IPV6_ADDR_LINKLOCAL</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">sin1</span><span class="o">-&gt;</span><span class="n">sin6_scope_id</span> <span class="o">==</span> <span class="n">sin2</span><span class="o">-&gt;</span><span class="n">sin6_scope_id</span><span class="p">;</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">__rpc_copy_addr6</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
				    <span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="n">ssin6</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="p">)</span> <span class="n">src</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="n">dsin6</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="p">)</span> <span class="n">dst</span><span class="p">;</span>

	<span class="n">dsin6</span><span class="o">-&gt;</span><span class="n">sin6_family</span> <span class="o">=</span> <span class="n">ssin6</span><span class="o">-&gt;</span><span class="n">sin6_family</span><span class="p">;</span>
	<span class="n">dsin6</span><span class="o">-&gt;</span><span class="n">sin6_addr</span> <span class="o">=</span> <span class="n">ssin6</span><span class="o">-&gt;</span><span class="n">sin6_addr</span><span class="p">;</span>
	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#else	</span><span class="cm">/* !(IS_ENABLED(CONFIG_IPV6) */</span><span class="cp"></span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">__rpc_cmp_addr6</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sap1</span><span class="p">,</span>
				   <span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sap2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">__rpc_copy_addr6</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
				    <span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif	</span><span class="cm">/* !(IS_ENABLED(CONFIG_IPV6) */</span><span class="cp"></span>

<span class="cm">/**</span>
<span class="cm"> * rpc_cmp_addr - compare the address portion of two sockaddrs.</span>
<span class="cm"> * @sap1: first sockaddr</span>
<span class="cm"> * @sap2: second sockaddr</span>
<span class="cm"> *</span>
<span class="cm"> * Just compares the family and address portion. Ignores port, scope, etc.</span>
<span class="cm"> * Returns true if the addrs are equal, false if they aren&#39;t.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">rpc_cmp_addr</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sap1</span><span class="p">,</span>
				<span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sap2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sap1</span><span class="o">-&gt;</span><span class="n">sa_family</span> <span class="o">==</span> <span class="n">sap2</span><span class="o">-&gt;</span><span class="n">sa_family</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">sap1</span><span class="o">-&gt;</span><span class="n">sa_family</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">AF_INET</span>:
			<span class="k">return</span> <span class="n">__rpc_cmp_addr4</span><span class="p">(</span><span class="n">sap1</span><span class="p">,</span> <span class="n">sap2</span><span class="p">);</span>
		<span class="k">case</span> <span class="n">AF_INET6</span>:
			<span class="k">return</span> <span class="n">__rpc_cmp_addr6</span><span class="p">(</span><span class="n">sap1</span><span class="p">,</span> <span class="n">sap2</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rpc_copy_addr - copy the address portion of one sockaddr to another</span>
<span class="cm"> * @dst: destination sockaddr</span>
<span class="cm"> * @src: source sockaddr</span>
<span class="cm"> *</span>
<span class="cm"> * Just copies the address portion and family. Ignores port, scope, etc.</span>
<span class="cm"> * Caller is responsible for making certain that dst is large enough to hold</span>
<span class="cm"> * the address in src. Returns true if address family is supported. Returns</span>
<span class="cm"> * false otherwise.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">rpc_copy_addr</span><span class="p">(</span><span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
				 <span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">src</span><span class="o">-&gt;</span><span class="n">sa_family</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AF_INET</span>:
		<span class="k">return</span> <span class="n">__rpc_copy_addr4</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
	<span class="k">case</span> <span class="n">AF_INET6</span>:
		<span class="k">return</span> <span class="n">__rpc_copy_addr6</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rpc_get_scope_id - return scopeid for a given sockaddr</span>
<span class="cm"> * @sa: sockaddr to get scopeid from</span>
<span class="cm"> *</span>
<span class="cm"> * Returns the value of the sin6_scope_id for AF_INET6 addrs, or 0 if</span>
<span class="cm"> * not an AF_INET6 address.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">rpc_get_scope_id</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">sa</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sa</span><span class="o">-&gt;</span><span class="n">sa_family</span> <span class="o">!=</span> <span class="n">AF_INET6</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="p">((</span><span class="k">struct</span> <span class="n">sockaddr_in6</span> <span class="o">*</span><span class="p">)</span> <span class="n">sa</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">sin6_scope_id</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* _LINUX_SUNRPC_CLNT_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
