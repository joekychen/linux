<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › dio.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>dio.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* header file for DIO boards for the HP300 architecture.</span>
<span class="cm"> * Maybe this should handle DIO-II later?</span>
<span class="cm"> * The general structure of this is vaguely based on how</span>
<span class="cm"> * the Amiga port handles Zorro boards.</span>
<span class="cm"> * Copyright (C) Peter Maydell 05/1998 &lt;pmaydell@chiark.greenend.org.uk&gt;</span>
<span class="cm"> * Converted to driver model Jochen Friedrich &lt;jochen@scram.de&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * The board IDs are from the NetBSD kernel, which for once provided</span>
<span class="cm"> * helpful comments...</span>
<span class="cm"> *</span>
<span class="cm"> * This goes with drivers/dio/dio.c</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _LINUX_DIO_H</span>
<span class="cp">#define _LINUX_DIO_H</span>

<span class="cm">/* The DIO boards in a system are distinguished by &#39;select codes&#39; which </span>
<span class="cm"> * range from 0-63 (DIO) and 132-255 (DIO-II). </span>
<span class="cm"> * The DIO board with select code sc is located at physical address </span>
<span class="cm"> *     0x600000 + sc * 0x10000</span>
<span class="cm"> * So DIO cards cover [0x600000-0x800000); the areas [0x200000-0x400000) and</span>
<span class="cm"> * [0x800000-0x1000000) are for additional space required by things</span>
<span class="cm"> * like framebuffers. [0x400000-0x600000) is for miscellaneous internal I/O.</span>
<span class="cm"> * On Linux, this is currently all mapped into the virtual address space</span>
<span class="cm"> * at 0xf0000000 on bootup.</span>
<span class="cm"> * DIO-II boards are at 0x1000000 + (sc - 132) * 0x400000</span>
<span class="cm"> * which is address range [0x1000000-0x20000000) -- too big to map completely,</span>
<span class="cm"> * so currently we just don&#39;t handle DIO-II boards.  It wouldn&#39;t be hard to </span>
<span class="cm"> * do with ioremap() though.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/device.h&gt;</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;asm/hp300hw.h&gt;</span>

<span class="k">typedef</span> <span class="n">__u16</span> <span class="n">dio_id</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     *  DIO devices</span>
<span class="cm">     */</span>

<span class="k">struct</span> <span class="n">dio_dev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">dio_bus</span> <span class="o">*</span><span class="n">bus</span><span class="p">;</span>
	<span class="n">dio_id</span> <span class="n">id</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">scode</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dio_driver</span> <span class="o">*</span><span class="n">driver</span><span class="p">;</span>	<span class="cm">/* which driver has allocated this device */</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="n">dev</span><span class="p">;</span>		<span class="cm">/* Generic device interface */</span>
	<span class="n">u8</span> <span class="n">ipl</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="n">resource</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define to_dio_dev(n) container_of(n, struct dio_dev, dev)</span>

    <span class="cm">/*</span>
<span class="cm">     *  DIO bus</span>
<span class="cm">     */</span>

<span class="k">struct</span> <span class="n">dio_bus</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">devices</span><span class="p">;</span>           <span class="cm">/* list of devices on this bus */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_resources</span><span class="p">;</span>         <span class="cm">/* number of resources */</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="n">resources</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>       <span class="cm">/* address space routed to this bus */</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="n">dev</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">dio_bus</span> <span class="n">dio_bus</span><span class="p">;</span>      <span class="cm">/* Single DIO bus */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">bus_type</span> <span class="n">dio_bus_type</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     *  DIO device IDs</span>
<span class="cm">     */</span>

<span class="k">struct</span> <span class="n">dio_device_id</span> <span class="p">{</span>
	<span class="n">dio_id</span> <span class="n">id</span><span class="p">;</span>                    <span class="cm">/* Device ID or DIO_WILDCARD */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">driver_data</span><span class="p">;</span>    <span class="cm">/* Data private to the driver */</span>
<span class="p">};</span>

    <span class="cm">/*</span>
<span class="cm">     *  DIO device drivers</span>
<span class="cm">     */</span>

<span class="k">struct</span> <span class="n">dio_driver</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">node</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">dio_device_id</span> <span class="o">*</span><span class="n">id_table</span><span class="p">;</span>     <span class="cm">/* NULL if wants all devices */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">probe</span><span class="p">)(</span><span class="k">struct</span> <span class="n">dio_dev</span> <span class="o">*</span><span class="n">z</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dio_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">);</span>
<span class="cm">/* New device inserted */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">remove</span><span class="p">)(</span><span class="k">struct</span> <span class="n">dio_dev</span> <span class="o">*</span><span class="n">z</span><span class="p">);</span>        <span class="cm">/* Device removed (NULL if not a hot-plug capable driver) */</span>
	<span class="k">struct</span> <span class="n">device_driver</span> <span class="n">driver</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define to_dio_driver(drv)    container_of(drv, struct dio_driver, driver)</span>

<span class="cm">/* DIO/DIO-II boards all have the following 8bit registers.</span>
<span class="cm"> * These are offsets from the base of the device.</span>
<span class="cm"> */</span>
<span class="cp">#define DIO_IDOFF     0x01             </span><span class="cm">/* primary device ID */</span><span class="cp"></span>
<span class="cp">#define DIO_IPLOFF    0x03             </span><span class="cm">/* interrupt priority level */</span><span class="cp"></span>
<span class="cp">#define DIO_SECIDOFF  0x15             </span><span class="cm">/* secondary device ID */</span><span class="cp"></span>
<span class="cp">#define DIOII_SIZEOFF 0x101            </span><span class="cm">/* device size, DIO-II only */</span><span class="cp"></span>
<span class="cp">#define DIO_VIRADDRBASE 0xf0000000UL   </span><span class="cm">/* vir addr where IOspace is mapped */</span><span class="cp"></span>

<span class="cp">#define DIO_BASE                0x600000        </span><span class="cm">/* start of DIO space */</span><span class="cp"></span>
<span class="cp">#define DIO_END                 0x1000000       </span><span class="cm">/* end of DIO space */</span><span class="cp"></span>
<span class="cp">#define DIO_DEVSIZE             0x10000         </span><span class="cm">/* size of a DIO device */</span><span class="cp"></span>

<span class="cp">#define DIOII_BASE              0x01000000      </span><span class="cm">/* start of DIO-II space */</span><span class="cp"></span>
<span class="cp">#define DIOII_END               0x20000000      </span><span class="cm">/* end of DIO-II space */</span><span class="cp"></span>
<span class="cp">#define DIOII_DEVSIZE           0x00400000      </span><span class="cm">/* size of a DIO-II device */</span><span class="cp"></span>

<span class="cm">/* Highest valid select code. If we add DIO-II support this should become</span>
<span class="cm"> * 256 for everything except HP320, which only has DIO.</span>
<span class="cm"> */</span>
<span class="cp">#define DIO_SCMAX (hp300_model == HP_320 ? 32 : 256)</span>
<span class="cp">#define DIOII_SCBASE 132 </span><span class="cm">/* lowest DIO-II select code */</span><span class="cp"></span>
<span class="cp">#define DIO_SCINHOLE(scode) (((scode) &gt;= 32) &amp;&amp; ((scode) &lt; DIOII_SCBASE))</span>
<span class="cp">#define DIO_ISDIOII(scode) ((scode) &gt;= 132 &amp;&amp; (scode) &lt; 256)</span>

<span class="cm">/* macros to read device IDs, given base address */</span>
<span class="cp">#define DIO_ID(baseaddr) in_8((baseaddr) + DIO_IDOFF)</span>
<span class="cp">#define DIO_SECID(baseaddr) in_8((baseaddr) + DIO_SECIDOFF)</span>

<span class="cm">/* extract the interrupt level */</span>
<span class="cp">#define DIO_IPL(baseaddr) (((in_8((baseaddr) + DIO_IPLOFF) &gt;&gt; 4) &amp; 0x03) + 3)</span>

<span class="cm">/* find the size of a DIO-II board&#39;s address space.</span>
<span class="cm"> * DIO boards are all fixed length.</span>
<span class="cm"> */</span>
<span class="cp">#define DIOII_SIZE(baseaddr) ((in_8((baseaddr) + DIOII_SIZEOFF) + 1) * 0x100000)</span>

<span class="cm">/* general purpose macro for both DIO and DIO-II */</span>
<span class="cp">#define DIO_SIZE(scode, base) (DIO_ISDIOII((scode)) ? DIOII_SIZE((base)) : DIO_DEVSIZE)</span>

<span class="cm">/* The hardware has primary and secondary IDs; we encode these in a single</span>
<span class="cm"> * int as PRIMARY ID &amp; (SECONDARY ID &lt;&lt; 8).</span>
<span class="cm"> * In practice this is only important for framebuffers,</span>
<span class="cm"> * and everybody else just sets ID fields equal to the DIO_ID_FOO value.</span>
<span class="cm"> */</span>
<span class="cp">#define DIO_ENCODE_ID(pr,sec) ((((int)sec &amp; 0xff) &lt;&lt; 8) | ((int)pr &amp; 0xff))</span>
<span class="cm">/* macro to determine whether a given primary ID requires a secondary ID byte */</span>
<span class="cp">#define DIO_NEEDSSECID(id) ((id) == DIO_ID_FBUFFER)</span>
<span class="cp">#define DIO_WILDCARD 0xff</span>

<span class="cm">/* Now a whole slew of macros giving device IDs and descriptive strings: */</span>
<span class="cp">#define DIO_ID_DCA0     0x02 </span><span class="cm">/* 98644A serial */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_DCA0 &quot;98644A DCA0 serial&quot;</span>
<span class="cp">#define DIO_ID_DCA0REM  0x82 </span><span class="cm">/* 98644A serial */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_DCA0REM &quot;98644A DCA0REM serial&quot;</span>
<span class="cp">#define DIO_ID_DCA1     0x42 </span><span class="cm">/* 98644A serial */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_DCA1 &quot;98644A DCA1 serial&quot;</span>
<span class="cp">#define DIO_ID_DCA1REM  0xc2 </span><span class="cm">/* 98644A serial */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_DCA1REM &quot;98644A DCA1REM serial&quot;</span>
<span class="cp">#define DIO_ID_DCM      0x05 </span><span class="cm">/* 98642A serial MUX */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_DCM &quot;98642A DCM serial MUX&quot;</span>
<span class="cp">#define DIO_ID_DCMREM   0x85 </span><span class="cm">/* 98642A serial MUX */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_DCMREM &quot;98642A DCMREM serial MUX&quot;</span>
<span class="cp">#define DIO_ID_LAN      0x15 </span><span class="cm">/* 98643A LAN */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_LAN &quot;98643A LANCE ethernet&quot;</span>
<span class="cp">#define DIO_ID_FHPIB    0x08 </span><span class="cm">/* 98625A/98625B fast HP-IB */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_FHPIB &quot;98625A/98625B fast HPIB&quot;</span>
<span class="cp">#define DIO_ID_NHPIB    0x01 </span><span class="cm">/* 98624A HP-IB (normal ie slow) */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_NHPIB &quot;98624A HPIB&quot;</span>
<span class="cp">#define DIO_ID_SCSI0    0x07 </span><span class="cm">/* 98265A SCSI */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_SCSI0 &quot;98265A SCSI0&quot;</span>
<span class="cp">#define DIO_ID_SCSI1    0x27 </span><span class="cm">/* ditto */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_SCSI1 &quot;98265A SCSI1&quot;</span>
<span class="cp">#define DIO_ID_SCSI2    0x47 </span><span class="cm">/* ditto */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_SCSI2 &quot;98265A SCSI2&quot;</span>
<span class="cp">#define DIO_ID_SCSI3    0x67 </span><span class="cm">/* ditto */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_SCSI3 &quot;98265A SCSI3&quot;</span>
<span class="cp">#define DIO_ID_FBUFFER  0x39 </span><span class="cm">/* framebuffer: flavour is distinguished by secondary ID */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_FBUFFER &quot;bitmapped display&quot;</span>
<span class="cm">/* the NetBSD kernel source is a bit unsure as to what these next IDs actually do :-&gt; */</span>
<span class="cp">#define DIO_ID_MISC0    0x03 </span><span class="cm">/* 98622A */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC0 &quot;98622A&quot;</span>
<span class="cp">#define DIO_ID_MISC1    0x04 </span><span class="cm">/* 98623A */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC1 &quot;98623A&quot;</span>
<span class="cp">#define DIO_ID_PARALLEL 0x06 </span><span class="cm">/* internal parallel */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_PARALLEL &quot;internal parallel&quot;</span>
<span class="cp">#define DIO_ID_MISC2    0x09 </span><span class="cm">/* 98287A keyboard */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC2 &quot;98287A keyboard&quot;</span>
<span class="cp">#define DIO_ID_MISC3    0x0a </span><span class="cm">/* HP98635A FP accelerator */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC3 &quot;HP98635A FP accelerator&quot;</span>
<span class="cp">#define DIO_ID_MISC4    0x0b </span><span class="cm">/* timer */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC4 &quot;timer&quot;</span>
<span class="cp">#define DIO_ID_MISC5    0x12 </span><span class="cm">/* 98640A */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC5 &quot;98640A&quot;</span>
<span class="cp">#define DIO_ID_MISC6    0x16 </span><span class="cm">/* 98659A */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC6 &quot;98659A&quot;</span>
<span class="cp">#define DIO_ID_MISC7    0x19 </span><span class="cm">/* 237 display */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC7 &quot;237 display&quot;</span>
<span class="cp">#define DIO_ID_MISC8    0x1a </span><span class="cm">/* quad-wide card */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC8 &quot;quad-wide card&quot;</span>
<span class="cp">#define DIO_ID_MISC9    0x1b </span><span class="cm">/* 98253A */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC9 &quot;98253A&quot;</span>
<span class="cp">#define DIO_ID_MISC10   0x1c </span><span class="cm">/* 98627A */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC10 &quot;98253A&quot;</span>
<span class="cp">#define DIO_ID_MISC11   0x1d </span><span class="cm">/* 98633A */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC11 &quot;98633A&quot;</span>
<span class="cp">#define DIO_ID_MISC12   0x1e </span><span class="cm">/* 98259A */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC12 &quot;98259A&quot;</span>
<span class="cp">#define DIO_ID_MISC13   0x1f </span><span class="cm">/* 8741 */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_MISC13 &quot;8741&quot;</span>
<span class="cp">#define DIO_ID_VME      0x31 </span><span class="cm">/* 98577A VME adapter */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_VME &quot;98577A VME adapter&quot;</span>
<span class="cp">#define DIO_ID_DCL      0x34 </span><span class="cm">/* 98628A serial */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_DCL &quot;98628A DCL serial&quot;</span>
<span class="cp">#define DIO_ID_DCLREM   0xb4 </span><span class="cm">/* 98628A serial */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC_DCLREM &quot;98628A DCLREM serial&quot;</span>
<span class="cm">/* These are the secondary IDs for the framebuffers */</span>
<span class="cp">#define DIO_ID2_GATORBOX    0x01 </span><span class="cm">/* 98700/98710 &quot;gatorbox&quot; */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_GATORBOX       &quot;98700/98710 \&quot;gatorbox\&quot; display&quot;</span>
<span class="cp">#define DIO_ID2_TOPCAT      0x02 </span><span class="cm">/* 98544/98545/98547 &quot;topcat&quot; */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_TOPCAT         &quot;98544/98545/98547 \&quot;topcat\&quot; display&quot;</span>
<span class="cp">#define DIO_ID2_RENAISSANCE 0x04 </span><span class="cm">/* 98720/98721 &quot;renaissance&quot; */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_RENAISSANCE    &quot;98720/98721 \&quot;renaissance\&quot; display&quot;</span>
<span class="cp">#define DIO_ID2_LRCATSEYE   0x05 </span><span class="cm">/* lowres &quot;catseye&quot; */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_LRCATSEYE      &quot;low-res catseye display&quot;</span>
<span class="cp">#define DIO_ID2_HRCCATSEYE  0x06 </span><span class="cm">/* highres colour &quot;catseye&quot; */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_HRCCATSEYE     &quot;high-res color catseye display&quot;</span>
<span class="cp">#define DIO_ID2_HRMCATSEYE  0x07 </span><span class="cm">/* highres mono &quot;catseye&quot; */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_HRMCATSEYE     &quot;high-res mono catseye display&quot;</span>
<span class="cp">#define DIO_ID2_DAVINCI     0x08 </span><span class="cm">/* 98730/98731 &quot;davinci&quot; */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_DAVINCI        &quot;98730/98731 \&quot;davinci\&quot; display&quot;</span>
<span class="cp">#define DIO_ID2_XXXCATSEYE  0x09 </span><span class="cm">/* &quot;catseye&quot; */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_XXXCATSEYE     &quot;catseye display&quot;</span>
<span class="cp">#define DIO_ID2_HYPERION    0x0e </span><span class="cm">/* A1096A &quot;hyperion&quot; */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_HYPERION       &quot;A1096A \&quot;hyperion\&quot; display&quot;</span>
<span class="cp">#define DIO_ID2_XGENESIS    0x0b </span><span class="cm">/* &quot;x-genesis&quot;; no NetBSD support */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_XGENESIS       &quot;\&quot;x-genesis\&quot; display&quot;</span>
<span class="cp">#define DIO_ID2_TIGER       0x0c </span><span class="cm">/* &quot;tiger&quot;; no NetBSD support */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_TIGER          &quot;\&quot;tiger\&quot; display&quot;</span>
<span class="cp">#define DIO_ID2_YGENESIS    0x0d </span><span class="cm">/* &quot;y-genesis&quot;; no NetBSD support */</span><span class="cp"></span>
<span class="cp">#define DIO_DESC2_YGENESIS       &quot;\&quot;y-genesis\&quot; display&quot;</span>
<span class="cm">/* if you add new IDs then you should tell dio.c about them so it can</span>
<span class="cm"> * identify them...</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">dio_find</span><span class="p">(</span><span class="kt">int</span> <span class="n">deviceid</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dio_scodetophysaddr</span><span class="p">(</span><span class="kt">int</span> <span class="n">scode</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">dio_create_sysfs_dev_files</span><span class="p">(</span><span class="k">struct</span> <span class="n">dio_dev</span> <span class="o">*</span><span class="p">);</span>

<span class="cm">/* New-style probing */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">dio_register_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">dio_driver</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">dio_unregister_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">dio_driver</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dio_device_id</span> <span class="o">*</span><span class="n">dio_match_device</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">dio_device_id</span> <span class="o">*</span><span class="n">ids</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dio_dev</span> <span class="o">*</span><span class="n">z</span><span class="p">);</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">dio_driver</span> <span class="o">*</span><span class="nf">dio_dev_driver</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">dio_dev</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define dio_resource_start(d) ((d)-&gt;resource.start)</span>
<span class="cp">#define dio_resource_end(d)   ((d)-&gt;resource.end)</span>
<span class="cp">#define dio_resource_len(d)   (resource_size(&amp;(d)-&gt;resource))</span>
<span class="cp">#define dio_resource_flags(d) ((d)-&gt;resource.flags)</span>

<span class="cp">#define dio_request_device(d, name) \</span>
<span class="cp">    request_mem_region(dio_resource_start(d), dio_resource_len(d), name)</span>
<span class="cp">#define dio_release_device(d) \</span>
<span class="cp">    release_mem_region(dio_resource_start(d), dio_resource_len(d))</span>

<span class="cm">/* Similar to the helpers above, these manipulate per-dio_dev</span>
<span class="cm"> * driver-specific data.  They are really just a wrapper around</span>
<span class="cm"> * the generic device structure functions of these calls.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">dio_get_drvdata</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dio_dev</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev_get_drvdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">dio_set_drvdata</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dio_dev</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dev_set_drvdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* ndef _LINUX_DIO_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
