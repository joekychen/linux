<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › cdrom.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>cdrom.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * -- &lt;linux/cdrom.h&gt;</span>
<span class="cm"> * General header file for linux CD-ROM drivers </span>
<span class="cm"> * Copyright (C) 1992         David Giller, rafetmad@oxy.edu</span>
<span class="cm"> *               1994, 1995   Eberhard Mönkeberg, emoenke@gwdg.de</span>
<span class="cm"> *               1996         David van Leeuwen, david@tm.tno.nl</span>
<span class="cm"> *               1997, 1998   Erik Andersen, andersee@debian.org</span>
<span class="cm"> *               1998-2002    Jens Axboe, axboe@suse.de</span>
<span class="cm"> */</span>
 
<span class="cp">#ifndef	_LINUX_CDROM_H</span>
<span class="cp">#define	_LINUX_CDROM_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;asm/byteorder.h&gt;</span>

<span class="cm">/*******************************************************</span>
<span class="cm"> * As of Linux 2.1.x, all Linux CD-ROM application programs will use this </span>
<span class="cm"> * (and only this) include file.  It is my hope to provide Linux with</span>
<span class="cm"> * a uniform interface between software accessing CD-ROMs and the various </span>
<span class="cm"> * device drivers that actually talk to the drives.  There may still be</span>
<span class="cm"> * 23 different kinds of strange CD-ROM drives, but at least there will </span>
<span class="cm"> * now be one, and only one, Linux CD-ROM interface.</span>
<span class="cm"> *</span>
<span class="cm"> * Additionally, as of Linux 2.1.x, all Linux application programs </span>
<span class="cm"> * should use the O_NONBLOCK option when opening a CD-ROM device </span>
<span class="cm"> * for subsequent ioctl commands.  This allows for neat system errors </span>
<span class="cm"> * like &quot;No medium found&quot; or &quot;Wrong medium type&quot; upon attempting to </span>
<span class="cm"> * mount or play an empty slot, mount an audio disc, or play a data disc.</span>
<span class="cm"> * Generally, changing an application program to support O_NONBLOCK</span>
<span class="cm"> * is as easy as the following:</span>
<span class="cm"> *       -    drive = open(&quot;/dev/cdrom&quot;, O_RDONLY);</span>
<span class="cm"> *       +    drive = open(&quot;/dev/cdrom&quot;, O_RDONLY | O_NONBLOCK);</span>
<span class="cm"> * It is worth the small change.</span>
<span class="cm"> *</span>
<span class="cm"> *  Patches for many common CD programs (provided by David A. van Leeuwen)</span>
<span class="cm"> *  can be found at:  ftp://ftp.gwdg.de/pub/linux/cdrom/drivers/cm206/</span>
<span class="cm"> * </span>
<span class="cm"> *******************************************************/</span>

<span class="cm">/* When a driver supports a certain function, but the cdrom drive we are </span>
<span class="cm"> * using doesn&#39;t, we will return the error EDRIVE_CANT_DO_THIS.  We will </span>
<span class="cm"> * borrow the &quot;Operation not supported&quot; error from the network folks to </span>
<span class="cm"> * accomplish this.  Maybe someday we will get a more targeted error code, </span>
<span class="cm"> * but this will do for now... */</span>
<span class="cp">#define EDRIVE_CANT_DO_THIS  EOPNOTSUPP</span>

<span class="cm">/*******************************************************</span>
<span class="cm"> * The CD-ROM IOCTL commands  -- these should be supported by </span>
<span class="cm"> * all the various cdrom drivers.  For the CD-ROM ioctls, we </span>
<span class="cm"> * will commandeer byte 0x53, or &#39;S&#39;.</span>
<span class="cm"> *******************************************************/</span>
<span class="cp">#define CDROMPAUSE		0x5301 </span><span class="cm">/* Pause Audio Operation */</span><span class="cp"> </span>
<span class="cp">#define CDROMRESUME		0x5302 </span><span class="cm">/* Resume paused Audio Operation */</span><span class="cp"></span>
<span class="cp">#define CDROMPLAYMSF		0x5303 </span><span class="cm">/* Play Audio MSF (struct cdrom_msf) */</span><span class="cp"></span>
<span class="cp">#define CDROMPLAYTRKIND		0x5304 </span><span class="cm">/* Play Audio Track/index </span>
<span class="cm">                                           (struct cdrom_ti) */</span><span class="cp"></span>
<span class="cp">#define CDROMREADTOCHDR		0x5305 </span><span class="cm">/* Read TOC header </span>
<span class="cm">                                           (struct cdrom_tochdr) */</span><span class="cp"></span>
<span class="cp">#define CDROMREADTOCENTRY	0x5306 </span><span class="cm">/* Read TOC entry </span>
<span class="cm">                                           (struct cdrom_tocentry) */</span><span class="cp"></span>
<span class="cp">#define CDROMSTOP		0x5307 </span><span class="cm">/* Stop the cdrom drive */</span><span class="cp"></span>
<span class="cp">#define CDROMSTART		0x5308 </span><span class="cm">/* Start the cdrom drive */</span><span class="cp"></span>
<span class="cp">#define CDROMEJECT		0x5309 </span><span class="cm">/* Ejects the cdrom media */</span><span class="cp"></span>
<span class="cp">#define CDROMVOLCTRL		0x530a </span><span class="cm">/* Control output volume </span>
<span class="cm">                                           (struct cdrom_volctrl) */</span><span class="cp"></span>
<span class="cp">#define CDROMSUBCHNL		0x530b </span><span class="cm">/* Read subchannel data </span>
<span class="cm">                                           (struct cdrom_subchnl) */</span><span class="cp"></span>
<span class="cp">#define CDROMREADMODE2		0x530c </span><span class="cm">/* Read CDROM mode 2 data (2336 Bytes) </span>
<span class="cm">                                           (struct cdrom_read) */</span><span class="cp"></span>
<span class="cp">#define CDROMREADMODE1		0x530d </span><span class="cm">/* Read CDROM mode 1 data (2048 Bytes)</span>
<span class="cm">                                           (struct cdrom_read) */</span><span class="cp"></span>
<span class="cp">#define CDROMREADAUDIO		0x530e </span><span class="cm">/* (struct cdrom_read_audio) */</span><span class="cp"></span>
<span class="cp">#define CDROMEJECT_SW		0x530f </span><span class="cm">/* enable(1)/disable(0) auto-ejecting */</span><span class="cp"></span>
<span class="cp">#define CDROMMULTISESSION	0x5310 </span><span class="cm">/* Obtain the start-of-last-session </span>
<span class="cm">                                           address of multi session disks </span>
<span class="cm">                                           (struct cdrom_multisession) */</span><span class="cp"></span>
<span class="cp">#define CDROM_GET_MCN		0x5311 </span><span class="cm">/* Obtain the &quot;Universal Product Code&quot; </span>
<span class="cm">                                           if available (struct cdrom_mcn) */</span><span class="cp"></span>
<span class="cp">#define CDROM_GET_UPC		CDROM_GET_MCN  </span><span class="cm">/* This one is deprecated, </span>
<span class="cm">                                          but here anyway for compatibility */</span><span class="cp"></span>
<span class="cp">#define CDROMRESET		0x5312 </span><span class="cm">/* hard-reset the drive */</span><span class="cp"></span>
<span class="cp">#define CDROMVOLREAD		0x5313 </span><span class="cm">/* Get the drive&#39;s volume setting </span>
<span class="cm">                                          (struct cdrom_volctrl) */</span><span class="cp"></span>
<span class="cp">#define CDROMREADRAW		0x5314	</span><span class="cm">/* read data in raw mode (2352 Bytes)</span>
<span class="cm">                                           (struct cdrom_read) */</span><span class="cp"></span>
<span class="cm">/* </span>
<span class="cm"> * These ioctls are used only used in aztcd.c and optcd.c</span>
<span class="cm"> */</span>
<span class="cp">#define CDROMREADCOOKED		0x5315	</span><span class="cm">/* read data in cooked mode */</span><span class="cp"></span>
<span class="cp">#define CDROMSEEK		0x5316  </span><span class="cm">/* seek msf address */</span><span class="cp"></span>
  
<span class="cm">/*</span>
<span class="cm"> * This ioctl is only used by the scsi-cd driver.  </span>
<span class="cm">   It is for playing audio in logical block addressing mode.</span>
<span class="cm"> */</span>
<span class="cp">#define CDROMPLAYBLK		0x5317	</span><span class="cm">/* (struct cdrom_blk) */</span><span class="cp"></span>

<span class="cm">/* </span>
<span class="cm"> * These ioctls are only used in optcd.c</span>
<span class="cm"> */</span>
<span class="cp">#define CDROMREADALL		0x5318	</span><span class="cm">/* read all 2646 bytes */</span><span class="cp"></span>

<span class="cm">/* </span>
<span class="cm"> * These ioctls are (now) only in ide-cd.c for controlling </span>
<span class="cm"> * drive spindown time.  They should be implemented in the</span>
<span class="cm"> * Uniform driver, via generic packet commands, GPCMD_MODE_SELECT_10,</span>
<span class="cm"> * GPCMD_MODE_SENSE_10 and the GPMODE_POWER_PAGE...</span>
<span class="cm"> *  -Erik</span>
<span class="cm"> */</span>
<span class="cp">#define CDROMGETSPINDOWN        0x531d</span>
<span class="cp">#define CDROMSETSPINDOWN        0x531e</span>

<span class="cm">/* </span>
<span class="cm"> * These ioctls are implemented through the uniform CD-ROM driver</span>
<span class="cm"> * They _will_ be adopted by all CD-ROM drivers, when all the CD-ROM</span>
<span class="cm"> * drivers are eventually ported to the uniform CD-ROM driver interface.</span>
<span class="cm"> */</span>
<span class="cp">#define CDROMCLOSETRAY		0x5319	</span><span class="cm">/* pendant of CDROMEJECT */</span><span class="cp"></span>
<span class="cp">#define CDROM_SET_OPTIONS	0x5320  </span><span class="cm">/* Set behavior options */</span><span class="cp"></span>
<span class="cp">#define CDROM_CLEAR_OPTIONS	0x5321  </span><span class="cm">/* Clear behavior options */</span><span class="cp"></span>
<span class="cp">#define CDROM_SELECT_SPEED	0x5322  </span><span class="cm">/* Set the CD-ROM speed */</span><span class="cp"></span>
<span class="cp">#define CDROM_SELECT_DISC	0x5323  </span><span class="cm">/* Select disc (for juke-boxes) */</span><span class="cp"></span>
<span class="cp">#define CDROM_MEDIA_CHANGED	0x5325  </span><span class="cm">/* Check is media changed  */</span><span class="cp"></span>
<span class="cp">#define CDROM_DRIVE_STATUS	0x5326  </span><span class="cm">/* Get tray position, etc. */</span><span class="cp"></span>
<span class="cp">#define CDROM_DISC_STATUS	0x5327  </span><span class="cm">/* Get disc type, etc. */</span><span class="cp"></span>
<span class="cp">#define CDROM_CHANGER_NSLOTS    0x5328  </span><span class="cm">/* Get number of slots */</span><span class="cp"></span>
<span class="cp">#define CDROM_LOCKDOOR		0x5329  </span><span class="cm">/* lock or unlock door */</span><span class="cp"></span>
<span class="cp">#define CDROM_DEBUG		0x5330	</span><span class="cm">/* Turn debug messages on/off */</span><span class="cp"></span>
<span class="cp">#define CDROM_GET_CAPABILITY	0x5331	</span><span class="cm">/* get capabilities */</span><span class="cp"></span>

<span class="cm">/* Note that scsi/scsi_ioctl.h also uses 0x5382 - 0x5386.</span>
<span class="cm"> * Future CDROM ioctls should be kept below 0x537F</span>
<span class="cm"> */</span>

<span class="cm">/* This ioctl is only used by sbpcd at the moment */</span>
<span class="cp">#define CDROMAUDIOBUFSIZ        0x5382	</span><span class="cm">/* set the audio buffer size */</span><span class="cp"></span>
					<span class="cm">/* conflict with SCSI_IOCTL_GET_IDLUN */</span>

<span class="cm">/* DVD-ROM Specific ioctls */</span>
<span class="cp">#define DVD_READ_STRUCT		0x5390  </span><span class="cm">/* Read structure */</span><span class="cp"></span>
<span class="cp">#define DVD_WRITE_STRUCT	0x5391  </span><span class="cm">/* Write structure */</span><span class="cp"></span>
<span class="cp">#define DVD_AUTH		0x5392  </span><span class="cm">/* Authentication */</span><span class="cp"></span>

<span class="cp">#define CDROM_SEND_PACKET	0x5393	</span><span class="cm">/* send a packet to the drive */</span><span class="cp"></span>
<span class="cp">#define CDROM_NEXT_WRITABLE	0x5394	</span><span class="cm">/* get next writable block */</span><span class="cp"></span>
<span class="cp">#define CDROM_LAST_WRITTEN	0x5395	</span><span class="cm">/* get last block written on disc */</span><span class="cp"></span>

<span class="cm">/*******************************************************</span>
<span class="cm"> * CDROM IOCTL structures</span>
<span class="cm"> *******************************************************/</span>

<span class="cm">/* Address in MSF format */</span>
<span class="k">struct</span> <span class="n">cdrom_msf0</span>		
<span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">minute</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">second</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">frame</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Address in either MSF or logical format */</span>
<span class="k">union</span> <span class="n">cdrom_addr</span>		
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">cdrom_msf0</span>	<span class="n">msf</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">lba</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* This struct is used by the CDROMPLAYMSF ioctl */</span> 
<span class="k">struct</span> <span class="n">cdrom_msf</span> 
<span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">cdmsf_min0</span><span class="p">;</span>	<span class="cm">/* start minute */</span>
	<span class="n">__u8</span>	<span class="n">cdmsf_sec0</span><span class="p">;</span>	<span class="cm">/* start second */</span>
	<span class="n">__u8</span>	<span class="n">cdmsf_frame0</span><span class="p">;</span>	<span class="cm">/* start frame */</span>
	<span class="n">__u8</span>	<span class="n">cdmsf_min1</span><span class="p">;</span>	<span class="cm">/* end minute */</span>
	<span class="n">__u8</span>	<span class="n">cdmsf_sec1</span><span class="p">;</span>	<span class="cm">/* end second */</span>
	<span class="n">__u8</span>	<span class="n">cdmsf_frame1</span><span class="p">;</span>	<span class="cm">/* end frame */</span>
<span class="p">};</span>

<span class="cm">/* This struct is used by the CDROMPLAYTRKIND ioctl */</span>
<span class="k">struct</span> <span class="n">cdrom_ti</span> 
<span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">cdti_trk0</span><span class="p">;</span>	<span class="cm">/* start track */</span>
	<span class="n">__u8</span>	<span class="n">cdti_ind0</span><span class="p">;</span>	<span class="cm">/* start index */</span>
	<span class="n">__u8</span>	<span class="n">cdti_trk1</span><span class="p">;</span>	<span class="cm">/* end track */</span>
	<span class="n">__u8</span>	<span class="n">cdti_ind1</span><span class="p">;</span>	<span class="cm">/* end index */</span>
<span class="p">};</span>

<span class="cm">/* This struct is used by the CDROMREADTOCHDR ioctl */</span>
<span class="k">struct</span> <span class="n">cdrom_tochdr</span> 	
<span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">cdth_trk0</span><span class="p">;</span>	<span class="cm">/* start track */</span>
	<span class="n">__u8</span>	<span class="n">cdth_trk1</span><span class="p">;</span>	<span class="cm">/* end track */</span>
<span class="p">};</span>

<span class="cm">/* This struct is used by the CDROMVOLCTRL and CDROMVOLREAD ioctls */</span>
<span class="k">struct</span> <span class="n">cdrom_volctrl</span>
<span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">channel0</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">channel1</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">channel2</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">channel3</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* This struct is used by the CDROMSUBCHNL ioctl */</span>
<span class="k">struct</span> <span class="n">cdrom_subchnl</span> 
<span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">cdsc_format</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">cdsc_audiostatus</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">cdsc_adr</span><span class="o">:</span>	<span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">cdsc_ctrl</span><span class="o">:</span>	<span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">cdsc_trk</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">cdsc_ind</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">cdrom_addr</span> <span class="n">cdsc_absaddr</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">cdrom_addr</span> <span class="n">cdsc_reladdr</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/* This struct is used by the CDROMREADTOCENTRY ioctl */</span>
<span class="k">struct</span> <span class="n">cdrom_tocentry</span> 
<span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">cdte_track</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">cdte_adr</span>	<span class="o">:</span><span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">cdte_ctrl</span>	<span class="o">:</span><span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">cdte_format</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">cdrom_addr</span> <span class="n">cdte_addr</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">cdte_datamode</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* This struct is used by the CDROMREADMODE1, and CDROMREADMODE2 ioctls */</span>
<span class="k">struct</span> <span class="n">cdrom_read</span>      
<span class="p">{</span>
	<span class="kt">int</span>	<span class="n">cdread_lba</span><span class="p">;</span>
	<span class="kt">char</span> 	<span class="o">*</span><span class="n">cdread_bufaddr</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">cdread_buflen</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* This struct is used by the CDROMREADAUDIO ioctl */</span>
<span class="k">struct</span> <span class="n">cdrom_read_audio</span>
<span class="p">{</span>
	<span class="k">union</span> <span class="n">cdrom_addr</span> <span class="n">addr</span><span class="p">;</span> <span class="cm">/* frame address */</span>
	<span class="n">__u8</span> <span class="n">addr_format</span><span class="p">;</span>      <span class="cm">/* CDROM_LBA or CDROM_MSF */</span>
	<span class="kt">int</span> <span class="n">nframes</span><span class="p">;</span>           <span class="cm">/* number of 2352-byte-frames to read at once */</span>
	<span class="n">__u8</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>      <span class="cm">/* frame buffer (size: nframes*2352 bytes) */</span>
<span class="p">};</span>

<span class="cm">/* This struct is used with the CDROMMULTISESSION ioctl */</span>
<span class="k">struct</span> <span class="n">cdrom_multisession</span>
<span class="p">{</span>
	<span class="k">union</span> <span class="n">cdrom_addr</span> <span class="n">addr</span><span class="p">;</span> <span class="cm">/* frame address: start-of-last-session </span>
<span class="cm">	                           (not the new &quot;frame 16&quot;!).  Only valid</span>
<span class="cm">	                           if the &quot;xa_flag&quot; is true. */</span>
	<span class="n">__u8</span> <span class="n">xa_flag</span><span class="p">;</span>        <span class="cm">/* 1: &quot;is XA disk&quot; */</span>
	<span class="n">__u8</span> <span class="n">addr_format</span><span class="p">;</span>    <span class="cm">/* CDROM_LBA or CDROM_MSF */</span>
<span class="p">};</span>

<span class="cm">/* This struct is used with the CDROM_GET_MCN ioctl.  </span>
<span class="cm"> * Very few audio discs actually have Universal Product Code information, </span>
<span class="cm"> * which should just be the Medium Catalog Number on the box.  Also note </span>
<span class="cm"> * that the way the codeis written on CD is _not_ uniform across all discs!</span>
<span class="cm"> */</span>  
<span class="k">struct</span> <span class="n">cdrom_mcn</span> 
<span class="p">{</span>
  <span class="n">__u8</span> <span class="n">medium_catalog_number</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span> <span class="cm">/* 13 ASCII digits, null-terminated */</span>
<span class="p">};</span>

<span class="cm">/* This is used by the CDROMPLAYBLK ioctl */</span>
<span class="k">struct</span> <span class="n">cdrom_blk</span> 
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">from</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">len</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define CDROM_PACKET_SIZE	12</span>

<span class="cp">#define CGC_DATA_UNKNOWN	0</span>
<span class="cp">#define CGC_DATA_WRITE		1</span>
<span class="cp">#define CGC_DATA_READ		2</span>
<span class="cp">#define CGC_DATA_NONE		3</span>

<span class="cm">/* for CDROM_PACKET_COMMAND ioctl */</span>
<span class="k">struct</span> <span class="n">cdrom_generic_command</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 		<span class="n">cmd</span><span class="p">[</span><span class="n">CDROM_PACKET_SIZE</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> 		<span class="n">buflen</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">stat</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">request_sense</span>	<span class="n">__user</span> <span class="o">*</span><span class="n">sense</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">data_direction</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">quiet</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">timeout</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="n">__user</span> <span class="o">*</span><span class="n">reserved</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>	<span class="cm">/* unused, actually */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * A CD-ROM physical sector size is 2048, 2052, 2056, 2324, 2332, 2336, </span>
<span class="cm"> * 2340, or 2352 bytes long.  </span>

<span class="cm">*         Sector types of the standard CD-ROM data formats:</span>
<span class="cm"> *</span>
<span class="cm"> * format   sector type               user data size (bytes)</span>
<span class="cm"> * -----------------------------------------------------------------------------</span>
<span class="cm"> *   1     (Red Book)    CD-DA          2352    (CD_FRAMESIZE_RAW)</span>
<span class="cm"> *   2     (Yellow Book) Mode1 Form1    2048    (CD_FRAMESIZE)</span>
<span class="cm"> *   3     (Yellow Book) Mode1 Form2    2336    (CD_FRAMESIZE_RAW0)</span>
<span class="cm"> *   4     (Green Book)  Mode2 Form1    2048    (CD_FRAMESIZE)</span>
<span class="cm"> *   5     (Green Book)  Mode2 Form2    2328    (2324+4 spare bytes)</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *       The layout of the standard CD-ROM data formats:</span>
<span class="cm"> * -----------------------------------------------------------------------------</span>
<span class="cm"> * - audio (red):                  | audio_sample_bytes |</span>
<span class="cm"> *                                 |        2352        |</span>
<span class="cm"> *</span>
<span class="cm"> * - data (yellow, mode1):         | sync - head - data - EDC - zero - ECC |</span>
<span class="cm"> *                                 |  12  -   4  - 2048 -  4  -   8  - 276 |</span>
<span class="cm"> *</span>
<span class="cm"> * - data (yellow, mode2):         | sync - head - data |</span>
<span class="cm"> *                                 |  12  -   4  - 2336 |</span>
<span class="cm"> *</span>
<span class="cm"> * - XA data (green, mode2 form1): | sync - head - sub - data - EDC - ECC |</span>
<span class="cm"> *                                 |  12  -   4  -  8  - 2048 -  4  - 276 |</span>
<span class="cm"> *</span>
<span class="cm"> * - XA data (green, mode2 form2): | sync - head - sub - data - Spare |</span>
<span class="cm"> *                                 |  12  -   4  -  8  - 2324 -  4    |</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/* Some generally useful CD-ROM information -- mostly based on the above */</span>
<span class="cp">#define CD_MINS              74 </span><span class="cm">/* max. minutes per CD, not really a limit */</span><span class="cp"></span>
<span class="cp">#define CD_SECS              60 </span><span class="cm">/* seconds per minute */</span><span class="cp"></span>
<span class="cp">#define CD_FRAMES            75 </span><span class="cm">/* frames per second */</span><span class="cp"></span>
<span class="cp">#define CD_SYNC_SIZE         12 </span><span class="cm">/* 12 sync bytes per raw data frame */</span><span class="cp"></span>
<span class="cp">#define CD_MSF_OFFSET       150 </span><span class="cm">/* MSF numbering offset of first frame */</span><span class="cp"></span>
<span class="cp">#define CD_CHUNK_SIZE        24 </span><span class="cm">/* lowest-level &quot;data bytes piece&quot; */</span><span class="cp"></span>
<span class="cp">#define CD_NUM_OF_CHUNKS     98 </span><span class="cm">/* chunks per frame */</span><span class="cp"></span>
<span class="cp">#define CD_FRAMESIZE_SUB     96 </span><span class="cm">/* subchannel data &quot;frame&quot; size */</span><span class="cp"></span>
<span class="cp">#define CD_HEAD_SIZE          4 </span><span class="cm">/* header (address) bytes per raw data frame */</span><span class="cp"></span>
<span class="cp">#define CD_SUBHEAD_SIZE       8 </span><span class="cm">/* subheader bytes per raw XA data frame */</span><span class="cp"></span>
<span class="cp">#define CD_EDC_SIZE           4 </span><span class="cm">/* bytes EDC per most raw data frame types */</span><span class="cp"></span>
<span class="cp">#define CD_ZERO_SIZE          8 </span><span class="cm">/* bytes zero per yellow book mode 1 frame */</span><span class="cp"></span>
<span class="cp">#define CD_ECC_SIZE         276 </span><span class="cm">/* bytes ECC per most raw data frame types */</span><span class="cp"></span>
<span class="cp">#define CD_FRAMESIZE       2048 </span><span class="cm">/* bytes per frame, &quot;cooked&quot; mode */</span><span class="cp"></span>
<span class="cp">#define CD_FRAMESIZE_RAW   2352 </span><span class="cm">/* bytes per frame, &quot;raw&quot; mode */</span><span class="cp"></span>
<span class="cp">#define CD_FRAMESIZE_RAWER 2646 </span><span class="cm">/* The maximum possible returned bytes */</span><span class="cp"> </span>
<span class="cm">/* most drives don&#39;t deliver everything: */</span>
<span class="cp">#define CD_FRAMESIZE_RAW1 (CD_FRAMESIZE_RAW-CD_SYNC_SIZE) </span><span class="cm">/*2340*/</span><span class="cp"></span>
<span class="cp">#define CD_FRAMESIZE_RAW0 (CD_FRAMESIZE_RAW-CD_SYNC_SIZE-CD_HEAD_SIZE) </span><span class="cm">/*2336*/</span><span class="cp"></span>

<span class="cp">#define CD_XA_HEAD        (CD_HEAD_SIZE+CD_SUBHEAD_SIZE) </span><span class="cm">/* &quot;before data&quot; part of raw XA frame */</span><span class="cp"></span>
<span class="cp">#define CD_XA_TAIL        (CD_EDC_SIZE+CD_ECC_SIZE) </span><span class="cm">/* &quot;after data&quot; part of raw XA frame */</span><span class="cp"></span>
<span class="cp">#define CD_XA_SYNC_HEAD   (CD_SYNC_SIZE+CD_XA_HEAD) </span><span class="cm">/* sync bytes + header of XA frame */</span><span class="cp"></span>

<span class="cm">/* CD-ROM address types (cdrom_tocentry.cdte_format) */</span>
<span class="cp">#define	CDROM_LBA 0x01 </span><span class="cm">/* &quot;logical block&quot;: first frame is #0 */</span><span class="cp"></span>
<span class="cp">#define	CDROM_MSF 0x02 </span><span class="cm">/* &quot;minute-second-frame&quot;: binary, not bcd here! */</span><span class="cp"></span>

<span class="cm">/* bit to tell whether track is data or audio (cdrom_tocentry.cdte_ctrl) */</span>
<span class="cp">#define	CDROM_DATA_TRACK	0x04</span>

<span class="cm">/* The leadout track is always 0xAA, regardless of # of tracks on disc */</span>
<span class="cp">#define	CDROM_LEADOUT		0xAA</span>

<span class="cm">/* audio states (from SCSI-2, but seen with other drives, too) */</span>
<span class="cp">#define	CDROM_AUDIO_INVALID	0x00	</span><span class="cm">/* audio status not supported */</span><span class="cp"></span>
<span class="cp">#define	CDROM_AUDIO_PLAY	0x11	</span><span class="cm">/* audio play operation in progress */</span><span class="cp"></span>
<span class="cp">#define	CDROM_AUDIO_PAUSED	0x12	</span><span class="cm">/* audio play operation paused */</span><span class="cp"></span>
<span class="cp">#define	CDROM_AUDIO_COMPLETED	0x13	</span><span class="cm">/* audio play successfully completed */</span><span class="cp"></span>
<span class="cp">#define	CDROM_AUDIO_ERROR	0x14	</span><span class="cm">/* audio play stopped due to error */</span><span class="cp"></span>
<span class="cp">#define	CDROM_AUDIO_NO_STATUS	0x15	</span><span class="cm">/* no current audio status to return */</span><span class="cp"></span>

<span class="cm">/* capability flags used with the uniform CD-ROM driver */</span> 
<span class="cp">#define CDC_CLOSE_TRAY		0x1     </span><span class="cm">/* caddy systems _can&#39;t_ close */</span><span class="cp"></span>
<span class="cp">#define CDC_OPEN_TRAY		0x2     </span><span class="cm">/* but _can_ eject.  */</span><span class="cp"></span>
<span class="cp">#define CDC_LOCK		0x4     </span><span class="cm">/* disable manual eject */</span><span class="cp"></span>
<span class="cp">#define CDC_SELECT_SPEED 	0x8     </span><span class="cm">/* programmable speed */</span><span class="cp"></span>
<span class="cp">#define CDC_SELECT_DISC		0x10    </span><span class="cm">/* select disc from juke-box */</span><span class="cp"></span>
<span class="cp">#define CDC_MULTI_SESSION 	0x20    </span><span class="cm">/* read sessions&gt;1 */</span><span class="cp"></span>
<span class="cp">#define CDC_MCN			0x40    </span><span class="cm">/* Medium Catalog Number */</span><span class="cp"></span>
<span class="cp">#define CDC_MEDIA_CHANGED 	0x80    </span><span class="cm">/* media changed */</span><span class="cp"></span>
<span class="cp">#define CDC_PLAY_AUDIO		0x100   </span><span class="cm">/* audio functions */</span><span class="cp"></span>
<span class="cp">#define CDC_RESET               0x200   </span><span class="cm">/* hard reset device */</span><span class="cp"></span>
<span class="cp">#define CDC_DRIVE_STATUS        0x800   </span><span class="cm">/* driver implements drive status */</span><span class="cp"></span>
<span class="cp">#define CDC_GENERIC_PACKET	0x1000	</span><span class="cm">/* driver implements generic packets */</span><span class="cp"></span>
<span class="cp">#define CDC_CD_R		0x2000	</span><span class="cm">/* drive is a CD-R */</span><span class="cp"></span>
<span class="cp">#define CDC_CD_RW		0x4000	</span><span class="cm">/* drive is a CD-RW */</span><span class="cp"></span>
<span class="cp">#define CDC_DVD			0x8000	</span><span class="cm">/* drive is a DVD */</span><span class="cp"></span>
<span class="cp">#define CDC_DVD_R		0x10000	</span><span class="cm">/* drive can write DVD-R */</span><span class="cp"></span>
<span class="cp">#define CDC_DVD_RAM		0x20000	</span><span class="cm">/* drive can write DVD-RAM */</span><span class="cp"></span>
<span class="cp">#define CDC_MO_DRIVE		0x40000 </span><span class="cm">/* drive is an MO device */</span><span class="cp"></span>
<span class="cp">#define CDC_MRW			0x80000 </span><span class="cm">/* drive can read MRW */</span><span class="cp"></span>
<span class="cp">#define CDC_MRW_W		0x100000 </span><span class="cm">/* drive can write MRW */</span><span class="cp"></span>
<span class="cp">#define CDC_RAM			0x200000 </span><span class="cm">/* ok to open for WRITE */</span><span class="cp"></span>

<span class="cm">/* drive status possibilities returned by CDROM_DRIVE_STATUS ioctl */</span>
<span class="cp">#define CDS_NO_INFO		0	</span><span class="cm">/* if not implemented */</span><span class="cp"></span>
<span class="cp">#define CDS_NO_DISC		1</span>
<span class="cp">#define CDS_TRAY_OPEN		2</span>
<span class="cp">#define CDS_DRIVE_NOT_READY	3</span>
<span class="cp">#define CDS_DISC_OK		4</span>

<span class="cm">/* return values for the CDROM_DISC_STATUS ioctl */</span>
<span class="cm">/* can also return CDS_NO_[INFO|DISC], from above */</span>
<span class="cp">#define CDS_AUDIO		100</span>
<span class="cp">#define CDS_DATA_1		101</span>
<span class="cp">#define CDS_DATA_2		102</span>
<span class="cp">#define CDS_XA_2_1		103</span>
<span class="cp">#define CDS_XA_2_2		104</span>
<span class="cp">#define CDS_MIXED		105</span>

<span class="cm">/* User-configurable behavior options for the uniform CD-ROM driver */</span>
<span class="cp">#define CDO_AUTO_CLOSE		0x1     </span><span class="cm">/* close tray on first open() */</span><span class="cp"></span>
<span class="cp">#define CDO_AUTO_EJECT		0x2     </span><span class="cm">/* open tray on last release() */</span><span class="cp"></span>
<span class="cp">#define CDO_USE_FFLAGS		0x4     </span><span class="cm">/* use O_NONBLOCK information on open */</span><span class="cp"></span>
<span class="cp">#define CDO_LOCK		0x8     </span><span class="cm">/* lock tray on open files */</span><span class="cp"></span>
<span class="cp">#define CDO_CHECK_TYPE		0x10    </span><span class="cm">/* check type on open for data */</span><span class="cp"></span>

<span class="cm">/* Special codes used when specifying changer slots. */</span>
<span class="cp">#define CDSL_NONE       	(INT_MAX-1)</span>
<span class="cp">#define CDSL_CURRENT    	INT_MAX</span>

<span class="cm">/* For partition based multisession access. IDE can handle 64 partitions</span>
<span class="cm"> * per drive - SCSI CD-ROM&#39;s use minors to differentiate between the</span>
<span class="cm"> * various drives, so we can&#39;t do multisessions the same way there.</span>
<span class="cm"> * Use the -o session=x option to mount on them.</span>
<span class="cm"> */</span>
<span class="cp">#define CD_PART_MAX		64</span>
<span class="cp">#define CD_PART_MASK		(CD_PART_MAX - 1)</span>

<span class="cm">/*********************************************************************</span>
<span class="cm"> * Generic Packet commands, MMC commands, and such</span>
<span class="cm"> *********************************************************************/</span>

 <span class="cm">/* The generic packet command opcodes for CD/DVD Logical Units,</span>
<span class="cm"> * From Table 57 of the SFF8090 Ver. 3 (Mt. Fuji) draft standard. */</span>
<span class="cp">#define GPCMD_BLANK			    0xa1</span>
<span class="cp">#define GPCMD_CLOSE_TRACK		    0x5b</span>
<span class="cp">#define GPCMD_FLUSH_CACHE		    0x35</span>
<span class="cp">#define GPCMD_FORMAT_UNIT		    0x04</span>
<span class="cp">#define GPCMD_GET_CONFIGURATION		    0x46</span>
<span class="cp">#define GPCMD_GET_EVENT_STATUS_NOTIFICATION 0x4a</span>
<span class="cp">#define GPCMD_GET_PERFORMANCE		    0xac</span>
<span class="cp">#define GPCMD_INQUIRY			    0x12</span>
<span class="cp">#define GPCMD_LOAD_UNLOAD		    0xa6</span>
<span class="cp">#define GPCMD_MECHANISM_STATUS		    0xbd</span>
<span class="cp">#define GPCMD_MODE_SELECT_10		    0x55</span>
<span class="cp">#define GPCMD_MODE_SENSE_10		    0x5a</span>
<span class="cp">#define GPCMD_PAUSE_RESUME		    0x4b</span>
<span class="cp">#define GPCMD_PLAY_AUDIO_10		    0x45</span>
<span class="cp">#define GPCMD_PLAY_AUDIO_MSF		    0x47</span>
<span class="cp">#define GPCMD_PLAY_AUDIO_TI		    0x48</span>
<span class="cp">#define GPCMD_PLAY_CD			    0xbc</span>
<span class="cp">#define GPCMD_PREVENT_ALLOW_MEDIUM_REMOVAL  0x1e</span>
<span class="cp">#define GPCMD_READ_10			    0x28</span>
<span class="cp">#define GPCMD_READ_12			    0xa8</span>
<span class="cp">#define GPCMD_READ_BUFFER		    0x3c</span>
<span class="cp">#define GPCMD_READ_BUFFER_CAPACITY	    0x5c</span>
<span class="cp">#define GPCMD_READ_CDVD_CAPACITY	    0x25</span>
<span class="cp">#define GPCMD_READ_CD			    0xbe</span>
<span class="cp">#define GPCMD_READ_CD_MSF		    0xb9</span>
<span class="cp">#define GPCMD_READ_DISC_INFO		    0x51</span>
<span class="cp">#define GPCMD_READ_DVD_STRUCTURE	    0xad</span>
<span class="cp">#define GPCMD_READ_FORMAT_CAPACITIES	    0x23</span>
<span class="cp">#define GPCMD_READ_HEADER		    0x44</span>
<span class="cp">#define GPCMD_READ_TRACK_RZONE_INFO	    0x52</span>
<span class="cp">#define GPCMD_READ_SUBCHANNEL		    0x42</span>
<span class="cp">#define GPCMD_READ_TOC_PMA_ATIP		    0x43</span>
<span class="cp">#define GPCMD_REPAIR_RZONE_TRACK	    0x58</span>
<span class="cp">#define GPCMD_REPORT_KEY		    0xa4</span>
<span class="cp">#define GPCMD_REQUEST_SENSE		    0x03</span>
<span class="cp">#define GPCMD_RESERVE_RZONE_TRACK	    0x53</span>
<span class="cp">#define GPCMD_SEND_CUE_SHEET		    0x5d</span>
<span class="cp">#define GPCMD_SCAN			    0xba</span>
<span class="cp">#define GPCMD_SEEK			    0x2b</span>
<span class="cp">#define GPCMD_SEND_DVD_STRUCTURE	    0xbf</span>
<span class="cp">#define GPCMD_SEND_EVENT		    0xa2</span>
<span class="cp">#define GPCMD_SEND_KEY			    0xa3</span>
<span class="cp">#define GPCMD_SEND_OPC			    0x54</span>
<span class="cp">#define GPCMD_SET_READ_AHEAD		    0xa7</span>
<span class="cp">#define GPCMD_SET_STREAMING		    0xb6</span>
<span class="cp">#define GPCMD_START_STOP_UNIT		    0x1b</span>
<span class="cp">#define GPCMD_STOP_PLAY_SCAN		    0x4e</span>
<span class="cp">#define GPCMD_TEST_UNIT_READY		    0x00</span>
<span class="cp">#define GPCMD_VERIFY_10			    0x2f</span>
<span class="cp">#define GPCMD_WRITE_10			    0x2a</span>
<span class="cp">#define GPCMD_WRITE_12			    0xaa</span>
<span class="cp">#define GPCMD_WRITE_AND_VERIFY_10	    0x2e</span>
<span class="cp">#define GPCMD_WRITE_BUFFER		    0x3b</span>
<span class="cm">/* This is listed as optional in ATAPI 2.6, but is (curiously) </span>
<span class="cm"> * missing from Mt. Fuji, Table 57.  It _is_ mentioned in Mt. Fuji</span>
<span class="cm"> * Table 377 as an MMC command for SCSi devices though...  Most ATAPI</span>
<span class="cm"> * drives support it. */</span>
<span class="cp">#define GPCMD_SET_SPEED			    0xbb</span>
<span class="cm">/* This seems to be a SCSI specific CD-ROM opcode </span>
<span class="cm"> * to play data at track/index */</span>
<span class="cp">#define GPCMD_PLAYAUDIO_TI		    0x48</span>
<span class="cm">/*</span>
<span class="cm"> * From MS Media Status Notification Support Specification. For</span>
<span class="cm"> * older drives only.</span>
<span class="cm"> */</span>
<span class="cp">#define GPCMD_GET_MEDIA_STATUS		    0xda</span>

<span class="cm">/* Mode page codes for mode sense/set */</span>
<span class="cp">#define GPMODE_VENDOR_PAGE		0x00</span>
<span class="cp">#define GPMODE_R_W_ERROR_PAGE		0x01</span>
<span class="cp">#define GPMODE_WRITE_PARMS_PAGE		0x05</span>
<span class="cp">#define GPMODE_WCACHING_PAGE		0x08</span>
<span class="cp">#define GPMODE_AUDIO_CTL_PAGE		0x0e</span>
<span class="cp">#define GPMODE_POWER_PAGE		0x1a</span>
<span class="cp">#define GPMODE_FAULT_FAIL_PAGE		0x1c</span>
<span class="cp">#define GPMODE_TO_PROTECT_PAGE		0x1d</span>
<span class="cp">#define GPMODE_CAPABILITIES_PAGE	0x2a</span>
<span class="cp">#define GPMODE_ALL_PAGES		0x3f</span>
<span class="cm">/* Not in Mt. Fuji, but in ATAPI 2.6 -- deprecated now in favor</span>
<span class="cm"> * of MODE_SENSE_POWER_PAGE */</span>
<span class="cp">#define GPMODE_CDROM_PAGE		0x0d</span>



<span class="cm">/* DVD struct types */</span>
<span class="cp">#define DVD_STRUCT_PHYSICAL	0x00</span>
<span class="cp">#define DVD_STRUCT_COPYRIGHT	0x01</span>
<span class="cp">#define DVD_STRUCT_DISCKEY	0x02</span>
<span class="cp">#define DVD_STRUCT_BCA		0x03</span>
<span class="cp">#define DVD_STRUCT_MANUFACT	0x04</span>

<span class="k">struct</span> <span class="n">dvd_layer</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">book_version</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">book_type</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">min_rate</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">disc_size</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">layer_type</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">track_path</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">nlayers</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">track_density</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">linear_density</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">bca</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">start_sector</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">end_sector</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">end_sector_l0</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define DVD_LAYERS	4</span>

<span class="k">struct</span> <span class="n">dvd_physical</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">layer_num</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_layer</span> <span class="n">layer</span><span class="p">[</span><span class="n">DVD_LAYERS</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvd_copyright</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>

	<span class="n">__u8</span> <span class="n">layer_num</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">cpst</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">rmi</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvd_disckey</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="n">agid</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">value</span><span class="p">[</span><span class="mi">2048</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvd_bca</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">value</span><span class="p">[</span><span class="mi">188</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvd_manufact</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>

	<span class="n">__u8</span> <span class="n">layer_num</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">value</span><span class="p">[</span><span class="mi">2048</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dvd_physical</span>	<span class="n">physical</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_copyright</span>	<span class="n">copyright</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_disckey</span>	<span class="n">disckey</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_bca</span>		<span class="n">bca</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_manufact</span>	<span class="n">manufact</span><span class="p">;</span>
<span class="p">}</span> <span class="n">dvd_struct</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * DVD authentication ioctl</span>
<span class="cm"> */</span>

<span class="cm">/* Authentication states */</span>
<span class="cp">#define DVD_LU_SEND_AGID	0</span>
<span class="cp">#define DVD_HOST_SEND_CHALLENGE	1</span>
<span class="cp">#define DVD_LU_SEND_KEY1	2</span>
<span class="cp">#define DVD_LU_SEND_CHALLENGE	3</span>
<span class="cp">#define DVD_HOST_SEND_KEY2	4</span>

<span class="cm">/* Termination states */</span>
<span class="cp">#define DVD_AUTH_ESTABLISHED	5</span>
<span class="cp">#define DVD_AUTH_FAILURE	6</span>

<span class="cm">/* Other functions */</span>
<span class="cp">#define DVD_LU_SEND_TITLE_KEY	7</span>
<span class="cp">#define DVD_LU_SEND_ASF		8</span>
<span class="cp">#define DVD_INVALIDATE_AGID	9</span>
<span class="cp">#define DVD_LU_SEND_RPC_STATE	10</span>
<span class="cp">#define DVD_HOST_SEND_RPC_STATE	11</span>

<span class="cm">/* State data */</span>
<span class="k">typedef</span> <span class="n">__u8</span> <span class="n">dvd_key</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>		<span class="cm">/* 40-bit value, MSB is first elem. */</span>
<span class="k">typedef</span> <span class="n">__u8</span> <span class="n">dvd_challenge</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>	<span class="cm">/* 80-bit value, MSB is first elem. */</span>

<span class="k">struct</span> <span class="n">dvd_lu_send_agid</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">agid</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvd_host_send_challenge</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">agid</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>

	<span class="n">dvd_challenge</span> <span class="n">chal</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvd_send_key</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">agid</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>

	<span class="n">dvd_key</span> <span class="n">key</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvd_lu_send_challenge</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">agid</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>

	<span class="n">dvd_challenge</span> <span class="n">chal</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define DVD_CPM_NO_COPYRIGHT	0</span>
<span class="cp">#define DVD_CPM_COPYRIGHTED	1</span>

<span class="cp">#define DVD_CP_SEC_NONE		0</span>
<span class="cp">#define DVD_CP_SEC_EXIST	1</span>

<span class="cp">#define DVD_CGMS_UNRESTRICTED	0</span>
<span class="cp">#define DVD_CGMS_SINGLE		2</span>
<span class="cp">#define DVD_CGMS_RESTRICTED	3</span>

<span class="k">struct</span> <span class="n">dvd_lu_send_title_key</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">agid</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>

	<span class="n">dvd_key</span> <span class="n">title_key</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">lba</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">cpm</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">cp_sec</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">cgms</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvd_lu_send_asf</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">agid</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="n">asf</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvd_host_send_rpcstate</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">pdrc</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvd_lu_send_rpcstate</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">vra</span>		<span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ucca</span>		<span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">region_mask</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">rpc_scheme</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">type</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dvd_lu_send_agid</span>		<span class="n">lsa</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_host_send_challenge</span>	<span class="n">hsc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_send_key</span>		<span class="n">lsk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_lu_send_challenge</span>	<span class="n">lsc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_send_key</span>		<span class="n">hsk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_lu_send_title_key</span>	<span class="n">lstk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_lu_send_asf</span>		<span class="n">lsasf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_host_send_rpcstate</span>	<span class="n">hrpcs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvd_lu_send_rpcstate</span>	<span class="n">lrpcs</span><span class="p">;</span>
<span class="p">}</span> <span class="n">dvd_authinfo</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">request_sense</span> <span class="p">{</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">valid</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">error_code</span>		<span class="o">:</span> <span class="mi">7</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">error_code</span>		<span class="o">:</span> <span class="mi">7</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">valid</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">segment_number</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ili</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">sense_key</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">sense_key</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ili</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">information</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">__u8</span> <span class="n">add_sense_len</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">command_info</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">__u8</span> <span class="n">asc</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ascq</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">fruc</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">sks</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">__u8</span> <span class="n">asb</span><span class="p">[</span><span class="mi">46</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * feature profile</span>
<span class="cm"> */</span>
<span class="cp">#define CDF_RWRT	0x0020	</span><span class="cm">/* &quot;Random Writable&quot; */</span><span class="cp"></span>
<span class="cp">#define CDF_HWDM	0x0024	</span><span class="cm">/* &quot;Hardware Defect Management&quot; */</span><span class="cp"></span>
<span class="cp">#define CDF_MRW 	0x0028</span>

<span class="cm">/*</span>
<span class="cm"> * media status bits</span>
<span class="cm"> */</span>
<span class="cp">#define CDM_MRW_NOTMRW			0</span>
<span class="cp">#define CDM_MRW_BGFORMAT_INACTIVE	1</span>
<span class="cp">#define CDM_MRW_BGFORMAT_ACTIVE		2</span>
<span class="cp">#define CDM_MRW_BGFORMAT_COMPLETE	3</span>

<span class="cm">/*</span>
<span class="cm"> * mrw address spaces</span>
<span class="cm"> */</span>
<span class="cp">#define MRW_LBA_DMA			0</span>
<span class="cp">#define MRW_LBA_GAA			1</span>

<span class="cm">/*</span>
<span class="cm"> * mrw mode pages (first is deprecated) -- probed at init time and</span>
<span class="cm"> * cdi-&gt;mrw_mode_page is set</span>
<span class="cm"> */</span>
<span class="cp">#define MRW_MODE_PC_PRE1		0x2c</span>
<span class="cp">#define MRW_MODE_PC			0x03</span>

<span class="k">struct</span> <span class="n">mrw_feature_desc</span> <span class="p">{</span>
	<span class="n">__be16</span> <span class="n">feature_code</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">feature_version</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">persistent</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">curr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">curr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">persistent</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">feature_version</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">add_len</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>		<span class="o">:</span> <span class="mi">7</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">write</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">write</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>		<span class="o">:</span> <span class="mi">7</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">reserved3</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved5</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* cf. mmc4r02g.pdf 5.3.10 Random Writable Feature (0020h) pg 197 of 635 */</span>
<span class="k">struct</span> <span class="n">rwrt_feature_desc</span> <span class="p">{</span>
	<span class="n">__be16</span> <span class="n">feature_code</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">feature_version</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">persistent</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">curr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">curr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">persistent</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">feature_version</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">add_len</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">last_lba</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">block_size</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">blocking</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>		<span class="o">:</span> <span class="mi">7</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">page_present</span>	<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">page_present</span>	<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>		<span class="o">:</span> <span class="mi">7</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">reserved3</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">__be16</span> <span class="n">disc_information_length</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>			<span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">erasable</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">border_status</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">disc_status</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
        <span class="n">__u8</span> <span class="n">disc_status</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">border_status</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">erasable</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>			<span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="cp">#error &quot;Please fix &lt;asm/byteorder.h&gt;&quot;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">n_first_track</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">n_sessions_lsb</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">first_track_lsb</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">last_track_lsb</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">did_v</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">dbc_v</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">uru</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">reserved2</span>			<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">dbit</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">mrw_status</span>			<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">mrw_status</span>			<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">dbit</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">reserved2</span>			<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">uru</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">dbc_v</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">did_v</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">disc_type</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">n_sessions_msb</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">first_track_msb</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">last_track_msb</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">disc_id</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">lead_in</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">lead_out</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">disc_bar_code</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">__u8</span> <span class="n">reserved3</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">n_opc</span><span class="p">;</span>
<span class="p">}</span> <span class="n">disc_information</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">__be16</span> <span class="n">track_information_length</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">track_lsb</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">session_lsb</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>			<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">damage</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">copy</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">track_mode</span>			<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">rt</span>				<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">blank</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">packet</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">fp</span>				<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">data_mode</span>			<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved3</span>			<span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">lra_v</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">nwa_v</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
        <span class="n">__u8</span> <span class="n">track_mode</span>			<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">copy</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">damage</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>			<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">data_mode</span>			<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">fp</span>				<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">packet</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">blank</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">rt</span>				<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">nwa_v</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">lra_v</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved3</span>			<span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__be32</span> <span class="n">track_start</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">next_writable</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">free_blocks</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">fixed_packet_size</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">track_size</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">last_rec_address</span><span class="p">;</span>
<span class="p">}</span> <span class="n">track_information</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">feature_header</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">data_len</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">curr_profile</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mode_page_header</span> <span class="p">{</span>
	<span class="n">__be16</span> <span class="n">mode_data_length</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">medium_type</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved3</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">desc_length</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#include &lt;linux/fs.h&gt;		</span><span class="cm">/* not really needed, later.. */</span><span class="cp"></span>
<span class="cp">#include &lt;linux/list.h&gt;</span>

<span class="k">struct</span> <span class="n">packet_command</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 		<span class="n">cmd</span><span class="p">[</span><span class="n">CDROM_PACKET_SIZE</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 		<span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> 		<span class="n">buflen</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">stat</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">request_sense</span>	<span class="o">*</span><span class="n">sense</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">data_direction</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">quiet</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">timeout</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">reserved</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * _OLD will use PIO transfer on atapi devices, _BPC_* will use DMA</span>
<span class="cm"> */</span>
<span class="cp">#define CDDA_OLD		0	</span><span class="cm">/* old style */</span><span class="cp"></span>
<span class="cp">#define CDDA_BPC_SINGLE		1	</span><span class="cm">/* single frame block pc */</span><span class="cp"></span>
<span class="cp">#define CDDA_BPC_FULL		2	</span><span class="cm">/* multi frame block pc */</span><span class="cp"></span>

<span class="cm">/* Uniform cdrom data structures for cdrom.c */</span>
<span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cdrom_device_ops</span>  <span class="o">*</span><span class="n">ops</span><span class="p">;</span>  <span class="cm">/* link to device_ops */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>		<span class="cm">/* linked list of all device_info */</span>
	<span class="k">struct</span> <span class="n">gendisk</span> <span class="o">*</span><span class="n">disk</span><span class="p">;</span>		<span class="cm">/* matching block layer disk */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">handle</span><span class="p">;</span>		        <span class="cm">/* driver-dependent data */</span>
<span class="cm">/* specifications */</span>
	<span class="kt">int</span> <span class="n">mask</span><span class="p">;</span>                       <span class="cm">/* mask of capability: disables them */</span>
	<span class="kt">int</span> <span class="n">speed</span><span class="p">;</span>			<span class="cm">/* maximum speed for reading data */</span>
	<span class="kt">int</span> <span class="n">capacity</span><span class="p">;</span>			<span class="cm">/* number of discs in jukebox */</span>
<span class="cm">/* device-related storage */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">options</span>	<span class="o">:</span> <span class="mi">30</span><span class="p">;</span>	<span class="cm">/* options flags */</span>
	<span class="kt">unsigned</span> <span class="n">mc_flags</span>	<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/* media change buffer flags */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vfs_events</span><span class="p">;</span>	<span class="cm">/* cached events for vfs path */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ioctl_events</span><span class="p">;</span>	<span class="cm">/* cached events for ioctl path */</span>
    	<span class="kt">int</span> <span class="n">use_count</span><span class="p">;</span>                  <span class="cm">/* number of times device opened */</span>
    	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>                  <span class="cm">/* name of the device type */</span>
<span class="cm">/* per-device flags */</span>
        <span class="n">__u8</span> <span class="n">sanyo_slot</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/* Sanyo 3 CD changer support */</span>
        <span class="n">__u8</span> <span class="n">keeplocked</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* CDROM_LOCKDOOR status */</span>
        <span class="n">__u8</span> <span class="n">reserved</span>		<span class="o">:</span> <span class="mi">5</span><span class="p">;</span>	<span class="cm">/* not used yet */</span>
	<span class="kt">int</span> <span class="n">cdda_method</span><span class="p">;</span>		<span class="cm">/* see flags */</span>
	<span class="n">__u8</span> <span class="n">last_sense</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">media_written</span><span class="p">;</span>		<span class="cm">/* dirty flag, DVD+RW bookkeeping */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">mmc3_profile</span><span class="p">;</span>	<span class="cm">/* current MMC3 profile */</span>
	<span class="kt">int</span> <span class="n">for_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">exit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">mrw_mode_page</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cdrom_device_ops</span> <span class="p">{</span>
<span class="cm">/* routines */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">open</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">release</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">drive_status</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">check_events</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">clearing</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slot</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">media_changed</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">tray_move</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">lock_door</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">select_speed</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">select_disc</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_last_session</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">cdrom_multisession</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_mcn</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">cdrom_mcn</span> <span class="o">*</span><span class="p">);</span>
	<span class="cm">/* hard reset device */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">reset</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">);</span>
	<span class="cm">/* play stuff */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">audio_ioctl</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>

<span class="cm">/* driver specifications */</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">capability</span><span class="p">;</span>   <span class="cm">/* capability flags */</span>
	<span class="kt">int</span> <span class="n">n_minors</span><span class="p">;</span>           <span class="cm">/* number of active minor devices */</span>
	<span class="cm">/* handle uniform packets for scsi type devices (scsi,atapi) */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">generic_packet</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">packet_command</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* the general block_device operations structure: */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cdrom_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">,</span> <span class="k">struct</span> <span class="n">block_device</span> <span class="o">*</span><span class="n">bdev</span><span class="p">,</span>
			<span class="n">fmode_t</span> <span class="n">mode</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cdrom_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">,</span> <span class="n">fmode_t</span> <span class="n">mode</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cdrom_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">,</span> <span class="k">struct</span> <span class="n">block_device</span> <span class="o">*</span><span class="n">bdev</span><span class="p">,</span>
		       <span class="n">fmode_t</span> <span class="n">mode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cdrom_check_events</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">clearing</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cdrom_media_changed</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">register_cdrom</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">unregister_cdrom</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">);</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">data</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">audio</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">cdi</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">xa</span><span class="p">;</span>
    <span class="kt">long</span> <span class="n">error</span><span class="p">;</span>
<span class="p">}</span> <span class="n">tracktype</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cdrom_get_last_written</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">,</span> <span class="kt">long</span> <span class="o">*</span><span class="n">last_written</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cdrom_number_of_slots</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cdrom_mode_select</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">packet_command</span> <span class="o">*</span><span class="n">cgc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cdrom_mode_sense</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">packet_command</span> <span class="o">*</span><span class="n">cgc</span><span class="p">,</span>
			    <span class="kt">int</span> <span class="n">page_code</span><span class="p">,</span> <span class="kt">int</span> <span class="n">page_control</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">init_cdrom_command</span><span class="p">(</span><span class="k">struct</span> <span class="n">packet_command</span> <span class="o">*</span><span class="n">cgc</span><span class="p">,</span>
			       <span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">);</span>

<span class="cm">/* The SCSI spec says there could be 256 slots. */</span>
<span class="cp">#define CDROM_MAX_SLOTS	256</span>

<span class="k">struct</span> <span class="n">cdrom_mechstat_header</span> <span class="p">{</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">fault</span>         <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">changer_state</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">curslot</span>       <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">mech_state</span>    <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">door_open</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>     <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">curslot</span>       <span class="o">:</span> <span class="mi">5</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">changer_state</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">fault</span>         <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>     <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">door_open</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">mech_state</span>    <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span>     <span class="n">curlba</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">__u8</span>     <span class="n">nslots</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">slot_tablelen</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cdrom_slot</span> <span class="p">{</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">disc_present</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>    <span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">change</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">change</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>    <span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">disc_present</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">reserved2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cdrom_changer_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cdrom_mechstat_header</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cdrom_slot</span> <span class="n">slots</span><span class="p">[</span><span class="n">CDROM_MAX_SLOTS</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">mechtype_caddy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">mechtype_tray</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">mechtype_popup</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">mechtype_individual_changer</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">mechtype_cartridge_changer</span>  <span class="o">=</span> <span class="mi">5</span>
<span class="p">}</span> <span class="n">mechtype_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">ps</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">page_code</span>		<span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">page_length</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">bufe</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ls_v</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">test_write</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">write_type</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">multi_session</span>	<span class="o">:</span> <span class="mi">2</span><span class="p">;</span> <span class="cm">/* or border, DVD */</span>
	<span class="n">__u8</span> <span class="n">fp</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">copy</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">track_mode</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved3</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">data_block_type</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">page_code</span>		<span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ps</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">page_length</span><span class="p">;</span>
        <span class="n">__u8</span> <span class="n">write_type</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">test_write</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ls_v</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">bufe</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">track_mode</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">copy</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">fp</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">multi_session</span>	<span class="o">:</span> <span class="mi">2</span><span class="p">;</span> <span class="cm">/* or border, DVD */</span>
	<span class="n">__u8</span> <span class="n">data_block_type</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved3</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">link_size</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved4</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">reserved5</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">app_code</span>		<span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">app_code</span>		<span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved5</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">session_format</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved6</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">packet_size</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">audio_pause</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">mcn</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">__u8</span> <span class="n">isrc</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">__u8</span> <span class="n">subhdr0</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">subhdr1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">subhdr2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">subhdr3</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">write_param_page</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">modesel_head</span>
<span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">reserved1</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">medium</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">reserved2</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">block_desc_length</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">density</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">number_of_blocks_hi</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">number_of_blocks_med</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">number_of_blocks_lo</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">reserved3</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">block_length_hi</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">block_length_med</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">block_length_lo</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">__u16</span> <span class="n">report_key_length</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">type_code</span>			<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">vra</span>			<span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ucca</span>			<span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">ucca</span>			<span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">vra</span>			<span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">type_code</span>			<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">region_mask</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">rpc_scheme</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved3</span><span class="p">;</span>
<span class="p">}</span> <span class="n">rpc_state_t</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">event_header</span> <span class="p">{</span>
	<span class="n">__be16</span> <span class="n">data_len</span><span class="p">;</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">nea</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">notification_class</span>	<span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">notification_class</span>	<span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">nea</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">supp_event_class</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">media_event_desc</span> <span class="p">{</span>
<span class="cp">#if defined(__BIG_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">media_event_code</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>		<span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">media_present</span>	<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">door_open</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#elif defined(__LITTLE_ENDIAN_BITFIELD)</span>
	<span class="n">__u8</span> <span class="n">media_event_code</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved1</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">door_open</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">media_present</span>	<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">reserved2</span>		<span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">__u8</span> <span class="n">start_slot</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">end_slot</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cdrom_get_media_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">cdrom_device_info</span> <span class="o">*</span><span class="n">cdi</span><span class="p">,</span> <span class="k">struct</span> <span class="n">media_event_desc</span> <span class="o">*</span><span class="n">med</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">lba_to_msf</span><span class="p">(</span><span class="kt">int</span> <span class="n">lba</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">lba</span> <span class="o">+=</span> <span class="n">CD_MSF_OFFSET</span><span class="p">;</span>
	<span class="n">lba</span> <span class="o">&amp;=</span> <span class="mh">0xffffff</span><span class="p">;</span>  <span class="cm">/* negative lbas use only 24 bits */</span>
	<span class="o">*</span><span class="n">m</span> <span class="o">=</span> <span class="n">lba</span> <span class="o">/</span> <span class="p">(</span><span class="n">CD_SECS</span> <span class="o">*</span> <span class="n">CD_FRAMES</span><span class="p">);</span>
	<span class="n">lba</span> <span class="o">%=</span> <span class="p">(</span><span class="n">CD_SECS</span> <span class="o">*</span> <span class="n">CD_FRAMES</span><span class="p">);</span>
	<span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="n">lba</span> <span class="o">/</span> <span class="n">CD_FRAMES</span><span class="p">;</span>
	<span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">lba</span> <span class="o">%</span> <span class="n">CD_FRAMES</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">msf_to_lba</span><span class="p">(</span><span class="n">u8</span> <span class="n">m</span><span class="p">,</span> <span class="n">u8</span> <span class="n">s</span><span class="p">,</span> <span class="n">u8</span> <span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(((</span><span class="n">m</span> <span class="o">*</span> <span class="n">CD_SECS</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="p">)</span> <span class="o">*</span> <span class="n">CD_FRAMES</span> <span class="o">+</span> <span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="n">CD_MSF_OFFSET</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif  </span><span class="cm">/* End of kernel only stuff */</span><span class="cp"> </span>

<span class="cp">#endif  </span><span class="cm">/* _LINUX_CDROM_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
