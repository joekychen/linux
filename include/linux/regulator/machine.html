<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › regulator › machine.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>machine.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * machine.h -- SoC Regulator support, machine/board driver API.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2007, 2008 Wolfson Microelectronics PLC.</span>
<span class="cm"> *</span>
<span class="cm"> * Author: Liam Girdwood &lt;lrg@slimlogic.co.uk&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * Regulator Machine/Board Interface.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __LINUX_REGULATOR_MACHINE_H_</span>
<span class="cp">#define __LINUX_REGULATOR_MACHINE_H_</span>

<span class="cp">#include &lt;linux/regulator/consumer.h&gt;</span>
<span class="cp">#include &lt;linux/suspend.h&gt;</span>

<span class="k">struct</span> <span class="n">regulator</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Regulator operation constraint flags. These flags are used to enable</span>
<span class="cm"> * certain regulator operations and can be OR&#39;ed together.</span>
<span class="cm"> *</span>
<span class="cm"> * VOLTAGE:  Regulator output voltage can be changed by software on this</span>
<span class="cm"> *           board/machine.</span>
<span class="cm"> * CURRENT:  Regulator output current can be changed by software on this</span>
<span class="cm"> *           board/machine.</span>
<span class="cm"> * MODE:     Regulator operating mode can be changed by software on this</span>
<span class="cm"> *           board/machine.</span>
<span class="cm"> * STATUS:   Regulator can be enabled and disabled.</span>
<span class="cm"> * DRMS:     Dynamic Regulator Mode Switching is enabled for this regulator.</span>
<span class="cm"> */</span>

<span class="cp">#define REGULATOR_CHANGE_VOLTAGE	0x1</span>
<span class="cp">#define REGULATOR_CHANGE_CURRENT	0x2</span>
<span class="cp">#define REGULATOR_CHANGE_MODE		0x4</span>
<span class="cp">#define REGULATOR_CHANGE_STATUS		0x8</span>
<span class="cp">#define REGULATOR_CHANGE_DRMS		0x10</span>

<span class="cm">/**</span>
<span class="cm"> * struct regulator_state - regulator state during low power system states</span>
<span class="cm"> *</span>
<span class="cm"> * This describes a regulators state during a system wide low power</span>
<span class="cm"> * state.  One of enabled or disabled must be set for the</span>
<span class="cm"> * configuration to be applied.</span>
<span class="cm"> *</span>
<span class="cm"> * @uV: Operating voltage during suspend.</span>
<span class="cm"> * @mode: Operating mode during suspend.</span>
<span class="cm"> * @enabled: Enabled during suspend.</span>
<span class="cm"> * @disabled: Disabled during suspend.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">regulator_state</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">uV</span><span class="p">;</span>	<span class="cm">/* suspend voltage */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">;</span> <span class="cm">/* suspend regulator operating mode */</span>
	<span class="kt">int</span> <span class="n">enabled</span><span class="p">;</span> <span class="cm">/* is regulator enabled in this suspend state */</span>
	<span class="kt">int</span> <span class="n">disabled</span><span class="p">;</span> <span class="cm">/* is the regulator disbled in this suspend state */</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct regulation_constraints - regulator operating constraints.</span>
<span class="cm"> *</span>
<span class="cm"> * This struct describes regulator and board/machine specific constraints.</span>
<span class="cm"> *</span>
<span class="cm"> * @name: Descriptive name for the constraints, used for display purposes.</span>
<span class="cm"> *</span>
<span class="cm"> * @min_uV: Smallest voltage consumers may set.</span>
<span class="cm"> * @max_uV: Largest voltage consumers may set.</span>
<span class="cm"> * @uV_offset: Offset applied to voltages from consumer to compensate for</span>
<span class="cm"> *             voltage drops.</span>
<span class="cm"> *</span>
<span class="cm"> * @min_uA: Smallest current consumers may set.</span>
<span class="cm"> * @max_uA: Largest current consumers may set.</span>
<span class="cm"> *</span>
<span class="cm"> * @valid_modes_mask: Mask of modes which may be configured by consumers.</span>
<span class="cm"> * @valid_ops_mask: Operations which may be performed by consumers.</span>
<span class="cm"> *</span>
<span class="cm"> * @always_on: Set if the regulator should never be disabled.</span>
<span class="cm"> * @boot_on: Set if the regulator is enabled when the system is initially</span>
<span class="cm"> *           started.  If the regulator is not enabled by the hardware or</span>
<span class="cm"> *           bootloader then it will be enabled when the constraints are</span>
<span class="cm"> *           applied.</span>
<span class="cm"> * @apply_uV: Apply the voltage constraint when initialising.</span>
<span class="cm"> *</span>
<span class="cm"> * @input_uV: Input voltage for regulator when supplied by another regulator.</span>
<span class="cm"> *</span>
<span class="cm"> * @state_disk: State for regulator when system is suspended in disk mode.</span>
<span class="cm"> * @state_mem: State for regulator when system is suspended in mem mode.</span>
<span class="cm"> * @state_standby: State for regulator when system is suspended in standby</span>
<span class="cm"> *                 mode.</span>
<span class="cm"> * @initial_state: Suspend state to set by default.</span>
<span class="cm"> * @initial_mode: Mode to set at startup.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">regulation_constraints</span> <span class="p">{</span>

	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>

	<span class="cm">/* voltage output range (inclusive) - for voltage control */</span>
	<span class="kt">int</span> <span class="n">min_uV</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">max_uV</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">uV_offset</span><span class="p">;</span>

	<span class="cm">/* current output range (inclusive) - for current control */</span>
	<span class="kt">int</span> <span class="n">min_uA</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">max_uA</span><span class="p">;</span>

	<span class="cm">/* valid regulator operating modes for this machine */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">valid_modes_mask</span><span class="p">;</span>

	<span class="cm">/* valid operations for regulator on this machine */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">valid_ops_mask</span><span class="p">;</span>

	<span class="cm">/* regulator input voltage - only if supply is another regulator */</span>
	<span class="kt">int</span> <span class="n">input_uV</span><span class="p">;</span>

	<span class="cm">/* regulator suspend states for global PMIC STANDBY/HIBERNATE */</span>
	<span class="k">struct</span> <span class="n">regulator_state</span> <span class="n">state_disk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">regulator_state</span> <span class="n">state_mem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">regulator_state</span> <span class="n">state_standby</span><span class="p">;</span>
	<span class="n">suspend_state_t</span> <span class="n">initial_state</span><span class="p">;</span> <span class="cm">/* suspend state to set at init */</span>

	<span class="cm">/* mode to set on startup */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">initial_mode</span><span class="p">;</span>

	<span class="cm">/* constraint flags */</span>
	<span class="kt">unsigned</span> <span class="n">always_on</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* regulator never off when system is on */</span>
	<span class="kt">unsigned</span> <span class="n">boot_on</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* bootloader/firmware enabled regulator */</span>
	<span class="kt">unsigned</span> <span class="n">apply_uV</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* apply uV constraint if min == max */</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct regulator_consumer_supply - supply -&gt; device mapping</span>
<span class="cm"> *</span>
<span class="cm"> * This maps a supply name to a device. Use of dev_name allows support for</span>
<span class="cm"> * buses which make struct device available late such as I2C.</span>
<span class="cm"> *</span>
<span class="cm"> * @dev_name: Result of dev_name() for the consumer.</span>
<span class="cm"> * @supply: Name for the supply.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dev_name</span><span class="p">;</span>   <span class="cm">/* dev_name() for consumer */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">supply</span><span class="p">;</span>	<span class="cm">/* consumer supply - e.g. &quot;vcc&quot; */</span>
<span class="p">};</span>

<span class="cm">/* Initialize struct regulator_consumer_supply */</span>
<span class="cp">#define REGULATOR_SUPPLY(_name, _dev_name)			\</span>
<span class="cp">{								\</span>
<span class="cp">	.supply		= _name,				\</span>
<span class="cp">	.dev_name	= _dev_name,				\</span>
<span class="cp">}</span>

<span class="cm">/**</span>
<span class="cm"> * struct regulator_init_data - regulator platform initialisation data.</span>
<span class="cm"> *</span>
<span class="cm"> * Initialisation constraints, our supply and consumers supplies.</span>
<span class="cm"> *</span>
<span class="cm"> * @supply_regulator: Parent regulator.  Specified using the regulator name</span>
<span class="cm"> *                    as it appears in the name field in sysfs, which can</span>
<span class="cm"> *                    be explicitly set using the constraints field &#39;name&#39;.</span>
<span class="cm"> *</span>
<span class="cm"> * @constraints: Constraints.  These must be specified for the regulator to</span>
<span class="cm"> *               be usable.</span>
<span class="cm"> * @num_consumer_supplies: Number of consumer device supplies.</span>
<span class="cm"> * @consumer_supplies: Consumer device supply configuration.</span>
<span class="cm"> *</span>
<span class="cm"> * @regulator_init: Callback invoked when the regulator has been registered.</span>
<span class="cm"> * @driver_data: Data passed to regulator_init.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">regulator_init_data</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">supply_regulator</span><span class="p">;</span>        <span class="cm">/* or NULL for system supply */</span>

	<span class="k">struct</span> <span class="n">regulation_constraints</span> <span class="n">constraints</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">num_consumer_supplies</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">regulator_consumer_supply</span> <span class="o">*</span><span class="n">consumer_supplies</span><span class="p">;</span>

	<span class="cm">/* optional regulator machine specific init */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">regulator_init</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">driver_data</span><span class="p">);</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">driver_data</span><span class="p">;</span>	<span class="cm">/* core does not touch this */</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">regulator_suspend_prepare</span><span class="p">(</span><span class="n">suspend_state_t</span> <span class="n">state</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">regulator_suspend_finish</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_REGULATOR</span>
<span class="kt">void</span> <span class="n">regulator_has_full_constraints</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">regulator_use_dummy_regulator</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">regulator_has_full_constraints</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">regulator_use_dummy_regulator</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
