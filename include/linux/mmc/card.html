<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › mmc › card.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>card.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  linux/include/linux/mmc/card.h</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> *  Card driver specific definitions.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef LINUX_MMC_CARD_H</span>
<span class="cp">#define LINUX_MMC_CARD_H</span>

<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/mmc/core.h&gt;</span>
<span class="cp">#include &lt;linux/mod_devicetable.h&gt;</span>

<span class="k">struct</span> <span class="n">mmc_cid</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">manfid</span><span class="p">;</span>
	<span class="kt">char</span>			<span class="n">prod_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">serial</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">oemid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">year</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">hwrev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">fwrev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">month</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mmc_csd</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">structure</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">mmca_vsn</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">cmdclass</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">tacc_clks</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">tacc_ns</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">c_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">r2w_factor</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">max_dtr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">erase_size</span><span class="p">;</span>		<span class="cm">/* In sectors */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">read_blkbits</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">write_blkbits</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">capacity</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">read_partial</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>
				<span class="nl">read_misalign:</span><span class="mi">1</span><span class="p">,</span>
				<span class="nl">write_partial:</span><span class="mi">1</span><span class="p">,</span>
				<span class="nl">write_misalign:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mmc_ext_csd</span> <span class="p">{</span>
	<span class="n">u8</span>			<span class="n">rev</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">erase_group_def</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">sec_feature_support</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">rel_sectors</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">rel_param</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">part_config</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">cache_ctrl</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">rst_n_function</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">part_time</span><span class="p">;</span>		<span class="cm">/* Units: ms */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sa_timeout</span><span class="p">;</span>		<span class="cm">/* Units: 100ns */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">generic_cmd6_time</span><span class="p">;</span>	<span class="cm">/* Units: 10ms */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">power_off_longtime</span><span class="p">;</span>     <span class="cm">/* Units: ms */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">hs_max_dtr</span><span class="p">;</span>
<span class="cp">#define MMC_HIGH_26_MAX_DTR	26000000</span>
<span class="cp">#define MMC_HIGH_52_MAX_DTR	52000000</span>
<span class="cp">#define MMC_HIGH_DDR_MAX_DTR	52000000</span>
<span class="cp">#define MMC_HS200_MAX_DTR	200000000</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sectors</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">card_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">hc_erase_size</span><span class="p">;</span>		<span class="cm">/* In sectors */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">hc_erase_timeout</span><span class="p">;</span>	<span class="cm">/* In milliseconds */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sec_trim_mult</span><span class="p">;</span>	<span class="cm">/* Secure trim multiplier  */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sec_erase_mult</span><span class="p">;</span>	<span class="cm">/* Secure erase multiplier */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">trim_timeout</span><span class="p">;</span>		<span class="cm">/* In milliseconds */</span>
	<span class="n">bool</span>			<span class="n">enhanced_area_en</span><span class="p">;</span>	<span class="cm">/* enable bit */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span>	<span class="n">enhanced_area_offset</span><span class="p">;</span>	<span class="cm">/* Units: Byte */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">enhanced_area_size</span><span class="p">;</span>	<span class="cm">/* Units: KB */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">cache_size</span><span class="p">;</span>		<span class="cm">/* Units: KB */</span>
	<span class="n">bool</span>			<span class="n">hpi_en</span><span class="p">;</span>			<span class="cm">/* HPI enablebit */</span>
	<span class="n">bool</span>			<span class="n">hpi</span><span class="p">;</span>			<span class="cm">/* HPI support bit */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">hpi_cmd</span><span class="p">;</span>		<span class="cm">/* cmd used as HPI */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">data_sector_size</span><span class="p">;</span>       <span class="cm">/* 512 bytes or 4KB */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">data_tag_unit_size</span><span class="p">;</span>     <span class="cm">/* DATA TAG UNIT size */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">boot_ro_lock</span><span class="p">;</span>		<span class="cm">/* ro lock support */</span>
	<span class="n">bool</span>			<span class="n">boot_ro_lockable</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">raw_partition_support</span><span class="p">;</span>	<span class="cm">/* 160 */</span>
	<span class="n">u8</span>			<span class="n">raw_erased_mem_count</span><span class="p">;</span>	<span class="cm">/* 181 */</span>
	<span class="n">u8</span>			<span class="n">raw_ext_csd_structure</span><span class="p">;</span>	<span class="cm">/* 194 */</span>
	<span class="n">u8</span>			<span class="n">raw_card_type</span><span class="p">;</span>		<span class="cm">/* 196 */</span>
	<span class="n">u8</span>			<span class="n">out_of_int_time</span><span class="p">;</span>	<span class="cm">/* 198 */</span>
	<span class="n">u8</span>			<span class="n">raw_s_a_timeout</span><span class="p">;</span>		<span class="cm">/* 217 */</span>
	<span class="n">u8</span>			<span class="n">raw_hc_erase_gap_size</span><span class="p">;</span>	<span class="cm">/* 221 */</span>
	<span class="n">u8</span>			<span class="n">raw_erase_timeout_mult</span><span class="p">;</span>	<span class="cm">/* 223 */</span>
	<span class="n">u8</span>			<span class="n">raw_hc_erase_grp_size</span><span class="p">;</span>	<span class="cm">/* 224 */</span>
	<span class="n">u8</span>			<span class="n">raw_sec_trim_mult</span><span class="p">;</span>	<span class="cm">/* 229 */</span>
	<span class="n">u8</span>			<span class="n">raw_sec_erase_mult</span><span class="p">;</span>	<span class="cm">/* 230 */</span>
	<span class="n">u8</span>			<span class="n">raw_sec_feature_support</span><span class="p">;</span><span class="cm">/* 231 */</span>
	<span class="n">u8</span>			<span class="n">raw_trim_mult</span><span class="p">;</span>		<span class="cm">/* 232 */</span>
	<span class="n">u8</span>			<span class="n">raw_sectors</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* 212 - 4 bytes */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">feature_support</span><span class="p">;</span>
<span class="cp">#define MMC_DISCARD_FEATURE	BIT(0)                  </span><span class="cm">/* CMD38 feature */</span><span class="cp"></span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sd_scr</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">sda_vsn</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">sda_spec3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">bus_widths</span><span class="p">;</span>
<span class="cp">#define SD_SCR_BUS_WIDTH_1	(1&lt;&lt;0)</span>
<span class="cp">#define SD_SCR_BUS_WIDTH_4	(1&lt;&lt;2)</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">cmds</span><span class="p">;</span>
<span class="cp">#define SD_SCR_CMD20_SUPPORT   (1&lt;&lt;0)</span>
<span class="cp">#define SD_SCR_CMD23_SUPPORT   (1&lt;&lt;1)</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sd_ssr</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">au</span><span class="p">;</span>			<span class="cm">/* In sectors */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">erase_timeout</span><span class="p">;</span>		<span class="cm">/* In milliseconds */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">erase_offset</span><span class="p">;</span>		<span class="cm">/* In milliseconds */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sd_switch_caps</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">hs_max_dtr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">uhs_max_dtr</span><span class="p">;</span>
<span class="cp">#define HIGH_SPEED_MAX_DTR	50000000</span>
<span class="cp">#define UHS_SDR104_MAX_DTR	208000000</span>
<span class="cp">#define UHS_SDR50_MAX_DTR	100000000</span>
<span class="cp">#define UHS_DDR50_MAX_DTR	50000000</span>
<span class="cp">#define UHS_SDR25_MAX_DTR	UHS_DDR50_MAX_DTR</span>
<span class="cp">#define UHS_SDR12_MAX_DTR	25000000</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sd3_bus_mode</span><span class="p">;</span>
<span class="cp">#define UHS_SDR12_BUS_SPEED	0</span>
<span class="cp">#define HIGH_SPEED_BUS_SPEED	1</span>
<span class="cp">#define UHS_SDR25_BUS_SPEED	1</span>
<span class="cp">#define UHS_SDR50_BUS_SPEED	2</span>
<span class="cp">#define UHS_SDR104_BUS_SPEED	3</span>
<span class="cp">#define UHS_DDR50_BUS_SPEED	4</span>

<span class="cp">#define SD_MODE_HIGH_SPEED	(1 &lt;&lt; HIGH_SPEED_BUS_SPEED)</span>
<span class="cp">#define SD_MODE_UHS_SDR12	(1 &lt;&lt; UHS_SDR12_BUS_SPEED)</span>
<span class="cp">#define SD_MODE_UHS_SDR25	(1 &lt;&lt; UHS_SDR25_BUS_SPEED)</span>
<span class="cp">#define SD_MODE_UHS_SDR50	(1 &lt;&lt; UHS_SDR50_BUS_SPEED)</span>
<span class="cp">#define SD_MODE_UHS_SDR104	(1 &lt;&lt; UHS_SDR104_BUS_SPEED)</span>
<span class="cp">#define SD_MODE_UHS_DDR50	(1 &lt;&lt; UHS_DDR50_BUS_SPEED)</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sd3_drv_type</span><span class="p">;</span>
<span class="cp">#define SD_DRIVER_TYPE_B	0x01</span>
<span class="cp">#define SD_DRIVER_TYPE_A	0x02</span>
<span class="cp">#define SD_DRIVER_TYPE_C	0x04</span>
<span class="cp">#define SD_DRIVER_TYPE_D	0x08</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sd3_curr_limit</span><span class="p">;</span>
<span class="cp">#define SD_SET_CURRENT_LIMIT_200	0</span>
<span class="cp">#define SD_SET_CURRENT_LIMIT_400	1</span>
<span class="cp">#define SD_SET_CURRENT_LIMIT_600	2</span>
<span class="cp">#define SD_SET_CURRENT_LIMIT_800	3</span>

<span class="cp">#define SD_MAX_CURRENT_200	(1 &lt;&lt; SD_SET_CURRENT_LIMIT_200)</span>
<span class="cp">#define SD_MAX_CURRENT_400	(1 &lt;&lt; SD_SET_CURRENT_LIMIT_400)</span>
<span class="cp">#define SD_MAX_CURRENT_600	(1 &lt;&lt; SD_SET_CURRENT_LIMIT_600)</span>
<span class="cp">#define SD_MAX_CURRENT_800	(1 &lt;&lt; SD_SET_CURRENT_LIMIT_800)</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sdio_cccr</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sdio_vsn</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sd_vsn</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">multi_block</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span>
				<span class="nl">low_speed:</span><span class="mi">1</span><span class="p">,</span>
				<span class="nl">wide_bus:</span><span class="mi">1</span><span class="p">,</span>
				<span class="nl">high_power:</span><span class="mi">1</span><span class="p">,</span>
				<span class="nl">high_speed:</span><span class="mi">1</span><span class="p">,</span>
				<span class="nl">disable_cd:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sdio_cis</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">vendor</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">device</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">blksize</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">max_dtr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mmc_host</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">sdio_func</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">sdio_func_tuple</span><span class="p">;</span>

<span class="cp">#define SDIO_MAX_FUNCS		7</span>

<span class="cm">/* The number of MMC physical partitions.  These consist of:</span>
<span class="cm"> * boot partitions (2), general purpose partitions (4) in MMC v4.4.</span>
<span class="cm"> */</span>
<span class="cp">#define MMC_NUM_BOOT_PARTITION	2</span>
<span class="cp">#define MMC_NUM_GP_PARTITION	4</span>
<span class="cp">#define MMC_NUM_PHY_PARTITION	6</span>
<span class="cp">#define MAX_MMC_PART_NAME_LEN	20</span>

<span class="cm">/*</span>
<span class="cm"> * MMC Physical partitions</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mmc_part</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">size</span><span class="p">;</span>	<span class="cm">/* partition size (in bytes) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">part_cfg</span><span class="p">;</span>	<span class="cm">/* partition type */</span>
	<span class="kt">char</span>	<span class="n">name</span><span class="p">[</span><span class="n">MAX_MMC_PART_NAME_LEN</span><span class="p">];</span>
	<span class="n">bool</span>	<span class="n">force_ro</span><span class="p">;</span>	<span class="cm">/* to make boot parts RO by default */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">area_type</span><span class="p">;</span>
<span class="cp">#define MMC_BLK_DATA_AREA_MAIN	(1&lt;&lt;0)</span>
<span class="cp">#define MMC_BLK_DATA_AREA_BOOT	(1&lt;&lt;1)</span>
<span class="cp">#define MMC_BLK_DATA_AREA_GP	(1&lt;&lt;2)</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * MMC device</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mmc_card</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mmc_host</span>		<span class="o">*</span><span class="n">host</span><span class="p">;</span>		<span class="cm">/* the host this device belongs to */</span>
	<span class="k">struct</span> <span class="n">device</span>		<span class="n">dev</span><span class="p">;</span>		<span class="cm">/* the device */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">rca</span><span class="p">;</span>		<span class="cm">/* relative card address of device */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">type</span><span class="p">;</span>		<span class="cm">/* card type */</span>
<span class="cp">#define MMC_TYPE_MMC		0		</span><span class="cm">/* MMC card */</span><span class="cp"></span>
<span class="cp">#define MMC_TYPE_SD		1		</span><span class="cm">/* SD card */</span><span class="cp"></span>
<span class="cp">#define MMC_TYPE_SDIO		2		</span><span class="cm">/* SDIO card */</span><span class="cp"></span>
<span class="cp">#define MMC_TYPE_SD_COMBO	3		</span><span class="cm">/* SD combo (IO+mem) card */</span><span class="cp"></span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">state</span><span class="p">;</span>		<span class="cm">/* (our) card state */</span>
<span class="cp">#define MMC_STATE_PRESENT	(1&lt;&lt;0)		</span><span class="cm">/* present in sysfs */</span><span class="cp"></span>
<span class="cp">#define MMC_STATE_READONLY	(1&lt;&lt;1)		</span><span class="cm">/* card is read-only */</span><span class="cp"></span>
<span class="cp">#define MMC_STATE_HIGHSPEED	(1&lt;&lt;2)		</span><span class="cm">/* card is in high speed mode */</span><span class="cp"></span>
<span class="cp">#define MMC_STATE_BLOCKADDR	(1&lt;&lt;3)		</span><span class="cm">/* card uses block-addressing */</span><span class="cp"></span>
<span class="cp">#define MMC_STATE_HIGHSPEED_DDR (1&lt;&lt;4)		</span><span class="cm">/* card is in high speed mode */</span><span class="cp"></span>
<span class="cp">#define MMC_STATE_ULTRAHIGHSPEED (1&lt;&lt;5)		</span><span class="cm">/* card is in ultra high speed mode */</span><span class="cp"></span>
<span class="cp">#define MMC_CARD_SDXC		(1&lt;&lt;6)		</span><span class="cm">/* card is SDXC */</span><span class="cp"></span>
<span class="cp">#define MMC_CARD_REMOVED	(1&lt;&lt;7)		</span><span class="cm">/* card has been removed */</span><span class="cp"></span>
<span class="cp">#define MMC_STATE_HIGHSPEED_200	(1&lt;&lt;8)		</span><span class="cm">/* card is in HS200 mode */</span><span class="cp"></span>
<span class="cp">#define MMC_STATE_SLEEP		(1&lt;&lt;9)		</span><span class="cm">/* card is in sleep state */</span><span class="cp"></span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">quirks</span><span class="p">;</span> 	<span class="cm">/* card quirks */</span>
<span class="cp">#define MMC_QUIRK_LENIENT_FN0	(1&lt;&lt;0)		</span><span class="cm">/* allow SDIO FN0 writes outside of the VS CCCR range */</span><span class="cp"></span>
<span class="cp">#define MMC_QUIRK_BLKSZ_FOR_BYTE_MODE (1&lt;&lt;1)	</span><span class="cm">/* use func-&gt;cur_blksize */</span><span class="cp"></span>
						<span class="cm">/* for byte mode */</span>
<span class="cp">#define MMC_QUIRK_NONSTD_SDIO	(1&lt;&lt;2)		</span><span class="cm">/* non-standard SDIO card attached */</span><span class="cp"></span>
						<span class="cm">/* (missing CIA registers) */</span>
<span class="cp">#define MMC_QUIRK_BROKEN_CLK_GATING (1&lt;&lt;3)	</span><span class="cm">/* clock gating the sdio bus will make card fail */</span><span class="cp"></span>
<span class="cp">#define MMC_QUIRK_NONSTD_FUNC_IF (1&lt;&lt;4)		</span><span class="cm">/* SDIO card has nonstd function interfaces */</span><span class="cp"></span>
<span class="cp">#define MMC_QUIRK_DISABLE_CD	(1&lt;&lt;5)		</span><span class="cm">/* disconnect CD/DAT[3] resistor */</span><span class="cp"></span>
<span class="cp">#define MMC_QUIRK_INAND_CMD38	(1&lt;&lt;6)		</span><span class="cm">/* iNAND devices have broken CMD38 */</span><span class="cp"></span>
<span class="cp">#define MMC_QUIRK_BLK_NO_CMD23	(1&lt;&lt;7)		</span><span class="cm">/* Avoid CMD23 for regular multiblock */</span><span class="cp"></span>
<span class="cp">#define MMC_QUIRK_BROKEN_BYTE_MODE_512 (1&lt;&lt;8)	</span><span class="cm">/* Avoid sending 512 bytes in */</span><span class="cp"></span>
<span class="cp">#define MMC_QUIRK_LONG_READ_TIME (1&lt;&lt;9)		</span><span class="cm">/* Data read time &gt; CSD says */</span><span class="cp"></span>
						<span class="cm">/* byte mode */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>    <span class="n">poweroff_notify_state</span><span class="p">;</span>	<span class="cm">/* eMMC4.5 notify feature */</span>
<span class="cp">#define MMC_NO_POWER_NOTIFICATION	0</span>
<span class="cp">#define MMC_POWERED_ON			1</span>
<span class="cp">#define MMC_POWEROFF_SHORT		2</span>
<span class="cp">#define MMC_POWEROFF_LONG		3</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">erase_size</span><span class="p">;</span>	<span class="cm">/* erase size in sectors */</span>
 	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">erase_shift</span><span class="p">;</span>	<span class="cm">/* if erase unit is power 2 */</span>
 	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">pref_erase</span><span class="p">;</span>	<span class="cm">/* in sectors */</span>
 	<span class="n">u8</span>			<span class="n">erased_byte</span><span class="p">;</span>	<span class="cm">/* value of erased bytes */</span>

	<span class="n">u32</span>			<span class="n">raw_cid</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* raw card CID */</span>
	<span class="n">u32</span>			<span class="n">raw_csd</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* raw card CSD */</span>
	<span class="n">u32</span>			<span class="n">raw_scr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* raw card SCR */</span>
	<span class="k">struct</span> <span class="n">mmc_cid</span>		<span class="n">cid</span><span class="p">;</span>		<span class="cm">/* card identification */</span>
	<span class="k">struct</span> <span class="n">mmc_csd</span>		<span class="n">csd</span><span class="p">;</span>		<span class="cm">/* card specific */</span>
	<span class="k">struct</span> <span class="n">mmc_ext_csd</span>	<span class="n">ext_csd</span><span class="p">;</span>	<span class="cm">/* mmc v4 extended card specific */</span>
	<span class="k">struct</span> <span class="n">sd_scr</span>		<span class="n">scr</span><span class="p">;</span>		<span class="cm">/* extra SD information */</span>
	<span class="k">struct</span> <span class="n">sd_ssr</span>		<span class="n">ssr</span><span class="p">;</span>		<span class="cm">/* yet more SD information */</span>
	<span class="k">struct</span> <span class="n">sd_switch_caps</span>	<span class="n">sw_caps</span><span class="p">;</span>	<span class="cm">/* switch (CMD6) caps */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sdio_funcs</span><span class="p">;</span>	<span class="cm">/* number of SDIO functions */</span>
	<span class="k">struct</span> <span class="n">sdio_cccr</span>	<span class="n">cccr</span><span class="p">;</span>		<span class="cm">/* common card info */</span>
	<span class="k">struct</span> <span class="n">sdio_cis</span>		<span class="n">cis</span><span class="p">;</span>		<span class="cm">/* common tuple info */</span>
	<span class="k">struct</span> <span class="n">sdio_func</span>	<span class="o">*</span><span class="n">sdio_func</span><span class="p">[</span><span class="n">SDIO_MAX_FUNCS</span><span class="p">];</span> <span class="cm">/* SDIO functions (devices) */</span>
	<span class="k">struct</span> <span class="n">sdio_func</span>	<span class="o">*</span><span class="n">sdio_single_irq</span><span class="p">;</span> <span class="cm">/* SDIO function when only one IRQ active */</span>
	<span class="kt">unsigned</span>		<span class="n">num_info</span><span class="p">;</span>	<span class="cm">/* number of info strings */</span>
	<span class="k">const</span> <span class="kt">char</span>		<span class="o">**</span><span class="n">info</span><span class="p">;</span>		<span class="cm">/* info strings */</span>
	<span class="k">struct</span> <span class="n">sdio_func_tuple</span>	<span class="o">*</span><span class="n">tuples</span><span class="p">;</span>	<span class="cm">/* unknown common tuples */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">sd_bus_speed</span><span class="p">;</span>	<span class="cm">/* Bus Speed Mode set for the card */</span>

	<span class="k">struct</span> <span class="n">dentry</span>		<span class="o">*</span><span class="n">debugfs_root</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mmc_part</span>	<span class="n">part</span><span class="p">[</span><span class="n">MMC_NUM_PHY_PARTITION</span><span class="p">];</span> <span class="cm">/* physical partitions */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>    <span class="n">nr_parts</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * This function fill contents in mmc_part.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">mmc_part_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">part_cfg</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bool</span> <span class="n">ro</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">area_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">card</span><span class="o">-&gt;</span><span class="n">part</span><span class="p">[</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">nr_parts</span><span class="p">].</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">card</span><span class="o">-&gt;</span><span class="n">part</span><span class="p">[</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">nr_parts</span><span class="p">].</span><span class="n">part_cfg</span> <span class="o">=</span> <span class="n">part_cfg</span><span class="p">;</span>
	<span class="n">sprintf</span><span class="p">(</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">part</span><span class="p">[</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">nr_parts</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="n">card</span><span class="o">-&gt;</span><span class="n">part</span><span class="p">[</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">nr_parts</span><span class="p">].</span><span class="n">force_ro</span> <span class="o">=</span> <span class="n">ro</span><span class="p">;</span>
	<span class="n">card</span><span class="o">-&gt;</span><span class="n">part</span><span class="p">[</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">nr_parts</span><span class="p">].</span><span class="n">area_type</span> <span class="o">=</span> <span class="n">area_type</span><span class="p">;</span>
	<span class="n">card</span><span class="o">-&gt;</span><span class="n">nr_parts</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> *  The world is not perfect and supplies us with broken mmc/sdio devices.</span>
<span class="cm"> *  For at least some of these bugs we need a work-around.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">mmc_fixup</span> <span class="p">{</span>
	<span class="cm">/* CID-specific fields. */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>

	<span class="cm">/* Valid revision range */</span>
	<span class="n">u64</span> <span class="n">rev_start</span><span class="p">,</span> <span class="n">rev_end</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">manfid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">oemid</span><span class="p">;</span>

	<span class="cm">/* SDIO-specfic fields. You can use SDIO_ANY_ID here of course */</span>
	<span class="n">u16</span> <span class="n">cis_vendor</span><span class="p">,</span> <span class="n">cis_device</span><span class="p">;</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">vendor_fixup</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">data</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define CID_MANFID_ANY (-1u)</span>
<span class="cp">#define CID_OEMID_ANY ((unsigned short) -1)</span>
<span class="cp">#define CID_NAME_ANY (NULL)</span>

<span class="cp">#define END_FIXUP { 0 }</span>

<span class="cp">#define _FIXUP_EXT(_name, _manfid, _oemid, _rev_start, _rev_end,	\</span>
<span class="cp">		   _cis_vendor, _cis_device,				\</span>
<span class="cp">		   _fixup, _data)					\</span>
<span class="cp">	{						   \</span>
<span class="cp">		.name = (_name),			   \</span>
<span class="cp">		.manfid = (_manfid),			   \</span>
<span class="cp">		.oemid = (_oemid),			   \</span>
<span class="cp">		.rev_start = (_rev_start),		   \</span>
<span class="cp">		.rev_end = (_rev_end),			   \</span>
<span class="cp">		.cis_vendor = (_cis_vendor),		   \</span>
<span class="cp">		.cis_device = (_cis_device),		   \</span>
<span class="cp">		.vendor_fixup = (_fixup),		   \</span>
<span class="cp">		.data = (_data),			   \</span>
<span class="cp">	 }</span>

<span class="cp">#define MMC_FIXUP_REV(_name, _manfid, _oemid, _rev_start, _rev_end,	\</span>
<span class="cp">		      _fixup, _data)					\</span>
<span class="cp">	_FIXUP_EXT(_name, _manfid,					\</span>
<span class="cp">		   _oemid, _rev_start, _rev_end,			\</span>
<span class="cp">		   SDIO_ANY_ID, SDIO_ANY_ID,				\</span>
<span class="cp">		   _fixup, _data)					\</span>

<span class="cp">#define MMC_FIXUP(_name, _manfid, _oemid, _fixup, _data) \</span>
<span class="cp">	MMC_FIXUP_REV(_name, _manfid, _oemid, 0, -1ull, _fixup, _data)</span>

<span class="cp">#define SDIO_FIXUP(_vendor, _device, _fixup, _data)			\</span>
<span class="cp">	_FIXUP_EXT(CID_NAME_ANY, CID_MANFID_ANY,			\</span>
<span class="cp">		    CID_OEMID_ANY, 0, -1ull,				\</span>
<span class="cp">		   _vendor, _device,					\</span>
<span class="cp">		   _fixup, _data)					\</span>

<span class="cp">#define cid_rev(hwrev, fwrev, year, month)	\</span>
<span class="cp">	(((u64) hwrev) &lt;&lt; 40 |                  \</span>
<span class="cp">	 ((u64) fwrev) &lt;&lt; 32 |                  \</span>
<span class="cp">	 ((u64) year) &lt;&lt; 16 |                   \</span>
<span class="cp">	 ((u64) month))</span>

<span class="cp">#define cid_rev_card(card)		  \</span>
<span class="cp">	cid_rev(card-&gt;cid.hwrev,	  \</span>
<span class="cp">		    card-&gt;cid.fwrev,      \</span>
<span class="cp">		    card-&gt;cid.year,	  \</span>
<span class="cp">		    card-&gt;cid.month)</span>

<span class="cm">/*</span>
<span class="cm"> * Unconditionally quirk add/remove.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__maybe_unused</span> <span class="nf">add_quirk</span><span class="p">(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">card</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">|=</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__maybe_unused</span> <span class="nf">remove_quirk</span><span class="p">(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">card</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define mmc_card_mmc(c)		((c)-&gt;type == MMC_TYPE_MMC)</span>
<span class="cp">#define mmc_card_sd(c)		((c)-&gt;type == MMC_TYPE_SD)</span>
<span class="cp">#define mmc_card_sdio(c)	((c)-&gt;type == MMC_TYPE_SDIO)</span>

<span class="cp">#define mmc_card_present(c)	((c)-&gt;state &amp; MMC_STATE_PRESENT)</span>
<span class="cp">#define mmc_card_readonly(c)	((c)-&gt;state &amp; MMC_STATE_READONLY)</span>
<span class="cp">#define mmc_card_highspeed(c)	((c)-&gt;state &amp; MMC_STATE_HIGHSPEED)</span>
<span class="cp">#define mmc_card_hs200(c)	((c)-&gt;state &amp; MMC_STATE_HIGHSPEED_200)</span>
<span class="cp">#define mmc_card_blockaddr(c)	((c)-&gt;state &amp; MMC_STATE_BLOCKADDR)</span>
<span class="cp">#define mmc_card_ddr_mode(c)	((c)-&gt;state &amp; MMC_STATE_HIGHSPEED_DDR)</span>
<span class="cp">#define mmc_card_uhs(c)		((c)-&gt;state &amp; MMC_STATE_ULTRAHIGHSPEED)</span>
<span class="cp">#define mmc_sd_card_uhs(c)	((c)-&gt;state &amp; MMC_STATE_ULTRAHIGHSPEED)</span>
<span class="cp">#define mmc_card_ext_capacity(c) ((c)-&gt;state &amp; MMC_CARD_SDXC)</span>
<span class="cp">#define mmc_card_removed(c)	((c) &amp;&amp; ((c)-&gt;state &amp; MMC_CARD_REMOVED))</span>
<span class="cp">#define mmc_card_is_sleep(c)	((c)-&gt;state &amp; MMC_STATE_SLEEP)</span>

<span class="cp">#define mmc_card_set_present(c)	((c)-&gt;state |= MMC_STATE_PRESENT)</span>
<span class="cp">#define mmc_card_set_readonly(c) ((c)-&gt;state |= MMC_STATE_READONLY)</span>
<span class="cp">#define mmc_card_set_highspeed(c) ((c)-&gt;state |= MMC_STATE_HIGHSPEED)</span>
<span class="cp">#define mmc_card_set_hs200(c)	((c)-&gt;state |= MMC_STATE_HIGHSPEED_200)</span>
<span class="cp">#define mmc_card_set_blockaddr(c) ((c)-&gt;state |= MMC_STATE_BLOCKADDR)</span>
<span class="cp">#define mmc_card_set_ddr_mode(c) ((c)-&gt;state |= MMC_STATE_HIGHSPEED_DDR)</span>
<span class="cp">#define mmc_card_set_uhs(c) ((c)-&gt;state |= MMC_STATE_ULTRAHIGHSPEED)</span>
<span class="cp">#define mmc_sd_card_set_uhs(c) ((c)-&gt;state |= MMC_STATE_ULTRAHIGHSPEED)</span>
<span class="cp">#define mmc_card_set_ext_capacity(c) ((c)-&gt;state |= MMC_CARD_SDXC)</span>
<span class="cp">#define mmc_card_set_removed(c) ((c)-&gt;state |= MMC_CARD_REMOVED)</span>
<span class="cp">#define mmc_card_set_sleep(c)	((c)-&gt;state |= MMC_STATE_SLEEP)</span>

<span class="cp">#define mmc_card_clr_sleep(c)	((c)-&gt;state &amp;= ~MMC_STATE_SLEEP)</span>
<span class="cm">/*</span>
<span class="cm"> * Quirk add/remove for MMC products.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__maybe_unused</span> <span class="nf">add_quirk_mmc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mmc_card_mmc</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>
		<span class="n">card</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">|=</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__maybe_unused</span> <span class="nf">remove_quirk_mmc</span><span class="p">(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span>
						   <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mmc_card_mmc</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>
		<span class="n">card</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Quirk add/remove for SD products.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__maybe_unused</span> <span class="nf">add_quirk_sd</span><span class="p">(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mmc_card_sd</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>
		<span class="n">card</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">|=</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__maybe_unused</span> <span class="nf">remove_quirk_sd</span><span class="p">(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span>
						   <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mmc_card_sd</span><span class="p">(</span><span class="n">card</span><span class="p">))</span>
		<span class="n">card</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mmc_card_lenient_fn0</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">MMC_QUIRK_LENIENT_FN0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mmc_blksz_for_byte_mode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">MMC_QUIRK_BLKSZ_FOR_BYTE_MODE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mmc_card_disable_cd</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">MMC_QUIRK_DISABLE_CD</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mmc_card_nonstd_func_interface</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">MMC_QUIRK_NONSTD_FUNC_IF</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mmc_card_broken_byte_mode_512</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">MMC_QUIRK_BROKEN_BYTE_MODE_512</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">mmc_card_long_read_time</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">MMC_QUIRK_LONG_READ_TIME</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define mmc_card_name(c)	((c)-&gt;cid.prod_name)</span>
<span class="cp">#define mmc_card_id(c)		(dev_name(&amp;(c)-&gt;dev))</span>

<span class="cp">#define mmc_dev_to_card(d)	container_of(d, struct mmc_card, dev)</span>

<span class="cp">#define mmc_list_to_card(l)	container_of(l, struct mmc_card, node)</span>
<span class="cp">#define mmc_get_drvdata(c)	dev_get_drvdata(&amp;(c)-&gt;dev)</span>
<span class="cp">#define mmc_set_drvdata(c,d)	dev_set_drvdata(&amp;(c)-&gt;dev, d)</span>

<span class="cm">/*</span>
<span class="cm"> * MMC device driver (e.g., Flash card, I/O card...)</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">mmc_driver</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">device_driver</span> <span class="n">drv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">probe</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">remove</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">suspend</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">resume</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">mmc_register_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">mmc_driver</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mmc_unregister_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">mmc_driver</span> <span class="o">*</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">mmc_fixup_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">mmc_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span>
			     <span class="k">const</span> <span class="k">struct</span> <span class="n">mmc_fixup</span> <span class="o">*</span><span class="n">table</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* LINUX_MMC_CARD_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
