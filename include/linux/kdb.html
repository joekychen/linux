<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › kdb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>kdb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _KDB_H</span>
<span class="cp">#define _KDB_H</span>

<span class="cm">/*</span>
<span class="cm"> * Kernel Debugger Architecture Independent Global Headers</span>
<span class="cm"> *</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2000-2007 Silicon Graphics, Inc.  All Rights Reserved.</span>
<span class="cm"> * Copyright (C) 2000 Stephane Eranian &lt;eranian@hpl.hp.com&gt;</span>
<span class="cm"> * Copyright (C) 2009 Jason Wessel &lt;jason.wessel@windriver.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifdef	CONFIG_KGDB_KDB</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/atomic.h&gt;</span>

<span class="cp">#define KDB_POLL_FUNC_MAX	5</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kdb_poll_idx</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * kdb_initial_cpu is initialized to -1, and is set to the cpu</span>
<span class="cm"> * number whenever the kernel debugger is entered.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kdb_initial_cpu</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">atomic_t</span> <span class="n">kdb_event</span><span class="p">;</span>

<span class="cm">/* Types and messages used for dynamically added kdb shell commands */</span>

<span class="cp">#define KDB_MAXARGS    16 </span><span class="cm">/* Maximum number of arguments to a function  */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">KDB_REPEAT_NONE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* Do not repeat this command */</span>
	<span class="n">KDB_REPEAT_NO_ARGS</span><span class="p">,</span>	<span class="cm">/* Repeat the command without arguments */</span>
	<span class="n">KDB_REPEAT_WITH_ARGS</span><span class="p">,</span>	<span class="cm">/* Repeat the command including its arguments */</span>
<span class="p">}</span> <span class="n">kdb_repeat_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">kdb_func_t</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="p">);</span>

<span class="cm">/* KDB return codes from a command or internal kdb function */</span>
<span class="cp">#define KDB_NOTFOUND	(-1)</span>
<span class="cp">#define KDB_ARGCOUNT	(-2)</span>
<span class="cp">#define KDB_BADWIDTH	(-3)</span>
<span class="cp">#define KDB_BADRADIX	(-4)</span>
<span class="cp">#define KDB_NOTENV	(-5)</span>
<span class="cp">#define KDB_NOENVVALUE	(-6)</span>
<span class="cp">#define KDB_NOTIMP	(-7)</span>
<span class="cp">#define KDB_ENVFULL	(-8)</span>
<span class="cp">#define KDB_ENVBUFFULL	(-9)</span>
<span class="cp">#define KDB_TOOMANYBPT	(-10)</span>
<span class="cp">#define KDB_TOOMANYDBREGS (-11)</span>
<span class="cp">#define KDB_DUPBPT	(-12)</span>
<span class="cp">#define KDB_BPTNOTFOUND	(-13)</span>
<span class="cp">#define KDB_BADMODE	(-14)</span>
<span class="cp">#define KDB_BADINT	(-15)</span>
<span class="cp">#define KDB_INVADDRFMT  (-16)</span>
<span class="cp">#define KDB_BADREG      (-17)</span>
<span class="cp">#define KDB_BADCPUNUM   (-18)</span>
<span class="cp">#define KDB_BADLENGTH	(-19)</span>
<span class="cp">#define KDB_NOBP	(-20)</span>
<span class="cp">#define KDB_BADADDR	(-21)</span>

<span class="cm">/*</span>
<span class="cm"> * kdb_diemsg</span>
<span class="cm"> *</span>
<span class="cm"> *	Contains a pointer to the last string supplied to the</span>
<span class="cm"> *	kernel &#39;die&#39; panic function.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kdb_diemsg</span><span class="p">;</span>

<span class="cp">#define KDB_FLAG_EARLYKDB	(1 &lt;&lt; 0) </span><span class="cm">/* set from boot parameter kdb=early */</span><span class="cp"></span>
<span class="cp">#define KDB_FLAG_CATASTROPHIC	(1 &lt;&lt; 1) </span><span class="cm">/* A catastrophic event has occurred */</span><span class="cp"></span>
<span class="cp">#define KDB_FLAG_CMD_INTERRUPT	(1 &lt;&lt; 2) </span><span class="cm">/* Previous command was interrupted */</span><span class="cp"></span>
<span class="cp">#define KDB_FLAG_NOIPI		(1 &lt;&lt; 3) </span><span class="cm">/* Do not send IPIs */</span><span class="cp"></span>
<span class="cp">#define KDB_FLAG_ONLY_DO_DUMP	(1 &lt;&lt; 4) </span><span class="cm">/* Only do a dump, used when</span>
<span class="cm">					  * kdb is off */</span><span class="cp"></span>
<span class="cp">#define KDB_FLAG_NO_CONSOLE	(1 &lt;&lt; 5) </span><span class="cm">/* No console is available,</span>
<span class="cm">					  * kdb is disabled */</span><span class="cp"></span>
<span class="cp">#define KDB_FLAG_NO_VT_CONSOLE	(1 &lt;&lt; 6) </span><span class="cm">/* No VT console is available, do</span>
<span class="cm">					  * not use keyboard */</span><span class="cp"></span>
<span class="cp">#define KDB_FLAG_NO_I8042	(1 &lt;&lt; 7) </span><span class="cm">/* No i8042 chip is available, do</span>
<span class="cm">					  * not use keyboard */</span><span class="cp"></span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">kdb_flags</span><span class="p">;</span>	<span class="cm">/* Global flags, see kdb_state for per cpu state */</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">kdb_save_flags</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">kdb_restore_flags</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#define KDB_FLAG(flag)		(kdb_flags &amp; KDB_FLAG_##flag)</span>
<span class="cp">#define KDB_FLAG_SET(flag)	((void)(kdb_flags |= KDB_FLAG_##flag))</span>
<span class="cp">#define KDB_FLAG_CLEAR(flag)	((void)(kdb_flags &amp;= ~KDB_FLAG_##flag))</span>

<span class="cm">/*</span>
<span class="cm"> * External entry point for the kernel debugger.  The pt_regs</span>
<span class="cm"> * at the time of entry are supplied along with the reason for</span>
<span class="cm"> * entry to the kernel debugger.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">KDB_REASON_ENTER</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* KDB_ENTER() trap/fault - regs valid */</span>
	<span class="n">KDB_REASON_ENTER_SLAVE</span><span class="p">,</span>	<span class="cm">/* KDB_ENTER_SLAVE() trap/fault - regs valid */</span>
	<span class="n">KDB_REASON_BREAK</span><span class="p">,</span>	<span class="cm">/* Breakpoint inst. - regs valid */</span>
	<span class="n">KDB_REASON_DEBUG</span><span class="p">,</span>	<span class="cm">/* Debug Fault - regs valid */</span>
	<span class="n">KDB_REASON_OOPS</span><span class="p">,</span>	<span class="cm">/* Kernel Oops - regs valid */</span>
	<span class="n">KDB_REASON_SWITCH</span><span class="p">,</span>	<span class="cm">/* CPU switch - regs valid*/</span>
	<span class="n">KDB_REASON_KEYBOARD</span><span class="p">,</span>	<span class="cm">/* Keyboard entry - regs valid */</span>
	<span class="n">KDB_REASON_NMI</span><span class="p">,</span>		<span class="cm">/* Non-maskable interrupt; regs valid */</span>
	<span class="n">KDB_REASON_RECURSE</span><span class="p">,</span>	<span class="cm">/* Recursive entry to kdb;</span>
<span class="cm">				 * regs probably valid */</span>
	<span class="n">KDB_REASON_SSTEP</span><span class="p">,</span>	<span class="cm">/* Single Step trap. - regs valid */</span>
<span class="p">}</span> <span class="n">kdb_reason_t</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">kdb_trap_printk</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">__printf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="kt">int</span> <span class="n">vkdb_printf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="kt">va_list</span> <span class="n">args</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__printf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="kt">int</span> <span class="n">kdb_printf</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="p">...);</span>
<span class="k">typedef</span> <span class="n">__printf</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">kdb_printf_t</span><span class="p">)(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="p">...);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">kdb_init</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">);</span>

<span class="cm">/* Access to kdb specific polling devices */</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_char_func</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">get_char_func</span> <span class="n">kdb_poll_funcs</span><span class="p">[];</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kdb_get_kbd_char</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">kdb_process_cpu</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cpu</span> <span class="o">=</span> <span class="n">task_thread_info</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">cpu</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cpu</span> <span class="o">&gt;</span> <span class="n">num_possible_cpus</span><span class="p">())</span>
		<span class="n">cpu</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">cpu</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* kdb access to register set for stack dumping */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">kdb_current_regs</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_KALLSYMS</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kdb_walk_kallsyms</span><span class="p">(</span><span class="n">loff_t</span> <span class="o">*</span><span class="n">pos</span><span class="p">);</span>
<span class="cp">#else </span><span class="cm">/* ! CONFIG_KALLSYMS */</span><span class="cp"></span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">kdb_walk_kallsyms</span><span class="p">(</span><span class="n">loff_t</span> <span class="o">*</span><span class="n">pos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* ! CONFIG_KALLSYMS */</span><span class="cp"></span>

<span class="cm">/* Dynamic kdb shell command registration */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kdb_register</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="n">kdb_func_t</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">short</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kdb_register_repeat</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="n">kdb_func_t</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span>
			       <span class="kt">short</span><span class="p">,</span> <span class="n">kdb_repeat_t</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kdb_unregister</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="cp">#else </span><span class="cm">/* ! CONFIG_KGDB_KDB */</span><span class="cp"></span>
<span class="cp">#define kdb_printf(...)</span>
<span class="cp">#define kdb_init(x)</span>
<span class="cp">#define kdb_register(...)</span>
<span class="cp">#define kdb_register_repeat(...)</span>
<span class="cp">#define kdb_uregister(x)</span>
<span class="cp">#endif	</span><span class="cm">/* CONFIG_KGDB_KDB */</span><span class="cp"></span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">KDB_NOT_INITIALIZED</span><span class="p">,</span>
	<span class="n">KDB_INIT_EARLY</span><span class="p">,</span>
	<span class="n">KDB_INIT_FULL</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">kdbgetintenv</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kdb_set</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* !_KDB_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
