<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › rio_drv.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>rio_drv.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * RapidIO driver services</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2005 MontaVista Software, Inc.</span>
<span class="cm"> * Matt Porter &lt;mporter@kernel.crashing.org&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute  it and/or modify it</span>
<span class="cm"> * under  the terms of  the GNU General  Public License as published by the</span>
<span class="cm"> * Free Software Foundation;  either version 2 of the  License, or (at your</span>
<span class="cm"> * option) any later version.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef LINUX_RIO_DRV_H</span>
<span class="cp">#define LINUX_RIO_DRV_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/ioport.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/rio.h&gt;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">__rio_local_read_config_32</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				      <span class="n">u32</span> <span class="o">*</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">__rio_local_write_config_32</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				       <span class="n">u32</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">__rio_local_read_config_16</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				      <span class="n">u16</span> <span class="o">*</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">__rio_local_write_config_16</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				       <span class="n">u16</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">__rio_local_read_config_8</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				     <span class="n">u8</span> <span class="o">*</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">__rio_local_write_config_8</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				      <span class="n">u8</span> <span class="n">data</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_mport_read_config_32</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u16</span> <span class="n">destid</span><span class="p">,</span>
				    <span class="n">u8</span> <span class="n">hopcount</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_mport_write_config_32</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u16</span> <span class="n">destid</span><span class="p">,</span>
				     <span class="n">u8</span> <span class="n">hopcount</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u32</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_mport_read_config_16</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u16</span> <span class="n">destid</span><span class="p">,</span>
				    <span class="n">u8</span> <span class="n">hopcount</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_mport_write_config_16</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u16</span> <span class="n">destid</span><span class="p">,</span>
				     <span class="n">u8</span> <span class="n">hopcount</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u16</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_mport_read_config_8</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u16</span> <span class="n">destid</span><span class="p">,</span>
				   <span class="n">u8</span> <span class="n">hopcount</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_mport_write_config_8</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u16</span> <span class="n">destid</span><span class="p">,</span>
				    <span class="n">u8</span> <span class="n">hopcount</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u8</span> <span class="n">data</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * rio_local_read_config_32 - Read 32 bits from local configuration space</span>
<span class="cm"> * @port: Master port</span>
<span class="cm"> * @offset: Offset into local configuration space</span>
<span class="cm"> * @data: Pointer to read data into</span>
<span class="cm"> *</span>
<span class="cm"> * Reads 32 bits of data from the specified offset within the local</span>
<span class="cm"> * device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_local_read_config_32</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
					   <span class="n">u32</span> <span class="o">*</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__rio_local_read_config_32</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rio_local_write_config_32 - Write 32 bits to local configuration space</span>
<span class="cm"> * @port: Master port</span>
<span class="cm"> * @offset: Offset into local configuration space</span>
<span class="cm"> * @data: Data to be written</span>
<span class="cm"> *</span>
<span class="cm"> * Writes 32 bits of data to the specified offset within the local</span>
<span class="cm"> * device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_local_write_config_32</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
					    <span class="n">u32</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__rio_local_write_config_32</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rio_local_read_config_16 - Read 16 bits from local configuration space</span>
<span class="cm"> * @port: Master port</span>
<span class="cm"> * @offset: Offset into local configuration space</span>
<span class="cm"> * @data: Pointer to read data into</span>
<span class="cm"> *</span>
<span class="cm"> * Reads 16 bits of data from the specified offset within the local</span>
<span class="cm"> * device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_local_read_config_16</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
					   <span class="n">u16</span> <span class="o">*</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__rio_local_read_config_16</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rio_local_write_config_16 - Write 16 bits to local configuration space</span>
<span class="cm"> * @port: Master port</span>
<span class="cm"> * @offset: Offset into local configuration space</span>
<span class="cm"> * @data: Data to be written</span>
<span class="cm"> *</span>
<span class="cm"> * Writes 16 bits of data to the specified offset within the local</span>
<span class="cm"> * device&#39;s configuration space.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_local_write_config_16</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
					    <span class="n">u16</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__rio_local_write_config_16</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rio_local_read_config_8 - Read 8 bits from local configuration space</span>
<span class="cm"> * @port: Master port</span>
<span class="cm"> * @offset: Offset into local configuration space</span>
<span class="cm"> * @data: Pointer to read data into</span>
<span class="cm"> *</span>
<span class="cm"> * Reads 8 bits of data from the specified offset within the local</span>
<span class="cm"> * device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_local_read_config_8</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
					  <span class="n">u8</span> <span class="o">*</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__rio_local_read_config_8</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rio_local_write_config_8 - Write 8 bits to local configuration space</span>
<span class="cm"> * @port: Master port</span>
<span class="cm"> * @offset: Offset into local configuration space</span>
<span class="cm"> * @data: Data to be written</span>
<span class="cm"> *</span>
<span class="cm"> * Writes 8 bits of data to the specified offset within the local</span>
<span class="cm"> * device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_local_write_config_8</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
					   <span class="n">u8</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__rio_local_write_config_8</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rio_read_config_32 - Read 32 bits from configuration space</span>
<span class="cm"> * @rdev: RIO device</span>
<span class="cm"> * @offset: Offset into device configuration space</span>
<span class="cm"> * @data: Pointer to read data into</span>
<span class="cm"> *</span>
<span class="cm"> * Reads 32 bits of data from the specified offset within the</span>
<span class="cm"> * RIO device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_read_config_32</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				     <span class="n">u32</span> <span class="o">*</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">rio_mport_read_config_32</span><span class="p">(</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">hport</span><span class="p">,</span> <span class="n">rdev</span><span class="o">-&gt;</span><span class="n">destid</span><span class="p">,</span>
					<span class="n">rdev</span><span class="o">-&gt;</span><span class="n">hopcount</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * rio_write_config_32 - Write 32 bits to configuration space</span>
<span class="cm"> * @rdev: RIO device</span>
<span class="cm"> * @offset: Offset into device configuration space</span>
<span class="cm"> * @data: Data to be written</span>
<span class="cm"> *</span>
<span class="cm"> * Writes 32 bits of data to the specified offset within the</span>
<span class="cm"> * RIO device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_write_config_32</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				      <span class="n">u32</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">rio_mport_write_config_32</span><span class="p">(</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">hport</span><span class="p">,</span> <span class="n">rdev</span><span class="o">-&gt;</span><span class="n">destid</span><span class="p">,</span>
					 <span class="n">rdev</span><span class="o">-&gt;</span><span class="n">hopcount</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * rio_read_config_16 - Read 16 bits from configuration space</span>
<span class="cm"> * @rdev: RIO device</span>
<span class="cm"> * @offset: Offset into device configuration space</span>
<span class="cm"> * @data: Pointer to read data into</span>
<span class="cm"> *</span>
<span class="cm"> * Reads 16 bits of data from the specified offset within the</span>
<span class="cm"> * RIO device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_read_config_16</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				     <span class="n">u16</span> <span class="o">*</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">rio_mport_read_config_16</span><span class="p">(</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">hport</span><span class="p">,</span> <span class="n">rdev</span><span class="o">-&gt;</span><span class="n">destid</span><span class="p">,</span>
					<span class="n">rdev</span><span class="o">-&gt;</span><span class="n">hopcount</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * rio_write_config_16 - Write 16 bits to configuration space</span>
<span class="cm"> * @rdev: RIO device</span>
<span class="cm"> * @offset: Offset into device configuration space</span>
<span class="cm"> * @data: Data to be written</span>
<span class="cm"> *</span>
<span class="cm"> * Writes 16 bits of data to the specified offset within the</span>
<span class="cm"> * RIO device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_write_config_16</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span>
				      <span class="n">u16</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">rio_mport_write_config_16</span><span class="p">(</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">hport</span><span class="p">,</span> <span class="n">rdev</span><span class="o">-&gt;</span><span class="n">destid</span><span class="p">,</span>
					 <span class="n">rdev</span><span class="o">-&gt;</span><span class="n">hopcount</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * rio_read_config_8 - Read 8 bits from configuration space</span>
<span class="cm"> * @rdev: RIO device</span>
<span class="cm"> * @offset: Offset into device configuration space</span>
<span class="cm"> * @data: Pointer to read data into</span>
<span class="cm"> *</span>
<span class="cm"> * Reads 8 bits of data from the specified offset within the</span>
<span class="cm"> * RIO device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_read_config_8</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">rio_mport_read_config_8</span><span class="p">(</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">hport</span><span class="p">,</span> <span class="n">rdev</span><span class="o">-&gt;</span><span class="n">destid</span><span class="p">,</span>
				       <span class="n">rdev</span><span class="o">-&gt;</span><span class="n">hopcount</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * rio_write_config_8 - Write 8 bits to configuration space</span>
<span class="cm"> * @rdev: RIO device</span>
<span class="cm"> * @offset: Offset into device configuration space</span>
<span class="cm"> * @data: Data to be written</span>
<span class="cm"> *</span>
<span class="cm"> * Writes 8 bits of data to the specified offset within the</span>
<span class="cm"> * RIO device&#39;s configuration space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_write_config_8</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">offset</span><span class="p">,</span> <span class="n">u8</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">rio_mport_write_config_8</span><span class="p">(</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">hport</span><span class="p">,</span> <span class="n">rdev</span><span class="o">-&gt;</span><span class="n">destid</span><span class="p">,</span>
					<span class="n">rdev</span><span class="o">-&gt;</span><span class="n">hopcount</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_mport_send_doorbell</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">mport</span><span class="p">,</span> <span class="n">u16</span> <span class="n">destid</span><span class="p">,</span>
				   <span class="n">u16</span> <span class="n">data</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * rio_send_doorbell - Send a doorbell message to a device</span>
<span class="cm"> * @rdev: RIO device</span>
<span class="cm"> * @data: Doorbell message data</span>
<span class="cm"> *</span>
<span class="cm"> * Send a doorbell message to a RIO device. The doorbell message</span>
<span class="cm"> * has a 16-bit info field provided by the @data argument.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_send_doorbell</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">rio_mport_send_doorbell</span><span class="p">(</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">net</span><span class="o">-&gt;</span><span class="n">hport</span><span class="p">,</span> <span class="n">rdev</span><span class="o">-&gt;</span><span class="n">destid</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * rio_init_mbox_res - Initialize a RIO mailbox resource</span>
<span class="cm"> * @res: resource struct</span>
<span class="cm"> * @start: start of mailbox range</span>
<span class="cm"> * @end: end of mailbox range</span>
<span class="cm"> *</span>
<span class="cm"> * This function is used to initialize the fields of a resource</span>
<span class="cm"> * for use as a mailbox resource.  It initializes a range of</span>
<span class="cm"> * mailboxes using the start and end arguments.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rio_init_mbox_res</span><span class="p">(</span><span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">res</span><span class="p">,</span> <span class="kt">int</span> <span class="n">start</span><span class="p">,</span> <span class="kt">int</span> <span class="n">end</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">resource</span><span class="p">));</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">=</span> <span class="n">RIO_RESOURCE_MAILBOX</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rio_init_dbell_res - Initialize a RIO doorbell resource</span>
<span class="cm"> * @res: resource struct</span>
<span class="cm"> * @start: start of doorbell range</span>
<span class="cm"> * @end: end of doorbell range</span>
<span class="cm"> *</span>
<span class="cm"> * This function is used to initialize the fields of a resource</span>
<span class="cm"> * for use as a doorbell resource.  It initializes a range of</span>
<span class="cm"> * doorbell messages using the start and end arguments.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rio_init_dbell_res</span><span class="p">(</span><span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">res</span><span class="p">,</span> <span class="n">u16</span> <span class="n">start</span><span class="p">,</span> <span class="n">u16</span> <span class="n">end</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">resource</span><span class="p">));</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">start</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">=</span> <span class="n">end</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">=</span> <span class="n">RIO_RESOURCE_DOORBELL</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * RIO_DEVICE - macro used to describe a specific RIO device</span>
<span class="cm"> * @dev: the 16 bit RIO device ID</span>
<span class="cm"> * @ven: the 16 bit RIO vendor ID</span>
<span class="cm"> *</span>
<span class="cm"> * This macro is used to create a struct rio_device_id that matches a</span>
<span class="cm"> * specific device.  The assembly vendor and assembly device fields</span>
<span class="cm"> * will be set to %RIO_ANY_ID.</span>
<span class="cm"> */</span>
<span class="cp">#define RIO_DEVICE(dev,ven) \</span>
<span class="cp">	.did = (dev), .vid = (ven), \</span>
<span class="cp">	.asm_did = RIO_ANY_ID, .asm_vid = RIO_ANY_ID</span>

<span class="cm">/* Mailbox management */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_request_outb_mbox</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span>
				 <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">));</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_release_outb_mbox</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * rio_add_outb_message - Add RIO message to an outbound mailbox queue</span>
<span class="cm"> * @mport: RIO master port containing the outbound queue</span>
<span class="cm"> * @rdev: RIO device the message is be sent to</span>
<span class="cm"> * @mbox: The outbound mailbox queue</span>
<span class="cm"> * @buffer: Pointer to the message buffer</span>
<span class="cm"> * @len: Length of the message buffer</span>
<span class="cm"> *</span>
<span class="cm"> * Adds a RIO message buffer to an outbound mailbox queue for</span>
<span class="cm"> * transmission. Returns 0 on success.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_add_outb_message</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">mport</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mbox</span><span class="p">,</span>
				       <span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">mport</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">add_outb_message</span><span class="p">(</span><span class="n">mport</span><span class="p">,</span> <span class="n">rdev</span><span class="p">,</span> <span class="n">mbox</span><span class="p">,</span>
						   <span class="n">buffer</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_request_inb_mbox</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span>
				<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">));</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_release_inb_mbox</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * rio_add_inb_buffer - Add buffer to an inbound mailbox queue</span>
<span class="cm"> * @mport: Master port containing the inbound mailbox</span>
<span class="cm"> * @mbox: The inbound mailbox number</span>
<span class="cm"> * @buffer: Pointer to the message buffer</span>
<span class="cm"> *</span>
<span class="cm"> * Adds a buffer to an inbound mailbox queue for reception. Returns</span>
<span class="cm"> * 0 on success.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rio_add_inb_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">mport</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mbox</span><span class="p">,</span>
				     <span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">mport</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">add_inb_buffer</span><span class="p">(</span><span class="n">mport</span><span class="p">,</span> <span class="n">mbox</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rio_get_inb_message - Get A RIO message from an inbound mailbox queue</span>
<span class="cm"> * @mport: Master port containing the inbound mailbox</span>
<span class="cm"> * @mbox: The inbound mailbox number</span>
<span class="cm"> *</span>
<span class="cm"> * Get a RIO message from an inbound mailbox queue. Returns 0 on success.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">rio_get_inb_message</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">mport</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mbox</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">mport</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">get_inb_message</span><span class="p">(</span><span class="n">mport</span><span class="p">,</span> <span class="n">mbox</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Doorbell management */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_request_inb_dbell</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">u16</span><span class="p">,</span> <span class="n">u16</span><span class="p">,</span>
				 <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">u16</span><span class="p">,</span> <span class="n">u16</span><span class="p">,</span> <span class="n">u16</span><span class="p">));</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_release_inb_dbell</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="p">,</span> <span class="n">u16</span><span class="p">,</span> <span class="n">u16</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">rio_request_outb_dbell</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">,</span> <span class="n">u16</span><span class="p">,</span> <span class="n">u16</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_release_outb_dbell</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="p">);</span>

<span class="cm">/* Memory region management */</span>
<span class="kt">int</span> <span class="n">rio_claim_resource</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">rio_request_regions</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">rio_release_regions</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">rio_request_region</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">rio_release_region</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

<span class="cm">/* Port-Write management */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_request_inb_pwrite</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">,</span>
			<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">,</span> <span class="k">union</span> <span class="n">rio_pw_msg</span><span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">));</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_release_inb_pwrite</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rio_inb_pwrite_handler</span><span class="p">(</span><span class="k">union</span> <span class="n">rio_pw_msg</span> <span class="o">*</span><span class="n">pw_msg</span><span class="p">);</span>

<span class="cm">/* LDM support */</span>
<span class="kt">int</span> <span class="n">rio_register_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_driver</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">rio_unregister_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_driver</span> <span class="o">*</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rio_dev_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">rio_dev_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_RAPIDIO_DMA_ENGINE</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">dma_chan</span> <span class="o">*</span><span class="n">rio_request_dma</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">rio_release_dma</span><span class="p">(</span><span class="k">struct</span> <span class="n">dma_chan</span> <span class="o">*</span><span class="n">dchan</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">dma_async_tx_descriptor</span> <span class="o">*</span><span class="n">rio_dma_prep_slave_sg</span><span class="p">(</span>
		<span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dma_chan</span> <span class="o">*</span><span class="n">dchan</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">rio_dma_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
		<span class="k">enum</span> <span class="n">dma_transfer_direction</span> <span class="n">direction</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cm">/**</span>
<span class="cm"> * rio_name - Get the unique RIO device identifier</span>
<span class="cm"> * @rdev: RIO device</span>
<span class="cm"> *</span>
<span class="cm"> * Get the unique RIO device identifier. Returns the device</span>
<span class="cm"> * identifier string.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">rio_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rio_get_drvdata - Get RIO driver specific data</span>
<span class="cm"> * @rdev: RIO device</span>
<span class="cm"> *</span>
<span class="cm"> * Get RIO driver specific data. Returns a pointer to the</span>
<span class="cm"> * driver specific data.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">rio_get_drvdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dev_get_drvdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rio_set_drvdata - Set RIO driver specific data</span>
<span class="cm"> * @rdev: RIO device</span>
<span class="cm"> * @data: Pointer to driver specific data</span>
<span class="cm"> *</span>
<span class="cm"> * Set RIO driver specific data. device struct driver data pointer</span>
<span class="cm"> * is set to the @data argument.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rio_set_drvdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rdev</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dev_set_drvdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Misc driver helpers */</span>
<span class="k">extern</span> <span class="n">u16</span> <span class="n">rio_local_get_device_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">rio_mport</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rio_get_device</span><span class="p">(</span><span class="n">u16</span> <span class="n">vid</span><span class="p">,</span> <span class="n">u16</span> <span class="n">did</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">from</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">rio_get_asm</span><span class="p">(</span><span class="n">u16</span> <span class="n">vid</span><span class="p">,</span> <span class="n">u16</span> <span class="n">did</span><span class="p">,</span> <span class="n">u16</span> <span class="n">asm_vid</span><span class="p">,</span> <span class="n">u16</span> <span class="n">asm_did</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">rio_dev</span> <span class="o">*</span><span class="n">from</span><span class="p">);</span>

<span class="cp">#endif				</span><span class="cm">/* LINUX_RIO_DRV_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
