<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › ac97_codec.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>ac97_codec.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _AC97_CODEC_H_</span>
<span class="cp">#define _AC97_CODEC_H_</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/soundcard.h&gt;</span>

<span class="cm">/* AC97 1.0 */</span>
<span class="cp">#define  AC97_RESET               0x0000      </span><span class="c1">//</span>
<span class="cp">#define  AC97_MASTER_VOL_STEREO   0x0002      </span><span class="c1">// Line Out</span>
<span class="cp">#define  AC97_HEADPHONE_VOL       0x0004      </span><span class="c1">// </span>
<span class="cp">#define  AC97_MASTER_VOL_MONO     0x0006      </span><span class="c1">// TAD Output</span>
<span class="cp">#define  AC97_MASTER_TONE         0x0008      </span><span class="c1">//</span>
<span class="cp">#define  AC97_PCBEEP_VOL          0x000a      </span><span class="c1">// none</span>
<span class="cp">#define  AC97_PHONE_VOL           0x000c      </span><span class="c1">// TAD Input (mono)</span>
<span class="cp">#define  AC97_MIC_VOL             0x000e      </span><span class="c1">// MIC Input (mono)</span>
<span class="cp">#define  AC97_LINEIN_VOL          0x0010      </span><span class="c1">// Line Input (stereo)</span>
<span class="cp">#define  AC97_CD_VOL              0x0012      </span><span class="c1">// CD Input (stereo)</span>
<span class="cp">#define  AC97_VIDEO_VOL           0x0014      </span><span class="c1">// none</span>
<span class="cp">#define  AC97_AUX_VOL             0x0016      </span><span class="c1">// Aux Input (stereo)</span>
<span class="cp">#define  AC97_PCMOUT_VOL          0x0018      </span><span class="c1">// Wave Output (stereo)</span>
<span class="cp">#define  AC97_RECORD_SELECT       0x001a      </span><span class="c1">//</span>
<span class="cp">#define  AC97_RECORD_GAIN         0x001c</span>
<span class="cp">#define  AC97_RECORD_GAIN_MIC     0x001e</span>
<span class="cp">#define  AC97_GENERAL_PURPOSE     0x0020</span>
<span class="cp">#define  AC97_3D_CONTROL          0x0022</span>
<span class="cp">#define  AC97_MODEM_RATE          0x0024</span>
<span class="cp">#define  AC97_POWER_CONTROL       0x0026</span>

<span class="cm">/* AC&#39;97 2.0 */</span>
<span class="cp">#define AC97_EXTENDED_ID          0x0028       </span><span class="cm">/* Extended Audio ID */</span><span class="cp"></span>
<span class="cp">#define AC97_EXTENDED_STATUS      0x002A       </span><span class="cm">/* Extended Audio Status */</span><span class="cp"></span>
<span class="cp">#define AC97_PCM_FRONT_DAC_RATE   0x002C       </span><span class="cm">/* PCM Front DAC Rate */</span><span class="cp"></span>
<span class="cp">#define AC97_PCM_SURR_DAC_RATE    0x002E       </span><span class="cm">/* PCM Surround DAC Rate */</span><span class="cp"></span>
<span class="cp">#define AC97_PCM_LFE_DAC_RATE     0x0030       </span><span class="cm">/* PCM LFE DAC Rate */</span><span class="cp"></span>
<span class="cp">#define AC97_PCM_LR_ADC_RATE      0x0032       </span><span class="cm">/* PCM LR ADC Rate */</span><span class="cp"></span>
<span class="cp">#define AC97_PCM_MIC_ADC_RATE     0x0034       </span><span class="cm">/* PCM MIC ADC Rate */</span><span class="cp"></span>
<span class="cp">#define AC97_CENTER_LFE_MASTER    0x0036       </span><span class="cm">/* Center + LFE Master Volume */</span><span class="cp"></span>
<span class="cp">#define AC97_SURROUND_MASTER      0x0038       </span><span class="cm">/* Surround (Rear) Master Volume */</span><span class="cp"></span>
<span class="cp">#define AC97_RESERVED_3A          0x003A       </span><span class="cm">/* Reserved in AC &#39;97 &lt; 2.2 */</span><span class="cp"></span>

<span class="cm">/* AC&#39;97 2.2 */</span>
<span class="cp">#define AC97_SPDIF_CONTROL        0x003A       </span><span class="cm">/* S/PDIF Control */</span><span class="cp"></span>

<span class="cm">/* range 0x3c-0x58 - MODEM */</span>
<span class="cp">#define AC97_EXTENDED_MODEM_ID    0x003C</span>
<span class="cp">#define AC97_EXTEND_MODEM_STAT    0x003E</span>
<span class="cp">#define AC97_LINE1_RATE           0x0040</span>
<span class="cp">#define AC97_LINE2_RATE           0x0042</span>
<span class="cp">#define AC97_HANDSET_RATE         0x0044</span>
<span class="cp">#define AC97_LINE1_LEVEL          0x0046</span>
<span class="cp">#define AC97_LINE2_LEVEL          0x0048</span>
<span class="cp">#define AC97_HANDSET_LEVEL        0x004A</span>
<span class="cp">#define AC97_GPIO_CONFIG          0x004C</span>
<span class="cp">#define AC97_GPIO_POLARITY        0x004E</span>
<span class="cp">#define AC97_GPIO_STICKY          0x0050</span>
<span class="cp">#define AC97_GPIO_WAKE_UP         0x0052</span>
<span class="cp">#define AC97_GPIO_STATUS          0x0054</span>
<span class="cp">#define AC97_MISC_MODEM_STAT      0x0056</span>
<span class="cp">#define AC97_RESERVED_58          0x0058</span>

<span class="cm">/* registers 0x005a - 0x007a are vendor reserved */</span>

<span class="cp">#define AC97_VENDOR_ID1           0x007c</span>
<span class="cp">#define AC97_VENDOR_ID2           0x007e</span>

<span class="cm">/* volume control bit defines */</span>
<span class="cp">#define AC97_MUTE                 0x8000</span>
<span class="cp">#define AC97_MICBOOST             0x0040</span>
<span class="cp">#define AC97_LEFTVOL              0x3f00</span>
<span class="cp">#define AC97_RIGHTVOL             0x003f</span>

<span class="cm">/* record mux defines */</span>
<span class="cp">#define AC97_RECMUX_MIC           0x0000</span>
<span class="cp">#define AC97_RECMUX_CD            0x0101</span>
<span class="cp">#define AC97_RECMUX_VIDEO         0x0202</span>
<span class="cp">#define AC97_RECMUX_AUX           0x0303</span>
<span class="cp">#define AC97_RECMUX_LINE          0x0404</span>
<span class="cp">#define AC97_RECMUX_STEREO_MIX    0x0505</span>
<span class="cp">#define AC97_RECMUX_MONO_MIX      0x0606</span>
<span class="cp">#define AC97_RECMUX_PHONE         0x0707</span>

<span class="cm">/* general purpose register bit defines */</span>
<span class="cp">#define AC97_GP_LPBK              0x0080       </span><span class="cm">/* Loopback mode */</span><span class="cp"></span>
<span class="cp">#define AC97_GP_MS                0x0100       </span><span class="cm">/* Mic Select 0=Mic1, 1=Mic2 */</span><span class="cp"></span>
<span class="cp">#define AC97_GP_MIX               0x0200       </span><span class="cm">/* Mono output select 0=Mix, 1=Mic */</span><span class="cp"></span>
<span class="cp">#define AC97_GP_RLBK              0x0400       </span><span class="cm">/* Remote Loopback - Modem line codec */</span><span class="cp"></span>
<span class="cp">#define AC97_GP_LLBK              0x0800       </span><span class="cm">/* Local Loopback - Modem Line codec */</span><span class="cp"></span>
<span class="cp">#define AC97_GP_LD                0x1000       </span><span class="cm">/* Loudness 1=on */</span><span class="cp"></span>
<span class="cp">#define AC97_GP_3D                0x2000       </span><span class="cm">/* 3D Enhancement 1=on */</span><span class="cp"></span>
<span class="cp">#define AC97_GP_ST                0x4000       </span><span class="cm">/* Stereo Enhancement 1=on */</span><span class="cp"></span>
<span class="cp">#define AC97_GP_POP               0x8000       </span><span class="cm">/* Pcm Out Path, 0=pre 3D, 1=post 3D */</span><span class="cp"></span>

<span class="cm">/* extended audio status and control bit defines */</span>
<span class="cp">#define AC97_EA_VRA               0x0001       </span><span class="cm">/* Variable bit rate enable bit */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_DRA               0x0002       </span><span class="cm">/* Double-rate audio enable bit */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_SPDIF             0x0004       </span><span class="cm">/* S/PDIF Enable bit */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_VRM               0x0008       </span><span class="cm">/* Variable bit rate for MIC enable bit */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_CDAC              0x0040       </span><span class="cm">/* PCM Center DAC is ready (Read only) */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_SDAC              0x0040       </span><span class="cm">/* PCM Surround DACs are ready (Read only) */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_LDAC              0x0080       </span><span class="cm">/* PCM LFE DAC is ready (Read only) */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_MDAC              0x0100       </span><span class="cm">/* MIC ADC is ready (Read only) */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_SPCV              0x0400       </span><span class="cm">/* S/PDIF configuration valid (Read only) */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_PRI               0x0800       </span><span class="cm">/* Turns the PCM Center DAC off */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_PRJ               0x1000       </span><span class="cm">/* Turns the PCM Surround DACs off */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_PRK               0x2000       </span><span class="cm">/* Turns the PCM LFE DAC off */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_PRL               0x4000       </span><span class="cm">/* Turns the MIC ADC off */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_SLOT_MASK         0xffcf       </span><span class="cm">/* Mask for slot assignment bits */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_SPSA_3_4          0x0000       </span><span class="cm">/* Slot assigned to 3 &amp; 4 */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_SPSA_7_8          0x0010       </span><span class="cm">/* Slot assigned to 7 &amp; 8 */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_SPSA_6_9          0x0020       </span><span class="cm">/* Slot assigned to 6 &amp; 9 */</span><span class="cp"></span>
<span class="cp">#define AC97_EA_SPSA_10_11        0x0030       </span><span class="cm">/* Slot assigned to 10 &amp; 11 */</span><span class="cp"></span>

<span class="cm">/* S/PDIF control bit defines */</span>
<span class="cp">#define AC97_SC_PRO               0x0001       </span><span class="cm">/* Professional status */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_NAUDIO            0x0002       </span><span class="cm">/* Non audio stream */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_COPY              0x0004       </span><span class="cm">/* Copyright status */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_PRE               0x0008       </span><span class="cm">/* Preemphasis status */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_CC_MASK           0x07f0       </span><span class="cm">/* Category Code mask */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_L                 0x0800       </span><span class="cm">/* Generation Level status */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_SPSR_MASK         0xcfff       </span><span class="cm">/* S/PDIF Sample Rate bits */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_SPSR_44K          0x0000       </span><span class="cm">/* Use 44.1kHz Sample rate */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_SPSR_48K          0x2000       </span><span class="cm">/* Use 48kHz Sample rate */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_SPSR_32K          0x3000       </span><span class="cm">/* Use 32kHz Sample rate */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_DRS               0x4000       </span><span class="cm">/* Double Rate S/PDIF */</span><span class="cp"></span>
<span class="cp">#define AC97_SC_V                 0x8000       </span><span class="cm">/* Validity status */</span><span class="cp"></span>

<span class="cm">/* powerdown control and status bit defines */</span>

<span class="cm">/* status */</span>
<span class="cp">#define AC97_PWR_MDM              0x0010       </span><span class="cm">/* Modem section ready */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_REF              0x0008       </span><span class="cm">/* Vref nominal */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_ANL              0x0004       </span><span class="cm">/* Analog section ready */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_DAC              0x0002       </span><span class="cm">/* DAC section ready */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_ADC              0x0001       </span><span class="cm">/* ADC section ready */</span><span class="cp"></span>

<span class="cm">/* control */</span>
<span class="cp">#define AC97_PWR_PR0              0x0100       </span><span class="cm">/* ADC and Mux powerdown */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_PR1              0x0200       </span><span class="cm">/* DAC powerdown */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_PR2              0x0400       </span><span class="cm">/* Output mixer powerdown (Vref on) */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_PR3              0x0800       </span><span class="cm">/* Output mixer powerdown (Vref off) */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_PR4              0x1000       </span><span class="cm">/* AC-link powerdown */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_PR5              0x2000       </span><span class="cm">/* Internal Clk disable */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_PR6              0x4000       </span><span class="cm">/* HP amp powerdown */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_PR7              0x8000       </span><span class="cm">/* Modem off - if supported */</span><span class="cp"></span>

<span class="cm">/* extended audio ID register bit defines */</span>
<span class="cp">#define AC97_EXTID_VRA            0x0001</span>
<span class="cp">#define AC97_EXTID_DRA            0x0002</span>
<span class="cp">#define AC97_EXTID_SPDIF          0x0004</span>
<span class="cp">#define AC97_EXTID_VRM            0x0008</span>
<span class="cp">#define AC97_EXTID_DSA0           0x0010</span>
<span class="cp">#define AC97_EXTID_DSA1           0x0020</span>
<span class="cp">#define AC97_EXTID_CDAC           0x0040</span>
<span class="cp">#define AC97_EXTID_SDAC           0x0080</span>
<span class="cp">#define AC97_EXTID_LDAC           0x0100</span>
<span class="cp">#define AC97_EXTID_AMAP           0x0200</span>
<span class="cp">#define AC97_EXTID_REV0           0x0400</span>
<span class="cp">#define AC97_EXTID_REV1           0x0800</span>
<span class="cp">#define AC97_EXTID_ID0            0x4000</span>
<span class="cp">#define AC97_EXTID_ID1            0x8000</span>

<span class="cm">/* extended status register bit defines */</span>
<span class="cp">#define AC97_EXTSTAT_VRA          0x0001</span>
<span class="cp">#define AC97_EXTSTAT_DRA          0x0002</span>
<span class="cp">#define AC97_EXTSTAT_SPDIF        0x0004</span>
<span class="cp">#define AC97_EXTSTAT_VRM          0x0008</span>
<span class="cp">#define AC97_EXTSTAT_SPSA0        0x0010</span>
<span class="cp">#define AC97_EXTSTAT_SPSA1        0x0020</span>
<span class="cp">#define AC97_EXTSTAT_CDAC         0x0040</span>
<span class="cp">#define AC97_EXTSTAT_SDAC         0x0080</span>
<span class="cp">#define AC97_EXTSTAT_LDAC         0x0100</span>
<span class="cp">#define AC97_EXTSTAT_MADC         0x0200</span>
<span class="cp">#define AC97_EXTSTAT_SPCV         0x0400</span>
<span class="cp">#define AC97_EXTSTAT_PRI          0x0800</span>
<span class="cp">#define AC97_EXTSTAT_PRJ          0x1000</span>
<span class="cp">#define AC97_EXTSTAT_PRK          0x2000</span>
<span class="cp">#define AC97_EXTSTAT_PRL          0x4000</span>

<span class="cm">/* extended audio ID register bit defines */</span>
<span class="cp">#define AC97_EXTID_VRA            0x0001</span>
<span class="cp">#define AC97_EXTID_DRA            0x0002</span>
<span class="cp">#define AC97_EXTID_SPDIF          0x0004</span>
<span class="cp">#define AC97_EXTID_VRM            0x0008</span>
<span class="cp">#define AC97_EXTID_DSA0           0x0010</span>
<span class="cp">#define AC97_EXTID_DSA1           0x0020</span>
<span class="cp">#define AC97_EXTID_CDAC           0x0040</span>
<span class="cp">#define AC97_EXTID_SDAC           0x0080</span>
<span class="cp">#define AC97_EXTID_LDAC           0x0100</span>
<span class="cp">#define AC97_EXTID_AMAP           0x0200</span>
<span class="cp">#define AC97_EXTID_REV0           0x0400</span>
<span class="cp">#define AC97_EXTID_REV1           0x0800</span>
<span class="cp">#define AC97_EXTID_ID0            0x4000</span>
<span class="cp">#define AC97_EXTID_ID1            0x8000</span>

<span class="cm">/* extended status register bit defines */</span>
<span class="cp">#define AC97_EXTSTAT_VRA          0x0001</span>
<span class="cp">#define AC97_EXTSTAT_DRA          0x0002</span>
<span class="cp">#define AC97_EXTSTAT_SPDIF        0x0004</span>
<span class="cp">#define AC97_EXTSTAT_VRM          0x0008</span>
<span class="cp">#define AC97_EXTSTAT_SPSA0        0x0010</span>
<span class="cp">#define AC97_EXTSTAT_SPSA1        0x0020</span>
<span class="cp">#define AC97_EXTSTAT_CDAC         0x0040</span>
<span class="cp">#define AC97_EXTSTAT_SDAC         0x0080</span>
<span class="cp">#define AC97_EXTSTAT_LDAC         0x0100</span>
<span class="cp">#define AC97_EXTSTAT_MADC         0x0200</span>
<span class="cp">#define AC97_EXTSTAT_SPCV         0x0400</span>
<span class="cp">#define AC97_EXTSTAT_PRI          0x0800</span>
<span class="cp">#define AC97_EXTSTAT_PRJ          0x1000</span>
<span class="cp">#define AC97_EXTSTAT_PRK          0x2000</span>
<span class="cp">#define AC97_EXTSTAT_PRL          0x4000</span>

<span class="cm">/* useful power states */</span>
<span class="cp">#define AC97_PWR_D0               0x0000      </span><span class="cm">/* everything on */</span><span class="cp"></span>
<span class="cp">#define AC97_PWR_D1              AC97_PWR_PR0|AC97_PWR_PR1|AC97_PWR_PR4</span>
<span class="cp">#define AC97_PWR_D2              AC97_PWR_PR0|AC97_PWR_PR1|AC97_PWR_PR2|AC97_PWR_PR3|AC97_PWR_PR4</span>
<span class="cp">#define AC97_PWR_D3              AC97_PWR_PR0|AC97_PWR_PR1|AC97_PWR_PR2|AC97_PWR_PR3|AC97_PWR_PR4</span>
<span class="cp">#define AC97_PWR_ANLOFF          AC97_PWR_PR2|AC97_PWR_PR3  </span><span class="cm">/* analog section off */</span><span class="cp"></span>

<span class="cm">/* Total number of defined registers.  */</span>
<span class="cp">#define AC97_REG_CNT 64</span>


<span class="cm">/* OSS interface to the ac97s.. */</span>
<span class="cp">#define AC97_STEREO_MASK (SOUND_MASK_VOLUME|SOUND_MASK_PCM|\</span>
<span class="cp">	SOUND_MASK_LINE|SOUND_MASK_CD|\</span>
<span class="cp">	SOUND_MASK_ALTPCM|SOUND_MASK_IGAIN|\</span>
<span class="cp">	SOUND_MASK_LINE1|SOUND_MASK_VIDEO)</span>

<span class="cp">#define AC97_SUPPORTED_MASK (AC97_STEREO_MASK | \</span>
<span class="cp">	SOUND_MASK_BASS|SOUND_MASK_TREBLE|\</span>
<span class="cp">	SOUND_MASK_SPEAKER|SOUND_MASK_MIC|\</span>
<span class="cp">	SOUND_MASK_PHONEIN|SOUND_MASK_PHONEOUT)</span>

<span class="cp">#define AC97_RECORD_MASK (SOUND_MASK_MIC|\</span>
<span class="cp">	SOUND_MASK_CD|SOUND_MASK_IGAIN|SOUND_MASK_VIDEO|\</span>
<span class="cp">	SOUND_MASK_LINE1| SOUND_MASK_LINE|\</span>
<span class="cp">	SOUND_MASK_PHONEIN)</span>

<span class="cm">/* original check is not good enough in case FOO is greater than</span>
<span class="cm"> * SOUND_MIXER_NRDEVICES because the supported_mixers has exactly</span>
<span class="cm"> * SOUND_MIXER_NRDEVICES elements.</span>
<span class="cm"> * before matching the given mixer against the bitmask in supported_mixers we</span>
<span class="cm"> * check if mixer number exceeds maximum allowed size which is as mentioned</span>
<span class="cm"> * above SOUND_MIXER_NRDEVICES */</span>
<span class="cp">#define supported_mixer(CODEC,FOO) ((FOO &gt;= 0) &amp;&amp; \</span>
<span class="cp">                                    (FOO &lt; SOUND_MIXER_NRDEVICES) &amp;&amp; \</span>
<span class="cp">                                    (CODEC)-&gt;supported_mixers &amp; (1&lt;&lt;FOO) )</span>

<span class="k">struct</span> <span class="n">ac97_codec</span> <span class="p">{</span>
	<span class="cm">/* Linked list of codecs */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>

	<span class="cm">/* AC97 controller connected with */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">;</span>

	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dev_mixer</span><span class="p">;</span> 
	<span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">model</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">modem</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ac97_ops</span> <span class="o">*</span><span class="n">codec_ops</span><span class="p">;</span>

	<span class="cm">/* controller specific lower leverl ac97 accessing routines.</span>
<span class="cm">	   must be re-entrant safe */</span>
	<span class="n">u16</span>  <span class="p">(</span><span class="o">*</span><span class="n">codec_read</span><span class="p">)</span>  <span class="p">(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">codec_write</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">);</span>

	<span class="cm">/* Wait for codec-ready.  Ok to sleep here.  */</span>
	<span class="kt">void</span>  <span class="p">(</span><span class="o">*</span><span class="n">codec_wait</span><span class="p">)</span>  <span class="p">(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">);</span>

	<span class="cm">/* callback used by helper drivers for interesting ac97 setups */</span>
	<span class="kt">void</span>  <span class="p">(</span><span class="o">*</span><span class="n">codec_unregister</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">);</span>
	
	<span class="k">struct</span> <span class="n">ac97_driver</span> <span class="o">*</span><span class="n">driver</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">driver_private</span><span class="p">;</span>	<span class="cm">/* Private data for the driver */</span>
	
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	
	<span class="cm">/* OSS mixer masks */</span>
	<span class="kt">int</span> <span class="n">modcnt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">supported_mixers</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">stereo_mixers</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">record_sources</span><span class="p">;</span>

	<span class="cm">/* Property flags */</span>
	<span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">bit_resolution</span><span class="p">;</span>

	<span class="cm">/* OSS mixer interface */</span>
	<span class="kt">int</span>  <span class="p">(</span><span class="o">*</span><span class="n">read_mixer</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oss_channel</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">write_mixer</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">oss_channel</span><span class="p">,</span>
			    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">right</span><span class="p">);</span>
	<span class="kt">int</span>  <span class="p">(</span><span class="o">*</span><span class="n">recmask_io</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rw</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">);</span>
	<span class="kt">int</span>  <span class="p">(</span><span class="o">*</span><span class="n">mixer_ioctl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>

	<span class="cm">/* saved OSS mixer states */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mixer_state</span><span class="p">[</span><span class="n">SOUND_MIXER_NRDEVICES</span><span class="p">];</span>

	<span class="cm">/* Software Modem interface */</span>
	<span class="kt">int</span>  <span class="p">(</span><span class="o">*</span><span class="n">modem_ioctl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *	Operation structures for each known AC97 chip</span>
<span class="cm"> */</span>
 
<span class="k">struct</span> <span class="n">ac97_ops</span>
<span class="p">{</span>
	<span class="cm">/* Initialise */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">c</span><span class="p">);</span>
	<span class="cm">/* Amplifier control */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">amplifier</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">on</span><span class="p">);</span>
	<span class="cm">/* Digital mode control */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">digital</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slots</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">);</span>
<span class="cp">#define AUDIO_DIGITAL		0x8000</span>
<span class="cp">#define AUDIO_PRO		0x4000</span>
<span class="cp">#define AUDIO_DRS		0x2000</span>
<span class="cp">#define AUDIO_CCMASK		0x003F</span>
	
<span class="cp">#define AC97_DELUDED_MODEM	1	</span><span class="cm">/* Audio codec reports its a modem */</span><span class="cp"></span>
<span class="cp">#define AC97_NO_PCM_VOLUME	2	</span><span class="cm">/* Volume control is missing 	   */</span><span class="cp"></span>
<span class="cp">#define AC97_DEFAULT_POWER_OFF 4 </span><span class="cm">/* Needs warm reset to power up */</span><span class="cp"></span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ac97_probe_codec</span><span class="p">(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">ac97_alloc_codec</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ac97_release_codec</span><span class="p">(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">ac97_driver</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">codec_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">codec_mask</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">probe</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ac97_driver</span> <span class="o">*</span><span class="n">driver</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">remove</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ac97_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ac97_driver</span> <span class="o">*</span><span class="n">driver</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* quirk types */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">AC97_TUNE_DEFAULT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="cm">/* use default from quirk list (not valid in list) */</span>
	<span class="n">AC97_TUNE_NONE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>     <span class="cm">/* nothing extra to do */</span>
	<span class="n">AC97_TUNE_HP_ONLY</span><span class="p">,</span>      <span class="cm">/* headphone (true line-out) control as master only */</span>
	<span class="n">AC97_TUNE_SWAP_HP</span><span class="p">,</span>      <span class="cm">/* swap headphone and master controls */</span>
	<span class="n">AC97_TUNE_SWAP_SURROUND</span><span class="p">,</span> <span class="cm">/* swap master and surround controls */</span>
	<span class="n">AC97_TUNE_AD_SHARING</span><span class="p">,</span>   <span class="cm">/* for AD1985, turn on OMS bit and use headphone */</span>
	<span class="n">AC97_TUNE_ALC_JACK</span><span class="p">,</span>     <span class="cm">/* for Realtek, enable JACK detection */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ac97_quirk</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">vendor</span><span class="p">;</span>  <span class="cm">/* PCI vendor id */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">device</span><span class="p">;</span>  <span class="cm">/* PCI device id */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">mask</span><span class="p">;</span>    <span class="cm">/* device id bit mask, 0 = accept all */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>       <span class="cm">/* name shown as info */</span>
	<span class="kt">int</span> <span class="n">type</span><span class="p">;</span>               <span class="cm">/* quirk type above */</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="cm">/* _AC97_CODEC_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
