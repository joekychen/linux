<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › concap.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>concap.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $Id: concap.h,v 1.3.2.2 2004/01/12 23:08:35 keil Exp $</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 1997 by Henner Eisen &lt;eis@baty.hanse.de&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This software may be used and distributed according to the terms</span>
<span class="cm"> * of the GNU General Public License, incorporated herein by reference.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _LINUX_CONCAP_H</span>
<span class="cp">#define _LINUX_CONCAP_H</span>

<span class="cp">#include &lt;linux/skbuff.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>

<span class="cm">/* Stuff to support encapsulation protocols genericly. The encapsulation</span>
<span class="cm">   protocol is processed at the uppermost layer of the network interface.</span>

<span class="cm">   Based on a ideas developed in a &#39;synchronous device&#39; thread in the</span>
<span class="cm">   linux-x25 mailing list contributed by Alan Cox, Thomasz Motylewski</span>
<span class="cm">   and Jonathan Naylor.</span>

<span class="cm">   For more documetation on this refer to Documentation/isdn/README.concap</span>
<span class="cm">*/</span>

<span class="k">struct</span> <span class="n">concap_proto_ops</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">concap_device_ops</span><span class="p">;</span>

<span class="cm">/* this manages all data needed by the encapsulation protocol</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">concap_proto</span><span class="p">{</span>
	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">net_dev</span><span class="p">;</span>	<span class="cm">/* net device using our service  */</span>
	<span class="k">struct</span> <span class="n">concap_device_ops</span> <span class="o">*</span><span class="n">dops</span><span class="p">;</span>	<span class="cm">/* callbacks provided by device */</span>
 	<span class="k">struct</span> <span class="n">concap_proto_ops</span>  <span class="o">*</span><span class="n">pops</span><span class="p">;</span>	<span class="cm">/* callbacks provided by us */</span>
 	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">proto_data</span><span class="p">;</span>		<span class="cm">/* protocol specific private data, to</span>
<span class="cm">					   be accessed via *pops methods only*/</span>
	<span class="cm">/*</span>
<span class="cm">	  :</span>
<span class="cm">	  whatever </span>
<span class="cm">	  :</span>
<span class="cm">	  */</span>
<span class="p">};</span>

<span class="cm">/* Operations to be supported by the net device. Called by the encapsulation</span>
<span class="cm"> * protocol entity. No receive method is offered because the encapsulation</span>
<span class="cm"> * protocol directly calls netif_rx().</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">concap_device_ops</span><span class="p">{</span>

	<span class="cm">/* to request data is submitted by device*/</span> 
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">data_req</span><span class="p">)(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="p">);</span>

	<span class="cm">/* Control methods must be set to NULL by devices which do not</span>
<span class="cm">	   support connection control.*/</span>
	<span class="cm">/* to request a connection is set up */</span> 
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">connect_req</span><span class="p">)(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="p">);</span>

	<span class="cm">/* to request a connection is released */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">disconn_req</span><span class="p">)(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="p">);</span>	
<span class="p">};</span>

<span class="cm">/* Operations to be supported by the encapsulation protocol. Called by</span>
<span class="cm"> * device driver.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">concap_proto_ops</span><span class="p">{</span>

	<span class="cm">/* create a new encapsulation protocol instance of same type */</span>
	<span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span>  <span class="p">(</span><span class="o">*</span><span class="n">proto_new</span><span class="p">)</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>

	<span class="cm">/* delete encapsulation protocol instance and free all its resources.</span>
<span class="cm">	   cprot may no loger be referenced after calling this */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">proto_del</span><span class="p">)(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="n">cprot</span><span class="p">);</span>

	<span class="cm">/* initialize the protocol&#39;s data. To be called at interface startup</span>
<span class="cm">	   or when the device driver resets the interface. All services of the</span>
<span class="cm">	   encapsulation protocol may be used after this*/</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">restart</span><span class="p">)(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="n">cprot</span><span class="p">,</span> 
		       <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">ndev</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">concap_device_ops</span> <span class="o">*</span><span class="n">dops</span><span class="p">);</span>

	<span class="cm">/* inactivate an encapsulation protocol instance. The encapsulation</span>
<span class="cm">	   protocol may not call any *dops methods after this. */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">close</span><span class="p">)(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="n">cprot</span><span class="p">);</span>

	<span class="cm">/* process a frame handed down to us by upper layer */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">encap_and_xmit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="n">cprot</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>

	<span class="cm">/* to be called for each data entity received from lower layer*/</span> 
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">data_ind</span><span class="p">)(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="n">cprot</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>

	<span class="cm">/* to be called when a connection was set up/down.</span>
<span class="cm">	   Protocols that don&#39;t process these primitives might fill in</span>
<span class="cm">	   dummy methods here */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">connect_ind</span><span class="p">)(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="n">cprot</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">disconn_ind</span><span class="p">)(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="n">cprot</span><span class="p">);</span>
  <span class="cm">/*</span>
<span class="cm">    Some network device support functions, like net_header(), rebuild_header(),</span>
<span class="cm">    and others, that depend solely on the encapsulation protocol, might</span>
<span class="cm">    be provided here, too. The net device would just fill them in its</span>
<span class="cm">    corresponding fields when it is opened.</span>
<span class="cm">    */</span>
<span class="p">};</span>

<span class="cm">/* dummy restart/close/connect/reset/disconn methods</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">concap_nop</span><span class="p">(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="n">cprot</span><span class="p">);</span> 

<span class="cm">/* dummy submit method</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">concap_drop_skb</span><span class="p">(</span><span class="k">struct</span> <span class="n">concap_proto</span> <span class="o">*</span><span class="n">cprot</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
