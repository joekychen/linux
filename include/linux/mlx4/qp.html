<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › mlx4 › qp.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>qp.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2007 Cisco Systems, Inc.  All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is available to you under a choice of one of two</span>
<span class="cm"> * licenses.  You may choose to be licensed under the terms of the GNU</span>
<span class="cm"> * General Public License (GPL) Version 2, available from the file</span>
<span class="cm"> * COPYING in the main directory of this source tree, or the</span>
<span class="cm"> * OpenIB.org BSD license below:</span>
<span class="cm"> *</span>
<span class="cm"> *     Redistribution and use in source and binary forms, with or</span>
<span class="cm"> *     without modification, are permitted provided that the following</span>
<span class="cm"> *     conditions are met:</span>
<span class="cm"> *</span>
<span class="cm"> *	- Redistributions of source code must retain the above</span>
<span class="cm"> *	  copyright notice, this list of conditions and the following</span>
<span class="cm"> *	  disclaimer.</span>
<span class="cm"> *</span>
<span class="cm"> *	- Redistributions in binary form must reproduce the above</span>
<span class="cm"> *	  copyright notice, this list of conditions and the following</span>
<span class="cm"> *	  disclaimer in the documentation and/or other materials</span>
<span class="cm"> *	  provided with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="cm"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="cm"> * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<span class="cm"> * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef MLX4_QP_H</span>
<span class="cp">#define MLX4_QP_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#include &lt;linux/mlx4/device.h&gt;</span>

<span class="cp">#define MLX4_INVALID_LKEY	0x100</span>

<span class="k">enum</span> <span class="n">mlx4_qp_optpar</span> <span class="p">{</span>
	<span class="n">MLX4_QP_OPTPAR_ALT_ADDR_PATH</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_RRE</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_RAE</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_RWE</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_PKEY_INDEX</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_Q_KEY</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_RNR_TIMEOUT</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_PRIMARY_ADDR_PATH</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_SRA_MAX</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_RRA_MAX</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_PM_STATE</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_RETRY_COUNT</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_RNR_RETRY</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_ACK_TIMEOUT</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_SCHED_QUEUE</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">,</span>
	<span class="n">MLX4_QP_OPTPAR_COUNTER_INDEX</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">mlx4_qp_state</span> <span class="p">{</span>
	<span class="n">MLX4_QP_STATE_RST</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MLX4_QP_STATE_INIT</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MLX4_QP_STATE_RTR</span>			<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MLX4_QP_STATE_RTS</span>			<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">MLX4_QP_STATE_SQER</span>			<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">MLX4_QP_STATE_SQD</span>			<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">MLX4_QP_STATE_ERR</span>			<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">MLX4_QP_STATE_SQ_DRAINING</span>		<span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">MLX4_QP_NUM_STATE</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_QP_ST_RC</span>				<span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
	<span class="n">MLX4_QP_ST_UC</span>				<span class="o">=</span> <span class="mh">0x1</span><span class="p">,</span>
	<span class="n">MLX4_QP_ST_RD</span>				<span class="o">=</span> <span class="mh">0x2</span><span class="p">,</span>
	<span class="n">MLX4_QP_ST_UD</span>				<span class="o">=</span> <span class="mh">0x3</span><span class="p">,</span>
	<span class="n">MLX4_QP_ST_XRC</span>				<span class="o">=</span> <span class="mh">0x6</span><span class="p">,</span>
	<span class="n">MLX4_QP_ST_MLX</span>				<span class="o">=</span> <span class="mh">0x7</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_QP_PM_MIGRATED</span>			<span class="o">=</span> <span class="mh">0x3</span><span class="p">,</span>
	<span class="n">MLX4_QP_PM_ARMED</span>			<span class="o">=</span> <span class="mh">0x0</span><span class="p">,</span>
	<span class="n">MLX4_QP_PM_REARM</span>			<span class="o">=</span> <span class="mh">0x1</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="cm">/* params1 */</span>
	<span class="n">MLX4_QP_BIT_SRE</span>				<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">,</span>
	<span class="n">MLX4_QP_BIT_SWE</span>				<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">,</span>
	<span class="n">MLX4_QP_BIT_SAE</span>				<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">,</span>
	<span class="cm">/* params2 */</span>
	<span class="n">MLX4_QP_BIT_RRE</span>				<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">,</span>
	<span class="n">MLX4_QP_BIT_RWE</span>				<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">,</span>
	<span class="n">MLX4_QP_BIT_RAE</span>				<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">,</span>
	<span class="n">MLX4_QP_BIT_RIC</span>				<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span>	<span class="mi">4</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_RSS_HASH_XOR</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MLX4_RSS_HASH_TOP</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="n">MLX4_RSS_UDP_IPV6</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MLX4_RSS_UDP_IPV4</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MLX4_RSS_TCP_IPV6</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MLX4_RSS_IPV6</span>				<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">MLX4_RSS_TCP_IPV4</span>			<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">MLX4_RSS_IPV4</span>				<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">,</span>

	<span class="cm">/* offset of mlx4_rss_context within mlx4_qp_context.pri_path */</span>
	<span class="n">MLX4_RSS_OFFSET_IN_QPC_PRI_PATH</span>		<span class="o">=</span> <span class="mh">0x24</span><span class="p">,</span>
	<span class="cm">/* offset of being RSS indirection QP within mlx4_qp_context.flags */</span>
	<span class="n">MLX4_RSS_QPC_FLAG_OFFSET</span>		<span class="o">=</span> <span class="mi">13</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_rss_context</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">base_qpn</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">default_qpn</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">reserved</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">hash_fn</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">flags</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">rss_key</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
	<span class="n">__be32</span>			<span class="n">base_qpn_udp</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_qp_path</span> <span class="p">{</span>
	<span class="n">u8</span>			<span class="n">fl</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">pkey_index</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">counter_index</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">grh_mylmc</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">rlid</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">ackto</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">mgid_index</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">static_rate</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">hop_limit</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">tclass_flowlabel</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">rgid</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">sched_queue</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">vlan_index</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">feup</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved3</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved4</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">dmac</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_qp_context</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">flags</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">pd</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">mtu_msgmax</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">rq_size_stride</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">sq_size_stride</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">rlkey</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">usr_page</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">local_qpn</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">remote_qpn</span><span class="p">;</span>
	<span class="k">struct</span>			<span class="n">mlx4_qp_path</span> <span class="n">pri_path</span><span class="p">;</span>
	<span class="k">struct</span>			<span class="n">mlx4_qp_path</span> <span class="n">alt_path</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">params1</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved1</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">next_send_psn</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">cqn_send</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">__be32</span>			<span class="n">last_acked_psn</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">ssn</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">params2</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">rnr_nextrecvpsn</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">xrcd</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">cqn_recv</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">db_rec_addr</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">qkey</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">srqn</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">msn</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">rq_wqe_counter</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">sq_wqe_counter</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved3</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">__be32</span>			<span class="n">param3</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">nummmcpeers_basemkey</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">log_page_size</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved4</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">mtt_base_addr_h</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">mtt_base_addr_l</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved5</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Which firmware version adds support for NEC (NoErrorCompletion) bit */</span>
<span class="cp">#define MLX4_FW_VER_WQE_CTRL_NEC mlx4_fw_ver(2, 2, 232)</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_WQE_CTRL_NEC</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">29</span><span class="p">,</span>
	<span class="n">MLX4_WQE_CTRL_FENCE</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">MLX4_WQE_CTRL_CQ_UPDATE</span>		<span class="o">=</span> <span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">MLX4_WQE_CTRL_SOLICITED</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">MLX4_WQE_CTRL_IP_CSUM</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">MLX4_WQE_CTRL_TCP_UDP_CSUM</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">MLX4_WQE_CTRL_INS_VLAN</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">MLX4_WQE_CTRL_STRONG_ORDER</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">MLX4_WQE_CTRL_FORCE_LOOPBACK</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_ctrl_seg</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">owner_opcode</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">vlan_tag</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">ins_vlan</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">fence_size</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * High 24 bits are SRC remote buffer; low 8 bits are flags:</span>
<span class="cm">	 * [7]   SO (strong ordering)</span>
<span class="cm">	 * [5]   TCP/UDP checksum</span>
<span class="cm">	 * [4]   IP checksum</span>
<span class="cm">	 * [3:2] C (generate completion queue entry)</span>
<span class="cm">	 * [1]   SE (solicited event)</span>
<span class="cm">	 * [0]   FL (force loopback)</span>
<span class="cm">	 */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">__be32</span>			<span class="n">srcrb_flags</span><span class="p">;</span>
		<span class="n">__be16</span>			<span class="n">srcrb_flags16</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="p">};</span>
	<span class="cm">/*</span>
<span class="cm">	 * imm is immediate data for send/RDMA write w/ immediate;</span>
<span class="cm">	 * also invalidation key for send with invalidate; input</span>
<span class="cm">	 * modifier for WQEs on CCQs.</span>
<span class="cm">	 */</span>
	<span class="n">__be32</span>			<span class="n">imm</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_WQE_MLX_VL15</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">17</span><span class="p">,</span>
	<span class="n">MLX4_WQE_MLX_SLR</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_mlx_seg</span> <span class="p">{</span>
	<span class="n">u8</span>			<span class="n">owner</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span>			<span class="n">opcode</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">sched_prio</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved2</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">size</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * [17]    VL15</span>
<span class="cm">	 * [16]    SLR</span>
<span class="cm">	 * [15:12] static rate</span>
<span class="cm">	 * [11:8]  SL</span>
<span class="cm">	 * [4]     ICRC</span>
<span class="cm">	 * [3:2]   C</span>
<span class="cm">	 * [0]     FL (force loopback)</span>
<span class="cm">	 */</span>
	<span class="n">__be32</span>			<span class="n">flags</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">rlid</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">reserved3</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_datagram_seg</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">av</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">__be32</span>			<span class="n">dqpn</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">qkey</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">vlan</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">mac</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_lso_seg</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">mss_hdr_size</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">header</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_bind_seg</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">flags1</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">flags2</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">new_rkey</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">lkey</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">addr</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">length</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_WQE_FMR_PERM_LOCAL_READ</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">27</span><span class="p">,</span>
	<span class="n">MLX4_WQE_FMR_PERM_LOCAL_WRITE</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">28</span><span class="p">,</span>
	<span class="n">MLX4_WQE_FMR_PERM_REMOTE_READ</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">29</span><span class="p">,</span>
	<span class="n">MLX4_WQE_FMR_PERM_REMOTE_WRITE</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">30</span><span class="p">,</span>
	<span class="n">MLX4_WQE_FMR_PERM_ATOMIC</span>	<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">31</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_fmr_seg</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">flags</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">mem_key</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">buf_list</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">start_addr</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">reg_len</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">offset</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">page_size</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_fmr_ext_seg</span> <span class="p">{</span>
	<span class="n">u8</span>			<span class="n">flags</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">reserved</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">app_mask</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">wire_app_tag</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">mem_app_tag</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">wire_ref_tag_base</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">mem_ref_tag_base</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_local_inval_seg</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">flags</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved1</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">mem_key</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">__be32</span>			<span class="n">guest_id</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">pa</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_raddr_seg</span> <span class="p">{</span>
	<span class="n">__be64</span>			<span class="n">raddr</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">rkey</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">reserved</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_atomic_seg</span> <span class="p">{</span>
	<span class="n">__be64</span>			<span class="n">swap_add</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">compare</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_masked_atomic_seg</span> <span class="p">{</span>
	<span class="n">__be64</span>			<span class="n">swap_add</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">compare</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">swap_add_mask</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">compare_mask</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_data_seg</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">byte_count</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">lkey</span><span class="p">;</span>
	<span class="n">__be64</span>			<span class="n">addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">MLX4_INLINE_ALIGN</span>	<span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
	<span class="n">MLX4_INLINE_SEG</span>		<span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">31</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">mlx4_wqe_inline_seg</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">byte_count</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">mlx4_qp_modify</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_mtt</span> <span class="o">*</span><span class="n">mtt</span><span class="p">,</span>
		   <span class="k">enum</span> <span class="n">mlx4_qp_state</span> <span class="n">cur_state</span><span class="p">,</span> <span class="k">enum</span> <span class="n">mlx4_qp_state</span> <span class="n">new_state</span><span class="p">,</span>
		   <span class="k">struct</span> <span class="n">mlx4_qp_context</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span> <span class="k">enum</span> <span class="n">mlx4_qp_optpar</span> <span class="n">optpar</span><span class="p">,</span>
		   <span class="kt">int</span> <span class="n">sqd_event</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="o">*</span><span class="n">qp</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_qp_query</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="o">*</span><span class="n">qp</span><span class="p">,</span>
		  <span class="k">struct</span> <span class="n">mlx4_qp_context</span> <span class="o">*</span><span class="n">context</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">mlx4_qp_to_ready</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_mtt</span> <span class="o">*</span><span class="n">mtt</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">mlx4_qp_context</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="o">*</span><span class="n">qp</span><span class="p">,</span> <span class="k">enum</span> <span class="n">mlx4_qp_state</span> <span class="o">*</span><span class="n">qp_state</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="o">*</span><span class="nf">__mlx4_qp_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">qpn</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">radix_tree_lookup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">qp_table_tree</span><span class="p">,</span> <span class="n">qpn</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">caps</span><span class="p">.</span><span class="n">num_qps</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">mlx4_qp_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">mlx4_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mlx4_qp</span> <span class="o">*</span><span class="n">qp</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* MLX4_QP_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
