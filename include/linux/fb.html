<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › fb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>fb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _LINUX_FB_H</span>
<span class="cp">#define _LINUX_FB_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#include &lt;linux/kgdb.h&gt;</span>
<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cm">/* Definitions of frame buffers						*/</span>

<span class="cp">#define FB_MAX			32	</span><span class="cm">/* sufficient for now */</span><span class="cp"></span>

<span class="cm">/* ioctls</span>
<span class="cm">   0x46 is &#39;F&#39;								*/</span>
<span class="cp">#define FBIOGET_VSCREENINFO	0x4600</span>
<span class="cp">#define FBIOPUT_VSCREENINFO	0x4601</span>
<span class="cp">#define FBIOGET_FSCREENINFO	0x4602</span>
<span class="cp">#define FBIOGETCMAP		0x4604</span>
<span class="cp">#define FBIOPUTCMAP		0x4605</span>
<span class="cp">#define FBIOPAN_DISPLAY		0x4606</span>
<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#define FBIO_CURSOR            _IOWR(&#39;F&#39;, 0x08, struct fb_cursor_user)</span>
<span class="cp">#else</span>
<span class="cp">#define FBIO_CURSOR            _IOWR(&#39;F&#39;, 0x08, struct fb_cursor)</span>
<span class="cp">#endif</span>
<span class="cm">/* 0x4607-0x460B are defined below */</span>
<span class="cm">/* #define FBIOGET_MONITORSPEC	0x460C */</span>
<span class="cm">/* #define FBIOPUT_MONITORSPEC	0x460D */</span>
<span class="cm">/* #define FBIOSWITCH_MONIBIT	0x460E */</span>
<span class="cp">#define FBIOGET_CON2FBMAP	0x460F</span>
<span class="cp">#define FBIOPUT_CON2FBMAP	0x4610</span>
<span class="cp">#define FBIOBLANK		0x4611		</span><span class="cm">/* arg: 0 or vesa level + 1 */</span><span class="cp"></span>
<span class="cp">#define FBIOGET_VBLANK		_IOR(&#39;F&#39;, 0x12, struct fb_vblank)</span>
<span class="cp">#define FBIO_ALLOC              0x4613</span>
<span class="cp">#define FBIO_FREE               0x4614</span>
<span class="cp">#define FBIOGET_GLYPH           0x4615</span>
<span class="cp">#define FBIOGET_HWCINFO         0x4616</span>
<span class="cp">#define FBIOPUT_MODEINFO        0x4617</span>
<span class="cp">#define FBIOGET_DISPINFO        0x4618</span>
<span class="cp">#define FBIO_WAITFORVSYNC	_IOW(&#39;F&#39;, 0x20, __u32)</span>

<span class="cp">#define FB_TYPE_PACKED_PIXELS		0	</span><span class="cm">/* Packed Pixels	*/</span><span class="cp"></span>
<span class="cp">#define FB_TYPE_PLANES			1	</span><span class="cm">/* Non interleaved planes */</span><span class="cp"></span>
<span class="cp">#define FB_TYPE_INTERLEAVED_PLANES	2	</span><span class="cm">/* Interleaved planes	*/</span><span class="cp"></span>
<span class="cp">#define FB_TYPE_TEXT			3	</span><span class="cm">/* Text/attributes	*/</span><span class="cp"></span>
<span class="cp">#define FB_TYPE_VGA_PLANES		4	</span><span class="cm">/* EGA/VGA planes	*/</span><span class="cp"></span>
<span class="cp">#define FB_TYPE_FOURCC			5	</span><span class="cm">/* Type identified by a V4L2 FOURCC */</span><span class="cp"></span>

<span class="cp">#define FB_AUX_TEXT_MDA		0	</span><span class="cm">/* Monochrome text */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_CGA		1	</span><span class="cm">/* CGA/EGA/VGA Color text */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_S3_MMIO	2	</span><span class="cm">/* S3 MMIO fasttext */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_MGA_STEP16	3	</span><span class="cm">/* MGA Millenium I: text, attr, 14 reserved bytes */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_MGA_STEP8	4	</span><span class="cm">/* other MGAs:      text, attr,  6 reserved bytes */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_SVGA_GROUP	8	</span><span class="cm">/* 8-15: SVGA tileblit compatible modes */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_SVGA_MASK	7	</span><span class="cm">/* lower three bits says step */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_SVGA_STEP2	8	</span><span class="cm">/* SVGA text mode:  text, attr */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_SVGA_STEP4	9	</span><span class="cm">/* SVGA text mode:  text, attr,  2 reserved bytes */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_SVGA_STEP8	10	</span><span class="cm">/* SVGA text mode:  text, attr,  6 reserved bytes */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_SVGA_STEP16	11	</span><span class="cm">/* SVGA text mode:  text, attr, 14 reserved bytes */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_TEXT_SVGA_LAST	15	</span><span class="cm">/* reserved up to 15 */</span><span class="cp"></span>

<span class="cp">#define FB_AUX_VGA_PLANES_VGA4		0	</span><span class="cm">/* 16 color planes (EGA/VGA) */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_VGA_PLANES_CFB4		1	</span><span class="cm">/* CFB4 in planes (VGA) */</span><span class="cp"></span>
<span class="cp">#define FB_AUX_VGA_PLANES_CFB8		2	</span><span class="cm">/* CFB8 in planes (VGA) */</span><span class="cp"></span>

<span class="cp">#define FB_VISUAL_MONO01		0	</span><span class="cm">/* Monochr. 1=Black 0=White */</span><span class="cp"></span>
<span class="cp">#define FB_VISUAL_MONO10		1	</span><span class="cm">/* Monochr. 1=White 0=Black */</span><span class="cp"></span>
<span class="cp">#define FB_VISUAL_TRUECOLOR		2	</span><span class="cm">/* True color	*/</span><span class="cp"></span>
<span class="cp">#define FB_VISUAL_PSEUDOCOLOR		3	</span><span class="cm">/* Pseudo color (like atari) */</span><span class="cp"></span>
<span class="cp">#define FB_VISUAL_DIRECTCOLOR		4	</span><span class="cm">/* Direct color */</span><span class="cp"></span>
<span class="cp">#define FB_VISUAL_STATIC_PSEUDOCOLOR	5	</span><span class="cm">/* Pseudo color readonly */</span><span class="cp"></span>
<span class="cp">#define FB_VISUAL_FOURCC		6	</span><span class="cm">/* Visual identified by a V4L2 FOURCC */</span><span class="cp"></span>

<span class="cp">#define FB_ACCEL_NONE		0	</span><span class="cm">/* no hardware accelerator	*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_ATARIBLITT	1	</span><span class="cm">/* Atari Blitter		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_AMIGABLITT	2	</span><span class="cm">/* Amiga Blitter                */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_S3_TRIO64	3	</span><span class="cm">/* Cybervision64 (S3 Trio64)    */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NCR_77C32BLT	4	</span><span class="cm">/* RetinaZ3 (NCR 77C32BLT)      */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_S3_VIRGE	5	</span><span class="cm">/* Cybervision64/3D (S3 ViRGE)	*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_ATI_MACH64GX	6	</span><span class="cm">/* ATI Mach 64GX family		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_DEC_TGA	7	</span><span class="cm">/* DEC 21030 TGA		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_ATI_MACH64CT	8	</span><span class="cm">/* ATI Mach 64CT family		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_ATI_MACH64VT	9	</span><span class="cm">/* ATI Mach 64CT family VT class */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_ATI_MACH64GT	10	</span><span class="cm">/* ATI Mach 64CT family GT class */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SUN_CREATOR	11	</span><span class="cm">/* Sun Creator/Creator3D	*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SUN_CGSIX	12	</span><span class="cm">/* Sun cg6			*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SUN_LEO	13	</span><span class="cm">/* Sun leo/zx			*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_IMS_TWINTURBO	14	</span><span class="cm">/* IMS Twin Turbo		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_3DLABS_PERMEDIA2 15	</span><span class="cm">/* 3Dlabs Permedia 2		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_MATROX_MGA2064W 16	</span><span class="cm">/* Matrox MGA2064W (Millenium)	*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_MATROX_MGA1064SG 17	</span><span class="cm">/* Matrox MGA1064SG (Mystique)	*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_MATROX_MGA2164W 18	</span><span class="cm">/* Matrox MGA2164W (Millenium II) */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_MATROX_MGA2164W_AGP 19	</span><span class="cm">/* Matrox MGA2164W (Millenium II) */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_MATROX_MGAG100	20	</span><span class="cm">/* Matrox G100 (Productiva G100) */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_MATROX_MGAG200	21	</span><span class="cm">/* Matrox G200 (Myst, Mill, ...) */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SUN_CG14	22	</span><span class="cm">/* Sun cgfourteen		 */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SUN_BWTWO	23	</span><span class="cm">/* Sun bwtwo			*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SUN_CGTHREE	24	</span><span class="cm">/* Sun cgthree			*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SUN_TCX	25	</span><span class="cm">/* Sun tcx			*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_MATROX_MGAG400	26	</span><span class="cm">/* Matrox G400			*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NV3		27	</span><span class="cm">/* nVidia RIVA 128              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NV4		28	</span><span class="cm">/* nVidia RIVA TNT		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NV5		29	</span><span class="cm">/* nVidia RIVA TNT2		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_CT_6555x	30	</span><span class="cm">/* C&amp;T 6555x			*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_3DFX_BANSHEE	31	</span><span class="cm">/* 3Dfx Banshee			*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_ATI_RAGE128	32	</span><span class="cm">/* ATI Rage128 family		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_IGS_CYBER2000	33	</span><span class="cm">/* CyberPro 2000		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_IGS_CYBER2010	34	</span><span class="cm">/* CyberPro 2010		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_IGS_CYBER5000	35	</span><span class="cm">/* CyberPro 5000		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SIS_GLAMOUR    36	</span><span class="cm">/* SiS 300/630/540              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_3DLABS_PERMEDIA3 37	</span><span class="cm">/* 3Dlabs Permedia 3		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_ATI_RADEON	38	</span><span class="cm">/* ATI Radeon family		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_I810           39      </span><span class="cm">/* Intel 810/815                */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SIS_GLAMOUR_2  40	</span><span class="cm">/* SiS 315, 650, 740		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SIS_XABRE      41	</span><span class="cm">/* SiS 330 (&quot;Xabre&quot;)		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_I830           42      </span><span class="cm">/* Intel 830M/845G/85x/865G     */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NV_10          43      </span><span class="cm">/* nVidia Arch 10               */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NV_20          44      </span><span class="cm">/* nVidia Arch 20               */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NV_30          45      </span><span class="cm">/* nVidia Arch 30               */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NV_40          46      </span><span class="cm">/* nVidia Arch 40               */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_XGI_VOLARI_V	47	</span><span class="cm">/* XGI Volari V3XT, V5, V8      */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_XGI_VOLARI_Z	48	</span><span class="cm">/* XGI Volari Z7                */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_OMAP1610	49	</span><span class="cm">/* TI OMAP16xx                  */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_TRIDENT_TGUI	50	</span><span class="cm">/* Trident TGUI			*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_TRIDENT_3DIMAGE 51	</span><span class="cm">/* Trident 3DImage		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_TRIDENT_BLADE3D 52	</span><span class="cm">/* Trident Blade3D		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_TRIDENT_BLADEXP 53	</span><span class="cm">/* Trident BladeXP		*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_CIRRUS_ALPINE   53	</span><span class="cm">/* Cirrus Logic 543x/544x/5480	*/</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NEOMAGIC_NM2070 90	</span><span class="cm">/* NeoMagic NM2070              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NEOMAGIC_NM2090 91	</span><span class="cm">/* NeoMagic NM2090              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NEOMAGIC_NM2093 92	</span><span class="cm">/* NeoMagic NM2093              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NEOMAGIC_NM2097 93	</span><span class="cm">/* NeoMagic NM2097              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NEOMAGIC_NM2160 94	</span><span class="cm">/* NeoMagic NM2160              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NEOMAGIC_NM2200 95	</span><span class="cm">/* NeoMagic NM2200              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NEOMAGIC_NM2230 96	</span><span class="cm">/* NeoMagic NM2230              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NEOMAGIC_NM2360 97	</span><span class="cm">/* NeoMagic NM2360              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_NEOMAGIC_NM2380 98	</span><span class="cm">/* NeoMagic NM2380              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_PXA3XX		 99	</span><span class="cm">/* PXA3xx			*/</span><span class="cp"></span>

<span class="cp">#define FB_ACCEL_SAVAGE4        0x80	</span><span class="cm">/* S3 Savage4                   */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SAVAGE3D       0x81	</span><span class="cm">/* S3 Savage3D                  */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SAVAGE3D_MV    0x82	</span><span class="cm">/* S3 Savage3D-MV               */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SAVAGE2000     0x83	</span><span class="cm">/* S3 Savage2000                */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SAVAGE_MX_MV   0x84	</span><span class="cm">/* S3 Savage/MX-MV              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SAVAGE_MX      0x85	</span><span class="cm">/* S3 Savage/MX                 */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SAVAGE_IX_MV   0x86	</span><span class="cm">/* S3 Savage/IX-MV              */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SAVAGE_IX      0x87	</span><span class="cm">/* S3 Savage/IX                 */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_PROSAVAGE_PM   0x88	</span><span class="cm">/* S3 ProSavage PM133           */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_PROSAVAGE_KM   0x89	</span><span class="cm">/* S3 ProSavage KM133           */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_S3TWISTER_P    0x8a	</span><span class="cm">/* S3 Twister                   */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_S3TWISTER_K    0x8b	</span><span class="cm">/* S3 TwisterK                  */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_SUPERSAVAGE    0x8c    </span><span class="cm">/* S3 Supersavage               */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_PROSAVAGE_DDR  0x8d	</span><span class="cm">/* S3 ProSavage DDR             */</span><span class="cp"></span>
<span class="cp">#define FB_ACCEL_PROSAVAGE_DDRK 0x8e	</span><span class="cm">/* S3 ProSavage DDR-K           */</span><span class="cp"></span>

<span class="cp">#define FB_ACCEL_PUV3_UNIGFX	0xa0	</span><span class="cm">/* PKUnity-v3 Unigfx		*/</span><span class="cp"></span>

<span class="cp">#define FB_CAP_FOURCC		1	</span><span class="cm">/* Device supports FOURCC-based formats */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">fb_fix_screeninfo</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">id</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>			<span class="cm">/* identification string eg &quot;TT Builtin&quot; */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">smem_start</span><span class="p">;</span>	<span class="cm">/* Start of frame buffer mem */</span>
					<span class="cm">/* (physical address) */</span>
	<span class="n">__u32</span> <span class="n">smem_len</span><span class="p">;</span>			<span class="cm">/* Length of frame buffer mem */</span>
	<span class="n">__u32</span> <span class="n">type</span><span class="p">;</span>			<span class="cm">/* see FB_TYPE_*		*/</span>
	<span class="n">__u32</span> <span class="n">type_aux</span><span class="p">;</span>			<span class="cm">/* Interleave for interleaved Planes */</span>
	<span class="n">__u32</span> <span class="n">visual</span><span class="p">;</span>			<span class="cm">/* see FB_VISUAL_*		*/</span> 
	<span class="n">__u16</span> <span class="n">xpanstep</span><span class="p">;</span>			<span class="cm">/* zero if no hardware panning  */</span>
	<span class="n">__u16</span> <span class="n">ypanstep</span><span class="p">;</span>			<span class="cm">/* zero if no hardware panning  */</span>
	<span class="n">__u16</span> <span class="n">ywrapstep</span><span class="p">;</span>		<span class="cm">/* zero if no hardware ywrap    */</span>
	<span class="n">__u32</span> <span class="n">line_length</span><span class="p">;</span>		<span class="cm">/* length of a line in bytes    */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mmio_start</span><span class="p">;</span>	<span class="cm">/* Start of Memory Mapped I/O   */</span>
					<span class="cm">/* (physical address) */</span>
	<span class="n">__u32</span> <span class="n">mmio_len</span><span class="p">;</span>			<span class="cm">/* Length of Memory Mapped I/O  */</span>
	<span class="n">__u32</span> <span class="n">accel</span><span class="p">;</span>			<span class="cm">/* Indicate to driver which	*/</span>
					<span class="cm">/*  specific chip/card we have	*/</span>
	<span class="n">__u16</span> <span class="n">capabilities</span><span class="p">;</span>		<span class="cm">/* see FB_CAP_*			*/</span>
	<span class="n">__u16</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>		<span class="cm">/* Reserved for future compatibility */</span>
<span class="p">};</span>

<span class="cm">/* Interpretation of offset for color fields: All offsets are from the right,</span>
<span class="cm"> * inside a &quot;pixel&quot; value, which is exactly &#39;bits_per_pixel&#39; wide (means: you</span>
<span class="cm"> * can use the offset as right argument to &lt;&lt;). A pixel afterwards is a bit</span>
<span class="cm"> * stream and is written to video memory as that unmodified.</span>
<span class="cm"> *</span>
<span class="cm"> * For pseudocolor: offset and length should be the same for all color</span>
<span class="cm"> * components. Offset specifies the position of the least significant bit</span>
<span class="cm"> * of the pallette index in a pixel value. Length indicates the number</span>
<span class="cm"> * of available palette entries (i.e. # of entries = 1 &lt;&lt; length).</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fb_bitfield</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">offset</span><span class="p">;</span>			<span class="cm">/* beginning of bitfield	*/</span>
	<span class="n">__u32</span> <span class="n">length</span><span class="p">;</span>			<span class="cm">/* length of bitfield		*/</span>
	<span class="n">__u32</span> <span class="n">msb_right</span><span class="p">;</span>		<span class="cm">/* != 0 : Most significant bit is */</span> 
					<span class="cm">/* right */</span> 
<span class="p">};</span>

<span class="cp">#define FB_NONSTD_HAM		1	</span><span class="cm">/* Hold-And-Modify (HAM)        */</span><span class="cp"></span>
<span class="cp">#define FB_NONSTD_REV_PIX_IN_B	2	</span><span class="cm">/* order of pixels in each byte is reversed */</span><span class="cp"></span>

<span class="cp">#define FB_ACTIVATE_NOW		0	</span><span class="cm">/* set values immediately (or vbl)*/</span><span class="cp"></span>
<span class="cp">#define FB_ACTIVATE_NXTOPEN	1	</span><span class="cm">/* activate on next open	*/</span><span class="cp"></span>
<span class="cp">#define FB_ACTIVATE_TEST	2	</span><span class="cm">/* don&#39;t set, round up impossible */</span><span class="cp"></span>
<span class="cp">#define FB_ACTIVATE_MASK       15</span>
					<span class="cm">/* values			*/</span>
<span class="cp">#define FB_ACTIVATE_VBL	       16	</span><span class="cm">/* activate values on next vbl  */</span><span class="cp"></span>
<span class="cp">#define FB_CHANGE_CMAP_VBL     32	</span><span class="cm">/* change colormap on vbl	*/</span><span class="cp"></span>
<span class="cp">#define FB_ACTIVATE_ALL	       64	</span><span class="cm">/* change all VCs on this fb	*/</span><span class="cp"></span>
<span class="cp">#define FB_ACTIVATE_FORCE     128	</span><span class="cm">/* force apply even when no change*/</span><span class="cp"></span>
<span class="cp">#define FB_ACTIVATE_INV_MODE  256       </span><span class="cm">/* invalidate videomode */</span><span class="cp"></span>

<span class="cp">#define FB_ACCELF_TEXT		1	</span><span class="cm">/* (OBSOLETE) see fb_info.flags and vc_mode */</span><span class="cp"></span>

<span class="cp">#define FB_SYNC_HOR_HIGH_ACT	1	</span><span class="cm">/* horizontal sync high active	*/</span><span class="cp"></span>
<span class="cp">#define FB_SYNC_VERT_HIGH_ACT	2	</span><span class="cm">/* vertical sync high active	*/</span><span class="cp"></span>
<span class="cp">#define FB_SYNC_EXT		4	</span><span class="cm">/* external sync		*/</span><span class="cp"></span>
<span class="cp">#define FB_SYNC_COMP_HIGH_ACT	8	</span><span class="cm">/* composite sync high active   */</span><span class="cp"></span>
<span class="cp">#define FB_SYNC_BROADCAST	16	</span><span class="cm">/* broadcast video timings      */</span><span class="cp"></span>
					<span class="cm">/* vtotal = 144d/288n/576i =&gt; PAL  */</span>
					<span class="cm">/* vtotal = 121d/242n/484i =&gt; NTSC */</span>
<span class="cp">#define FB_SYNC_ON_GREEN	32	</span><span class="cm">/* sync on green */</span><span class="cp"></span>

<span class="cp">#define FB_VMODE_NONINTERLACED  0	</span><span class="cm">/* non interlaced */</span><span class="cp"></span>
<span class="cp">#define FB_VMODE_INTERLACED	1	</span><span class="cm">/* interlaced	*/</span><span class="cp"></span>
<span class="cp">#define FB_VMODE_DOUBLE		2	</span><span class="cm">/* double scan */</span><span class="cp"></span>
<span class="cp">#define FB_VMODE_ODD_FLD_FIRST	4	</span><span class="cm">/* interlaced: top line first */</span><span class="cp"></span>
<span class="cp">#define FB_VMODE_MASK		255</span>

<span class="cp">#define FB_VMODE_YWRAP		256	</span><span class="cm">/* ywrap instead of panning     */</span><span class="cp"></span>
<span class="cp">#define FB_VMODE_SMOOTH_XPAN	512	</span><span class="cm">/* smooth xpan possible (internally used) */</span><span class="cp"></span>
<span class="cp">#define FB_VMODE_CONUPDATE	512	</span><span class="cm">/* don&#39;t update x/yoffset	*/</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Display rotation support</span>
<span class="cm"> */</span>
<span class="cp">#define FB_ROTATE_UR      0</span>
<span class="cp">#define FB_ROTATE_CW      1</span>
<span class="cp">#define FB_ROTATE_UD      2</span>
<span class="cp">#define FB_ROTATE_CCW     3</span>

<span class="cp">#define PICOS2KHZ(a) (1000000000UL/(a))</span>
<span class="cp">#define KHZ2PICOS(a) (1000000000UL/(a))</span>

<span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">xres</span><span class="p">;</span>			<span class="cm">/* visible resolution		*/</span>
	<span class="n">__u32</span> <span class="n">yres</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">xres_virtual</span><span class="p">;</span>		<span class="cm">/* virtual resolution		*/</span>
	<span class="n">__u32</span> <span class="n">yres_virtual</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">xoffset</span><span class="p">;</span>			<span class="cm">/* offset from virtual to visible */</span>
	<span class="n">__u32</span> <span class="n">yoffset</span><span class="p">;</span>			<span class="cm">/* resolution			*/</span>

	<span class="n">__u32</span> <span class="n">bits_per_pixel</span><span class="p">;</span>		<span class="cm">/* guess what			*/</span>
	<span class="n">__u32</span> <span class="n">grayscale</span><span class="p">;</span>		<span class="cm">/* 0 = color, 1 = grayscale,	*/</span>
					<span class="cm">/* &gt;1 = FOURCC			*/</span>
	<span class="k">struct</span> <span class="n">fb_bitfield</span> <span class="n">red</span><span class="p">;</span>		<span class="cm">/* bitfield in fb mem if true color, */</span>
	<span class="k">struct</span> <span class="n">fb_bitfield</span> <span class="n">green</span><span class="p">;</span>	<span class="cm">/* else only length is significant */</span>
	<span class="k">struct</span> <span class="n">fb_bitfield</span> <span class="n">blue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_bitfield</span> <span class="n">transp</span><span class="p">;</span>	<span class="cm">/* transparency			*/</span>	

	<span class="n">__u32</span> <span class="n">nonstd</span><span class="p">;</span>			<span class="cm">/* != 0 Non standard pixel format */</span>

	<span class="n">__u32</span> <span class="n">activate</span><span class="p">;</span>			<span class="cm">/* see FB_ACTIVATE_*		*/</span>

	<span class="n">__u32</span> <span class="n">height</span><span class="p">;</span>			<span class="cm">/* height of picture in mm    */</span>
	<span class="n">__u32</span> <span class="n">width</span><span class="p">;</span>			<span class="cm">/* width of picture in mm     */</span>

	<span class="n">__u32</span> <span class="n">accel_flags</span><span class="p">;</span>		<span class="cm">/* (OBSOLETE) see fb_info.flags */</span>

	<span class="cm">/* Timing: All values in pixclocks, except pixclock (of course) */</span>
	<span class="n">__u32</span> <span class="n">pixclock</span><span class="p">;</span>			<span class="cm">/* pixel clock in ps (pico seconds) */</span>
	<span class="n">__u32</span> <span class="n">left_margin</span><span class="p">;</span>		<span class="cm">/* time from sync to picture	*/</span>
	<span class="n">__u32</span> <span class="n">right_margin</span><span class="p">;</span>		<span class="cm">/* time from picture to sync	*/</span>
	<span class="n">__u32</span> <span class="n">upper_margin</span><span class="p">;</span>		<span class="cm">/* time from sync to picture	*/</span>
	<span class="n">__u32</span> <span class="n">lower_margin</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">hsync_len</span><span class="p">;</span>		<span class="cm">/* length of horizontal sync	*/</span>
	<span class="n">__u32</span> <span class="n">vsync_len</span><span class="p">;</span>		<span class="cm">/* length of vertical sync	*/</span>
	<span class="n">__u32</span> <span class="n">sync</span><span class="p">;</span>			<span class="cm">/* see FB_SYNC_*		*/</span>
	<span class="n">__u32</span> <span class="n">vmode</span><span class="p">;</span>			<span class="cm">/* see FB_VMODE_*		*/</span>
	<span class="n">__u32</span> <span class="n">rotate</span><span class="p">;</span>			<span class="cm">/* angle we rotate counter clockwise */</span>
	<span class="n">__u32</span> <span class="n">colorspace</span><span class="p">;</span>		<span class="cm">/* colorspace for FOURCC-based modes */</span>
	<span class="n">__u32</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* Reserved for future compatibility */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_cmap</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">start</span><span class="p">;</span>			<span class="cm">/* First entry	*/</span>
	<span class="n">__u32</span> <span class="n">len</span><span class="p">;</span>			<span class="cm">/* Number of entries */</span>
	<span class="n">__u16</span> <span class="o">*</span><span class="n">red</span><span class="p">;</span>			<span class="cm">/* Red values	*/</span>
	<span class="n">__u16</span> <span class="o">*</span><span class="n">green</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="o">*</span><span class="n">blue</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="o">*</span><span class="n">transp</span><span class="p">;</span>			<span class="cm">/* transparency, can be NULL */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_con2fbmap</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">console</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">framebuffer</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* VESA Blanking Levels */</span>
<span class="cp">#define VESA_NO_BLANKING        0</span>
<span class="cp">#define VESA_VSYNC_SUSPEND      1</span>
<span class="cp">#define VESA_HSYNC_SUSPEND      2</span>
<span class="cp">#define VESA_POWERDOWN          3</span>


<span class="k">enum</span> <span class="p">{</span>
	<span class="cm">/* screen: unblanked, hsync: on,  vsync: on */</span>
	<span class="n">FB_BLANK_UNBLANK</span>       <span class="o">=</span> <span class="n">VESA_NO_BLANKING</span><span class="p">,</span>

	<span class="cm">/* screen: blanked,   hsync: on,  vsync: on */</span>
	<span class="n">FB_BLANK_NORMAL</span>        <span class="o">=</span> <span class="n">VESA_NO_BLANKING</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>

	<span class="cm">/* screen: blanked,   hsync: on,  vsync: off */</span>
	<span class="n">FB_BLANK_VSYNC_SUSPEND</span> <span class="o">=</span> <span class="n">VESA_VSYNC_SUSPEND</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>

	<span class="cm">/* screen: blanked,   hsync: off, vsync: on */</span>
	<span class="n">FB_BLANK_HSYNC_SUSPEND</span> <span class="o">=</span> <span class="n">VESA_HSYNC_SUSPEND</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>

	<span class="cm">/* screen: blanked,   hsync: off, vsync: off */</span>
	<span class="n">FB_BLANK_POWERDOWN</span>     <span class="o">=</span> <span class="n">VESA_POWERDOWN</span> <span class="o">+</span> <span class="mi">1</span>
<span class="p">};</span>

<span class="cp">#define FB_VBLANK_VBLANKING	0x001	</span><span class="cm">/* currently in a vertical blank */</span><span class="cp"></span>
<span class="cp">#define FB_VBLANK_HBLANKING	0x002	</span><span class="cm">/* currently in a horizontal blank */</span><span class="cp"></span>
<span class="cp">#define FB_VBLANK_HAVE_VBLANK	0x004	</span><span class="cm">/* vertical blanks can be detected */</span><span class="cp"></span>
<span class="cp">#define FB_VBLANK_HAVE_HBLANK	0x008	</span><span class="cm">/* horizontal blanks can be detected */</span><span class="cp"></span>
<span class="cp">#define FB_VBLANK_HAVE_COUNT	0x010	</span><span class="cm">/* global retrace counter is available */</span><span class="cp"></span>
<span class="cp">#define FB_VBLANK_HAVE_VCOUNT	0x020	</span><span class="cm">/* the vcount field is valid */</span><span class="cp"></span>
<span class="cp">#define FB_VBLANK_HAVE_HCOUNT	0x040	</span><span class="cm">/* the hcount field is valid */</span><span class="cp"></span>
<span class="cp">#define FB_VBLANK_VSYNCING	0x080	</span><span class="cm">/* currently in a vsync */</span><span class="cp"></span>
<span class="cp">#define FB_VBLANK_HAVE_VSYNC	0x100	</span><span class="cm">/* verical syncs can be detected */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">fb_vblank</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">flags</span><span class="p">;</span>			<span class="cm">/* FB_VBLANK flags */</span>
	<span class="n">__u32</span> <span class="n">count</span><span class="p">;</span>			<span class="cm">/* counter of retraces since boot */</span>
	<span class="n">__u32</span> <span class="n">vcount</span><span class="p">;</span>			<span class="cm">/* current scanline position */</span>
	<span class="n">__u32</span> <span class="n">hcount</span><span class="p">;</span>			<span class="cm">/* current scandot position */</span>
	<span class="n">__u32</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* reserved for future compatibility */</span>
<span class="p">};</span>

<span class="cm">/* Internal HW accel */</span>
<span class="cp">#define ROP_COPY 0</span>
<span class="cp">#define ROP_XOR  1</span>

<span class="k">struct</span> <span class="n">fb_copyarea</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">dx</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">dy</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">width</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">height</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">sx</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">sy</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_fillrect</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">dx</span><span class="p">;</span>	<span class="cm">/* screen-relative */</span>
	<span class="n">__u32</span> <span class="n">dy</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">width</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">height</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">color</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">rop</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_image</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">dx</span><span class="p">;</span>		<span class="cm">/* Where to place image */</span>
	<span class="n">__u32</span> <span class="n">dy</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">width</span><span class="p">;</span>		<span class="cm">/* Size of image */</span>
	<span class="n">__u32</span> <span class="n">height</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">fg_color</span><span class="p">;</span>		<span class="cm">/* Only used when a mono bitmap */</span>
	<span class="n">__u32</span> <span class="n">bg_color</span><span class="p">;</span>
	<span class="n">__u8</span>  <span class="n">depth</span><span class="p">;</span>		<span class="cm">/* Depth of the image */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>	<span class="cm">/* Pointer to image data */</span>
	<span class="k">struct</span> <span class="n">fb_cmap</span> <span class="n">cmap</span><span class="p">;</span>	<span class="cm">/* color map info */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * hardware cursor control</span>
<span class="cm"> */</span>

<span class="cp">#define FB_CUR_SETIMAGE 0x01</span>
<span class="cp">#define FB_CUR_SETPOS   0x02</span>
<span class="cp">#define FB_CUR_SETHOT   0x04</span>
<span class="cp">#define FB_CUR_SETCMAP  0x08</span>
<span class="cp">#define FB_CUR_SETSHAPE 0x10</span>
<span class="cp">#define FB_CUR_SETSIZE	0x20</span>
<span class="cp">#define FB_CUR_SETALL   0xFF</span>

<span class="k">struct</span> <span class="n">fbcurpos</span> <span class="p">{</span>
	<span class="n">__u16</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_cursor</span> <span class="p">{</span>
	<span class="n">__u16</span> <span class="n">set</span><span class="p">;</span>		<span class="cm">/* what to set */</span>
	<span class="n">__u16</span> <span class="n">enable</span><span class="p">;</span>		<span class="cm">/* cursor on/off */</span>
	<span class="n">__u16</span> <span class="n">rop</span><span class="p">;</span>		<span class="cm">/* bitop operation */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mask</span><span class="p">;</span>	<span class="cm">/* cursor mask bits */</span>
	<span class="k">struct</span> <span class="n">fbcurpos</span> <span class="n">hot</span><span class="p">;</span>	<span class="cm">/* cursor hot spot */</span>
	<span class="k">struct</span> <span class="n">fb_image</span>	<span class="n">image</span><span class="p">;</span>	<span class="cm">/* Cursor image */</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_FB_BACKLIGHT</span>
<span class="cm">/* Settings for the generic backlight code */</span>
<span class="cp">#define FB_BACKLIGHT_LEVELS	128</span>
<span class="cp">#define FB_BACKLIGHT_MAX	0xFF</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;linux/fs.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/workqueue.h&gt;</span>
<span class="cp">#include &lt;linux/notifier.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/backlight.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;asm/io.h&gt;</span>

<span class="k">struct</span> <span class="n">vm_area_struct</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">fb_info</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">device</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">file</span><span class="p">;</span>

<span class="cm">/* Definitions below are used in the parsed monitor specs */</span>
<span class="cp">#define FB_DPMS_ACTIVE_OFF	1</span>
<span class="cp">#define FB_DPMS_SUSPEND		2</span>
<span class="cp">#define FB_DPMS_STANDBY		4</span>

<span class="cp">#define FB_DISP_DDI		1</span>
<span class="cp">#define FB_DISP_ANA_700_300	2</span>
<span class="cp">#define FB_DISP_ANA_714_286	4</span>
<span class="cp">#define FB_DISP_ANA_1000_400	8</span>
<span class="cp">#define FB_DISP_ANA_700_000	16</span>

<span class="cp">#define FB_DISP_MONO		32</span>
<span class="cp">#define FB_DISP_RGB		64</span>
<span class="cp">#define FB_DISP_MULTI		128</span>
<span class="cp">#define FB_DISP_UNKNOWN		256</span>

<span class="cp">#define FB_SIGNAL_NONE		0</span>
<span class="cp">#define FB_SIGNAL_BLANK_BLANK	1</span>
<span class="cp">#define FB_SIGNAL_SEPARATE	2</span>
<span class="cp">#define FB_SIGNAL_COMPOSITE	4</span>
<span class="cp">#define FB_SIGNAL_SYNC_ON_GREEN	8</span>
<span class="cp">#define FB_SIGNAL_SERRATION_ON	16</span>

<span class="cp">#define FB_MISC_PRIM_COLOR	1</span>
<span class="cp">#define FB_MISC_1ST_DETAIL	2	</span><span class="cm">/* First Detailed Timing is preferred */</span><span class="cp"></span>
<span class="k">struct</span> <span class="n">fb_chroma</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">redx</span><span class="p">;</span>	<span class="cm">/* in fraction of 1024 */</span>
	<span class="n">__u32</span> <span class="n">greenx</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">bluex</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">whitex</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">redy</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">greeny</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">bluey</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">whitey</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_monspecs</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fb_chroma</span> <span class="n">chroma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">modedb</span><span class="p">;</span>	<span class="cm">/* mode database */</span>
	<span class="n">__u8</span>  <span class="n">manufacturer</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* Manufacturer */</span>
	<span class="n">__u8</span>  <span class="n">monitor</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>		<span class="cm">/* Monitor String */</span>
	<span class="n">__u8</span>  <span class="n">serial_no</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>		<span class="cm">/* Serial Number */</span>
	<span class="n">__u8</span>  <span class="n">ascii</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>		<span class="cm">/* ? */</span>
	<span class="n">__u32</span> <span class="n">modedb_len</span><span class="p">;</span>		<span class="cm">/* mode database length */</span>
	<span class="n">__u32</span> <span class="n">model</span><span class="p">;</span>			<span class="cm">/* Monitor Model */</span>
	<span class="n">__u32</span> <span class="n">serial</span><span class="p">;</span>			<span class="cm">/* Serial Number - Integer */</span>
	<span class="n">__u32</span> <span class="n">year</span><span class="p">;</span>			<span class="cm">/* Year manufactured */</span>
	<span class="n">__u32</span> <span class="n">week</span><span class="p">;</span>			<span class="cm">/* Week Manufactured */</span>
	<span class="n">__u32</span> <span class="n">hfmin</span><span class="p">;</span>			<span class="cm">/* hfreq lower limit (Hz) */</span>
	<span class="n">__u32</span> <span class="n">hfmax</span><span class="p">;</span>			<span class="cm">/* hfreq upper limit (Hz) */</span>
	<span class="n">__u32</span> <span class="n">dclkmin</span><span class="p">;</span>			<span class="cm">/* pixelclock lower limit (Hz) */</span>
	<span class="n">__u32</span> <span class="n">dclkmax</span><span class="p">;</span>			<span class="cm">/* pixelclock upper limit (Hz) */</span>
	<span class="n">__u16</span> <span class="n">input</span><span class="p">;</span>			<span class="cm">/* display type - see FB_DISP_* */</span>
	<span class="n">__u16</span> <span class="n">dpms</span><span class="p">;</span>			<span class="cm">/* DPMS support - see FB_DPMS_ */</span>
	<span class="n">__u16</span> <span class="n">signal</span><span class="p">;</span>			<span class="cm">/* Signal Type - see FB_SIGNAL_* */</span>
	<span class="n">__u16</span> <span class="n">vfmin</span><span class="p">;</span>			<span class="cm">/* vfreq lower limit (Hz) */</span>
	<span class="n">__u16</span> <span class="n">vfmax</span><span class="p">;</span>			<span class="cm">/* vfreq upper limit (Hz) */</span>
	<span class="n">__u16</span> <span class="n">gamma</span><span class="p">;</span>			<span class="cm">/* Gamma - in fractions of 100 */</span>
	<span class="n">__u16</span> <span class="n">gtf</span>	<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>		<span class="cm">/* supports GTF */</span>
	<span class="n">__u16</span> <span class="n">misc</span><span class="p">;</span>			<span class="cm">/* Misc flags - see FB_MISC_* */</span>
	<span class="n">__u8</span>  <span class="n">version</span><span class="p">;</span>			<span class="cm">/* EDID version... */</span>
	<span class="n">__u8</span>  <span class="n">revision</span><span class="p">;</span>			<span class="cm">/* ...and revision */</span>
	<span class="n">__u8</span>  <span class="n">max_x</span><span class="p">;</span>			<span class="cm">/* Maximum horizontal size (cm) */</span>
	<span class="n">__u8</span>  <span class="n">max_y</span><span class="p">;</span>			<span class="cm">/* Maximum vertical size (cm) */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_cmap_user</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">start</span><span class="p">;</span>			<span class="cm">/* First entry	*/</span>
	<span class="n">__u32</span> <span class="n">len</span><span class="p">;</span>			<span class="cm">/* Number of entries */</span>
	<span class="n">__u16</span> <span class="n">__user</span> <span class="o">*</span><span class="n">red</span><span class="p">;</span>		<span class="cm">/* Red values	*/</span>
	<span class="n">__u16</span> <span class="n">__user</span> <span class="o">*</span><span class="n">green</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">__user</span> <span class="o">*</span><span class="n">blue</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">__user</span> <span class="o">*</span><span class="n">transp</span><span class="p">;</span>		<span class="cm">/* transparency, can be NULL */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_image_user</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">dx</span><span class="p">;</span>			<span class="cm">/* Where to place image */</span>
	<span class="n">__u32</span> <span class="n">dy</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">width</span><span class="p">;</span>			<span class="cm">/* Size of image */</span>
	<span class="n">__u32</span> <span class="n">height</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">fg_color</span><span class="p">;</span>			<span class="cm">/* Only used when a mono bitmap */</span>
	<span class="n">__u32</span> <span class="n">bg_color</span><span class="p">;</span>
	<span class="n">__u8</span>  <span class="n">depth</span><span class="p">;</span>			<span class="cm">/* Depth of the image */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>	<span class="cm">/* Pointer to image data */</span>
	<span class="k">struct</span> <span class="n">fb_cmap_user</span> <span class="n">cmap</span><span class="p">;</span>	<span class="cm">/* color map info */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_cursor_user</span> <span class="p">{</span>
	<span class="n">__u16</span> <span class="n">set</span><span class="p">;</span>			<span class="cm">/* what to set */</span>
	<span class="n">__u16</span> <span class="n">enable</span><span class="p">;</span>			<span class="cm">/* cursor on/off */</span>
	<span class="n">__u16</span> <span class="n">rop</span><span class="p">;</span>			<span class="cm">/* bitop operation */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">mask</span><span class="p">;</span>	<span class="cm">/* cursor mask bits */</span>
	<span class="k">struct</span> <span class="n">fbcurpos</span> <span class="n">hot</span><span class="p">;</span>		<span class="cm">/* cursor hot spot */</span>
	<span class="k">struct</span> <span class="n">fb_image_user</span> <span class="n">image</span><span class="p">;</span>	<span class="cm">/* Cursor image */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Register/unregister for framebuffer events</span>
<span class="cm"> */</span>

<span class="cm">/*	The resolution of the passed in fb_info about to change */</span> 
<span class="cp">#define FB_EVENT_MODE_CHANGE		0x01</span>
<span class="cm">/*	The display on this fb_info is beeing suspended, no access to the</span>
<span class="cm"> *	framebuffer is allowed any more after that call returns</span>
<span class="cm"> */</span>
<span class="cp">#define FB_EVENT_SUSPEND		0x02</span>
<span class="cm">/*	The display on this fb_info was resumed, you can restore the display</span>
<span class="cm"> *	if you own it</span>
<span class="cm"> */</span>
<span class="cp">#define FB_EVENT_RESUME			0x03</span>
<span class="cm">/*      An entry from the modelist was removed */</span>
<span class="cp">#define FB_EVENT_MODE_DELETE            0x04</span>
<span class="cm">/*      A driver registered itself */</span>
<span class="cp">#define FB_EVENT_FB_REGISTERED          0x05</span>
<span class="cm">/*      A driver unregistered itself */</span>
<span class="cp">#define FB_EVENT_FB_UNREGISTERED        0x06</span>
<span class="cm">/*      CONSOLE-SPECIFIC: get console to framebuffer mapping */</span>
<span class="cp">#define FB_EVENT_GET_CONSOLE_MAP        0x07</span>
<span class="cm">/*      CONSOLE-SPECIFIC: set console to framebuffer mapping */</span>
<span class="cp">#define FB_EVENT_SET_CONSOLE_MAP        0x08</span>
<span class="cm">/*      A hardware display blank change occurred */</span>
<span class="cp">#define FB_EVENT_BLANK                  0x09</span>
<span class="cm">/*      Private modelist is to be replaced */</span>
<span class="cp">#define FB_EVENT_NEW_MODELIST           0x0A</span>
<span class="cm">/*	The resolution of the passed in fb_info about to change and</span>
<span class="cm">        all vc&#39;s should be changed         */</span>
<span class="cp">#define FB_EVENT_MODE_CHANGE_ALL	0x0B</span>
<span class="cm">/*	A software display blank change occurred */</span>
<span class="cp">#define FB_EVENT_CONBLANK               0x0C</span>
<span class="cm">/*      Get drawing requirements        */</span>
<span class="cp">#define FB_EVENT_GET_REQ                0x0D</span>
<span class="cm">/*      Unbind from the console if possible */</span>
<span class="cp">#define FB_EVENT_FB_UNBIND              0x0E</span>
<span class="cm">/*      CONSOLE-SPECIFIC: remap all consoles to new fb - for vga switcheroo */</span>
<span class="cp">#define FB_EVENT_REMAP_ALL_CONSOLE      0x0F</span>
<span class="cm">/*      A hardware display blank early change occured */</span>
<span class="cp">#define FB_EARLY_EVENT_BLANK		0x10</span>
<span class="cm">/*      A hardware display blank revert early change occured */</span>
<span class="cp">#define FB_R_EARLY_EVENT_BLANK		0x11</span>

<span class="k">struct</span> <span class="n">fb_event</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_blit_caps</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">x</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">y</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_register_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">notifier_block</span> <span class="o">*</span><span class="n">nb</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_unregister_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">notifier_block</span> <span class="o">*</span><span class="n">nb</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_notifier_call_chain</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm"> * Pixmap structure definition</span>
<span class="cm"> *</span>
<span class="cm"> * The purpose of this structure is to translate data</span>
<span class="cm"> * from the hardware independent format of fbdev to what</span>
<span class="cm"> * format the hardware needs.</span>
<span class="cm"> */</span>

<span class="cp">#define FB_PIXMAP_DEFAULT 1     </span><span class="cm">/* used internally by fbcon */</span><span class="cp"></span>
<span class="cp">#define FB_PIXMAP_SYSTEM  2     </span><span class="cm">/* memory is in system RAM  */</span><span class="cp"></span>
<span class="cp">#define FB_PIXMAP_IO      4     </span><span class="cm">/* memory is iomapped       */</span><span class="cp"></span>
<span class="cp">#define FB_PIXMAP_SYNC    256   </span><span class="cm">/* set if GPU can DMA       */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">fb_pixmap</span> <span class="p">{</span>
	<span class="n">u8</span>  <span class="o">*</span><span class="n">addr</span><span class="p">;</span>		<span class="cm">/* pointer to memory			*/</span>
	<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>		<span class="cm">/* size of buffer in bytes		*/</span>
	<span class="n">u32</span> <span class="n">offset</span><span class="p">;</span>		<span class="cm">/* current offset to buffer		*/</span>
	<span class="n">u32</span> <span class="n">buf_align</span><span class="p">;</span>		<span class="cm">/* byte alignment of each bitmap	*/</span>
	<span class="n">u32</span> <span class="n">scan_align</span><span class="p">;</span>		<span class="cm">/* alignment per scanline		*/</span>
	<span class="n">u32</span> <span class="n">access_align</span><span class="p">;</span>	<span class="cm">/* alignment per read/write (bits)	*/</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>		<span class="cm">/* see FB_PIXMAP_*			*/</span>
	<span class="n">u32</span> <span class="n">blit_x</span><span class="p">;</span>             <span class="cm">/* supported bit block dimensions (1-32)*/</span>
	<span class="n">u32</span> <span class="n">blit_y</span><span class="p">;</span>             <span class="cm">/* Format: blit_x = 1 &lt;&lt; (width - 1)    */</span>
	                        <span class="cm">/*         blit_y = 1 &lt;&lt; (height - 1)   */</span>
	                        <span class="cm">/* if 0, will be set to 0xffffffff (all)*/</span>
	<span class="cm">/* access methods */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">writeio</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">readio</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_FB_DEFERRED_IO</span>
<span class="k">struct</span> <span class="n">fb_deferred_io</span> <span class="p">{</span>
	<span class="cm">/* delay between mkwrite and deferred handler */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">delay</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">lock</span><span class="p">;</span> <span class="cm">/* mutex that protects the page list */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">pagelist</span><span class="p">;</span> <span class="cm">/* list of touched pages */</span>
	<span class="cm">/* callback */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">first_io</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">deferred_io</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">pagelist</span><span class="p">);</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Frame buffer operations</span>
<span class="cm"> *</span>
<span class="cm"> * LOCKING NOTE: those functions must _ALL_ be called with the console</span>
<span class="cm"> * semaphore held, this is the only suitable locking mechanism we have</span>
<span class="cm"> * in 2.6. Some may be called at interrupt time at this point though.</span>
<span class="cm"> *</span>
<span class="cm"> * The exception to this is the debug related hooks.  Putting the fb</span>
<span class="cm"> * into a debug state (e.g. flipping to the kernel console) and restoring</span>
<span class="cm"> * it must be done in a lock-free manner, so low level drivers should</span>
<span class="cm"> * keep track of the initial console (if applicable) and may need to</span>
<span class="cm"> * perform direct, unlocked hardware writes in these hooks.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">fb_ops</span> <span class="p">{</span>
	<span class="cm">/* open/release and usage marking */</span>
	<span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="n">owner</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_open</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">user</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_release</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">user</span><span class="p">);</span>

	<span class="cm">/* For framebuffers with strange non linear layouts or that do not</span>
<span class="cm">	 * work with normal memory mapped access</span>
<span class="cm">	 */</span>
	<span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_read</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
			   <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">);</span>
	<span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_write</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
			    <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">);</span>

	<span class="cm">/* checks var and eventually tweaks it to something supported,</span>
<span class="cm">	 * DO NOT MODIFY PAR */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_check_var</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

	<span class="cm">/* set the video mode according to info-&gt;var */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_set_par</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

	<span class="cm">/* set color register */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_setcolreg</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="n">regno</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">red</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">green</span><span class="p">,</span>
			    <span class="kt">unsigned</span> <span class="n">blue</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">transp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

	<span class="cm">/* set color registers in batch */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_setcmap</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_cmap</span> <span class="o">*</span><span class="n">cmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

	<span class="cm">/* blank display */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_blank</span><span class="p">)(</span><span class="kt">int</span> <span class="n">blank</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

	<span class="cm">/* pan display */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_pan_display</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

	<span class="cm">/* Draws a rectangle */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_fillrect</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_fillrect</span> <span class="o">*</span><span class="n">rect</span><span class="p">);</span>
	<span class="cm">/* Copy data from area to another */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_copyarea</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_copyarea</span> <span class="o">*</span><span class="n">region</span><span class="p">);</span>
	<span class="cm">/* Draws a image to the display */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_imageblit</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_image</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>

	<span class="cm">/* Draws cursor */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_cursor</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_cursor</span> <span class="o">*</span><span class="n">cursor</span><span class="p">);</span>

	<span class="cm">/* Rotates the display */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_rotate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">angle</span><span class="p">);</span>

	<span class="cm">/* wait for blit idle, optional */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_sync</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

	<span class="cm">/* perform fb specific ioctl (optional) */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_ioctl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>

	<span class="cm">/* Handle 32bit compat ioctl (optional) */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_compat_ioctl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">cmd</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>

	<span class="cm">/* perform fb specific mmap */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_mmap</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">);</span>

	<span class="cm">/* get capability given var */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_get_caps</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_blit_caps</span> <span class="o">*</span><span class="n">caps</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">);</span>

	<span class="cm">/* teardown any resources to do with this framebuffer */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_destroy</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

	<span class="cm">/* called at KDB enter and leave time to prepare the console */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_debug_enter</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_debug_leave</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_FB_TILEBLITTING</span>
<span class="cp">#define FB_TILE_CURSOR_NONE        0</span>
<span class="cp">#define FB_TILE_CURSOR_UNDERLINE   1</span>
<span class="cp">#define FB_TILE_CURSOR_LOWER_THIRD 2</span>
<span class="cp">#define FB_TILE_CURSOR_LOWER_HALF  3</span>
<span class="cp">#define FB_TILE_CURSOR_TWO_THIRDS  4</span>
<span class="cp">#define FB_TILE_CURSOR_BLOCK       5</span>

<span class="k">struct</span> <span class="n">fb_tilemap</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">width</span><span class="p">;</span>                <span class="cm">/* width of each tile in pixels */</span>
	<span class="n">__u32</span> <span class="n">height</span><span class="p">;</span>               <span class="cm">/* height of each tile in scanlines */</span>
	<span class="n">__u32</span> <span class="n">depth</span><span class="p">;</span>                <span class="cm">/* color depth of each tile */</span>
	<span class="n">__u32</span> <span class="n">length</span><span class="p">;</span>               <span class="cm">/* number of tiles in the map */</span>
	<span class="k">const</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>           <span class="cm">/* actual tile map: a bitmap array, packed</span>
<span class="cm">				       to the nearest byte */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_tilerect</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">sx</span><span class="p">;</span>                   <span class="cm">/* origin in the x-axis */</span>
	<span class="n">__u32</span> <span class="n">sy</span><span class="p">;</span>                   <span class="cm">/* origin in the y-axis */</span>
	<span class="n">__u32</span> <span class="n">width</span><span class="p">;</span>                <span class="cm">/* number of tiles in the x-axis */</span>
	<span class="n">__u32</span> <span class="n">height</span><span class="p">;</span>               <span class="cm">/* number of tiles in the y-axis */</span>
	<span class="n">__u32</span> <span class="n">index</span><span class="p">;</span>                <span class="cm">/* what tile to use: index to tile map */</span>
	<span class="n">__u32</span> <span class="n">fg</span><span class="p">;</span>                   <span class="cm">/* foreground color */</span>
	<span class="n">__u32</span> <span class="n">bg</span><span class="p">;</span>                   <span class="cm">/* background color */</span>
	<span class="n">__u32</span> <span class="n">rop</span><span class="p">;</span>                  <span class="cm">/* raster operation */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_tilearea</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">sx</span><span class="p">;</span>                   <span class="cm">/* source origin in the x-axis */</span>
	<span class="n">__u32</span> <span class="n">sy</span><span class="p">;</span>                   <span class="cm">/* source origin in the y-axis */</span>
	<span class="n">__u32</span> <span class="n">dx</span><span class="p">;</span>                   <span class="cm">/* destination origin in the x-axis */</span>
	<span class="n">__u32</span> <span class="n">dy</span><span class="p">;</span>                   <span class="cm">/* destination origin in the y-axis */</span>
	<span class="n">__u32</span> <span class="n">width</span><span class="p">;</span>                <span class="cm">/* number of tiles in the x-axis */</span>
	<span class="n">__u32</span> <span class="n">height</span><span class="p">;</span>               <span class="cm">/* number of tiles in the y-axis */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_tileblit</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">sx</span><span class="p">;</span>                   <span class="cm">/* origin in the x-axis */</span>
	<span class="n">__u32</span> <span class="n">sy</span><span class="p">;</span>                   <span class="cm">/* origin in the y-axis */</span>
	<span class="n">__u32</span> <span class="n">width</span><span class="p">;</span>                <span class="cm">/* number of tiles in the x-axis */</span>
	<span class="n">__u32</span> <span class="n">height</span><span class="p">;</span>               <span class="cm">/* number of tiles in the y-axis */</span>
	<span class="n">__u32</span> <span class="n">fg</span><span class="p">;</span>                   <span class="cm">/* foreground color */</span>
	<span class="n">__u32</span> <span class="n">bg</span><span class="p">;</span>                   <span class="cm">/* background color */</span>
	<span class="n">__u32</span> <span class="n">length</span><span class="p">;</span>               <span class="cm">/* number of tiles to draw */</span>
	<span class="n">__u32</span> <span class="o">*</span><span class="n">indices</span><span class="p">;</span>             <span class="cm">/* array of indices to tile map */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_tilecursor</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">sx</span><span class="p">;</span>                   <span class="cm">/* cursor position in the x-axis */</span>
	<span class="n">__u32</span> <span class="n">sy</span><span class="p">;</span>                   <span class="cm">/* cursor position in the y-axis */</span>
	<span class="n">__u32</span> <span class="n">mode</span><span class="p">;</span>                 <span class="cm">/* 0 = erase, 1 = draw */</span>
	<span class="n">__u32</span> <span class="n">shape</span><span class="p">;</span>                <span class="cm">/* see FB_TILE_CURSOR_* */</span>
	<span class="n">__u32</span> <span class="n">fg</span><span class="p">;</span>                   <span class="cm">/* foreground color */</span>
	<span class="n">__u32</span> <span class="n">bg</span><span class="p">;</span>                   <span class="cm">/* background color */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fb_tile_ops</span> <span class="p">{</span>
	<span class="cm">/* set tile characteristics */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_settile</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_tilemap</span> <span class="o">*</span><span class="n">map</span><span class="p">);</span>

	<span class="cm">/* all dimensions from hereon are in terms of tiles */</span>

	<span class="cm">/* move a rectangular region of tiles from one area to another*/</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_tilecopy</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_tilearea</span> <span class="o">*</span><span class="n">area</span><span class="p">);</span>
	<span class="cm">/* fill a rectangular region with a tile */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_tilefill</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_tilerect</span> <span class="o">*</span><span class="n">rect</span><span class="p">);</span>
	<span class="cm">/* copy an array of tiles */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_tileblit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_tileblit</span> <span class="o">*</span><span class="n">blit</span><span class="p">);</span>
	<span class="cm">/* cursor */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_tilecursor</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">fb_tilecursor</span> <span class="o">*</span><span class="n">cursor</span><span class="p">);</span>
	<span class="cm">/* get maximum length of the tile map */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">fb_get_tilemax</span><span class="p">)(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="p">};</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_TILEBLITTING */</span><span class="cp"></span>

<span class="cm">/* FBINFO_* = fb_info.flags bit flags */</span>
<span class="cp">#define FBINFO_MODULE		0x0001	</span><span class="cm">/* Low-level driver is a module */</span><span class="cp"></span>
<span class="cp">#define FBINFO_HWACCEL_DISABLED	0x0002</span>
	<span class="cm">/* When FBINFO_HWACCEL_DISABLED is set:</span>
<span class="cm">	 *  Hardware acceleration is turned off.  Software implementations</span>
<span class="cm">	 *  of required functions (copyarea(), fillrect(), and imageblit())</span>
<span class="cm">	 *  takes over; acceleration engine should be in a quiescent state */</span>

<span class="cm">/* hints */</span>
<span class="cp">#define FBINFO_VIRTFB		0x0004 </span><span class="cm">/* FB is System RAM, not device. */</span><span class="cp"></span>
<span class="cp">#define FBINFO_PARTIAL_PAN_OK	0x0040 </span><span class="cm">/* otw use pan only for double-buffering */</span><span class="cp"></span>
<span class="cp">#define FBINFO_READS_FAST	0x0080 </span><span class="cm">/* soft-copy faster than rendering */</span><span class="cp"></span>

<span class="cm">/* hardware supported ops */</span>
<span class="cm">/*  semantics: when a bit is set, it indicates that the operation is</span>
<span class="cm"> *   accelerated by hardware.</span>
<span class="cm"> *  required functions will still work even if the bit is not set.</span>
<span class="cm"> *  optional functions may not even exist if the flag bit is not set.</span>
<span class="cm"> */</span>
<span class="cp">#define FBINFO_HWACCEL_NONE		0x0000</span>
<span class="cp">#define FBINFO_HWACCEL_COPYAREA		0x0100 </span><span class="cm">/* required */</span><span class="cp"></span>
<span class="cp">#define FBINFO_HWACCEL_FILLRECT		0x0200 </span><span class="cm">/* required */</span><span class="cp"></span>
<span class="cp">#define FBINFO_HWACCEL_IMAGEBLIT	0x0400 </span><span class="cm">/* required */</span><span class="cp"></span>
<span class="cp">#define FBINFO_HWACCEL_ROTATE		0x0800 </span><span class="cm">/* optional */</span><span class="cp"></span>
<span class="cp">#define FBINFO_HWACCEL_XPAN		0x1000 </span><span class="cm">/* optional */</span><span class="cp"></span>
<span class="cp">#define FBINFO_HWACCEL_YPAN		0x2000 </span><span class="cm">/* optional */</span><span class="cp"></span>
<span class="cp">#define FBINFO_HWACCEL_YWRAP		0x4000 </span><span class="cm">/* optional */</span><span class="cp"></span>

<span class="cp">#define FBINFO_MISC_USEREVENT          0x10000 </span><span class="cm">/* event request</span>
<span class="cm">						  from userspace */</span><span class="cp"></span>
<span class="cp">#define FBINFO_MISC_TILEBLITTING       0x20000 </span><span class="cm">/* use tile blitting */</span><span class="cp"></span>

<span class="cm">/* A driver may set this flag to indicate that it does want a set_par to be</span>
<span class="cm"> * called every time when fbcon_switch is executed. The advantage is that with</span>
<span class="cm"> * this flag set you can really be sure that set_par is always called before</span>
<span class="cm"> * any of the functions dependent on the correct hardware state or altering</span>
<span class="cm"> * that state, even if you are using some broken X releases. The disadvantage</span>
<span class="cm"> * is that it introduces unwanted delays to every console switch if set_par</span>
<span class="cm"> * is slow. It is a good idea to try this flag in the drivers initialization</span>
<span class="cm"> * code whenever there is a bug report related to switching between X and the</span>
<span class="cm"> * framebuffer console.</span>
<span class="cm"> */</span>
<span class="cp">#define FBINFO_MISC_ALWAYS_SETPAR   0x40000</span>

<span class="cm">/* where the fb is a firmware driver, and can be replaced with a proper one */</span>
<span class="cp">#define FBINFO_MISC_FIRMWARE        0x80000</span>
<span class="cm">/*</span>
<span class="cm"> * Host and GPU endianness differ.</span>
<span class="cm"> */</span>
<span class="cp">#define FBINFO_FOREIGN_ENDIAN	0x100000</span>
<span class="cm">/*</span>
<span class="cm"> * Big endian math. This is the same flags as above, but with different</span>
<span class="cm"> * meaning, it is set by the fb subsystem depending FOREIGN_ENDIAN flag</span>
<span class="cm"> * and host endianness. Drivers should not use this flag.</span>
<span class="cm"> */</span>
<span class="cp">#define FBINFO_BE_MATH  0x100000</span>

<span class="cm">/* report to the VT layer that this fb driver can accept forced console</span>
<span class="cm">   output like oopses */</span>
<span class="cp">#define FBINFO_CAN_FORCE_OUTPUT     0x200000</span>

<span class="k">struct</span> <span class="n">fb_info</span> <span class="p">{</span>
	<span class="n">atomic_t</span> <span class="n">count</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">node</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">lock</span><span class="p">;</span>		<span class="cm">/* Lock for open/release/ioctl funcs */</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">mm_lock</span><span class="p">;</span>		<span class="cm">/* Lock for fb_mmap and smem_* fields */</span>
	<span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="n">var</span><span class="p">;</span>	<span class="cm">/* Current var */</span>
	<span class="k">struct</span> <span class="n">fb_fix_screeninfo</span> <span class="n">fix</span><span class="p">;</span>	<span class="cm">/* Current fix */</span>
	<span class="k">struct</span> <span class="n">fb_monspecs</span> <span class="n">monspecs</span><span class="p">;</span>	<span class="cm">/* Current Monitor specs */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">queue</span><span class="p">;</span>	<span class="cm">/* Framebuffer event queue */</span>
	<span class="k">struct</span> <span class="n">fb_pixmap</span> <span class="n">pixmap</span><span class="p">;</span>	<span class="cm">/* Image hardware mapper */</span>
	<span class="k">struct</span> <span class="n">fb_pixmap</span> <span class="n">sprite</span><span class="p">;</span>	<span class="cm">/* Cursor hardware mapper */</span>
	<span class="k">struct</span> <span class="n">fb_cmap</span> <span class="n">cmap</span><span class="p">;</span>		<span class="cm">/* Current cmap */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">modelist</span><span class="p">;</span>      <span class="cm">/* mode list */</span>
	<span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">;</span>	<span class="cm">/* current mode */</span>

<span class="cp">#ifdef CONFIG_FB_BACKLIGHT</span>
	<span class="cm">/* assigned backlight device */</span>
	<span class="cm">/* set before framebuffer registration, </span>
<span class="cm">	   remove after unregister */</span>
	<span class="k">struct</span> <span class="n">backlight_device</span> <span class="o">*</span><span class="n">bl_dev</span><span class="p">;</span>

	<span class="cm">/* Backlight level curve */</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">bl_curve_mutex</span><span class="p">;</span>	
	<span class="n">u8</span> <span class="n">bl_curve</span><span class="p">[</span><span class="n">FB_BACKLIGHT_LEVELS</span><span class="p">];</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_FB_DEFERRED_IO</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">deferred_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_deferred_io</span> <span class="o">*</span><span class="n">fbdefio</span><span class="p">;</span>
<span class="cp">#endif</span>

	<span class="k">struct</span> <span class="n">fb_ops</span> <span class="o">*</span><span class="n">fbops</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">device</span><span class="p">;</span>		<span class="cm">/* This is the parent */</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>		<span class="cm">/* This is this fb device */</span>
	<span class="kt">int</span> <span class="n">class_flag</span><span class="p">;</span>                    <span class="cm">/* private sysfs flags */</span>
<span class="cp">#ifdef CONFIG_FB_TILEBLITTING</span>
	<span class="k">struct</span> <span class="n">fb_tile_ops</span> <span class="o">*</span><span class="n">tileops</span><span class="p">;</span>    <span class="cm">/* Tile Blitting */</span>
<span class="cp">#endif</span>
	<span class="kt">char</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">screen_base</span><span class="p">;</span>	<span class="cm">/* Virtual address */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">screen_size</span><span class="p">;</span>	<span class="cm">/* Amount of ioremapped VRAM or 0 */</span> 
	<span class="kt">void</span> <span class="o">*</span><span class="n">pseudo_palette</span><span class="p">;</span>		<span class="cm">/* Fake palette of 16 colors */</span> 
<span class="cp">#define FBINFO_STATE_RUNNING	0</span>
<span class="cp">#define FBINFO_STATE_SUSPENDED	1</span>
	<span class="n">u32</span> <span class="n">state</span><span class="p">;</span>			<span class="cm">/* Hardware state i.e suspend */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">fbcon_par</span><span class="p">;</span>                <span class="cm">/* fbcon use-only private area */</span>
	<span class="cm">/* From here on everything is device dependent */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">par</span><span class="p">;</span>
	<span class="cm">/* we need the PCI or similar aperture base/size not</span>
<span class="cm">	   smem_start/size as smem_start may just be an object</span>
<span class="cm">	   allocated inside the aperture so may not actually overlap */</span>
	<span class="k">struct</span> <span class="n">apertures_struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">aperture</span> <span class="p">{</span>
			<span class="n">resource_size_t</span> <span class="n">base</span><span class="p">;</span>
			<span class="n">resource_size_t</span> <span class="n">size</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="p">}</span> <span class="o">*</span><span class="n">apertures</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">apertures_struct</span> <span class="o">*</span><span class="nf">alloc_apertures</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max_num</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">apertures_struct</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">apertures_struct</span><span class="p">)</span>
			<span class="o">+</span> <span class="n">max_num</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">aperture</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">a</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">a</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">max_num</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef MODULE</span>
<span class="cp">#define FBINFO_DEFAULT	FBINFO_MODULE</span>
<span class="cp">#else</span>
<span class="cp">#define FBINFO_DEFAULT	0</span>
<span class="cp">#endif</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>This will go away</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define FBINFO_FLAG_MODULE	FBINFO_MODULE</span>
<span class="cp">#define FBINFO_FLAG_DEFAULT	FBINFO_DEFAULT</span>

<span class="cm">/* This will go away</span>
<span class="cm"> * fbset currently hacks in FB_ACCELF_TEXT into var.accel_flags</span>
<span class="cm"> * when it wants to turn the acceleration engine on.  This is</span>
<span class="cm"> * really a separate operation, and should be modified via sysfs.</span>
<span class="cm"> *  But for now, we leave it broken with the following define</span>
<span class="cm"> */</span>
<span class="cp">#define STUPID_ACCELF_TEXT_SHIT</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>This will go away</p></td><td class="code"><div class="highlight"><pre><span class="cp">#if defined(__sparc__)</span>

<span class="cm">/* We map all of our framebuffers such that big-endian accesses</span>
<span class="cm"> * are what we want, so the following is sufficient.</span>
<span class="cm"> */</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>This will go away</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define fb_readb sbus_readb</span>
<span class="cp">#define fb_readw sbus_readw</span>
<span class="cp">#define fb_readl sbus_readl</span>
<span class="cp">#define fb_readq sbus_readq</span>
<span class="cp">#define fb_writeb sbus_writeb</span>
<span class="cp">#define fb_writew sbus_writew</span>
<span class="cp">#define fb_writel sbus_writel</span>
<span class="cp">#define fb_writeq sbus_writeq</span>
<span class="cp">#define fb_memset sbus_memset_io</span>
<span class="cp">#define fb_memcpy_fromfb sbus_memcpy_fromio</span>
<span class="cp">#define fb_memcpy_tofb sbus_memcpy_toio</span>

<span class="cp">#elif defined(__i386__) || defined(__alpha__) || defined(__x86_64__) || defined(__hppa__) || defined(__sh__) || defined(__powerpc__) || defined(__avr32__) || defined(__bfin__)</span>

<span class="cp">#define fb_readb __raw_readb</span>
<span class="cp">#define fb_readw __raw_readw</span>
<span class="cp">#define fb_readl __raw_readl</span>
<span class="cp">#define fb_readq __raw_readq</span>
<span class="cp">#define fb_writeb __raw_writeb</span>
<span class="cp">#define fb_writew __raw_writew</span>
<span class="cp">#define fb_writel __raw_writel</span>
<span class="cp">#define fb_writeq __raw_writeq</span>
<span class="cp">#define fb_memset memset_io</span>
<span class="cp">#define fb_memcpy_fromfb memcpy_fromio</span>
<span class="cp">#define fb_memcpy_tofb memcpy_toio</span>

<span class="cp">#else</span>

<span class="cp">#define fb_readb(addr) (*(volatile u8 *) (addr))</span>
<span class="cp">#define fb_readw(addr) (*(volatile u16 *) (addr))</span>
<span class="cp">#define fb_readl(addr) (*(volatile u32 *) (addr))</span>
<span class="cp">#define fb_readq(addr) (*(volatile u64 *) (addr))</span>
<span class="cp">#define fb_writeb(b,addr) (*(volatile u8 *) (addr) = (b))</span>
<span class="cp">#define fb_writew(b,addr) (*(volatile u16 *) (addr) = (b))</span>
<span class="cp">#define fb_writel(b,addr) (*(volatile u32 *) (addr) = (b))</span>
<span class="cp">#define fb_writeq(b,addr) (*(volatile u64 *) (addr) = (b))</span>
<span class="cp">#define fb_memset memset</span>
<span class="cp">#define fb_memcpy_fromfb memcpy</span>
<span class="cp">#define fb_memcpy_tofb memcpy</span>

<span class="cp">#endif</span>

<span class="cp">#define FB_LEFT_POS(p, bpp)          (fb_be_math(p) ? (32 - (bpp)) : 0)</span>
<span class="cp">#define FB_SHIFT_HIGH(p, val, bits)  (fb_be_math(p) ? (val) &gt;&gt; (bits) : \</span>
<span class="cp">						      (val) &lt;&lt; (bits))</span>
<span class="cp">#define FB_SHIFT_LOW(p, val, bits)   (fb_be_math(p) ? (val) &lt;&lt; (bits) : \</span>
<span class="cp">						      (val) &gt;&gt; (bits))</span>

    <span class="cm">/*</span>
<span class="cm">     *  `Generic&#39; versions of the frame buffer device operations</span>
<span class="cm">     */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_set_var</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">);</span> 
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_pan_display</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">);</span> 
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_blank</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">blank</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cfb_fillrect</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_fillrect</span> <span class="o">*</span><span class="n">rect</span><span class="p">);</span> 
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cfb_copyarea</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_copyarea</span> <span class="o">*</span><span class="n">area</span><span class="p">);</span> 
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cfb_imageblit</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_image</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm"> * Drawing operations where framebuffer is in system RAM</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sys_fillrect</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_fillrect</span> <span class="o">*</span><span class="n">rect</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sys_copyarea</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_copyarea</span> <span class="o">*</span><span class="n">area</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sys_imageblit</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_image</span> <span class="o">*</span><span class="n">image</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">ssize_t</span> <span class="n">fb_sys_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
			   <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">ssize_t</span> <span class="n">fb_sys_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
			    <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">);</span>

<span class="cm">/* drivers/video/fbmem.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">register_framebuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">unregister_framebuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">unlink_framebuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">remove_conflicting_framebuffers</span><span class="p">(</span><span class="k">struct</span> <span class="n">apertures_struct</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="n">bool</span> <span class="n">primary</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_prepare_logo</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rotate</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_show_logo</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rotate</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fb_get_buffer_offset</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_pixmap</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">u32</span> <span class="n">size</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_pad_unaligned_buffer</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="n">u32</span> <span class="n">d_pitch</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="n">u32</span> <span class="n">idx</span><span class="p">,</span>
				<span class="n">u32</span> <span class="n">height</span><span class="p">,</span> <span class="n">u32</span> <span class="n">shift_high</span><span class="p">,</span> <span class="n">u32</span> <span class="n">shift_low</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mod</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_pad_aligned_buffer</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="n">u32</span> <span class="n">d_pitch</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="n">u32</span> <span class="n">s_pitch</span><span class="p">,</span> <span class="n">u32</span> <span class="n">height</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_set_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="kt">int</span> <span class="n">state</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_get_color_depth</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">fb_fix_screeninfo</span> <span class="o">*</span><span class="n">fix</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_get_options</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">option</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_new_modelist</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">registered_fb</span><span class="p">[</span><span class="n">FB_MAX</span><span class="p">];</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">num_registered_fb</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">class</span> <span class="o">*</span><span class="n">fb_class</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">lock_fb_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">unlock_fb_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__fb_pad_aligned_buffer</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="n">u32</span> <span class="n">d_pitch</span><span class="p">,</span>
					   <span class="n">u8</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="n">u32</span> <span class="n">s_pitch</span><span class="p">,</span> <span class="n">u32</span> <span class="n">height</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

	<span class="n">d_pitch</span> <span class="o">-=</span> <span class="n">s_pitch</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">height</span><span class="p">;</span> <span class="n">i</span><span class="o">--</span><span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* s_pitch is a few bytes at the most, memcpy is suboptimal */</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">s_pitch</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">src</span><span class="o">++</span><span class="p">;</span>
		<span class="n">dst</span> <span class="o">+=</span> <span class="n">d_pitch</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* drivers/video/fb_defio.c */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_deferred_io_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_deferred_io_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_deferred_io_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_deferred_io_fsync</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="n">loff_t</span> <span class="n">start</span><span class="p">,</span>
				<span class="n">loff_t</span> <span class="n">end</span><span class="p">,</span> <span class="kt">int</span> <span class="n">datasync</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">fb_be_math</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_FB_FOREIGN_ENDIAN</span>
<span class="cp">#if defined(CONFIG_FB_BOTH_ENDIAN)</span>
	<span class="k">return</span> <span class="n">info</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">FBINFO_BE_MATH</span><span class="p">;</span>
<span class="cp">#elif defined(CONFIG_FB_BIG_ENDIAN)</span>
	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="cp">#elif defined(CONFIG_FB_LITTLE_ENDIAN)</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_BOTH_ENDIAN */</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="cp">#ifdef __BIG_ENDIAN</span>
	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="cp">#else</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* __BIG_ENDIAN */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_FB_FOREIGN_ENDIAN */</span><span class="cp"></span>
<span class="p">}</span>

<span class="cm">/* drivers/video/fbsysfs.c */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">framebuffer_alloc</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">framebuffer_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_init_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_cleanup_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">head</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_bl_default_curve</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">,</span> <span class="n">u8</span> <span class="n">off</span><span class="p">,</span> <span class="n">u8</span> <span class="n">min</span><span class="p">,</span> <span class="n">u8</span> <span class="n">max</span><span class="p">);</span>

<span class="cm">/* drivers/video/fbmon.c */</span>
<span class="cp">#define FB_MAXTIMINGS		0</span>
<span class="cp">#define FB_VSYNCTIMINGS		1</span>
<span class="cp">#define FB_HSYNCTIMINGS		2</span>
<span class="cp">#define FB_DCLKTIMINGS		3</span>
<span class="cp">#define FB_IGNOREMON		0x100</span>

<span class="cp">#define FB_MODE_IS_UNKNOWN	0</span>
<span class="cp">#define FB_MODE_IS_DETAILED	1</span>
<span class="cp">#define FB_MODE_IS_STANDARD	2</span>
<span class="cp">#define FB_MODE_IS_VESA		4</span>
<span class="cp">#define FB_MODE_IS_CALCULATED	8</span>
<span class="cp">#define FB_MODE_IS_FIRST	16</span>
<span class="cp">#define FB_MODE_IS_FROM_VAR     32</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">fbmon_dpms</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_get_mode</span><span class="p">(</span><span class="kt">int</span> <span class="n">flags</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_validate_mode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_parse_edid</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">edid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fb_firmware_edid</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">device</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_edid_to_monspecs</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">edid</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">fb_monspecs</span> <span class="o">*</span><span class="n">specs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_edid_add_monspecs</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">edid</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">fb_monspecs</span> <span class="o">*</span><span class="n">specs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_destroy_modedb</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">modedb</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_find_mode_cvt</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">margins</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rb</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fb_ddc_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>

<span class="cm">/* drivers/video/modedb.c */</span>
<span class="cp">#define VESA_MODEDB_SIZE 34</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_var_to_videomode</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span>
				<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_videomode_to_var</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
				<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_mode_is_equal</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode1</span><span class="p">,</span>
			    <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode2</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_add_videomode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_delete_videomode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">fb_match_mode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
						<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">fb_find_best_mode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
						    <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">fb_find_nearest_mode</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">mode</span><span class="p">,</span>
						       <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_destroy_modelist</span><span class="p">(</span><span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_videomode_to_modelist</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">modedb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">fb_find_best_display</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_monspecs</span> <span class="o">*</span><span class="n">specs</span><span class="p">,</span>
						       <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">head</span><span class="p">);</span>

<span class="cm">/* drivers/video/fbcmap.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_alloc_cmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_cmap</span> <span class="o">*</span><span class="n">cmap</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">transp</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_alloc_cmap_gfp</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_cmap</span> <span class="o">*</span><span class="n">cmap</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">transp</span><span class="p">,</span> <span class="n">gfp_t</span> <span class="n">flags</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_dealloc_cmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_cmap</span> <span class="o">*</span><span class="n">cmap</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_copy_cmap</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_cmap</span> <span class="o">*</span><span class="n">from</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_cmap</span> <span class="o">*</span><span class="n">to</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_cmap_to_user</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">fb_cmap</span> <span class="o">*</span><span class="n">from</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_cmap_user</span> <span class="o">*</span><span class="n">to</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_set_cmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_cmap</span> <span class="o">*</span><span class="n">cmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_set_user_cmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_cmap_user</span> <span class="o">*</span><span class="n">cmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">fb_info</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_cmap</span> <span class="o">*</span><span class="n">fb_default_cmap</span><span class="p">(</span><span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fb_invert_cmaps</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">fb_videomode</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>	<span class="cm">/* optional */</span>
	<span class="n">u32</span> <span class="n">refresh</span><span class="p">;</span>		<span class="cm">/* optional */</span>
	<span class="n">u32</span> <span class="n">xres</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">yres</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pixclock</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">left_margin</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">right_margin</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">upper_margin</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lower_margin</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">hsync_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">vsync_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sync</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">vmode</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flag</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fb_mode_option</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">vesa_modes</span><span class="p">[];</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">cea_modes</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

<span class="k">struct</span> <span class="n">fb_modelist</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fb_videomode</span> <span class="n">mode</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">fb_find_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">fb_var_screeninfo</span> <span class="o">*</span><span class="n">var</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">fb_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mode_option</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">db</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dbsize</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">fb_videomode</span> <span class="o">*</span><span class="n">default_mode</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">default_bpp</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _LINUX_FB_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
