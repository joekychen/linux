<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › drbd.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>drbd.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">  drbd.h</span>
<span class="cm">  Kernel module for 2.6.x Kernels</span>

<span class="cm">  This file is part of DRBD by Philipp Reisner and Lars Ellenberg.</span>

<span class="cm">  Copyright (C) 2001-2008, LINBIT Information Technologies GmbH.</span>
<span class="cm">  Copyright (C) 2001-2008, Philipp Reisner &lt;philipp.reisner@linbit.com&gt;.</span>
<span class="cm">  Copyright (C) 2001-2008, Lars Ellenberg &lt;lars.ellenberg@linbit.com&gt;.</span>

<span class="cm">  drbd is free software; you can redistribute it and/or modify</span>
<span class="cm">  it under the terms of the GNU General Public License as published by</span>
<span class="cm">  the Free Software Foundation; either version 2, or (at your option)</span>
<span class="cm">  any later version.</span>

<span class="cm">  drbd is distributed in the hope that it will be useful,</span>
<span class="cm">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">  GNU General Public License for more details.</span>

<span class="cm">  You should have received a copy of the GNU General Public License</span>
<span class="cm">  along with drbd; see the file COPYING.  If not, write to</span>
<span class="cm">  the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.</span>

<span class="cm">*/</span>
<span class="cp">#ifndef DRBD_H</span>
<span class="cp">#define DRBD_H</span>
<span class="cp">#include &lt;linux/connector.h&gt;</span>
<span class="cp">#include &lt;asm/types.h&gt;</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;asm/byteorder.h&gt;</span>
<span class="cp">#else</span>
<span class="cp">#include &lt;sys/types.h&gt;</span>
<span class="cp">#include &lt;sys/wait.h&gt;</span>
<span class="cp">#include &lt;limits.h&gt;</span>

<span class="cm">/* Although the Linux source code makes a difference between</span>
<span class="cm">   generic endianness and the bitfields&#39; endianness, there is no</span>
<span class="cm">   architecture as of Linux-2.6.24-rc4 where the bitfields&#39; endianness</span>
<span class="cm">   does not match the generic endianness. */</span>

<span class="cp">#if __BYTE_ORDER == __LITTLE_ENDIAN</span>
<span class="cp">#define __LITTLE_ENDIAN_BITFIELD</span>
<span class="cp">#elif __BYTE_ORDER == __BIG_ENDIAN</span>
<span class="cp">#define __BIG_ENDIAN_BITFIELD</span>
<span class="cp">#else</span>
<span class="cp"># error &quot;sorry, weird endianness on this box&quot;</span>
<span class="cp">#endif</span>

<span class="cp">#endif</span>


<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">drbd_buildtag</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#define REL_VERSION &quot;8.3.13&quot;</span>
<span class="cp">#define API_VERSION 88</span>
<span class="cp">#define PRO_VERSION_MIN 86</span>
<span class="cp">#define PRO_VERSION_MAX 96</span>


<span class="k">enum</span> <span class="n">drbd_io_error_p</span> <span class="p">{</span>
	<span class="n">EP_PASS_ON</span><span class="p">,</span> <span class="cm">/* FIXME should the better be named &quot;Ignore&quot;? */</span>
	<span class="n">EP_CALL_HELPER</span><span class="p">,</span>
	<span class="n">EP_DETACH</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">drbd_fencing_p</span> <span class="p">{</span>
	<span class="n">FP_DONT_CARE</span><span class="p">,</span>
	<span class="n">FP_RESOURCE</span><span class="p">,</span>
	<span class="n">FP_STONITH</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">drbd_disconnect_p</span> <span class="p">{</span>
	<span class="n">DP_RECONNECT</span><span class="p">,</span>
	<span class="n">DP_DROP_NET_CONF</span><span class="p">,</span>
	<span class="n">DP_FREEZE_IO</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">drbd_after_sb_p</span> <span class="p">{</span>
	<span class="n">ASB_DISCONNECT</span><span class="p">,</span>
	<span class="n">ASB_DISCARD_YOUNGER_PRI</span><span class="p">,</span>
	<span class="n">ASB_DISCARD_OLDER_PRI</span><span class="p">,</span>
	<span class="n">ASB_DISCARD_ZERO_CHG</span><span class="p">,</span>
	<span class="n">ASB_DISCARD_LEAST_CHG</span><span class="p">,</span>
	<span class="n">ASB_DISCARD_LOCAL</span><span class="p">,</span>
	<span class="n">ASB_DISCARD_REMOTE</span><span class="p">,</span>
	<span class="n">ASB_CONSENSUS</span><span class="p">,</span>
	<span class="n">ASB_DISCARD_SECONDARY</span><span class="p">,</span>
	<span class="n">ASB_CALL_HELPER</span><span class="p">,</span>
	<span class="n">ASB_VIOLENTLY</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">drbd_on_no_data</span> <span class="p">{</span>
	<span class="n">OND_IO_ERROR</span><span class="p">,</span>
	<span class="n">OND_SUSPEND_IO</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">drbd_on_congestion</span> <span class="p">{</span>
	<span class="n">OC_BLOCK</span><span class="p">,</span>
	<span class="n">OC_PULL_AHEAD</span><span class="p">,</span>
	<span class="n">OC_DISCONNECT</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* KEEP the order, do not delete or insert. Only append. */</span>
<span class="k">enum</span> <span class="n">drbd_ret_code</span> <span class="p">{</span>
	<span class="n">ERR_CODE_BASE</span>		<span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
	<span class="n">NO_ERROR</span>		<span class="o">=</span> <span class="mi">101</span><span class="p">,</span>
	<span class="n">ERR_LOCAL_ADDR</span>		<span class="o">=</span> <span class="mi">102</span><span class="p">,</span>
	<span class="n">ERR_PEER_ADDR</span>		<span class="o">=</span> <span class="mi">103</span><span class="p">,</span>
	<span class="n">ERR_OPEN_DISK</span>		<span class="o">=</span> <span class="mi">104</span><span class="p">,</span>
	<span class="n">ERR_OPEN_MD_DISK</span>	<span class="o">=</span> <span class="mi">105</span><span class="p">,</span>
	<span class="n">ERR_DISK_NOT_BDEV</span>	<span class="o">=</span> <span class="mi">107</span><span class="p">,</span>
	<span class="n">ERR_MD_NOT_BDEV</span>		<span class="o">=</span> <span class="mi">108</span><span class="p">,</span>
	<span class="n">ERR_DISK_TOO_SMALL</span>	<span class="o">=</span> <span class="mi">111</span><span class="p">,</span>
	<span class="n">ERR_MD_DISK_TOO_SMALL</span>	<span class="o">=</span> <span class="mi">112</span><span class="p">,</span>
	<span class="n">ERR_BDCLAIM_DISK</span>	<span class="o">=</span> <span class="mi">114</span><span class="p">,</span>
	<span class="n">ERR_BDCLAIM_MD_DISK</span>	<span class="o">=</span> <span class="mi">115</span><span class="p">,</span>
	<span class="n">ERR_MD_IDX_INVALID</span>	<span class="o">=</span> <span class="mi">116</span><span class="p">,</span>
	<span class="n">ERR_IO_MD_DISK</span>		<span class="o">=</span> <span class="mi">118</span><span class="p">,</span>
	<span class="n">ERR_MD_INVALID</span>          <span class="o">=</span> <span class="mi">119</span><span class="p">,</span>
	<span class="n">ERR_AUTH_ALG</span>		<span class="o">=</span> <span class="mi">120</span><span class="p">,</span>
	<span class="n">ERR_AUTH_ALG_ND</span>		<span class="o">=</span> <span class="mi">121</span><span class="p">,</span>
	<span class="n">ERR_NOMEM</span>		<span class="o">=</span> <span class="mi">122</span><span class="p">,</span>
	<span class="n">ERR_DISCARD</span>		<span class="o">=</span> <span class="mi">123</span><span class="p">,</span>
	<span class="n">ERR_DISK_CONFIGURED</span>	<span class="o">=</span> <span class="mi">124</span><span class="p">,</span>
	<span class="n">ERR_NET_CONFIGURED</span>	<span class="o">=</span> <span class="mi">125</span><span class="p">,</span>
	<span class="n">ERR_MANDATORY_TAG</span>	<span class="o">=</span> <span class="mi">126</span><span class="p">,</span>
	<span class="n">ERR_MINOR_INVALID</span>	<span class="o">=</span> <span class="mi">127</span><span class="p">,</span>
	<span class="n">ERR_INTR</span>		<span class="o">=</span> <span class="mi">129</span><span class="p">,</span> <span class="cm">/* EINTR */</span>
	<span class="n">ERR_RESIZE_RESYNC</span>	<span class="o">=</span> <span class="mi">130</span><span class="p">,</span>
	<span class="n">ERR_NO_PRIMARY</span>		<span class="o">=</span> <span class="mi">131</span><span class="p">,</span>
	<span class="n">ERR_SYNC_AFTER</span>		<span class="o">=</span> <span class="mi">132</span><span class="p">,</span>
	<span class="n">ERR_SYNC_AFTER_CYCLE</span>	<span class="o">=</span> <span class="mi">133</span><span class="p">,</span>
	<span class="n">ERR_PAUSE_IS_SET</span>	<span class="o">=</span> <span class="mi">134</span><span class="p">,</span>
	<span class="n">ERR_PAUSE_IS_CLEAR</span>	<span class="o">=</span> <span class="mi">135</span><span class="p">,</span>
	<span class="n">ERR_PACKET_NR</span>		<span class="o">=</span> <span class="mi">137</span><span class="p">,</span>
	<span class="n">ERR_NO_DISK</span>		<span class="o">=</span> <span class="mi">138</span><span class="p">,</span>
	<span class="n">ERR_NOT_PROTO_C</span>		<span class="o">=</span> <span class="mi">139</span><span class="p">,</span>
	<span class="n">ERR_NOMEM_BITMAP</span>	<span class="o">=</span> <span class="mi">140</span><span class="p">,</span>
	<span class="n">ERR_INTEGRITY_ALG</span>	<span class="o">=</span> <span class="mi">141</span><span class="p">,</span> <span class="cm">/* DRBD 8.2 only */</span>
	<span class="n">ERR_INTEGRITY_ALG_ND</span>	<span class="o">=</span> <span class="mi">142</span><span class="p">,</span> <span class="cm">/* DRBD 8.2 only */</span>
	<span class="n">ERR_CPU_MASK_PARSE</span>	<span class="o">=</span> <span class="mi">143</span><span class="p">,</span> <span class="cm">/* DRBD 8.2 only */</span>
	<span class="n">ERR_CSUMS_ALG</span>		<span class="o">=</span> <span class="mi">144</span><span class="p">,</span> <span class="cm">/* DRBD 8.2 only */</span>
	<span class="n">ERR_CSUMS_ALG_ND</span>	<span class="o">=</span> <span class="mi">145</span><span class="p">,</span> <span class="cm">/* DRBD 8.2 only */</span>
	<span class="n">ERR_VERIFY_ALG</span>		<span class="o">=</span> <span class="mi">146</span><span class="p">,</span> <span class="cm">/* DRBD 8.2 only */</span>
	<span class="n">ERR_VERIFY_ALG_ND</span>	<span class="o">=</span> <span class="mi">147</span><span class="p">,</span> <span class="cm">/* DRBD 8.2 only */</span>
	<span class="n">ERR_CSUMS_RESYNC_RUNNING</span><span class="o">=</span> <span class="mi">148</span><span class="p">,</span> <span class="cm">/* DRBD 8.2 only */</span>
	<span class="n">ERR_VERIFY_RUNNING</span>	<span class="o">=</span> <span class="mi">149</span><span class="p">,</span> <span class="cm">/* DRBD 8.2 only */</span>
	<span class="n">ERR_DATA_NOT_CURRENT</span>	<span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
	<span class="n">ERR_CONNECTED</span>		<span class="o">=</span> <span class="mi">151</span><span class="p">,</span> <span class="cm">/* DRBD 8.3 only */</span>
	<span class="n">ERR_PERM</span>		<span class="o">=</span> <span class="mi">152</span><span class="p">,</span>
	<span class="n">ERR_NEED_APV_93</span>		<span class="o">=</span> <span class="mi">153</span><span class="p">,</span>
	<span class="n">ERR_STONITH_AND_PROT_A</span>  <span class="o">=</span> <span class="mi">154</span><span class="p">,</span>
	<span class="n">ERR_CONG_NOT_PROTO_A</span>	<span class="o">=</span> <span class="mi">155</span><span class="p">,</span>
	<span class="n">ERR_PIC_AFTER_DEP</span>	<span class="o">=</span> <span class="mi">156</span><span class="p">,</span>
	<span class="n">ERR_PIC_PEER_DEP</span>	<span class="o">=</span> <span class="mi">157</span><span class="p">,</span>

	<span class="cm">/* insert new ones above this line */</span>
	<span class="n">AFTER_LAST_ERR_CODE</span>
<span class="p">};</span>

<span class="cp">#define DRBD_PROT_A   1</span>
<span class="cp">#define DRBD_PROT_B   2</span>
<span class="cp">#define DRBD_PROT_C   3</span>

<span class="k">enum</span> <span class="n">drbd_role</span> <span class="p">{</span>
	<span class="n">R_UNKNOWN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">R_PRIMARY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>     <span class="cm">/* role */</span>
	<span class="n">R_SECONDARY</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>   <span class="cm">/* role */</span>
	<span class="n">R_MASK</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* The order of these constants is important.</span>
<span class="cm"> * The lower ones (&lt;C_WF_REPORT_PARAMS) indicate</span>
<span class="cm"> * that there is no socket!</span>
<span class="cm"> * &gt;=C_WF_REPORT_PARAMS ==&gt; There is a socket</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">drbd_conns</span> <span class="p">{</span>
	<span class="n">C_STANDALONE</span><span class="p">,</span>
	<span class="n">C_DISCONNECTING</span><span class="p">,</span>  <span class="cm">/* Temporal state on the way to StandAlone. */</span>
	<span class="n">C_UNCONNECTED</span><span class="p">,</span>    <span class="cm">/* &gt;= C_UNCONNECTED -&gt; inc_net() succeeds */</span>

	<span class="cm">/* These temporal states are all used on the way</span>
<span class="cm">	 * from &gt;= C_CONNECTED to Unconnected.</span>
<span class="cm">	 * The &#39;disconnect reason&#39; states</span>
<span class="cm">	 * I do not allow to change between them. */</span>
	<span class="n">C_TIMEOUT</span><span class="p">,</span>
	<span class="n">C_BROKEN_PIPE</span><span class="p">,</span>
	<span class="n">C_NETWORK_FAILURE</span><span class="p">,</span>
	<span class="n">C_PROTOCOL_ERROR</span><span class="p">,</span>
	<span class="n">C_TEAR_DOWN</span><span class="p">,</span>

	<span class="n">C_WF_CONNECTION</span><span class="p">,</span>
	<span class="n">C_WF_REPORT_PARAMS</span><span class="p">,</span> <span class="cm">/* we have a socket */</span>
	<span class="n">C_CONNECTED</span><span class="p">,</span>      <span class="cm">/* we have introduced each other */</span>
	<span class="n">C_STARTING_SYNC_S</span><span class="p">,</span>  <span class="cm">/* starting full sync by admin request. */</span>
	<span class="n">C_STARTING_SYNC_T</span><span class="p">,</span>  <span class="cm">/* starting full sync by admin request. */</span>
	<span class="n">C_WF_BITMAP_S</span><span class="p">,</span>
	<span class="n">C_WF_BITMAP_T</span><span class="p">,</span>
	<span class="n">C_WF_SYNC_UUID</span><span class="p">,</span>

	<span class="cm">/* All SyncStates are tested with this comparison</span>
<span class="cm">	 * xx &gt;= C_SYNC_SOURCE &amp;&amp; xx &lt;= C_PAUSED_SYNC_T */</span>
	<span class="n">C_SYNC_SOURCE</span><span class="p">,</span>
	<span class="n">C_SYNC_TARGET</span><span class="p">,</span>
	<span class="n">C_VERIFY_S</span><span class="p">,</span>
	<span class="n">C_VERIFY_T</span><span class="p">,</span>
	<span class="n">C_PAUSED_SYNC_S</span><span class="p">,</span>
	<span class="n">C_PAUSED_SYNC_T</span><span class="p">,</span>

	<span class="n">C_AHEAD</span><span class="p">,</span>
	<span class="n">C_BEHIND</span><span class="p">,</span>

	<span class="n">C_MASK</span> <span class="o">=</span> <span class="mi">31</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">drbd_disk_state</span> <span class="p">{</span>
	<span class="n">D_DISKLESS</span><span class="p">,</span>
	<span class="n">D_ATTACHING</span><span class="p">,</span>      <span class="cm">/* In the process of reading the meta-data */</span>
	<span class="n">D_FAILED</span><span class="p">,</span>         <span class="cm">/* Becomes D_DISKLESS as soon as we told it the peer */</span>
			<span class="cm">/* when &gt;= D_FAILED it is legal to access mdev-&gt;bc */</span>
	<span class="n">D_NEGOTIATING</span><span class="p">,</span>    <span class="cm">/* Late attaching state, we need to talk to the peer */</span>
	<span class="n">D_INCONSISTENT</span><span class="p">,</span>
	<span class="n">D_OUTDATED</span><span class="p">,</span>
	<span class="n">D_UNKNOWN</span><span class="p">,</span>       <span class="cm">/* Only used for the peer, never for myself */</span>
	<span class="n">D_CONSISTENT</span><span class="p">,</span>     <span class="cm">/* Might be D_OUTDATED, might be D_UP_TO_DATE ... */</span>
	<span class="n">D_UP_TO_DATE</span><span class="p">,</span>       <span class="cm">/* Only this disk state allows applications&#39; IO ! */</span>
	<span class="n">D_MASK</span> <span class="o">=</span> <span class="mi">15</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">drbd_state</span> <span class="p">{</span>
<span class="cm">/* According to gcc&#39;s docs is the ...</span>
<span class="cm"> * The order of allocation of bit-fields within a unit (C90 6.5.2.1, C99 6.7.2.1).</span>
<span class="cm"> * Determined by ABI.</span>
<span class="cm"> * pointed out by Maxim Uvarov q&lt;muvarov@ru.mvista.com&gt;</span>
<span class="cm"> * even though we transmit as &quot;cpu_to_be32(state)&quot;,</span>
<span class="cm"> * the offsets of the bitfields still need to be swapped</span>
<span class="cm"> * on different endianness.</span>
<span class="cm"> */</span>
	<span class="k">struct</span> <span class="p">{</span>
<span class="cp">#if defined(__LITTLE_ENDIAN_BITFIELD)</span>
		<span class="kt">unsigned</span> <span class="n">role</span><span class="o">:</span><span class="mi">2</span> <span class="p">;</span>   <span class="cm">/* 3/4	 primary/secondary/unknown */</span>
		<span class="kt">unsigned</span> <span class="n">peer</span><span class="o">:</span><span class="mi">2</span> <span class="p">;</span>   <span class="cm">/* 3/4	 primary/secondary/unknown */</span>
		<span class="kt">unsigned</span> <span class="n">conn</span><span class="o">:</span><span class="mi">5</span> <span class="p">;</span>   <span class="cm">/* 17/32	 cstates */</span>
		<span class="kt">unsigned</span> <span class="n">disk</span><span class="o">:</span><span class="mi">4</span> <span class="p">;</span>   <span class="cm">/* 8/16	 from D_DISKLESS to D_UP_TO_DATE */</span>
		<span class="kt">unsigned</span> <span class="n">pdsk</span><span class="o">:</span><span class="mi">4</span> <span class="p">;</span>   <span class="cm">/* 8/16	 from D_DISKLESS to D_UP_TO_DATE */</span>
		<span class="kt">unsigned</span> <span class="n">susp</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span>   <span class="cm">/* 2/2	 IO suspended no/yes (by user) */</span>
		<span class="kt">unsigned</span> <span class="n">aftr_isp</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span> <span class="cm">/* isp .. imposed sync pause */</span>
		<span class="kt">unsigned</span> <span class="n">peer_isp</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span>
		<span class="kt">unsigned</span> <span class="n">user_isp</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span>
		<span class="kt">unsigned</span> <span class="n">susp_nod</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span> <span class="cm">/* IO suspended because no data */</span>
		<span class="kt">unsigned</span> <span class="n">susp_fen</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span> <span class="cm">/* IO suspended because fence peer handler runs*/</span>
		<span class="kt">unsigned</span> <span class="n">_pad</span><span class="o">:</span><span class="mi">9</span><span class="p">;</span>   <span class="cm">/* 0	 unused */</span>
<span class="cp">#elif defined(__BIG_ENDIAN_BITFIELD)</span>
		<span class="kt">unsigned</span> <span class="n">_pad</span><span class="o">:</span><span class="mi">9</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="n">susp_fen</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span>
		<span class="kt">unsigned</span> <span class="n">susp_nod</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span>
		<span class="kt">unsigned</span> <span class="n">user_isp</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span>
		<span class="kt">unsigned</span> <span class="n">peer_isp</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span>
		<span class="kt">unsigned</span> <span class="n">aftr_isp</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span> <span class="cm">/* isp .. imposed sync pause */</span>
		<span class="kt">unsigned</span> <span class="n">susp</span><span class="o">:</span><span class="mi">1</span> <span class="p">;</span>   <span class="cm">/* 2/2	 IO suspended  no/yes */</span>
		<span class="kt">unsigned</span> <span class="n">pdsk</span><span class="o">:</span><span class="mi">4</span> <span class="p">;</span>   <span class="cm">/* 8/16	 from D_DISKLESS to D_UP_TO_DATE */</span>
		<span class="kt">unsigned</span> <span class="n">disk</span><span class="o">:</span><span class="mi">4</span> <span class="p">;</span>   <span class="cm">/* 8/16	 from D_DISKLESS to D_UP_TO_DATE */</span>
		<span class="kt">unsigned</span> <span class="n">conn</span><span class="o">:</span><span class="mi">5</span> <span class="p">;</span>   <span class="cm">/* 17/32	 cstates */</span>
		<span class="kt">unsigned</span> <span class="n">peer</span><span class="o">:</span><span class="mi">2</span> <span class="p">;</span>   <span class="cm">/* 3/4	 primary/secondary/unknown */</span>
		<span class="kt">unsigned</span> <span class="n">role</span><span class="o">:</span><span class="mi">2</span> <span class="p">;</span>   <span class="cm">/* 3/4	 primary/secondary/unknown */</span>
<span class="cp">#else</span>
<span class="cp"># error &quot;this endianness is not supported&quot;</span>
<span class="cp">#endif</span>
	<span class="p">};</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">drbd_state_rv</span> <span class="p">{</span>
	<span class="n">SS_CW_NO_NEED</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">SS_CW_SUCCESS</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">SS_NOTHING_TO_DO</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">SS_SUCCESS</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">SS_UNKNOWN_ERROR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* Used to sleep longer in _drbd_request_state */</span>
	<span class="n">SS_TWO_PRIMARIES</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">SS_NO_UP_TO_DATE_DISK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span>
	<span class="n">SS_NO_LOCAL_DISK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span>
	<span class="n">SS_NO_REMOTE_DISK</span> <span class="o">=</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span>
	<span class="n">SS_CONNECTED_OUTDATES</span> <span class="o">=</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span>
	<span class="n">SS_PRIMARY_NOP</span> <span class="o">=</span> <span class="o">-</span><span class="mi">7</span><span class="p">,</span>
	<span class="n">SS_RESYNC_RUNNING</span> <span class="o">=</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span>
	<span class="n">SS_ALREADY_STANDALONE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9</span><span class="p">,</span>
	<span class="n">SS_CW_FAILED_BY_PEER</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span>
	<span class="n">SS_IS_DISKLESS</span> <span class="o">=</span> <span class="o">-</span><span class="mi">11</span><span class="p">,</span>
	<span class="n">SS_DEVICE_IN_USE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">12</span><span class="p">,</span>
	<span class="n">SS_NO_NET_CONFIG</span> <span class="o">=</span> <span class="o">-</span><span class="mi">13</span><span class="p">,</span>
	<span class="n">SS_NO_VERIFY_ALG</span> <span class="o">=</span> <span class="o">-</span><span class="mi">14</span><span class="p">,</span>       <span class="cm">/* drbd-8.2 only */</span>
	<span class="n">SS_NEED_CONNECTION</span> <span class="o">=</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span>    <span class="cm">/* drbd-8.2 only */</span>
	<span class="n">SS_LOWER_THAN_OUTDATED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span>
	<span class="n">SS_NOT_SUPPORTED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">17</span><span class="p">,</span>      <span class="cm">/* drbd-8.2 only */</span>
	<span class="n">SS_IN_TRANSIENT_STATE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">18</span><span class="p">,</span>  <span class="cm">/* Retry after the next state change */</span>
	<span class="n">SS_CONCURRENT_ST_CHG</span> <span class="o">=</span> <span class="o">-</span><span class="mi">19</span><span class="p">,</span>   <span class="cm">/* Concurrent cluster side state change! */</span>
	<span class="n">SS_AFTER_LAST_ERROR</span> <span class="o">=</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span>    <span class="cm">/* Keep this at bottom */</span>
<span class="p">};</span>

<span class="cm">/* from drbd_strings.c */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">drbd_conn_str</span><span class="p">(</span><span class="k">enum</span> <span class="n">drbd_conns</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">drbd_role_str</span><span class="p">(</span><span class="k">enum</span> <span class="n">drbd_role</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">drbd_disk_str</span><span class="p">(</span><span class="k">enum</span> <span class="n">drbd_disk_state</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">drbd_set_st_err_str</span><span class="p">(</span><span class="k">enum</span> <span class="n">drbd_state_rv</span><span class="p">);</span>

<span class="cp">#define SHARED_SECRET_MAX 64</span>

<span class="cp">#define MDF_CONSISTENT		(1 &lt;&lt; 0)</span>
<span class="cp">#define MDF_PRIMARY_IND		(1 &lt;&lt; 1)</span>
<span class="cp">#define MDF_CONNECTED_IND	(1 &lt;&lt; 2)</span>
<span class="cp">#define MDF_FULL_SYNC		(1 &lt;&lt; 3)</span>
<span class="cp">#define MDF_WAS_UP_TO_DATE	(1 &lt;&lt; 4)</span>
<span class="cp">#define MDF_PEER_OUT_DATED	(1 &lt;&lt; 5)</span>
<span class="cp">#define MDF_CRASHED_PRIMARY     (1 &lt;&lt; 6)</span>

<span class="k">enum</span> <span class="n">drbd_uuid_index</span> <span class="p">{</span>
	<span class="n">UI_CURRENT</span><span class="p">,</span>
	<span class="n">UI_BITMAP</span><span class="p">,</span>
	<span class="n">UI_HISTORY_START</span><span class="p">,</span>
	<span class="n">UI_HISTORY_END</span><span class="p">,</span>
	<span class="n">UI_SIZE</span><span class="p">,</span>      <span class="cm">/* nl-packet: number of dirty bits */</span>
	<span class="n">UI_FLAGS</span><span class="p">,</span>     <span class="cm">/* nl-packet: flags */</span>
	<span class="n">UI_EXTENDED_SIZE</span>   <span class="cm">/* Everything. */</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">drbd_timeout_flag</span> <span class="p">{</span>
	<span class="n">UT_DEFAULT</span>      <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">UT_DEGRADED</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">UT_PEER_OUTDATED</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define UUID_JUST_CREATED ((__u64)4)</span>

<span class="cp">#define DRBD_MAGIC 0x83740267</span>
<span class="cp">#define BE_DRBD_MAGIC __constant_cpu_to_be32(DRBD_MAGIC)</span>
<span class="cp">#define DRBD_MAGIC_BIG 0x835a</span>
<span class="cp">#define BE_DRBD_MAGIC_BIG __constant_cpu_to_be16(DRBD_MAGIC_BIG)</span>

<span class="cm">/* these are of type &quot;int&quot; */</span>
<span class="cp">#define DRBD_MD_INDEX_INTERNAL -1</span>
<span class="cp">#define DRBD_MD_INDEX_FLEX_EXT -2</span>
<span class="cp">#define DRBD_MD_INDEX_FLEX_INT -3</span>

<span class="cm">/* Start of the new netlink/connector stuff */</span>

<span class="cp">#define DRBD_NL_CREATE_DEVICE 0x01</span>
<span class="cp">#define DRBD_NL_SET_DEFAULTS  0x02</span>


<span class="cm">/* For searching a vacant cn_idx value */</span>
<span class="cp">#define CN_IDX_STEP			6977</span>

<span class="k">struct</span> <span class="n">drbd_nl_cfg_req</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">packet_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">drbd_minor</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tag_list</span><span class="p">[];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drbd_nl_cfg_reply</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">packet_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">minor</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret_code</span><span class="p">;</span> <span class="cm">/* enum ret_code or set_st_err_t */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tag_list</span><span class="p">[];</span> <span class="cm">/* only used with get_* calls */</span>
<span class="p">};</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
