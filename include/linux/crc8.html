<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › crc8.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>crc8.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2011 Broadcom Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * Permission to use, copy, modify, and/or distribute this software for any</span>
<span class="cm"> * purpose with or without fee is hereby granted, provided that the above</span>
<span class="cm"> * copyright notice and this permission notice appear in all copies.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="cm"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY</span>
<span class="cm"> * SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="cm"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION</span>
<span class="cm"> * OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __CRC8_H_</span>
<span class="cp">#define __CRC8_H_</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cm">/* see usage of this value in crc8() description */</span>
<span class="cp">#define CRC8_INIT_VALUE		0xFF</span>

<span class="cm">/*</span>
<span class="cm"> * Return value of crc8() indicating valid message+crc. This is true</span>
<span class="cm"> * if a CRC is inverted before transmission. The CRC computed over the</span>
<span class="cm"> * whole received bitstream is _table[x], where x is the bit pattern</span>
<span class="cm"> * of the modification (almost always 0xff).</span>
<span class="cm"> */</span>
<span class="cp">#define CRC8_GOOD_VALUE(_table)	(_table[0xFF])</span>

<span class="cm">/* required table size for crc8 algorithm */</span>
<span class="cp">#define CRC8_TABLE_SIZE			256</span>

<span class="cm">/* helper macro assuring right table size is used */</span>
<span class="cp">#define DECLARE_CRC8_TABLE(_table) \</span>
<span class="cp">	static u8 _table[CRC8_TABLE_SIZE]</span>

<span class="cm">/**</span>
<span class="cm"> * crc8_populate_lsb - fill crc table for given polynomial in regular bit order.</span>
<span class="cm"> *</span>
<span class="cm"> * @table:	table to be filled.</span>
<span class="cm"> * @polynomial:	polynomial for which table is to be filled.</span>
<span class="cm"> *</span>
<span class="cm"> * This function fills the provided table according the polynomial provided for</span>
<span class="cm"> * regular bit order (lsb first). Polynomials in CRC algorithms are typically</span>
<span class="cm"> * represented as shown below.</span>
<span class="cm"> *</span>
<span class="cm"> *	poly = x^8 + x^7 + x^6 + x^4 + x^2 + 1</span>
<span class="cm"> *</span>
<span class="cm"> * For lsb first direction x^7 maps to the lsb. So the polynomial is as below.</span>
<span class="cm"> *</span>
<span class="cm"> * - lsb first: poly = 10101011(1) = 0xAB</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">crc8_populate_lsb</span><span class="p">(</span><span class="n">u8</span> <span class="n">table</span><span class="p">[</span><span class="n">CRC8_TABLE_SIZE</span><span class="p">],</span> <span class="n">u8</span> <span class="n">polynomial</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * crc8_populate_msb - fill crc table for given polynomial in reverse bit order.</span>
<span class="cm"> *</span>
<span class="cm"> * @table:	table to be filled.</span>
<span class="cm"> * @polynomial:	polynomial for which table is to be filled.</span>
<span class="cm"> *</span>
<span class="cm"> * This function fills the provided table according the polynomial provided for</span>
<span class="cm"> * reverse bit order (msb first). Polynomials in CRC algorithms are typically</span>
<span class="cm"> * represented as shown below.</span>
<span class="cm"> *</span>
<span class="cm"> *	poly = x^8 + x^7 + x^6 + x^4 + x^2 + 1</span>
<span class="cm"> *</span>
<span class="cm"> * For msb first direction x^7 maps to the msb. So the polynomial is as below.</span>
<span class="cm"> *</span>
<span class="cm"> * - msb first: poly = (1)11010101 = 0xD5</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">crc8_populate_msb</span><span class="p">(</span><span class="n">u8</span> <span class="n">table</span><span class="p">[</span><span class="n">CRC8_TABLE_SIZE</span><span class="p">],</span> <span class="n">u8</span> <span class="n">polynomial</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * crc8() - calculate a crc8 over the given input data.</span>
<span class="cm"> *</span>
<span class="cm"> * @table:	crc table used for calculation.</span>
<span class="cm"> * @pdata:	pointer to data buffer.</span>
<span class="cm"> * @nbytes:	number of bytes in data buffer.</span>
<span class="cm"> * @crc:	previous returned crc8 value.</span>
<span class="cm"> *</span>
<span class="cm"> * The CRC8 is calculated using the polynomial given in crc8_populate_msb()</span>
<span class="cm"> * or crc8_populate_lsb().</span>
<span class="cm"> *</span>
<span class="cm"> * The caller provides the initial value (either %CRC8_INIT_VALUE</span>
<span class="cm"> * or the previous returned value) to allow for processing of</span>
<span class="cm"> * discontiguous blocks of data.  When generating the CRC the</span>
<span class="cm"> * caller is responsible for complementing the final return value</span>
<span class="cm"> * and inserting it into the byte stream.  When validating a byte</span>
<span class="cm"> * stream (including CRC8), a final return value of %CRC8_GOOD_VALUE</span>
<span class="cm"> * indicates the byte stream data can be considered valid.</span>
<span class="cm"> *</span>
<span class="cm"> * Reference:</span>
<span class="cm"> * &quot;A Painless Guide to CRC Error Detection Algorithms&quot;, ver 3, Aug 1993</span>
<span class="cm"> * Williams, Ross N., ross&lt;at&gt;ross.net</span>
<span class="cm"> * (see URL http://www.ross.net/crc/download/crc_v3.txt).</span>
<span class="cm"> */</span>
<span class="n">u8</span> <span class="n">crc8</span><span class="p">(</span><span class="k">const</span> <span class="n">u8</span> <span class="n">table</span><span class="p">[</span><span class="n">CRC8_TABLE_SIZE</span><span class="p">],</span> <span class="n">u8</span> <span class="o">*</span><span class="n">pdata</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">,</span> <span class="n">u8</span> <span class="n">crc</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __CRC8_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
