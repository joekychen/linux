<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › devfreq.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>devfreq.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * devfreq: Generic Dynamic Voltage and Frequency Scaling (DVFS) Framework</span>
<span class="cm"> *	    for Non-CPU Devices.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2011 Samsung Electronics</span>
<span class="cm"> *	MyungJoo Ham &lt;myungjoo.ham@samsung.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __LINUX_DEVFREQ_H__</span>
<span class="cp">#define __LINUX_DEVFREQ_H__</span>

<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/notifier.h&gt;</span>
<span class="cp">#include &lt;linux/opp.h&gt;</span>

<span class="cp">#define DEVFREQ_NAME_LEN 16</span>

<span class="k">struct</span> <span class="n">devfreq</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * struct devfreq_dev_status - Data given from devfreq user device to</span>
<span class="cm"> *			     governors. Represents the performance</span>
<span class="cm"> *			     statistics.</span>
<span class="cm"> * @total_time		The total time represented by this instance of</span>
<span class="cm"> *			devfreq_dev_status</span>
<span class="cm"> * @busy_time		The time that the device was working among the</span>
<span class="cm"> *			total_time.</span>
<span class="cm"> * @current_frequency	The operating frequency.</span>
<span class="cm"> * @private_data	An entry not specified by the devfreq framework.</span>
<span class="cm"> *			A device and a specific governor may have their</span>
<span class="cm"> *			own protocol with private_data. However, because</span>
<span class="cm"> *			this is governor-specific, a governor using this</span>
<span class="cm"> *			will be only compatible with devices aware of it.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">devfreq_dev_status</span> <span class="p">{</span>
	<span class="cm">/* both since the last measure */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">total_time</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">busy_time</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">current_frequency</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * The resulting frequency should be at most this. (this bound is the</span>
<span class="cm"> * least upper bound; thus, the resulting freq should be lower or same)</span>
<span class="cm"> * If the flag is not set, the resulting frequency should be at most the</span>
<span class="cm"> * bound (greatest lower bound)</span>
<span class="cm"> */</span>
<span class="cp">#define DEVFREQ_FLAG_LEAST_UPPER_BOUND		0x1</span>

<span class="cm">/**</span>
<span class="cm"> * struct devfreq_dev_profile - Devfreq&#39;s user device profile</span>
<span class="cm"> * @initial_freq	The operating frequency when devfreq_add_device() is</span>
<span class="cm"> *			called.</span>
<span class="cm"> * @polling_ms		The polling interval in ms. 0 disables polling.</span>
<span class="cm"> * @target		The device should set its operating frequency at</span>
<span class="cm"> *			freq or lowest-upper-than-freq value. If freq is</span>
<span class="cm"> *			higher than any operable frequency, set maximum.</span>
<span class="cm"> *			Before returning, target function should set</span>
<span class="cm"> *			freq at the current frequency.</span>
<span class="cm"> *			The &quot;flags&quot; parameter&#39;s possible values are</span>
<span class="cm"> *			explained above with &quot;DEVFREQ_FLAG_*&quot; macros.</span>
<span class="cm"> * @get_dev_status	The device should provide the current performance</span>
<span class="cm"> *			status to devfreq, which is used by governors.</span>
<span class="cm"> * @exit		An optional callback that is called when devfreq</span>
<span class="cm"> *			is removing the devfreq object due to error or</span>
<span class="cm"> *			from devfreq_remove_device() call. If the user</span>
<span class="cm"> *			has registered devfreq-&gt;nb at a notifier-head,</span>
<span class="cm"> *			this is the time to unregister it.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">devfreq_dev_profile</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">initial_freq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">polling_ms</span><span class="p">;</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">target</span><span class="p">)(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">freq</span><span class="p">,</span> <span class="n">u32</span> <span class="n">flags</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_dev_status</span><span class="p">)(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">devfreq_dev_status</span> <span class="o">*</span><span class="n">stat</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">exit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct devfreq_governor - Devfreq policy governor</span>
<span class="cm"> * @name		Governor&#39;s name</span>
<span class="cm"> * @get_target_freq	Returns desired operating frequency for the device.</span>
<span class="cm"> *			Basically, get_target_freq will run</span>
<span class="cm"> *			devfreq_dev_profile.get_dev_status() to get the</span>
<span class="cm"> *			status of the device (load = busy_time / total_time).</span>
<span class="cm"> *			If no_central_polling is set, this callback is called</span>
<span class="cm"> *			only with update_devfreq() notified by OPP.</span>
<span class="cm"> * @init		Called when the devfreq is being attached to a device</span>
<span class="cm"> * @exit		Called when the devfreq is being removed from a</span>
<span class="cm"> *			device. Governor should stop any internal routines</span>
<span class="cm"> *			before return because related data may be</span>
<span class="cm"> *			freed after exit().</span>
<span class="cm"> * @no_central_polling	Do not use devfreq&#39;s central polling mechanism.</span>
<span class="cm"> *			When this is set, devfreq will not call</span>
<span class="cm"> *			get_target_freq with devfreq_monitor(). However,</span>
<span class="cm"> *			devfreq will call get_target_freq with</span>
<span class="cm"> *			devfreq_update() notified by OPP framework.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that the callbacks are called with devfreq-&gt;lock locked by devfreq.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">devfreq_governor</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="n">DEVFREQ_NAME_LEN</span><span class="p">];</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_target_freq</span><span class="p">)(</span><span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="n">this</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">freq</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="n">this</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">exit</span><span class="p">)(</span><span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="n">this</span><span class="p">);</span>
	<span class="k">const</span> <span class="n">bool</span> <span class="n">no_central_polling</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct devfreq - Device devfreq structure</span>
<span class="cm"> * @node	list node - contains the devices with devfreq that have been</span>
<span class="cm"> *		registered.</span>
<span class="cm"> * @lock	a mutex to protect accessing devfreq.</span>
<span class="cm"> * @dev		device registered by devfreq class. dev.parent is the device</span>
<span class="cm"> *		using devfreq.</span>
<span class="cm"> * @profile	device-specific devfreq profile</span>
<span class="cm"> * @governor	method how to choose frequency based on the usage.</span>
<span class="cm"> * @nb		notifier block used to notify devfreq object that it should</span>
<span class="cm"> *		reevaluate operable frequencies. Devfreq users may use</span>
<span class="cm"> *		devfreq.nb to the corresponding register notifier call chain.</span>
<span class="cm"> * @polling_jiffies	interval in jiffies.</span>
<span class="cm"> * @previous_freq	previously configured frequency value.</span>
<span class="cm"> * @next_polling	the number of remaining jiffies to poll with</span>
<span class="cm"> *			&quot;devfreq_monitor&quot; executions to reevaluate</span>
<span class="cm"> *			frequency/voltage of the device. Set by</span>
<span class="cm"> *			profile&#39;s polling_ms interval.</span>
<span class="cm"> * @data	Private data of the governor. The devfreq framework does not</span>
<span class="cm"> *		touch this.</span>
<span class="cm"> * @being_removed	a flag to mark that this object is being removed in</span>
<span class="cm"> *			order to prevent trying to remove the object multiple times.</span>
<span class="cm"> * @min_freq	Limit minimum frequency requested by user (0: none)</span>
<span class="cm"> * @max_freq	Limit maximum frequency requested by user (0: none)</span>
<span class="cm"> *</span>
<span class="cm"> * This structure stores the devfreq information for a give device.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that when a governor accesses entries in struct devfreq in its</span>
<span class="cm"> * functions except for the context of callbacks defined in struct</span>
<span class="cm"> * devfreq_governor, the governor should protect its access with the</span>
<span class="cm"> * struct mutex lock in struct devfreq. A governor may use this mutex</span>
<span class="cm"> * to protect its own private data in void *data as well.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">devfreq</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">node</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">devfreq_dev_profile</span> <span class="o">*</span><span class="n">profile</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">devfreq_governor</span> <span class="o">*</span><span class="n">governor</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">notifier_block</span> <span class="n">nb</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">polling_jiffies</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">previous_freq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">next_polling</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span> <span class="cm">/* private data for governors */</span>

	<span class="n">bool</span> <span class="n">being_removed</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">min_freq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">max_freq</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#if defined(CONFIG_PM_DEVFREQ)</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="n">devfreq_add_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">devfreq_dev_profile</span> <span class="o">*</span><span class="n">profile</span><span class="p">,</span>
				  <span class="k">const</span> <span class="k">struct</span> <span class="n">devfreq_governor</span> <span class="o">*</span><span class="n">governor</span><span class="p">,</span>
				  <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">devfreq_remove_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="n">devfreq</span><span class="p">);</span>

<span class="cm">/* Helper functions for devfreq user device driver with OPP. */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">opp</span> <span class="o">*</span><span class="n">devfreq_recommended_opp</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">freq</span><span class="p">,</span> <span class="n">u32</span> <span class="n">flags</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">devfreq_register_opp_notifier</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="n">devfreq</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">devfreq_unregister_opp_notifier</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="n">devfreq</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_DEVFREQ_GOV_POWERSAVE</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">devfreq_governor</span> <span class="n">devfreq_powersave</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_DEVFREQ_GOV_PERFORMANCE</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">devfreq_governor</span> <span class="n">devfreq_performance</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_DEVFREQ_GOV_USERSPACE</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">devfreq_governor</span> <span class="n">devfreq_userspace</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_DEVFREQ_GOV_SIMPLE_ONDEMAND</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">devfreq_governor</span> <span class="n">devfreq_simple_ondemand</span><span class="p">;</span>
<span class="cm">/**</span>
<span class="cm"> * struct devfreq_simple_ondemand_data - void *data fed to struct devfreq</span>
<span class="cm"> *	and devfreq_add_device</span>
<span class="cm"> * @ upthreshold	If the load is over this value, the frequency jumps.</span>
<span class="cm"> *			Specify 0 to use the default. Valid value = 0 to 100.</span>
<span class="cm"> * @ downdifferential	If the load is under upthreshold - downdifferential,</span>
<span class="cm"> *			the governor may consider slowing the frequency down.</span>
<span class="cm"> *			Specify 0 to use the default. Valid value = 0 to 100.</span>
<span class="cm"> *			downdifferential &lt; upthreshold must hold.</span>
<span class="cm"> *</span>
<span class="cm"> * If the fed devfreq_simple_ondemand_data pointer is NULL to the governor,</span>
<span class="cm"> * the governor uses the default values.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">devfreq_simple_ondemand_data</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">upthreshold</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">downdifferential</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#else </span><span class="cm">/* !CONFIG_PM_DEVFREQ */</span><span class="cp"></span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="nf">devfreq_add_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">devfreq_dev_profile</span> <span class="o">*</span><span class="n">profile</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">devfreq_governor</span> <span class="o">*</span><span class="n">governor</span><span class="p">,</span>
					  <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">devfreq_remove_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="n">devfreq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">opp</span> <span class="o">*</span><span class="nf">devfreq_recommended_opp</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">freq</span><span class="p">,</span> <span class="n">u32</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">devfreq_register_opp_notifier</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="n">devfreq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">devfreq_unregister_opp_notifier</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">devfreq</span> <span class="o">*</span><span class="n">devfreq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define devfreq_powersave	NULL</span>
<span class="cp">#define devfreq_performance	NULL</span>
<span class="cp">#define devfreq_userspace	NULL</span>
<span class="cp">#define devfreq_simple_ondemand	NULL</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_PM_DEVFREQ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __LINUX_DEVFREQ_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
