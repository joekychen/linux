<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › hiddev.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>hiddev.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _HIDDEV_H</span>
<span class="cp">#define _HIDDEV_H</span>

<span class="cm">/*</span>
<span class="cm"> *  Copyright (c) 1999-2000 Vojtech Pavlik</span>
<span class="cm"> *</span>
<span class="cm"> *  Sponsored by SuSE</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or </span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> * </span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> * </span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<span class="cm"> * </span>
<span class="cm"> * Should you need to contact me, the author, you can do so either by</span>
<span class="cm"> * e-mail - mail your message to &lt;vojtech@suse.cz&gt;, or by paper mail:</span>
<span class="cm"> * Vojtech Pavlik, Ucitelska 1576, Prague 8, 182 00 Czech Republic</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * The event structure itself</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">hiddev_event</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">hid</span><span class="p">;</span>
	<span class="kt">signed</span> <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hiddev_devinfo</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">bustype</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">busnum</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">devnum</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">ifnum</span><span class="p">;</span>
	<span class="n">__s16</span> <span class="n">vendor</span><span class="p">;</span>
	<span class="n">__s16</span> <span class="n">product</span><span class="p">;</span>
	<span class="n">__s16</span> <span class="n">version</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">num_applications</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hiddev_collection_info</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">index</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">usage</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">level</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define HID_STRING_SIZE 256</span>
<span class="k">struct</span> <span class="n">hiddev_string_descriptor</span> <span class="p">{</span>
	<span class="n">__s32</span> <span class="n">index</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">value</span><span class="p">[</span><span class="n">HID_STRING_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hiddev_report_info</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">report_type</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">report_id</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">num_fields</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* To do a GUSAGE/SUSAGE, fill in at least usage_code,  report_type and </span>
<span class="cm"> * report_id.  Set report_id to REPORT_ID_UNKNOWN if the rest of the fields </span>
<span class="cm"> * are unknown.  Otherwise use a usage_ref struct filled in from a previous </span>
<span class="cm"> * successful GUSAGE call to save time.  To actually send a value to the</span>
<span class="cm"> * device, perform a SUSAGE first, followed by a SREPORT.  An INITREPORT or a</span>
<span class="cm"> * GREPORT isn&#39;t necessary for a GUSAGE to return valid data.</span>
<span class="cm"> */</span>
<span class="cp">#define HID_REPORT_ID_UNKNOWN 0xffffffff</span>
<span class="cp">#define HID_REPORT_ID_FIRST   0x00000100</span>
<span class="cp">#define HID_REPORT_ID_NEXT    0x00000200</span>
<span class="cp">#define HID_REPORT_ID_MASK    0x000000ff</span>
<span class="cp">#define HID_REPORT_ID_MAX     0x000000ff</span>

<span class="cp">#define HID_REPORT_TYPE_INPUT	1</span>
<span class="cp">#define HID_REPORT_TYPE_OUTPUT	2</span>
<span class="cp">#define HID_REPORT_TYPE_FEATURE	3</span>
<span class="cp">#define HID_REPORT_TYPE_MIN     1</span>
<span class="cp">#define HID_REPORT_TYPE_MAX     3</span>

<span class="k">struct</span> <span class="n">hiddev_field_info</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">report_type</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">report_id</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">field_index</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">maxusage</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">physical</span><span class="p">;</span>		<span class="cm">/* physical usage for this field */</span>
	<span class="n">__u32</span> <span class="n">logical</span><span class="p">;</span>		<span class="cm">/* logical usage for this field */</span>
	<span class="n">__u32</span> <span class="n">application</span><span class="p">;</span>		<span class="cm">/* application usage for this field */</span>
	<span class="n">__s32</span> <span class="n">logical_minimum</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">logical_maximum</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">physical_minimum</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">physical_maximum</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">unit_exponent</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">unit</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Fill in report_type, report_id and field_index to get the information on a</span>
<span class="cm"> * field.</span>
<span class="cm"> */</span>
<span class="cp">#define HID_FIELD_CONSTANT		0x001</span>
<span class="cp">#define HID_FIELD_VARIABLE		0x002</span>
<span class="cp">#define HID_FIELD_RELATIVE		0x004</span>
<span class="cp">#define HID_FIELD_WRAP			0x008	</span>
<span class="cp">#define HID_FIELD_NONLINEAR		0x010</span>
<span class="cp">#define HID_FIELD_NO_PREFERRED		0x020</span>
<span class="cp">#define HID_FIELD_NULL_STATE		0x040</span>
<span class="cp">#define HID_FIELD_VOLATILE		0x080</span>
<span class="cp">#define HID_FIELD_BUFFERED_BYTE		0x100</span>

<span class="k">struct</span> <span class="n">hiddev_usage_ref</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">report_type</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">report_id</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">field_index</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">usage_index</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">usage_code</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">value</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* hiddev_usage_ref_multi is used for sending multiple bytes to a control.</span>
<span class="cm"> * It really manifests itself as setting the value of consecutive usages */</span>
<span class="cp">#define HID_MAX_MULTI_USAGES 1024</span>
<span class="k">struct</span> <span class="n">hiddev_usage_ref_multi</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">hiddev_usage_ref</span> <span class="n">uref</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">num_values</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">values</span><span class="p">[</span><span class="n">HID_MAX_MULTI_USAGES</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* FIELD_INDEX_NONE is returned in read() data from the kernel when flags</span>
<span class="cm"> * is set to (HIDDEV_FLAG_UREF | HIDDEV_FLAG_REPORT) and a new report has</span>
<span class="cm"> * been sent by the device </span>
<span class="cm"> */</span>
<span class="cp">#define HID_FIELD_INDEX_NONE 0xffffffff</span>

<span class="cm">/*</span>
<span class="cm"> * Protocol version.</span>
<span class="cm"> */</span>

<span class="cp">#define HID_VERSION		0x010004</span>

<span class="cm">/*</span>
<span class="cm"> * IOCTLs (0x00 - 0x7f)</span>
<span class="cm"> */</span>

<span class="cp">#define HIDIOCGVERSION		_IOR(&#39;H&#39;, 0x01, int)</span>
<span class="cp">#define HIDIOCAPPLICATION	_IO(&#39;H&#39;, 0x02)</span>
<span class="cp">#define HIDIOCGDEVINFO		_IOR(&#39;H&#39;, 0x03, struct hiddev_devinfo)</span>
<span class="cp">#define HIDIOCGSTRING		_IOR(&#39;H&#39;, 0x04, struct hiddev_string_descriptor)</span>
<span class="cp">#define HIDIOCINITREPORT	_IO(&#39;H&#39;, 0x05)</span>
<span class="cp">#define HIDIOCGNAME(len)	_IOC(_IOC_READ, &#39;H&#39;, 0x06, len)</span>
<span class="cp">#define HIDIOCGREPORT		_IOW(&#39;H&#39;, 0x07, struct hiddev_report_info)</span>
<span class="cp">#define HIDIOCSREPORT		_IOW(&#39;H&#39;, 0x08, struct hiddev_report_info)</span>
<span class="cp">#define HIDIOCGREPORTINFO	_IOWR(&#39;H&#39;, 0x09, struct hiddev_report_info)</span>
<span class="cp">#define HIDIOCGFIELDINFO	_IOWR(&#39;H&#39;, 0x0A, struct hiddev_field_info)</span>
<span class="cp">#define HIDIOCGUSAGE		_IOWR(&#39;H&#39;, 0x0B, struct hiddev_usage_ref)</span>
<span class="cp">#define HIDIOCSUSAGE		_IOW(&#39;H&#39;, 0x0C, struct hiddev_usage_ref)</span>
<span class="cp">#define HIDIOCGUCODE		_IOWR(&#39;H&#39;, 0x0D, struct hiddev_usage_ref)</span>
<span class="cp">#define HIDIOCGFLAG		_IOR(&#39;H&#39;, 0x0E, int)</span>
<span class="cp">#define HIDIOCSFLAG		_IOW(&#39;H&#39;, 0x0F, int)</span>
<span class="cp">#define HIDIOCGCOLLECTIONINDEX	_IOW(&#39;H&#39;, 0x10, struct hiddev_usage_ref)</span>
<span class="cp">#define HIDIOCGCOLLECTIONINFO	_IOWR(&#39;H&#39;, 0x11, struct hiddev_collection_info)</span>
<span class="cp">#define HIDIOCGPHYS(len)	_IOC(_IOC_READ, &#39;H&#39;, 0x12, len)</span>

<span class="cm">/* For writing/reading to multiple/consecutive usages */</span>
<span class="cp">#define HIDIOCGUSAGES		_IOWR(&#39;H&#39;, 0x13, struct hiddev_usage_ref_multi)</span>
<span class="cp">#define HIDIOCSUSAGES		_IOW(&#39;H&#39;, 0x14, struct hiddev_usage_ref_multi)</span>

<span class="cm">/* </span>
<span class="cm"> * Flags to be used in HIDIOCSFLAG</span>
<span class="cm"> */</span>
<span class="cp">#define HIDDEV_FLAG_UREF	0x1</span>
<span class="cp">#define HIDDEV_FLAG_REPORT	0x2</span>
<span class="cp">#define HIDDEV_FLAGS		0x3</span>

<span class="cm">/* To traverse the input report descriptor info for a HID device, perform the </span>
<span class="cm"> * following:</span>
<span class="cm"> *</span>
<span class="cm"> * rinfo.report_type = HID_REPORT_TYPE_INPUT;</span>
<span class="cm"> * rinfo.report_id = HID_REPORT_ID_FIRST;</span>
<span class="cm"> * ret = ioctl(fd, HIDIOCGREPORTINFO, &amp;rinfo);</span>
<span class="cm"> *</span>
<span class="cm"> * while (ret &gt;= 0) {</span>
<span class="cm"> * 	for (i = 0; i &lt; rinfo.num_fields; i++) {</span>
<span class="cm"> * 		finfo.report_type = rinfo.report_type;</span>
<span class="cm"> * 		finfo.report_id = rinfo.report_id;</span>
<span class="cm"> * 		finfo.field_index = i;</span>
<span class="cm"> * 		ioctl(fd, HIDIOCGFIELDINFO, &amp;finfo);</span>
<span class="cm"> * 		for (j = 0; j &lt; finfo.maxusage; j++) {</span>
<span class="cm"> * 			uref.report_type = rinfo.report_type;</span>
<span class="cm"> * 			uref.report_id = rinfo.report_id;</span>
<span class="cm"> * 			uref.field_index = i;</span>
<span class="cm"> * 			uref.usage_index = j;</span>
<span class="cm"> * 			ioctl(fd, HIDIOCGUCODE, &amp;uref);</span>
<span class="cm"> * 			ioctl(fd, HIDIOCGUSAGE, &amp;uref);</span>
<span class="cm"> * 		}</span>
<span class="cm"> * 	}</span>
<span class="cm"> * 	rinfo.report_id |= HID_REPORT_ID_NEXT;</span>
<span class="cm"> * 	ret = ioctl(fd, HIDIOCGREPORTINFO, &amp;rinfo);</span>
<span class="cm"> * }</span>
<span class="cm"> */</span>


<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/*</span>
<span class="cm"> * In-kernel definitions.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">hid_device</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">hid_usage</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">hid_field</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">hid_report</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_USB_HIDDEV</span>
<span class="kt">int</span> <span class="n">hiddev_connect</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">force</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">hiddev_disconnect</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">hiddev_hid_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">value</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">hiddev_report_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">hiddev_connect</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">force</span><span class="p">)</span>
<span class="p">{</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">hiddev_disconnect</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">hiddev_hid_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">hiddev_report_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#endif</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
