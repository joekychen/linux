<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › fdreg.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>fdreg.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _LINUX_FDREG_H</span>
<span class="cp">#define _LINUX_FDREG_H</span>
<span class="cm">/*</span>
<span class="cm"> * This file contains some defines for the floppy disk controller.</span>
<span class="cm"> * Various sources. Mostly &quot;IBM Microcomputers: A Programmers</span>
<span class="cm"> * Handbook&quot;, Sanches and Canton.</span>
<span class="cm"> */</span>

<span class="cp">#ifdef FDPATCHES</span>
<span class="cp">#define FD_IOPORT fdc_state[fdc].address</span>
<span class="cp">#else</span>
<span class="cm">/* It would be a lot saner just to force fdc_state[fdc].address to always</span>
<span class="cm">   be set ! FIXME */</span>
<span class="cp">#define FD_IOPORT 0x3f0</span>
<span class="cp">#endif</span>

<span class="cm">/* Fd controller regs. S&amp;C, about page 340 */</span>
<span class="cp">#define FD_STATUS	(4 + FD_IOPORT )</span>
<span class="cp">#define FD_DATA		(5 + FD_IOPORT )</span>

<span class="cm">/* Digital Output Register */</span>
<span class="cp">#define FD_DOR		(2 + FD_IOPORT )</span>

<span class="cm">/* Digital Input Register (read) */</span>
<span class="cp">#define FD_DIR		(7 + FD_IOPORT )</span>

<span class="cm">/* Diskette Control Register (write)*/</span>
<span class="cp">#define FD_DCR		(7 + FD_IOPORT )</span>

<span class="cm">/* Bits of main status register */</span>
<span class="cp">#define STATUS_BUSYMASK	0x0F		</span><span class="cm">/* drive busy mask */</span><span class="cp"></span>
<span class="cp">#define STATUS_BUSY	0x10		</span><span class="cm">/* FDC busy */</span><span class="cp"></span>
<span class="cp">#define STATUS_DMA	0x20		</span><span class="cm">/* 0- DMA mode */</span><span class="cp"></span>
<span class="cp">#define STATUS_DIR	0x40		</span><span class="cm">/* 0- cpu-&gt;fdc */</span><span class="cp"></span>
<span class="cp">#define STATUS_READY	0x80		</span><span class="cm">/* Data reg ready */</span><span class="cp"></span>

<span class="cm">/* Bits of FD_ST0 */</span>
<span class="cp">#define ST0_DS		0x03		</span><span class="cm">/* drive select mask */</span><span class="cp"></span>
<span class="cp">#define ST0_HA		0x04		</span><span class="cm">/* Head (Address) */</span><span class="cp"></span>
<span class="cp">#define ST0_NR		0x08		</span><span class="cm">/* Not Ready */</span><span class="cp"></span>
<span class="cp">#define ST0_ECE		0x10		</span><span class="cm">/* Equipment check error */</span><span class="cp"></span>
<span class="cp">#define ST0_SE		0x20		</span><span class="cm">/* Seek end */</span><span class="cp"></span>
<span class="cp">#define ST0_INTR	0xC0		</span><span class="cm">/* Interrupt code mask */</span><span class="cp"></span>

<span class="cm">/* Bits of FD_ST1 */</span>
<span class="cp">#define ST1_MAM		0x01		</span><span class="cm">/* Missing Address Mark */</span><span class="cp"></span>
<span class="cp">#define ST1_WP		0x02		</span><span class="cm">/* Write Protect */</span><span class="cp"></span>
<span class="cp">#define ST1_ND		0x04		</span><span class="cm">/* No Data - unreadable */</span><span class="cp"></span>
<span class="cp">#define ST1_OR		0x10		</span><span class="cm">/* OverRun */</span><span class="cp"></span>
<span class="cp">#define ST1_CRC		0x20		</span><span class="cm">/* CRC error in data or addr */</span><span class="cp"></span>
<span class="cp">#define ST1_EOC		0x80		</span><span class="cm">/* End Of Cylinder */</span><span class="cp"></span>

<span class="cm">/* Bits of FD_ST2 */</span>
<span class="cp">#define ST2_MAM		0x01		</span><span class="cm">/* Missing Address Mark (again) */</span><span class="cp"></span>
<span class="cp">#define ST2_BC		0x02		</span><span class="cm">/* Bad Cylinder */</span><span class="cp"></span>
<span class="cp">#define ST2_SNS		0x04		</span><span class="cm">/* Scan Not Satisfied */</span><span class="cp"></span>
<span class="cp">#define ST2_SEH		0x08		</span><span class="cm">/* Scan Equal Hit */</span><span class="cp"></span>
<span class="cp">#define ST2_WC		0x10		</span><span class="cm">/* Wrong Cylinder */</span><span class="cp"></span>
<span class="cp">#define ST2_CRC		0x20		</span><span class="cm">/* CRC error in data field */</span><span class="cp"></span>
<span class="cp">#define ST2_CM		0x40		</span><span class="cm">/* Control Mark = deleted */</span><span class="cp"></span>

<span class="cm">/* Bits of FD_ST3 */</span>
<span class="cp">#define ST3_HA		0x04		</span><span class="cm">/* Head (Address) */</span><span class="cp"></span>
<span class="cp">#define ST3_DS		0x08		</span><span class="cm">/* drive is double-sided */</span><span class="cp"></span>
<span class="cp">#define ST3_TZ		0x10		</span><span class="cm">/* Track Zero signal (1=track 0) */</span><span class="cp"></span>
<span class="cp">#define ST3_RY		0x20		</span><span class="cm">/* drive is ready */</span><span class="cp"></span>
<span class="cp">#define ST3_WP		0x40		</span><span class="cm">/* Write Protect */</span><span class="cp"></span>
<span class="cp">#define ST3_FT		0x80		</span><span class="cm">/* Drive Fault */</span><span class="cp"></span>

<span class="cm">/* Values for FD_COMMAND */</span>
<span class="cp">#define FD_RECALIBRATE		0x07	</span><span class="cm">/* move to track 0 */</span><span class="cp"></span>
<span class="cp">#define FD_SEEK			0x0F	</span><span class="cm">/* seek track */</span><span class="cp"></span>
<span class="cp">#define FD_READ			0xE6	</span><span class="cm">/* read with MT, MFM, SKip deleted */</span><span class="cp"></span>
<span class="cp">#define FD_WRITE		0xC5	</span><span class="cm">/* write with MT, MFM */</span><span class="cp"></span>
<span class="cp">#define FD_SENSEI		0x08	</span><span class="cm">/* Sense Interrupt Status */</span><span class="cp"></span>
<span class="cp">#define FD_SPECIFY		0x03	</span><span class="cm">/* specify HUT etc */</span><span class="cp"></span>
<span class="cp">#define FD_FORMAT		0x4D	</span><span class="cm">/* format one track */</span><span class="cp"></span>
<span class="cp">#define FD_VERSION		0x10	</span><span class="cm">/* get version code */</span><span class="cp"></span>
<span class="cp">#define FD_CONFIGURE		0x13	</span><span class="cm">/* configure FIFO operation */</span><span class="cp"></span>
<span class="cp">#define FD_PERPENDICULAR	0x12	</span><span class="cm">/* perpendicular r/w mode */</span><span class="cp"></span>
<span class="cp">#define FD_GETSTATUS		0x04	</span><span class="cm">/* read ST3 */</span><span class="cp"></span>
<span class="cp">#define FD_DUMPREGS		0x0E	</span><span class="cm">/* dump the contents of the fdc regs */</span><span class="cp"></span>
<span class="cp">#define FD_READID		0xEA	</span><span class="cm">/* prints the header of a sector */</span><span class="cp"></span>
<span class="cp">#define FD_UNLOCK		0x14	</span><span class="cm">/* Fifo config unlock */</span><span class="cp"></span>
<span class="cp">#define FD_LOCK			0x94	</span><span class="cm">/* Fifo config lock */</span><span class="cp"></span>
<span class="cp">#define FD_RSEEK_OUT		0x8f	</span><span class="cm">/* seek out (i.e. to lower tracks) */</span><span class="cp"></span>
<span class="cp">#define FD_RSEEK_IN		0xcf	</span><span class="cm">/* seek in (i.e. to higher tracks) */</span><span class="cp"></span>

<span class="cm">/* the following commands are new in the 82078. They are not used in the</span>
<span class="cm"> * floppy driver, except the first three. These commands may be useful for apps</span>
<span class="cm"> * which use the FDRAWCMD interface. For doc, get the 82078 spec sheets at</span>
<span class="cm"> * http://www.intel.com/design/archives/periphrl/docs/29046803.htm */</span>

<span class="cp">#define FD_PARTID		0x18	</span><span class="cm">/* part id (&quot;extended&quot; version cmd) */</span><span class="cp"></span>
<span class="cp">#define FD_SAVE			0x2e	</span><span class="cm">/* save fdc regs for later restore */</span><span class="cp"></span>
<span class="cp">#define FD_DRIVESPEC		0x8e	</span><span class="cm">/* drive specification: Access to the</span>
<span class="cm">					 * 2 Mbps data transfer rate for tape</span>
<span class="cm">					 * drives */</span><span class="cp"></span>

<span class="cp">#define FD_RESTORE		0x4e    </span><span class="cm">/* later restore */</span><span class="cp"></span>
<span class="cp">#define FD_POWERDOWN		0x27	</span><span class="cm">/* configure FDC&#39;s powersave features */</span><span class="cp"></span>
<span class="cp">#define FD_FORMAT_N_WRITE	0xef    </span><span class="cm">/* format and write in one go. */</span><span class="cp"></span>
<span class="cp">#define FD_OPTION		0x33	</span><span class="cm">/* ISO format (which is a clean way to</span>
<span class="cm">					 * pack more sectors on a track) */</span><span class="cp"></span>

<span class="cm">/* DMA commands */</span>
<span class="cp">#define DMA_READ	0x46</span>
<span class="cp">#define DMA_WRITE	0x4A</span>

<span class="cm">/* FDC version return types */</span>
<span class="cp">#define FDC_NONE	0x00</span>
<span class="cp">#define FDC_UNKNOWN	0x10	</span><span class="cm">/* DO NOT USE THIS TYPE EXCEPT IF IDENTIFICATION</span>
<span class="cm">				   FAILS EARLY */</span><span class="cp"></span>
<span class="cp">#define FDC_8272A	0x20	</span><span class="cm">/* Intel 8272a, NEC 765 */</span><span class="cp"></span>
<span class="cp">#define FDC_765ED	0x30	</span><span class="cm">/* Non-Intel 1MB-compatible FDC, can&#39;t detect */</span><span class="cp"></span>
<span class="cp">#define FDC_82072	0x40	</span><span class="cm">/* Intel 82072; 8272a + FIFO + DUMPREGS */</span><span class="cp"></span>
<span class="cp">#define FDC_82072A	0x45	</span><span class="cm">/* 82072A (on Sparcs) */</span><span class="cp"></span>
<span class="cp">#define FDC_82077_ORIG	0x51	</span><span class="cm">/* Original version of 82077AA, sans LOCK */</span><span class="cp"></span>
<span class="cp">#define FDC_82077	0x52	</span><span class="cm">/* 82077AA-1 */</span><span class="cp"></span>
<span class="cp">#define FDC_82078_UNKN	0x5f	</span><span class="cm">/* Unknown 82078 variant */</span><span class="cp"></span>
<span class="cp">#define FDC_82078	0x60	</span><span class="cm">/* 44pin 82078 or 64pin 82078SL */</span><span class="cp"></span>
<span class="cp">#define FDC_82078_1	0x61	</span><span class="cm">/* 82078-1 (2Mbps fdc) */</span><span class="cp"></span>
<span class="cp">#define FDC_S82078B	0x62	</span><span class="cm">/* S82078B (first seen on Adaptec AVA-2825 VLB</span>
<span class="cm">				 * SCSI/EIDE/Floppy controller) */</span><span class="cp"></span>
<span class="cp">#define FDC_87306	0x63	</span><span class="cm">/* National Semiconductor PC 87306 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Beware: the fdc type list is roughly sorted by increasing features.</span>
<span class="cm"> * Presence of features is tested by comparing the FDC version id with the</span>
<span class="cm"> * &quot;oldest&quot; version that has the needed feature.</span>
<span class="cm"> * If during FDC detection, an obscure test fails late in the sequence, don&#39;t</span>
<span class="cm"> * assign FDC_UNKNOWN. Else the FDC will be treated as a dumb 8272a, or worse.</span>
<span class="cm"> * This is especially true if the tests are unneeded.</span>
<span class="cm"> */</span>

<span class="cp">#define FD_RESET_DELAY 20</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
