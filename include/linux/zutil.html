<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › zutil.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>zutil.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* zutil.h -- internal interface and configuration of the compression library</span>
<span class="cm"> * Copyright (C) 1995-1998 Jean-loup Gailly.</span>
<span class="cm"> * For conditions of distribution and use, see copyright notice in zlib.h</span>
<span class="cm"> */</span>

<span class="cm">/* WARNING: this file should *not* be used by applications. It is</span>
<span class="cm">   part of the implementation of the compression library and is</span>
<span class="cm">   subject to change. Applications should only use zlib.h.</span>
<span class="cm"> */</span>

<span class="cm">/* @(#) $Id: zutil.h,v 1.1 2000/01/01 03:32:23 davem Exp $ */</span>

<span class="cp">#ifndef _Z_UTIL_H</span>
<span class="cp">#define _Z_UTIL_H</span>

<span class="cp">#include &lt;linux/zlib.h&gt;</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>

<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">uch</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ush</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">ulg</span><span class="p">;</span>

        <span class="cm">/* common constants */</span>

<span class="cp">#define STORED_BLOCK 0</span>
<span class="cp">#define STATIC_TREES 1</span>
<span class="cp">#define DYN_TREES    2</span>
<span class="cm">/* The three kinds of block type */</span>

<span class="cp">#define MIN_MATCH  3</span>
<span class="cp">#define MAX_MATCH  258</span>
<span class="cm">/* The minimum and maximum match lengths */</span>

<span class="cp">#define PRESET_DICT 0x20 </span><span class="cm">/* preset dictionary flag in zlib header */</span><span class="cp"></span>

        <span class="cm">/* target dependencies */</span>

        <span class="cm">/* Common defaults */</span>

<span class="cp">#ifndef OS_CODE</span>
<span class="cp">#  define OS_CODE  0x03  </span><span class="cm">/* assume Unix */</span><span class="cp"></span>
<span class="cp">#endif</span>

         <span class="cm">/* functions */</span>

<span class="k">typedef</span> <span class="n">uLong</span> <span class="p">(</span><span class="o">*</span><span class="n">check_func</span><span class="p">)</span> <span class="p">(</span><span class="n">uLong</span> <span class="n">check</span><span class="p">,</span> <span class="k">const</span> <span class="n">Byte</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
				       <span class="n">uInt</span> <span class="n">len</span><span class="p">);</span>


                        <span class="cm">/* checksum functions */</span>

<span class="cp">#define BASE 65521L </span><span class="cm">/* largest prime smaller than 65536 */</span><span class="cp"></span>
<span class="cp">#define NMAX 5552</span>
<span class="cm">/* NMAX is the largest n such that 255n(n+1)/2 + (n+1)(BASE-1) &lt;= 2^32-1 */</span>

<span class="cp">#define DO1(buf,i)  {s1 += buf[i]; s2 += s1;}</span>
<span class="cp">#define DO2(buf,i)  DO1(buf,i); DO1(buf,i+1);</span>
<span class="cp">#define DO4(buf,i)  DO2(buf,i); DO2(buf,i+2);</span>
<span class="cp">#define DO8(buf,i)  DO4(buf,i); DO4(buf,i+4);</span>
<span class="cp">#define DO16(buf)   DO8(buf,0); DO8(buf,8);</span>

<span class="cm">/* ========================================================================= */</span>
<span class="cm">/*</span>
<span class="cm">     Update a running Adler-32 checksum with the bytes buf[0..len-1] and</span>
<span class="cm">   return the updated checksum. If buf is NULL, this function returns</span>
<span class="cm">   the required initial value for the checksum.</span>
<span class="cm">   An Adler-32 checksum is almost as reliable as a CRC32 but can be computed</span>
<span class="cm">   much faster. Usage example:</span>

<span class="cm">     uLong adler = adler32(0L, NULL, 0);</span>

<span class="cm">     while (read_buffer(buffer, length) != EOF) {</span>
<span class="cm">       adler = adler32(adler, buffer, length);</span>
<span class="cm">     }</span>
<span class="cm">     if (adler != original_adler) error();</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">uLong</span> <span class="nf">zlib_adler32</span><span class="p">(</span><span class="n">uLong</span> <span class="n">adler</span><span class="p">,</span>
				 <span class="k">const</span> <span class="n">Byte</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
				 <span class="n">uInt</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">s1</span> <span class="o">=</span> <span class="n">adler</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">s2</span> <span class="o">=</span> <span class="p">(</span><span class="n">adler</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">k</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1L</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">len</span> <span class="o">&lt;</span> <span class="n">NMAX</span> <span class="o">?</span> <span class="n">len</span> <span class="o">:</span> <span class="n">NMAX</span><span class="p">;</span>
        <span class="n">len</span> <span class="o">-=</span> <span class="n">k</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">DO16</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	    <span class="n">buf</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
            <span class="n">k</span> <span class="o">-=</span> <span class="mi">16</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">do</span> <span class="p">{</span>
            <span class="n">s1</span> <span class="o">+=</span> <span class="o">*</span><span class="n">buf</span><span class="o">++</span><span class="p">;</span>
	    <span class="n">s2</span> <span class="o">+=</span> <span class="n">s1</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">k</span><span class="p">);</span>
        <span class="n">s1</span> <span class="o">%=</span> <span class="n">BASE</span><span class="p">;</span>
        <span class="n">s2</span> <span class="o">%=</span> <span class="n">BASE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">s2</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="n">s1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* _Z_UTIL_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
