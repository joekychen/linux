<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › pxa2xx_ssp.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>pxa2xx_ssp.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  pxa2xx_ssp.h</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 2003 Russell King, All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This driver supports the following PXA CPU/SSP ports:-</span>
<span class="cm"> *</span>
<span class="cm"> *       PXA250     SSP</span>
<span class="cm"> *       PXA255     SSP, NSSP</span>
<span class="cm"> *       PXA26x     SSP, NSSP, ASSP</span>
<span class="cm"> *       PXA27x     SSP1, SSP2, SSP3</span>
<span class="cm"> *       PXA3xx     SSP1, SSP2, SSP3, SSP4</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __LINUX_SSP_H</span>
<span class="cp">#define __LINUX_SSP_H</span>

<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * SSP Serial Port Registers</span>
<span class="cm"> * PXA250, PXA255, PXA26x and PXA27x SSP controllers are all slightly different.</span>
<span class="cm"> * PXA255, PXA26x and PXA27x have extra ports, registers and bits.</span>
<span class="cm"> */</span>

<span class="cp">#define SSCR0		(0x00)  </span><span class="cm">/* SSP Control Register 0 */</span><span class="cp"></span>
<span class="cp">#define SSCR1		(0x04)  </span><span class="cm">/* SSP Control Register 1 */</span><span class="cp"></span>
<span class="cp">#define SSSR		(0x08)  </span><span class="cm">/* SSP Status Register */</span><span class="cp"></span>
<span class="cp">#define SSITR		(0x0C)  </span><span class="cm">/* SSP Interrupt Test Register */</span><span class="cp"></span>
<span class="cp">#define SSDR		(0x10)  </span><span class="cm">/* SSP Data Write/Data Read Register */</span><span class="cp"></span>

<span class="cp">#define SSTO		(0x28)  </span><span class="cm">/* SSP Time Out Register */</span><span class="cp"></span>
<span class="cp">#define SSPSP		(0x2C)  </span><span class="cm">/* SSP Programmable Serial Protocol */</span><span class="cp"></span>
<span class="cp">#define SSTSA		(0x30)  </span><span class="cm">/* SSP Tx Timeslot Active */</span><span class="cp"></span>
<span class="cp">#define SSRSA		(0x34)  </span><span class="cm">/* SSP Rx Timeslot Active */</span><span class="cp"></span>
<span class="cp">#define SSTSS		(0x38)  </span><span class="cm">/* SSP Timeslot Status */</span><span class="cp"></span>
<span class="cp">#define SSACD		(0x3C)  </span><span class="cm">/* SSP Audio Clock Divider */</span><span class="cp"></span>
<span class="cp">#define SSACDD		(0x40)	</span><span class="cm">/* SSP Audio Clock Dither Divider */</span><span class="cp"></span>

<span class="cm">/* Common PXA2xx bits first */</span>
<span class="cp">#define SSCR0_DSS	(0x0000000f)	</span><span class="cm">/* Data Size Select (mask) */</span><span class="cp"></span>
<span class="cp">#define SSCR0_DataSize(x)  ((x) - 1)	</span><span class="cm">/* Data Size Select [4..16] */</span><span class="cp"></span>
<span class="cp">#define SSCR0_FRF	(0x00000030)	</span><span class="cm">/* FRame Format (mask) */</span><span class="cp"></span>
<span class="cp">#define SSCR0_Motorola	(0x0 &lt;&lt; 4)	</span><span class="cm">/* Motorola&#39;s Serial Peripheral Interface (SPI) */</span><span class="cp"></span>
<span class="cp">#define SSCR0_TI	(0x1 &lt;&lt; 4)	</span><span class="cm">/* Texas Instruments&#39; Synchronous Serial Protocol (SSP) */</span><span class="cp"></span>
<span class="cp">#define SSCR0_National	(0x2 &lt;&lt; 4)	</span><span class="cm">/* National Microwire */</span><span class="cp"></span>
<span class="cp">#define SSCR0_ECS	(1 &lt;&lt; 6)	</span><span class="cm">/* External clock select */</span><span class="cp"></span>
<span class="cp">#define SSCR0_SSE	(1 &lt;&lt; 7)	</span><span class="cm">/* Synchronous Serial Port Enable */</span><span class="cp"></span>
<span class="cp">#define SSCR0_SCR(x)	((x) &lt;&lt; 8)	</span><span class="cm">/* Serial Clock Rate (mask) */</span><span class="cp"></span>

<span class="cm">/* PXA27x, PXA3xx */</span>
<span class="cp">#define SSCR0_EDSS	(1 &lt;&lt; 20)	</span><span class="cm">/* Extended data size select */</span><span class="cp"></span>
<span class="cp">#define SSCR0_NCS	(1 &lt;&lt; 21)	</span><span class="cm">/* Network clock select */</span><span class="cp"></span>
<span class="cp">#define SSCR0_RIM	(1 &lt;&lt; 22)	</span><span class="cm">/* Receive FIFO overrrun interrupt mask */</span><span class="cp"></span>
<span class="cp">#define SSCR0_TUM	(1 &lt;&lt; 23)	</span><span class="cm">/* Transmit FIFO underrun interrupt mask */</span><span class="cp"></span>
<span class="cp">#define SSCR0_FRDC	(0x07000000)	</span><span class="cm">/* Frame rate divider control (mask) */</span><span class="cp"></span>
<span class="cp">#define SSCR0_SlotsPerFrm(x) (((x) - 1) &lt;&lt; 24)	</span><span class="cm">/* Time slots per frame [1..8] */</span><span class="cp"></span>
<span class="cp">#define SSCR0_FPCKE	(1 &lt;&lt; 29)	</span><span class="cm">/* FIFO packing enable */</span><span class="cp"></span>
<span class="cp">#define SSCR0_ACS	(1 &lt;&lt; 30)	</span><span class="cm">/* Audio clock select */</span><span class="cp"></span>
<span class="cp">#define SSCR0_MOD	(1 &lt;&lt; 31)	</span><span class="cm">/* Mode (normal or network) */</span><span class="cp"></span>


<span class="cp">#define SSCR1_RIE	(1 &lt;&lt; 0)	</span><span class="cm">/* Receive FIFO Interrupt Enable */</span><span class="cp"></span>
<span class="cp">#define SSCR1_TIE	(1 &lt;&lt; 1)	</span><span class="cm">/* Transmit FIFO Interrupt Enable */</span><span class="cp"></span>
<span class="cp">#define SSCR1_LBM	(1 &lt;&lt; 2)	</span><span class="cm">/* Loop-Back Mode */</span><span class="cp"></span>
<span class="cp">#define SSCR1_SPO	(1 &lt;&lt; 3)	</span><span class="cm">/* Motorola SPI SSPSCLK polarity setting */</span><span class="cp"></span>
<span class="cp">#define SSCR1_SPH	(1 &lt;&lt; 4)	</span><span class="cm">/* Motorola SPI SSPSCLK phase setting */</span><span class="cp"></span>
<span class="cp">#define SSCR1_MWDS	(1 &lt;&lt; 5)	</span><span class="cm">/* Microwire Transmit Data Size */</span><span class="cp"></span>

<span class="cp">#define SSSR_ALT_FRM_MASK	3	</span><span class="cm">/* Masks the SFRM signal number */</span><span class="cp"></span>
<span class="cp">#define SSSR_TNF	(1 &lt;&lt; 2)	</span><span class="cm">/* Transmit FIFO Not Full */</span><span class="cp"></span>
<span class="cp">#define SSSR_RNE	(1 &lt;&lt; 3)	</span><span class="cm">/* Receive FIFO Not Empty */</span><span class="cp"></span>
<span class="cp">#define SSSR_BSY	(1 &lt;&lt; 4)	</span><span class="cm">/* SSP Busy */</span><span class="cp"></span>
<span class="cp">#define SSSR_TFS	(1 &lt;&lt; 5)	</span><span class="cm">/* Transmit FIFO Service Request */</span><span class="cp"></span>
<span class="cp">#define SSSR_RFS	(1 &lt;&lt; 6)	</span><span class="cm">/* Receive FIFO Service Request */</span><span class="cp"></span>
<span class="cp">#define SSSR_ROR	(1 &lt;&lt; 7)	</span><span class="cm">/* Receive FIFO Overrun */</span><span class="cp"></span>

<span class="cp">#ifdef CONFIG_ARCH_PXA</span>
<span class="cp">#define RX_THRESH_DFLT	8</span>
<span class="cp">#define TX_THRESH_DFLT	8</span>

<span class="cp">#define SSSR_TFL_MASK	(0xf &lt;&lt; 8)	</span><span class="cm">/* Transmit FIFO Level mask */</span><span class="cp"></span>
<span class="cp">#define SSSR_RFL_MASK	(0xf &lt;&lt; 12)	</span><span class="cm">/* Receive FIFO Level mask */</span><span class="cp"></span>

<span class="cp">#define SSCR1_TFT	(0x000003c0)	</span><span class="cm">/* Transmit FIFO Threshold (mask) */</span><span class="cp"></span>
<span class="cp">#define SSCR1_TxTresh(x) (((x) - 1) &lt;&lt; 6) </span><span class="cm">/* level [1..16] */</span><span class="cp"></span>
<span class="cp">#define SSCR1_RFT	(0x00003c00)	</span><span class="cm">/* Receive FIFO Threshold (mask) */</span><span class="cp"></span>
<span class="cp">#define SSCR1_RxTresh(x) (((x) - 1) &lt;&lt; 10) </span><span class="cm">/* level [1..16] */</span><span class="cp"></span>

<span class="cp">#else</span>

<span class="cp">#define RX_THRESH_DFLT	2</span>
<span class="cp">#define TX_THRESH_DFLT	2</span>

<span class="cp">#define SSSR_TFL_MASK	(0x3 &lt;&lt; 8)	</span><span class="cm">/* Transmit FIFO Level mask */</span><span class="cp"></span>
<span class="cp">#define SSSR_RFL_MASK	(0x3 &lt;&lt; 12)	</span><span class="cm">/* Receive FIFO Level mask */</span><span class="cp"></span>

<span class="cp">#define SSCR1_TFT	(0x000000c0)	</span><span class="cm">/* Transmit FIFO Threshold (mask) */</span><span class="cp"></span>
<span class="cp">#define SSCR1_TxTresh(x) (((x) - 1) &lt;&lt; 6) </span><span class="cm">/* level [1..4] */</span><span class="cp"></span>
<span class="cp">#define SSCR1_RFT	(0x00000c00)	</span><span class="cm">/* Receive FIFO Threshold (mask) */</span><span class="cp"></span>
<span class="cp">#define SSCR1_RxTresh(x) (((x) - 1) &lt;&lt; 10) </span><span class="cm">/* level [1..4] */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cm">/* extra bits in PXA255, PXA26x and PXA27x SSP ports */</span>
<span class="cp">#define SSCR0_TISSP		(1 &lt;&lt; 4)	</span><span class="cm">/* TI Sync Serial Protocol */</span><span class="cp"></span>
<span class="cp">#define SSCR0_PSP		(3 &lt;&lt; 4)	</span><span class="cm">/* PSP - Programmable Serial Protocol */</span><span class="cp"></span>
<span class="cp">#define SSCR1_TTELP		(1 &lt;&lt; 31)	</span><span class="cm">/* TXD Tristate Enable Last Phase */</span><span class="cp"></span>
<span class="cp">#define SSCR1_TTE		(1 &lt;&lt; 30)	</span><span class="cm">/* TXD Tristate Enable */</span><span class="cp"></span>
<span class="cp">#define SSCR1_EBCEI		(1 &lt;&lt; 29)	</span><span class="cm">/* Enable Bit Count Error interrupt */</span><span class="cp"></span>
<span class="cp">#define SSCR1_SCFR		(1 &lt;&lt; 28)	</span><span class="cm">/* Slave Clock free Running */</span><span class="cp"></span>
<span class="cp">#define SSCR1_ECRA		(1 &lt;&lt; 27)	</span><span class="cm">/* Enable Clock Request A */</span><span class="cp"></span>
<span class="cp">#define SSCR1_ECRB		(1 &lt;&lt; 26)	</span><span class="cm">/* Enable Clock request B */</span><span class="cp"></span>
<span class="cp">#define SSCR1_SCLKDIR		(1 &lt;&lt; 25)	</span><span class="cm">/* Serial Bit Rate Clock Direction */</span><span class="cp"></span>
<span class="cp">#define SSCR1_SFRMDIR		(1 &lt;&lt; 24)	</span><span class="cm">/* Frame Direction */</span><span class="cp"></span>
<span class="cp">#define SSCR1_RWOT		(1 &lt;&lt; 23)	</span><span class="cm">/* Receive Without Transmit */</span><span class="cp"></span>
<span class="cp">#define SSCR1_TRAIL		(1 &lt;&lt; 22)	</span><span class="cm">/* Trailing Byte */</span><span class="cp"></span>
<span class="cp">#define SSCR1_TSRE		(1 &lt;&lt; 21)	</span><span class="cm">/* Transmit Service Request Enable */</span><span class="cp"></span>
<span class="cp">#define SSCR1_RSRE		(1 &lt;&lt; 20)	</span><span class="cm">/* Receive Service Request Enable */</span><span class="cp"></span>
<span class="cp">#define SSCR1_TINTE		(1 &lt;&lt; 19)	</span><span class="cm">/* Receiver Time-out Interrupt enable */</span><span class="cp"></span>
<span class="cp">#define SSCR1_PINTE		(1 &lt;&lt; 18)	</span><span class="cm">/* Peripheral Trailing Byte Interrupt Enable */</span><span class="cp"></span>
<span class="cp">#define SSCR1_IFS		(1 &lt;&lt; 16)	</span><span class="cm">/* Invert Frame Signal */</span><span class="cp"></span>
<span class="cp">#define SSCR1_STRF		(1 &lt;&lt; 15)	</span><span class="cm">/* Select FIFO or EFWR */</span><span class="cp"></span>
<span class="cp">#define SSCR1_EFWR		(1 &lt;&lt; 14)	</span><span class="cm">/* Enable FIFO Write/Read */</span><span class="cp"></span>

<span class="cp">#define SSSR_BCE		(1 &lt;&lt; 23)	</span><span class="cm">/* Bit Count Error */</span><span class="cp"></span>
<span class="cp">#define SSSR_CSS		(1 &lt;&lt; 22)	</span><span class="cm">/* Clock Synchronisation Status */</span><span class="cp"></span>
<span class="cp">#define SSSR_TUR		(1 &lt;&lt; 21)	</span><span class="cm">/* Transmit FIFO Under Run */</span><span class="cp"></span>
<span class="cp">#define SSSR_EOC		(1 &lt;&lt; 20)	</span><span class="cm">/* End Of Chain */</span><span class="cp"></span>
<span class="cp">#define SSSR_TINT		(1 &lt;&lt; 19)	</span><span class="cm">/* Receiver Time-out Interrupt */</span><span class="cp"></span>
<span class="cp">#define SSSR_PINT		(1 &lt;&lt; 18)	</span><span class="cm">/* Peripheral Trailing Byte Interrupt */</span><span class="cp"></span>


<span class="cp">#define SSPSP_SCMODE(x)		((x) &lt;&lt; 0)	</span><span class="cm">/* Serial Bit Rate Clock Mode */</span><span class="cp"></span>
<span class="cp">#define SSPSP_SFRMP		(1 &lt;&lt; 2)	</span><span class="cm">/* Serial Frame Polarity */</span><span class="cp"></span>
<span class="cp">#define SSPSP_ETDS		(1 &lt;&lt; 3)	</span><span class="cm">/* End of Transfer data State */</span><span class="cp"></span>
<span class="cp">#define SSPSP_STRTDLY(x)	((x) &lt;&lt; 4)	</span><span class="cm">/* Start Delay */</span><span class="cp"></span>
<span class="cp">#define SSPSP_DMYSTRT(x)	((x) &lt;&lt; 7)	</span><span class="cm">/* Dummy Start */</span><span class="cp"></span>
<span class="cp">#define SSPSP_SFRMDLY(x)	((x) &lt;&lt; 9)	</span><span class="cm">/* Serial Frame Delay */</span><span class="cp"></span>
<span class="cp">#define SSPSP_SFRMWDTH(x)	((x) &lt;&lt; 16)	</span><span class="cm">/* Serial Frame Width */</span><span class="cp"></span>
<span class="cp">#define SSPSP_DMYSTOP(x)	((x) &lt;&lt; 23)	</span><span class="cm">/* Dummy Stop */</span><span class="cp"></span>
<span class="cp">#define SSPSP_FSRT		(1 &lt;&lt; 25)	</span><span class="cm">/* Frame Sync Relative Timing */</span><span class="cp"></span>

<span class="cm">/* PXA3xx */</span>
<span class="cp">#define SSPSP_EDMYSTRT(x)	((x) &lt;&lt; 26)     </span><span class="cm">/* Extended Dummy Start */</span><span class="cp"></span>
<span class="cp">#define SSPSP_EDMYSTOP(x)	((x) &lt;&lt; 28)     </span><span class="cm">/* Extended Dummy Stop */</span><span class="cp"></span>
<span class="cp">#define SSPSP_TIMING_MASK	(0x7f8001f0)</span>

<span class="cp">#define SSACD_SCDB		(1 &lt;&lt; 3)	</span><span class="cm">/* SSPSYSCLK Divider Bypass */</span><span class="cp"></span>
<span class="cp">#define SSACD_ACPS(x)		((x) &lt;&lt; 4)	</span><span class="cm">/* Audio clock PLL select */</span><span class="cp"></span>
<span class="cp">#define SSACD_ACDS(x)		((x) &lt;&lt; 0)	</span><span class="cm">/* Audio clock divider select */</span><span class="cp"></span>
<span class="cp">#define SSACD_SCDX8		(1 &lt;&lt; 7)	</span><span class="cm">/* SYSCLK division ratio select */</span><span class="cp"></span>

<span class="k">enum</span> <span class="n">pxa_ssp_type</span> <span class="p">{</span>
	<span class="n">SSP_UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">PXA25x_SSP</span><span class="p">,</span>  <span class="cm">/* pxa 210, 250, 255, 26x */</span>
	<span class="n">PXA25x_NSSP</span><span class="p">,</span> <span class="cm">/* pxa 255, 26x (including ASSP) */</span>
	<span class="n">PXA27x_SSP</span><span class="p">,</span>
	<span class="n">PXA3xx_SSP</span><span class="p">,</span>
	<span class="n">PXA168_SSP</span><span class="p">,</span>
	<span class="n">PXA910_SSP</span><span class="p">,</span>
	<span class="n">CE4100_SSP</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ssp_device</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">node</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">clk</span>	<span class="o">*</span><span class="n">clk</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">mmio_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">phys_base</span><span class="p">;</span>

	<span class="k">const</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">label</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">port_id</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">type</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">use_count</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">irq</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">drcmr_rx</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">drcmr_tx</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * pxa_ssp_write_reg - Write to a SSP register</span>
<span class="cm"> *</span>
<span class="cm"> * @dev: SSP device to access</span>
<span class="cm"> * @reg: Register to write to</span>
<span class="cm"> * @val: Value to be written.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">pxa_ssp_write_reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">ssp_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">mmio_base</span> <span class="o">+</span> <span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * pxa_ssp_read_reg - Read from a SSP register</span>
<span class="cm"> *</span>
<span class="cm"> * @dev: SSP device to access</span>
<span class="cm"> * @reg: Register to read from</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">pxa_ssp_read_reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">ssp_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">mmio_base</span> <span class="o">+</span> <span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">ssp_device</span> <span class="o">*</span><span class="n">pxa_ssp_request</span><span class="p">(</span><span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">pxa_ssp_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">ssp_device</span> <span class="o">*</span><span class="p">);</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
