<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › cm4000_cs.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>cm4000_cs.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef	_CM4000_H_</span>
<span class="cp">#define	_CM4000_H_</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#define	MAX_ATR			33</span>

<span class="cp">#define	CM4000_MAX_DEV		4</span>

<span class="cm">/* those two structures are passed via ioctl() from/to userspace.  They are</span>
<span class="cm"> * used by existing userspace programs, so I kepth the awkward &quot;bIFSD&quot; naming</span>
<span class="cm"> * not to break compilation of userspace apps. -HW */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">atreq</span> <span class="p">{</span>
	<span class="n">__s32</span> <span class="n">atr_len</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">atr</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="n">__s32</span> <span class="n">power_act</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">bIFSD</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">bIFSC</span><span class="p">;</span>
<span class="p">}</span> <span class="n">atreq_t</span><span class="p">;</span>


<span class="cm">/* what is particularly stupid in the original driver is the arch-dependent</span>
<span class="cm"> * member sizes. This leads to CONFIG_COMPAT breakage, since 32bit userspace</span>
<span class="cm"> * will lay out the structure members differently than the 64bit kernel.</span>
<span class="cm"> *</span>
<span class="cm"> * I&#39;ve changed &quot;ptsreq.protocol&quot; from &quot;unsigned long&quot; to &quot;__u32&quot;.</span>
<span class="cm"> * On 32bit this will make no difference.  With 64bit kernels, it will make</span>
<span class="cm"> * 32bit apps work, too.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ptsreq</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">protocol</span><span class="p">;</span> <span class="cm">/*T=0: 2^0, T=1:  2^1*/</span>
 	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">flags</span><span class="p">;</span>
 	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pts1</span><span class="p">;</span>
 	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pts2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pts3</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ptsreq_t</span><span class="p">;</span>

<span class="cp">#define	CM_IOC_MAGIC		&#39;c&#39;</span>
<span class="cp">#define	CM_IOC_MAXNR	        255</span>

<span class="cp">#define	CM_IOCGSTATUS		_IOR (CM_IOC_MAGIC, 0, unsigned char *)</span>
<span class="cp">#define	CM_IOCGATR		_IOWR(CM_IOC_MAGIC, 1, atreq_t *)</span>
<span class="cp">#define	CM_IOCSPTS		_IOW (CM_IOC_MAGIC, 2, ptsreq_t *)</span>
<span class="cp">#define	CM_IOCSRDR		_IO  (CM_IOC_MAGIC, 3)</span>
<span class="cp">#define CM_IOCARDOFF            _IO  (CM_IOC_MAGIC, 4)</span>

<span class="cp">#define CM_IOSDBGLVL            _IOW(CM_IOC_MAGIC, 250, int*)</span>

<span class="cm">/* card and device states */</span>
<span class="cp">#define	CM_CARD_INSERTED		0x01</span>
<span class="cp">#define	CM_CARD_POWERED			0x02</span>
<span class="cp">#define	CM_ATR_PRESENT			0x04</span>
<span class="cp">#define	CM_ATR_VALID	 		0x08</span>
<span class="cp">#define	CM_STATE_VALID			0x0f</span>
<span class="cm">/* extra info only from CM4000 */</span>
<span class="cp">#define	CM_NO_READER			0x10</span>
<span class="cp">#define	CM_BAD_CARD			0x20</span>


<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#define	DEVICE_NAME		&quot;cmm&quot;</span>
<span class="cp">#define	MODULE_NAME		&quot;cm4000_cs&quot;</span>

<span class="cp">#endif	</span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif	</span><span class="cm">/* _CM4000_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
