<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › sungem_phy.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>sungem_phy.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __SUNGEM_PHY_H__</span>
<span class="cp">#define __SUNGEM_PHY_H__</span>

<span class="k">struct</span> <span class="n">mii_phy</span><span class="p">;</span>

<span class="cm">/* Operations supported by any kind of PHY */</span>
<span class="k">struct</span> <span class="n">mii_phy_ops</span>
<span class="p">{</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mii_phy</span> <span class="o">*</span><span class="n">phy</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">suspend</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mii_phy</span> <span class="o">*</span><span class="n">phy</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">setup_aneg</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mii_phy</span> <span class="o">*</span><span class="n">phy</span><span class="p">,</span> <span class="n">u32</span> <span class="n">advertise</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">setup_forced</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mii_phy</span> <span class="o">*</span><span class="n">phy</span><span class="p">,</span> <span class="kt">int</span> <span class="n">speed</span><span class="p">,</span> <span class="kt">int</span> <span class="n">fd</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">poll_link</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mii_phy</span> <span class="o">*</span><span class="n">phy</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">read_link</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mii_phy</span> <span class="o">*</span><span class="n">phy</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">enable_fiber</span><span class="p">)(</span><span class="k">struct</span> <span class="n">mii_phy</span> <span class="o">*</span><span class="n">phy</span><span class="p">,</span> <span class="kt">int</span> <span class="n">autoneg</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* Structure used to statically define an mii/gii based PHY */</span>
<span class="k">struct</span> <span class="n">mii_phy_def</span>
<span class="p">{</span>
	<span class="n">u32</span>				<span class="n">phy_id</span><span class="p">;</span>		<span class="cm">/* Concatenated ID1 &lt;&lt; 16 | ID2 */</span>
	<span class="n">u32</span>				<span class="n">phy_id_mask</span><span class="p">;</span>	<span class="cm">/* Significant bits */</span>
	<span class="n">u32</span>				<span class="n">features</span><span class="p">;</span>	<span class="cm">/* Ethtool SUPPORTED_* defines */</span>
	<span class="kt">int</span>				<span class="n">magic_aneg</span><span class="p">;</span>	<span class="cm">/* Autoneg does all speed test for us */</span>
	<span class="k">const</span> <span class="kt">char</span><span class="o">*</span>			<span class="n">name</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">mii_phy_ops</span><span class="o">*</span>	<span class="n">ops</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">BCM54XX_COPPER</span><span class="p">,</span>
	<span class="n">BCM54XX_FIBER</span><span class="p">,</span>
	<span class="n">BCM54XX_GBIC</span><span class="p">,</span>
	<span class="n">BCM54XX_SGMII</span><span class="p">,</span>
	<span class="n">BCM54XX_UNKNOWN</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* An instance of a PHY, partially borrowed from mii_if_info */</span>
<span class="k">struct</span> <span class="n">mii_phy</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mii_phy_def</span><span class="o">*</span>	<span class="n">def</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">advertising</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">mii_id</span><span class="p">;</span>

	<span class="cm">/* 1: autoneg enabled, 0: disabled */</span>
	<span class="kt">int</span>			<span class="n">autoneg</span><span class="p">;</span>

	<span class="cm">/* forced speed &amp; duplex (no autoneg)</span>
<span class="cm">	 * partner speed &amp; duplex &amp; pause (autoneg)</span>
<span class="cm">	 */</span>
	<span class="kt">int</span>			<span class="n">speed</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">duplex</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">pause</span><span class="p">;</span>

	<span class="cm">/* Provided by host chip */</span>
	<span class="k">struct</span> <span class="n">net_device</span>	<span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">mdio_read</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mii_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">mdio_write</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mii_id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">);</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">platform_data</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Pass in a struct mii_phy with dev, mdio_read and mdio_write</span>
<span class="cm"> * filled, the remaining fields will be filled on return</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">sungem_phy_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">mii_phy</span> <span class="o">*</span><span class="n">phy</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mii_id</span><span class="p">);</span>


<span class="cm">/* MII definitions missing from mii.h */</span>

<span class="cp">#define BMCR_SPD2	0x0040		</span><span class="cm">/* Gigabit enable (bcm54xx)	*/</span><span class="cp"></span>
<span class="cp">#define LPA_PAUSE	0x0400</span>

<span class="cm">/* More PHY registers (model specific) */</span>

<span class="cm">/* MII BCM5201 MULTIPHY interrupt register */</span>
<span class="cp">#define MII_BCM5201_INTERRUPT			0x1A</span>
<span class="cp">#define MII_BCM5201_INTERRUPT_INTENABLE		0x4000</span>

<span class="cp">#define MII_BCM5201_AUXMODE2			0x1B</span>
<span class="cp">#define MII_BCM5201_AUXMODE2_LOWPOWER		0x0008</span>

<span class="cp">#define MII_BCM5201_MULTIPHY                    0x1E</span>

<span class="cm">/* MII BCM5201 MULTIPHY register bits */</span>
<span class="cp">#define MII_BCM5201_MULTIPHY_SERIALMODE         0x0002</span>
<span class="cp">#define MII_BCM5201_MULTIPHY_SUPERISOLATE       0x0008</span>

<span class="cm">/* MII BCM5221 Additional registers */</span>
<span class="cp">#define MII_BCM5221_TEST			0x1f</span>
<span class="cp">#define MII_BCM5221_TEST_ENABLE_SHADOWS		0x0080</span>
<span class="cp">#define MII_BCM5221_SHDOW_AUX_STAT2		0x1b</span>
<span class="cp">#define MII_BCM5221_SHDOW_AUX_STAT2_APD		0x0020</span>
<span class="cp">#define MII_BCM5221_SHDOW_AUX_MODE4		0x1a</span>
<span class="cp">#define MII_BCM5221_SHDOW_AUX_MODE4_IDDQMODE	0x0001</span>
<span class="cp">#define MII_BCM5221_SHDOW_AUX_MODE4_CLKLOPWR	0x0004</span>

<span class="cm">/* MII BCM5241 Additional registers */</span>
<span class="cp">#define MII_BCM5241_SHDOW_AUX_MODE4_STANDBYPWR	0x0008</span>

<span class="cm">/* MII BCM5400 1000-BASET Control register */</span>
<span class="cp">#define MII_BCM5400_GB_CONTROL			0x09</span>
<span class="cp">#define MII_BCM5400_GB_CONTROL_FULLDUPLEXCAP	0x0200</span>

<span class="cm">/* MII BCM5400 AUXCONTROL register */</span>
<span class="cp">#define MII_BCM5400_AUXCONTROL                  0x18</span>
<span class="cp">#define MII_BCM5400_AUXCONTROL_PWR10BASET       0x0004</span>

<span class="cm">/* MII BCM5400 AUXSTATUS register */</span>
<span class="cp">#define MII_BCM5400_AUXSTATUS                   0x19</span>
<span class="cp">#define MII_BCM5400_AUXSTATUS_LINKMODE_MASK     0x0700</span>
<span class="cp">#define MII_BCM5400_AUXSTATUS_LINKMODE_SHIFT    8</span>

<span class="cm">/* 1000BT control (Marvell &amp; BCM54xx at least) */</span>
<span class="cp">#define MII_1000BASETCONTROL			0x09</span>
<span class="cp">#define MII_1000BASETCONTROL_FULLDUPLEXCAP	0x0200</span>
<span class="cp">#define MII_1000BASETCONTROL_HALFDUPLEXCAP	0x0100</span>

<span class="cm">/* Marvell 88E1011 PHY control */</span>
<span class="cp">#define MII_M1011_PHY_SPEC_CONTROL		0x10</span>
<span class="cp">#define MII_M1011_PHY_SPEC_CONTROL_MANUAL_MDIX	0x20</span>
<span class="cp">#define MII_M1011_PHY_SPEC_CONTROL_AUTO_MDIX	0x40</span>

<span class="cm">/* Marvell 88E1011 PHY status */</span>
<span class="cp">#define MII_M1011_PHY_SPEC_STATUS		0x11</span>
<span class="cp">#define MII_M1011_PHY_SPEC_STATUS_1000		0x8000</span>
<span class="cp">#define MII_M1011_PHY_SPEC_STATUS_100		0x4000</span>
<span class="cp">#define MII_M1011_PHY_SPEC_STATUS_SPD_MASK	0xc000</span>
<span class="cp">#define MII_M1011_PHY_SPEC_STATUS_FULLDUPLEX	0x2000</span>
<span class="cp">#define MII_M1011_PHY_SPEC_STATUS_RESOLVED	0x0800</span>
<span class="cp">#define MII_M1011_PHY_SPEC_STATUS_TX_PAUSE	0x0008</span>
<span class="cp">#define MII_M1011_PHY_SPEC_STATUS_RX_PAUSE	0x0004</span>

<span class="cp">#endif </span><span class="cm">/* __SUNGEM_PHY_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
