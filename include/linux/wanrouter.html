<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › wanrouter.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>wanrouter.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*****************************************************************************</span>
<span class="cm">* wanrouter.h	Definitions for the WAN Multiprotocol Router Module.</span>
<span class="cm">*		This module provides API and common services for WAN Link</span>
<span class="cm">*		Drivers and is completely hardware-independent.</span>
<span class="cm">*</span>
<span class="cm">* Author: 	Nenad Corbic &lt;ncorbic@sangoma.com&gt;</span>
<span class="cm">*		Gideon Hack 	</span>
<span class="cm">* Additions:	Arnaldo Melo</span>
<span class="cm">*</span>
<span class="cm">* Copyright:	(c) 1995-2000 Sangoma Technologies Inc.</span>
<span class="cm">*</span>
<span class="cm">*		This program is free software; you can redistribute it and/or</span>
<span class="cm">*		modify it under the terms of the GNU General Public License</span>
<span class="cm">*		as published by the Free Software Foundation; either version</span>
<span class="cm">*		2 of the License, or (at your option) any later version.</span>
<span class="cm">* ============================================================================</span>
<span class="cm">* Jul 21, 2000  Nenad Corbic	Added WAN_FT1_READY State</span>
<span class="cm">* Feb 24, 2000  Nenad Corbic    Added support for socket based x25api</span>
<span class="cm">* Jan 28, 2000  Nenad Corbic    Added support for the ASYNC protocol.</span>
<span class="cm">* Oct 04, 1999  Nenad Corbic 	Updated for 2.1.0 release</span>
<span class="cm">* Jun 02, 1999  Gideon Hack	Added support for the S514 adapter.</span>
<span class="cm">* May 23, 1999	Arnaldo Melo	Added local_addr to wanif_conf_t</span>
<span class="cm">*				WAN_DISCONNECTING state added</span>
<span class="cm">* Jul 20, 1998	David Fong	Added Inverse ARP options to &#39;wanif_conf_t&#39;</span>
<span class="cm">* Jun 12, 1998	David Fong	Added Cisco HDLC support.</span>
<span class="cm">* Dec 16, 1997	Jaspreet Singh	Moved &#39;enable_IPX&#39; and &#39;network_number&#39; to</span>
<span class="cm">*				&#39;wanif_conf_t&#39;</span>
<span class="cm">* Dec 05, 1997	Jaspreet Singh	Added &#39;pap&#39;, &#39;chap&#39; to &#39;wanif_conf_t&#39;</span>
<span class="cm">*				Added &#39;authenticator&#39; to &#39;wan_ppp_conf_t&#39;</span>
<span class="cm">* Nov 06, 1997	Jaspreet Singh	Changed Router Driver version to 1.1 from 1.0</span>
<span class="cm">* Oct 20, 1997	Jaspreet Singh	Added &#39;cir&#39;,&#39;bc&#39;,&#39;be&#39; and &#39;mc&#39; to &#39;wanif_conf_t&#39;</span>
<span class="cm">*				Added &#39;enable_IPX&#39; and &#39;network_number&#39; to </span>
<span class="cm">*				&#39;wan_device_t&#39;.  Also added defines for</span>
<span class="cm">*				UDP PACKET TYPE, Interrupt test, critical values</span>
<span class="cm">*				for RACE conditions.</span>
<span class="cm">* Oct 05, 1997	Jaspreet Singh	Added &#39;dlci_num&#39; and &#39;dlci[100]&#39; to </span>
<span class="cm">*				&#39;wan_fr_conf_t&#39; to configure a list of dlci(s)</span>
<span class="cm">*				for a NODE </span>
<span class="cm">* Jul 07, 1997	Jaspreet Singh	Added &#39;ttl&#39; to &#39;wandev_conf_t&#39; &amp; &#39;wan_device_t&#39;</span>
<span class="cm">* May 29, 1997 	Jaspreet Singh	Added &#39;tx_int_enabled&#39; to &#39;wan_device_t&#39;</span>
<span class="cm">* May 21, 1997	Jaspreet Singh	Added &#39;udp_port&#39; to &#39;wan_device_t&#39;</span>
<span class="cm">* Apr 25, 1997  Farhan Thawar   Added &#39;udp_port&#39; to &#39;wandev_conf_t&#39;</span>
<span class="cm">* Jan 16, 1997	Gene Kozin	router_devlist made public</span>
<span class="cm">* Jan 02, 1997	Gene Kozin	Initial version (based on wanpipe.h).</span>
<span class="cm">*****************************************************************************/</span>

<span class="cp">#ifndef	_ROUTER_H</span>
<span class="cp">#define	_ROUTER_H</span>

<span class="cp">#define	ROUTER_NAME	&quot;wanrouter&quot;	</span><span class="cm">/* in case we ever change it */</span><span class="cp"></span>
<span class="cp">#define	ROUTER_VERSION	1		</span><span class="cm">/* version number */</span><span class="cp"></span>
<span class="cp">#define	ROUTER_RELEASE	1		</span><span class="cm">/* release (minor version) number */</span><span class="cp"></span>
<span class="cp">#define	ROUTER_IOCTL	&#39;W&#39;		</span><span class="cm">/* for IOCTL calls */</span><span class="cp"></span>
<span class="cp">#define	ROUTER_MAGIC	0x524D4157L	</span><span class="cm">/* signature: &#39;WANR&#39; reversed */</span><span class="cp"></span>

<span class="cm">/* IOCTL codes for /proc/router/&lt;device&gt; entries (up to 255) */</span>
<span class="k">enum</span> <span class="n">router_ioctls</span>
<span class="p">{</span>
	<span class="n">ROUTER_SETUP</span>	<span class="o">=</span> <span class="n">ROUTER_IOCTL</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">,</span>	<span class="cm">/* configure device */</span>
	<span class="n">ROUTER_DOWN</span><span class="p">,</span>				<span class="cm">/* shut down device */</span>
	<span class="n">ROUTER_STAT</span><span class="p">,</span>				<span class="cm">/* get device status */</span>
	<span class="n">ROUTER_IFNEW</span><span class="p">,</span>				<span class="cm">/* add interface */</span>
	<span class="n">ROUTER_IFDEL</span><span class="p">,</span>				<span class="cm">/* delete interface */</span>
	<span class="n">ROUTER_IFSTAT</span><span class="p">,</span>				<span class="cm">/* get interface status */</span>
	<span class="n">ROUTER_USER</span>	<span class="o">=</span> <span class="p">(</span><span class="n">ROUTER_IOCTL</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="mi">16</span><span class="p">,</span>	<span class="cm">/* driver-specific calls */</span>
	<span class="n">ROUTER_USER_MAX</span>	<span class="o">=</span> <span class="p">(</span><span class="n">ROUTER_IOCTL</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="mi">31</span>
<span class="p">};</span>

<span class="cm">/* identifiers for displaying proc file data for dual port adapters */</span>
<span class="cp">#define PROC_DATA_PORT_0 0x8000	</span><span class="cm">/* the data is for port 0 */</span><span class="cp"></span>
<span class="cp">#define PROC_DATA_PORT_1 0x8001	</span><span class="cm">/* the data is for port 1 */</span><span class="cp"></span>

<span class="cm">/* NLPID for packet encapsulation (ISO/IEC TR 9577) */</span>
<span class="cp">#define	NLPID_IP	0xCC	</span><span class="cm">/* Internet Protocol Datagram */</span><span class="cp"></span>
<span class="cp">#define	NLPID_SNAP	0x80	</span><span class="cm">/* IEEE Subnetwork Access Protocol */</span><span class="cp"></span>
<span class="cp">#define	NLPID_CLNP	0x81	</span><span class="cm">/* ISO/IEC 8473 */</span><span class="cp"></span>
<span class="cp">#define	NLPID_ESIS	0x82	</span><span class="cm">/* ISO/IEC 9542 */</span><span class="cp"></span>
<span class="cp">#define	NLPID_ISIS	0x83	</span><span class="cm">/* ISO/IEC ISIS */</span><span class="cp"></span>
<span class="cp">#define	NLPID_Q933	0x08	</span><span class="cm">/* CCITT Q.933 */</span><span class="cp"></span>

<span class="cm">/* Miscellaneous */</span>
<span class="cp">#define	WAN_IFNAME_SZ	15	</span><span class="cm">/* max length of the interface name */</span><span class="cp"></span>
<span class="cp">#define	WAN_DRVNAME_SZ	15	</span><span class="cm">/* max length of the link driver name */</span><span class="cp"></span>
<span class="cp">#define	WAN_ADDRESS_SZ	31	</span><span class="cm">/* max length of the WAN media address */</span><span class="cp"></span>
<span class="cp">#define USED_BY_FIELD	8	</span><span class="cm">/* max length of the used by field */</span><span class="cp"></span>

<span class="cm">/* Defines for UDP PACKET TYPE */</span>
<span class="cp">#define UDP_PTPIPE_TYPE 	0x01</span>
<span class="cp">#define UDP_FPIPE_TYPE		0x02</span>
<span class="cp">#define UDP_CPIPE_TYPE		0x03</span>
<span class="cp">#define UDP_DRVSTATS_TYPE 	0x04</span>
<span class="cp">#define UDP_INVALID_TYPE  	0x05</span>

<span class="cm">/* Command return code */</span>
<span class="cp">#define CMD_OK		0		</span><span class="cm">/* normal firmware return code */</span><span class="cp"></span>
<span class="cp">#define CMD_TIMEOUT	0xFF		</span><span class="cm">/* firmware command timed out */</span><span class="cp"></span>

<span class="cm">/* UDP Packet Management */</span>
<span class="cp">#define UDP_PKT_FRM_STACK	0x00</span>
<span class="cp">#define UDP_PKT_FRM_NETWORK	0x01</span>

<span class="cm">/* Maximum interrupt test counter */</span>
<span class="cp">#define MAX_INTR_TEST_COUNTER	100</span>

<span class="cm">/* Critical Values for RACE conditions*/</span>
<span class="cp">#define CRITICAL_IN_ISR		0xA1</span>
<span class="cp">#define CRITICAL_INTR_HANDLED	0xB1</span>

<span class="cm">/****** Data Types **********************************************************/</span>

<span class="cm">/*----------------------------------------------------------------------------</span>
<span class="cm"> * X.25-specific link-level configuration.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">wan_x25_conf</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">lo_pvc</span><span class="p">;</span>	<span class="cm">/* lowest permanent circuit number */</span>
	<span class="kt">unsigned</span> <span class="n">hi_pvc</span><span class="p">;</span>	<span class="cm">/* highest permanent circuit number */</span>
	<span class="kt">unsigned</span> <span class="n">lo_svc</span><span class="p">;</span>	<span class="cm">/* lowest switched circuit number */</span>
	<span class="kt">unsigned</span> <span class="n">hi_svc</span><span class="p">;</span>	<span class="cm">/* highest switched circuit number */</span>
	<span class="kt">unsigned</span> <span class="n">hdlc_window</span><span class="p">;</span>	<span class="cm">/* HDLC window size (1..7) */</span>
	<span class="kt">unsigned</span> <span class="n">pkt_window</span><span class="p">;</span>	<span class="cm">/* X.25 packet window size (1..7) */</span>
	<span class="kt">unsigned</span> <span class="n">t1</span><span class="p">;</span>		<span class="cm">/* HDLC timer T1, sec (1..30) */</span>
	<span class="kt">unsigned</span> <span class="n">t2</span><span class="p">;</span>		<span class="cm">/* HDLC timer T2, sec (0..29) */</span>
	<span class="kt">unsigned</span> <span class="n">t4</span><span class="p">;</span>		<span class="cm">/* HDLC supervisory frame timer = T4 * T1 */</span>
	<span class="kt">unsigned</span> <span class="n">n2</span><span class="p">;</span>		<span class="cm">/* HDLC retransmission limit (1..30) */</span>
	<span class="kt">unsigned</span> <span class="n">t10_t20</span><span class="p">;</span>	<span class="cm">/* X.25 RESTART timeout, sec (1..255) */</span>
	<span class="kt">unsigned</span> <span class="n">t11_t21</span><span class="p">;</span>	<span class="cm">/* X.25 CALL timeout, sec (1..255) */</span>
	<span class="kt">unsigned</span> <span class="n">t12_t22</span><span class="p">;</span>	<span class="cm">/* X.25 RESET timeout, sec (1..255) */</span>
	<span class="kt">unsigned</span> <span class="n">t13_t23</span><span class="p">;</span>	<span class="cm">/* X.25 CLEAR timeout, sec (1..255) */</span>
	<span class="kt">unsigned</span> <span class="n">t16_t26</span><span class="p">;</span>	<span class="cm">/* X.25 INTERRUPT timeout, sec (1..255) */</span>
	<span class="kt">unsigned</span> <span class="n">t28</span><span class="p">;</span>		<span class="cm">/* X.25 REGISTRATION timeout, sec (1..255) */</span>
	<span class="kt">unsigned</span> <span class="n">r10_r20</span><span class="p">;</span>	<span class="cm">/* RESTART retransmission limit (0..250) */</span>
	<span class="kt">unsigned</span> <span class="n">r12_r22</span><span class="p">;</span>	<span class="cm">/* RESET retransmission limit (0..250) */</span>
	<span class="kt">unsigned</span> <span class="n">r13_r23</span><span class="p">;</span>	<span class="cm">/* CLEAR retransmission limit (0..250) */</span>
	<span class="kt">unsigned</span> <span class="n">ccitt_compat</span><span class="p">;</span>	<span class="cm">/* compatibility mode: 1988/1984/1980 */</span>
	<span class="kt">unsigned</span> <span class="n">x25_conf_opt</span><span class="p">;</span>   <span class="cm">/* User defined x25 config optoins */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">LAPB_hdlc_only</span><span class="p">;</span> <span class="cm">/* Run in HDLC only mode */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">logging</span><span class="p">;</span>   <span class="cm">/* Control connection logging */</span>  
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">oob_on_modem</span><span class="p">;</span> <span class="cm">/* Whether to send modem status to the user app */</span>
<span class="p">}</span> <span class="n">wan_x25_conf_t</span><span class="p">;</span>

<span class="cm">/*----------------------------------------------------------------------------</span>
<span class="cm"> * Frame relay specific link-level configuration.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">wan_fr_conf</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">signalling</span><span class="p">;</span>	<span class="cm">/* local in-channel signalling type */</span>
	<span class="kt">unsigned</span> <span class="n">t391</span><span class="p">;</span>		<span class="cm">/* link integrity verification timer */</span>
	<span class="kt">unsigned</span> <span class="n">t392</span><span class="p">;</span>		<span class="cm">/* polling verification timer */</span>
	<span class="kt">unsigned</span> <span class="n">n391</span><span class="p">;</span>		<span class="cm">/* full status polling cycle counter */</span>
	<span class="kt">unsigned</span> <span class="n">n392</span><span class="p">;</span>		<span class="cm">/* error threshold counter */</span>
	<span class="kt">unsigned</span> <span class="n">n393</span><span class="p">;</span>		<span class="cm">/* monitored events counter */</span>
	<span class="kt">unsigned</span> <span class="n">dlci_num</span><span class="p">;</span>	<span class="cm">/* number of DLCs (access node) */</span>
	<span class="kt">unsigned</span>  <span class="n">dlci</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>    <span class="cm">/* List of all DLCIs */</span>
<span class="p">}</span> <span class="n">wan_fr_conf_t</span><span class="p">;</span>

<span class="cm">/*----------------------------------------------------------------------------</span>
<span class="cm"> * PPP-specific link-level configuration.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">wan_ppp_conf</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">restart_tmr</span><span class="p">;</span>	<span class="cm">/* restart timer */</span>
	<span class="kt">unsigned</span> <span class="n">auth_rsrt_tmr</span><span class="p">;</span>	<span class="cm">/* authentication timer */</span>
	<span class="kt">unsigned</span> <span class="n">auth_wait_tmr</span><span class="p">;</span>	<span class="cm">/* authentication timer */</span>
	<span class="kt">unsigned</span> <span class="n">mdm_fail_tmr</span><span class="p">;</span>	<span class="cm">/* modem failure timer */</span>
	<span class="kt">unsigned</span> <span class="n">dtr_drop_tmr</span><span class="p">;</span>	<span class="cm">/* DTR drop timer */</span>
	<span class="kt">unsigned</span> <span class="n">connect_tmout</span><span class="p">;</span>	<span class="cm">/* connection timeout */</span>
	<span class="kt">unsigned</span> <span class="n">conf_retry</span><span class="p">;</span>	<span class="cm">/* max. retry */</span>
	<span class="kt">unsigned</span> <span class="n">term_retry</span><span class="p">;</span>	<span class="cm">/* max. retry */</span>
	<span class="kt">unsigned</span> <span class="n">fail_retry</span><span class="p">;</span>	<span class="cm">/* max. retry */</span>
	<span class="kt">unsigned</span> <span class="n">auth_retry</span><span class="p">;</span>	<span class="cm">/* max. retry */</span>
	<span class="kt">unsigned</span> <span class="n">auth_options</span><span class="p">;</span>	<span class="cm">/* authentication opt. */</span>
	<span class="kt">unsigned</span> <span class="n">ip_options</span><span class="p">;</span>	<span class="cm">/* IP options */</span>
	<span class="kt">char</span>	<span class="n">authenticator</span><span class="p">;</span>	<span class="cm">/* AUTHENTICATOR or not */</span>
	<span class="kt">char</span>	<span class="n">ip_mode</span><span class="p">;</span>	<span class="cm">/* Static/Host/Peer */</span>
<span class="p">}</span> <span class="n">wan_ppp_conf_t</span><span class="p">;</span>

<span class="cm">/*----------------------------------------------------------------------------</span>
<span class="cm"> * CHDLC-specific link-level configuration.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">wan_chdlc_conf</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ignore_dcd</span><span class="p">;</span>	<span class="cm">/* Protocol options:		*/</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ignore_cts</span><span class="p">;</span>	<span class="cm">/*  Ignore these to determine	*/</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ignore_keepalive</span><span class="p">;</span>	<span class="cm">/*  link status (Yes or No)	*/</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">hdlc_streaming</span><span class="p">;</span>	<span class="cm">/*  hdlc_streaming mode (Y/N) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">receive_only</span><span class="p">;</span>	<span class="cm">/*  no transmit buffering (Y/N) */</span>
	<span class="kt">unsigned</span> <span class="n">keepalive_tx_tmr</span><span class="p">;</span>	<span class="cm">/* transmit keepalive timer */</span>
	<span class="kt">unsigned</span> <span class="n">keepalive_rx_tmr</span><span class="p">;</span>	<span class="cm">/* receive  keepalive timer */</span>
	<span class="kt">unsigned</span> <span class="n">keepalive_err_margin</span><span class="p">;</span>	<span class="cm">/* keepalive_error_tolerance */</span>
	<span class="kt">unsigned</span> <span class="n">slarp_timer</span><span class="p">;</span>		<span class="cm">/* SLARP request timer */</span>
<span class="p">}</span> <span class="n">wan_chdlc_conf_t</span><span class="p">;</span>


<span class="cm">/*----------------------------------------------------------------------------</span>
<span class="cm"> * WAN device configuration. Passed to ROUTER_SETUP IOCTL.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">wandev_conf</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">magic</span><span class="p">;</span>		<span class="cm">/* magic number (for verification) */</span>
	<span class="kt">unsigned</span> <span class="n">config_id</span><span class="p">;</span>	<span class="cm">/* configuration structure identifier */</span>
				<span class="cm">/****** hardware configuration ******/</span>
	<span class="kt">unsigned</span> <span class="n">ioport</span><span class="p">;</span>	<span class="cm">/* adapter I/O port base */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">maddr</span><span class="p">;</span>	<span class="cm">/* dual-port memory address */</span>
	<span class="kt">unsigned</span> <span class="n">msize</span><span class="p">;</span>		<span class="cm">/* dual-port memory size */</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>		<span class="cm">/* interrupt request level */</span>
	<span class="kt">int</span> <span class="n">dma</span><span class="p">;</span>		<span class="cm">/* DMA request level */</span>
        <span class="kt">char</span> <span class="n">S514_CPU_no</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>	<span class="cm">/* S514 PCI adapter CPU number (&#39;A&#39; or &#39;B&#39;) */</span>
        <span class="kt">unsigned</span> <span class="n">PCI_slot_no</span><span class="p">;</span>	<span class="cm">/* S514 PCI adapter slot number */</span>
	<span class="kt">char</span> <span class="n">auto_pci_cfg</span><span class="p">;</span>	<span class="cm">/* S515 PCI automatic slot detection */</span>
	<span class="kt">char</span> <span class="n">comm_port</span><span class="p">;</span>		<span class="cm">/* Communication Port (PRI=0, SEC=1) */</span> 
	<span class="kt">unsigned</span> <span class="n">bps</span><span class="p">;</span>		<span class="cm">/* data transfer rate */</span>
	<span class="kt">unsigned</span> <span class="n">mtu</span><span class="p">;</span>		<span class="cm">/* maximum transmit unit size */</span>
        <span class="kt">unsigned</span> <span class="n">udp_port</span><span class="p">;</span>      <span class="cm">/* UDP port for management */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ttl</span><span class="p">;</span>	<span class="cm">/* Time To Live for UDP security */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ft1</span><span class="p">;</span>	<span class="cm">/* FT1 Configurator Option */</span>
        <span class="kt">char</span> <span class="n">interface</span><span class="p">;</span>		<span class="cm">/* RS-232/V.35, etc. */</span>
	<span class="kt">char</span> <span class="n">clocking</span><span class="p">;</span>		<span class="cm">/* external/internal */</span>
	<span class="kt">char</span> <span class="n">line_coding</span><span class="p">;</span>	<span class="cm">/* NRZ/NRZI/FM0/FM1, etc. */</span>
	<span class="kt">char</span> <span class="n">station</span><span class="p">;</span>		<span class="cm">/* DTE/DCE, primary/secondary, etc. */</span>
	<span class="kt">char</span> <span class="n">connection</span><span class="p">;</span>	<span class="cm">/* permanent/switched/on-demand */</span>
	<span class="kt">char</span> <span class="n">read_mode</span><span class="p">;</span>		<span class="cm">/* read mode: Polling or interrupt */</span>
	<span class="kt">char</span> <span class="n">receive_only</span><span class="p">;</span>	<span class="cm">/* disable tx buffers */</span>
	<span class="kt">char</span> <span class="n">tty</span><span class="p">;</span>		<span class="cm">/* Create a fake tty device */</span>
	<span class="kt">unsigned</span> <span class="n">tty_major</span><span class="p">;</span>	<span class="cm">/* Major number for wanpipe tty device */</span>
	<span class="kt">unsigned</span> <span class="n">tty_minor</span><span class="p">;</span> 	<span class="cm">/* Minor number for wanpipe tty device */</span>
	<span class="kt">unsigned</span> <span class="n">tty_mode</span><span class="p">;</span>	<span class="cm">/* TTY operation mode SYNC or ASYNC */</span>
	<span class="kt">char</span> <span class="n">backup</span><span class="p">;</span>		<span class="cm">/* Backup Mode */</span>
	<span class="kt">unsigned</span> <span class="n">hw_opt</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* other hardware options */</span>
	<span class="kt">unsigned</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
				<span class="cm">/****** arbitrary data ***************/</span>
	<span class="kt">unsigned</span> <span class="n">data_size</span><span class="p">;</span>	<span class="cm">/* data buffer size */</span>
	<span class="kt">void</span><span class="o">*</span> <span class="n">data</span><span class="p">;</span>		<span class="cm">/* data buffer, e.g. firmware */</span>
	<span class="k">union</span>			<span class="cm">/****** protocol-specific ************/</span>
	<span class="p">{</span>
		<span class="n">wan_x25_conf_t</span> <span class="n">x25</span><span class="p">;</span>	<span class="cm">/* X.25 configuration */</span>
		<span class="n">wan_ppp_conf_t</span> <span class="n">ppp</span><span class="p">;</span>	<span class="cm">/* PPP configuration */</span>
		<span class="n">wan_fr_conf_t</span> <span class="n">fr</span><span class="p">;</span>	<span class="cm">/* frame relay configuration */</span>
		<span class="n">wan_chdlc_conf_t</span> <span class="n">chdlc</span><span class="p">;</span>	<span class="cm">/* Cisco HDLC configuration */</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">}</span> <span class="n">wandev_conf_t</span><span class="p">;</span>

<span class="cm">/* &#39;config_id&#39; definitions */</span>
<span class="cp">#define	WANCONFIG_X25	101	</span><span class="cm">/* X.25 link */</span><span class="cp"></span>
<span class="cp">#define	WANCONFIG_FR	102	</span><span class="cm">/* frame relay link */</span><span class="cp"></span>
<span class="cp">#define	WANCONFIG_PPP	103	</span><span class="cm">/* synchronous PPP link */</span><span class="cp"></span>
<span class="cp">#define WANCONFIG_CHDLC	104	</span><span class="cm">/* Cisco HDLC Link */</span><span class="cp"></span>
<span class="cp">#define WANCONFIG_BSC	105	</span><span class="cm">/* BiSync Streaming */</span><span class="cp"></span>
<span class="cp">#define WANCONFIG_HDLC	106	</span><span class="cm">/* HDLC Support */</span><span class="cp"></span>
<span class="cp">#define WANCONFIG_MPPP  107	</span><span class="cm">/* Multi Port PPP over RAW CHDLC */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Configuration options defines.</span>
<span class="cm"> */</span>
<span class="cm">/* general options */</span>
<span class="cp">#define	WANOPT_OFF	0</span>
<span class="cp">#define	WANOPT_ON	1</span>
<span class="cp">#define	WANOPT_NO	0</span>
<span class="cp">#define	WANOPT_YES	1</span>

<span class="cm">/* intercace options */</span>
<span class="cp">#define	WANOPT_RS232	0</span>
<span class="cp">#define	WANOPT_V35	1</span>

<span class="cm">/* data encoding options */</span>
<span class="cp">#define	WANOPT_NRZ	0</span>
<span class="cp">#define	WANOPT_NRZI	1</span>
<span class="cp">#define	WANOPT_FM0	2</span>
<span class="cp">#define	WANOPT_FM1	3</span>

<span class="cm">/* link type options */</span>
<span class="cp">#define	WANOPT_POINTTOPOINT	0	</span><span class="cm">/* RTS always active */</span><span class="cp"></span>
<span class="cp">#define	WANOPT_MULTIDROP	1	</span><span class="cm">/* RTS is active when transmitting */</span><span class="cp"></span>

<span class="cm">/* clocking options */</span>
<span class="cp">#define	WANOPT_EXTERNAL	0</span>
<span class="cp">#define	WANOPT_INTERNAL	1</span>

<span class="cm">/* station options */</span>
<span class="cp">#define	WANOPT_DTE		0</span>
<span class="cp">#define	WANOPT_DCE		1</span>
<span class="cp">#define	WANOPT_CPE		0</span>
<span class="cp">#define	WANOPT_NODE		1</span>
<span class="cp">#define	WANOPT_SECONDARY	0</span>
<span class="cp">#define	WANOPT_PRIMARY		1</span>

<span class="cm">/* connection options */</span>
<span class="cp">#define	WANOPT_PERMANENT	0	</span><span class="cm">/* DTR always active */</span><span class="cp"></span>
<span class="cp">#define	WANOPT_SWITCHED		1	</span><span class="cm">/* use DTR to setup link (dial-up) */</span><span class="cp"></span>
<span class="cp">#define	WANOPT_ONDEMAND		2	</span><span class="cm">/* activate DTR only before sending */</span><span class="cp"></span>

<span class="cm">/* frame relay in-channel signalling */</span>
<span class="cp">#define	WANOPT_FR_ANSI		1	</span><span class="cm">/* ANSI T1.617 Annex D */</span><span class="cp"></span>
<span class="cp">#define	WANOPT_FR_Q933		2	</span><span class="cm">/* ITU Q.933A */</span><span class="cp"></span>
<span class="cp">#define	WANOPT_FR_LMI		3	</span><span class="cm">/* LMI */</span><span class="cp"></span>

<span class="cm">/* PPP IP Mode Options */</span>
<span class="cp">#define	WANOPT_PPP_STATIC	0</span>
<span class="cp">#define	WANOPT_PPP_HOST		1</span>
<span class="cp">#define	WANOPT_PPP_PEER		2</span>

<span class="cm">/* ASY Mode Options */</span>
<span class="cp">#define WANOPT_ONE 		1</span>
<span class="cp">#define WANOPT_TWO		2</span>
<span class="cp">#define WANOPT_ONE_AND_HALF	3</span>

<span class="cp">#define WANOPT_NONE	0</span>
<span class="cp">#define WANOPT_ODD      1</span>
<span class="cp">#define WANOPT_EVEN	2</span>

<span class="cm">/* CHDLC Protocol Options */</span>
<span class="cm">/* DF Commented out for now.</span>

<span class="cm">#define WANOPT_CHDLC_NO_DCD		IGNORE_DCD_FOR_LINK_STAT</span>
<span class="cm">#define WANOPT_CHDLC_NO_CTS		IGNORE_CTS_FOR_LINK_STAT</span>
<span class="cm">#define WANOPT_CHDLC_NO_KEEPALIVE	IGNORE_KPALV_FOR_LINK_STAT</span>
<span class="cm">*/</span>

<span class="cm">/* Port options */</span>
<span class="cp">#define WANOPT_PRI 0</span>
<span class="cp">#define WANOPT_SEC 1</span>
<span class="cm">/* read mode */</span>
<span class="cp">#define	WANOPT_INTR	0</span>
<span class="cp">#define WANOPT_POLL	1</span>


<span class="cp">#define WANOPT_TTY_SYNC  0</span>
<span class="cp">#define WANOPT_TTY_ASYNC 1</span>
<span class="cm">/*----------------------------------------------------------------------------</span>
<span class="cm"> * WAN Link Status Info (for ROUTER_STAT IOCTL).</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">wandev_stat</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">state</span><span class="p">;</span>		<span class="cm">/* link state */</span>
	<span class="kt">unsigned</span> <span class="n">ndev</span><span class="p">;</span>		<span class="cm">/* number of configured interfaces */</span>

	<span class="cm">/* link/interface configuration */</span>
	<span class="kt">unsigned</span> <span class="n">connection</span><span class="p">;</span>	<span class="cm">/* permanent/switched/on-demand */</span>
	<span class="kt">unsigned</span> <span class="n">media_type</span><span class="p">;</span>	<span class="cm">/* Frame relay/PPP/X.25/SDLC, etc. */</span>
	<span class="kt">unsigned</span> <span class="n">mtu</span><span class="p">;</span>		<span class="cm">/* max. transmit unit for this device */</span>

	<span class="cm">/* physical level statistics */</span>
	<span class="kt">unsigned</span> <span class="n">modem_status</span><span class="p">;</span>	<span class="cm">/* modem status */</span>
	<span class="kt">unsigned</span> <span class="n">rx_frames</span><span class="p">;</span>	<span class="cm">/* received frames count */</span>
	<span class="kt">unsigned</span> <span class="n">rx_overruns</span><span class="p">;</span>	<span class="cm">/* receiver overrun error count */</span>
	<span class="kt">unsigned</span> <span class="n">rx_crc_err</span><span class="p">;</span>	<span class="cm">/* receive CRC error count */</span>
	<span class="kt">unsigned</span> <span class="n">rx_aborts</span><span class="p">;</span>	<span class="cm">/* received aborted frames count */</span>
	<span class="kt">unsigned</span> <span class="n">rx_bad_length</span><span class="p">;</span>	<span class="cm">/* unexpetedly long/short frames count */</span>
	<span class="kt">unsigned</span> <span class="n">rx_dropped</span><span class="p">;</span>	<span class="cm">/* frames discarded at device level */</span>
	<span class="kt">unsigned</span> <span class="n">tx_frames</span><span class="p">;</span>	<span class="cm">/* transmitted frames count */</span>
	<span class="kt">unsigned</span> <span class="n">tx_underruns</span><span class="p">;</span>	<span class="cm">/* aborted transmissions (underruns) count */</span>
	<span class="kt">unsigned</span> <span class="n">tx_timeouts</span><span class="p">;</span>	<span class="cm">/* transmission timeouts */</span>
	<span class="kt">unsigned</span> <span class="n">tx_rejects</span><span class="p">;</span>	<span class="cm">/* other transmit errors */</span>

	<span class="cm">/* media level statistics */</span>
	<span class="kt">unsigned</span> <span class="n">rx_bad_format</span><span class="p">;</span>	<span class="cm">/* frames with invalid format */</span>
	<span class="kt">unsigned</span> <span class="n">rx_bad_addr</span><span class="p">;</span>	<span class="cm">/* frames with invalid media address */</span>
	<span class="kt">unsigned</span> <span class="n">tx_retries</span><span class="p">;</span>	<span class="cm">/* frames re-transmitted */</span>
	<span class="kt">unsigned</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>	<span class="cm">/* reserved for future use */</span>
<span class="p">}</span> <span class="n">wandev_stat_t</span><span class="p">;</span>

<span class="cm">/* &#39;state&#39; defines */</span>
<span class="k">enum</span> <span class="n">wan_states</span>
<span class="p">{</span>
	<span class="n">WAN_UNCONFIGURED</span><span class="p">,</span>	<span class="cm">/* link/channel is not configured */</span>
	<span class="n">WAN_DISCONNECTED</span><span class="p">,</span>	<span class="cm">/* link/channel is disconnected */</span>
	<span class="n">WAN_CONNECTING</span><span class="p">,</span>		<span class="cm">/* connection is in progress */</span>
	<span class="n">WAN_CONNECTED</span><span class="p">,</span>		<span class="cm">/* link/channel is operational */</span>
	<span class="n">WAN_LIMIT</span><span class="p">,</span>		<span class="cm">/* for verification only */</span>
	<span class="n">WAN_DUALPORT</span><span class="p">,</span>		<span class="cm">/* for Dual Port cards */</span>
	<span class="n">WAN_DISCONNECTING</span><span class="p">,</span>
	<span class="n">WAN_FT1_READY</span>		<span class="cm">/* FT1 Configurator Ready */</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">WAN_LOCAL_IP</span><span class="p">,</span>
	<span class="n">WAN_POINTOPOINT_IP</span><span class="p">,</span>
	<span class="n">WAN_NETMASK_IP</span><span class="p">,</span>
	<span class="n">WAN_BROADCAST_IP</span>
<span class="p">};</span>

<span class="cm">/* &#39;modem_status&#39; masks */</span>
<span class="cp">#define	WAN_MODEM_CTS	0x0001	</span><span class="cm">/* CTS line active */</span><span class="cp"></span>
<span class="cp">#define	WAN_MODEM_DCD	0x0002	</span><span class="cm">/* DCD line active */</span><span class="cp"></span>
<span class="cp">#define	WAN_MODEM_DTR	0x0010	</span><span class="cm">/* DTR line active */</span><span class="cp"></span>
<span class="cp">#define	WAN_MODEM_RTS	0x0020	</span><span class="cm">/* RTS line active */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------------</span>
<span class="cm"> * WAN interface (logical channel) configuration (for ROUTER_IFNEW IOCTL).</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">wanif_conf</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">magic</span><span class="p">;</span>			<span class="cm">/* magic number */</span>
	<span class="kt">unsigned</span> <span class="n">config_id</span><span class="p">;</span>		<span class="cm">/* configuration identifier */</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="n">WAN_IFNAME_SZ</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>	<span class="cm">/* interface name, ASCIIZ */</span>
	<span class="kt">char</span> <span class="n">addr</span><span class="p">[</span><span class="n">WAN_ADDRESS_SZ</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>	<span class="cm">/* media address, ASCIIZ */</span>
	<span class="kt">char</span> <span class="n">usedby</span><span class="p">[</span><span class="n">USED_BY_FIELD</span><span class="p">];</span>	<span class="cm">/* used by API or WANPIPE */</span>
	<span class="kt">unsigned</span> <span class="n">idle_timeout</span><span class="p">;</span>		<span class="cm">/* sec, before disconnecting */</span>
	<span class="kt">unsigned</span> <span class="n">hold_timeout</span><span class="p">;</span>		<span class="cm">/* sec, before re-connecting */</span>
	<span class="kt">unsigned</span> <span class="n">cir</span><span class="p">;</span>			<span class="cm">/* Committed Information Rate fwd,bwd*/</span>
	<span class="kt">unsigned</span> <span class="n">bc</span><span class="p">;</span>			<span class="cm">/* Committed Burst Size fwd, bwd */</span>
	<span class="kt">unsigned</span> <span class="n">be</span><span class="p">;</span>			<span class="cm">/* Excess Burst Size fwd, bwd */</span> 
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">enable_IPX</span><span class="p">;</span>	<span class="cm">/* Enable or Disable IPX */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">inarp</span><span class="p">;</span>		<span class="cm">/* Send Inverse ARP requests Y/N */</span>
	<span class="kt">unsigned</span> <span class="n">inarp_interval</span><span class="p">;</span>	<span class="cm">/* sec, between InARP requests */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">network_number</span><span class="p">;</span>	<span class="cm">/* Network Number for IPX */</span>
	<span class="kt">char</span> <span class="n">mc</span><span class="p">;</span>			<span class="cm">/* Multicast on or off */</span>
	<span class="kt">char</span> <span class="n">local_addr</span><span class="p">[</span><span class="n">WAN_ADDRESS_SZ</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span><span class="cm">/* local media address, ASCIIZ */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">port</span><span class="p">;</span>		<span class="cm">/* board port */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">protocol</span><span class="p">;</span>		<span class="cm">/* prococol used in this channel (TCPOX25 or X25) */</span>
	<span class="kt">char</span> <span class="n">pap</span><span class="p">;</span>			<span class="cm">/* PAP enabled or disabled */</span>
	<span class="kt">char</span> <span class="n">chap</span><span class="p">;</span>			<span class="cm">/* CHAP enabled or disabled */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">userid</span><span class="p">[</span><span class="mi">511</span><span class="p">];</span>	<span class="cm">/* List of User Id */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">passwd</span><span class="p">[</span><span class="mi">511</span><span class="p">];</span>	<span class="cm">/* List of passwords */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">sysname</span><span class="p">[</span><span class="mi">31</span><span class="p">];</span>	<span class="cm">/* Name of the system */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ignore_dcd</span><span class="p">;</span>	<span class="cm">/* Protocol options: */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ignore_cts</span><span class="p">;</span>	<span class="cm">/*  Ignore these to determine */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ignore_keepalive</span><span class="p">;</span>	<span class="cm">/*  link status (Yes or No) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">hdlc_streaming</span><span class="p">;</span>	<span class="cm">/*  Hdlc streaming mode (Y/N) */</span>
	<span class="kt">unsigned</span> <span class="n">keepalive_tx_tmr</span><span class="p">;</span>	<span class="cm">/* transmit keepalive timer */</span>
	<span class="kt">unsigned</span> <span class="n">keepalive_rx_tmr</span><span class="p">;</span>	<span class="cm">/* receive  keepalive timer */</span>
	<span class="kt">unsigned</span> <span class="n">keepalive_err_margin</span><span class="p">;</span>	<span class="cm">/* keepalive_error_tolerance */</span>
	<span class="kt">unsigned</span> <span class="n">slarp_timer</span><span class="p">;</span>		<span class="cm">/* SLARP request timer */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ttl</span><span class="p">;</span>		<span class="cm">/* Time To Live for UDP security */</span>
	<span class="kt">char</span> <span class="n">interface</span><span class="p">;</span>			<span class="cm">/* RS-232/V.35, etc. */</span>
	<span class="kt">char</span> <span class="n">clocking</span><span class="p">;</span>			<span class="cm">/* external/internal */</span>
	<span class="kt">unsigned</span> <span class="n">bps</span><span class="p">;</span>			<span class="cm">/* data transfer rate */</span>
	<span class="kt">unsigned</span> <span class="n">mtu</span><span class="p">;</span>			<span class="cm">/* maximum transmit unit size */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">if_down</span><span class="p">;</span>		<span class="cm">/* brind down interface when disconnected */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">gateway</span><span class="p">;</span>		<span class="cm">/* Is this interface a gateway */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">true_if_encoding</span><span class="p">;</span>	<span class="cm">/* Set the dev-&gt;type to true board protocol */</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">asy_data_trans</span><span class="p">;</span>     <span class="cm">/* async API options */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">rts_hs_for_receive</span><span class="p">;</span> <span class="cm">/* async Protocol options */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">xon_xoff_hs_for_receive</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">xon_xoff_hs_for_transmit</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">dcd_hs_for_transmit</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cts_hs_for_transmit</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">async_mode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">tx_bits_per_char</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">rx_bits_per_char</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">stop_bits</span><span class="p">;</span>  
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">parity</span><span class="p">;</span>
 	<span class="kt">unsigned</span> <span class="n">break_timer</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="n">inter_char_timer</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">rx_complete_length</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">xon_char</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">xoff_char</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">receive_only</span><span class="p">;</span>	<span class="cm">/*  no transmit buffering (Y/N) */</span>
<span class="p">}</span> <span class="n">wanif_conf_t</span><span class="p">;</span>

<span class="cp">#ifdef	__KERNEL__</span>
<span class="cm">/****** Kernel Interface ****************************************************/</span>

<span class="cp">#include &lt;linux/fs.h&gt;		</span><span class="cm">/* support for device drivers */</span><span class="cp"></span>
<span class="cp">#include &lt;linux/proc_fs.h&gt;	</span><span class="cm">/* proc filesystem pragmatics */</span><span class="cp"></span>
<span class="cp">#include &lt;linux/netdevice.h&gt;	</span><span class="cm">/* support for network drivers */</span><span class="cp"></span>
<span class="cp">#include &lt;linux/spinlock.h&gt;     </span><span class="cm">/* Support for SMP Locking */</span><span class="cp"></span>

<span class="cm">/*----------------------------------------------------------------------------</span>
<span class="cm"> * WAN device data space.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">wan_device</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">magic</span><span class="p">;</span>			<span class="cm">/* magic number */</span>
	<span class="kt">char</span><span class="o">*</span> <span class="n">name</span><span class="p">;</span>			<span class="cm">/* -&gt; WAN device name (ASCIIZ) */</span>
	<span class="kt">void</span><span class="o">*</span> <span class="n">private</span><span class="p">;</span>			<span class="cm">/* -&gt; driver private data */</span>
	<span class="kt">unsigned</span> <span class="n">config_id</span><span class="p">;</span>		<span class="cm">/* Configuration ID */</span>
					<span class="cm">/****** hardware configuration ******/</span>
	<span class="kt">unsigned</span> <span class="n">ioport</span><span class="p">;</span>		<span class="cm">/* adapter I/O port base #1 */</span>
	<span class="kt">char</span> <span class="n">S514_cpu_no</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>		<span class="cm">/* PCI CPU Number */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">S514_slot_no</span><span class="p">;</span>	<span class="cm">/* PCI Slot Number */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">maddr</span><span class="p">;</span>		<span class="cm">/* dual-port memory address */</span>
	<span class="kt">unsigned</span> <span class="n">msize</span><span class="p">;</span>			<span class="cm">/* dual-port memory size */</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>			<span class="cm">/* interrupt request level */</span>
	<span class="kt">int</span> <span class="n">dma</span><span class="p">;</span>			<span class="cm">/* DMA request level */</span>
	<span class="kt">unsigned</span> <span class="n">bps</span><span class="p">;</span>			<span class="cm">/* data transfer rate */</span>
	<span class="kt">unsigned</span> <span class="n">mtu</span><span class="p">;</span>			<span class="cm">/* max physical transmit unit size */</span>
	<span class="kt">unsigned</span> <span class="n">udp_port</span><span class="p">;</span>              <span class="cm">/* UDP port for management */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ttl</span><span class="p">;</span>		<span class="cm">/* Time To Live for UDP security */</span>
	<span class="kt">unsigned</span> <span class="n">enable_tx_int</span><span class="p">;</span> 	<span class="cm">/* Transmit Interrupt enabled or not */</span>
	<span class="kt">char</span> <span class="n">interface</span><span class="p">;</span>			<span class="cm">/* RS-232/V.35, etc. */</span>
	<span class="kt">char</span> <span class="n">clocking</span><span class="p">;</span>			<span class="cm">/* external/internal */</span>
	<span class="kt">char</span> <span class="n">line_coding</span><span class="p">;</span>		<span class="cm">/* NRZ/NRZI/FM0/FM1, etc. */</span>
	<span class="kt">char</span> <span class="n">station</span><span class="p">;</span>			<span class="cm">/* DTE/DCE, primary/secondary, etc. */</span>
	<span class="kt">char</span> <span class="n">connection</span><span class="p">;</span>		<span class="cm">/* permanent/switched/on-demand */</span>
	<span class="kt">char</span> <span class="n">signalling</span><span class="p">;</span>		<span class="cm">/* Signalling RS232 or V35 */</span>
	<span class="kt">char</span> <span class="n">read_mode</span><span class="p">;</span>			<span class="cm">/* read mode: Polling or interrupt */</span>
	<span class="kt">char</span> <span class="n">new_if_cnt</span><span class="p">;</span>                <span class="cm">/* Number of interfaces per wanpipe */</span> 
	<span class="kt">char</span> <span class="n">del_if_cnt</span><span class="p">;</span>		<span class="cm">/* Number of times del_if() gets called */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">piggyback</span><span class="p">;</span>        <span class="cm">/* Piggibacking a port */</span>
	<span class="kt">unsigned</span> <span class="n">hw_opt</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* other hardware options */</span>
					<span class="cm">/****** status and statistics *******/</span>
	<span class="kt">char</span> <span class="n">state</span><span class="p">;</span>			<span class="cm">/* device state */</span>
	<span class="kt">char</span> <span class="n">api_status</span><span class="p">;</span>		<span class="cm">/* device api status */</span>
	<span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">stats</span><span class="p">;</span> 	<span class="cm">/* interface statistics */</span>
	<span class="kt">unsigned</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>		<span class="cm">/* reserved for future use */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">critical</span><span class="p">;</span>		<span class="cm">/* critical section flag */</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>                <span class="cm">/* Support for SMP Locking */</span>

					<span class="cm">/****** device management methods ***/</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">setup</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">wan_device</span> <span class="o">*</span><span class="n">wandev</span><span class="p">,</span> <span class="n">wandev_conf_t</span> <span class="o">*</span><span class="n">conf</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">shutdown</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">wan_device</span> <span class="o">*</span><span class="n">wandev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">update</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">wan_device</span> <span class="o">*</span><span class="n">wandev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">ioctl</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">wan_device</span> <span class="o">*</span><span class="n">wandev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">cmd</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">new_if</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wan_device</span> <span class="o">*</span><span class="n">wandev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
		      <span class="n">wanif_conf_t</span> <span class="o">*</span><span class="n">conf</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">del_if</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wan_device</span> <span class="o">*</span><span class="n">wandev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
					<span class="cm">/****** maintained by the router ****/</span>
	<span class="k">struct</span> <span class="n">wan_device</span><span class="o">*</span> <span class="n">next</span><span class="p">;</span>	<span class="cm">/* -&gt; next device */</span>
	<span class="k">struct</span> <span class="n">net_device</span><span class="o">*</span> <span class="n">dev</span><span class="p">;</span>		<span class="cm">/* list of network interfaces */</span>
	<span class="kt">unsigned</span> <span class="n">ndev</span><span class="p">;</span>			<span class="cm">/* number of interfaces */</span>
	<span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">dent</span><span class="p">;</span>	<span class="cm">/* proc filesystem entry */</span>
<span class="p">};</span>

<span class="cm">/* Public functions available for device drivers */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">register_wan_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">wan_device</span> <span class="o">*</span><span class="n">wandev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">unregister_wan_device</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">);</span>

<span class="cm">/* Proc interface functions. These must not be called by the drivers! */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">wanrouter_proc_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">wanrouter_proc_cleanup</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">wanrouter_proc_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">wan_device</span> <span class="o">*</span><span class="n">wandev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">wanrouter_proc_delete</span><span class="p">(</span><span class="k">struct</span> <span class="n">wan_device</span> <span class="o">*</span><span class="n">wandev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">long</span> <span class="n">wanrouter_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>

<span class="cm">/* Public Data */</span>
<span class="cm">/* list of registered devices */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">wan_device</span> <span class="o">*</span><span class="n">wanrouter_router_devlist</span><span class="p">;</span>

<span class="cp">#endif	</span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif	</span><span class="cm">/* _ROUTER_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
