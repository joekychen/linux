<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › mtd › doc2000.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>doc2000.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Linux driver for Disk-On-Chip devices</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright © 1999 Machine Vision Holdings, Inc.</span>
<span class="cm"> * Copyright © 1999-2010 David Woodhouse &lt;dwmw2@infradead.org&gt;</span>
<span class="cm"> * Copyright © 2002-2003 Greg Ungerer &lt;gerg@snapgear.com&gt;</span>
<span class="cm"> * Copyright © 2002-2003 SnapGear Inc</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __MTD_DOC2000_H__</span>
<span class="cp">#define __MTD_DOC2000_H__</span>

<span class="cp">#include &lt;linux/mtd/mtd.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>

<span class="cp">#define DoC_Sig1 0</span>
<span class="cp">#define DoC_Sig2 1</span>

<span class="cp">#define DoC_ChipID		0x1000</span>
<span class="cp">#define DoC_DOCStatus		0x1001</span>
<span class="cp">#define DoC_DOCControl		0x1002</span>
<span class="cp">#define DoC_FloorSelect		0x1003</span>
<span class="cp">#define DoC_CDSNControl		0x1004</span>
<span class="cp">#define DoC_CDSNDeviceSelect 	0x1005</span>
<span class="cp">#define DoC_ECCConf 		0x1006</span>
<span class="cp">#define DoC_2k_ECCStatus	0x1007</span>

<span class="cp">#define DoC_CDSNSlowIO		0x100d</span>
<span class="cp">#define DoC_ECCSyndrome0	0x1010</span>
<span class="cp">#define DoC_ECCSyndrome1	0x1011</span>
<span class="cp">#define DoC_ECCSyndrome2	0x1012</span>
<span class="cp">#define DoC_ECCSyndrome3	0x1013</span>
<span class="cp">#define DoC_ECCSyndrome4	0x1014</span>
<span class="cp">#define DoC_ECCSyndrome5	0x1015</span>
<span class="cp">#define DoC_AliasResolution 	0x101b</span>
<span class="cp">#define DoC_ConfigInput		0x101c</span>
<span class="cp">#define DoC_ReadPipeInit 	0x101d</span>
<span class="cp">#define DoC_WritePipeTerm 	0x101e</span>
<span class="cp">#define DoC_LastDataRead 	0x101f</span>
<span class="cp">#define DoC_NOP 		0x1020</span>

<span class="cp">#define DoC_Mil_CDSN_IO 	0x0800</span>
<span class="cp">#define DoC_2k_CDSN_IO 		0x1800</span>

<span class="cp">#define DoC_Mplus_NOP			0x1002</span>
<span class="cp">#define DoC_Mplus_AliasResolution	0x1004</span>
<span class="cp">#define DoC_Mplus_DOCControl		0x1006</span>
<span class="cp">#define DoC_Mplus_AccessStatus		0x1008</span>
<span class="cp">#define DoC_Mplus_DeviceSelect		0x1008</span>
<span class="cp">#define DoC_Mplus_Configuration		0x100a</span>
<span class="cp">#define DoC_Mplus_OutputControl		0x100c</span>
<span class="cp">#define DoC_Mplus_FlashControl		0x1020</span>
<span class="cp">#define DoC_Mplus_FlashSelect 		0x1022</span>
<span class="cp">#define DoC_Mplus_FlashCmd		0x1024</span>
<span class="cp">#define DoC_Mplus_FlashAddress		0x1026</span>
<span class="cp">#define DoC_Mplus_FlashData0		0x1028</span>
<span class="cp">#define DoC_Mplus_FlashData1		0x1029</span>
<span class="cp">#define DoC_Mplus_ReadPipeInit		0x102a</span>
<span class="cp">#define DoC_Mplus_LastDataRead		0x102c</span>
<span class="cp">#define DoC_Mplus_LastDataRead1		0x102d</span>
<span class="cp">#define DoC_Mplus_WritePipeTerm 	0x102e</span>
<span class="cp">#define DoC_Mplus_ECCSyndrome0		0x1040</span>
<span class="cp">#define DoC_Mplus_ECCSyndrome1		0x1041</span>
<span class="cp">#define DoC_Mplus_ECCSyndrome2		0x1042</span>
<span class="cp">#define DoC_Mplus_ECCSyndrome3		0x1043</span>
<span class="cp">#define DoC_Mplus_ECCSyndrome4		0x1044</span>
<span class="cp">#define DoC_Mplus_ECCSyndrome5		0x1045</span>
<span class="cp">#define DoC_Mplus_ECCConf 		0x1046</span>
<span class="cp">#define DoC_Mplus_Toggle		0x1046</span>
<span class="cp">#define DoC_Mplus_DownloadStatus	0x1074</span>
<span class="cp">#define DoC_Mplus_CtrlConfirm		0x1076</span>
<span class="cp">#define DoC_Mplus_Power			0x1fff</span>

<span class="cm">/* How to access the device?</span>
<span class="cm"> * On ARM, it&#39;ll be mmap&#39;d directly with 32-bit wide accesses.</span>
<span class="cm"> * On PPC, it&#39;s mmap&#39;d and 16-bit wide.</span>
<span class="cm"> * Others use readb/writeb</span>
<span class="cm"> */</span>
<span class="cp">#if defined(__arm__)</span>
<span class="cp">#define ReadDOC_(adr, reg)      ((unsigned char)(*(volatile __u32 *)(((unsigned long)adr)+((reg)&lt;&lt;2))))</span>
<span class="cp">#define WriteDOC_(d, adr, reg)  do{ *(volatile __u32 *)(((unsigned long)adr)+((reg)&lt;&lt;2)) = (__u32)d; wmb();} while(0)</span>
<span class="cp">#define DOC_IOREMAP_LEN 0x8000</span>
<span class="cp">#elif defined(__ppc__)</span>
<span class="cp">#define ReadDOC_(adr, reg)      ((unsigned char)(*(volatile __u16 *)(((unsigned long)adr)+((reg)&lt;&lt;1))))</span>
<span class="cp">#define WriteDOC_(d, adr, reg)  do{ *(volatile __u16 *)(((unsigned long)adr)+((reg)&lt;&lt;1)) = (__u16)d; wmb();} while(0)</span>
<span class="cp">#define DOC_IOREMAP_LEN 0x4000</span>
<span class="cp">#else</span>
<span class="cp">#define ReadDOC_(adr, reg)      readb((void __iomem *)(adr) + (reg))</span>
<span class="cp">#define WriteDOC_(d, adr, reg)  writeb(d, (void __iomem *)(adr) + (reg))</span>
<span class="cp">#define DOC_IOREMAP_LEN 0x2000</span>

<span class="cp">#endif</span>

<span class="cp">#if defined(__i386__) || defined(__x86_64__)</span>
<span class="cp">#define USE_MEMCPY</span>
<span class="cp">#endif</span>

<span class="cm">/* These are provided to directly use the DoC_xxx defines */</span>
<span class="cp">#define ReadDOC(adr, reg)      ReadDOC_(adr,DoC_##reg)</span>
<span class="cp">#define WriteDOC(d, adr, reg)  WriteDOC_(d,adr,DoC_##reg)</span>

<span class="cp">#define DOC_MODE_RESET 		0</span>
<span class="cp">#define DOC_MODE_NORMAL 	1</span>
<span class="cp">#define DOC_MODE_RESERVED1 	2</span>
<span class="cp">#define DOC_MODE_RESERVED2 	3</span>

<span class="cp">#define DOC_MODE_CLR_ERR 	0x80</span>
<span class="cp">#define	DOC_MODE_RST_LAT	0x10</span>
<span class="cp">#define	DOC_MODE_BDECT		0x08</span>
<span class="cp">#define DOC_MODE_MDWREN 	0x04</span>

<span class="cp">#define DOC_ChipID_Doc2k 	0x20</span>
<span class="cp">#define DOC_ChipID_Doc2kTSOP 	0x21	</span><span class="cm">/* internal number for MTD */</span><span class="cp"></span>
<span class="cp">#define DOC_ChipID_DocMil 	0x30</span>
<span class="cp">#define DOC_ChipID_DocMilPlus32	0x40</span>
<span class="cp">#define DOC_ChipID_DocMilPlus16	0x41</span>

<span class="cp">#define CDSN_CTRL_FR_B 		0x80</span>
<span class="cp">#define CDSN_CTRL_FR_B0		0x40</span>
<span class="cp">#define CDSN_CTRL_FR_B1		0x80</span>

<span class="cp">#define CDSN_CTRL_ECC_IO 	0x20</span>
<span class="cp">#define CDSN_CTRL_FLASH_IO 	0x10</span>
<span class="cp">#define CDSN_CTRL_WP 		0x08</span>
<span class="cp">#define CDSN_CTRL_ALE 		0x04</span>
<span class="cp">#define CDSN_CTRL_CLE 		0x02</span>
<span class="cp">#define CDSN_CTRL_CE 		0x01</span>

<span class="cp">#define DOC_ECC_RESET 		0</span>
<span class="cp">#define DOC_ECC_ERROR 		0x80</span>
<span class="cp">#define DOC_ECC_RW 		0x20</span>
<span class="cp">#define DOC_ECC__EN 		0x08</span>
<span class="cp">#define DOC_TOGGLE_BIT 		0x04</span>
<span class="cp">#define DOC_ECC_RESV 		0x02</span>
<span class="cp">#define DOC_ECC_IGNORE		0x01</span>

<span class="cp">#define DOC_FLASH_CE		0x80</span>
<span class="cp">#define DOC_FLASH_WP		0x40</span>
<span class="cp">#define DOC_FLASH_BANK		0x02</span>

<span class="cm">/* We have to also set the reserved bit 1 for enable */</span>
<span class="cp">#define DOC_ECC_EN (DOC_ECC__EN | DOC_ECC_RESV)</span>
<span class="cp">#define DOC_ECC_DIS (DOC_ECC_RESV)</span>

<span class="k">struct</span> <span class="n">Nand</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">floor</span><span class="p">,</span> <span class="n">chip</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">curadr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">curmode</span><span class="p">;</span>
	<span class="cm">/* Also some erase/write/pipeline info when we get that far */</span>
<span class="p">};</span>

<span class="cp">#define MAX_FLOORS 4</span>
<span class="cp">#define MAX_CHIPS 4</span>

<span class="cp">#define MAX_FLOORS_MIL 1</span>
<span class="cp">#define MAX_CHIPS_MIL 1</span>

<span class="cp">#define MAX_FLOORS_MPLUS 2</span>
<span class="cp">#define MAX_CHIPS_MPLUS 1</span>

<span class="cp">#define ADDR_COLUMN 1</span>
<span class="cp">#define ADDR_PAGE 2</span>
<span class="cp">#define ADDR_COLUMN_PAGE 3</span>

<span class="k">struct</span> <span class="n">DiskOnChip</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">physadr</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">virtadr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">totlen</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ChipID</span><span class="p">;</span> <span class="cm">/* Type of DiskOnChip */</span>
	<span class="kt">int</span> <span class="n">ioreg</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mfr</span><span class="p">;</span> <span class="cm">/* Flash IDs - only one type of flash per device */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">id</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">chipshift</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">page256</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">pageadrlen</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">interleave</span><span class="p">;</span> <span class="cm">/* Internal interleaving - Millennium Plus style */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">erasesize</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">curfloor</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">curchip</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">numchips</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">Nand</span> <span class="o">*</span><span class="n">chips</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mtd_info</span> <span class="o">*</span><span class="n">nextdoc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">doc_decode_ecc</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">sector</span><span class="p">[</span><span class="mi">512</span><span class="p">],</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ecc1</span><span class="p">[</span><span class="mi">6</span><span class="p">]);</span>

<span class="cp">#endif </span><span class="cm">/* __MTD_DOC2000_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
