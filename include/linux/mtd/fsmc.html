<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › mtd › fsmc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>fsmc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * incude/mtd/fsmc.h</span>
<span class="cm"> *</span>
<span class="cm"> * ST Microelectronics</span>
<span class="cm"> * Flexible Static Memory Controller (FSMC)</span>
<span class="cm"> * platform data interface and header file</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright © 2010 ST Microelectronics</span>
<span class="cm"> * Vipin Kumar &lt;vipin.kumar@st.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This file is licensed under the terms of the GNU General Public</span>
<span class="cm"> * License version 2. This program is licensed &quot;as is&quot; without any</span>
<span class="cm"> * warranty of any kind, whether express or implied.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __MTD_FSMC_H</span>
<span class="cp">#define __MTD_FSMC_H</span>

<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/physmap.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/mtd/partitions.h&gt;</span>
<span class="cp">#include &lt;asm/param.h&gt;</span>

<span class="cp">#define FSMC_NAND_BW8		1</span>
<span class="cp">#define FSMC_NAND_BW16		2</span>

<span class="cp">#define FSMC_MAX_NOR_BANKS	4</span>
<span class="cp">#define FSMC_MAX_NAND_BANKS	4</span>

<span class="cp">#define FSMC_FLASH_WIDTH8	1</span>
<span class="cp">#define FSMC_FLASH_WIDTH16	2</span>

<span class="cm">/* fsmc controller registers for NOR flash */</span>
<span class="cp">#define CTRL			0x0</span>
	<span class="cm">/* ctrl register definitions */</span>
	<span class="cp">#define BANK_ENABLE		(1 &lt;&lt; 0)</span>
	<span class="cp">#define MUXED			(1 &lt;&lt; 1)</span>
	<span class="cp">#define NOR_DEV			(2 &lt;&lt; 2)</span>
	<span class="cp">#define WIDTH_8			(0 &lt;&lt; 4)</span>
	<span class="cp">#define WIDTH_16		(1 &lt;&lt; 4)</span>
	<span class="cp">#define RSTPWRDWN		(1 &lt;&lt; 6)</span>
	<span class="cp">#define WPROT			(1 &lt;&lt; 7)</span>
	<span class="cp">#define WRT_ENABLE		(1 &lt;&lt; 12)</span>
	<span class="cp">#define WAIT_ENB		(1 &lt;&lt; 13)</span>

<span class="cp">#define CTRL_TIM		0x4</span>
	<span class="cm">/* ctrl_tim register definitions */</span>

<span class="cp">#define FSMC_NOR_BANK_SZ	0x8</span>
<span class="cp">#define FSMC_NOR_REG_SIZE	0x40</span>

<span class="cp">#define FSMC_NOR_REG(base, bank, reg)		(base + \</span>
<span class="cp">						FSMC_NOR_BANK_SZ * (bank) + \</span>
<span class="cp">						reg)</span>

<span class="cm">/* fsmc controller registers for NAND flash */</span>
<span class="cp">#define PC			0x00</span>
	<span class="cm">/* pc register definitions */</span>
	<span class="cp">#define FSMC_RESET		(1 &lt;&lt; 0)</span>
	<span class="cp">#define FSMC_WAITON		(1 &lt;&lt; 1)</span>
	<span class="cp">#define FSMC_ENABLE		(1 &lt;&lt; 2)</span>
	<span class="cp">#define FSMC_DEVTYPE_NAND	(1 &lt;&lt; 3)</span>
	<span class="cp">#define FSMC_DEVWID_8		(0 &lt;&lt; 4)</span>
	<span class="cp">#define FSMC_DEVWID_16		(1 &lt;&lt; 4)</span>
	<span class="cp">#define FSMC_ECCEN		(1 &lt;&lt; 6)</span>
	<span class="cp">#define FSMC_ECCPLEN_512	(0 &lt;&lt; 7)</span>
	<span class="cp">#define FSMC_ECCPLEN_256	(1 &lt;&lt; 7)</span>
	<span class="cp">#define FSMC_TCLR_1		(1)</span>
	<span class="cp">#define FSMC_TCLR_SHIFT		(9)</span>
	<span class="cp">#define FSMC_TCLR_MASK		(0xF)</span>
	<span class="cp">#define FSMC_TAR_1		(1)</span>
	<span class="cp">#define FSMC_TAR_SHIFT		(13)</span>
	<span class="cp">#define FSMC_TAR_MASK		(0xF)</span>
<span class="cp">#define STS			0x04</span>
	<span class="cm">/* sts register definitions */</span>
	<span class="cp">#define FSMC_CODE_RDY		(1 &lt;&lt; 15)</span>
<span class="cp">#define COMM			0x08</span>
	<span class="cm">/* comm register definitions */</span>
	<span class="cp">#define FSMC_TSET_0		0</span>
	<span class="cp">#define FSMC_TSET_SHIFT		0</span>
	<span class="cp">#define FSMC_TSET_MASK		0xFF</span>
	<span class="cp">#define FSMC_TWAIT_6		6</span>
	<span class="cp">#define FSMC_TWAIT_SHIFT	8</span>
	<span class="cp">#define FSMC_TWAIT_MASK		0xFF</span>
	<span class="cp">#define FSMC_THOLD_4		4</span>
	<span class="cp">#define FSMC_THOLD_SHIFT	16</span>
	<span class="cp">#define FSMC_THOLD_MASK		0xFF</span>
	<span class="cp">#define FSMC_THIZ_1		1</span>
	<span class="cp">#define FSMC_THIZ_SHIFT		24</span>
	<span class="cp">#define FSMC_THIZ_MASK		0xFF</span>
<span class="cp">#define ATTRIB			0x0C</span>
<span class="cp">#define IOATA			0x10</span>
<span class="cp">#define ECC1			0x14</span>
<span class="cp">#define ECC2			0x18</span>
<span class="cp">#define ECC3			0x1C</span>
<span class="cp">#define FSMC_NAND_BANK_SZ	0x20</span>

<span class="cp">#define FSMC_NAND_REG(base, bank, reg)		(base + FSMC_NOR_REG_SIZE + \</span>
<span class="cp">						(FSMC_NAND_BANK_SZ * (bank)) + \</span>
<span class="cp">						reg)</span>

<span class="cp">#define FSMC_BUSY_WAIT_TIMEOUT	(1 * HZ)</span>

<span class="cm">/*</span>
<span class="cm"> * There are 13 bytes of ecc for every 512 byte block in FSMC version 8</span>
<span class="cm"> * and it has to be read consecutively and immediately after the 512</span>
<span class="cm"> * byte data block for hardware to generate the error bit offsets</span>
<span class="cm"> * Managing the ecc bytes in the following way is easier. This way is</span>
<span class="cm"> * similar to oobfree structure maintained already in u-boot nand driver</span>
<span class="cm"> */</span>
<span class="cp">#define MAX_ECCPLACE_ENTRIES	32</span>

<span class="k">struct</span> <span class="n">fsmc_nand_eccplace</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">offset</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">length</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fsmc_eccplace</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fsmc_nand_eccplace</span> <span class="n">eccplace</span><span class="p">[</span><span class="n">MAX_ECCPLACE_ENTRIES</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fsmc_nand_timings</span> <span class="p">{</span>
	<span class="kt">uint8_t</span> <span class="n">tclr</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">tar</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">thiz</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">thold</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">twait</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">tset</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">access_mode</span> <span class="p">{</span>
	<span class="n">USE_DMA_ACCESS</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">USE_WORD_ACCESS</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * fsmc_nand_platform_data - platform specific NAND controller config</span>
<span class="cm"> * @partitions: partition table for the platform, use a default fallback</span>
<span class="cm"> * if this is NULL</span>
<span class="cm"> * @nr_partitions: the number of partitions in the previous entry</span>
<span class="cm"> * @options: different options for the driver</span>
<span class="cm"> * @width: bus width</span>
<span class="cm"> * @bank: default bank</span>
<span class="cm"> * @select_bank: callback to select a certain bank, this is</span>
<span class="cm"> * platform-specific. If the controller only supports one bank</span>
<span class="cm"> * this may be set to NULL</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">fsmc_nand_platform_data</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">fsmc_nand_timings</span> <span class="o">*</span><span class="n">nand_timings</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mtd_partition</span>	<span class="o">*</span><span class="n">partitions</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">nr_partitions</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">options</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">width</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">bank</span><span class="p">;</span>

	<span class="cm">/* CLE, ALE offsets */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">cle_off</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">ale_off</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">access_mode</span>	<span class="n">mode</span><span class="p">;</span>

	<span class="kt">void</span>			<span class="p">(</span><span class="o">*</span><span class="n">select_bank</span><span class="p">)(</span><span class="kt">uint32_t</span> <span class="n">bank</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">busw</span><span class="p">);</span>

	<span class="cm">/* priv structures for dma accesses */</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">read_dma_priv</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">write_dma_priv</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">__init</span> <span class="n">fsmc_nor_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">base</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">bank</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">width</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">fsmc_init_board_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">mtd_partition</span> <span class="o">*</span><span class="n">partitions</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nr_partitions</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">width</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __MTD_FSMC_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
