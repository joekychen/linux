<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › vme.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>vme.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _VME_H_</span>
<span class="cp">#define _VME_H_</span>

<span class="cm">/* Resource Type */</span>
<span class="k">enum</span> <span class="n">vme_resource_type</span> <span class="p">{</span>
	<span class="n">VME_MASTER</span><span class="p">,</span>
	<span class="n">VME_SLAVE</span><span class="p">,</span>
	<span class="n">VME_DMA</span><span class="p">,</span>
	<span class="n">VME_LM</span>
<span class="p">};</span>

<span class="cm">/* VME Address Spaces */</span>
<span class="cp">#define VME_A16		0x1</span>
<span class="cp">#define VME_A24		0x2</span>
<span class="cp">#define	VME_A32		0x4</span>
<span class="cp">#define VME_A64		0x8</span>
<span class="cp">#define VME_CRCSR	0x10</span>
<span class="cp">#define VME_USER1	0x20</span>
<span class="cp">#define VME_USER2	0x40</span>
<span class="cp">#define VME_USER3	0x80</span>
<span class="cp">#define VME_USER4	0x100</span>

<span class="cp">#define VME_A16_MAX	0x10000ULL</span>
<span class="cp">#define VME_A24_MAX	0x1000000ULL</span>
<span class="cp">#define VME_A32_MAX	0x100000000ULL</span>
<span class="cp">#define VME_A64_MAX	0x10000000000000000ULL</span>
<span class="cp">#define VME_CRCSR_MAX	0x1000000ULL</span>


<span class="cm">/* VME Cycle Types */</span>
<span class="cp">#define VME_SCT		0x1</span>
<span class="cp">#define VME_BLT		0x2</span>
<span class="cp">#define VME_MBLT	0x4</span>
<span class="cp">#define VME_2eVME	0x8</span>
<span class="cp">#define VME_2eSST	0x10</span>
<span class="cp">#define VME_2eSSTB	0x20</span>

<span class="cp">#define VME_2eSST160	0x100</span>
<span class="cp">#define VME_2eSST267	0x200</span>
<span class="cp">#define VME_2eSST320	0x400</span>

<span class="cp">#define	VME_SUPER	0x1000</span>
<span class="cp">#define	VME_USER	0x2000</span>
<span class="cp">#define	VME_PROG	0x4000</span>
<span class="cp">#define	VME_DATA	0x8000</span>

<span class="cm">/* VME Data Widths */</span>
<span class="cp">#define VME_D8		0x1</span>
<span class="cp">#define VME_D16		0x2</span>
<span class="cp">#define VME_D32		0x4</span>
<span class="cp">#define VME_D64		0x8</span>

<span class="cm">/* Arbitration Scheduling Modes */</span>
<span class="cp">#define VME_R_ROBIN_MODE	0x1</span>
<span class="cp">#define VME_PRIORITY_MODE	0x2</span>

<span class="cp">#define VME_DMA_PATTERN			(1&lt;&lt;0)</span>
<span class="cp">#define VME_DMA_PCI			(1&lt;&lt;1)</span>
<span class="cp">#define VME_DMA_VME			(1&lt;&lt;2)</span>

<span class="cp">#define VME_DMA_PATTERN_BYTE		(1&lt;&lt;0)</span>
<span class="cp">#define VME_DMA_PATTERN_WORD		(1&lt;&lt;1)</span>
<span class="cp">#define VME_DMA_PATTERN_INCREMENT	(1&lt;&lt;2)</span>

<span class="cp">#define VME_DMA_VME_TO_MEM		(1&lt;&lt;0)</span>
<span class="cp">#define VME_DMA_MEM_TO_VME		(1&lt;&lt;1)</span>
<span class="cp">#define VME_DMA_VME_TO_VME		(1&lt;&lt;2)</span>
<span class="cp">#define VME_DMA_MEM_TO_MEM		(1&lt;&lt;3)</span>
<span class="cp">#define VME_DMA_PATTERN_TO_VME		(1&lt;&lt;4)</span>
<span class="cp">#define VME_DMA_PATTERN_TO_MEM		(1&lt;&lt;5)</span>

<span class="k">struct</span> <span class="n">vme_dma_attr</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">private</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vme_resource</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">vme_resource_type</span> <span class="n">type</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">entry</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">bus_type</span> <span class="n">vme_bus_type</span><span class="p">;</span>

<span class="cm">/* VME_MAX_BRIDGES comes from the type of vme_bus_numbers */</span>
<span class="cp">#define VME_MAX_BRIDGES		(sizeof(unsigned int)*8)</span>
<span class="cp">#define VME_MAX_SLOTS		32</span>

<span class="cp">#define VME_SLOT_CURRENT	-1</span>
<span class="cp">#define VME_SLOT_ALL		-2</span>

<span class="cm">/**</span>
<span class="cm"> * Structure representing a VME device</span>
<span class="cm"> * @num: The device number</span>
<span class="cm"> * @bridge: Pointer to the bridge device this device is on</span>
<span class="cm"> * @dev: Internal device structure</span>
<span class="cm"> * @drv_list: List of devices (per driver)</span>
<span class="cm"> * @bridge_list: List of devices (per bridge)</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">vme_dev</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">num</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vme_bridge</span> <span class="o">*</span><span class="n">bridge</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">drv_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">bridge_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vme_driver</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">node</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">match</span><span class="p">)(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">probe</span><span class="p">)(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">remove</span><span class="p">)(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">shutdown</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">device_driver</span> <span class="n">driver</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">devices</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="o">*</span><span class="n">vme_alloc_consistent</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vme_free_consistent</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span>  <span class="kt">void</span> <span class="o">*</span><span class="p">,</span>
	<span class="n">dma_addr_t</span><span class="p">);</span>

<span class="kt">size_t</span> <span class="n">vme_get_size</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="n">vme_slave_request</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_slave_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">,</span> <span class="n">dma_addr_t</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_slave_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="o">*</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="o">*</span><span class="p">,</span> <span class="n">dma_addr_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vme_slave_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="n">vme_master_request</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_master_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_master_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="o">*</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">ssize_t</span> <span class="n">vme_master_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">loff_t</span><span class="p">);</span>
<span class="kt">ssize_t</span> <span class="n">vme_master_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">loff_t</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vme_master_rmw</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">loff_t</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vme_master_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="n">vme_dma_request</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">vme_dma_list</span> <span class="o">*</span><span class="n">vme_new_dma_list</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">vme_dma_attr</span> <span class="o">*</span><span class="n">vme_dma_pattern_attribute</span><span class="p">(</span><span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">vme_dma_attr</span> <span class="o">*</span><span class="n">vme_dma_pci_attribute</span><span class="p">(</span><span class="n">dma_addr_t</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">vme_dma_attr</span> <span class="o">*</span><span class="n">vme_dma_vme_attribute</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vme_dma_free_attribute</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dma_attr</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_dma_list_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dma_list</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">vme_dma_attr</span> <span class="o">*</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">vme_dma_attr</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_dma_list_exec</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dma_list</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_dma_list_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dma_list</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_dma_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">vme_irq_request</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">),</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vme_irq_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_irq_generate</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="n">vme_lm_request</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_lm_count</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_lm_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_lm_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">vme_lm_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="kt">int</span><span class="p">));</span>
<span class="kt">int</span> <span class="n">vme_lm_detach</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vme_lm_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_resource</span> <span class="o">*</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">vme_slot_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_dev</span> <span class="o">*</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">vme_register_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_driver</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">vme_unregister_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">vme_driver</span> <span class="o">*</span><span class="p">);</span>


<span class="cp">#endif </span><span class="cm">/* _VME_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
