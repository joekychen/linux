<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › usb › musb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>musb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This is used to for host and peripheral modes of the driver for</span>
<span class="cm"> * Inventra (Multidrop) Highspeed Dual-Role Controllers:  (M)HDRC.</span>
<span class="cm"> *</span>
<span class="cm"> * Board initialization should put one of these into dev-&gt;platform_data,</span>
<span class="cm"> * probably on some platform_device named &quot;musb-hdrc&quot;.  It encapsulates</span>
<span class="cm"> * key configuration differences between boards.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __LINUX_USB_MUSB_H</span>
<span class="cp">#define __LINUX_USB_MUSB_H</span>

<span class="cm">/* The USB role is defined by the connector used on the board, so long as</span>
<span class="cm"> * standards are being followed.  (Developer boards sometimes won&#39;t.)</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">musb_mode</span> <span class="p">{</span>
	<span class="n">MUSB_UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">MUSB_HOST</span><span class="p">,</span>		<span class="cm">/* A or Mini-A connector */</span>
	<span class="n">MUSB_PERIPHERAL</span><span class="p">,</span>	<span class="cm">/* B or Mini-B connector */</span>
	<span class="n">MUSB_OTG</span>		<span class="cm">/* Mini-AB connector */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">clk</span><span class="p">;</span>

<span class="k">enum</span> <span class="n">musb_fifo_style</span> <span class="p">{</span>
	<span class="n">FIFO_RXTX</span><span class="p">,</span>
	<span class="n">FIFO_TX</span><span class="p">,</span>
	<span class="n">FIFO_RX</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">enum</span> <span class="n">musb_buf_mode</span> <span class="p">{</span>
	<span class="n">BUF_SINGLE</span><span class="p">,</span>
	<span class="n">BUF_DOUBLE</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">musb_fifo_cfg</span> <span class="p">{</span>
	<span class="n">u8</span>			<span class="n">hw_ep_num</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">musb_fifo_style</span>	<span class="n">style</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">musb_buf_mode</span>	<span class="n">mode</span><span class="p">;</span>
	<span class="n">u16</span>			<span class="n">maxpacket</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define MUSB_EP_FIFO(ep, st, m, pkt)		\</span>
<span class="cp">{						\</span>
<span class="cp">	.hw_ep_num	= ep,			\</span>
<span class="cp">	.style		= st,			\</span>
<span class="cp">	.mode		= m,			\</span>
<span class="cp">	.maxpacket	= pkt,			\</span>
<span class="cp">}</span>

<span class="cp">#define MUSB_EP_FIFO_SINGLE(ep, st, pkt)	\</span>
<span class="cp">	MUSB_EP_FIFO(ep, st, BUF_SINGLE, pkt)</span>

<span class="cp">#define MUSB_EP_FIFO_DOUBLE(ep, st, pkt)	\</span>
<span class="cp">	MUSB_EP_FIFO(ep, st, BUF_DOUBLE, pkt)</span>

<span class="k">struct</span> <span class="n">musb_hdrc_eps_bits</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span>	<span class="n">name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u8</span>		<span class="n">bits</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">musb_hdrc_config</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">musb_fifo_cfg</span>	<span class="o">*</span><span class="n">fifo_cfg</span><span class="p">;</span>	<span class="cm">/* board fifo configuration */</span>
	<span class="kt">unsigned</span>		<span class="n">fifo_cfg_size</span><span class="p">;</span>	<span class="cm">/* size of the fifo configuration */</span>

	<span class="cm">/* MUSB configuration-specific details */</span>
	<span class="kt">unsigned</span>	<span class="n">multipoint</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* multipoint device */</span>
	<span class="kt">unsigned</span>	<span class="n">dyn_fifo</span><span class="o">:</span><span class="mi">1</span> <span class="n">__deprecated</span><span class="p">;</span> <span class="cm">/* supports dynamic fifo sizing */</span>
	<span class="kt">unsigned</span>	<span class="n">soft_con</span><span class="o">:</span><span class="mi">1</span> <span class="n">__deprecated</span><span class="p">;</span> <span class="cm">/* soft connect required */</span>
	<span class="kt">unsigned</span>	<span class="n">utm_16</span><span class="o">:</span><span class="mi">1</span> <span class="n">__deprecated</span><span class="p">;</span> <span class="cm">/* utm data witdh is 16 bits */</span>
	<span class="kt">unsigned</span>	<span class="n">big_endian</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* true if CPU uses big-endian */</span>
	<span class="kt">unsigned</span>	<span class="n">mult_bulk_tx</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Tx ep required for multbulk pkts */</span>
	<span class="kt">unsigned</span>	<span class="n">mult_bulk_rx</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Rx ep required for multbulk pkts */</span>
	<span class="kt">unsigned</span>	<span class="n">high_iso_tx</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Tx ep required for HB iso */</span>
	<span class="kt">unsigned</span>	<span class="n">high_iso_rx</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Rx ep required for HD iso */</span>
	<span class="kt">unsigned</span>	<span class="n">dma</span><span class="o">:</span><span class="mi">1</span> <span class="n">__deprecated</span><span class="p">;</span> <span class="cm">/* supports DMA */</span>
	<span class="kt">unsigned</span>	<span class="n">vendor_req</span><span class="o">:</span><span class="mi">1</span> <span class="n">__deprecated</span><span class="p">;</span> <span class="cm">/* vendor registers required */</span>

	<span class="n">u8</span>		<span class="n">num_eps</span><span class="p">;</span>	<span class="cm">/* number of endpoints _with_ ep0 */</span>
	<span class="n">u8</span>		<span class="n">dma_channels</span> <span class="n">__deprecated</span><span class="p">;</span> <span class="cm">/* number of dma channels */</span>
	<span class="n">u8</span>		<span class="n">dyn_fifo_size</span><span class="p">;</span>	<span class="cm">/* dynamic size in bytes */</span>
	<span class="n">u8</span>		<span class="n">vendor_ctrl</span> <span class="n">__deprecated</span><span class="p">;</span> <span class="cm">/* vendor control reg width */</span>
	<span class="n">u8</span>		<span class="n">vendor_stat</span> <span class="n">__deprecated</span><span class="p">;</span> <span class="cm">/* vendor status reg witdh */</span>
	<span class="n">u8</span>		<span class="n">dma_req_chan</span> <span class="n">__deprecated</span><span class="p">;</span> <span class="cm">/* bitmask for required dma channels */</span>
	<span class="n">u8</span>		<span class="n">ram_bits</span><span class="p">;</span>	<span class="cm">/* ram address size */</span>

	<span class="k">struct</span> <span class="n">musb_hdrc_eps_bits</span> <span class="o">*</span><span class="n">eps_bits</span> <span class="n">__deprecated</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_BLACKFIN</span>
	<span class="cm">/* A GPIO controlling VRSEL in Blackfin */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">gpio_vrsel</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">gpio_vrsel_active</span><span class="p">;</span>
	<span class="cm">/* musb CLKIN in Blackfin in MHZ */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">clkin</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="p">};</span>

<span class="k">struct</span> <span class="n">musb_hdrc_platform_data</span> <span class="p">{</span>
	<span class="cm">/* MUSB_HOST, MUSB_PERIPHERAL, or MUSB_OTG */</span>
	<span class="n">u8</span>		<span class="n">mode</span><span class="p">;</span>

	<span class="cm">/* for clk_get() */</span>
	<span class="k">const</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">clock</span><span class="p">;</span>

	<span class="cm">/* (HOST or OTG) switch VBUS on/off */</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">set_vbus</span><span class="p">)(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">is_on</span><span class="p">);</span>

	<span class="cm">/* (HOST or OTG) mA/2 power supplied on (default = 8mA) */</span>
	<span class="n">u8</span>		<span class="n">power</span><span class="p">;</span>

	<span class="cm">/* (PERIPHERAL) mA/2 max power consumed (default = 100mA) */</span>
	<span class="n">u8</span>		<span class="n">min_power</span><span class="p">;</span>

	<span class="cm">/* (HOST or OTG) msec/2 after VBUS on till power good */</span>
	<span class="n">u8</span>		<span class="n">potpgt</span><span class="p">;</span>

	<span class="cm">/* (HOST or OTG) program PHY for external Vbus */</span>
	<span class="kt">unsigned</span>	<span class="n">extvbus</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* Power the device on or off */</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">set_power</span><span class="p">)(</span><span class="kt">int</span> <span class="n">state</span><span class="p">);</span>

	<span class="cm">/* MUSB configuration-specific details */</span>
	<span class="k">struct</span> <span class="n">musb_hdrc_config</span>	<span class="o">*</span><span class="n">config</span><span class="p">;</span>

	<span class="cm">/* Architecture specific board data	*/</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">board_data</span><span class="p">;</span>

	<span class="cm">/* Platform specific struct musb_ops pointer */</span>
	<span class="k">const</span> <span class="kt">void</span>	<span class="o">*</span><span class="n">platform_ops</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/* TUSB 6010 support */</span>

<span class="cp">#define	TUSB6010_OSCCLK_60	16667	</span><span class="cm">/* psec/clk @ 60.0 MHz */</span><span class="cp"></span>
<span class="cp">#define	TUSB6010_REFCLK_24	41667	</span><span class="cm">/* psec/clk @ 24.0 MHz XI */</span><span class="cp"></span>
<span class="cp">#define	TUSB6010_REFCLK_19	52083	</span><span class="cm">/* psec/clk @ 19.2 MHz CLKIN */</span><span class="cp"></span>

<span class="cp">#ifdef	CONFIG_ARCH_OMAP2</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">__init</span> <span class="n">tusb6010_setup_interface</span><span class="p">(</span>
		<span class="k">struct</span> <span class="n">musb_hdrc_platform_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="n">ps_refclk</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">waitpin</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="n">async_cs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">sync_cs</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">dmachan</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">tusb6010_platform_retime</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">is_refclk</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* OMAP2 */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __LINUX_USB_MUSB_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
