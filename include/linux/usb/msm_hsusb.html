<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › usb › msm_hsusb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>msm_hsusb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* linux/include/asm-arm/arch-msm/hsusb.h</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2008 Google, Inc.</span>
<span class="cm"> * Author: Brian Swetland &lt;swetland@google.com&gt;</span>
<span class="cm"> * Copyright (c) 2009-2011, Code Aurora Forum. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is licensed under the terms of the GNU General Public</span>
<span class="cm"> * License version 2, as published by the Free Software Foundation, and</span>
<span class="cm"> * may be copied, distributed, and modified under those terms.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASM_ARCH_MSM_HSUSB_H</span>
<span class="cp">#define __ASM_ARCH_MSM_HSUSB_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/usb/otg.h&gt;</span>

<span class="cm">/**</span>
<span class="cm"> * Supported USB modes</span>
<span class="cm"> *</span>
<span class="cm"> * USB_PERIPHERAL       Only peripheral mode is supported.</span>
<span class="cm"> * USB_HOST             Only host mode is supported.</span>
<span class="cm"> * USB_OTG              OTG mode is supported.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">usb_mode_type</span> <span class="p">{</span>
	<span class="n">USB_NONE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">USB_PERIPHERAL</span><span class="p">,</span>
	<span class="n">USB_HOST</span><span class="p">,</span>
	<span class="n">USB_OTG</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * OTG control</span>
<span class="cm"> *</span>
<span class="cm"> * OTG_NO_CONTROL	Id/VBUS notifications not required. Useful in host</span>
<span class="cm"> *                      only configuration.</span>
<span class="cm"> * OTG_PHY_CONTROL	Id/VBUS notifications comes form USB PHY.</span>
<span class="cm"> * OTG_PMIC_CONTROL	Id/VBUS notifications comes from PMIC hardware.</span>
<span class="cm"> * OTG_USER_CONTROL	Id/VBUS notifcations comes from User via sysfs.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">otg_control_type</span> <span class="p">{</span>
	<span class="n">OTG_NO_CONTROL</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">OTG_PHY_CONTROL</span><span class="p">,</span>
	<span class="n">OTG_PMIC_CONTROL</span><span class="p">,</span>
	<span class="n">OTG_USER_CONTROL</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * PHY used in</span>
<span class="cm"> *</span>
<span class="cm"> * INVALID_PHY			Unsupported PHY</span>
<span class="cm"> * CI_45NM_INTEGRATED_PHY	Chipidea 45nm integrated PHY</span>
<span class="cm"> * SNPS_28NM_INTEGRATED_PHY	Synopsis 28nm integrated PHY</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">msm_usb_phy_type</span> <span class="p">{</span>
	<span class="n">INVALID_PHY</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">CI_45NM_INTEGRATED_PHY</span><span class="p">,</span>
	<span class="n">SNPS_28NM_INTEGRATED_PHY</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define IDEV_CHG_MAX	1500</span>
<span class="cp">#define IUNIT		100</span>

<span class="cm">/**</span>
<span class="cm"> * Different states involved in USB charger detection.</span>
<span class="cm"> *</span>
<span class="cm"> * USB_CHG_STATE_UNDEFINED	USB charger is not connected or detection</span>
<span class="cm"> *                              process is not yet started.</span>
<span class="cm"> * USB_CHG_STATE_WAIT_FOR_DCD	Waiting for Data pins contact.</span>
<span class="cm"> * USB_CHG_STATE_DCD_DONE	Data pin contact is detected.</span>
<span class="cm"> * USB_CHG_STATE_PRIMARY_DONE	Primary detection is completed (Detects</span>
<span class="cm"> *                              between SDP and DCP/CDP).</span>
<span class="cm"> * USB_CHG_STATE_SECONDARY_DONE	Secondary detection is completed (Detects</span>
<span class="cm"> *                              between DCP and CDP).</span>
<span class="cm"> * USB_CHG_STATE_DETECTED	USB charger type is determined.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">usb_chg_state</span> <span class="p">{</span>
	<span class="n">USB_CHG_STATE_UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">USB_CHG_STATE_WAIT_FOR_DCD</span><span class="p">,</span>
	<span class="n">USB_CHG_STATE_DCD_DONE</span><span class="p">,</span>
	<span class="n">USB_CHG_STATE_PRIMARY_DONE</span><span class="p">,</span>
	<span class="n">USB_CHG_STATE_SECONDARY_DONE</span><span class="p">,</span>
	<span class="n">USB_CHG_STATE_DETECTED</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * USB charger types</span>
<span class="cm"> *</span>
<span class="cm"> * USB_INVALID_CHARGER	Invalid USB charger.</span>
<span class="cm"> * USB_SDP_CHARGER	Standard downstream port. Refers to a downstream port</span>
<span class="cm"> *                      on USB2.0 compliant host/hub.</span>
<span class="cm"> * USB_DCP_CHARGER	Dedicated charger port (AC charger/ Wall charger).</span>
<span class="cm"> * USB_CDP_CHARGER	Charging downstream port. Enumeration can happen and</span>
<span class="cm"> *                      IDEV_CHG_MAX can be drawn irrespective of USB state.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">usb_chg_type</span> <span class="p">{</span>
	<span class="n">USB_INVALID_CHARGER</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">USB_SDP_CHARGER</span><span class="p">,</span>
	<span class="n">USB_DCP_CHARGER</span><span class="p">,</span>
	<span class="n">USB_CDP_CHARGER</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct msm_otg_platform_data - platform device data</span>
<span class="cm"> *              for msm_otg driver.</span>
<span class="cm"> * @phy_init_seq: PHY configuration sequence. val, reg pairs</span>
<span class="cm"> *              terminated by -1.</span>
<span class="cm"> * @vbus_power: VBUS power on/off routine.</span>
<span class="cm"> * @power_budget: VBUS power budget in mA (0 will be treated as 500mA).</span>
<span class="cm"> * @mode: Supported mode (OTG/peripheral/host).</span>
<span class="cm"> * @otg_control: OTG switch controlled by user/Id pin</span>
<span class="cm"> * @default_mode: Default operational mode. Applicable only if</span>
<span class="cm"> *              OTG switch is controller by user.</span>
<span class="cm"> * @pclk_src_name: pclk is derived from ebi1_usb_clk in case of 7x27 and 8k</span>
<span class="cm"> *              dfab_usb_hs_clk in case of 8660 and 8960.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">msm_otg_platform_data</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="o">*</span><span class="n">phy_init_seq</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">vbus_power</span><span class="p">)(</span><span class="n">bool</span> <span class="n">on</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="n">power_budget</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">usb_mode_type</span> <span class="n">mode</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">otg_control_type</span> <span class="n">otg_control</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">usb_mode_type</span> <span class="n">default_mode</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">msm_usb_phy_type</span> <span class="n">phy_type</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">setup_gpio</span><span class="p">)(</span><span class="k">enum</span> <span class="n">usb_otg_state</span> <span class="n">state</span><span class="p">);</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pclk_src_name</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct msm_otg: OTG driver data. Shared by HCD and DCD.</span>
<span class="cm"> * @otg: USB OTG Transceiver structure.</span>
<span class="cm"> * @pdata: otg device platform data.</span>
<span class="cm"> * @irq: IRQ number assigned for HSUSB controller.</span>
<span class="cm"> * @clk: clock struct of usb_hs_clk.</span>
<span class="cm"> * @pclk: clock struct of usb_hs_pclk.</span>
<span class="cm"> * @pclk_src: pclk source for voting.</span>
<span class="cm"> * @phy_reset_clk: clock struct of usb_phy_clk.</span>
<span class="cm"> * @core_clk: clock struct of usb_hs_core_clk.</span>
<span class="cm"> * @regs: ioremapped register base address.</span>
<span class="cm"> * @inputs: OTG state machine inputs(Id, SessValid etc).</span>
<span class="cm"> * @sm_work: OTG state machine work.</span>
<span class="cm"> * @in_lpm: indicates low power mode (LPM) state.</span>
<span class="cm"> * @async_int: Async interrupt arrived.</span>
<span class="cm"> * @cur_power: The amount of mA available from downstream port.</span>
<span class="cm"> * @chg_work: Charger detection work.</span>
<span class="cm"> * @chg_state: The state of charger detection process.</span>
<span class="cm"> * @chg_type: The type of charger attached.</span>
<span class="cm"> * @dcd_retires: The retry count used to track Data contact</span>
<span class="cm"> *               detection process.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">msm_otg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_phy</span> <span class="n">phy</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">msm_otg_platform_data</span> <span class="o">*</span><span class="n">pdata</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">clk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">pclk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">pclk_src</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">phy_reset_clk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">core_clk</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">regs</span><span class="p">;</span>
<span class="cp">#define ID		0</span>
<span class="cp">#define B_SESS_VLD	1</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">inputs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">sm_work</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">in_lpm</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">async_int</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">cur_power</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">chg_work</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">usb_chg_state</span> <span class="n">chg_state</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">usb_chg_type</span> <span class="n">chg_type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dcd_retries</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
