<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › cyclades.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>cyclades.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $Revision: 3.0 $$Date: 1998/11/02 14:20:59 $</span>
<span class="cm"> * linux/include/linux/cyclades.h</span>
<span class="cm"> *</span>
<span class="cm"> * This file was initially written by</span>
<span class="cm"> * Randolph Bentson &lt;bentson@grieg.seaslug.org&gt; and is maintained by</span>
<span class="cm"> * Ivan Passos &lt;ivan@cyclades.com&gt;.</span>
<span class="cm"> *</span>
<span class="cm"> * This file contains the general definitions for the cyclades.c driver</span>
<span class="cm"> *$Log: cyclades.h,v $</span>
<span class="cm"> *Revision 3.1  2002/01/29 11:36:16  henrique</span>
<span class="cm"> *added throttle field on struct cyclades_port to indicate whether the</span>
<span class="cm"> *port is throttled or not</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 3.1  2000/04/19 18:52:52  ivan</span>
<span class="cm"> *converted address fields to unsigned long and added fields for physical</span>
<span class="cm"> *addresses on cyclades_card structure;</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 3.0  1998/11/02 14:20:59  ivan</span>
<span class="cm"> *added nports field on cyclades_card structure;</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 2.5  1998/08/03 16:57:01  ivan</span>
<span class="cm"> *added cyclades_idle_stats structure;</span>
<span class="cm"> * </span>
<span class="cm"> *Revision 2.4  1998/06/01 12:09:53  ivan</span>
<span class="cm"> *removed closing_wait2 from cyclades_port structure;</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 2.3  1998/03/16 18:01:12  ivan</span>
<span class="cm"> *changes in the cyclades_port structure to get it closer to the </span>
<span class="cm"> *standard serial port structure;</span>
<span class="cm"> *added constants for new ioctls;</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 2.2  1998/02/17 16:50:00  ivan</span>
<span class="cm"> *changes in the cyclades_port structure (addition of shutdown_wait and </span>
<span class="cm"> *chip_rev variables);</span>
<span class="cm"> *added constants for new ioctls and for CD1400 rev. numbers.</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 2.1	1997/10/24 16:03:00  ivan</span>
<span class="cm"> *added rflow (which allows enabling the CD1400 special flow control </span>
<span class="cm"> *feature) and rtsdtr_inv (which allows DTR/RTS pin inversion) to </span>
<span class="cm"> *cyclades_port structure;</span>
<span class="cm"> *added Alpha support</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 2.0  1997/06/30 10:30:00  ivan</span>
<span class="cm"> *added some new doorbell command constants related to IOCTLW and</span>
<span class="cm"> *UART error signaling</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 1.8  1997/06/03 15:30:00  ivan</span>
<span class="cm"> *added constant ZFIRM_HLT</span>
<span class="cm"> *added constant CyPCI_Ze_win ( = 2 * Cy_PCI_Zwin)</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 1.7  1997/03/26 10:30:00  daniel</span>
<span class="cm"> *new entries at the end of cyclades_port struct to reallocate</span>
<span class="cm"> *variables illegally allocated within card memory.</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 1.6  1996/09/09 18:35:30  bentson</span>
<span class="cm"> *fold in changes for Cyclom-Z -- including structures for</span>
<span class="cm"> *communicating with board as well modest changes to original</span>
<span class="cm"> *structures to support new features.</span>
<span class="cm"> *</span>
<span class="cm"> *Revision 1.5  1995/11/13 21:13:31  bentson</span>
<span class="cm"> *changes suggested by Michael Chastain &lt;mec@duracef.shout.net&gt;</span>
<span class="cm"> *to support use of this file in non-kernel applications</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _LINUX_CYCLADES_H</span>
<span class="cp">#define _LINUX_CYCLADES_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="k">struct</span> <span class="n">cyclades_monitor</span> <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span>           <span class="n">int_count</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">long</span>           <span class="n">char_count</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">long</span>           <span class="n">char_max</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">long</span>           <span class="n">char_last</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * These stats all reflect activity since the device was last initialized.</span>
<span class="cm"> * (i.e., since the port was opened with no other processes already having it</span>
<span class="cm"> * open)</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">cyclades_idle_stats</span> <span class="p">{</span>
    <span class="n">__kernel_time_t</span> <span class="n">in_use</span><span class="p">;</span>	<span class="cm">/* Time device has been in use (secs) */</span>
    <span class="n">__kernel_time_t</span> <span class="n">recv_idle</span><span class="p">;</span>	<span class="cm">/* Time since last char received (secs) */</span>
    <span class="n">__kernel_time_t</span> <span class="n">xmit_idle</span><span class="p">;</span>	<span class="cm">/* Time since last char transmitted (secs) */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">recv_bytes</span><span class="p">;</span>	<span class="cm">/* Bytes received */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">xmit_bytes</span><span class="p">;</span>	<span class="cm">/* Bytes transmitted */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">overruns</span><span class="p">;</span>	<span class="cm">/* Input overruns */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">frame_errs</span><span class="p">;</span>	<span class="cm">/* Input framing errors */</span>
    <span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">parity_errs</span><span class="p">;</span>	<span class="cm">/* Input parity errors */</span>
<span class="p">};</span>

<span class="cp">#define CYCLADES_MAGIC  0x4359</span>

<span class="cp">#define CYGETMON                0x435901</span>
<span class="cp">#define CYGETTHRESH             0x435902</span>
<span class="cp">#define CYSETTHRESH             0x435903</span>
<span class="cp">#define CYGETDEFTHRESH          0x435904</span>
<span class="cp">#define CYSETDEFTHRESH          0x435905</span>
<span class="cp">#define CYGETTIMEOUT            0x435906</span>
<span class="cp">#define CYSETTIMEOUT            0x435907</span>
<span class="cp">#define CYGETDEFTIMEOUT         0x435908</span>
<span class="cp">#define CYSETDEFTIMEOUT         0x435909</span>
<span class="cp">#define CYSETRFLOW		0x43590a</span>
<span class="cp">#define CYGETRFLOW		0x43590b</span>
<span class="cp">#define CYSETRTSDTR_INV		0x43590c</span>
<span class="cp">#define CYGETRTSDTR_INV		0x43590d</span>
<span class="cp">#define CYZSETPOLLCYCLE		0x43590e</span>
<span class="cp">#define CYZGETPOLLCYCLE		0x43590f</span>
<span class="cp">#define CYGETCD1400VER		0x435910</span>
<span class="cp">#define	CYSETWAIT		0x435912</span>
<span class="cp">#define	CYGETWAIT		0x435913</span>

<span class="cm">/*************** CYCLOM-Z ADDITIONS ***************/</span>

<span class="cp">#define CZIOC           (&#39;M&#39; &lt;&lt; 8)</span>
<span class="cp">#define CZ_NBOARDS      (CZIOC|0xfa)</span>
<span class="cp">#define CZ_BOOT_START   (CZIOC|0xfb)</span>
<span class="cp">#define CZ_BOOT_DATA    (CZIOC|0xfc)</span>
<span class="cp">#define CZ_BOOT_END     (CZIOC|0xfd)</span>
<span class="cp">#define CZ_TEST         (CZIOC|0xfe)</span>

<span class="cp">#define CZ_DEF_POLL	(HZ/25)</span>

<span class="cp">#define MAX_BOARD       4       </span><span class="cm">/* Max number of boards */</span><span class="cp"></span>
<span class="cp">#define MAX_DEV         256     </span><span class="cm">/* Max number of ports total */</span><span class="cp"></span>
<span class="cp">#define	CYZ_MAX_SPEED	921600</span>

<span class="cp">#define	CYZ_FIFO_SIZE	16</span>

<span class="cp">#define CYZ_BOOT_NWORDS 0x100</span>
<span class="k">struct</span> <span class="n">CYZ_BOOT_CTRL</span> <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">nboard</span><span class="p">;</span>
        <span class="kt">int</span>             <span class="n">status</span><span class="p">[</span><span class="n">MAX_BOARD</span><span class="p">];</span>
        <span class="kt">int</span>             <span class="n">nchannel</span><span class="p">[</span><span class="n">MAX_BOARD</span><span class="p">];</span>
        <span class="kt">int</span>             <span class="n">fw_rev</span><span class="p">[</span><span class="n">MAX_BOARD</span><span class="p">];</span>
        <span class="kt">unsigned</span> <span class="kt">long</span>   <span class="n">offset</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">long</span>   <span class="n">data</span><span class="p">[</span><span class="n">CYZ_BOOT_NWORDS</span><span class="p">];</span>
<span class="p">};</span>


<span class="cp">#ifndef DP_WINDOW_SIZE</span>
<span class="cm">/*</span>
<span class="cm"> *	Memory Window Sizes</span>
<span class="cm"> */</span>

<span class="cp">#define	DP_WINDOW_SIZE		(0x00080000)	</span><span class="cm">/* window size 512 Kb */</span><span class="cp"></span>
<span class="cp">#define	ZE_DP_WINDOW_SIZE	(0x00100000)	</span><span class="cm">/* window size 1 Mb (Ze and</span>
<span class="cm">						  8Zo V.2 */</span><span class="cp"></span>
<span class="cp">#define	CTRL_WINDOW_SIZE	(0x00000080)	</span><span class="cm">/* runtime regs 128 bytes */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	CUSTOM_REG - Cyclom-Z/PCI Custom Registers Set. The driver</span>
<span class="cm"> *	normally will access only interested on the fpga_id, fpga_version,</span>
<span class="cm"> *	start_cpu and stop_cpu.</span>
<span class="cm"> */</span>

<span class="k">struct</span>	<span class="n">CUSTOM_REG</span> <span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">fpga_id</span><span class="p">;</span>		<span class="cm">/* FPGA Identification Register */</span>
	<span class="n">__u32</span>	<span class="n">fpga_version</span><span class="p">;</span>		<span class="cm">/* FPGA Version Number Register */</span>
	<span class="n">__u32</span>	<span class="n">cpu_start</span><span class="p">;</span>		<span class="cm">/* CPU start Register (write) */</span>
	<span class="n">__u32</span>	<span class="n">cpu_stop</span><span class="p">;</span>		<span class="cm">/* CPU stop Register (write) */</span>
	<span class="n">__u32</span>	<span class="n">misc_reg</span><span class="p">;</span>		<span class="cm">/* Miscellaneous Register */</span>
	<span class="n">__u32</span>	<span class="n">idt_mode</span><span class="p">;</span>		<span class="cm">/* IDT mode Register */</span>
	<span class="n">__u32</span>	<span class="n">uart_irq_status</span><span class="p">;</span>	<span class="cm">/* UART IRQ status Register */</span>
	<span class="n">__u32</span>	<span class="n">clear_timer0_irq</span><span class="p">;</span>	<span class="cm">/* Clear timer interrupt Register */</span>
	<span class="n">__u32</span>	<span class="n">clear_timer1_irq</span><span class="p">;</span>	<span class="cm">/* Clear timer interrupt Register */</span>
	<span class="n">__u32</span>	<span class="n">clear_timer2_irq</span><span class="p">;</span>	<span class="cm">/* Clear timer interrupt Register */</span>
	<span class="n">__u32</span>	<span class="n">test_register</span><span class="p">;</span>		<span class="cm">/* Test Register */</span>
	<span class="n">__u32</span>	<span class="n">test_count</span><span class="p">;</span>		<span class="cm">/* Test Count Register */</span>
	<span class="n">__u32</span>	<span class="n">timer_select</span><span class="p">;</span>		<span class="cm">/* Timer select register */</span>
	<span class="n">__u32</span>	<span class="n">pr_uart_irq_status</span><span class="p">;</span>	<span class="cm">/* Prioritized UART IRQ stat Reg */</span>
	<span class="n">__u32</span>	<span class="n">ram_wait_state</span><span class="p">;</span>		<span class="cm">/* RAM wait-state Register */</span>
	<span class="n">__u32</span>	<span class="n">uart_wait_state</span><span class="p">;</span>	<span class="cm">/* UART wait-state Register */</span>
	<span class="n">__u32</span>	<span class="n">timer_wait_state</span><span class="p">;</span>	<span class="cm">/* timer wait-state Register */</span>
	<span class="n">__u32</span>	<span class="n">ack_wait_state</span><span class="p">;</span>		<span class="cm">/* ACK wait State Register */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *	RUNTIME_9060 - PLX PCI9060ES local configuration and shared runtime</span>
<span class="cm"> *	registers. This structure can be used to access the 9060 registers</span>
<span class="cm"> *	(memory mapped).</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">RUNTIME_9060</span> <span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">loc_addr_range</span><span class="p">;</span>	<span class="cm">/* 00h - Local Address Range */</span>
	<span class="n">__u32</span>	<span class="n">loc_addr_base</span><span class="p">;</span>	<span class="cm">/* 04h - Local Address Base */</span>
	<span class="n">__u32</span>	<span class="n">loc_arbitr</span><span class="p">;</span>	<span class="cm">/* 08h - Local Arbitration */</span>
	<span class="n">__u32</span>	<span class="n">endian_descr</span><span class="p">;</span>	<span class="cm">/* 0Ch - Big/Little Endian Descriptor */</span>
	<span class="n">__u32</span>	<span class="n">loc_rom_range</span><span class="p">;</span>	<span class="cm">/* 10h - Local ROM Range */</span>
	<span class="n">__u32</span>	<span class="n">loc_rom_base</span><span class="p">;</span>	<span class="cm">/* 14h - Local ROM Base */</span>
	<span class="n">__u32</span>	<span class="n">loc_bus_descr</span><span class="p">;</span>	<span class="cm">/* 18h - Local Bus descriptor */</span>
	<span class="n">__u32</span>	<span class="n">loc_range_mst</span><span class="p">;</span>	<span class="cm">/* 1Ch - Local Range for Master to PCI */</span>
	<span class="n">__u32</span>	<span class="n">loc_base_mst</span><span class="p">;</span>	<span class="cm">/* 20h - Local Base for Master PCI */</span>
	<span class="n">__u32</span>	<span class="n">loc_range_io</span><span class="p">;</span>	<span class="cm">/* 24h - Local Range for Master IO */</span>
	<span class="n">__u32</span>	<span class="n">pci_base_mst</span><span class="p">;</span>	<span class="cm">/* 28h - PCI Base for Master PCI */</span>
	<span class="n">__u32</span>	<span class="n">pci_conf_io</span><span class="p">;</span>	<span class="cm">/* 2Ch - PCI configuration for Master IO */</span>
	<span class="n">__u32</span>	<span class="n">filler1</span><span class="p">;</span>	<span class="cm">/* 30h */</span>
	<span class="n">__u32</span>	<span class="n">filler2</span><span class="p">;</span>	<span class="cm">/* 34h */</span>
	<span class="n">__u32</span>	<span class="n">filler3</span><span class="p">;</span>	<span class="cm">/* 38h */</span>
	<span class="n">__u32</span>	<span class="n">filler4</span><span class="p">;</span>	<span class="cm">/* 3Ch */</span>
	<span class="n">__u32</span>	<span class="n">mail_box_0</span><span class="p">;</span>	<span class="cm">/* 40h - Mail Box 0 */</span>
	<span class="n">__u32</span>	<span class="n">mail_box_1</span><span class="p">;</span>	<span class="cm">/* 44h - Mail Box 1 */</span>
	<span class="n">__u32</span>	<span class="n">mail_box_2</span><span class="p">;</span>	<span class="cm">/* 48h - Mail Box 2 */</span>
	<span class="n">__u32</span>	<span class="n">mail_box_3</span><span class="p">;</span>	<span class="cm">/* 4Ch - Mail Box 3 */</span>
	<span class="n">__u32</span>	<span class="n">filler5</span><span class="p">;</span>	<span class="cm">/* 50h */</span>
	<span class="n">__u32</span>	<span class="n">filler6</span><span class="p">;</span>	<span class="cm">/* 54h */</span>
	<span class="n">__u32</span>	<span class="n">filler7</span><span class="p">;</span>	<span class="cm">/* 58h */</span>
	<span class="n">__u32</span>	<span class="n">filler8</span><span class="p">;</span>	<span class="cm">/* 5Ch */</span>
	<span class="n">__u32</span>	<span class="n">pci_doorbell</span><span class="p">;</span>	<span class="cm">/* 60h - PCI to Local Doorbell */</span>
	<span class="n">__u32</span>	<span class="n">loc_doorbell</span><span class="p">;</span>	<span class="cm">/* 64h - Local to PCI Doorbell */</span>
	<span class="n">__u32</span>	<span class="n">intr_ctrl_stat</span><span class="p">;</span>	<span class="cm">/* 68h - Interrupt Control/Status */</span>
	<span class="n">__u32</span>	<span class="n">init_ctrl</span><span class="p">;</span>	<span class="cm">/* 6Ch - EEPROM control, Init Control, etc */</span>
<span class="p">};</span>

<span class="cm">/* Values for the Local Base Address re-map register */</span>

<span class="cp">#define	WIN_RAM		0x00000001L	</span><span class="cm">/* set the sliding window to RAM */</span><span class="cp"></span>
<span class="cp">#define	WIN_CREG	0x14000001L	</span><span class="cm">/* set the window to custom Registers */</span><span class="cp"></span>

<span class="cm">/* Values timer select registers */</span>

<span class="cp">#define	TIMER_BY_1M	0x00		</span><span class="cm">/* clock divided by 1M */</span><span class="cp"></span>
<span class="cp">#define	TIMER_BY_256K	0x01		</span><span class="cm">/* clock divided by 256k */</span><span class="cp"></span>
<span class="cp">#define	TIMER_BY_128K	0x02		</span><span class="cm">/* clock divided by 128k */</span><span class="cp"></span>
<span class="cp">#define	TIMER_BY_32K	0x03		</span><span class="cm">/* clock divided by 32k */</span><span class="cp"></span>

<span class="cm">/****************** ****************** *******************/</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef ZFIRM_ID</span>
<span class="cm">/* #include &quot;zfwint.h&quot; */</span>
<span class="cm">/****************** ****************** *******************/</span>
<span class="cm">/*</span>
<span class="cm"> *	This file contains the definitions for interfacing with the</span>
<span class="cm"> *	Cyclom-Z ZFIRM Firmware.</span>
<span class="cm"> */</span>

<span class="cm">/* General Constant definitions */</span>

<span class="cp">#define	MAX_CHAN	64		</span><span class="cm">/* max number of channels per board */</span><span class="cp"></span>

<span class="cm">/* firmware id structure (set after boot) */</span>

<span class="cp">#define ID_ADDRESS	0x00000180L	</span><span class="cm">/* signature/pointer address */</span><span class="cp"></span>
<span class="cp">#define	ZFIRM_ID	0x5557465AL	</span><span class="cm">/* ZFIRM/U signature */</span><span class="cp"></span>
<span class="cp">#define	ZFIRM_HLT	0x59505B5CL	</span><span class="cm">/* ZFIRM needs external power supply */</span><span class="cp"></span>
<span class="cp">#define	ZFIRM_RST	0x56040674L	</span><span class="cm">/* RST signal (due to FW reset) */</span><span class="cp"></span>

<span class="cp">#define	ZF_TINACT_DEF	1000		</span><span class="cm">/* default inactivity timeout </span>
<span class="cm">					   (1000 ms) */</span><span class="cp"></span>
<span class="cp">#define	ZF_TINACT	ZF_TINACT_DEF</span>

<span class="k">struct</span>	<span class="n">FIRM_ID</span> <span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">signature</span><span class="p">;</span>		<span class="cm">/* ZFIRM/U signature */</span>
	<span class="n">__u32</span>	<span class="n">zfwctrl_addr</span><span class="p">;</span>		<span class="cm">/* pointer to ZFW_CTRL structure */</span>
<span class="p">};</span>

<span class="cm">/* Op. System id */</span>

<span class="cp">#define	C_OS_LINUX	0x00000030	</span><span class="cm">/* generic Linux system */</span><span class="cp"></span>

<span class="cm">/* channel op_mode */</span>

<span class="cp">#define	C_CH_DISABLE	0x00000000	</span><span class="cm">/* channel is disabled */</span><span class="cp"></span>
<span class="cp">#define	C_CH_TXENABLE	0x00000001	</span><span class="cm">/* channel Tx enabled */</span><span class="cp"></span>
<span class="cp">#define	C_CH_RXENABLE	0x00000002	</span><span class="cm">/* channel Rx enabled */</span><span class="cp"></span>
<span class="cp">#define	C_CH_ENABLE	0x00000003	</span><span class="cm">/* channel Tx/Rx enabled */</span><span class="cp"></span>
<span class="cp">#define	C_CH_LOOPBACK	0x00000004	</span><span class="cm">/* Loopback mode */</span><span class="cp"></span>

<span class="cm">/* comm_parity - parity */</span>

<span class="cp">#define	C_PR_NONE	0x00000000	</span><span class="cm">/* None */</span><span class="cp"></span>
<span class="cp">#define	C_PR_ODD	0x00000001	</span><span class="cm">/* Odd */</span><span class="cp"></span>
<span class="cp">#define C_PR_EVEN	0x00000002	</span><span class="cm">/* Even */</span><span class="cp"></span>
<span class="cp">#define C_PR_MARK	0x00000004	</span><span class="cm">/* Mark */</span><span class="cp"></span>
<span class="cp">#define C_PR_SPACE	0x00000008	</span><span class="cm">/* Space */</span><span class="cp"></span>
<span class="cp">#define C_PR_PARITY	0x000000ff</span>

<span class="cp">#define	C_PR_DISCARD	0x00000100	</span><span class="cm">/* discard char with frame/par error */</span><span class="cp"></span>
<span class="cp">#define C_PR_IGNORE	0x00000200	</span><span class="cm">/* ignore frame/par error */</span><span class="cp"></span>

<span class="cm">/* comm_data_l - data length and stop bits */</span>

<span class="cp">#define C_DL_CS5	0x00000001</span>
<span class="cp">#define C_DL_CS6	0x00000002</span>
<span class="cp">#define C_DL_CS7	0x00000004</span>
<span class="cp">#define C_DL_CS8	0x00000008</span>
<span class="cp">#define	C_DL_CS		0x0000000f</span>
<span class="cp">#define C_DL_1STOP	0x00000010</span>
<span class="cp">#define C_DL_15STOP	0x00000020</span>
<span class="cp">#define C_DL_2STOP	0x00000040</span>
<span class="cp">#define	C_DL_STOP	0x000000f0</span>

<span class="cm">/* interrupt enabling/status */</span>

<span class="cp">#define	C_IN_DISABLE	0x00000000	</span><span class="cm">/* zero, disable interrupts */</span><span class="cp"></span>
<span class="cp">#define	C_IN_TXBEMPTY	0x00000001	</span><span class="cm">/* tx buffer empty */</span><span class="cp"></span>
<span class="cp">#define	C_IN_TXLOWWM	0x00000002	</span><span class="cm">/* tx buffer below LWM */</span><span class="cp"></span>
<span class="cp">#define	C_IN_RXHIWM	0x00000010	</span><span class="cm">/* rx buffer above HWM */</span><span class="cp"></span>
<span class="cp">#define	C_IN_RXNNDT	0x00000020	</span><span class="cm">/* rx no new data timeout */</span><span class="cp"></span>
<span class="cp">#define	C_IN_MDCD	0x00000100	</span><span class="cm">/* modem DCD change */</span><span class="cp"></span>
<span class="cp">#define	C_IN_MDSR	0x00000200	</span><span class="cm">/* modem DSR change */</span><span class="cp"></span>
<span class="cp">#define	C_IN_MRI	0x00000400	</span><span class="cm">/* modem RI change */</span><span class="cp"></span>
<span class="cp">#define	C_IN_MCTS	0x00000800	</span><span class="cm">/* modem CTS change */</span><span class="cp"></span>
<span class="cp">#define	C_IN_RXBRK	0x00001000	</span><span class="cm">/* Break received */</span><span class="cp"></span>
<span class="cp">#define	C_IN_PR_ERROR	0x00002000	</span><span class="cm">/* parity error */</span><span class="cp"></span>
<span class="cp">#define	C_IN_FR_ERROR	0x00004000	</span><span class="cm">/* frame error */</span><span class="cp"></span>
<span class="cp">#define C_IN_OVR_ERROR  0x00008000      </span><span class="cm">/* overrun error */</span><span class="cp"></span>
<span class="cp">#define C_IN_RXOFL	0x00010000      </span><span class="cm">/* RX buffer overflow */</span><span class="cp"></span>
<span class="cp">#define C_IN_IOCTLW	0x00020000      </span><span class="cm">/* I/O control w/ wait */</span><span class="cp"></span>
<span class="cp">#define C_IN_MRTS	0x00040000	</span><span class="cm">/* modem RTS drop */</span><span class="cp"></span>
<span class="cp">#define C_IN_ICHAR	0x00080000</span>
 
<span class="cm">/* flow control */</span>

<span class="cp">#define	C_FL_OXX	0x00000001	</span><span class="cm">/* output Xon/Xoff flow control */</span><span class="cp"></span>
<span class="cp">#define	C_FL_IXX	0x00000002	</span><span class="cm">/* output Xon/Xoff flow control */</span><span class="cp"></span>
<span class="cp">#define C_FL_OIXANY	0x00000004	</span><span class="cm">/* output Xon/Xoff (any xon) */</span><span class="cp"></span>
<span class="cp">#define	C_FL_SWFLOW	0x0000000f</span>

<span class="cm">/* flow status */</span>

<span class="cp">#define	C_FS_TXIDLE	0x00000000	</span><span class="cm">/* no Tx data in the buffer or UART */</span><span class="cp"></span>
<span class="cp">#define	C_FS_SENDING	0x00000001	</span><span class="cm">/* UART is sending data */</span><span class="cp"></span>
<span class="cp">#define	C_FS_SWFLOW	0x00000002	</span><span class="cm">/* Tx is stopped by received Xoff */</span><span class="cp"></span>

<span class="cm">/* rs_control/rs_status RS-232 signals */</span>

<span class="cp">#define C_RS_PARAM	0x80000000	</span><span class="cm">/* Indicates presence of parameter in </span>
<span class="cm">					   IOCTLM command */</span><span class="cp"></span>
<span class="cp">#define	C_RS_RTS	0x00000001	</span><span class="cm">/* RTS */</span><span class="cp"></span>
<span class="cp">#define	C_RS_DTR	0x00000004	</span><span class="cm">/* DTR */</span><span class="cp"></span>
<span class="cp">#define	C_RS_DCD	0x00000100	</span><span class="cm">/* CD */</span><span class="cp"></span>
<span class="cp">#define	C_RS_DSR	0x00000200	</span><span class="cm">/* DSR */</span><span class="cp"></span>
<span class="cp">#define	C_RS_RI		0x00000400	</span><span class="cm">/* RI */</span><span class="cp"></span>
<span class="cp">#define	C_RS_CTS	0x00000800	</span><span class="cm">/* CTS */</span><span class="cp"></span>

<span class="cm">/* commands Host &lt;-&gt; Board */</span>

<span class="cp">#define	C_CM_RESET	0x01		</span><span class="cm">/* reset/flush buffers */</span><span class="cp"></span>
<span class="cp">#define	C_CM_IOCTL	0x02		</span><span class="cm">/* re-read CH_CTRL */</span><span class="cp"></span>
<span class="cp">#define	C_CM_IOCTLW	0x03		</span><span class="cm">/* re-read CH_CTRL, intr when done */</span><span class="cp"></span>
<span class="cp">#define	C_CM_IOCTLM	0x04		</span><span class="cm">/* RS-232 outputs change */</span><span class="cp"></span>
<span class="cp">#define	C_CM_SENDXOFF	0x10		</span><span class="cm">/* send Xoff */</span><span class="cp"></span>
<span class="cp">#define	C_CM_SENDXON	0x11		</span><span class="cm">/* send Xon */</span><span class="cp"></span>
<span class="cp">#define C_CM_CLFLOW	0x12		</span><span class="cm">/* Clear flow control (resume) */</span><span class="cp"></span>
<span class="cp">#define	C_CM_SENDBRK	0x41		</span><span class="cm">/* send break */</span><span class="cp"></span>
<span class="cp">#define	C_CM_INTBACK	0x42		</span><span class="cm">/* Interrupt back */</span><span class="cp"></span>
<span class="cp">#define	C_CM_SET_BREAK	0x43		</span><span class="cm">/* Tx break on */</span><span class="cp"></span>
<span class="cp">#define	C_CM_CLR_BREAK	0x44		</span><span class="cm">/* Tx break off */</span><span class="cp"></span>
<span class="cp">#define	C_CM_CMD_DONE	0x45		</span><span class="cm">/* Previous command done */</span><span class="cp"></span>
<span class="cp">#define C_CM_INTBACK2	0x46		</span><span class="cm">/* Alternate Interrupt back */</span><span class="cp"></span>
<span class="cp">#define	C_CM_TINACT	0x51		</span><span class="cm">/* set inactivity detection */</span><span class="cp"></span>
<span class="cp">#define	C_CM_IRQ_ENBL	0x52		</span><span class="cm">/* enable generation of interrupts */</span><span class="cp"></span>
<span class="cp">#define	C_CM_IRQ_DSBL	0x53		</span><span class="cm">/* disable generation of interrupts */</span><span class="cp"></span>
<span class="cp">#define	C_CM_ACK_ENBL	0x54		</span><span class="cm">/* enable acknowledged interrupt mode */</span><span class="cp"></span>
<span class="cp">#define	C_CM_ACK_DSBL	0x55		</span><span class="cm">/* disable acknowledged intr mode */</span><span class="cp"></span>
<span class="cp">#define	C_CM_FLUSH_RX	0x56		</span><span class="cm">/* flushes Rx buffer */</span><span class="cp"></span>
<span class="cp">#define	C_CM_FLUSH_TX	0x57		</span><span class="cm">/* flushes Tx buffer */</span><span class="cp"></span>
<span class="cp">#define C_CM_Q_ENABLE	0x58		</span><span class="cm">/* enables queue access from the </span>
<span class="cm">					   driver */</span><span class="cp"></span>
<span class="cp">#define C_CM_Q_DISABLE  0x59            </span><span class="cm">/* disables queue access from the </span>
<span class="cm">					   driver */</span><span class="cp"></span>

<span class="cp">#define	C_CM_TXBEMPTY	0x60		</span><span class="cm">/* Tx buffer is empty */</span><span class="cp"></span>
<span class="cp">#define	C_CM_TXLOWWM	0x61		</span><span class="cm">/* Tx buffer low water mark */</span><span class="cp"></span>
<span class="cp">#define	C_CM_RXHIWM	0x62		</span><span class="cm">/* Rx buffer high water mark */</span><span class="cp"></span>
<span class="cp">#define	C_CM_RXNNDT	0x63		</span><span class="cm">/* rx no new data timeout */</span><span class="cp"></span>
<span class="cp">#define	C_CM_TXFEMPTY	0x64</span>
<span class="cp">#define	C_CM_ICHAR	0x65</span>
<span class="cp">#define	C_CM_MDCD	0x70		</span><span class="cm">/* modem DCD change */</span><span class="cp"></span>
<span class="cp">#define	C_CM_MDSR	0x71		</span><span class="cm">/* modem DSR change */</span><span class="cp"></span>
<span class="cp">#define	C_CM_MRI	0x72		</span><span class="cm">/* modem RI change */</span><span class="cp"></span>
<span class="cp">#define	C_CM_MCTS	0x73		</span><span class="cm">/* modem CTS change */</span><span class="cp"></span>
<span class="cp">#define C_CM_MRTS	0x74		</span><span class="cm">/* modem RTS drop */</span><span class="cp"></span>
<span class="cp">#define	C_CM_RXBRK	0x84		</span><span class="cm">/* Break received */</span><span class="cp"></span>
<span class="cp">#define	C_CM_PR_ERROR	0x85		</span><span class="cm">/* Parity error */</span><span class="cp"></span>
<span class="cp">#define	C_CM_FR_ERROR	0x86		</span><span class="cm">/* Frame error */</span><span class="cp"></span>
<span class="cp">#define C_CM_OVR_ERROR  0x87            </span><span class="cm">/* Overrun error */</span><span class="cp"></span>
<span class="cp">#define C_CM_RXOFL	0x88            </span><span class="cm">/* RX buffer overflow */</span><span class="cp"></span>
<span class="cp">#define	C_CM_CMDERROR	0x90		</span><span class="cm">/* command error */</span><span class="cp"></span>
<span class="cp">#define	C_CM_FATAL	0x91		</span><span class="cm">/* fatal error */</span><span class="cp"></span>
<span class="cp">#define	C_CM_HW_RESET	0x92		</span><span class="cm">/* reset board */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	CH_CTRL - This per port structure contains all parameters</span>
<span class="cm"> *	that control an specific port. It can be seen as the</span>
<span class="cm"> *	configuration registers of a &quot;super-serial-controller&quot;.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">CH_CTRL</span> <span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">op_mode</span><span class="p">;</span>	<span class="cm">/* operation mode */</span>
	<span class="n">__u32</span>	<span class="n">intr_enable</span><span class="p">;</span>	<span class="cm">/* interrupt masking */</span>
	<span class="n">__u32</span>	<span class="n">sw_flow</span><span class="p">;</span>	<span class="cm">/* SW flow control */</span>
	<span class="n">__u32</span>	<span class="n">flow_status</span><span class="p">;</span>	<span class="cm">/* output flow status */</span>
	<span class="n">__u32</span>	<span class="n">comm_baud</span><span class="p">;</span>	<span class="cm">/* baud rate  - numerically specified */</span>
	<span class="n">__u32</span>	<span class="n">comm_parity</span><span class="p">;</span>	<span class="cm">/* parity */</span>
	<span class="n">__u32</span>	<span class="n">comm_data_l</span><span class="p">;</span>	<span class="cm">/* data length/stop */</span>
	<span class="n">__u32</span>	<span class="n">comm_flags</span><span class="p">;</span>	<span class="cm">/* other flags */</span>
	<span class="n">__u32</span>	<span class="n">hw_flow</span><span class="p">;</span>	<span class="cm">/* HW flow control */</span>
	<span class="n">__u32</span>	<span class="n">rs_control</span><span class="p">;</span>	<span class="cm">/* RS-232 outputs */</span>
	<span class="n">__u32</span>	<span class="n">rs_status</span><span class="p">;</span>	<span class="cm">/* RS-232 inputs */</span>
	<span class="n">__u32</span>	<span class="n">flow_xon</span><span class="p">;</span>	<span class="cm">/* xon char */</span>
	<span class="n">__u32</span>	<span class="n">flow_xoff</span><span class="p">;</span>	<span class="cm">/* xoff char */</span>
	<span class="n">__u32</span>	<span class="n">hw_overflow</span><span class="p">;</span>	<span class="cm">/* hw overflow counter */</span>
	<span class="n">__u32</span>	<span class="n">sw_overflow</span><span class="p">;</span>	<span class="cm">/* sw overflow counter */</span>
	<span class="n">__u32</span>	<span class="n">comm_error</span><span class="p">;</span>	<span class="cm">/* frame/parity error counter */</span>
	<span class="n">__u32</span> <span class="n">ichar</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">filler</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> *	BUF_CTRL - This per channel structure contains</span>
<span class="cm"> *	all Tx and Rx buffer control for a given channel.</span>
<span class="cm"> */</span>

<span class="k">struct</span>	<span class="n">BUF_CTRL</span>	<span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">flag_dma</span><span class="p">;</span>	<span class="cm">/* buffers are in Host memory */</span>
	<span class="n">__u32</span>	<span class="n">tx_bufaddr</span><span class="p">;</span>	<span class="cm">/* address of the tx buffer */</span>
	<span class="n">__u32</span>	<span class="n">tx_bufsize</span><span class="p">;</span>	<span class="cm">/* tx buffer size */</span>
	<span class="n">__u32</span>	<span class="n">tx_threshold</span><span class="p">;</span>	<span class="cm">/* tx low water mark */</span>
	<span class="n">__u32</span>	<span class="n">tx_get</span><span class="p">;</span>		<span class="cm">/* tail index tx buf */</span>
	<span class="n">__u32</span>	<span class="n">tx_put</span><span class="p">;</span>		<span class="cm">/* head index tx buf */</span>
	<span class="n">__u32</span>	<span class="n">rx_bufaddr</span><span class="p">;</span>	<span class="cm">/* address of the rx buffer */</span>
	<span class="n">__u32</span>	<span class="n">rx_bufsize</span><span class="p">;</span>	<span class="cm">/* rx buffer size */</span>
	<span class="n">__u32</span>	<span class="n">rx_threshold</span><span class="p">;</span>	<span class="cm">/* rx high water mark */</span>
	<span class="n">__u32</span>	<span class="n">rx_get</span><span class="p">;</span>		<span class="cm">/* tail index rx buf */</span>
	<span class="n">__u32</span>	<span class="n">rx_put</span><span class="p">;</span>		<span class="cm">/* head index rx buf */</span>
	<span class="n">__u32</span>	<span class="n">filler</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>	<span class="cm">/* filler to align structures */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *	BOARD_CTRL - This per board structure contains all global </span>
<span class="cm"> *	control fields related to the board.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">BOARD_CTRL</span> <span class="p">{</span>

	<span class="cm">/* static info provided by the on-board CPU */</span>
	<span class="n">__u32</span>	<span class="n">n_channel</span><span class="p">;</span>	<span class="cm">/* number of channels */</span>
	<span class="n">__u32</span>	<span class="n">fw_version</span><span class="p">;</span>	<span class="cm">/* firmware version */</span>

	<span class="cm">/* static info provided by the driver */</span>
	<span class="n">__u32</span>	<span class="n">op_system</span><span class="p">;</span>	<span class="cm">/* op_system id */</span>
	<span class="n">__u32</span>	<span class="n">dr_version</span><span class="p">;</span>	<span class="cm">/* driver version */</span>

	<span class="cm">/* board control area */</span>
	<span class="n">__u32</span>	<span class="n">inactivity</span><span class="p">;</span>	<span class="cm">/* inactivity control */</span>

	<span class="cm">/* host to FW commands */</span>
	<span class="n">__u32</span>	<span class="n">hcmd_channel</span><span class="p">;</span>	<span class="cm">/* channel number */</span>
	<span class="n">__u32</span>	<span class="n">hcmd_param</span><span class="p">;</span>	<span class="cm">/* pointer to parameters */</span>

	<span class="cm">/* FW to Host commands */</span>
	<span class="n">__u32</span>	<span class="n">fwcmd_channel</span><span class="p">;</span>	<span class="cm">/* channel number */</span>
	<span class="n">__u32</span>	<span class="n">fwcmd_param</span><span class="p">;</span>	<span class="cm">/* pointer to parameters */</span>
	<span class="n">__u32</span>	<span class="n">zf_int_queue_addr</span><span class="p">;</span> <span class="cm">/* offset for INT_QUEUE structure */</span>

	<span class="cm">/* filler so the structures are aligned */</span>
	<span class="n">__u32</span>	<span class="n">filler</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Host Interrupt Queue */</span>

<span class="cp">#define QUEUE_SIZE	(10*MAX_CHAN)</span>

<span class="k">struct</span>	<span class="n">INT_QUEUE</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">intr_code</span><span class="p">[</span><span class="n">QUEUE_SIZE</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">channel</span><span class="p">[</span><span class="n">QUEUE_SIZE</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">param</span><span class="p">[</span><span class="n">QUEUE_SIZE</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">put</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">get</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *	ZFW_CTRL - This is the data structure that includes all other</span>
<span class="cm"> *	data structures used by the Firmware.</span>
<span class="cm"> */</span>
 
<span class="k">struct</span> <span class="n">ZFW_CTRL</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">BOARD_CTRL</span>	<span class="n">board_ctrl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">CH_CTRL</span>		<span class="n">ch_ctrl</span><span class="p">[</span><span class="n">MAX_CHAN</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">BUF_CTRL</span>		<span class="n">buf_ctrl</span><span class="p">[</span><span class="n">MAX_CHAN</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/****************** ****************** *******************/</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/* Per card data structure */</span>
<span class="k">struct</span> <span class="n">cyclades_card</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">base_addr</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p9050</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">RUNTIME_9060</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">p9060</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">ctl_addr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">BOARD_CTRL</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">board_ctrl</span><span class="p">;</span>	<span class="cm">/* cyz specific */</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_chips</span><span class="p">;</span>	<span class="cm">/* 0 if card absent, -1 if Z/PCI, else Y */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">first_line</span><span class="p">;</span>	<span class="cm">/* minor number of first channel on card */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nports</span><span class="p">;</span>	<span class="cm">/* Number of ports in the card */</span>
	<span class="kt">int</span> <span class="n">bus_index</span><span class="p">;</span>		<span class="cm">/* address shift - 0 for ISA, 1 for PCI */</span>
	<span class="kt">int</span> <span class="n">intr_enabled</span><span class="p">;</span>		<span class="cm">/* FW Interrupt flag - 0 disabled, 1 enabled */</span>
	<span class="n">u32</span> <span class="n">hw_ver</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">card_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cyclades_port</span> <span class="o">*</span><span class="n">ports</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/***************************************</span>
<span class="cm"> * Memory access functions/macros      *</span>
<span class="cm"> * (required to support Alpha systems) *</span>
<span class="cm"> ***************************************/</span>

<span class="cp">#define cy_writeb(port,val)     do { writeb((val), (port)); mb(); } while (0)</span>
<span class="cp">#define cy_writew(port,val)     do { writew((val), (port)); mb(); } while (0)</span>
<span class="cp">#define cy_writel(port,val)     do { writel((val), (port)); mb(); } while (0)</span>

<span class="cm">/*</span>
<span class="cm"> * Statistics counters</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">cyclades_icount</span> <span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">cts</span><span class="p">,</span> <span class="n">dsr</span><span class="p">,</span> <span class="n">rng</span><span class="p">,</span> <span class="n">dcd</span><span class="p">,</span> <span class="n">tx</span><span class="p">,</span> <span class="n">rx</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">frame</span><span class="p">,</span> <span class="n">parity</span><span class="p">,</span> <span class="n">overrun</span><span class="p">,</span> <span class="n">brk</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">buf_overrun</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * This is our internal structure for each serial port&#39;s state.</span>
<span class="cm"> * </span>
<span class="cm"> * Many fields are paralleled by the structure used by the serial_struct</span>
<span class="cm"> * structure.</span>
<span class="cm"> *</span>
<span class="cm"> * For definitions of the flags field, see tty.h</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">cyclades_port</span> <span class="p">{</span>
	<span class="kt">int</span>                     <span class="n">magic</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tty_port</span>		<span class="n">port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cyclades_card</span>	<span class="o">*</span><span class="n">card</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">base_addr</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">cyy</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">CH_CTRL</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">ch_ctrl</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">BUF_CTRL</span> <span class="n">__iomem</span>	<span class="o">*</span><span class="n">buf_ctrl</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">cyz</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">line</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">flags</span><span class="p">;</span> 		<span class="cm">/* defined in tty.h */</span>
	<span class="kt">int</span>                     <span class="n">type</span><span class="p">;</span>		<span class="cm">/* UART type */</span>
	<span class="kt">int</span>			<span class="n">read_status_mask</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">ignore_status_mask</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">timeout</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">xmit_fifo_size</span><span class="p">;</span>
	<span class="kt">int</span>                     <span class="n">cor1</span><span class="p">,</span><span class="n">cor2</span><span class="p">,</span><span class="n">cor3</span><span class="p">,</span><span class="n">cor4</span><span class="p">,</span><span class="n">cor5</span><span class="p">;</span>
	<span class="kt">int</span>                     <span class="n">tbpr</span><span class="p">,</span><span class="n">tco</span><span class="p">,</span><span class="n">rbpr</span><span class="p">,</span><span class="n">rco</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">baud</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">rflow</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">rtsdtr_inv</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">chip_rev</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">custom_divisor</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">x_char</span><span class="p">;</span> <span class="cm">/* to be pushed out ASAP */</span>
	<span class="kt">int</span>                     <span class="n">breakon</span><span class="p">;</span>
	<span class="kt">int</span>                     <span class="n">breakoff</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">xmit_head</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">xmit_tail</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">xmit_cnt</span><span class="p">;</span>
        <span class="kt">int</span>                     <span class="n">default_threshold</span><span class="p">;</span>
        <span class="kt">int</span>                     <span class="n">default_timeout</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">rflush_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cyclades_monitor</span>	<span class="n">mon</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cyclades_idle_stats</span>	<span class="n">idle_stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cyclades_icount</span>	<span class="n">icount</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span>       <span class="n">shutdown_wait</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">throttle</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define	CLOSING_WAIT_DELAY	30*HZ</span>
<span class="cp">#define CY_CLOSING_WAIT_NONE	ASYNC_CLOSING_WAIT_NONE</span>
<span class="cp">#define CY_CLOSING_WAIT_INF	ASYNC_CLOSING_WAIT_INF</span>


<span class="cp">#define CyMAX_CHIPS_PER_CARD	8</span>
<span class="cp">#define CyMAX_CHAR_FIFO		12</span>
<span class="cp">#define CyPORTS_PER_CHIP	4</span>
<span class="cp">#define	CD1400_MAX_SPEED	115200</span>

<span class="cp">#define	CyISA_Ywin	0x2000</span>

<span class="cp">#define CyPCI_Ywin 	0x4000</span>
<span class="cp">#define CyPCI_Yctl 	0x80</span>
<span class="cp">#define CyPCI_Zctl 	CTRL_WINDOW_SIZE</span>
<span class="cp">#define CyPCI_Zwin 	0x80000</span>
<span class="cp">#define CyPCI_Ze_win 	(2 * CyPCI_Zwin)</span>

<span class="cp">#define PCI_DEVICE_ID_MASK	0x06</span>

<span class="cm">/**** CD1400 registers ****/</span>

<span class="cp">#define CD1400_REV_G	0x46</span>
<span class="cp">#define CD1400_REV_J	0x48</span>

<span class="cp">#define CyRegSize  	0x0400</span>
<span class="cp">#define Cy_HwReset 	0x1400</span>
<span class="cp">#define Cy_ClrIntr 	0x1800</span>
<span class="cp">#define Cy_EpldRev 	0x1e00</span>

<span class="cm">/* Global Registers */</span>

<span class="cp">#define CyGFRCR		(0x40*2)</span>
<span class="cp">#define      CyRevE		(44)</span>
<span class="cp">#define CyCAR		(0x68*2)</span>
<span class="cp">#define      CyCHAN_0		(0x00)</span>
<span class="cp">#define      CyCHAN_1		(0x01)</span>
<span class="cp">#define      CyCHAN_2		(0x02)</span>
<span class="cp">#define      CyCHAN_3		(0x03)</span>
<span class="cp">#define CyGCR		(0x4B*2)</span>
<span class="cp">#define      CyCH0_SERIAL	(0x00)</span>
<span class="cp">#define      CyCH0_PARALLEL	(0x80)</span>
<span class="cp">#define CySVRR		(0x67*2)</span>
<span class="cp">#define      CySRModem		(0x04)</span>
<span class="cp">#define      CySRTransmit	(0x02)</span>
<span class="cp">#define      CySRReceive	(0x01)</span>
<span class="cp">#define CyRICR		(0x44*2)</span>
<span class="cp">#define CyTICR		(0x45*2)</span>
<span class="cp">#define CyMICR		(0x46*2)</span>
<span class="cp">#define      CyICR0		(0x00)</span>
<span class="cp">#define      CyICR1		(0x01)</span>
<span class="cp">#define      CyICR2		(0x02)</span>
<span class="cp">#define      CyICR3		(0x03)</span>
<span class="cp">#define CyRIR		(0x6B*2)</span>
<span class="cp">#define CyTIR		(0x6A*2)</span>
<span class="cp">#define CyMIR		(0x69*2)</span>
<span class="cp">#define      CyIRDirEq		(0x80)</span>
<span class="cp">#define      CyIRBusy		(0x40)</span>
<span class="cp">#define      CyIRUnfair		(0x20)</span>
<span class="cp">#define      CyIRContext	(0x1C)</span>
<span class="cp">#define      CyIRChannel	(0x03)</span>
<span class="cp">#define CyPPR 		(0x7E*2)</span>
<span class="cp">#define      CyCLOCK_20_1MS	(0x27)</span>
<span class="cp">#define      CyCLOCK_25_1MS	(0x31)</span>
<span class="cp">#define      CyCLOCK_25_5MS	(0xf4)</span>
<span class="cp">#define      CyCLOCK_60_1MS	(0x75)</span>
<span class="cp">#define      CyCLOCK_60_2MS	(0xea)</span>

<span class="cm">/* Virtual Registers */</span>

<span class="cp">#define CyRIVR		(0x43*2)</span>
<span class="cp">#define CyTIVR		(0x42*2)</span>
<span class="cp">#define CyMIVR		(0x41*2)</span>
<span class="cp">#define      CyIVRMask (0x07)</span>
<span class="cp">#define      CyIVRRxEx (0x07)</span>
<span class="cp">#define      CyIVRRxOK (0x03)</span>
<span class="cp">#define      CyIVRTxOK (0x02)</span>
<span class="cp">#define      CyIVRMdmOK (0x01)</span>
<span class="cp">#define CyTDR		(0x63*2)</span>
<span class="cp">#define CyRDSR		(0x62*2)</span>
<span class="cp">#define      CyTIMEOUT		(0x80)</span>
<span class="cp">#define      CySPECHAR		(0x70)</span>
<span class="cp">#define      CyBREAK		(0x08)</span>
<span class="cp">#define      CyPARITY		(0x04)</span>
<span class="cp">#define      CyFRAME		(0x02)</span>
<span class="cp">#define      CyOVERRUN		(0x01)</span>
<span class="cp">#define CyMISR		(0x4C*2)</span>
<span class="cm">/* see CyMCOR_ and CyMSVR_ for bits*/</span>
<span class="cp">#define CyEOSRR		(0x60*2)</span>

<span class="cm">/* Channel Registers */</span>

<span class="cp">#define CyLIVR		(0x18*2)</span>
<span class="cp">#define      CyMscsr		(0x01)</span>
<span class="cp">#define      CyTdsr		(0x02)</span>
<span class="cp">#define      CyRgdsr		(0x03)</span>
<span class="cp">#define      CyRedsr		(0x07)</span>
<span class="cp">#define CyCCR		(0x05*2)</span>
<span class="cm">/* Format 1 */</span>
<span class="cp">#define      CyCHAN_RESET	(0x80)</span>
<span class="cp">#define      CyCHIP_RESET	(0x81)</span>
<span class="cp">#define      CyFlushTransFIFO	(0x82)</span>
<span class="cm">/* Format 2 */</span>
<span class="cp">#define      CyCOR_CHANGE	(0x40)</span>
<span class="cp">#define      CyCOR1ch		(0x02)</span>
<span class="cp">#define      CyCOR2ch		(0x04)</span>
<span class="cp">#define      CyCOR3ch		(0x08)</span>
<span class="cm">/* Format 3 */</span>
<span class="cp">#define      CySEND_SPEC_1	(0x21)</span>
<span class="cp">#define      CySEND_SPEC_2	(0x22)</span>
<span class="cp">#define      CySEND_SPEC_3	(0x23)</span>
<span class="cp">#define      CySEND_SPEC_4	(0x24)</span>
<span class="cm">/* Format 4 */</span>
<span class="cp">#define      CyCHAN_CTL		(0x10)</span>
<span class="cp">#define      CyDIS_RCVR		(0x01)</span>
<span class="cp">#define      CyENB_RCVR		(0x02)</span>
<span class="cp">#define      CyDIS_XMTR		(0x04)</span>
<span class="cp">#define      CyENB_XMTR		(0x08)</span>
<span class="cp">#define CySRER		(0x06*2)</span>
<span class="cp">#define      CyMdmCh		(0x80)</span>
<span class="cp">#define      CyRxData		(0x10)</span>
<span class="cp">#define      CyTxRdy		(0x04)</span>
<span class="cp">#define      CyTxMpty		(0x02)</span>
<span class="cp">#define      CyNNDT		(0x01)</span>
<span class="cp">#define CyCOR1		(0x08*2)</span>
<span class="cp">#define      CyPARITY_NONE	(0x00)</span>
<span class="cp">#define      CyPARITY_0		(0x20)</span>
<span class="cp">#define      CyPARITY_1		(0xA0)</span>
<span class="cp">#define      CyPARITY_E		(0x40)</span>
<span class="cp">#define      CyPARITY_O		(0xC0)</span>
<span class="cp">#define      Cy_1_STOP		(0x00)</span>
<span class="cp">#define      Cy_1_5_STOP	(0x04)</span>
<span class="cp">#define      Cy_2_STOP		(0x08)</span>
<span class="cp">#define      Cy_5_BITS		(0x00)</span>
<span class="cp">#define      Cy_6_BITS		(0x01)</span>
<span class="cp">#define      Cy_7_BITS		(0x02)</span>
<span class="cp">#define      Cy_8_BITS		(0x03)</span>
<span class="cp">#define CyCOR2		(0x09*2)</span>
<span class="cp">#define      CyIXM		(0x80)</span>
<span class="cp">#define      CyTxIBE		(0x40)</span>
<span class="cp">#define      CyETC		(0x20)</span>
<span class="cp">#define      CyAUTO_TXFL	(0x60)</span>
<span class="cp">#define      CyLLM		(0x10)</span>
<span class="cp">#define      CyRLM		(0x08)</span>
<span class="cp">#define      CyRtsAO		(0x04)</span>
<span class="cp">#define      CyCtsAE		(0x02)</span>
<span class="cp">#define      CyDsrAE		(0x01)</span>
<span class="cp">#define CyCOR3		(0x0A*2)</span>
<span class="cp">#define      CySPL_CH_DRANGE	(0x80)  </span><span class="cm">/* special character detect range */</span><span class="cp"></span>
<span class="cp">#define      CySPL_CH_DET1	(0x40)  </span><span class="cm">/* enable special character detection</span>
<span class="cm">                                                               on SCHR4-SCHR3 */</span><span class="cp"></span>
<span class="cp">#define      CyFL_CTRL_TRNSP	(0x20)  </span><span class="cm">/* Flow Control Transparency */</span><span class="cp"></span>
<span class="cp">#define      CySPL_CH_DET2	(0x10)  </span><span class="cm">/* Enable special character detection</span>
<span class="cm">                                                               on SCHR2-SCHR1 */</span><span class="cp"></span>
<span class="cp">#define      CyREC_FIFO		(0x0F)  </span><span class="cm">/* Receive FIFO threshold */</span><span class="cp"></span>
<span class="cp">#define CyCOR4		(0x1E*2)</span>
<span class="cp">#define CyCOR5		(0x1F*2)</span>
<span class="cp">#define CyCCSR		(0x0B*2)</span>
<span class="cp">#define      CyRxEN		(0x80)</span>
<span class="cp">#define      CyRxFloff		(0x40)</span>
<span class="cp">#define      CyRxFlon		(0x20)</span>
<span class="cp">#define      CyTxEN		(0x08)</span>
<span class="cp">#define      CyTxFloff		(0x04)</span>
<span class="cp">#define      CyTxFlon		(0x02)</span>
<span class="cp">#define CyRDCR		(0x0E*2)</span>
<span class="cp">#define CySCHR1		(0x1A*2)</span>
<span class="cp">#define CySCHR2 	(0x1B*2)</span>
<span class="cp">#define CySCHR3		(0x1C*2)</span>
<span class="cp">#define CySCHR4		(0x1D*2)</span>
<span class="cp">#define CySCRL		(0x22*2)</span>
<span class="cp">#define CySCRH		(0x23*2)</span>
<span class="cp">#define CyLNC		(0x24*2)</span>
<span class="cp">#define CyMCOR1 	(0x15*2)</span>
<span class="cp">#define CyMCOR2		(0x16*2)</span>
<span class="cp">#define CyRTPR		(0x21*2)</span>
<span class="cp">#define CyMSVR1		(0x6C*2)</span>
<span class="cp">#define CyMSVR2		(0x6D*2)</span>
<span class="cp">#define      CyANY_DELTA	(0xF0)</span>
<span class="cp">#define      CyDSR		(0x80)</span>
<span class="cp">#define      CyCTS		(0x40)</span>
<span class="cp">#define      CyRI		(0x20)</span>
<span class="cp">#define      CyDCD		(0x10)</span>
<span class="cp">#define      CyDTR              (0x02)</span>
<span class="cp">#define      CyRTS              (0x01)</span>
<span class="cp">#define CyPVSR		(0x6F*2)</span>
<span class="cp">#define CyRBPR		(0x78*2)</span>
<span class="cp">#define CyRCOR		(0x7C*2)</span>
<span class="cp">#define CyTBPR		(0x72*2)</span>
<span class="cp">#define CyTCOR		(0x76*2)</span>

<span class="cm">/* Custom Registers */</span>

<span class="cp">#define	CyPLX_VER	(0x3400)</span>
<span class="cp">#define	PLX_9050	0x0b</span>
<span class="cp">#define	PLX_9060	0x0c</span>
<span class="cp">#define	PLX_9080	0x0d</span>

<span class="cm">/***************************************************************************/</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* _LINUX_CYCLADES_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
