<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › scc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>scc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $Id: scc.h,v 1.29 1997/04/02 14:56:45 jreuter Exp jreuter $ */</span>

<span class="cp">#ifndef	_SCC_H</span>
<span class="cp">#define	_SCC_H</span>


<span class="cm">/* selection of hardware types */</span>

<span class="cp">#define PA0HZP		0x00	</span><span class="cm">/* hardware type for PA0HZP SCC card and compatible */</span><span class="cp"></span>
<span class="cp">#define EAGLE		0x01    </span><span class="cm">/* hardware type for EAGLE card */</span><span class="cp"></span>
<span class="cp">#define PC100		0x02	</span><span class="cm">/* hardware type for PC100 card */</span><span class="cp"></span>
<span class="cp">#define PRIMUS		0x04	</span><span class="cm">/* hardware type for PRIMUS-PC (DG9BL) card */</span><span class="cp"></span>
<span class="cp">#define DRSI		0x08	</span><span class="cm">/* hardware type for DRSI PC*Packet card */</span><span class="cp"></span>
<span class="cp">#define BAYCOM		0x10	</span><span class="cm">/* hardware type for BayCom (U)SCC */</span><span class="cp"></span>

<span class="cm">/* DEV ioctl() commands */</span>

<span class="k">enum</span> <span class="n">SCC_ioctl_cmds</span> <span class="p">{</span>
	<span class="n">SIOCSCCRESERVED</span> <span class="o">=</span> <span class="n">SIOCDEVPRIVATE</span><span class="p">,</span>
	<span class="n">SIOCSCCCFG</span><span class="p">,</span>
	<span class="n">SIOCSCCINI</span><span class="p">,</span>
	<span class="n">SIOCSCCCHANINI</span><span class="p">,</span>
	<span class="n">SIOCSCCSMEM</span><span class="p">,</span>
	<span class="n">SIOCSCCGKISS</span><span class="p">,</span>
	<span class="n">SIOCSCCSKISS</span><span class="p">,</span>
	<span class="n">SIOCSCCGSTAT</span><span class="p">,</span>
	<span class="n">SIOCSCCCAL</span>
<span class="p">};</span>

<span class="cm">/* Device parameter control (from WAMPES) */</span>

<span class="k">enum</span> <span class="n">L1_params</span> <span class="p">{</span>
	<span class="n">PARAM_DATA</span><span class="p">,</span>
	<span class="n">PARAM_TXDELAY</span><span class="p">,</span>
	<span class="n">PARAM_PERSIST</span><span class="p">,</span>
	<span class="n">PARAM_SLOTTIME</span><span class="p">,</span>
	<span class="n">PARAM_TXTAIL</span><span class="p">,</span>
	<span class="n">PARAM_FULLDUP</span><span class="p">,</span>
	<span class="n">PARAM_SOFTDCD</span><span class="p">,</span>		<span class="cm">/* was: PARAM_HW */</span>
	<span class="n">PARAM_MUTE</span><span class="p">,</span>		<span class="cm">/* ??? */</span>
	<span class="n">PARAM_DTR</span><span class="p">,</span>
	<span class="n">PARAM_RTS</span><span class="p">,</span>
	<span class="n">PARAM_SPEED</span><span class="p">,</span>
	<span class="n">PARAM_ENDDELAY</span><span class="p">,</span>		<span class="cm">/* ??? */</span>
	<span class="n">PARAM_GROUP</span><span class="p">,</span>
	<span class="n">PARAM_IDLE</span><span class="p">,</span>
	<span class="n">PARAM_MIN</span><span class="p">,</span>
	<span class="n">PARAM_MAXKEY</span><span class="p">,</span>
	<span class="n">PARAM_WAIT</span><span class="p">,</span>
	<span class="n">PARAM_MAXDEFER</span><span class="p">,</span>
	<span class="n">PARAM_TX</span><span class="p">,</span>
	<span class="n">PARAM_HWEVENT</span> <span class="o">=</span> <span class="mi">31</span><span class="p">,</span>
	<span class="n">PARAM_RETURN</span> <span class="o">=</span> <span class="mi">255</span>	<span class="cm">/* reset kiss mode */</span>
<span class="p">};</span>

<span class="cm">/* fulldup parameter */</span>

<span class="k">enum</span> <span class="n">FULLDUP_modes</span> <span class="p">{</span>
	<span class="n">KISS_DUPLEX_HALF</span><span class="p">,</span>	<span class="cm">/* normal CSMA operation */</span>
	<span class="n">KISS_DUPLEX_FULL</span><span class="p">,</span>	<span class="cm">/* fullduplex, key down trx after transmission */</span>
	<span class="n">KISS_DUPLEX_LINK</span><span class="p">,</span>	<span class="cm">/* fullduplex, key down trx after &#39;idletime&#39; sec */</span>
	<span class="n">KISS_DUPLEX_OPTIMA</span>	<span class="cm">/* fullduplex, let the protocol layer control the hw */</span>
<span class="p">};</span>

<span class="cm">/* misc. parameters */</span>

<span class="cp">#define TIMER_OFF	65535U	</span><span class="cm">/* to switch off timers */</span><span class="cp"></span>
<span class="cp">#define NO_SUCH_PARAM	65534U	</span><span class="cm">/* param not implemented */</span><span class="cp"></span>

<span class="cm">/* HWEVENT parameter */</span>

<span class="k">enum</span> <span class="n">HWEVENT_opts</span> <span class="p">{</span>
	<span class="n">HWEV_DCD_ON</span><span class="p">,</span>
	<span class="n">HWEV_DCD_OFF</span><span class="p">,</span>
	<span class="n">HWEV_ALL_SENT</span>
<span class="p">};</span>

<span class="cm">/* channel grouping */</span>

<span class="cp">#define RXGROUP		0100	</span><span class="cm">/* if set, only tx when all channels clear */</span><span class="cp"></span>
<span class="cp">#define TXGROUP		0200	</span><span class="cm">/* if set, don&#39;t transmit simultaneously */</span><span class="cp"></span>

<span class="cm">/* Tx/Rx clock sources */</span>

<span class="k">enum</span> <span class="n">CLOCK_sources</span> <span class="p">{</span>
	<span class="n">CLK_DPLL</span><span class="p">,</span>	<span class="cm">/* normal halfduplex operation */</span>
	<span class="n">CLK_EXTERNAL</span><span class="p">,</span>	<span class="cm">/* external clocking (G3RUH/DF9IC modems) */</span>
	<span class="n">CLK_DIVIDER</span><span class="p">,</span>	<span class="cm">/* Rx = DPLL, Tx = divider (fullduplex with */</span>
			<span class="cm">/* modems without clock regeneration */</span>
	<span class="n">CLK_BRG</span>		<span class="cm">/* experimental fullduplex mode with DPLL/BRG for */</span>
			<span class="cm">/* MODEMs without clock recovery */</span>
<span class="p">};</span>

<span class="cm">/* Tx state */</span>

<span class="k">enum</span> <span class="n">TX_state</span> <span class="p">{</span>
	<span class="n">TXS_IDLE</span><span class="p">,</span>	<span class="cm">/* Transmitter off, no data pending */</span>
	<span class="n">TXS_BUSY</span><span class="p">,</span>	<span class="cm">/* waiting for permission to send / tailtime */</span>
	<span class="n">TXS_ACTIVE</span><span class="p">,</span>	<span class="cm">/* Transmitter on, sending data */</span>
	<span class="n">TXS_NEWFRAME</span><span class="p">,</span>	<span class="cm">/* reset CRC and send (next) frame */</span>
	<span class="n">TXS_IDLE2</span><span class="p">,</span>	<span class="cm">/* Transmitter on, no data pending */</span>
	<span class="n">TXS_WAIT</span><span class="p">,</span>	<span class="cm">/* Waiting for Mintime to expire */</span>
	<span class="n">TXS_TIMEOUT</span>	<span class="cm">/* We had a transmission timeout */</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">io_port</span><span class="p">;</span>	<span class="cm">/* type definition for an &#39;io port address&#39; */</span>

<span class="cm">/* SCC statistical information */</span>

<span class="k">struct</span> <span class="n">scc_stat</span> <span class="p">{</span>
        <span class="kt">long</span> <span class="n">rxints</span><span class="p">;</span>            <span class="cm">/* Receiver interrupts */</span>
        <span class="kt">long</span> <span class="n">txints</span><span class="p">;</span>            <span class="cm">/* Transmitter interrupts */</span>
        <span class="kt">long</span> <span class="n">exints</span><span class="p">;</span>            <span class="cm">/* External/status interrupts */</span>
        <span class="kt">long</span> <span class="n">spints</span><span class="p">;</span>            <span class="cm">/* Special receiver interrupts */</span>

        <span class="kt">long</span> <span class="n">txframes</span><span class="p">;</span>          <span class="cm">/* Packets sent */</span>
        <span class="kt">long</span> <span class="n">rxframes</span><span class="p">;</span>          <span class="cm">/* Number of Frames Actually Received */</span>
        <span class="kt">long</span> <span class="n">rxerrs</span><span class="p">;</span>            <span class="cm">/* CRC Errors */</span>
        <span class="kt">long</span> <span class="n">txerrs</span><span class="p">;</span>		<span class="cm">/* KISS errors */</span>
        
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nospace</span><span class="p">;</span>	<span class="cm">/* &quot;Out of buffers&quot; */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_over</span><span class="p">;</span>	<span class="cm">/* Receiver Overruns */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_under</span><span class="p">;</span>	<span class="cm">/* Transmitter Underruns */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_state</span><span class="p">;</span>	<span class="cm">/* Transmitter state */</span>
	<span class="kt">int</span> <span class="n">tx_queued</span><span class="p">;</span>		<span class="cm">/* tx frames enqueued */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">maxqueue</span><span class="p">;</span>	<span class="cm">/* allocated tx_buffers */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bufsize</span><span class="p">;</span>	<span class="cm">/* used buffersize */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">scc_modem</span> <span class="p">{</span>
	<span class="kt">long</span> <span class="n">speed</span><span class="p">;</span>		<span class="cm">/* Line speed, bps */</span>
	<span class="kt">char</span> <span class="n">clocksrc</span><span class="p">;</span>		<span class="cm">/* 0 = DPLL, 1 = external, 2 = divider */</span>
	<span class="kt">char</span> <span class="n">nrz</span><span class="p">;</span>		<span class="cm">/* NRZ instead of NRZI */</span>	
<span class="p">};</span>

<span class="k">struct</span> <span class="n">scc_kiss_cmd</span> <span class="p">{</span>
	<span class="kt">int</span>  	 <span class="n">command</span><span class="p">;</span>	<span class="cm">/* one of the KISS-Commands defined above */</span>
	<span class="kt">unsigned</span> <span class="n">param</span><span class="p">;</span>		<span class="cm">/* KISS-Param */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">scc_hw_config</span> <span class="p">{</span>
	<span class="n">io_port</span> <span class="n">data_a</span><span class="p">;</span>		<span class="cm">/* data port channel A */</span>
	<span class="n">io_port</span> <span class="n">ctrl_a</span><span class="p">;</span>		<span class="cm">/* control port channel A */</span>
	<span class="n">io_port</span> <span class="n">data_b</span><span class="p">;</span>		<span class="cm">/* data port channel B */</span>
	<span class="n">io_port</span> <span class="n">ctrl_b</span><span class="p">;</span>		<span class="cm">/* control port channel B */</span>
	<span class="n">io_port</span> <span class="n">vector_latch</span><span class="p">;</span>	<span class="cm">/* INTACK-Latch (#) */</span>
	<span class="n">io_port</span>	<span class="n">special</span><span class="p">;</span>	<span class="cm">/* special function port */</span>

	<span class="kt">int</span>	<span class="n">irq</span><span class="p">;</span>		<span class="cm">/* irq */</span>
	<span class="kt">long</span>	<span class="n">clock</span><span class="p">;</span>		<span class="cm">/* clock */</span>
	<span class="kt">char</span>	<span class="n">option</span><span class="p">;</span>		<span class="cm">/* command for function port */</span>

	<span class="kt">char</span> <span class="n">brand</span><span class="p">;</span>		<span class="cm">/* hardware type */</span>
	<span class="kt">char</span> <span class="n">escc</span><span class="p">;</span>		<span class="cm">/* use ext. features of a 8580/85180/85280 */</span>
<span class="p">};</span>

<span class="cm">/* (#) only one INTACK latch allowed. */</span>


<span class="k">struct</span> <span class="n">scc_mem_config</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dummy</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bufsize</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">scc_calibrate</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">time</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pattern</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="k">enum</span> <span class="p">{</span><span class="n">TX_OFF</span><span class="p">,</span> <span class="n">TX_ON</span><span class="p">};</span>	<span class="cm">/* command for scc_key_trx() */</span>

<span class="cm">/* Vector masks in RR2B */</span>

<span class="cp">#define VECTOR_MASK	0x06</span>
<span class="cp">#define TXINT		0x00</span>
<span class="cp">#define EXINT		0x02</span>
<span class="cp">#define RXINT		0x04</span>
<span class="cp">#define SPINT		0x06</span>

<span class="cp">#ifdef CONFIG_SCC_DELAY</span>
<span class="cp">#define Inb(port)	inb_p(port)</span>
<span class="cp">#define Outb(port, val)	outb_p(val, port)</span>
<span class="cp">#else</span>
<span class="cp">#define Inb(port)	inb(port)</span>
<span class="cp">#define Outb(port, val)	outb(val, port)</span>
<span class="cp">#endif</span>

<span class="cm">/* SCC channel control structure for KISS */</span>

<span class="k">struct</span> <span class="n">scc_kiss</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">txdelay</span><span class="p">;</span>		<span class="cm">/* Transmit Delay 10 ms/cnt */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">persist</span><span class="p">;</span>		<span class="cm">/* Persistence (0-255) as a % */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">slottime</span><span class="p">;</span>		<span class="cm">/* Delay to wait on persistence hit */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">tailtime</span><span class="p">;</span>		<span class="cm">/* Delay after last byte written */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">fulldup</span><span class="p">;</span>		<span class="cm">/* Full Duplex mode 0=CSMA 1=DUP 2=ALWAYS KEYED */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">waittime</span><span class="p">;</span>		<span class="cm">/* Waittime before any transmit attempt */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">maxkeyup</span><span class="p">;</span>		<span class="cm">/* Maximum time to transmit (seconds) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">mintime</span><span class="p">;</span>		<span class="cm">/* Minimal offtime after MAXKEYUP timeout (seconds) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">idletime</span><span class="p">;</span>		<span class="cm">/* Maximum idle time in ALWAYS KEYED mode (seconds) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">maxdefer</span><span class="p">;</span>		<span class="cm">/* Timer for CSMA channel busy limit */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">tx_inhibit</span><span class="p">;</span>	<span class="cm">/* Transmit is not allowed when set */</span>	
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">group</span><span class="p">;</span>		<span class="cm">/* Group ID for AX.25 TX interlocking */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">mode</span><span class="p">;</span>		<span class="cm">/* &#39;normal&#39; or &#39;hwctrl&#39; mode (unused) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">softdcd</span><span class="p">;</span>		<span class="cm">/* Use DPLL instead of DCD pin for carrier detect */</span>
<span class="p">};</span>


<span class="cm">/* SCC channel structure */</span>

<span class="k">struct</span> <span class="n">scc_channel</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">init</span><span class="p">;</span>			<span class="cm">/* channel exists? */</span>

	<span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>		<span class="cm">/* link to device control structure */</span>
	<span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">dev_stat</span><span class="p">;</span><span class="cm">/* device statistics */</span>

	<span class="kt">char</span> <span class="n">brand</span><span class="p">;</span>			<span class="cm">/* manufacturer of the board */</span>
	<span class="kt">long</span> <span class="n">clock</span><span class="p">;</span>			<span class="cm">/* used clock */</span>

	<span class="n">io_port</span> <span class="n">ctrl</span><span class="p">;</span>			<span class="cm">/* I/O address of CONTROL register */</span>
	<span class="n">io_port</span>	<span class="n">data</span><span class="p">;</span>			<span class="cm">/* I/O address of DATA register */</span>
	<span class="n">io_port</span> <span class="n">special</span><span class="p">;</span>		<span class="cm">/* I/O address of special function port */</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>			<span class="cm">/* Number of Interrupt */</span>

	<span class="kt">char</span> <span class="n">option</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">enhanced</span><span class="p">;</span>			<span class="cm">/* Enhanced SCC support */</span>

	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">wreg</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> 	<span class="cm">/* Copy of last written value in WRx */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">status</span><span class="p">;</span>		<span class="cm">/* Copy of R0 at last external interrupt */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">dcd</span><span class="p">;</span>		<span class="cm">/* DCD status */</span>

        <span class="k">struct</span> <span class="n">scc_kiss</span> <span class="n">kiss</span><span class="p">;</span>		<span class="cm">/* control structure for KISS params */</span>
        <span class="k">struct</span> <span class="n">scc_stat</span> <span class="n">stat</span><span class="p">;</span>		<span class="cm">/* statistical information */</span>
        <span class="k">struct</span> <span class="n">scc_modem</span> <span class="n">modem</span><span class="p">;</span> 	<span class="cm">/* modem information */</span>

        <span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">tx_queue</span><span class="p">;</span>	<span class="cm">/* next tx buffer */</span>
        <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">rx_buff</span><span class="p">;</span>	<span class="cm">/* pointer to frame currently received */</span>
        <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">tx_buff</span><span class="p">;</span>	<span class="cm">/* pointer to frame currently transmitted */</span>

	<span class="cm">/* Timer */</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">tx_t</span><span class="p">;</span>		<span class="cm">/* tx timer for this channel */</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">tx_wdog</span><span class="p">;</span>	<span class="cm">/* tx watchdogs */</span>
	
	<span class="cm">/* Channel lock */</span>
	<span class="n">spinlock_t</span>	<span class="n">lock</span><span class="p">;</span>		<span class="cm">/* Channel guard lock */</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="cm">/* defined(__KERNEL__) */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* defined(_SCC_H) */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
