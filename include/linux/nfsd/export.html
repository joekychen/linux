<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › nfsd › export.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>export.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * include/linux/nfsd/export.h</span>
<span class="cm"> * </span>
<span class="cm"> * Public declarations for NFS exports. The definitions for the</span>
<span class="cm"> * syscall interface are in nfsctl.h</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1995-1997 Olaf Kirch &lt;okir@monad.swb.de&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef NFSD_EXPORT_H</span>
<span class="cp">#define NFSD_EXPORT_H</span>

<span class="cp"># include &lt;linux/types.h&gt;</span>
<span class="cp">#ifdef __KERNEL__</span>
<span class="cp"># include &lt;linux/nfsd/nfsfh.h&gt;</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Important limits for the exports stuff.</span>
<span class="cm"> */</span>
<span class="cp">#define NFSCLNT_IDMAX		1024</span>
<span class="cp">#define NFSCLNT_ADDRMAX		16</span>
<span class="cp">#define NFSCLNT_KEYMAX		32</span>

<span class="cm">/*</span>
<span class="cm"> * Export flags.</span>
<span class="cm"> */</span>
<span class="cp">#define NFSEXP_READONLY		0x0001</span>
<span class="cp">#define NFSEXP_INSECURE_PORT	0x0002</span>
<span class="cp">#define NFSEXP_ROOTSQUASH	0x0004</span>
<span class="cp">#define NFSEXP_ALLSQUASH	0x0008</span>
<span class="cp">#define NFSEXP_ASYNC		0x0010</span>
<span class="cp">#define NFSEXP_GATHERED_WRITES	0x0020</span>
<span class="cm">/* 40 80 100 currently unused */</span>
<span class="cp">#define NFSEXP_NOHIDE		0x0200</span>
<span class="cp">#define NFSEXP_NOSUBTREECHECK	0x0400</span>
<span class="cp">#define	NFSEXP_NOAUTHNLM	0x0800		</span><span class="cm">/* Don&#39;t authenticate NLM requests - just trust */</span><span class="cp"></span>
<span class="cp">#define NFSEXP_MSNFS		0x1000	</span><span class="cm">/* do silly things that MS clients expect; no longer supported */</span><span class="cp"></span>
<span class="cp">#define NFSEXP_FSID		0x2000</span>
<span class="cp">#define	NFSEXP_CROSSMOUNT	0x4000</span>
<span class="cp">#define	NFSEXP_NOACL		0x8000	</span><span class="cm">/* reserved for possible ACL related use */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm"> * The NFSEXP_V4ROOT flag causes the kernel to give access only to NFSv4</span>
<span class="cm"> * clients, and only to the single directory that is the root of the</span>
<span class="cm"> * export; further lookup and readdir operations are treated as if every</span>
<span class="cm"> * subdirectory was a mountpoint, and ignored if they are not themselves</span>
<span class="cm"> * exported.  This is used by nfsd and mountd to construct the NFSv4</span>
<span class="cm"> * pseudofilesystem, which provides access only to paths leading to each</span>
<span class="cm"> * exported filesystem.</span>
<span class="cm"> */</span>
<span class="cp">#define	NFSEXP_V4ROOT		0x10000</span>
<span class="cm">/* All flags that we claim to support.  (Note we don&#39;t support NOACL.) */</span>
<span class="cp">#define NFSEXP_ALLFLAGS		0x17E3F</span>

<span class="cm">/* The flags that may vary depending on security flavor: */</span>
<span class="cp">#define NFSEXP_SECINFO_FLAGS	(NFSEXP_READONLY | NFSEXP_ROOTSQUASH \</span>
<span class="cp">					| NFSEXP_ALLSQUASH \</span>
<span class="cp">					| NFSEXP_INSECURE_PORT)</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/*</span>
<span class="cm"> * FS Locations</span>
<span class="cm"> */</span>

<span class="cp">#define MAX_FS_LOCATIONS	128</span>

<span class="k">struct</span> <span class="n">nfsd4_fs_location</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">hosts</span><span class="p">;</span> <span class="cm">/* colon separated list of hosts */</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">;</span>  <span class="cm">/* slash separated list of path components */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_fs_locations</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">locations_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfsd4_fs_location</span> <span class="o">*</span><span class="n">locations</span><span class="p">;</span>
<span class="cm">/* If we&#39;re not actually serving this data ourselves (only providing a</span>
<span class="cm"> * list of replicas that do serve it) then we set &quot;migrated&quot;: */</span>
	<span class="kt">int</span> <span class="n">migrated</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * We keep an array of pseudoflavors with the export, in order from most</span>
<span class="cm"> * to least preferred.  For the foreseeable future, we don&#39;t expect more</span>
<span class="cm"> * than the eight pseudoflavors null, unix, krb5, krb5i, krb5p, skpm3,</span>
<span class="cm"> * spkm3i, and spkm3p (and using all 8 at once should be rare).</span>
<span class="cm"> */</span>
<span class="cp">#define MAX_SECINFO_LIST	8</span>

<span class="k">struct</span> <span class="n">exp_flavor_info</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">pseudoflavor</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">svc_export</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cache_head</span>	<span class="n">h</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auth_domain</span> <span class="o">*</span>	<span class="n">ex_client</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">ex_flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">path</span>		<span class="n">ex_path</span><span class="p">;</span>
	<span class="n">uid_t</span>			<span class="n">ex_anon_uid</span><span class="p">;</span>
	<span class="n">gid_t</span>			<span class="n">ex_anon_gid</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">ex_fsid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>		<span class="n">ex_uuid</span><span class="p">;</span> <span class="cm">/* 16 byte fsid */</span>
	<span class="k">struct</span> <span class="n">nfsd4_fs_locations</span> <span class="n">ex_fslocs</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">ex_nflavors</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">exp_flavor_info</span>	<span class="n">ex_flavors</span><span class="p">[</span><span class="n">MAX_SECINFO_LIST</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">cache_detail</span>	<span class="o">*</span><span class="n">cd</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* an &quot;export key&quot; (expkey) maps a filehandlefragement to an</span>
<span class="cm"> * svc_export for a given client.  There can be several per export,</span>
<span class="cm"> * for the different fsid types.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">svc_expkey</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cache_head</span>	<span class="n">h</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">auth_domain</span> <span class="o">*</span>	<span class="n">ek_client</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">ek_fsidtype</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">ek_fsid</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">path</span>		<span class="n">ek_path</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define EX_ISSYNC(exp)		(!((exp)-&gt;ex_flags &amp; NFSEXP_ASYNC))</span>
<span class="cp">#define EX_NOHIDE(exp)		((exp)-&gt;ex_flags &amp; NFSEXP_NOHIDE)</span>
<span class="cp">#define EX_WGATHER(exp)		((exp)-&gt;ex_flags &amp; NFSEXP_GATHERED_WRITES)</span>

<span class="kt">int</span> <span class="n">nfsexp_flags</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span><span class="n">exp</span><span class="p">);</span>
<span class="n">__be32</span> <span class="n">check_nfsd_access</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span><span class="n">exp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Function declarations</span>
<span class="cm"> */</span>
<span class="kt">int</span>			<span class="n">nfsd_export_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>			<span class="n">nfsd_export_shutdown</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>			<span class="n">nfsd_export_flush</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span>	<span class="n">rqst_exp_get_by_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span>	<span class="n">rqst_exp_parent</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span>	<span class="n">rqst_find_fsidzero_export</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span>			<span class="n">exp_rootfh</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">auth_domain</span> <span class="o">*</span><span class="p">,</span>
					<span class="kt">char</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="k">struct</span> <span class="n">knfsd_fh</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="n">maxsize</span><span class="p">);</span>
<span class="n">__be32</span>			<span class="n">exp_pseudoroot</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">svc_fh</span> <span class="o">*</span><span class="p">);</span>
<span class="n">__be32</span>			<span class="n">nfserrno</span><span class="p">(</span><span class="kt">int</span> <span class="n">errno</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">exp_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span><span class="n">exp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">cache_put</span><span class="p">(</span><span class="o">&amp;</span><span class="n">exp</span><span class="o">-&gt;</span><span class="n">h</span><span class="p">,</span> <span class="n">exp</span><span class="o">-&gt;</span><span class="n">cd</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">exp_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span><span class="n">exp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">cache_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">exp</span><span class="o">-&gt;</span><span class="n">h</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span> <span class="n">rqst_exp_find</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* NFSD_EXPORT_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
