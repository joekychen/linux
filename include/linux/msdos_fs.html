<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › msdos_fs.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>msdos_fs.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _LINUX_MSDOS_FS_H</span>
<span class="cp">#define _LINUX_MSDOS_FS_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/magic.h&gt;</span>
<span class="cp">#include &lt;asm/byteorder.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * The MS-DOS filesystem constants/structures</span>
<span class="cm"> */</span>

<span class="cp">#define SECTOR_SIZE	512		</span><span class="cm">/* sector size (bytes) */</span><span class="cp"></span>
<span class="cp">#define SECTOR_BITS	9		</span><span class="cm">/* log2(SECTOR_SIZE) */</span><span class="cp"></span>
<span class="cp">#define MSDOS_DPB	(MSDOS_DPS)	</span><span class="cm">/* dir entries per block */</span><span class="cp"></span>
<span class="cp">#define MSDOS_DPB_BITS	4		</span><span class="cm">/* log2(MSDOS_DPB) */</span><span class="cp"></span>
<span class="cp">#define MSDOS_DPS	(SECTOR_SIZE / sizeof(struct msdos_dir_entry))</span>
<span class="cp">#define MSDOS_DPS_BITS	4		</span><span class="cm">/* log2(MSDOS_DPS) */</span><span class="cp"></span>
<span class="cp">#define MSDOS_LONGNAME	256		</span><span class="cm">/* maximum name length */</span><span class="cp"></span>
<span class="cp">#define CF_LE_W(v)	le16_to_cpu(v)</span>
<span class="cp">#define CF_LE_L(v)	le32_to_cpu(v)</span>
<span class="cp">#define CT_LE_W(v)	cpu_to_le16(v)</span>
<span class="cp">#define CT_LE_L(v)	cpu_to_le32(v)</span>

<span class="cp">#define MSDOS_ROOT_INO	 1	</span><span class="cm">/* The root inode number */</span><span class="cp"></span>
<span class="cp">#define MSDOS_FSINFO_INO 2	</span><span class="cm">/* Used for managing the FSINFO block */</span><span class="cp"></span>

<span class="cp">#define MSDOS_DIR_BITS	5	</span><span class="cm">/* log2(sizeof(struct msdos_dir_entry)) */</span><span class="cp"></span>

<span class="cm">/* directory limit */</span>
<span class="cp">#define FAT_MAX_DIR_ENTRIES	(65536)</span>
<span class="cp">#define FAT_MAX_DIR_SIZE	(FAT_MAX_DIR_ENTRIES &lt;&lt; MSDOS_DIR_BITS)</span>

<span class="cp">#define ATTR_NONE	0	</span><span class="cm">/* no attribute bits */</span><span class="cp"></span>
<span class="cp">#define ATTR_RO		1	</span><span class="cm">/* read-only */</span><span class="cp"></span>
<span class="cp">#define ATTR_HIDDEN	2	</span><span class="cm">/* hidden */</span><span class="cp"></span>
<span class="cp">#define ATTR_SYS	4	</span><span class="cm">/* system */</span><span class="cp"></span>
<span class="cp">#define ATTR_VOLUME	8	</span><span class="cm">/* volume label */</span><span class="cp"></span>
<span class="cp">#define ATTR_DIR	16	</span><span class="cm">/* directory */</span><span class="cp"></span>
<span class="cp">#define ATTR_ARCH	32	</span><span class="cm">/* archived */</span><span class="cp"></span>

<span class="cm">/* attribute bits that are copied &quot;as is&quot; */</span>
<span class="cp">#define ATTR_UNUSED	(ATTR_VOLUME | ATTR_ARCH | ATTR_SYS | ATTR_HIDDEN)</span>
<span class="cm">/* bits that are used by the Windows 95/Windows NT extended FAT */</span>
<span class="cp">#define ATTR_EXT	(ATTR_RO | ATTR_HIDDEN | ATTR_SYS | ATTR_VOLUME)</span>

<span class="cp">#define CASE_LOWER_BASE	8	</span><span class="cm">/* base is lower case */</span><span class="cp"></span>
<span class="cp">#define CASE_LOWER_EXT	16	</span><span class="cm">/* extension is lower case */</span><span class="cp"></span>

<span class="cp">#define DELETED_FLAG	0xe5	</span><span class="cm">/* marks file as deleted when in name[0] */</span><span class="cp"></span>
<span class="cp">#define IS_FREE(n)	(!*(n) || *(n) == DELETED_FLAG)</span>

<span class="cp">#define FAT_LFN_LEN	255	</span><span class="cm">/* maximum long name length */</span><span class="cp"></span>
<span class="cp">#define MSDOS_NAME	11	</span><span class="cm">/* maximum name length */</span><span class="cp"></span>
<span class="cp">#define MSDOS_SLOTS	21	</span><span class="cm">/* max # of slots for short and long names */</span><span class="cp"></span>
<span class="cp">#define MSDOS_DOT	&quot;.          &quot;	</span><span class="cm">/* &quot;.&quot;, padded to MSDOS_NAME chars */</span><span class="cp"></span>
<span class="cp">#define MSDOS_DOTDOT	&quot;..         &quot;	</span><span class="cm">/* &quot;..&quot;, padded to MSDOS_NAME chars */</span><span class="cp"></span>

<span class="cp">#define FAT_FIRST_ENT(s, x)	((MSDOS_SB(s)-&gt;fat_bits == 32 ? 0x0FFFFF00 : \</span>
<span class="cp">	MSDOS_SB(s)-&gt;fat_bits == 16 ? 0xFF00 : 0xF00) | (x))</span>

<span class="cm">/* start of data cluster&#39;s entry (number of reserved clusters) */</span>
<span class="cp">#define FAT_START_ENT	2</span>

<span class="cm">/* maximum number of clusters */</span>
<span class="cp">#define MAX_FAT12	0xFF4</span>
<span class="cp">#define MAX_FAT16	0xFFF4</span>
<span class="cp">#define MAX_FAT32	0x0FFFFFF6</span>
<span class="cp">#define MAX_FAT(s)	(MSDOS_SB(s)-&gt;fat_bits == 32 ? MAX_FAT32 : \</span>
<span class="cp">	MSDOS_SB(s)-&gt;fat_bits == 16 ? MAX_FAT16 : MAX_FAT12)</span>

<span class="cm">/* bad cluster mark */</span>
<span class="cp">#define BAD_FAT12	0xFF7</span>
<span class="cp">#define BAD_FAT16	0xFFF7</span>
<span class="cp">#define BAD_FAT32	0x0FFFFFF7</span>

<span class="cm">/* standard EOF */</span>
<span class="cp">#define EOF_FAT12	0xFFF</span>
<span class="cp">#define EOF_FAT16	0xFFFF</span>
<span class="cp">#define EOF_FAT32	0x0FFFFFFF</span>

<span class="cp">#define FAT_ENT_FREE	(0)</span>
<span class="cp">#define FAT_ENT_BAD	(BAD_FAT32)</span>
<span class="cp">#define FAT_ENT_EOF	(EOF_FAT32)</span>

<span class="cp">#define FAT_FSINFO_SIG1	0x41615252</span>
<span class="cp">#define FAT_FSINFO_SIG2	0x61417272</span>
<span class="cp">#define IS_FSINFO(x)	(le32_to_cpu((x)-&gt;signature1) == FAT_FSINFO_SIG1 \</span>
<span class="cp">			 &amp;&amp; le32_to_cpu((x)-&gt;signature2) == FAT_FSINFO_SIG2)</span>

<span class="k">struct</span> <span class="n">__fat_dirent</span> <span class="p">{</span>
	<span class="kt">long</span>		<span class="n">d_ino</span><span class="p">;</span>
	<span class="n">__kernel_off_t</span>	<span class="n">d_off</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">d_reclen</span><span class="p">;</span>
	<span class="kt">char</span>		<span class="n">d_name</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span> <span class="cm">/* We must not include limits.h! */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * ioctl commands</span>
<span class="cm"> */</span>
<span class="cp">#define VFAT_IOCTL_READDIR_BOTH		_IOR(&#39;r&#39;, 1, struct __fat_dirent[2])</span>
<span class="cp">#define VFAT_IOCTL_READDIR_SHORT	_IOR(&#39;r&#39;, 2, struct __fat_dirent[2])</span>
<span class="cm">/* &lt;linux/videotext.h&gt; has used 0x72 (&#39;r&#39;) in collision, so skip a few */</span>
<span class="cp">#define FAT_IOCTL_GET_ATTRIBUTES	_IOR(&#39;r&#39;, 0x10, __u32)</span>
<span class="cp">#define FAT_IOCTL_SET_ATTRIBUTES	_IOW(&#39;r&#39;, 0x11, __u32)</span>

<span class="k">struct</span> <span class="n">fat_boot_sector</span> <span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">ignored</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>	<span class="cm">/* Boot strap short or near jump */</span>
	<span class="n">__u8</span>	<span class="n">system_id</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>	<span class="cm">/* Name - can be used to special case</span>
<span class="cm">				   partition manager volumes */</span>
	<span class="n">__u8</span>	<span class="n">sector_size</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* bytes per logical sector */</span>
	<span class="n">__u8</span>	<span class="n">sec_per_clus</span><span class="p">;</span>	<span class="cm">/* sectors/cluster */</span>
	<span class="n">__le16</span>	<span class="n">reserved</span><span class="p">;</span>	<span class="cm">/* reserved sectors */</span>
	<span class="n">__u8</span>	<span class="n">fats</span><span class="p">;</span>		<span class="cm">/* number of FATs */</span>
	<span class="n">__u8</span>	<span class="n">dir_entries</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* root directory entries */</span>
	<span class="n">__u8</span>	<span class="n">sectors</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* number of sectors */</span>
	<span class="n">__u8</span>	<span class="n">media</span><span class="p">;</span>		<span class="cm">/* media code */</span>
	<span class="n">__le16</span>	<span class="n">fat_length</span><span class="p">;</span>	<span class="cm">/* sectors/FAT */</span>
	<span class="n">__le16</span>	<span class="n">secs_track</span><span class="p">;</span>	<span class="cm">/* sectors per track */</span>
	<span class="n">__le16</span>	<span class="n">heads</span><span class="p">;</span>		<span class="cm">/* number of heads */</span>
	<span class="n">__le32</span>	<span class="n">hidden</span><span class="p">;</span>		<span class="cm">/* hidden sectors (unused) */</span>
	<span class="n">__le32</span>	<span class="n">total_sect</span><span class="p">;</span>	<span class="cm">/* number of sectors (if sectors == 0) */</span>

	<span class="cm">/* The following fields are only used by FAT32 */</span>
	<span class="n">__le32</span>	<span class="n">fat32_length</span><span class="p">;</span>	<span class="cm">/* sectors/FAT */</span>
	<span class="n">__le16</span>	<span class="n">flags</span><span class="p">;</span>		<span class="cm">/* bit 8: fat mirroring, low 4: active fat */</span>
	<span class="n">__u8</span>	<span class="n">version</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* major, minor filesystem version */</span>
	<span class="n">__le32</span>	<span class="n">root_cluster</span><span class="p">;</span>	<span class="cm">/* first cluster in root directory */</span>
	<span class="n">__le16</span>	<span class="n">info_sector</span><span class="p">;</span>	<span class="cm">/* filesystem info sector */</span>
	<span class="n">__le16</span>	<span class="n">backup_boot</span><span class="p">;</span>	<span class="cm">/* backup boot sector */</span>
	<span class="n">__le16</span>	<span class="n">reserved2</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>	<span class="cm">/* Unused */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">fat_boot_fsinfo</span> <span class="p">{</span>
	<span class="n">__le32</span>   <span class="n">signature1</span><span class="p">;</span>	<span class="cm">/* 0x41615252L */</span>
	<span class="n">__le32</span>   <span class="n">reserved1</span><span class="p">[</span><span class="mi">120</span><span class="p">];</span>	<span class="cm">/* Nothing as far as I can tell */</span>
	<span class="n">__le32</span>   <span class="n">signature2</span><span class="p">;</span>	<span class="cm">/* 0x61417272L */</span>
	<span class="n">__le32</span>   <span class="n">free_clusters</span><span class="p">;</span>	<span class="cm">/* Free cluster count.  -1 if unknown */</span>
	<span class="n">__le32</span>   <span class="n">next_cluster</span><span class="p">;</span>	<span class="cm">/* Most recently allocated cluster */</span>
	<span class="n">__le32</span>   <span class="n">reserved2</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">msdos_dir_entry</span> <span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">name</span><span class="p">[</span><span class="n">MSDOS_NAME</span><span class="p">];</span><span class="cm">/* name and extension */</span>
	<span class="n">__u8</span>	<span class="n">attr</span><span class="p">;</span>		<span class="cm">/* attribute bits */</span>
	<span class="n">__u8</span>    <span class="n">lcase</span><span class="p">;</span>		<span class="cm">/* Case for base and extension */</span>
	<span class="n">__u8</span>	<span class="n">ctime_cs</span><span class="p">;</span>	<span class="cm">/* Creation time, centiseconds (0-199) */</span>
	<span class="n">__le16</span>	<span class="n">ctime</span><span class="p">;</span>		<span class="cm">/* Creation time */</span>
	<span class="n">__le16</span>	<span class="n">cdate</span><span class="p">;</span>		<span class="cm">/* Creation date */</span>
	<span class="n">__le16</span>	<span class="n">adate</span><span class="p">;</span>		<span class="cm">/* Last access date */</span>
	<span class="n">__le16</span>	<span class="n">starthi</span><span class="p">;</span>	<span class="cm">/* High 16 bits of cluster in FAT32 */</span>
	<span class="n">__le16</span>	<span class="n">time</span><span class="p">,</span><span class="n">date</span><span class="p">,</span><span class="n">start</span><span class="p">;</span><span class="cm">/* time, date and first cluster */</span>
	<span class="n">__le32</span>	<span class="n">size</span><span class="p">;</span>		<span class="cm">/* file size (in bytes) */</span>
<span class="p">};</span>

<span class="cm">/* Up to 13 characters of the name */</span>
<span class="k">struct</span> <span class="n">msdos_dir_slot</span> <span class="p">{</span>
	<span class="n">__u8</span>    <span class="n">id</span><span class="p">;</span>		<span class="cm">/* sequence number for slot */</span>
	<span class="n">__u8</span>    <span class="n">name0_4</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>	<span class="cm">/* first 5 characters in name */</span>
	<span class="n">__u8</span>    <span class="n">attr</span><span class="p">;</span>		<span class="cm">/* attribute byte */</span>
	<span class="n">__u8</span>    <span class="n">reserved</span><span class="p">;</span>	<span class="cm">/* always 0 */</span>
	<span class="n">__u8</span>    <span class="n">alias_checksum</span><span class="p">;</span>	<span class="cm">/* checksum for 8.3 alias */</span>
	<span class="n">__u8</span>    <span class="n">name5_10</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>	<span class="cm">/* 6 more characters in name */</span>
	<span class="n">__le16</span>   <span class="n">start</span><span class="p">;</span>		<span class="cm">/* starting cluster number, 0 in long slots */</span>
	<span class="n">__u8</span>    <span class="n">name11_12</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* last 2 characters in name */</span>
<span class="p">};</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cm">/* media of boot sector */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">fat_valid_media</span><span class="p">(</span><span class="n">u8</span> <span class="n">media</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mh">0xf8</span> <span class="o">&lt;=</span> <span class="n">media</span> <span class="o">||</span> <span class="n">media</span> <span class="o">==</span> <span class="mh">0xf0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* !__KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* !_LINUX_MSDOS_FS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
