<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › isdnif.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>isdnif.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $Id: isdnif.h,v 1.43.2.2 2004/01/12 23:08:35 keil Exp $</span>
<span class="cm"> *</span>
<span class="cm"> * Linux ISDN subsystem</span>
<span class="cm"> * Definition of the interface between the subsystem and its low-level drivers.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 1994,95,96 by Fritz Elfert (fritz@isdn4linux.de)</span>
<span class="cm"> * Copyright 1995,96    Thinking Objects Software GmbH Wuerzburg</span>
<span class="cm"> * </span>
<span class="cm"> * This software may be used and distributed according to the terms</span>
<span class="cm"> * of the GNU General Public License, incorporated herein by reference.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ISDNIF_H__</span>
<span class="cp">#define __ISDNIF_H__</span>


<span class="cm">/*</span>
<span class="cm"> * Values for general protocol-selection</span>
<span class="cm"> */</span>
<span class="cp">#define ISDN_PTYPE_UNKNOWN   0   </span><span class="cm">/* Protocol undefined   */</span><span class="cp"></span>
<span class="cp">#define ISDN_PTYPE_1TR6      1   </span><span class="cm">/* german 1TR6-protocol */</span><span class="cp"></span>
<span class="cp">#define ISDN_PTYPE_EURO      2   </span><span class="cm">/* EDSS1-protocol       */</span><span class="cp"></span>
<span class="cp">#define ISDN_PTYPE_LEASED    3   </span><span class="cm">/* for leased lines     */</span><span class="cp"></span>
<span class="cp">#define ISDN_PTYPE_NI1       4   </span><span class="cm">/* US NI-1 protocol     */</span><span class="cp"></span>
<span class="cp">#define ISDN_PTYPE_MAX       7   </span><span class="cm">/* Max. 8 Protocols     */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Values for Layer-2-protocol-selection</span>
<span class="cm"> */</span>
<span class="cp">#define ISDN_PROTO_L2_X75I   0   </span><span class="cm">/* X75/LAPB with I-Frames            */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_X75UI  1   </span><span class="cm">/* X75/LAPB with UI-Frames           */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_X75BUI 2   </span><span class="cm">/* X75/LAPB with UI-Frames           */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_HDLC   3   </span><span class="cm">/* HDLC                              */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_TRANS  4   </span><span class="cm">/* Transparent (Voice)               */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_X25DTE 5   </span><span class="cm">/* X25/LAPB DTE mode                 */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_X25DCE 6   </span><span class="cm">/* X25/LAPB DCE mode                 */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_V11096 7   </span><span class="cm">/* V.110 bitrate adaption 9600 Baud  */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_V11019 8   </span><span class="cm">/* V.110 bitrate adaption 19200 Baud */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_V11038 9   </span><span class="cm">/* V.110 bitrate adaption 38400 Baud */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_MODEM  10  </span><span class="cm">/* Analog Modem on Board */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_FAX    11  </span><span class="cm">/* Fax Group 2/3         */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_HDLC_56K 12   </span><span class="cm">/* HDLC 56k                          */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L2_MAX    15  </span><span class="cm">/* Max. 16 Protocols                 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Values for Layer-3-protocol-selection</span>
<span class="cm"> */</span>
<span class="cp">#define ISDN_PROTO_L3_TRANS	0	</span><span class="cm">/* Transparent */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L3_TRANSDSP	1	</span><span class="cm">/* Transparent with DSP */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L3_FCLASS2	2	</span><span class="cm">/* Fax Group 2/3 CLASS 2 */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L3_FCLASS1	3	</span><span class="cm">/* Fax Group 2/3 CLASS 1 */</span><span class="cp"></span>
<span class="cp">#define ISDN_PROTO_L3_MAX	7	</span><span class="cm">/* Max. 8 Protocols */</span><span class="cp"></span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;linux/skbuff.h&gt;</span>

<span class="cm">/***************************************************************************/</span>
<span class="cm">/* Extensions made by Werner Cornelius (werner@ikt.de)                     */</span>
<span class="cm">/*                                                                         */</span> 
<span class="cm">/* The proceed command holds a incoming call in a state to leave processes */</span>
<span class="cm">/* enough time to check whether ist should be accepted.                    */</span>
<span class="cm">/* The PROT_IO Command extends the interface to make protocol dependent    */</span>
<span class="cm">/* features available (call diversion, call waiting...).                   */</span>
<span class="cm">/*                                                                         */</span> 
<span class="cm">/* The PROT_IO Command is executed with the desired driver id and the arg  */</span>
<span class="cm">/* parameter coded as follows:                                             */</span>
<span class="cm">/* The lower 8 bits of arg contain the desired protocol from ISDN_PTYPE    */</span>
<span class="cm">/* definitions. The upper 24 bits represent the protocol specific cmd/stat.*/</span>
<span class="cm">/* Any additional data is protocol and command specific.                   */</span>
<span class="cm">/* This mechanism also applies to the statcallb callback STAT_PROT.        */</span>    
<span class="cm">/*                                                                         */</span>
<span class="cm">/* This suggested extension permits an easy expansion of protocol specific */</span>
<span class="cm">/* handling. Extensions may be added at any time without changing the HL   */</span>
<span class="cm">/* driver code and not getting conflicts without certifications.           */</span>
<span class="cm">/* The well known CAPI 2.0 interface handles such extensions in a similar  */</span>
<span class="cm">/* way. Perhaps a protocol specific module may be added and separately     */</span>
<span class="cm">/* loaded and linked to the basic isdn module for handling.                */</span>                    
<span class="cm">/***************************************************************************/</span>

<span class="cm">/*****************/</span>
<span class="cm">/* DSS1 commands */</span> 
<span class="cm">/*****************/</span>
<span class="cp">#define DSS1_CMD_INVOKE       ((0x00 &lt;&lt; 8) | ISDN_PTYPE_EURO)   </span><span class="cm">/* invoke a supplementary service */</span><span class="cp"></span>
<span class="cp">#define DSS1_CMD_INVOKE_ABORT ((0x01 &lt;&lt; 8) | ISDN_PTYPE_EURO)   </span><span class="cm">/* abort a invoke cmd */</span><span class="cp"></span>

<span class="cm">/*******************************/</span>
<span class="cm">/* DSS1 Status callback values */</span>
<span class="cm">/*******************************/</span>
<span class="cp">#define DSS1_STAT_INVOKE_RES  ((0x80 &lt;&lt; 8) | ISDN_PTYPE_EURO)   </span><span class="cm">/* Result for invocation */</span><span class="cp"></span>
<span class="cp">#define DSS1_STAT_INVOKE_ERR  ((0x81 &lt;&lt; 8) | ISDN_PTYPE_EURO)   </span><span class="cm">/* Error Return for invocation */</span><span class="cp"></span>
<span class="cp">#define DSS1_STAT_INVOKE_BRD  ((0x82 &lt;&lt; 8) | ISDN_PTYPE_EURO)   </span><span class="cm">/* Deliver invoke broadcast info */</span><span class="cp"></span>


<span class="cm">/*********************************************************************/</span>
<span class="cm">/* structures for DSS1 commands and callback                         */</span>
<span class="cm">/*                                                                   */</span>
<span class="cm">/* An action is invoked by sending a DSS1_CMD_INVOKE. The ll_id, proc*/</span>
<span class="cm">/* timeout, datalen and data fields must be set before calling.      */</span>
<span class="cm">/*                                                                   */</span>
<span class="cm">/* The return value is a positive hl_id value also delivered in the  */</span>
<span class="cm">/* hl_id field. A value of zero signals no more left hl_id capacitys.*/</span>
<span class="cm">/* A negative return value signals errors in LL. So if the return    */</span>
<span class="cm">/* value is &lt;= 0 no action in LL will be taken -&gt; request ignored    */</span>
<span class="cm">/*                                                                   */</span>
<span class="cm">/* The timeout field must be filled with a positive value specifying */</span>
<span class="cm">/* the amount of time the INVOKED process waits for a reaction from  */</span>
<span class="cm">/* the network.                                                      */</span>
<span class="cm">/* If a response (either error or result) is received during this    */</span>
<span class="cm">/* intervall, a reporting callback is initiated and the process will */</span>
<span class="cm">/* be deleted, the hl identifier will be freed.                      */</span>
<span class="cm">/* If no response is received during the specified intervall, a error*/</span>
<span class="cm">/* callback is initiated with timeout set to -1 and a datalen set    */</span>
<span class="cm">/* to 0.                                                             */</span>
<span class="cm">/* If timeout is set to a value &lt;= 0 during INVOCATION the process is*/</span>
<span class="cm">/* immediately deleted after sending the data. No callback occurs !  */</span>
<span class="cm">/*                                                                   */</span>
<span class="cm">/* A currently waiting process may be aborted with INVOKE_ABORT. No  */</span>
<span class="cm">/* callback will occur when a process has been aborted.              */</span>
<span class="cm">/*                                                                   */</span>
<span class="cm">/* Broadcast invoke frames from the network are reported via the     */</span>
<span class="cm">/* STAT_INVOKE_BRD callback. The ll_id is set to 0, the other fields */</span>
<span class="cm">/* are supplied by the network and not by the HL.                    */</span>   
<span class="cm">/*********************************************************************/</span>

<span class="cm">/*****************/</span>
<span class="cm">/* NI1 commands */</span> 
<span class="cm">/*****************/</span>
<span class="cp">#define NI1_CMD_INVOKE       ((0x00 &lt;&lt; 8) | ISDN_PTYPE_NI1)   </span><span class="cm">/* invoke a supplementary service */</span><span class="cp"></span>
<span class="cp">#define NI1_CMD_INVOKE_ABORT ((0x01 &lt;&lt; 8) | ISDN_PTYPE_NI1)   </span><span class="cm">/* abort a invoke cmd */</span><span class="cp"></span>

<span class="cm">/*******************************/</span>
<span class="cm">/* NI1 Status callback values */</span>
<span class="cm">/*******************************/</span>
<span class="cp">#define NI1_STAT_INVOKE_RES  ((0x80 &lt;&lt; 8) | ISDN_PTYPE_NI1)   </span><span class="cm">/* Result for invocation */</span><span class="cp"></span>
<span class="cp">#define NI1_STAT_INVOKE_ERR  ((0x81 &lt;&lt; 8) | ISDN_PTYPE_NI1)   </span><span class="cm">/* Error Return for invocation */</span><span class="cp"></span>
<span class="cp">#define NI1_STAT_INVOKE_BRD  ((0x82 &lt;&lt; 8) | ISDN_PTYPE_NI1)   </span><span class="cm">/* Deliver invoke broadcast info */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">struct</span>
  <span class="p">{</span> <span class="n">ulong</span> <span class="n">ll_id</span><span class="p">;</span> <span class="cm">/* ID supplied by LL when executing    */</span>
		 <span class="cm">/* a command and returned by HL for    */</span>
                 <span class="cm">/* INVOKE_RES and INVOKE_ERR           */</span>
    <span class="kt">int</span> <span class="n">hl_id</span><span class="p">;</span>   <span class="cm">/* ID supplied by HL when called       */</span>
                 <span class="cm">/* for executing a cmd and delivered   */</span>
                 <span class="cm">/* for results and errors              */</span>
                 <span class="cm">/* must be supplied by LL when aborting*/</span>  
    <span class="kt">int</span> <span class="n">proc</span><span class="p">;</span>    <span class="cm">/* invoke procedure used by CMD_INVOKE */</span>
                 <span class="cm">/* returned by callback and broadcast  */</span> 
    <span class="kt">int</span> <span class="n">timeout</span><span class="p">;</span> <span class="cm">/* timeout for INVOKE CMD in ms        */</span>
                 <span class="cm">/* -1  in stat callback when timed out */</span>
                 <span class="cm">/* error value when error callback     */</span>
    <span class="kt">int</span> <span class="n">datalen</span><span class="p">;</span> <span class="cm">/* length of cmd or stat data          */</span>
    <span class="n">u_char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span><span class="cm">/* pointer to data delivered or send   */</span>
  <span class="p">}</span> <span class="n">isdn_cmd_stat</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Commands from linklevel to lowlevel</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#define ISDN_CMD_IOCTL    0       </span><span class="cm">/* Perform ioctl                         */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_DIAL     1       </span><span class="cm">/* Dial out                              */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_ACCEPTD  2       </span><span class="cm">/* Accept an incoming call on D-Chan.    */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_ACCEPTB  3       </span><span class="cm">/* Request B-Channel connect.            */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_HANGUP   4       </span><span class="cm">/* Hangup                                */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_CLREAZ   5       </span><span class="cm">/* Clear EAZ(s) of channel               */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_SETEAZ   6       </span><span class="cm">/* Set EAZ(s) of channel                 */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_GETEAZ   7       </span><span class="cm">/* Get EAZ(s) of channel                 */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_SETSIL   8       </span><span class="cm">/* Set Service-Indicator-List of channel */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_GETSIL   9       </span><span class="cm">/* Get Service-Indicator-List of channel */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_SETL2   10       </span><span class="cm">/* Set B-Chan. Layer2-Parameter          */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_GETL2   11       </span><span class="cm">/* Get B-Chan. Layer2-Parameter          */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_SETL3   12       </span><span class="cm">/* Set B-Chan. Layer3-Parameter          */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_GETL3   13       </span><span class="cm">/* Get B-Chan. Layer3-Parameter          */</span><span class="cp"></span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><h1>define ISDN<em>CMD</em>LOCK    14       /* Signal usage by upper levels          */</h1>

<h1>define ISDN<em>CMD</em>UNLOCK  15       /* Release usage-lock                    */</h1></td><td class="code"><div class="highlight"><pre><span class="cp">#define ISDN_CMD_SUSPEND 16       </span><span class="cm">/* Suspend connection                    */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_RESUME  17       </span><span class="cm">/* Resume connection                     */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_PROCEED 18       </span><span class="cm">/* Proceed with call establishment       */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_ALERT   19       </span><span class="cm">/* Alert after Proceeding                */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_REDIR   20       </span><span class="cm">/* Redir a incoming call                 */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_PROT_IO 21       </span><span class="cm">/* Protocol specific commands            */</span><span class="cp"></span>
<span class="cp">#define CAPI_PUT_MESSAGE 22       </span><span class="cm">/* CAPI message send down or up          */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_FAXCMD  23       </span><span class="cm">/* FAX commands to HL-driver             */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMD_AUDIO   24       </span><span class="cm">/* DSP, DTMF, ... settings               */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Status-Values delivered from lowlevel to linklevel via</span>
<span class="cm"> * statcallb().</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#define ISDN_STAT_STAVAIL 256    </span><span class="cm">/* Raw status-data available             */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_ICALL   257    </span><span class="cm">/* Incoming call detected                */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_RUN     258    </span><span class="cm">/* Signal protocol-code is running       */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_STOP    259    </span><span class="cm">/* Signal halt of protocol-code          */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_DCONN   260    </span><span class="cm">/* Signal D-Channel connect              */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_BCONN   261    </span><span class="cm">/* Signal B-Channel connect              */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_DHUP    262    </span><span class="cm">/* Signal D-Channel disconnect           */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_BHUP    263    </span><span class="cm">/* Signal B-Channel disconnect           */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_CINF    264    </span><span class="cm">/* Charge-Info                           */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_LOAD    265    </span><span class="cm">/* Signal new lowlevel-driver is loaded  */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_UNLOAD  266    </span><span class="cm">/* Signal unload of lowlevel-driver      */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_BSENT   267    </span><span class="cm">/* Signal packet sent                    */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_NODCH   268    </span><span class="cm">/* Signal no D-Channel                   */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_ADDCH   269    </span><span class="cm">/* Add more Channels                     */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_CAUSE   270    </span><span class="cm">/* Cause-Message                         */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_ICALLW  271    </span><span class="cm">/* Incoming call without B-chan waiting  */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_REDIR   272    </span><span class="cm">/* Redir result                          */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_PROT    273    </span><span class="cm">/* protocol IO specific callback         */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_DISPLAY 274    </span><span class="cm">/* deliver a received display message    */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_L1ERR   275    </span><span class="cm">/* Signal Layer-1 Error                  */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_FAXIND  276    </span><span class="cm">/* FAX indications from HL-driver        */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_AUDIO   277    </span><span class="cm">/* DTMF, DSP indications                 */</span><span class="cp"></span>
<span class="cp">#define ISDN_STAT_DISCH   278    </span><span class="cm">/* Disable/Enable channel usage          */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Audio commands</span>
<span class="cm"> */</span>
<span class="cp">#define ISDN_AUDIO_SETDD	0	</span><span class="cm">/* Set DTMF detection           */</span><span class="cp"></span>
<span class="cp">#define ISDN_AUDIO_DTMF		1	</span><span class="cm">/* Rx/Tx DTMF                   */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Values for errcode field</span>
<span class="cm"> */</span>
<span class="cp">#define ISDN_STAT_L1ERR_SEND 1</span>
<span class="cp">#define ISDN_STAT_L1ERR_RECV 2</span>

<span class="cm">/*</span>
<span class="cm"> * Values for feature-field of interface-struct.</span>
<span class="cm"> */</span>
<span class="cm">/* Layer 2 */</span>
<span class="cp">#define ISDN_FEATURE_L2_X75I    (0x0001 &lt;&lt; ISDN_PROTO_L2_X75I)</span>
<span class="cp">#define ISDN_FEATURE_L2_X75UI   (0x0001 &lt;&lt; ISDN_PROTO_L2_X75UI)</span>
<span class="cp">#define ISDN_FEATURE_L2_X75BUI  (0x0001 &lt;&lt; ISDN_PROTO_L2_X75BUI)</span>
<span class="cp">#define ISDN_FEATURE_L2_HDLC    (0x0001 &lt;&lt; ISDN_PROTO_L2_HDLC)</span>
<span class="cp">#define ISDN_FEATURE_L2_TRANS   (0x0001 &lt;&lt; ISDN_PROTO_L2_TRANS)</span>
<span class="cp">#define ISDN_FEATURE_L2_X25DTE  (0x0001 &lt;&lt; ISDN_PROTO_L2_X25DTE)</span>
<span class="cp">#define ISDN_FEATURE_L2_X25DCE  (0x0001 &lt;&lt; ISDN_PROTO_L2_X25DCE)</span>
<span class="cp">#define ISDN_FEATURE_L2_V11096  (0x0001 &lt;&lt; ISDN_PROTO_L2_V11096)</span>
<span class="cp">#define ISDN_FEATURE_L2_V11019  (0x0001 &lt;&lt; ISDN_PROTO_L2_V11019)</span>
<span class="cp">#define ISDN_FEATURE_L2_V11038  (0x0001 &lt;&lt; ISDN_PROTO_L2_V11038)</span>
<span class="cp">#define ISDN_FEATURE_L2_MODEM   (0x0001 &lt;&lt; ISDN_PROTO_L2_MODEM)</span>
<span class="cp">#define ISDN_FEATURE_L2_FAX	(0x0001 &lt;&lt; ISDN_PROTO_L2_FAX)</span>
<span class="cp">#define ISDN_FEATURE_L2_HDLC_56K (0x0001 &lt;&lt; ISDN_PROTO_L2_HDLC_56K)</span>

<span class="cp">#define ISDN_FEATURE_L2_MASK    (0x0FFFF) </span><span class="cm">/* Max. 16 protocols */</span><span class="cp"></span>
<span class="cp">#define ISDN_FEATURE_L2_SHIFT   (0)</span>

<span class="cm">/* Layer 3 */</span>
<span class="cp">#define ISDN_FEATURE_L3_TRANS   (0x10000 &lt;&lt; ISDN_PROTO_L3_TRANS)</span>
<span class="cp">#define ISDN_FEATURE_L3_TRANSDSP (0x10000 &lt;&lt; ISDN_PROTO_L3_TRANSDSP)</span>
<span class="cp">#define ISDN_FEATURE_L3_FCLASS2	(0x10000 &lt;&lt; ISDN_PROTO_L3_FCLASS2)</span>
<span class="cp">#define ISDN_FEATURE_L3_FCLASS1	(0x10000 &lt;&lt; ISDN_PROTO_L3_FCLASS1)</span>

<span class="cp">#define ISDN_FEATURE_L3_MASK    (0x0FF0000) </span><span class="cm">/* Max. 8 Protocols */</span><span class="cp"></span>
<span class="cp">#define ISDN_FEATURE_L3_SHIFT   (16)</span>

<span class="cm">/* Signaling */</span>
<span class="cp">#define ISDN_FEATURE_P_UNKNOWN  (0x1000000 &lt;&lt; ISDN_PTYPE_UNKNOWN)</span>
<span class="cp">#define ISDN_FEATURE_P_1TR6     (0x1000000 &lt;&lt; ISDN_PTYPE_1TR6)</span>
<span class="cp">#define ISDN_FEATURE_P_EURO     (0x1000000 &lt;&lt; ISDN_PTYPE_EURO)</span>
<span class="cp">#define ISDN_FEATURE_P_NI1      (0x1000000 &lt;&lt; ISDN_PTYPE_NI1)</span>

<span class="cp">#define ISDN_FEATURE_P_MASK     (0x0FF000000) </span><span class="cm">/* Max. 8 Protocols */</span><span class="cp"></span>
<span class="cp">#define ISDN_FEATURE_P_SHIFT    (24)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">setup_parm</span> <span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">phone</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>	<span class="cm">/* Remote Phone-Number */</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">eazmsn</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>	<span class="cm">/* Local EAZ or MSN    */</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">si1</span><span class="p">;</span>      <span class="cm">/* Service Indicator 1 */</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">si2</span><span class="p">;</span>      <span class="cm">/* Service Indicator 2 */</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">plan</span><span class="p">;</span>     <span class="cm">/* Numbering plan      */</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">screen</span><span class="p">;</span>   <span class="cm">/* Screening info      */</span>
<span class="p">}</span> <span class="n">setup_parm</span><span class="p">;</span>


<span class="cp">#ifdef CONFIG_ISDN_TTY_FAX</span>
<span class="cm">/* T.30 Fax G3 */</span>

<span class="cp">#define FAXIDLEN 21</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">T30_s</span> <span class="p">{</span>
	<span class="cm">/* session parameters */</span>
	<span class="n">__u8</span> <span class="n">resolution</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">rate</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">width</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">length</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">compression</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ecm</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">binary</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">scantime</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">id</span><span class="p">[</span><span class="n">FAXIDLEN</span><span class="p">];</span>
	<span class="cm">/* additional parameters */</span>
	<span class="n">__u8</span> <span class="n">phase</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">direction</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">code</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">badlin</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">badmul</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">bor</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">fet</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">pollid</span><span class="p">[</span><span class="n">FAXIDLEN</span><span class="p">];</span>
	<span class="n">__u8</span> <span class="n">cq</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">cr</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ctcrty</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">minsp</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">phcto</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">rel</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">nbc</span><span class="p">;</span>
	<span class="cm">/* remote station parameters */</span>
	<span class="n">__u8</span> <span class="n">r_resolution</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">r_rate</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">r_width</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">r_length</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">r_compression</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">r_ecm</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">r_binary</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">r_scantime</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">r_id</span><span class="p">[</span><span class="n">FAXIDLEN</span><span class="p">];</span>
	<span class="n">__u8</span> <span class="n">r_code</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span> <span class="n">T30_s</span><span class="p">;</span>

<span class="cp">#define ISDN_TTY_FAX_CONN_IN	0</span>
<span class="cp">#define ISDN_TTY_FAX_CONN_OUT	1</span>

<span class="cp">#define ISDN_TTY_FAX_FCON	0</span>
<span class="cp">#define ISDN_TTY_FAX_DIS 	1</span>
<span class="cp">#define ISDN_TTY_FAX_FTT 	2</span>
<span class="cp">#define ISDN_TTY_FAX_MCF 	3</span>
<span class="cp">#define ISDN_TTY_FAX_DCS 	4</span>
<span class="cp">#define ISDN_TTY_FAX_TRAIN_OK	5</span>
<span class="cp">#define ISDN_TTY_FAX_EOP 	6</span>
<span class="cp">#define ISDN_TTY_FAX_EOM 	7</span>
<span class="cp">#define ISDN_TTY_FAX_MPS 	8</span>
<span class="cp">#define ISDN_TTY_FAX_DTC 	9</span>
<span class="cp">#define ISDN_TTY_FAX_RID 	10</span>
<span class="cp">#define ISDN_TTY_FAX_HNG 	11</span>
<span class="cp">#define ISDN_TTY_FAX_DT  	12</span>
<span class="cp">#define ISDN_TTY_FAX_FCON_I	13</span>
<span class="cp">#define ISDN_TTY_FAX_DR  	14</span>
<span class="cp">#define ISDN_TTY_FAX_ET  	15</span>
<span class="cp">#define ISDN_TTY_FAX_CFR 	16</span>
<span class="cp">#define ISDN_TTY_FAX_PTS 	17</span>
<span class="cp">#define ISDN_TTY_FAX_SENT	18</span>

<span class="cp">#define ISDN_FAX_PHASE_IDLE	0</span>
<span class="cp">#define ISDN_FAX_PHASE_A	1</span>
<span class="cp">#define ISDN_FAX_PHASE_B   	2</span>
<span class="cp">#define ISDN_FAX_PHASE_C   	3</span>
<span class="cp">#define ISDN_FAX_PHASE_D   	4</span>
<span class="cp">#define ISDN_FAX_PHASE_E   	5</span>

<span class="cp">#endif </span><span class="cm">/* TTY_FAX */</span><span class="cp"></span>

<span class="cp">#define ISDN_FAX_CLASS1_FAE	0</span>
<span class="cp">#define ISDN_FAX_CLASS1_FTS	1</span>
<span class="cp">#define ISDN_FAX_CLASS1_FRS	2</span>
<span class="cp">#define ISDN_FAX_CLASS1_FTM	3</span>
<span class="cp">#define ISDN_FAX_CLASS1_FRM	4</span>
<span class="cp">#define ISDN_FAX_CLASS1_FTH	5</span>
<span class="cp">#define ISDN_FAX_CLASS1_FRH	6</span>
<span class="cp">#define ISDN_FAX_CLASS1_CTRL	7</span>

<span class="cp">#define ISDN_FAX_CLASS1_OK	0</span>
<span class="cp">#define ISDN_FAX_CLASS1_CONNECT	1</span>
<span class="cp">#define ISDN_FAX_CLASS1_NOCARR	2</span>
<span class="cp">#define ISDN_FAX_CLASS1_ERROR	3</span>
<span class="cp">#define ISDN_FAX_CLASS1_FCERROR	4</span>
<span class="cp">#define ISDN_FAX_CLASS1_QUERY	5</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">__u8</span>	<span class="n">cmd</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">subcmd</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">para</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>
<span class="p">}</span> <span class="n">aux_s</span><span class="p">;</span>

<span class="cp">#define AT_COMMAND	0</span>
<span class="cp">#define AT_EQ_VALUE	1</span>
<span class="cp">#define AT_QUERY	2</span>
<span class="cp">#define AT_EQ_QUERY	3</span>

<span class="cm">/* CAPI structs */</span>

<span class="cm">/* this is compatible to the old union size */</span>
<span class="cp">#define MAX_CAPI_PARA_LEN 50</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="cm">/* Header */</span>
	<span class="n">__u16</span> <span class="n">Length</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">ApplId</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">Command</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">Subcommand</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">Messagenumber</span><span class="p">;</span>

	<span class="cm">/* Parameter */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">__u32</span> <span class="n">Controller</span><span class="p">;</span>
		<span class="n">__u32</span> <span class="n">PLCI</span><span class="p">;</span>
		<span class="n">__u32</span> <span class="n">NCCI</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">adr</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">para</span><span class="p">[</span><span class="n">MAX_CAPI_PARA_LEN</span><span class="p">];</span>
<span class="p">}</span> <span class="n">capi_msg</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Structure for exchanging above infos</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span>   <span class="n">driver</span><span class="p">;</span>		<span class="cm">/* Lowlevel-Driver-ID            */</span>
	<span class="kt">int</span>   <span class="n">command</span><span class="p">;</span>		<span class="cm">/* Command or Status (see above) */</span>
	<span class="n">ulong</span> <span class="n">arg</span><span class="p">;</span>		<span class="cm">/* Additional Data               */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">ulong</span> <span class="n">errcode</span><span class="p">;</span>	<span class="cm">/* Type of error with STAT_L1ERR	*/</span>
		<span class="kt">int</span> <span class="n">length</span><span class="p">;</span>	<span class="cm">/* Amount of bytes sent with STAT_BSENT	*/</span>
		<span class="n">u_char</span> <span class="n">num</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>	<span class="cm">/* Additional Data			*/</span>
		<span class="n">setup_parm</span> <span class="n">setup</span><span class="p">;</span><span class="cm">/* For SETUP msg			*/</span>
		<span class="n">capi_msg</span> <span class="n">cmsg</span><span class="p">;</span>	<span class="cm">/* For CAPI like messages		*/</span>
		<span class="kt">char</span> <span class="n">display</span><span class="p">[</span><span class="mi">85</span><span class="p">];</span><span class="cm">/* display message data		*/</span> 
		<span class="n">isdn_cmd_stat</span> <span class="n">isdn_io</span><span class="p">;</span> <span class="cm">/* ISDN IO-parameter/result	*/</span>
		<span class="n">aux_s</span> <span class="n">aux</span><span class="p">;</span>	<span class="cm">/* for modem commands/indications	*/</span>
<span class="cp">#ifdef CONFIG_ISDN_TTY_FAX</span>
		<span class="n">T30_s</span>	<span class="o">*</span><span class="n">fax</span><span class="p">;</span>	<span class="cm">/* Pointer to ttys fax struct		*/</span>
<span class="cp">#endif</span>
		<span class="n">ulong</span> <span class="n">userdata</span><span class="p">;</span>	<span class="cm">/* User Data */</span>
	<span class="p">}</span> <span class="n">parm</span><span class="p">;</span>
<span class="p">}</span> <span class="n">isdn_ctrl</span><span class="p">;</span>

<span class="cp">#define dss1_io    isdn_io</span>
<span class="cp">#define ni1_io     isdn_io</span>

<span class="cm">/*</span>
<span class="cm"> * The interface-struct itself (initialized at load-time of lowlevel-driver)</span>
<span class="cm"> *</span>
<span class="cm"> * See Documentation/isdn/INTERFACE for a description, how the communication</span>
<span class="cm"> * between the ISDN subsystem and its drivers is done.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="n">owner</span><span class="p">;</span>

  <span class="cm">/* Number of channels supported by this driver</span>
<span class="cm">   */</span>
  <span class="kt">int</span> <span class="n">channels</span><span class="p">;</span>

  <span class="cm">/* </span>
<span class="cm">   * Maximum Size of transmit/receive-buffer this driver supports.</span>
<span class="cm">   */</span>
  <span class="kt">int</span> <span class="n">maxbufsize</span><span class="p">;</span>

  <span class="cm">/* Feature-Flags for this driver.</span>
<span class="cm">   * See defines ISDN_FEATURE_... for Values</span>
<span class="cm">   */</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">features</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">   * Needed for calculating</span>
<span class="cm">   * dev-&gt;hard_header_len = linklayer header + hl_hdrlen;</span>
<span class="cm">   * Drivers, not supporting sk_buff&#39;s should set this to 0.</span>
<span class="cm">   */</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">hl_hdrlen</span><span class="p">;</span>

  <span class="cm">/*</span>
<span class="cm">   * Receive-Callback using sk_buff&#39;s</span>
<span class="cm">   * Parameters:</span>
<span class="cm">   *             int                    Driver-ID</span>
<span class="cm">   *             int                    local channel-number (0 ...)</span>
<span class="cm">   *             struct sk_buff *skb    received Data</span>
<span class="cm">   */</span>
  <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">rcvcallb_skb</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="p">);</span>

  <span class="cm">/* Status-Callback</span>
<span class="cm">   * Parameters:</span>
<span class="cm">   *             isdn_ctrl*</span>
<span class="cm">   *                   driver  = Driver ID.</span>
<span class="cm">   *                   command = One of above ISDN_STAT_... constants.</span>
<span class="cm">   *                   arg     = depending on status-type.</span>
<span class="cm">   *                   num     = depending on status-type.</span>
<span class="cm">   */</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">statcallb</span><span class="p">)(</span><span class="n">isdn_ctrl</span><span class="o">*</span><span class="p">);</span>

  <span class="cm">/* Send command</span>
<span class="cm">   * Parameters:</span>
<span class="cm">   *             isdn_ctrl*</span>
<span class="cm">   *                   driver  = Driver ID.</span>
<span class="cm">   *                   command = One of above ISDN_CMD_... constants.</span>
<span class="cm">   *                   arg     = depending on command.</span>
<span class="cm">   *                   num     = depending on command.</span>
<span class="cm">   */</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">command</span><span class="p">)(</span><span class="n">isdn_ctrl</span><span class="o">*</span><span class="p">);</span>

  <span class="cm">/*</span>
<span class="cm">   * Send data using sk_buff&#39;s</span>
<span class="cm">   * Parameters:</span>
<span class="cm">   *             int                    driverId</span>
<span class="cm">   *             int                    local channel-number (0...)</span>
<span class="cm">   *             int                    Flag: Need ACK for this packet.</span>
<span class="cm">   *             struct sk_buff *skb    Data to send</span>
<span class="cm">   */</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">writebuf_skb</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="p">);</span>

  <span class="cm">/* Send raw D-Channel-Commands</span>
<span class="cm">   * Parameters:</span>
<span class="cm">   *             u_char pointer data</span>
<span class="cm">   *             int    length of data</span>
<span class="cm">   *             int    driverId</span>
<span class="cm">   *             int    local channel-number (0 ...)</span>
<span class="cm">   */</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">writecmd</span><span class="p">)(</span><span class="k">const</span> <span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

  <span class="cm">/* Read raw Status replies</span>
<span class="cm">   *             u_char pointer data (volatile)</span>
<span class="cm">   *             int    length of buffer</span>
<span class="cm">   *             int    driverId</span>
<span class="cm">   *             int    local channel-number (0 ...)</span>
<span class="cm">   */</span>
  <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">readstat</span><span class="p">)(</span><span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

  <span class="kt">char</span> <span class="n">id</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
<span class="p">}</span> <span class="n">isdn_if</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Function which must be called by lowlevel-driver at loadtime with</span>
<span class="cm"> * the following fields of above struct set:</span>
<span class="cm"> *</span>
<span class="cm"> * channels     Number of channels that will be supported.</span>
<span class="cm"> * hl_hdrlen    Space to preserve in sk_buff&#39;s when sending. Drivers, not</span>
<span class="cm"> *              supporting sk_buff&#39;s should set this to 0.</span>
<span class="cm"> * command      Address of Command-Handler.</span>
<span class="cm"> * features     Bitwise coded Features of this driver. (use ISDN_FEATURE_...)</span>
<span class="cm"> * writebuf_skb Address of Skbuff-Send-Handler.</span>
<span class="cm"> * writecmd        &quot;    &quot;  D-Channel  &quot; which accepts raw D-Ch-Commands.</span>
<span class="cm"> * readstat        &quot;    &quot;  D-Channel  &quot; which delivers raw Status-Data.</span>
<span class="cm"> *</span>
<span class="cm"> * The linklevel-driver fills the following fields:</span>
<span class="cm"> *</span>
<span class="cm"> * channels      Driver-ID assigned to this driver. (Must be used on all</span>
<span class="cm"> *               subsequent callbacks.</span>
<span class="cm"> * rcvcallb_skb  Address of handler for received Skbuff&#39;s.</span>
<span class="cm"> * statcallb        &quot;    &quot;     &quot;    for status-changes.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">register_isdn</span><span class="p">(</span><span class="n">isdn_if</span><span class="o">*</span><span class="p">);</span>
<span class="cp">#include &lt;asm/uaccess.h&gt;</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ISDNIF_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
