<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › init_task.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>init_task.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _LINUX__INIT_TASK_H</span>
<span class="cp">#define _LINUX__INIT_TASK_H</span>

<span class="cp">#include &lt;linux/rcupdate.h&gt;</span>
<span class="cp">#include &lt;linux/irqflags.h&gt;</span>
<span class="cp">#include &lt;linux/utsname.h&gt;</span>
<span class="cp">#include &lt;linux/lockdep.h&gt;</span>
<span class="cp">#include &lt;linux/ftrace.h&gt;</span>
<span class="cp">#include &lt;linux/ipc.h&gt;</span>
<span class="cp">#include &lt;linux/pid_namespace.h&gt;</span>
<span class="cp">#include &lt;linux/user_namespace.h&gt;</span>
<span class="cp">#include &lt;linux/securebits.h&gt;</span>
<span class="cp">#include &lt;net/net_namespace.h&gt;</span>

<span class="cp">#ifdef CONFIG_SMP</span>
<span class="cp"># define INIT_PUSHABLE_TASKS(tsk)					\</span>
<span class="cp">	.pushable_tasks = PLIST_NODE_INIT(tsk.pushable_tasks, MAX_PRIO),</span>
<span class="cp">#else</span>
<span class="cp"># define INIT_PUSHABLE_TASKS(tsk)</span>
<span class="cp">#endif</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">files_struct</span> <span class="n">init_files</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">fs_struct</span> <span class="n">init_fs</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_CGROUPS</span>
<span class="cp">#define INIT_GROUP_RWSEM(sig)						\</span>
<span class="cp">	.group_rwsem = __RWSEM_INITIALIZER(sig.group_rwsem),</span>
<span class="cp">#else</span>
<span class="cp">#define INIT_GROUP_RWSEM(sig)</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_CPUSETS</span>
<span class="cp">#define INIT_CPUSET_SEQ							\</span>
<span class="cp">	.mems_allowed_seq = SEQCNT_ZERO,</span>
<span class="cp">#else</span>
<span class="cp">#define INIT_CPUSET_SEQ</span>
<span class="cp">#endif</span>

<span class="cp">#define INIT_SIGNALS(sig) {						\</span>
<span class="cp">	.nr_threads	= 1,						\</span>
<span class="cp">	.wait_chldexit	= __WAIT_QUEUE_HEAD_INITIALIZER(sig.wait_chldexit),\</span>
<span class="cp">	.shared_pending	= { 						\</span>
<span class="cp">		.list = LIST_HEAD_INIT(sig.shared_pending.list),	\</span>
<span class="cp">		.signal =  {{0}}},					\</span>
<span class="cp">	.posix_timers	 = LIST_HEAD_INIT(sig.posix_timers),		\</span>
<span class="cp">	.cpu_timers	= INIT_CPU_TIMERS(sig.cpu_timers),		\</span>
<span class="cp">	.rlim		= INIT_RLIMITS,					\</span>
<span class="cp">	.cputimer	= { 						\</span>
<span class="cp">		.cputime = INIT_CPUTIME,				\</span>
<span class="cp">		.running = 0,						\</span>
<span class="cp">		.lock = __RAW_SPIN_LOCK_UNLOCKED(sig.cputimer.lock),	\</span>
<span class="cp">	},								\</span>
<span class="cp">	.cred_guard_mutex =						\</span>
<span class="cp">		 __MUTEX_INITIALIZER(sig.cred_guard_mutex),		\</span>
<span class="cp">	INIT_GROUP_RWSEM(sig)						\</span>
<span class="cp">}</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">nsproxy</span> <span class="n">init_nsproxy</span><span class="p">;</span>

<span class="cp">#define INIT_SIGHAND(sighand) {						\</span>
<span class="cp">	.count		= ATOMIC_INIT(1), 				\</span>
<span class="cp">	.action		= { { { .sa_handler = SIG_DFL, } }, },		\</span>
<span class="cp">	.siglock	= __SPIN_LOCK_UNLOCKED(sighand.siglock),	\</span>
<span class="cp">	.signalfd_wqh	= __WAIT_QUEUE_HEAD_INITIALIZER(sighand.signalfd_wqh),	\</span>
<span class="cp">}</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">group_info</span> <span class="n">init_groups</span><span class="p">;</span>

<span class="cp">#define INIT_STRUCT_PID {						\</span>
<span class="cp">	.count 		= ATOMIC_INIT(1),				\</span>
<span class="cp">	.tasks		= {						\</span>
<span class="cp">		{ .first = NULL },					\</span>
<span class="cp">		{ .first = NULL },					\</span>
<span class="cp">		{ .first = NULL },					\</span>
<span class="cp">	},								\</span>
<span class="cp">	.level		= 0,						\</span>
<span class="cp">	.numbers	= { {						\</span>
<span class="cp">		.nr		= 0,					\</span>
<span class="cp">		.ns		= &amp;init_pid_ns,				\</span>
<span class="cp">		.pid_chain	= { .next = NULL, .pprev = NULL },	\</span>
<span class="cp">	}, }								\</span>
<span class="cp">}</span>

<span class="cp">#define INIT_PID_LINK(type) 					\</span>
<span class="cp">{								\</span>
<span class="cp">	.node = {						\</span>
<span class="cp">		.next = NULL,					\</span>
<span class="cp">		.pprev = NULL,					\</span>
<span class="cp">	},							\</span>
<span class="cp">	.pid = &amp;init_struct_pid,				\</span>
<span class="cp">}</span>

<span class="cp">#ifdef CONFIG_AUDITSYSCALL</span>
<span class="cp">#define INIT_IDS \</span>
<span class="cp">	.loginuid = -1, \</span>
<span class="cp">	.sessionid = -1,</span>
<span class="cp">#else</span>
<span class="cp">#define INIT_IDS</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_RCU_BOOST</span>
<span class="cp">#define INIT_TASK_RCU_BOOST()						\</span>
<span class="cp">	.rcu_boost_mutex = NULL,</span>
<span class="cp">#else</span>
<span class="cp">#define INIT_TASK_RCU_BOOST()</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_TREE_PREEMPT_RCU</span>
<span class="cp">#define INIT_TASK_RCU_TREE_PREEMPT()					\</span>
<span class="cp">	.rcu_blocked_node = NULL,</span>
<span class="cp">#else</span>
<span class="cp">#define INIT_TASK_RCU_TREE_PREEMPT(tsk)</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_PREEMPT_RCU</span>
<span class="cp">#define INIT_TASK_RCU_PREEMPT(tsk)					\</span>
<span class="cp">	.rcu_read_lock_nesting = 0,					\</span>
<span class="cp">	.rcu_read_unlock_special = 0,					\</span>
<span class="cp">	.rcu_node_entry = LIST_HEAD_INIT(tsk.rcu_node_entry),		\</span>
<span class="cp">	INIT_TASK_RCU_TREE_PREEMPT()					\</span>
<span class="cp">	INIT_TASK_RCU_BOOST()</span>
<span class="cp">#else</span>
<span class="cp">#define INIT_TASK_RCU_PREEMPT(tsk)</span>
<span class="cp">#endif</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">cred</span> <span class="n">init_cred</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_PERF_EVENTS</span>
<span class="cp"># define INIT_PERF_EVENTS(tsk)					\</span>
<span class="cp">	.perf_event_mutex = 						\</span>
<span class="cp">		 __MUTEX_INITIALIZER(tsk.perf_event_mutex),		\</span>
<span class="cp">	.perf_event_list = LIST_HEAD_INIT(tsk.perf_event_list),</span>
<span class="cp">#else</span>
<span class="cp"># define INIT_PERF_EVENTS(tsk)</span>
<span class="cp">#endif</span>

<span class="cp">#define INIT_TASK_COMM &quot;swapper&quot;</span>

<span class="cm">/*</span>
<span class="cm"> *  INIT_TASK is used to set up the first task table, touch at</span>
<span class="cm"> * your own risk!. Base=0, limit=0x1fffff (=2MB)</span>
<span class="cm"> */</span>
<span class="cp">#define INIT_TASK(tsk)	\</span>
<span class="cp">{									\</span>
<span class="cp">	.state		= 0,						\</span>
<span class="cp">	.stack		= &amp;init_thread_info,				\</span>
<span class="cp">	.usage		= ATOMIC_INIT(2),				\</span>
<span class="cp">	.flags		= PF_KTHREAD,					\</span>
<span class="cp">	.prio		= MAX_PRIO-20,					\</span>
<span class="cp">	.static_prio	= MAX_PRIO-20,					\</span>
<span class="cp">	.normal_prio	= MAX_PRIO-20,					\</span>
<span class="cp">	.policy		= SCHED_NORMAL,					\</span>
<span class="cp">	.cpus_allowed	= CPU_MASK_ALL,					\</span>
<span class="cp">	.nr_cpus_allowed= NR_CPUS,					\</span>
<span class="cp">	.mm		= NULL,						\</span>
<span class="cp">	.active_mm	= &amp;init_mm,					\</span>
<span class="cp">	.se		= {						\</span>
<span class="cp">		.group_node 	= LIST_HEAD_INIT(tsk.se.group_node),	\</span>
<span class="cp">	},								\</span>
<span class="cp">	.rt		= {						\</span>
<span class="cp">		.run_list	= LIST_HEAD_INIT(tsk.rt.run_list),	\</span>
<span class="cp">		.time_slice	= RR_TIMESLICE,				\</span>
<span class="cp">	},								\</span>
<span class="cp">	.tasks		= LIST_HEAD_INIT(tsk.tasks),			\</span>
<span class="cp">	INIT_PUSHABLE_TASKS(tsk)					\</span>
<span class="cp">	.ptraced	= LIST_HEAD_INIT(tsk.ptraced),			\</span>
<span class="cp">	.ptrace_entry	= LIST_HEAD_INIT(tsk.ptrace_entry),		\</span>
<span class="cp">	.real_parent	= &amp;tsk,						\</span>
<span class="cp">	.parent		= &amp;tsk,						\</span>
<span class="cp">	.children	= LIST_HEAD_INIT(tsk.children),			\</span>
<span class="cp">	.sibling	= LIST_HEAD_INIT(tsk.sibling),			\</span>
<span class="cp">	.group_leader	= &amp;tsk,						\</span>
<span class="cp">	RCU_INIT_POINTER(.real_cred, &amp;init_cred),			\</span>
<span class="cp">	RCU_INIT_POINTER(.cred, &amp;init_cred),				\</span>
<span class="cp">	.comm		= INIT_TASK_COMM,				\</span>
<span class="cp">	.thread		= INIT_THREAD,					\</span>
<span class="cp">	.fs		= &amp;init_fs,					\</span>
<span class="cp">	.files		= &amp;init_files,					\</span>
<span class="cp">	.signal		= &amp;init_signals,				\</span>
<span class="cp">	.sighand	= &amp;init_sighand,				\</span>
<span class="cp">	.nsproxy	= &amp;init_nsproxy,				\</span>
<span class="cp">	.pending	= {						\</span>
<span class="cp">		.list = LIST_HEAD_INIT(tsk.pending.list),		\</span>
<span class="cp">		.signal = {{0}}},					\</span>
<span class="cp">	.blocked	= {{0}},					\</span>
<span class="cp">	.alloc_lock	= __SPIN_LOCK_UNLOCKED(tsk.alloc_lock),		\</span>
<span class="cp">	.journal_info	= NULL,						\</span>
<span class="cp">	.cpu_timers	= INIT_CPU_TIMERS(tsk.cpu_timers),		\</span>
<span class="cp">	.pi_lock	= __RAW_SPIN_LOCK_UNLOCKED(tsk.pi_lock),	\</span>
<span class="cp">	.timer_slack_ns = 50000, </span><span class="cm">/* 50 usec default slack */</span><span class="cp">		\</span>
<span class="cp">	.pids = {							\</span>
<span class="cp">		[PIDTYPE_PID]  = INIT_PID_LINK(PIDTYPE_PID),		\</span>
<span class="cp">		[PIDTYPE_PGID] = INIT_PID_LINK(PIDTYPE_PGID),		\</span>
<span class="cp">		[PIDTYPE_SID]  = INIT_PID_LINK(PIDTYPE_SID),		\</span>
<span class="cp">	},								\</span>
<span class="cp">	.thread_group	= LIST_HEAD_INIT(tsk.thread_group),		\</span>
<span class="cp">	INIT_IDS							\</span>
<span class="cp">	INIT_PERF_EVENTS(tsk)						\</span>
<span class="cp">	INIT_TRACE_IRQFLAGS						\</span>
<span class="cp">	INIT_LOCKDEP							\</span>
<span class="cp">	INIT_FTRACE_GRAPH						\</span>
<span class="cp">	INIT_TRACE_RECURSION						\</span>
<span class="cp">	INIT_TASK_RCU_PREEMPT(tsk)					\</span>
<span class="cp">	INIT_CPUSET_SEQ							\</span>
<span class="cp">}</span>


<span class="cp">#define INIT_CPU_TIMERS(cpu_timers)					\</span>
<span class="cp">{									\</span>
<span class="cp">	LIST_HEAD_INIT(cpu_timers[0]),					\</span>
<span class="cp">	LIST_HEAD_INIT(cpu_timers[1]),					\</span>
<span class="cp">	LIST_HEAD_INIT(cpu_timers[2]),					\</span>
<span class="cp">}</span>

<span class="cm">/* Attach to the init_task data structure for proper alignment */</span>
<span class="cp">#define __init_task_data __attribute__((__section__(&quot;.data..init_task&quot;)))</span>


<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
