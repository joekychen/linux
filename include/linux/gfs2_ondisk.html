<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › gfs2_ondisk.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>gfs2_ondisk.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) Sistina Software, Inc.  1997-2003 All rights reserved.</span>
<span class="cm"> * Copyright (C) 2004-2006 Red Hat, Inc.  All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This copyrighted material is made available to anyone wishing to use,</span>
<span class="cm"> * modify, copy, or redistribute it subject to the terms and conditions</span>
<span class="cm"> * of the GNU General Public License v.2.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __GFS2_ONDISK_DOT_H__</span>
<span class="cp">#define __GFS2_ONDISK_DOT_H__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#define GFS2_MAGIC		0x01161970</span>
<span class="cp">#define GFS2_BASIC_BLOCK	512</span>
<span class="cp">#define GFS2_BASIC_BLOCK_SHIFT	9</span>

<span class="cm">/* Lock numbers of the LM_TYPE_NONDISK type */</span>

<span class="cp">#define GFS2_MOUNT_LOCK		0</span>
<span class="cp">#define GFS2_LIVE_LOCK		1</span>
<span class="cp">#define GFS2_TRANS_LOCK		2</span>
<span class="cp">#define GFS2_RENAME_LOCK	3</span>
<span class="cp">#define GFS2_CONTROL_LOCK	4</span>
<span class="cp">#define GFS2_MOUNTED_LOCK	5</span>

<span class="cm">/* Format numbers for various metadata types */</span>

<span class="cp">#define GFS2_FORMAT_NONE	0</span>
<span class="cp">#define GFS2_FORMAT_SB		100</span>
<span class="cp">#define GFS2_FORMAT_RG		200</span>
<span class="cp">#define GFS2_FORMAT_RB		300</span>
<span class="cp">#define GFS2_FORMAT_DI		400</span>
<span class="cp">#define GFS2_FORMAT_IN		500</span>
<span class="cp">#define GFS2_FORMAT_LF		600</span>
<span class="cp">#define GFS2_FORMAT_JD		700</span>
<span class="cp">#define GFS2_FORMAT_LH		800</span>
<span class="cp">#define GFS2_FORMAT_LD		900</span>
<span class="cp">#define GFS2_FORMAT_LB		1000</span>
<span class="cp">#define GFS2_FORMAT_EA		1600</span>
<span class="cp">#define GFS2_FORMAT_ED		1700</span>
<span class="cp">#define GFS2_FORMAT_QC		1400</span>
<span class="cm">/* These are format numbers for entities contained in files */</span>
<span class="cp">#define GFS2_FORMAT_RI		1100</span>
<span class="cp">#define GFS2_FORMAT_DE		1200</span>
<span class="cp">#define GFS2_FORMAT_QU		1500</span>
<span class="cm">/* These are part of the superblock */</span>
<span class="cp">#define GFS2_FORMAT_FS		1801</span>
<span class="cp">#define GFS2_FORMAT_MULTI	1900</span>

<span class="cm">/*</span>
<span class="cm"> * An on-disk inode number</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">gfs2_inum</span> <span class="p">{</span>
	<span class="n">__be64</span> <span class="n">no_formal_ino</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">no_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Generic metadata head structure</span>
<span class="cm"> * Every inplace buffer logged in the journal must start with this.</span>
<span class="cm"> */</span>

<span class="cp">#define GFS2_METATYPE_NONE	0</span>
<span class="cp">#define GFS2_METATYPE_SB	1</span>
<span class="cp">#define GFS2_METATYPE_RG	2</span>
<span class="cp">#define GFS2_METATYPE_RB	3</span>
<span class="cp">#define GFS2_METATYPE_DI	4</span>
<span class="cp">#define GFS2_METATYPE_IN	5</span>
<span class="cp">#define GFS2_METATYPE_LF	6</span>
<span class="cp">#define GFS2_METATYPE_JD	7</span>
<span class="cp">#define GFS2_METATYPE_LH	8</span>
<span class="cp">#define GFS2_METATYPE_LD	9</span>
<span class="cp">#define GFS2_METATYPE_LB	12</span>
<span class="cp">#define GFS2_METATYPE_EA	10</span>
<span class="cp">#define GFS2_METATYPE_ED	11</span>
<span class="cp">#define GFS2_METATYPE_QC	14</span>

<span class="k">struct</span> <span class="n">gfs2_meta_header</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="n">mh_magic</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">mh_type</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">__pad0</span><span class="p">;</span>		<span class="cm">/* Was generation number in gfs1 */</span>
	<span class="n">__be32</span> <span class="n">mh_format</span><span class="p">;</span>
	<span class="cm">/* This union is to keep userspace happy */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">__be32</span> <span class="n">mh_jid</span><span class="p">;</span>		<span class="cm">/* Was incarnation number in gfs1 */</span>
		<span class="n">__be32</span> <span class="n">__pad1</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * super-block structure</span>
<span class="cm"> *</span>
<span class="cm"> * It&#39;s probably good if SIZEOF_SB &lt;= GFS2_BASIC_BLOCK (512 bytes)</span>
<span class="cm"> *</span>
<span class="cm"> * Order is important, need to be able to read old superblocks to do on-disk</span>
<span class="cm"> * version upgrades.</span>
<span class="cm"> */</span>

<span class="cm">/* Address of superblock in GFS2 basic blocks */</span>
<span class="cp">#define GFS2_SB_ADDR		128</span>

<span class="cm">/* The lock number for the superblock (must be zero) */</span>
<span class="cp">#define GFS2_SB_LOCK		0</span>

<span class="cm">/* Requirement:  GFS2_LOCKNAME_LEN % 8 == 0</span>
<span class="cm">   Includes: the fencing zero at the end */</span>
<span class="cp">#define GFS2_LOCKNAME_LEN	64</span>

<span class="k">struct</span> <span class="n">gfs2_sb</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gfs2_meta_header</span> <span class="n">sb_header</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">sb_fs_format</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">sb_multihost_format</span><span class="p">;</span>
	<span class="n">__u32</span>  <span class="n">__pad0</span><span class="p">;</span>	<span class="cm">/* Was superblock flags in gfs1 */</span>

	<span class="n">__be32</span> <span class="n">sb_bsize</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">sb_bsize_shift</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">__pad1</span><span class="p">;</span>	<span class="cm">/* Was journal segment size in gfs1 */</span>

	<span class="k">struct</span> <span class="n">gfs2_inum</span> <span class="n">sb_master_dir</span><span class="p">;</span> <span class="cm">/* Was jindex dinode in gfs1 */</span>
	<span class="k">struct</span> <span class="n">gfs2_inum</span> <span class="n">__pad2</span><span class="p">;</span> <span class="cm">/* Was rindex dinode in gfs1 */</span>
	<span class="k">struct</span> <span class="n">gfs2_inum</span> <span class="n">sb_root_dir</span><span class="p">;</span>

	<span class="kt">char</span> <span class="n">sb_lockproto</span><span class="p">[</span><span class="n">GFS2_LOCKNAME_LEN</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">sb_locktable</span><span class="p">[</span><span class="n">GFS2_LOCKNAME_LEN</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">gfs2_inum</span> <span class="n">__pad3</span><span class="p">;</span> <span class="cm">/* Was quota inode in gfs1 */</span>
	<span class="k">struct</span> <span class="n">gfs2_inum</span> <span class="n">__pad4</span><span class="p">;</span> <span class="cm">/* Was licence inode in gfs1 */</span>
<span class="cp">#define GFS2_HAS_UUID 1</span>
	<span class="n">__u8</span> <span class="n">sb_uuid</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span> <span class="cm">/* The UUID, maybe 0 for backwards compat */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * resource index structure</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">gfs2_rindex</span> <span class="p">{</span>
	<span class="n">__be64</span> <span class="n">ri_addr</span><span class="p">;</span>	<span class="cm">/* grp block disk address */</span>
	<span class="n">__be32</span> <span class="n">ri_length</span><span class="p">;</span>	<span class="cm">/* length of rgrp header in fs blocks */</span>
	<span class="n">__u32</span> <span class="n">__pad</span><span class="p">;</span>

	<span class="n">__be64</span> <span class="n">ri_data0</span><span class="p">;</span>	<span class="cm">/* first data location */</span>
	<span class="n">__be32</span> <span class="n">ri_data</span><span class="p">;</span>	<span class="cm">/* num of data blocks in rgrp */</span>

	<span class="n">__be32</span> <span class="n">ri_bitbytes</span><span class="p">;</span>	<span class="cm">/* number of bytes in data bitmaps */</span>

	<span class="n">__u8</span> <span class="n">ri_reserved</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * resource group header structure</span>
<span class="cm"> */</span>

<span class="cm">/* Number of blocks per byte in rgrp */</span>
<span class="cp">#define GFS2_NBBY		4</span>
<span class="cp">#define GFS2_BIT_SIZE		2</span>
<span class="cp">#define GFS2_BIT_MASK		0x00000003</span>

<span class="cp">#define GFS2_BLKST_FREE		0</span>
<span class="cp">#define GFS2_BLKST_USED		1</span>
<span class="cp">#define GFS2_BLKST_UNLINKED	2</span>
<span class="cp">#define GFS2_BLKST_DINODE	3</span>

<span class="cp">#define GFS2_RGF_JOURNAL	0x00000001</span>
<span class="cp">#define GFS2_RGF_METAONLY	0x00000002</span>
<span class="cp">#define GFS2_RGF_DATAONLY	0x00000004</span>
<span class="cp">#define GFS2_RGF_NOALLOC	0x00000008</span>
<span class="cp">#define GFS2_RGF_TRIMMED	0x00000010</span>

<span class="k">struct</span> <span class="n">gfs2_rgrp</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gfs2_meta_header</span> <span class="n">rg_header</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">rg_flags</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">rg_free</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">rg_dinodes</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">__pad</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">rg_igeneration</span><span class="p">;</span>

	<span class="n">__u8</span> <span class="n">rg_reserved</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span> <span class="cm">/* Several fields from gfs1 now reserved */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * quota structure</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">gfs2_quota</span> <span class="p">{</span>
	<span class="n">__be64</span> <span class="n">qu_limit</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">qu_warn</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">qu_value</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">qu_reserved</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * dinode structure</span>
<span class="cm"> */</span>

<span class="cp">#define GFS2_MAX_META_HEIGHT	10</span>
<span class="cp">#define GFS2_DIR_MAX_DEPTH	17</span>

<span class="cp">#define DT2IF(dt) (((dt) &lt;&lt; 12) &amp; S_IFMT)</span>
<span class="cp">#define IF2DT(sif) (((sif) &amp; S_IFMT) &gt;&gt; 12)</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">gfs2fl_Jdata</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">gfs2fl_ExHash</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">gfs2fl_Unused</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">gfs2fl_EaIndirect</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">gfs2fl_Directio</span>		<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">gfs2fl_Immutable</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">gfs2fl_AppendOnly</span>	<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">gfs2fl_NoAtime</span>		<span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">gfs2fl_Sync</span>		<span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="n">gfs2fl_System</span>		<span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
	<span class="n">gfs2fl_TruncInProg</span>	<span class="o">=</span> <span class="mi">29</span><span class="p">,</span>
	<span class="n">gfs2fl_InheritDirectio</span>	<span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
	<span class="n">gfs2fl_InheritJdata</span>	<span class="o">=</span> <span class="mi">31</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Dinode flags */</span>
<span class="cp">#define GFS2_DIF_JDATA			0x00000001</span>
<span class="cp">#define GFS2_DIF_EXHASH			0x00000002</span>
<span class="cp">#define GFS2_DIF_UNUSED			0x00000004  </span><span class="cm">/* only in gfs1 */</span><span class="cp"></span>
<span class="cp">#define GFS2_DIF_EA_INDIRECT		0x00000008</span>
<span class="cp">#define GFS2_DIF_DIRECTIO		0x00000010</span>
<span class="cp">#define GFS2_DIF_IMMUTABLE		0x00000020</span>
<span class="cp">#define GFS2_DIF_APPENDONLY		0x00000040</span>
<span class="cp">#define GFS2_DIF_NOATIME		0x00000080</span>
<span class="cp">#define GFS2_DIF_SYNC			0x00000100</span>
<span class="cp">#define GFS2_DIF_SYSTEM			0x00000200 </span><span class="cm">/* New in gfs2 */</span><span class="cp"></span>
<span class="cp">#define GFS2_DIF_TRUNC_IN_PROG		0x20000000 </span><span class="cm">/* New in gfs2 */</span><span class="cp"></span>
<span class="cp">#define GFS2_DIF_INHERIT_DIRECTIO	0x40000000</span>
<span class="cp">#define GFS2_DIF_INHERIT_JDATA		0x80000000</span>

<span class="k">struct</span> <span class="n">gfs2_dinode</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gfs2_meta_header</span> <span class="n">di_header</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">gfs2_inum</span> <span class="n">di_num</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">di_mode</span><span class="p">;</span>	<span class="cm">/* mode of file */</span>
	<span class="n">__be32</span> <span class="n">di_uid</span><span class="p">;</span>	<span class="cm">/* owner&#39;s user id */</span>
	<span class="n">__be32</span> <span class="n">di_gid</span><span class="p">;</span>	<span class="cm">/* owner&#39;s group id */</span>
	<span class="n">__be32</span> <span class="n">di_nlink</span><span class="p">;</span>	<span class="cm">/* number of links to this file */</span>
	<span class="n">__be64</span> <span class="n">di_size</span><span class="p">;</span>	<span class="cm">/* number of bytes in file */</span>
	<span class="n">__be64</span> <span class="n">di_blocks</span><span class="p">;</span>	<span class="cm">/* number of blocks in file */</span>
	<span class="n">__be64</span> <span class="n">di_atime</span><span class="p">;</span>	<span class="cm">/* time last accessed */</span>
	<span class="n">__be64</span> <span class="n">di_mtime</span><span class="p">;</span>	<span class="cm">/* time last modified */</span>
	<span class="n">__be64</span> <span class="n">di_ctime</span><span class="p">;</span>	<span class="cm">/* time last changed */</span>
	<span class="n">__be32</span> <span class="n">di_major</span><span class="p">;</span>	<span class="cm">/* device major number */</span>
	<span class="n">__be32</span> <span class="n">di_minor</span><span class="p">;</span>	<span class="cm">/* device minor number */</span>

	<span class="cm">/* This section varies from gfs1. Padding added to align with</span>
<span class="cm">         * remainder of dinode</span>
<span class="cm">	 */</span>
	<span class="n">__be64</span> <span class="n">di_goal_meta</span><span class="p">;</span>	<span class="cm">/* rgrp to alloc from next */</span>
	<span class="n">__be64</span> <span class="n">di_goal_data</span><span class="p">;</span>	<span class="cm">/* data block goal */</span>
	<span class="n">__be64</span> <span class="n">di_generation</span><span class="p">;</span>	<span class="cm">/* generation number for NFS */</span>

	<span class="n">__be32</span> <span class="n">di_flags</span><span class="p">;</span>	<span class="cm">/* GFS2_DIF_... */</span>
	<span class="n">__be32</span> <span class="n">di_payload_format</span><span class="p">;</span>  <span class="cm">/* GFS2_FORMAT_... */</span>
	<span class="n">__u16</span> <span class="n">__pad1</span><span class="p">;</span>	<span class="cm">/* Was ditype in gfs1 */</span>
	<span class="n">__be16</span> <span class="n">di_height</span><span class="p">;</span>	<span class="cm">/* height of metadata */</span>
	<span class="n">__u32</span> <span class="n">__pad2</span><span class="p">;</span>	<span class="cm">/* Unused incarnation number from gfs1 */</span>

	<span class="cm">/* These only apply to directories  */</span>
	<span class="n">__u16</span> <span class="n">__pad3</span><span class="p">;</span>	<span class="cm">/* Padding */</span>
	<span class="n">__be16</span> <span class="n">di_depth</span><span class="p">;</span>	<span class="cm">/* Number of bits in the table */</span>
	<span class="n">__be32</span> <span class="n">di_entries</span><span class="p">;</span>	<span class="cm">/* The number of entries in the directory */</span>

	<span class="k">struct</span> <span class="n">gfs2_inum</span> <span class="n">__pad4</span><span class="p">;</span> <span class="cm">/* Unused even in current gfs1 */</span>

	<span class="n">__be64</span> <span class="n">di_eattr</span><span class="p">;</span>	<span class="cm">/* extended attribute block number */</span>
	<span class="n">__be32</span> <span class="n">di_atime_nsec</span><span class="p">;</span>   <span class="cm">/* nsec portion of atime */</span>
	<span class="n">__be32</span> <span class="n">di_mtime_nsec</span><span class="p">;</span>   <span class="cm">/* nsec portion of mtime */</span>
	<span class="n">__be32</span> <span class="n">di_ctime_nsec</span><span class="p">;</span>   <span class="cm">/* nsec portion of ctime */</span>

	<span class="n">__u8</span> <span class="n">di_reserved</span><span class="p">[</span><span class="mi">44</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * directory structure - many of these per directory file</span>
<span class="cm"> */</span>

<span class="cp">#define GFS2_FNAMESIZE		255</span>
<span class="cp">#define GFS2_DIRENT_SIZE(name_len) ((sizeof(struct gfs2_dirent) + (name_len) + 7) &amp; ~7)</span>

<span class="k">struct</span> <span class="n">gfs2_dirent</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gfs2_inum</span> <span class="n">de_inum</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">de_hash</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">de_rec_len</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">de_name_len</span><span class="p">;</span>
	<span class="n">__be16</span> <span class="n">de_type</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">__pad</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Header of leaf directory nodes</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">gfs2_leaf</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gfs2_meta_header</span> <span class="n">lf_header</span><span class="p">;</span>

	<span class="n">__be16</span> <span class="n">lf_depth</span><span class="p">;</span>		<span class="cm">/* Depth of leaf */</span>
	<span class="n">__be16</span> <span class="n">lf_entries</span><span class="p">;</span>		<span class="cm">/* Number of dirents in leaf */</span>
	<span class="n">__be32</span> <span class="n">lf_dirent_format</span><span class="p">;</span>	<span class="cm">/* Format of the dirents */</span>
	<span class="n">__be64</span> <span class="n">lf_next</span><span class="p">;</span>			<span class="cm">/* Next leaf, if overflow */</span>

	<span class="n">__u8</span> <span class="n">lf_reserved</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Extended attribute header format</span>
<span class="cm"> *</span>
<span class="cm"> * This works in a similar way to dirents. There is a fixed size header</span>
<span class="cm"> * followed by a variable length section made up of the name and the</span>
<span class="cm"> * associated data. In the case of a &quot;stuffed&quot; entry, the value is</span>
<span class="cm"> * inline directly after the name, the ea_num_ptrs entry will be</span>
<span class="cm"> * zero in that case. For non-&quot;stuffed&quot; entries, there will be</span>
<span class="cm"> * a set of pointers (aligned to 8 byte boundary) to the block(s)</span>
<span class="cm"> * containing the value.</span>
<span class="cm"> *</span>
<span class="cm"> * The blocks containing the values and the blocks containing the</span>
<span class="cm"> * extended attribute headers themselves all start with the common</span>
<span class="cm"> * metadata header. Each inode, if it has extended attributes, will</span>
<span class="cm"> * have either a single block containing the extended attribute headers</span>
<span class="cm"> * or a single indirect block pointing to blocks containing the</span>
<span class="cm"> * extended attribure headers.</span>
<span class="cm"> *</span>
<span class="cm"> * The maximim size of the data part of an extended attribute is 64k</span>
<span class="cm"> * so the number of blocks required depends upon block size. Since the</span>
<span class="cm"> * block size also determines the number of pointers in an indirect</span>
<span class="cm"> * block, its a fairly complicated calculation to work out the maximum</span>
<span class="cm"> * number of blocks that an inode may have relating to extended attributes.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#define GFS2_EA_MAX_NAME_LEN	255</span>
<span class="cp">#define GFS2_EA_MAX_DATA_LEN	65536</span>

<span class="cp">#define GFS2_EATYPE_UNUSED	0</span>
<span class="cp">#define GFS2_EATYPE_USR		1</span>
<span class="cp">#define GFS2_EATYPE_SYS		2</span>
<span class="cp">#define GFS2_EATYPE_SECURITY	3</span>

<span class="cp">#define GFS2_EATYPE_LAST	3</span>
<span class="cp">#define GFS2_EATYPE_VALID(x)	((x) &lt;= GFS2_EATYPE_LAST)</span>

<span class="cp">#define GFS2_EAFLAG_LAST	0x01	</span><span class="cm">/* last ea in block */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">gfs2_ea_header</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="n">ea_rec_len</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">ea_data_len</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="n">ea_name_len</span><span class="p">;</span>	<span class="cm">/* no NULL pointer after the string */</span>
	<span class="n">__u8</span> <span class="n">ea_type</span><span class="p">;</span>		<span class="cm">/* GFS2_EATYPE_... */</span>
	<span class="n">__u8</span> <span class="n">ea_flags</span><span class="p">;</span>		<span class="cm">/* GFS2_EAFLAG_... */</span>
	<span class="n">__u8</span> <span class="n">ea_num_ptrs</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">__pad</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Log header structure</span>
<span class="cm"> */</span>

<span class="cp">#define GFS2_LOG_HEAD_UNMOUNT	0x00000001	</span><span class="cm">/* log is clean */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">gfs2_log_header</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gfs2_meta_header</span> <span class="n">lh_header</span><span class="p">;</span>

	<span class="n">__be64</span> <span class="n">lh_sequence</span><span class="p">;</span>	<span class="cm">/* Sequence number of this transaction */</span>
	<span class="n">__be32</span> <span class="n">lh_flags</span><span class="p">;</span>	<span class="cm">/* GFS2_LOG_HEAD_... */</span>
	<span class="n">__be32</span> <span class="n">lh_tail</span><span class="p">;</span>		<span class="cm">/* Block number of log tail */</span>
	<span class="n">__be32</span> <span class="n">lh_blkno</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">lh_hash</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Log type descriptor</span>
<span class="cm"> */</span>

<span class="cp">#define GFS2_LOG_DESC_METADATA	300</span>
<span class="cm">/* ld_data1 is the number of metadata blocks in the descriptor.</span>
<span class="cm">   ld_data2 is unused. */</span>

<span class="cp">#define GFS2_LOG_DESC_REVOKE	301</span>
<span class="cm">/* ld_data1 is the number of revoke blocks in the descriptor.</span>
<span class="cm">   ld_data2 is unused. */</span>

<span class="cp">#define GFS2_LOG_DESC_JDATA	302</span>
<span class="cm">/* ld_data1 is the number of data blocks in the descriptor.</span>
<span class="cm">   ld_data2 is unused. */</span>

<span class="k">struct</span> <span class="n">gfs2_log_descriptor</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gfs2_meta_header</span> <span class="n">ld_header</span><span class="p">;</span>

	<span class="n">__be32</span> <span class="n">ld_type</span><span class="p">;</span>		<span class="cm">/* GFS2_LOG_DESC_... */</span>
	<span class="n">__be32</span> <span class="n">ld_length</span><span class="p">;</span>	<span class="cm">/* Number of buffers in this chunk */</span>
	<span class="n">__be32</span> <span class="n">ld_data1</span><span class="p">;</span>	<span class="cm">/* descriptor-specific field */</span>
	<span class="n">__be32</span> <span class="n">ld_data2</span><span class="p">;</span>	<span class="cm">/* descriptor-specific field */</span>

	<span class="n">__u8</span> <span class="n">ld_reserved</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Inum Range</span>
<span class="cm"> * Describe a range of formal inode numbers allocated to</span>
<span class="cm"> * one machine to assign to inodes.</span>
<span class="cm"> */</span>

<span class="cp">#define GFS2_INUM_QUANTUM	1048576</span>

<span class="k">struct</span> <span class="n">gfs2_inum_range</span> <span class="p">{</span>
	<span class="n">__be64</span> <span class="n">ir_start</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">ir_length</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Statfs change</span>
<span class="cm"> * Describes an change to the pool of free and allocated</span>
<span class="cm"> * blocks.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">gfs2_statfs_change</span> <span class="p">{</span>
	<span class="n">__be64</span> <span class="n">sc_total</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">sc_free</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="n">sc_dinodes</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Quota change</span>
<span class="cm"> * Describes an allocation change for a particular</span>
<span class="cm"> * user or group.</span>
<span class="cm"> */</span>

<span class="cp">#define GFS2_QCF_USER		0x00000001</span>

<span class="k">struct</span> <span class="n">gfs2_quota_change</span> <span class="p">{</span>
	<span class="n">__be64</span> <span class="n">qc_change</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">qc_flags</span><span class="p">;</span>	<span class="cm">/* GFS2_QCF_... */</span>
	<span class="n">__be32</span> <span class="n">qc_id</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_quota_lvb</span> <span class="p">{</span>
        <span class="n">__be32</span> <span class="n">qb_magic</span><span class="p">;</span>
        <span class="n">__u32</span> <span class="n">__pad</span><span class="p">;</span>
        <span class="n">__be64</span> <span class="n">qb_limit</span><span class="p">;</span>      <span class="cm">/* Hard limit of # blocks to alloc */</span>
        <span class="n">__be64</span> <span class="n">qb_warn</span><span class="p">;</span>       <span class="cm">/* Warn user when alloc is above this # */</span>
        <span class="n">__be64</span> <span class="n">qb_value</span><span class="p">;</span>       <span class="cm">/* Current # blocks allocated */</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="cm">/* __GFS2_ONDISK_DOT_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
