<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › lp.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>lp.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _LINUX_LP_H</span>
<span class="cp">#define _LINUX_LP_H</span>

<span class="cm">/*</span>
<span class="cm"> * usr/include/linux/lp.h c.1991-1992 James Wiegand</span>
<span class="cm"> * many modifications copyright (C) 1992 Michael K. Johnson</span>
<span class="cm"> * Interrupt support added 1993 Nigel Gamble</span>
<span class="cm"> * Removed 8255 status defines from inside __KERNEL__ Marcelo Tosatti </span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Per POSIX guidelines, this module reserves the LP and lp prefixes</span>
<span class="cm"> * These are the lp_table[minor].flags flags...</span>
<span class="cm"> */</span>
<span class="cp">#define LP_EXIST 0x0001</span>
<span class="cp">#define LP_SELEC 0x0002</span>
<span class="cp">#define LP_BUSY	 0x0004</span>
<span class="cp">#define LP_BUSY_BIT_POS 2</span>
<span class="cp">#define LP_OFFL	 0x0008</span>
<span class="cp">#define LP_NOPA  0x0010</span>
<span class="cp">#define LP_ERR   0x0020</span>
<span class="cp">#define LP_ABORT 0x0040</span>
<span class="cp">#define LP_CAREFUL 0x0080 </span><span class="cm">/* obsoleted -arca */</span><span class="cp"></span>
<span class="cp">#define LP_ABORTOPEN 0x0100</span>

<span class="cp">#define LP_TRUST_IRQ_  0x0200 </span><span class="cm">/* obsolete */</span><span class="cp"></span>
<span class="cp">#define LP_NO_REVERSE  0x0400 </span><span class="cm">/* No reverse mode available. */</span><span class="cp"></span>
<span class="cp">#define LP_DATA_AVAIL  0x0800 </span><span class="cm">/* Data is available. */</span><span class="cp"></span>

<span class="cm">/* </span>
<span class="cm"> * bit defines for 8255 status port</span>
<span class="cm"> * base + 1</span>
<span class="cm"> * accessed with LP_S(minor), which gets the byte...</span>
<span class="cm"> */</span>
<span class="cp">#define LP_PBUSY	0x80  </span><span class="cm">/* inverted input, active high */</span><span class="cp"></span>
<span class="cp">#define LP_PACK		0x40  </span><span class="cm">/* unchanged input, active low */</span><span class="cp"></span>
<span class="cp">#define LP_POUTPA	0x20  </span><span class="cm">/* unchanged input, active high */</span><span class="cp"></span>
<span class="cp">#define LP_PSELECD	0x10  </span><span class="cm">/* unchanged input, active high */</span><span class="cp"></span>
<span class="cp">#define LP_PERRORP	0x08  </span><span class="cm">/* unchanged input, active low */</span><span class="cp"></span>

<span class="cm">/* timeout for each character.  This is relative to bus cycles -- it</span>
<span class="cm"> * is the count in a busy loop.  THIS IS THE VALUE TO CHANGE if you</span>
<span class="cm"> * have extremely slow printing, or if the machine seems to slow down</span>
<span class="cm"> * a lot when you print.  If you have slow printing, increase this</span>
<span class="cm"> * number and recompile, and if your system gets bogged down, decrease</span>
<span class="cm"> * this number.  This can be changed with the tunelp(8) command as well.</span>
<span class="cm"> */</span>

<span class="cp">#define LP_INIT_CHAR 1000</span>

<span class="cm">/* The parallel port specs apparently say that there needs to be</span>
<span class="cm"> * a .5usec wait before and after the strobe.</span>
<span class="cm"> */</span>

<span class="cp">#define LP_INIT_WAIT 1</span>

<span class="cm">/* This is the amount of time that the driver waits for the printer to</span>
<span class="cm"> * catch up when the printer&#39;s buffer appears to be filled.  If you</span>
<span class="cm"> * want to tune this and have a fast printer (i.e. HPIIIP), decrease</span>
<span class="cm"> * this number, and if you have a slow printer, increase this number.</span>
<span class="cm"> * This is in hundredths of a second, the default 2 being .05 second.</span>
<span class="cm"> * Or use the tunelp(8) command, which is especially nice if you want</span>
<span class="cm"> * change back and forth between character and graphics printing, which</span>
<span class="cm"> * are wildly different...</span>
<span class="cm"> */</span>

<span class="cp">#define LP_INIT_TIME 2</span>

<span class="cm">/* IOCTL numbers */</span>
<span class="cp">#define LPCHAR   0x0601  </span><span class="cm">/* corresponds to LP_INIT_CHAR */</span><span class="cp"></span>
<span class="cp">#define LPTIME   0x0602  </span><span class="cm">/* corresponds to LP_INIT_TIME */</span><span class="cp"></span>
<span class="cp">#define LPABORT  0x0604  </span><span class="cm">/* call with TRUE arg to abort on error,</span>
<span class="cm">			    FALSE to retry.  Default is retry.  */</span><span class="cp"></span>
<span class="cp">#define LPSETIRQ 0x0605  </span><span class="cm">/* call with new IRQ number,</span>
<span class="cm">			    or 0 for polling (no IRQ) */</span><span class="cp"></span>
<span class="cp">#define LPGETIRQ 0x0606  </span><span class="cm">/* get the current IRQ number */</span><span class="cp"></span>
<span class="cp">#define LPWAIT   0x0608  </span><span class="cm">/* corresponds to LP_INIT_WAIT */</span><span class="cp"></span>
<span class="cm">/* NOTE: LPCAREFUL is obsoleted and it&#39; s always the default right now -arca */</span>
<span class="cp">#define LPCAREFUL   0x0609  </span><span class="cm">/* call with TRUE arg to require out-of-paper, off-</span>
<span class="cm">			    line, and error indicators good on all writes,</span>
<span class="cm">			    FALSE to ignore them.  Default is ignore. */</span><span class="cp"></span>
<span class="cp">#define LPABORTOPEN 0x060a  </span><span class="cm">/* call with TRUE arg to abort open() on error,</span>
<span class="cm">			    FALSE to ignore error.  Default is ignore.  */</span><span class="cp"></span>
<span class="cp">#define LPGETSTATUS 0x060b  </span><span class="cm">/* return LP_S(minor) */</span><span class="cp"></span>
<span class="cp">#define LPRESET     0x060c  </span><span class="cm">/* reset printer */</span><span class="cp"></span>
<span class="cp">#ifdef LP_STATS</span>
<span class="cp">#define LPGETSTATS  0x060d  </span><span class="cm">/* get statistics (struct lp_stats) */</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#define LPGETFLAGS  0x060e  </span><span class="cm">/* get status flags */</span><span class="cp"></span>
<span class="cp">#define LPSETTIMEOUT 0x060f </span><span class="cm">/* set parport timeout */</span><span class="cp"></span>

<span class="cm">/* timeout for printk&#39;ing a timeout, in jiffies (100ths of a second).</span>
<span class="cm">   This is also used for re-checking error conditions if LP_ABORT is</span>
<span class="cm">   not set.  This is the default behavior. */</span>

<span class="cp">#define LP_TIMEOUT_INTERRUPT	(60 * HZ)</span>
<span class="cp">#define LP_TIMEOUT_POLLED	(10 * HZ)</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;linux/wait.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>

<span class="cm">/* Magic numbers for defining port-device mappings */</span>
<span class="cp">#define LP_PARPORT_UNSPEC -4</span>
<span class="cp">#define LP_PARPORT_AUTO -3</span>
<span class="cp">#define LP_PARPORT_OFF -2</span>
<span class="cp">#define LP_PARPORT_NONE -1</span>

<span class="cp">#define LP_F(minor)	lp_table[(minor)].flags		</span><span class="cm">/* flags for busy, etc. */</span><span class="cp"></span>
<span class="cp">#define LP_CHAR(minor)	lp_table[(minor)].chars		</span><span class="cm">/* busy timeout */</span><span class="cp"></span>
<span class="cp">#define LP_TIME(minor)	lp_table[(minor)].time		</span><span class="cm">/* wait time */</span><span class="cp"></span>
<span class="cp">#define LP_WAIT(minor)	lp_table[(minor)].wait		</span><span class="cm">/* strobe wait */</span><span class="cp"></span>
<span class="cp">#define LP_IRQ(minor)	lp_table[(minor)].dev-&gt;port-&gt;irq </span><span class="cm">/* interrupt # */</span><span class="cp"></span>
					<span class="cm">/* PARPORT_IRQ_NONE means polled */</span>
<span class="cp">#ifdef LP_STATS</span>
<span class="cp">#define LP_STAT(minor)	lp_table[(minor)].stats		</span><span class="cm">/* statistics area */</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#define LP_BUFFER_SIZE PAGE_SIZE</span>

<span class="cp">#define LP_BASE(x)	lp_table[(x)].dev-&gt;port-&gt;base</span>

<span class="cp">#ifdef LP_STATS</span>
<span class="k">struct</span> <span class="n">lp_stats</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">chars</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sleeps</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">maxrun</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">maxwait</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">meanwait</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mdev</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">lp_struct</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">pardevice</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">chars</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">time</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wait</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">lp_buffer</span><span class="p">;</span>
<span class="cp">#ifdef LP_STATS</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lastcall</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">runchars</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lp_stats</span> <span class="n">stats</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">wait_queue_head_t</span> <span class="n">waitq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">last_error</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">port_mutex</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">dataq</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">timeout</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">best_mode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">current_mode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bits</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * The following constants describe the various signals of the printer port</span>
<span class="cm"> * hardware.  Note that the hardware inverts some signals and that some</span>
<span class="cm"> * signals are active low.  An example is LP_STROBE, which must be programmed</span>
<span class="cm"> * with 1 for being active and 0 for being inactive, because the strobe signal</span>
<span class="cm"> * gets inverted, but it is also active low.</span>
<span class="cm"> */</span>


<span class="cm">/* </span>
<span class="cm"> * defines for 8255 control port</span>
<span class="cm"> * base + 2 </span>
<span class="cm"> * accessed with LP_C(minor)</span>
<span class="cm"> */</span>
<span class="cp">#define LP_PINTEN	0x10  </span><span class="cm">/* high to read data in or-ed with data out */</span><span class="cp"></span>
<span class="cp">#define LP_PSELECP	0x08  </span><span class="cm">/* inverted output, active low */</span><span class="cp"></span>
<span class="cp">#define LP_PINITP	0x04  </span><span class="cm">/* unchanged output, active low */</span><span class="cp"></span>
<span class="cp">#define LP_PAUTOLF	0x02  </span><span class="cm">/* inverted output, active low */</span><span class="cp"></span>
<span class="cp">#define LP_PSTROBE	0x01  </span><span class="cm">/* short high output on raising edge */</span><span class="cp"></span>

<span class="cm">/* </span>
<span class="cm"> * the value written to ports to test existence. PC-style ports will </span>
<span class="cm"> * return the value written. AT-style ports will return 0. so why not</span>
<span class="cm"> * make them the same ? </span>
<span class="cm"> */</span>
<span class="cp">#define LP_DUMMY	0x00</span>

<span class="cm">/*</span>
<span class="cm"> * This is the port delay time, in microseconds.</span>
<span class="cm"> * It is used only in the lp_init() and lp_reset() routine.</span>
<span class="cm"> */</span>
<span class="cp">#define LP_DELAY 	50</span>

<span class="cp">#endif</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
