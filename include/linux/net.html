<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › net.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>net.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * NET		An implementation of the SOCKET network access protocol.</span>
<span class="cm"> *		This is the master header file for the Linux NET layer,</span>
<span class="cm"> *		or, in plain English: the networking handling part of the</span>
<span class="cm"> *		kernel.</span>
<span class="cm"> *</span>
<span class="cm"> * Version:	@(#)net.h	1.0.3	05/25/93</span>
<span class="cm"> *</span>
<span class="cm"> * Authors:	Orest Zborowski, &lt;obz@Kodak.COM&gt;</span>
<span class="cm"> *		Ross Biro</span>
<span class="cm"> *		Fred N. van Kempen, &lt;waltje@uWalt.NL.Mugnet.ORG&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *		This program is free software; you can redistribute it and/or</span>
<span class="cm"> *		modify it under the terms of the GNU General Public License</span>
<span class="cm"> *		as published by the Free Software Foundation; either version</span>
<span class="cm"> *		2 of the License, or (at your option) any later version.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _LINUX_NET_H</span>
<span class="cp">#define _LINUX_NET_H</span>

<span class="cp">#include &lt;linux/socket.h&gt;</span>
<span class="cp">#include &lt;asm/socket.h&gt;</span>

<span class="cp">#define NPROTO		AF_MAX</span>

<span class="cp">#define SYS_SOCKET	1		</span><span class="cm">/* sys_socket(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_BIND	2		</span><span class="cm">/* sys_bind(2)			*/</span><span class="cp"></span>
<span class="cp">#define SYS_CONNECT	3		</span><span class="cm">/* sys_connect(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_LISTEN	4		</span><span class="cm">/* sys_listen(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_ACCEPT	5		</span><span class="cm">/* sys_accept(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_GETSOCKNAME	6		</span><span class="cm">/* sys_getsockname(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_GETPEERNAME	7		</span><span class="cm">/* sys_getpeername(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_SOCKETPAIR	8		</span><span class="cm">/* sys_socketpair(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_SEND	9		</span><span class="cm">/* sys_send(2)			*/</span><span class="cp"></span>
<span class="cp">#define SYS_RECV	10		</span><span class="cm">/* sys_recv(2)			*/</span><span class="cp"></span>
<span class="cp">#define SYS_SENDTO	11		</span><span class="cm">/* sys_sendto(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_RECVFROM	12		</span><span class="cm">/* sys_recvfrom(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_SHUTDOWN	13		</span><span class="cm">/* sys_shutdown(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_SETSOCKOPT	14		</span><span class="cm">/* sys_setsockopt(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_GETSOCKOPT	15		</span><span class="cm">/* sys_getsockopt(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_SENDMSG	16		</span><span class="cm">/* sys_sendmsg(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_RECVMSG	17		</span><span class="cm">/* sys_recvmsg(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_ACCEPT4	18		</span><span class="cm">/* sys_accept4(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_RECVMMSG	19		</span><span class="cm">/* sys_recvmmsg(2)		*/</span><span class="cp"></span>
<span class="cp">#define SYS_SENDMMSG	20		</span><span class="cm">/* sys_sendmmsg(2)		*/</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">SS_FREE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>			<span class="cm">/* not allocated		*/</span>
	<span class="n">SS_UNCONNECTED</span><span class="p">,</span>			<span class="cm">/* unconnected to any socket	*/</span>
	<span class="n">SS_CONNECTING</span><span class="p">,</span>			<span class="cm">/* in process of connecting	*/</span>
	<span class="n">SS_CONNECTED</span><span class="p">,</span>			<span class="cm">/* connected to socket		*/</span>
	<span class="n">SS_DISCONNECTING</span>		<span class="cm">/* in process of disconnecting	*/</span>
<span class="p">}</span> <span class="n">socket_state</span><span class="p">;</span>

<span class="cp">#define __SO_ACCEPTCON	(1 &lt;&lt; 16)	</span><span class="cm">/* performed a listen		*/</span><span class="cp"></span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#include &lt;linux/stringify.h&gt;</span>
<span class="cp">#include &lt;linux/random.h&gt;</span>
<span class="cp">#include &lt;linux/wait.h&gt;</span>
<span class="cp">#include &lt;linux/fcntl.h&gt;	</span><span class="cm">/* For O_CLOEXEC and O_NONBLOCK */</span><span class="cp"></span>
<span class="cp">#include &lt;linux/kmemcheck.h&gt;</span>
<span class="cp">#include &lt;linux/rcupdate.h&gt;</span>

<span class="k">struct</span> <span class="n">poll_table_struct</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">pipe_inode_info</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">inode</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">net</span><span class="p">;</span>

<span class="cp">#define SOCK_ASYNC_NOSPACE	0</span>
<span class="cp">#define SOCK_ASYNC_WAITDATA	1</span>
<span class="cp">#define SOCK_NOSPACE		2</span>
<span class="cp">#define SOCK_PASSCRED		3</span>
<span class="cp">#define SOCK_PASSSEC		4</span>

<span class="cp">#ifndef ARCH_HAS_SOCKET_TYPES</span>
<span class="cm">/**</span>
<span class="cm"> * enum sock_type - Socket types</span>
<span class="cm"> * @SOCK_STREAM: stream (connection) socket</span>
<span class="cm"> * @SOCK_DGRAM: datagram (conn.less) socket</span>
<span class="cm"> * @SOCK_RAW: raw socket</span>
<span class="cm"> * @SOCK_RDM: reliably-delivered message</span>
<span class="cm"> * @SOCK_SEQPACKET: sequential packet socket</span>
<span class="cm"> * @SOCK_DCCP: Datagram Congestion Control Protocol socket</span>
<span class="cm"> * @SOCK_PACKET: linux specific way of getting packets at the dev level.</span>
<span class="cm"> *		  For writing rarp and other similar things on the user level.</span>
<span class="cm"> *</span>
<span class="cm"> * When adding some new socket type please</span>
<span class="cm"> * grep ARCH_HAS_SOCKET_TYPE include/asm-* /socket.h, at least MIPS</span>
<span class="cm"> * overrides this enum for binary compat reasons.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">sock_type</span> <span class="p">{</span>
	<span class="n">SOCK_STREAM</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">SOCK_DGRAM</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">SOCK_RAW</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">SOCK_RDM</span>	<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">SOCK_SEQPACKET</span>	<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">SOCK_DCCP</span>	<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">SOCK_PACKET</span>	<span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define SOCK_MAX (SOCK_PACKET + 1)</span>
<span class="cm">/* Mask which covers at least up to SOCK_MASK-1.  The</span>
<span class="cm"> * remaining bits are used as flags. */</span>
<span class="cp">#define SOCK_TYPE_MASK 0xf</span>

<span class="cm">/* Flags for socket, socketpair, accept4 */</span>
<span class="cp">#define SOCK_CLOEXEC	O_CLOEXEC</span>
<span class="cp">#ifndef SOCK_NONBLOCK</span>
<span class="cp">#define SOCK_NONBLOCK	O_NONBLOCK</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* ARCH_HAS_SOCKET_TYPES */</span><span class="cp"></span>

<span class="k">enum</span> <span class="n">sock_shutdown_cmd</span> <span class="p">{</span>
	<span class="n">SHUT_RD</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SHUT_WR</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">SHUT_RDWR</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">socket_wq</span> <span class="p">{</span>
	<span class="cm">/* Note: wait MUST be first field of socket_wq */</span>
	<span class="n">wait_queue_head_t</span>	<span class="n">wait</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">fasync_struct</span>	<span class="o">*</span><span class="n">fasync_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rcu_head</span>		<span class="n">rcu</span><span class="p">;</span>
<span class="p">}</span> <span class="n">____cacheline_aligned_in_smp</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> *  struct socket - general BSD socket</span>
<span class="cm"> *  @state: socket state (%SS_CONNECTED, etc)</span>
<span class="cm"> *  @type: socket type (%SOCK_STREAM, etc)</span>
<span class="cm"> *  @flags: socket flags (%SOCK_ASYNC_NOSPACE, etc)</span>
<span class="cm"> *  @ops: protocol specific socket operations</span>
<span class="cm"> *  @file: File back pointer for gc</span>
<span class="cm"> *  @sk: internal networking protocol agnostic socket representation</span>
<span class="cm"> *  @wq: wait queue for several uses</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">socket</span> <span class="p">{</span>
	<span class="n">socket_state</span>		<span class="n">state</span><span class="p">;</span>

	<span class="n">kmemcheck_bitfield_begin</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
	<span class="kt">short</span>			<span class="n">type</span><span class="p">;</span>
	<span class="n">kmemcheck_bitfield_end</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">flags</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">socket_wq</span> <span class="n">__rcu</span>	<span class="o">*</span><span class="n">wq</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">file</span>		<span class="o">*</span><span class="n">file</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sock</span>		<span class="o">*</span><span class="n">sk</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">proto_ops</span>	<span class="o">*</span><span class="n">ops</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">vm_area_struct</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">page</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">kiocb</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">sockaddr</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">msghdr</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">module</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">proto_ops</span> <span class="p">{</span>
	<span class="kt">int</span>		<span class="n">family</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">module</span>	<span class="o">*</span><span class="n">owner</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">release</span><span class="p">)</span>   <span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">bind</span><span class="p">)</span>	     <span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">myaddr</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">sockaddr_len</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">connect</span><span class="p">)</span>   <span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">vaddr</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">sockaddr_len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">socketpair</span><span class="p">)(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock1</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock2</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">accept</span><span class="p">)</span>    <span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">newsock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">getname</span><span class="p">)</span>   <span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="o">*</span><span class="n">sockaddr_len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">peer</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="p">(</span><span class="o">*</span><span class="n">poll</span><span class="p">)</span>	     <span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">poll_table_struct</span> <span class="o">*</span><span class="n">wait</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">ioctl</span><span class="p">)</span>     <span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_COMPAT</span>
	<span class="kt">int</span>	 	<span class="p">(</span><span class="o">*</span><span class="n">compat_ioctl</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">listen</span><span class="p">)</span>    <span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">shutdown</span><span class="p">)</span>  <span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">setsockopt</span><span class="p">)(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">optname</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">optval</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">optlen</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">getsockopt</span><span class="p">)(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">optname</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">optval</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__user</span> <span class="o">*</span><span class="n">optlen</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_COMPAT</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">compat_setsockopt</span><span class="p">)(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">optname</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">optval</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">optlen</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">compat_getsockopt</span><span class="p">)(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">optname</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">optval</span><span class="p">,</span> <span class="kt">int</span> <span class="n">__user</span> <span class="o">*</span><span class="n">optlen</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">sendmsg</span><span class="p">)</span>   <span class="p">(</span><span class="k">struct</span> <span class="n">kiocb</span> <span class="o">*</span><span class="n">iocb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">msghdr</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">total_len</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">recvmsg</span><span class="p">)</span>   <span class="p">(</span><span class="k">struct</span> <span class="n">kiocb</span> <span class="o">*</span><span class="n">iocb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">msghdr</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">total_len</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">mmap</span><span class="p">)</span>	     <span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span> <span class="n">vma</span><span class="p">);</span>
	<span class="kt">ssize_t</span>		<span class="p">(</span><span class="o">*</span><span class="n">sendpage</span><span class="p">)</span>  <span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">page</span> <span class="o">*</span><span class="n">page</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
	<span class="kt">ssize_t</span> 	<span class="p">(</span><span class="o">*</span><span class="n">splice_read</span><span class="p">)(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>  <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">pipe_inode_info</span> <span class="o">*</span><span class="n">pipe</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">set_peek_off</span><span class="p">)(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#define DECLARE_SOCKADDR(type, dst, src)	\</span>
<span class="cp">	type dst = ({ __sockaddr_check_size(sizeof(*dst)); (type) src; })</span>

<span class="k">struct</span> <span class="n">net_proto_family</span> <span class="p">{</span>
	<span class="kt">int</span>		<span class="n">family</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">create</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="n">net</span><span class="p">,</span> <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>
				  <span class="kt">int</span> <span class="n">protocol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kern</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">module</span>	<span class="o">*</span><span class="n">owner</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">iovec</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">kvec</span><span class="p">;</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">SOCK_WAKE_IO</span><span class="p">,</span>
	<span class="n">SOCK_WAKE_WAITD</span><span class="p">,</span>
	<span class="n">SOCK_WAKE_SPACE</span><span class="p">,</span>
	<span class="n">SOCK_WAKE_URG</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span>	     <span class="n">sock_wake_async</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span> <span class="kt">int</span> <span class="n">how</span><span class="p">,</span> <span class="kt">int</span> <span class="n">band</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>	     <span class="n">sock_register</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">net_proto_family</span> <span class="o">*</span><span class="n">fam</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>	     <span class="n">sock_unregister</span><span class="p">(</span><span class="kt">int</span> <span class="n">family</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>	     <span class="n">__sock_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">net</span> <span class="o">*</span><span class="n">net</span><span class="p">,</span> <span class="kt">int</span> <span class="n">family</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">proto</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">socket</span> <span class="o">**</span><span class="n">res</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kern</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>	     <span class="n">sock_create</span><span class="p">(</span><span class="kt">int</span> <span class="n">family</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">proto</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">socket</span> <span class="o">**</span><span class="n">res</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>	     <span class="n">sock_create_kern</span><span class="p">(</span><span class="kt">int</span> <span class="n">family</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">proto</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">socket</span> <span class="o">**</span><span class="n">res</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>	     <span class="n">sock_create_lite</span><span class="p">(</span><span class="kt">int</span> <span class="n">family</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">proto</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">socket</span> <span class="o">**</span><span class="n">res</span><span class="p">);</span> 
<span class="k">extern</span> <span class="kt">void</span>	     <span class="n">sock_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>   	     <span class="n">sock_sendmsg</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">msghdr</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span>
				  <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>	     <span class="n">sock_recvmsg</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">msghdr</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span>
				  <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> 	     <span class="n">sock_map_fd</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sockfd_lookup</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">err</span><span class="p">);</span>
<span class="cp">#define		     sockfd_put(sock) fput(sock-&gt;file)</span>
<span class="k">extern</span> <span class="kt">int</span>	     <span class="n">net_ratelimit</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#define net_ratelimited_function(function, ...)			\</span>
<span class="cp">do {								\</span>
<span class="cp">	if (net_ratelimit())					\</span>
<span class="cp">		function(__VA_ARGS__);				\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define net_emerg_ratelimited(fmt, ...)				\</span>
<span class="cp">	net_ratelimited_function(pr_emerg, fmt, ##__VA_ARGS__)</span>
<span class="cp">#define net_alert_ratelimited(fmt, ...)				\</span>
<span class="cp">	net_ratelimited_function(pr_alert, fmt, ##__VA_ARGS__)</span>
<span class="cp">#define net_crit_ratelimited(fmt, ...)				\</span>
<span class="cp">	net_ratelimited_function(pr_crit, fmt, ##__VA_ARGS__)</span>
<span class="cp">#define net_err_ratelimited(fmt, ...)				\</span>
<span class="cp">	net_ratelimited_function(pr_err, fmt, ##__VA_ARGS__)</span>
<span class="cp">#define net_notice_ratelimited(fmt, ...)			\</span>
<span class="cp">	net_ratelimited_function(pr_notice, fmt, ##__VA_ARGS__)</span>
<span class="cp">#define net_warn_ratelimited(fmt, ...)				\</span>
<span class="cp">	net_ratelimited_function(pr_warn, fmt, ##__VA_ARGS__)</span>
<span class="cp">#define net_info_ratelimited(fmt, ...)				\</span>
<span class="cp">	net_ratelimited_function(pr_info, fmt, ##__VA_ARGS__)</span>
<span class="cp">#define net_dbg_ratelimited(fmt, ...)				\</span>
<span class="cp">	net_ratelimited_function(pr_debug, fmt, ##__VA_ARGS__)</span>

<span class="cp">#define net_random()		random32()</span>
<span class="cp">#define net_srandom(seed)	srandom32((__force u32)seed)</span>

<span class="k">extern</span> <span class="kt">int</span>   	     <span class="n">kernel_sendmsg</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">msghdr</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">kvec</span> <span class="o">*</span><span class="n">vec</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">num</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>   	     <span class="n">kernel_recvmsg</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">msghdr</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">kvec</span> <span class="o">*</span><span class="n">vec</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">num</span><span class="p">,</span>
				    <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_bind</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span>
		       <span class="kt">int</span> <span class="n">addrlen</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_listen</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">backlog</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_accept</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">socket</span> <span class="o">**</span><span class="n">newsock</span><span class="p">,</span>
			 <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_connect</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span>
			  <span class="kt">int</span> <span class="n">addrlen</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_getsockname</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span>
			      <span class="kt">int</span> <span class="o">*</span><span class="n">addrlen</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_getpeername</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span>
			      <span class="kt">int</span> <span class="o">*</span><span class="n">addrlen</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_getsockopt</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">optname</span><span class="p">,</span>
			     <span class="kt">char</span> <span class="o">*</span><span class="n">optval</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">optlen</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_setsockopt</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">optname</span><span class="p">,</span>
			     <span class="kt">char</span> <span class="o">*</span><span class="n">optval</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">optlen</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_sendpage</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">page</span> <span class="o">*</span><span class="n">page</span><span class="p">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span>
			   <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_sock_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">kernel_sock_shutdown</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">sock_shutdown_cmd</span> <span class="n">how</span><span class="p">);</span>

<span class="cp">#define MODULE_ALIAS_NETPROTO(proto) \</span>
<span class="cp">	MODULE_ALIAS(&quot;net-pf-&quot; __stringify(proto))</span>

<span class="cp">#define MODULE_ALIAS_NET_PF_PROTO(pf, proto) \</span>
<span class="cp">	MODULE_ALIAS(&quot;net-pf-&quot; __stringify(pf) &quot;-proto-&quot; __stringify(proto))</span>

<span class="cp">#define MODULE_ALIAS_NET_PF_PROTO_TYPE(pf, proto, type) \</span>
<span class="cp">	MODULE_ALIAS(&quot;net-pf-&quot; __stringify(pf) &quot;-proto-&quot; __stringify(proto) \</span>
<span class="cp">		     &quot;-type-&quot; __stringify(type))</span>

<span class="cp">#define MODULE_ALIAS_NET_PF_PROTO_NAME(pf, proto, name) \</span>
<span class="cp">	MODULE_ALIAS(&quot;net-pf-&quot; __stringify(pf) &quot;-proto-&quot; __stringify(proto) \</span>
<span class="cp">		     name)</span>
<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif	</span><span class="cm">/* _LINUX_NET_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
