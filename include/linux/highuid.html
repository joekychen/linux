<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › highuid.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>highuid.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _LINUX_HIGHUID_H</span>
<span class="cp">#define _LINUX_HIGHUID_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * general notes:</span>
<span class="cm"> *</span>
<span class="cm"> * CONFIG_UID16 is defined if the given architecture needs to</span>
<span class="cm"> * support backwards compatibility for old system calls.</span>
<span class="cm"> *</span>
<span class="cm"> * kernel code should use uid_t and gid_t at all times when dealing with</span>
<span class="cm"> * kernel-private data.</span>
<span class="cm"> *</span>
<span class="cm"> * old_uid_t and old_gid_t should only be different if CONFIG_UID16 is</span>
<span class="cm"> * defined, else the platform should provide dummy typedefs for them</span>
<span class="cm"> * such that they are equivalent to __kernel_{u,g}id_t.</span>
<span class="cm"> *</span>
<span class="cm"> * uid16_t and gid16_t are used on all architectures. (when dealing</span>
<span class="cm"> * with structures hard coded to 16 bits, such as in filesystems)</span>
<span class="cm"> */</span>


<span class="cm">/*</span>
<span class="cm"> * This is the &quot;overflow&quot; UID and GID. They are used to signify uid/gid</span>
<span class="cm"> * overflow to old programs when they request uid/gid information but are</span>
<span class="cm"> * using the old 16 bit interfaces.</span>
<span class="cm"> * When you run a libc5 program, it will think that all highuid files or</span>
<span class="cm"> * processes are owned by this uid/gid.</span>
<span class="cm"> * The idea is that it&#39;s better to do so than possibly return 0 in lieu of</span>
<span class="cm"> * 65536, etc.</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">overflowuid</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">overflowgid</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">__bad_uid</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__bad_gid</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#define DEFAULT_OVERFLOWUID	65534</span>
<span class="cp">#define DEFAULT_OVERFLOWGID	65534</span>

<span class="cp">#ifdef CONFIG_UID16</span>

<span class="cm">/* prevent uid mod 65536 effect by returning a default value for high UIDs */</span>
<span class="cp">#define high2lowuid(uid) ((uid) &amp; ~0xFFFF ? (old_uid_t)overflowuid : (old_uid_t)(uid))</span>
<span class="cp">#define high2lowgid(gid) ((gid) &amp; ~0xFFFF ? (old_gid_t)overflowgid : (old_gid_t)(gid))</span>
<span class="cm">/*</span>
<span class="cm"> * -1 is different in 16 bits than it is in 32 bits</span>
<span class="cm"> * these macros are used by chown(), setreuid(), ...,</span>
<span class="cm"> */</span>
<span class="cp">#define low2highuid(uid) ((uid) == (old_uid_t)-1 ? (uid_t)-1 : (uid_t)(uid))</span>
<span class="cp">#define low2highgid(gid) ((gid) == (old_gid_t)-1 ? (gid_t)-1 : (gid_t)(gid))</span>

<span class="cp">#define __convert_uid(size, uid) \</span>
<span class="cp">	(size &gt;= sizeof(uid) ? (uid) : high2lowuid(uid))</span>
<span class="cp">#define __convert_gid(size, gid) \</span>
<span class="cp">	(size &gt;= sizeof(gid) ? (gid) : high2lowgid(gid))</span>
	

<span class="cp">#else</span>

<span class="cp">#define __convert_uid(size, uid) (uid)</span>
<span class="cp">#define __convert_gid(size, gid) (gid)</span>

<span class="cp">#endif </span><span class="cm">/* !CONFIG_UID16 */</span><span class="cp"></span>

<span class="cm">/* uid/gid input should be always 32bit uid_t */</span>
<span class="cp">#define SET_UID(var, uid) do { (var) = __convert_uid(sizeof(var), (uid)); } while (0)</span>
<span class="cp">#define SET_GID(var, gid) do { (var) = __convert_gid(sizeof(var), (gid)); } while (0)</span>

<span class="cm">/*</span>
<span class="cm"> * Everything below this line is needed on all architectures, to deal with</span>
<span class="cm"> * filesystems that only store 16 bits of the UID/GID, etc.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * This is the UID and GID that will get written to disk if a filesystem</span>
<span class="cm"> * only supports 16-bit UIDs and the kernel has a high UID/GID to write</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fs_overflowuid</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">fs_overflowgid</span><span class="p">;</span>

<span class="cp">#define DEFAULT_FS_OVERFLOWUID	65534</span>
<span class="cp">#define DEFAULT_FS_OVERFLOWGID	65534</span>

<span class="cm">/*</span>
<span class="cm"> * Since these macros are used in architectures that only need limited</span>
<span class="cm"> * 16-bit UID back compatibility, we won&#39;t use old_uid_t and old_gid_t</span>
<span class="cm"> */</span>
<span class="cp">#define fs_high2lowuid(uid) ((uid) &amp; ~0xFFFF ? (uid16_t)fs_overflowuid : (uid16_t)(uid))</span>
<span class="cp">#define fs_high2lowgid(gid) ((gid) &amp; ~0xFFFF ? (gid16_t)fs_overflowgid : (gid16_t)(gid))</span>

<span class="cp">#define low_16_bits(x)	((x) &amp; 0xFFFF)</span>
<span class="cp">#define high_16_bits(x)	(((x) &amp; 0xFFFF0000) &gt;&gt; 16)</span>

<span class="cp">#endif </span><span class="cm">/* _LINUX_HIGHUID_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
