<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › ssb › ssb_driver_pci.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>ssb_driver_pci.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef LINUX_SSB_PCICORE_H_</span>
<span class="cp">#define LINUX_SSB_PCICORE_H_</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="k">struct</span> <span class="n">pci_dev</span><span class="p">;</span>


<span class="cp">#ifdef CONFIG_SSB_DRIVER_PCICORE</span>

<span class="cm">/* PCI core registers. */</span>
<span class="cp">#define SSB_PCICORE_CTL			0x0000	</span><span class="cm">/* PCI Control */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_CTL_RST_OE		0x00000001 </span><span class="cm">/* PCI_RESET Output Enable */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_CTL_RST		0x00000002 </span><span class="cm">/* PCI_RESET driven out to pin */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_CTL_CLK_OE		0x00000004 </span><span class="cm">/* Clock gate Output Enable */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_CTL_CLK		0x00000008 </span><span class="cm">/* Gate for clock driven out to pin */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_ARBCTL		0x0010	</span><span class="cm">/* PCI Arbiter Control */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_ARBCTL_INTERN	0x00000001 </span><span class="cm">/* Use internal arbiter */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_ARBCTL_EXTERN	0x00000002 </span><span class="cm">/* Use external arbiter */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_ARBCTL_PARKID	0x00000006 </span><span class="cm">/* Mask, selects which agent is parked on an idle bus */</span><span class="cp"></span>
<span class="cp">#define   SSB_PCICORE_ARBCTL_PARKID_LAST	0x00000000 </span><span class="cm">/* Last requestor */</span><span class="cp"></span>
<span class="cp">#define   SSB_PCICORE_ARBCTL_PARKID_4710	0x00000002 </span><span class="cm">/* 4710 */</span><span class="cp"></span>
<span class="cp">#define   SSB_PCICORE_ARBCTL_PARKID_EXT0	0x00000004 </span><span class="cm">/* External requestor 0 */</span><span class="cp"></span>
<span class="cp">#define   SSB_PCICORE_ARBCTL_PARKID_EXT1	0x00000006 </span><span class="cm">/* External requestor 1 */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_ISTAT		0x0020	</span><span class="cm">/* Interrupt status */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_ISTAT_INTA		0x00000001 </span><span class="cm">/* PCI INTA# */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_ISTAT_INTB		0x00000002 </span><span class="cm">/* PCI INTB# */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_ISTAT_SERR		0x00000004 </span><span class="cm">/* PCI SERR# (write to clear) */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_ISTAT_PERR		0x00000008 </span><span class="cm">/* PCI PERR# (write to clear) */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_ISTAT_PME		0x00000010 </span><span class="cm">/* PCI PME# */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_IMASK		0x0024	</span><span class="cm">/* Interrupt mask */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_IMASK_INTA		0x00000001 </span><span class="cm">/* PCI INTA# */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_IMASK_INTB		0x00000002 </span><span class="cm">/* PCI INTB# */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_IMASK_SERR		0x00000004 </span><span class="cm">/* PCI SERR# */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_IMASK_PERR		0x00000008 </span><span class="cm">/* PCI PERR# */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_IMASK_PME		0x00000010 </span><span class="cm">/* PCI PME# */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_MBOX		0x0028	</span><span class="cm">/* Backplane to PCI Mailbox */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_MBOX_F0_0		0x00000100 </span><span class="cm">/* PCI function 0, INT 0 */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_MBOX_F0_1		0x00000200 </span><span class="cm">/* PCI function 0, INT 1 */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_MBOX_F1_0		0x00000400 </span><span class="cm">/* PCI function 1, INT 0 */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_MBOX_F1_1		0x00000800 </span><span class="cm">/* PCI function 1, INT 1 */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_MBOX_F2_0		0x00001000 </span><span class="cm">/* PCI function 2, INT 0 */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_MBOX_F2_1		0x00002000 </span><span class="cm">/* PCI function 2, INT 1 */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_MBOX_F3_0		0x00004000 </span><span class="cm">/* PCI function 3, INT 0 */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_MBOX_F3_1		0x00008000 </span><span class="cm">/* PCI function 3, INT 1 */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_BCAST_ADDR		0x0050	</span><span class="cm">/* Backplane Broadcast Address */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_BCAST_ADDR_MASK	0x000000FF</span>
<span class="cp">#define SSB_PCICORE_BCAST_DATA		0x0054	</span><span class="cm">/* Backplane Broadcast Data */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_GPIO_IN		0x0060	</span><span class="cm">/* rev &gt;= 2 only */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_GPIO_OUT		0x0064	</span><span class="cm">/* rev &gt;= 2 only */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_GPIO_ENABLE		0x0068	</span><span class="cm">/* rev &gt;= 2 only */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_GPIO_CTL		0x006C	</span><span class="cm">/* rev &gt;= 2 only */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_SBTOPCI0		0x0100	</span><span class="cm">/* Backplane to PCI translation 0 (sbtopci0) */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_SBTOPCI0_MASK	0xFC000000</span>
<span class="cp">#define SSB_PCICORE_SBTOPCI1		0x0104	</span><span class="cm">/* Backplane to PCI translation 1 (sbtopci1) */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_SBTOPCI1_MASK	0xFC000000</span>
<span class="cp">#define SSB_PCICORE_SBTOPCI2		0x0108	</span><span class="cm">/* Backplane to PCI translation 2 (sbtopci2) */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_SBTOPCI2_MASK	0xC0000000</span>
<span class="cp">#define SSB_PCICORE_PCICFG0		0x0400	</span><span class="cm">/* PCI config space 0 (rev &gt;= 8) */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_PCICFG1		0x0500	</span><span class="cm">/* PCI config space 1 (rev &gt;= 8) */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_PCICFG2		0x0600	</span><span class="cm">/* PCI config space 2 (rev &gt;= 8) */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_PCICFG3		0x0700	</span><span class="cm">/* PCI config space 3 (rev &gt;= 8) */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_SPROM(wordoffset)	(0x0800 + ((wordoffset) * 2)) </span><span class="cm">/* SPROM shadow area (72 bytes) */</span><span class="cp"></span>

<span class="cm">/* SBtoPCIx */</span>
<span class="cp">#define SSB_PCICORE_SBTOPCI_MEM		0x00000000</span>
<span class="cp">#define SSB_PCICORE_SBTOPCI_IO		0x00000001</span>
<span class="cp">#define SSB_PCICORE_SBTOPCI_CFG0	0x00000002</span>
<span class="cp">#define SSB_PCICORE_SBTOPCI_CFG1	0x00000003</span>
<span class="cp">#define SSB_PCICORE_SBTOPCI_PREF	0x00000004 </span><span class="cm">/* Prefetch enable */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_SBTOPCI_BURST	0x00000008 </span><span class="cm">/* Burst enable */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_SBTOPCI_MRM		0x00000020 </span><span class="cm">/* Memory Read Multiple */</span><span class="cp"></span>
<span class="cp">#define SSB_PCICORE_SBTOPCI_RC		0x00000030 </span><span class="cm">/* Read Command mask (rev &gt;= 11) */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_SBTOPCI_RC_READ	0x00000000 </span><span class="cm">/* Memory read */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_SBTOPCI_RC_READL	0x00000010 </span><span class="cm">/* Memory read line */</span><span class="cp"></span>
<span class="cp">#define  SSB_PCICORE_SBTOPCI_RC_READM	0x00000020 </span><span class="cm">/* Memory read multiple */</span><span class="cp"></span>


<span class="cm">/* PCIcore specific boardflags */</span>
<span class="cp">#define SSB_PCICORE_BFL_NOPCI		0x00000400 </span><span class="cm">/* Board leaves PCI floating */</span><span class="cp"></span>


<span class="k">struct</span> <span class="n">ssb_pcicore</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ssb_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">setup_done</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">hostmode</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cardbusmode</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">ssb_pcicore_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ssb_pcicore</span> <span class="o">*</span><span class="n">pc</span><span class="p">);</span>

<span class="cm">/* Enable IRQ routing for a specific device */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ssb_pcicore_dev_irqvecs_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">ssb_pcicore</span> <span class="o">*</span><span class="n">pc</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">ssb_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ssb_pcicore_plat_dev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">d</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ssb_pcicore_pcibios_map_irq</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">slot</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pin</span><span class="p">);</span>


<span class="cp">#else </span><span class="cm">/* CONFIG_SSB_DRIVER_PCICORE */</span><span class="cp"></span>


<span class="k">struct</span> <span class="n">ssb_pcicore</span> <span class="p">{</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">void</span> <span class="nf">ssb_pcicore_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ssb_pcicore</span> <span class="o">*</span><span class="n">pc</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">ssb_pcicore_dev_irqvecs_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">ssb_pcicore</span> <span class="o">*</span><span class="n">pc</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">ssb_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">ssb_pcicore_plat_dev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span>
<span class="kt">int</span> <span class="nf">ssb_pcicore_pcibios_map_irq</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">slot</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pin</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_SSB_DRIVER_PCICORE */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* LINUX_SSB_PCICORE_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
