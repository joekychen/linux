<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › ip_vs.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>ip_vs.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *      IP Virtual Server</span>
<span class="cm"> *      data structure and functionality definitions</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _IP_VS_H</span>
<span class="cp">#define _IP_VS_H</span>

<span class="cp">#include &lt;linux/types.h&gt;	</span><span class="cm">/* For __beXX types in userland */</span><span class="cp"></span>

<span class="cp">#define IP_VS_VERSION_CODE	0x010201</span>
<span class="cp">#define NVERSION(version)			\</span>
<span class="cp">	(version &gt;&gt; 16) &amp; 0xFF,			\</span>
<span class="cp">	(version &gt;&gt; 8) &amp; 0xFF,			\</span>
<span class="cp">	version &amp; 0xFF</span>

<span class="cm">/*</span>
<span class="cm"> *      Virtual Service Flags</span>
<span class="cm"> */</span>
<span class="cp">#define IP_VS_SVC_F_PERSISTENT	0x0001		</span><span class="cm">/* persistent port */</span><span class="cp"></span>
<span class="cp">#define IP_VS_SVC_F_HASHED	0x0002		</span><span class="cm">/* hashed entry */</span><span class="cp"></span>
<span class="cp">#define IP_VS_SVC_F_ONEPACKET	0x0004		</span><span class="cm">/* one-packet scheduling */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *      Destination Server Flags</span>
<span class="cm"> */</span>
<span class="cp">#define IP_VS_DEST_F_AVAILABLE	0x0001		</span><span class="cm">/* server is available */</span><span class="cp"></span>
<span class="cp">#define IP_VS_DEST_F_OVERLOAD	0x0002		</span><span class="cm">/* server is overloaded */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *      IPVS sync daemon states</span>
<span class="cm"> */</span>
<span class="cp">#define IP_VS_STATE_NONE	0x0000		</span><span class="cm">/* daemon is stopped */</span><span class="cp"></span>
<span class="cp">#define IP_VS_STATE_MASTER	0x0001		</span><span class="cm">/* started as master */</span><span class="cp"></span>
<span class="cp">#define IP_VS_STATE_BACKUP	0x0002		</span><span class="cm">/* started as backup */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *      IPVS socket options</span>
<span class="cm"> */</span>
<span class="cp">#define IP_VS_BASE_CTL		(64+1024+64)		</span><span class="cm">/* base */</span><span class="cp"></span>

<span class="cp">#define IP_VS_SO_SET_NONE	IP_VS_BASE_CTL		</span><span class="cm">/* just peek */</span><span class="cp"></span>
<span class="cp">#define IP_VS_SO_SET_INSERT	(IP_VS_BASE_CTL+1)</span>
<span class="cp">#define IP_VS_SO_SET_ADD	(IP_VS_BASE_CTL+2)</span>
<span class="cp">#define IP_VS_SO_SET_EDIT	(IP_VS_BASE_CTL+3)</span>
<span class="cp">#define IP_VS_SO_SET_DEL	(IP_VS_BASE_CTL+4)</span>
<span class="cp">#define IP_VS_SO_SET_FLUSH	(IP_VS_BASE_CTL+5)</span>
<span class="cp">#define IP_VS_SO_SET_LIST	(IP_VS_BASE_CTL+6)</span>
<span class="cp">#define IP_VS_SO_SET_ADDDEST	(IP_VS_BASE_CTL+7)</span>
<span class="cp">#define IP_VS_SO_SET_DELDEST	(IP_VS_BASE_CTL+8)</span>
<span class="cp">#define IP_VS_SO_SET_EDITDEST	(IP_VS_BASE_CTL+9)</span>
<span class="cp">#define IP_VS_SO_SET_TIMEOUT	(IP_VS_BASE_CTL+10)</span>
<span class="cp">#define IP_VS_SO_SET_STARTDAEMON (IP_VS_BASE_CTL+11)</span>
<span class="cp">#define IP_VS_SO_SET_STOPDAEMON (IP_VS_BASE_CTL+12)</span>
<span class="cp">#define IP_VS_SO_SET_RESTORE    (IP_VS_BASE_CTL+13)</span>
<span class="cp">#define IP_VS_SO_SET_SAVE       (IP_VS_BASE_CTL+14)</span>
<span class="cp">#define IP_VS_SO_SET_ZERO	(IP_VS_BASE_CTL+15)</span>
<span class="cp">#define IP_VS_SO_SET_MAX	IP_VS_SO_SET_ZERO</span>

<span class="cp">#define IP_VS_SO_GET_VERSION	IP_VS_BASE_CTL</span>
<span class="cp">#define IP_VS_SO_GET_INFO	(IP_VS_BASE_CTL+1)</span>
<span class="cp">#define IP_VS_SO_GET_SERVICES	(IP_VS_BASE_CTL+2)</span>
<span class="cp">#define IP_VS_SO_GET_SERVICE	(IP_VS_BASE_CTL+3)</span>
<span class="cp">#define IP_VS_SO_GET_DESTS	(IP_VS_BASE_CTL+4)</span>
<span class="cp">#define IP_VS_SO_GET_DEST	(IP_VS_BASE_CTL+5)	</span><span class="cm">/* not used now */</span><span class="cp"></span>
<span class="cp">#define IP_VS_SO_GET_TIMEOUT	(IP_VS_BASE_CTL+6)</span>
<span class="cp">#define IP_VS_SO_GET_DAEMON	(IP_VS_BASE_CTL+7)</span>
<span class="cp">#define IP_VS_SO_GET_MAX	IP_VS_SO_GET_DAEMON</span>


<span class="cm">/*</span>
<span class="cm"> *      IPVS Connection Flags</span>
<span class="cm"> *      Only flags 0..15 are sent to backup server</span>
<span class="cm"> */</span>
<span class="cp">#define IP_VS_CONN_F_FWD_MASK	0x0007		</span><span class="cm">/* mask for the fwd methods */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_MASQ	0x0000		</span><span class="cm">/* masquerading/NAT */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_LOCALNODE	0x0001		</span><span class="cm">/* local node */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_TUNNEL	0x0002		</span><span class="cm">/* tunneling */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_DROUTE	0x0003		</span><span class="cm">/* direct routing */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_BYPASS	0x0004		</span><span class="cm">/* cache bypass */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_SYNC	0x0020		</span><span class="cm">/* entry created by sync */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_HASHED	0x0040		</span><span class="cm">/* hashed entry */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_NOOUTPUT	0x0080		</span><span class="cm">/* no output packets */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_INACTIVE	0x0100		</span><span class="cm">/* not established */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_OUT_SEQ	0x0200		</span><span class="cm">/* must do output seq adjust */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_IN_SEQ	0x0400		</span><span class="cm">/* must do input seq adjust */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_SEQ_MASK	0x0600		</span><span class="cm">/* in/out sequence mask */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_NO_CPORT	0x0800		</span><span class="cm">/* no client port set yet */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_TEMPLATE	0x1000		</span><span class="cm">/* template, not connection */</span><span class="cp"></span>
<span class="cp">#define IP_VS_CONN_F_ONE_PACKET	0x2000		</span><span class="cm">/* forward only one packet */</span><span class="cp"></span>

<span class="cm">/* Initial bits allowed in backup server */</span>
<span class="cp">#define IP_VS_CONN_F_BACKUP_MASK (IP_VS_CONN_F_FWD_MASK | \</span>
<span class="cp">				  IP_VS_CONN_F_NOOUTPUT | \</span>
<span class="cp">				  IP_VS_CONN_F_INACTIVE | \</span>
<span class="cp">				  IP_VS_CONN_F_SEQ_MASK | \</span>
<span class="cp">				  IP_VS_CONN_F_NO_CPORT | \</span>
<span class="cp">				  IP_VS_CONN_F_TEMPLATE \</span>
<span class="cp">				 )</span>

<span class="cm">/* Bits allowed to update in backup server */</span>
<span class="cp">#define IP_VS_CONN_F_BACKUP_UPD_MASK (IP_VS_CONN_F_INACTIVE | \</span>
<span class="cp">				      IP_VS_CONN_F_SEQ_MASK)</span>

<span class="cm">/* Flags that are not sent to backup server start from bit 16 */</span>
<span class="cp">#define IP_VS_CONN_F_NFCT	(1 &lt;&lt; 16)	</span><span class="cm">/* use netfilter conntrack */</span><span class="cp"></span>

<span class="cm">/* Connection flags from destination that can be changed by user space */</span>
<span class="cp">#define IP_VS_CONN_F_DEST_MASK (IP_VS_CONN_F_FWD_MASK | \</span>
<span class="cp">				IP_VS_CONN_F_ONE_PACKET | \</span>
<span class="cp">				IP_VS_CONN_F_NFCT | \</span>
<span class="cp">				0)</span>

<span class="cp">#define IP_VS_SCHEDNAME_MAXLEN	16</span>
<span class="cp">#define IP_VS_PENAME_MAXLEN	16</span>
<span class="cp">#define IP_VS_IFNAME_MAXLEN	16</span>

<span class="cp">#define IP_VS_PEDATA_MAXLEN     255</span>

<span class="cm">/*</span>
<span class="cm"> *	The struct ip_vs_service_user and struct ip_vs_dest_user are</span>
<span class="cm"> *	used to set IPVS rules through setsockopt.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ip_vs_service_user</span> <span class="p">{</span>
	<span class="cm">/* virtual service addresses */</span>
	<span class="n">__u16</span>		<span class="n">protocol</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">addr</span><span class="p">;</span>		<span class="cm">/* virtual ip address */</span>
	<span class="n">__be16</span>			<span class="n">port</span><span class="p">;</span>
	<span class="n">__u32</span>		<span class="n">fwmark</span><span class="p">;</span>		<span class="cm">/* firwall mark of service */</span>

	<span class="cm">/* virtual service options */</span>
	<span class="kt">char</span>			<span class="n">sched_name</span><span class="p">[</span><span class="n">IP_VS_SCHEDNAME_MAXLEN</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">flags</span><span class="p">;</span>		<span class="cm">/* virtual service flags */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">timeout</span><span class="p">;</span>	<span class="cm">/* persistent timeout in sec */</span>
	<span class="n">__be32</span>			<span class="n">netmask</span><span class="p">;</span>	<span class="cm">/* persistent netmask */</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">ip_vs_dest_user</span> <span class="p">{</span>
	<span class="cm">/* destination server address */</span>
	<span class="n">__be32</span>			<span class="n">addr</span><span class="p">;</span>
	<span class="n">__be16</span>			<span class="n">port</span><span class="p">;</span>

	<span class="cm">/* real server options */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">conn_flags</span><span class="p">;</span>	<span class="cm">/* connection flags */</span>
	<span class="kt">int</span>			<span class="n">weight</span><span class="p">;</span>		<span class="cm">/* destination weight */</span>

	<span class="cm">/* thresholds for active connections */</span>
	<span class="n">__u32</span>		<span class="n">u_threshold</span><span class="p">;</span>	<span class="cm">/* upper threshold */</span>
	<span class="n">__u32</span>		<span class="n">l_threshold</span><span class="p">;</span>	<span class="cm">/* lower threshold */</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> *	IPVS statistics object (for user space)</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ip_vs_stats_user</span> <span class="p">{</span>
	<span class="n">__u32</span>                   <span class="n">conns</span><span class="p">;</span>          <span class="cm">/* connections scheduled */</span>
	<span class="n">__u32</span>                   <span class="n">inpkts</span><span class="p">;</span>         <span class="cm">/* incoming packets */</span>
	<span class="n">__u32</span>                   <span class="n">outpkts</span><span class="p">;</span>        <span class="cm">/* outgoing packets */</span>
	<span class="n">__u64</span>                   <span class="n">inbytes</span><span class="p">;</span>        <span class="cm">/* incoming bytes */</span>
	<span class="n">__u64</span>                   <span class="n">outbytes</span><span class="p">;</span>       <span class="cm">/* outgoing bytes */</span>

	<span class="n">__u32</span>			<span class="n">cps</span><span class="p">;</span>		<span class="cm">/* current connection rate */</span>
	<span class="n">__u32</span>			<span class="n">inpps</span><span class="p">;</span>		<span class="cm">/* current in packet rate */</span>
	<span class="n">__u32</span>			<span class="n">outpps</span><span class="p">;</span>		<span class="cm">/* current out packet rate */</span>
	<span class="n">__u32</span>			<span class="n">inbps</span><span class="p">;</span>		<span class="cm">/* current in byte rate */</span>
	<span class="n">__u32</span>			<span class="n">outbps</span><span class="p">;</span>		<span class="cm">/* current out byte rate */</span>
<span class="p">};</span>


<span class="cm">/* The argument to IP_VS_SO_GET_INFO */</span>
<span class="k">struct</span> <span class="n">ip_vs_getinfo</span> <span class="p">{</span>
	<span class="cm">/* version number */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">version</span><span class="p">;</span>

	<span class="cm">/* size of connection hash table */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">size</span><span class="p">;</span>

	<span class="cm">/* number of virtual services */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">num_services</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/* The argument to IP_VS_SO_GET_SERVICE */</span>
<span class="k">struct</span> <span class="n">ip_vs_service_entry</span> <span class="p">{</span>
	<span class="cm">/* which service: user fills in these */</span>
	<span class="n">__u16</span>		<span class="n">protocol</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">addr</span><span class="p">;</span>		<span class="cm">/* virtual address */</span>
	<span class="n">__be16</span>			<span class="n">port</span><span class="p">;</span>
	<span class="n">__u32</span>		<span class="n">fwmark</span><span class="p">;</span>		<span class="cm">/* firwall mark of service */</span>

	<span class="cm">/* service options */</span>
	<span class="kt">char</span>			<span class="n">sched_name</span><span class="p">[</span><span class="n">IP_VS_SCHEDNAME_MAXLEN</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">flags</span><span class="p">;</span>          <span class="cm">/* virtual service flags */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">timeout</span><span class="p">;</span>	<span class="cm">/* persistent timeout */</span>
	<span class="n">__be32</span>			<span class="n">netmask</span><span class="p">;</span>	<span class="cm">/* persistent netmask */</span>

	<span class="cm">/* number of real servers */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">num_dests</span><span class="p">;</span>

	<span class="cm">/* statistics */</span>
	<span class="k">struct</span> <span class="n">ip_vs_stats_user</span> <span class="n">stats</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">ip_vs_dest_entry</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">addr</span><span class="p">;</span>		<span class="cm">/* destination address */</span>
	<span class="n">__be16</span>			<span class="n">port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">conn_flags</span><span class="p">;</span>	<span class="cm">/* connection flags */</span>
	<span class="kt">int</span>			<span class="n">weight</span><span class="p">;</span>		<span class="cm">/* destination weight */</span>

	<span class="n">__u32</span>		<span class="n">u_threshold</span><span class="p">;</span>	<span class="cm">/* upper threshold */</span>
	<span class="n">__u32</span>		<span class="n">l_threshold</span><span class="p">;</span>	<span class="cm">/* lower threshold */</span>

	<span class="n">__u32</span>		<span class="n">activeconns</span><span class="p">;</span>	<span class="cm">/* active connections */</span>
	<span class="n">__u32</span>		<span class="n">inactconns</span><span class="p">;</span>	<span class="cm">/* inactive connections */</span>
	<span class="n">__u32</span>		<span class="n">persistconns</span><span class="p">;</span>	<span class="cm">/* persistent connections */</span>

	<span class="cm">/* statistics */</span>
	<span class="k">struct</span> <span class="n">ip_vs_stats_user</span> <span class="n">stats</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/* The argument to IP_VS_SO_GET_DESTS */</span>
<span class="k">struct</span> <span class="n">ip_vs_get_dests</span> <span class="p">{</span>
	<span class="cm">/* which service: user fills in these */</span>
	<span class="n">__u16</span>		<span class="n">protocol</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">addr</span><span class="p">;</span>		<span class="cm">/* virtual address */</span>
	<span class="n">__be16</span>			<span class="n">port</span><span class="p">;</span>
	<span class="n">__u32</span>		<span class="n">fwmark</span><span class="p">;</span>		<span class="cm">/* firwall mark of service */</span>

	<span class="cm">/* number of real servers */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">num_dests</span><span class="p">;</span>

	<span class="cm">/* the real servers */</span>
	<span class="k">struct</span> <span class="n">ip_vs_dest_entry</span>	<span class="n">entrytable</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>


<span class="cm">/* The argument to IP_VS_SO_GET_SERVICES */</span>
<span class="k">struct</span> <span class="n">ip_vs_get_services</span> <span class="p">{</span>
	<span class="cm">/* number of virtual services */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">num_services</span><span class="p">;</span>

	<span class="cm">/* service table */</span>
	<span class="k">struct</span> <span class="n">ip_vs_service_entry</span> <span class="n">entrytable</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>


<span class="cm">/* The argument to IP_VS_SO_GET_TIMEOUT */</span>
<span class="k">struct</span> <span class="n">ip_vs_timeout_user</span> <span class="p">{</span>
	<span class="kt">int</span>			<span class="n">tcp_timeout</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">tcp_fin_timeout</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">udp_timeout</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/* The argument to IP_VS_SO_GET_DAEMON */</span>
<span class="k">struct</span> <span class="n">ip_vs_daemon_user</span> <span class="p">{</span>
	<span class="cm">/* sync daemon state (master/backup) */</span>
	<span class="kt">int</span>			<span class="n">state</span><span class="p">;</span>

	<span class="cm">/* multicast interface name */</span>
	<span class="kt">char</span>			<span class="n">mcast_ifn</span><span class="p">[</span><span class="n">IP_VS_IFNAME_MAXLEN</span><span class="p">];</span>

	<span class="cm">/* SyncID we belong to */</span>
	<span class="kt">int</span>			<span class="n">syncid</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * IPVS Generic Netlink interface definitions</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/* Generic Netlink family info */</span>

<span class="cp">#define IPVS_GENL_NAME		&quot;IPVS&quot;</span>
<span class="cp">#define IPVS_GENL_VERSION	0x1</span>

<span class="k">struct</span> <span class="n">ip_vs_flags</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="n">mask</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Generic Netlink command attributes */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">IPVS_CMD_UNSPEC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="n">IPVS_CMD_NEW_SERVICE</span><span class="p">,</span>		<span class="cm">/* add service */</span>
	<span class="n">IPVS_CMD_SET_SERVICE</span><span class="p">,</span>		<span class="cm">/* modify service */</span>
	<span class="n">IPVS_CMD_DEL_SERVICE</span><span class="p">,</span>		<span class="cm">/* delete service */</span>
	<span class="n">IPVS_CMD_GET_SERVICE</span><span class="p">,</span>		<span class="cm">/* get service info */</span>

	<span class="n">IPVS_CMD_NEW_DEST</span><span class="p">,</span>		<span class="cm">/* add destination */</span>
	<span class="n">IPVS_CMD_SET_DEST</span><span class="p">,</span>		<span class="cm">/* modify destination */</span>
	<span class="n">IPVS_CMD_DEL_DEST</span><span class="p">,</span>		<span class="cm">/* delete destination */</span>
	<span class="n">IPVS_CMD_GET_DEST</span><span class="p">,</span>		<span class="cm">/* get destination info */</span>

	<span class="n">IPVS_CMD_NEW_DAEMON</span><span class="p">,</span>		<span class="cm">/* start sync daemon */</span>
	<span class="n">IPVS_CMD_DEL_DAEMON</span><span class="p">,</span>		<span class="cm">/* stop sync daemon */</span>
	<span class="n">IPVS_CMD_GET_DAEMON</span><span class="p">,</span>		<span class="cm">/* get sync daemon status */</span>

	<span class="n">IPVS_CMD_SET_CONFIG</span><span class="p">,</span>		<span class="cm">/* set config settings */</span>
	<span class="n">IPVS_CMD_GET_CONFIG</span><span class="p">,</span>		<span class="cm">/* get config settings */</span>

	<span class="n">IPVS_CMD_SET_INFO</span><span class="p">,</span>		<span class="cm">/* only used in GET_INFO reply */</span>
	<span class="n">IPVS_CMD_GET_INFO</span><span class="p">,</span>		<span class="cm">/* get general IPVS info */</span>

	<span class="n">IPVS_CMD_ZERO</span><span class="p">,</span>			<span class="cm">/* zero all counters and stats */</span>
	<span class="n">IPVS_CMD_FLUSH</span><span class="p">,</span>			<span class="cm">/* flush services and dests */</span>

	<span class="n">__IPVS_CMD_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define IPVS_CMD_MAX (__IPVS_CMD_MAX - 1)</span>

<span class="cm">/* Attributes used in the first level of commands */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">IPVS_CMD_ATTR_UNSPEC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IPVS_CMD_ATTR_SERVICE</span><span class="p">,</span>		<span class="cm">/* nested service attribute */</span>
	<span class="n">IPVS_CMD_ATTR_DEST</span><span class="p">,</span>		<span class="cm">/* nested destination attribute */</span>
	<span class="n">IPVS_CMD_ATTR_DAEMON</span><span class="p">,</span>		<span class="cm">/* nested sync daemon attribute */</span>
	<span class="n">IPVS_CMD_ATTR_TIMEOUT_TCP</span><span class="p">,</span>	<span class="cm">/* TCP connection timeout */</span>
	<span class="n">IPVS_CMD_ATTR_TIMEOUT_TCP_FIN</span><span class="p">,</span>	<span class="cm">/* TCP FIN wait timeout */</span>
	<span class="n">IPVS_CMD_ATTR_TIMEOUT_UDP</span><span class="p">,</span>	<span class="cm">/* UDP timeout */</span>
	<span class="n">__IPVS_CMD_ATTR_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define IPVS_CMD_ATTR_MAX (__IPVS_SVC_ATTR_MAX - 1)</span>

<span class="cm">/*</span>
<span class="cm"> * Attributes used to describe a service</span>
<span class="cm"> *</span>
<span class="cm"> * Used inside nested attribute IPVS_CMD_ATTR_SERVICE</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">IPVS_SVC_ATTR_UNSPEC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IPVS_SVC_ATTR_AF</span><span class="p">,</span>		<span class="cm">/* address family */</span>
	<span class="n">IPVS_SVC_ATTR_PROTOCOL</span><span class="p">,</span>		<span class="cm">/* virtual service protocol */</span>
	<span class="n">IPVS_SVC_ATTR_ADDR</span><span class="p">,</span>		<span class="cm">/* virtual service address */</span>
	<span class="n">IPVS_SVC_ATTR_PORT</span><span class="p">,</span>		<span class="cm">/* virtual service port */</span>
	<span class="n">IPVS_SVC_ATTR_FWMARK</span><span class="p">,</span>		<span class="cm">/* firewall mark of service */</span>

	<span class="n">IPVS_SVC_ATTR_SCHED_NAME</span><span class="p">,</span>	<span class="cm">/* name of scheduler */</span>
	<span class="n">IPVS_SVC_ATTR_FLAGS</span><span class="p">,</span>		<span class="cm">/* virtual service flags */</span>
	<span class="n">IPVS_SVC_ATTR_TIMEOUT</span><span class="p">,</span>		<span class="cm">/* persistent timeout */</span>
	<span class="n">IPVS_SVC_ATTR_NETMASK</span><span class="p">,</span>		<span class="cm">/* persistent netmask */</span>

	<span class="n">IPVS_SVC_ATTR_STATS</span><span class="p">,</span>		<span class="cm">/* nested attribute for service stats */</span>

	<span class="n">IPVS_SVC_ATTR_PE_NAME</span><span class="p">,</span>		<span class="cm">/* name of ct retriever */</span>

	<span class="n">__IPVS_SVC_ATTR_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define IPVS_SVC_ATTR_MAX (__IPVS_SVC_ATTR_MAX - 1)</span>

<span class="cm">/*</span>
<span class="cm"> * Attributes used to describe a destination (real server)</span>
<span class="cm"> *</span>
<span class="cm"> * Used inside nested attribute IPVS_CMD_ATTR_DEST</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">IPVS_DEST_ATTR_UNSPEC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IPVS_DEST_ATTR_ADDR</span><span class="p">,</span>		<span class="cm">/* real server address */</span>
	<span class="n">IPVS_DEST_ATTR_PORT</span><span class="p">,</span>		<span class="cm">/* real server port */</span>

	<span class="n">IPVS_DEST_ATTR_FWD_METHOD</span><span class="p">,</span>	<span class="cm">/* forwarding method */</span>
	<span class="n">IPVS_DEST_ATTR_WEIGHT</span><span class="p">,</span>		<span class="cm">/* destination weight */</span>

	<span class="n">IPVS_DEST_ATTR_U_THRESH</span><span class="p">,</span>	<span class="cm">/* upper threshold */</span>
	<span class="n">IPVS_DEST_ATTR_L_THRESH</span><span class="p">,</span>	<span class="cm">/* lower threshold */</span>

	<span class="n">IPVS_DEST_ATTR_ACTIVE_CONNS</span><span class="p">,</span>	<span class="cm">/* active connections */</span>
	<span class="n">IPVS_DEST_ATTR_INACT_CONNS</span><span class="p">,</span>	<span class="cm">/* inactive connections */</span>
	<span class="n">IPVS_DEST_ATTR_PERSIST_CONNS</span><span class="p">,</span>	<span class="cm">/* persistent connections */</span>

	<span class="n">IPVS_DEST_ATTR_STATS</span><span class="p">,</span>		<span class="cm">/* nested attribute for dest stats */</span>
	<span class="n">__IPVS_DEST_ATTR_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define IPVS_DEST_ATTR_MAX (__IPVS_DEST_ATTR_MAX - 1)</span>

<span class="cm">/*</span>
<span class="cm"> * Attributes describing a sync daemon</span>
<span class="cm"> *</span>
<span class="cm"> * Used inside nested attribute IPVS_CMD_ATTR_DAEMON</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">IPVS_DAEMON_ATTR_UNSPEC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IPVS_DAEMON_ATTR_STATE</span><span class="p">,</span>		<span class="cm">/* sync daemon state (master/backup) */</span>
	<span class="n">IPVS_DAEMON_ATTR_MCAST_IFN</span><span class="p">,</span>	<span class="cm">/* multicast interface name */</span>
	<span class="n">IPVS_DAEMON_ATTR_SYNC_ID</span><span class="p">,</span>	<span class="cm">/* SyncID we belong to */</span>
	<span class="n">__IPVS_DAEMON_ATTR_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define IPVS_DAEMON_ATTR_MAX (__IPVS_DAEMON_ATTR_MAX - 1)</span>

<span class="cm">/*</span>
<span class="cm"> * Attributes used to describe service or destination entry statistics</span>
<span class="cm"> *</span>
<span class="cm"> * Used inside nested attributes IPVS_SVC_ATTR_STATS and IPVS_DEST_ATTR_STATS</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">IPVS_STATS_ATTR_UNSPEC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IPVS_STATS_ATTR_CONNS</span><span class="p">,</span>		<span class="cm">/* connections scheduled */</span>
	<span class="n">IPVS_STATS_ATTR_INPKTS</span><span class="p">,</span>		<span class="cm">/* incoming packets */</span>
	<span class="n">IPVS_STATS_ATTR_OUTPKTS</span><span class="p">,</span>	<span class="cm">/* outgoing packets */</span>
	<span class="n">IPVS_STATS_ATTR_INBYTES</span><span class="p">,</span>	<span class="cm">/* incoming bytes */</span>
	<span class="n">IPVS_STATS_ATTR_OUTBYTES</span><span class="p">,</span>	<span class="cm">/* outgoing bytes */</span>

	<span class="n">IPVS_STATS_ATTR_CPS</span><span class="p">,</span>		<span class="cm">/* current connection rate */</span>
	<span class="n">IPVS_STATS_ATTR_INPPS</span><span class="p">,</span>		<span class="cm">/* current in packet rate */</span>
	<span class="n">IPVS_STATS_ATTR_OUTPPS</span><span class="p">,</span>		<span class="cm">/* current out packet rate */</span>
	<span class="n">IPVS_STATS_ATTR_INBPS</span><span class="p">,</span>		<span class="cm">/* current in byte rate */</span>
	<span class="n">IPVS_STATS_ATTR_OUTBPS</span><span class="p">,</span>		<span class="cm">/* current out byte rate */</span>
	<span class="n">__IPVS_STATS_ATTR_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define IPVS_STATS_ATTR_MAX (__IPVS_STATS_ATTR_MAX - 1)</span>

<span class="cm">/* Attributes used in response to IPVS_CMD_GET_INFO command */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">IPVS_INFO_ATTR_UNSPEC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IPVS_INFO_ATTR_VERSION</span><span class="p">,</span>		<span class="cm">/* IPVS version number */</span>
	<span class="n">IPVS_INFO_ATTR_CONN_TAB_SIZE</span><span class="p">,</span>	<span class="cm">/* size of connection hash table */</span>
	<span class="n">__IPVS_INFO_ATTR_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define IPVS_INFO_ATTR_MAX (__IPVS_INFO_ATTR_MAX - 1)</span>

<span class="cp">#endif	</span><span class="cm">/* _IP_VS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
