<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › nubus.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>nubus.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">  nubus.h: various definitions and prototypes for NuBus drivers to use.</span>

<span class="cm">  Originally written by Alan Cox.</span>

<span class="cm">  Hacked to death by C. Scott Ananian and David Huggins-Daines.</span>
<span class="cm">  </span>
<span class="cm">  Some of the constants in here are from the corresponding</span>
<span class="cm">  NetBSD/OpenBSD header file, by Allen Briggs.  We figured out the</span>
<span class="cm">  rest of them on our own. */</span>

<span class="cp">#ifndef LINUX_NUBUS_H</span>
<span class="cp">#define LINUX_NUBUS_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#include &lt;asm/nubus.h&gt;</span>
<span class="cp">#endif</span>

<span class="k">enum</span> <span class="n">nubus_category</span> <span class="p">{</span>
	<span class="n">NUBUS_CAT_BOARD</span>          <span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">NUBUS_CAT_DISPLAY</span>        <span class="o">=</span> <span class="mh">0x0003</span><span class="p">,</span>
	<span class="n">NUBUS_CAT_NETWORK</span>        <span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">NUBUS_CAT_COMMUNICATIONS</span> <span class="o">=</span> <span class="mh">0x0006</span><span class="p">,</span>
	<span class="n">NUBUS_CAT_FONT</span>           <span class="o">=</span> <span class="mh">0x0009</span><span class="p">,</span>
	<span class="n">NUBUS_CAT_CPU</span>            <span class="o">=</span> <span class="mh">0x000A</span><span class="p">,</span>
	<span class="cm">/* For lack of a better name */</span>
	<span class="n">NUBUS_CAT_DUODOCK</span>        <span class="o">=</span> <span class="mh">0x0020</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">nubus_type_network</span> <span class="p">{</span>
	<span class="n">NUBUS_TYPE_ETHERNET</span>      <span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">NUBUS_TYPE_RS232</span>         <span class="o">=</span> <span class="mh">0x0002</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">nubus_type_display</span> <span class="p">{</span>
	<span class="n">NUBUS_TYPE_VIDEO</span>         <span class="o">=</span> <span class="mh">0x0001</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">nubus_type_cpu</span> <span class="p">{</span>
	<span class="n">NUBUS_TYPE_68020</span>         <span class="o">=</span> <span class="mh">0x0003</span><span class="p">,</span>
	<span class="n">NUBUS_TYPE_68030</span>         <span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">NUBUS_TYPE_68040</span>         <span class="o">=</span> <span class="mh">0x0005</span>
<span class="p">};</span>

<span class="cm">/* Known &lt;Cat,Type,SW,HW&gt; tuples: (according to TattleTech and Slots)</span>
<span class="cm"> *  68030 motherboards: &lt;10,4,0,24&gt;</span>
<span class="cm"> *  68040 motherboards: &lt;10,5,0,24&gt;</span>
<span class="cm"> *  DuoDock Plus: &lt;32,1,1,2&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  Toby Frame Buffer card: &lt;3,1,1,1&gt;</span>
<span class="cm"> *  RBV built-in video (IIci): &lt;3,1,1,24&gt;</span>
<span class="cm"> *  Valkyrie built-in video (Q630): &lt;3,1,1,46&gt;</span>
<span class="cm"> *  Macintosh Display Card: &lt;3,1,1,25&gt;</span>
<span class="cm"> *  Sonora built-in video (P460): &lt;3,1,1,34&gt;</span>
<span class="cm"> *  Jet framebuffer (DuoDock Plus): &lt;3,1,1,41&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  SONIC comm-slot/on-board and DuoDock Ethernet: &lt;4,1,1,272&gt;</span>
<span class="cm"> *  SONIC LC-PDS Ethernet (Dayna, but like Apple 16-bit, sort of): &lt;4,1,1,271&gt;</span>
<span class="cm"> *  Apple SONIC LC-PDS Ethernet (&quot;Apple Ethernet LC Twisted-Pair Card&quot;): &lt;4,1,0,281&gt;</span>
<span class="cm"> *  Sonic Systems Ethernet A-Series Card: &lt;4,1,268,256&gt;</span>
<span class="cm"> *  Asante MacCon NuBus-A: &lt;4,1,260,256&gt; (alpha-1.0,1.1 revision)</span>
<span class="cm"> *   ROM on the above card: &lt;2,1,0,0&gt;</span>
<span class="cm"> *  Cabletron ethernet card: &lt;4,1,1,265&gt;</span>
<span class="cm"> *  Farallon ethernet card: &lt;4,1,268,256&gt; (identical to Sonic Systems card)</span>
<span class="cm"> *  Kinetics EtherPort IIN: &lt;4,1,259,262&gt;</span>
<span class="cm"> *  API Engineering EtherRun_LCa PDS enet card: &lt;4,1,282,256&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  Add your devices to the list!  You can obtain the &quot;Slots&quot; utility</span>
<span class="cm"> *  from Apple&#39;s FTP site at:</span>
<span class="cm"> *  ftp://dev.apple.com/devworld/Tool_Chest/Devices_-_Hardware/NuBus_Slot_Manager/</span>
<span class="cm"> *</span>
<span class="cm"> *  Alternately, TattleTech can be found at any Info-Mac mirror site.  </span>
<span class="cm"> *  or from its distribution site: ftp://ftp.decismkr.com/dms</span>
<span class="cm"> */</span>

<span class="cm">/* DrSW: Uniquely identifies the software interface to a board.  This</span>
<span class="cm">   is usually the one you want to look at when writing a driver.  It&#39;s</span>
<span class="cm">   not as useful as you think, though, because as we should know by</span>
<span class="cm">   now (duh), &quot;Apple Compatible&quot; can mean a lot of things... */</span>

<span class="cm">/* Add known DrSW values here */</span>
<span class="k">enum</span> <span class="n">nubus_drsw</span> <span class="p">{</span>
	<span class="cm">/* NUBUS_CAT_DISPLAY */</span>
	<span class="n">NUBUS_DRSW_APPLE</span>        <span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_APPLE_HIRES</span>  <span class="o">=</span> <span class="mh">0x0013</span><span class="p">,</span> <span class="cm">/* MacII HiRes card driver */</span>
	
	<span class="cm">/* NUBUS_CAT_NETWORK */</span>
	<span class="n">NUBUS_DRSW_3COM</span>         <span class="o">=</span> <span class="mh">0x0000</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_CABLETRON</span>    <span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_SONIC_LC</span>     <span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_KINETICS</span>     <span class="o">=</span> <span class="mh">0x0103</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_ASANTE</span>       <span class="o">=</span> <span class="mh">0x0104</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_TECHWORKS</span>    <span class="o">=</span> <span class="mh">0x0109</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_DAYNA</span>        <span class="o">=</span> <span class="mh">0x010b</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_FARALLON</span>     <span class="o">=</span> <span class="mh">0x010c</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_APPLE_SN</span>     <span class="o">=</span> <span class="mh">0x010f</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_DAYNA2</span>       <span class="o">=</span> <span class="mh">0x0115</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_FOCUS</span>        <span class="o">=</span> <span class="mh">0x011a</span><span class="p">,</span>
	<span class="n">NUBUS_DRSW_ASANTE_CS</span>    <span class="o">=</span> <span class="mh">0x011d</span><span class="p">,</span> <span class="cm">/* use asante SMC9194 driver */</span>
	<span class="n">NUBUS_DRSW_DAYNA_LC</span>     <span class="o">=</span> <span class="mh">0x011e</span><span class="p">,</span>

	<span class="cm">/* NUBUS_CAT_CPU */</span>
	<span class="n">NUBUS_DRSW_NONE</span>         <span class="o">=</span> <span class="mh">0x0000</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* DrHW: Uniquely identifies the hardware interface to a board (or at</span>
<span class="cm">   least, it should...  some video cards are known to incorrectly</span>
<span class="cm">   identify themselves as Toby cards) */</span>

<span class="cm">/* Add known DrHW values here */</span>
<span class="k">enum</span> <span class="n">nubus_drhw</span> <span class="p">{</span>
	<span class="cm">/* NUBUS_CAT_DISPLAY */</span>
	<span class="n">NUBUS_DRHW_APPLE_TFB</span>      <span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span> <span class="cm">/* Toby frame buffer card */</span>
	<span class="n">NUBUS_DRHW_APPLE_WVC</span>      <span class="o">=</span> <span class="mh">0x0006</span><span class="p">,</span> <span class="cm">/* Apple Workstation Video Card */</span>
	<span class="n">NUBUS_DRHW_SIGMA_CLRMAX</span>   <span class="o">=</span> <span class="mh">0x0007</span><span class="p">,</span> <span class="cm">/* Sigma Design ColorMax */</span>
	<span class="n">NUBUS_DRHW_APPLE_SE30</span>     <span class="o">=</span> <span class="mh">0x0009</span><span class="p">,</span> <span class="cm">/* Apple SE/30 video */</span>
	<span class="n">NUBUS_DRHW_APPLE_HRVC</span>     <span class="o">=</span> <span class="mh">0x0013</span><span class="p">,</span> <span class="cm">/* Mac II High-Res Video Card */</span>
	<span class="n">NUBUS_DRHW_APPLE_PVC</span>      <span class="o">=</span> <span class="mh">0x0017</span><span class="p">,</span> <span class="cm">/* Mac II Portrait Video Card */</span>
	<span class="n">NUBUS_DRHW_APPLE_RBV1</span>     <span class="o">=</span> <span class="mh">0x0018</span><span class="p">,</span> <span class="cm">/* IIci RBV video */</span>
	<span class="n">NUBUS_DRHW_APPLE_MDC</span>      <span class="o">=</span> <span class="mh">0x0019</span><span class="p">,</span> <span class="cm">/* Macintosh Display Card */</span>
	<span class="n">NUBUS_DRHW_APPLE_SONORA</span>   <span class="o">=</span> <span class="mh">0x0022</span><span class="p">,</span> <span class="cm">/* Sonora built-in video */</span>
	<span class="n">NUBUS_DRHW_APPLE_24AC</span>     <span class="o">=</span> <span class="mh">0x002b</span><span class="p">,</span> <span class="cm">/* Mac 24AC Video Card */</span>
	<span class="n">NUBUS_DRHW_APPLE_VALKYRIE</span> <span class="o">=</span> <span class="mh">0x002e</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_APPLE_JET</span>      <span class="o">=</span> <span class="mh">0x0029</span><span class="p">,</span> <span class="cm">/* Jet framebuffer (DuoDock) */</span>
	<span class="n">NUBUS_DRHW_SMAC_GFX</span>       <span class="o">=</span> <span class="mh">0x0105</span><span class="p">,</span> <span class="cm">/* SuperMac GFX */</span>
	<span class="n">NUBUS_DRHW_RASTER_CB264</span>   <span class="o">=</span> <span class="mh">0x013B</span><span class="p">,</span> <span class="cm">/* RasterOps ColorBoard 264 */</span>
	<span class="n">NUBUS_DRHW_MICRON_XCEED</span>   <span class="o">=</span> <span class="mh">0x0146</span><span class="p">,</span> <span class="cm">/* Micron Exceed color */</span>
	<span class="n">NUBUS_DRHW_RDIUS_GSC</span>      <span class="o">=</span> <span class="mh">0x0153</span><span class="p">,</span> <span class="cm">/* Radius GS/C */</span>
	<span class="n">NUBUS_DRHW_SMAC_SPEC8</span>     <span class="o">=</span> <span class="mh">0x017B</span><span class="p">,</span> <span class="cm">/* SuperMac Spectrum/8 */</span>
	<span class="n">NUBUS_DRHW_SMAC_SPEC24</span>    <span class="o">=</span> <span class="mh">0x017C</span><span class="p">,</span> <span class="cm">/* SuperMac Spectrum/24 */</span>
	<span class="n">NUBUS_DRHW_RASTER_CB364</span>   <span class="o">=</span> <span class="mh">0x026F</span><span class="p">,</span> <span class="cm">/* RasterOps ColorBoard 364 */</span>
	<span class="n">NUBUS_DRHW_RDIUS_DCGX</span>     <span class="o">=</span> <span class="mh">0x027C</span><span class="p">,</span> <span class="cm">/* Radius DirectColor/GX */</span>
	<span class="n">NUBUS_DRHW_RDIUS_PC8</span>      <span class="o">=</span> <span class="mh">0x0291</span><span class="p">,</span> <span class="cm">/* Radius PrecisionColor 8 */</span>
	<span class="n">NUBUS_DRHW_LAPIS_PCS8</span>     <span class="o">=</span> <span class="mh">0x0292</span><span class="p">,</span> <span class="cm">/* Lapis ProColorServer 8 */</span>
	<span class="n">NUBUS_DRHW_RASTER_24XLI</span>   <span class="o">=</span> <span class="mh">0x02A0</span><span class="p">,</span> <span class="cm">/* RasterOps 8/24 XLi */</span>
	<span class="n">NUBUS_DRHW_RASTER_PBPGT</span>   <span class="o">=</span> <span class="mh">0x02A5</span><span class="p">,</span> <span class="cm">/* RasterOps PaintBoard Prism GT */</span>
	<span class="n">NUBUS_DRHW_EMACH_FSX</span>      <span class="o">=</span> <span class="mh">0x02AE</span><span class="p">,</span> <span class="cm">/* E-Machines Futura SX */</span>
	<span class="n">NUBUS_DRHW_RASTER_24XLTV</span>  <span class="o">=</span> <span class="mh">0x02B7</span><span class="p">,</span> <span class="cm">/* RasterOps 24XLTV */</span>
	<span class="n">NUBUS_DRHW_SMAC_THUND24</span>   <span class="o">=</span> <span class="mh">0x02CB</span><span class="p">,</span> <span class="cm">/* SuperMac Thunder/24 */</span>
	<span class="n">NUBUS_DRHW_SMAC_THUNDLGHT</span> <span class="o">=</span> <span class="mh">0x03D9</span><span class="p">,</span> <span class="cm">/* SuperMac ThunderLight */</span>
	<span class="n">NUBUS_DRHW_RDIUS_PC24XP</span>   <span class="o">=</span> <span class="mh">0x0406</span><span class="p">,</span> <span class="cm">/* Radius PrecisionColor 24Xp */</span>
	<span class="n">NUBUS_DRHW_RDIUS_PC24X</span>    <span class="o">=</span> <span class="mh">0x040A</span><span class="p">,</span> <span class="cm">/* Radius PrecisionColor 24X */</span>
	<span class="n">NUBUS_DRHW_RDIUS_PC8XJ</span>    <span class="o">=</span> <span class="mh">0x040B</span><span class="p">,</span> <span class="cm">/* Radius PrecisionColor 8XJ */</span>
	
	<span class="cm">/* NUBUS_CAT_NETWORK */</span>
	<span class="n">NUBUS_DRHW_INTERLAN</span>       <span class="o">=</span> <span class="mh">0x0100</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_SMC9194</span>        <span class="o">=</span> <span class="mh">0x0101</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_KINETICS</span>       <span class="o">=</span> <span class="mh">0x0106</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_CABLETRON</span>      <span class="o">=</span> <span class="mh">0x0109</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_ASANTE_LC</span>      <span class="o">=</span> <span class="mh">0x010f</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_SONIC</span>          <span class="o">=</span> <span class="mh">0x0110</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_TECHWORKS</span>      <span class="o">=</span> <span class="mh">0x0112</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_APPLE_SONIC_NB</span> <span class="o">=</span> <span class="mh">0x0118</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_APPLE_SONIC_LC</span> <span class="o">=</span> <span class="mh">0x0119</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_FOCUS</span>          <span class="o">=</span> <span class="mh">0x011c</span><span class="p">,</span>
	<span class="n">NUBUS_DRHW_SONNET</span>         <span class="o">=</span> <span class="mh">0x011d</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Resource IDs: These are the identifiers for the various weird and</span>
<span class="cm">   wonderful tidbits of information that may or may not reside in the</span>
<span class="cm">   NuBus ROM directory. */</span>
<span class="k">enum</span> <span class="n">nubus_res_id</span> <span class="p">{</span>
	<span class="n">NUBUS_RESID_TYPE</span>         <span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_NAME</span>         <span class="o">=</span> <span class="mh">0x0002</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_ICON</span>         <span class="o">=</span> <span class="mh">0x0003</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_DRVRDIR</span>      <span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_LOADREC</span>      <span class="o">=</span> <span class="mh">0x0005</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_BOOTREC</span>      <span class="o">=</span> <span class="mh">0x0006</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_FLAGS</span>        <span class="o">=</span> <span class="mh">0x0007</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_HWDEVID</span>      <span class="o">=</span> <span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_MINOR_BASEOS</span> <span class="o">=</span> <span class="mh">0x000a</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_MINOR_LENGTH</span> <span class="o">=</span> <span class="mh">0x000b</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_MAJOR_BASEOS</span> <span class="o">=</span> <span class="mh">0x000c</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_MAJOR_LENGTH</span> <span class="o">=</span> <span class="mh">0x000d</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_CICN</span>         <span class="o">=</span> <span class="mh">0x000f</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_ICL8</span>         <span class="o">=</span> <span class="mh">0x0010</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_ICL4</span>         <span class="o">=</span> <span class="mh">0x0011</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Category-specific resources. */</span>
<span class="k">enum</span> <span class="n">nubus_board_res_id</span> <span class="p">{</span>
	<span class="n">NUBUS_RESID_BOARDID</span>      <span class="o">=</span> <span class="mh">0x0020</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_PRAMINITDATA</span> <span class="o">=</span> <span class="mh">0x0021</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_PRIMARYINIT</span>  <span class="o">=</span> <span class="mh">0x0022</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_TIMEOUTCONST</span> <span class="o">=</span> <span class="mh">0x0023</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_VENDORINFO</span>   <span class="o">=</span> <span class="mh">0x0024</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_BOARDFLAGS</span>   <span class="o">=</span> <span class="mh">0x0025</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_SECONDINIT</span>   <span class="o">=</span> <span class="mh">0x0026</span><span class="p">,</span>

	<span class="cm">/* Not sure why Apple put these next two in here */</span>
	<span class="n">NUBUS_RESID_VIDNAMES</span>     <span class="o">=</span> <span class="mh">0x0041</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_VIDMODES</span>     <span class="o">=</span> <span class="mh">0x007e</span>
<span class="p">};</span>

<span class="cm">/* Fields within the vendor info directory */</span>
<span class="k">enum</span> <span class="n">nubus_vendor_res_id</span> <span class="p">{</span>
	<span class="n">NUBUS_RESID_VEND_ID</span>     <span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_VEND_SERIAL</span> <span class="o">=</span> <span class="mh">0x0002</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_VEND_REV</span>    <span class="o">=</span> <span class="mh">0x0003</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_VEND_PART</span>   <span class="o">=</span> <span class="mh">0x0004</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_VEND_DATE</span>   <span class="o">=</span> <span class="mh">0x0005</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">nubus_net_res_id</span> <span class="p">{</span>
	<span class="n">NUBUS_RESID_MAC_ADDRESS</span>  <span class="o">=</span> <span class="mh">0x0080</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">nubus_cpu_res_id</span> <span class="p">{</span>
	<span class="n">NUBUS_RESID_MEMINFO</span>      <span class="o">=</span> <span class="mh">0x0081</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_ROMINFO</span>      <span class="o">=</span> <span class="mh">0x0082</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">nubus_display_res_id</span> <span class="p">{</span>
	<span class="n">NUBUS_RESID_GAMMADIR</span>    <span class="o">=</span> <span class="mh">0x0040</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_FIRSTMODE</span>   <span class="o">=</span> <span class="mh">0x0080</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_SECONDMODE</span>  <span class="o">=</span> <span class="mh">0x0081</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_THIRDMODE</span>   <span class="o">=</span> <span class="mh">0x0082</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_FOURTHMODE</span>  <span class="o">=</span> <span class="mh">0x0083</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_FIFTHMODE</span>   <span class="o">=</span> <span class="mh">0x0084</span><span class="p">,</span>
	<span class="n">NUBUS_RESID_SIXTHMODE</span>   <span class="o">=</span> <span class="mh">0x0085</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nubus_dir</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">done</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mask</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nubus_dirent</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">data</span><span class="p">;</span>	<span class="cm">/* Actually 24bits used */</span>
	<span class="kt">int</span> <span class="n">mask</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="k">struct</span> <span class="n">nubus_board</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">nubus_board</span><span class="o">*</span> <span class="n">next</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nubus_dev</span><span class="o">*</span> <span class="n">first_dev</span><span class="p">;</span>
	
	<span class="cm">/* Only 9-E actually exist, though 0-8 are also theoretically</span>
<span class="cm">	   possible, and 0 is a special case which represents the</span>
<span class="cm">	   motherboard and onboard peripherals (Ethernet, video) */</span>
	<span class="kt">int</span> <span class="n">slot</span><span class="p">;</span>
	<span class="cm">/* For slot 0, this is bogus. */</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

	<span class="cm">/* Format block */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">fblock</span><span class="p">;</span>
	<span class="cm">/* Root directory (does *not* always equal fblock + doffset!) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">directory</span><span class="p">;</span>
	
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">slot_addr</span><span class="p">;</span>
	<span class="cm">/* Offset to root directory (sometimes) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">doffset</span><span class="p">;</span>
	<span class="cm">/* Length over which to compute the crc */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rom_length</span><span class="p">;</span>
	<span class="cm">/* Completely useless most of the time */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">crc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">rev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">format</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">lanes</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nubus_dev</span> <span class="p">{</span>
	<span class="cm">/* Next link in device list */</span>
	<span class="k">struct</span> <span class="n">nubus_dev</span><span class="o">*</span> <span class="n">next</span><span class="p">;</span>
	<span class="cm">/* Directory entry in /proc/bus/nubus */</span>
	<span class="k">struct</span> <span class="n">proc_dir_entry</span><span class="o">*</span> <span class="n">procdir</span><span class="p">;</span>

	<span class="cm">/* The functional resource ID of this device */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">resid</span><span class="p">;</span>
	<span class="cm">/* These are mostly here for convenience; we could always read</span>
<span class="cm">	   them from the ROMs if we wanted to */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">category</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">dr_sw</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">dr_hw</span><span class="p">;</span>
	<span class="cm">/* This is the device&#39;s name rather than the board&#39;s.</span>
<span class="cm">	   Sometimes they are different.  Usually the board name is</span>
<span class="cm">	   more correct. */</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="cm">/* MacOS driver (I kid you not) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">driver</span><span class="p">;</span>
	<span class="cm">/* Actually this is an offset */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">iobase</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">iosize</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">flags</span><span class="p">,</span> <span class="n">hwdevid</span><span class="p">;</span>
	
	<span class="cm">/* Functional directory */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">directory</span><span class="p">;</span>
	<span class="cm">/* Much of our info comes from here */</span>
	<span class="k">struct</span> <span class="n">nubus_board</span><span class="o">*</span> <span class="n">board</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* This is all NuBus devices (used to find devices later on) */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">nubus_dev</span><span class="o">*</span> <span class="n">nubus_devices</span><span class="p">;</span>
<span class="cm">/* This is all NuBus cards */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">nubus_board</span><span class="o">*</span> <span class="n">nubus_boards</span><span class="p">;</span>

<span class="cm">/* Generic NuBus interface functions, modelled after the PCI interface */</span>
<span class="kt">void</span> <span class="n">nubus_scan_bus</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nubus_proc_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">get_nubus_list</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nubus_proc_attach_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">nubus_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nubus_proc_detach_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">nubus_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="cm">/* If we need more precision we can add some more of these */</span>
<span class="k">struct</span> <span class="n">nubus_dev</span><span class="o">*</span> <span class="n">nubus_find_device</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">category</span><span class="p">,</span>
				    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">type</span><span class="p">,</span>
				    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">dr_hw</span><span class="p">,</span>
				    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">dr_sw</span><span class="p">,</span>
				    <span class="k">const</span> <span class="k">struct</span> <span class="n">nubus_dev</span><span class="o">*</span> <span class="n">from</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">nubus_dev</span><span class="o">*</span> <span class="n">nubus_find_type</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">category</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">type</span><span class="p">,</span>
				  <span class="k">const</span> <span class="k">struct</span> <span class="n">nubus_dev</span><span class="o">*</span> <span class="n">from</span><span class="p">);</span>
<span class="cm">/* Might have more than one device in a slot, you know... */</span>
<span class="k">struct</span> <span class="n">nubus_dev</span><span class="o">*</span> <span class="n">nubus_find_slot</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slot</span><span class="p">,</span>
				  <span class="k">const</span> <span class="k">struct</span> <span class="n">nubus_dev</span><span class="o">*</span> <span class="n">from</span><span class="p">);</span>

<span class="cm">/* These are somewhat more NuBus-specific.  They all return 0 for</span>
<span class="cm">   success and -1 for failure, as you&#39;d expect. */</span>

<span class="cm">/* The root directory which contains the board and functional</span>
<span class="cm">   directories */</span>
<span class="kt">int</span> <span class="n">nubus_get_root_dir</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">nubus_board</span><span class="o">*</span> <span class="n">board</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">nubus_dir</span><span class="o">*</span> <span class="n">dir</span><span class="p">);</span>
<span class="cm">/* The board directory */</span>
<span class="kt">int</span> <span class="n">nubus_get_board_dir</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">nubus_board</span><span class="o">*</span> <span class="n">board</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">nubus_dir</span><span class="o">*</span> <span class="n">dir</span><span class="p">);</span>
<span class="cm">/* The functional directory */</span>
<span class="kt">int</span> <span class="n">nubus_get_func_dir</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">nubus_dev</span><span class="o">*</span> <span class="n">dev</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">nubus_dir</span><span class="o">*</span> <span class="n">dir</span><span class="p">);</span>

<span class="cm">/* These work on any directory gotten via the above */</span>
<span class="kt">int</span> <span class="n">nubus_readdir</span><span class="p">(</span><span class="k">struct</span> <span class="n">nubus_dir</span><span class="o">*</span> <span class="n">dir</span><span class="p">,</span>
		  <span class="k">struct</span> <span class="n">nubus_dirent</span><span class="o">*</span> <span class="n">ent</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nubus_find_rsrc</span><span class="p">(</span><span class="k">struct</span> <span class="n">nubus_dir</span><span class="o">*</span> <span class="n">dir</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">rsrc_type</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">nubus_dirent</span><span class="o">*</span> <span class="n">ent</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nubus_rewinddir</span><span class="p">(</span><span class="k">struct</span> <span class="n">nubus_dir</span><span class="o">*</span> <span class="n">dir</span><span class="p">);</span>

<span class="cm">/* Things to do with directory entries */</span>
<span class="kt">int</span> <span class="n">nubus_get_subdir</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">nubus_dirent</span><span class="o">*</span> <span class="n">ent</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">nubus_dir</span><span class="o">*</span> <span class="n">dir</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">nubus_get_rsrc_mem</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">dest</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">nubus_dirent</span> <span class="o">*</span><span class="n">dirent</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">nubus_get_rsrc_str</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">dest</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">nubus_dirent</span> <span class="o">*</span><span class="n">dirent</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">maxlen</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cm">/* We&#39;d like to get rid of this eventually.  Only daynaport.c uses it now. */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span><span class="nf">nubus_slot_addr</span><span class="p">(</span><span class="kt">int</span> <span class="n">slot</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="mh">0xF0000000</span><span class="o">|</span><span class="p">(</span><span class="n">slot</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* LINUX_NUBUS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
