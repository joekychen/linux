<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › efi.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>efi.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _LINUX_EFI_H</span>
<span class="cp">#define _LINUX_EFI_H</span>

<span class="cm">/*</span>
<span class="cm"> * Extensible Firmware Interface</span>
<span class="cm"> * Based on &#39;Extensible Firmware Interface Specification&#39; version 0.9, April 30, 1999</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1999 VA Linux Systems</span>
<span class="cm"> * Copyright (C) 1999 Walt Drummond &lt;drummond@valinux.com&gt;</span>
<span class="cm"> * Copyright (C) 1999, 2002-2003 Hewlett-Packard Co.</span>
<span class="cm"> *	David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;</span>
<span class="cm"> *	Stephane Eranian &lt;eranian@hpl.hp.com&gt;</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/time.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/proc_fs.h&gt;</span>
<span class="cp">#include &lt;linux/rtc.h&gt;</span>
<span class="cp">#include &lt;linux/ioport.h&gt;</span>
<span class="cp">#include &lt;linux/pfn.h&gt;</span>
<span class="cp">#include &lt;linux/pstore.h&gt;</span>

<span class="cp">#include &lt;asm/page.h&gt;</span>

<span class="cp">#define EFI_SUCCESS		0</span>
<span class="cp">#define EFI_LOAD_ERROR          ( 1 | (1UL &lt;&lt; (BITS_PER_LONG-1)))</span>
<span class="cp">#define EFI_INVALID_PARAMETER	( 2 | (1UL &lt;&lt; (BITS_PER_LONG-1)))</span>
<span class="cp">#define EFI_UNSUPPORTED		( 3 | (1UL &lt;&lt; (BITS_PER_LONG-1)))</span>
<span class="cp">#define EFI_BAD_BUFFER_SIZE     ( 4 | (1UL &lt;&lt; (BITS_PER_LONG-1)))</span>
<span class="cp">#define EFI_BUFFER_TOO_SMALL	( 5 | (1UL &lt;&lt; (BITS_PER_LONG-1)))</span>
<span class="cp">#define EFI_NOT_FOUND		(14 | (1UL &lt;&lt; (BITS_PER_LONG-1)))</span>

<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">efi_status_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">u8</span> <span class="n">efi_bool_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">u16</span> <span class="n">efi_char16_t</span><span class="p">;</span>		<span class="cm">/* UNICODE character */</span>


<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">b</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="p">}</span> <span class="n">efi_guid_t</span><span class="p">;</span>

<span class="cp">#define EFI_GUID(a,b,c,d0,d1,d2,d3,d4,d5,d6,d7) \</span>
<span class="cp">((efi_guid_t) \</span>
<span class="cp">{{ (a) &amp; 0xff, ((a) &gt;&gt; 8) &amp; 0xff, ((a) &gt;&gt; 16) &amp; 0xff, ((a) &gt;&gt; 24) &amp; 0xff, \</span>
<span class="cp">  (b) &amp; 0xff, ((b) &gt;&gt; 8) &amp; 0xff, \</span>
<span class="cp">  (c) &amp; 0xff, ((c) &gt;&gt; 8) &amp; 0xff, \</span>
<span class="cp">  (d0), (d1), (d2), (d3), (d4), (d5), (d6), (d7) }})</span>

<span class="cm">/*</span>
<span class="cm"> * Generic EFI table header</span>
<span class="cm"> */</span>
<span class="k">typedef</span>	<span class="k">struct</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">signature</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">revision</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">headersize</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">crc32</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_table_hdr_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Memory map descriptor:</span>
<span class="cm"> */</span>

<span class="cm">/* Memory types: */</span>
<span class="cp">#define EFI_RESERVED_TYPE		 0</span>
<span class="cp">#define EFI_LOADER_CODE			 1</span>
<span class="cp">#define EFI_LOADER_DATA			 2</span>
<span class="cp">#define EFI_BOOT_SERVICES_CODE		 3</span>
<span class="cp">#define EFI_BOOT_SERVICES_DATA		 4</span>
<span class="cp">#define EFI_RUNTIME_SERVICES_CODE	 5</span>
<span class="cp">#define EFI_RUNTIME_SERVICES_DATA	 6</span>
<span class="cp">#define EFI_CONVENTIONAL_MEMORY		 7</span>
<span class="cp">#define EFI_UNUSABLE_MEMORY		 8</span>
<span class="cp">#define EFI_ACPI_RECLAIM_MEMORY		 9</span>
<span class="cp">#define EFI_ACPI_MEMORY_NVS		10</span>
<span class="cp">#define EFI_MEMORY_MAPPED_IO		11</span>
<span class="cp">#define EFI_MEMORY_MAPPED_IO_PORT_SPACE	12</span>
<span class="cp">#define EFI_PAL_CODE			13</span>
<span class="cp">#define EFI_MAX_MEMORY_TYPE		14</span>

<span class="cm">/* Attribute values: */</span>
<span class="cp">#define EFI_MEMORY_UC		((u64)0x0000000000000001ULL)	</span><span class="cm">/* uncached */</span><span class="cp"></span>
<span class="cp">#define EFI_MEMORY_WC		((u64)0x0000000000000002ULL)	</span><span class="cm">/* write-coalescing */</span><span class="cp"></span>
<span class="cp">#define EFI_MEMORY_WT		((u64)0x0000000000000004ULL)	</span><span class="cm">/* write-through */</span><span class="cp"></span>
<span class="cp">#define EFI_MEMORY_WB		((u64)0x0000000000000008ULL)	</span><span class="cm">/* write-back */</span><span class="cp"></span>
<span class="cp">#define EFI_MEMORY_WP		((u64)0x0000000000001000ULL)	</span><span class="cm">/* write-protect */</span><span class="cp"></span>
<span class="cp">#define EFI_MEMORY_RP		((u64)0x0000000000002000ULL)	</span><span class="cm">/* read-protect */</span><span class="cp"></span>
<span class="cp">#define EFI_MEMORY_XP		((u64)0x0000000000004000ULL)	</span><span class="cm">/* execute-protect */</span><span class="cp"></span>
<span class="cp">#define EFI_MEMORY_RUNTIME	((u64)0x8000000000000000ULL)	</span><span class="cm">/* range requires runtime mapping */</span><span class="cp"></span>
<span class="cp">#define EFI_MEMORY_DESCRIPTOR_VERSION	1</span>

<span class="cp">#define EFI_PAGE_SHIFT		12</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pad</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">phys_addr</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">virt_addr</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">num_pages</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">attribute</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_memory_desc_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">efi_guid_t</span> <span class="n">guid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">headersize</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">imagesize</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_capsule_header_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Allocation types for calls to boottime-&gt;allocate_pages.</span>
<span class="cm"> */</span>
<span class="cp">#define EFI_ALLOCATE_ANY_PAGES		0</span>
<span class="cp">#define EFI_ALLOCATE_MAX_ADDRESS	1</span>
<span class="cp">#define EFI_ALLOCATE_ADDRESS		2</span>
<span class="cp">#define EFI_MAX_ALLOCATE_TYPE		3</span>

<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">efi_freemem_callback_t</span><span class="p">)</span> <span class="p">(</span><span class="n">u64</span> <span class="n">start</span><span class="p">,</span> <span class="n">u64</span> <span class="n">end</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Types and defines for Time Services</span>
<span class="cm"> */</span>
<span class="cp">#define EFI_TIME_ADJUST_DAYLIGHT 0x1</span>
<span class="cp">#define EFI_TIME_IN_DAYLIGHT     0x2</span>
<span class="cp">#define EFI_UNSPECIFIED_TIMEZONE 0x07ff</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">year</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">month</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">day</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">hour</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">minute</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">second</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pad1</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">nanosecond</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">timezone</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">daylight</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pad2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_time_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">resolution</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">accuracy</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sets_to_zero</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_time_cap_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * EFI Boot Services table</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">efi_table_hdr_t</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">raise_tpl</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">restore_tpl</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">allocate_pages</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">free_pages</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">get_memory_map</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">allocate_pool</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">free_pool</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">create_event</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">set_timer</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">wait_for_event</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">signal_event</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">close_event</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">check_event</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">install_protocol_interface</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">reinstall_protocol_interface</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">uninstall_protocol_interface</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">handle_protocol</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">__reserved</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">register_protocol_notify</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">locate_handle</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">locate_device_path</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">install_configuration_table</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">load_image</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">start_image</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">exit</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">unload_image</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">exit_boot_services</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">get_next_monotonic_count</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">stall</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">set_watchdog_timer</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">connect_controller</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">disconnect_controller</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">open_protocol</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">close_protocol</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">open_protocol_information</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">protocols_per_handle</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">locate_handle_buffer</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">locate_protocol</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">install_multiple_protocol_interfaces</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">uninstall_multiple_protocol_interfaces</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">calculate_crc32</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">copy_mem</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">set_mem</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">create_event_ex</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_boot_services_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Types and defines for EFI ResetSystem</span>
<span class="cm"> */</span>
<span class="cp">#define EFI_RESET_COLD 0</span>
<span class="cp">#define EFI_RESET_WARM 1</span>
<span class="cp">#define EFI_RESET_SHUTDOWN 2</span>

<span class="cm">/*</span>
<span class="cm"> * EFI Runtime Services table</span>
<span class="cm"> */</span>
<span class="cp">#define EFI_RUNTIME_SERVICES_SIGNATURE ((u64)0x5652453544e5552ULL)</span>
<span class="cp">#define EFI_RUNTIME_SERVICES_REVISION  0x00010000</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">efi_table_hdr_t</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">get_time</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">set_time</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">get_wakeup_time</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">set_wakeup_time</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">set_virtual_address_map</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">convert_pointer</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">get_variable</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">get_next_variable</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">set_variable</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">get_next_high_mono_count</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reset_system</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">update_capsule</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">query_capsule_caps</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">query_variable_info</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_runtime_services_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_get_time_t</span> <span class="p">(</span><span class="n">efi_time_t</span> <span class="o">*</span><span class="n">tm</span><span class="p">,</span> <span class="n">efi_time_cap_t</span> <span class="o">*</span><span class="n">tc</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_set_time_t</span> <span class="p">(</span><span class="n">efi_time_t</span> <span class="o">*</span><span class="n">tm</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_get_wakeup_time_t</span> <span class="p">(</span><span class="n">efi_bool_t</span> <span class="o">*</span><span class="n">enabled</span><span class="p">,</span> <span class="n">efi_bool_t</span> <span class="o">*</span><span class="n">pending</span><span class="p">,</span>
					    <span class="n">efi_time_t</span> <span class="o">*</span><span class="n">tm</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_set_wakeup_time_t</span> <span class="p">(</span><span class="n">efi_bool_t</span> <span class="n">enabled</span><span class="p">,</span> <span class="n">efi_time_t</span> <span class="o">*</span><span class="n">tm</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_get_variable_t</span> <span class="p">(</span><span class="n">efi_char16_t</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="n">efi_guid_t</span> <span class="o">*</span><span class="n">vendor</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">data_size</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_get_next_variable_t</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">name_size</span><span class="p">,</span> <span class="n">efi_char16_t</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span>
					      <span class="n">efi_guid_t</span> <span class="o">*</span><span class="n">vendor</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_set_variable_t</span> <span class="p">(</span><span class="n">efi_char16_t</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="n">efi_guid_t</span> <span class="o">*</span><span class="n">vendor</span><span class="p">,</span> 
					 <span class="n">u32</span> <span class="n">attr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data_size</span><span class="p">,</span>
					 <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_get_next_high_mono_count_t</span> <span class="p">(</span><span class="n">u32</span> <span class="o">*</span><span class="n">count</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="n">efi_reset_system_t</span> <span class="p">(</span><span class="kt">int</span> <span class="n">reset_type</span><span class="p">,</span> <span class="n">efi_status_t</span> <span class="n">status</span><span class="p">,</span>
				 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data_size</span><span class="p">,</span> <span class="n">efi_char16_t</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_set_virtual_address_map_t</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">memory_map_size</span><span class="p">,</span>
						<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">descriptor_size</span><span class="p">,</span>
						<span class="n">u32</span> <span class="n">descriptor_version</span><span class="p">,</span>
						<span class="n">efi_memory_desc_t</span> <span class="o">*</span><span class="n">virtual_map</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_query_variable_info_t</span><span class="p">(</span><span class="n">u32</span> <span class="n">attr</span><span class="p">,</span>
					       <span class="n">u64</span> <span class="o">*</span><span class="n">storage_space</span><span class="p">,</span>
					       <span class="n">u64</span> <span class="o">*</span><span class="n">remaining_space</span><span class="p">,</span>
					       <span class="n">u64</span> <span class="o">*</span><span class="n">max_variable_size</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_update_capsule_t</span><span class="p">(</span><span class="n">efi_capsule_header_t</span> <span class="o">**</span><span class="n">capsules</span><span class="p">,</span>
					  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">,</span>
					  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sg_list</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">efi_status_t</span> <span class="n">efi_query_capsule_caps_t</span><span class="p">(</span><span class="n">efi_capsule_header_t</span> <span class="o">**</span><span class="n">capsules</span><span class="p">,</span>
					      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">,</span>
					      <span class="n">u64</span> <span class="o">*</span><span class="n">max_size</span><span class="p">,</span>
					      <span class="kt">int</span> <span class="o">*</span><span class="n">reset_type</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> *  EFI Configuration Table and GUID definitions</span>
<span class="cm"> */</span>
<span class="cp">#define NULL_GUID \</span>
<span class="cp">    EFI_GUID(  0x00000000, 0x0000, 0x0000, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 )</span>

<span class="cp">#define MPS_TABLE_GUID    \</span>
<span class="cp">    EFI_GUID(  0xeb9d2d2f, 0x2d88, 0x11d3, 0x9a, 0x16, 0x0, 0x90, 0x27, 0x3f, 0xc1, 0x4d )</span>

<span class="cp">#define ACPI_TABLE_GUID    \</span>
<span class="cp">    EFI_GUID(  0xeb9d2d30, 0x2d88, 0x11d3, 0x9a, 0x16, 0x0, 0x90, 0x27, 0x3f, 0xc1, 0x4d )</span>

<span class="cp">#define ACPI_20_TABLE_GUID    \</span>
<span class="cp">    EFI_GUID(  0x8868e871, 0xe4f1, 0x11d3, 0xbc, 0x22, 0x0, 0x80, 0xc7, 0x3c, 0x88, 0x81 )</span>

<span class="cp">#define SMBIOS_TABLE_GUID    \</span>
<span class="cp">    EFI_GUID(  0xeb9d2d31, 0x2d88, 0x11d3, 0x9a, 0x16, 0x0, 0x90, 0x27, 0x3f, 0xc1, 0x4d )</span>

<span class="cp">#define SAL_SYSTEM_TABLE_GUID    \</span>
<span class="cp">    EFI_GUID(  0xeb9d2d32, 0x2d88, 0x11d3, 0x9a, 0x16, 0x0, 0x90, 0x27, 0x3f, 0xc1, 0x4d )</span>

<span class="cp">#define HCDP_TABLE_GUID	\</span>
<span class="cp">    EFI_GUID(  0xf951938d, 0x620b, 0x42ef, 0x82, 0x79, 0xa8, 0x4b, 0x79, 0x61, 0x78, 0x98 )</span>

<span class="cp">#define UGA_IO_PROTOCOL_GUID \</span>
<span class="cp">    EFI_GUID(  0x61a4d49e, 0x6f68, 0x4f1b, 0xb9, 0x22, 0xa8, 0x6e, 0xed, 0xb, 0x7, 0xa2 )</span>

<span class="cp">#define EFI_GLOBAL_VARIABLE_GUID \</span>
<span class="cp">    EFI_GUID(  0x8be4df61, 0x93ca, 0x11d2, 0xaa, 0x0d, 0x00, 0xe0, 0x98, 0x03, 0x2b, 0x8c )</span>

<span class="cp">#define UV_SYSTEM_TABLE_GUID \</span>
<span class="cp">    EFI_GUID(  0x3b13a7d4, 0x633e, 0x11dd, 0x93, 0xec, 0xda, 0x25, 0x56, 0xd8, 0x95, 0x93 )</span>

<span class="cp">#define LINUX_EFI_CRASH_GUID \</span>
<span class="cp">    EFI_GUID(  0xcfc8fc79, 0xbe2e, 0x4ddc, 0x97, 0xf0, 0x9f, 0x98, 0xbf, 0xe2, 0x98, 0xa0 )</span>

<span class="cp">#define LOADED_IMAGE_PROTOCOL_GUID \</span>
<span class="cp">    EFI_GUID(  0x5b1b31a1, 0x9562, 0x11d2, 0x8e, 0x3f, 0x00, 0xa0, 0xc9, 0x69, 0x72, 0x3b )</span>

<span class="cp">#define EFI_GRAPHICS_OUTPUT_PROTOCOL_GUID \</span>
<span class="cp">    EFI_GUID(  0x9042a9de, 0x23dc, 0x4a38, 0x96, 0xfb, 0x7a, 0xde, 0xd0, 0x80, 0x51, 0x6a )</span>

<span class="cp">#define EFI_UGA_PROTOCOL_GUID \</span>
<span class="cp">    EFI_GUID(  0x982c298b, 0xf4fa, 0x41cb, 0xb8, 0x38, 0x77, 0xaa, 0x68, 0x8f, 0xb8, 0x39 )</span>

<span class="cp">#define EFI_PCI_IO_PROTOCOL_GUID \</span>
<span class="cp">    EFI_GUID(  0x4cf5b200, 0x68b8, 0x4ca5, 0x9e, 0xec, 0xb2, 0x3e, 0x3f, 0x50, 0x2, 0x9a )</span>

<span class="cp">#define EFI_FILE_INFO_ID \</span>
<span class="cp">    EFI_GUID(  0x9576e92, 0x6d3f, 0x11d2, 0x8e, 0x39, 0x00, 0xa0, 0xc9, 0x69, 0x72, 0x3b )</span>

<span class="cp">#define EFI_FILE_SYSTEM_GUID \</span>
<span class="cp">    EFI_GUID(  0x964e5b22, 0x6459, 0x11d2, 0x8e, 0x39, 0x00, 0xa0, 0xc9, 0x69, 0x72, 0x3b )</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">efi_guid_t</span> <span class="n">guid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">table</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_config_table_64_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">efi_guid_t</span> <span class="n">guid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">table</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_config_table_32_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">efi_guid_t</span> <span class="n">guid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">table</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_config_table_t</span><span class="p">;</span>

<span class="cp">#define EFI_SYSTEM_TABLE_SIGNATURE ((u64)0x5453595320494249ULL)</span>

<span class="cp">#define EFI_2_30_SYSTEM_TABLE_REVISION  ((2 &lt;&lt; 16) | (30))</span>
<span class="cp">#define EFI_2_20_SYSTEM_TABLE_REVISION  ((2 &lt;&lt; 16) | (20))</span>
<span class="cp">#define EFI_2_10_SYSTEM_TABLE_REVISION  ((2 &lt;&lt; 16) | (10))</span>
<span class="cp">#define EFI_2_00_SYSTEM_TABLE_REVISION  ((2 &lt;&lt; 16) | (00))</span>
<span class="cp">#define EFI_1_10_SYSTEM_TABLE_REVISION  ((1 &lt;&lt; 16) | (10))</span>
<span class="cp">#define EFI_1_02_SYSTEM_TABLE_REVISION  ((1 &lt;&lt; 16) | (02))</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">efi_table_hdr_t</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">fw_vendor</span><span class="p">;</span>	<span class="cm">/* physical addr of CHAR16 vendor string */</span>
	<span class="n">u32</span> <span class="n">fw_revision</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">__pad1</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">con_in_handle</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">con_in</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">con_out_handle</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">con_out</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">stderr_handle</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">stderr</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">runtime</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">boottime</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">nr_tables</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">__pad2</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">tables</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_system_table_64_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">efi_table_hdr_t</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fw_vendor</span><span class="p">;</span>	<span class="cm">/* physical addr of CHAR16 vendor string */</span>
	<span class="n">u32</span> <span class="n">fw_revision</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">con_in_handle</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">con_in</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">con_out_handle</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">con_out</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">stderr_handle</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">stderr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">runtime</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">boottime</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">nr_tables</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tables</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_system_table_32_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">efi_table_hdr_t</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">fw_vendor</span><span class="p">;</span>	<span class="cm">/* physical addr of CHAR16 vendor string */</span>
	<span class="n">u32</span> <span class="n">fw_revision</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">con_in_handle</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">con_in</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">con_out_handle</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">con_out</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">stderr_handle</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">stderr</span><span class="p">;</span>
	<span class="n">efi_runtime_services_t</span> <span class="o">*</span><span class="n">runtime</span><span class="p">;</span>
	<span class="n">efi_boot_services_t</span> <span class="o">*</span><span class="n">boottime</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">nr_tables</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tables</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_system_table_t</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">efi_memory_map</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">phys_map</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">map</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">map_end</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nr_map</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">desc_version</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">desc_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">revision</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">parent_handle</span><span class="p">;</span>
	<span class="n">efi_system_table_t</span> <span class="o">*</span><span class="n">system_table</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">device_handle</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">file_path</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">reserved</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">load_options_size</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">load_options</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">image_base</span><span class="p">;</span>
	<span class="n">__aligned_u64</span> <span class="n">image_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">image_code_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">image_data_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">unload</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_loaded_image_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">revision</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">open_volume</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_file_io_interface_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">file_size</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">phys_size</span><span class="p">;</span>
	<span class="n">efi_time_t</span> <span class="n">create_time</span><span class="p">;</span>
	<span class="n">efi_time_t</span> <span class="n">last_access_time</span><span class="p">;</span>
	<span class="n">efi_time_t</span> <span class="n">modification_time</span><span class="p">;</span>
	<span class="n">__aligned_u64</span> <span class="n">attribute</span><span class="p">;</span>
	<span class="n">efi_char16_t</span> <span class="n">filename</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span> <span class="n">efi_file_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">revision</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">open</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">close</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">delete</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">read</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">write</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">get_position</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">set_position</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">get_info</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">set_info</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">flush</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi_file_handle_t</span><span class="p">;</span>

<span class="cp">#define EFI_FILE_MODE_READ	0x0000000000000001</span>
<span class="cp">#define EFI_FILE_MODE_WRITE	0x0000000000000002</span>
<span class="cp">#define EFI_FILE_MODE_CREATE	0x8000000000000000</span>

<span class="cp">#define EFI_INVALID_TABLE_ADDR		(~0UL)</span>

<span class="cm">/*</span>
<span class="cm"> * All runtime access to EFI goes through this structure:</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">efi</span> <span class="p">{</span>
	<span class="n">efi_system_table_t</span> <span class="o">*</span><span class="n">systab</span><span class="p">;</span>	<span class="cm">/* EFI system table */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">runtime_version</span><span class="p">;</span>	<span class="cm">/* Runtime services version */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mps</span><span class="p">;</span>		<span class="cm">/* MPS table */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">acpi</span><span class="p">;</span>		<span class="cm">/* ACPI table  (IA64 ext 0.71) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">acpi20</span><span class="p">;</span>		<span class="cm">/* ACPI table  (ACPI 2.0) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">smbios</span><span class="p">;</span>		<span class="cm">/* SM BIOS table */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sal_systab</span><span class="p">;</span>	<span class="cm">/* SAL system table */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">boot_info</span><span class="p">;</span>	<span class="cm">/* boot info table */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">hcdp</span><span class="p">;</span>		<span class="cm">/* HCDP table */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">uga</span><span class="p">;</span>		<span class="cm">/* UGA table */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">uv_systab</span><span class="p">;</span>	<span class="cm">/* UV system table */</span>
	<span class="n">efi_get_time_t</span> <span class="o">*</span><span class="n">get_time</span><span class="p">;</span>
	<span class="n">efi_set_time_t</span> <span class="o">*</span><span class="n">set_time</span><span class="p">;</span>
	<span class="n">efi_get_wakeup_time_t</span> <span class="o">*</span><span class="n">get_wakeup_time</span><span class="p">;</span>
	<span class="n">efi_set_wakeup_time_t</span> <span class="o">*</span><span class="n">set_wakeup_time</span><span class="p">;</span>
	<span class="n">efi_get_variable_t</span> <span class="o">*</span><span class="n">get_variable</span><span class="p">;</span>
	<span class="n">efi_get_next_variable_t</span> <span class="o">*</span><span class="n">get_next_variable</span><span class="p">;</span>
	<span class="n">efi_set_variable_t</span> <span class="o">*</span><span class="n">set_variable</span><span class="p">;</span>
	<span class="n">efi_query_variable_info_t</span> <span class="o">*</span><span class="n">query_variable_info</span><span class="p">;</span>
	<span class="n">efi_update_capsule_t</span> <span class="o">*</span><span class="n">update_capsule</span><span class="p">;</span>
	<span class="n">efi_query_capsule_caps_t</span> <span class="o">*</span><span class="n">query_capsule_caps</span><span class="p">;</span>
	<span class="n">efi_get_next_high_mono_count_t</span> <span class="o">*</span><span class="n">get_next_high_mono_count</span><span class="p">;</span>
	<span class="n">efi_reset_system_t</span> <span class="o">*</span><span class="n">reset_system</span><span class="p">;</span>
	<span class="n">efi_set_virtual_address_map_t</span> <span class="o">*</span><span class="n">set_virtual_address_map</span><span class="p">;</span>
<span class="p">}</span> <span class="n">efi</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span>
<span class="nf">efi_guidcmp</span> <span class="p">(</span><span class="n">efi_guid_t</span> <span class="n">left</span><span class="p">,</span> <span class="n">efi_guid_t</span> <span class="n">right</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">memcmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">,</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">efi_guid_t</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">efi_guid_unparse</span><span class="p">(</span><span class="n">efi_guid_t</span> <span class="o">*</span><span class="n">guid</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">out</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">sprintf</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">&quot;%pUl&quot;</span><span class="p">,</span> <span class="n">guid</span><span class="o">-&gt;</span><span class="n">b</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">out</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">efi_init</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="o">*</span><span class="n">efi_get_pal_addr</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">efi_map_pal_code</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">efi_memmap_walk</span> <span class="p">(</span><span class="n">efi_freemem_callback_t</span> <span class="n">callback</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">efi_gettimeofday</span> <span class="p">(</span><span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="n">ts</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">efi_enter_virtual_mode</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>	<span class="cm">/* switch EFI to virtual mode, if possible */</span>
<span class="k">extern</span> <span class="n">u64</span> <span class="n">efi_get_iobase</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u32</span> <span class="n">efi_mem_type</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u64</span> <span class="n">efi_mem_attributes</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u64</span> <span class="n">efi_mem_attribute</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">__init</span> <span class="n">efi_uart_console_only</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">efi_initialize_iomem_resources</span><span class="p">(</span><span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">code_resource</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">data_resource</span><span class="p">,</span> <span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">bss_resource</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">efi_get_time</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">efi_set_rtc_mmss</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">nowtime</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">efi_reserve_boot_services</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">efi_memory_map</span> <span class="n">memmap</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm"> * efi_range_is_wc - check the WC bit on an address range</span>
<span class="cm"> * @start: starting kvirt address</span>
<span class="cm"> * @len: length of range</span>
<span class="cm"> *</span>
<span class="cm"> * Consult the EFI memory map and make sure it&#39;s ok to set this range WC.</span>
<span class="cm"> * Returns true or false.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">efi_range_is_wc</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1UL</span> <span class="o">&lt;&lt;</span> <span class="n">EFI_PAGE_SHIFT</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">paddr</span> <span class="o">=</span> <span class="n">__pa</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">efi_mem_attributes</span><span class="p">(</span><span class="n">paddr</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">EFI_MEMORY_WC</span><span class="p">))</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* The range checked out */</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_EFI_PCDP</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">__init</span> <span class="n">efi_setup_pcdp_console</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * We play games with efi_enabled so that the compiler will, if possible, remove</span>
<span class="cm"> * EFI-related code altogether.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_EFI</span>
<span class="cp"># ifdef CONFIG_X86</span>
   <span class="k">extern</span> <span class="kt">int</span> <span class="n">efi_enabled</span><span class="p">;</span>
   <span class="k">extern</span> <span class="n">bool</span> <span class="n">efi_64bit</span><span class="p">;</span>
<span class="cp"># else</span>
<span class="cp">#  define efi_enabled 1</span>
<span class="cp"># endif</span>
<span class="cp">#else</span>
<span class="cp"># define efi_enabled 0</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Variable Attributes</span>
<span class="cm"> */</span>
<span class="cp">#define EFI_VARIABLE_NON_VOLATILE       0x0000000000000001</span>
<span class="cp">#define EFI_VARIABLE_BOOTSERVICE_ACCESS 0x0000000000000002</span>
<span class="cp">#define EFI_VARIABLE_RUNTIME_ACCESS     0x0000000000000004</span>
<span class="cp">#define EFI_VARIABLE_HARDWARE_ERROR_RECORD 0x0000000000000008</span>
<span class="cp">#define EFI_VARIABLE_AUTHENTICATED_WRITE_ACCESS 0x0000000000000010</span>
<span class="cp">#define EFI_VARIABLE_TIME_BASED_AUTHENTICATED_WRITE_ACCESS 0x0000000000000020</span>
<span class="cp">#define EFI_VARIABLE_APPEND_WRITE	0x0000000000000040</span>

<span class="cp">#define EFI_VARIABLE_MASK 	(EFI_VARIABLE_NON_VOLATILE | \</span>
<span class="cp">				EFI_VARIABLE_BOOTSERVICE_ACCESS | \</span>
<span class="cp">				EFI_VARIABLE_RUNTIME_ACCESS | \</span>
<span class="cp">				EFI_VARIABLE_HARDWARE_ERROR_RECORD | \</span>
<span class="cp">				EFI_VARIABLE_AUTHENTICATED_WRITE_ACCESS | \</span>
<span class="cp">				EFI_VARIABLE_TIME_BASED_AUTHENTICATED_WRITE_ACCESS | \</span>
<span class="cp">				EFI_VARIABLE_APPEND_WRITE)</span>
<span class="cm">/*</span>
<span class="cm"> * The type of search to perform when calling boottime-&gt;locate_handle</span>
<span class="cm"> */</span>
<span class="cp">#define EFI_LOCATE_ALL_HANDLES			0</span>
<span class="cp">#define EFI_LOCATE_BY_REGISTER_NOTIFY		1</span>
<span class="cp">#define EFI_LOCATE_BY_PROTOCOL			2</span>

<span class="cm">/*</span>
<span class="cm"> * EFI Device Path information</span>
<span class="cm"> */</span>
<span class="cp">#define EFI_DEV_HW			0x01</span>
<span class="cp">#define  EFI_DEV_PCI				 1</span>
<span class="cp">#define  EFI_DEV_PCCARD				 2</span>
<span class="cp">#define  EFI_DEV_MEM_MAPPED			 3</span>
<span class="cp">#define  EFI_DEV_VENDOR				 4</span>
<span class="cp">#define  EFI_DEV_CONTROLLER			 5</span>
<span class="cp">#define EFI_DEV_ACPI			0x02</span>
<span class="cp">#define   EFI_DEV_BASIC_ACPI			 1</span>
<span class="cp">#define   EFI_DEV_EXPANDED_ACPI			 2</span>
<span class="cp">#define EFI_DEV_MSG			0x03</span>
<span class="cp">#define   EFI_DEV_MSG_ATAPI			 1</span>
<span class="cp">#define   EFI_DEV_MSG_SCSI			 2</span>
<span class="cp">#define   EFI_DEV_MSG_FC			 3</span>
<span class="cp">#define   EFI_DEV_MSG_1394			 4</span>
<span class="cp">#define   EFI_DEV_MSG_USB			 5</span>
<span class="cp">#define   EFI_DEV_MSG_USB_CLASS			15</span>
<span class="cp">#define   EFI_DEV_MSG_I20			 6</span>
<span class="cp">#define   EFI_DEV_MSG_MAC			11</span>
<span class="cp">#define   EFI_DEV_MSG_IPV4			12</span>
<span class="cp">#define   EFI_DEV_MSG_IPV6			13</span>
<span class="cp">#define   EFI_DEV_MSG_INFINIBAND		 9</span>
<span class="cp">#define   EFI_DEV_MSG_UART			14</span>
<span class="cp">#define   EFI_DEV_MSG_VENDOR			10</span>
<span class="cp">#define EFI_DEV_MEDIA			0x04</span>
<span class="cp">#define   EFI_DEV_MEDIA_HARD_DRIVE		 1</span>
<span class="cp">#define   EFI_DEV_MEDIA_CDROM			 2</span>
<span class="cp">#define   EFI_DEV_MEDIA_VENDOR			 3</span>
<span class="cp">#define   EFI_DEV_MEDIA_FILE			 4</span>
<span class="cp">#define   EFI_DEV_MEDIA_PROTOCOL		 5</span>
<span class="cp">#define EFI_DEV_BIOS_BOOT		0x05</span>
<span class="cp">#define EFI_DEV_END_PATH		0x7F</span>
<span class="cp">#define EFI_DEV_END_PATH2		0xFF</span>
<span class="cp">#define   EFI_DEV_END_INSTANCE			0x01</span>
<span class="cp">#define   EFI_DEV_END_ENTIRE			0xFF</span>

<span class="k">struct</span> <span class="n">efi_generic_dev_path</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sub_type</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">length</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">memrange_efi_to_native</span><span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">npages</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="n">npages</span> <span class="o">=</span> <span class="n">PFN_UP</span><span class="p">(</span><span class="o">*</span><span class="n">addr</span> <span class="o">+</span> <span class="p">(</span><span class="o">*</span><span class="n">npages</span><span class="o">&lt;&lt;</span><span class="n">EFI_PAGE_SHIFT</span><span class="p">))</span> <span class="o">-</span> <span class="n">PFN_DOWN</span><span class="p">(</span><span class="o">*</span><span class="n">addr</span><span class="p">);</span>
	<span class="o">*</span><span class="n">addr</span> <span class="o">&amp;=</span> <span class="n">PAGE_MASK</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_EFI_VARS) || defined(CONFIG_EFI_VARS_MODULE)</span>
<span class="cm">/*</span>
<span class="cm"> * EFI Variable support.</span>
<span class="cm"> *</span>
<span class="cm"> * Different firmware drivers can expose their EFI-like variables using</span>
<span class="cm"> * the following.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">efivar_operations</span> <span class="p">{</span>
	<span class="n">efi_get_variable_t</span> <span class="o">*</span><span class="n">get_variable</span><span class="p">;</span>
	<span class="n">efi_get_next_variable_t</span> <span class="o">*</span><span class="n">get_next_variable</span><span class="p">;</span>
	<span class="n">efi_set_variable_t</span> <span class="o">*</span><span class="n">set_variable</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">efivars</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * -&gt;lock protects two things:</span>
<span class="cm">	 * 1) -&gt;list - adds, removals, reads, writes</span>
<span class="cm">	 * 2) ops.[gs]et_variable() calls.</span>
<span class="cm">	 * It must not be held when creating sysfs entries or calling kmalloc.</span>
<span class="cm">	 * ops.get_next_variable() is only called from register_efivars(),</span>
<span class="cm">	 * which is protected by the BKL, so that path is safe.</span>
<span class="cm">	 */</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kset</span> <span class="o">*</span><span class="n">kset</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bin_attribute</span> <span class="o">*</span><span class="n">new_var</span><span class="p">,</span> <span class="o">*</span><span class="n">del_var</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">efivar_operations</span> <span class="o">*</span><span class="n">ops</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">efivar_entry</span> <span class="o">*</span><span class="n">walk_entry</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pstore_info</span> <span class="n">efi_pstore_info</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">register_efivars</span><span class="p">(</span><span class="k">struct</span> <span class="n">efivars</span> <span class="o">*</span><span class="n">efivars</span><span class="p">,</span>
		     <span class="k">const</span> <span class="k">struct</span> <span class="n">efivar_operations</span> <span class="o">*</span><span class="n">ops</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">kobject</span> <span class="o">*</span><span class="n">parent_kobj</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">unregister_efivars</span><span class="p">(</span><span class="k">struct</span> <span class="n">efivars</span> <span class="o">*</span><span class="n">efivars</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_EFI_VARS */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _LINUX_EFI_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
