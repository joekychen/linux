<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › netfilter › nf_conntrack_common.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>nf_conntrack_common.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _NF_CONNTRACK_COMMON_H</span>
<span class="cp">#define _NF_CONNTRACK_COMMON_H</span>
<span class="cm">/* Connection state tracking for netfilter.  This is separated from,</span>
<span class="cm">   but required by, the NAT layer; it can also be used by an iptables</span>
<span class="cm">   extension. */</span>
<span class="k">enum</span> <span class="n">ip_conntrack_info</span> <span class="p">{</span>
	<span class="cm">/* Part of an established connection (either direction). */</span>
	<span class="n">IP_CT_ESTABLISHED</span><span class="p">,</span>

	<span class="cm">/* Like NEW, but related to an existing connection, or ICMP error</span>
<span class="cm">	   (in either direction). */</span>
	<span class="n">IP_CT_RELATED</span><span class="p">,</span>

	<span class="cm">/* Started a new connection to track (only</span>
<span class="cm">           IP_CT_DIR_ORIGINAL); may be a retransmission. */</span>
	<span class="n">IP_CT_NEW</span><span class="p">,</span>

	<span class="cm">/* &gt;= this indicates reply direction */</span>
	<span class="n">IP_CT_IS_REPLY</span><span class="p">,</span>

	<span class="n">IP_CT_ESTABLISHED_REPLY</span> <span class="o">=</span> <span class="n">IP_CT_ESTABLISHED</span> <span class="o">+</span> <span class="n">IP_CT_IS_REPLY</span><span class="p">,</span>
	<span class="n">IP_CT_RELATED_REPLY</span> <span class="o">=</span> <span class="n">IP_CT_RELATED</span> <span class="o">+</span> <span class="n">IP_CT_IS_REPLY</span><span class="p">,</span>
	<span class="n">IP_CT_NEW_REPLY</span> <span class="o">=</span> <span class="n">IP_CT_NEW</span> <span class="o">+</span> <span class="n">IP_CT_IS_REPLY</span><span class="p">,</span>	
	<span class="cm">/* Number of distinct IP_CT types (no NEW in reply dirn). */</span>
	<span class="n">IP_CT_NUMBER</span> <span class="o">=</span> <span class="n">IP_CT_IS_REPLY</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
<span class="p">};</span>

<span class="cm">/* Bitset representing status of connection. */</span>
<span class="k">enum</span> <span class="n">ip_conntrack_status</span> <span class="p">{</span>
	<span class="cm">/* It&#39;s an expected connection: bit 0 set.  This bit never changed */</span>
	<span class="n">IPS_EXPECTED_BIT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IPS_EXPECTED</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_EXPECTED_BIT</span><span class="p">),</span>

	<span class="cm">/* We&#39;ve seen packets both ways: bit 1 set.  Can be set, not unset. */</span>
	<span class="n">IPS_SEEN_REPLY_BIT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">IPS_SEEN_REPLY</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_SEEN_REPLY_BIT</span><span class="p">),</span>

	<span class="cm">/* Conntrack should never be early-expired. */</span>
	<span class="n">IPS_ASSURED_BIT</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">IPS_ASSURED</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_ASSURED_BIT</span><span class="p">),</span>

	<span class="cm">/* Connection is confirmed: originating packet has left box */</span>
	<span class="n">IPS_CONFIRMED_BIT</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">IPS_CONFIRMED</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_CONFIRMED_BIT</span><span class="p">),</span>

	<span class="cm">/* Connection needs src nat in orig dir.  This bit never changed. */</span>
	<span class="n">IPS_SRC_NAT_BIT</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">IPS_SRC_NAT</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_SRC_NAT_BIT</span><span class="p">),</span>

	<span class="cm">/* Connection needs dst nat in orig dir.  This bit never changed. */</span>
	<span class="n">IPS_DST_NAT_BIT</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">IPS_DST_NAT</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_DST_NAT_BIT</span><span class="p">),</span>

	<span class="cm">/* Both together. */</span>
	<span class="n">IPS_NAT_MASK</span> <span class="o">=</span> <span class="p">(</span><span class="n">IPS_DST_NAT</span> <span class="o">|</span> <span class="n">IPS_SRC_NAT</span><span class="p">),</span>

	<span class="cm">/* Connection needs TCP sequence adjusted. */</span>
	<span class="n">IPS_SEQ_ADJUST_BIT</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">IPS_SEQ_ADJUST</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_SEQ_ADJUST_BIT</span><span class="p">),</span>

	<span class="cm">/* NAT initialization bits. */</span>
	<span class="n">IPS_SRC_NAT_DONE_BIT</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">IPS_SRC_NAT_DONE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_SRC_NAT_DONE_BIT</span><span class="p">),</span>

	<span class="n">IPS_DST_NAT_DONE_BIT</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="n">IPS_DST_NAT_DONE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_DST_NAT_DONE_BIT</span><span class="p">),</span>

	<span class="cm">/* Both together */</span>
	<span class="n">IPS_NAT_DONE_MASK</span> <span class="o">=</span> <span class="p">(</span><span class="n">IPS_DST_NAT_DONE</span> <span class="o">|</span> <span class="n">IPS_SRC_NAT_DONE</span><span class="p">),</span>

	<span class="cm">/* Connection is dying (removed from lists), can not be unset. */</span>
	<span class="n">IPS_DYING_BIT</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
	<span class="n">IPS_DYING</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_DYING_BIT</span><span class="p">),</span>

	<span class="cm">/* Connection has fixed timeout. */</span>
	<span class="n">IPS_FIXED_TIMEOUT_BIT</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
	<span class="n">IPS_FIXED_TIMEOUT</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_FIXED_TIMEOUT_BIT</span><span class="p">),</span>

	<span class="cm">/* Conntrack is a template */</span>
	<span class="n">IPS_TEMPLATE_BIT</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
	<span class="n">IPS_TEMPLATE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_TEMPLATE_BIT</span><span class="p">),</span>

	<span class="cm">/* Conntrack is a fake untracked entry */</span>
	<span class="n">IPS_UNTRACKED_BIT</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
	<span class="n">IPS_UNTRACKED</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_UNTRACKED_BIT</span><span class="p">),</span>

	<span class="cm">/* Conntrack got a helper explicitly attached via CT target. */</span>
	<span class="n">IPS_HELPER_BIT</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span>
	<span class="n">IPS_HELPER</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IPS_HELPER_BIT</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Connection tracking event types */</span>
<span class="k">enum</span> <span class="n">ip_conntrack_events</span> <span class="p">{</span>
	<span class="n">IPCT_NEW</span><span class="p">,</span>		<span class="cm">/* new conntrack */</span>
	<span class="n">IPCT_RELATED</span><span class="p">,</span>		<span class="cm">/* related conntrack */</span>
	<span class="n">IPCT_DESTROY</span><span class="p">,</span>		<span class="cm">/* destroyed conntrack */</span>
	<span class="n">IPCT_REPLY</span><span class="p">,</span>		<span class="cm">/* connection has seen two-way traffic */</span>
	<span class="n">IPCT_ASSURED</span><span class="p">,</span>		<span class="cm">/* connection status has changed to assured */</span>
	<span class="n">IPCT_PROTOINFO</span><span class="p">,</span>		<span class="cm">/* protocol information has changed */</span>
	<span class="n">IPCT_HELPER</span><span class="p">,</span>		<span class="cm">/* new helper has been set */</span>
	<span class="n">IPCT_MARK</span><span class="p">,</span>		<span class="cm">/* new mark has been set */</span>
	<span class="n">IPCT_NATSEQADJ</span><span class="p">,</span>		<span class="cm">/* NAT is doing sequence adjustment */</span>
	<span class="n">IPCT_SECMARK</span><span class="p">,</span>		<span class="cm">/* new security mark has been set */</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ip_conntrack_expect_events</span> <span class="p">{</span>
	<span class="n">IPEXP_NEW</span><span class="p">,</span>		<span class="cm">/* new expectation */</span>
	<span class="n">IPEXP_DESTROY</span><span class="p">,</span>		<span class="cm">/* destroyed expectation */</span>
<span class="p">};</span>

<span class="cm">/* expectation flags */</span>
<span class="cp">#define NF_CT_EXPECT_PERMANENT		0x1</span>
<span class="cp">#define NF_CT_EXPECT_INACTIVE		0x2</span>
<span class="cp">#define NF_CT_EXPECT_USERSPACE		0x4</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="k">struct</span> <span class="n">ip_conntrack_stat</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">searched</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">found</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">new</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">invalid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ignore</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">delete</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">delete_list</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">insert</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">insert_failed</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">drop</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">early_drop</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">error</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">expect_new</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">expect_create</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">expect_delete</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">search_restart</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* call to create an explicit dependency on nf_conntrack. */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">need_conntrack</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _NF_CONNTRACK_COMMON_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
