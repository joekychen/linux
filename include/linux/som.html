<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › som.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>som.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _LINUX_SOM_H</span>
<span class="cp">#define _LINUX_SOM_H</span>

<span class="cm">/* File format definition for SOM executables / shared libraries */</span>

<span class="cm">/* we need struct timespec */</span>
<span class="cp">#include &lt;linux/time.h&gt;</span>

<span class="cp">#define SOM_PAGESIZE 4096</span>

<span class="cm">/* this is the SOM header */</span>
<span class="k">struct</span> <span class="n">som_hdr</span> <span class="p">{</span>
	<span class="kt">short</span>		<span class="n">system_id</span><span class="p">;</span>		<span class="cm">/* magic number - system */</span>
	<span class="kt">short</span>		<span class="n">a_magic</span><span class="p">;</span>		<span class="cm">/* magic number - file type */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">version_id</span><span class="p">;</span>		<span class="cm">/* versiod ID: YYMMDDHH */</span>
	<span class="k">struct</span> <span class="n">timespec</span>	<span class="n">file_time</span><span class="p">;</span>		<span class="cm">/* system clock */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">entry_space</span><span class="p">;</span>		<span class="cm">/* space for entry point */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">entry_subspace</span><span class="p">;</span>		<span class="cm">/* subspace for entry point */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">entry_offset</span><span class="p">;</span>		<span class="cm">/* offset of entry point */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">aux_header_location</span><span class="p">;</span>	<span class="cm">/* auxiliary header location */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">aux_header_size</span><span class="p">;</span>	<span class="cm">/* auxiliary header size */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">som_length</span><span class="p">;</span>		<span class="cm">/* length of entire SOM */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">presumed_dp</span><span class="p">;</span>		<span class="cm">/* compiler&#39;s DP value */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">space_location</span><span class="p">;</span>		<span class="cm">/* space dictionary location */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">space_total</span><span class="p">;</span>		<span class="cm">/* number of space entries */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">subspace_location</span><span class="p">;</span>	<span class="cm">/* subspace entries location */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">subspace_total</span><span class="p">;</span>		<span class="cm">/* number of subspace entries */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">loader_fixup_location</span><span class="p">;</span>	<span class="cm">/* MPE/iX loader fixup */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">loader_fixup_total</span><span class="p">;</span>	<span class="cm">/* number of fixup records */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">space_strings_location</span><span class="p">;</span>	<span class="cm">/* (sub)space names */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">space_strings_size</span><span class="p">;</span>	<span class="cm">/* size of strings area */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">init_array_location</span><span class="p">;</span>	<span class="cm">/* reserved */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">init_array_total</span><span class="p">;</span>	<span class="cm">/* reserved */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">compiler_location</span><span class="p">;</span>	<span class="cm">/* module dictionary */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">compiler_total</span><span class="p">;</span>		<span class="cm">/* number of modules */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">symbol_location</span><span class="p">;</span>	<span class="cm">/* symbol dictionary */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">symbol_total</span><span class="p">;</span>		<span class="cm">/* number of symbols */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">fixup_request_location</span><span class="p">;</span>	<span class="cm">/* fixup requests */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">fixup_request_total</span><span class="p">;</span>	<span class="cm">/* number of fixup requests */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">symbol_strings_location</span><span class="p">;</span><span class="cm">/* module &amp; symbol names area */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">symbol_strings_size</span><span class="p">;</span>	<span class="cm">/* size of strings area */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">unloadable_sp_location</span><span class="p">;</span>	<span class="cm">/* unloadable spaces location */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">unloadable_sp_size</span><span class="p">;</span>	<span class="cm">/* size of data */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">checksum</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* values for system_id */</span>

<span class="cp">#define SOM_SID_PARISC_1_0	0x020b</span>
<span class="cp">#define SOM_SID_PARISC_1_1	0x0210</span>
<span class="cp">#define SOM_SID_PARISC_2_0	0x0214</span>

<span class="cm">/* values for a_magic */</span>

<span class="cp">#define SOM_LIB_EXEC		0x0104</span>
<span class="cp">#define SOM_RELOCATABLE		0x0106</span>
<span class="cp">#define SOM_EXEC_NONSHARE	0x0107</span>
<span class="cp">#define SOM_EXEC_SHARE		0x0108</span>
<span class="cp">#define SOM_EXEC_DEMAND		0x010B</span>
<span class="cp">#define SOM_LIB_DYN		0x010D</span>
<span class="cp">#define SOM_LIB_SHARE		0x010E</span>
<span class="cp">#define SOM_LIB_RELOC		0x0619</span>

<span class="cm">/* values for version_id.  Decimal not hex, yes.  Grr. */</span>

<span class="cp">#define SOM_ID_OLD		85082112</span>
<span class="cp">#define SOM_ID_NEW		87102412</span>

<span class="k">struct</span> <span class="n">aux_id</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">mandatory</span> <span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* the linker must understand this */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">copy</span>	  <span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Must be copied by the linker */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">append</span>	  <span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Must be merged by the linker */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">ignore</span>	  <span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Discard section if unknown */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">reserved</span>  <span class="o">:</span><span class="mi">12</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">type</span>	  <span class="o">:</span><span class="mi">16</span><span class="p">;</span>	<span class="cm">/* Header type */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">length</span><span class="p">;</span>		<span class="cm">/* length of _following_ data */</span>
<span class="p">};</span>

<span class="cm">/* The Exec Auxiliary Header.  Called The HP-UX Header within HP apparently. */</span>
<span class="k">struct</span> <span class="n">som_exec_auxhdr</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">aux_id</span>	<span class="n">som_auxhdr</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">exec_tsize</span><span class="p">;</span>	<span class="cm">/* Text size in bytes */</span>
	<span class="kt">int</span>		<span class="n">exec_tmem</span><span class="p">;</span>	<span class="cm">/* Address to load text at */</span>
	<span class="kt">int</span>		<span class="n">exec_tfile</span><span class="p">;</span>	<span class="cm">/* Location of text in file */</span>
	<span class="kt">int</span>		<span class="n">exec_dsize</span><span class="p">;</span>	<span class="cm">/* Data size in bytes */</span>
	<span class="kt">int</span>		<span class="n">exec_dmem</span><span class="p">;</span>	<span class="cm">/* Address to load data at */</span>
	<span class="kt">int</span>		<span class="n">exec_dfile</span><span class="p">;</span>	<span class="cm">/* Location of data in file */</span>
	<span class="kt">int</span>		<span class="n">exec_bsize</span><span class="p">;</span>	<span class="cm">/* Uninitialised data (bss) */</span>
	<span class="kt">int</span>		<span class="n">exec_entry</span><span class="p">;</span>	<span class="cm">/* Address to start executing */</span>
	<span class="kt">int</span>		<span class="n">exec_flags</span><span class="p">;</span>	<span class="cm">/* loader flags */</span>
	<span class="kt">int</span>		<span class="n">exec_bfill</span><span class="p">;</span>	<span class="cm">/* initialisation value for bss */</span>
<span class="p">};</span>

<span class="cm">/* Oh, the things people do to avoid casts.  Shame it&#39;ll break with gcc&#39;s</span>
<span class="cm"> * new aliasing rules really.</span>
<span class="cm"> */</span>
<span class="k">union</span> <span class="n">name_pt</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">n_name</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">n_strx</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* The Space Dictionary */</span>
<span class="k">struct</span> <span class="n">space_dictionary_record</span> <span class="p">{</span>
	<span class="k">union</span> <span class="n">name_pt</span>	<span class="n">name</span><span class="p">;</span>			<span class="cm">/* index to subspace name */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">is_loadable</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* loadable */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">is_defined</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* defined within file */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">is_private</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* not sharable */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">has_intermediate_code</span> <span class="o">:</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* contains intermediate code */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">is_tspecific</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* thread specific */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">reserved</span>	<span class="o">:</span><span class="mi">11</span><span class="p">;</span>	<span class="cm">/* for future expansion */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">sort_key</span>	<span class="o">:</span><span class="mi">8</span><span class="p">;</span>	<span class="cm">/* for linker */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">reserved2</span>	<span class="o">:</span><span class="mi">8</span><span class="p">;</span>	<span class="cm">/* for future expansion */</span>

	<span class="kt">int</span>		<span class="n">space_number</span><span class="p">;</span>		<span class="cm">/* index */</span>
	<span class="kt">int</span>		<span class="n">subspace_index</span><span class="p">;</span>		<span class="cm">/* index into subspace dict */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">subspace_quantity</span><span class="p">;</span>	<span class="cm">/* number of subspaces */</span>
	<span class="kt">int</span>		<span class="n">loader_fix_index</span><span class="p">;</span>	<span class="cm">/* for loader */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">loader_fix_quantity</span><span class="p">;</span>	<span class="cm">/* for loader */</span>
	<span class="kt">int</span>		<span class="n">init_pointer_index</span><span class="p">;</span>	<span class="cm">/* data pointer array index */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">init_pointer_quantity</span><span class="p">;</span>	<span class="cm">/* number of data pointers */</span>
<span class="p">};</span>

<span class="cm">/* The Subspace Dictionary */</span>
<span class="k">struct</span> <span class="n">subspace_dictionary_record</span> <span class="p">{</span>
	<span class="kt">int</span>		<span class="n">space_index</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">access_control_bits</span> <span class="o">:</span><span class="mi">7</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">memory_resident</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">dup_common</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">is_common</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">quadrant</span>	<span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">initially_frozen</span> <span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">is_first</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">code_only</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">sort_key</span>	<span class="o">:</span><span class="mi">8</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">replicate_init</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">continuation</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">is_tspecific</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">is_comdat</span>	<span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">reserved</span>	<span class="o">:</span><span class="mi">4</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="n">file_loc_init_value</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">initialization_length</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">subspace_start</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">subspace_length</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">reserved2</span>	<span class="o">:</span><span class="mi">5</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">alignment</span>	<span class="o">:</span><span class="mi">27</span><span class="p">;</span>

	<span class="k">union</span> <span class="n">name_pt</span>	<span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">fixup_request_index</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">fixup_request_quantity</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="cm">/* _LINUX_SOM_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
