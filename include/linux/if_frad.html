<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › if_frad.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>if_frad.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * DLCI/FRAD	Definitions for Frame Relay Access Devices.  DLCI devices are</span>
<span class="cm"> *		created for each DLCI associated with a FRAD.  The FRAD driver</span>
<span class="cm"> *		is not truly a network device, but the lower level device</span>
<span class="cm"> *		handler.  This allows other FRAD manufacturers to use the DLCI</span>
<span class="cm"> *		code, including its RFC1490 encapsulation alongside the current</span>
<span class="cm"> *		implementation for the Sangoma cards.</span>
<span class="cm"> *</span>
<span class="cm"> * Version:	@(#)if_ifrad.h	0.15	31 Mar 96</span>
<span class="cm"> *</span>
<span class="cm"> * Author:	Mike McLagan &lt;mike.mclagan@linux.org&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Changes:</span>
<span class="cm"> *		0.15	Mike McLagan	changed structure defs (packed)</span>
<span class="cm"> *					re-arranged flags</span>
<span class="cm"> *					added DLCI_RET vars</span>
<span class="cm"> *</span>
<span class="cm"> *		This program is free software; you can redistribute it and/or</span>
<span class="cm"> *		modify it under the terms of the GNU General Public License</span>
<span class="cm"> *		as published by the Free Software Foundation; either version</span>
<span class="cm"> *		2 of the License, or (at your option) any later version.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _FRAD_H_</span>
<span class="cp">#define _FRAD_H_</span>

<span class="cp">#include &lt;linux/if.h&gt;</span>

<span class="cm">/* Structures and constants associated with the DLCI device driver */</span>

<span class="k">struct</span> <span class="n">dlci_add</span>
<span class="p">{</span>
   <span class="kt">char</span>  <span class="n">devname</span><span class="p">[</span><span class="n">IFNAMSIZ</span><span class="p">];</span>
   <span class="kt">short</span> <span class="n">dlci</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define DLCI_GET_CONF	(SIOCDEVPRIVATE + 2)</span>
<span class="cp">#define DLCI_SET_CONF	(SIOCDEVPRIVATE + 3)</span>

<span class="cm">/* </span>
<span class="cm"> * These are related to the Sangoma SDLA and should remain in order. </span>
<span class="cm"> * Code within the SDLA module is based on the specifics of this </span>
<span class="cm"> * structure.  Change at your own peril.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">dlci_conf</span> <span class="p">{</span>
   <span class="kt">short</span> <span class="n">flags</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">CIR_fwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Bc_fwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Be_fwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">CIR_bwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Bc_bwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Be_bwd</span><span class="p">;</span> 

<span class="cm">/* these are part of the status read */</span>
   <span class="kt">short</span> <span class="n">Tc_fwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Tc_bwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Tf_max</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Tb_max</span><span class="p">;</span>

<span class="cm">/* add any new fields here above is a mirror of sdla_dlci_conf */</span>
<span class="p">};</span>

<span class="cp">#define DLCI_GET_SLAVE	(SIOCDEVPRIVATE + 4)</span>

<span class="cm">/* configuration flags for DLCI */</span>
<span class="cp">#define DLCI_IGNORE_CIR_OUT	0x0001</span>
<span class="cp">#define DLCI_ACCOUNT_CIR_IN	0x0002</span>
<span class="cp">#define DLCI_BUFFER_IF		0x0008</span>

<span class="cp">#define DLCI_VALID_FLAGS	0x000B</span>

<span class="cm">/* defines for the actual Frame Relay hardware */</span>
<span class="cp">#define FRAD_GET_CONF	(SIOCDEVPRIVATE)</span>
<span class="cp">#define FRAD_SET_CONF	(SIOCDEVPRIVATE + 1)</span>

<span class="cp">#define FRAD_LAST_IOCTL	FRAD_SET_CONF</span>

<span class="cm">/*</span>
<span class="cm"> * Based on the setup for the Sangoma SDLA.  If changes are </span>
<span class="cm"> * necessary to this structure, a routine will need to be </span>
<span class="cm"> * added to that module to copy fields.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">frad_conf</span> 
<span class="p">{</span>
   <span class="kt">short</span> <span class="n">station</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">flags</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">kbaud</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">clocking</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">mtu</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">T391</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">T392</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">N391</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">N392</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">N393</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">CIR_fwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Bc_fwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Be_fwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">CIR_bwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Bc_bwd</span><span class="p">;</span>
   <span class="kt">short</span> <span class="n">Be_bwd</span><span class="p">;</span>

<span class="cm">/* Add new fields here, above is a mirror of the sdla_conf */</span>

<span class="p">};</span>

<span class="cp">#define FRAD_STATION_CPE	0x0000</span>
<span class="cp">#define FRAD_STATION_NODE	0x0001</span>

<span class="cp">#define FRAD_TX_IGNORE_CIR	0x0001</span>
<span class="cp">#define FRAD_RX_ACCOUNT_CIR	0x0002</span>
<span class="cp">#define FRAD_DROP_ABORTED	0x0004</span>
<span class="cp">#define FRAD_BUFFERIF		0x0008</span>
<span class="cp">#define FRAD_STATS		0x0010</span>
<span class="cp">#define FRAD_MCI		0x0100</span>
<span class="cp">#define FRAD_AUTODLCI		0x8000</span>
<span class="cp">#define FRAD_VALID_FLAGS	0x811F</span>

<span class="cp">#define FRAD_CLOCK_INT		0x0001</span>
<span class="cp">#define FRAD_CLOCK_EXT		0x0000</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#if defined(CONFIG_DLCI) || defined(CONFIG_DLCI_MODULE)</span>

<span class="cm">/* these are the fields of an RFC 1490 header */</span>
<span class="k">struct</span> <span class="n">frhdr</span>
<span class="p">{</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">control</span><span class="p">;</span>

   <span class="cm">/* for IP packets, this can be the NLPID */</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">pad</span><span class="p">;</span>

   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">NLPID</span><span class="p">;</span>
   <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">OUI</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
   <span class="n">__be16</span> <span class="n">PID</span><span class="p">;</span>

<span class="cp">#define IP_NLPID pad </span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* see RFC 1490 for the definition of the following */</span>
<span class="cp">#define FRAD_I_UI		0x03</span>

<span class="cp">#define FRAD_P_PADDING		0x00</span>
<span class="cp">#define FRAD_P_Q933		0x08</span>
<span class="cp">#define FRAD_P_SNAP		0x80</span>
<span class="cp">#define FRAD_P_CLNP		0x81</span>
<span class="cp">#define FRAD_P_IP		0xCC</span>

<span class="k">struct</span> <span class="n">dlci_local</span>
<span class="p">{</span>
   <span class="k">struct</span> <span class="n">net_device</span>      <span class="o">*</span><span class="n">master</span><span class="p">;</span>
   <span class="k">struct</span> <span class="n">net_device</span>      <span class="o">*</span><span class="n">slave</span><span class="p">;</span>
   <span class="k">struct</span> <span class="n">dlci_conf</span>       <span class="n">config</span><span class="p">;</span>
   <span class="kt">int</span>                    <span class="n">configured</span><span class="p">;</span>
   <span class="k">struct</span> <span class="n">list_head</span>	  <span class="n">list</span><span class="p">;</span>

   <span class="cm">/* callback function */</span>
   <span class="kt">void</span>              <span class="p">(</span><span class="o">*</span><span class="n">receive</span><span class="p">)(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">frad_local</span>
<span class="p">{</span>
   <span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">stats</span><span class="p">;</span>

   <span class="cm">/* devices which this FRAD is slaved to */</span>
   <span class="k">struct</span> <span class="n">net_device</span>     <span class="o">*</span><span class="n">master</span><span class="p">[</span><span class="n">CONFIG_DLCI_MAX</span><span class="p">];</span>
   <span class="kt">short</span>             <span class="n">dlci</span><span class="p">[</span><span class="n">CONFIG_DLCI_MAX</span><span class="p">];</span>

   <span class="k">struct</span> <span class="n">frad_conf</span>  <span class="n">config</span><span class="p">;</span>
   <span class="kt">int</span>               <span class="n">configured</span><span class="p">;</span>	<span class="cm">/* has this device been configured */</span>
   <span class="kt">int</span>               <span class="n">initialized</span><span class="p">;</span>	<span class="cm">/* mem_start, port, irq set ? */</span>

   <span class="cm">/* callback functions */</span>
   <span class="kt">int</span>               <span class="p">(</span><span class="o">*</span><span class="n">activate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">);</span>
   <span class="kt">int</span>               <span class="p">(</span><span class="o">*</span><span class="n">deactivate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">);</span>
   <span class="kt">int</span>               <span class="p">(</span><span class="o">*</span><span class="n">assoc</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">);</span>
   <span class="kt">int</span>               <span class="p">(</span><span class="o">*</span><span class="n">deassoc</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">);</span>
   <span class="kt">int</span>               <span class="p">(</span><span class="o">*</span><span class="n">dlci_conf</span><span class="p">)(</span><span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="n">get</span><span class="p">);</span>

   <span class="cm">/* fields that are used by the Sangoma SDLA cards */</span>
   <span class="k">struct</span> <span class="n">timer_list</span> <span class="n">timer</span><span class="p">;</span>
   <span class="kt">int</span>               <span class="n">type</span><span class="p">;</span>		<span class="cm">/* adapter type */</span>
   <span class="kt">int</span>               <span class="n">state</span><span class="p">;</span>		<span class="cm">/* state of the S502/8 control latch */</span>
   <span class="kt">int</span>               <span class="n">buffer</span><span class="p">;</span>		<span class="cm">/* current buffer for S508 firmware */</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_DLCI || CONFIG_DLCI_MODULE */</span><span class="cp"></span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">dlci_ioctl_set</span><span class="p">(</span><span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">hook</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__user</span> <span class="o">*</span><span class="p">));</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
