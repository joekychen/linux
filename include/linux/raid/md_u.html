<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › raid › md_u.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>md_u.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">   md_u.h : user &lt;=&gt; kernel API between Linux raidtools and RAID drivers</span>
<span class="cm">          Copyright (C) 1998 Ingo Molnar</span>
<span class="cm">	  </span>
<span class="cm">   This program is free software; you can redistribute it and/or modify</span>
<span class="cm">   it under the terms of the GNU General Public License as published by</span>
<span class="cm">   the Free Software Foundation; either version 2, or (at your option)</span>
<span class="cm">   any later version.</span>
<span class="cm">   </span>
<span class="cm">   You should have received a copy of the GNU General Public License</span>
<span class="cm">   (for example /usr/src/linux/COPYING); if not, write to the Free</span>
<span class="cm">   Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.  </span>
<span class="cm">*/</span>

<span class="cp">#ifndef _MD_U_H</span>
<span class="cp">#define _MD_U_H</span>

<span class="cm">/*</span>
<span class="cm"> * Different major versions are not compatible.</span>
<span class="cm"> * Different minor versions are only downward compatible.</span>
<span class="cm"> * Different patchlevel versions are downward and upward compatible.</span>
<span class="cm"> */</span>
<span class="cp">#define MD_MAJOR_VERSION                0</span>
<span class="cp">#define MD_MINOR_VERSION                90</span>
<span class="cm">/*</span>
<span class="cm"> * MD_PATCHLEVEL_VERSION indicates kernel functionality.</span>
<span class="cm"> * &gt;=1 means different superblock formats are selectable using SET_ARRAY_INFO</span>
<span class="cm"> *     and major_version/minor_version accordingly</span>
<span class="cm"> * &gt;=2 means that Internal bitmaps are supported by setting MD_SB_BITMAP_PRESENT</span>
<span class="cm"> *     in the super status byte</span>
<span class="cm"> * &gt;=3 means that bitmap superblock version 4 is supported, which uses</span>
<span class="cm"> *     little-ending representation rather than host-endian</span>
<span class="cm"> */</span>
<span class="cp">#define MD_PATCHLEVEL_VERSION           3</span>

<span class="cm">/* ioctls */</span>

<span class="cm">/* status */</span>
<span class="cp">#define RAID_VERSION		_IOR (MD_MAJOR, 0x10, mdu_version_t)</span>
<span class="cp">#define GET_ARRAY_INFO		_IOR (MD_MAJOR, 0x11, mdu_array_info_t)</span>
<span class="cp">#define GET_DISK_INFO		_IOR (MD_MAJOR, 0x12, mdu_disk_info_t)</span>
<span class="cp">#define PRINT_RAID_DEBUG	_IO (MD_MAJOR, 0x13)</span>
<span class="cp">#define RAID_AUTORUN		_IO (MD_MAJOR, 0x14)</span>
<span class="cp">#define GET_BITMAP_FILE		_IOR (MD_MAJOR, 0x15, mdu_bitmap_file_t)</span>

<span class="cm">/* configuration */</span>
<span class="cp">#define CLEAR_ARRAY		_IO (MD_MAJOR, 0x20)</span>
<span class="cp">#define ADD_NEW_DISK		_IOW (MD_MAJOR, 0x21, mdu_disk_info_t)</span>
<span class="cp">#define HOT_REMOVE_DISK		_IO (MD_MAJOR, 0x22)</span>
<span class="cp">#define SET_ARRAY_INFO		_IOW (MD_MAJOR, 0x23, mdu_array_info_t)</span>
<span class="cp">#define SET_DISK_INFO		_IO (MD_MAJOR, 0x24)</span>
<span class="cp">#define WRITE_RAID_INFO		_IO (MD_MAJOR, 0x25)</span>
<span class="cp">#define UNPROTECT_ARRAY		_IO (MD_MAJOR, 0x26)</span>
<span class="cp">#define PROTECT_ARRAY		_IO (MD_MAJOR, 0x27)</span>
<span class="cp">#define HOT_ADD_DISK		_IO (MD_MAJOR, 0x28)</span>
<span class="cp">#define SET_DISK_FAULTY		_IO (MD_MAJOR, 0x29)</span>
<span class="cp">#define HOT_GENERATE_ERROR	_IO (MD_MAJOR, 0x2a)</span>
<span class="cp">#define SET_BITMAP_FILE		_IOW (MD_MAJOR, 0x2b, int)</span>

<span class="cm">/* usage */</span>
<span class="cp">#define RUN_ARRAY		_IOW (MD_MAJOR, 0x30, mdu_param_t)</span>
<span class="cm">/*  0x31 was START_ARRAY  */</span>
<span class="cp">#define STOP_ARRAY		_IO (MD_MAJOR, 0x32)</span>
<span class="cp">#define STOP_ARRAY_RO		_IO (MD_MAJOR, 0x33)</span>
<span class="cp">#define RESTART_ARRAY_RW	_IO (MD_MAJOR, 0x34)</span>

<span class="cm">/* 63 partitions with the alternate major number (mdp) */</span>
<span class="cp">#define MdpMinorShift 6</span>
<span class="cp">#ifdef __KERNEL__</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mdp_major</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">mdu_version_s</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">major</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">minor</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">patchlevel</span><span class="p">;</span>
<span class="p">}</span> <span class="n">mdu_version_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">mdu_array_info_s</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * Generic constant information</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">major_version</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">minor_version</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">patch_version</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ctime</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">level</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nr_disks</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">raid_disks</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">md_minor</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">not_persistent</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Generic state information</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">utime</span><span class="p">;</span>		<span class="cm">/*  0 Superblock update time		      */</span>
	<span class="kt">int</span> <span class="n">state</span><span class="p">;</span>		<span class="cm">/*  1 State bits (clean, ...)		      */</span>
	<span class="kt">int</span> <span class="n">active_disks</span><span class="p">;</span>	<span class="cm">/*  2 Number of currently active disks	      */</span>
	<span class="kt">int</span> <span class="n">working_disks</span><span class="p">;</span>	<span class="cm">/*  3 Number of working disks		      */</span>
	<span class="kt">int</span> <span class="n">failed_disks</span><span class="p">;</span>	<span class="cm">/*  4 Number of failed disks		      */</span>
	<span class="kt">int</span> <span class="n">spare_disks</span><span class="p">;</span>	<span class="cm">/*  5 Number of spare disks		      */</span>

	<span class="cm">/*</span>
<span class="cm">	 * Personality information</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">layout</span><span class="p">;</span>		<span class="cm">/*  0 the array&#39;s physical layout	      */</span>
	<span class="kt">int</span> <span class="n">chunk_size</span><span class="p">;</span>	<span class="cm">/*  1 chunk size in bytes		      */</span>

<span class="p">}</span> <span class="n">mdu_array_info_t</span><span class="p">;</span>

<span class="cm">/* non-obvious values for &#39;level&#39; */</span>
<span class="cp">#define	LEVEL_MULTIPATH		(-4)</span>
<span class="cp">#define	LEVEL_LINEAR		(-1)</span>
<span class="cp">#define	LEVEL_FAULTY		(-5)</span>

<span class="cm">/* we need a value for &#39;no level specified&#39; and 0</span>
<span class="cm"> * means &#39;raid0&#39;, so we need something else.  This is</span>
<span class="cm"> * for internal use only</span>
<span class="cm"> */</span>
<span class="cp">#define	LEVEL_NONE		(-1000000)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">mdu_disk_info_s</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * configuration/status of one particular disk</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">number</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">major</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">minor</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">raid_disk</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">state</span><span class="p">;</span>

<span class="p">}</span> <span class="n">mdu_disk_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">mdu_start_info_s</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * configuration/status of one particular disk</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">major</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">minor</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">raid_disk</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">state</span><span class="p">;</span>

<span class="p">}</span> <span class="n">mdu_start_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">mdu_bitmap_file_s</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">pathname</span><span class="p">[</span><span class="mi">4096</span><span class="p">];</span>
<span class="p">}</span> <span class="n">mdu_bitmap_file_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">mdu_param_s</span>
<span class="p">{</span>
	<span class="kt">int</span>			<span class="n">personality</span><span class="p">;</span>	<span class="cm">/* 1,2,3,4 */</span>
	<span class="kt">int</span>			<span class="n">chunk_size</span><span class="p">;</span>	<span class="cm">/* in bytes */</span>
	<span class="kt">int</span>			<span class="n">max_fault</span><span class="p">;</span>	<span class="cm">/* unused for now */</span>
<span class="p">}</span> <span class="n">mdu_param_t</span><span class="p">;</span>

<span class="cp">#endif </span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
