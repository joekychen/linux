<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › pkt_cls.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>pkt_cls.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __LINUX_PKT_CLS_H</span>
<span class="cp">#define __LINUX_PKT_CLS_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/pkt_sched.h&gt;</span>

<span class="cm">/* I think i could have done better macros ; for now this is stolen from</span>
<span class="cm"> * some arch/mips code - jhs</span>
<span class="cm">*/</span>
<span class="cp">#define _TC_MAKE32(x) ((x))</span>

<span class="cp">#define _TC_MAKEMASK1(n) (_TC_MAKE32(1) &lt;&lt; _TC_MAKE32(n))</span>
<span class="cp">#define _TC_MAKEMASK(v,n) (_TC_MAKE32((_TC_MAKE32(1)&lt;&lt;(v))-1) &lt;&lt; _TC_MAKE32(n))</span>
<span class="cp">#define _TC_MAKEVALUE(v,n) (_TC_MAKE32(v) &lt;&lt; _TC_MAKE32(n))</span>
<span class="cp">#define _TC_GETVALUE(v,n,m) ((_TC_MAKE32(v) &amp; _TC_MAKE32(m)) &gt;&gt; _TC_MAKE32(n))</span>

<span class="cm">/* verdict bit breakdown </span>
<span class="cm"> *</span>
<span class="cm">bit 0: when set -&gt; this packet has been munged already</span>

<span class="cm">bit 1: when set -&gt; It is ok to munge this packet</span>

<span class="cm">bit 2,3,4,5: Reclassify counter - sort of reverse TTL - if exceeded</span>
<span class="cm">assume loop</span>

<span class="cm">bit 6,7: Where this packet was last seen </span>
<span class="cm">0: Above the transmit example at the socket level</span>
<span class="cm">1: on the Ingress</span>
<span class="cm">2: on the Egress</span>

<span class="cm">bit 8: when set --&gt; Request not to classify on ingress. </span>

<span class="cm">bits 9,10,11: redirect counter -  redirect TTL. Loop avoidance</span>

<span class="cm"> *</span>
<span class="cm"> * */</span>

<span class="cp">#define TC_MUNGED          _TC_MAKEMASK1(0)</span>
<span class="cp">#define SET_TC_MUNGED(v)   ( TC_MUNGED | (v &amp; ~TC_MUNGED))</span>
<span class="cp">#define CLR_TC_MUNGED(v)   ( v &amp; ~TC_MUNGED)</span>

<span class="cp">#define TC_OK2MUNGE        _TC_MAKEMASK1(1)</span>
<span class="cp">#define SET_TC_OK2MUNGE(v)   ( TC_OK2MUNGE | (v &amp; ~TC_OK2MUNGE))</span>
<span class="cp">#define CLR_TC_OK2MUNGE(v)   ( v &amp; ~TC_OK2MUNGE)</span>

<span class="cp">#define S_TC_VERD          _TC_MAKE32(2)</span>
<span class="cp">#define M_TC_VERD          _TC_MAKEMASK(4,S_TC_VERD)</span>
<span class="cp">#define G_TC_VERD(x)       _TC_GETVALUE(x,S_TC_VERD,M_TC_VERD)</span>
<span class="cp">#define V_TC_VERD(x)       _TC_MAKEVALUE(x,S_TC_VERD)</span>
<span class="cp">#define SET_TC_VERD(v,n)   ((V_TC_VERD(n)) | (v &amp; ~M_TC_VERD))</span>

<span class="cp">#define S_TC_FROM          _TC_MAKE32(6)</span>
<span class="cp">#define M_TC_FROM          _TC_MAKEMASK(2,S_TC_FROM)</span>
<span class="cp">#define G_TC_FROM(x)       _TC_GETVALUE(x,S_TC_FROM,M_TC_FROM)</span>
<span class="cp">#define V_TC_FROM(x)       _TC_MAKEVALUE(x,S_TC_FROM)</span>
<span class="cp">#define SET_TC_FROM(v,n)   ((V_TC_FROM(n)) | (v &amp; ~M_TC_FROM))</span>
<span class="cp">#define AT_STACK	0x0</span>
<span class="cp">#define AT_INGRESS	0x1</span>
<span class="cp">#define AT_EGRESS	0x2</span>

<span class="cp">#define TC_NCLS          _TC_MAKEMASK1(8)</span>
<span class="cp">#define SET_TC_NCLS(v)   ( TC_NCLS | (v &amp; ~TC_NCLS))</span>
<span class="cp">#define CLR_TC_NCLS(v)   ( v &amp; ~TC_NCLS)</span>

<span class="cp">#define S_TC_RTTL          _TC_MAKE32(9)</span>
<span class="cp">#define M_TC_RTTL          _TC_MAKEMASK(3,S_TC_RTTL)</span>
<span class="cp">#define G_TC_RTTL(x)       _TC_GETVALUE(x,S_TC_RTTL,M_TC_RTTL)</span>
<span class="cp">#define V_TC_RTTL(x)       _TC_MAKEVALUE(x,S_TC_RTTL)</span>
<span class="cp">#define SET_TC_RTTL(v,n)   ((V_TC_RTTL(n)) | (v &amp; ~M_TC_RTTL))</span>

<span class="cp">#define S_TC_AT          _TC_MAKE32(12)</span>
<span class="cp">#define M_TC_AT          _TC_MAKEMASK(2,S_TC_AT)</span>
<span class="cp">#define G_TC_AT(x)       _TC_GETVALUE(x,S_TC_AT,M_TC_AT)</span>
<span class="cp">#define V_TC_AT(x)       _TC_MAKEVALUE(x,S_TC_AT)</span>
<span class="cp">#define SET_TC_AT(v,n)   ((V_TC_AT(n)) | (v &amp; ~M_TC_AT))</span>

<span class="cm">/* Action attributes */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_ACT_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_ACT_KIND</span><span class="p">,</span>
	<span class="n">TCA_ACT_OPTIONS</span><span class="p">,</span>
	<span class="n">TCA_ACT_INDEX</span><span class="p">,</span>
	<span class="n">TCA_ACT_STATS</span><span class="p">,</span>
	<span class="n">__TCA_ACT_MAX</span>
<span class="p">};</span>

<span class="cp">#define TCA_ACT_MAX __TCA_ACT_MAX</span>
<span class="cp">#define TCA_OLD_COMPAT (TCA_ACT_MAX+1)</span>
<span class="cp">#define TCA_ACT_MAX_PRIO 32</span>
<span class="cp">#define TCA_ACT_BIND	1</span>
<span class="cp">#define TCA_ACT_NOBIND	0</span>
<span class="cp">#define TCA_ACT_UNBIND	1</span>
<span class="cp">#define TCA_ACT_NOUNBIND	0</span>
<span class="cp">#define TCA_ACT_REPLACE		1</span>
<span class="cp">#define TCA_ACT_NOREPLACE	0</span>
<span class="cp">#define MAX_REC_LOOP 4</span>
<span class="cp">#define MAX_RED_LOOP 4</span>

<span class="cp">#define TC_ACT_UNSPEC	(-1)</span>
<span class="cp">#define TC_ACT_OK		0</span>
<span class="cp">#define TC_ACT_RECLASSIFY	1</span>
<span class="cp">#define TC_ACT_SHOT		2</span>
<span class="cp">#define TC_ACT_PIPE		3</span>
<span class="cp">#define TC_ACT_STOLEN		4</span>
<span class="cp">#define TC_ACT_QUEUED		5</span>
<span class="cp">#define TC_ACT_REPEAT		6</span>
<span class="cp">#define TC_ACT_JUMP		0x10000000</span>

<span class="cm">/* Action type identifiers*/</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_ID_UNSPEC</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
	<span class="n">TCA_ID_POLICE</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
	<span class="cm">/* other actions go here */</span>
	<span class="n">__TCA_ID_MAX</span><span class="o">=</span><span class="mi">255</span>
<span class="p">};</span>

<span class="cp">#define TCA_ID_MAX __TCA_ID_MAX</span>

<span class="k">struct</span> <span class="n">tc_police</span> <span class="p">{</span>
	<span class="n">__u32</span>			<span class="n">index</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">action</span><span class="p">;</span>
<span class="cp">#define TC_POLICE_UNSPEC	TC_ACT_UNSPEC</span>
<span class="cp">#define TC_POLICE_OK		TC_ACT_OK</span>
<span class="cp">#define TC_POLICE_RECLASSIFY	TC_ACT_RECLASSIFY</span>
<span class="cp">#define TC_POLICE_SHOT		TC_ACT_SHOT</span>
<span class="cp">#define TC_POLICE_PIPE		TC_ACT_PIPE</span>

	<span class="n">__u32</span>			<span class="n">limit</span><span class="p">;</span>
	<span class="n">__u32</span>			<span class="n">burst</span><span class="p">;</span>
	<span class="n">__u32</span>			<span class="n">mtu</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tc_ratespec</span>	<span class="n">rate</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tc_ratespec</span>	<span class="n">peakrate</span><span class="p">;</span>
	<span class="kt">int</span> 			<span class="n">refcnt</span><span class="p">;</span>
	<span class="kt">int</span> 			<span class="n">bindcnt</span><span class="p">;</span>
	<span class="n">__u32</span>			<span class="n">capab</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">tcf_t</span> <span class="p">{</span>
	<span class="n">__u64</span>   <span class="n">install</span><span class="p">;</span>
	<span class="n">__u64</span>   <span class="n">lastuse</span><span class="p">;</span>
	<span class="n">__u64</span>   <span class="n">expires</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">tc_cnt</span> <span class="p">{</span>
	<span class="kt">int</span>                   <span class="n">refcnt</span><span class="p">;</span> 
	<span class="kt">int</span>                   <span class="n">bindcnt</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define tc_gen \</span>
<span class="cp">	__u32                 index; \</span>
<span class="cp">	__u32                 capab; \</span>
<span class="cp">	int                   action; \</span>
<span class="cp">	int                   refcnt; \</span>
<span class="cp">	int                   bindcnt</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_POLICE_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_POLICE_TBF</span><span class="p">,</span>
	<span class="n">TCA_POLICE_RATE</span><span class="p">,</span>
	<span class="n">TCA_POLICE_PEAKRATE</span><span class="p">,</span>
	<span class="n">TCA_POLICE_AVRATE</span><span class="p">,</span>
	<span class="n">TCA_POLICE_RESULT</span><span class="p">,</span>
	<span class="n">__TCA_POLICE_MAX</span>
<span class="cp">#define TCA_POLICE_RESULT TCA_POLICE_RESULT</span>
<span class="p">};</span>

<span class="cp">#define TCA_POLICE_MAX (__TCA_POLICE_MAX - 1)</span>

<span class="cm">/* U32 filters */</span>

<span class="cp">#define TC_U32_HTID(h) ((h)&amp;0xFFF00000)</span>
<span class="cp">#define TC_U32_USERHTID(h) (TC_U32_HTID(h)&gt;&gt;20)</span>
<span class="cp">#define TC_U32_HASH(h) (((h)&gt;&gt;12)&amp;0xFF)</span>
<span class="cp">#define TC_U32_NODE(h) ((h)&amp;0xFFF)</span>
<span class="cp">#define TC_U32_KEY(h) ((h)&amp;0xFFFFF)</span>
<span class="cp">#define TC_U32_UNSPEC	0</span>
<span class="cp">#define TC_U32_ROOT	(0xFFF00000)</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_U32_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_U32_CLASSID</span><span class="p">,</span>
	<span class="n">TCA_U32_HASH</span><span class="p">,</span>
	<span class="n">TCA_U32_LINK</span><span class="p">,</span>
	<span class="n">TCA_U32_DIVISOR</span><span class="p">,</span>
	<span class="n">TCA_U32_SEL</span><span class="p">,</span>
	<span class="n">TCA_U32_POLICE</span><span class="p">,</span>
	<span class="n">TCA_U32_ACT</span><span class="p">,</span>   
	<span class="n">TCA_U32_INDEV</span><span class="p">,</span>
	<span class="n">TCA_U32_PCNT</span><span class="p">,</span>
	<span class="n">TCA_U32_MARK</span><span class="p">,</span>
	<span class="n">__TCA_U32_MAX</span>
<span class="p">};</span>

<span class="cp">#define TCA_U32_MAX (__TCA_U32_MAX - 1)</span>

<span class="k">struct</span> <span class="n">tc_u32_key</span> <span class="p">{</span>
	<span class="n">__be32</span>		<span class="n">mask</span><span class="p">;</span>
	<span class="n">__be32</span>		<span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">off</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">offmask</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">tc_u32_sel</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">offshift</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">nkeys</span><span class="p">;</span>

	<span class="n">__be16</span>			<span class="n">offmask</span><span class="p">;</span>
	<span class="n">__u16</span>			<span class="n">off</span><span class="p">;</span>
	<span class="kt">short</span>			<span class="n">offoff</span><span class="p">;</span>

	<span class="kt">short</span>			<span class="n">hoff</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">hmask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tc_u32_key</span>	<span class="n">keys</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">tc_u32_mark</span> <span class="p">{</span>
	<span class="n">__u32</span>		<span class="n">val</span><span class="p">;</span>
	<span class="n">__u32</span>		<span class="n">mask</span><span class="p">;</span>
	<span class="n">__u32</span>		<span class="n">success</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">tc_u32_pcnt</span> <span class="p">{</span>
	<span class="n">__u64</span> <span class="n">rcnt</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">rhit</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">kcnts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Flags */</span>

<span class="cp">#define TC_U32_TERMINAL		1</span>
<span class="cp">#define TC_U32_OFFSET		2</span>
<span class="cp">#define TC_U32_VAROFFSET	4</span>
<span class="cp">#define TC_U32_EAT		8</span>

<span class="cp">#define TC_U32_MAXDEPTH 8</span>


<span class="cm">/* RSVP filter */</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_RSVP_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_RSVP_CLASSID</span><span class="p">,</span>
	<span class="n">TCA_RSVP_DST</span><span class="p">,</span>
	<span class="n">TCA_RSVP_SRC</span><span class="p">,</span>
	<span class="n">TCA_RSVP_PINFO</span><span class="p">,</span>
	<span class="n">TCA_RSVP_POLICE</span><span class="p">,</span>
	<span class="n">TCA_RSVP_ACT</span><span class="p">,</span>
	<span class="n">__TCA_RSVP_MAX</span>
<span class="p">};</span>

<span class="cp">#define TCA_RSVP_MAX (__TCA_RSVP_MAX - 1 )</span>

<span class="k">struct</span> <span class="n">tc_rsvp_gpi</span> <span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">key</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">mask</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">offset</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">tc_rsvp_pinfo</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">tc_rsvp_gpi</span> <span class="n">dpi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tc_rsvp_gpi</span> <span class="n">spi</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">protocol</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">tunnelid</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">tunnelhdr</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">pad</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* ROUTE filter */</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_ROUTE4_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_ROUTE4_CLASSID</span><span class="p">,</span>
	<span class="n">TCA_ROUTE4_TO</span><span class="p">,</span>
	<span class="n">TCA_ROUTE4_FROM</span><span class="p">,</span>
	<span class="n">TCA_ROUTE4_IIF</span><span class="p">,</span>
	<span class="n">TCA_ROUTE4_POLICE</span><span class="p">,</span>
	<span class="n">TCA_ROUTE4_ACT</span><span class="p">,</span>
	<span class="n">__TCA_ROUTE4_MAX</span>
<span class="p">};</span>

<span class="cp">#define TCA_ROUTE4_MAX (__TCA_ROUTE4_MAX - 1)</span>


<span class="cm">/* FW filter */</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_FW_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_FW_CLASSID</span><span class="p">,</span>
	<span class="n">TCA_FW_POLICE</span><span class="p">,</span>
	<span class="n">TCA_FW_INDEV</span><span class="p">,</span> <span class="cm">/*  used by CONFIG_NET_CLS_IND */</span>
	<span class="n">TCA_FW_ACT</span><span class="p">,</span> <span class="cm">/* used by CONFIG_NET_CLS_ACT */</span>
	<span class="n">TCA_FW_MASK</span><span class="p">,</span>
	<span class="n">__TCA_FW_MAX</span>
<span class="p">};</span>

<span class="cp">#define TCA_FW_MAX (__TCA_FW_MAX - 1)</span>

<span class="cm">/* TC index filter */</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_TCINDEX_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_TCINDEX_HASH</span><span class="p">,</span>
	<span class="n">TCA_TCINDEX_MASK</span><span class="p">,</span>
	<span class="n">TCA_TCINDEX_SHIFT</span><span class="p">,</span>
	<span class="n">TCA_TCINDEX_FALL_THROUGH</span><span class="p">,</span>
	<span class="n">TCA_TCINDEX_CLASSID</span><span class="p">,</span>
	<span class="n">TCA_TCINDEX_POLICE</span><span class="p">,</span>
	<span class="n">TCA_TCINDEX_ACT</span><span class="p">,</span>
	<span class="n">__TCA_TCINDEX_MAX</span>
<span class="p">};</span>

<span class="cp">#define TCA_TCINDEX_MAX     (__TCA_TCINDEX_MAX - 1)</span>

<span class="cm">/* Flow filter */</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">FLOW_KEY_SRC</span><span class="p">,</span>
	<span class="n">FLOW_KEY_DST</span><span class="p">,</span>
	<span class="n">FLOW_KEY_PROTO</span><span class="p">,</span>
	<span class="n">FLOW_KEY_PROTO_SRC</span><span class="p">,</span>
	<span class="n">FLOW_KEY_PROTO_DST</span><span class="p">,</span>
	<span class="n">FLOW_KEY_IIF</span><span class="p">,</span>
	<span class="n">FLOW_KEY_PRIORITY</span><span class="p">,</span>
	<span class="n">FLOW_KEY_MARK</span><span class="p">,</span>
	<span class="n">FLOW_KEY_NFCT</span><span class="p">,</span>
	<span class="n">FLOW_KEY_NFCT_SRC</span><span class="p">,</span>
	<span class="n">FLOW_KEY_NFCT_DST</span><span class="p">,</span>
	<span class="n">FLOW_KEY_NFCT_PROTO_SRC</span><span class="p">,</span>
	<span class="n">FLOW_KEY_NFCT_PROTO_DST</span><span class="p">,</span>
	<span class="n">FLOW_KEY_RTCLASSID</span><span class="p">,</span>
	<span class="n">FLOW_KEY_SKUID</span><span class="p">,</span>
	<span class="n">FLOW_KEY_SKGID</span><span class="p">,</span>
	<span class="n">FLOW_KEY_VLAN_TAG</span><span class="p">,</span>
	<span class="n">FLOW_KEY_RXHASH</span><span class="p">,</span>
	<span class="n">__FLOW_KEY_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define FLOW_KEY_MAX	(__FLOW_KEY_MAX - 1)</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">FLOW_MODE_MAP</span><span class="p">,</span>
	<span class="n">FLOW_MODE_HASH</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_FLOW_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_FLOW_KEYS</span><span class="p">,</span>
	<span class="n">TCA_FLOW_MODE</span><span class="p">,</span>
	<span class="n">TCA_FLOW_BASECLASS</span><span class="p">,</span>
	<span class="n">TCA_FLOW_RSHIFT</span><span class="p">,</span>
	<span class="n">TCA_FLOW_ADDEND</span><span class="p">,</span>
	<span class="n">TCA_FLOW_MASK</span><span class="p">,</span>
	<span class="n">TCA_FLOW_XOR</span><span class="p">,</span>
	<span class="n">TCA_FLOW_DIVISOR</span><span class="p">,</span>
	<span class="n">TCA_FLOW_ACT</span><span class="p">,</span>
	<span class="n">TCA_FLOW_POLICE</span><span class="p">,</span>
	<span class="n">TCA_FLOW_EMATCHES</span><span class="p">,</span>
	<span class="n">TCA_FLOW_PERTURB</span><span class="p">,</span>
	<span class="n">__TCA_FLOW_MAX</span>
<span class="p">};</span>

<span class="cp">#define TCA_FLOW_MAX	(__TCA_FLOW_MAX - 1)</span>

<span class="cm">/* Basic filter */</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_BASIC_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_BASIC_CLASSID</span><span class="p">,</span>
	<span class="n">TCA_BASIC_EMATCHES</span><span class="p">,</span>
	<span class="n">TCA_BASIC_ACT</span><span class="p">,</span>
	<span class="n">TCA_BASIC_POLICE</span><span class="p">,</span>
	<span class="n">__TCA_BASIC_MAX</span>
<span class="p">};</span>

<span class="cp">#define TCA_BASIC_MAX (__TCA_BASIC_MAX - 1)</span>


<span class="cm">/* Cgroup classifier */</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_CGROUP_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_CGROUP_ACT</span><span class="p">,</span>
	<span class="n">TCA_CGROUP_POLICE</span><span class="p">,</span>
	<span class="n">TCA_CGROUP_EMATCHES</span><span class="p">,</span>
	<span class="n">__TCA_CGROUP_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define TCA_CGROUP_MAX (__TCA_CGROUP_MAX - 1)</span>

<span class="cm">/* Extended Matches */</span>

<span class="k">struct</span> <span class="n">tcf_ematch_tree_hdr</span> <span class="p">{</span>
	<span class="n">__u16</span>		<span class="n">nmatches</span><span class="p">;</span>
	<span class="n">__u16</span>		<span class="n">progid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCA_EMATCH_TREE_UNSPEC</span><span class="p">,</span>
	<span class="n">TCA_EMATCH_TREE_HDR</span><span class="p">,</span>
	<span class="n">TCA_EMATCH_TREE_LIST</span><span class="p">,</span>
	<span class="n">__TCA_EMATCH_TREE_MAX</span>
<span class="p">};</span>
<span class="cp">#define TCA_EMATCH_TREE_MAX (__TCA_EMATCH_TREE_MAX - 1)</span>

<span class="k">struct</span> <span class="n">tcf_ematch_hdr</span> <span class="p">{</span>
	<span class="n">__u16</span>		<span class="n">matchid</span><span class="p">;</span>
	<span class="n">__u16</span>		<span class="n">kind</span><span class="p">;</span>
	<span class="n">__u16</span>		<span class="n">flags</span><span class="p">;</span>
	<span class="n">__u16</span>		<span class="n">pad</span><span class="p">;</span> <span class="cm">/* currently unused */</span>
<span class="p">};</span>

<span class="cm">/*  0                   1</span>
<span class="cm"> *  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 </span>
<span class="cm"> * +-----------------------+-+-+---+</span>
<span class="cm"> * |         Unused        |S|I| R |</span>
<span class="cm"> * +-----------------------+-+-+---+</span>
<span class="cm"> *</span>
<span class="cm"> * R(2) ::= relation to next ematch</span>
<span class="cm"> *          where: 0 0 END (last ematch)</span>
<span class="cm"> *                 0 1 AND</span>
<span class="cm"> *                 1 0 OR</span>
<span class="cm"> *                 1 1 Unused (invalid)</span>
<span class="cm"> * I(1) ::= invert result</span>
<span class="cm"> * S(1) ::= simple payload</span>
<span class="cm"> */</span>
<span class="cp">#define TCF_EM_REL_END	0</span>
<span class="cp">#define TCF_EM_REL_AND	(1&lt;&lt;0)</span>
<span class="cp">#define TCF_EM_REL_OR	(1&lt;&lt;1)</span>
<span class="cp">#define TCF_EM_INVERT	(1&lt;&lt;2)</span>
<span class="cp">#define TCF_EM_SIMPLE	(1&lt;&lt;3)</span>

<span class="cp">#define TCF_EM_REL_MASK	3</span>
<span class="cp">#define TCF_EM_REL_VALID(v) (((v) &amp; TCF_EM_REL_MASK) != TCF_EM_REL_MASK)</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCF_LAYER_LINK</span><span class="p">,</span>
	<span class="n">TCF_LAYER_NETWORK</span><span class="p">,</span>
	<span class="n">TCF_LAYER_TRANSPORT</span><span class="p">,</span>
	<span class="n">__TCF_LAYER_MAX</span>
<span class="p">};</span>
<span class="cp">#define TCF_LAYER_MAX (__TCF_LAYER_MAX - 1)</span>

<span class="cm">/* Ematch type assignments</span>
<span class="cm"> *   1..32767		Reserved for ematches inside kernel tree</span>
<span class="cm"> *   32768..65535	Free to use, not reliable</span>
<span class="cm"> */</span>
<span class="cp">#define	TCF_EM_CONTAINER	0</span>
<span class="cp">#define	TCF_EM_CMP		1</span>
<span class="cp">#define	TCF_EM_NBYTE		2</span>
<span class="cp">#define	TCF_EM_U32		3</span>
<span class="cp">#define	TCF_EM_META		4</span>
<span class="cp">#define	TCF_EM_TEXT		5</span>
<span class="cp">#define        TCF_EM_VLAN		6</span>
<span class="cp">#define	TCF_EM_MAX		6</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCF_EM_PROG_TC</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">TCF_EM_OPND_EQ</span><span class="p">,</span>
	<span class="n">TCF_EM_OPND_GT</span><span class="p">,</span>
	<span class="n">TCF_EM_OPND_LT</span>
<span class="p">};</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
