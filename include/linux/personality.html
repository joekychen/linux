<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › personality.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>personality.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _LINUX_PERSONALITY_H</span>
<span class="cp">#define _LINUX_PERSONALITY_H</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/*</span>
<span class="cm"> * Handling of different ABIs (personalities).</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">exec_domain</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">pt_regs</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">int</span>		<span class="n">register_exec_domain</span><span class="p">(</span><span class="k">struct</span> <span class="n">exec_domain</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>		<span class="n">unregister_exec_domain</span><span class="p">(</span><span class="k">struct</span> <span class="n">exec_domain</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>		<span class="n">__set_personality</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Flags for bug emulation.</span>
<span class="cm"> *</span>
<span class="cm"> * These occupy the top three bytes.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">UNAME26</span>	<span class="o">=</span>               <span class="mh">0x0020000</span><span class="p">,</span>
	<span class="n">ADDR_NO_RANDOMIZE</span> <span class="o">=</span> 	<span class="mh">0x0040000</span><span class="p">,</span>	<span class="cm">/* disable randomization of VA space */</span>
	<span class="n">FDPIC_FUNCPTRS</span> <span class="o">=</span>	<span class="mh">0x0080000</span><span class="p">,</span>	<span class="cm">/* userspace function ptrs point to descriptors</span>
<span class="cm">						 * (signal handling)</span>
<span class="cm">						 */</span>
	<span class="n">MMAP_PAGE_ZERO</span> <span class="o">=</span>	<span class="mh">0x0100000</span><span class="p">,</span>
	<span class="n">ADDR_COMPAT_LAYOUT</span> <span class="o">=</span>	<span class="mh">0x0200000</span><span class="p">,</span>
	<span class="n">READ_IMPLIES_EXEC</span> <span class="o">=</span>	<span class="mh">0x0400000</span><span class="p">,</span>
	<span class="n">ADDR_LIMIT_32BIT</span> <span class="o">=</span>	<span class="mh">0x0800000</span><span class="p">,</span>
	<span class="n">SHORT_INODE</span> <span class="o">=</span>		<span class="mh">0x1000000</span><span class="p">,</span>
	<span class="n">WHOLE_SECONDS</span> <span class="o">=</span>		<span class="mh">0x2000000</span><span class="p">,</span>
	<span class="n">STICKY_TIMEOUTS</span>	<span class="o">=</span>	<span class="mh">0x4000000</span><span class="p">,</span>
	<span class="n">ADDR_LIMIT_3GB</span> <span class="o">=</span> 	<span class="mh">0x8000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Security-relevant compatibility flags that must be</span>
<span class="cm"> * cleared upon setuid or setgid exec:</span>
<span class="cm"> */</span>
<span class="cp">#define PER_CLEAR_ON_SETID (READ_IMPLIES_EXEC  | \</span>
<span class="cp">			    ADDR_NO_RANDOMIZE  | \</span>
<span class="cp">			    ADDR_COMPAT_LAYOUT | \</span>
<span class="cp">			    MMAP_PAGE_ZERO)</span>

<span class="cm">/*</span>
<span class="cm"> * Personality types.</span>
<span class="cm"> *</span>
<span class="cm"> * These go in the low byte.  Avoid using the top bit, it will</span>
<span class="cm"> * conflict with error returns.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">PER_LINUX</span> <span class="o">=</span>		<span class="mh">0x0000</span><span class="p">,</span>
	<span class="n">PER_LINUX_32BIT</span> <span class="o">=</span>	<span class="mh">0x0000</span> <span class="o">|</span> <span class="n">ADDR_LIMIT_32BIT</span><span class="p">,</span>
	<span class="n">PER_LINUX_FDPIC</span> <span class="o">=</span>	<span class="mh">0x0000</span> <span class="o">|</span> <span class="n">FDPIC_FUNCPTRS</span><span class="p">,</span>
	<span class="n">PER_SVR4</span> <span class="o">=</span>		<span class="mh">0x0001</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span> <span class="o">|</span> <span class="n">MMAP_PAGE_ZERO</span><span class="p">,</span>
	<span class="n">PER_SVR3</span> <span class="o">=</span>		<span class="mh">0x0002</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span> <span class="o">|</span> <span class="n">SHORT_INODE</span><span class="p">,</span>
	<span class="n">PER_SCOSVR3</span> <span class="o">=</span>		<span class="mh">0x0003</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span> <span class="o">|</span>
					 <span class="n">WHOLE_SECONDS</span> <span class="o">|</span> <span class="n">SHORT_INODE</span><span class="p">,</span>
	<span class="n">PER_OSR5</span> <span class="o">=</span>		<span class="mh">0x0003</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span> <span class="o">|</span> <span class="n">WHOLE_SECONDS</span><span class="p">,</span>
	<span class="n">PER_WYSEV386</span> <span class="o">=</span>		<span class="mh">0x0004</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span> <span class="o">|</span> <span class="n">SHORT_INODE</span><span class="p">,</span>
	<span class="n">PER_ISCR4</span> <span class="o">=</span>		<span class="mh">0x0005</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span><span class="p">,</span>
	<span class="n">PER_BSD</span> <span class="o">=</span>		<span class="mh">0x0006</span><span class="p">,</span>
	<span class="n">PER_SUNOS</span> <span class="o">=</span>		<span class="mh">0x0006</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span><span class="p">,</span>
	<span class="n">PER_XENIX</span> <span class="o">=</span>		<span class="mh">0x0007</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span> <span class="o">|</span> <span class="n">SHORT_INODE</span><span class="p">,</span>
	<span class="n">PER_LINUX32</span> <span class="o">=</span>		<span class="mh">0x0008</span><span class="p">,</span>
	<span class="n">PER_LINUX32_3GB</span> <span class="o">=</span>	<span class="mh">0x0008</span> <span class="o">|</span> <span class="n">ADDR_LIMIT_3GB</span><span class="p">,</span>
	<span class="n">PER_IRIX32</span> <span class="o">=</span>		<span class="mh">0x0009</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span><span class="p">,</span><span class="cm">/* IRIX5 32-bit */</span>
	<span class="n">PER_IRIXN32</span> <span class="o">=</span>		<span class="mh">0x000a</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span><span class="p">,</span><span class="cm">/* IRIX6 new 32-bit */</span>
	<span class="n">PER_IRIX64</span> <span class="o">=</span>		<span class="mh">0x000b</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span><span class="p">,</span><span class="cm">/* IRIX6 64-bit */</span>
	<span class="n">PER_RISCOS</span> <span class="o">=</span>		<span class="mh">0x000c</span><span class="p">,</span>
	<span class="n">PER_SOLARIS</span> <span class="o">=</span>		<span class="mh">0x000d</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span><span class="p">,</span>
	<span class="n">PER_UW7</span> <span class="o">=</span>		<span class="mh">0x000e</span> <span class="o">|</span> <span class="n">STICKY_TIMEOUTS</span> <span class="o">|</span> <span class="n">MMAP_PAGE_ZERO</span><span class="p">,</span>
	<span class="n">PER_OSF4</span> <span class="o">=</span>		<span class="mh">0x000f</span><span class="p">,</span>			 <span class="cm">/* OSF/1 v4 */</span>
	<span class="n">PER_HPUX</span> <span class="o">=</span>		<span class="mh">0x0010</span><span class="p">,</span>
	<span class="n">PER_MASK</span> <span class="o">=</span>		<span class="mh">0x00ff</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/*</span>
<span class="cm"> * Description of an execution domain.</span>
<span class="cm"> * </span>
<span class="cm"> * The first two members are refernced from assembly source</span>
<span class="cm"> * and should stay where they are unless explicitly needed.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">handler_t</span><span class="p">)(</span><span class="kt">int</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">exec_domain</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span>		<span class="o">*</span><span class="n">name</span><span class="p">;</span>		<span class="cm">/* name of the execdomain */</span>
	<span class="n">handler_t</span>		<span class="n">handler</span><span class="p">;</span>	<span class="cm">/* handler for syscalls */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">pers_low</span><span class="p">;</span>	<span class="cm">/* lowest personality */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">pers_high</span><span class="p">;</span>	<span class="cm">/* highest personality */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="o">*</span><span class="n">signal_map</span><span class="p">;</span>	<span class="cm">/* signal mapping */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="o">*</span><span class="n">signal_invmap</span><span class="p">;</span>	<span class="cm">/* reverse signal mapping */</span>
	<span class="k">struct</span> <span class="n">map_segment</span>	<span class="o">*</span><span class="n">err_map</span><span class="p">;</span>	<span class="cm">/* error mapping */</span>
	<span class="k">struct</span> <span class="n">map_segment</span>	<span class="o">*</span><span class="n">socktype_map</span><span class="p">;</span>	<span class="cm">/* socket type mapping */</span>
	<span class="k">struct</span> <span class="n">map_segment</span>	<span class="o">*</span><span class="n">sockopt_map</span><span class="p">;</span>	<span class="cm">/* socket option mapping */</span>
	<span class="k">struct</span> <span class="n">map_segment</span>	<span class="o">*</span><span class="n">af_map</span><span class="p">;</span>	<span class="cm">/* address family mapping */</span>
	<span class="k">struct</span> <span class="n">module</span>		<span class="o">*</span><span class="n">module</span><span class="p">;</span>	<span class="cm">/* module context of the ed. */</span>
	<span class="k">struct</span> <span class="n">exec_domain</span>	<span class="o">*</span><span class="n">next</span><span class="p">;</span>		<span class="cm">/* linked list (internal) */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Return the base personality without flags.</span>
<span class="cm"> */</span>
<span class="cp">#define personality(pers)	(pers &amp; PER_MASK)</span>


<span class="cm">/*</span>
<span class="cm"> * Change personality of the currently running process.</span>
<span class="cm"> */</span>
<span class="cp">#define set_personality(pers) \</span>
<span class="cp">	((current-&gt;personality == (pers)) ? 0 : __set_personality(pers))</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _LINUX_PERSONALITY_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
