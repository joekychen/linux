<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › cdk.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>cdk.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*****************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> *	cdk.h  -- CDK interface definitions.</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright (C) 1996-1998  Stallion Technologies</span>
<span class="cm"> *	Copyright (C) 1994-1996  Greg Ungerer.</span>
<span class="cm"> *</span>
<span class="cm"> *	This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *	it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *	the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *	(at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *	This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *	but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *	GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *	You should have received a copy of the GNU General Public License</span>
<span class="cm"> *	along with this program; if not, write to the Free Software</span>
<span class="cm"> *	Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>

<span class="cm">/*****************************************************************************/</span>
<span class="cp">#ifndef	_CDK_H</span>
<span class="cp">#define	_CDK_H</span>
<span class="cm">/*****************************************************************************/</span>

<span class="cp">#pragma	pack(2)</span>

<span class="cm">/*</span>
<span class="cm"> *	The following set of definitions is used to communicate with the</span>
<span class="cm"> *	shared memory interface of the Stallion intelligent multiport serial</span>
<span class="cm"> *	boards. The definitions in this file are taken directly from the</span>
<span class="cm"> *	document titled &quot;Generic Stackable Interface, Downloader and</span>
<span class="cm"> *	Communications Development Kit&quot;.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> *	Define the set of important shared memory addresses. These are</span>
<span class="cm"> *	required to initialize the board and get things started. All of these</span>
<span class="cm"> *	addresses are relative to the start of the shared memory.</span>
<span class="cm"> */</span>
<span class="cp">#define	CDK_SIGADDR	0x200</span>
<span class="cp">#define	CDK_FEATADDR	0x280</span>
<span class="cp">#define	CDK_CDKADDR	0x300</span>
<span class="cp">#define	CDK_RDYADDR	0x262</span>

<span class="cp">#define	CDK_ALIVEMARKER	13</span>

<span class="cm">/*</span>
<span class="cm"> *	On hardware power up the ROMs located on the EasyConnection 8/64 will</span>
<span class="cm"> *	fill out the following signature information into shared memory. This</span>
<span class="cm"> *	way the host system can quickly determine that the board is present</span>
<span class="cm"> *	and is operational.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">cdkecpsig</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">magic</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">romver</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">cputype</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">panelid</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span> <span class="n">cdkecpsig_t</span><span class="p">;</span>

<span class="cp">#define	ECP_MAGIC	0x21504345</span>

<span class="cm">/*</span>
<span class="cm"> *	On hardware power up the ROMs located on the ONboard, Stallion and</span>
<span class="cm"> *	Brumbys will fill out the following signature information into shared</span>
<span class="cm"> *	memory. This way the host system can quickly determine that the board</span>
<span class="cm"> *	is present and is operational.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">cdkonbsig</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">magic0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">magic1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">magic2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">magic3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">romver</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">memoff</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">memseg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">amask0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">pic</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">status</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">btype</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">clkticks</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">clkspeed</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">amask1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">amask2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">cdkonbsig_t</span><span class="p">;</span>

<span class="cp">#define	ONB_MAGIC0	0xf2a7</span>
<span class="cp">#define	ONB_MAGIC1	0xa149</span>
<span class="cp">#define	ONB_MAGIC2	0x6352</span>
<span class="cp">#define	ONB_MAGIC3	0xf121</span>

<span class="cm">/*</span>
<span class="cm"> *	Define the feature area structure. The feature area is the set of</span>
<span class="cm"> *	startup parameters used by the slave image when it starts executing.</span>
<span class="cm"> *	They allow for the specification of buffer sizes, debug trace, etc.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">cdkfeature</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">debug</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">banner</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">etype</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">nrdevs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">brdspec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">txrqsize</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rxrqsize</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>
<span class="p">}</span> <span class="n">cdkfeature_t</span><span class="p">;</span>

<span class="cp">#define	ETYP_DDK	0</span>
<span class="cp">#define	ETYP_CDK	1</span>

<span class="cm">/*</span>
<span class="cm"> *	Define the CDK header structure. This is the info that the slave</span>
<span class="cm"> *	environment sets up after it has been downloaded and started. It</span>
<span class="cm"> *	essentially provides a memory map for the shared memory interface.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">cdkhdr</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">command</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">status</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">mode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">cmd_buf</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">alive_cnt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">intrpt_mode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">intrpt_id</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">ver_release</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">ver_modification</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">ver_fix</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">deadman_restart</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">deadman</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">nrdevs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">memp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">hostp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">slavep</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">hostreq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">slavereq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">cmd_reserved</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>
<span class="p">}</span> <span class="n">cdkhdr_t</span><span class="p">;</span>

<span class="cp">#define	MODE_DDK	0</span>
<span class="cp">#define	MODE_CDK	1</span>

<span class="cp">#define	IMD_INTR	0x0</span>
<span class="cp">#define	IMD_PPINTR	0x1</span>
<span class="cp">#define	IMD_POLL	0xff</span>

<span class="cm">/*</span>
<span class="cm"> *	Define the memory mapping structure. This structure is pointed to by</span>
<span class="cm"> *	the memp field in the stlcdkhdr struct. As many as these structures</span>
<span class="cm"> *	as required are laid out in shared memory to define how the rest of</span>
<span class="cm"> *	shared memory is divided up. There will be one for each port.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">cdkmem</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">dtype</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">offset</span><span class="p">;</span>
<span class="p">}</span> <span class="n">cdkmem_t</span><span class="p">;</span>

<span class="cp">#define	TYP_UNDEFINED	0x0</span>
<span class="cp">#define	TYP_ASYNCTRL	0x1</span>
<span class="cp">#define	TYP_ASYNC	0x20</span>
<span class="cp">#define	TYP_PARALLEL	0x40</span>
<span class="cp">#define	TYP_SYNCX21	0x60</span>

<span class="cm">/*****************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> *	Following is a set of defines and structures used to actually deal</span>
<span class="cm"> *	with the serial ports on the board. Firstly is the set of commands</span>
<span class="cm"> *	that can be applied to ports.</span>
<span class="cm"> */</span>
<span class="cp">#define	ASYCMD		(((unsigned long) &#39;a&#39;) &lt;&lt; 8)</span>

<span class="cp">#define	A_NULL		(ASYCMD | 0)</span>
<span class="cp">#define	A_FLUSH		(ASYCMD | 1)</span>
<span class="cp">#define	A_BREAK		(ASYCMD | 2)</span>
<span class="cp">#define	A_GETPORT	(ASYCMD | 3)</span>
<span class="cp">#define	A_SETPORT	(ASYCMD | 4)</span>
<span class="cp">#define	A_SETPORTF	(ASYCMD | 5)</span>
<span class="cp">#define	A_SETPORTFTX	(ASYCMD | 6)</span>
<span class="cp">#define	A_SETPORTFRX	(ASYCMD | 7)</span>
<span class="cp">#define	A_GETSIGNALS	(ASYCMD | 8)</span>
<span class="cp">#define	A_SETSIGNALS	(ASYCMD | 9)</span>
<span class="cp">#define	A_SETSIGNALSF	(ASYCMD | 10)</span>
<span class="cp">#define	A_SETSIGNALSFTX	(ASYCMD | 11)</span>
<span class="cp">#define	A_SETSIGNALSFRX	(ASYCMD | 12)</span>
<span class="cp">#define	A_GETNOTIFY	(ASYCMD | 13)</span>
<span class="cp">#define	A_SETNOTIFY	(ASYCMD | 14)</span>
<span class="cp">#define	A_NOTIFY	(ASYCMD | 15)</span>
<span class="cp">#define	A_PORTCTRL	(ASYCMD | 16)</span>
<span class="cp">#define	A_GETSTATS	(ASYCMD | 17)</span>
<span class="cp">#define	A_RQSTATE	(ASYCMD | 18)</span>
<span class="cp">#define	A_FLOWSTATE	(ASYCMD | 19)</span>
<span class="cp">#define	A_CLEARSTATS	(ASYCMD | 20)</span>

<span class="cm">/*</span>
<span class="cm"> *	Define those arguments used for simple commands.</span>
<span class="cm"> */</span>
<span class="cp">#define	FLUSHRX		0x1</span>
<span class="cp">#define	FLUSHTX		0x2</span>

<span class="cp">#define	BREAKON		-1</span>
<span class="cp">#define	BREAKOFF	-2</span>

<span class="cm">/*</span>
<span class="cm"> *	Define the port setting structure, and all those defines that go along</span>
<span class="cm"> *	with it. Basically this structure defines the characteristics of this</span>
<span class="cm"> *	port: baud rate, chars, parity, input/output char cooking etc.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">asyport</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">baudout</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">baudin</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">iflag</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">oflag</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">lflag</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">pflag</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flow</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">spare1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">vtime</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">vmin</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">txlo</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">txhi</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">rxlo</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">rxhi</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">rxhog</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">spare2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">csize</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">stopbs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">parity</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">stopin</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">startin</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">stopout</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">startout</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">parmark</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">brkmark</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">cc</span><span class="p">[</span><span class="mi">11</span><span class="p">];</span>
<span class="p">}</span> <span class="n">asyport_t</span><span class="p">;</span>

<span class="cp">#define	PT_STOP1	0x0</span>
<span class="cp">#define	PT_STOP15	0x1</span>
<span class="cp">#define	PT_STOP2	0x2</span>

<span class="cp">#define	PT_NOPARITY	0x0</span>
<span class="cp">#define	PT_ODDPARITY	0x1</span>
<span class="cp">#define	PT_EVENPARITY	0x2</span>
<span class="cp">#define	PT_MARKPARITY	0x3</span>
<span class="cp">#define	PT_SPACEPARITY	0x4</span>

<span class="cp">#define	F_NONE		0x0</span>
<span class="cp">#define	F_IXON		0x1</span>
<span class="cp">#define	F_IXOFF		0x2</span>
<span class="cp">#define	F_IXANY		0x4</span>
<span class="cp">#define	F_IOXANY	0x8</span>
<span class="cp">#define	F_RTSFLOW	0x10</span>
<span class="cp">#define	F_CTSFLOW	0x20</span>
<span class="cp">#define	F_DTRFLOW	0x40</span>
<span class="cp">#define	F_DCDFLOW	0x80</span>
<span class="cp">#define	F_DSROFLOW	0x100</span>
<span class="cp">#define	F_DSRIFLOW	0x200</span>

<span class="cp">#define	FI_NORX		0x1</span>
<span class="cp">#define	FI_RAW		0x2</span>
<span class="cp">#define	FI_ISTRIP	0x4</span>
<span class="cp">#define	FI_UCLC		0x8</span>
<span class="cp">#define	FI_INLCR	0x10</span>
<span class="cp">#define	FI_ICRNL	0x20</span>
<span class="cp">#define	FI_IGNCR	0x40</span>
<span class="cp">#define	FI_IGNBREAK	0x80</span>
<span class="cp">#define	FI_DSCRDBREAK	0x100</span>
<span class="cp">#define	FI_1MARKBREAK	0x200</span>
<span class="cp">#define	FI_2MARKBREAK	0x400</span>
<span class="cp">#define	FI_XCHNGBREAK	0x800</span>
<span class="cp">#define	FI_IGNRXERRS	0x1000</span>
<span class="cp">#define	FI_DSCDRXERRS	0x2000</span>
<span class="cp">#define	FI_1MARKRXERRS	0x4000</span>
<span class="cp">#define	FI_2MARKRXERRS	0x8000</span>
<span class="cp">#define	FI_XCHNGRXERRS	0x10000</span>
<span class="cp">#define	FI_DSCRDNULL	0x20000</span>

<span class="cp">#define	FO_OLCUC	0x1</span>
<span class="cp">#define	FO_ONLCR	0x2</span>
<span class="cp">#define	FO_OOCRNL	0x4</span>
<span class="cp">#define	FO_ONOCR	0x8</span>
<span class="cp">#define	FO_ONLRET	0x10</span>
<span class="cp">#define	FO_ONL		0x20</span>
<span class="cp">#define	FO_OBS		0x40</span>
<span class="cp">#define	FO_OVT		0x80</span>
<span class="cp">#define	FO_OFF		0x100</span>
<span class="cp">#define	FO_OTAB1	0x200</span>
<span class="cp">#define	FO_OTAB2	0x400</span>
<span class="cp">#define	FO_OTAB3	0x800</span>
<span class="cp">#define	FO_OCR1		0x1000</span>
<span class="cp">#define	FO_OCR2		0x2000</span>
<span class="cp">#define	FO_OCR3		0x4000</span>
<span class="cp">#define	FO_OFILL	0x8000</span>
<span class="cp">#define	FO_ODELL	0x10000</span>

<span class="cp">#define	P_RTSLOCK	0x1</span>
<span class="cp">#define	P_CTSLOCK	0x2</span>
<span class="cp">#define	P_MAPRTS	0x4</span>
<span class="cp">#define	P_MAPCTS	0x8</span>
<span class="cp">#define	P_LOOPBACK	0x10</span>
<span class="cp">#define	P_DTRFOLLOW	0x20</span>
<span class="cp">#define	P_FAKEDCD	0x40</span>

<span class="cp">#define	P_RXIMIN	0x10000</span>
<span class="cp">#define	P_RXITIME	0x20000</span>
<span class="cp">#define	P_RXTHOLD	0x40000</span>

<span class="cm">/*</span>
<span class="cm"> *	Define a structure to communicate serial port signal and data state</span>
<span class="cm"> *	information.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">asysigs</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">signal</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">sigvalue</span><span class="p">;</span>
<span class="p">}</span> <span class="n">asysigs_t</span><span class="p">;</span>

<span class="cp">#define	DT_TXBUSY	0x1</span>
<span class="cp">#define	DT_TXEMPTY	0x2</span>
<span class="cp">#define	DT_TXLOW	0x4</span>
<span class="cp">#define	DT_TXHIGH	0x8</span>
<span class="cp">#define	DT_TXFULL	0x10</span>
<span class="cp">#define	DT_TXHOG	0x20</span>
<span class="cp">#define	DT_TXFLOWED	0x40</span>
<span class="cp">#define	DT_TXBREAK	0x80</span>

<span class="cp">#define	DT_RXBUSY	0x100</span>
<span class="cp">#define	DT_RXEMPTY	0x200</span>
<span class="cp">#define	DT_RXLOW	0x400</span>
<span class="cp">#define	DT_RXHIGH	0x800</span>
<span class="cp">#define	DT_RXFULL	0x1000</span>
<span class="cp">#define	DT_RXHOG	0x2000</span>
<span class="cp">#define	DT_RXFLOWED	0x4000</span>
<span class="cp">#define	DT_RXBREAK	0x8000</span>

<span class="cp">#define	SG_DTR		0x1</span>
<span class="cp">#define	SG_DCD		0x2</span>
<span class="cp">#define	SG_RTS		0x4</span>
<span class="cp">#define	SG_CTS		0x8</span>
<span class="cp">#define	SG_DSR		0x10</span>
<span class="cp">#define	SG_RI		0x20</span>

<span class="cm">/*</span>
<span class="cm"> *	Define the notification setting structure. This is used to tell the</span>
<span class="cm"> *	port what events we want to be informed about. Fields here use the</span>
<span class="cm"> *	same defines as for the asysigs structure above.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">asynotify</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">ctrl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">signal</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">sigvalue</span><span class="p">;</span>
<span class="p">}</span> <span class="n">asynotify_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> *	Define the port control structure. It is used to do fine grain</span>
<span class="cm"> *	control operations on the port.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rxctrl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">txctrl</span><span class="p">;</span>
	<span class="kt">char</span>		<span class="n">rximdch</span><span class="p">;</span>
	<span class="kt">char</span>		<span class="n">tximdch</span><span class="p">;</span>
	<span class="kt">char</span>		<span class="n">spare1</span><span class="p">;</span>
	<span class="kt">char</span>		<span class="n">spare2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">asyctrl_t</span><span class="p">;</span>

<span class="cp">#define	CT_ENABLE	0x1</span>
<span class="cp">#define	CT_DISABLE	0x2</span>
<span class="cp">#define	CT_STOP		0x4</span>
<span class="cp">#define	CT_START	0x8</span>
<span class="cp">#define	CT_STARTFLOW	0x10</span>
<span class="cp">#define	CT_STOPFLOW	0x20</span>
<span class="cp">#define	CT_SENDCHR	0x40</span>

<span class="cm">/*</span>
<span class="cm"> *	Define the stats structure kept for each port. This is a useful set</span>
<span class="cm"> *	of data collected for each port on the slave. The A_GETSTATS command</span>
<span class="cm"> *	is used to retrieve this data from the slave.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">asystats</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">opens</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">txchars</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rxchars</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">txringq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rxringq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">txmsgs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rxmsgs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">txflushes</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rxflushes</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">overruns</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">framing</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">parity</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">ringover</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">lost</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rxstart</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rxstop</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">txstart</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">txstop</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">dcdcnt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">dtrcnt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">ctscnt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rtscnt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">dsrcnt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">ricnt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">txbreaks</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">rxbreaks</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">signals</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">state</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">hwid</span><span class="p">;</span>
<span class="p">}</span> <span class="n">asystats_t</span><span class="p">;</span>

<span class="cm">/*****************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> *	All command and control communication with a device on the slave is</span>
<span class="cm"> *	via a control block in shared memory. Each device has its own control</span>
<span class="cm"> *	block, defined by the following structure. The control block allows</span>
<span class="cm"> *	the host to open, close and control the device on the slave.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">cdkctrl</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">open</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">close</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">openarg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">closearg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">cmd</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">status</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">args</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="p">}</span> <span class="n">cdkctrl_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> *	Each device on the slave passes data to and from the host via a ring</span>
<span class="cm"> *	queue in shared memory. Define a ring queue structure to hold the</span>
<span class="cm"> *	vital information about each ring queue. Two ring queues will be</span>
<span class="cm"> *	allocated for each port, one for receive data and one for transmit</span>
<span class="cm"> *	data.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">cdkasyrq</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">head</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">tail</span><span class="p">;</span>
<span class="p">}</span> <span class="n">cdkasyrq_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> *	Each asynchronous port is defined in shared memory by the following</span>
<span class="cm"> *	structure. It contains a control block to command a device, and also</span>
<span class="cm"> *	the necessary data channel information as well.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">cdkasy</span> <span class="p">{</span>
	<span class="n">cdkctrl_t</span>	<span class="n">ctrl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">notify</span><span class="p">;</span>
	<span class="n">asynotify_t</span>	<span class="n">changed</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">receive</span><span class="p">;</span>
	<span class="n">cdkasyrq_t</span>	<span class="n">rxq</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">transmit</span><span class="p">;</span>
	<span class="n">cdkasyrq_t</span>	<span class="n">txq</span><span class="p">;</span>
<span class="p">}</span> <span class="n">cdkasy_t</span><span class="p">;</span>

<span class="cp">#pragma	pack()</span>

<span class="cm">/*****************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> *	Define the set of ioctls used by the driver to do special things</span>
<span class="cm"> *	to the board. These include interrupting it, and initializing</span>
<span class="cm"> *	the driver after board startup and shutdown.</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/ioctl.h&gt;</span>

<span class="cp">#define	STL_BINTR	_IO(&#39;s&#39;,20)</span>
<span class="cp">#define	STL_BSTART	_IO(&#39;s&#39;,21)</span>
<span class="cp">#define	STL_BSTOP	_IO(&#39;s&#39;,22)</span>
<span class="cp">#define	STL_BRESET	_IO(&#39;s&#39;,23)</span>

<span class="cm">/*</span>
<span class="cm"> *	Define a set of ioctl extensions, used to get at special stuff.</span>
<span class="cm"> */</span>
<span class="cp">#define	STL_GETPFLAG	_IO(&#39;s&#39;,80)</span>
<span class="cp">#define	STL_SETPFLAG	_IO(&#39;s&#39;,81)</span>

<span class="cm">/*****************************************************************************/</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
