<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › isdn.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>isdn.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $Id: isdn.h,v 1.125.2.3 2004/02/10 01:07:14 keil Exp $</span>
<span class="cm"> *</span>
<span class="cm"> * Main header for the Linux ISDN subsystem (linklevel).</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 1994,95,96 by Fritz Elfert (fritz@isdn4linux.de)</span>
<span class="cm"> * Copyright 1995,96    by Thinking Objects Software GmbH Wuerzburg</span>
<span class="cm"> * Copyright 1995,96    by Michael Hipp (Michael.Hipp@student.uni-tuebingen.de)</span>
<span class="cm"> * </span>
<span class="cm"> * This software may be used and distributed according to the terms</span>
<span class="cm"> * of the GNU General Public License, incorporated herein by reference.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ISDN_H__</span>
<span class="cp">#define __ISDN_H__</span>

<span class="cp">#include &lt;linux/ioctl.h&gt;</span>
<span class="cp">#include &lt;linux/tty.h&gt;</span>

<span class="cp">#define ISDN_MAX_DRIVERS    32</span>
<span class="cp">#define ISDN_MAX_CHANNELS   64</span>

<span class="cm">/* New ioctl-codes */</span>
<span class="cp">#define IIOCNETAIF  _IO(&#39;I&#39;,1)</span>
<span class="cp">#define IIOCNETDIF  _IO(&#39;I&#39;,2)</span>
<span class="cp">#define IIOCNETSCF  _IO(&#39;I&#39;,3)</span>
<span class="cp">#define IIOCNETGCF  _IO(&#39;I&#39;,4)</span>
<span class="cp">#define IIOCNETANM  _IO(&#39;I&#39;,5)</span>
<span class="cp">#define IIOCNETDNM  _IO(&#39;I&#39;,6)</span>
<span class="cp">#define IIOCNETGNM  _IO(&#39;I&#39;,7)</span>
<span class="cp">#define IIOCGETSET  _IO(&#39;I&#39;,8) </span><span class="cm">/* no longer supported */</span><span class="cp"></span>
<span class="cp">#define IIOCSETSET  _IO(&#39;I&#39;,9) </span><span class="cm">/* no longer supported */</span><span class="cp"></span>
<span class="cp">#define IIOCSETVER  _IO(&#39;I&#39;,10)</span>
<span class="cp">#define IIOCNETHUP  _IO(&#39;I&#39;,11)</span>
<span class="cp">#define IIOCSETGST  _IO(&#39;I&#39;,12)</span>
<span class="cp">#define IIOCSETBRJ  _IO(&#39;I&#39;,13)</span>
<span class="cp">#define IIOCSIGPRF  _IO(&#39;I&#39;,14)</span>
<span class="cp">#define IIOCGETPRF  _IO(&#39;I&#39;,15)</span>
<span class="cp">#define IIOCSETPRF  _IO(&#39;I&#39;,16)</span>
<span class="cp">#define IIOCGETMAP  _IO(&#39;I&#39;,17)</span>
<span class="cp">#define IIOCSETMAP  _IO(&#39;I&#39;,18)</span>
<span class="cp">#define IIOCNETASL  _IO(&#39;I&#39;,19)</span>
<span class="cp">#define IIOCNETDIL  _IO(&#39;I&#39;,20)</span>
<span class="cp">#define IIOCGETCPS  _IO(&#39;I&#39;,21)</span>
<span class="cp">#define IIOCGETDVR  _IO(&#39;I&#39;,22)</span>
<span class="cp">#define IIOCNETLCR  _IO(&#39;I&#39;,23) </span><span class="cm">/* dwabc ioctl for LCR from isdnlog */</span><span class="cp"></span>
<span class="cp">#define IIOCNETDWRSET  _IO(&#39;I&#39;,24) </span><span class="cm">/* dwabc ioctl to reset abc-values to default on a net-interface */</span><span class="cp"></span>

<span class="cp">#define IIOCNETALN  _IO(&#39;I&#39;,32)</span>
<span class="cp">#define IIOCNETDLN  _IO(&#39;I&#39;,33)</span>

<span class="cp">#define IIOCNETGPN  _IO(&#39;I&#39;,34)</span>

<span class="cp">#define IIOCDBGVAR  _IO(&#39;I&#39;,127)</span>

<span class="cp">#define IIOCDRVCTL  _IO(&#39;I&#39;,128)</span>

<span class="cm">/* cisco hdlck device private ioctls */</span>
<span class="cp">#define SIOCGKEEPPERIOD	(SIOCDEVPRIVATE + 0)</span>
<span class="cp">#define SIOCSKEEPPERIOD	(SIOCDEVPRIVATE + 1)</span>
<span class="cp">#define SIOCGDEBSERINT	(SIOCDEVPRIVATE + 2)</span>
<span class="cp">#define SIOCSDEBSERINT	(SIOCDEVPRIVATE + 3)</span>

<span class="cm">/* Packet encapsulations for net-interfaces */</span>
<span class="cp">#define ISDN_NET_ENCAP_ETHER      0</span>
<span class="cp">#define ISDN_NET_ENCAP_RAWIP      1</span>
<span class="cp">#define ISDN_NET_ENCAP_IPTYP      2</span>
<span class="cp">#define ISDN_NET_ENCAP_CISCOHDLC  3 </span><span class="cm">/* Without SLARP and keepalive */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_ENCAP_SYNCPPP    4</span>
<span class="cp">#define ISDN_NET_ENCAP_UIHDLC     5</span>
<span class="cp">#define ISDN_NET_ENCAP_CISCOHDLCK 6 </span><span class="cm">/* With SLARP and keepalive    */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_ENCAP_X25IFACE   7 </span><span class="cm">/* Documentation/networking/x25-iface.txt */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_ENCAP_MAX_ENCAP  ISDN_NET_ENCAP_X25IFACE</span>

<span class="cm">/* Facility which currently uses an ISDN-channel */</span>
<span class="cp">#define ISDN_USAGE_NONE       0</span>
<span class="cp">#define ISDN_USAGE_RAW        1</span>
<span class="cp">#define ISDN_USAGE_MODEM      2</span>
<span class="cp">#define ISDN_USAGE_NET        3</span>
<span class="cp">#define ISDN_USAGE_VOICE      4</span>
<span class="cp">#define ISDN_USAGE_FAX        5</span>
<span class="cp">#define ISDN_USAGE_MASK       7 </span><span class="cm">/* Mask to get plain usage */</span><span class="cp"></span>
<span class="cp">#define ISDN_USAGE_DISABLED  32 </span><span class="cm">/* This bit is set, if channel is disabled */</span><span class="cp"></span>
<span class="cp">#define ISDN_USAGE_EXCLUSIVE 64 </span><span class="cm">/* This bit is set, if channel is exclusive */</span><span class="cp"></span>
<span class="cp">#define ISDN_USAGE_OUTGOING 128 </span><span class="cm">/* This bit is set, if channel is outgoing  */</span><span class="cp"></span>

<span class="cp">#define ISDN_MODEM_NUMREG    24        </span><span class="cm">/* Number of Modem-Registers        */</span><span class="cp"></span>
<span class="cp">#define ISDN_LMSNLEN         255 </span><span class="cm">/* Length of tty&#39;s Listen-MSN string */</span><span class="cp"></span>
<span class="cp">#define ISDN_CMSGLEN	     50	 </span><span class="cm">/* Length of CONNECT-Message to add for Modem */</span><span class="cp"></span>

<span class="cp">#define ISDN_MSNLEN          32</span>
<span class="cp">#define NET_DV 0x06  </span><span class="cm">/* Data version for isdn_net_ioctl_cfg   */</span><span class="cp"></span>
<span class="cp">#define TTY_DV 0x06  </span><span class="cm">/* Data version for iprofd etc.          */</span><span class="cp"></span>

<span class="cp">#define INF_DV 0x01  </span><span class="cm">/* Data version for /dev/isdninfo        */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">drvid</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>
  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">;</span>
<span class="p">}</span> <span class="n">isdn_ioctl_struct</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">phone</span><span class="p">[</span><span class="n">ISDN_MSNLEN</span><span class="p">];</span>
  <span class="kt">int</span>  <span class="n">outgoing</span><span class="p">;</span>
<span class="p">}</span> <span class="n">isdn_net_ioctl_phone</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>     <span class="cm">/* Name of interface                     */</span>
  <span class="kt">char</span> <span class="n">master</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>   <span class="cm">/* Name of Master for Bundling           */</span>
  <span class="kt">char</span> <span class="n">slave</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>    <span class="cm">/* Name of Slave for Bundling            */</span>
  <span class="kt">char</span> <span class="n">eaz</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>     <span class="cm">/* EAZ/MSN                               */</span>
  <span class="kt">char</span> <span class="n">drvid</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>    <span class="cm">/* DriverId for Bindings                 */</span>
  <span class="kt">int</span>  <span class="n">onhtime</span><span class="p">;</span>      <span class="cm">/* Hangup-Timeout                        */</span>
  <span class="kt">int</span>  <span class="n">charge</span><span class="p">;</span>       <span class="cm">/* Charge-Units                          */</span>
  <span class="kt">int</span>  <span class="n">l2_proto</span><span class="p">;</span>     <span class="cm">/* Layer-2 protocol                      */</span>
  <span class="kt">int</span>  <span class="n">l3_proto</span><span class="p">;</span>     <span class="cm">/* Layer-3 protocol                      */</span>
  <span class="kt">int</span>  <span class="n">p_encap</span><span class="p">;</span>      <span class="cm">/* Encapsulation                         */</span>
  <span class="kt">int</span>  <span class="n">exclusive</span><span class="p">;</span>    <span class="cm">/* Channel, if bound exclusive           */</span>
  <span class="kt">int</span>  <span class="n">dialmax</span><span class="p">;</span>      <span class="cm">/* Dial Retry-Counter                    */</span>
  <span class="kt">int</span>  <span class="n">slavedelay</span><span class="p">;</span>   <span class="cm">/* Delay until slave starts up           */</span>
  <span class="kt">int</span>  <span class="n">cbdelay</span><span class="p">;</span>      <span class="cm">/* Delay before Callback                 */</span>
  <span class="kt">int</span>  <span class="n">chargehup</span><span class="p">;</span>    <span class="cm">/* Flag: Charge-Hangup                   */</span>
  <span class="kt">int</span>  <span class="n">ihup</span><span class="p">;</span>         <span class="cm">/* Flag: Hangup-Timeout on incoming line */</span>
  <span class="kt">int</span>  <span class="n">secure</span><span class="p">;</span>       <span class="cm">/* Flag: Secure                          */</span>
  <span class="kt">int</span>  <span class="n">callback</span><span class="p">;</span>     <span class="cm">/* Flag: Callback                        */</span>
  <span class="kt">int</span>  <span class="n">cbhup</span><span class="p">;</span>        <span class="cm">/* Flag: Reject Call before Callback     */</span>
  <span class="kt">int</span>  <span class="n">pppbind</span><span class="p">;</span>      <span class="cm">/* ippp device for bindings              */</span>
  <span class="kt">int</span>  <span class="n">chargeint</span><span class="p">;</span>    <span class="cm">/* Use fixed charge interval length      */</span>
  <span class="kt">int</span>  <span class="n">triggercps</span><span class="p">;</span>   <span class="cm">/* BogoCPS needed for triggering slave   */</span>
  <span class="kt">int</span>  <span class="n">dialtimeout</span><span class="p">;</span>  <span class="cm">/* Dial-Timeout                          */</span>
  <span class="kt">int</span>  <span class="n">dialwait</span><span class="p">;</span>     <span class="cm">/* Time to wait after failed dial        */</span>
  <span class="kt">int</span>  <span class="n">dialmode</span><span class="p">;</span>     <span class="cm">/* Flag: off / on / auto                 */</span>
<span class="p">}</span> <span class="n">isdn_net_ioctl_cfg</span><span class="p">;</span>

<span class="cp">#define ISDN_NET_DIALMODE_MASK  0xC0    </span><span class="cm">/* bits for status                */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_DM_OFF	        0x00    </span><span class="cm">/* this interface is stopped      */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_DM_MANUAL	0x40    </span><span class="cm">/* this interface is on (manual)  */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_DM_AUTO	0x80    </span><span class="cm">/* this interface is autodial     */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_DIALMODE(x) ((&amp;(x))-&gt;flags &amp; ISDN_NET_DIALMODE_MASK)</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/fs.h&gt;</span>
<span class="cp">#include &lt;linux/major.h&gt;</span>
<span class="cp">#include &lt;asm/io.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/signal.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>
<span class="cp">#include &lt;linux/wait.h&gt;</span>
<span class="cp">#include &lt;linux/tty.h&gt;</span>
<span class="cp">#include &lt;linux/tty_flip.h&gt;</span>
<span class="cp">#include &lt;linux/serial_reg.h&gt;</span>
<span class="cp">#include &lt;linux/fcntl.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/ip.h&gt;</span>
<span class="cp">#include &lt;linux/in.h&gt;</span>
<span class="cp">#include &lt;linux/netdevice.h&gt;</span>
<span class="cp">#include &lt;linux/etherdevice.h&gt;</span>
<span class="cp">#include &lt;linux/skbuff.h&gt;</span>
<span class="cp">#include &lt;linux/tcp.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>

<span class="cp">#define ISDN_TTY_MAJOR    43</span>
<span class="cp">#define ISDN_TTYAUX_MAJOR 44</span>
<span class="cp">#define ISDN_MAJOR        45</span>

<span class="cm">/* The minor-devicenumbers for Channel 0 and 1 are used as arguments for</span>
<span class="cm"> * physical Channel-Mapping, so they MUST NOT be changed without changing</span>
<span class="cm"> * the correspondent code in isdn.c</span>
<span class="cm"> */</span>

<span class="cp">#define ISDN_MINOR_B        0</span>
<span class="cp">#define ISDN_MINOR_BMAX     (ISDN_MAX_CHANNELS-1)</span>
<span class="cp">#define ISDN_MINOR_CTRL     64</span>
<span class="cp">#define ISDN_MINOR_CTRLMAX  (64 + (ISDN_MAX_CHANNELS-1))</span>
<span class="cp">#define ISDN_MINOR_PPP      128</span>
<span class="cp">#define ISDN_MINOR_PPPMAX   (128 + (ISDN_MAX_CHANNELS-1))</span>
<span class="cp">#define ISDN_MINOR_STATUS   255</span>

<span class="cp">#ifdef CONFIG_ISDN_PPP</span>

<span class="cp">#ifdef CONFIG_ISDN_PPP_VJ</span>
<span class="cp">#  include &lt;net/slhc_vj.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#include &lt;linux/ppp_defs.h&gt;</span>
<span class="cp">#include &lt;linux/ppp-ioctl.h&gt;</span>

<span class="cp">#include &lt;linux/isdn_ppp.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_ISDN_X25</span>
<span class="cp">#  include &lt;linux/concap.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#include &lt;linux/isdnif.h&gt;</span>

<span class="cp">#define ISDN_DRVIOCTL_MASK       0x7f  </span><span class="cm">/* Mask for Device-ioctl */</span><span class="cp"></span>

<span class="cm">/* Until now unused */</span>
<span class="cp">#define ISDN_SERVICE_VOICE 1</span>
<span class="cp">#define ISDN_SERVICE_AB    1&lt;&lt;1 </span>
<span class="cp">#define ISDN_SERVICE_X21   1&lt;&lt;2</span>
<span class="cp">#define ISDN_SERVICE_G4    1&lt;&lt;3</span>
<span class="cp">#define ISDN_SERVICE_BTX   1&lt;&lt;4</span>
<span class="cp">#define ISDN_SERVICE_DFUE  1&lt;&lt;5</span>
<span class="cp">#define ISDN_SERVICE_X25   1&lt;&lt;6</span>
<span class="cp">#define ISDN_SERVICE_TTX   1&lt;&lt;7</span>
<span class="cp">#define ISDN_SERVICE_MIXED 1&lt;&lt;8</span>
<span class="cp">#define ISDN_SERVICE_FW    1&lt;&lt;9</span>
<span class="cp">#define ISDN_SERVICE_GTEL  1&lt;&lt;10</span>
<span class="cp">#define ISDN_SERVICE_BTXN  1&lt;&lt;11</span>
<span class="cp">#define ISDN_SERVICE_BTEL  1&lt;&lt;12</span>

<span class="cm">/* Macros checking plain usage */</span>
<span class="cp">#define USG_NONE(x)         ((x &amp; ISDN_USAGE_MASK)==ISDN_USAGE_NONE)</span>
<span class="cp">#define USG_RAW(x)          ((x &amp; ISDN_USAGE_MASK)==ISDN_USAGE_RAW)</span>
<span class="cp">#define USG_MODEM(x)        ((x &amp; ISDN_USAGE_MASK)==ISDN_USAGE_MODEM)</span>
<span class="cp">#define USG_VOICE(x)        ((x &amp; ISDN_USAGE_MASK)==ISDN_USAGE_VOICE)</span>
<span class="cp">#define USG_NET(x)          ((x &amp; ISDN_USAGE_MASK)==ISDN_USAGE_NET)</span>
<span class="cp">#define USG_FAX(x)          ((x &amp; ISDN_USAGE_MASK)==ISDN_USAGE_FAX)</span>
<span class="cp">#define USG_OUTGOING(x)     ((x &amp; ISDN_USAGE_OUTGOING)==ISDN_USAGE_OUTGOING)</span>
<span class="cp">#define USG_MODEMORVOICE(x) (((x &amp; ISDN_USAGE_MASK)==ISDN_USAGE_MODEM) || \</span>
<span class="cp">                             ((x &amp; ISDN_USAGE_MASK)==ISDN_USAGE_VOICE)     )</span>

<span class="cm">/* Timer-delays and scheduling-flags */</span>
<span class="cp">#define ISDN_TIMER_RES         4                         </span><span class="cm">/* Main Timer-Resolution   */</span><span class="cp"></span>
<span class="cp">#define ISDN_TIMER_02SEC       (HZ/ISDN_TIMER_RES/5)     </span><span class="cm">/* Slow-Timer1 .2 sec      */</span><span class="cp"></span>
<span class="cp">#define ISDN_TIMER_1SEC        (HZ/ISDN_TIMER_RES)       </span><span class="cm">/* Slow-Timer2 1 sec       */</span><span class="cp"></span>
<span class="cp">#define ISDN_TIMER_RINGING     5 </span><span class="cm">/* tty RINGs = ISDN_TIMER_1SEC * this factor       */</span><span class="cp"></span>
<span class="cp">#define ISDN_TIMER_KEEPINT    10 </span><span class="cm">/* Cisco-Keepalive = ISDN_TIMER_1SEC * this factor */</span><span class="cp"></span>
<span class="cp">#define ISDN_TIMER_MODEMREAD   1</span>
<span class="cp">#define ISDN_TIMER_MODEMPLUS   2</span>
<span class="cp">#define ISDN_TIMER_MODEMRING   4</span>
<span class="cp">#define ISDN_TIMER_MODEMXMIT   8</span>
<span class="cp">#define ISDN_TIMER_NETDIAL    16 </span>
<span class="cp">#define ISDN_TIMER_NETHANGUP  32</span>
<span class="cp">#define ISDN_TIMER_CARRIER   256 </span><span class="cm">/* Wait for Carrier */</span><span class="cp"></span>
<span class="cp">#define ISDN_TIMER_FAST      (ISDN_TIMER_MODEMREAD | ISDN_TIMER_MODEMPLUS | \</span>
<span class="cp">                              ISDN_TIMER_MODEMXMIT)</span>
<span class="cp">#define ISDN_TIMER_SLOW      (ISDN_TIMER_MODEMRING | ISDN_TIMER_NETHANGUP | \</span>
<span class="cp">                              ISDN_TIMER_NETDIAL | ISDN_TIMER_CARRIER)</span>

<span class="cm">/* Timeout-Values for isdn_net_dial() */</span>
<span class="cp">#define ISDN_TIMER_DTIMEOUT10 (10*HZ/(ISDN_TIMER_02SEC*(ISDN_TIMER_RES+1)))</span>
<span class="cp">#define ISDN_TIMER_DTIMEOUT15 (15*HZ/(ISDN_TIMER_02SEC*(ISDN_TIMER_RES+1)))</span>
<span class="cp">#define ISDN_TIMER_DTIMEOUT60 (60*HZ/(ISDN_TIMER_02SEC*(ISDN_TIMER_RES+1)))</span>

<span class="cm">/* GLOBAL_FLAGS */</span>
<span class="cp">#define ISDN_GLOBAL_STOPPED 1</span>

<span class="cm">/*=================== Start of ip-over-ISDN stuff =========================*/</span>

<span class="cm">/* Feature- and status-flags for a net-interface */</span>
<span class="cp">#define ISDN_NET_CONNECTED  0x01       </span><span class="cm">/* Bound to ISDN-Channel             */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_SECURE     0x02       </span><span class="cm">/* Accept calls from phonelist only  */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_CALLBACK   0x04       </span><span class="cm">/* activate callback                 */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_CBHUP      0x08       </span><span class="cm">/* hangup before callback            */</span><span class="cp"></span>
<span class="cp">#define ISDN_NET_CBOUT      0x10       </span><span class="cm">/* remote machine does callback      */</span><span class="cp"></span>

<span class="cp">#define ISDN_NET_MAGIC      0x49344C02 </span><span class="cm">/* for paranoia-checking             */</span><span class="cp"></span>

<span class="cm">/* Phone-list-element */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">num</span><span class="p">[</span><span class="n">ISDN_MSNLEN</span><span class="p">];</span>
<span class="p">}</span> <span class="n">isdn_net_phone</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm">   Principles when extending structures for generic encapsulation protocol</span>
<span class="cm">   (&quot;concap&quot;) support:</span>
<span class="cm">   - Stuff which is hardware specific (here i4l-specific) goes in </span>
<span class="cm">     the netdev -&gt; local structure (here: isdn_net_local)</span>
<span class="cm">   - Stuff which is encapsulation protocol specific goes in the structure</span>
<span class="cm">     which holds the linux device structure (here: isdn_net_device)</span>
<span class="cm">*/</span>

<span class="cm">/* Local interface-data */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">isdn_net_local_s</span> <span class="p">{</span>
  <span class="n">ulong</span>                  <span class="n">magic</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">net_device_stats</span> <span class="n">stats</span><span class="p">;</span>       <span class="cm">/* Ethernet Statistics              */</span>
  <span class="kt">int</span>                    <span class="n">isdn_device</span><span class="p">;</span>  <span class="cm">/* Index to isdn-device             */</span>
  <span class="kt">int</span>                    <span class="n">isdn_channel</span><span class="p">;</span> <span class="cm">/* Index to isdn-channel            */</span>
  <span class="kt">int</span>			 <span class="n">ppp_slot</span><span class="p">;</span>     <span class="cm">/* PPPD device slot number          */</span>
  <span class="kt">int</span>                    <span class="n">pre_device</span><span class="p">;</span>   <span class="cm">/* Preselected isdn-device          */</span>
  <span class="kt">int</span>                    <span class="n">pre_channel</span><span class="p">;</span>  <span class="cm">/* Preselected isdn-channel         */</span>
  <span class="kt">int</span>                    <span class="n">exclusive</span><span class="p">;</span>    <span class="cm">/* If non-zero idx to reserved chan.*/</span>
  <span class="kt">int</span>                    <span class="n">flags</span><span class="p">;</span>        <span class="cm">/* Connection-flags                 */</span>
  <span class="kt">int</span>                    <span class="n">dialretry</span><span class="p">;</span>    <span class="cm">/* Counter for Dialout-retries      */</span>
  <span class="kt">int</span>                    <span class="n">dialmax</span><span class="p">;</span>      <span class="cm">/* Max. Number of Dial-retries      */</span>
  <span class="kt">int</span>                    <span class="n">cbdelay</span><span class="p">;</span>      <span class="cm">/* Delay before Callback starts     */</span>
  <span class="kt">int</span>                    <span class="n">dtimer</span><span class="p">;</span>       <span class="cm">/* Timeout-counter for dialing      */</span>
  <span class="kt">char</span>                   <span class="n">msn</span><span class="p">[</span><span class="n">ISDN_MSNLEN</span><span class="p">];</span> <span class="cm">/* MSNs/EAZs for this interface */</span>
  <span class="n">u_char</span>                 <span class="n">cbhup</span><span class="p">;</span>        <span class="cm">/* Flag: Reject Call before Callback*/</span>
  <span class="n">u_char</span>                 <span class="n">dialstate</span><span class="p">;</span>    <span class="cm">/* State for dialing                */</span>
  <span class="n">u_char</span>                 <span class="n">p_encap</span><span class="p">;</span>      <span class="cm">/* Packet encapsulation             */</span>
                                       <span class="cm">/*   0 = Ethernet over ISDN         */</span>
				       <span class="cm">/*   1 = RAW-IP                     */</span>
                                       <span class="cm">/*   2 = IP with type field         */</span>
  <span class="n">u_char</span>                 <span class="n">l2_proto</span><span class="p">;</span>     <span class="cm">/* Layer-2-protocol                 */</span>
				       <span class="cm">/* See ISDN_PROTO_L2..-constants in */</span>
                                       <span class="cm">/* isdnif.h                         */</span>
                                       <span class="cm">/*   0 = X75/LAPB with I-Frames     */</span>
				       <span class="cm">/*   1 = X75/LAPB with UI-Frames    */</span>
				       <span class="cm">/*   2 = X75/LAPB with BUI-Frames   */</span>
				       <span class="cm">/*   3 = HDLC                       */</span>
  <span class="n">u_char</span>                 <span class="n">l3_proto</span><span class="p">;</span>     <span class="cm">/* Layer-3-protocol                 */</span>
				       <span class="cm">/* See ISDN_PROTO_L3..-constants in */</span>
                                       <span class="cm">/* isdnif.h                         */</span>
                                       <span class="cm">/*   0 = Transparent                */</span>
  <span class="kt">int</span>                    <span class="n">huptimer</span><span class="p">;</span>     <span class="cm">/* Timeout-counter for auto-hangup  */</span>
  <span class="kt">int</span>                    <span class="n">charge</span><span class="p">;</span>       <span class="cm">/* Counter for charging units       */</span>
  <span class="n">ulong</span>                  <span class="n">chargetime</span><span class="p">;</span>   <span class="cm">/* Timer for Charging info          */</span>
  <span class="kt">int</span>                    <span class="n">hupflags</span><span class="p">;</span>     <span class="cm">/* Flags for charge-unit-hangup:    */</span>
				       <span class="cm">/* bit0: chargeint is invalid       */</span>
				       <span class="cm">/* bit1: Getting charge-interval    */</span>
                                       <span class="cm">/* bit2: Do charge-unit-hangup      */</span>
                                       <span class="cm">/* bit3: Do hangup even on incoming */</span>
  <span class="kt">int</span>                    <span class="n">outgoing</span><span class="p">;</span>     <span class="cm">/* Flag: outgoing call              */</span>
  <span class="kt">int</span>                    <span class="n">onhtime</span><span class="p">;</span>      <span class="cm">/* Time to keep link up             */</span>
  <span class="kt">int</span>                    <span class="n">chargeint</span><span class="p">;</span>    <span class="cm">/* Interval between charge-infos    */</span>
  <span class="kt">int</span>                    <span class="n">onum</span><span class="p">;</span>         <span class="cm">/* Flag: at least 1 outgoing number */</span>
  <span class="kt">int</span>                    <span class="n">cps</span><span class="p">;</span>          <span class="cm">/* current speed of this interface  */</span>
  <span class="kt">int</span>                    <span class="n">transcount</span><span class="p">;</span>   <span class="cm">/* byte-counter for cps-calculation */</span>
  <span class="kt">int</span>                    <span class="n">sqfull</span><span class="p">;</span>       <span class="cm">/* Flag: netdev-queue overloaded    */</span>
  <span class="n">ulong</span>                  <span class="n">sqfull_stamp</span><span class="p">;</span> <span class="cm">/* Start-Time of overload           */</span>
  <span class="n">ulong</span>                  <span class="n">slavedelay</span><span class="p">;</span>   <span class="cm">/* Dynamic bundling delaytime       */</span>
  <span class="kt">int</span>                    <span class="n">triggercps</span><span class="p">;</span>   <span class="cm">/* BogoCPS needed for trigger slave */</span>
  <span class="n">isdn_net_phone</span>         <span class="o">*</span><span class="n">phone</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>    <span class="cm">/* List of remote-phonenumbers      */</span>
				       <span class="cm">/* phone[0] = Incoming Numbers      */</span>
				       <span class="cm">/* phone[1] = Outgoing Numbers      */</span>
  <span class="n">isdn_net_phone</span>         <span class="o">*</span><span class="n">dial</span><span class="p">;</span>        <span class="cm">/* Pointer to dialed number         */</span>
  <span class="k">struct</span> <span class="n">net_device</span>      <span class="o">*</span><span class="n">master</span><span class="p">;</span>      <span class="cm">/* Ptr to Master device for slaves  */</span>
  <span class="k">struct</span> <span class="n">net_device</span>      <span class="o">*</span><span class="n">slave</span><span class="p">;</span>       <span class="cm">/* Ptr to Slave device for masters  */</span>
  <span class="k">struct</span> <span class="n">isdn_net_local_s</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>       <span class="cm">/* Ptr to next link in bundle       */</span>
  <span class="k">struct</span> <span class="n">isdn_net_local_s</span> <span class="o">*</span><span class="n">last</span><span class="p">;</span>       <span class="cm">/* Ptr to last link in bundle       */</span>
  <span class="k">struct</span> <span class="n">isdn_net_dev_s</span>  <span class="o">*</span><span class="n">netdev</span><span class="p">;</span>      <span class="cm">/* Ptr to netdev                    */</span>
  <span class="k">struct</span> <span class="n">sk_buff_head</span>    <span class="n">super_tx_queue</span><span class="p">;</span> <span class="cm">/* List of supervisory frames to  */</span>
	                               <span class="cm">/* be transmitted asap              */</span>
  <span class="n">atomic_t</span> <span class="n">frame_cnt</span><span class="p">;</span>                  <span class="cm">/* number of frames currently       */</span>
                        	       <span class="cm">/* queued in HL driver              */</span>    
                                       <span class="cm">/* Ptr to orig. hard_header_cache   */</span>
  <span class="n">spinlock_t</span>             <span class="n">xmit_lock</span><span class="p">;</span>    <span class="cm">/* used to protect the xmit path of */</span>
                                       <span class="cm">/* a particular channel (including  */</span>
                                       <span class="cm">/* the frame_cnt                    */</span>

  <span class="kt">int</span>  <span class="n">pppbind</span><span class="p">;</span>                        <span class="cm">/* ippp device for bindings         */</span>
  <span class="kt">int</span>					<span class="n">dialtimeout</span><span class="p">;</span>	<span class="cm">/* How long shall we try on dialing? (jiffies) */</span>
  <span class="kt">int</span>					<span class="n">dialwait</span><span class="p">;</span>		<span class="cm">/* How long shall we wait after failed attempt? (jiffies) */</span>
  <span class="n">ulong</span>					<span class="n">dialstarted</span><span class="p">;</span>	<span class="cm">/* jiffies of first dialing-attempt */</span>
  <span class="n">ulong</span>					<span class="n">dialwait_timer</span><span class="p">;</span>	<span class="cm">/* jiffies of earliest next dialing-attempt */</span>
  <span class="kt">int</span>					<span class="n">huptimeout</span><span class="p">;</span>		<span class="cm">/* How long will the connection be up? (seconds) */</span>
<span class="cp">#ifdef CONFIG_ISDN_X25</span>
  <span class="k">struct</span> <span class="n">concap_device_ops</span> <span class="o">*</span><span class="n">dops</span><span class="p">;</span>      <span class="cm">/* callbacks used by encapsulator   */</span>
<span class="cp">#endif</span>
  <span class="cm">/* use an own struct for that in later versions */</span>
  <span class="n">ulong</span> <span class="n">cisco_myseq</span><span class="p">;</span>                   <span class="cm">/* Local keepalive seq. for Cisco   */</span>
  <span class="n">ulong</span> <span class="n">cisco_mineseen</span><span class="p">;</span>                <span class="cm">/* returned keepalive seq. from remote */</span>
  <span class="n">ulong</span> <span class="n">cisco_yourseq</span><span class="p">;</span>                 <span class="cm">/* Remote keepalive seq. for Cisco  */</span>
  <span class="kt">int</span> <span class="n">cisco_keepalive_period</span><span class="p">;</span>		<span class="cm">/* keepalive period */</span>
  <span class="n">ulong</span> <span class="n">cisco_last_slarp_in</span><span class="p">;</span>		<span class="cm">/* jiffie of last keepalive packet we received */</span>
  <span class="kt">char</span> <span class="n">cisco_line_state</span><span class="p">;</span>		<span class="cm">/* state of line according to keepalive packets */</span>
  <span class="kt">char</span> <span class="n">cisco_debserint</span><span class="p">;</span>			<span class="cm">/* debugging flag of cisco hdlc with slarp */</span>
  <span class="k">struct</span> <span class="n">timer_list</span> <span class="n">cisco_timer</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">work_struct</span> <span class="n">tqueue</span><span class="p">;</span>
<span class="p">}</span> <span class="n">isdn_net_local</span><span class="p">;</span>

<span class="cm">/* the interface itself */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">isdn_net_dev_s</span> <span class="p">{</span>
  <span class="n">isdn_net_local</span> <span class="o">*</span><span class="n">local</span><span class="p">;</span>
  <span class="n">isdn_net_local</span> <span class="o">*</span><span class="n">queue</span><span class="p">;</span>               <span class="cm">/* circular list of all bundled</span>
<span class="cm">					  channels, which are currently</span>
<span class="cm">					  online                           */</span>
  <span class="n">spinlock_t</span> <span class="n">queue_lock</span><span class="p">;</span>               <span class="cm">/* lock to protect queue            */</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>                          <span class="cm">/* Pointer to next isdn-interface   */</span>
  <span class="k">struct</span> <span class="n">net_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>              <span class="cm">/* interface to upper levels        */</span>
<span class="cp">#ifdef CONFIG_ISDN_PPP</span>
  <span class="n">ippp_bundle</span> <span class="o">*</span> <span class="n">pb</span><span class="p">;</span>		<span class="cm">/* pointer to the common bundle structure</span>
<span class="cm">   			         * with the per-bundle data */</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_ISDN_X25</span>
  <span class="k">struct</span> <span class="n">concap_proto</span>  <span class="o">*</span><span class="n">cprot</span><span class="p">;</span> <span class="cm">/* connection oriented encapsulation protocol */</span>
<span class="cp">#endif</span>

<span class="p">}</span> <span class="n">isdn_net_dev</span><span class="p">;</span>

<span class="cm">/*===================== End of ip-over-ISDN stuff ===========================*/</span>

<span class="cm">/*======================= Start of ISDN-tty stuff ===========================*/</span>

<span class="cp">#define ISDN_ASYNC_MAGIC          0x49344C01 </span><span class="cm">/* for paranoia-checking        */</span><span class="cp"></span>
<span class="cp">#define ISDN_SERIAL_XMIT_SIZE           1024 </span><span class="cm">/* Default bufsize for write    */</span><span class="cp"></span>
<span class="cp">#define ISDN_SERIAL_XMIT_MAX            4000 </span><span class="cm">/* Maximum bufsize for write    */</span><span class="cp"></span>

<span class="cp">#ifdef CONFIG_ISDN_AUDIO</span>
<span class="cm">/* For using sk_buffs with audio we need some private variables</span>
<span class="cm"> * within each sk_buff. For this purpose, we declare a struct here,</span>
<span class="cm"> * and put it always at the private skb-&gt;cb data array. A few macros help</span>
<span class="cm"> * accessing the variables.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_isdn_audio_data</span> <span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">dle_count</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">lock</span><span class="p">;</span>
<span class="p">}</span> <span class="n">isdn_audio_data_t</span><span class="p">;</span>

<span class="cp">#define ISDN_AUDIO_SKB_DLECOUNT(skb)	(((isdn_audio_data_t *)&amp;skb-&gt;cb[0])-&gt;dle_count)</span>
<span class="cp">#define ISDN_AUDIO_SKB_LOCK(skb)	(((isdn_audio_data_t *)&amp;skb-&gt;cb[0])-&gt;lock)</span>
<span class="cp">#endif</span>

<span class="cm">/* Private data of AT-command-interpreter */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">atemu</span> <span class="p">{</span>
	<span class="n">u_char</span>       <span class="n">profile</span><span class="p">[</span><span class="n">ISDN_MODEM_NUMREG</span><span class="p">];</span> <span class="cm">/* Modem-Regs. Profile 0              */</span>
	<span class="n">u_char</span>       <span class="n">mdmreg</span><span class="p">[</span><span class="n">ISDN_MODEM_NUMREG</span><span class="p">];</span>  <span class="cm">/* Modem-Registers                    */</span>
	<span class="kt">char</span>         <span class="n">pmsn</span><span class="p">[</span><span class="n">ISDN_MSNLEN</span><span class="p">];</span>          <span class="cm">/* EAZ/MSNs Profile 0                 */</span>
	<span class="kt">char</span>         <span class="n">msn</span><span class="p">[</span><span class="n">ISDN_MSNLEN</span><span class="p">];</span>           <span class="cm">/* EAZ/MSN                            */</span>
	<span class="kt">char</span>         <span class="n">plmsn</span><span class="p">[</span><span class="n">ISDN_LMSNLEN</span><span class="p">];</span>        <span class="cm">/* Listening MSNs Profile 0           */</span>
	<span class="kt">char</span>         <span class="n">lmsn</span><span class="p">[</span><span class="n">ISDN_LMSNLEN</span><span class="p">];</span>         <span class="cm">/* Listening MSNs                     */</span>
	<span class="kt">char</span>         <span class="n">cpn</span><span class="p">[</span><span class="n">ISDN_MSNLEN</span><span class="p">];</span>           <span class="cm">/* CalledPartyNumber on incoming call */</span>
	<span class="kt">char</span>         <span class="n">connmsg</span><span class="p">[</span><span class="n">ISDN_CMSGLEN</span><span class="p">];</span>	 <span class="cm">/* CONNECT-Msg from HL-Driver	       */</span>
<span class="cp">#ifdef CONFIG_ISDN_AUDIO</span>
	<span class="n">u_char</span>       <span class="n">vpar</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>                   <span class="cm">/* Voice-parameters                   */</span>
	<span class="kt">int</span>          <span class="n">lastDLE</span><span class="p">;</span>                    <span class="cm">/* Flag for voice-coding: DLE seen    */</span>
<span class="cp">#endif</span>
	<span class="kt">int</span>          <span class="n">mdmcmdl</span><span class="p">;</span>                    <span class="cm">/* Length of Modem-Commandbuffer      */</span>
	<span class="kt">int</span>          <span class="n">pluscount</span><span class="p">;</span>                  <span class="cm">/* Counter for +++ sequence           */</span>
	<span class="n">u_long</span>       <span class="n">lastplus</span><span class="p">;</span>                   <span class="cm">/* Timestamp of last +                */</span>
	<span class="kt">int</span>	     <span class="n">carrierwait</span><span class="p">;</span>                <span class="cm">/* Seconds of carrier waiting         */</span>
	<span class="kt">char</span>         <span class="n">mdmcmd</span><span class="p">[</span><span class="mi">255</span><span class="p">];</span>                <span class="cm">/* Modem-Commandbuffer                */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">charge</span><span class="p">;</span>                     <span class="cm">/* Charge units of current connection */</span>
<span class="p">}</span> <span class="n">atemu</span><span class="p">;</span>

<span class="cm">/* Private data (similar to async_struct in &lt;linux/serial.h&gt;) */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">modem_info</span> <span class="p">{</span>
  <span class="kt">int</span>			<span class="n">magic</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">tty_port</span>	<span class="n">port</span><span class="p">;</span>
  <span class="kt">int</span>			<span class="n">x_char</span><span class="p">;</span>		 <span class="cm">/* xon/xoff character             */</span>
  <span class="kt">int</span>			<span class="n">mcr</span><span class="p">;</span>		 <span class="cm">/* Modem control register         */</span>
  <span class="kt">int</span>                   <span class="n">msr</span><span class="p">;</span>             <span class="cm">/* Modem status register          */</span>
  <span class="kt">int</span>                   <span class="n">lsr</span><span class="p">;</span>             <span class="cm">/* Line status register           */</span>
  <span class="kt">int</span>			<span class="n">line</span><span class="p">;</span>
  <span class="kt">int</span>                   <span class="n">online</span><span class="p">;</span>          <span class="cm">/* 1 = B-Channel is up, drop data */</span>
					 <span class="cm">/* 2 = B-Channel is up, deliver d.*/</span>
  <span class="kt">int</span>                   <span class="n">dialing</span><span class="p">;</span>         <span class="cm">/* Dial in progress or ATA        */</span>
  <span class="kt">int</span>                   <span class="n">rcvsched</span><span class="p">;</span>        <span class="cm">/* Receive needs schedule         */</span>
  <span class="kt">int</span>                   <span class="n">isdn_driver</span><span class="p">;</span>	 <span class="cm">/* Index to isdn-driver           */</span>
  <span class="kt">int</span>                   <span class="n">isdn_channel</span><span class="p">;</span>    <span class="cm">/* Index to isdn-channel          */</span>
  <span class="kt">int</span>                   <span class="n">drv_index</span><span class="p">;</span>       <span class="cm">/* Index to dev-&gt;usage            */</span>
  <span class="kt">int</span>                   <span class="n">ncarrier</span><span class="p">;</span>        <span class="cm">/* Flag: schedule NO CARRIER      */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>         <span class="n">last_cause</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>   <span class="cm">/* Last cause message             */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>         <span class="n">last_num</span><span class="p">[</span><span class="n">ISDN_MSNLEN</span><span class="p">];</span>
	                                 <span class="cm">/* Last phone-number              */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>         <span class="n">last_l2</span><span class="p">;</span>         <span class="cm">/* Last layer-2 protocol          */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>         <span class="n">last_si</span><span class="p">;</span>         <span class="cm">/* Last service                   */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>         <span class="n">last_lhup</span><span class="p">;</span>       <span class="cm">/* Last hangup local?             */</span>
  <span class="kt">unsigned</span> <span class="kt">char</span>         <span class="n">last_dir</span><span class="p">;</span>        <span class="cm">/* Last direction (in or out)     */</span>
  <span class="k">struct</span> <span class="n">timer_list</span>     <span class="n">nc_timer</span><span class="p">;</span>        <span class="cm">/* Timer for delayed NO CARRIER   */</span>
  <span class="kt">int</span>                   <span class="n">send_outstanding</span><span class="p">;</span><span class="cm">/* # of outstanding send-requests */</span>
  <span class="kt">int</span>                   <span class="n">xmit_size</span><span class="p">;</span>       <span class="cm">/* max. # of chars in xmit_buf    */</span>
  <span class="kt">int</span>                   <span class="n">xmit_count</span><span class="p">;</span>      <span class="cm">/* # of chars in xmit_buf         */</span>
  <span class="k">struct</span> <span class="n">sk_buff_head</span>   <span class="n">xmit_queue</span><span class="p">;</span>      <span class="cm">/* transmit queue                 */</span>
  <span class="n">atomic_t</span>              <span class="n">xmit_lock</span><span class="p">;</span>       <span class="cm">/* Semaphore for isdn_tty_write   */</span>
<span class="cp">#ifdef CONFIG_ISDN_AUDIO</span>
  <span class="kt">int</span>                   <span class="n">vonline</span><span class="p">;</span>         <span class="cm">/* Voice-channel status           */</span>
					 <span class="cm">/* Bit 0 = recording              */</span>
					 <span class="cm">/* Bit 1 = playback               */</span>
					 <span class="cm">/* Bit 2 = playback, DLE-ETX seen */</span>
  <span class="k">struct</span> <span class="n">sk_buff_head</span>   <span class="n">dtmf_queue</span><span class="p">;</span>      <span class="cm">/* queue for dtmf results         */</span>
  <span class="kt">void</span>                  <span class="o">*</span><span class="n">adpcms</span><span class="p">;</span>         <span class="cm">/* state for adpcm decompression  */</span>
  <span class="kt">void</span>                  <span class="o">*</span><span class="n">adpcmr</span><span class="p">;</span>         <span class="cm">/* state for adpcm compression    */</span>
  <span class="kt">void</span>                  <span class="o">*</span><span class="n">dtmf_state</span><span class="p">;</span>     <span class="cm">/* state for dtmf decoder         */</span>
  <span class="kt">void</span>                  <span class="o">*</span><span class="n">silence_state</span><span class="p">;</span>  <span class="cm">/* state for silence detection    */</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_ISDN_TTY_FAX</span>
  <span class="k">struct</span> <span class="n">T30_s</span>		<span class="o">*</span><span class="n">fax</span><span class="p">;</span>		 <span class="cm">/* T30 Fax Group 3 data/interface */</span>
  <span class="kt">int</span>			<span class="n">faxonline</span><span class="p">;</span>	 <span class="cm">/* Fax-channel status             */</span>
<span class="cp">#endif</span>
  <span class="n">atemu</span>                 <span class="n">emu</span><span class="p">;</span>             <span class="cm">/* AT-emulator data               */</span>
  <span class="n">spinlock_t</span>	        <span class="n">readlock</span><span class="p">;</span>
<span class="p">}</span> <span class="n">modem_info</span><span class="p">;</span>

<span class="cp">#define ISDN_MODEM_WINSIZE 8</span>

<span class="cm">/* Description of one ISDN-tty */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_isdn_modem</span> <span class="p">{</span>
  <span class="kt">int</span>                <span class="n">refcount</span><span class="p">;</span>				<span class="cm">/* Number of opens        */</span>
  <span class="k">struct</span> <span class="n">tty_driver</span>  <span class="o">*</span><span class="n">tty_modem</span><span class="p">;</span>			<span class="cm">/* tty-device             */</span>
  <span class="k">struct</span> <span class="n">tty_struct</span>  <span class="o">*</span><span class="n">modem_table</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span>	<span class="cm">/* ?? copied from Orig    */</span>
  <span class="k">struct</span> <span class="n">ktermios</span>     <span class="o">*</span><span class="n">modem_termios</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span>
  <span class="k">struct</span> <span class="n">ktermios</span>     <span class="o">*</span><span class="n">modem_termios_locked</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span>
  <span class="n">modem_info</span>         <span class="n">info</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span>	   <span class="cm">/* Private data           */</span>
<span class="p">}</span> <span class="n">isdn_modem_t</span><span class="p">;</span>

<span class="cm">/*======================= End of ISDN-tty stuff ============================*/</span>

<span class="cm">/*======================== Start of V.110 stuff ============================*/</span>
<span class="cp">#define V110_BUFSIZE 1024</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">nbytes</span><span class="p">;</span>                    <span class="cm">/* 1 Matrixbyte -&gt; nbytes in stream     */</span>
	<span class="kt">int</span> <span class="n">nbits</span><span class="p">;</span>                     <span class="cm">/* Number of used bits in streambyte    */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">key</span><span class="p">;</span>             <span class="cm">/* Bitmask in stream eg. 11 (nbits=2)   */</span>
	<span class="kt">int</span> <span class="n">decodelen</span><span class="p">;</span>                 <span class="cm">/* Amount of data in decodebuf          */</span>
	<span class="kt">int</span> <span class="n">SyncInit</span><span class="p">;</span>                  <span class="cm">/* Number of sync frames to send        */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">OnlineFrame</span><span class="p">;</span>    <span class="cm">/* Precalculated V110 idle frame        */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">OfflineFrame</span><span class="p">;</span>   <span class="cm">/* Precalculated V110 sync Frame        */</span>
	<span class="kt">int</span> <span class="n">framelen</span><span class="p">;</span>                  <span class="cm">/* Length of frames                     */</span>
	<span class="kt">int</span> <span class="n">skbuser</span><span class="p">;</span>                   <span class="cm">/* Number of unacked userdata skbs      */</span>
	<span class="kt">int</span> <span class="n">skbidle</span><span class="p">;</span>                   <span class="cm">/* Number of unacked idle/sync skbs     */</span>
	<span class="kt">int</span> <span class="n">introducer</span><span class="p">;</span>                <span class="cm">/* Local vars for decoder               */</span>
	<span class="kt">int</span> <span class="n">dbit</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">skbres</span><span class="p">;</span>                    <span class="cm">/* space to reserve in outgoing skb     */</span>
	<span class="kt">int</span> <span class="n">maxsize</span><span class="p">;</span>                   <span class="cm">/* maxbufsize of lowlevel driver        */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">encodebuf</span><span class="p">;</span>      <span class="cm">/* temporary buffer for encoding        */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">decodebuf</span><span class="p">[</span><span class="n">V110_BUFSIZE</span><span class="p">];</span> <span class="cm">/* incomplete V110 matrices     */</span>
<span class="p">}</span> <span class="n">isdn_v110_stream</span><span class="p">;</span>

<span class="cm">/*========================= End of V.110 stuff =============================*/</span>

<span class="cm">/*======================= Start of general stuff ===========================*/</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">private</span><span class="p">;</span>
<span class="p">}</span> <span class="n">infostruct</span><span class="p">;</span>

<span class="cp">#define DRV_FLAG_RUNNING 1</span>
<span class="cp">#define DRV_FLAG_REJBUS  2</span>
<span class="cp">#define DRV_FLAG_LOADED  4</span>

<span class="cm">/* Description of hardware-level-driver */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_isdn_driver</span> <span class="p">{</span>
	<span class="n">ulong</span>               <span class="n">online</span><span class="p">;</span>           <span class="cm">/* Channel-Online flags             */</span>
	<span class="n">ulong</span>               <span class="n">flags</span><span class="p">;</span>            <span class="cm">/* Misc driver Flags                */</span>
	<span class="kt">int</span>                 <span class="n">locks</span><span class="p">;</span>            <span class="cm">/* Number of locks for this driver  */</span>
	<span class="kt">int</span>                 <span class="n">channels</span><span class="p">;</span>         <span class="cm">/* Number of channels               */</span>
	<span class="n">wait_queue_head_t</span>   <span class="n">st_waitq</span><span class="p">;</span>         <span class="cm">/* Wait-Queue for status-read&#39;s     */</span>
	<span class="kt">int</span>                 <span class="n">maxbufsize</span><span class="p">;</span>       <span class="cm">/* Maximum Buffersize supported     */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>       <span class="n">pktcount</span><span class="p">;</span>         <span class="cm">/* Until now: unused                */</span>
	<span class="kt">int</span>                 <span class="n">stavail</span><span class="p">;</span>          <span class="cm">/* Chars avail on Status-device     */</span>
	<span class="n">isdn_if</span>            <span class="o">*</span><span class="n">interface</span><span class="p">;</span>        <span class="cm">/* Interface to driver              */</span>
	<span class="kt">int</span>                <span class="o">*</span><span class="n">rcverr</span><span class="p">;</span>           <span class="cm">/* Error-counters for B-Ch.-receive */</span>
	<span class="kt">int</span>                <span class="o">*</span><span class="n">rcvcount</span><span class="p">;</span>         <span class="cm">/* Byte-counters for B-Ch.-receive  */</span>
<span class="cp">#ifdef CONFIG_ISDN_AUDIO</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>      <span class="n">DLEflag</span><span class="p">;</span>           <span class="cm">/* Flags: Insert DLE at next read   */</span>
<span class="cp">#endif</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="o">*</span><span class="n">rpqueue</span><span class="p">;</span>         <span class="cm">/* Pointers to start of Rcv-Queue   */</span>
	<span class="n">wait_queue_head_t</span>  <span class="o">*</span><span class="n">rcv_waitq</span><span class="p">;</span>       <span class="cm">/* Wait-Queues for B-Channel-Reads  */</span>
	<span class="n">wait_queue_head_t</span>  <span class="o">*</span><span class="n">snd_waitq</span><span class="p">;</span>       <span class="cm">/* Wait-Queue for B-Channel-Send&#39;s  */</span>
	<span class="kt">char</span>               <span class="n">msn2eaz</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="n">ISDN_MSNLEN</span><span class="p">];</span>  <span class="cm">/* Mapping-Table MSN-&gt;EAZ   */</span>
<span class="p">}</span> <span class="n">isdn_driver_t</span><span class="p">;</span>

<span class="cm">/* Main driver-data */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">isdn_devt</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">module</span>     <span class="o">*</span><span class="n">owner</span><span class="p">;</span>
	<span class="n">spinlock_t</span>	  <span class="n">lock</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>    <span class="n">flags</span><span class="p">;</span>		      <span class="cm">/* Bitmapped Flags:           */</span>
	<span class="kt">int</span>               <span class="n">drivers</span><span class="p">;</span>		      <span class="cm">/* Current number of drivers  */</span>
	<span class="kt">int</span>               <span class="n">channels</span><span class="p">;</span>		      <span class="cm">/* Current number of channels */</span>
	<span class="kt">int</span>               <span class="n">net_verbose</span><span class="p">;</span>                <span class="cm">/* Verbose-Flag               */</span>
	<span class="kt">int</span>               <span class="n">modempoll</span><span class="p">;</span>		      <span class="cm">/* Flag: tty-read active      */</span>
	<span class="n">spinlock_t</span>	  <span class="n">timerlock</span><span class="p">;</span>
	<span class="kt">int</span>               <span class="n">tflags</span><span class="p">;</span>                     <span class="cm">/* Timer-Flags:               */</span>
	<span class="cm">/*  see ISDN_TIMER_..defines  */</span>
	<span class="kt">int</span>               <span class="n">global_flags</span><span class="p">;</span>
	<span class="n">infostruct</span>        <span class="o">*</span><span class="n">infochain</span><span class="p">;</span>                 <span class="cm">/* List of open info-devs.    */</span>
	<span class="n">wait_queue_head_t</span> <span class="n">info_waitq</span><span class="p">;</span>                 <span class="cm">/* Wait-Queue for isdninfo    */</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">timer</span><span class="p">;</span>		      <span class="cm">/* Misc.-function Timer       */</span>
	<span class="kt">int</span>               <span class="n">chanmap</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span> <span class="cm">/* Map minor-&gt;device-channel  */</span>
	<span class="kt">int</span>               <span class="n">drvmap</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span>  <span class="cm">/* Map minor-&gt;driver-index    */</span>
	<span class="kt">int</span>               <span class="n">usage</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span>   <span class="cm">/* Used by tty/ip/voice       */</span>
	<span class="kt">char</span>              <span class="n">num</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">][</span><span class="n">ISDN_MSNLEN</span><span class="p">];</span>
	<span class="cm">/* Remote number of active ch.*/</span>
	<span class="kt">int</span>               <span class="n">m_idx</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span>   <span class="cm">/* Index for mdm....          */</span>
	<span class="n">isdn_driver_t</span>     <span class="o">*</span><span class="n">drv</span><span class="p">[</span><span class="n">ISDN_MAX_DRIVERS</span><span class="p">];</span>     <span class="cm">/* Array of drivers           */</span>
	<span class="n">isdn_net_dev</span>      <span class="o">*</span><span class="n">netdev</span><span class="p">;</span>		      <span class="cm">/* Linked list of net-if&#39;s    */</span>
	<span class="kt">char</span>              <span class="n">drvid</span><span class="p">[</span><span class="n">ISDN_MAX_DRIVERS</span><span class="p">][</span><span class="mi">20</span><span class="p">];</span><span class="cm">/* Driver-ID                 */</span>
	<span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">profd</span><span class="p">;</span>                    <span class="cm">/* For iprofd                 */</span>
	<span class="n">isdn_modem_t</span>      <span class="n">mdm</span><span class="p">;</span>			      <span class="cm">/* tty-driver-data            */</span>
	<span class="n">isdn_net_dev</span>      <span class="o">*</span><span class="n">rx_netdev</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span> <span class="cm">/* rx netdev-pointers     */</span>
	<span class="n">isdn_net_dev</span>      <span class="o">*</span><span class="n">st_netdev</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span> <span class="cm">/* stat netdev-pointers   */</span>
	<span class="n">ulong</span>             <span class="n">ibytes</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span>  <span class="cm">/* Statistics incoming bytes  */</span>
	<span class="n">ulong</span>             <span class="n">obytes</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span>  <span class="cm">/* Statistics outgoing bytes  */</span>
	<span class="kt">int</span>               <span class="n">v110emu</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span> <span class="cm">/* V.110 emulator-mode 0=none */</span>
	<span class="n">atomic_t</span>          <span class="n">v110use</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span> <span class="cm">/* Usage-Semaphore for stream */</span>
	<span class="n">isdn_v110_stream</span>  <span class="o">*</span><span class="n">v110</span><span class="p">[</span><span class="n">ISDN_MAX_CHANNELS</span><span class="p">];</span>   <span class="cm">/* V.110 private data         */</span>
	<span class="k">struct</span> <span class="n">mutex</span>      <span class="n">mtx</span><span class="p">;</span>                        <span class="cm">/* serialize list access*/</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>     <span class="n">global_features</span><span class="p">;</span>
<span class="p">}</span> <span class="n">isdn_dev</span><span class="p">;</span>

<span class="k">extern</span> <span class="n">isdn_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>


<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ISDN_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
