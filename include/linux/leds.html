<!DOCTYPE html>
<html><head><title>joekychen/linux » include › linux › leds.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>leds.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Driver model for leds and led triggers</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2005 John Lenz &lt;lenz@cs.wisc.edu&gt;</span>
<span class="cm"> * Copyright (C) 2005 Richard Purdie &lt;rpurdie@openedhand.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __LINUX_LEDS_H_INCLUDED</span>
<span class="cp">#define __LINUX_LEDS_H_INCLUDED</span>

<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/rwsem.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>

<span class="k">struct</span> <span class="n">device</span><span class="p">;</span>
<span class="cm">/*</span>
<span class="cm"> * LED Core</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="n">led_brightness</span> <span class="p">{</span>
	<span class="n">LED_OFF</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">LED_HALF</span>	<span class="o">=</span> <span class="mi">127</span><span class="p">,</span>
	<span class="n">LED_FULL</span>	<span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">led_classdev</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span>		<span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span>			 <span class="n">brightness</span><span class="p">;</span>
	<span class="kt">int</span>			 <span class="n">max_brightness</span><span class="p">;</span>
	<span class="kt">int</span>			 <span class="n">flags</span><span class="p">;</span>

	<span class="cm">/* Lower 16 bits reflect status */</span>
<span class="cp">#define LED_SUSPENDED		(1 &lt;&lt; 0)</span>
	<span class="cm">/* Upper 16 bits reflect control information */</span>
<span class="cp">#define LED_CORE_SUSPENDRESUME	(1 &lt;&lt; 16)</span>

	<span class="cm">/* Set LED brightness level */</span>
	<span class="cm">/* Must not sleep, use a workqueue if needed */</span>
	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">brightness_set</span><span class="p">)(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">,</span>
					  <span class="k">enum</span> <span class="n">led_brightness</span> <span class="n">brightness</span><span class="p">);</span>
	<span class="cm">/* Get LED brightness level */</span>
	<span class="k">enum</span> <span class="n">led_brightness</span> <span class="p">(</span><span class="o">*</span><span class="n">brightness_get</span><span class="p">)(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Activate hardware accelerated blink, delays are in milliseconds</span>
<span class="cm">	 * and if both are zero then a sensible default should be chosen.</span>
<span class="cm">	 * The call should adjust the timings in that case and if it can&#39;t</span>
<span class="cm">	 * match the values specified exactly.</span>
<span class="cm">	 * Deactivate blinking again when the brightness is set to a fixed</span>
<span class="cm">	 * value via the brightness_set() callback.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">blink_set</span><span class="p">)(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">,</span>
				     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">delay_on</span><span class="p">,</span>
				     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">delay_off</span><span class="p">);</span>

	<span class="k">struct</span> <span class="n">device</span>		<span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	 <span class="n">node</span><span class="p">;</span>			<span class="cm">/* LED Device list */</span>
	<span class="k">const</span> <span class="kt">char</span>		<span class="o">*</span><span class="n">default_trigger</span><span class="p">;</span>	<span class="cm">/* Trigger to use */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>		 <span class="n">blink_delay_on</span><span class="p">,</span> <span class="n">blink_delay_off</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span>	 <span class="n">blink_timer</span><span class="p">;</span>
	<span class="kt">int</span>			 <span class="n">blink_brightness</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_LEDS_TRIGGERS</span>
	<span class="cm">/* Protects the trigger data below */</span>
	<span class="k">struct</span> <span class="n">rw_semaphore</span>	 <span class="n">trigger_lock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">led_trigger</span>	<span class="o">*</span><span class="n">trigger</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	 <span class="n">trig_list</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">trigger_data</span><span class="p">;</span>
	<span class="cm">/* true if activated - deactivate routine uses it to do cleanup */</span>
	<span class="n">bool</span>			<span class="n">activated</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">led_classdev_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">led_classdev_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">led_classdev_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">led_classdev_resume</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * led_blink_set - set blinking with software fallback</span>
<span class="cm"> * @led_cdev: the LED to start blinking</span>
<span class="cm"> * @delay_on: the time it should be on (in ms)</span>
<span class="cm"> * @delay_off: the time it should ble off (in ms)</span>
<span class="cm"> *</span>
<span class="cm"> * This function makes the LED blink, attempting to use the</span>
<span class="cm"> * hardware acceleration if possible, but falling back to</span>
<span class="cm"> * software blinking if there is no hardware blinking or if</span>
<span class="cm"> * the LED refuses the passed values.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that if software blinking is active, simply calling</span>
<span class="cm"> * led_cdev-&gt;brightness_set() will not stop the blinking,</span>
<span class="cm"> * use led_classdev_brightness_set() instead.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">led_blink_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">,</span>
			  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">delay_on</span><span class="p">,</span>
			  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">delay_off</span><span class="p">);</span>
<span class="cm">/**</span>
<span class="cm"> * led_brightness_set - set LED brightness</span>
<span class="cm"> * @led_cdev: the LED to set</span>
<span class="cm"> * @brightness: the brightness to set it to</span>
<span class="cm"> *</span>
<span class="cm"> * Set an LED&#39;s brightness, and, if necessary, cancel the</span>
<span class="cm"> * software blink timer that implements blinking when the</span>
<span class="cm"> * hardware doesn&#39;t.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">led_brightness_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">,</span>
			       <span class="k">enum</span> <span class="n">led_brightness</span> <span class="n">brightness</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * LED Triggers</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_LEDS_TRIGGERS</span>

<span class="cp">#define TRIG_NAME_MAX 50</span>

<span class="k">struct</span> <span class="n">led_trigger</span> <span class="p">{</span>
	<span class="cm">/* Trigger Properties */</span>
	<span class="k">const</span> <span class="kt">char</span>	 <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">activate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">);</span>
	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">deactivate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">led_classdev</span> <span class="o">*</span><span class="n">led_cdev</span><span class="p">);</span>

	<span class="cm">/* LEDs under control by this trigger (for simple triggers) */</span>
	<span class="n">rwlock_t</span>	  <span class="n">leddev_list_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>  <span class="n">led_cdevs</span><span class="p">;</span>

	<span class="cm">/* Link to next registered trigger */</span>
	<span class="k">struct</span> <span class="n">list_head</span>  <span class="n">next_trig</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Registration functions for complex triggers */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">led_trigger_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_trigger</span> <span class="o">*</span><span class="n">trigger</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">led_trigger_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_trigger</span> <span class="o">*</span><span class="n">trigger</span><span class="p">);</span>

<span class="cm">/* Registration functions for simple triggers */</span>
<span class="cp">#define DEFINE_LED_TRIGGER(x)		static struct led_trigger *x;</span>
<span class="cp">#define DEFINE_LED_TRIGGER_GLOBAL(x)	struct led_trigger *x;</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">led_trigger_register_simple</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">led_trigger</span> <span class="o">**</span><span class="n">trigger</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">led_trigger_unregister_simple</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_trigger</span> <span class="o">*</span><span class="n">trigger</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">led_trigger_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_trigger</span> <span class="o">*</span><span class="n">trigger</span><span class="p">,</span>
				<span class="k">enum</span> <span class="n">led_brightness</span> <span class="n">event</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">led_trigger_blink</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_trigger</span> <span class="o">*</span><span class="n">trigger</span><span class="p">,</span>
			      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">delay_on</span><span class="p">,</span>
			      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">delay_off</span><span class="p">);</span>

<span class="cp">#else</span>

<span class="cm">/* Triggers aren&#39;t active - null macros */</span>
<span class="cp">#define DEFINE_LED_TRIGGER(x)</span>
<span class="cp">#define DEFINE_LED_TRIGGER_GLOBAL(x)</span>
<span class="cp">#define led_trigger_register_simple(x, y) do {} while(0)</span>
<span class="cp">#define led_trigger_unregister_simple(x) do {} while(0)</span>
<span class="cp">#define led_trigger_event(x, y) do {} while(0)</span>

<span class="cp">#endif</span>

<span class="cm">/* Trigger specific functions */</span>
<span class="cp">#ifdef CONFIG_LEDS_TRIGGER_IDE_DISK</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ledtrig_ide_activity</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define ledtrig_ide_activity() do {} while(0)</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Generic LED platform data for describing LED names and default triggers.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">led_info</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">default_trigger</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">led_platform_data</span> <span class="p">{</span>
	<span class="kt">int</span>		<span class="n">num_leds</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">led_info</span>	<span class="o">*</span><span class="n">leds</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* For the leds-gpio driver */</span>
<span class="k">struct</span> <span class="n">gpio_led</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">default_trigger</span><span class="p">;</span>
	<span class="kt">unsigned</span> 	<span class="n">gpio</span><span class="p">;</span>
	<span class="kt">unsigned</span>	<span class="n">active_low</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>	<span class="n">retain_state_suspended</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>	<span class="n">default_state</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="cm">/* default_state should be one of LEDS_GPIO_DEFSTATE_(ON|OFF|KEEP) */</span>
<span class="p">};</span>
<span class="cp">#define LEDS_GPIO_DEFSTATE_OFF		0</span>
<span class="cp">#define LEDS_GPIO_DEFSTATE_ON		1</span>
<span class="cp">#define LEDS_GPIO_DEFSTATE_KEEP		2</span>

<span class="k">struct</span> <span class="n">gpio_led_platform_data</span> <span class="p">{</span>
	<span class="kt">int</span> 		<span class="n">num_leds</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">gpio_led</span> <span class="o">*</span><span class="n">leds</span><span class="p">;</span>

<span class="cp">#define GPIO_LED_NO_BLINK_LOW	0	</span><span class="cm">/* No blink GPIO state low */</span><span class="cp"></span>
<span class="cp">#define GPIO_LED_NO_BLINK_HIGH	1	</span><span class="cm">/* No blink GPIO state high */</span><span class="cp"></span>
<span class="cp">#define GPIO_LED_BLINK		2	</span><span class="cm">/* Please, blink */</span><span class="cp"></span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">gpio_blink_set</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="n">gpio</span><span class="p">,</span> <span class="kt">int</span> <span class="n">state</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">delay_on</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">delay_off</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">gpio_led_register_device</span><span class="p">(</span>
		<span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">gpio_led_platform_data</span> <span class="o">*</span><span class="n">pdata</span><span class="p">);</span>

<span class="cp">#endif		</span><span class="cm">/* __LINUX_LEDS_H_INCLUDED */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
