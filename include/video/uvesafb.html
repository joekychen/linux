<!DOCTYPE html>
<html><head><title>joekychen/linux » include › video › uvesafb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>uvesafb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _UVESAFB_H</span>
<span class="cp">#define _UVESAFB_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="k">struct</span> <span class="n">v86_regs</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">ebx</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">ecx</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">edx</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">esi</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">edi</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">ebp</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">eax</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">eip</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">eflags</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">esp</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">cs</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">ss</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">es</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">ds</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">fs</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">gs</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Task flags */</span>
<span class="cp">#define TF_VBEIB	0x01</span>
<span class="cp">#define TF_BUF_ESDI	0x02</span>
<span class="cp">#define TF_BUF_ESBX	0x04</span>
<span class="cp">#define TF_BUF_RET	0x08</span>
<span class="cp">#define TF_EXIT		0x10</span>

<span class="k">struct</span> <span class="n">uvesafb_task</span> <span class="p">{</span>
	<span class="n">__u8</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">buf_len</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v86_regs</span> <span class="n">regs</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Constants for the capabilities field</span>
<span class="cm"> * in vbe_ib */</span>
<span class="cp">#define VBE_CAP_CAN_SWITCH_DAC	0x01</span>
<span class="cp">#define VBE_CAP_VGACOMPAT	0x02</span>

<span class="cm">/* The VBE Info Block */</span>
<span class="k">struct</span> <span class="n">vbe_ib</span> <span class="p">{</span>
	<span class="kt">char</span>  <span class="n">vbe_signature</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">__u16</span> <span class="n">vbe_version</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">oem_string_ptr</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">capabilities</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">mode_list_ptr</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">total_memory</span><span class="p">;</span>
	<span class="n">__u16</span> <span class="n">oem_software_rev</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">oem_vendor_name_ptr</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">oem_product_name_ptr</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">oem_product_rev_ptr</span><span class="p">;</span>
	<span class="n">__u8</span>  <span class="n">reserved</span><span class="p">[</span><span class="mi">222</span><span class="p">];</span>
	<span class="kt">char</span>  <span class="n">oem_data</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
	<span class="kt">char</span>  <span class="n">misc_data</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/* VBE CRTC Info Block */</span>
<span class="k">struct</span> <span class="n">vbe_crtc_ib</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">horiz_total</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">horiz_start</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">horiz_end</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">vert_total</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">vert_start</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">vert_end</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pixel_clock</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">refresh_rate</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">reserved</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define VBE_MODE_VGACOMPAT	0x20</span>
<span class="cp">#define VBE_MODE_COLOR		0x08</span>
<span class="cp">#define VBE_MODE_SUPPORTEDHW	0x01</span>
<span class="cp">#define VBE_MODE_GRAPHICS	0x10</span>
<span class="cp">#define VBE_MODE_LFB		0x80</span>

<span class="cp">#define VBE_MODE_MASK		(VBE_MODE_COLOR | VBE_MODE_SUPPORTEDHW | \</span>
<span class="cp">				VBE_MODE_GRAPHICS | VBE_MODE_LFB)</span>

<span class="cm">/* VBE Mode Info Block */</span>
<span class="k">struct</span> <span class="n">vbe_mode_ib</span> <span class="p">{</span>
	<span class="cm">/* for all VBE revisions */</span>
	<span class="n">u16</span> <span class="n">mode_attr</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">winA_attr</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">winB_attr</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">win_granularity</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">win_size</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">winA_seg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">winB_seg</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">win_func_ptr</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">bytes_per_scan_line</span><span class="p">;</span>

	<span class="cm">/* for VBE 1.2+ */</span>
	<span class="n">u16</span> <span class="n">x_res</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">y_res</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">x_char_size</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">y_char_size</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">planes</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">bits_per_pixel</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">banks</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">memory_model</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">bank_size</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">image_pages</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">reserved1</span><span class="p">;</span>

	<span class="cm">/* Direct color fields for direct/6 and YUV/7 memory models. */</span>
	<span class="cm">/* Offsets are bit positions of lsb in the mask. */</span>
	<span class="n">u8</span>  <span class="n">red_len</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">red_off</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">green_len</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">green_off</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">blue_len</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">blue_off</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">rsvd_len</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">rsvd_off</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">direct_color_info</span><span class="p">;</span>	<span class="cm">/* direct color mode attributes */</span>

	<span class="cm">/* for VBE 2.0+ */</span>
	<span class="n">u32</span> <span class="n">phys_base_ptr</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">reserved2</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>

	<span class="cm">/* for VBE 3.0+ */</span>
	<span class="n">u16</span> <span class="n">lin_bytes_per_scan_line</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">bnk_image_pages</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">lin_image_pages</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">lin_red_len</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">lin_red_off</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">lin_green_len</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">lin_green_off</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">lin_blue_len</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">lin_blue_off</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">lin_rsvd_len</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">lin_rsvd_off</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">max_pixel_clock</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">mode_id</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">depth</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define UVESAFB_DEFAULT_MODE &quot;640x480-16&quot;</span>

<span class="cm">/* How long to wait for a reply from userspace [ms] */</span>
<span class="cp">#define UVESAFB_TIMEOUT 5000</span>

<span class="cm">/* Max number of concurrent tasks */</span>
<span class="cp">#define UVESAFB_TASKS_MAX 16</span>

<span class="cp">#define dac_reg	(0x3c8)</span>
<span class="cp">#define dac_val	(0x3c9)</span>

<span class="k">struct</span> <span class="n">uvesafb_pal_entry</span> <span class="p">{</span>
	<span class="n">u_char</span> <span class="n">blue</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">red</span><span class="p">,</span> <span class="n">pad</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">uvesafb_ktask</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">uvesafb_task</span> <span class="n">t</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="o">*</span><span class="n">done</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ack</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">uvesafb_exec</span><span class="p">(</span><span class="k">struct</span> <span class="n">uvesafb_ktask</span> <span class="o">*</span><span class="n">tsk</span><span class="p">);</span>

<span class="cp">#define UVESAFB_EXACT_RES	1</span>
<span class="cp">#define UVESAFB_EXACT_DEPTH	2</span>

<span class="k">struct</span> <span class="n">uvesafb_par</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">vbe_ib</span> <span class="n">vbe_ib</span><span class="p">;</span>		<span class="cm">/* VBE Info Block */</span>
	<span class="k">struct</span> <span class="n">vbe_mode_ib</span> <span class="o">*</span><span class="n">vbe_modes</span><span class="p">;</span>	<span class="cm">/* list of supported VBE modes */</span>
	<span class="kt">int</span> <span class="n">vbe_modes_cnt</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">nocrtc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ypan</span><span class="p">;</span>			<span class="cm">/* 0 - nothing, 1 - ypan, 2 - ywrap */</span>
	<span class="n">u8</span> <span class="n">pmi_setpal</span><span class="p">;</span>			<span class="cm">/* PMI for palette changes */</span>
	<span class="n">u16</span> <span class="o">*</span><span class="n">pmi_base</span><span class="p">;</span>			<span class="cm">/* protected mode interface location */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">pmi_start</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">pmi_pal</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">vbe_state_orig</span><span class="p">;</span>		<span class="cm">/*</span>
<span class="cm">					 * original hardware state, before the</span>
<span class="cm">					 * driver was loaded</span>
<span class="cm">					 */</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">vbe_state_saved</span><span class="p">;</span>		<span class="cm">/* state saved by fb_save_state */</span>
	<span class="kt">int</span> <span class="n">vbe_state_size</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">ref_count</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">mode_idx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vbe_crtc_ib</span> <span class="n">crtc</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* _UVESAFB_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
