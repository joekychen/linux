<!DOCTYPE html>
<html><head><title>joekychen/linux » include › video › newport.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>newport.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* $Id: newport.h,v 1.5 1999/08/04 06:01:51 ulfc Exp $</span>
<span class="cm"> *</span>
<span class="cm"> * newport.h: Defines and register layout for NEWPORT graphics</span>
<span class="cm"> *            hardware.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1996 David S. Miller (davem@davemloft.net)</span>
<span class="cm"> * </span>
<span class="cm"> * Ulf Carlsson - Compatibility with the IRIX structures added</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _SGI_NEWPORT_H</span>
<span class="cp">#define _SGI_NEWPORT_H</span>


<span class="k">typedef</span> <span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">npireg_t</span><span class="p">;</span>

<span class="k">union</span> <span class="n">npfloat</span> <span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">float</span> <span class="n">flt</span><span class="p">;</span>
	<span class="n">npireg_t</span>       <span class="n">word</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">npfloat</span> <span class="n">npfreg_t</span><span class="p">;</span>

<span class="k">union</span> <span class="n">np_dcb</span> <span class="p">{</span>
	<span class="n">npireg_t</span> <span class="n">byword</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span> <span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">s0</span><span class="p">,</span> <span class="n">s1</span><span class="p">;</span> <span class="p">}</span> <span class="n">byshort</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span> <span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">;</span> <span class="p">}</span> <span class="n">bybytes</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">newport_rexregs</span> <span class="p">{</span>
	<span class="n">npireg_t</span> <span class="n">drawmode1</span><span class="p">;</span>      <span class="cm">/* GL extra mode bits */</span>
	
<span class="cp">#define DM1_PLANES         0x00000007</span>
<span class="cp">#define    DM1_NOPLANES    0x00000000</span>
<span class="cp">#define    DM1_RGBPLANES   0x00000001</span>
<span class="cp">#define    DM1_RGBAPLANES  0x00000002</span>
<span class="cp">#define    DM1_OLAYPLANES  0x00000004</span>
<span class="cp">#define    DM1_PUPPLANES   0x00000005</span>
<span class="cp">#define    DM1_CIDPLANES   0x00000006</span>
	
<span class="cp">#define NPORT_DMODE1_DDMASK      0x00000018</span>
<span class="cp">#define NPORT_DMODE1_DD4         0x00000000</span>
<span class="cp">#define NPORT_DMODE1_DD8         0x00000008</span>
<span class="cp">#define NPORT_DMODE1_DD12        0x00000010</span>
<span class="cp">#define NPORT_DMODE1_DD24        0x00000018</span>
<span class="cp">#define NPORT_DMODE1_DSRC        0x00000020</span>
<span class="cp">#define NPORT_DMODE1_YFLIP       0x00000040</span>
<span class="cp">#define NPORT_DMODE1_RWPCKD      0x00000080</span>
<span class="cp">#define NPORT_DMODE1_HDMASK      0x00000300</span>
<span class="cp">#define NPORT_DMODE1_HD4         0x00000000</span>
<span class="cp">#define NPORT_DMODE1_HD8         0x00000100</span>
<span class="cp">#define NPORT_DMODE1_HD12        0x00000200</span>
<span class="cp">#define NPORT_DMODE1_HD32        0x00000300</span>
<span class="cp">#define NPORT_DMODE1_RWDBL       0x00000400</span>
<span class="cp">#define NPORT_DMODE1_ESWAP       0x00000800 </span><span class="cm">/* Endian swap */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE1_CCMASK      0x00007000</span>
<span class="cp">#define NPORT_DMODE1_CCLT        0x00001000</span>
<span class="cp">#define NPORT_DMODE1_CCEQ        0x00002000</span>
<span class="cp">#define NPORT_DMODE1_CCGT        0x00004000</span>
<span class="cp">#define NPORT_DMODE1_RGBMD       0x00008000</span>
<span class="cp">#define NPORT_DMODE1_DENAB       0x00010000 </span><span class="cm">/* Dither enable */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE1_FCLR        0x00020000 </span><span class="cm">/* Fast clear */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE1_BENAB       0x00040000 </span><span class="cm">/* Blend enable */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE1_SFMASK      0x00380000</span>
<span class="cp">#define NPORT_DMODE1_SF0         0x00000000</span>
<span class="cp">#define NPORT_DMODE1_SF1         0x00080000</span>
<span class="cp">#define NPORT_DMODE1_SFDC        0x00100000</span>
<span class="cp">#define NPORT_DMODE1_SFMDC       0x00180000</span>
<span class="cp">#define NPORT_DMODE1_SFSA        0x00200000</span>
<span class="cp">#define NPORT_DMODE1_SFMSA       0x00280000</span>
<span class="cp">#define NPORT_DMODE1_DFMASK      0x01c00000</span>
<span class="cp">#define NPORT_DMODE1_DF0         0x00000000</span>
<span class="cp">#define NPORT_DMODE1_DF1         0x00400000</span>
<span class="cp">#define NPORT_DMODE1_DFSC        0x00800000</span>
<span class="cp">#define NPORT_DMODE1_DFMSC       0x00c00000</span>
<span class="cp">#define NPORT_DMODE1_DFSA        0x01000000</span>
<span class="cp">#define NPORT_DMODE1_DFMSA       0x01400000</span>
<span class="cp">#define NPORT_DMODE1_BBENAB      0x02000000 </span><span class="cm">/* Back blend enable */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE1_PFENAB      0x04000000 </span><span class="cm">/* Pre-fetch enable */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE1_ABLEND      0x08000000 </span><span class="cm">/* Alpha blend */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE1_LOMASK      0xf0000000</span>
<span class="cp">#define NPORT_DMODE1_LOZERO      0x00000000</span>
<span class="cp">#define NPORT_DMODE1_LOAND       0x10000000</span>
<span class="cp">#define NPORT_DMODE1_LOANDR      0x20000000</span>
<span class="cp">#define NPORT_DMODE1_LOSRC       0x30000000</span>
<span class="cp">#define NPORT_DMODE1_LOANDI      0x40000000</span>
<span class="cp">#define NPORT_DMODE1_LODST       0x50000000</span>
<span class="cp">#define NPORT_DMODE1_LOXOR       0x60000000</span>
<span class="cp">#define NPORT_DMODE1_LOOR        0x70000000</span>
<span class="cp">#define NPORT_DMODE1_LONOR       0x80000000</span>
<span class="cp">#define NPORT_DMODE1_LOXNOR      0x90000000</span>
<span class="cp">#define NPORT_DMODE1_LONDST      0xa0000000</span>
<span class="cp">#define NPORT_DMODE1_LOORR       0xb0000000</span>
<span class="cp">#define NPORT_DMODE1_LONSRC      0xc0000000</span>
<span class="cp">#define NPORT_DMODE1_LOORI       0xd0000000</span>
<span class="cp">#define NPORT_DMODE1_LONAND      0xe0000000</span>
<span class="cp">#define NPORT_DMODE1_LOONE       0xf0000000</span>

	<span class="n">npireg_t</span> <span class="n">drawmode0</span><span class="p">;</span>      <span class="cm">/* REX command register */</span>

	<span class="cm">/* These bits define the graphics opcode being performed. */</span>
<span class="cp">#define NPORT_DMODE0_OPMASK   0x00000003 </span><span class="cm">/* Opcode mask */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_NOP      0x00000000 </span><span class="cm">/* No operation */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_RD       0x00000001 </span><span class="cm">/* Read operation */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_DRAW     0x00000002 </span><span class="cm">/* Draw operation */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_S2S      0x00000003 </span><span class="cm">/* Screen to screen operation */</span><span class="cp"></span>

	<span class="cm">/* The following decide what addressing mode(s) are to be used */</span>
<span class="cp">#define NPORT_DMODE0_AMMASK   0x0000001c </span><span class="cm">/* Address mode mask */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_SPAN     0x00000000 </span><span class="cm">/* Spanning address mode */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_BLOCK    0x00000004 </span><span class="cm">/* Block address mode */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_ILINE    0x00000008 </span><span class="cm">/* Iline address mode */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_FLINE    0x0000000c </span><span class="cm">/* Fline address mode */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_ALINE    0x00000010 </span><span class="cm">/* Aline address mode */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_TLINE    0x00000014 </span><span class="cm">/* Tline address mode */</span><span class="cp"></span>
<span class="cp">#define NPORT_DMODE0_BLINE    0x00000018 </span><span class="cm">/* Bline address mode */</span><span class="cp"></span>

	<span class="cm">/* And now some misc. operation control bits. */</span>
<span class="cp">#define NPORT_DMODE0_DOSETUP  0x00000020</span>
<span class="cp">#define NPORT_DMODE0_CHOST    0x00000040</span>
<span class="cp">#define NPORT_DMODE0_AHOST    0x00000080</span>
<span class="cp">#define NPORT_DMODE0_STOPX    0x00000100</span>
<span class="cp">#define NPORT_DMODE0_STOPY    0x00000200</span>
<span class="cp">#define NPORT_DMODE0_SK1ST    0x00000400</span>
<span class="cp">#define NPORT_DMODE0_SKLST    0x00000800</span>
<span class="cp">#define NPORT_DMODE0_ZPENAB   0x00001000</span>
<span class="cp">#define NPORT_DMODE0_LISPENAB 0x00002000</span>
<span class="cp">#define NPORT_DMODE0_LISLST   0x00004000</span>
<span class="cp">#define NPORT_DMODE0_L32      0x00008000</span>
<span class="cp">#define NPORT_DMODE0_ZOPQ     0x00010000</span>
<span class="cp">#define NPORT_DMODE0_LISOPQ   0x00020000</span>
<span class="cp">#define NPORT_DMODE0_SHADE    0x00040000</span>
<span class="cp">#define NPORT_DMODE0_LRONLY   0x00080000</span>
<span class="cp">#define NPORT_DMODE0_XYOFF    0x00100000</span>
<span class="cp">#define NPORT_DMODE0_CLAMP    0x00200000</span>
<span class="cp">#define NPORT_DMODE0_ENDPF    0x00400000</span>
<span class="cp">#define NPORT_DMODE0_YSTR     0x00800000</span>

	<span class="n">npireg_t</span> <span class="n">lsmode</span><span class="p">;</span>      <span class="cm">/* Mode for line stipple ops */</span>
	<span class="n">npireg_t</span> <span class="n">lspattern</span><span class="p">;</span>   <span class="cm">/* Pattern for line stipple ops */</span>
	<span class="n">npireg_t</span> <span class="n">lspatsave</span><span class="p">;</span>   <span class="cm">/* Backup save pattern */</span>
	<span class="n">npireg_t</span> <span class="n">zpattern</span><span class="p">;</span>    <span class="cm">/* Pixel zpattern */</span>
	<span class="n">npireg_t</span> <span class="n">colorback</span><span class="p">;</span>   <span class="cm">/* Background color */</span>
	<span class="n">npireg_t</span> <span class="n">colorvram</span><span class="p">;</span>   <span class="cm">/* Clear color for fast vram */</span>
	<span class="n">npireg_t</span> <span class="n">alpharef</span><span class="p">;</span>    <span class="cm">/* Reference value for afunctions */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pad0</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">smask0x</span><span class="p">;</span>     <span class="cm">/* Window GL relative screen mask 0 */</span>
	<span class="n">npireg_t</span> <span class="n">smask0y</span><span class="p">;</span>     <span class="cm">/* Window GL relative screen mask 0 */</span>
	<span class="n">npireg_t</span> <span class="n">_setup</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">_stepz</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">_lsrestore</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">_lssave</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_pad1</span><span class="p">[</span><span class="mh">0x30</span><span class="p">];</span>

	<span class="cm">/* Iterators, full state for context switch */</span>
	<span class="n">npfreg_t</span> <span class="n">_xstart</span><span class="p">;</span>	<span class="cm">/* X-start point (current) */</span>
	<span class="n">npfreg_t</span> <span class="n">_ystart</span><span class="p">;</span>	<span class="cm">/* Y-start point (current) */</span>
	<span class="n">npfreg_t</span> <span class="n">_xend</span><span class="p">;</span>		<span class="cm">/* x-end point */</span>
	<span class="n">npfreg_t</span> <span class="n">_yend</span><span class="p">;</span>		<span class="cm">/* y-end point */</span>
	<span class="n">npireg_t</span> <span class="n">xsave</span><span class="p">;</span>		<span class="cm">/* copy of xstart integer value for BLOCk addressing MODE */</span>
	<span class="n">npireg_t</span> <span class="n">xymove</span><span class="p">;</span>	<span class="cm">/* x.y offset from xstart, ystart for relative operations */</span>
	<span class="n">npfreg_t</span> <span class="n">bresd</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">bress1</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">bresoctinc1</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="kt">int</span> <span class="n">bresrndinc2</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">brese1</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">bress2</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">aweight0</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">aweight1</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">xstartf</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">ystartf</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">xendf</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">yendf</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">xstarti</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">xendf1</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">xystarti</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">xyendi</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">xstartendi</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_unused2</span><span class="p">[</span><span class="mh">0x29</span><span class="p">];</span>

	<span class="n">npfreg_t</span> <span class="n">colorred</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">coloralpha</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">colorgrn</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">colorblue</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">slopered</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">slopealpha</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">slopegrn</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">slopeblue</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">wrmask</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">colori</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">colorx</span><span class="p">;</span>
	<span class="n">npfreg_t</span> <span class="n">slopered1</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">hostrw0</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">hostrw1</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">dcbmode</span><span class="p">;</span>
<span class="cp">#define NPORT_DMODE_WMASK   0x00000003</span>
<span class="cp">#define NPORT_DMODE_W4      0x00000000</span>
<span class="cp">#define NPORT_DMODE_W1      0x00000001</span>
<span class="cp">#define NPORT_DMODE_W2      0x00000002</span>
<span class="cp">#define NPORT_DMODE_W3      0x00000003</span>
<span class="cp">#define NPORT_DMODE_EDPACK  0x00000004</span>
<span class="cp">#define NPORT_DMODE_ECINC   0x00000008</span>
<span class="cp">#define NPORT_DMODE_CMASK   0x00000070</span>
<span class="cp">#define NPORT_DMODE_AMASK   0x00000780</span>
<span class="cp">#define NPORT_DMODE_AVC2    0x00000000</span>
<span class="cp">#define NPORT_DMODE_ACMALL  0x00000080</span>
<span class="cp">#define NPORT_DMODE_ACM0    0x00000100</span>
<span class="cp">#define NPORT_DMODE_ACM1    0x00000180</span>
<span class="cp">#define NPORT_DMODE_AXMALL  0x00000200</span>
<span class="cp">#define NPORT_DMODE_AXM0    0x00000280</span>
<span class="cp">#define NPORT_DMODE_AXM1    0x00000300</span>
<span class="cp">#define NPORT_DMODE_ABT     0x00000380</span>
<span class="cp">#define NPORT_DMODE_AVCC1   0x00000400</span>
<span class="cp">#define NPORT_DMODE_AVAB1   0x00000480</span>
<span class="cp">#define NPORT_DMODE_ALG3V0  0x00000500</span>
<span class="cp">#define NPORT_DMODE_A1562   0x00000580</span>
<span class="cp">#define NPORT_DMODE_ESACK   0x00000800</span>
<span class="cp">#define NPORT_DMODE_EASACK  0x00001000</span>
<span class="cp">#define NPORT_DMODE_CWMASK  0x0003e000</span>
<span class="cp">#define NPORT_DMODE_CHMASK  0x007c0000</span>
<span class="cp">#define NPORT_DMODE_CSMASK  0x0f800000</span>
<span class="cp">#define NPORT_DMODE_SENDIAN 0x10000000</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_unused3</span><span class="p">;</span>

	<span class="k">union</span> <span class="n">np_dcb</span> <span class="n">dcbdata0</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">dcbdata1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">newport_cregs</span> <span class="p">{</span>
	<span class="n">npireg_t</span> <span class="n">smask1x</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">smask1y</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">smask2x</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">smask2y</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">smask3x</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">smask3y</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">smask4x</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">smask4y</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">topscan</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">xywin</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">clipmode</span><span class="p">;</span>
<span class="cp">#define NPORT_CMODE_SM0   0x00000001</span>
<span class="cp">#define NPORT_CMODE_SM1   0x00000002</span>
<span class="cp">#define NPORT_CMODE_SM2   0x00000004</span>
<span class="cp">#define NPORT_CMODE_SM3   0x00000008</span>
<span class="cp">#define NPORT_CMODE_SM4   0x00000010</span>
<span class="cp">#define NPORT_CMODE_CMSK  0x00001e00</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_unused0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">config</span><span class="p">;</span>
<span class="cp">#define NPORT_CFG_G32MD   0x00000001</span>
<span class="cp">#define NPORT_CFG_BWIDTH  0x00000002</span>
<span class="cp">#define NPORT_CFG_ERCVR   0x00000004</span>
<span class="cp">#define NPORT_CFG_BDMSK   0x00000078</span>
<span class="cp">#define NPORT_CFG_BFAINT  0x00000080</span>
<span class="cp">#define NPORT_CFG_GDMSK   0x00001f80</span>
<span class="cp">#define NPORT_CFG_GD0     0x00000100</span>
<span class="cp">#define NPORT_CFG_GD1     0x00000200</span>
<span class="cp">#define NPORT_CFG_GD2     0x00000400</span>
<span class="cp">#define NPORT_CFG_GD3     0x00000800</span>
<span class="cp">#define NPORT_CFG_GD4     0x00001000</span>
<span class="cp">#define NPORT_CFG_GFAINT  0x00002000</span>
<span class="cp">#define NPORT_CFG_TOMSK   0x0001c000</span>
<span class="cp">#define NPORT_CFG_VRMSK   0x000e0000</span>
<span class="cp">#define NPORT_CFG_FBTYP   0x00100000</span>

	<span class="n">npireg_t</span> <span class="n">_unused1</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">status</span><span class="p">;</span>
<span class="cp">#define NPORT_STAT_VERS   0x00000007</span>
<span class="cp">#define NPORT_STAT_GBUSY  0x00000008</span>
<span class="cp">#define NPORT_STAT_BBUSY  0x00000010</span>
<span class="cp">#define NPORT_STAT_VRINT  0x00000020</span>
<span class="cp">#define NPORT_STAT_VIDINT 0x00000040</span>
<span class="cp">#define NPORT_STAT_GLMSK  0x00001f80</span>
<span class="cp">#define NPORT_STAT_BLMSK  0x0007e000</span>
<span class="cp">#define NPORT_STAT_BFIRQ  0x00080000</span>
<span class="cp">#define NPORT_STAT_GFIRQ  0x00100000</span>

	<span class="n">npireg_t</span> <span class="n">ustatus</span><span class="p">;</span>
	<span class="n">npireg_t</span> <span class="n">dcbreset</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">newport_regs</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">newport_rexregs</span> <span class="n">set</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_unused0</span><span class="p">[</span><span class="mh">0x16e</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">newport_rexregs</span> <span class="n">go</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_unused1</span><span class="p">[</span><span class="mh">0x22e</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">newport_cregs</span> <span class="n">cset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_unused2</span><span class="p">[</span><span class="mh">0x1ef</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">newport_cregs</span> <span class="n">cgo</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">drawmode1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">drawmode0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lsmode</span><span class="p">;</span>   
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lspattern</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lspatsave</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">zpattern</span><span class="p">;</span> 
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">colorback</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">colorvram</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">alpharef</span><span class="p">;</span> 
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smask0x</span><span class="p">;</span>  
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smask0y</span><span class="p">;</span>  
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_xstart</span><span class="p">;</span>  
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_ystart</span><span class="p">;</span>  
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_xend</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">_yend</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">xsave</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">xymove</span><span class="p">;</span>   
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bresd</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bress1</span><span class="p">;</span>   
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bresoctinc1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bresrndinc2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">brese1</span><span class="p">;</span>     
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bress2</span><span class="p">;</span>     
	
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">aweight0</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">aweight1</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">colorred</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">coloralpha</span><span class="p">;</span>  
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">colorgrn</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">colorblue</span><span class="p">;</span>   
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slopered</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slopealpha</span><span class="p">;</span>  
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slopegrn</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slopeblue</span><span class="p">;</span>   
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wrmask</span><span class="p">;</span>      
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hostrw0</span><span class="p">;</span>     
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hostrw1</span><span class="p">;</span>     
	
        <span class="cm">/* configregs */</span>
	
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smask1x</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smask1y</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smask2x</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smask2y</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smask3x</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smask3y</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smask4x</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">smask4y</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">topscan</span><span class="p">;</span>    
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">xywin</span><span class="p">;</span>      
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">clipmode</span><span class="p">;</span>   
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">config</span><span class="p">;</span>     
	
        <span class="cm">/* dcb registers */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dcbmode</span><span class="p">;</span>   
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dcbdata0</span><span class="p">;</span>  
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dcbdata1</span><span class="p">;</span>
<span class="p">}</span> <span class="n">newport_ctx</span><span class="p">;</span>

<span class="cm">/* Reading/writing VC2 registers. */</span>
<span class="cp">#define VC2_REGADDR_INDEX      0x00000000</span>
<span class="cp">#define VC2_REGADDR_IREG       0x00000010</span>
<span class="cp">#define VC2_REGADDR_RAM        0x00000030</span>
<span class="cp">#define VC2_PROTOCOL           (NPORT_DMODE_EASACK | 0x00800000 | 0x00040000)</span>

<span class="cp">#define VC2_VLINET_ADDR        0x000</span>
<span class="cp">#define VC2_VFRAMET_ADDR       0x400</span>
<span class="cp">#define VC2_CGLYPH_ADDR        0x500</span>

<span class="cm">/* Now the Indexed registers of the VC2. */</span>
<span class="cp">#define VC2_IREG_VENTRY        0x00</span>
<span class="cp">#define VC2_IREG_CENTRY        0x01</span>
<span class="cp">#define VC2_IREG_CURSX         0x02</span>
<span class="cp">#define VC2_IREG_CURSY         0x03</span>
<span class="cp">#define VC2_IREG_CCURSX        0x04</span>
<span class="cp">#define VC2_IREG_DENTRY        0x05</span>
<span class="cp">#define VC2_IREG_SLEN          0x06</span>
<span class="cp">#define VC2_IREG_RADDR         0x07</span>
<span class="cp">#define VC2_IREG_VFPTR         0x08</span>
<span class="cp">#define VC2_IREG_VLSPTR        0x09</span>
<span class="cp">#define VC2_IREG_VLIR          0x0a</span>
<span class="cp">#define VC2_IREG_VLCTR         0x0b</span>
<span class="cp">#define VC2_IREG_CTPTR         0x0c</span>
<span class="cp">#define VC2_IREG_WCURSY        0x0d</span>
<span class="cp">#define VC2_IREG_DFPTR         0x0e</span>
<span class="cp">#define VC2_IREG_DLTPTR        0x0f</span>
<span class="cp">#define VC2_IREG_CONTROL       0x10</span>
<span class="cp">#define VC2_IREG_CONFIG        0x20</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">newport_vc2_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">newport_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">vc2ireg</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbmode</span> <span class="o">=</span> <span class="p">(</span><span class="n">NPORT_DMODE_AVC2</span> <span class="o">|</span> <span class="n">VC2_REGADDR_INDEX</span> <span class="o">|</span> <span class="n">NPORT_DMODE_W3</span> <span class="o">|</span>
			   <span class="n">NPORT_DMODE_ECINC</span> <span class="o">|</span> <span class="n">VC2_PROTOCOL</span><span class="p">);</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbdata0</span><span class="p">.</span><span class="n">byword</span> <span class="o">=</span> <span class="p">(</span><span class="n">vc2ireg</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="nf">newport_vc2_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">newport_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
					     <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">vc2ireg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbmode</span> <span class="o">=</span> <span class="p">(</span><span class="n">NPORT_DMODE_AVC2</span> <span class="o">|</span> <span class="n">VC2_REGADDR_INDEX</span> <span class="o">|</span> <span class="n">NPORT_DMODE_W1</span> <span class="o">|</span>
			   <span class="n">NPORT_DMODE_ECINC</span> <span class="o">|</span> <span class="n">VC2_PROTOCOL</span><span class="p">);</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbdata0</span><span class="p">.</span><span class="n">bybytes</span><span class="p">.</span><span class="n">b3</span> <span class="o">=</span> <span class="n">vc2ireg</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbmode</span> <span class="o">=</span> <span class="p">(</span><span class="n">NPORT_DMODE_AVC2</span> <span class="o">|</span> <span class="n">VC2_REGADDR_IREG</span> <span class="o">|</span> <span class="n">NPORT_DMODE_W2</span> <span class="o">|</span>
			   <span class="n">NPORT_DMODE_ECINC</span> <span class="o">|</span> <span class="n">VC2_PROTOCOL</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbdata0</span><span class="p">.</span><span class="n">byshort</span><span class="p">.</span><span class="n">s1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* VC2 Control register bits */</span>
<span class="cp">#define VC2_CTRL_EVIRQ     0x0001</span>
<span class="cp">#define VC2_CTRL_EDISP     0x0002</span>
<span class="cp">#define VC2_CTRL_EVIDEO    0x0004</span>
<span class="cp">#define VC2_CTRL_EDIDS     0x0008</span>
<span class="cp">#define VC2_CTRL_ECURS     0x0010</span>
<span class="cp">#define VC2_CTRL_EGSYNC    0x0020</span>
<span class="cp">#define VC2_CTRL_EILACE    0x0040</span>
<span class="cp">#define VC2_CTRL_ECDISP    0x0080</span>
<span class="cp">#define VC2_CTRL_ECCURS    0x0100</span>
<span class="cp">#define VC2_CTRL_ECG64     0x0200</span>
<span class="cp">#define VC2_CTRL_GLSEL     0x0400</span>

<span class="cm">/* Controlling the color map on NEWPORT. */</span>
<span class="cp">#define NCMAP_REGADDR_AREG   0x00000000</span>
<span class="cp">#define NCMAP_REGADDR_ALO    0x00000000</span>
<span class="cp">#define NCMAP_REGADDR_AHI    0x00000010</span>
<span class="cp">#define NCMAP_REGADDR_PBUF   0x00000020</span>
<span class="cp">#define NCMAP_REGADDR_CREG   0x00000030</span>
<span class="cp">#define NCMAP_REGADDR_SREG   0x00000040</span>
<span class="cp">#define NCMAP_REGADDR_RREG   0x00000060</span>
<span class="cp">#define NCMAP_PROTOCOL       (0x00008000 | 0x00040000 | 0x00800000)</span>

<span class="k">static</span> <span class="n">__inline__</span> <span class="kt">void</span> <span class="nf">newport_cmap_setaddr</span><span class="p">(</span><span class="k">struct</span> <span class="n">newport_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbmode</span> <span class="o">=</span> <span class="p">(</span><span class="n">NPORT_DMODE_ACMALL</span> <span class="o">|</span> <span class="n">NCMAP_PROTOCOL</span> <span class="o">|</span>
			   <span class="n">NPORT_DMODE_SENDIAN</span> <span class="o">|</span> <span class="n">NPORT_DMODE_ECINC</span> <span class="o">|</span>
			   <span class="n">NCMAP_REGADDR_AREG</span> <span class="o">|</span> <span class="n">NPORT_DMODE_W2</span><span class="p">);</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbdata0</span><span class="p">.</span><span class="n">byshort</span><span class="p">.</span><span class="n">s1</span> <span class="o">=</span> <span class="n">addr</span><span class="p">;</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbmode</span> <span class="o">=</span> <span class="p">(</span><span class="n">NPORT_DMODE_ACMALL</span> <span class="o">|</span> <span class="n">NCMAP_PROTOCOL</span> <span class="o">|</span>
			   <span class="n">NCMAP_REGADDR_PBUF</span> <span class="o">|</span> <span class="n">NPORT_DMODE_W3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">__inline__</span> <span class="kt">void</span> <span class="nf">newport_cmap_setrgb</span><span class="p">(</span><span class="k">struct</span> <span class="n">newport_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">red</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">green</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">blue</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbdata0</span><span class="p">.</span><span class="n">byword</span> <span class="o">=</span>
		<span class="p">(</span><span class="n">red</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">green</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">blue</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Miscellaneous NEWPORT routines. */</span>
<span class="cp">#define BUSY_TIMEOUT 100000</span>
<span class="k">static</span> <span class="n">__inline__</span> <span class="kt">int</span> <span class="nf">newport_wait</span><span class="p">(</span><span class="k">struct</span> <span class="n">newport_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="n">BUSY_TIMEOUT</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">t</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">cset</span><span class="p">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">NPORT_STAT_GBUSY</span><span class="p">))</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">!</span><span class="n">t</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">__inline__</span> <span class="kt">int</span> <span class="nf">newport_bfwait</span><span class="p">(</span><span class="k">struct</span> <span class="n">newport_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">t</span> <span class="o">=</span> <span class="n">BUSY_TIMEOUT</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">t</span><span class="p">)</span>
		<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">cset</span><span class="p">.</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">NPORT_STAT_BBUSY</span><span class="p">))</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">!</span><span class="n">t</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * DCBMODE register defines:</span>
<span class="cm"> */</span>

<span class="cm">/* Width of the data being transferred for each DCBDATA[01] word */</span>
<span class="cp">#define DCB_DATAWIDTH_4 0x0</span>
<span class="cp">#define DCB_DATAWIDTH_1 0x1</span>
<span class="cp">#define DCB_DATAWIDTH_2 0x2</span>
<span class="cp">#define DCB_DATAWIDTH_3 0x3</span>

<span class="cm">/* If set, all of DCBDATA will be moved, otherwise only DATAWIDTH bytes */</span>
<span class="cp">#define DCB_ENDATAPACK   (1 &lt;&lt; 2)</span>

<span class="cm">/* Enables DCBCRS auto increment after each DCB transfer */</span>
<span class="cp">#define DCB_ENCRSINC     (1 &lt;&lt; 3)</span>

<span class="cm">/* shift for accessing the control register select address (DBCCRS, 3 bits) */</span>
<span class="cp">#define DCB_CRS_SHIFT    4</span>

<span class="cm">/* DCBADDR (4 bits): display bus slave address */</span>
<span class="cp">#define DCB_ADDR_SHIFT   7</span>
<span class="cp">#define DCB_VC2          (0 &lt;&lt;  DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_CMAP_ALL     (1 &lt;&lt;  DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_CMAP0        (2 &lt;&lt;  DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_CMAP1        (3 &lt;&lt;  DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_XMAP_ALL     (4 &lt;&lt;  DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_XMAP0        (5 &lt;&lt;  DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_XMAP1        (6 &lt;&lt;  DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_BT445        (7 &lt;&lt;  DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_VCC1         (8 &lt;&lt;  DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_VAB1         (9 &lt;&lt;  DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_LG3_BDVERS0  (10 &lt;&lt; DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_LG3_ICS1562  (11 &lt;&lt; DCB_ADDR_SHIFT)</span>
<span class="cp">#define DCB_RESERVED     (15 &lt;&lt; DCB_ADDR_SHIFT)</span>

<span class="cm">/* DCB protocol ack types */</span>
<span class="cp">#define DCB_ENSYNCACK    (1 &lt;&lt; 11)</span>
<span class="cp">#define DCB_ENASYNCACK   (1 &lt;&lt; 12)</span>

<span class="cp">#define DCB_CSWIDTH_SHIFT 13</span>
<span class="cp">#define DCB_CSHOLD_SHIFT  18</span>
<span class="cp">#define DCB_CSSETUP_SHIFT 23</span>

<span class="cm">/* XMAP9 specific defines */</span>
<span class="cm">/*   XMAP9 -- registers as seen on the DCBMODE register*/</span>
<span class="cp">#   define XM9_CRS_CONFIG            (0 &lt;&lt; DCB_CRS_SHIFT)</span>
<span class="cp">#       define XM9_PUPMODE           (1 &lt;&lt; 0)</span>
<span class="cp">#       define XM9_ODD_PIXEL         (1 &lt;&lt; 1)</span>
<span class="cp">#       define XM9_8_BITPLANES       (1 &lt;&lt; 2)</span>
<span class="cp">#       define XM9_SLOW_DCB          (1 &lt;&lt; 3)</span>
<span class="cp">#       define XM9_VIDEO_RGBMAP_MASK (3 &lt;&lt; 4)</span>
<span class="cp">#       define XM9_EXPRESS_VIDEO     (1 &lt;&lt; 6)</span>
<span class="cp">#       define XM9_VIDEO_OPTION      (1 &lt;&lt; 7)</span>
<span class="cp">#   define XM9_CRS_REVISION          (1 &lt;&lt; DCB_CRS_SHIFT)</span>
<span class="cp">#   define XM9_CRS_FIFO_AVAIL        (2 &lt;&lt; DCB_CRS_SHIFT)</span>
<span class="cp">#       define XM9_FIFO_0_AVAIL      0</span>
<span class="cp">#       define XM9_FIFO_1_AVAIL      1</span>
<span class="cp">#       define XM9_FIFO_2_AVAIL      3</span>
<span class="cp">#       define XM9_FIFO_3_AVAIL      2</span>
<span class="cp">#       define XM9_FIFO_FULL         XM9_FIFO_0_AVAIL</span>
<span class="cp">#       define XM9_FIFO_EMPTY        XM9_FIFO_3_AVAIL</span>
<span class="cp">#   define XM9_CRS_CURS_CMAP_MSB     (3 &lt;&lt; DCB_CRS_SHIFT)</span>
<span class="cp">#   define XM9_CRS_PUP_CMAP_MSB      (4 &lt;&lt; DCB_CRS_SHIFT)</span>
<span class="cp">#   define XM9_CRS_MODE_REG_DATA     (5 &lt;&lt; DCB_CRS_SHIFT)</span>
<span class="cp">#   define XM9_CRS_MODE_REG_INDEX    (7 &lt;&lt; DCB_CRS_SHIFT)</span>


<span class="cp">#define DCB_CYCLES(setup,hold,width)                \</span>
<span class="cp">                  ((hold &lt;&lt; DCB_CSHOLD_SHIFT)  |    \</span>
<span class="cp">		   (setup &lt;&lt; DCB_CSSETUP_SHIFT)|    \</span>
<span class="cp">		   (width &lt;&lt; DCB_CSWIDTH_SHIFT))</span>

<span class="cp">#define W_DCB_XMAP9_PROTOCOL       DCB_CYCLES (2, 1, 0)</span>
<span class="cp">#define WSLOW_DCB_XMAP9_PROTOCOL   DCB_CYCLES (5, 5, 0)</span>
<span class="cp">#define WAYSLOW_DCB_XMAP9_PROTOCOL DCB_CYCLES (12, 12, 0)</span>
<span class="cp">#define R_DCB_XMAP9_PROTOCOL       DCB_CYCLES (2, 1, 3)</span>

<span class="k">static</span> <span class="n">__inline__</span> <span class="kt">void</span>
<span class="nf">xmap9FIFOWait</span> <span class="p">(</span><span class="k">struct</span> <span class="n">newport_regs</span> <span class="o">*</span><span class="n">rex</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">rex</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbmode</span> <span class="o">=</span> <span class="n">DCB_XMAP0</span> <span class="o">|</span> <span class="n">XM9_CRS_FIFO_AVAIL</span> <span class="o">|</span>
		<span class="n">DCB_DATAWIDTH_1</span> <span class="o">|</span> <span class="n">R_DCB_XMAP9_PROTOCOL</span><span class="p">;</span>
        <span class="n">newport_bfwait</span> <span class="p">(</span><span class="n">rex</span><span class="p">);</span>
	
        <span class="k">while</span> <span class="p">((</span><span class="n">rex</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbdata0</span><span class="p">.</span><span class="n">bybytes</span><span class="p">.</span><span class="n">b3</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">!=</span> <span class="n">XM9_FIFO_EMPTY</span><span class="p">)</span>
		<span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">__inline__</span> <span class="kt">void</span>
<span class="nf">xmap9SetModeReg</span> <span class="p">(</span><span class="k">struct</span> <span class="n">newport_regs</span> <span class="o">*</span><span class="n">rex</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">modereg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data24</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cfreq</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">cfreq</span> <span class="o">&gt;</span> <span class="mi">119</span><span class="p">)</span>
            <span class="n">rex</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbmode</span> <span class="o">=</span> <span class="n">DCB_XMAP_ALL</span> <span class="o">|</span> <span class="n">XM9_CRS_MODE_REG_DATA</span> <span class="o">|</span>
                        <span class="n">DCB_DATAWIDTH_4</span> <span class="o">|</span> <span class="n">W_DCB_XMAP9_PROTOCOL</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">cfreq</span> <span class="o">&gt;</span> <span class="mi">59</span><span class="p">)</span>
            <span class="n">rex</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbmode</span> <span class="o">=</span> <span class="n">DCB_XMAP_ALL</span> <span class="o">|</span> <span class="n">XM9_CRS_MODE_REG_DATA</span> <span class="o">|</span>
		    <span class="n">DCB_DATAWIDTH_4</span> <span class="o">|</span> <span class="n">WSLOW_DCB_XMAP9_PROTOCOL</span><span class="p">;</span>    
        <span class="k">else</span>
            <span class="n">rex</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbmode</span> <span class="o">=</span> <span class="n">DCB_XMAP_ALL</span> <span class="o">|</span> <span class="n">XM9_CRS_MODE_REG_DATA</span> <span class="o">|</span>
                        <span class="n">DCB_DATAWIDTH_4</span> <span class="o">|</span> <span class="n">WAYSLOW_DCB_XMAP9_PROTOCOL</span><span class="p">;</span> 
        <span class="n">rex</span><span class="o">-&gt;</span><span class="n">set</span><span class="p">.</span><span class="n">dcbdata0</span><span class="p">.</span><span class="n">byword</span> <span class="o">=</span> <span class="p">((</span><span class="n">modereg</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data24</span> <span class="o">&amp;</span> <span class="mh">0xffffff</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define BT445_PROTOCOL		DCB_CYCLES(1,1,3)</span>

<span class="cp">#define BT445_CSR_ADDR_REG	(0 &lt;&lt; DCB_CRS_SHIFT)</span>
<span class="cp">#define BT445_CSR_REVISION	(2 &lt;&lt; DCB_CRS_SHIFT)</span>

<span class="cp">#define BT445_REVISION_REG	0x01</span>

<span class="cp">#endif </span><span class="cm">/* !(_SGI_NEWPORT_H) */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
