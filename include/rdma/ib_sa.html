<!DOCTYPE html>
<html><head><title>joekychen/linux » include › rdma › ib_sa.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>ib_sa.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2004 Topspin Communications.  All rights reserved.</span>
<span class="cm"> * Copyright (c) 2005 Voltaire, Inc.  All rights reserved.</span>
<span class="cm"> * Copyright (c) 2006 Intel Corporation.  All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is available to you under a choice of one of two</span>
<span class="cm"> * licenses.  You may choose to be licensed under the terms of the GNU</span>
<span class="cm"> * General Public License (GPL) Version 2, available from the file</span>
<span class="cm"> * COPYING in the main directory of this source tree, or the</span>
<span class="cm"> * OpenIB.org BSD license below:</span>
<span class="cm"> *</span>
<span class="cm"> *     Redistribution and use in source and binary forms, with or</span>
<span class="cm"> *     without modification, are permitted provided that the following</span>
<span class="cm"> *     conditions are met:</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions of source code must retain the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer.</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions in binary form must reproduce the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer in the documentation and/or other materials</span>
<span class="cm"> *        provided with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="cm"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="cm"> * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<span class="cm"> * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef IB_SA_H</span>
<span class="cp">#define IB_SA_H</span>

<span class="cp">#include &lt;linux/completion.h&gt;</span>
<span class="cp">#include &lt;linux/compiler.h&gt;</span>

<span class="cp">#include &lt;linux/atomic.h&gt;</span>

<span class="cp">#include &lt;rdma/ib_verbs.h&gt;</span>
<span class="cp">#include &lt;rdma/ib_mad.h&gt;</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">IB_SA_CLASS_VERSION</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* IB spec version 1.1/1.2 */</span>

	<span class="n">IB_SA_METHOD_GET_TABLE</span>		<span class="o">=</span> <span class="mh">0x12</span><span class="p">,</span>
	<span class="n">IB_SA_METHOD_GET_TABLE_RESP</span>	<span class="o">=</span> <span class="mh">0x92</span><span class="p">,</span>
	<span class="n">IB_SA_METHOD_DELETE</span>		<span class="o">=</span> <span class="mh">0x15</span><span class="p">,</span>
	<span class="n">IB_SA_METHOD_DELETE_RESP</span>	<span class="o">=</span> <span class="mh">0x95</span><span class="p">,</span>
	<span class="n">IB_SA_METHOD_GET_MULTI</span>		<span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>
	<span class="n">IB_SA_METHOD_GET_MULTI_RESP</span>	<span class="o">=</span> <span class="mh">0x94</span><span class="p">,</span>
	<span class="n">IB_SA_METHOD_GET_TRACE_TBL</span>	<span class="o">=</span> <span class="mh">0x13</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">IB_SA_ATTR_CLASS_PORTINFO</span>    <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_NOTICE</span>	     <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_INFORM_INFO</span>	     <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_NODE_REC</span>	     <span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_PORT_INFO_REC</span>     <span class="o">=</span> <span class="mh">0x12</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_SL2VL_REC</span>	     <span class="o">=</span> <span class="mh">0x13</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_SWITCH_REC</span>	     <span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_LINEAR_FDB_REC</span>    <span class="o">=</span> <span class="mh">0x15</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_RANDOM_FDB_REC</span>    <span class="o">=</span> <span class="mh">0x16</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_MCAST_FDB_REC</span>     <span class="o">=</span> <span class="mh">0x17</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_SM_INFO_REC</span>	     <span class="o">=</span> <span class="mh">0x18</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_LINK_REC</span>	     <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_GUID_INFO_REC</span>     <span class="o">=</span> <span class="mh">0x30</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_SERVICE_REC</span>	     <span class="o">=</span> <span class="mh">0x31</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_PARTITION_REC</span>     <span class="o">=</span> <span class="mh">0x33</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_PATH_REC</span>	     <span class="o">=</span> <span class="mh">0x35</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_VL_ARB_REC</span>	     <span class="o">=</span> <span class="mh">0x36</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_MC_MEMBER_REC</span>     <span class="o">=</span> <span class="mh">0x38</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_TRACE_REC</span>	     <span class="o">=</span> <span class="mh">0x39</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_MULTI_PATH_REC</span>    <span class="o">=</span> <span class="mh">0x3a</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_SERVICE_ASSOC_REC</span> <span class="o">=</span> <span class="mh">0x3b</span><span class="p">,</span>
	<span class="n">IB_SA_ATTR_INFORM_INFO_REC</span>   <span class="o">=</span> <span class="mh">0xf3</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">ib_sa_selector</span> <span class="p">{</span>
	<span class="n">IB_SA_GT</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">IB_SA_LT</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">IB_SA_EQ</span>   <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="cm">/*</span>
<span class="cm">	 * The meaning of &quot;best&quot; depends on the attribute: for</span>
<span class="cm">	 * example, for MTU best will return the largest available</span>
<span class="cm">	 * MTU, while for packet life time, best will return the</span>
<span class="cm">	 * smallest available life time.</span>
<span class="cm">	 */</span>
	<span class="n">IB_SA_BEST</span> <span class="o">=</span> <span class="mi">3</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Structures for SA records are named &quot;struct ib_sa_xxx_rec.&quot;  No</span>
<span class="cm"> * attempt is made to pack structures to match the physical layout of</span>
<span class="cm"> * SA records in SA MADs; all packing and unpacking is handled by the</span>
<span class="cm"> * SA query code.</span>
<span class="cm"> *</span>
<span class="cm"> * For a record with structure ib_sa_xxx_rec, the naming convention</span>
<span class="cm"> * for the component mask value for field yyy is IB_SA_XXX_REC_YYY (we</span>
<span class="cm"> * never use different abbreviations or otherwise change the spelling</span>
<span class="cm"> * of xxx/yyy between ib_sa_xxx_rec.yyy and IB_SA_XXX_REC_YYY).</span>
<span class="cm"> *</span>
<span class="cm"> * Reserved rows are indicated with comments to help maintainability.</span>
<span class="cm"> */</span>

<span class="cp">#define IB_SA_PATH_REC_SERVICE_ID		       (IB_SA_COMP_MASK( 0) |\</span>
<span class="cp">							IB_SA_COMP_MASK( 1))</span>
<span class="cp">#define IB_SA_PATH_REC_DGID				IB_SA_COMP_MASK( 2)</span>
<span class="cp">#define IB_SA_PATH_REC_SGID				IB_SA_COMP_MASK( 3)</span>
<span class="cp">#define IB_SA_PATH_REC_DLID				IB_SA_COMP_MASK( 4)</span>
<span class="cp">#define IB_SA_PATH_REC_SLID				IB_SA_COMP_MASK( 5)</span>
<span class="cp">#define IB_SA_PATH_REC_RAW_TRAFFIC			IB_SA_COMP_MASK( 6)</span>
<span class="cm">/* reserved:								 7 */</span>
<span class="cp">#define IB_SA_PATH_REC_FLOW_LABEL       		IB_SA_COMP_MASK( 8)</span>
<span class="cp">#define IB_SA_PATH_REC_HOP_LIMIT			IB_SA_COMP_MASK( 9)</span>
<span class="cp">#define IB_SA_PATH_REC_TRAFFIC_CLASS			IB_SA_COMP_MASK(10)</span>
<span class="cp">#define IB_SA_PATH_REC_REVERSIBLE			IB_SA_COMP_MASK(11)</span>
<span class="cp">#define IB_SA_PATH_REC_NUMB_PATH			IB_SA_COMP_MASK(12)</span>
<span class="cp">#define IB_SA_PATH_REC_PKEY				IB_SA_COMP_MASK(13)</span>
<span class="cp">#define IB_SA_PATH_REC_QOS_CLASS			IB_SA_COMP_MASK(14)</span>
<span class="cp">#define IB_SA_PATH_REC_SL				IB_SA_COMP_MASK(15)</span>
<span class="cp">#define IB_SA_PATH_REC_MTU_SELECTOR			IB_SA_COMP_MASK(16)</span>
<span class="cp">#define IB_SA_PATH_REC_MTU				IB_SA_COMP_MASK(17)</span>
<span class="cp">#define IB_SA_PATH_REC_RATE_SELECTOR			IB_SA_COMP_MASK(18)</span>
<span class="cp">#define IB_SA_PATH_REC_RATE				IB_SA_COMP_MASK(19)</span>
<span class="cp">#define IB_SA_PATH_REC_PACKET_LIFE_TIME_SELECTOR	IB_SA_COMP_MASK(20)</span>
<span class="cp">#define IB_SA_PATH_REC_PACKET_LIFE_TIME			IB_SA_COMP_MASK(21)</span>
<span class="cp">#define IB_SA_PATH_REC_PREFERENCE			IB_SA_COMP_MASK(22)</span>

<span class="k">struct</span> <span class="n">ib_sa_path_rec</span> <span class="p">{</span>
	<span class="n">__be64</span>       <span class="n">service_id</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">dgid</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">sgid</span><span class="p">;</span>
	<span class="n">__be16</span>       <span class="n">dlid</span><span class="p">;</span>
	<span class="n">__be16</span>       <span class="n">slid</span><span class="p">;</span>
	<span class="kt">int</span>          <span class="n">raw_traffic</span><span class="p">;</span>
	<span class="cm">/* reserved */</span>
	<span class="n">__be32</span>       <span class="n">flow_label</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">hop_limit</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">traffic_class</span><span class="p">;</span>
	<span class="kt">int</span>          <span class="n">reversible</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">numb_path</span><span class="p">;</span>
	<span class="n">__be16</span>       <span class="n">pkey</span><span class="p">;</span>
	<span class="n">__be16</span>       <span class="n">qos_class</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">sl</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">mtu_selector</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">mtu</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">rate_selector</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">rate</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">packet_life_time_selector</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">packet_life_time</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">preference</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define IB_SA_MCMEMBER_REC_MGID				IB_SA_COMP_MASK( 0)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_PORT_GID			IB_SA_COMP_MASK( 1)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_QKEY				IB_SA_COMP_MASK( 2)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_MLID				IB_SA_COMP_MASK( 3)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_MTU_SELECTOR			IB_SA_COMP_MASK( 4)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_MTU				IB_SA_COMP_MASK( 5)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_TRAFFIC_CLASS		IB_SA_COMP_MASK( 6)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_PKEY				IB_SA_COMP_MASK( 7)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_RATE_SELECTOR		IB_SA_COMP_MASK( 8)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_RATE				IB_SA_COMP_MASK( 9)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_PACKET_LIFE_TIME_SELECTOR	IB_SA_COMP_MASK(10)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_PACKET_LIFE_TIME		IB_SA_COMP_MASK(11)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_SL				IB_SA_COMP_MASK(12)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_FLOW_LABEL			IB_SA_COMP_MASK(13)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_HOP_LIMIT			IB_SA_COMP_MASK(14)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_SCOPE			IB_SA_COMP_MASK(15)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_JOIN_STATE			IB_SA_COMP_MASK(16)</span>
<span class="cp">#define IB_SA_MCMEMBER_REC_PROXY_JOIN			IB_SA_COMP_MASK(17)</span>

<span class="k">struct</span> <span class="n">ib_sa_mcmember_rec</span> <span class="p">{</span>
	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">mgid</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ib_gid</span> <span class="n">port_gid</span><span class="p">;</span>
	<span class="n">__be32</span>       <span class="n">qkey</span><span class="p">;</span>
	<span class="n">__be16</span>       <span class="n">mlid</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">mtu_selector</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">mtu</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">traffic_class</span><span class="p">;</span>
	<span class="n">__be16</span>       <span class="n">pkey</span><span class="p">;</span>
	<span class="n">u8</span> 	     <span class="n">rate_selector</span><span class="p">;</span>
	<span class="n">u8</span> 	     <span class="n">rate</span><span class="p">;</span>
	<span class="n">u8</span> 	     <span class="n">packet_life_time_selector</span><span class="p">;</span>
	<span class="n">u8</span> 	     <span class="n">packet_life_time</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">sl</span><span class="p">;</span>
	<span class="n">__be32</span>       <span class="n">flow_label</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">hop_limit</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">scope</span><span class="p">;</span>
	<span class="n">u8</span>           <span class="n">join_state</span><span class="p">;</span>
	<span class="kt">int</span>          <span class="n">proxy_join</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Service Record Component Mask Sec 15.2.5.14 Ver 1.1	*/</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_ID			IB_SA_COMP_MASK( 0)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_GID			IB_SA_COMP_MASK( 1)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_PKEY			IB_SA_COMP_MASK( 2)</span>
<span class="cm">/* reserved:								 3 */</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_LEASE			IB_SA_COMP_MASK( 4)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_KEY			IB_SA_COMP_MASK( 5)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_NAME			IB_SA_COMP_MASK( 6)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_0		IB_SA_COMP_MASK( 7)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_1		IB_SA_COMP_MASK( 8)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_2		IB_SA_COMP_MASK( 9)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_3		IB_SA_COMP_MASK(10)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_4		IB_SA_COMP_MASK(11)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_5		IB_SA_COMP_MASK(12)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_6		IB_SA_COMP_MASK(13)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_7		IB_SA_COMP_MASK(14)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_8		IB_SA_COMP_MASK(15)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_9		IB_SA_COMP_MASK(16)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_10		IB_SA_COMP_MASK(17)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_11		IB_SA_COMP_MASK(18)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_12		IB_SA_COMP_MASK(19)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_13		IB_SA_COMP_MASK(20)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_14		IB_SA_COMP_MASK(21)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA8_15		IB_SA_COMP_MASK(22)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA16_0		IB_SA_COMP_MASK(23)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA16_1		IB_SA_COMP_MASK(24)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA16_2		IB_SA_COMP_MASK(25)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA16_3		IB_SA_COMP_MASK(26)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA16_4		IB_SA_COMP_MASK(27)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA16_5		IB_SA_COMP_MASK(28)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA16_6		IB_SA_COMP_MASK(29)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA16_7		IB_SA_COMP_MASK(30)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA32_0		IB_SA_COMP_MASK(31)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA32_1		IB_SA_COMP_MASK(32)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA32_2		IB_SA_COMP_MASK(33)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA32_3		IB_SA_COMP_MASK(34)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA64_0		IB_SA_COMP_MASK(35)</span>
<span class="cp">#define IB_SA_SERVICE_REC_SERVICE_DATA64_1		IB_SA_COMP_MASK(36)</span>

<span class="cp">#define IB_DEFAULT_SERVICE_LEASE 	0xFFFFFFFF</span>

<span class="k">struct</span> <span class="n">ib_sa_service_rec</span> <span class="p">{</span>
	<span class="n">u64</span>		<span class="n">id</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ib_gid</span>	<span class="n">gid</span><span class="p">;</span>
	<span class="n">__be16</span> 		<span class="n">pkey</span><span class="p">;</span>
	<span class="cm">/* reserved */</span>
	<span class="n">u32</span>		<span class="n">lease</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">key</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u8</span>		<span class="n">name</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="n">u8</span>		<span class="n">data8</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u16</span>		<span class="n">data16</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u32</span>		<span class="n">data32</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u64</span>		<span class="n">data64</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ib_sa_client</span> <span class="p">{</span>
	<span class="n">atomic_t</span> <span class="n">users</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">comp</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * ib_sa_register_client - Register an SA client.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">ib_sa_register_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_sa_client</span> <span class="o">*</span><span class="n">client</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * ib_sa_unregister_client - Deregister an SA client.</span>
<span class="cm"> * @client: Client object to deregister.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">ib_sa_unregister_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_sa_client</span> <span class="o">*</span><span class="n">client</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">ib_sa_query</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">ib_sa_cancel_query</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_sa_query</span> <span class="o">*</span><span class="n">query</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ib_sa_path_rec_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_sa_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">device</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port_num</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">ib_sa_path_rec</span> <span class="o">*</span><span class="n">rec</span><span class="p">,</span>
		       <span class="n">ib_sa_comp_mask</span> <span class="n">comp_mask</span><span class="p">,</span>
		       <span class="kt">int</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">gfp_t</span> <span class="n">gfp_mask</span><span class="p">,</span>
		       <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="kt">int</span> <span class="n">status</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">ib_sa_path_rec</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span>
					<span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">),</span>
		       <span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">ib_sa_query</span> <span class="o">**</span><span class="n">query</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">ib_sa_service_rec_query</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_sa_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">device</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port_num</span><span class="p">,</span>
			 <span class="n">u8</span> <span class="n">method</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ib_sa_service_rec</span> <span class="o">*</span><span class="n">rec</span><span class="p">,</span>
			 <span class="n">ib_sa_comp_mask</span> <span class="n">comp_mask</span><span class="p">,</span>
			 <span class="kt">int</span> <span class="n">timeout_ms</span><span class="p">,</span> <span class="n">gfp_t</span> <span class="n">gfp_mask</span><span class="p">,</span>
			 <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="kt">int</span> <span class="n">status</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">ib_sa_service_rec</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span>
					  <span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">),</span>
			 <span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ib_sa_query</span> <span class="o">**</span><span class="n">sa_query</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">ib_sa_multicast</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_sa_mcmember_rec</span> <span class="n">rec</span><span class="p">;</span>
	<span class="n">ib_sa_comp_mask</span>		<span class="n">comp_mask</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="kt">int</span> <span class="n">status</span><span class="p">,</span>
					    <span class="k">struct</span> <span class="n">ib_sa_multicast</span> <span class="o">*</span><span class="n">multicast</span><span class="p">);</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">context</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * ib_sa_join_multicast - Initiates a join request to the specified multicast</span>
<span class="cm"> *   group.</span>
<span class="cm"> * @client: SA client</span>
<span class="cm"> * @device: Device associated with the multicast group.</span>
<span class="cm"> * @port_num: Port on the specified device to associate with the multicast</span>
<span class="cm"> *   group.</span>
<span class="cm"> * @rec: SA multicast member record specifying group attributes.</span>
<span class="cm"> * @comp_mask: Component mask indicating which group attributes of %rec are</span>
<span class="cm"> *   valid.</span>
<span class="cm"> * @gfp_mask: GFP mask for memory allocations.</span>
<span class="cm"> * @callback: User callback invoked once the join operation completes.</span>
<span class="cm"> * @context: User specified context stored with the ib_sa_multicast structure.</span>
<span class="cm"> *</span>
<span class="cm"> * This call initiates a multicast join request with the SA for the specified</span>
<span class="cm"> * multicast group.  If the join operation is started successfully, it returns</span>
<span class="cm"> * an ib_sa_multicast structure that is used to track the multicast operation.</span>
<span class="cm"> * Users must free this structure by calling ib_free_multicast, even if the</span>
<span class="cm"> * join operation later fails.  (The callback status is non-zero.)</span>
<span class="cm"> *</span>
<span class="cm"> * If the join operation fails; status will be non-zero, with the following</span>
<span class="cm"> * failures possible:</span>
<span class="cm"> * -ETIMEDOUT: The request timed out.</span>
<span class="cm"> * -EIO: An error occurred sending the query.</span>
<span class="cm"> * -EINVAL: The MCMemberRecord values differed from the existing group&#39;s.</span>
<span class="cm"> * -ENETRESET: Indicates that an fatal error has occurred on the multicast</span>
<span class="cm"> *   group, and the user must rejoin the group to continue using it.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ib_sa_multicast</span> <span class="o">*</span><span class="n">ib_sa_join_multicast</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_sa_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">device</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port_num</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">ib_sa_mcmember_rec</span> <span class="o">*</span><span class="n">rec</span><span class="p">,</span>
					     <span class="n">ib_sa_comp_mask</span> <span class="n">comp_mask</span><span class="p">,</span> <span class="n">gfp_t</span> <span class="n">gfp_mask</span><span class="p">,</span>
					     <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">callback</span><span class="p">)(</span><span class="kt">int</span> <span class="n">status</span><span class="p">,</span>
							     <span class="k">struct</span> <span class="n">ib_sa_multicast</span>
								    <span class="o">*</span><span class="n">multicast</span><span class="p">),</span>
					     <span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * ib_free_multicast - Frees the multicast tracking structure, and releases</span>
<span class="cm"> *    any reference on the multicast group.</span>
<span class="cm"> * @multicast: Multicast tracking structure allocated by ib_join_multicast.</span>
<span class="cm"> *</span>
<span class="cm"> * This call blocks until the multicast identifier is destroyed.  It may</span>
<span class="cm"> * not be called from within the multicast callback; however, returning a non-</span>
<span class="cm"> * zero value from the callback will result in destroying the multicast</span>
<span class="cm"> * tracking structure.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">ib_sa_free_multicast</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_sa_multicast</span> <span class="o">*</span><span class="n">multicast</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * ib_get_mcmember_rec - Looks up a multicast member record by its MGID and</span>
<span class="cm"> *   returns it if found.</span>
<span class="cm"> * @device: Device associated with the multicast group.</span>
<span class="cm"> * @port_num: Port on the specified device to associate with the multicast</span>
<span class="cm"> *   group.</span>
<span class="cm"> * @mgid: MGID of multicast group.</span>
<span class="cm"> * @rec: Location to copy SA multicast member record.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">ib_sa_get_mcmember_rec</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">device</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port_num</span><span class="p">,</span>
			   <span class="k">union</span> <span class="n">ib_gid</span> <span class="o">*</span><span class="n">mgid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_sa_mcmember_rec</span> <span class="o">*</span><span class="n">rec</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * ib_init_ah_from_mcmember - Initialize address handle attributes based on</span>
<span class="cm"> * an SA multicast member record.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">ib_init_ah_from_mcmember</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">device</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port_num</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">ib_sa_mcmember_rec</span> <span class="o">*</span><span class="n">rec</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">ib_ah_attr</span> <span class="o">*</span><span class="n">ah_attr</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * ib_init_ah_from_path - Initialize address handle attributes based on an SA</span>
<span class="cm"> *   path record.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">ib_init_ah_from_path</span><span class="p">(</span><span class="k">struct</span> <span class="n">ib_device</span> <span class="o">*</span><span class="n">device</span><span class="p">,</span> <span class="n">u8</span> <span class="n">port_num</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ib_sa_path_rec</span> <span class="o">*</span><span class="n">rec</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">ib_ah_attr</span> <span class="o">*</span><span class="n">ah_attr</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * ib_sa_unpack_path - Convert a path record from MAD format to struct</span>
<span class="cm"> * ib_sa_path_rec.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">ib_sa_unpack_path</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">attribute</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ib_sa_path_rec</span> <span class="o">*</span><span class="n">rec</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* IB_SA_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
