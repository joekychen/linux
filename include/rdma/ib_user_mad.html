<!DOCTYPE html>
<html><head><title>joekychen/linux » include › rdma › ib_user_mad.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>ib_user_mad.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2004 Topspin Communications.  All rights reserved.</span>
<span class="cm"> * Copyright (c) 2005 Voltaire, Inc. All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This software is available to you under a choice of one of two</span>
<span class="cm"> * licenses.  You may choose to be licensed under the terms of the GNU</span>
<span class="cm"> * General Public License (GPL) Version 2, available from the file</span>
<span class="cm"> * COPYING in the main directory of this source tree, or the</span>
<span class="cm"> * OpenIB.org BSD license below:</span>
<span class="cm"> *</span>
<span class="cm"> *     Redistribution and use in source and binary forms, with or</span>
<span class="cm"> *     without modification, are permitted provided that the following</span>
<span class="cm"> *     conditions are met:</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions of source code must retain the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer.</span>
<span class="cm"> *</span>
<span class="cm"> *      - Redistributions in binary form must reproduce the above</span>
<span class="cm"> *        copyright notice, this list of conditions and the following</span>
<span class="cm"> *        disclaimer in the documentation and/or other materials</span>
<span class="cm"> *        provided with the distribution.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<span class="cm"> * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<span class="cm"> * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS</span>
<span class="cm"> * BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN</span>
<span class="cm"> * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span>
<span class="cm"> * SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef IB_USER_MAD_H</span>
<span class="cp">#define IB_USER_MAD_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/ioctl.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Increment this value if any changes that break userspace ABI</span>
<span class="cm"> * compatibility are made.</span>
<span class="cm"> */</span>
<span class="cp">#define IB_USER_MAD_ABI_VERSION	5</span>

<span class="cm">/*</span>
<span class="cm"> * Make sure that all structs defined in this file remain laid out so</span>
<span class="cm"> * that they pack the same way on 32-bit and 64-bit architectures (to</span>
<span class="cm"> * avoid incompatibility between 32-bit userspace and 64-bit kernels).</span>
<span class="cm"> */</span>

<span class="cm">/**</span>
<span class="cm"> * ib_user_mad_hdr_old - Old version of MAD packet header without pkey_index</span>
<span class="cm"> * @id - ID of agent MAD received with/to be sent with</span>
<span class="cm"> * @status - 0 on successful receive, ETIMEDOUT if no response</span>
<span class="cm"> *   received (transaction ID in data[] will be set to TID of original</span>
<span class="cm"> *   request) (ignored on send)</span>
<span class="cm"> * @timeout_ms - Milliseconds to wait for response (unset on receive)</span>
<span class="cm"> * @retries - Number of automatic retries to attempt</span>
<span class="cm"> * @qpn - Remote QP number received from/to be sent to</span>
<span class="cm"> * @qkey - Remote Q_Key to be sent with (unset on receive)</span>
<span class="cm"> * @lid - Remote lid received from/to be sent to</span>
<span class="cm"> * @sl - Service level received with/to be sent with</span>
<span class="cm"> * @path_bits - Local path bits received with/to be sent with</span>
<span class="cm"> * @grh_present - If set, GRH was received/should be sent</span>
<span class="cm"> * @gid_index - Local GID index to send with (unset on receive)</span>
<span class="cm"> * @hop_limit - Hop limit in GRH</span>
<span class="cm"> * @traffic_class - Traffic class in GRH</span>
<span class="cm"> * @gid - Remote GID in GRH</span>
<span class="cm"> * @flow_label - Flow label in GRH</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ib_user_mad_hdr_old</span> <span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">id</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">status</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">timeout_ms</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">retries</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">length</span><span class="p">;</span>
	<span class="n">__be32</span>	<span class="n">qpn</span><span class="p">;</span>
	<span class="n">__be32</span>  <span class="n">qkey</span><span class="p">;</span>
	<span class="n">__be16</span>	<span class="n">lid</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">sl</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">path_bits</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">grh_present</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">gid_index</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">hop_limit</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">traffic_class</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">gid</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">__be32</span>	<span class="n">flow_label</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * ib_user_mad_hdr - MAD packet header</span>
<span class="cm"> *   This layout allows specifying/receiving the P_Key index.  To use</span>
<span class="cm"> *   this capability, an application must call the</span>
<span class="cm"> *   IB_USER_MAD_ENABLE_PKEY ioctl on the user MAD file handle before</span>
<span class="cm"> *   any other actions with the file handle.</span>
<span class="cm"> * @id - ID of agent MAD received with/to be sent with</span>
<span class="cm"> * @status - 0 on successful receive, ETIMEDOUT if no response</span>
<span class="cm"> *   received (transaction ID in data[] will be set to TID of original</span>
<span class="cm"> *   request) (ignored on send)</span>
<span class="cm"> * @timeout_ms - Milliseconds to wait for response (unset on receive)</span>
<span class="cm"> * @retries - Number of automatic retries to attempt</span>
<span class="cm"> * @qpn - Remote QP number received from/to be sent to</span>
<span class="cm"> * @qkey - Remote Q_Key to be sent with (unset on receive)</span>
<span class="cm"> * @lid - Remote lid received from/to be sent to</span>
<span class="cm"> * @sl - Service level received with/to be sent with</span>
<span class="cm"> * @path_bits - Local path bits received with/to be sent with</span>
<span class="cm"> * @grh_present - If set, GRH was received/should be sent</span>
<span class="cm"> * @gid_index - Local GID index to send with (unset on receive)</span>
<span class="cm"> * @hop_limit - Hop limit in GRH</span>
<span class="cm"> * @traffic_class - Traffic class in GRH</span>
<span class="cm"> * @gid - Remote GID in GRH</span>
<span class="cm"> * @flow_label - Flow label in GRH</span>
<span class="cm"> * @pkey_index - P_Key index</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ib_user_mad_hdr</span> <span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">id</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">status</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">timeout_ms</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">retries</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">length</span><span class="p">;</span>
	<span class="n">__be32</span>	<span class="n">qpn</span><span class="p">;</span>
	<span class="n">__be32</span>  <span class="n">qkey</span><span class="p">;</span>
	<span class="n">__be16</span>	<span class="n">lid</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">sl</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">path_bits</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">grh_present</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">gid_index</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">hop_limit</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">traffic_class</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">gid</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">__be32</span>	<span class="n">flow_label</span><span class="p">;</span>
	<span class="n">__u16</span>	<span class="n">pkey_index</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">reserved</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * ib_user_mad - MAD packet</span>
<span class="cm"> * @hdr - MAD packet header</span>
<span class="cm"> * @data - Contents of MAD</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ib_user_mad</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ib_user_mad_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">__u64</span>	<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Earlier versions of this interface definition declared the</span>
<span class="cm"> * method_mask[] member as an array of __u32 but treated it as a</span>
<span class="cm"> * bitmap made up of longs in the kernel.  This ambiguity meant that</span>
<span class="cm"> * 32-bit big-endian applications that can run on both 32-bit and</span>
<span class="cm"> * 64-bit kernels had no consistent ABI to rely on, and 64-bit</span>
<span class="cm"> * big-endian applications that treated method_mask as being made up</span>
<span class="cm"> * of 32-bit words would have their bitmap misinterpreted.</span>
<span class="cm"> *</span>
<span class="cm"> * To clear up this confusion, we change the declaration of</span>
<span class="cm"> * method_mask[] to use unsigned long and handle the conversion from</span>
<span class="cm"> * 32-bit userspace to 64-bit kernel for big-endian systems in the</span>
<span class="cm"> * compat_ioctl method.  Unfortunately, to keep the structure layout</span>
<span class="cm"> * the same, we need the method_mask[] array to be aligned only to 4</span>
<span class="cm"> * bytes even when long is 64 bits, which forces us into this ugly</span>
<span class="cm"> * typedef.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span> <span class="n">packed_ulong</span><span class="p">;</span>
<span class="cp">#define IB_USER_MAD_LONGS_PER_METHOD_MASK (128 / (8 * sizeof (long)))</span>

<span class="cm">/**</span>
<span class="cm"> * ib_user_mad_reg_req - MAD registration request</span>
<span class="cm"> * @id - Set by the kernel; used to identify agent in future requests.</span>
<span class="cm"> * @qpn - Queue pair number; must be 0 or 1.</span>
<span class="cm"> * @method_mask - The caller will receive unsolicited MADs for any method</span>
<span class="cm"> *   where @method_mask = 1.</span>
<span class="cm"> * @mgmt_class - Indicates which management class of MADs should be receive</span>
<span class="cm"> *   by the caller.  This field is only required if the user wishes to</span>
<span class="cm"> *   receive unsolicited MADs, otherwise it should be 0.</span>
<span class="cm"> * @mgmt_class_version - Indicates which version of MADs for the given</span>
<span class="cm"> *   management class to receive.</span>
<span class="cm"> * @oui: Indicates IEEE OUI when mgmt_class is a vendor class</span>
<span class="cm"> *   in the range from 0x30 to 0x4f. Otherwise not used.</span>
<span class="cm"> * @rmpp_version: If set, indicates the RMPP version used.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ib_user_mad_reg_req</span> <span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">id</span><span class="p">;</span>
	<span class="n">packed_ulong</span> <span class="n">method_mask</span><span class="p">[</span><span class="n">IB_USER_MAD_LONGS_PER_METHOD_MASK</span><span class="p">];</span>
	<span class="n">__u8</span>	<span class="n">qpn</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">mgmt_class</span><span class="p">;</span>
	<span class="n">__u8</span>	<span class="n">mgmt_class_version</span><span class="p">;</span>
	<span class="n">__u8</span>    <span class="n">oui</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">__u8</span>	<span class="n">rmpp_version</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define IB_IOCTL_MAGIC		0x1b</span>

<span class="cp">#define IB_USER_MAD_REGISTER_AGENT	_IOWR(IB_IOCTL_MAGIC, 1, \</span>
<span class="cp">					      struct ib_user_mad_reg_req)</span>

<span class="cp">#define IB_USER_MAD_UNREGISTER_AGENT	_IOW(IB_IOCTL_MAGIC, 2, __u32)</span>

<span class="cp">#define IB_USER_MAD_ENABLE_PKEY		_IO(IB_IOCTL_MAGIC, 3)</span>

<span class="cp">#endif </span><span class="cm">/* IB_USER_MAD_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
