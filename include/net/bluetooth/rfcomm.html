<!DOCTYPE html>
<html><head><title>joekychen/linux » include › net › bluetooth › rfcomm.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>rfcomm.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">   RFCOMM implementation for Linux Bluetooth stack (BlueZ)</span>
<span class="cm">   Copyright (C) 2002 Maxim Krasnyansky &lt;maxk@qualcomm.com&gt;</span>
<span class="cm">   Copyright (C) 2002 Marcel Holtmann &lt;marcel@holtmann.org&gt;</span>

<span class="cm">   This program is free software; you can redistribute it and/or modify</span>
<span class="cm">   it under the terms of the GNU General Public License version 2 as</span>
<span class="cm">   published by the Free Software Foundation;</span>

<span class="cm">   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS</span>
<span class="cm">   OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm">   FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT OF THIRD PARTY RIGHTS.</span>
<span class="cm">   IN NO EVENT SHALL THE COPYRIGHT HOLDER(S) AND AUTHOR(S) BE LIABLE FOR ANY</span>
<span class="cm">   CLAIM, OR ANY SPECIAL INDIRECT OR CONSEQUENTIAL DAMAGES, OR ANY DAMAGES</span>
<span class="cm">   WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span>
<span class="cm">   ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span>
<span class="cm">   OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>

<span class="cm">   ALL LIABILITY, INCLUDING LIABILITY FOR INFRINGEMENT OF ANY PATENTS,</span>
<span class="cm">   COPYRIGHTS, TRADEMARKS OR OTHER RIGHTS, RELATING TO USE OF THIS</span>
<span class="cm">   SOFTWARE IS DISCLAIMED.</span>
<span class="cm">*/</span>

<span class="cp">#ifndef __RFCOMM_H</span>
<span class="cp">#define __RFCOMM_H</span>

<span class="cp">#define RFCOMM_PSM 3</span>

<span class="cp">#define RFCOMM_CONN_TIMEOUT (HZ * 30)</span>
<span class="cp">#define RFCOMM_DISC_TIMEOUT (HZ * 20)</span>
<span class="cp">#define RFCOMM_AUTH_TIMEOUT (HZ * 25)</span>
<span class="cp">#define RFCOMM_IDLE_TIMEOUT (HZ * 2)</span>

<span class="cp">#define RFCOMM_DEFAULT_MTU	127</span>
<span class="cp">#define RFCOMM_DEFAULT_CREDITS	7</span>

<span class="cp">#define RFCOMM_MAX_L2CAP_MTU	1013</span>
<span class="cp">#define RFCOMM_MAX_CREDITS	40</span>

<span class="cp">#define RFCOMM_SKB_HEAD_RESERVE	8</span>
<span class="cp">#define RFCOMM_SKB_TAIL_RESERVE	2</span>
<span class="cp">#define RFCOMM_SKB_RESERVE  (RFCOMM_SKB_HEAD_RESERVE + RFCOMM_SKB_TAIL_RESERVE)</span>

<span class="cp">#define RFCOMM_SABM	0x2f</span>
<span class="cp">#define RFCOMM_DISC	0x43</span>
<span class="cp">#define RFCOMM_UA	0x63</span>
<span class="cp">#define RFCOMM_DM	0x0f</span>
<span class="cp">#define RFCOMM_UIH	0xef</span>

<span class="cp">#define RFCOMM_TEST	0x08</span>
<span class="cp">#define RFCOMM_FCON	0x28</span>
<span class="cp">#define RFCOMM_FCOFF	0x18</span>
<span class="cp">#define RFCOMM_MSC	0x38</span>
<span class="cp">#define RFCOMM_RPN	0x24</span>
<span class="cp">#define RFCOMM_RLS	0x14</span>
<span class="cp">#define RFCOMM_PN	0x20</span>
<span class="cp">#define RFCOMM_NSC	0x04</span>

<span class="cp">#define RFCOMM_V24_FC	0x02</span>
<span class="cp">#define RFCOMM_V24_RTC	0x04</span>
<span class="cp">#define RFCOMM_V24_RTR	0x08</span>
<span class="cp">#define RFCOMM_V24_IC	0x40</span>
<span class="cp">#define RFCOMM_V24_DV	0x80</span>

<span class="cp">#define RFCOMM_RPN_BR_2400	0x0</span>
<span class="cp">#define RFCOMM_RPN_BR_4800	0x1</span>
<span class="cp">#define RFCOMM_RPN_BR_7200	0x2</span>
<span class="cp">#define RFCOMM_RPN_BR_9600	0x3</span>
<span class="cp">#define RFCOMM_RPN_BR_19200	0x4</span>
<span class="cp">#define RFCOMM_RPN_BR_38400	0x5</span>
<span class="cp">#define RFCOMM_RPN_BR_57600	0x6</span>
<span class="cp">#define RFCOMM_RPN_BR_115200	0x7</span>
<span class="cp">#define RFCOMM_RPN_BR_230400	0x8</span>

<span class="cp">#define RFCOMM_RPN_DATA_5	0x0</span>
<span class="cp">#define RFCOMM_RPN_DATA_6	0x1</span>
<span class="cp">#define RFCOMM_RPN_DATA_7	0x2</span>
<span class="cp">#define RFCOMM_RPN_DATA_8	0x3</span>

<span class="cp">#define RFCOMM_RPN_STOP_1	0</span>
<span class="cp">#define RFCOMM_RPN_STOP_15	1</span>

<span class="cp">#define RFCOMM_RPN_PARITY_NONE	0x0</span>
<span class="cp">#define RFCOMM_RPN_PARITY_ODD	0x1</span>
<span class="cp">#define RFCOMM_RPN_PARITY_EVEN	0x3</span>
<span class="cp">#define RFCOMM_RPN_PARITY_MARK	0x5</span>
<span class="cp">#define RFCOMM_RPN_PARITY_SPACE	0x7</span>

<span class="cp">#define RFCOMM_RPN_FLOW_NONE	0x00</span>

<span class="cp">#define RFCOMM_RPN_XON_CHAR	0x11</span>
<span class="cp">#define RFCOMM_RPN_XOFF_CHAR	0x13</span>

<span class="cp">#define RFCOMM_RPN_PM_BITRATE		0x0001</span>
<span class="cp">#define RFCOMM_RPN_PM_DATA		0x0002</span>
<span class="cp">#define RFCOMM_RPN_PM_STOP		0x0004</span>
<span class="cp">#define RFCOMM_RPN_PM_PARITY		0x0008</span>
<span class="cp">#define RFCOMM_RPN_PM_PARITY_TYPE	0x0010</span>
<span class="cp">#define RFCOMM_RPN_PM_XON		0x0020</span>
<span class="cp">#define RFCOMM_RPN_PM_XOFF		0x0040</span>
<span class="cp">#define RFCOMM_RPN_PM_FLOW		0x3F00</span>

<span class="cp">#define RFCOMM_RPN_PM_ALL		0x3F7F</span>

<span class="k">struct</span> <span class="n">rfcomm_hdr</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">addr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ctrl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">len</span><span class="p">;</span>    <span class="cm">/* Actual size can be 2 bytes */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">rfcomm_cmd</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">addr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ctrl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fcs</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">rfcomm_mcc</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">rfcomm_pn</span> <span class="p">{</span>
	<span class="n">u8</span>  <span class="n">dlci</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">flow_ctrl</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">priority</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">ack_timer</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">mtu</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">max_retrans</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">credits</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">rfcomm_rpn</span> <span class="p">{</span>
	<span class="n">u8</span>  <span class="n">dlci</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">bit_rate</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">line_settings</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">flow_ctrl</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">xon_char</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">xoff_char</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">param_mask</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">rfcomm_rls</span> <span class="p">{</span>
	<span class="n">u8</span>  <span class="n">dlci</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">status</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">rfcomm_msc</span> <span class="p">{</span>
	<span class="n">u8</span>  <span class="n">dlci</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">v24_sig</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* ---- Core structures, flags etc ---- */</span>

<span class="k">struct</span> <span class="n">rfcomm_session</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">socket</span>   <span class="o">*</span><span class="n">sock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span> <span class="n">timer</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">state</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">flags</span><span class="p">;</span>
	<span class="n">atomic_t</span>         <span class="n">refcnt</span><span class="p">;</span>
	<span class="kt">int</span>              <span class="n">initiator</span><span class="p">;</span>

	<span class="cm">/* Default DLC parameters */</span>
	<span class="kt">int</span>    <span class="n">cfc</span><span class="p">;</span>
	<span class="n">uint</span>   <span class="n">mtu</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">dlcs</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span>      <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rfcomm_session</span> <span class="o">*</span><span class="n">session</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span>   <span class="n">tx_queue</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span>     <span class="n">timer</span><span class="p">;</span>

	<span class="n">spinlock_t</span>    <span class="n">lock</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">state</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">atomic_t</span>      <span class="n">refcnt</span><span class="p">;</span>
	<span class="n">u8</span>            <span class="n">dlci</span><span class="p">;</span>
	<span class="n">u8</span>            <span class="n">addr</span><span class="p">;</span>
	<span class="n">u8</span>            <span class="n">priority</span><span class="p">;</span>
	<span class="n">u8</span>            <span class="n">v24_sig</span><span class="p">;</span>
	<span class="n">u8</span>            <span class="n">remote_v24_sig</span><span class="p">;</span>
	<span class="n">u8</span>            <span class="n">mscex</span><span class="p">;</span>
	<span class="n">u8</span>            <span class="n">out</span><span class="p">;</span>
	<span class="n">u8</span>            <span class="n">sec_level</span><span class="p">;</span>
	<span class="n">u8</span>            <span class="n">role_switch</span><span class="p">;</span>
	<span class="n">u32</span>           <span class="n">defer_setup</span><span class="p">;</span>

	<span class="n">uint</span>          <span class="n">mtu</span><span class="p">;</span>
	<span class="n">uint</span>          <span class="n">cfc</span><span class="p">;</span>
	<span class="n">uint</span>          <span class="n">rx_credits</span><span class="p">;</span>
	<span class="n">uint</span>          <span class="n">tx_credits</span><span class="p">;</span>

	<span class="kt">void</span>          <span class="o">*</span><span class="n">owner</span><span class="p">;</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">data_ready</span><span class="p">)(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">state_change</span><span class="p">)(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">err</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">modem_status</span><span class="p">)(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="n">u8</span> <span class="n">v24_sig</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* DLC and session flags */</span>
<span class="cp">#define RFCOMM_RX_THROTTLED 0</span>
<span class="cp">#define RFCOMM_TX_THROTTLED 1</span>
<span class="cp">#define RFCOMM_TIMED_OUT    2</span>
<span class="cp">#define RFCOMM_MSC_PENDING  3</span>
<span class="cp">#define RFCOMM_SEC_PENDING  4</span>
<span class="cp">#define RFCOMM_AUTH_PENDING 5</span>
<span class="cp">#define RFCOMM_AUTH_ACCEPT  6</span>
<span class="cp">#define RFCOMM_AUTH_REJECT  7</span>
<span class="cp">#define RFCOMM_DEFER_SETUP  8</span>
<span class="cp">#define RFCOMM_ENC_DROP     9</span>

<span class="cm">/* Scheduling flags and events */</span>
<span class="cp">#define RFCOMM_SCHED_WAKEUP 31</span>

<span class="cm">/* MSC exchange flags */</span>
<span class="cp">#define RFCOMM_MSCEX_TX     1</span>
<span class="cp">#define RFCOMM_MSCEX_RX     2</span>
<span class="cp">#define RFCOMM_MSCEX_OK     (RFCOMM_MSCEX_TX + RFCOMM_MSCEX_RX)</span>

<span class="cm">/* CFC states */</span>
<span class="cp">#define RFCOMM_CFC_UNKNOWN  -1</span>
<span class="cp">#define RFCOMM_CFC_DISABLED 0</span>
<span class="cp">#define RFCOMM_CFC_ENABLED  RFCOMM_MAX_CREDITS</span>

<span class="cm">/* ---- RFCOMM SEND RPN ---- */</span>
<span class="kt">int</span> <span class="n">rfcomm_send_rpn</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_session</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">dlci</span><span class="p">,</span>
			<span class="n">u8</span> <span class="n">bit_rate</span><span class="p">,</span> <span class="n">u8</span> <span class="n">data_bits</span><span class="p">,</span> <span class="n">u8</span> <span class="n">stop_bits</span><span class="p">,</span>
			<span class="n">u8</span> <span class="n">parity</span><span class="p">,</span> <span class="n">u8</span> <span class="n">flow_ctrl_settings</span><span class="p">,</span>
			<span class="n">u8</span> <span class="n">xon_char</span><span class="p">,</span> <span class="n">u8</span> <span class="n">xoff_char</span><span class="p">,</span> <span class="n">u16</span> <span class="n">param_mask</span><span class="p">);</span>

<span class="cm">/* ---- RFCOMM DLCs (channels) ---- */</span>
<span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">rfcomm_dlc_alloc</span><span class="p">(</span><span class="n">gfp_t</span> <span class="n">prio</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">rfcomm_dlc_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">);</span>
<span class="kt">int</span>  <span class="n">rfcomm_dlc_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="n">bdaddr_t</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="n">bdaddr_t</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span>
								<span class="n">u8</span> <span class="n">channel</span><span class="p">);</span>
<span class="kt">int</span>  <span class="n">rfcomm_dlc_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">reason</span><span class="p">);</span>
<span class="kt">int</span>  <span class="n">rfcomm_dlc_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>
<span class="kt">int</span>  <span class="n">rfcomm_dlc_set_modem_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="n">u8</span> <span class="n">v24_sig</span><span class="p">);</span>
<span class="kt">int</span>  <span class="n">rfcomm_dlc_get_modem_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">v24_sig</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">rfcomm_dlc_accept</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">);</span>

<span class="cp">#define rfcomm_dlc_lock(d)     spin_lock(&amp;d-&gt;lock)</span>
<span class="cp">#define rfcomm_dlc_unlock(d)   spin_unlock(&amp;d-&gt;lock)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rfcomm_dlc_hold</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">atomic_inc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rfcomm_dlc_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">atomic_dec_and_test</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">))</span>
		<span class="n">rfcomm_dlc_free</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">__rfcomm_dlc_throttle</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__rfcomm_dlc_unthrottle</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rfcomm_dlc_throttle</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">test_and_set_bit</span><span class="p">(</span><span class="n">RFCOMM_RX_THROTTLED</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">))</span>
		<span class="n">__rfcomm_dlc_throttle</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rfcomm_dlc_unthrottle</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">test_and_clear_bit</span><span class="p">(</span><span class="n">RFCOMM_RX_THROTTLED</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">))</span>
		<span class="n">__rfcomm_dlc_unthrottle</span><span class="p">(</span><span class="n">d</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* ---- RFCOMM sessions ---- */</span>
<span class="kt">void</span>   <span class="n">rfcomm_session_getaddr</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_session</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">bdaddr_t</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span>
								<span class="n">bdaddr_t</span> <span class="o">*</span><span class="n">dst</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rfcomm_session_hold</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_session</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">atomic_inc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="o">-&gt;</span><span class="n">refcnt</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* ---- RFCOMM sockets ---- */</span>
<span class="k">struct</span> <span class="n">sockaddr_rc</span> <span class="p">{</span>
	<span class="n">sa_family_t</span>	<span class="n">rc_family</span><span class="p">;</span>
	<span class="n">bdaddr_t</span>	<span class="n">rc_bdaddr</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">rc_channel</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define RFCOMM_CONNINFO	0x02</span>
<span class="k">struct</span> <span class="n">rfcomm_conninfo</span> <span class="p">{</span>
	<span class="n">__u16</span> <span class="n">hci_handle</span><span class="p">;</span>
	<span class="n">__u8</span>  <span class="n">dev_class</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define RFCOMM_LM	0x03</span>
<span class="cp">#define RFCOMM_LM_MASTER	0x0001</span>
<span class="cp">#define RFCOMM_LM_AUTH		0x0002</span>
<span class="cp">#define RFCOMM_LM_ENCRYPT	0x0004</span>
<span class="cp">#define RFCOMM_LM_TRUSTED	0x0008</span>
<span class="cp">#define RFCOMM_LM_RELIABLE	0x0010</span>
<span class="cp">#define RFCOMM_LM_SECURE	0x0020</span>

<span class="cp">#define rfcomm_pi(sk) ((struct rfcomm_pinfo *) sk)</span>

<span class="k">struct</span> <span class="n">rfcomm_pinfo</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">bt_sock</span> <span class="n">bt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rfcomm_dlc</span>   <span class="o">*</span><span class="n">dlc</span><span class="p">;</span>
	<span class="n">u8</span>     <span class="n">channel</span><span class="p">;</span>
	<span class="n">u8</span>     <span class="n">sec_level</span><span class="p">;</span>
	<span class="n">u8</span>     <span class="n">role_switch</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span>  <span class="n">rfcomm_init_sockets</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">rfcomm_cleanup_sockets</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="kt">int</span>  <span class="n">rfcomm_connect_ind</span><span class="p">(</span><span class="k">struct</span> <span class="n">rfcomm_session</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">u8</span> <span class="n">channel</span><span class="p">,</span>
							<span class="k">struct</span> <span class="n">rfcomm_dlc</span> <span class="o">**</span><span class="n">d</span><span class="p">);</span>

<span class="cm">/* ---- RFCOMM TTY ---- */</span>
<span class="cp">#define RFCOMM_MAX_DEV  256</span>

<span class="cp">#define RFCOMMCREATEDEV		_IOW(&#39;R&#39;, 200, int)</span>
<span class="cp">#define RFCOMMRELEASEDEV	_IOW(&#39;R&#39;, 201, int)</span>
<span class="cp">#define RFCOMMGETDEVLIST	_IOR(&#39;R&#39;, 210, int)</span>
<span class="cp">#define RFCOMMGETDEVINFO	_IOR(&#39;R&#39;, 211, int)</span>
<span class="cp">#define RFCOMMSTEALDLC		_IOW(&#39;R&#39;, 220, int)</span>

<span class="cp">#define RFCOMM_REUSE_DLC      0</span>
<span class="cp">#define RFCOMM_RELEASE_ONHUP  1</span>
<span class="cp">#define RFCOMM_HANGUP_NOW     2</span>
<span class="cp">#define RFCOMM_TTY_ATTACHED   3</span>
<span class="cp">#define RFCOMM_TTY_RELEASED   4</span>

<span class="k">struct</span> <span class="n">rfcomm_dev_req</span> <span class="p">{</span>
	<span class="n">s16</span>      <span class="n">dev_id</span><span class="p">;</span>
	<span class="n">u32</span>      <span class="n">flags</span><span class="p">;</span>
	<span class="n">bdaddr_t</span> <span class="n">src</span><span class="p">;</span>
	<span class="n">bdaddr_t</span> <span class="n">dst</span><span class="p">;</span>
	<span class="n">u8</span>       <span class="n">channel</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rfcomm_dev_info</span> <span class="p">{</span>
	<span class="n">s16</span>      <span class="n">id</span><span class="p">;</span>
	<span class="n">u32</span>      <span class="n">flags</span><span class="p">;</span>
	<span class="n">u16</span>      <span class="n">state</span><span class="p">;</span>
	<span class="n">bdaddr_t</span> <span class="n">src</span><span class="p">;</span>
	<span class="n">bdaddr_t</span> <span class="n">dst</span><span class="p">;</span>
	<span class="n">u8</span>       <span class="n">channel</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">rfcomm_dev_list_req</span> <span class="p">{</span>
	<span class="n">u16</span>      <span class="n">dev_num</span><span class="p">;</span>
	<span class="k">struct</span>   <span class="n">rfcomm_dev_info</span> <span class="n">dev_info</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">};</span>

<span class="kt">int</span>  <span class="n">rfcomm_dev_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__user</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_BT_RFCOMM_TTY</span>
<span class="kt">int</span>  <span class="n">rfcomm_init_ttys</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">rfcomm_cleanup_ttys</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rfcomm_init_ttys</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">rfcomm_cleanup_ttys</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="cp">#endif</span>
<span class="cp">#endif </span><span class="cm">/* __RFCOMM_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
