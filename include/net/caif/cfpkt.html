<!DOCTYPE html>
<html><head><title>joekychen/linux » include › net › caif › cfpkt.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>cfpkt.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) ST-Ericsson AB 2010</span>
<span class="cm"> * Author:	Sjur Brendeland/sjur.brandeland@stericsson.com</span>
<span class="cm"> * License terms: GNU General Public License (GPL) version 2</span>
<span class="cm"> */</span>

<span class="cp">#ifndef CFPKT_H_</span>
<span class="cp">#define CFPKT_H_</span>
<span class="cp">#include &lt;net/caif/caif_layer.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="k">struct</span> <span class="n">cfpkt</span><span class="p">;</span>

<span class="cm">/* Create a CAIF packet.</span>
<span class="cm"> * len: Length of packet to be created</span>
<span class="cm"> * @return New packet.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">cfpkt_create</span><span class="p">(</span><span class="n">u16</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Destroy a CAIF Packet.</span>
<span class="cm"> * pkt Packet to be destoyed.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">cfpkt_destroy</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Extract header from packet.</span>
<span class="cm"> *</span>
<span class="cm"> * pkt Packet to extract header data from.</span>
<span class="cm"> * data Pointer to copy the header data into.</span>
<span class="cm"> * len Length of head data to copy.</span>
<span class="cm"> * @return zero on success and error code upon failure</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cfpkt_extr_head</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Peek header from packet.</span>
<span class="cm"> * Reads data from packet without changing packet.</span>
<span class="cm"> *</span>
<span class="cm"> * pkt Packet to extract header data from.</span>
<span class="cm"> * data Pointer to copy the header data into.</span>
<span class="cm"> * len Length of head data to copy.</span>
<span class="cm"> * @return zero on success and error code upon failure</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cfpkt_peek_head</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Extract header from trailer (end of packet).</span>
<span class="cm"> *</span>
<span class="cm"> * pkt Packet to extract header data from.</span>
<span class="cm"> * data Pointer to copy the trailer data into.</span>
<span class="cm"> * len Length of header data to copy.</span>
<span class="cm"> * @return zero on success and error code upon failure</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cfpkt_extr_trail</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Add header to packet.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * pkt Packet to add header data to.</span>
<span class="cm"> * data Pointer to data to copy into the header.</span>
<span class="cm"> * len Length of header data to copy.</span>
<span class="cm"> * @return zero on success and error code upon failure</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cfpkt_add_head</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Add trailer to packet.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * pkt Packet to add trailer data to.</span>
<span class="cm"> * data Pointer to data to copy into the trailer.</span>
<span class="cm"> * len Length of trailer data to copy.</span>
<span class="cm"> * @return zero on success and error code upon failure</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cfpkt_add_trail</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Pad trailer on packet.</span>
<span class="cm"> * Moves data pointer in packet, no content copied.</span>
<span class="cm"> *</span>
<span class="cm"> * pkt Packet in which to pad trailer.</span>
<span class="cm"> * len Length of padding to add.</span>
<span class="cm"> * @return zero on success and error code upon failure</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cfpkt_pad_trail</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Add a single byte to packet body (tail).</span>
<span class="cm"> *</span>
<span class="cm"> * pkt Packet in which to add byte.</span>
<span class="cm"> * data Byte to add.</span>
<span class="cm"> * @return zero on success and error code upon failure</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cfpkt_addbdy</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">data</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Add a data to packet body (tail).</span>
<span class="cm"> *</span>
<span class="cm"> * pkt Packet in which to add data.</span>
<span class="cm"> * data Pointer to data to copy into the packet body.</span>
<span class="cm"> * len Length of data to add.</span>
<span class="cm"> * @return zero on success and error code upon failure</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cfpkt_add_body</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Checks whether there are more data to process in packet.</span>
<span class="cm"> * pkt Packet to check.</span>
<span class="cm"> * @return true if more data are available in packet false otherwise</span>
<span class="cm"> */</span>
<span class="n">bool</span> <span class="n">cfpkt_more</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Checks whether the packet is erroneous,</span>
<span class="cm"> * i.e. if it has been attempted to extract more data than available in packet</span>
<span class="cm"> * or writing more data than has been allocated in cfpkt_create().</span>
<span class="cm"> * pkt Packet to check.</span>
<span class="cm"> * @return true on error false otherwise</span>
<span class="cm"> */</span>
<span class="n">bool</span> <span class="n">cfpkt_erroneous</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Get the packet length.</span>
<span class="cm"> * pkt Packet to get length from.</span>
<span class="cm"> * @return Number of bytes in packet.</span>
<span class="cm"> */</span>
<span class="n">u16</span> <span class="n">cfpkt_getlen</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Set the packet length, by adjusting the trailer pointer according to length.</span>
<span class="cm"> * pkt Packet to set length.</span>
<span class="cm"> * len Packet length.</span>
<span class="cm"> * @return Number of bytes in packet.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">cfpkt_setlen</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * cfpkt_append - Appends a packet&#39;s data to another packet.</span>
<span class="cm"> * dstpkt:    Packet to append data into, WILL BE FREED BY THIS FUNCTION</span>
<span class="cm"> * addpkt:    Packet to be appended and automatically released,</span>
<span class="cm"> *            WILL BE FREED BY THIS FUNCTION.</span>
<span class="cm"> * expectlen: Packet&#39;s expected total length. This should be considered</span>
<span class="cm"> *            as a hint.</span>
<span class="cm"> * NB: Input packets will be destroyed after appending and cannot be used</span>
<span class="cm"> * after calling this function.</span>
<span class="cm"> * @return    The new appended packet.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">cfpkt_append</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">dstpkt</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">addpkt</span><span class="p">,</span>
		      <span class="n">u16</span> <span class="n">expectlen</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * cfpkt_split - Split a packet into two packets at the specified split point.</span>
<span class="cm"> * pkt: Packet to be split (will contain the first part of the data on exit)</span>
<span class="cm"> * pos: Position to split packet in two parts.</span>
<span class="cm"> * @return The new packet, containing the second part of the data.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">cfpkt_split</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="n">u16</span> <span class="n">pos</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Iteration function, iterates the packet buffers from start to end.</span>
<span class="cm"> *</span>
<span class="cm"> * Checksum iteration function used to iterate buffers</span>
<span class="cm"> * (we may have packets consisting of a chain of buffers)</span>
<span class="cm"> * pkt:       Packet to calculate checksum for</span>
<span class="cm"> * iter_func: Function pointer to iteration function</span>
<span class="cm"> * chks:      Checksum calculated so far.</span>
<span class="cm"> * buf:       Pointer to the buffer to checksum</span>
<span class="cm"> * len:       Length of buf.</span>
<span class="cm"> * data:      Initial checksum value.</span>
<span class="cm"> * @return    Checksum of buffer.</span>
<span class="cm"> */</span>

<span class="n">u16</span> <span class="n">cfpkt_iterate</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span>
		<span class="n">u16</span> <span class="p">(</span><span class="o">*</span><span class="n">iter_func</span><span class="p">)(</span><span class="n">u16</span> <span class="n">chks</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">),</span>
		<span class="n">u16</span> <span class="n">data</span><span class="p">);</span>

<span class="cm">/* Map from a &quot;native&quot; packet (e.g. Linux Socket Buffer) to a CAIF packet.</span>
<span class="cm"> *  dir - Direction indicating whether this packet is to be sent or received.</span>
<span class="cm"> *  nativepkt  - The native packet to be transformed to a CAIF packet</span>
<span class="cm"> *  @return The mapped CAIF Packet CFPKT.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">cfpkt_fromnative</span><span class="p">(</span><span class="k">enum</span> <span class="n">caif_direction</span> <span class="n">dir</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">nativepkt</span><span class="p">);</span>

<span class="cm">/* Map from a CAIF packet to a &quot;native&quot; packet (e.g. Linux Socket Buffer).</span>
<span class="cm"> *  pkt  - The CAIF packet to be transformed into a &quot;native&quot; packet.</span>
<span class="cm"> *  @return The native packet transformed from a CAIF packet.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="o">*</span><span class="n">cfpkt_tonative</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Returns packet information for a packet.</span>
<span class="cm"> * pkt Packet to get info from;</span>
<span class="cm"> * @return Packet information</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">caif_payload_info</span> <span class="o">*</span><span class="n">cfpkt_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">);</span>

<span class="cm">/** cfpkt_set_prio - set priority for a CAIF packet.</span>
<span class="cm"> *</span>
<span class="cm"> * @pkt: The CAIF packet to be adjusted.</span>
<span class="cm"> * @prio: one of TC_PRIO_ constants.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">cfpkt_set_prio</span><span class="p">(</span><span class="k">struct</span> <span class="n">cfpkt</span> <span class="o">*</span><span class="n">pkt</span><span class="p">,</span> <span class="kt">int</span> <span class="n">prio</span><span class="p">);</span>

<span class="cp">#endif				</span><span class="cm">/* CFPKT_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
