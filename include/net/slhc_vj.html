<!DOCTYPE html>
<html><head><title>joekychen/linux » include › net › slhc_vj.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>slhc_vj.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _SLHC_H</span>
<span class="cp">#define _SLHC_H</span>
<span class="cm">/*</span>
<span class="cm"> * Definitions for tcp compression routines.</span>
<span class="cm"> *</span>
<span class="cm"> * $Header: slcompress.h,v 1.10 89/12/31 08:53:02 van Exp $</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 1989 Regents of the University of California.</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Redistribution and use in source and binary forms are permitted</span>
<span class="cm"> * provided that the above copyright notice and this paragraph are</span>
<span class="cm"> * duplicated in all such forms and that any documentation,</span>
<span class="cm"> * advertising materials, and other materials related to such</span>
<span class="cm"> * distribution and use acknowledge that the software was developed</span>
<span class="cm"> * by the University of California, Berkeley.  The name of the</span>
<span class="cm"> * University may not be used to endorse or promote products derived</span>
<span class="cm"> * from this software without specific prior written permission.</span>
<span class="cm"> * THIS SOFTWARE IS PROVIDED ``AS IS&#39;&#39; AND WITHOUT ANY EXPRESS OR</span>
<span class="cm"> * IMPLIED WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED</span>
<span class="cm"> * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
<span class="cm"> *</span>
<span class="cm"> *	Van Jacobson (van@helios.ee.lbl.gov), Dec 31, 1989:</span>
<span class="cm"> *	- Initial distribution.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * modified for KA9Q Internet Software Package by</span>
<span class="cm"> * Katie Stevens (dkstevens@ucdavis.edu)</span>
<span class="cm"> * University of California, Davis</span>
<span class="cm"> * Computing Services</span>
<span class="cm"> *	- 01-31-90	initial adaptation</span>
<span class="cm"> *</span>
<span class="cm"> *	- Feb 1991	Bill_Simpson@um.cc.umich.edu</span>
<span class="cm"> *			variable number of conversation slots</span>
<span class="cm"> *			allow zero or one slots</span>
<span class="cm"> *			separate routines</span>
<span class="cm"> *			status display</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Compressed packet format:</span>
<span class="cm"> *</span>
<span class="cm"> * The first octet contains the packet type (top 3 bits), TCP</span>
<span class="cm"> * &#39;push&#39; bit, and flags that indicate which of the 4 TCP sequence</span>
<span class="cm"> * numbers have changed (bottom 5 bits).  The next octet is a</span>
<span class="cm"> * conversation number that associates a saved IP/TCP header with</span>
<span class="cm"> * the compressed packet.  The next two octets are the TCP checksum</span>
<span class="cm"> * from the original datagram.  The next 0 to 15 octets are</span>
<span class="cm"> * sequence number changes, one change per bit set in the header</span>
<span class="cm"> * (there may be no changes and there are two special cases where</span>
<span class="cm"> * the receiver implicitly knows what changed -- see below).</span>
<span class="cm"> *</span>
<span class="cm"> * There are 5 numbers which can change (they are always inserted</span>
<span class="cm"> * in the following order): TCP urgent pointer, window,</span>
<span class="cm"> * acknowledgment, sequence number and IP ID.  (The urgent pointer</span>
<span class="cm"> * is different from the others in that its value is sent, not the</span>
<span class="cm"> * change in value.)  Since typical use of SLIP links is biased</span>
<span class="cm"> * toward small packets (see comments on MTU/MSS below), changes</span>
<span class="cm"> * use a variable length coding with one octet for numbers in the</span>
<span class="cm"> * range 1 - 255 and 3 octets (0, MSB, LSB) for numbers in the</span>
<span class="cm"> * range 256 - 65535 or 0.  (If the change in sequence number or</span>
<span class="cm"> * ack is more than 65535, an uncompressed packet is sent.)</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Packet types (must not conflict with IP protocol version)</span>
<span class="cm"> *</span>
<span class="cm"> * The top nibble of the first octet is the packet type.  There are</span>
<span class="cm"> * three possible types: IP (not proto TCP or tcp with one of the</span>
<span class="cm"> * control flags set); uncompressed TCP (a normal IP/TCP packet but</span>
<span class="cm"> * with the 8-bit protocol field replaced by an 8-bit connection id --</span>
<span class="cm"> * this type of packet syncs the sender &amp; receiver); and compressed</span>
<span class="cm"> * TCP (described above).</span>
<span class="cm"> *</span>
<span class="cm"> * LSB of 4-bit field is TCP &quot;PUSH&quot; bit (a worthless anachronism) and</span>
<span class="cm"> * is logically part of the 4-bit &quot;changes&quot; field that follows.  Top</span>
<span class="cm"> * three bits are actual packet type.  For backward compatibility</span>
<span class="cm"> * and in the interest of conserving bits, numbers are chosen so the</span>
<span class="cm"> * IP protocol version number (4) which normally appears in this nibble</span>
<span class="cm"> * means &quot;IP packet&quot;.</span>
<span class="cm"> */</span>


<span class="cp">#include &lt;linux/ip.h&gt;</span>
<span class="cp">#include &lt;linux/tcp.h&gt;</span>

<span class="cm">/* SLIP compression masks for len/vers byte */</span>
<span class="cp">#define SL_TYPE_IP 0x40</span>
<span class="cp">#define SL_TYPE_UNCOMPRESSED_TCP 0x70</span>
<span class="cp">#define SL_TYPE_COMPRESSED_TCP 0x80</span>
<span class="cp">#define SL_TYPE_ERROR 0x00</span>

<span class="cm">/* Bits in first octet of compressed packet */</span>
<span class="cp">#define NEW_C	0x40	</span><span class="cm">/* flag bits for what changed in a packet */</span><span class="cp"></span>
<span class="cp">#define NEW_I	0x20</span>
<span class="cp">#define NEW_S	0x08</span>
<span class="cp">#define NEW_A	0x04</span>
<span class="cp">#define NEW_W	0x02</span>
<span class="cp">#define NEW_U	0x01</span>

<span class="cm">/* reserved, special-case values of above */</span>
<span class="cp">#define SPECIAL_I (NEW_S|NEW_W|NEW_U)		</span><span class="cm">/* echoed interactive traffic */</span><span class="cp"></span>
<span class="cp">#define SPECIAL_D (NEW_S|NEW_A|NEW_W|NEW_U)	</span><span class="cm">/* unidirectional data */</span><span class="cp"></span>
<span class="cp">#define SPECIALS_MASK (NEW_S|NEW_A|NEW_W|NEW_U)</span>

<span class="cp">#define TCP_PUSH_BIT 0x10</span>

<span class="cm">/*</span>
<span class="cm"> * data type and sizes conversion assumptions:</span>
<span class="cm"> *</span>
<span class="cm"> *	VJ code		KA9Q style	generic</span>
<span class="cm"> *	u_char		byte_t		unsigned char	 8 bits</span>
<span class="cm"> *	u_short		int16		unsigned short	16 bits</span>
<span class="cm"> *	u_int		int16		unsigned short	16 bits</span>
<span class="cm"> *	u_long		unsigned long	unsigned long	32 bits</span>
<span class="cm"> *	int		int32		long		32 bits</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="n">__u8</span> <span class="n">byte_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">__u32</span> <span class="n">int32</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * &quot;state&quot; data for each active tcp conversation on the wire.  This is</span>
<span class="cm"> * basically a copy of the entire IP/TCP header from the last packet</span>
<span class="cm"> * we saw from the conversation together with a small identifier</span>
<span class="cm"> * the transmit &amp; receive ends of the line use to locate saved header.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">cstate</span> <span class="p">{</span>
	<span class="n">byte_t</span>	<span class="n">cs_this</span><span class="p">;</span>	<span class="cm">/* connection id number (xmit) */</span>
	<span class="k">struct</span> <span class="n">cstate</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>	<span class="cm">/* next in ring (xmit) */</span>
	<span class="k">struct</span> <span class="n">iphdr</span> <span class="n">cs_ip</span><span class="p">;</span>	<span class="cm">/* ip/tcp hdr from most recent packet */</span>
	<span class="k">struct</span> <span class="n">tcphdr</span> <span class="n">cs_tcp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cs_ipopt</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cs_tcpopt</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">cs_hsize</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define NULLSLSTATE	(struct cstate *)0</span>

<span class="cm">/*</span>
<span class="cm"> * all the state data for one serial line (we need one of these per line).</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">slcompress</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cstate</span> <span class="o">*</span><span class="n">tstate</span><span class="p">;</span>	<span class="cm">/* transmit connection states (array)*/</span>
	<span class="k">struct</span> <span class="n">cstate</span> <span class="o">*</span><span class="n">rstate</span><span class="p">;</span>	<span class="cm">/* receive connection states (array)*/</span>

	<span class="n">byte_t</span> <span class="n">tslot_limit</span><span class="p">;</span>	<span class="cm">/* highest transmit slot id (0-l)*/</span>
	<span class="n">byte_t</span> <span class="n">rslot_limit</span><span class="p">;</span>	<span class="cm">/* highest receive slot id (0-l)*/</span>

	<span class="n">byte_t</span> <span class="n">xmit_oldest</span><span class="p">;</span>	<span class="cm">/* oldest xmit in ring */</span>
	<span class="n">byte_t</span> <span class="n">xmit_current</span><span class="p">;</span>	<span class="cm">/* most recent xmit id */</span>
	<span class="n">byte_t</span> <span class="n">recv_current</span><span class="p">;</span>	<span class="cm">/* most recent rcvd id */</span>

	<span class="n">byte_t</span> <span class="n">flags</span><span class="p">;</span>
<span class="cp">#define SLF_TOSS	0x01	</span><span class="cm">/* tossing rcvd frames until id received */</span><span class="cp"></span>

	<span class="n">int32</span> <span class="n">sls_o_nontcp</span><span class="p">;</span>	<span class="cm">/* outbound non-TCP packets */</span>
	<span class="n">int32</span> <span class="n">sls_o_tcp</span><span class="p">;</span>	<span class="cm">/* outbound TCP packets */</span>
	<span class="n">int32</span> <span class="n">sls_o_uncompressed</span><span class="p">;</span>	<span class="cm">/* outbound uncompressed packets */</span>
	<span class="n">int32</span> <span class="n">sls_o_compressed</span><span class="p">;</span>	<span class="cm">/* outbound compressed packets */</span>
	<span class="n">int32</span> <span class="n">sls_o_searches</span><span class="p">;</span>	<span class="cm">/* searches for connection state */</span>
	<span class="n">int32</span> <span class="n">sls_o_misses</span><span class="p">;</span>	<span class="cm">/* times couldn&#39;t find conn. state */</span>

	<span class="n">int32</span> <span class="n">sls_i_uncompressed</span><span class="p">;</span>	<span class="cm">/* inbound uncompressed packets */</span>
	<span class="n">int32</span> <span class="n">sls_i_compressed</span><span class="p">;</span>	<span class="cm">/* inbound compressed packets */</span>
	<span class="n">int32</span> <span class="n">sls_i_error</span><span class="p">;</span>	<span class="cm">/* inbound error packets */</span>
	<span class="n">int32</span> <span class="n">sls_i_tossed</span><span class="p">;</span>	<span class="cm">/* inbound packets tossed because of error */</span>

	<span class="n">int32</span> <span class="n">sls_i_runt</span><span class="p">;</span>
	<span class="n">int32</span> <span class="n">sls_i_badcheck</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define NULLSLCOMPR	(struct slcompress *)0</span>

<span class="cm">/* In slhc.c: */</span>
<span class="k">struct</span> <span class="n">slcompress</span> <span class="o">*</span><span class="n">slhc_init</span><span class="p">(</span><span class="kt">int</span> <span class="n">rslots</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tslots</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">slhc_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">slcompress</span> <span class="o">*</span><span class="n">comp</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">slhc_compress</span><span class="p">(</span><span class="k">struct</span> <span class="n">slcompress</span> <span class="o">*</span><span class="n">comp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">icp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">isize</span><span class="p">,</span>
		  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ocp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">cpp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">compress_cid</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">slhc_uncompress</span><span class="p">(</span><span class="k">struct</span> <span class="n">slcompress</span> <span class="o">*</span><span class="n">comp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">icp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">isize</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">slhc_remember</span><span class="p">(</span><span class="k">struct</span> <span class="n">slcompress</span> <span class="o">*</span><span class="n">comp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">icp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">isize</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">slhc_toss</span><span class="p">(</span><span class="k">struct</span> <span class="n">slcompress</span> <span class="o">*</span><span class="n">comp</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* _SLHC_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
