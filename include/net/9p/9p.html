<!DOCTYPE html>
<html><head><title>joekychen/linux » include › net › 9p › 9p.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>9p.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * include/net/9p/9p.h</span>
<span class="cm"> *</span>
<span class="cm"> * 9P protocol definitions.</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 2005 by Latchesar Ionkov &lt;lucho@ionkov.net&gt;</span>
<span class="cm"> *  Copyright (C) 2004 by Eric Van Hensbergen &lt;ericvh@gmail.com&gt;</span>
<span class="cm"> *  Copyright (C) 2002 by Ron Minnich &lt;rminnich@lanl.gov&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License version 2</span>
<span class="cm"> *  as published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to:</span>
<span class="cm"> *  Free Software Foundation</span>
<span class="cm"> *  51 Franklin Street, Fifth Floor</span>
<span class="cm"> *  Boston, MA  02111-1301  USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef NET_9P_H</span>
<span class="cp">#define NET_9P_H</span>

<span class="cm">/**</span>
<span class="cm"> * enum p9_debug_flags - bits for mount time debug parameter</span>
<span class="cm"> * @P9_DEBUG_ERROR: more verbose error messages including original error string</span>
<span class="cm"> * @P9_DEBUG_9P: 9P protocol tracing</span>
<span class="cm"> * @P9_DEBUG_VFS: VFS API tracing</span>
<span class="cm"> * @P9_DEBUG_CONV: protocol conversion tracing</span>
<span class="cm"> * @P9_DEBUG_MUX: trace management of concurrent transactions</span>
<span class="cm"> * @P9_DEBUG_TRANS: transport tracing</span>
<span class="cm"> * @P9_DEBUG_SLABS: memory management tracing</span>
<span class="cm"> * @P9_DEBUG_FCALL: verbose dump of protocol messages</span>
<span class="cm"> * @P9_DEBUG_FID: fid allocation/deallocation tracking</span>
<span class="cm"> * @P9_DEBUG_PKT: packet marshalling/unmarshalling</span>
<span class="cm"> * @P9_DEBUG_FSC: FS-cache tracing</span>
<span class="cm"> * @P9_DEBUG_VPKT: Verbose packet debugging (full packet dump)</span>
<span class="cm"> *</span>
<span class="cm"> * These flags are passed at mount time to turn on various levels of</span>
<span class="cm"> * verbosity and tracing which will be output to the system logs.</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="n">p9_debug_flags</span> <span class="p">{</span>
	<span class="n">P9_DEBUG_ERROR</span> <span class="o">=</span> 	<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">0</span><span class="p">),</span>
	<span class="n">P9_DEBUG_9P</span> <span class="o">=</span> 		<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">),</span>
	<span class="n">P9_DEBUG_VFS</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">3</span><span class="p">),</span>
	<span class="n">P9_DEBUG_CONV</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">4</span><span class="p">),</span>
	<span class="n">P9_DEBUG_MUX</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">5</span><span class="p">),</span>
	<span class="n">P9_DEBUG_TRANS</span> <span class="o">=</span>	<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">6</span><span class="p">),</span>
	<span class="n">P9_DEBUG_SLABS</span> <span class="o">=</span>      	<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">7</span><span class="p">),</span>
	<span class="n">P9_DEBUG_FCALL</span> <span class="o">=</span>	<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">),</span>
	<span class="n">P9_DEBUG_FID</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">9</span><span class="p">),</span>
	<span class="n">P9_DEBUG_PKT</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">10</span><span class="p">),</span>
	<span class="n">P9_DEBUG_FSC</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">11</span><span class="p">),</span>
	<span class="n">P9_DEBUG_VPKT</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">12</span><span class="p">),</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_NET_9P_DEBUG</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">p9_debug_level</span><span class="p">;</span>
<span class="n">__printf</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="kt">void</span> <span class="n">_p9_debug</span><span class="p">(</span><span class="k">enum</span> <span class="n">p9_debug_flags</span> <span class="n">level</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">func</span><span class="p">,</span>
	       <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
<span class="cp">#define p9_debug(level, fmt, ...)			\</span>
<span class="cp">	_p9_debug(level, __func__, fmt, ##__VA_ARGS__)</span>
<span class="cp">#else</span>
<span class="cp">#define p9_debug(level, fmt, ...)			\</span>
<span class="cp">	no_printk(fmt, ##__VA_ARGS__)</span>
<span class="cp">#endif</span>

<span class="cm">/**</span>
<span class="cm"> * enum p9_msg_t - 9P message types</span>
<span class="cm"> * @P9_TLERROR: not used</span>
<span class="cm"> * @P9_RLERROR: response for any failed request for 9P2000.L</span>
<span class="cm"> * @P9_TSTATFS: file system status request</span>
<span class="cm"> * @P9_RSTATFS: file system status response</span>
<span class="cm"> * @P9_TSYMLINK: make symlink request</span>
<span class="cm"> * @P9_RSYMLINK: make symlink response</span>
<span class="cm"> * @P9_TMKNOD: create a special file object request</span>
<span class="cm"> * @P9_RMKNOD: create a special file object response</span>
<span class="cm"> * @P9_TLCREATE: prepare a handle for I/O on an new file for 9P2000.L</span>
<span class="cm"> * @P9_RLCREATE: response with file access information for 9P2000.L</span>
<span class="cm"> * @P9_TRENAME: rename request</span>
<span class="cm"> * @P9_RRENAME: rename response</span>
<span class="cm"> * @P9_TMKDIR: create a directory request</span>
<span class="cm"> * @P9_RMKDIR: create a directory response</span>
<span class="cm"> * @P9_TVERSION: version handshake request</span>
<span class="cm"> * @P9_RVERSION: version handshake response</span>
<span class="cm"> * @P9_TAUTH: request to establish authentication channel</span>
<span class="cm"> * @P9_RAUTH: response with authentication information</span>
<span class="cm"> * @P9_TATTACH: establish user access to file service</span>
<span class="cm"> * @P9_RATTACH: response with top level handle to file hierarchy</span>
<span class="cm"> * @P9_TERROR: not used</span>
<span class="cm"> * @P9_RERROR: response for any failed request</span>
<span class="cm"> * @P9_TFLUSH: request to abort a previous request</span>
<span class="cm"> * @P9_RFLUSH: response when previous request has been cancelled</span>
<span class="cm"> * @P9_TWALK: descend a directory hierarchy</span>
<span class="cm"> * @P9_RWALK: response with new handle for position within hierarchy</span>
<span class="cm"> * @P9_TOPEN: prepare a handle for I/O on an existing file</span>
<span class="cm"> * @P9_ROPEN: response with file access information</span>
<span class="cm"> * @P9_TCREATE: prepare a handle for I/O on a new file</span>
<span class="cm"> * @P9_RCREATE: response with file access information</span>
<span class="cm"> * @P9_TREAD: request to transfer data from a file or directory</span>
<span class="cm"> * @P9_RREAD: response with data requested</span>
<span class="cm"> * @P9_TWRITE: reuqest to transfer data to a file</span>
<span class="cm"> * @P9_RWRITE: response with out much data was transferred to file</span>
<span class="cm"> * @P9_TCLUNK: forget about a handle to an entity within the file system</span>
<span class="cm"> * @P9_RCLUNK: response when server has forgotten about the handle</span>
<span class="cm"> * @P9_TREMOVE: request to remove an entity from the hierarchy</span>
<span class="cm"> * @P9_RREMOVE: response when server has removed the entity</span>
<span class="cm"> * @P9_TSTAT: request file entity attributes</span>
<span class="cm"> * @P9_RSTAT: response with file entity attributes</span>
<span class="cm"> * @P9_TWSTAT: request to update file entity attributes</span>
<span class="cm"> * @P9_RWSTAT: response when file entity attributes are updated</span>
<span class="cm"> *</span>
<span class="cm"> * There are 14 basic operations in 9P2000, paired as</span>
<span class="cm"> * requests and responses.  The one special case is ERROR</span>
<span class="cm"> * as there is no @P9_TERROR request for clients to transmit to</span>
<span class="cm"> * the server, but the server may respond to any other request</span>
<span class="cm"> * with an @P9_RERROR.</span>
<span class="cm"> *</span>
<span class="cm"> * See Also: http://plan9.bell-labs.com/sys/man/5/INDEX.html</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="n">p9_msg_t</span> <span class="p">{</span>
	<span class="n">P9_TLERROR</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">P9_RLERROR</span><span class="p">,</span>
	<span class="n">P9_TSTATFS</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="n">P9_RSTATFS</span><span class="p">,</span>
	<span class="n">P9_TLOPEN</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
	<span class="n">P9_RLOPEN</span><span class="p">,</span>
	<span class="n">P9_TLCREATE</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span>
	<span class="n">P9_RLCREATE</span><span class="p">,</span>
	<span class="n">P9_TSYMLINK</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="n">P9_RSYMLINK</span><span class="p">,</span>
	<span class="n">P9_TMKNOD</span> <span class="o">=</span> <span class="mi">18</span><span class="p">,</span>
	<span class="n">P9_RMKNOD</span><span class="p">,</span>
	<span class="n">P9_TRENAME</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
	<span class="n">P9_RRENAME</span><span class="p">,</span>
	<span class="n">P9_TREADLINK</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span>
	<span class="n">P9_RREADLINK</span><span class="p">,</span>
	<span class="n">P9_TGETATTR</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
	<span class="n">P9_RGETATTR</span><span class="p">,</span>
	<span class="n">P9_TSETATTR</span> <span class="o">=</span> <span class="mi">26</span><span class="p">,</span>
	<span class="n">P9_RSETATTR</span><span class="p">,</span>
	<span class="n">P9_TXATTRWALK</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
	<span class="n">P9_RXATTRWALK</span><span class="p">,</span>
	<span class="n">P9_TXATTRCREATE</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
	<span class="n">P9_RXATTRCREATE</span><span class="p">,</span>
	<span class="n">P9_TREADDIR</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
	<span class="n">P9_RREADDIR</span><span class="p">,</span>
	<span class="n">P9_TFSYNC</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
	<span class="n">P9_RFSYNC</span><span class="p">,</span>
	<span class="n">P9_TLOCK</span> <span class="o">=</span> <span class="mi">52</span><span class="p">,</span>
	<span class="n">P9_RLOCK</span><span class="p">,</span>
	<span class="n">P9_TGETLOCK</span> <span class="o">=</span> <span class="mi">54</span><span class="p">,</span>
	<span class="n">P9_RGETLOCK</span><span class="p">,</span>
	<span class="n">P9_TLINK</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>
	<span class="n">P9_RLINK</span><span class="p">,</span>
	<span class="n">P9_TMKDIR</span> <span class="o">=</span> <span class="mi">72</span><span class="p">,</span>
	<span class="n">P9_RMKDIR</span><span class="p">,</span>
	<span class="n">P9_TRENAMEAT</span> <span class="o">=</span> <span class="mi">74</span><span class="p">,</span>
	<span class="n">P9_RRENAMEAT</span><span class="p">,</span>
	<span class="n">P9_TUNLINKAT</span> <span class="o">=</span> <span class="mi">76</span><span class="p">,</span>
	<span class="n">P9_RUNLINKAT</span><span class="p">,</span>
	<span class="n">P9_TVERSION</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
	<span class="n">P9_RVERSION</span><span class="p">,</span>
	<span class="n">P9_TAUTH</span> <span class="o">=</span> <span class="mi">102</span><span class="p">,</span>
	<span class="n">P9_RAUTH</span><span class="p">,</span>
	<span class="n">P9_TATTACH</span> <span class="o">=</span> <span class="mi">104</span><span class="p">,</span>
	<span class="n">P9_RATTACH</span><span class="p">,</span>
	<span class="n">P9_TERROR</span> <span class="o">=</span> <span class="mi">106</span><span class="p">,</span>
	<span class="n">P9_RERROR</span><span class="p">,</span>
	<span class="n">P9_TFLUSH</span> <span class="o">=</span> <span class="mi">108</span><span class="p">,</span>
	<span class="n">P9_RFLUSH</span><span class="p">,</span>
	<span class="n">P9_TWALK</span> <span class="o">=</span> <span class="mi">110</span><span class="p">,</span>
	<span class="n">P9_RWALK</span><span class="p">,</span>
	<span class="n">P9_TOPEN</span> <span class="o">=</span> <span class="mi">112</span><span class="p">,</span>
	<span class="n">P9_ROPEN</span><span class="p">,</span>
	<span class="n">P9_TCREATE</span> <span class="o">=</span> <span class="mi">114</span><span class="p">,</span>
	<span class="n">P9_RCREATE</span><span class="p">,</span>
	<span class="n">P9_TREAD</span> <span class="o">=</span> <span class="mi">116</span><span class="p">,</span>
	<span class="n">P9_RREAD</span><span class="p">,</span>
	<span class="n">P9_TWRITE</span> <span class="o">=</span> <span class="mi">118</span><span class="p">,</span>
	<span class="n">P9_RWRITE</span><span class="p">,</span>
	<span class="n">P9_TCLUNK</span> <span class="o">=</span> <span class="mi">120</span><span class="p">,</span>
	<span class="n">P9_RCLUNK</span><span class="p">,</span>
	<span class="n">P9_TREMOVE</span> <span class="o">=</span> <span class="mi">122</span><span class="p">,</span>
	<span class="n">P9_RREMOVE</span><span class="p">,</span>
	<span class="n">P9_TSTAT</span> <span class="o">=</span> <span class="mi">124</span><span class="p">,</span>
	<span class="n">P9_RSTAT</span><span class="p">,</span>
	<span class="n">P9_TWSTAT</span> <span class="o">=</span> <span class="mi">126</span><span class="p">,</span>
	<span class="n">P9_RWSTAT</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum p9_open_mode_t - 9P open modes</span>
<span class="cm"> * @P9_OREAD: open file for reading only</span>
<span class="cm"> * @P9_OWRITE: open file for writing only</span>
<span class="cm"> * @P9_ORDWR: open file for reading or writing</span>
<span class="cm"> * @P9_OEXEC: open file for execution</span>
<span class="cm"> * @P9_OTRUNC: truncate file to zero-length before opening it</span>
<span class="cm"> * @P9_OREXEC: close the file when an exec(2) system call is made</span>
<span class="cm"> * @P9_ORCLOSE: remove the file when the file is closed</span>
<span class="cm"> * @P9_OAPPEND: open the file and seek to the end</span>
<span class="cm"> * @P9_OEXCL: only create a file, do not open it</span>
<span class="cm"> *</span>
<span class="cm"> * 9P open modes differ slightly from Posix standard modes.</span>
<span class="cm"> * In particular, there are extra modes which specify different</span>
<span class="cm"> * semantic behaviors than may be available on standard Posix</span>
<span class="cm"> * systems.  For example, @P9_OREXEC and @P9_ORCLOSE are modes that</span>
<span class="cm"> * most likely will not be issued from the Linux VFS client, but may</span>
<span class="cm"> * be supported by servers.</span>
<span class="cm"> *</span>
<span class="cm"> * See Also: http://plan9.bell-labs.com/magic/man2html/2/open</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="n">p9_open_mode_t</span> <span class="p">{</span>
	<span class="n">P9_OREAD</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="n">P9_OWRITE</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">P9_ORDWR</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">P9_OEXEC</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="n">P9_OTRUNC</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">P9_OREXEC</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">P9_ORCLOSE</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">P9_OAPPEND</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="n">P9_OEXCL</span> <span class="o">=</span> <span class="mh">0x1000</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * enum p9_perm_t - 9P permissions</span>
<span class="cm"> * @P9_DMDIR: mode bit for directories</span>
<span class="cm"> * @P9_DMAPPEND: mode bit for is append-only</span>
<span class="cm"> * @P9_DMEXCL: mode bit for excluse use (only one open handle allowed)</span>
<span class="cm"> * @P9_DMMOUNT: mode bit for mount points</span>
<span class="cm"> * @P9_DMAUTH: mode bit for authentication file</span>
<span class="cm"> * @P9_DMTMP: mode bit for non-backed-up files</span>
<span class="cm"> * @P9_DMSYMLINK: mode bit for symbolic links (9P2000.u)</span>
<span class="cm"> * @P9_DMLINK: mode bit for hard-link (9P2000.u)</span>
<span class="cm"> * @P9_DMDEVICE: mode bit for device files (9P2000.u)</span>
<span class="cm"> * @P9_DMNAMEDPIPE: mode bit for named pipe (9P2000.u)</span>
<span class="cm"> * @P9_DMSOCKET: mode bit for socket (9P2000.u)</span>
<span class="cm"> * @P9_DMSETUID: mode bit for setuid (9P2000.u)</span>
<span class="cm"> * @P9_DMSETGID: mode bit for setgid (9P2000.u)</span>
<span class="cm"> * @P9_DMSETVTX: mode bit for sticky bit (9P2000.u)</span>
<span class="cm"> *</span>
<span class="cm"> * 9P permissions differ slightly from Posix standard modes.</span>
<span class="cm"> *</span>
<span class="cm"> * See Also: http://plan9.bell-labs.com/magic/man2html/2/stat</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">p9_perm_t</span> <span class="p">{</span>
	<span class="n">P9_DMDIR</span> <span class="o">=</span> <span class="mh">0x80000000</span><span class="p">,</span>
	<span class="n">P9_DMAPPEND</span> <span class="o">=</span> <span class="mh">0x40000000</span><span class="p">,</span>
	<span class="n">P9_DMEXCL</span> <span class="o">=</span> <span class="mh">0x20000000</span><span class="p">,</span>
	<span class="n">P9_DMMOUNT</span> <span class="o">=</span> <span class="mh">0x10000000</span><span class="p">,</span>
	<span class="n">P9_DMAUTH</span> <span class="o">=</span> <span class="mh">0x08000000</span><span class="p">,</span>
	<span class="n">P9_DMTMP</span> <span class="o">=</span> <span class="mh">0x04000000</span><span class="p">,</span>
<span class="cm">/* 9P2000.u extensions */</span>
	<span class="n">P9_DMSYMLINK</span> <span class="o">=</span> <span class="mh">0x02000000</span><span class="p">,</span>
	<span class="n">P9_DMLINK</span> <span class="o">=</span> <span class="mh">0x01000000</span><span class="p">,</span>
	<span class="n">P9_DMDEVICE</span> <span class="o">=</span> <span class="mh">0x00800000</span><span class="p">,</span>
	<span class="n">P9_DMNAMEDPIPE</span> <span class="o">=</span> <span class="mh">0x00200000</span><span class="p">,</span>
	<span class="n">P9_DMSOCKET</span> <span class="o">=</span> <span class="mh">0x00100000</span><span class="p">,</span>
	<span class="n">P9_DMSETUID</span> <span class="o">=</span> <span class="mh">0x00080000</span><span class="p">,</span>
	<span class="n">P9_DMSETGID</span> <span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>
	<span class="n">P9_DMSETVTX</span> <span class="o">=</span> <span class="mh">0x00010000</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* 9p2000.L open flags */</span>
<span class="cp">#define P9_DOTL_RDONLY        00000000</span>
<span class="cp">#define P9_DOTL_WRONLY        00000001</span>
<span class="cp">#define P9_DOTL_RDWR          00000002</span>
<span class="cp">#define P9_DOTL_NOACCESS      00000003</span>
<span class="cp">#define P9_DOTL_CREATE        00000100</span>
<span class="cp">#define P9_DOTL_EXCL          00000200</span>
<span class="cp">#define P9_DOTL_NOCTTY        00000400</span>
<span class="cp">#define P9_DOTL_TRUNC         00001000</span>
<span class="cp">#define P9_DOTL_APPEND        00002000</span>
<span class="cp">#define P9_DOTL_NONBLOCK      00004000</span>
<span class="cp">#define P9_DOTL_DSYNC         00010000</span>
<span class="cp">#define P9_DOTL_FASYNC        00020000</span>
<span class="cp">#define P9_DOTL_DIRECT        00040000</span>
<span class="cp">#define P9_DOTL_LARGEFILE     00100000</span>
<span class="cp">#define P9_DOTL_DIRECTORY     00200000</span>
<span class="cp">#define P9_DOTL_NOFOLLOW      00400000</span>
<span class="cp">#define P9_DOTL_NOATIME       01000000</span>
<span class="cp">#define P9_DOTL_CLOEXEC       02000000</span>
<span class="cp">#define P9_DOTL_SYNC          04000000</span>

<span class="cm">/* 9p2000.L at flags */</span>
<span class="cp">#define P9_DOTL_AT_REMOVEDIR		0x200</span>

<span class="cm">/* 9p2000.L lock type */</span>
<span class="cp">#define P9_LOCK_TYPE_RDLCK 0</span>
<span class="cp">#define P9_LOCK_TYPE_WRLCK 1</span>
<span class="cp">#define P9_LOCK_TYPE_UNLCK 2</span>

<span class="cm">/**</span>
<span class="cm"> * enum p9_qid_t - QID types</span>
<span class="cm"> * @P9_QTDIR: directory</span>
<span class="cm"> * @P9_QTAPPEND: append-only</span>
<span class="cm"> * @P9_QTEXCL: excluse use (only one open handle allowed)</span>
<span class="cm"> * @P9_QTMOUNT: mount points</span>
<span class="cm"> * @P9_QTAUTH: authentication file</span>
<span class="cm"> * @P9_QTTMP: non-backed-up files</span>
<span class="cm"> * @P9_QTSYMLINK: symbolic links (9P2000.u)</span>
<span class="cm"> * @P9_QTLINK: hard-link (9P2000.u)</span>
<span class="cm"> * @P9_QTFILE: normal files</span>
<span class="cm"> *</span>
<span class="cm"> * QID types are a subset of permissions - they are primarily</span>
<span class="cm"> * used to differentiate semantics for a file system entity via</span>
<span class="cm"> * a jump-table.  Their value is also the most significant 16 bits</span>
<span class="cm"> * of the permission_t</span>
<span class="cm"> *</span>
<span class="cm"> * See Also: http://plan9.bell-labs.com/magic/man2html/2/stat</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">p9_qid_t</span> <span class="p">{</span>
	<span class="n">P9_QTDIR</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="n">P9_QTAPPEND</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">P9_QTEXCL</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">P9_QTMOUNT</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">P9_QTAUTH</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">P9_QTTMP</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">P9_QTSYMLINK</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">P9_QTLINK</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">P9_QTFILE</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* 9P Magic Numbers */</span>
<span class="cp">#define P9_NOTAG	(u16)(~0)</span>
<span class="cp">#define P9_NOFID	(u32)(~0)</span>
<span class="cp">#define P9_MAXWELEM	16</span>

<span class="cm">/* ample room for Twrite/Rread header */</span>
<span class="cp">#define P9_IOHDRSZ	24</span>

<span class="cm">/* Room for readdir header */</span>
<span class="cp">#define P9_READDIRHDRSZ	24</span>

<span class="cm">/* size of header for zero copy read/write */</span>
<span class="cp">#define P9_ZC_HDR_SZ 4096</span>

<span class="cm">/**</span>
<span class="cm"> * struct p9_qid - file system entity information</span>
<span class="cm"> * @type: 8-bit type &amp;p9_qid_t</span>
<span class="cm"> * @version: 16-bit monotonically incrementing version number</span>
<span class="cm"> * @path: 64-bit per-server-unique ID for a file system element</span>
<span class="cm"> *</span>
<span class="cm"> * qids are identifiers used by 9P servers to track file system</span>
<span class="cm"> * entities.  The type is used to differentiate semantics for operations</span>
<span class="cm"> * on the entity (ie. read means something different on a directory than</span>
<span class="cm"> * on a file).  The path provides a server unique index for an entity</span>
<span class="cm"> * (roughly analogous to an inode number), while the version is updated</span>
<span class="cm"> * every time a file is modified and can be used to maintain cache</span>
<span class="cm"> * coherency between clients and serves.</span>
<span class="cm"> * Servers will often differentiate purely synthetic entities by setting</span>
<span class="cm"> * their version to 0, signaling that they should never be cached and</span>
<span class="cm"> * should be accessed synchronously.</span>
<span class="cm"> *</span>
<span class="cm"> * See Also://plan9.bell-labs.com/magic/man2html/2/stat</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">p9_qid</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">version</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">path</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct p9_wstat - file system metadata information</span>
<span class="cm"> * @size: length prefix for this stat structure instance</span>
<span class="cm"> * @type: the type of the server (equivalent to a major number)</span>
<span class="cm"> * @dev: the sub-type of the server (equivalent to a minor number)</span>
<span class="cm"> * @qid: unique id from the server of type &amp;p9_qid</span>
<span class="cm"> * @mode: Plan 9 format permissions of type &amp;p9_perm_t</span>
<span class="cm"> * @atime: Last access/read time</span>
<span class="cm"> * @mtime: Last modify/write time</span>
<span class="cm"> * @length: file length</span>
<span class="cm"> * @name: last element of path (aka filename)</span>
<span class="cm"> * @uid: owner name</span>
<span class="cm"> * @gid: group owner</span>
<span class="cm"> * @muid: last modifier</span>
<span class="cm"> * @extension: area used to encode extended UNIX support</span>
<span class="cm"> * @n_uid: numeric user id of owner (part of 9p2000.u extension)</span>
<span class="cm"> * @n_gid: numeric group id (part of 9p2000.u extension)</span>
<span class="cm"> * @n_muid: numeric user id of laster modifier (part of 9p2000.u extension)</span>
<span class="cm"> *</span>
<span class="cm"> * See Also: http://plan9.bell-labs.com/magic/man2html/2/stat</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">p9_wstat</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">p9_qid</span> <span class="n">qid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mode</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">atime</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mtime</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">length</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">uid</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">gid</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">muid</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">extension</span><span class="p">;</span>	<span class="cm">/* 9p2000.u extensions */</span>
	<span class="n">u32</span> <span class="n">n_uid</span><span class="p">;</span>		<span class="cm">/* 9p2000.u extensions */</span>
	<span class="n">u32</span> <span class="n">n_gid</span><span class="p">;</span>		<span class="cm">/* 9p2000.u extensions */</span>
	<span class="n">u32</span> <span class="n">n_muid</span><span class="p">;</span>		<span class="cm">/* 9p2000.u extensions */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">p9_stat_dotl</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">st_result_mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">p9_qid</span> <span class="n">qid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">st_mode</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">st_uid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">st_gid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_nlink</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_rdev</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_size</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_blksize</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_blocks</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_atime_sec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_atime_nsec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_mtime_sec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_mtime_nsec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_ctime_sec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_ctime_nsec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_btime_sec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_btime_nsec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_gen</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">st_data_version</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define P9_STATS_MODE		0x00000001ULL</span>
<span class="cp">#define P9_STATS_NLINK		0x00000002ULL</span>
<span class="cp">#define P9_STATS_UID		0x00000004ULL</span>
<span class="cp">#define P9_STATS_GID		0x00000008ULL</span>
<span class="cp">#define P9_STATS_RDEV		0x00000010ULL</span>
<span class="cp">#define P9_STATS_ATIME		0x00000020ULL</span>
<span class="cp">#define P9_STATS_MTIME		0x00000040ULL</span>
<span class="cp">#define P9_STATS_CTIME		0x00000080ULL</span>
<span class="cp">#define P9_STATS_INO		0x00000100ULL</span>
<span class="cp">#define P9_STATS_SIZE		0x00000200ULL</span>
<span class="cp">#define P9_STATS_BLOCKS		0x00000400ULL</span>

<span class="cp">#define P9_STATS_BTIME		0x00000800ULL</span>
<span class="cp">#define P9_STATS_GEN		0x00001000ULL</span>
<span class="cp">#define P9_STATS_DATA_VERSION	0x00002000ULL</span>

<span class="cp">#define P9_STATS_BASIC		0x000007ffULL </span><span class="cm">/* Mask for fields up to BLOCKS */</span><span class="cp"></span>
<span class="cp">#define P9_STATS_ALL		0x00003fffULL </span><span class="cm">/* Mask for All fields above */</span><span class="cp"></span>

<span class="cm">/**</span>
<span class="cm"> * struct p9_iattr_dotl - P9 inode attribute for setattr</span>
<span class="cm"> * @valid: bitfield specifying which fields are valid</span>
<span class="cm"> *         same as in struct iattr</span>
<span class="cm"> * @mode: File permission bits</span>
<span class="cm"> * @uid: user id of owner</span>
<span class="cm"> * @gid: group id</span>
<span class="cm"> * @size: File size</span>
<span class="cm"> * @atime_sec: Last access time, seconds</span>
<span class="cm"> * @atime_nsec: Last access time, nanoseconds</span>
<span class="cm"> * @mtime_sec: Last modification time, seconds</span>
<span class="cm"> * @mtime_nsec: Last modification time, nanoseconds</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">p9_iattr_dotl</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mode</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">uid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">atime_sec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">atime_nsec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mtime_sec</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">mtime_nsec</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define P9_LOCK_SUCCESS 0</span>
<span class="cp">#define P9_LOCK_BLOCKED 1</span>
<span class="cp">#define P9_LOCK_ERROR 2</span>
<span class="cp">#define P9_LOCK_GRACE 3</span>

<span class="cp">#define P9_LOCK_FLAGS_BLOCK 1</span>
<span class="cp">#define P9_LOCK_FLAGS_RECLAIM 2</span>

<span class="cm">/* struct p9_flock: POSIX lock structure</span>
<span class="cm"> * @type - type of lock</span>
<span class="cm"> * @flags - lock flags</span>
<span class="cm"> * @start - starting offset of the lock</span>
<span class="cm"> * @length - number of bytes</span>
<span class="cm"> * @proc_id - process id which wants to take lock</span>
<span class="cm"> * @client_id - client id</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">p9_flock</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">start</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">length</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">proc_id</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">client_id</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* struct p9_getlock: getlock structure</span>
<span class="cm"> * @type - type of lock</span>
<span class="cm"> * @start - starting offset of the lock</span>
<span class="cm"> * @length - number of bytes</span>
<span class="cm"> * @proc_id - process id which wants to take lock</span>
<span class="cm"> * @client_id - client id</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">p9_getlock</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">start</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">length</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">proc_id</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">client_id</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">p9_rstatfs</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bsize</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">blocks</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bfree</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bavail</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">files</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">ffree</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">fsid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">namelen</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct p9_fcall - primary packet structure</span>
<span class="cm"> * @size: prefixed length of the structure</span>
<span class="cm"> * @id: protocol operating identifier of type &amp;p9_msg_t</span>
<span class="cm"> * @tag: transaction id of the request</span>
<span class="cm"> * @offset: used by marshalling routines to track current position in buffer</span>
<span class="cm"> * @capacity: used by marshalling routines to track total malloc&#39;d capacity</span>
<span class="cm"> * @sdata: payload</span>
<span class="cm"> *</span>
<span class="cm"> * &amp;p9_fcall represents the structure for all 9P RPC</span>
<span class="cm"> * transactions.  Requests are packaged into fcalls, and reponses</span>
<span class="cm"> * must be extracted from them.</span>
<span class="cm"> *</span>
<span class="cm"> * See Also: http://plan9.bell-labs.com/magic/man2html/2/fcall</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">p9_fcall</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">id</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tag</span><span class="p">;</span>

	<span class="kt">size_t</span> <span class="n">offset</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">capacity</span><span class="p">;</span>

	<span class="n">u8</span> <span class="o">*</span><span class="n">sdata</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">p9_idpool</span><span class="p">;</span>

<span class="kt">int</span> <span class="n">p9_errstr2errno</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">errstr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">p9_idpool</span> <span class="o">*</span><span class="n">p9_idpool_create</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">p9_idpool_destroy</span><span class="p">(</span><span class="k">struct</span> <span class="n">p9_idpool</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">p9_idpool_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">p9_idpool</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">p9_idpool_put</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="k">struct</span> <span class="n">p9_idpool</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">p9_idpool_check</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="k">struct</span> <span class="n">p9_idpool</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">p9_error_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">p9_trans_fd_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">p9_trans_fd_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* NET_9P_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
