<!DOCTYPE html>
<html><head><title>joekychen/linux » include › drm › radeon_drm.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>radeon_drm.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* radeon_drm.h -- Public header for the radeon driver -*- linux-c -*-</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2000 Precision Insight, Inc., Cedar Park, Texas.</span>
<span class="cm"> * Copyright 2000 VA Linux Systems, Inc., Fremont, California.</span>
<span class="cm"> * Copyright 2002 Tungsten Graphics, Inc., Cedar Park, Texas.</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Permission is hereby granted, free of charge, to any person obtaining a</span>
<span class="cm"> * copy of this software and associated documentation files (the &quot;Software&quot;),</span>
<span class="cm"> * to deal in the Software without restriction, including without limitation</span>
<span class="cm"> * the rights to use, copy, modify, merge, publish, distribute, sublicense,</span>
<span class="cm"> * and/or sell copies of the Software, and to permit persons to whom the</span>
<span class="cm"> * Software is furnished to do so, subject to the following conditions:</span>
<span class="cm"> *</span>
<span class="cm"> * The above copyright notice and this permission notice (including the next</span>
<span class="cm"> * paragraph) shall be included in all copies or substantial portions of the</span>
<span class="cm"> * Software.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<span class="cm"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL</span>
<span class="cm"> * PRECISION INSIGHT AND/OR ITS SUPPLIERS BE LIABLE FOR ANY CLAIM, DAMAGES OR</span>
<span class="cm"> * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,</span>
<span class="cm"> * ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER</span>
<span class="cm"> * DEALINGS IN THE SOFTWARE.</span>
<span class="cm"> *</span>
<span class="cm"> * Authors:</span>
<span class="cm"> *    Kevin E. Martin &lt;martin@valinux.com&gt;</span>
<span class="cm"> *    Gareth Hughes &lt;gareth@valinux.com&gt;</span>
<span class="cm"> *    Keith Whitwell &lt;keith@tungstengraphics.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __RADEON_DRM_H__</span>
<span class="cp">#define __RADEON_DRM_H__</span>

<span class="cp">#include &quot;drm.h&quot;</span>

<span class="cm">/* WARNING: If you change any of these defines, make sure to change the</span>
<span class="cm"> * defines in the X server file (radeon_sarea.h)</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __RADEON_SAREA_DEFINES__</span>
<span class="cp">#define __RADEON_SAREA_DEFINES__</span>

<span class="cm">/* Old style state flags, required for sarea interface (1.1 and 1.2</span>
<span class="cm"> * clears) and 1.2 drm_vertex2 ioctl.</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_UPLOAD_CONTEXT		0x00000001</span>
<span class="cp">#define RADEON_UPLOAD_VERTFMT		0x00000002</span>
<span class="cp">#define RADEON_UPLOAD_LINE		0x00000004</span>
<span class="cp">#define RADEON_UPLOAD_BUMPMAP		0x00000008</span>
<span class="cp">#define RADEON_UPLOAD_MASKS		0x00000010</span>
<span class="cp">#define RADEON_UPLOAD_VIEWPORT		0x00000020</span>
<span class="cp">#define RADEON_UPLOAD_SETUP		0x00000040</span>
<span class="cp">#define RADEON_UPLOAD_TCL		0x00000080</span>
<span class="cp">#define RADEON_UPLOAD_MISC		0x00000100</span>
<span class="cp">#define RADEON_UPLOAD_TEX0		0x00000200</span>
<span class="cp">#define RADEON_UPLOAD_TEX1		0x00000400</span>
<span class="cp">#define RADEON_UPLOAD_TEX2		0x00000800</span>
<span class="cp">#define RADEON_UPLOAD_TEX0IMAGES	0x00001000</span>
<span class="cp">#define RADEON_UPLOAD_TEX1IMAGES	0x00002000</span>
<span class="cp">#define RADEON_UPLOAD_TEX2IMAGES	0x00004000</span>
<span class="cp">#define RADEON_UPLOAD_CLIPRECTS		0x00008000	</span><span class="cm">/* handled client-side */</span><span class="cp"></span>
<span class="cp">#define RADEON_REQUIRE_QUIESCENCE	0x00010000</span>
<span class="cp">#define RADEON_UPLOAD_ZBIAS		0x00020000	</span><span class="cm">/* version 1.2 and newer */</span><span class="cp"></span>
<span class="cp">#define RADEON_UPLOAD_ALL		0x003effff</span>
<span class="cp">#define RADEON_UPLOAD_CONTEXT_ALL       0x003e01ff</span>

<span class="cm">/* New style per-packet identifiers for use in cmd_buffer ioctl with</span>
<span class="cm"> * the RADEON_EMIT_PACKET command.  Comments relate new packets to old</span>
<span class="cm"> * state bits and the packet size:</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_EMIT_PP_MISC                         0	</span><span class="cm">/* context/7 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_PP_CNTL                         1	</span><span class="cm">/* context/3 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_RB3D_COLORPITCH                 2	</span><span class="cm">/* context/1 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_RE_LINE_PATTERN                 3	</span><span class="cm">/* line/2 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_SE_LINE_WIDTH                   4	</span><span class="cm">/* line/1 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_PP_LUM_MATRIX                   5	</span><span class="cm">/* bumpmap/1 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_PP_ROT_MATRIX_0                 6	</span><span class="cm">/* bumpmap/2 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_RB3D_STENCILREFMASK             7	</span><span class="cm">/* masks/3 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_SE_VPORT_XSCALE                 8	</span><span class="cm">/* viewport/6 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_SE_CNTL                         9	</span><span class="cm">/* setup/2 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_SE_CNTL_STATUS                  10	</span><span class="cm">/* setup/1 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_RE_MISC                         11	</span><span class="cm">/* misc/1 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_PP_TXFILTER_0                   12	</span><span class="cm">/* tex0/6 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_PP_BORDER_COLOR_0               13	</span><span class="cm">/* tex0/1 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_PP_TXFILTER_1                   14	</span><span class="cm">/* tex1/6 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_PP_BORDER_COLOR_1               15	</span><span class="cm">/* tex1/1 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_PP_TXFILTER_2                   16	</span><span class="cm">/* tex2/6 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_PP_BORDER_COLOR_2               17	</span><span class="cm">/* tex2/1 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_SE_ZBIAS_FACTOR                 18	</span><span class="cm">/* zbias/2 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_SE_TCL_OUTPUT_VTX_FMT           19	</span><span class="cm">/* tcl/11 */</span><span class="cp"></span>
<span class="cp">#define RADEON_EMIT_SE_TCL_MATERIAL_EMMISSIVE_RED   20	</span><span class="cm">/* material/17 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXCBLEND_0                     21	</span><span class="cm">/* tex0/4 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXCBLEND_1                     22	</span><span class="cm">/* tex1/4 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXCBLEND_2                     23	</span><span class="cm">/* tex2/4 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXCBLEND_3                     24	</span><span class="cm">/* tex3/4 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXCBLEND_4                     25	</span><span class="cm">/* tex4/4 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXCBLEND_5                     26	</span><span class="cm">/* tex5/4 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXCBLEND_6                     27	</span><span class="cm">/* /4 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXCBLEND_7                     28	</span><span class="cm">/* /4 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_TCL_LIGHT_MODEL_CTL_0             29	</span><span class="cm">/* tcl/7 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_TFACTOR_0                         30	</span><span class="cm">/* tf/7 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_VTX_FMT_0                         31	</span><span class="cm">/* vtx/5 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_VAP_CTL                           32	</span><span class="cm">/* vap/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_MATRIX_SELECT_0                   33	</span><span class="cm">/* msl/5 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_TEX_PROC_CTL_2                    34	</span><span class="cm">/* tcg/5 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_TCL_UCP_VERT_BLEND_CTL            35	</span><span class="cm">/* tcl/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXFILTER_0                     36	</span><span class="cm">/* tex0/6 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXFILTER_1                     37	</span><span class="cm">/* tex1/6 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXFILTER_2                     38	</span><span class="cm">/* tex2/6 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXFILTER_3                     39	</span><span class="cm">/* tex3/6 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXFILTER_4                     40	</span><span class="cm">/* tex4/6 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXFILTER_5                     41	</span><span class="cm">/* tex5/6 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXOFFSET_0                     42	</span><span class="cm">/* tex0/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXOFFSET_1                     43	</span><span class="cm">/* tex1/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXOFFSET_2                     44	</span><span class="cm">/* tex2/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXOFFSET_3                     45	</span><span class="cm">/* tex3/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXOFFSET_4                     46	</span><span class="cm">/* tex4/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TXOFFSET_5                     47	</span><span class="cm">/* tex5/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_VTE_CNTL                          48	</span><span class="cm">/* vte/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_OUTPUT_VTX_COMP_SEL               49	</span><span class="cm">/* vtx/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_TAM_DEBUG3                     50	</span><span class="cm">/* tam/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_CNTL_X                         51	</span><span class="cm">/* cst/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_RB3D_DEPTHXY_OFFSET               52	</span><span class="cm">/* cst/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_RE_AUX_SCISSOR_CNTL               53	</span><span class="cm">/* cst/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_RE_SCISSOR_TL_0                   54	</span><span class="cm">/* cst/2 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_RE_SCISSOR_TL_1                   55	</span><span class="cm">/* cst/2 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_RE_SCISSOR_TL_2                   56	</span><span class="cm">/* cst/2 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_SE_VAP_CNTL_STATUS                57	</span><span class="cm">/* cst/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_SE_VTX_STATE_CNTL                 58	</span><span class="cm">/* cst/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_RE_POINTSIZE                      59	</span><span class="cm">/* cst/1 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_TCL_INPUT_VTX_VECTOR_ADDR_0       60	</span><span class="cm">/* cst/4 */</span><span class="cp"></span>
<span class="cp">#define R200_EMIT_PP_CUBIC_FACES_0                  61</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_OFFSETS_0                62</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_FACES_1                  63</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_OFFSETS_1                64</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_FACES_2                  65</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_OFFSETS_2                66</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_FACES_3                  67</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_OFFSETS_3                68</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_FACES_4                  69</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_OFFSETS_4                70</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_FACES_5                  71</span>
<span class="cp">#define R200_EMIT_PP_CUBIC_OFFSETS_5                72</span>
<span class="cp">#define RADEON_EMIT_PP_TEX_SIZE_0                   73</span>
<span class="cp">#define RADEON_EMIT_PP_TEX_SIZE_1                   74</span>
<span class="cp">#define RADEON_EMIT_PP_TEX_SIZE_2                   75</span>
<span class="cp">#define R200_EMIT_RB3D_BLENDCOLOR                   76</span>
<span class="cp">#define R200_EMIT_TCL_POINT_SPRITE_CNTL             77</span>
<span class="cp">#define RADEON_EMIT_PP_CUBIC_FACES_0                78</span>
<span class="cp">#define RADEON_EMIT_PP_CUBIC_OFFSETS_T0             79</span>
<span class="cp">#define RADEON_EMIT_PP_CUBIC_FACES_1                80</span>
<span class="cp">#define RADEON_EMIT_PP_CUBIC_OFFSETS_T1             81</span>
<span class="cp">#define RADEON_EMIT_PP_CUBIC_FACES_2                82</span>
<span class="cp">#define RADEON_EMIT_PP_CUBIC_OFFSETS_T2             83</span>
<span class="cp">#define R200_EMIT_PP_TRI_PERF_CNTL                  84</span>
<span class="cp">#define R200_EMIT_PP_AFS_0                          85</span>
<span class="cp">#define R200_EMIT_PP_AFS_1                          86</span>
<span class="cp">#define R200_EMIT_ATF_TFACTOR                       87</span>
<span class="cp">#define R200_EMIT_PP_TXCTLALL_0                     88</span>
<span class="cp">#define R200_EMIT_PP_TXCTLALL_1                     89</span>
<span class="cp">#define R200_EMIT_PP_TXCTLALL_2                     90</span>
<span class="cp">#define R200_EMIT_PP_TXCTLALL_3                     91</span>
<span class="cp">#define R200_EMIT_PP_TXCTLALL_4                     92</span>
<span class="cp">#define R200_EMIT_PP_TXCTLALL_5                     93</span>
<span class="cp">#define R200_EMIT_VAP_PVS_CNTL                      94</span>
<span class="cp">#define RADEON_MAX_STATE_PACKETS                    95</span>

<span class="cm">/* Commands understood by cmd_buffer ioctl.  More can be added but</span>
<span class="cm"> * obviously these can&#39;t be removed or changed:</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_CMD_PACKET      1	</span><span class="cm">/* emit one of the register packets above */</span><span class="cp"></span>
<span class="cp">#define RADEON_CMD_SCALARS     2	</span><span class="cm">/* emit scalar data */</span><span class="cp"></span>
<span class="cp">#define RADEON_CMD_VECTORS     3	</span><span class="cm">/* emit vector data */</span><span class="cp"></span>
<span class="cp">#define RADEON_CMD_DMA_DISCARD 4	</span><span class="cm">/* discard current dma buf */</span><span class="cp"></span>
<span class="cp">#define RADEON_CMD_PACKET3     5	</span><span class="cm">/* emit hw packet */</span><span class="cp"></span>
<span class="cp">#define RADEON_CMD_PACKET3_CLIP 6	</span><span class="cm">/* emit hw packet wrapped in cliprects */</span><span class="cp"></span>
<span class="cp">#define RADEON_CMD_SCALARS2     7	</span><span class="cm">/* r200 stopgap */</span><span class="cp"></span>
<span class="cp">#define RADEON_CMD_WAIT         8	</span><span class="cm">/* emit hw wait commands -- note:</span>
<span class="cm">					 *  doesn&#39;t make the cpu wait, just</span>
<span class="cm">					 *  the graphics hardware */</span><span class="cp"></span>
<span class="cp">#define RADEON_CMD_VECLINEAR	9       </span><span class="cm">/* another r200 stopgap */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">pad0</span><span class="p">,</span> <span class="n">pad1</span><span class="p">,</span> <span class="n">pad2</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">packet_id</span><span class="p">,</span> <span class="n">pad0</span><span class="p">,</span> <span class="n">pad1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">packet</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">stride</span><span class="p">,</span> <span class="n">count</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">scalars</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">stride</span><span class="p">,</span> <span class="n">count</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">vectors</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">addr_lo</span><span class="p">,</span> <span class="n">addr_hi</span><span class="p">,</span> <span class="n">count</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">veclinear</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">buf_idx</span><span class="p">,</span> <span class="n">pad0</span><span class="p">,</span> <span class="n">pad1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">pad0</span><span class="p">,</span> <span class="n">pad1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">wait</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_cmd_header_t</span><span class="p">;</span>

<span class="cp">#define RADEON_WAIT_2D  0x1</span>
<span class="cp">#define RADEON_WAIT_3D  0x2</span>

<span class="cm">/* Allowed parameters for R300_CMD_PACKET3</span>
<span class="cm"> */</span>
<span class="cp">#define R300_CMD_PACKET3_CLEAR		0</span>
<span class="cp">#define R300_CMD_PACKET3_RAW		1</span>

<span class="cm">/* Commands understood by cmd_buffer ioctl for R300.</span>
<span class="cm"> * The interface has not been stabilized, so some of these may be removed</span>
<span class="cm"> * and eventually reordered before stabilization.</span>
<span class="cm"> */</span>
<span class="cp">#define R300_CMD_PACKET0		1</span>
<span class="cp">#define R300_CMD_VPU			2	</span><span class="cm">/* emit vertex program upload */</span><span class="cp"></span>
<span class="cp">#define R300_CMD_PACKET3		3	</span><span class="cm">/* emit a packet3 */</span><span class="cp"></span>
<span class="cp">#define R300_CMD_END3D			4	</span><span class="cm">/* emit sequence ending 3d rendering */</span><span class="cp"></span>
<span class="cp">#define R300_CMD_CP_DELAY		5</span>
<span class="cp">#define R300_CMD_DMA_DISCARD		6</span>
<span class="cp">#define R300_CMD_WAIT			7</span>
<span class="cp">#	define R300_WAIT_2D		0x1</span>
<span class="cp">#	define R300_WAIT_3D		0x2</span>
<span class="cm">/* these two defines are DOING IT WRONG - however</span>
<span class="cm"> * we have userspace which relies on using these.</span>
<span class="cm"> * The wait interface is backwards compat new </span>
<span class="cm"> * code should use the NEW_WAIT defines below</span>
<span class="cm"> * THESE ARE NOT BIT FIELDS</span>
<span class="cm"> */</span>
<span class="cp">#	define R300_WAIT_2D_CLEAN	0x3</span>
<span class="cp">#	define R300_WAIT_3D_CLEAN	0x4</span>

<span class="cp">#	define R300_NEW_WAIT_2D_3D	0x3</span>
<span class="cp">#	define R300_NEW_WAIT_2D_2D_CLEAN	0x4</span>
<span class="cp">#	define R300_NEW_WAIT_3D_3D_CLEAN	0x6</span>
<span class="cp">#	define R300_NEW_WAIT_2D_2D_CLEAN_3D_3D_CLEAN	0x8</span>

<span class="cp">#define R300_CMD_SCRATCH		8</span>
<span class="cp">#define R300_CMD_R500FP                 9</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">u</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">pad0</span><span class="p">,</span> <span class="n">pad1</span><span class="p">,</span> <span class="n">pad2</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">reglo</span><span class="p">,</span> <span class="n">reghi</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">packet0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">adrlo</span><span class="p">,</span> <span class="n">adrhi</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">vpu</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">packet</span><span class="p">,</span> <span class="n">pad0</span><span class="p">,</span> <span class="n">pad1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">packet3</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">packet</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">count</span><span class="p">;</span>	<span class="cm">/* amount of packet2 to emit */</span>
	<span class="p">}</span> <span class="n">delay</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">buf_idx</span><span class="p">,</span> <span class="n">pad0</span><span class="p">,</span> <span class="n">pad1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">dma</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">pad0</span><span class="p">,</span> <span class="n">pad1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">wait</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">n_bufs</span><span class="p">,</span> <span class="n">flags</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">scratch</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cmd_type</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">adrlo</span><span class="p">,</span> <span class="n">adrhi_flags</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">r500fp</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_r300_cmd_header_t</span><span class="p">;</span>

<span class="cp">#define RADEON_FRONT			0x1</span>
<span class="cp">#define RADEON_BACK			0x2</span>
<span class="cp">#define RADEON_DEPTH			0x4</span>
<span class="cp">#define RADEON_STENCIL			0x8</span>
<span class="cp">#define RADEON_CLEAR_FASTZ		0x80000000</span>
<span class="cp">#define RADEON_USE_HIERZ		0x40000000</span>
<span class="cp">#define RADEON_USE_COMP_ZBUF		0x20000000</span>

<span class="cp">#define R500FP_CONSTANT_TYPE  (1 &lt;&lt; 1)</span>
<span class="cp">#define R500FP_CONSTANT_CLAMP (1 &lt;&lt; 2)</span>

<span class="cm">/* Primitive types</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_POINTS			0x1</span>
<span class="cp">#define RADEON_LINES			0x2</span>
<span class="cp">#define RADEON_LINE_STRIP		0x3</span>
<span class="cp">#define RADEON_TRIANGLES		0x4</span>
<span class="cp">#define RADEON_TRIANGLE_FAN		0x5</span>
<span class="cp">#define RADEON_TRIANGLE_STRIP		0x6</span>

<span class="cm">/* Vertex/indirect buffer size</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_BUFFER_SIZE		65536</span>

<span class="cm">/* Byte offsets for indirect buffer data</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_INDEX_PRIM_OFFSET	20</span>

<span class="cp">#define RADEON_SCRATCH_REG_OFFSET	32</span>

<span class="cp">#define R600_SCRATCH_REG_OFFSET         256</span>

<span class="cp">#define RADEON_NR_SAREA_CLIPRECTS	12</span>

<span class="cm">/* There are 2 heaps (local/GART).  Each region within a heap is a</span>
<span class="cm"> * minimum of 64k, and there are at most 64 of them per heap.</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_LOCAL_TEX_HEAP		0</span>
<span class="cp">#define RADEON_GART_TEX_HEAP		1</span>
<span class="cp">#define RADEON_NR_TEX_HEAPS		2</span>
<span class="cp">#define RADEON_NR_TEX_REGIONS		64</span>
<span class="cp">#define RADEON_LOG_TEX_GRANULARITY	16</span>

<span class="cp">#define RADEON_MAX_TEXTURE_LEVELS	12</span>
<span class="cp">#define RADEON_MAX_TEXTURE_UNITS	3</span>

<span class="cp">#define RADEON_MAX_SURFACES		8</span>

<span class="cm">/* Blits have strict offset rules.  All blit offset must be aligned on</span>
<span class="cm"> * a 1K-byte boundary.</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_OFFSET_SHIFT             10</span>
<span class="cp">#define RADEON_OFFSET_ALIGN             (1 &lt;&lt; RADEON_OFFSET_SHIFT)</span>
<span class="cp">#define RADEON_OFFSET_MASK              (RADEON_OFFSET_ALIGN - 1)</span>

<span class="cp">#endif				</span><span class="cm">/* __RADEON_SAREA_DEFINES__ */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">red</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">green</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">blue</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">alpha</span><span class="p">;</span>
<span class="p">}</span> <span class="n">radeon_color_regs_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="cm">/* Context state */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_misc</span><span class="p">;</span>	<span class="cm">/* 0x1c14 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_fog_color</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">re_solid_color</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rb3d_blendcntl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rb3d_depthoffset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rb3d_depthpitch</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rb3d_zstencilcntl</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_cntl</span><span class="p">;</span>	<span class="cm">/* 0x1c38 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rb3d_cntl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rb3d_coloroffset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">re_width_height</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rb3d_colorpitch</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_cntl</span><span class="p">;</span>

	<span class="cm">/* Vertex format state */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_coord_fmt</span><span class="p">;</span>	<span class="cm">/* 0x1c50 */</span>

	<span class="cm">/* Line state */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">re_line_pattern</span><span class="p">;</span>	<span class="cm">/* 0x1cd0 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">re_line_state</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_line_width</span><span class="p">;</span>	<span class="cm">/* 0x1db8 */</span>

	<span class="cm">/* Bumpmap state */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_lum_matrix</span><span class="p">;</span>	<span class="cm">/* 0x1d00 */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_rot_matrix_0</span><span class="p">;</span>	<span class="cm">/* 0x1d58 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_rot_matrix_1</span><span class="p">;</span>

	<span class="cm">/* Mask state */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rb3d_stencilrefmask</span><span class="p">;</span>	<span class="cm">/* 0x1d7c */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rb3d_ropcntl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rb3d_planemask</span><span class="p">;</span>

	<span class="cm">/* Viewport state */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_vport_xscale</span><span class="p">;</span>	<span class="cm">/* 0x1d98 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_vport_xoffset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_vport_yscale</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_vport_yoffset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_vport_zscale</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_vport_zoffset</span><span class="p">;</span>

	<span class="cm">/* Setup state */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_cntl_status</span><span class="p">;</span>	<span class="cm">/* 0x2140 */</span>

	<span class="cm">/* Misc state */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">re_top_left</span><span class="p">;</span>	<span class="cm">/* 0x26c0 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">re_misc</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_context_regs_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="cm">/* Zbias state */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_zbias_factor</span><span class="p">;</span>	<span class="cm">/* 0x1dac */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">se_zbias_constant</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_context2_regs_t</span><span class="p">;</span>

<span class="cm">/* Setup registers for each texture unit</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_txfilter</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_txformat</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_txoffset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_txcblend</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_txablend</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_tfactor</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pp_border_color</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_texture_regs_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">start</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">finish</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">prim</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stateidx</span><span class="o">:</span><span class="mi">8</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">numverts</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>	<span class="cm">/* overloaded as offset/64 for elt prims */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vc_format</span><span class="p">;</span>	<span class="cm">/* vertex format */</span>
<span class="p">}</span> <span class="n">drm_radeon_prim_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">drm_radeon_context_regs_t</span> <span class="n">context</span><span class="p">;</span>
	<span class="n">drm_radeon_texture_regs_t</span> <span class="n">tex</span><span class="p">[</span><span class="n">RADEON_MAX_TEXTURE_UNITS</span><span class="p">];</span>
	<span class="n">drm_radeon_context2_regs_t</span> <span class="n">context2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dirty</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_state_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="cm">/* The channel for communication of state information to the</span>
<span class="cm">	 * kernel on firing a vertex buffer with either of the</span>
<span class="cm">	 * obsoleted vertex/index ioctls.</span>
<span class="cm">	 */</span>
	<span class="n">drm_radeon_context_regs_t</span> <span class="n">context_state</span><span class="p">;</span>
	<span class="n">drm_radeon_texture_regs_t</span> <span class="n">tex_state</span><span class="p">[</span><span class="n">RADEON_MAX_TEXTURE_UNITS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dirty</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vertsize</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vc_format</span><span class="p">;</span>

	<span class="cm">/* The current cliprects, or a subset thereof.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">drm_clip_rect</span> <span class="n">boxes</span><span class="p">[</span><span class="n">RADEON_NR_SAREA_CLIPRECTS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nbox</span><span class="p">;</span>

	<span class="cm">/* Counters for client-side throttling of rendering clients.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">last_frame</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">last_dispatch</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">last_clear</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">drm_tex_region</span> <span class="n">tex_list</span><span class="p">[</span><span class="n">RADEON_NR_TEX_HEAPS</span><span class="p">][</span><span class="n">RADEON_NR_TEX_REGIONS</span> <span class="o">+</span>
						       <span class="mi">1</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tex_age</span><span class="p">[</span><span class="n">RADEON_NR_TEX_HEAPS</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">ctx_owner</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pfState</span><span class="p">;</span>		<span class="cm">/* number of 3d windows (0,1,2ormore) */</span>
	<span class="kt">int</span> <span class="n">pfCurrentPage</span><span class="p">;</span>	<span class="cm">/* which buffer is being displayed? */</span>
	<span class="kt">int</span> <span class="n">crtc2_base</span><span class="p">;</span>		<span class="cm">/* CRTC2 frame offset */</span>
	<span class="kt">int</span> <span class="n">tiling_enabled</span><span class="p">;</span>	<span class="cm">/* set by drm, read by 2d + 3d clients */</span>
<span class="p">}</span> <span class="n">drm_radeon_sarea_t</span><span class="p">;</span>

<span class="cm">/* WARNING: If you change any of these defines, make sure to change the</span>
<span class="cm"> * defines in the Xserver file (xf86drmRadeon.h)</span>
<span class="cm"> *</span>
<span class="cm"> * KW: actually it&#39;s illegal to change any of this (backwards compatibility).</span>
<span class="cm"> */</span>

<span class="cm">/* Radeon specific ioctls</span>
<span class="cm"> * The device specific ioctl range is 0x40 to 0x79.</span>
<span class="cm"> */</span>
<span class="cp">#define DRM_RADEON_CP_INIT    0x00</span>
<span class="cp">#define DRM_RADEON_CP_START   0x01</span>
<span class="cp">#define DRM_RADEON_CP_STOP    0x02</span>
<span class="cp">#define DRM_RADEON_CP_RESET   0x03</span>
<span class="cp">#define DRM_RADEON_CP_IDLE    0x04</span>
<span class="cp">#define DRM_RADEON_RESET      0x05</span>
<span class="cp">#define DRM_RADEON_FULLSCREEN 0x06</span>
<span class="cp">#define DRM_RADEON_SWAP       0x07</span>
<span class="cp">#define DRM_RADEON_CLEAR      0x08</span>
<span class="cp">#define DRM_RADEON_VERTEX     0x09</span>
<span class="cp">#define DRM_RADEON_INDICES    0x0A</span>
<span class="cp">#define DRM_RADEON_NOT_USED</span>
<span class="cp">#define DRM_RADEON_STIPPLE    0x0C</span>
<span class="cp">#define DRM_RADEON_INDIRECT   0x0D</span>
<span class="cp">#define DRM_RADEON_TEXTURE    0x0E</span>
<span class="cp">#define DRM_RADEON_VERTEX2    0x0F</span>
<span class="cp">#define DRM_RADEON_CMDBUF     0x10</span>
<span class="cp">#define DRM_RADEON_GETPARAM   0x11</span>
<span class="cp">#define DRM_RADEON_FLIP       0x12</span>
<span class="cp">#define DRM_RADEON_ALLOC      0x13</span>
<span class="cp">#define DRM_RADEON_FREE       0x14</span>
<span class="cp">#define DRM_RADEON_INIT_HEAP  0x15</span>
<span class="cp">#define DRM_RADEON_IRQ_EMIT   0x16</span>
<span class="cp">#define DRM_RADEON_IRQ_WAIT   0x17</span>
<span class="cp">#define DRM_RADEON_CP_RESUME  0x18</span>
<span class="cp">#define DRM_RADEON_SETPARAM   0x19</span>
<span class="cp">#define DRM_RADEON_SURF_ALLOC 0x1a</span>
<span class="cp">#define DRM_RADEON_SURF_FREE  0x1b</span>
<span class="cm">/* KMS ioctl */</span>
<span class="cp">#define DRM_RADEON_GEM_INFO		0x1c</span>
<span class="cp">#define DRM_RADEON_GEM_CREATE		0x1d</span>
<span class="cp">#define DRM_RADEON_GEM_MMAP		0x1e</span>
<span class="cp">#define DRM_RADEON_GEM_PREAD		0x21</span>
<span class="cp">#define DRM_RADEON_GEM_PWRITE		0x22</span>
<span class="cp">#define DRM_RADEON_GEM_SET_DOMAIN	0x23</span>
<span class="cp">#define DRM_RADEON_GEM_WAIT_IDLE	0x24</span>
<span class="cp">#define DRM_RADEON_CS			0x26</span>
<span class="cp">#define DRM_RADEON_INFO			0x27</span>
<span class="cp">#define DRM_RADEON_GEM_SET_TILING	0x28</span>
<span class="cp">#define DRM_RADEON_GEM_GET_TILING	0x29</span>
<span class="cp">#define DRM_RADEON_GEM_BUSY		0x2a</span>
<span class="cp">#define DRM_RADEON_GEM_VA		0x2b</span>

<span class="cp">#define DRM_IOCTL_RADEON_CP_INIT    DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_CP_INIT, drm_radeon_init_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_CP_START   DRM_IO(  DRM_COMMAND_BASE + DRM_RADEON_CP_START)</span>
<span class="cp">#define DRM_IOCTL_RADEON_CP_STOP    DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_CP_STOP, drm_radeon_cp_stop_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_CP_RESET   DRM_IO(  DRM_COMMAND_BASE + DRM_RADEON_CP_RESET)</span>
<span class="cp">#define DRM_IOCTL_RADEON_CP_IDLE    DRM_IO(  DRM_COMMAND_BASE + DRM_RADEON_CP_IDLE)</span>
<span class="cp">#define DRM_IOCTL_RADEON_RESET      DRM_IO(  DRM_COMMAND_BASE + DRM_RADEON_RESET)</span>
<span class="cp">#define DRM_IOCTL_RADEON_FULLSCREEN DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_FULLSCREEN, drm_radeon_fullscreen_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_SWAP       DRM_IO(  DRM_COMMAND_BASE + DRM_RADEON_SWAP)</span>
<span class="cp">#define DRM_IOCTL_RADEON_CLEAR      DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_CLEAR, drm_radeon_clear_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_VERTEX     DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_VERTEX, drm_radeon_vertex_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_INDICES    DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_INDICES, drm_radeon_indices_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_STIPPLE    DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_STIPPLE, drm_radeon_stipple_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_INDIRECT   DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_INDIRECT, drm_radeon_indirect_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_TEXTURE    DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_TEXTURE, drm_radeon_texture_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_VERTEX2    DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_VERTEX2, drm_radeon_vertex2_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_CMDBUF     DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_CMDBUF, drm_radeon_cmd_buffer_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GETPARAM   DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GETPARAM, drm_radeon_getparam_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_FLIP       DRM_IO(  DRM_COMMAND_BASE + DRM_RADEON_FLIP)</span>
<span class="cp">#define DRM_IOCTL_RADEON_ALLOC      DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_ALLOC, drm_radeon_mem_alloc_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_FREE       DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_FREE, drm_radeon_mem_free_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_INIT_HEAP  DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_INIT_HEAP, drm_radeon_mem_init_heap_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_IRQ_EMIT   DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_IRQ_EMIT, drm_radeon_irq_emit_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_IRQ_WAIT   DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_IRQ_WAIT, drm_radeon_irq_wait_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_CP_RESUME  DRM_IO(  DRM_COMMAND_BASE + DRM_RADEON_CP_RESUME)</span>
<span class="cp">#define DRM_IOCTL_RADEON_SETPARAM   DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_SETPARAM, drm_radeon_setparam_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_SURF_ALLOC DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_SURF_ALLOC, drm_radeon_surface_alloc_t)</span>
<span class="cp">#define DRM_IOCTL_RADEON_SURF_FREE  DRM_IOW( DRM_COMMAND_BASE + DRM_RADEON_SURF_FREE, drm_radeon_surface_free_t)</span>
<span class="cm">/* KMS */</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_INFO	DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GEM_INFO, struct drm_radeon_gem_info)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_CREATE	DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GEM_CREATE, struct drm_radeon_gem_create)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_MMAP	DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GEM_MMAP, struct drm_radeon_gem_mmap)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_PREAD	DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GEM_PREAD, struct drm_radeon_gem_pread)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_PWRITE	DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GEM_PWRITE, struct drm_radeon_gem_pwrite)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_SET_DOMAIN	DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GEM_SET_DOMAIN, struct drm_radeon_gem_set_domain)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_WAIT_IDLE	DRM_IOW(DRM_COMMAND_BASE + DRM_RADEON_GEM_WAIT_IDLE, struct drm_radeon_gem_wait_idle)</span>
<span class="cp">#define DRM_IOCTL_RADEON_CS		DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_CS, struct drm_radeon_cs)</span>
<span class="cp">#define DRM_IOCTL_RADEON_INFO		DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_INFO, struct drm_radeon_info)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_SET_TILING	DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GEM_SET_TILING, struct drm_radeon_gem_set_tiling)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_GET_TILING	DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GEM_GET_TILING, struct drm_radeon_gem_get_tiling)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_BUSY	DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GEM_BUSY, struct drm_radeon_gem_busy)</span>
<span class="cp">#define DRM_IOCTL_RADEON_GEM_VA		DRM_IOWR(DRM_COMMAND_BASE + DRM_RADEON_GEM_VA, struct drm_radeon_gem_va)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_init</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="p">{</span>
		<span class="n">RADEON_INIT_CP</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
		<span class="n">RADEON_CLEANUP_CP</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
		<span class="n">RADEON_INIT_R200_CP</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
		<span class="n">RADEON_INIT_R300_CP</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
		<span class="n">RADEON_INIT_R600_CP</span> <span class="o">=</span> <span class="mh">0x05</span>
	<span class="p">}</span> <span class="n">func</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sarea_priv_offset</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">is_pci</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">cp_mode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">gart_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ring_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">usec_timeout</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fb_bpp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">front_offset</span><span class="p">,</span> <span class="n">front_pitch</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">back_offset</span><span class="p">,</span> <span class="n">back_pitch</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">depth_bpp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">depth_offset</span><span class="p">,</span> <span class="n">depth_pitch</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">fb_offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mmio_offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ring_offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ring_rptr_offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">buffers_offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gart_textures_offset</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_init_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_cp_stop</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">flush</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">idle</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_cp_stop_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_fullscreen</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="p">{</span>
		<span class="n">RADEON_INIT_FULLSCREEN</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
		<span class="n">RADEON_CLEANUP_FULLSCREEN</span> <span class="o">=</span> <span class="mh">0x02</span>
	<span class="p">}</span> <span class="n">func</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_fullscreen_t</span><span class="p">;</span>

<span class="cp">#define CLEAR_X1	0</span>
<span class="cp">#define CLEAR_Y1	1</span>
<span class="cp">#define CLEAR_X2	2</span>
<span class="cp">#define CLEAR_Y2	3</span>
<span class="cp">#define CLEAR_DEPTH	4</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">drm_radeon_clear_rect</span> <span class="p">{</span>
	<span class="kt">float</span> <span class="n">f</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ui</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
<span class="p">}</span> <span class="n">drm_radeon_clear_rect_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_clear</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">clear_color</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">clear_depth</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">color_mask</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">depth_mask</span><span class="p">;</span>	<span class="cm">/* misnamed field:  should be stencil */</span>
	<span class="n">drm_radeon_clear_rect_t</span> <span class="n">__user</span> <span class="o">*</span><span class="n">depth_boxes</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_clear_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_vertex</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">prim</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>		<span class="cm">/* Index of vertex buffer */</span>
	<span class="kt">int</span> <span class="n">count</span><span class="p">;</span>		<span class="cm">/* Number of vertices in buffer */</span>
	<span class="kt">int</span> <span class="n">discard</span><span class="p">;</span>		<span class="cm">/* Client finished with buffer? */</span>
<span class="p">}</span> <span class="n">drm_radeon_vertex_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_indices</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">prim</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">start</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">end</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">discard</span><span class="p">;</span>		<span class="cm">/* Client finished with buffer? */</span>
<span class="p">}</span> <span class="n">drm_radeon_indices_t</span><span class="p">;</span>

<span class="cm">/* v1.2 - obsoletes drm_radeon_vertex and drm_radeon_indices</span>
<span class="cm"> *      - allows multiple primitives and state changes in a single ioctl</span>
<span class="cm"> *      - supports driver change to emit native primitives</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_vertex2</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>		<span class="cm">/* Index of vertex buffer */</span>
	<span class="kt">int</span> <span class="n">discard</span><span class="p">;</span>		<span class="cm">/* Client finished with buffer? */</span>
	<span class="kt">int</span> <span class="n">nr_states</span><span class="p">;</span>
	<span class="n">drm_radeon_state_t</span> <span class="n">__user</span> <span class="o">*</span><span class="n">state</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nr_prims</span><span class="p">;</span>
	<span class="n">drm_radeon_prim_t</span> <span class="n">__user</span> <span class="o">*</span><span class="n">prim</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_vertex2_t</span><span class="p">;</span>

<span class="cm">/* v1.3 - obsoletes drm_radeon_vertex2</span>
<span class="cm"> *      - allows arbitrarily large cliprect list</span>
<span class="cm"> *      - allows updating of tcl packet, vector and scalar state</span>
<span class="cm"> *      - allows memory-efficient description of state updates</span>
<span class="cm"> *      - allows state to be emitted without a primitive</span>
<span class="cm"> *           (for clears, ctx switches)</span>
<span class="cm"> *      - allows more than one dma buffer to be referenced per ioctl</span>
<span class="cm"> *      - supports tcl driver</span>
<span class="cm"> *      - may be extended in future versions with new cmd types, packets</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_cmd_buffer</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">bufsz</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nbox</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">drm_clip_rect</span> <span class="n">__user</span> <span class="o">*</span><span class="n">boxes</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_cmd_buffer_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_tex_image</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">;</span>	<span class="cm">/* Blit coordinates */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">void</span> <span class="n">__user</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_tex_image_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_texture</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pitch</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">format</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">width</span><span class="p">;</span>		<span class="cm">/* Texture image coordinates */</span>
	<span class="kt">int</span> <span class="n">height</span><span class="p">;</span>
	<span class="n">drm_radeon_tex_image_t</span> <span class="n">__user</span> <span class="o">*</span><span class="n">image</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_texture_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_stipple</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">__user</span> <span class="o">*</span><span class="n">mask</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_stipple_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_indirect</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">start</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">end</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">discard</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_indirect_t</span><span class="p">;</span>

<span class="cm">/* enum for card type parameters */</span>
<span class="cp">#define RADEON_CARD_PCI 0</span>
<span class="cp">#define RADEON_CARD_AGP 1</span>
<span class="cp">#define RADEON_CARD_PCIE 2</span>

<span class="cm">/* 1.3: An ioctl to get parameters that aren&#39;t available to the 3d</span>
<span class="cm"> * client any other way.</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_PARAM_GART_BUFFER_OFFSET    1	</span><span class="cm">/* card offset of 1st GART buffer */</span><span class="cp"></span>
<span class="cp">#define RADEON_PARAM_LAST_FRAME            2</span>
<span class="cp">#define RADEON_PARAM_LAST_DISPATCH         3</span>
<span class="cp">#define RADEON_PARAM_LAST_CLEAR            4</span>
<span class="cm">/* Added with DRM version 1.6. */</span>
<span class="cp">#define RADEON_PARAM_IRQ_NR                5</span>
<span class="cp">#define RADEON_PARAM_GART_BASE             6	</span><span class="cm">/* card offset of GART base */</span><span class="cp"></span>
<span class="cm">/* Added with DRM version 1.8. */</span>
<span class="cp">#define RADEON_PARAM_REGISTER_HANDLE       7	</span><span class="cm">/* for drmMap() */</span><span class="cp"></span>
<span class="cp">#define RADEON_PARAM_STATUS_HANDLE         8</span>
<span class="cp">#define RADEON_PARAM_SAREA_HANDLE          9</span>
<span class="cp">#define RADEON_PARAM_GART_TEX_HANDLE       10</span>
<span class="cp">#define RADEON_PARAM_SCRATCH_OFFSET        11</span>
<span class="cp">#define RADEON_PARAM_CARD_TYPE             12</span>
<span class="cp">#define RADEON_PARAM_VBLANK_CRTC           13   </span><span class="cm">/* VBLANK CRTC */</span><span class="cp"></span>
<span class="cp">#define RADEON_PARAM_FB_LOCATION           14   </span><span class="cm">/* FB location */</span><span class="cp"></span>
<span class="cp">#define RADEON_PARAM_NUM_GB_PIPES          15   </span><span class="cm">/* num GB pipes */</span><span class="cp"></span>
<span class="cp">#define RADEON_PARAM_DEVICE_ID             16</span>
<span class="cp">#define RADEON_PARAM_NUM_Z_PIPES           17   </span><span class="cm">/* num Z pipes */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_getparam</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">param</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__user</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_getparam_t</span><span class="p">;</span>

<span class="cm">/* 1.6: Set up a memory manager for regions of shared memory:</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_MEM_REGION_GART 1</span>
<span class="cp">#define RADEON_MEM_REGION_FB   2</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_mem_alloc</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">region</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">alignment</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">__user</span> <span class="o">*</span><span class="n">region_offset</span><span class="p">;</span>	<span class="cm">/* offset from start of fb or GART */</span>
<span class="p">}</span> <span class="n">drm_radeon_mem_alloc_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_mem_free</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">region</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">region_offset</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_mem_free_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_mem_init_heap</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">region</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">start</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_mem_init_heap_t</span><span class="p">;</span>

<span class="cm">/* 1.6: Userspace can request &amp; wait on irq&#39;s:</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_irq_emit</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">__user</span> <span class="o">*</span><span class="n">irq_seq</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_irq_emit_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_irq_wait</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">irq_seq</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_irq_wait_t</span><span class="p">;</span>

<span class="cm">/* 1.10: Clients tell the DRM where they think the framebuffer is located in</span>
<span class="cm"> * the card&#39;s address space, via a new generic ioctl to set parameters</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_setparam</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">param</span><span class="p">;</span>
	<span class="n">__s64</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_setparam_t</span><span class="p">;</span>

<span class="cp">#define RADEON_SETPARAM_FB_LOCATION    1	</span><span class="cm">/* determined framebuffer location */</span><span class="cp"></span>
<span class="cp">#define RADEON_SETPARAM_SWITCH_TILING  2	</span><span class="cm">/* enable/disable color tiling */</span><span class="cp"></span>
<span class="cp">#define RADEON_SETPARAM_PCIGART_LOCATION 3	</span><span class="cm">/* PCI Gart Location */</span><span class="cp"></span>
<span class="cp">#define RADEON_SETPARAM_NEW_MEMMAP 4		</span><span class="cm">/* Use new memory map */</span><span class="cp"></span>
<span class="cp">#define RADEON_SETPARAM_PCIGART_TABLE_SIZE 5    </span><span class="cm">/* PCI GART Table Size */</span><span class="cp"></span>
<span class="cp">#define RADEON_SETPARAM_VBLANK_CRTC 6           </span><span class="cm">/* VBLANK CRTC */</span><span class="cp"></span>
<span class="cm">/* 1.14: Clients can allocate/free a surface</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_surface_alloc</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">address</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_surface_alloc_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">drm_radeon_surface_free</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">address</span><span class="p">;</span>
<span class="p">}</span> <span class="n">drm_radeon_surface_free_t</span><span class="p">;</span>

<span class="cp">#define	DRM_RADEON_VBLANK_CRTC1		1</span>
<span class="cp">#define	DRM_RADEON_VBLANK_CRTC2		2</span>

<span class="cm">/*</span>
<span class="cm"> * Kernel modesetting world below.</span>
<span class="cm"> */</span>
<span class="cp">#define RADEON_GEM_DOMAIN_CPU		0x1</span>
<span class="cp">#define RADEON_GEM_DOMAIN_GTT		0x2</span>
<span class="cp">#define RADEON_GEM_DOMAIN_VRAM		0x4</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_info</span> <span class="p">{</span>
	<span class="kt">uint64_t</span>	<span class="n">gart_size</span><span class="p">;</span>
	<span class="kt">uint64_t</span>	<span class="n">vram_size</span><span class="p">;</span>
	<span class="kt">uint64_t</span>	<span class="n">vram_visible</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define RADEON_GEM_NO_BACKING_STORE 1</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_create</span> <span class="p">{</span>
	<span class="kt">uint64_t</span>	<span class="n">size</span><span class="p">;</span>
	<span class="kt">uint64_t</span>	<span class="n">alignment</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">initial_domain</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define RADEON_TILING_MACRO				0x1</span>
<span class="cp">#define RADEON_TILING_MICRO				0x2</span>
<span class="cp">#define RADEON_TILING_SWAP_16BIT			0x4</span>
<span class="cp">#define RADEON_TILING_SWAP_32BIT			0x8</span>
<span class="cm">/* this object requires a surface when mapped - i.e. front buffer */</span>
<span class="cp">#define RADEON_TILING_SURFACE				0x10</span>
<span class="cp">#define RADEON_TILING_MICRO_SQUARE			0x20</span>
<span class="cp">#define RADEON_TILING_EG_BANKW_SHIFT			8</span>
<span class="cp">#define RADEON_TILING_EG_BANKW_MASK			0xf</span>
<span class="cp">#define RADEON_TILING_EG_BANKH_SHIFT			12</span>
<span class="cp">#define RADEON_TILING_EG_BANKH_MASK			0xf</span>
<span class="cp">#define RADEON_TILING_EG_MACRO_TILE_ASPECT_SHIFT	16</span>
<span class="cp">#define RADEON_TILING_EG_MACRO_TILE_ASPECT_MASK		0xf</span>
<span class="cp">#define RADEON_TILING_EG_TILE_SPLIT_SHIFT		24</span>
<span class="cp">#define RADEON_TILING_EG_TILE_SPLIT_MASK		0xf</span>
<span class="cp">#define RADEON_TILING_EG_STENCIL_TILE_SPLIT_SHIFT	28</span>
<span class="cp">#define RADEON_TILING_EG_STENCIL_TILE_SPLIT_MASK	0xf</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_set_tiling</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>	<span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">tiling_flags</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">pitch</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_get_tiling</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>	<span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">tiling_flags</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">pitch</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_mmap</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>	<span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">pad</span><span class="p">;</span>
	<span class="kt">uint64_t</span>	<span class="n">offset</span><span class="p">;</span>
	<span class="kt">uint64_t</span>	<span class="n">size</span><span class="p">;</span>
	<span class="kt">uint64_t</span>	<span class="n">addr_ptr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_set_domain</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>	<span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">read_domains</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">write_domain</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_wait_idle</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>	<span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">pad</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_busy</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>	<span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span>        <span class="n">domain</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_pread</span> <span class="p">{</span>
	<span class="cm">/** Handle for the object being read. */</span>
	<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pad</span><span class="p">;</span>
	<span class="cm">/** Offset into the object to read from */</span>
	<span class="kt">uint64_t</span> <span class="n">offset</span><span class="p">;</span>
	<span class="cm">/** Length of data to read */</span>
	<span class="kt">uint64_t</span> <span class="n">size</span><span class="p">;</span>
	<span class="cm">/** Pointer to write the data into. */</span>
	<span class="cm">/* void *, but pointers are not 32/64 compatible */</span>
	<span class="kt">uint64_t</span> <span class="n">data_ptr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_pwrite</span> <span class="p">{</span>
	<span class="cm">/** Handle for the object being written to. */</span>
	<span class="kt">uint32_t</span> <span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pad</span><span class="p">;</span>
	<span class="cm">/** Offset into the object to write to */</span>
	<span class="kt">uint64_t</span> <span class="n">offset</span><span class="p">;</span>
	<span class="cm">/** Length of data to write */</span>
	<span class="kt">uint64_t</span> <span class="n">size</span><span class="p">;</span>
	<span class="cm">/** Pointer to read the data from. */</span>
	<span class="cm">/* void *, but pointers are not 32/64 compatible */</span>
	<span class="kt">uint64_t</span> <span class="n">data_ptr</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define RADEON_VA_MAP			1</span>
<span class="cp">#define RADEON_VA_UNMAP			2</span>

<span class="cp">#define RADEON_VA_RESULT_OK		0</span>
<span class="cp">#define RADEON_VA_RESULT_ERROR		1</span>
<span class="cp">#define RADEON_VA_RESULT_VA_EXIST	2</span>

<span class="cp">#define RADEON_VM_PAGE_VALID		(1 &lt;&lt; 0)</span>
<span class="cp">#define RADEON_VM_PAGE_READABLE		(1 &lt;&lt; 1)</span>
<span class="cp">#define RADEON_VM_PAGE_WRITEABLE	(1 &lt;&lt; 2)</span>
<span class="cp">#define RADEON_VM_PAGE_SYSTEM		(1 &lt;&lt; 3)</span>
<span class="cp">#define RADEON_VM_PAGE_SNOOPED		(1 &lt;&lt; 4)</span>

<span class="k">struct</span> <span class="n">drm_radeon_gem_va</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>		<span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">operation</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">vm_id</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">flags</span><span class="p">;</span>
	<span class="kt">uint64_t</span>		<span class="n">offset</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define RADEON_CHUNK_ID_RELOCS	0x01</span>
<span class="cp">#define RADEON_CHUNK_ID_IB	0x02</span>
<span class="cp">#define RADEON_CHUNK_ID_FLAGS	0x03</span>
<span class="cp">#define RADEON_CHUNK_ID_CONST_IB	0x04</span>

<span class="cm">/* The first dword of RADEON_CHUNK_ID_FLAGS is a uint32 of these flags: */</span>
<span class="cp">#define RADEON_CS_KEEP_TILING_FLAGS 0x01</span>
<span class="cp">#define RADEON_CS_USE_VM            0x02</span>
<span class="cm">/* The second dword of RADEON_CHUNK_ID_FLAGS is a uint32 that sets the ring type */</span>
<span class="cp">#define RADEON_CS_RING_GFX          0</span>
<span class="cp">#define RADEON_CS_RING_COMPUTE      1</span>
<span class="cm">/* The third dword of RADEON_CHUNK_ID_FLAGS is a sint32 that sets the priority */</span>
<span class="cm">/* 0 = normal, + = higher priority, - = lower priority */</span>

<span class="k">struct</span> <span class="n">drm_radeon_cs_chunk</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>		<span class="n">chunk_id</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">length_dw</span><span class="p">;</span>
	<span class="kt">uint64_t</span>		<span class="n">chunk_data</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* drm_radeon_cs_reloc.flags */</span>

<span class="k">struct</span> <span class="n">drm_radeon_cs_reloc</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>		<span class="n">handle</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">read_domains</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">write_domain</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">drm_radeon_cs</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>		<span class="n">num_chunks</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">cs_id</span><span class="p">;</span>
	<span class="cm">/* this points to uint64_t * which point to cs chunks */</span>
	<span class="kt">uint64_t</span>		<span class="n">chunks</span><span class="p">;</span>
	<span class="cm">/* updates to the limits after this CS ioctl */</span>
	<span class="kt">uint64_t</span>		<span class="n">gart_limit</span><span class="p">;</span>
	<span class="kt">uint64_t</span>		<span class="n">vram_limit</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define RADEON_INFO_DEVICE_ID		0x00</span>
<span class="cp">#define RADEON_INFO_NUM_GB_PIPES	0x01</span>
<span class="cp">#define RADEON_INFO_NUM_Z_PIPES 	0x02</span>
<span class="cp">#define RADEON_INFO_ACCEL_WORKING	0x03</span>
<span class="cp">#define RADEON_INFO_CRTC_FROM_ID	0x04</span>
<span class="cp">#define RADEON_INFO_ACCEL_WORKING2	0x05</span>
<span class="cp">#define RADEON_INFO_TILING_CONFIG	0x06</span>
<span class="cp">#define RADEON_INFO_WANT_HYPERZ		0x07</span>
<span class="cp">#define RADEON_INFO_WANT_CMASK		0x08 </span><span class="cm">/* get access to CMASK on r300 */</span><span class="cp"></span>
<span class="cp">#define RADEON_INFO_CLOCK_CRYSTAL_FREQ	0x09 </span><span class="cm">/* clock crystal frequency */</span><span class="cp"></span>
<span class="cp">#define RADEON_INFO_NUM_BACKENDS	0x0a </span><span class="cm">/* DB/backends for r600+ - need for OQ */</span><span class="cp"></span>
<span class="cp">#define RADEON_INFO_NUM_TILE_PIPES	0x0b </span><span class="cm">/* tile pipes for r600+ */</span><span class="cp"></span>
<span class="cp">#define RADEON_INFO_FUSION_GART_WORKING	0x0c </span><span class="cm">/* fusion writes to GTT were broken before this */</span><span class="cp"></span>
<span class="cp">#define RADEON_INFO_BACKEND_MAP		0x0d </span><span class="cm">/* pipe to backend map, needed by mesa */</span><span class="cp"></span>
<span class="cm">/* virtual address start, va &lt; start are reserved by the kernel */</span>
<span class="cp">#define RADEON_INFO_VA_START		0x0e</span>
<span class="cm">/* maximum size of ib using the virtual memory cs */</span>
<span class="cp">#define RADEON_INFO_IB_VM_MAX_SIZE	0x0f</span>
<span class="cm">/* max pipes - needed for compute shaders */</span>
<span class="cp">#define RADEON_INFO_MAX_PIPES		0x10</span>

<span class="k">struct</span> <span class="n">drm_radeon_info</span> <span class="p">{</span>
	<span class="kt">uint32_t</span>		<span class="n">request</span><span class="p">;</span>
	<span class="kt">uint32_t</span>		<span class="n">pad</span><span class="p">;</span>
	<span class="kt">uint64_t</span>		<span class="n">value</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
