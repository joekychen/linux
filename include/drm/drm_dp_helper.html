<!DOCTYPE html>
<html><head><title>joekychen/linux » include › drm › drm_dp_helper.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>drm_dp_helper.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright © 2008 Keith Packard</span>
<span class="cm"> *</span>
<span class="cm"> * Permission to use, copy, modify, distribute, and sell this software and its</span>
<span class="cm"> * documentation for any purpose is hereby granted without fee, provided that</span>
<span class="cm"> * the above copyright notice appear in all copies and that both that copyright</span>
<span class="cm"> * notice and this permission notice appear in supporting documentation, and</span>
<span class="cm"> * that the name of the copyright holders not be used in advertising or</span>
<span class="cm"> * publicity pertaining to distribution of the software without specific,</span>
<span class="cm"> * written prior permission.  The copyright holders make no representations</span>
<span class="cm"> * about the suitability of this software for any purpose.  It is provided &quot;as</span>
<span class="cm"> * is&quot; without express or implied warranty.</span>
<span class="cm"> *</span>
<span class="cm"> * THE COPYRIGHT HOLDERS DISCLAIM ALL WARRANTIES WITH REGARD TO THIS SOFTWARE,</span>
<span class="cm"> * INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS, IN NO</span>
<span class="cm"> * EVENT SHALL THE COPYRIGHT HOLDERS BE LIABLE FOR ANY SPECIAL, INDIRECT OR</span>
<span class="cm"> * CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS OF USE,</span>
<span class="cm"> * DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER</span>
<span class="cm"> * TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE</span>
<span class="cm"> * OF THIS SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _DRM_DP_HELPER_H_</span>
<span class="cp">#define _DRM_DP_HELPER_H_</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>

<span class="cm">/* From the VESA DisplayPort spec */</span>

<span class="cp">#define AUX_NATIVE_WRITE	0x8</span>
<span class="cp">#define AUX_NATIVE_READ		0x9</span>
<span class="cp">#define AUX_I2C_WRITE		0x0</span>
<span class="cp">#define AUX_I2C_READ		0x1</span>
<span class="cp">#define AUX_I2C_STATUS		0x2</span>
<span class="cp">#define AUX_I2C_MOT		0x4</span>

<span class="cp">#define AUX_NATIVE_REPLY_ACK	(0x0 &lt;&lt; 4)</span>
<span class="cp">#define AUX_NATIVE_REPLY_NACK	(0x1 &lt;&lt; 4)</span>
<span class="cp">#define AUX_NATIVE_REPLY_DEFER	(0x2 &lt;&lt; 4)</span>
<span class="cp">#define AUX_NATIVE_REPLY_MASK	(0x3 &lt;&lt; 4)</span>

<span class="cp">#define AUX_I2C_REPLY_ACK	(0x0 &lt;&lt; 6)</span>
<span class="cp">#define AUX_I2C_REPLY_NACK	(0x1 &lt;&lt; 6)</span>
<span class="cp">#define AUX_I2C_REPLY_DEFER	(0x2 &lt;&lt; 6)</span>
<span class="cp">#define AUX_I2C_REPLY_MASK	(0x3 &lt;&lt; 6)</span>

<span class="cm">/* AUX CH addresses */</span>
<span class="cm">/* DPCD */</span>
<span class="cp">#define DP_DPCD_REV                         0x000</span>

<span class="cp">#define DP_MAX_LINK_RATE                    0x001</span>

<span class="cp">#define DP_MAX_LANE_COUNT                   0x002</span>
<span class="cp"># define DP_MAX_LANE_COUNT_MASK		    0x1f</span>
<span class="cp"># define DP_TPS3_SUPPORTED		    (1 &lt;&lt; 6)</span>
<span class="cp"># define DP_ENHANCED_FRAME_CAP		    (1 &lt;&lt; 7)</span>

<span class="cp">#define DP_MAX_DOWNSPREAD                   0x003</span>
<span class="cp"># define DP_NO_AUX_HANDSHAKE_LINK_TRAINING  (1 &lt;&lt; 6)</span>

<span class="cp">#define DP_NORP                             0x004</span>

<span class="cp">#define DP_DOWNSTREAMPORT_PRESENT           0x005</span>
<span class="cp"># define DP_DWN_STRM_PORT_PRESENT           (1 &lt;&lt; 0)</span>
<span class="cp"># define DP_DWN_STRM_PORT_TYPE_MASK         0x06</span>
<span class="cm">/* 00b = DisplayPort */</span>
<span class="cm">/* 01b = Analog */</span>
<span class="cm">/* 10b = TMDS or HDMI */</span>
<span class="cm">/* 11b = Other */</span>
<span class="cp"># define DP_FORMAT_CONVERSION               (1 &lt;&lt; 3)</span>

<span class="cp">#define DP_MAIN_LINK_CHANNEL_CODING         0x006</span>

<span class="cp">#define DP_DOWN_STREAM_PORT_COUNT	    0x007</span>
<span class="cp">#define  DP_PORT_COUNT_MASK		    0x0f</span>
<span class="cp">#define  DP_OUI_SUPPORT			    (1 &lt;&lt; 7)</span>

<span class="cp">#define DP_EDP_CONFIGURATION_CAP            0x00d</span>
<span class="cp">#define DP_TRAINING_AUX_RD_INTERVAL         0x00e</span>

<span class="cp">#define DP_PSR_SUPPORT                      0x070</span>
<span class="cp"># define DP_PSR_IS_SUPPORTED                1</span>
<span class="cp">#define DP_PSR_CAPS                         0x071</span>
<span class="cp"># define DP_PSR_NO_TRAIN_ON_EXIT            1</span>
<span class="cp"># define DP_PSR_SETUP_TIME_330              (0 &lt;&lt; 1)</span>
<span class="cp"># define DP_PSR_SETUP_TIME_275              (1 &lt;&lt; 1)</span>
<span class="cp"># define DP_PSR_SETUP_TIME_220              (2 &lt;&lt; 1)</span>
<span class="cp"># define DP_PSR_SETUP_TIME_165              (3 &lt;&lt; 1)</span>
<span class="cp"># define DP_PSR_SETUP_TIME_110              (4 &lt;&lt; 1)</span>
<span class="cp"># define DP_PSR_SETUP_TIME_55               (5 &lt;&lt; 1)</span>
<span class="cp"># define DP_PSR_SETUP_TIME_0                (6 &lt;&lt; 1)</span>
<span class="cp"># define DP_PSR_SETUP_TIME_MASK             (7 &lt;&lt; 1)</span>
<span class="cp"># define DP_PSR_SETUP_TIME_SHIFT            1</span>

<span class="cm">/* link configuration */</span>
<span class="cp">#define	DP_LINK_BW_SET		            0x100</span>
<span class="cp"># define DP_LINK_BW_1_62		    0x06</span>
<span class="cp"># define DP_LINK_BW_2_7			    0x0a</span>
<span class="cp"># define DP_LINK_BW_5_4			    0x14</span>

<span class="cp">#define DP_LANE_COUNT_SET	            0x101</span>
<span class="cp"># define DP_LANE_COUNT_MASK		    0x0f</span>
<span class="cp"># define DP_LANE_COUNT_ENHANCED_FRAME_EN    (1 &lt;&lt; 7)</span>

<span class="cp">#define DP_TRAINING_PATTERN_SET	            0x102</span>
<span class="cp"># define DP_TRAINING_PATTERN_DISABLE	    0</span>
<span class="cp"># define DP_TRAINING_PATTERN_1		    1</span>
<span class="cp"># define DP_TRAINING_PATTERN_2		    2</span>
<span class="cp"># define DP_TRAINING_PATTERN_3		    3</span>
<span class="cp"># define DP_TRAINING_PATTERN_MASK	    0x3</span>

<span class="cp"># define DP_LINK_QUAL_PATTERN_DISABLE	    (0 &lt;&lt; 2)</span>
<span class="cp"># define DP_LINK_QUAL_PATTERN_D10_2	    (1 &lt;&lt; 2)</span>
<span class="cp"># define DP_LINK_QUAL_PATTERN_ERROR_RATE    (2 &lt;&lt; 2)</span>
<span class="cp"># define DP_LINK_QUAL_PATTERN_PRBS7	    (3 &lt;&lt; 2)</span>
<span class="cp"># define DP_LINK_QUAL_PATTERN_MASK	    (3 &lt;&lt; 2)</span>

<span class="cp"># define DP_RECOVERED_CLOCK_OUT_EN	    (1 &lt;&lt; 4)</span>
<span class="cp"># define DP_LINK_SCRAMBLING_DISABLE	    (1 &lt;&lt; 5)</span>

<span class="cp"># define DP_SYMBOL_ERROR_COUNT_BOTH	    (0 &lt;&lt; 6)</span>
<span class="cp"># define DP_SYMBOL_ERROR_COUNT_DISPARITY    (1 &lt;&lt; 6)</span>
<span class="cp"># define DP_SYMBOL_ERROR_COUNT_SYMBOL	    (2 &lt;&lt; 6)</span>
<span class="cp"># define DP_SYMBOL_ERROR_COUNT_MASK	    (3 &lt;&lt; 6)</span>

<span class="cp">#define DP_TRAINING_LANE0_SET		    0x103</span>
<span class="cp">#define DP_TRAINING_LANE1_SET		    0x104</span>
<span class="cp">#define DP_TRAINING_LANE2_SET		    0x105</span>
<span class="cp">#define DP_TRAINING_LANE3_SET		    0x106</span>

<span class="cp"># define DP_TRAIN_VOLTAGE_SWING_MASK	    0x3</span>
<span class="cp"># define DP_TRAIN_VOLTAGE_SWING_SHIFT	    0</span>
<span class="cp"># define DP_TRAIN_MAX_SWING_REACHED	    (1 &lt;&lt; 2)</span>
<span class="cp"># define DP_TRAIN_VOLTAGE_SWING_400	    (0 &lt;&lt; 0)</span>
<span class="cp"># define DP_TRAIN_VOLTAGE_SWING_600	    (1 &lt;&lt; 0)</span>
<span class="cp"># define DP_TRAIN_VOLTAGE_SWING_800	    (2 &lt;&lt; 0)</span>
<span class="cp"># define DP_TRAIN_VOLTAGE_SWING_1200	    (3 &lt;&lt; 0)</span>

<span class="cp"># define DP_TRAIN_PRE_EMPHASIS_MASK	    (3 &lt;&lt; 3)</span>
<span class="cp"># define DP_TRAIN_PRE_EMPHASIS_0	    (0 &lt;&lt; 3)</span>
<span class="cp"># define DP_TRAIN_PRE_EMPHASIS_3_5	    (1 &lt;&lt; 3)</span>
<span class="cp"># define DP_TRAIN_PRE_EMPHASIS_6	    (2 &lt;&lt; 3)</span>
<span class="cp"># define DP_TRAIN_PRE_EMPHASIS_9_5	    (3 &lt;&lt; 3)</span>

<span class="cp"># define DP_TRAIN_PRE_EMPHASIS_SHIFT	    3</span>
<span class="cp"># define DP_TRAIN_MAX_PRE_EMPHASIS_REACHED  (1 &lt;&lt; 5)</span>

<span class="cp">#define DP_DOWNSPREAD_CTRL		    0x107</span>
<span class="cp"># define DP_SPREAD_AMP_0_5		    (1 &lt;&lt; 4)</span>

<span class="cp">#define DP_MAIN_LINK_CHANNEL_CODING_SET	    0x108</span>
<span class="cp"># define DP_SET_ANSI_8B10B		    (1 &lt;&lt; 0)</span>

<span class="cp">#define DP_PSR_EN_CFG			    0x170</span>
<span class="cp"># define DP_PSR_ENABLE			    (1 &lt;&lt; 0)</span>
<span class="cp"># define DP_PSR_MAIN_LINK_ACTIVE	    (1 &lt;&lt; 1)</span>
<span class="cp"># define DP_PSR_CRC_VERIFICATION	    (1 &lt;&lt; 2)</span>
<span class="cp"># define DP_PSR_FRAME_CAPTURE		    (1 &lt;&lt; 3)</span>

<span class="cp">#define DP_DEVICE_SERVICE_IRQ_VECTOR	    0x201</span>
<span class="cp"># define DP_REMOTE_CONTROL_COMMAND_PENDING  (1 &lt;&lt; 0)</span>
<span class="cp"># define DP_AUTOMATED_TEST_REQUEST	    (1 &lt;&lt; 1)</span>
<span class="cp"># define DP_CP_IRQ			    (1 &lt;&lt; 2)</span>
<span class="cp"># define DP_SINK_SPECIFIC_IRQ		    (1 &lt;&lt; 6)</span>

<span class="cp">#define DP_EDP_CONFIGURATION_SET            0x10a</span>

<span class="cp">#define DP_LANE0_1_STATUS		    0x202</span>
<span class="cp">#define DP_LANE2_3_STATUS		    0x203</span>
<span class="cp"># define DP_LANE_CR_DONE		    (1 &lt;&lt; 0)</span>
<span class="cp"># define DP_LANE_CHANNEL_EQ_DONE	    (1 &lt;&lt; 1)</span>
<span class="cp"># define DP_LANE_SYMBOL_LOCKED		    (1 &lt;&lt; 2)</span>

<span class="cp">#define DP_CHANNEL_EQ_BITS (DP_LANE_CR_DONE |		\</span>
<span class="cp">			    DP_LANE_CHANNEL_EQ_DONE |	\</span>
<span class="cp">			    DP_LANE_SYMBOL_LOCKED)</span>

<span class="cp">#define DP_LANE_ALIGN_STATUS_UPDATED	    0x204</span>

<span class="cp">#define DP_INTERLANE_ALIGN_DONE		    (1 &lt;&lt; 0)</span>
<span class="cp">#define DP_DOWNSTREAM_PORT_STATUS_CHANGED   (1 &lt;&lt; 6)</span>
<span class="cp">#define DP_LINK_STATUS_UPDATED		    (1 &lt;&lt; 7)</span>

<span class="cp">#define DP_SINK_STATUS			    0x205</span>

<span class="cp">#define DP_RECEIVE_PORT_0_STATUS	    (1 &lt;&lt; 0)</span>
<span class="cp">#define DP_RECEIVE_PORT_1_STATUS	    (1 &lt;&lt; 1)</span>

<span class="cp">#define DP_ADJUST_REQUEST_LANE0_1	    0x206</span>
<span class="cp">#define DP_ADJUST_REQUEST_LANE2_3	    0x207</span>
<span class="cp"># define DP_ADJUST_VOLTAGE_SWING_LANE0_MASK  0x03</span>
<span class="cp"># define DP_ADJUST_VOLTAGE_SWING_LANE0_SHIFT 0</span>
<span class="cp"># define DP_ADJUST_PRE_EMPHASIS_LANE0_MASK   0x0c</span>
<span class="cp"># define DP_ADJUST_PRE_EMPHASIS_LANE0_SHIFT  2</span>
<span class="cp"># define DP_ADJUST_VOLTAGE_SWING_LANE1_MASK  0x30</span>
<span class="cp"># define DP_ADJUST_VOLTAGE_SWING_LANE1_SHIFT 4</span>
<span class="cp"># define DP_ADJUST_PRE_EMPHASIS_LANE1_MASK   0xc0</span>
<span class="cp"># define DP_ADJUST_PRE_EMPHASIS_LANE1_SHIFT  6</span>

<span class="cp">#define DP_TEST_REQUEST			    0x218</span>
<span class="cp"># define DP_TEST_LINK_TRAINING		    (1 &lt;&lt; 0)</span>
<span class="cp"># define DP_TEST_LINK_PATTERN		    (1 &lt;&lt; 1)</span>
<span class="cp"># define DP_TEST_LINK_EDID_READ		    (1 &lt;&lt; 2)</span>
<span class="cp"># define DP_TEST_LINK_PHY_TEST_PATTERN	    (1 &lt;&lt; 3) </span><span class="cm">/* DPCD &gt;= 1.1 */</span><span class="cp"></span>

<span class="cp">#define DP_TEST_LINK_RATE		    0x219</span>
<span class="cp"># define DP_LINK_RATE_162		    (0x6)</span>
<span class="cp"># define DP_LINK_RATE_27		    (0xa)</span>

<span class="cp">#define DP_TEST_LANE_COUNT		    0x220</span>

<span class="cp">#define DP_TEST_PATTERN			    0x221</span>

<span class="cp">#define DP_TEST_RESPONSE		    0x260</span>
<span class="cp"># define DP_TEST_ACK			    (1 &lt;&lt; 0)</span>
<span class="cp"># define DP_TEST_NAK			    (1 &lt;&lt; 1)</span>
<span class="cp"># define DP_TEST_EDID_CHECKSUM_WRITE	    (1 &lt;&lt; 2)</span>

<span class="cp">#define DP_SOURCE_OUI			    0x300</span>
<span class="cp">#define DP_SINK_OUI			    0x400</span>
<span class="cp">#define DP_BRANCH_OUI			    0x500</span>

<span class="cp">#define DP_SET_POWER                        0x600</span>
<span class="cp"># define DP_SET_POWER_D0                    0x1</span>
<span class="cp"># define DP_SET_POWER_D3                    0x2</span>

<span class="cp">#define DP_PSR_ERROR_STATUS                 0x2006</span>
<span class="cp"># define DP_PSR_LINK_CRC_ERROR              (1 &lt;&lt; 0)</span>
<span class="cp"># define DP_PSR_RFB_STORAGE_ERROR           (1 &lt;&lt; 1)</span>

<span class="cp">#define DP_PSR_ESI                          0x2007</span>
<span class="cp"># define DP_PSR_CAPS_CHANGE                 (1 &lt;&lt; 0)</span>

<span class="cp">#define DP_PSR_STATUS                       0x2008</span>
<span class="cp"># define DP_PSR_SINK_INACTIVE               0</span>
<span class="cp"># define DP_PSR_SINK_ACTIVE_SRC_SYNCED      1</span>
<span class="cp"># define DP_PSR_SINK_ACTIVE_RFB             2</span>
<span class="cp"># define DP_PSR_SINK_ACTIVE_SINK_SYNCED     3</span>
<span class="cp"># define DP_PSR_SINK_ACTIVE_RESYNC          4</span>
<span class="cp"># define DP_PSR_SINK_INTERNAL_ERROR         7</span>
<span class="cp"># define DP_PSR_SINK_STATE_MASK             0x07</span>

<span class="cp">#define MODE_I2C_START	1</span>
<span class="cp">#define MODE_I2C_WRITE	2</span>
<span class="cp">#define MODE_I2C_READ	4</span>
<span class="cp">#define MODE_I2C_STOP	8</span>

<span class="k">struct</span> <span class="n">i2c_algo_dp_aux_data</span> <span class="p">{</span>
	<span class="n">bool</span> <span class="n">running</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">address</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">aux_ch</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span>
		       <span class="kt">int</span> <span class="n">mode</span><span class="p">,</span> <span class="kt">uint8_t</span> <span class="n">write_byte</span><span class="p">,</span>
		       <span class="kt">uint8_t</span> <span class="o">*</span><span class="n">read_byte</span><span class="p">);</span>
<span class="p">};</span>

<span class="kt">int</span>
<span class="n">i2c_dp_aux_add_bus</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* _DRM_DP_HELPER_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
