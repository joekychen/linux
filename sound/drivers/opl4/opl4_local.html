<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › drivers › opl4 › opl4_local.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>opl4_local.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Local definitions for the OPL4 driver</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2003 by Clemens Ladisch &lt;clemens@ladisch.de&gt;</span>
<span class="cm"> * All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * Redistribution and use in source and binary forms, with or without</span>
<span class="cm"> * modification, are permitted provided that the following conditions</span>
<span class="cm"> * are met:</span>
<span class="cm"> * 1. Redistributions of source code must retain the above copyright</span>
<span class="cm"> *    notice, this list of conditions, and the following disclaimer,</span>
<span class="cm"> *    without modification.</span>
<span class="cm"> * 2. The name of the author may not be used to endorse or promote products</span>
<span class="cm"> *    derived from this software without specific prior written permission.</span>
<span class="cm"> *</span>
<span class="cm"> * Alternatively, this software may be distributed and/or modified under the</span>
<span class="cm"> * terms of the GNU General Public License as published by the Free Software</span>
<span class="cm"> * Foundation; either version 2 of the License, or (at your option) any later</span>
<span class="cm"> * version.</span>
<span class="cm"> *</span>
<span class="cm"> * THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS&#39;&#39; AND</span>
<span class="cm"> * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="cm"> * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="cm"> * ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE FOR</span>
<span class="cm"> * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<span class="cm"> * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS</span>
<span class="cm"> * OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)</span>
<span class="cm"> * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT</span>
<span class="cm"> * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY</span>
<span class="cm"> * OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF</span>
<span class="cm"> * SUCH DAMAGE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __OPL4_LOCAL_H</span>
<span class="cp">#define __OPL4_LOCAL_H</span>

<span class="cp">#include &lt;sound/opl4.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Register numbers</span>
<span class="cm"> */</span>

<span class="cp">#define OPL4_REG_TEST0			0x00</span>
<span class="cp">#define OPL4_REG_TEST1			0x01</span>

<span class="cp">#define OPL4_REG_MEMORY_CONFIGURATION	0x02</span>
<span class="cp">#define   OPL4_MODE_BIT			0x01</span>
<span class="cp">#define   OPL4_MTYPE_BIT		0x02</span>
<span class="cp">#define   OPL4_TONE_HEADER_MASK		0x1c</span>
<span class="cp">#define   OPL4_DEVICE_ID_MASK		0xe0</span>

<span class="cp">#define OPL4_REG_MEMORY_ADDRESS_HIGH	0x03</span>
<span class="cp">#define OPL4_REG_MEMORY_ADDRESS_MID	0x04</span>
<span class="cp">#define OPL4_REG_MEMORY_ADDRESS_LOW	0x05</span>
<span class="cp">#define OPL4_REG_MEMORY_DATA		0x06</span>

<span class="cm">/*</span>
<span class="cm"> * Offsets to the register banks for voices. To get the</span>
<span class="cm"> * register number just add the voice number to the bank offset.</span>
<span class="cm"> *</span>
<span class="cm"> * Wave Table Number low bits (0x08 to 0x1F)</span>
<span class="cm"> */</span>
<span class="cp">#define OPL4_REG_TONE_NUMBER		0x08</span>

<span class="cm">/* Wave Table Number high bit, F-Number low bits (0x20 to 0x37) */</span>
<span class="cp">#define OPL4_REG_F_NUMBER		0x20</span>
<span class="cp">#define   OPL4_TONE_NUMBER_BIT8		0x01</span>
<span class="cp">#define   OPL4_F_NUMBER_LOW_MASK	0xfe</span>

<span class="cm">/* F-Number high bits, Octave, Pseudo-Reverb (0x38 to 0x4F) */</span>
<span class="cp">#define OPL4_REG_OCTAVE			0x38</span>
<span class="cp">#define   OPL4_F_NUMBER_HIGH_MASK	0x07</span>
<span class="cp">#define   OPL4_BLOCK_MASK		0xf0</span>
<span class="cp">#define   OPL4_PSEUDO_REVERB_BIT	0x08</span>

<span class="cm">/* Total Level, Level Direct (0x50 to 0x67) */</span>
<span class="cp">#define OPL4_REG_LEVEL			0x50</span>
<span class="cp">#define   OPL4_TOTAL_LEVEL_MASK		0xfe</span>
<span class="cp">#define   OPL4_LEVEL_DIRECT_BIT		0x01</span>

<span class="cm">/* Key On, Damp, LFO RST, CH, Panpot (0x68 to 0x7F) */</span>
<span class="cp">#define OPL4_REG_MISC			0x68</span>
<span class="cp">#define   OPL4_KEY_ON_BIT		0x80</span>
<span class="cp">#define   OPL4_DAMP_BIT			0x40</span>
<span class="cp">#define   OPL4_LFO_RESET_BIT		0x20</span>
<span class="cp">#define   OPL4_OUTPUT_CHANNEL_BIT	0x10</span>
<span class="cp">#define   OPL4_PAN_POT_MASK		0x0f</span>

<span class="cm">/* LFO, VIB (0x80 to 0x97) */</span>
<span class="cp">#define OPL4_REG_LFO_VIBRATO		0x80</span>
<span class="cp">#define   OPL4_LFO_FREQUENCY_MASK	0x38</span>
<span class="cp">#define   OPL4_VIBRATO_DEPTH_MASK	0x07</span>
<span class="cp">#define   OPL4_CHORUS_SEND_MASK		0xc0 </span><span class="cm">/* ML only */</span><span class="cp"></span>

<span class="cm">/* Attack / Decay 1 rate (0x98 to 0xAF) */</span>
<span class="cp">#define OPL4_REG_ATTACK_DECAY1		0x98</span>
<span class="cp">#define   OPL4_ATTACK_RATE_MASK		0xf0</span>
<span class="cp">#define   OPL4_DECAY1_RATE_MASK		0x0f</span>

<span class="cm">/* Decay level / 2 rate (0xB0 to 0xC7) */</span>
<span class="cp">#define OPL4_REG_LEVEL_DECAY2		0xb0</span>
<span class="cp">#define   OPL4_DECAY_LEVEL_MASK		0xf0</span>
<span class="cp">#define   OPL4_DECAY2_RATE_MASK		0x0f</span>

<span class="cm">/* Release rate / Rate correction (0xC8 to 0xDF) */</span>
<span class="cp">#define OPL4_REG_RELEASE_CORRECTION	0xc8</span>
<span class="cp">#define   OPL4_RELEASE_RATE_MASK	0x0f</span>
<span class="cp">#define   OPL4_RATE_INTERPOLATION_MASK	0xf0</span>

<span class="cm">/* AM (0xE0 to 0xF7) */</span>
<span class="cp">#define OPL4_REG_TREMOLO		0xe0</span>
<span class="cp">#define   OPL4_TREMOLO_DEPTH_MASK	0x07</span>
<span class="cp">#define   OPL4_REVERB_SEND_MASK		0xe0 </span><span class="cm">/* ML only */</span><span class="cp"></span>

<span class="cm">/* Mixer */</span>
<span class="cp">#define OPL4_REG_MIX_CONTROL_FM		0xf8</span>
<span class="cp">#define OPL4_REG_MIX_CONTROL_PCM	0xf9</span>
<span class="cp">#define   OPL4_MIX_LEFT_MASK		0x07</span>
<span class="cp">#define   OPL4_MIX_RIGHT_MASK		0x38</span>

<span class="cp">#define OPL4_REG_ATC			0xfa</span>
<span class="cp">#define   OPL4_ATC_BIT			0x01 </span><span class="cm">/* ???, ML only */</span><span class="cp"></span>

<span class="cm">/* bits in the OPL3 Status register */</span>
<span class="cp">#define OPL4_STATUS_BUSY		0x01</span>
<span class="cp">#define OPL4_STATUS_LOAD		0x02</span>


<span class="cp">#define OPL4_MAX_VOICES 24</span>

<span class="cp">#define SNDRV_SEQ_DEV_ID_OPL4 &quot;opl4-synth&quot;</span>


<span class="k">struct</span> <span class="n">opl4_sound</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">tone</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">pitch_offset</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">key_scaling</span><span class="p">;</span>
	<span class="n">s8</span> <span class="n">panpot</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">vibrato</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tone_attenuate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">volume_factor</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg_lfo_vibrato</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg_attack_decay1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg_level_decay2</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg_release_correction</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg_tremolo</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">opl4_region</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">key_min</span><span class="p">,</span> <span class="n">key_max</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">opl4_sound</span> <span class="n">sound</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">opl4_region_ptr</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">opl4_region</span> <span class="o">*</span><span class="n">regions</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">opl4_voice</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">number</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">note</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">velocity</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">opl4_sound</span> <span class="o">*</span><span class="n">sound</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">level_direct</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg_f_number</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg_misc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg_lfo_vibrato</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_opl4</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">fm_port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pcm_port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">res_fm_port</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">resource</span> <span class="o">*</span><span class="n">res_pcm_port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">hardware</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">reg_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_PROC_FS</span>
	<span class="k">struct</span> <span class="n">snd_info_entry</span> <span class="o">*</span><span class="n">proc_entry</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">memory_access</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">access_mutex</span><span class="p">;</span>

<span class="cp">#if defined(CONFIG_SND_SEQUENCER) || defined(CONFIG_SND_SEQUENCER_MODULE)</span>
	<span class="kt">int</span> <span class="n">used</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">seq_dev_num</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">seq_client</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_seq_device</span> <span class="o">*</span><span class="n">seq_dev</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span><span class="n">chset</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">opl4_voice</span> <span class="n">voices</span><span class="p">[</span><span class="n">OPL4_MAX_VOICES</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">off_voices</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">on_voices</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="cm">/* opl4_lib.c */</span>
<span class="kt">void</span> <span class="n">snd_opl4_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl4</span> <span class="o">*</span><span class="n">opl4</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">value</span><span class="p">);</span>
<span class="n">u8</span> <span class="n">snd_opl4_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl4</span> <span class="o">*</span><span class="n">opl4</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_opl4_read_memory</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl4</span> <span class="o">*</span><span class="n">opl4</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_opl4_write_memory</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl4</span> <span class="o">*</span><span class="n">opl4</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>

<span class="cm">/* opl4_mixer.c */</span>
<span class="kt">int</span> <span class="n">snd_opl4_create_mixer</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl4</span> <span class="o">*</span><span class="n">opl4</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_PROC_FS</span>
<span class="cm">/* opl4_proc.c */</span>
<span class="kt">int</span> <span class="n">snd_opl4_create_proc</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl4</span> <span class="o">*</span><span class="n">opl4</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_opl4_free_proc</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl4</span> <span class="o">*</span><span class="n">opl4</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cm">/* opl4_seq.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">volume_boost</span><span class="p">;</span>

<span class="cm">/* opl4_synth.c */</span>
<span class="kt">void</span> <span class="n">snd_opl4_synth_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl4</span> <span class="o">*</span><span class="n">opl4</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_opl4_synth_shutdown</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl4</span> <span class="o">*</span><span class="n">opl4</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_opl4_note_on</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">note</span><span class="p">,</span> <span class="kt">int</span> <span class="n">vel</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_opl4_note_off</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">note</span><span class="p">,</span> <span class="kt">int</span> <span class="n">vel</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_opl4_terminate_note</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">note</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_opl4_control</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_opl4_sysex</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">parsed</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_midi_channel_set</span> <span class="o">*</span><span class="n">chset</span><span class="p">);</span>

<span class="cm">/* yrw801.c */</span>
<span class="kt">int</span> <span class="n">snd_yrw801_detect</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_opl4</span> <span class="o">*</span><span class="n">opl4</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">opl4_region_ptr</span> <span class="n">snd_yrw801_regions</span><span class="p">[];</span>

<span class="cp">#endif </span><span class="cm">/* __OPL4_LOCAL_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
