<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › pci › au88x0 › au88x0_a3d.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>au88x0_a3d.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/***************************************************************************</span>
<span class="cm"> *            au88x0_a3d.c</span>
<span class="cm"> *</span>
<span class="cm"> *  Fri Jul 18 14:16:22 2003</span>
<span class="cm"> *  Copyright  2003  mjander</span>
<span class="cm"> *  mjander@users.sourceforge.net</span>
<span class="cm"> *</span>
<span class="cm"> * A3D. You may think i&#39;m crazy, but this may work someday. Who knows...</span>
<span class="cm"> ****************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *  (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU Library General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;au88x0_a3d.h&quot;</span>
<span class="cp">#include &quot;au88x0_a3ddata.c&quot;</span>
<span class="cp">#include &quot;au88x0_xtalk.h&quot;</span>
<span class="cp">#include &quot;au88x0.h&quot;</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">a3dsrc_SetTimeConsts</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">short</span> <span class="n">HrtfTrack</span><span class="p">,</span> <span class="kt">short</span> <span class="n">ItdTrack</span><span class="p">,</span>
		     <span class="kt">short</span> <span class="n">GTrack</span><span class="p">,</span> <span class="kt">short</span> <span class="n">CTrack</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_A_HrtfTrackTC</span><span class="p">),</span> <span class="n">HrtfTrack</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_A_ITDTrackTC</span><span class="p">),</span> <span class="n">ItdTrack</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_A_GainTrackTC</span><span class="p">),</span> <span class="n">GTrack</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_A_CoeffTrackTC</span><span class="p">),</span> <span class="n">CTrack</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void</span>
<span class="c">a3dsrc_GetTimeConsts(a3dsrc_t * a, short *HrtfTrack, short *ItdTrack,</span>
<span class="c">		     short *GTrack, short *CTrack)</span>
<span class="c">{</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>stub!</p></td><td class="code"><div class="highlight"><pre><span class="c">}</span>

<span class="cp">#endif</span>
<span class="cm">/* Atmospheric absorption. */</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">a3dsrc_SetAtmosTarget</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">short</span> <span class="n">aa</span><span class="p">,</span> <span class="kt">short</span> <span class="n">b</span><span class="p">,</span> <span class="kt">short</span> <span class="n">c</span><span class="p">,</span> <span class="kt">short</span> <span class="n">d</span><span class="p">,</span>
		      <span class="kt">short</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_B_A21Target</span><span class="p">),</span>
		<span class="p">(</span><span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">d</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_B_B10Target</span><span class="p">),</span>
		<span class="p">(</span><span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">aa</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_B_B2Target</span><span class="p">),</span> <span class="n">c</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">a3dsrc_SetAtmosCurrent</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">short</span> <span class="n">aa</span><span class="p">,</span> <span class="kt">short</span> <span class="n">b</span><span class="p">,</span> <span class="kt">short</span> <span class="n">c</span><span class="p">,</span> <span class="kt">short</span> <span class="n">d</span><span class="p">,</span>
		       <span class="kt">short</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_B_A12Current</span><span class="p">),</span>
		<span class="p">(</span><span class="n">e</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">d</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_B_B01Current</span><span class="p">),</span>
		<span class="p">(</span><span class="n">b</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">aa</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_B_B2Current</span><span class="p">),</span> <span class="n">c</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">a3dsrc_SetAtmosState</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">short</span> <span class="n">x1</span><span class="p">,</span> <span class="kt">short</span> <span class="n">x2</span><span class="p">,</span> <span class="kt">short</span> <span class="n">y1</span><span class="p">,</span> <span class="kt">short</span> <span class="n">y2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_A_x1</span><span class="p">),</span> <span class="n">x1</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_A_x2</span><span class="p">),</span> <span class="n">x2</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_A_y1</span><span class="p">),</span> <span class="n">y1</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_A_y2</span><span class="p">),</span> <span class="n">y2</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void</span>
<span class="c">a3dsrc_GetAtmosTarget(a3dsrc_t * a, short *aa, short *b, short *c,</span>
<span class="c">		      short *d, short *e)</span>
<span class="c">{</span>
<span class="c">}</span>
<span class="c">static void</span>
<span class="c">a3dsrc_GetAtmosCurrent(a3dsrc_t * a, short *bb01, short *ab01, short *b2,</span>
<span class="c">		       short *aa12, short *ba12)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	*aa12 =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrA(a-&gt;slice, a-&gt;source, A3D_A_A12Current));</span>
<span class="c">	*ba12 =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrB(a-&gt;slice, a-&gt;source, A3D_B_A12Current));</span>
<span class="c">	*ab01 =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrA(a-&gt;slice, a-&gt;source, A3D_A_B01Current));</span>
<span class="c">	*bb01 =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrB(a-&gt;slice, a-&gt;source, A3D_B_B01Current));</span>
<span class="c">	*b2 =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrA(a-&gt;slice, a-&gt;source, A3D_A_B2Current));</span>
<span class="c">}</span>

<span class="c">static void</span>
<span class="c">a3dsrc_GetAtmosState(a3dsrc_t * a, short *x1, short *x2, short *y1, short *y2)</span>
<span class="c">{</span>

<span class="c">}</span>

<span class="cp">#endif</span>
<span class="cm">/* HRTF */</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">a3dsrc_SetHrtfTarget</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">a3d_Hrtf_t</span> <span class="k">const</span> <span class="n">aa</span><span class="p">,</span> <span class="n">a3d_Hrtf_t</span> <span class="k">const</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">HRTF_SZ</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
			<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span>
				  <span class="n">A3D_B_HrtfTarget</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span>
			<span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">a3dsrc_SetHrtfCurrent</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">a3d_Hrtf_t</span> <span class="k">const</span> <span class="n">aa</span><span class="p">,</span> <span class="n">a3d_Hrtf_t</span> <span class="k">const</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">HRTF_SZ</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
			<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span>
				  <span class="n">A3D_B_HrtfCurrent</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span>
			<span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">a3dsrc_SetHrtfState</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">a3d_Hrtf_t</span> <span class="k">const</span> <span class="n">aa</span><span class="p">,</span> <span class="n">a3d_Hrtf_t</span> <span class="k">const</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">HRTF_SZ</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
			<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span>
				  <span class="n">A3D_B_HrtfDelayLine</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span>
			<span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">aa</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_SetHrtfOutput</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">short</span> <span class="n">left</span><span class="p">,</span> <span class="kt">short</span> <span class="n">right</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_A_HrtfOutL</span><span class="p">),</span> <span class="n">left</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_A_HrtfOutR</span><span class="p">),</span> <span class="n">right</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void a3dsrc_GetHrtfTarget(a3dsrc_t * a, a3d_Hrtf_t aa, a3d_Hrtf_t b)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	int i;</span>

<span class="c">	for (i = 0; i &lt; HRTF_SZ; i++)</span>
<span class="c">		aa[i] =</span>
<span class="c">		    hwread(vortex-&gt;mmio,</span>
<span class="c">			   a3d_addrA(a-&gt;slice, a-&gt;source,</span>
<span class="c">				     A3D_A_HrtfTarget + (i &lt;&lt; 2)));</span>
<span class="c">	for (i = 0; i &lt; HRTF_SZ; i++)</span>
<span class="c">		b[i] =</span>
<span class="c">		    hwread(vortex-&gt;mmio,</span>
<span class="c">			   a3d_addrB(a-&gt;slice, a-&gt;source,</span>
<span class="c">				     A3D_B_HrtfTarget + (i &lt;&lt; 2)));</span>
<span class="c">}</span>

<span class="c">static void a3dsrc_GetHrtfCurrent(a3dsrc_t * a, a3d_Hrtf_t aa, a3d_Hrtf_t b)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	int i;</span>

<span class="c">	for (i = 0; i &lt; HRTF_SZ; i++)</span>
<span class="c">		aa[i] =</span>
<span class="c">		    hwread(vortex-&gt;mmio,</span>
<span class="c">			   a3d_addrA(a-&gt;slice, a-&gt;source,</span>
<span class="c">				     A3D_A_HrtfCurrent + (i &lt;&lt; 2)));</span>
<span class="c">	for (i = 0; i &lt; HRTF_SZ; i++)</span>
<span class="c">		b[i] =</span>
<span class="c">		    hwread(vortex-&gt;mmio,</span>
<span class="c">			   a3d_addrB(a-&gt;slice, a-&gt;source,</span>
<span class="c">				     A3D_B_HrtfCurrent + (i &lt;&lt; 2)));</span>
<span class="c">}</span>

<span class="c">static void a3dsrc_GetHrtfState(a3dsrc_t * a, a3d_Hrtf_t aa, a3d_Hrtf_t b)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	int i;</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>FIXME: verify this!</p></td><td class="code"><div class="highlight"><pre><span class="c">	for (i = 0; i &lt; HRTF_SZ; i++)</span>
<span class="c">		aa[i] =</span>
<span class="c">		    hwread(vortex-&gt;mmio,</span>
<span class="c">			   a3d_addrA(a-&gt;slice, a-&gt;source,</span>
<span class="c">				     A3D_A_HrtfDelayLine + (i &lt;&lt; 2)));</span>
<span class="c">	for (i = 0; i &lt; HRTF_SZ; i++)</span>
<span class="c">		b[i] =</span>
<span class="c">		    hwread(vortex-&gt;mmio,</span>
<span class="c">			   a3d_addrB(a-&gt;slice, a-&gt;source,</span>
<span class="c">				     A3D_B_HrtfDelayLine + (i &lt;&lt; 2)));</span>
<span class="c">}</span>

<span class="c">static void a3dsrc_GetHrtfOutput(a3dsrc_t * a, short *left, short *right)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	*left =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrA(a-&gt;slice, a-&gt;source, A3D_A_HrtfOutL));</span>
<span class="c">	*right =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrA(a-&gt;slice, a-&gt;source, A3D_A_HrtfOutR));</span>
<span class="c">}</span>

<span class="cp">#endif</span>

<span class="cm">/* Interaural Time Difference. </span>
<span class="cm"> * &quot;The other main clue that humans use to locate sounds, is called </span>
<span class="cm"> * Interaural Time Difference (ITD). The differences in distance from </span>
<span class="cm"> * the sound source to a listeners ears means  that the sound will </span>
<span class="cm"> * reach one ear slightly before the other....&quot;, found somewhere with google.*/</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_SetItdTarget</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">short</span> <span class="n">litd</span><span class="p">,</span> <span class="kt">short</span> <span class="n">ritd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">litd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">litd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">litd</span> <span class="o">&gt;</span> <span class="mh">0x57FF</span><span class="p">)</span>
		<span class="n">litd</span> <span class="o">=</span> <span class="mh">0x57FF</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ritd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">ritd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ritd</span> <span class="o">&gt;</span> <span class="mh">0x57FF</span><span class="p">)</span>
		<span class="n">ritd</span> <span class="o">=</span> <span class="mh">0x57FF</span><span class="p">;</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_B_ITDTarget</span><span class="p">),</span>
		<span class="p">(</span><span class="n">ritd</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">litd</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>hwwrite(vortex->mmio, addr(0x191DF+5, this04, this08), (ritd&lt;&lt;0x10)|litd);</p></td><td class="code"><div class="highlight"><pre><span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_SetItdCurrent</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">short</span> <span class="n">litd</span><span class="p">,</span> <span class="kt">short</span> <span class="n">ritd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">litd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">litd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">litd</span> <span class="o">&gt;</span> <span class="mh">0x57FF</span><span class="p">)</span>
		<span class="n">litd</span> <span class="o">=</span> <span class="mh">0x57FF</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ritd</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">ritd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ritd</span> <span class="o">&gt;</span> <span class="mh">0x57FF</span><span class="p">)</span>
		<span class="n">ritd</span> <span class="o">=</span> <span class="mh">0x57FF</span><span class="p">;</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_B_ITDCurrent</span><span class="p">),</span>
		<span class="p">(</span><span class="n">ritd</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">litd</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>hwwrite(vortex->mmio, addr(0x191DF+1, this04, this08), (ritd&lt;&lt;0x10)|litd);</p></td><td class="code"><div class="highlight"><pre><span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_SetItdDline</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">a3d_ItdDline_t</span> <span class="k">const</span> <span class="n">dline</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="cm">/* 45 != 40 -&gt; Check this ! */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">DLINE_SZ</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
			<span class="n">a3d_addrA</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span>
				  <span class="n">A3D_A_ITDDelayLine</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dline</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void a3dsrc_GetItdTarget(a3dsrc_t * a, short *litd, short *ritd)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	*ritd =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrA(a-&gt;slice, a-&gt;source, A3D_A_ITDTarget));</span>
<span class="c">	*litd =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrB(a-&gt;slice, a-&gt;source, A3D_B_ITDTarget));</span>
<span class="c">}</span>

<span class="c">static void a3dsrc_GetItdCurrent(a3dsrc_t * a, short *litd, short *ritd)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>

<span class="c">	*ritd =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrA(a-&gt;slice, a-&gt;source, A3D_A_ITDCurrent));</span>
<span class="c">	*litd =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrB(a-&gt;slice, a-&gt;source, A3D_B_ITDCurrent));</span>
<span class="c">}</span>

<span class="c">static void a3dsrc_GetItdDline(a3dsrc_t * a, a3d_ItdDline_t dline)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	int i;</span>

<span class="c">	for (i = 0; i &lt; DLINE_SZ; i++)</span>
<span class="c">		dline[i] =</span>
<span class="c">		    hwread(vortex-&gt;mmio,</span>
<span class="c">			   a3d_addrA(a-&gt;slice, a-&gt;source,</span>
<span class="c">				     A3D_A_ITDDelayLine + (i &lt;&lt; 2)));</span>
<span class="c">}</span>

<span class="cp">#endif</span>
<span class="cm">/* This is may be used for ILD Interaural Level Difference. */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_SetGainTarget</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">short</span> <span class="n">left</span><span class="p">,</span> <span class="kt">short</span> <span class="n">right</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_B_GainTarget</span><span class="p">),</span>
		<span class="p">(</span><span class="n">right</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">left</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_SetGainCurrent</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">short</span> <span class="n">left</span><span class="p">,</span> <span class="kt">short</span> <span class="n">right</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
		<span class="n">a3d_addrB</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">,</span> <span class="n">A3D_B_GainCurrent</span><span class="p">),</span>
		<span class="p">(</span><span class="n">right</span> <span class="o">&lt;&lt;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">|</span> <span class="n">left</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void a3dsrc_GetGainTarget(a3dsrc_t * a, short *left, short *right)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	*right =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrA(a-&gt;slice, a-&gt;source, A3D_A_GainTarget));</span>
<span class="c">	*left =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrB(a-&gt;slice, a-&gt;source, A3D_B_GainTarget));</span>
<span class="c">}</span>

<span class="c">static void a3dsrc_GetGainCurrent(a3dsrc_t * a, short *left, short *right)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	*right =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrA(a-&gt;slice, a-&gt;source, A3D_A_GainCurrent));</span>
<span class="c">	*left =</span>
<span class="c">	    hwread(vortex-&gt;mmio,</span>
<span class="c">		   a3d_addrB(a-&gt;slice, a-&gt;source, A3D_B_GainCurrent));</span>
<span class="c">}</span>

<span class="c">/* CA3dIO this func seems to be inlined all over this place. */</span>
<span class="c">static void CA3dIO_WriteReg(a3dsrc_t * a, unsigned long addr, short aa, short b)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	hwwrite(vortex-&gt;mmio, addr, (aa &lt;&lt; 0x10) | b);</span>
<span class="c">}</span>

<span class="cp">#endif</span>
<span class="cm">/* Generic A3D stuff */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_SetA3DSampleRate</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">esp0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">esp0</span> <span class="o">=</span> <span class="p">(((</span><span class="n">esp0</span> <span class="o">&amp;</span> <span class="mh">0x7fffffff</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0xB8000000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">sr</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">A3D_SLICE_Control</span> <span class="o">+</span> <span class="p">((</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mh">0xd</span><span class="p">),</span> <span class="n">esp0</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>hwwrite(vortex->mmio, 0x19C38 + (this08&lt;&lt;0xd), esp0);</p></td><td class="code"><div class="highlight"><pre><span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_EnableA3D</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">A3D_SLICE_Control</span> <span class="o">+</span> <span class="p">((</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mh">0xd</span><span class="p">),</span>
		<span class="mh">0xF0000001</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>hwwrite(vortex->mmio, 0x19C38 + (this08&lt;&lt;0xd), 0xF0000001);</p></td><td class="code"><div class="highlight"><pre><span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_DisableA3D</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">A3D_SLICE_Control</span> <span class="o">+</span> <span class="p">((</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mh">0xd</span><span class="p">),</span>
		<span class="mh">0xF0000000</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_SetA3DControlReg</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">A3D_SLICE_Control</span> <span class="o">+</span> <span class="p">((</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mh">0xd</span><span class="p">),</span> <span class="n">ctrl</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_SetA3DPointerReg</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ptr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">A3D_SLICE_Pointers</span> <span class="o">+</span> <span class="p">((</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mh">0xd</span><span class="p">),</span> <span class="n">ptr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void a3dsrc_GetA3DSampleRate(a3dsrc_t * a, int *sr)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	*sr = ((hwread(vortex-&gt;mmio, A3D_SLICE_Control + (a-&gt;slice &lt;&lt; 0xd))</span>
<span class="c">		&gt;&gt; 3) &amp; 0x1f);</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>*sr = ((hwread(vortex->mmio, 0x19C38 + (this08&lt;&lt;0xd))>>3)&amp;0x1f);</p></td><td class="code"><div class="highlight"><pre><span class="c">}</span>

<span class="c">static void a3dsrc_GetA3DControlReg(a3dsrc_t * a, unsigned long *ctrl)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	*ctrl = hwread(vortex-&gt;mmio, A3D_SLICE_Control + ((a-&gt;slice) &lt;&lt; 0xd));</span>
<span class="c">}</span>

<span class="c">static void a3dsrc_GetA3DPointerReg(a3dsrc_t * a, unsigned long *ptr)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span>
<span class="c">	*ptr = hwread(vortex-&gt;mmio, A3D_SLICE_Pointers + ((a-&gt;slice) &lt;&lt; 0xd));</span>
<span class="c">}</span>

<span class="cp">#endif</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_ZeroSliceIO</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
			<span class="n">A3D_SLICE_VDBDest</span> <span class="o">+</span>
			<span class="p">((((</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mh">0xb</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span>
			<span class="n">A3D_SLICE_VDBSource</span> <span class="o">+</span>
			<span class="p">((((</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mh">0xb</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Reset Single A3D source. */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_ZeroState</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	printk(KERN_DEBUG &quot;vortex: ZeroState slice: %d, source %d\n&quot;,</span>
<span class="cm">	       a-&gt;slice, a-&gt;source);</span>
<span class="cm">	*/</span>
	<span class="n">a3dsrc_SetAtmosState</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetHrtfState</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">A3dHrirZeros</span><span class="p">,</span> <span class="n">A3dHrirZeros</span><span class="p">);</span>
	<span class="n">a3dsrc_SetItdDline</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">A3dItdDlineZeros</span><span class="p">);</span>
	<span class="n">a3dsrc_SetHrtfOutput</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetTimeConsts</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">a3dsrc_SetAtmosCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetAtmosTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetItdCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetItdTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetGainCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetGainTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">a3dsrc_SetHrtfCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">A3dHrirZeros</span><span class="p">,</span> <span class="n">A3dHrirZeros</span><span class="p">);</span>
	<span class="n">a3dsrc_SetHrtfTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">A3dHrirZeros</span><span class="p">,</span> <span class="n">A3dHrirZeros</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Reset entire A3D engine */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_ZeroStateA3D</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">var</span><span class="p">,</span> <span class="n">var2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;vortex: ZeroStateA3D: ERROR: a-&gt;vortex is NULL</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">a3dsrc_SetA3DControlReg</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetA3DPointerReg</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">var</span> <span class="o">=</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span><span class="p">;</span>
	<span class="n">var2</span> <span class="o">=</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
		<span class="n">a3dsrc_ZeroSliceIO</span><span class="p">(</span><span class="n">a</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>a3dsrc_ZeroState(a);</p></td><td class="code"><div class="highlight"><pre>	<span class="p">}</span>
	<span class="n">a</span><span class="o">-&gt;</span><span class="n">source</span> <span class="o">=</span> <span class="n">var2</span><span class="p">;</span>
	<span class="n">a</span><span class="o">-&gt;</span><span class="n">slice</span> <span class="o">=</span> <span class="n">var</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Program A3D block as pass through */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">a3dsrc_ProgramPipe</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">a3dsrc_SetTimeConsts</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetAtmosCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetAtmosTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetItdCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetItdTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">a3dsrc_SetGainCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mh">0x7fff</span><span class="p">,</span> <span class="mh">0x7fff</span><span class="p">);</span>
	<span class="n">a3dsrc_SetGainTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mh">0x7fff</span><span class="p">,</span> <span class="mh">0x7fff</span><span class="p">);</span>

	<span class="cm">/* SET HRTF HERE */</span>

	<span class="cm">/* Single spike leads to identity transfer function. */</span>
	<span class="n">a3dsrc_SetHrtfCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">A3dHrirImpulse</span><span class="p">,</span> <span class="n">A3dHrirImpulse</span><span class="p">);</span>
	<span class="n">a3dsrc_SetHrtfTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">A3dHrirImpulse</span><span class="p">,</span> <span class="n">A3dHrirImpulse</span><span class="p">);</span>

	<span class="cm">/* Test: Sounds saturated. */</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>a3dsrc<em>SetHrtfCurrent(a, A3dHrirSatTest, A3dHrirSatTest);
a3dsrc</em>SetHrtfTarget(a, A3dHrirSatTest, A3dHrirSatTest);      </p></td><td class="code"><div class="highlight"><pre><span class="p">}</span>

<span class="cm">/* VDB = Vortex audio Dataflow Bus */</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void a3dsrc_ClearVDBData(a3dsrc_t * a, unsigned long aa)</span>
<span class="c">{</span>
<span class="c">	vortex_t *vortex = (vortex_t *) (a-&gt;vortex);</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>((aa >> 2) &lt;&lt; 8) - (aa >> 2)</p></td><td class="code"><div class="highlight"><pre><span class="c">	hwwrite(vortex-&gt;mmio,</span>
<span class="c">		a3d_addrS(a-&gt;slice, A3D_SLICE_VDBDest) + (a-&gt;source &lt;&lt; 2), 0);</span>
<span class="c">	hwwrite(vortex-&gt;mmio,</span>
<span class="c">		a3d_addrS(a-&gt;slice,</span>
<span class="c">			  A3D_SLICE_VDBDest + 4) + (a-&gt;source &lt;&lt; 2), 0);</span>
<span class="c">	/*</span>
<span class="c">	   hwwrite(vortex-&gt;mmio, 0x19c00 + (((aa&gt;&gt;2)*255*4)+aa)*8, 0);</span>
<span class="c">	   hwwrite(vortex-&gt;mmio, 0x19c04 + (((aa&gt;&gt;2)*255*4)+aa)*8, 0);</span>
<span class="c">	 */</span>
<span class="c">}</span>
<span class="cp">#endif</span>

<span class="cm">/* A3D HwSource stuff. */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_A3dSourceHw_Initialize</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">source</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">a3dsrc_t</span> <span class="o">*</span><span class="n">a3dsrc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">a3d</span><span class="p">[</span><span class="n">source</span> <span class="o">+</span> <span class="p">(</span><span class="n">slice</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)]);</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>a3dsrc_t <em>a3dsrc = &amp;(v->a3d[source + (slice</em>4)]);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">a3dsrc</span><span class="o">-&gt;</span><span class="n">vortex</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">v</span><span class="p">;</span>
	<span class="n">a3dsrc</span><span class="o">-&gt;</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span><span class="p">;</span>	<span class="cm">/* source */</span>
	<span class="n">a3dsrc</span><span class="o">-&gt;</span><span class="n">slice</span> <span class="o">=</span> <span class="n">slice</span><span class="p">;</span>	<span class="cm">/* slice */</span>
	<span class="n">a3dsrc_ZeroState</span><span class="p">(</span><span class="n">a3dsrc</span><span class="p">);</span>
	<span class="cm">/* Added by me. */</span>
	<span class="n">a3dsrc_SetA3DSampleRate</span><span class="p">(</span><span class="n">a3dsrc</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">Vort3DRend_Initialize</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">v</span><span class="o">-&gt;</span><span class="n">xt_mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">;</span>	<span class="cm">/* this_14 */</span>

	<span class="n">vortex_XtalkHw_init</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
	<span class="n">vortex_XtalkHw_SetGainsAllChan</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">xt_mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">XT_SPEAKER0</span>:
		<span class="n">vortex_XtalkHw_ProgramXtalkNarrow</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">XT_SPEAKER1</span>:
		<span class="n">vortex_XtalkHw_ProgramXtalkWide</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
	<span class="k">case</span> <span class="n">XT_HEADPHONE</span>:
		<span class="n">vortex_XtalkHw_ProgramPipe</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">XT_DIAMOND</span>:
		<span class="n">vortex_XtalkHw_ProgramDiamondXtalk</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">vortex_XtalkHw_SetSampleRate</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>
	<span class="n">vortex_XtalkHw_Enable</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* 3D Sound entry points. */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">vortex_a3d_register_controls</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">vortex_a3d_unregister_controls</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">);</span>
<span class="cm">/* A3D base support init/shudown */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__devinit</span> <span class="nf">vortex_Vort3D_enable</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">Vort3DRend_Initialize</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">XT_HEADPHONE</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NR_A3D</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">vortex_A3dSourceHw_Initialize</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">a3dsrc_ZeroStateA3D</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">a3d</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
	<span class="p">}</span>
	<span class="cm">/* Register ALSA controls */</span>
	<span class="n">vortex_a3d_register_controls</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Vort3D_disable</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_XtalkHw_Disable</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
	<span class="n">vortex_a3d_unregister_controls</span><span class="p">(</span><span class="n">v</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Make A3D subsystem connections. */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Vort3D_connect</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">v</span><span class="p">,</span> <span class="kt">int</span> <span class="n">en</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	</pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>Disable AU8810 routes, since they seem to be wrong (in au8810.h).</p></td><td class="code"><div class="highlight"><pre><span class="cp">#ifdef CHIP_AU8810</span>
	<span class="k">return</span><span class="p">;</span>
<span class="cp">#endif</span>
	
<span class="cp">#if 1</span>
	<span class="cm">/* Alloc Xtalk mixin resources */</span>
	<span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
	    <span class="n">vortex_adb_checkinout</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">fixed_res</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="n">VORTEX_RESOURCE_MIXIN</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span>
		    <span class="p">(</span><span class="s">&quot;vortex: vortex_Vort3D: ERROR: not enough free mixer resources.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
	    <span class="n">vortex_adb_checkinout</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">fixed_res</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="n">VORTEX_RESOURCE_MIXIN</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span>
		    <span class="p">(</span><span class="s">&quot;vortex: vortex_Vort3D: ERROR: not enough free mixer resources.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">#endif</span>

	<span class="cm">/* Connect A3D -&gt; XTALK */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>2 outputs per each A3D slice. </p></td><td class="code"><div class="highlight"><pre>		<span class="n">vortex_route</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">ADB_A3DOUT</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span> <span class="n">ADB_XTALKIN</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
		<span class="n">vortex_route</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">ADB_A3DOUT</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ADB_XTALKIN</span><span class="p">(</span><span class="mi">5</span> <span class="o">+</span> <span class="n">i</span><span class="p">));</span>
	<span class="p">}</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	vortex_route(v, en, 0x11, ADB_XTALKOUT(0), ADB_EQIN(2));</span>
<span class="c">	vortex_route(v, en, 0x11, ADB_XTALKOUT(1), ADB_EQIN(3));</span>
<span class="cp">#else</span>
	<span class="cm">/* Connect XTalk -&gt; mixer */</span>
	<span class="n">vortex_route</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">ADB_XTALKOUT</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">ADB_MIXIN</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
	<span class="n">vortex_route</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">ADB_XTALKOUT</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">ADB_MIXIN</span><span class="p">(</span><span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
	<span class="n">vortex_connection_mixin_mix</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixplayb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">vortex_connection_mixin_mix</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixplayb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">vortex_mix_setinputvolumebyte</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixplayb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
				      <span class="n">en</span> <span class="o">?</span> <span class="n">MIX_DEFIGAIN</span> <span class="o">:</span> <span class="n">VOL_MIN</span><span class="p">);</span>
	<span class="n">vortex_mix_setinputvolumebyte</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixplayb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
				      <span class="n">en</span> <span class="o">?</span> <span class="n">MIX_DEFIGAIN</span> <span class="o">:</span> <span class="n">VOL_MIN</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">VORTEX_IS_QUAD</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">vortex_connection_mixin_mix</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
					    <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixplayb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">vortex_connection_mixin_mix</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
					    <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixplayb</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">vortex_mix_setinputvolumebyte</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixplayb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
					      <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
					      <span class="n">en</span> <span class="o">?</span> <span class="n">MIX_DEFIGAIN</span> <span class="o">:</span> <span class="n">VOL_MIN</span><span class="p">);</span>
		<span class="n">vortex_mix_setinputvolumebyte</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixplayb</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
					      <span class="n">v</span><span class="o">-&gt;</span><span class="n">mixxtlk</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
					      <span class="n">en</span> <span class="o">?</span> <span class="n">MIX_DEFIGAIN</span> <span class="o">:</span> <span class="n">VOL_MIN</span><span class="p">);</span>
	<span class="p">}</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cm">/* Initialize one single A3D source. */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Vort3D_InitializeSource</span><span class="p">(</span><span class="n">a3dsrc_t</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">en</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">vortex</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span>
		    <span class="p">(</span><span class="s">&quot;vortex: Vort3D_InitializeSource: A3D source not initialized</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">en</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">a3dsrc_ProgramPipe</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
		<span class="n">a3dsrc_SetA3DSampleRate</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>
		<span class="n">a3dsrc_SetTimeConsts</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">HrtfTCDefault</span><span class="p">,</span>
				     <span class="n">ItdTCDefault</span><span class="p">,</span> <span class="n">GainTCDefault</span><span class="p">,</span>
				     <span class="n">CoefTCDefault</span><span class="p">);</span>
		<span class="cm">/* Remark: zero gain is muted. */</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>a3dsrc<em>SetGainTarget(a,0,0);
a3dsrc</em>SetGainCurrent(a,0,0);</p></td><td class="code"><div class="highlight"><pre>		<span class="n">a3dsrc_EnableA3D</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">a3dsrc_DisableA3D</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
		<span class="n">a3dsrc_ZeroState</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Conversion of coordinates into 3D parameters. */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_a3d_coord2hrtf</span><span class="p">(</span><span class="n">a3d_Hrtf_t</span> <span class="n">hrtf</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">coord</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* FIXME: implement this. */</span>

<span class="p">}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_a3d_coord2itd</span><span class="p">(</span><span class="n">a3d_Itd_t</span> <span class="n">itd</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">coord</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* FIXME: implement this. */</span>

<span class="p">}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_a3d_coord2ild</span><span class="p">(</span><span class="n">a3d_LRGains_t</span> <span class="n">ild</span><span class="p">,</span> <span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">right</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* FIXME: implement this. */</span>

<span class="p">}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_a3d_translate_filter</span><span class="p">(</span><span class="n">a3d_atmos_t</span> <span class="n">filter</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* FIXME: implement this. */</span>

<span class="p">}</span>

<span class="cm">/* ALSA control interface.  */</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_a3d_hrtf_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_a3d_itd_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_a3d_ild_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_a3d_filter_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_a3d_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>a3dsrc<em>t *a = kcontrol->private</em>data;</p></td><td class="code"><div class="highlight"><pre>	<span class="cm">/* No read yet. Would this be really useable/needed ? */</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_a3d_hrtf_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">a3dsrc_t</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">coord</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">coord</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="cm">/* Translate orientation coordinates to a3d params. */</span>
	<span class="n">vortex_a3d_coord2hrtf</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">hrtf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">);</span>
	<span class="n">vortex_a3d_coord2hrtf</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">hrtf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">);</span>
	<span class="n">a3dsrc_SetHrtfTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">hrtf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">hrtf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">a3dsrc_SetHrtfCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">hrtf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">hrtf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_a3d_itd_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">a3dsrc_t</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">coord</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">coord</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="cm">/* Translate orientation coordinates to a3d params. */</span>
	<span class="n">vortex_a3d_coord2itd</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">hrtf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">);</span>
	<span class="n">vortex_a3d_coord2itd</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">hrtf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">);</span>
	<span class="cm">/* Inter aural time difference. */</span>
	<span class="n">a3dsrc_SetItdTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">itd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">itd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">a3dsrc_SetItdCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">itd</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">itd</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">a3dsrc_SetItdDline</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">dline</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_a3d_ild_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">a3dsrc_t</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span>
	<span class="cm">/* There may be some scale tranlation needed here. */</span>
	<span class="n">l</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">vortex_a3d_coord2ild</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">ild</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
	<span class="cm">/* Left Right panning. */</span>
	<span class="n">a3dsrc_SetGainTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
	<span class="n">a3dsrc_SetGainCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_a3d_filter_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">a3dsrc_t</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">params</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="cm">/* Translate generic filter params to a3d filter params. */</span>
	<span class="n">vortex_a3d_translate_filter</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">,</span> <span class="n">params</span><span class="p">);</span>
	<span class="cm">/* Atmospheric absorption and filtering. */</span>
	<span class="n">a3dsrc_SetAtmosTarget</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			      <span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			      <span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="n">a3dsrc_SetAtmosCurrent</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			       <span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			       <span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">a</span><span class="o">-&gt;</span><span class="n">filter</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">vortex_a3d_kcontrol</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_PCM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Playback PCM advanced processing&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_hrtf_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_hrtf_put</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Control (un)registration. */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">vortex_a3d_register_controls</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="cm">/* HRTF controls. */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NR_A3D</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">kcontrol</span> <span class="o">=</span>
		     <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vortex_a3d_kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">a3d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">numid</span> <span class="o">=</span> <span class="n">CTRLID_HRTF</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_hrtf_info</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">put</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_hrtf_put</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">kcontrol</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* ITD controls. */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NR_A3D</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">kcontrol</span> <span class="o">=</span>
		     <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vortex_a3d_kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">a3d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">numid</span> <span class="o">=</span> <span class="n">CTRLID_ITD</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_itd_info</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">put</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_itd_put</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">kcontrol</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* ILD (gains) controls. */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NR_A3D</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">kcontrol</span> <span class="o">=</span>
		     <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vortex_a3d_kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">a3d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">numid</span> <span class="o">=</span> <span class="n">CTRLID_GAINS</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_ild_info</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">put</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_ild_put</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">kcontrol</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* Filter controls. */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NR_A3D</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">kcontrol</span> <span class="o">=</span>
		     <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vortex_a3d_kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">a3d</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">numid</span> <span class="o">=</span> <span class="n">CTRLID_FILTER</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_filter_info</span><span class="p">;</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">put</span> <span class="o">=</span> <span class="n">snd_vortex_a3d_filter_put</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">kcontrol</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_a3d_unregister_controls</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>

<span class="p">}</span>

<span class="cm">/* End of File*/</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
