<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › pci › au88x0 › au88x0_eq.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>au88x0_eq.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/***************************************************************************</span>
<span class="cm"> *            au88x0_eq.c</span>
<span class="cm"> *  Aureal Vortex Hardware EQ control/access.</span>
<span class="cm"> *</span>
<span class="cm"> *  Sun Jun  8 18:19:19 2003</span>
<span class="cm"> *  2003  Manuel Jander (mjander@users.sourceforge.net)</span>
<span class="cm"> *  </span>
<span class="cm"> *  02 July 2003: First time something works :)</span>
<span class="cm"> *  November 2003: A3D Bypass code completed but untested.</span>
<span class="cm"> *</span>
<span class="cm"> *  TODO:</span>
<span class="cm"> *     - Debug (testing)</span>
<span class="cm"> *     - Test peak visualization support.</span>
<span class="cm"> *</span>
<span class="cm"> ****************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *  (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU Library General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> The Aureal Hardware EQ is found on AU8810 and AU8830 chips only.</span>
<span class="cm"> it has 4 inputs (2 for general mix, 2 for A3D) and 2 outputs (supposed </span>
<span class="cm"> to be routed to the codec).</span>
<span class="cm">*/</span>

<span class="cp">#include &quot;au88x0.h&quot;</span>
<span class="cp">#include &quot;au88x0_eq.h&quot;</span>
<span class="cp">#include &quot;au88x0_eqdata.c&quot;</span>

<span class="cp">#define VORTEX_EQ_BASE	 0x2b000</span>
<span class="cp">#define VORTEX_EQ_DEST   (VORTEX_EQ_BASE + 0x410)</span>
<span class="cp">#define VORTEX_EQ_SOURCE (VORTEX_EQ_BASE + 0x430)</span>
<span class="cp">#define VORTEX_EQ_CTRL   (VORTEX_EQ_BASE + 0x440)</span>

<span class="cp">#define VORTEX_BAND_COEFF_SIZE 0x30</span>

<span class="cm">/* CEqHw.s */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetTimeConsts</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">gain</span><span class="p">,</span> <span class="n">u16</span> <span class="n">level</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3c4</span><span class="p">,</span> <span class="n">gain</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3c8</span><span class="p">,</span> <span class="n">level</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">sign_invert</span><span class="p">(</span><span class="n">u16</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* -(-32768) -&gt; -32768 so we do -(-32768) -&gt; 32767 to make the result positive */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span><span class="o">-</span><span class="mi">32768</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">32767</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">a</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetLeftCoefs</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">coefs</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="cm">/*esp2c */</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b000</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">0</span><span class="p">]);</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b004</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this08</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b008</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]);</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b00c</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]);</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b010</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b008</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">sign_invert</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]));</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b00c</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">sign_invert</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">]));</span>
		        <span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b010</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">sign_invert</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">]));</span>
		<span class="p">}</span>
		<span class="n">i</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetRightCoefs</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">coefs</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="cm">/*esp2c */</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1e0</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="mi">0</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1e4</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this08</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1e8</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1ec</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1f0</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">coefs</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1e8</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">sign_invert</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]));</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1ec</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">sign_invert</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">]));</span>
			<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1f0</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">sign_invert</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="mi">4</span> <span class="o">+</span> <span class="n">i</span><span class="p">]));</span>
		<span class="p">}</span>
		<span class="n">i</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="p">}</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetLeftStates</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">a</span><span class="p">[],</span> <span class="n">u16</span> <span class="n">b</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ebx</span><span class="p">;</span>

	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3fc</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b400</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">ebx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ebx</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">ebx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b014</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0xc</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b018</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0xc</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b01c</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0xc</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b020</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0xc</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
		<span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetRightStates</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">a</span><span class="p">[],</span> <span class="n">u16</span> <span class="n">b</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ebx</span><span class="p">;</span>

	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b404</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b408</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">ebx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ebx</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">ebx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1f4</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0xc</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1f8</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0xc</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b1fc</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0xc</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b200</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mh">0xc</span><span class="p">),</span> <span class="n">b</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="n">i</span><span class="p">]);</span>
		<span class="n">i</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void vortex_EqHw_GetTimeConsts(vortex_t * vortex, u16 * a, u16 * b)</span>
<span class="c">{</span>
<span class="c">	*a = hwread(vortex-&gt;mmio, 0x2b3c4);</span>
<span class="c">	*b = hwread(vortex-&gt;mmio, 0x2b3c8);</span>
<span class="c">}</span>

<span class="c">static void vortex_EqHw_GetLeftCoefs(vortex_t * vortex, u16 a[])</span>
<span class="c">{</span>

<span class="c">}</span>

<span class="c">static void vortex_EqHw_GetRightCoefs(vortex_t * vortex, u16 a[])</span>
<span class="c">{</span>

<span class="c">}</span>

<span class="c">static void vortex_EqHw_GetLeftStates(vortex_t * vortex, u16 * a, u16 b[])</span>
<span class="c">{</span>

<span class="c">}</span>

<span class="c">static void vortex_EqHw_GetRightStates(vortex_t * vortex, u16 * a, u16 b[])</span>
<span class="c">{</span>

<span class="c">}</span>

<span class="cp">#endif</span>
<span class="cm">/* Mix Gains */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetBypassGain</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">a</span><span class="p">,</span> <span class="n">u16</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this08</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3d4</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3ec</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3d4</span><span class="p">,</span> <span class="n">sign_invert</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3ec</span><span class="p">,</span> <span class="n">sign_invert</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetA3DBypassGain</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">a</span><span class="p">,</span> <span class="n">u16</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3e0</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3f8</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void vortex_EqHw_SetCurrBypassGain(vortex_t * vortex, u16 a, u16 b)</span>
<span class="c">{</span>

<span class="c">	hwwrite(vortex-&gt;mmio, 0x2b3d0, a);</span>
<span class="c">	hwwrite(vortex-&gt;mmio, 0x2b3e8, b);</span>
<span class="c">}</span>

<span class="c">static void vortex_EqHw_SetCurrA3DBypassGain(vortex_t * vortex, u16 a, u16 b)</span>
<span class="c">{</span>

<span class="c">	hwwrite(vortex-&gt;mmio, 0x2b3dc, a);</span>
<span class="c">	hwwrite(vortex-&gt;mmio, 0x2b3f4, b);</span>
<span class="c">}</span>

<span class="cp">#endif</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">vortex_EqHw_SetLeftGainsSingleTarget</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">,</span> <span class="n">u16</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b02c</span> <span class="o">+</span> <span class="p">(</span><span class="n">index</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">),</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">vortex_EqHw_SetRightGainsSingleTarget</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">,</span> <span class="n">u16</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b20c</span> <span class="o">+</span> <span class="p">(</span><span class="n">index</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">),</span> <span class="n">b</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetLeftGainsTarget</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">a</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ebx</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">ebx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ebx</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">ebx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b02c</span> <span class="o">+</span> <span class="n">ebx</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">ebx</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetRightGainsTarget</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">a</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ebx</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">ebx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ebx</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">ebx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b20c</span> <span class="o">+</span> <span class="n">ebx</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">ebx</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetLeftGainsCurrent</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">a</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ebx</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">ebx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ebx</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">ebx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b028</span> <span class="o">+</span> <span class="n">ebx</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">ebx</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetRightGainsCurrent</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">a</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ebx</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">ebx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ebx</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">ebx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b208</span> <span class="o">+</span> <span class="n">ebx</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">ebx</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void vortex_EqHw_GetLeftGainsTarget(vortex_t * vortex, u16 a[])</span>
<span class="c">{</span>
<span class="c">	eqhw_t *eqhw = &amp;(vortex-&gt;eq.this04);</span>
<span class="c">	int ebx = 0;</span>

<span class="c">	if (eqhw-&gt;this04 &lt; 0)</span>
<span class="c">		return;</span>

<span class="c">	do {</span>
<span class="c">		a[ebx] = hwread(vortex-&gt;mmio, 0x2b02c + ebx * 0x30);</span>
<span class="c">		ebx++;</span>
<span class="c">	}</span>
<span class="c">	while (ebx &lt; eqhw-&gt;this04);</span>
<span class="c">}</span>

<span class="c">static void vortex_EqHw_GetRightGainsTarget(vortex_t * vortex, u16 a[])</span>
<span class="c">{</span>
<span class="c">	eqhw_t *eqhw = &amp;(vortex-&gt;eq.this04);</span>
<span class="c">	int ebx = 0;</span>

<span class="c">	if (eqhw-&gt;this04 &lt; 0)</span>
<span class="c">		return;</span>

<span class="c">	do {</span>
<span class="c">		a[ebx] = hwread(vortex-&gt;mmio, 0x2b20c + ebx * 0x30);</span>
<span class="c">		ebx++;</span>
<span class="c">	}</span>
<span class="c">	while (ebx &lt; eqhw-&gt;this04);</span>
<span class="c">}</span>

<span class="c">static void vortex_EqHw_GetLeftGainsCurrent(vortex_t * vortex, u16 a[])</span>
<span class="c">{</span>
<span class="c">	eqhw_t *eqhw = &amp;(vortex-&gt;eq.this04);</span>
<span class="c">	int ebx = 0;</span>

<span class="c">	if (eqhw-&gt;this04 &lt; 0)</span>
<span class="c">		return;</span>

<span class="c">	do {</span>
<span class="c">		a[ebx] = hwread(vortex-&gt;mmio, 0x2b028 + ebx * 0x30);</span>
<span class="c">		ebx++;</span>
<span class="c">	}</span>
<span class="c">	while (ebx &lt; eqhw-&gt;this04);</span>
<span class="c">}</span>

<span class="c">static void vortex_EqHw_GetRightGainsCurrent(vortex_t * vortex, u16 a[])</span>
<span class="c">{</span>
<span class="c">	eqhw_t *eqhw = &amp;(vortex-&gt;eq.this04);</span>
<span class="c">	int ebx = 0;</span>

<span class="c">	if (eqhw-&gt;this04 &lt; 0)</span>
<span class="c">		return;</span>

<span class="c">	do {</span>
<span class="c">		a[ebx] = hwread(vortex-&gt;mmio, 0x2b208 + ebx * 0x30);</span>
<span class="c">		ebx++;</span>
<span class="c">	}</span>
<span class="c">	while (ebx &lt; eqhw-&gt;this04);</span>
<span class="c">}</span>

<span class="cp">#endif</span>
<span class="cm">/* EQ band levels settings */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetLevels</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">peaks</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/* set left peaks */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b024</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">VORTEX_BAND_COEFF_SIZE</span><span class="p">,</span> <span class="n">peaks</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3cc</span><span class="p">,</span> <span class="n">peaks</span><span class="p">[</span><span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">]);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3d8</span><span class="p">,</span> <span class="n">peaks</span><span class="p">[</span><span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]);</span>

	<span class="cm">/* set right peaks */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b204</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">VORTEX_BAND_COEFF_SIZE</span><span class="p">,</span>
			<span class="n">peaks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="p">(</span><span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]);</span>
	<span class="p">}</span>

	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3e4</span><span class="p">,</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)]);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3f0</span><span class="p">,</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">3</span> <span class="o">+</span> <span class="p">(</span><span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)]);</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void vortex_EqHw_GetLevels(vortex_t * vortex, u16 a[])</span>
<span class="c">{</span>
<span class="c">	eqhw_t *eqhw = &amp;(vortex-&gt;eq.this04);</span>
<span class="c">	int ebx;</span>

<span class="c">	if (eqhw-&gt;this04 &lt; 0)</span>
<span class="c">		return;</span>

<span class="c">	ebx = 0;</span>
<span class="c">	do {</span>
<span class="c">		a[ebx] = hwread(vortex-&gt;mmio, 0x2b024 + ebx * 0x30);</span>
<span class="c">		ebx++;</span>
<span class="c">	}</span>
<span class="c">	while (ebx &lt; eqhw-&gt;this04);</span>

<span class="c">	a[eqhw-&gt;this04] = hwread(vortex-&gt;mmio, 0x2b3cc);</span>
<span class="c">	a[eqhw-&gt;this04 + 1] = hwread(vortex-&gt;mmio, 0x2b3d8);</span>

<span class="c">	ebx = 0;</span>
<span class="c">	do {</span>
<span class="c">		a[ebx + (eqhw-&gt;this04 + 2)] =</span>
<span class="c">		    hwread(vortex-&gt;mmio, 0x2b204 + ebx * 0x30);</span>
<span class="c">		ebx++;</span>
<span class="c">	}</span>
<span class="c">	while (ebx &lt; eqhw-&gt;this04);</span>

<span class="c">	a[2 + (eqhw-&gt;this04 * 2)] = hwread(vortex-&gt;mmio, 0x2b3e4);</span>
<span class="c">	a[3 + (eqhw-&gt;this04 * 2)] = hwread(vortex-&gt;mmio, 0x2b3f0);</span>
<span class="c">}</span>

<span class="cp">#endif</span>
<span class="cm">/* Global Control */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetControlReg</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b440</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_SetSampleRate</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u32</span> <span class="n">sr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b440</span><span class="p">,</span> <span class="p">((</span><span class="n">sr</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0xb800</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static void vortex_EqHw_GetControlReg(vortex_t * vortex, u32 *reg)</span>
<span class="c">{</span>
<span class="c">	*reg = hwread(vortex-&gt;mmio, 0x2b440);</span>
<span class="c">}</span>

<span class="c">static void vortex_EqHw_GetSampleRate(vortex_t * vortex, u32 *sr)</span>
<span class="c">{</span>
<span class="c">	*sr = (hwread(vortex-&gt;mmio, 0x2b440) &gt;&gt; 3) &amp; 0x1f;</span>
<span class="c">}</span>

<span class="cp">#endif</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_Enable</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">VORTEX_EQ_CTRL</span><span class="p">,</span> <span class="mh">0xf001</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_Disable</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">VORTEX_EQ_CTRL</span><span class="p">,</span> <span class="mh">0xf000</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Reset (zero) buffers */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_ZeroIO</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">VORTEX_EQ_DEST</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">VORTEX_EQ_SOURCE</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mh">0x0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_ZeroA3DIO</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="n">VORTEX_EQ_DEST</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">),</span> <span class="mh">0x0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_ZeroState</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">vortex_EqHw_SetControlReg</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">vortex_EqHw_ZeroIO</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">hwwrite</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2b3c0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetTimeConsts</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetLeftCoefs</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">asEqCoefsZeros</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetRightCoefs</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">asEqCoefsZeros</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetLeftGainsCurrent</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_gains_zero</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetRightGainsCurrent</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_gains_zero</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetLeftGainsTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_gains_zero</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetRightGainsTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_gains_zero</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetBypassGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>vortex<em>EqHw</em>SetCurrBypassGain(vortex, 0, 0);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">vortex_EqHw_SetA3DBypassGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>vortex<em>EqHw</em>SetCurrA3DBypassGain(vortex, 0, 0);</p></td><td class="code"><div class="highlight"><pre>	<span class="n">vortex_EqHw_SetLeftStates</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_states_zero</span><span class="p">,</span> <span class="n">asEqOutStateZeros</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetRightStates</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_states_zero</span><span class="p">,</span> <span class="n">asEqOutStateZeros</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetLevels</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="p">)</span> <span class="n">eq_levels</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Program coeficients as pass through */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_ProgramPipe</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_EqHw_SetTimeConsts</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetLeftCoefs</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">asEqCoefsPipes</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetRightCoefs</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">asEqCoefsPipes</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetLeftGainsCurrent</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_gains_current</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetRightGainsCurrent</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_gains_current</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetLeftGainsTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_gains_current</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetRightGainsTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_gains_current</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Program EQ block as 10 band Equalizer */</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">vortex_EqHw_Program10Band</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">auxxEqCoeffSet_t</span> <span class="o">*</span> <span class="n">coefset</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">vortex_EqHw_SetTimeConsts</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">,</span> <span class="mh">0x7fe0</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetLeftCoefs</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">coefset</span><span class="o">-&gt;</span><span class="n">LeftCoefs</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetRightCoefs</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">coefset</span><span class="o">-&gt;</span><span class="n">RightCoefs</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetLeftGainsCurrent</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">coefset</span><span class="o">-&gt;</span><span class="n">LeftGains</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetRightGainsTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">coefset</span><span class="o">-&gt;</span><span class="n">RightGains</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetLeftGainsTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">coefset</span><span class="o">-&gt;</span><span class="n">LeftGains</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetRightGainsCurrent</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">coefset</span><span class="o">-&gt;</span><span class="n">RightGains</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Read all EQ peaks. (think VU meter) */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_EqHw_GetTenBandLevels</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">peaks</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="n">eqhw_t</span> <span class="o">*</span><span class="n">eqhw</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">.</span><span class="n">this04</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">peaks</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">hwread</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2B024</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">peaks</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">eqhw</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">]</span> <span class="o">=</span>
		    <span class="n">hwread</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">mmio</span><span class="p">,</span> <span class="mh">0x2B204</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mh">0x30</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* CEqlzr.s */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">vortex_Eqlzr_GetLeftGain</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span> <span class="n">gain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this28</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">gain</span> <span class="o">=</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this130</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Eqlzr_SetLeftGain</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">,</span> <span class="n">u16</span> <span class="n">gain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this28</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this130</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">gain</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this54</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">vortex_EqHw_SetLeftGainsSingleTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">gain</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">vortex_Eqlzr_GetRightGain</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span> <span class="n">gain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this28</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">gain</span> <span class="o">=</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this130</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this10</span><span class="p">];</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Eqlzr_SetRightGain</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">,</span> <span class="n">u16</span> <span class="n">gain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this28</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this130</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this10</span><span class="p">]</span> <span class="o">=</span> <span class="n">gain</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this54</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">vortex_EqHw_SetRightGainsSingleTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">gain</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static int</span>
<span class="c">vortex_Eqlzr_GetAllBands(vortex_t * vortex, u16 * gains, s32 *cnt)</span>
<span class="c">{</span>
<span class="c">	eqlzr_t *eq = &amp;(vortex-&gt;eq);</span>
<span class="c">	int si = 0;</span>

<span class="c">	if (eq-&gt;this10 == 0)</span>
<span class="c">		return 1;</span>

<span class="c">	{</span>
<span class="c">		if (vortex_Eqlzr_GetLeftGain(vortex, si, &amp;gains[si]))</span>
<span class="c">			return 1;</span>
<span class="c">		if (vortex_Eqlzr_GetRightGain</span>
<span class="c">		    (vortex, si, &amp;gains[si + eq-&gt;this10]))</span>
<span class="c">			return 1;</span>
<span class="c">		si++;</span>
<span class="c">	}</span>
<span class="c">	while (eq-&gt;this10 &gt; si) ;</span>
<span class="c">	*cnt = si * 2;</span>
<span class="c">	return 0;</span>
<span class="c">}</span>
<span class="cp">#endif</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">vortex_Eqlzr_SetAllBandsFromActiveCoeffSet</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>

	<span class="n">vortex_EqHw_SetLeftGainsTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this130</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetRightGainsTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this130</span><span class="p">[</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this10</span><span class="p">]));</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">vortex_Eqlzr_SetAllBands</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="n">gains</span><span class="p">[],</span> <span class="n">s32</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(((</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">!=</span> <span class="n">count</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this28</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this130</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gains</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="p">}</span>
	
	<span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this54</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">vortex_Eqlzr_SetAllBandsFromActiveCoeffSet</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">vortex_Eqlzr_SetA3dBypassGain</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u32</span> <span class="n">a</span><span class="p">,</span> <span class="n">u32</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">eax</span><span class="p">,</span> <span class="n">ebx</span><span class="p">;</span>

	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this58</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this5c</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this54</span><span class="p">)</span>
		<span class="n">eax</span> <span class="o">=</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this0e</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">eax</span> <span class="o">=</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this0a</span><span class="p">;</span>
	<span class="n">ebx</span> <span class="o">=</span> <span class="p">(</span><span class="n">eax</span> <span class="o">*</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this58</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">eax</span> <span class="o">=</span> <span class="p">(</span><span class="n">eax</span> <span class="o">*</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this5c</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">vortex_EqHw_SetA3DBypassGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">ebx</span><span class="p">,</span> <span class="n">eax</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Eqlzr_ProgramA3dBypassGain</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">eax</span><span class="p">,</span> <span class="n">ebx</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this54</span><span class="p">)</span>
		<span class="n">eax</span> <span class="o">=</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this0e</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">eax</span> <span class="o">=</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this0a</span><span class="p">;</span>
	<span class="n">ebx</span> <span class="o">=</span> <span class="p">(</span><span class="n">eax</span> <span class="o">*</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this58</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">eax</span> <span class="o">=</span> <span class="p">(</span><span class="n">eax</span> <span class="o">*</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this5c</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">vortex_EqHw_SetA3DBypassGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">ebx</span><span class="p">,</span> <span class="n">eax</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Eqlzr_ShutDownA3d</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vortex</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="n">vortex_EqHw_ZeroA3DIO</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Eqlzr_SetBypass</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u32</span> <span class="n">bp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>
	
	<span class="k">if</span> <span class="p">((</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this28</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">bp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* EQ enabled */</span>
		<span class="n">vortex_Eqlzr_SetAllBandsFromActiveCoeffSet</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
		<span class="n">vortex_EqHw_SetBypassGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this08</span><span class="p">,</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this08</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* EQ disabled. */</span>
		<span class="n">vortex_EqHw_SetLeftGainsTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this14_array</span><span class="p">);</span>
		<span class="n">vortex_EqHw_SetRightGainsTarget</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this14_array</span><span class="p">);</span>
		<span class="n">vortex_EqHw_SetBypassGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this0c</span><span class="p">,</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this0c</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">vortex_Eqlzr_ProgramA3dBypassGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Eqlzr_ReadAndSetActiveCoefSet</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>

	<span class="cm">/* Set EQ BiQuad filter coeficients */</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">coefset</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">asEqCoefsNormal</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">auxxEqCoeffSet_t</span><span class="p">));</span>
	<span class="cm">/* Set EQ Band gain levels and dump into hardware registers. */</span>
	<span class="n">vortex_Eqlzr_SetAllBands</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq_gains_normal</span><span class="p">,</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this10</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">vortex_Eqlzr_GetAllPeaks</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span> <span class="n">peaks</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="o">*</span><span class="n">count</span> <span class="o">=</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this10</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">vortex_EqHw_GetTenBandLevels</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">peaks</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static auxxEqCoeffSet_t *vortex_Eqlzr_GetActiveCoefSet(vortex_t * vortex)</span>
<span class="c">{</span>
<span class="c">	eqlzr_t *eq = &amp;(vortex-&gt;eq);</span>

<span class="c">	return (&amp;(eq-&gt;coefset));</span>
<span class="c">}</span>
<span class="cp">#endif</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Eqlzr_init</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span>

	<span class="cm">/* Object constructor */</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>eq->this04 = 0;</p></td><td class="code"><div class="highlight"><pre>	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this08</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>		<span class="cm">/* Bypass gain with EQ in use. */</span>
	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this0a</span> <span class="o">=</span> <span class="mh">0x5999</span><span class="p">;</span>
	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this0c</span> <span class="o">=</span> <span class="mh">0x5999</span><span class="p">;</span>	<span class="cm">/* Bypass gain with EQ disabled. */</span>
	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this0e</span> <span class="o">=</span> <span class="mh">0x5999</span><span class="p">;</span>

	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this10</span> <span class="o">=</span> <span class="mh">0xa</span><span class="p">;</span>	<span class="cm">/* 10 eq frequency bands. */</span>
	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this04</span><span class="p">.</span><span class="n">this04</span> <span class="o">=</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this10</span><span class="p">;</span>
	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this28</span> <span class="o">=</span> <span class="mh">0x1</span><span class="p">;</span>	<span class="cm">/* if 1 =&gt; Allow read access to this130 (gains) */</span>
	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this54</span> <span class="o">=</span> <span class="mh">0x0</span><span class="p">;</span>	<span class="cm">/* if 1 =&gt; Dont Allow access to hardware (gains) */</span>
	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this58</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this5c</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>

	<span class="cm">/* Set gains. */</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this14_array</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">this14_array</span><span class="p">));</span>

	<span class="cm">/* Actual init. */</span>
	<span class="n">vortex_EqHw_ZeroState</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">vortex_EqHw_SetSampleRate</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>
	<span class="n">vortex_Eqlzr_ReadAndSetActiveCoefSet</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>

	<span class="n">vortex_EqHw_Program10Band</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">eq</span><span class="o">-&gt;</span><span class="n">coefset</span><span class="p">));</span>
	<span class="n">vortex_Eqlzr_SetBypass</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this54</span><span class="p">);</span>
	<span class="n">vortex_Eqlzr_SetA3dBypassGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">vortex_EqHw_Enable</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">vortex_Eqlzr_shutdown</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_Eqlzr_ShutDownA3d</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">vortex_EqHw_ProgramPipe</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
	<span class="n">vortex_EqHw_Disable</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* ALSA interface */</span>

<span class="cm">/* Control interface */</span>
<span class="cp">#define snd_vortex_eqtoggle_info	snd_ctl_boolean_mono_info</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_eqtoggle_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>int i = kcontrol->private_value;</p></td><td class="code"><div class="highlight"><pre>	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this54</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_eqtoggle_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="n">eqlzr_t</span> <span class="o">*</span><span class="n">eq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">eq</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>int i = kcontrol->private_value;</p></td><td class="code"><div class="highlight"><pre>	<span class="n">eq</span><span class="o">-&gt;</span><span class="n">this54</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">vortex_Eqlzr_SetBypass</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">eq</span><span class="o">-&gt;</span><span class="n">this54</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Allways changes */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">vortex_eqtoggle_kcontrol</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;EQ Enable&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_vortex_eqtoggle_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">snd_vortex_eqtoggle_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">snd_vortex_eqtoggle_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_eq_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mh">0x0000</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mh">0x7fff</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_eq_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">gainL</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gainR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">vortex_Eqlzr_GetLeftGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gainL</span><span class="p">);</span>
	<span class="n">vortex_Eqlzr_GetRightGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gainR</span><span class="p">);</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">gainL</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">gainR</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_eq_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">gainL</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gainR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">vortex_Eqlzr_GetLeftGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gainL</span><span class="p">);</span>
	<span class="n">vortex_Eqlzr_GetRightGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gainR</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gainL</span> <span class="o">!=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">vortex_Eqlzr_SetLeftGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
					 <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gainR</span> <span class="o">!=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">vortex_Eqlzr_SetRightGain</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
					  <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
		<span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">vortex_eq_kcontrol</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;                        .&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_vortex_eq_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">snd_vortex_eq_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">snd_vortex_eq_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_peaks_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mh">0x0000</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mh">0x7fff</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">snd_vortex_peaks_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vortex_t</span> <span class="o">*</span><span class="n">vortex</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>

	<span class="n">vortex_Eqlzr_GetAllPeaks</span><span class="p">(</span><span class="n">vortex</span><span class="p">,</span> <span class="n">peaks</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">count</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">!=</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;vortex: peak count error 20 != %d </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">vortex_levels_kcontrol</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;EQ Peaks&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_READ</span> <span class="o">|</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_VOLATILE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_vortex_peaks_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">snd_vortex_peaks_get</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* EQ band gain labels. */</span>
<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">EqBandLabels</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;EQ0 31Hz</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
	<span class="s">&quot;EQ1 63Hz</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
	<span class="s">&quot;EQ2 125Hz</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
	<span class="s">&quot;EQ3 250Hz</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
	<span class="s">&quot;EQ4 500Hz</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
	<span class="s">&quot;EQ5 1KHz</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
	<span class="s">&quot;EQ6 2KHz</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
	<span class="s">&quot;EQ7 4KHz</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
	<span class="s">&quot;EQ8 8KHz</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
	<span class="s">&quot;EQ9 16KHz</span><span class="se">\0</span><span class="s">&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* ALSA driver entry points. Init and exit. */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">vortex_eq_init</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">vortex_Eqlzr_init</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">kcontrol</span> <span class="o">=</span>
	     <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vortex_eqtoggle_kcontrol</span><span class="p">,</span> <span class="n">vortex</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">kcontrol</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="cm">/* EQ gain controls */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">kcontrol</span> <span class="o">=</span>
		     <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vortex_eq_kcontrol</span><span class="p">,</span> <span class="n">vortex</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="n">snprintf</span><span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">name</span><span class="p">),</span>
			<span class="s">&quot;%s Playback Volume&quot;</span><span class="p">,</span> <span class="n">EqBandLabels</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">kcontrol</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>vortex->eqctrl[i] = kcontrol;</p></td><td class="code"><div class="highlight"><pre>	<span class="p">}</span>
	<span class="cm">/* EQ band levels */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">kcontrol</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vortex_levels_kcontrol</span><span class="p">,</span> <span class="n">vortex</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">vortex</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">kcontrol</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">vortex_eq_free</span><span class="p">(</span><span class="n">vortex_t</span> <span class="o">*</span> <span class="n">vortex</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>

<span class="cm">//DIVIDER</span>
<span class="cm">	   int i;</span>
<span class="cm">	   for (i=0; i&lt;10; i++) {</span>
<span class="cm">	   if (vortex-&gt;eqctrl[i])</span>
<span class="cm">	   snd_ctl_remove(vortex-&gt;card, vortex-&gt;eqctrl[i]);</span>
<span class="cm">	   }</span>
<span class="cm">	 */</span>
	<span class="n">vortex_Eqlzr_shutdown</span><span class="p">(</span><span class="n">vortex</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* End */</span>

</pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>FIXME: segfault because vortex->eqctrl[i] == 4</p></td><td class="code"><div class="highlight"><pre>undefined</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
