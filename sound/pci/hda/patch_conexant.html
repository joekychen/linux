<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › pci › hda › patch_conexant.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>patch_conexant.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * HD audio interface patch for Conexant HDA audio codec</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2006 Pototskiy Akex &lt;alex.pototskiy@gmail.com&gt;</span>
<span class="cm"> * 		      Takashi Iwai &lt;tiwai@suse.de&gt;</span>
<span class="cm"> * 		      Tobin Davis  &lt;tdavis@dsl-only.net&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This driver is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *  (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This driver is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;sound/core.h&gt;</span>
<span class="cp">#include &lt;sound/jack.h&gt;</span>

<span class="cp">#include &quot;hda_codec.h&quot;</span>
<span class="cp">#include &quot;hda_local.h&quot;</span>
<span class="cp">#include &quot;hda_auto_parser.h&quot;</span>
<span class="cp">#include &quot;hda_beep.h&quot;</span>
<span class="cp">#include &quot;hda_jack.h&quot;</span>

<span class="cp">#define CXT_PIN_DIR_IN              0x00</span>
<span class="cp">#define CXT_PIN_DIR_OUT             0x01</span>
<span class="cp">#define CXT_PIN_DIR_INOUT           0x02</span>
<span class="cp">#define CXT_PIN_DIR_IN_NOMICBIAS    0x03</span>
<span class="cp">#define CXT_PIN_DIR_INOUT_NOMICBIAS 0x04</span>

<span class="cp">#define CONEXANT_HP_EVENT	0x37</span>
<span class="cp">#define CONEXANT_MIC_EVENT	0x38</span>
<span class="cp">#define CONEXANT_LINE_EVENT	0x39</span>

<span class="cm">/* Conexant 5051 specific */</span>

<span class="cp">#define CXT5051_SPDIF_OUT	0x12</span>
<span class="cp">#define CXT5051_PORTB_EVENT	0x38</span>
<span class="cp">#define CXT5051_PORTC_EVENT	0x39</span>

<span class="cp">#define AUTO_MIC_PORTB		(1 &lt;&lt; 1)</span>
<span class="cp">#define AUTO_MIC_PORTC		(1 &lt;&lt; 2)</span>

<span class="k">struct</span> <span class="n">pin_dac_pair</span> <span class="p">{</span>
	<span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">dac</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">imux_info</span> <span class="p">{</span>
	<span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">;</span>		<span class="cm">/* input pin NID */</span>
	<span class="n">hda_nid_t</span> <span class="n">adc</span><span class="p">;</span>		<span class="cm">/* connected ADC NID */</span>	
	<span class="n">hda_nid_t</span> <span class="n">boost</span><span class="p">;</span>	<span class="cm">/* optional boost volume NID */</span>
	<span class="kt">int</span> <span class="n">index</span><span class="p">;</span>		<span class="cm">/* corresponding to autocfg.input */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_gen_spec</span> <span class="n">gen</span><span class="p">;</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="o">*</span><span class="n">mixers</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">num_mixers</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">vmaster_nid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_vmaster_mute_hook</span> <span class="n">vmaster_mute</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">vmaster_mute_led</span><span class="p">;</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="o">*</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>	<span class="cm">/* initialization verbs</span>
<span class="cm">						 * don&#39;t forget NULL</span>
<span class="cm">						 * termination!</span>
<span class="cm">						 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_init_verbs</span><span class="p">;</span>

	<span class="cm">/* playback */</span>
	<span class="k">struct</span> <span class="n">hda_multi_out</span> <span class="n">multiout</span><span class="p">;</span>	<span class="cm">/* playback set-up</span>
<span class="cm">					 * max_channels, dacs must be set</span>
<span class="cm">					 * dig_out_nid and hp_nid are optional</span>
<span class="cm">					 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cur_eapd</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hp_present</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">line_present</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">auto_mic</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">auto_mic_ext</span><span class="p">;</span>		<span class="cm">/* imux_pins[] index for ext mic */</span>
	<span class="kt">int</span> <span class="n">auto_mic_dock</span><span class="p">;</span>		<span class="cm">/* imux_pins[] index for dock mic */</span>
	<span class="kt">int</span> <span class="n">auto_mic_int</span><span class="p">;</span>		<span class="cm">/* imux_pins[] index for int mic */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">need_dac_fix</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">slave_dig_outs</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* capture */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_adc_nids</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">adc_nids</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">dig_in_nid</span><span class="p">;</span>		<span class="cm">/* digital-in NID; optional */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cur_adc_idx</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">cur_adc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cur_adc_stream_tag</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cur_adc_format</span><span class="p">;</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">capture_stream</span><span class="p">;</span>

	<span class="cm">/* capture source */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="o">*</span><span class="n">input_mux</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">capsrc_nids</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cur_mux</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="cm">/* channel model */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_channel_mode</span> <span class="o">*</span><span class="n">channel_mode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_channel_mode</span><span class="p">;</span>

	<span class="cm">/* PCM information */</span>
	<span class="k">struct</span> <span class="n">hda_pcm</span> <span class="n">pcm_rec</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* used in build_pcms() */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">spdif_route</span><span class="p">;</span>

	<span class="cm">/* dynamic controls, init_verbs and input_mux */</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="n">autocfg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">private_imux</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">imux_info</span> <span class="n">imux_info</span><span class="p">[</span><span class="n">HDA_MAX_NUM_INPUTS</span><span class="p">];</span>
	<span class="n">hda_nid_t</span> <span class="n">private_adc_nids</span><span class="p">[</span><span class="n">HDA_MAX_NUM_INPUTS</span><span class="p">];</span>
	<span class="n">hda_nid_t</span> <span class="n">private_dac_nids</span><span class="p">[</span><span class="n">AUTO_CFG_MAX_OUTS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">pin_dac_pair</span> <span class="n">dac_info</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">dac_info_filled</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">port_d_mode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">auto_mute</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* used in auto-parser */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">detect_line</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Line-out detection enabled */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">automute_lines</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* automute line-out as well */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">automute_hp_lo</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* both HP and LO available */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dell_automute</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dell_vostro</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ideapad</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">thinkpad</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hp_laptop</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">asus</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pin_eapd_ctrls</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fixup_stereo_dmic</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">adc_switching</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ext_mic_present</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">recording</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">capture_prepare</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">capture_cleanup</span><span class="p">)(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">);</span>

	<span class="cm">/* OLPC XO-1.5 supports DC input mode (e.g. for use with analog sensors)</span>
<span class="cm">	 * through the microphone jack.</span>
<span class="cm">	 * When the user enables this through a mixer switch, both internal and</span>
<span class="cm">	 * external microphones are disabled. Gain is fixed at 0dB. In this mode,</span>
<span class="cm">	 * we also allow the bias to be configured through a separate mixer</span>
<span class="cm">	 * control. */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dc_enable</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dc_input_bias</span><span class="p">;</span> <span class="cm">/* offset into cxt5066_olpc_dc_bias */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mic_boost</span><span class="p">;</span> <span class="cm">/* offset into cxt5066_analog_mic_boost */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">beep_amp</span><span class="p">;</span>

	<span class="cm">/* extra EAPD pins */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_eapds</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">eapds</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_playback_pcm_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_analog_open</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">,</span> <span class="n">substream</span><span class="p">,</span>
					     <span class="n">hinfo</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_playback_pcm_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stream_tag</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_analog_prepare</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">,</span>
						<span class="n">stream_tag</span><span class="p">,</span>
						<span class="n">format</span><span class="p">,</span> <span class="n">substream</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_playback_pcm_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_analog_cleanup</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Digital out</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_dig_playback_pcm_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_dig_open</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_dig_playback_pcm_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_dig_close</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_dig_playback_pcm_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stream_tag</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_dig_prepare</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">,</span>
					     <span class="n">stream_tag</span><span class="p">,</span>
					     <span class="n">format</span><span class="p">,</span> <span class="n">substream</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Analog capture</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_capture_pcm_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stream_tag</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">capture_prepare</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capture_prepare</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">snd_hda_codec_setup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="n">substream</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">],</span>
				   <span class="n">stream_tag</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_capture_pcm_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_hda_codec_cleanup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="n">substream</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">]);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">capture_cleanup</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capture_cleanup</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>



<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">conexant_pcm_analog_playback</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* fill later */</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">conexant_playback_pcm_open</span><span class="p">,</span>
		<span class="p">.</span><span class="n">prepare</span> <span class="o">=</span> <span class="n">conexant_playback_pcm_prepare</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="n">conexant_playback_pcm_cleanup</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">conexant_pcm_analog_capture</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* fill later */</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">prepare</span> <span class="o">=</span> <span class="n">conexant_capture_pcm_prepare</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="n">conexant_capture_pcm_cleanup</span>
	<span class="p">},</span>
<span class="p">};</span>


<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">conexant_pcm_digital_playback</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* fill later */</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">conexant_dig_playback_pcm_open</span><span class="p">,</span>
		<span class="p">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">conexant_dig_playback_pcm_close</span><span class="p">,</span>
		<span class="p">.</span><span class="n">prepare</span> <span class="o">=</span> <span class="n">conexant_dig_playback_pcm_prepare</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">conexant_pcm_digital_capture</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="cm">/* NID is set in alc_build_pcms */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx5051_capture_pcm_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stream_tag</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_idx</span><span class="p">];</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_stream_tag</span> <span class="o">=</span> <span class="n">stream_tag</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_format</span> <span class="o">=</span> <span class="n">format</span><span class="p">;</span>
	<span class="n">snd_hda_codec_setup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span><span class="p">,</span> <span class="n">stream_tag</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx5051_capture_pcm_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_hda_codec_cleanup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">cx5051_pcm_analog_capture</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* fill later */</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">prepare</span> <span class="o">=</span> <span class="n">cx5051_capture_pcm_prepare</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="n">cx5051_capture_pcm_cleanup</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_build_pcms</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_pcm</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">pcm_rec</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_pcms</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">pcm_info</span> <span class="o">=</span> <span class="n">info</span><span class="p">;</span>

	<span class="n">info</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CONEXANT Analog&quot;</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">conexant_pcm_analog_playback</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">].</span><span class="n">channels_max</span> <span class="o">=</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">].</span><span class="n">nid</span> <span class="o">=</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">capture_stream</span><span class="p">)</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">capture_stream</span><span class="p">;</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_id</span> <span class="o">==</span> <span class="mh">0x14f15051</span><span class="p">)</span>
			<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">cx5051_pcm_analog_capture</span><span class="p">;</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">conexant_pcm_analog_capture</span><span class="p">;</span>
			<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">].</span><span class="n">substreams</span> <span class="o">=</span>
				<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">].</span><span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">info</span><span class="o">++</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_pcms</span><span class="o">++</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Conexant Digital&quot;</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">pcm_type</span> <span class="o">=</span> <span class="n">HDA_PCM_TYPE_SPDIF</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">conexant_pcm_digital_playback</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">].</span><span class="n">nid</span> <span class="o">=</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">conexant_pcm_digital_capture</span><span class="p">;</span>
			<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">].</span><span class="n">nid</span> <span class="o">=</span>
				<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_dig_outs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">codec</span><span class="o">-&gt;</span><span class="n">slave_dig_outs</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_dig_outs</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_mux_enum_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
	       			  <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">snd_hda_input_mux_info</span><span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span><span class="p">,</span> <span class="n">uinfo</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_mux_enum_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">adc_idx</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>

	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_mux</span><span class="p">[</span><span class="n">adc_idx</span><span class="p">];</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_mux_enum_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">adc_idx</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">snd_hda_input_mux_put</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">,</span>
				     <span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span><span class="p">[</span><span class="n">adc_idx</span><span class="p">],</span>
				     <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_mux</span><span class="p">[</span><span class="n">adc_idx</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">conexant_set_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">fg</span><span class="p">,</span>
			       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">power_state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">power_state</span> <span class="o">==</span> <span class="n">AC_PWRST_D3</span><span class="p">)</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
	<span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">fg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_POWER_STATE</span><span class="p">,</span>
			    <span class="n">power_state</span><span class="p">);</span>
	<span class="cm">/* partial workaround for &quot;azx_get_response timeout&quot; */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">power_state</span> <span class="o">==</span> <span class="n">AC_PWRST_D0</span><span class="p">)</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">snd_hda_codec_set_power_to_all</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">fg</span><span class="p">,</span> <span class="n">power_state</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">conexant_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_hda_gen_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">gen</span><span class="p">);</span>
	<span class="n">snd_hda_detach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">spec</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt_capture_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">conexant_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">conexant_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">conexant_mux_enum_put</span>
	<span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_SND_HDA_INPUT_BEEP</span>
<span class="cm">/* additional beep mixers; the actual parameters are overwritten at build */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt_beep_mixer</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Beep Playback Volume&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_BEEP_MONO</span><span class="p">(</span><span class="s">&quot;Beep Playback Switch&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">slave_pfxs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Headphone&quot;</span><span class="p">,</span> <span class="s">&quot;Speaker&quot;</span><span class="p">,</span> <span class="s">&quot;Front&quot;</span><span class="p">,</span> <span class="s">&quot;Surround&quot;</span><span class="p">,</span> <span class="s">&quot;CLFE&quot;</span><span class="p">,</span>
	<span class="nb">NULL</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_build_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_add_new_ctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_create_spdif_out_ctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span>
						    <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">,</span>
						    <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_create_spdif_share_sw</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span>
						    <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">share_spdif</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> 
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_create_spdif_in_ctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* if we have no master control, let&#39;s create it */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span> <span class="o">&amp;&amp;</span>
	    <span class="o">!</span><span class="n">snd_hda_find_mixer_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Master Playback Volume&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vmaster_tlv</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
		<span class="n">snd_hda_set_vmaster_tlv</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span><span class="p">,</span>
					<span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="n">vmaster_tlv</span><span class="p">);</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_add_vmaster</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span>
					  <span class="n">vmaster_tlv</span><span class="p">,</span> <span class="n">slave_pfxs</span><span class="p">,</span>
					  <span class="s">&quot;Playback Volume&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span> <span class="o">&amp;&amp;</span>
	    <span class="o">!</span><span class="n">snd_hda_find_mixer_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">__snd_hda_add_vmaster</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
					    <span class="nb">NULL</span><span class="p">,</span> <span class="n">slave_pfxs</span><span class="p">,</span>
					    <span class="s">&quot;Playback Switch&quot;</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span>
					    <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_mute</span><span class="p">.</span><span class="n">sw_kctl</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_add_new_ctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cxt_capture_mixers</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

<span class="cp">#ifdef CONFIG_SND_HDA_INPUT_BEEP</span>
	<span class="cm">/* create beep controls if needed */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="o">*</span><span class="n">knew</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">knew</span> <span class="o">=</span> <span class="n">cxt_beep_mixer</span><span class="p">;</span> <span class="n">knew</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span> <span class="n">knew</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kctl</span><span class="p">;</span>
			<span class="n">kctl</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="n">knew</span><span class="p">,</span> <span class="n">codec</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">kctl</span><span class="p">)</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
			<span class="n">kctl</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">;</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_ctl_add</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kctl</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="cp">#endif</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">pm_message_t</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_hda_shutup_pins</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_codec_ops</span> <span class="n">conexant_patch_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">build_controls</span> <span class="o">=</span> <span class="n">conexant_build_controls</span><span class="p">,</span>
	<span class="p">.</span><span class="n">build_pcms</span> <span class="o">=</span> <span class="n">conexant_build_pcms</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">conexant_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">free</span> <span class="o">=</span> <span class="n">conexant_free</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_power_state</span> <span class="o">=</span> <span class="n">conexant_set_power</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="p">.</span><span class="n">suspend</span> <span class="o">=</span> <span class="n">conexant_suspend</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="p">.</span><span class="n">reboot_notify</span> <span class="o">=</span> <span class="n">snd_hda_shutup_pins</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_SND_HDA_INPUT_BEEP</span>
<span class="cp">#define set_beep_amp(spec, nid, idx, dir) \</span>
<span class="cp">	((spec)-&gt;beep_amp = HDA_COMPOSE_AMP_VAL(nid, 1, idx, dir))</span>
<span class="cp">#else</span>
<span class="cp">#define set_beep_amp(spec, nid, idx, dir) </span><span class="cm">/* NOP */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">patch_conexant_auto</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">);</span>
<span class="cm">/*</span>
<span class="cm"> * EAPD control</span>
<span class="cm"> * the private value = nid | (invert &lt;&lt; 8)</span>
<span class="cm"> */</span>

<span class="cp">#define cxt_eapd_info		snd_ctl_boolean_mono_info</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt_eapd_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">invert</span> <span class="o">=</span> <span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">invert</span><span class="p">)</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt_eapd_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">invert</span> <span class="o">=</span> <span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">eapd</span><span class="p">;</span>

	<span class="n">eapd</span> <span class="o">=</span> <span class="o">!!</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">invert</span><span class="p">)</span>
		<span class="n">eapd</span> <span class="o">=</span> <span class="o">!</span><span class="n">eapd</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">eapd</span> <span class="o">==</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span> <span class="o">=</span> <span class="n">eapd</span><span class="p">;</span>
	<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span>
				  <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span>
				  <span class="n">eapd</span> <span class="o">?</span> <span class="mh">0x02</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* controls for test mode */</span>
<span class="cp">#ifdef CONFIG_SND_DEBUG</span>

<span class="cp">#define CXT_EAPD_SWITCH(xname, nid, mask) \</span>
<span class="cp">	{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = 0,  \</span>
<span class="cp">	  .info = cxt_eapd_info, \</span>
<span class="cp">	  .get = cxt_eapd_get, \</span>
<span class="cp">	  .put = cxt_eapd_put, \</span>
<span class="cp">	  .private_value = nid | (mask&lt;&lt;16) }</span>



<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_ch_mode_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_ch_mode_info</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">uinfo</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span><span class="p">,</span>
				    <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_ch_mode_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_ch_mode_get</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span><span class="p">,</span>
				   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span><span class="p">,</span>
				   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">conexant_ch_mode_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_ch_mode_put</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span><span class="p">,</span>
				      <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span><span class="p">,</span>
				      <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">need_dac_fix</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define CXT_PIN_MODE(xname, nid, dir) \</span>
<span class="cp">	{ .iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname, .index = 0,  \</span>
<span class="cp">	  .info = conexant_ch_mode_info, \</span>
<span class="cp">	  .get = conexant_ch_mode_get, \</span>
<span class="cp">	  .put = conexant_ch_mode_put, \</span>
<span class="cp">	  .private_value = nid | (dir&lt;&lt;16) }</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_SND_DEBUG */</span><span class="cp"></span>

<span class="cm">/* Conexant 5045 specific */</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5045_dac_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x19</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5045_adc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x1a</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5045_capsrc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x1a</span> <span class="p">};</span>
<span class="cp">#define CXT5045_SPDIF_OUT	0x18</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_channel_mode</span> <span class="n">cxt5045_modes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">cxt5045_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Internal Mic&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span>          <span class="mh">0x2</span> <span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">cxt5045_capture_source_benq</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Internal Mic&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span>          <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Line&quot;</span><span class="p">,</span>         <span class="mh">0x3</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mixer&quot;</span><span class="p">,</span>        <span class="mh">0x0</span> <span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">cxt5045_capture_source_hp530</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span>          <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Internal Mic&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* turn on/off EAPD (+ mute HP) as a master switch */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5045_hp_master_sw_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bits</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cxt_eapd_put</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* toggle internal speakers mute depending of presence of</span>
<span class="cm">	 * the headphone jack</span>
<span class="cm">	 */</span>
	<span class="n">bits</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">HDA_AMP_MUTE</span><span class="p">;</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>

	<span class="n">bits</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">HDA_AMP_MUTE</span><span class="p">;</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* bind volumes of both NID 0x10 and 0x11 */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_bind_ctls</span> <span class="n">cxt5045_hp_bind_master_vol</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">snd_hda_bind_vol</span><span class="p">,</span>
	<span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="mi">0</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* toggle input of built-in and mic jack appropriately */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5045_hp_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">mic_jack_on</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb000</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">mic_jack_off</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb000</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">present</span><span class="p">)</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mic_jack_on</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mic_jack_off</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* mute internal speaker if HP is plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5045_hp_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bits</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>

	<span class="n">bits</span> <span class="o">=</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">||</span> <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">)</span> <span class="o">?</span> <span class="n">HDA_AMP_MUTE</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span> 
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* unsolicited event for HP jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5045_hp_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">res</span> <span class="o">&gt;&gt;=</span> <span class="mi">26</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CONEXANT_HP_EVENT</span>:
		<span class="n">cxt5045_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CONEXANT_MIC_EVENT</span>:
		<span class="n">cxt5045_hp_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5045_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Internal Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_VOL</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxt5045_hp_bind_master_vol</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">cxt_eapd_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cxt_eapd_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cxt5045_hp_master_sw_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5045_benq_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>

	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5045_mixers_hp530</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Internal Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_VOL</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxt5045_hp_bind_master_vol</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">cxt_eapd_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cxt_eapd_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cxt5045_hp_master_sw_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5045_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Line in, Mic */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="o">|</span><span class="n">AC_PINCTL_VREF_80</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="o">|</span><span class="n">AC_PINCTL_VREF_80</span> <span class="p">},</span>
	<span class="cm">/* HP, Amp  */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="cm">/* Record selector: Internal mic */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span><span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
	 <span class="n">AC_AMP_SET_INPUT</span><span class="o">|</span><span class="n">AC_AMP_SET_RIGHT</span><span class="o">|</span><span class="n">AC_AMP_SET_LEFT</span><span class="o">|</span><span class="mh">0x17</span><span class="p">},</span>
	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
	<span class="cm">/* EAPD */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span> <span class="cm">/* default on */</span> 
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5045_benq_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Internal Mic, Mic */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="o">|</span><span class="n">AC_PINCTL_VREF_80</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="o">|</span><span class="n">AC_PINCTL_VREF_80</span> <span class="p">},</span>
	<span class="cm">/* Line In,HP, Amp  */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="cm">/* Record selector: Internal mic */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
	 <span class="n">AC_AMP_SET_INPUT</span><span class="o">|</span><span class="n">AC_AMP_SET_RIGHT</span><span class="o">|</span><span class="n">AC_AMP_SET_LEFT</span><span class="o">|</span><span class="mh">0x17</span><span class="p">},</span>
	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* EAPD */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">},</span> <span class="cm">/* default on */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5045_hp_sense_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* pin sensing on HP jack */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5045_mic_sense_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* pin sensing on HP jack */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_SND_DEBUG</span>
<span class="cm">/* Test configuration for debugging, modelled after the ALC260 test</span>
<span class="cm"> * configuration.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">cxt5045_test_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;MIXER&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;MIC1 pin&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;LINE1 pin&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;HP-OUT pin&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;CD pin&quot;</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>
        <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5045_test_mixer</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="cm">/* Output controls */</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Speaker Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Speaker Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;HP-OUT Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;HP-OUT Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;LINE1 Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;LINE1 Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	
	<span class="cm">/* Modes for retasking pin widgets */</span>
	<span class="n">CXT_PIN_MODE</span><span class="p">(</span><span class="s">&quot;HP-OUT pin mode&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">CXT_PIN_DIR_INOUT</span><span class="p">),</span>
	<span class="n">CXT_PIN_MODE</span><span class="p">(</span><span class="s">&quot;LINE1 pin mode&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">CXT_PIN_DIR_INOUT</span><span class="p">),</span>

	<span class="cm">/* EAPD Switch Control */</span>
	<span class="n">CXT_EAPD_SWITCH</span><span class="p">(</span><span class="s">&quot;External Amplifier&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">),</span>

	<span class="cm">/* Loopback mixer controls */</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;MIC1 pin Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;MIC1 pin Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;LINE1 pin Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;LINE1 pin Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;HP-OUT pin Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;HP-OUT pin Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD pin Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD pin Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Input Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">conexant_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">conexant_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">conexant_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* Audio input controls */</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5045_test_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Set connections */</span>
	<span class="p">{</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
	<span class="cm">/* Enable retasking pins as output, initially without power amp */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>

	<span class="cm">/* Disable digital (SPDIF) pins initially, but users can enable</span>
<span class="cm">	 * them via a mixer switch.  In the case of SPDIF-out, this initverb</span>
<span class="cm">	 * payload also sets the generation to 0, output to be in &quot;consumer&quot;</span>
<span class="cm">	 * PCM format, copyright asserted, no pre-emphasis and no validity</span>
<span class="cm">	 * control.</span>
<span class="cm">	 */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_DIGI_CONVERT_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Unmute retasking pin widget output buffers since the default</span>
<span class="cm">	 * state appears to be output.  As the pin mode is changed by the</span>
<span class="cm">	 * user the pin mode control will take care of enabling the pin&#39;s</span>
<span class="cm">	 * input/output buffers as needed.</span>
<span class="cm">	 */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>

	<span class="cm">/* Mute capture amp left and right */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>

	<span class="cm">/* Set ADC connection select to match default mixer setting (mic1</span>
<span class="cm">	 * pin)</span>
<span class="cm">	 */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>

	<span class="cm">/* Mute all inputs to mixer widget (even unconnected ones) */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span> <span class="cm">/* Mixer */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span> <span class="cm">/* Mic1 pin */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span> <span class="cm">/* Line pin */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span> <span class="cm">/* HP pin */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span> <span class="cm">/* CD pin */</span>

	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="cp">#endif</span>


<span class="cm">/* initialize jack-sensing, too */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5045_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">conexant_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">cxt5045_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CXT5045_LAPTOP_HPSENSE</span><span class="p">,</span>
	<span class="n">CXT5045_LAPTOP_MICSENSE</span><span class="p">,</span>
	<span class="n">CXT5045_LAPTOP_HPMICSENSE</span><span class="p">,</span>
	<span class="n">CXT5045_BENQ</span><span class="p">,</span>
	<span class="n">CXT5045_LAPTOP_HP530</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_SND_DEBUG</span>
	<span class="n">CXT5045_TEST</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="n">CXT5045_AUTO</span><span class="p">,</span>
	<span class="n">CXT5045_MODELS</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">cxt5045_models</span><span class="p">[</span><span class="n">CXT5045_MODELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">CXT5045_LAPTOP_HPSENSE</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop-hpsense&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5045_LAPTOP_MICSENSE</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop-micsense&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5045_LAPTOP_HPMICSENSE</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop-hpmicsense&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5045_BENQ</span><span class="p">]</span>			<span class="o">=</span> <span class="s">&quot;benq&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5045_LAPTOP_HP530</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;laptop-hp530&quot;</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_SND_DEBUG</span>
	<span class="p">[</span><span class="n">CXT5045_TEST</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="p">[</span><span class="n">CXT5045_AUTO</span><span class="p">]</span>			<span class="o">=</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">cxt5045_cfg_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x30d5</span><span class="p">,</span> <span class="s">&quot;HP 530&quot;</span><span class="p">,</span> <span class="n">CXT5045_LAPTOP_HP530</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1179</span><span class="p">,</span> <span class="mh">0xff31</span><span class="p">,</span> <span class="s">&quot;Toshiba P105&quot;</span><span class="p">,</span> <span class="n">CXT5045_LAPTOP_MICSENSE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x152d</span><span class="p">,</span> <span class="mh">0x0753</span><span class="p">,</span> <span class="s">&quot;Benq R55E&quot;</span><span class="p">,</span> <span class="n">CXT5045_BENQ</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1734</span><span class="p">,</span> <span class="mh">0x10ad</span><span class="p">,</span> <span class="s">&quot;Fujitsu Si1520&quot;</span><span class="p">,</span> <span class="n">CXT5045_LAPTOP_MICSENSE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1734</span><span class="p">,</span> <span class="mh">0x10cb</span><span class="p">,</span> <span class="s">&quot;Fujitsu Si3515&quot;</span><span class="p">,</span> <span class="n">CXT5045_LAPTOP_HPMICSENSE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1734</span><span class="p">,</span> <span class="mh">0x110e</span><span class="p">,</span> <span class="s">&quot;Fujitsu V5505&quot;</span><span class="p">,</span>
		      <span class="n">CXT5045_LAPTOP_HPMICSENSE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1509</span><span class="p">,</span> <span class="mh">0x1e40</span><span class="p">,</span> <span class="s">&quot;FIC&quot;</span><span class="p">,</span> <span class="n">CXT5045_LAPTOP_HPMICSENSE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1509</span><span class="p">,</span> <span class="mh">0x2f05</span><span class="p">,</span> <span class="s">&quot;FIC&quot;</span><span class="p">,</span> <span class="n">CXT5045_LAPTOP_HPMICSENSE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1509</span><span class="p">,</span> <span class="mh">0x2f06</span><span class="p">,</span> <span class="s">&quot;FIC&quot;</span><span class="p">,</span> <span class="n">CXT5045_LAPTOP_HPMICSENSE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK_MASK</span><span class="p">(</span><span class="mh">0x1631</span><span class="p">,</span> <span class="mh">0xff00</span><span class="p">,</span> <span class="mh">0xc100</span><span class="p">,</span> <span class="s">&quot;Packard Bell&quot;</span><span class="p">,</span>
			   <span class="n">CXT5045_LAPTOP_HPMICSENSE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x8086</span><span class="p">,</span> <span class="mh">0x2111</span><span class="p">,</span> <span class="s">&quot;Conexant Reference board&quot;</span><span class="p">,</span> <span class="n">CXT5045_LAPTOP_HPSENSE</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_cxt5045</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">board_config</span><span class="p">;</span>

	<span class="n">board_config</span> <span class="o">=</span> <span class="n">snd_hda_check_board_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">CXT5045_MODELS</span><span class="p">,</span>
						  <span class="n">cxt5045_models</span><span class="p">,</span>
						  <span class="n">cxt5045_cfg_tbl</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">board_config</span> <span class="o">=</span> <span class="n">CXT5045_AUTO</span><span class="p">;</span> <span class="cm">/* model=auto as default */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">==</span> <span class="n">CXT5045_AUTO</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">patch_conexant_auto</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">single_adc_amp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cxt5045_dac_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">cxt5045_dac_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">CXT5045_SPDIF_OUT</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">cxt5045_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span> <span class="o">=</span> <span class="n">cxt5045_capsrc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5045_capture_source</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_init_verbs</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cxt5045_modes</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span> <span class="o">=</span> <span class="n">cxt5045_modes</span><span class="p">;</span>

	<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">conexant_patch_ops</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CXT5045_LAPTOP_HPSENSE</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5045_hp_unsol_event</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5045_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_hp_sense_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_mixers</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5045_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5045_LAPTOP_MICSENSE</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5045_hp_unsol_event</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5045_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_mic_sense_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_mixers</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5045_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
	<span class="k">case</span> <span class="n">CXT5045_LAPTOP_HPMICSENSE</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5045_hp_unsol_event</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5045_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_hp_sense_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_mic_sense_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_mixers</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5045_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5045_BENQ</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5045_hp_unsol_event</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5045_capture_source_benq</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_benq_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_benq_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5045_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5045_LAPTOP_HP530</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5045_hp_unsol_event</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5045_capture_source_hp530</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_hp_sense_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_mixers_hp530</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5045_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_SND_DEBUG</span>
	<span class="k">case</span> <span class="n">CXT5045_TEST</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5045_test_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_test_mixer</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5045_test_init_verbs</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
		
<span class="cp">#endif	</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">subsystem_id</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x103c</span>:
	<span class="k">case</span> <span class="mh">0x1631</span>:
	<span class="k">case</span> <span class="mh">0x1734</span>:
	<span class="k">case</span> <span class="mh">0x17aa</span>:
		<span class="cm">/* HP, Packard Bell, Fujitsu-Siemens &amp; Lenovo laptops have</span>
<span class="cm">		 * really bad sound over 0dB on NID 0x17. Fix max PCM level to</span>
<span class="cm">		 * 0 dB (originally it has 0x2b steps with 0dB offset 0x14)</span>
<span class="cm">		 */</span>
		<span class="n">snd_hda_override_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span>
					  <span class="p">(</span><span class="mh">0x14</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_OFFSET_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x14</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_NUM_STEPS_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x05</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_STEP_SIZE_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_MUTE_SHIFT</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">)</span>
		<span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Conexant 5047 specific */</span>
<span class="cp">#define CXT5047_SPDIF_OUT	0x11</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5047_dac_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x10</span> <span class="p">};</span> <span class="cm">/* 0x1c */</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5047_adc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x12</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5047_capsrc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x1a</span> <span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_channel_mode</span> <span class="n">cxt5047_modes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">cxt5047_toshiba_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;ExtMic&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Line-In&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* turn on/off EAPD (+ mute HP) as a master switch */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5047_hp_master_sw_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bits</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cxt_eapd_put</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* toggle internal speakers mute depending of presence of</span>
<span class="cm">	 * the headphone jack</span>
<span class="cm">	 */</span>
	<span class="n">bits</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">HDA_AMP_MUTE</span><span class="p">;</span>
	<span class="cm">/* NOTE: Conexat codec needs the index for *OUTPUT* amp of</span>
<span class="cm">	 * pin widgets unlike other codecs.  In this case, we need to</span>
<span class="cm">	 * set index 0x01 for the volume from the mixer amp 0x19.</span>
<span class="cm">	 */</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>
	<span class="n">bits</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">HDA_AMP_MUTE</span><span class="p">;</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* mute internal speaker if HP is plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5047_hp_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bits</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">);</span>

	<span class="n">bits</span> <span class="o">=</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">||</span> <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">)</span> <span class="o">?</span> <span class="n">HDA_AMP_MUTE</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/* See the note in cxt5047_hp_master_sw_put */</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* toggle input of built-in and mic jack appropriately */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5047_hp_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">mic_jack_on</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">mic_jack_off</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">present</span><span class="p">)</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mic_jack_on</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mic_jack_off</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* unsolicited event for HP jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5047_hp_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CONEXANT_HP_EVENT</span>:
		<span class="n">cxt5047_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CONEXANT_MIC_EVENT</span>:
		<span class="n">cxt5047_hp_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5047_base_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Volume&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Switch&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">cxt_eapd_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cxt_eapd_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cxt5047_hp_master_sw_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5047_hp_spk_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* See the note in cxt5047_hp_master_sw_put */</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Speaker Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Headphone Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5047_hp_only_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5047_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Line in, Mic, Built-in Mic */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="o">|</span><span class="n">AC_PINCTL_VREF_50</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="o">|</span><span class="n">AC_PINCTL_VREF_50</span> <span class="p">},</span>
	<span class="cm">/* HP, Speaker  */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span> <span class="cm">/* mixer(0x19) */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span> <span class="cm">/* mixer(0x19) */</span>
	<span class="cm">/* Record selector: Mic */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span><span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
	 <span class="n">AC_AMP_SET_INPUT</span><span class="o">|</span><span class="n">AC_AMP_SET_RIGHT</span><span class="o">|</span><span class="n">AC_AMP_SET_LEFT</span><span class="o">|</span><span class="mh">0x17</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1A</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span><span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1A</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
	 <span class="n">AC_AMP_SET_OUTPUT</span><span class="o">|</span><span class="n">AC_AMP_SET_RIGHT</span><span class="o">|</span><span class="n">AC_AMP_SET_LEFT</span><span class="o">|</span><span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1A</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
	 <span class="n">AC_AMP_SET_OUTPUT</span><span class="o">|</span><span class="n">AC_AMP_SET_RIGHT</span><span class="o">|</span><span class="n">AC_AMP_SET_LEFT</span><span class="o">|</span><span class="mh">0x03</span><span class="p">},</span>
	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span> <span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
	<span class="cm">/* Enable unsolicited events */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* configuration for Toshiba Laptops */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5047_toshiba_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span> <span class="cm">/* default off */</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="cm">/* Test configuration for debugging, modelled after the ALC260 test</span>
<span class="cm"> * configuration.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_SND_DEBUG</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">cxt5047_test_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;LINE1 pin&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;MIC1 pin&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;MIC2 pin&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;CD pin&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
        <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5047_test_mixer</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="cm">/* Output only controls */</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;OutAmp-1 Volume&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;OutAmp-1 Switch&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span><span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;OutAmp-2 Volume&quot;</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;OutAmp-2 Switch&quot;</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Speaker Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Speaker Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;HeadPhone Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;HeadPhone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line1-Out Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line1-Out Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line2-Out Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line2-Out Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>

	<span class="cm">/* Modes for retasking pin widgets */</span>
	<span class="n">CXT_PIN_MODE</span><span class="p">(</span><span class="s">&quot;LINE1 pin mode&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="n">CXT_PIN_DIR_INOUT</span><span class="p">),</span>
	<span class="n">CXT_PIN_MODE</span><span class="p">(</span><span class="s">&quot;MIC1 pin mode&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="n">CXT_PIN_DIR_INOUT</span><span class="p">),</span>

	<span class="cm">/* EAPD Switch Control */</span>
	<span class="n">CXT_EAPD_SWITCH</span><span class="p">(</span><span class="s">&quot;External Amplifier&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">),</span>

	<span class="cm">/* Loopback mixer controls */</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;MIC1 Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;MIC1 Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;MIC2 Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;MIC2 Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;LINE Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;LINE Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture-1 Volume&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture-1 Switch&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture-2 Volume&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture-2 Switch&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture-3 Volume&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture-3 Switch&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture-4 Volume&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture-4 Switch&quot;</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Input Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">conexant_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">conexant_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">conexant_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>

	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5047_test_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Enable retasking pins as output, initially without power amp */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>

	<span class="cm">/* Disable digital (SPDIF) pins initially, but users can enable</span>
<span class="cm">	 * them via a mixer switch.  In the case of SPDIF-out, this initverb</span>
<span class="cm">	 * payload also sets the generation to 0, output to be in &quot;consumer&quot;</span>
<span class="cm">	 * PCM format, copyright asserted, no pre-emphasis and no validity</span>
<span class="cm">	 * control.</span>
<span class="cm">	 */</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_DIGI_CONVERT_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Ensure mic1, mic2, line1 pin widgets take input from the </span>
<span class="cm">	 * OUT1 sum bus when acting as an output.</span>
<span class="cm">	 */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Start with output sum widgets muted and their output gains at min */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>

	<span class="cm">/* Unmute retasking pin widget output buffers since the default</span>
<span class="cm">	 * state appears to be output.  As the pin mode is changed by the</span>
<span class="cm">	 * user the pin mode control will take care of enabling the pin&#39;s</span>
<span class="cm">	 * input/output buffers as needed.</span>
<span class="cm">	 */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>

	<span class="cm">/* Mute capture amp left and right */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>

	<span class="cm">/* Set ADC connection select to match default mixer setting (mic1</span>
<span class="cm">	 * pin)</span>
<span class="cm">	 */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>

	<span class="cm">/* Mute all inputs to mixer widget (even unconnected ones) */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span> <span class="cm">/* mic1 pin */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span> <span class="cm">/* mic2 pin */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span> <span class="cm">/* line1 pin */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span> <span class="cm">/* line2 pin */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span> <span class="cm">/* CD pin */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">5</span><span class="p">)},</span> <span class="cm">/* Beep-gen pin */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">6</span><span class="p">)},</span> <span class="cm">/* Line-out pin */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">7</span><span class="p">)},</span> <span class="cm">/* HP-pin pin */</span>

	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="cp">#endif</span>


<span class="cm">/* initialize jack-sensing, too */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5047_hp_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">conexant_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">cxt5047_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CXT5047_LAPTOP</span><span class="p">,</span>		<span class="cm">/* Laptops w/o EAPD support */</span>
	<span class="n">CXT5047_LAPTOP_HP</span><span class="p">,</span>	<span class="cm">/* Some HP laptops */</span>
	<span class="n">CXT5047_LAPTOP_EAPD</span><span class="p">,</span>	<span class="cm">/* Laptops with EAPD support */</span>
<span class="cp">#ifdef CONFIG_SND_DEBUG</span>
	<span class="n">CXT5047_TEST</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="n">CXT5047_AUTO</span><span class="p">,</span>
	<span class="n">CXT5047_MODELS</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">cxt5047_models</span><span class="p">[</span><span class="n">CXT5047_MODELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">CXT5047_LAPTOP</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5047_LAPTOP_HP</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop-hp&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5047_LAPTOP_EAPD</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop-eapd&quot;</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_SND_DEBUG</span>
	<span class="p">[</span><span class="n">CXT5047_TEST</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;test&quot;</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="p">[</span><span class="n">CXT5047_AUTO</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">cxt5047_cfg_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x30a5</span><span class="p">,</span> <span class="s">&quot;HP DV5200T/DV8000T&quot;</span><span class="p">,</span> <span class="n">CXT5047_LAPTOP_HP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK_MASK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0xff00</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">,</span> <span class="s">&quot;HP DV Series&quot;</span><span class="p">,</span>
			   <span class="n">CXT5047_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1179</span><span class="p">,</span> <span class="mh">0xff31</span><span class="p">,</span> <span class="s">&quot;Toshiba P100&quot;</span><span class="p">,</span> <span class="n">CXT5047_LAPTOP_EAPD</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_cxt5047</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">board_config</span><span class="p">;</span>

	<span class="n">board_config</span> <span class="o">=</span> <span class="n">snd_hda_check_board_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">CXT5047_MODELS</span><span class="p">,</span>
						  <span class="n">cxt5047_models</span><span class="p">,</span>
						  <span class="n">cxt5047_cfg_tbl</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">board_config</span> <span class="o">=</span> <span class="n">CXT5047_AUTO</span><span class="p">;</span> <span class="cm">/* model=auto as default */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">==</span> <span class="n">CXT5047_AUTO</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">patch_conexant_auto</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">pin_amp_workaround</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cxt5047_dac_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">cxt5047_dac_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">CXT5047_SPDIF_OUT</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">cxt5047_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span> <span class="o">=</span> <span class="n">cxt5047_capsrc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5047_base_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5047_init_verbs</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cxt5047_modes</span><span class="p">),</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span> <span class="o">=</span> <span class="n">cxt5047_modes</span><span class="p">,</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">conexant_patch_ops</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CXT5047_LAPTOP</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5047_hp_spk_mixers</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5047_hp_unsol_event</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5047_LAPTOP_HP</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5047_hp_only_mixers</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5047_hp_unsol_event</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5047_hp_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5047_LAPTOP_EAPD</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5047_toshiba_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5047_hp_spk_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5047_toshiba_init_verbs</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5047_hp_unsol_event</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_SND_DEBUG</span>
	<span class="k">case</span> <span class="n">CXT5047_TEST</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5047_test_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5047_test_mixer</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5047_test_init_verbs</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5047_hp_unsol_event</span><span class="p">;</span>
<span class="cp">#endif	</span>
	<span class="p">}</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span> <span class="o">=</span> <span class="mh">0x13</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">subsystem_id</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x103c</span>:
		<span class="cm">/* HP laptops have really bad sound over 0 dB on NID 0x10.</span>
<span class="cm">		 * Fix max PCM level to 0 dB (originally it has 0x1e steps</span>
<span class="cm">		 * with 0 dB offset 0x17)</span>
<span class="cm">		 */</span>
		<span class="n">snd_hda_override_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_OFFSET_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_NUM_STEPS_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x05</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_STEP_SIZE_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_MUTE_SHIFT</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Conexant 5051 specific */</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5051_dac_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x10</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5051_adc_nids</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x15</span> <span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_channel_mode</span> <span class="n">cxt5051_modes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5051_update_speaker</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pinctl</span><span class="p">;</span>
	<span class="cm">/* headphone pin */</span>
	<span class="n">pinctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">)</span> <span class="o">?</span> <span class="n">PIN_HP</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="n">pinctl</span><span class="p">);</span>
	<span class="cm">/* speaker pin */</span>
	<span class="n">pinctl</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">)</span> <span class="o">?</span> <span class="n">PIN_OUT</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="n">pinctl</span><span class="p">);</span>
	<span class="cm">/* on ideapad there is an additional speaker (subwoofer) to mute */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">ideapad</span><span class="p">)</span>
		<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="n">pinctl</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* turn on/off EAPD (+ mute HP) as a master switch */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5051_hp_master_sw_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cxt_eapd_put</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">cxt5051_update_speaker</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* toggle input of built-in and mic jack appropriately */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5051_portb_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span> <span class="o">&amp;</span> <span class="n">AUTO_MIC_PORTB</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">);</span>
	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span>
			    <span class="n">present</span> <span class="o">?</span> <span class="mh">0x01</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* switch the current ADC according to the jack state */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5051_portc_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">new_adc</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span> <span class="o">&amp;</span> <span class="n">AUTO_MIC_PORTC</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">present</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">new_adc</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_idx</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">!=</span> <span class="n">new_adc</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* stream is running, let&#39;s swap the current ADC */</span>
		<span class="n">__snd_hda_codec_cleanup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">=</span> <span class="n">new_adc</span><span class="p">;</span>
		<span class="n">snd_hda_codec_setup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">new_adc</span><span class="p">,</span>
					   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_stream_tag</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_format</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* mute internal speaker if HP is plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5051_hp_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">);</span>
	<span class="n">cxt5051_update_speaker</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* unsolicited event for HP jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5051_hp_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CONEXANT_HP_EVENT</span>:
		<span class="n">cxt5051_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5051_PORTB_EVENT</span>:
		<span class="n">cxt5051_portb_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5051_PORTC_EVENT</span>:
		<span class="n">cxt5051_portc_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5051_playback_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">cxt_eapd_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cxt_eapd_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cxt5051_hp_master_sw_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5051_capture_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Internal Mic Switch&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Switch&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Docking Mic Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Docking Mic Switch&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5051_hp_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Internal Mic Switch&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Switch&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5051_hp_dv6736_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5051_f700_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5051_toshiba_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Internal Mic Switch&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Switch&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5051_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Line in, Mic */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="cm">/* SPK  */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="cm">/* HP, Amp  */</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="cm">/* DAC1 */</span>	
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* Record selector: Internal mic */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x44</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x44</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x44</span><span class="p">},</span>
	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* EAPD */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">},</span> <span class="cm">/* default on */</span> 
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span><span class="o">|</span><span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5051_hp_dv6736_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Line in, Mic */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* SPK  */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="cm">/* HP, Amp  */</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="cm">/* DAC1 */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* Record selector: Internal mic */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x44</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* EAPD */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">},</span> <span class="cm">/* default on */</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span><span class="o">|</span><span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5051_f700_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Line in, Mic */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* SPK  */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="cm">/* HP, Amp  */</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="cm">/* DAC1 */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* Record selector: Internal mic */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x44</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* EAPD */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">},</span> <span class="cm">/* default on */</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span><span class="o">|</span><span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5051_init_mic_port</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span>
				 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span>
			    <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">event</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5051_ideapad_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Subwoofer */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* initialize jack-sensing, too */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5051_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="n">conexant_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span> <span class="o">&amp;</span> <span class="n">AUTO_MIC_PORTB</span><span class="p">)</span>
		<span class="n">cxt5051_init_mic_port</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">CXT5051_PORTB_EVENT</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span> <span class="o">&amp;</span> <span class="n">AUTO_MIC_PORTC</span><span class="p">)</span>
		<span class="n">cxt5051_init_mic_port</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="n">CXT5051_PORTC_EVENT</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cxt5051_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="n">cxt5051_portb_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="n">cxt5051_portc_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CXT5051_LAPTOP</span><span class="p">,</span>	 <span class="cm">/* Laptops w/ EAPD support */</span>
	<span class="n">CXT5051_HP</span><span class="p">,</span>	<span class="cm">/* no docking */</span>
	<span class="n">CXT5051_HP_DV6736</span><span class="p">,</span>	<span class="cm">/* HP without mic switch */</span>
	<span class="n">CXT5051_F700</span><span class="p">,</span>       <span class="cm">/* HP Compaq Presario F700 */</span>
	<span class="n">CXT5051_TOSHIBA</span><span class="p">,</span>	<span class="cm">/* Toshiba M300 &amp; co */</span>
	<span class="n">CXT5051_IDEAPAD</span><span class="p">,</span>	<span class="cm">/* Lenovo IdeaPad Y430 */</span>
	<span class="n">CXT5051_AUTO</span><span class="p">,</span>		<span class="cm">/* auto-parser */</span>
	<span class="n">CXT5051_MODELS</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="k">const</span> <span class="n">cxt5051_models</span><span class="p">[</span><span class="n">CXT5051_MODELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">CXT5051_LAPTOP</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5051_HP</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;hp&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5051_HP_DV6736</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;hp-dv6736&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5051_F700</span><span class="p">]</span>          <span class="o">=</span> <span class="s">&quot;hp-700&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5051_TOSHIBA</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;toshiba&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5051_IDEAPAD</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;ideapad&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5051_AUTO</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">cxt5051_cfg_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x30cf</span><span class="p">,</span> <span class="s">&quot;HP DV6736&quot;</span><span class="p">,</span> <span class="n">CXT5051_HP_DV6736</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x360b</span><span class="p">,</span> <span class="s">&quot;Compaq Presario CQ60&quot;</span><span class="p">,</span> <span class="n">CXT5051_HP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x30ea</span><span class="p">,</span> <span class="s">&quot;Compaq Presario F700&quot;</span><span class="p">,</span> <span class="n">CXT5051_F700</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1179</span><span class="p">,</span> <span class="mh">0xff50</span><span class="p">,</span> <span class="s">&quot;Toshiba M30x&quot;</span><span class="p">,</span> <span class="n">CXT5051_TOSHIBA</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x14f1</span><span class="p">,</span> <span class="mh">0x0101</span><span class="p">,</span> <span class="s">&quot;Conexant Reference board&quot;</span><span class="p">,</span>
		      <span class="n">CXT5051_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x14f1</span><span class="p">,</span> <span class="mh">0x5051</span><span class="p">,</span> <span class="s">&quot;HP Spartan 1.1&quot;</span><span class="p">,</span> <span class="n">CXT5051_HP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x3a0d</span><span class="p">,</span> <span class="s">&quot;Lenovo IdeaPad&quot;</span><span class="p">,</span> <span class="n">CXT5051_IDEAPAD</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_cxt5051</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">board_config</span><span class="p">;</span>

	<span class="n">board_config</span> <span class="o">=</span> <span class="n">snd_hda_check_board_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">CXT5051_MODELS</span><span class="p">,</span>
						  <span class="n">cxt5051_models</span><span class="p">,</span>
						  <span class="n">cxt5051_cfg_tbl</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">board_config</span> <span class="o">=</span> <span class="n">CXT5051_AUTO</span><span class="p">;</span> <span class="cm">/* model=auto as default */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">==</span> <span class="n">CXT5051_AUTO</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">patch_conexant_auto</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">pin_amp_workaround</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">conexant_patch_ops</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5051_init</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cxt5051_dac_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">cxt5051_dac_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">CXT5051_SPDIF_OUT</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* not 2; via auto-mic switch */</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">cxt5051_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5051_capture_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5051_playback_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5051_init_verbs</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cxt5051_modes</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span> <span class="o">=</span> <span class="n">cxt5051_modes</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5051_hp_unsol_event</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span> <span class="o">=</span> <span class="n">AUTO_MIC_PORTB</span> <span class="o">|</span> <span class="n">AUTO_MIC_PORTC</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CXT5051_HP</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5051_hp_mixers</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5051_HP_DV6736</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5051_hp_dv6736_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5051_hp_dv6736_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5051_F700</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5051_f700_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5051_f700_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5051_TOSHIBA</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5051_toshiba_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span> <span class="o">=</span> <span class="n">AUTO_MIC_PORTB</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5051_IDEAPAD</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">cxt5051_ideapad_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">ideapad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">)</span>
		<span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Conexant 5066 specific */</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5066_dac_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x10</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5066_adc_nids</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x16</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5066_capsrc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x17</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cxt5066_digout_pin_nids</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x22</span> <span class="p">};</span>

<span class="cm">/* OLPC&#39;s microphone port is DC coupled for use with external sensors,</span>
<span class="cm"> * therefore we use a 50% mic bias in order to center the input signal with</span>
<span class="cm"> * the DC input range of the codec. */</span>
<span class="cp">#define CXT5066_OLPC_EXT_MIC_BIAS PIN_VREF50</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_channel_mode</span> <span class="n">cxt5066_modes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cp">#define HP_PRESENT_PORT_A	(1 &lt;&lt; 0)</span>
<span class="cp">#define HP_PRESENT_PORT_D	(1 &lt;&lt; 1)</span>
<span class="cp">#define hp_port_a_present(spec)	((spec)-&gt;hp_present &amp; HP_PRESENT_PORT_A)</span>
<span class="cp">#define hp_port_d_present(spec)	((spec)-&gt;hp_present &amp; HP_PRESENT_PORT_D)</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_update_speaker</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pinctl</span><span class="p">;</span>

	<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: update speaker, hp_present=%d, cur_eapd=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">);</span>

	<span class="cm">/* Port A (HP) */</span>
	<span class="n">pinctl</span> <span class="o">=</span> <span class="p">(</span><span class="n">hp_port_a_present</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">)</span> <span class="o">?</span> <span class="n">PIN_HP</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="n">pinctl</span><span class="p">);</span>

	<span class="cm">/* Port D (HP/LO) */</span>
	<span class="n">pinctl</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span> <span class="o">?</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">port_d_mode</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dell_automute</span> <span class="o">||</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">thinkpad</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Mute if Port A is connected */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hp_port_a_present</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
			<span class="n">pinctl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* Thinkpad/Dell doesn&#39;t give pin-D status */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hp_port_d_present</span><span class="p">(</span><span class="n">spec</span><span class="p">))</span>
			<span class="n">pinctl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="n">pinctl</span><span class="p">);</span>

	<span class="cm">/* CLASS_D AMP */</span>
	<span class="n">pinctl</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">)</span> <span class="o">?</span> <span class="n">PIN_OUT</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="n">pinctl</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* turn on/off EAPD (+ mute HP) as a master switch */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_hp_master_sw_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cxt_eapd_put</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">cxt5066_update_speaker</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">cxt5066_olpc_dc_bias</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Off&quot;</span><span class="p">,</span> <span class="n">PIN_IN</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;50%&quot;</span><span class="p">,</span> <span class="n">PIN_VREF50</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;80%&quot;</span><span class="p">,</span> <span class="n">PIN_VREF80</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_set_olpc_dc_bias</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="cm">/* Even though port F is the DC input, the bias is controlled on port B.</span>
<span class="cm">	 * we also leave that port as an active input (but unselected) in DC mode</span>
<span class="cm">	 * just in case that is necessary to make the bias setting take effect. */</span>
	<span class="k">return</span> <span class="n">snd_hda_set_pin_ctl_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span>
		<span class="n">cxt5066_olpc_dc_bias</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_input_bias</span><span class="p">].</span><span class="n">index</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* OLPC defers mic widget control until when capture is started because the</span>
<span class="cm"> * microphone LED comes on as soon as these settings are put in place. if we</span>
<span class="cm"> * did this before recording, it would give the false indication that recording</span>
<span class="cm"> * is happening when it is not. */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_olpc_select_mic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">recording</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_enable</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* in DC mode we ignore presence detection and just use the jack</span>
<span class="cm">		 * through our special DC port */</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">enable_dc_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="cm">/* disble internal mic, port C */</span>
			<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

			<span class="cm">/* enable DC capture, port F */</span>
			<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
			<span class="p">{},</span>
		<span class="p">};</span>

		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">enable_dc_mode</span><span class="p">);</span>
		<span class="cm">/* port B input disabled (and bias set) through the following call */</span>
		<span class="n">cxt5066_set_olpc_dc_bias</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* disable DC (port F) */</span>
	<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* external mic, port B */</span>
	<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">ext_mic_present</span> <span class="o">?</span> <span class="n">CXT5066_OLPC_EXT_MIC_BIAS</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* internal mic, port C */</span>
	<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">ext_mic_present</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">PIN_VREF80</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* toggle input of built-in and mic jack appropriately */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_olpc_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_enable</span><span class="p">)</span> <span class="cm">/* don&#39;t do presence detection in DC mode */</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				     <span class="n">AC_VERB_GET_PIN_SENSE</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">present</span><span class="p">)</span>
		<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: external microphone detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: external microphone absent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span>
		<span class="n">present</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">ext_mic_present</span> <span class="o">=</span> <span class="o">!!</span><span class="n">present</span><span class="p">;</span>

	<span class="n">cxt5066_olpc_select_mic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* toggle input of built-in digital mic and mic jack appropriately */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_vostro_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ext_mic_present</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* enable external mic, port B */</span>
		<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>

		<span class="cm">/* switch to external mic input */</span>
		<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

		<span class="cm">/* disable internal digital mic */</span>
		<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ext_mic_absent</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* enable internal mic, port C */</span>
		<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>

		<span class="cm">/* switch to internal mic input */</span>
		<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>

		<span class="cm">/* disable external mic, port B */</span>
		<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">present</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: external microphone detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ext_mic_present</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: external microphone absent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ext_mic_absent</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* toggle input of built-in digital mic and mic jack appropriately */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_ideapad_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ext_mic_present</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ext_mic_absent</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">present</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: external microphone detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ext_mic_present</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: external microphone absent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ext_mic_absent</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="cm">/* toggle input of built-in digital mic and mic jack appropriately */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_asus_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">);</span>
	<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: external microphone present=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">present</span><span class="p">);</span>
	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span>
			    <span class="n">present</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* toggle input of built-in digital mic and mic jack appropriately */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_hp_laptop_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">);</span>
	<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: external microphone present=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">present</span><span class="p">);</span>
	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span>
			    <span class="n">present</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* toggle input of built-in digital mic and mic jack appropriately</span>
<span class="cm">   order is: external mic -&gt; dock mic -&gt; interal mic */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_thinkpad_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ext_present</span><span class="p">,</span> <span class="n">dock_present</span><span class="p">;</span>

	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ext_mic_present</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">dock_mic_present</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ext_mic_absent</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>

	<span class="n">ext_present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">);</span>
	<span class="n">dock_present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ext_present</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: external microphone detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ext_mic_present</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dock_present</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: dock microphone detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">dock_mic_present</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: external microphone absent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ext_mic_absent</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* mute internal speaker if HP is plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_hp_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">portA</span><span class="p">,</span> <span class="n">portD</span><span class="p">;</span>

	<span class="cm">/* Port A */</span>
	<span class="n">portA</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>

	<span class="cm">/* Port D */</span>
	<span class="n">portD</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">);</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">=</span> <span class="n">portA</span> <span class="o">?</span> <span class="n">HP_PRESENT_PORT_A</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">|=</span> <span class="n">portD</span> <span class="o">?</span> <span class="n">HP_PRESENT_PORT_D</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: hp automute portA=%x portD=%x present=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">portA</span><span class="p">,</span> <span class="n">portD</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span><span class="p">);</span>
	<span class="n">cxt5066_update_speaker</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Dispatch the right mic autoswitch function */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dell_vostro</span><span class="p">)</span>
		<span class="n">cxt5066_vostro_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">ideapad</span><span class="p">)</span>
		<span class="n">cxt5066_ideapad_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">thinkpad</span><span class="p">)</span>
		<span class="n">cxt5066_thinkpad_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_laptop</span><span class="p">)</span>
		<span class="n">cxt5066_hp_laptop_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">asus</span><span class="p">)</span>
		<span class="n">cxt5066_asus_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* unsolicited event for jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_olpc_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: unsol event %x (%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CONEXANT_HP_EVENT</span>:
		<span class="n">cxt5066_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CONEXANT_MIC_EVENT</span>:
		<span class="cm">/* ignore mic events in DC mode; we&#39;re always using the jack */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_enable</span><span class="p">)</span>
			<span class="n">cxt5066_olpc_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* unsolicited event for jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: unsol event %x (%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CONEXANT_HP_EVENT</span>:
		<span class="n">cxt5066_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CONEXANT_MIC_EVENT</span>:
		<span class="n">cxt5066_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">cxt5066_analog_mic_boost</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;0dB&quot;</span><span class="p">,</span>  <span class="mi">0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;10dB&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;20dB&quot;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;30dB&quot;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;40dB&quot;</span><span class="p">,</span> <span class="mi">4</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_set_mic_boost</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
		<span class="n">AC_AMP_SET_RIGHT</span> <span class="o">|</span> <span class="n">AC_AMP_SET_LEFT</span> <span class="o">|</span> <span class="n">AC_AMP_SET_OUTPUT</span> <span class="o">|</span>
			<span class="n">cxt5066_analog_mic_boost</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">mic_boost</span><span class="p">].</span><span class="n">index</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">ideapad</span> <span class="o">||</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">thinkpad</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* adjust the internal mic as well...it is not through 0x17 */</span>
		<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
			<span class="n">AC_AMP_SET_RIGHT</span> <span class="o">|</span> <span class="n">AC_AMP_SET_LEFT</span> <span class="o">|</span> <span class="n">AC_AMP_SET_INPUT</span> <span class="o">|</span>
				<span class="n">cxt5066_analog_mic_boost</span><span class="p">.</span>
					<span class="n">items</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">mic_boost</span><span class="p">].</span><span class="n">index</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_mic_boost_mux_enum_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">snd_hda_input_mux_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cxt5066_analog_mic_boost</span><span class="p">,</span> <span class="n">uinfo</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_mic_boost_mux_enum_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">mic_boost</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_mic_boost_mux_enum_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="o">*</span><span class="n">imux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5066_analog_mic_boost</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>
	<span class="n">idx</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">)</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mic_boost</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_enable</span><span class="p">)</span>
		<span class="n">cxt5066_set_mic_boost</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_enable_dc</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">enable_dc_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* disable gain */</span>
		<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>

		<span class="cm">/* switch to DC input */</span>
		<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>

	<span class="cm">/* configure as input source */</span>
	<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">enable_dc_mode</span><span class="p">);</span>
	<span class="n">cxt5066_olpc_select_mic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span> <span class="cm">/* also sets configured bias */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_disable_dc</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* reconfigure input source */</span>
	<span class="n">cxt5066_set_mic_boost</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="cm">/* automic also selects the right mic if we&#39;re recording */</span>
	<span class="n">cxt5066_olpc_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_olpc_dc_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_enable</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_olpc_dc_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dc_enable</span> <span class="o">=</span> <span class="o">!!</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dc_enable</span> <span class="o">==</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_enable</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_enable</span> <span class="o">=</span> <span class="n">dc_enable</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dc_enable</span><span class="p">)</span>
		<span class="n">cxt5066_enable_dc</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">cxt5066_disable_dc</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_olpc_dc_bias_enum_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">snd_hda_input_mux_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cxt5066_olpc_dc_bias</span><span class="p">,</span> <span class="n">uinfo</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_olpc_dc_bias_enum_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_input_bias</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_olpc_dc_bias_enum_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="o">*</span><span class="n">imux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5066_analog_mic_boost</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>

	<span class="n">idx</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">)</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_input_bias</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_enable</span><span class="p">)</span>
		<span class="n">cxt5066_set_olpc_dc_bias</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_olpc_capture_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="cm">/* mark as recording and configure the microphone widget so that the</span>
<span class="cm">	 * recording LED comes on. */</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">recording</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">cxt5066_olpc_select_mic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt5066_olpc_capture_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">disable_mics</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* disable external mic, port B */</span>
		<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

		<span class="cm">/* disble internal mic, port C */</span>
		<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

		<span class="cm">/* disable DC capture, port F */</span>
		<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
		<span class="p">{},</span>
	<span class="p">};</span>

	<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">disable_mics</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">recording</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">conexant_check_dig_outs</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				    <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">dig_pins</span><span class="p">,</span>
				    <span class="kt">int</span> <span class="n">num_pins</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">nid_loc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_pins</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">dig_pins</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cfg</span> <span class="o">=</span> <span class="n">snd_hda_codec_get_pincfg</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">*</span><span class="n">dig_pins</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">get_defcfg_connect</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span> <span class="o">==</span> <span class="n">AC_JACK_PORT_NONE</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">snd_hda_get_connections</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">*</span><span class="n">dig_pins</span><span class="p">,</span> <span class="n">nid_loc</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_dig_outs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">nid_loc</span><span class="o">++</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">nid_loc</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_dig_outs</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">cxt5066_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic B&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mic C&quot;</span><span class="p">,</span> <span class="mi">1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mic E&quot;</span><span class="p">,</span> <span class="mi">2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mic F&quot;</span><span class="p">,</span> <span class="mi">3</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_bind_ctls</span> <span class="n">cxt5066_bind_capture_vol_others</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">snd_hda_bind_vol</span><span class="p">,</span>
	<span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x14</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x14</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
		<span class="mi">0</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_bind_ctls</span> <span class="n">cxt5066_bind_capture_sw_others</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">snd_hda_bind_sw</span><span class="p">,</span>
	<span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x14</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x14</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
		<span class="mi">0</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5066_mixer_master</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5066_mixer_master_olpc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">access</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span> <span class="o">|</span>
				  <span class="n">SNDRV_CTL_ELEM_ACCESS_TLV_READ</span> <span class="o">|</span>
				  <span class="n">SNDRV_CTL_ELEM_ACCESS_TLV_CALLBACK</span><span class="p">,</span>
		<span class="p">.</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_AMP_FLAG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_volume_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_volume_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_volume_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tlv</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_tlv</span> <span class="p">},</span>
		<span class="cm">/* offset by 28 volume steps to limit minimum gain to -46dB */</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span>
			<span class="n">HDA_COMPOSE_AMP_VAL_OFS</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span>
	<span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5066_mixer_olpc_dc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;DC Mode Enable Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_ctl_boolean_mono_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cxt5066_olpc_dc_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cxt5066_olpc_dc_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;DC Input Bias Enum&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">cxt5066_olpc_dc_bias_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cxt5066_olpc_dc_bias_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cxt5066_olpc_dc_bias_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5066_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">cxt_eapd_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cxt_eapd_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cxt5066_hp_master_sw_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mh">0x1d</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Analog Mic Boost Capture Enum&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">cxt5066_mic_boost_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cxt5066_mic_boost_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cxt5066_mic_boost_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="n">HDA_BIND_VOL</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxt5066_bind_capture_vol_others</span><span class="p">),</span>
	<span class="n">HDA_BIND_SW</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxt5066_bind_capture_sw_others</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cxt5066_vostro_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Internal Mic Boost Capture Enum&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">cxt5066_mic_boost_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cxt5066_mic_boost_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cxt5066_mic_boost_mux_enum_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mh">0x23</span> <span class="o">|</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5066_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span> <span class="cm">/* Port B */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span> <span class="cm">/* Port C */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span> <span class="cm">/* Port F */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span> <span class="cm">/* Port E */</span>

	<span class="cm">/* Speakers  */</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* HP, Amp  */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* DAC1 */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>

	<span class="cm">/* Node 14 connections: 0x17 0x18 0x23 0x24 0x27 */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x50</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x50</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>

	<span class="cm">/* no digital microphone support yet */</span>
	<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Audio input selector */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x3</span><span class="p">},</span>

	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>

	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>

	<span class="cm">/* EAPD */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">},</span> <span class="cm">/* default on */</span>

	<span class="cm">/* not handling these yet */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5066_init_verbs_olpc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Port A: headphones */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* Port B: external microphone */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Port C: internal microphone */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Port D: unused */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Port E: unused, but has primary EAPD */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">},</span> <span class="cm">/* default on */</span>

	<span class="cm">/* Port F: external DC input through microphone port */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Port G: internal speakers */</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* DAC1 */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>

	<span class="cm">/* DAC2: unused */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>

	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x50</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>

	<span class="cm">/* Disable digital microphone port */</span>
	<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Audio input selectors */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x3</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span> <span class="p">},</span>

	<span class="cm">/* Disable SPDIF */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* enable unsolicited events for Port A and B */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5066_init_verbs_vostro</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Port A: headphones */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* Port B: external microphone */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Port C: unused */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Port D: unused */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Port E: unused, but has primary EAPD */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">},</span> <span class="cm">/* default on */</span>

	<span class="cm">/* Port F: unused */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Port G: internal speakers */</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* DAC1 */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>

	<span class="cm">/* DAC2: unused */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>

	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>

	<span class="cm">/* Digital microphone port */</span>
	<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>

	<span class="cm">/* Audio input selectors */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x3</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span> <span class="p">},</span>

	<span class="cm">/* Disable SPDIF */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* enable unsolicited events for Port A and B */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5066_init_verbs_ideapad</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span> <span class="cm">/* Port B */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span> <span class="cm">/* Port C */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span> <span class="cm">/* Port F */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span> <span class="cm">/* Port E */</span>

	<span class="cm">/* Speakers  */</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* HP, Amp  */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* DAC1 */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>

	<span class="cm">/* Node 14 connections: 0x17 0x18 0x23 0x24 0x27 */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x50</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x50</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>	<span class="cm">/* default to internal mic */</span>

	<span class="cm">/* Audio input selector */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x2</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>	<span class="cm">/* route ext mic */</span>

	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>

	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>

	<span class="cm">/* internal microphone */</span>
	<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span> <span class="cm">/* enable internal mic */</span>

	<span class="cm">/* EAPD */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">},</span> <span class="cm">/* default on */</span>

	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5066_init_verbs_thinkpad</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span> <span class="cm">/* Port F */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span> <span class="cm">/* Port E */</span>

	<span class="cm">/* Port G: internal speakers  */</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* Port A: HP, Amp  */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* Port B: Mic Dock */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Port C: Mic */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>

	<span class="cm">/* Port D: HP Dock, Amp */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC1 */</span>

	<span class="cm">/* DAC1 */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>

	<span class="cm">/* Node 14 connections: 0x17 0x18 0x23 0x24 0x27 */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x50</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x50</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">2</span><span class="p">},</span>	<span class="cm">/* default to internal mic */</span>

	<span class="cm">/* Audio input selector */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x2</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span>	<span class="cm">/* route ext mic */</span>

	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>

	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>

	<span class="cm">/* internal microphone */</span>
	<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span> <span class="cm">/* enable internal mic */</span>

	<span class="cm">/* EAPD */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x2</span><span class="p">},</span> <span class="cm">/* default on */</span>

	<span class="cm">/* enable unsolicited events for Port A, B, C and D */</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5066_init_verbs_portd_lo</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>


<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">cxt5066_init_verbs_hp_laptop</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">CONEXANT_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* initialize jack-sensing, too */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: init</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">conexant_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cxt5066_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="n">cxt5066_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">cxt5066_set_mic_boost</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cxt5066_olpc_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;CXT5066: init</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">conexant_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">cxt5066_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dc_enable</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cxt5066_set_mic_boost</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="n">cxt5066_olpc_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">cxt5066_enable_dc</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CXT5066_LAPTOP</span><span class="p">,</span>		<span class="cm">/* Laptops w/ EAPD support */</span>
	<span class="n">CXT5066_DELL_LAPTOP</span><span class="p">,</span>	<span class="cm">/* Dell Laptop */</span>
	<span class="n">CXT5066_OLPC_XO_1_5</span><span class="p">,</span>	<span class="cm">/* OLPC XO 1.5 */</span>
	<span class="n">CXT5066_DELL_VOSTRO</span><span class="p">,</span>	<span class="cm">/* Dell Vostro 1015i */</span>
	<span class="n">CXT5066_IDEAPAD</span><span class="p">,</span>	<span class="cm">/* Lenovo IdeaPad U150 */</span>
	<span class="n">CXT5066_THINKPAD</span><span class="p">,</span>	<span class="cm">/* Lenovo ThinkPad T410s, others? */</span>
	<span class="n">CXT5066_ASUS</span><span class="p">,</span>		<span class="cm">/* Asus K52JU, Lenovo G560 - Int mic at 0x1a and Ext mic at 0x1b */</span>
	<span class="n">CXT5066_HP_LAPTOP</span><span class="p">,</span>      <span class="cm">/* HP Laptop */</span>
	<span class="n">CXT5066_AUTO</span><span class="p">,</span>		<span class="cm">/* BIOS auto-parser */</span>
	<span class="n">CXT5066_MODELS</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">cxt5066_models</span><span class="p">[</span><span class="n">CXT5066_MODELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">CXT5066_LAPTOP</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5066_DELL_LAPTOP</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;dell-laptop&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5066_OLPC_XO_1_5</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;olpc-xo-1_5&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5066_DELL_VOSTRO</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;dell-vostro&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5066_IDEAPAD</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;ideapad&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5066_THINKPAD</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;thinkpad&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5066_ASUS</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;asus&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5066_HP_LAPTOP</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;hp-laptop&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">CXT5066_AUTO</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">cxt5066_cfg_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1025</span><span class="p">,</span> <span class="mh">0x054c</span><span class="p">,</span> <span class="s">&quot;Acer Aspire 3830TG&quot;</span><span class="p">,</span> <span class="n">CXT5066_AUTO</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK_MASK</span><span class="p">(</span><span class="mh">0x1025</span><span class="p">,</span> <span class="mh">0xff00</span><span class="p">,</span> <span class="mh">0x0400</span><span class="p">,</span> <span class="s">&quot;Acer&quot;</span><span class="p">,</span> <span class="n">CXT5066_IDEAPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1028</span><span class="p">,</span> <span class="mh">0x02d8</span><span class="p">,</span> <span class="s">&quot;Dell Vostro&quot;</span><span class="p">,</span> <span class="n">CXT5066_DELL_VOSTRO</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1028</span><span class="p">,</span> <span class="mh">0x02f5</span><span class="p">,</span> <span class="s">&quot;Dell Vostro 320&quot;</span><span class="p">,</span> <span class="n">CXT5066_IDEAPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1028</span><span class="p">,</span> <span class="mh">0x0401</span><span class="p">,</span> <span class="s">&quot;Dell Vostro 1014&quot;</span><span class="p">,</span> <span class="n">CXT5066_DELL_VOSTRO</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1028</span><span class="p">,</span> <span class="mh">0x0402</span><span class="p">,</span> <span class="s">&quot;Dell Vostro&quot;</span><span class="p">,</span> <span class="n">CXT5066_DELL_VOSTRO</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1028</span><span class="p">,</span> <span class="mh">0x0408</span><span class="p">,</span> <span class="s">&quot;Dell Inspiron One 19T&quot;</span><span class="p">,</span> <span class="n">CXT5066_IDEAPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1028</span><span class="p">,</span> <span class="mh">0x050f</span><span class="p">,</span> <span class="s">&quot;Dell Inspiron&quot;</span><span class="p">,</span> <span class="n">CXT5066_IDEAPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1028</span><span class="p">,</span> <span class="mh">0x0510</span><span class="p">,</span> <span class="s">&quot;Dell Vostro&quot;</span><span class="p">,</span> <span class="n">CXT5066_IDEAPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x360b</span><span class="p">,</span> <span class="s">&quot;HP G60&quot;</span><span class="p">,</span> <span class="n">CXT5066_HP_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x13f3</span><span class="p">,</span> <span class="s">&quot;Asus A52J&quot;</span><span class="p">,</span> <span class="n">CXT5066_ASUS</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x1643</span><span class="p">,</span> <span class="s">&quot;Asus K52JU&quot;</span><span class="p">,</span> <span class="n">CXT5066_ASUS</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x1993</span><span class="p">,</span> <span class="s">&quot;Asus U50F&quot;</span><span class="p">,</span> <span class="n">CXT5066_ASUS</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1179</span><span class="p">,</span> <span class="mh">0xff1e</span><span class="p">,</span> <span class="s">&quot;Toshiba Satellite C650D&quot;</span><span class="p">,</span> <span class="n">CXT5066_IDEAPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1179</span><span class="p">,</span> <span class="mh">0xff50</span><span class="p">,</span> <span class="s">&quot;Toshiba Satellite P500-PSPGSC-01800T&quot;</span><span class="p">,</span> <span class="n">CXT5066_OLPC_XO_1_5</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x14f1</span><span class="p">,</span> <span class="mh">0x0101</span><span class="p">,</span> <span class="s">&quot;Conexant Reference board&quot;</span><span class="p">,</span>
		      <span class="n">CXT5066_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x152d</span><span class="p">,</span> <span class="mh">0x0833</span><span class="p">,</span> <span class="s">&quot;OLPC XO-1.5&quot;</span><span class="p">,</span> <span class="n">CXT5066_OLPC_XO_1_5</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x20f2</span><span class="p">,</span> <span class="s">&quot;Lenovo T400s&quot;</span><span class="p">,</span> <span class="n">CXT5066_THINKPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x21c5</span><span class="p">,</span> <span class="s">&quot;Thinkpad Edge 13&quot;</span><span class="p">,</span> <span class="n">CXT5066_THINKPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x21c6</span><span class="p">,</span> <span class="s">&quot;Thinkpad Edge 13&quot;</span><span class="p">,</span> <span class="n">CXT5066_ASUS</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x215e</span><span class="p">,</span> <span class="s">&quot;Lenovo T510&quot;</span><span class="p">,</span> <span class="n">CXT5066_AUTO</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x21cf</span><span class="p">,</span> <span class="s">&quot;Lenovo T520 &amp; W520&quot;</span><span class="p">,</span> <span class="n">CXT5066_AUTO</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x21da</span><span class="p">,</span> <span class="s">&quot;Lenovo X220&quot;</span><span class="p">,</span> <span class="n">CXT5066_THINKPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x21db</span><span class="p">,</span> <span class="s">&quot;Lenovo X220-tablet&quot;</span><span class="p">,</span> <span class="n">CXT5066_THINKPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x3a0d</span><span class="p">,</span> <span class="s">&quot;Lenovo U350&quot;</span><span class="p">,</span> <span class="n">CXT5066_ASUS</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x38af</span><span class="p">,</span> <span class="s">&quot;Lenovo G560&quot;</span><span class="p">,</span> <span class="n">CXT5066_ASUS</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x3938</span><span class="p">,</span> <span class="s">&quot;Lenovo G565&quot;</span><span class="p">,</span> <span class="n">CXT5066_AUTO</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1b0a</span><span class="p">,</span> <span class="mh">0x2092</span><span class="p">,</span> <span class="s">&quot;CyberpowerPC Gamer Xplorer N57001&quot;</span><span class="p">,</span> <span class="n">CXT5066_AUTO</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_cxt5066</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">board_config</span><span class="p">;</span>

	<span class="n">board_config</span> <span class="o">=</span> <span class="n">snd_hda_check_board_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">CXT5066_MODELS</span><span class="p">,</span>
						  <span class="n">cxt5066_models</span><span class="p">,</span> <span class="n">cxt5066_cfg_tbl</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">board_config</span> <span class="o">=</span> <span class="n">CXT5066_AUTO</span><span class="p">;</span> <span class="cm">/* model=auto as default */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">==</span> <span class="n">CXT5066_AUTO</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">patch_conexant_auto</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">conexant_patch_ops</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">conexant_init</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dell_automute</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cxt5066_dac_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">cxt5066_dac_nids</span><span class="p">;</span>
	<span class="n">conexant_check_dig_outs</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cxt5066_digout_pin_nids</span><span class="p">,</span>
	    <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cxt5066_digout_pin_nids</span><span class="p">));</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">cxt5066_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span> <span class="o">=</span> <span class="n">cxt5066_capsrc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxt5066_capture_source</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">port_d_mode</span> <span class="o">=</span> <span class="n">PIN_HP</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_init_verbs</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cxt5066_modes</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span> <span class="o">=</span> <span class="n">cxt5066_modes</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="nl">default:</span>
	<span class="k">case</span> <span class="n">CXT5066_LAPTOP</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixer_master</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixers</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5066_DELL_LAPTOP</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixer_master</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixers</span><span class="p">;</span>

		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">port_d_mode</span> <span class="o">=</span> <span class="n">PIN_OUT</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_init_verbs_portd_lo</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dell_automute</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5066_ASUS</span>:
	<span class="k">case</span> <span class="n">CXT5066_HP_LAPTOP</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5066_init</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5066_unsol_event</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">cxt5066_init_verbs_hp_laptop</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_laptop</span> <span class="o">=</span> <span class="n">board_config</span> <span class="o">==</span> <span class="n">CXT5066_HP_LAPTOP</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">asus</span> <span class="o">=</span> <span class="n">board_config</span> <span class="o">==</span> <span class="n">CXT5066_ASUS</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixer_master</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixers</span><span class="p">;</span>
		<span class="cm">/* no S/PDIF out */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">==</span> <span class="n">CXT5066_HP_LAPTOP</span><span class="p">)</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="cm">/* input source automatically selected */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">port_d_mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mic_boost</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="cm">/* default 30dB gain */</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">CXT5066_OLPC_XO_1_5</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5066_olpc_init</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5066_olpc_unsol_event</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_init_verbs_olpc</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixer_master_olpc</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixer_olpc_dc</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">port_d_mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mic_boost</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="cm">/* default 30dB gain */</span>

		<span class="cm">/* no S/PDIF out */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="cm">/* input source automatically selected */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

		<span class="cm">/* our capture hooks which allow us to turn on the microphone LED</span>
<span class="cm">		 * at the right time */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capture_prepare</span> <span class="o">=</span> <span class="n">cxt5066_olpc_capture_prepare</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capture_cleanup</span> <span class="o">=</span> <span class="n">cxt5066_olpc_capture_cleanup</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5066_DELL_VOSTRO</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5066_init</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5066_unsol_event</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_init_verbs_vostro</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixer_master_olpc</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_vostro_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">port_d_mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dell_vostro</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mic_boost</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span> <span class="cm">/* default 30dB gain */</span>

		<span class="cm">/* no S/PDIF out */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="cm">/* input source automatically selected */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5066_IDEAPAD</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5066_init</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5066_unsol_event</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixer_master</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_init_verbs_ideapad</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">port_d_mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">ideapad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mic_boost</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/* default 20dB gain */</span>

		<span class="cm">/* no S/PDIF out */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="cm">/* input source automatically selected */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CXT5066_THINKPAD</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cxt5066_init</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cxt5066_unsol_event</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixer_master</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cxt5066_init_verbs_thinkpad</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">thinkpad</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">port_d_mode</span> <span class="o">=</span> <span class="n">PIN_OUT</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mic_boost</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>	<span class="cm">/* default 20dB gain */</span>

		<span class="cm">/* no S/PDIF out */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="cm">/* input source automatically selected */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">)</span>
		<span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Automatic parser for CX20641 &amp; co</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_capture_pcm_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stream_tag</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">adc</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_mux</span><span class="p">[</span><span class="mi">0</span><span class="p">]].</span><span class="n">adc</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_switching</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">=</span> <span class="n">adc</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_stream_tag</span> <span class="o">=</span> <span class="n">stream_tag</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_format</span> <span class="o">=</span> <span class="n">format</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">snd_hda_codec_setup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">adc</span><span class="p">,</span> <span class="n">stream_tag</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_capture_pcm_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_hda_codec_cleanup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">cx_auto_pcm_analog_capture</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* fill later */</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">prepare</span> <span class="o">=</span> <span class="n">cx_auto_capture_pcm_prepare</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="n">cx_auto_capture_pcm_cleanup</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">cx_auto_adc_nids</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x14</span> <span class="p">};</span>

<span class="cp">#define get_connection_index(codec, mux, nid)\</span>
<span class="cp">	snd_hda_get_conn_index(codec, mux, nid, 0)</span>

<span class="cm">/* get an unassigned DAC from the given list.</span>
<span class="cm"> * Return the nid if found and reduce the DAC list, or return zero if</span>
<span class="cm"> * not found</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">hda_nid_t</span> <span class="nf">get_unassigned_dac</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">,</span>
				    <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">dacs</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">num_dacs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">nums</span> <span class="o">=</span> <span class="o">*</span><span class="n">num_dacs</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">get_connection_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">dacs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">dacs</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">nums</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">memmove</span><span class="p">(</span><span class="n">dacs</span><span class="p">,</span> <span class="n">dacs</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nums</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">hda_nid_t</span><span class="p">));</span>
	<span class="o">*</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">nums</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define MAX_AUTO_DACS	5</span>

<span class="cp">#define DAC_SLAVE_FLAG	0x8000	</span><span class="cm">/* filled dac is a slave */</span><span class="cp"></span>

<span class="cm">/* fill analog DAC list from the widget tree */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">fill_cx_auto_dacs</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">dacs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span> <span class="n">end_nid</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nums</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">end_nid</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">start_nid</span> <span class="o">+</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_nodes</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">nid</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">start_nid</span><span class="p">;</span> <span class="n">nid</span> <span class="o">&lt;</span> <span class="n">end_nid</span><span class="p">;</span> <span class="n">nid</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wcaps</span> <span class="o">=</span> <span class="n">get_wcaps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="n">get_wcaps_type</span><span class="p">(</span><span class="n">wcaps</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">AC_WID_AUD_OUT</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">wcaps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_DIGITAL</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">dacs</span><span class="p">[</span><span class="n">nums</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">nid</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">nums</span> <span class="o">&gt;=</span> <span class="n">MAX_AUTO_DACS</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">nums</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* fill pin_dac_pair list from the pin and dac list */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">fill_dacs_for_pins</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">pins</span><span class="p">,</span>
			      <span class="kt">int</span> <span class="n">num_pins</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">dacs</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">rest</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">pin_dac_pair</span> <span class="o">*</span><span class="n">filled</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nums</span><span class="p">,</span> 
			      <span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="n">nums</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_pins</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">nums</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">filled</span><span class="p">[</span><span class="n">nums</span><span class="p">].</span><span class="n">pin</span> <span class="o">=</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">filled</span><span class="p">[</span><span class="n">nums</span><span class="p">].</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
		<span class="n">filled</span><span class="p">[</span><span class="n">nums</span><span class="p">].</span><span class="n">dac</span> <span class="o">=</span> <span class="n">get_unassigned_dac</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dacs</span><span class="p">,</span> <span class="n">rest</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">filled</span><span class="p">[</span><span class="n">nums</span><span class="p">].</span><span class="n">dac</span><span class="p">)</span> 
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">filled</span><span class="p">[</span><span class="n">start</span><span class="p">].</span><span class="n">dac</span> <span class="o">&amp;&amp;</span> <span class="n">get_connection_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">filled</span><span class="p">[</span><span class="n">start</span><span class="p">].</span><span class="n">dac</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">filled</span><span class="p">[</span><span class="n">nums</span><span class="p">].</span><span class="n">dac</span> <span class="o">=</span> <span class="n">filled</span><span class="p">[</span><span class="n">start</span><span class="p">].</span><span class="n">dac</span> <span class="o">|</span> <span class="n">DAC_SLAVE_FLAG</span><span class="p">;</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">filled</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dac</span> <span class="o">&amp;&amp;</span> <span class="n">get_connection_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">filled</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dac</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">filled</span><span class="p">[</span><span class="n">nums</span><span class="p">].</span><span class="n">dac</span> <span class="o">=</span> <span class="n">filled</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dac</span> <span class="o">|</span> <span class="n">DAC_SLAVE_FLAG</span><span class="p">;</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">snd_printdd</span><span class="p">(</span><span class="s">&quot;Failed to find a DAC for pin 0x%x&quot;</span><span class="p">,</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">nums</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* parse analog output paths */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_parse_output</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">dacs</span><span class="p">[</span><span class="n">MAX_AUTO_DACS</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">nums</span><span class="p">,</span> <span class="n">rest</span><span class="p">;</span>

	<span class="n">rest</span> <span class="o">=</span> <span class="n">fill_cx_auto_dacs</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">dacs</span><span class="p">);</span>
	<span class="cm">/* parse all analog output pins */</span>
	<span class="n">nums</span> <span class="o">=</span> <span class="n">fill_dacs_for_pins</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">,</span>
			  <span class="n">dacs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rest</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			  <span class="n">AUTO_PIN_LINE_OUT</span><span class="p">);</span>
	<span class="n">nums</span> <span class="o">=</span> <span class="n">fill_dacs_for_pins</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_outs</span><span class="p">,</span>
			  <span class="n">dacs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rest</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">,</span> <span class="n">nums</span><span class="p">,</span>
			  <span class="n">AUTO_PIN_HP_OUT</span><span class="p">);</span>
	<span class="n">nums</span> <span class="o">=</span> <span class="n">fill_dacs_for_pins</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">speaker_pins</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">speaker_outs</span><span class="p">,</span>
			  <span class="n">dacs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rest</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">,</span> <span class="n">nums</span><span class="p">,</span>
			  <span class="n">AUTO_PIN_SPEAKER_OUT</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info_filled</span> <span class="o">=</span> <span class="n">nums</span><span class="p">;</span>
	<span class="cm">/* fill multiout struct */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">dac</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dac</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dac</span> <span class="o">||</span> <span class="p">(</span><span class="n">dac</span> <span class="o">&amp;</span> <span class="n">DAC_SLAVE_FLAG</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">AUTO_PIN_LINE_OUT</span>:
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_dac_nids</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span><span class="p">]</span> <span class="o">=</span> <span class="n">dac</span><span class="p">;</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span><span class="o">++</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">AUTO_PIN_HP_OUT</span>:
		<span class="k">case</span> <span class="n">AUTO_PIN_SPEAKER_OUT</span>:
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">hp_nid</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">hp_nid</span> <span class="o">=</span> <span class="n">dac</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">extra_out_nid</span><span class="p">);</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">extra_out_nid</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="p">{</span>
					<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">extra_out_nid</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">dac</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_dac_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_outs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">is_jack_detectable</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span> <span class="o">&amp;&amp;</span>
	    <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
	    <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_type</span> <span class="o">!=</span> <span class="n">AUTO_PIN_SPEAKER_OUT</span> <span class="o">&amp;&amp;</span>
	    <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
	    <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">speaker_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">is_jack_detectable</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
				<span class="n">spec</span><span class="o">-&gt;</span><span class="n">detect_line</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">automute_lines</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">detect_line</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_dac_nids</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">cx_auto_turn_eapd</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_pins</span><span class="p">,</span>
			      <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">pins</span><span class="p">,</span> <span class="n">bool</span> <span class="n">on</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">do_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_pins</span><span class="p">,</span>
			<span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">pins</span><span class="p">,</span> <span class="n">bool</span> <span class="n">on</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_pins</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">on</span> <span class="o">?</span> <span class="n">PIN_OUT</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">pin_eapd_ctrls</span><span class="p">)</span>
		<span class="n">cx_auto_turn_eapd</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">num_pins</span><span class="p">,</span> <span class="n">pins</span><span class="p">,</span> <span class="n">on</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">detect_jacks</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_pins</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">pins</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">present</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_pins</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">nid</span> <span class="o">=</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">nid</span> <span class="o">||</span> <span class="o">!</span><span class="n">is_jack_detectable</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">))</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="n">present</span> <span class="o">|=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">present</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* auto-mute/unmute speaker and line outs according to headphone jack */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_update_speakers</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">on</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* turn on HP EAPD when HP jacks are present */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">pin_eapd_ctrls</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span><span class="p">)</span>
			<span class="n">on</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span><span class="p">;</span>
		<span class="n">cx_auto_turn_eapd</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_outs</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">,</span> <span class="n">on</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* mute speakers in auto-mode if HP or LO jacks are plugged */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span><span class="p">)</span>
		<span class="n">on</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">||</span>
		       <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">detect_line</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">line_present</span><span class="p">));</span>
	<span class="n">do_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">speaker_outs</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">speaker_pins</span><span class="p">,</span> <span class="n">on</span><span class="p">);</span>

	<span class="cm">/* toggle line-out mutes if needed, too */</span>
	<span class="cm">/* if LO is a copy of either HP or Speaker, don&#39;t need to handle it */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span>
	    <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">speaker_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* mute LO in auto-mode when HP jack is present */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_type</span> <span class="o">==</span> <span class="n">AUTO_PIN_SPEAKER_OUT</span> <span class="o">||</span>
		    <span class="n">spec</span><span class="o">-&gt;</span><span class="n">automute_lines</span><span class="p">)</span>
			<span class="n">on</span> <span class="o">=</span> <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">on</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">do_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">,</span> <span class="n">on</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_hp_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">=</span> <span class="n">detect_jacks</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_outs</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">);</span>
	<span class="n">cx_auto_update_speakers</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_line_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span> <span class="o">||</span> <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">detect_line</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">line_present</span> <span class="o">=</span> <span class="n">detect_jacks</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">,</span>
					  <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">);</span>
	<span class="n">cx_auto_update_speakers</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_automute_mode_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">texts2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Disabled&quot;</span><span class="p">,</span> <span class="s">&quot;Enabled&quot;</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">texts3</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Disabled&quot;</span><span class="p">,</span> <span class="s">&quot;Speaker Only&quot;</span><span class="p">,</span> <span class="s">&quot;Line Out+Speaker&quot;</span>
	<span class="p">};</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">texts</span><span class="p">;</span>

	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_ENUMERATED</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">automute_hp_lo</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">texts</span> <span class="o">=</span> <span class="n">texts3</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">texts</span> <span class="o">=</span> <span class="n">texts2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">&gt;=</span> <span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span><span class="p">)</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
	       <span class="n">texts</span><span class="p">[</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_automute_mode_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">automute_lines</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">val</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_automute_mode_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">automute_lines</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">automute_lines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">automute_hp_lo</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">automute_lines</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">automute_lines</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">cx_auto_update_speakers</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cx_automute_mode_enum</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Auto-Mute Mode&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">cx_automute_mode_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cx_automute_mode_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cx_automute_mode_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_mux_enum_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">snd_hda_input_mux_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_imux</span><span class="p">,</span> <span class="n">uinfo</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_mux_enum_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_mux</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* look for the route the given pin from mux and return the index;</span>
<span class="cm"> * if do_select is set, actually select the route.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">__select_input_connection</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">mux</span><span class="p">,</span>
				     <span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">srcp</span><span class="p">,</span>
				     <span class="n">bool</span> <span class="n">do_select</span><span class="p">,</span> <span class="kt">int</span> <span class="n">depth</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hda_nid_t</span> <span class="n">conn</span><span class="p">[</span><span class="n">HDA_MAX_NUM_INPUTS</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">nums</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">get_wcaps_type</span><span class="p">(</span><span class="n">get_wcaps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mux</span><span class="p">)))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AC_WID_AUD_IN</span>:
	<span class="k">case</span> <span class="n">AC_WID_AUD_SEL</span>:
	<span class="k">case</span> <span class="n">AC_WID_AUD_MIX</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">nums</span> <span class="o">=</span> <span class="n">snd_hda_get_connections</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mux</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">conn</span><span class="p">));</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">conn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">pin</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">do_select</span><span class="p">)</span>
				<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mux</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						    <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">srcp</span><span class="p">)</span>
				<span class="o">*</span><span class="n">srcp</span> <span class="o">=</span> <span class="n">mux</span><span class="p">;</span>
			<span class="k">return</span> <span class="n">i</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="n">depth</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">depth</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">ret</span>  <span class="o">=</span> <span class="n">__select_input_connection</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">conn</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pin</span><span class="p">,</span> <span class="n">srcp</span><span class="p">,</span>
						     <span class="n">do_select</span><span class="p">,</span> <span class="n">depth</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">do_select</span><span class="p">)</span>
				<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mux</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						    <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">i</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">select_input_connection</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">mux</span><span class="p">,</span>
				   <span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__select_input_connection</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mux</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">get_input_connection</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">mux</span><span class="p">,</span>
				<span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__select_input_connection</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mux</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_mux_enum_update</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				   <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="o">*</span><span class="n">imux</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">adc</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">)</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_mux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">idx</span><span class="p">)</span>
		<span class="n">changed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">adc</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">adc</span><span class="p">;</span>
	<span class="n">select_input_connection</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">adc</span><span class="p">,</span>
				<span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">pin</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">!=</span> <span class="n">adc</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* stream is running, let&#39;s swap the current ADC */</span>
		<span class="n">__snd_hda_codec_cleanup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc</span> <span class="o">=</span> <span class="n">adc</span><span class="p">;</span>
		<span class="n">snd_hda_codec_setup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">adc</span><span class="p">,</span>
					   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_stream_tag</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_adc_format</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_mux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_mux_enum_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">cx_auto_mux_enum_update</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_imux</span><span class="p">,</span>
				       <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cx_auto_capture_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">cx_auto_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">cx_auto_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">cx_auto_mux_enum_put</span>
	<span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">select_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">bool</span> <span class="n">detect</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">detect</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">pin</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">cx_auto_mux_enum_update</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_imux</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* automatic switch internal and external mic */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">select_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic_ext</span><span class="p">,</span> <span class="nb">true</span><span class="p">))</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">select_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic_dock</span><span class="p">,</span> <span class="nb">true</span><span class="p">))</span>
			<span class="n">select_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic_int</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">snd_hda_jack_get_action</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CONEXANT_HP_EVENT</span>:
		<span class="n">cx_auto_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CONEXANT_LINE_EVENT</span>:
		<span class="n">cx_auto_line_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CONEXANT_MIC_EVENT</span>:
		<span class="n">cx_auto_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">snd_hda_jack_report_sync</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* check whether the pin config is suitable for auto-mic switching;</span>
<span class="cm"> * auto-mic is enabled only when one int-mic and one ext- and/or</span>
<span class="cm"> * one dock-mic exist</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_check_auto_mic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pset</span><span class="p">[</span><span class="n">INPUT_PIN_ATTR_NORMAL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">pset</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">pset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_imux</span><span class="p">.</span><span class="n">num_items</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">pin</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">def_conf</span> <span class="o">=</span> <span class="n">snd_hda_codec_get_pincfg</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="n">attr</span><span class="p">;</span>
		<span class="n">attr</span> <span class="o">=</span> <span class="n">snd_hda_get_input_pin_attr</span><span class="p">(</span><span class="n">def_conf</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">attr</span> <span class="o">==</span> <span class="n">INPUT_PIN_ATTR_UNUSED</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span> <span class="cm">/* invalid entry */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">attr</span> <span class="o">&gt;</span> <span class="n">INPUT_PIN_ATTR_NORMAL</span><span class="p">)</span>
			<span class="n">attr</span> <span class="o">=</span> <span class="n">INPUT_PIN_ATTR_NORMAL</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">attr</span> <span class="o">!=</span> <span class="n">INPUT_PIN_ATTR_INT</span> <span class="o">&amp;&amp;</span>
		    <span class="o">!</span><span class="n">is_jack_detectable</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">))</span>
			<span class="k">return</span><span class="p">;</span> <span class="cm">/* non-detectable pin */</span>
		<span class="n">type</span> <span class="o">=</span> <span class="n">get_defcfg_device</span><span class="p">(</span><span class="n">def_conf</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">!=</span> <span class="n">AC_JACK_MIC_IN</span> <span class="o">&amp;&amp;</span>
		    <span class="p">(</span><span class="n">attr</span> <span class="o">!=</span> <span class="n">INPUT_PIN_ATTR_DOCK</span> <span class="o">||</span> <span class="n">type</span> <span class="o">!=</span> <span class="n">AC_JACK_LINE_IN</span><span class="p">))</span>
			<span class="k">return</span><span class="p">;</span> <span class="cm">/* no valid input type */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pset</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span> <span class="cm">/* already occupied */</span>
		<span class="n">pset</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pset</span><span class="p">[</span><span class="n">INPUT_PIN_ATTR_INT</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">pset</span><span class="p">[</span><span class="n">INPUT_PIN_ATTR_NORMAL</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">pset</span><span class="p">[</span><span class="n">INPUT_PIN_ATTR_DOCK</span><span class="p">]))</span>
		<span class="k">return</span><span class="p">;</span> <span class="cm">/* no input to switch*/</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic_ext</span> <span class="o">=</span> <span class="n">pset</span><span class="p">[</span><span class="n">INPUT_PIN_ATTR_NORMAL</span><span class="p">];</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic_dock</span> <span class="o">=</span> <span class="n">pset</span><span class="p">[</span><span class="n">INPUT_PIN_ATTR_DOCK</span><span class="p">];</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic_int</span> <span class="o">=</span> <span class="n">pset</span><span class="p">[</span><span class="n">INPUT_PIN_ATTR_INT</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_parse_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="o">*</span><span class="n">imux</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

	<span class="n">imux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_imux</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">num_inputs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hda_nid_t</span> <span class="n">adc</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
			<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">get_input_connection</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">adc</span><span class="p">,</span>
						       <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">;</span>
				<span class="n">label</span> <span class="o">=</span> <span class="n">hda_get_autocfg_input_label</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
				<span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">].</span><span class="n">index</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">].</span><span class="n">boost</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">].</span><span class="n">adc</span> <span class="o">=</span> <span class="n">adc</span><span class="p">;</span>
				<span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">].</span><span class="n">pin</span> <span class="o">=</span>
					<span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">;</span>
				<span class="n">snd_hda_add_imux_item</span><span class="p">(</span><span class="n">imux</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">num_inputs</span> <span class="o">==</span> <span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">)</span>
		<span class="n">cx_auto_check_auto_mic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">adc</span> <span class="o">!=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">adc</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_switching</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* get digital-input audio widget corresponding to the given pin */</span>
<span class="k">static</span> <span class="n">hda_nid_t</span> <span class="nf">cx_auto_get_dig_in</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span> <span class="n">end_nid</span><span class="p">;</span>

	<span class="n">end_nid</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">start_nid</span> <span class="o">+</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_nodes</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">nid</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">start_nid</span><span class="p">;</span> <span class="n">nid</span> <span class="o">&lt;</span> <span class="n">end_nid</span><span class="p">;</span> <span class="n">nid</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wcaps</span> <span class="o">=</span> <span class="n">get_wcaps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="n">get_wcaps_type</span><span class="p">(</span><span class="n">wcaps</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">AC_WID_AUD_IN</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">wcaps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_DIGITAL</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">get_connection_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">pin</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">nid</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_parse_digital</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">dig_outs</span> <span class="o">&amp;&amp;</span>
	    <span class="n">snd_hda_get_connections</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">dig_out_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">nid</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">nid</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">dig_in_pin</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span> <span class="o">=</span> <span class="n">cx_auto_get_dig_in</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">dig_in_pin</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_SND_HDA_INPUT_BEEP</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_parse_beep</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span> <span class="n">end_nid</span><span class="p">;</span>

	<span class="n">end_nid</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">start_nid</span> <span class="o">+</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_nodes</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">nid</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">start_nid</span><span class="p">;</span> <span class="n">nid</span> <span class="o">&lt;</span> <span class="n">end_nid</span><span class="p">;</span> <span class="n">nid</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">get_wcaps_type</span><span class="p">(</span><span class="n">get_wcaps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">))</span> <span class="o">==</span> <span class="n">AC_WID_BEEP</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="cp">#define cx_auto_parse_beep(codec)</span>
<span class="cp">#endif</span>

<span class="cm">/* parse EAPDs */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_parse_eapd</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span> <span class="n">end_nid</span><span class="p">;</span>

	<span class="n">end_nid</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">start_nid</span> <span class="o">+</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_nodes</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">nid</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">start_nid</span><span class="p">;</span> <span class="n">nid</span> <span class="o">&lt;</span> <span class="n">end_nid</span><span class="p">;</span> <span class="n">nid</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">get_wcaps_type</span><span class="p">(</span><span class="n">get_wcaps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">))</span> <span class="o">!=</span> <span class="n">AC_WID_PIN</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">snd_hda_query_pin_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_EAPD</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">eapds</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_eapds</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">nid</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_eapds</span> <span class="o">&gt;=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">eapds</span><span class="p">))</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* NOTE: below is a wild guess; if we have more than two EAPDs,</span>
<span class="cm">	 * it&#39;s a new chip, where EAPDs are supposed to be associated to</span>
<span class="cm">	 * pins, and we can control EAPD per pin.</span>
<span class="cm">	 * OTOH, if only one or two EAPDs are found, it&#39;s an old chip,</span>
<span class="cm">	 * thus it might control over all pins.</span>
<span class="cm">	 */</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">pin_eapd_ctrls</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_eapds</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_parse_auto_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_parse_pin_def_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">cx_auto_parse_output</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">cx_auto_parse_input</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">cx_auto_parse_digital</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">cx_auto_parse_beep</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">cx_auto_parse_eapd</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_turn_eapd</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_pins</span><span class="p">,</span>
			      <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">pins</span><span class="p">,</span> <span class="n">bool</span> <span class="n">on</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_pins</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">snd_hda_query_pin_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_EAPD</span><span class="p">)</span>
			<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
					    <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span>
					    <span class="n">on</span> <span class="o">?</span> <span class="mh">0x02</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">select_connection</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">,</span>
			      <span class="n">hda_nid_t</span> <span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">get_connection_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				    <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mute_outputs</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_nids</span><span class="p">,</span>
			 <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">nids</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_nids</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">nid</span> <span class="o">=</span> <span class="n">nids</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">get_wcaps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_OUT_AMP</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">query_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">AC_AMPCAP_MUTE</span><span class="p">)</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">AMP_OUT_MUTE</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">AMP_OUT_ZERO</span><span class="p">;</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				    <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">enable_unsol_pins</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_pins</span><span class="p">,</span>
			      <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">pins</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">action</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_pins</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">snd_hda_jack_detect_enable</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">action</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">found_in_nid_list</span><span class="p">(</span><span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">list</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nums</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nums</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">nid</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* is the given NID found in any of autocfg items? */</span>
<span class="k">static</span> <span class="n">bool</span> <span class="nf">found_in_autocfg</span><span class="p">(</span><span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">found_in_nid_list</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">)</span> <span class="o">||</span>
	    <span class="n">found_in_nid_list</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_outs</span><span class="p">)</span> <span class="o">||</span>
	    <span class="n">found_in_nid_list</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">speaker_pins</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">speaker_outs</span><span class="p">)</span> <span class="o">||</span>
	    <span class="n">found_in_nid_list</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">dig_out_pins</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">dig_outs</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">num_inputs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span> <span class="o">==</span> <span class="n">nid</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">dig_in_pin</span> <span class="o">==</span> <span class="n">nid</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* clear unsol-event tags on unused pins; Conexant codecs seem to leave</span>
<span class="cm"> * invalid unsol tags by some reason</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">clear_unsol_on_unused_pins</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">init_pins</span><span class="p">.</span><span class="n">used</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">hda_pincfg</span> <span class="o">*</span><span class="n">pin</span> <span class="o">=</span> <span class="n">snd_array_elem</span><span class="p">(</span><span class="o">&amp;</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">init_pins</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">found_in_autocfg</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">pin</span><span class="o">-&gt;</span><span class="n">nid</span><span class="p">))</span>
			<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="o">-&gt;</span><span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					    <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* turn on/off EAPD according to Master switch */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_vmaster_hook</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enabled</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">enabled</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">pin_eapd_ctrls</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cx_auto_update_speakers</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">cx_auto_turn_eapd</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_eapds</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">eapds</span><span class="p">,</span> <span class="n">enabled</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_init_output</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">mute_outputs</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_outs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="n">PIN_OUT</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">snd_hda_query_pin_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span>
		    <span class="n">AC_PINCAP_HP_DRV</span><span class="p">)</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">AC_PINCTL_HP_EN</span><span class="p">;</span>
		<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">mute_outputs</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_outs</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">);</span>
	<span class="n">mute_outputs</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">);</span>
	<span class="n">mute_outputs</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">speaker_outs</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">speaker_pins</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info_filled</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dac</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">nid</span><span class="p">)</span>
			<span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nid</span> <span class="o">&amp;</span> <span class="n">DAC_SLAVE_FLAG</span><span class="p">)</span>
			<span class="n">nid</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">DAC_SLAVE_FLAG</span><span class="p">;</span>
		<span class="n">select_connection</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">enable_unsol_pins</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_outs</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">,</span>
				  <span class="n">CONEXANT_HP_EVENT</span><span class="p">);</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">hp_present</span> <span class="o">=</span> <span class="n">detect_jacks</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_outs</span><span class="p">,</span>
						<span class="n">cfg</span><span class="o">-&gt;</span><span class="n">hp_pins</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">detect_line</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">enable_unsol_pins</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">,</span>
					  <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">,</span>
					  <span class="n">CONEXANT_LINE_EVENT</span><span class="p">);</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">line_present</span> <span class="o">=</span>
				<span class="n">detect_jacks</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">,</span>
					     <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">cx_auto_update_speakers</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="cm">/* turn on all EAPDs if no individual EAPD control is available */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">pin_eapd_ctrls</span><span class="p">)</span>
		<span class="n">cx_auto_turn_eapd</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_eapds</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">eapds</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="n">clear_unsol_on_unused_pins</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_init_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">get_wcaps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_IN_AMP</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">query_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">AC_AMPCAP_MUTE</span><span class="p">)</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
				    <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">num_inputs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">pin</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="n">PIN_IN</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span> <span class="o">==</span> <span class="n">AUTO_PIN_MIC</span><span class="p">)</span>
			<span class="n">type</span> <span class="o">|=</span> <span class="n">snd_hda_get_default_vref</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">);</span>
		<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic_ext</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">snd_hda_jack_detect_enable</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span>
				<span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic_ext</span><span class="p">].</span><span class="n">pin</span><span class="p">,</span>
				<span class="n">CONEXANT_MIC_EVENT</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic_dock</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">snd_hda_jack_detect_enable</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span>
				<span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic_dock</span><span class="p">].</span><span class="n">pin</span><span class="p">,</span>
				<span class="n">CONEXANT_MIC_EVENT</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">cx_auto_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">select_input_connection</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">adc</span><span class="p">,</span>
					<span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pin</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx_auto_init_digital</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">)</span>
		<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">dig_out_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">PIN_OUT</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span><span class="p">)</span>
		<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">dig_in_pin</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_hda_gen_apply_verbs</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">cx_auto_init_output</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">cx_auto_init_input</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">cx_auto_init_digital</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">snd_hda_jack_report_sync</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">snd_hda_sync_vmaster_hook</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_mute</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_add_volume_idx</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">basename</span><span class="p">,</span>
			      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cidx</span><span class="p">,</span>
			      <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hda_dir</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amp_idx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">44</span><span class="p">];</span>
	<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">knew</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
		<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">sfx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Switch&quot;</span> <span class="p">};</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kctl</span><span class="p">;</span>
		<span class="n">knew</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="n">chs</span><span class="p">,</span> <span class="n">amp_idx</span><span class="p">,</span>
							    <span class="n">hda_dir</span><span class="p">);</span>
		<span class="n">knew</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_AMP_FLAG</span><span class="p">;</span>
		<span class="n">knew</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">index</span> <span class="o">=</span> <span class="n">cidx</span><span class="p">;</span>
		<span class="n">snprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="s">&quot;%s%s %s&quot;</span><span class="p">,</span> <span class="n">basename</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">sfx</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">kctl</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">knew</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">codec</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">kctl</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_ctl_add</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">kctl</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">query_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">hda_dir</span><span class="p">)</span> <span class="o">&amp;</span>
		      <span class="p">(</span><span class="n">AC_AMPCAP_MUTE</span> <span class="o">|</span> <span class="n">AC_AMPCAP_MIN_MUTE</span><span class="p">)))</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define cx_auto_add_volume(codec, str, dir, cidx, nid, hda_dir)		\</span>
<span class="cp">	cx_auto_add_volume_idx(codec, str, dir, cidx, nid, hda_dir, 0, 3)</span>

<span class="cp">#define cx_auto_add_pb_volume(codec, nid, str, idx)			\</span>
<span class="cp">	cx_auto_add_volume(codec, str, &quot; Playback&quot;, idx, nid, HDA_OUTPUT)</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">try_add_pb_volume</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">dac</span><span class="p">,</span>
			     <span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">caps</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dac</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">dac</span> <span class="o">&amp;</span> <span class="n">DAC_SLAVE_FLAG</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">caps</span> <span class="o">=</span> <span class="n">query_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">dac</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_AMPCAP_NUM_STEPS</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">cx_auto_add_pb_volume</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">dac</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">caps</span> <span class="o">=</span> <span class="n">query_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_AMPCAP_NUM_STEPS</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">cx_auto_add_pb_volume</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_build_output_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">err</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_line</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num_hp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">num_spk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">texts</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Front&quot;</span><span class="p">,</span> <span class="s">&quot;Surround&quot;</span><span class="p">,</span> <span class="s">&quot;CLFE&quot;</span> <span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info_filled</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">try_add_pb_volume</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">dac</span><span class="p">,</span>
					 <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pin</span><span class="p">,</span>
					 <span class="s">&quot;Master&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info_filled</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">idx</span><span class="p">,</span> <span class="n">type</span><span class="p">;</span>
		<span class="n">hda_nid_t</span> <span class="n">dac</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dac</span><span class="p">;</span>
		<span class="n">type</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">AUTO_PIN_LINE_OUT</span><span class="p">)</span>
			<span class="n">type</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">line_out_type</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">AUTO_PIN_LINE_OUT</span>:
		<span class="nl">default:</span>
			<span class="n">label</span> <span class="o">=</span> <span class="n">texts</span><span class="p">[</span><span class="n">num_line</span><span class="o">++</span><span class="p">];</span>
			<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">AUTO_PIN_HP_OUT</span>:
			<span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Headphone&quot;</span><span class="p">;</span>
			<span class="n">idx</span> <span class="o">=</span> <span class="n">num_hp</span><span class="o">++</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">AUTO_PIN_SPEAKER_OUT</span>:
			<span class="n">label</span> <span class="o">=</span> <span class="s">&quot;Speaker&quot;</span><span class="p">;</span>
			<span class="n">idx</span> <span class="o">=</span> <span class="n">num_spk</span><span class="o">++</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">try_add_pb_volume</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">dac</span><span class="p">,</span>
					<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dac_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">,</span>
					<span class="n">label</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mute</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_add_new_ctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cx_automute_mode_enum</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Returns zero if this is a normal stereo channel, and non-zero if it should</span>
<span class="cm">   be split in two independent channels.</span>
<span class="cm">   dest_label must be at least 44 characters. */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_get_rightch_label</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">,</span>
				     <span class="kt">char</span> <span class="o">*</span><span class="n">dest_label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">fixup_stereo_dmic</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">AUTO_CFG_MAX_INS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">def_conf</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span> <span class="o">!=</span> <span class="n">nid</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span> <span class="o">!=</span> <span class="n">AUTO_PIN_MIC</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">def_conf</span> <span class="o">=</span> <span class="n">snd_hda_codec_get_pincfg</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">snd_hda_get_input_pin_attr</span><span class="p">(</span><span class="n">def_conf</span><span class="p">)</span> <span class="o">!=</span> <span class="n">INPUT_PIN_ATTR_INT</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

		<span class="cm">/* Finally found the inverted internal mic! */</span>
		<span class="n">snprintf</span><span class="p">(</span><span class="n">dest_label</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="s">&quot;Inverted %s&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_add_capture_volume</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span>
				      <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pfx</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">cidx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">char</span> <span class="n">rightch_label</span><span class="p">[</span><span class="mi">44</span><span class="p">];</span>
		<span class="n">hda_nid_t</span> <span class="n">adc_nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">get_input_connection</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">adc_nid</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">single_adc_amp</span><span class="p">)</span>
			<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">cx_auto_get_rightch_label</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">rightch_label</span><span class="p">,</span> <span class="n">nid</span><span class="p">))</span> <span class="p">{</span>
			<span class="cm">/* Make two independent kcontrols for left and right */</span>
			<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="n">cx_auto_add_volume_idx</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">pfx</span><span class="p">,</span>
					      <span class="n">cidx</span><span class="p">,</span> <span class="n">adc_nid</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
			<span class="k">return</span> <span class="n">cx_auto_add_volume_idx</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">rightch_label</span><span class="p">,</span> <span class="n">pfx</span><span class="p">,</span>
						      <span class="n">cidx</span><span class="p">,</span> <span class="n">adc_nid</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">cx_auto_add_volume_idx</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">pfx</span><span class="p">,</span>
					      <span class="n">cidx</span><span class="p">,</span> <span class="n">adc_nid</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_add_boost_volume</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">,</span>
				    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cidx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">mux</span><span class="p">,</span> <span class="n">nid</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">con</span><span class="p">;</span>

	<span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">pin</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">get_wcaps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_IN_AMP</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">char</span> <span class="n">rightch_label</span><span class="p">[</span><span class="mi">44</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cx_auto_get_rightch_label</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">rightch_label</span><span class="p">,</span> <span class="n">nid</span><span class="p">))</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="n">cx_auto_add_volume_idx</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="s">&quot; Boost&quot;</span><span class="p">,</span>
							 <span class="n">cidx</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
			<span class="k">return</span> <span class="n">cx_auto_add_volume_idx</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">rightch_label</span><span class="p">,</span> <span class="s">&quot; Boost&quot;</span><span class="p">,</span>
						      <span class="n">cidx</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">cx_auto_add_volume</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="s">&quot; Boost&quot;</span><span class="p">,</span> <span class="n">cidx</span><span class="p">,</span>
					  <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">con</span> <span class="o">=</span> <span class="n">__select_input_connection</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">adc</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">mux</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">con</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">idx</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">boost</span> <span class="o">==</span> <span class="n">mux</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* already present */</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">get_wcaps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mux</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_OUT_AMP</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">idx</span><span class="p">].</span><span class="n">boost</span> <span class="o">=</span> <span class="n">mux</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">cx_auto_add_volume</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="s">&quot; Boost&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					  <span class="n">mux</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_build_input_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="o">*</span><span class="n">imux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_imux</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">prev_label</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">input_conn</span><span class="p">[</span><span class="n">HDA_MAX_NUM_INPUTS</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">cidx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">multi_connection</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">multi_connection</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cidx</span> <span class="o">=</span> <span class="n">get_input_connection</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">adc</span><span class="p">,</span>
					    <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cidx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="n">input_conn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">adc</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">single_adc_amp</span><span class="p">)</span>
			<span class="n">input_conn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">|=</span> <span class="n">cidx</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">input_conn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">input_conn</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">multi_connection</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">prev_label</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">cidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">imux</span><span class="o">-&gt;</span><span class="n">num_items</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">;</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">;</span>

		<span class="n">label</span> <span class="o">=</span> <span class="n">hda_get_autocfg_input_label</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">,</span>
						    <span class="n">spec</span><span class="o">-&gt;</span><span class="n">imux_info</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">index</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">label</span> <span class="o">==</span> <span class="n">prev_label</span><span class="p">)</span>
			<span class="n">cidx</span><span class="o">++</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">cidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">prev_label</span> <span class="o">=</span> <span class="n">label</span><span class="p">;</span>

		<span class="n">err</span> <span class="o">=</span> <span class="n">cx_auto_add_boost_volume</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">cidx</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">multi_connection</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">cx_auto_add_capture_volume</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span>
							 <span class="s">&quot;Capture&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="n">cidx</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">bool</span> <span class="n">dup_found</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">input_conn</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">input_conn</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
					<span class="n">dup_found</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dup_found</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">cx_auto_add_capture_volume</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span>
							 <span class="n">label</span><span class="p">,</span> <span class="s">&quot; Capture&quot;</span><span class="p">,</span> <span class="n">cidx</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_imux</span><span class="p">.</span><span class="n">num_items</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">auto_mic</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_add_new_ctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cx_auto_capture_mixers</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_build_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">cx_auto_build_output_controls</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">cx_auto_build_input_controls</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">conexant_build_controls</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_jack_add_kctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_mute</span><span class="p">.</span><span class="n">sw_kctl</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_mute</span><span class="p">.</span><span class="n">hook</span> <span class="o">=</span> <span class="n">cx_auto_vmaster_hook</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_add_vmaster_hook</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_mute</span><span class="p">,</span>
					       <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_mute_led</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx_auto_search_adcs</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span> <span class="n">end_nid</span><span class="p">;</span>

	<span class="n">end_nid</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">start_nid</span> <span class="o">+</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_nodes</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">nid</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">start_nid</span><span class="p">;</span> <span class="n">nid</span> <span class="o">&lt;</span> <span class="n">end_nid</span><span class="p">;</span> <span class="n">nid</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">caps</span> <span class="o">=</span> <span class="n">get_wcaps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">get_wcaps_type</span><span class="p">(</span><span class="n">caps</span><span class="p">)</span> <span class="o">!=</span> <span class="n">AC_WID_AUD_IN</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_DIGITAL</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">snd_BUG_ON</span><span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">&gt;=</span>
			       <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_adc_nids</span><span class="p">)))</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_adc_nids</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">nid</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_adc_nids</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_codec_ops</span> <span class="n">cx_auto_patch_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">build_controls</span> <span class="o">=</span> <span class="n">cx_auto_build_controls</span><span class="p">,</span>
	<span class="p">.</span><span class="n">build_pcms</span> <span class="o">=</span> <span class="n">conexant_build_pcms</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">cx_auto_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">free</span> <span class="o">=</span> <span class="n">conexant_free</span><span class="p">,</span>
	<span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">cx_auto_unsol_event</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="p">.</span><span class="n">suspend</span> <span class="o">=</span> <span class="n">conexant_suspend</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="p">.</span><span class="n">reboot_notify</span> <span class="o">=</span> <span class="n">snd_hda_shutup_pins</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * pin fix-up</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">CXT_PINCFG_LENOVO_X200</span><span class="p">,</span>
	<span class="n">CXT_PINCFG_LENOVO_TP410</span><span class="p">,</span>
	<span class="n">CXT_FIXUP_STEREO_DMIC</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cxt_fixup_stereo_dmic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				  <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_fixup</span> <span class="o">*</span><span class="n">fix</span><span class="p">,</span> <span class="kt">int</span> <span class="n">action</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">fixup_stereo_dmic</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* ThinkPad X200 &amp; co with cxt5051 */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pintbl</span> <span class="n">cxt_pincfg_lenovo_x200</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x042140ff</span> <span class="p">},</span> <span class="cm">/* HP (seq# overridden) */</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x21a11000</span> <span class="p">},</span> <span class="cm">/* dock-mic */</span>
	<span class="p">{</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x2121103f</span> <span class="p">},</span> <span class="cm">/* dock-HP */</span>
	<span class="p">{</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x21440100</span> <span class="p">},</span> <span class="cm">/* dock SPDIF out */</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="cm">/* ThinkPad 410/420/510/520, X201 &amp; co with cxt5066 */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pintbl</span> <span class="n">cxt_pincfg_lenovo_tp410</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x042110ff</span> <span class="p">},</span> <span class="cm">/* HP (seq# overridden) */</span>
	<span class="p">{</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x21a190f0</span> <span class="p">},</span> <span class="cm">/* dock-mic */</span>
	<span class="p">{</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x212140ff</span> <span class="p">},</span> <span class="cm">/* dock-HP */</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_fixup</span> <span class="n">cxt_fixups</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">CXT_PINCFG_LENOVO_X200</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">HDA_FIXUP_PINS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">pins</span> <span class="o">=</span> <span class="n">cxt_pincfg_lenovo_x200</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">CXT_PINCFG_LENOVO_TP410</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">HDA_FIXUP_PINS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">pins</span> <span class="o">=</span> <span class="n">cxt_pincfg_lenovo_tp410</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">CXT_FIXUP_STEREO_DMIC</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">HDA_FIXUP_FUNC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">v</span><span class="p">.</span><span class="n">func</span> <span class="o">=</span> <span class="n">cxt_fixup_stereo_dmic</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">cxt5051_fixups</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x20f2</span><span class="p">,</span> <span class="s">&quot;Lenovo X200&quot;</span><span class="p">,</span> <span class="n">CXT_PINCFG_LENOVO_X200</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">cxt5066_fixups</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x20f2</span><span class="p">,</span> <span class="s">&quot;Lenovo T400&quot;</span><span class="p">,</span> <span class="n">CXT_PINCFG_LENOVO_TP410</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x215e</span><span class="p">,</span> <span class="s">&quot;Lenovo T410&quot;</span><span class="p">,</span> <span class="n">CXT_PINCFG_LENOVO_TP410</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x215f</span><span class="p">,</span> <span class="s">&quot;Lenovo T510&quot;</span><span class="p">,</span> <span class="n">CXT_PINCFG_LENOVO_TP410</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x21ce</span><span class="p">,</span> <span class="s">&quot;Lenovo T420&quot;</span><span class="p">,</span> <span class="n">CXT_PINCFG_LENOVO_TP410</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x21cf</span><span class="p">,</span> <span class="s">&quot;Lenovo T520&quot;</span><span class="p">,</span> <span class="n">CXT_PINCFG_LENOVO_TP410</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x3975</span><span class="p">,</span> <span class="s">&quot;Lenovo U300s&quot;</span><span class="p">,</span> <span class="n">CXT_FIXUP_STEREO_DMIC</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x397b</span><span class="p">,</span> <span class="s">&quot;Lenovo S205&quot;</span><span class="p">,</span> <span class="n">CXT_FIXUP_STEREO_DMIC</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="cm">/* add &quot;fake&quot; mute amp-caps to DACs on cx5051 so that mixer mute switches</span>
<span class="cm"> * can be created (bko#42825)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">add_cx5051_fake_mutes</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="n">hda_nid_t</span> <span class="n">out_nids</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mi">0</span>
	<span class="p">};</span>
	<span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="n">out_nids</span><span class="p">;</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span>
		<span class="n">snd_hda_override_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span>
					  <span class="n">AC_AMPCAP_MIN_MUTE</span> <span class="o">|</span>
					  <span class="n">query_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_conexant_auto</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">conexant_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;hda_codec: %s: BIOS auto-probing.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">codec</span><span class="o">-&gt;</span><span class="n">chip_name</span><span class="p">);</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_hda_gen_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">gen</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x14f15045</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">single_adc_amp</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x14f15051</span>:
		<span class="n">add_cx5051_fake_mutes</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">pin_amp_workaround</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">snd_hda_pick_fixup</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">cxt5051_fixups</span><span class="p">,</span> <span class="n">cxt_fixups</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">pin_amp_workaround</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">snd_hda_pick_fixup</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">cxt5066_fixups</span><span class="p">,</span> <span class="n">cxt_fixups</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">snd_hda_apply_fixup</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">HDA_FIXUP_ACT_PRE_PROBE</span><span class="p">);</span>

	<span class="cm">/* Show mute-led control only on HP laptops</span>
<span class="cm">	 * This is a sort of white-list: on HP laptops, EAPD corresponds</span>
<span class="cm">	 * only to the mute-LED without actualy amp function.  Meanwhile,</span>
<span class="cm">	 * others may use EAPD really as an amp switch, so it might be</span>
<span class="cm">	 * not good to expose it blindly.</span>
<span class="cm">	 */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">subsystem_id</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x103c</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_mute_led</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">cx_auto_search_adcs</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">cx_auto_parse_auto_config</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">);</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capture_stream</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cx_auto_pcm_analog_capture</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">cx_auto_patch_ops</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">)</span>
		<span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">);</span>

	<span class="cm">/* Some laptops with Conexant chips show stalls in S3 resume,</span>
<span class="cm">	 * which falls into the single-cmd mode.</span>
<span class="cm">	 * Better to make reset, then.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">bus</span><span class="o">-&gt;</span><span class="n">sync_write</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_printd</span><span class="p">(</span><span class="s">&quot;hda_codec: &quot;</span>
			   <span class="s">&quot;Enable sync_write for stable communication</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">bus</span><span class="o">-&gt;</span><span class="n">sync_write</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">bus</span><span class="o">-&gt;</span><span class="n">allow_bus_reset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_codec_preset</span> <span class="n">snd_hda_preset_conexant</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15045</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20549 (Venice)&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_cxt5045</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15047</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20551 (Waikiki)&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_cxt5047</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15051</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20561 (Hermosa)&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_cxt5051</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15066</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20582 (Pebble)&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_cxt5066</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15067</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20583 (Pebble HSF)&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_cxt5066</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15068</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20584&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_cxt5066</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15069</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20585&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_cxt5066</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f1506c</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20588&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_cxt5066</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f1506e</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20590&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_cxt5066</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15097</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20631&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15098</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20632&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f150a1</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20641&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f150a2</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20642&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f150ab</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20651&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f150ac</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20652&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f150b8</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20664&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f150b9</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20665&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f1510f</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20751/2&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15110</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20751/2&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x14f15111</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CX20753/4&quot;</span><span class="p">,</span>
	  <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_conexant_auto</span> <span class="p">},</span>
	<span class="p">{}</span> <span class="cm">/* terminator */</span>
<span class="p">};</span>

<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15045&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15047&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15051&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15066&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15067&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15068&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15069&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f1506c&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f1506e&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15097&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15098&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f150a1&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f150a2&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f150ab&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f150ac&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f150b8&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f150b9&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f1510f&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15110&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:14f15111&quot;</span><span class="p">);</span>

<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;Conexant HD-audio codec&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">hda_codec_preset_list</span> <span class="n">conexant_list</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">preset</span> <span class="o">=</span> <span class="n">snd_hda_preset_conexant</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">patch_conexant_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">snd_hda_add_codec_preset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conexant_list</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">patch_conexant_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_hda_delete_codec_preset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">conexant_list</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">patch_conexant_init</span><span class="p">)</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">patch_conexant_exit</span><span class="p">)</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
