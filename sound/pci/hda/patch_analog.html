<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › pci › hda › patch_analog.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>patch_analog.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * HD audio interface patch for AD1882, AD1884, AD1981HD, AD1983, AD1984,</span>
<span class="cm"> *   AD1986A, AD1988</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2005-2007 Takashi Iwai &lt;tiwai@suse.de&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This driver is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *  (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This driver is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>

<span class="cp">#include &lt;sound/core.h&gt;</span>
<span class="cp">#include &quot;hda_codec.h&quot;</span>
<span class="cp">#include &quot;hda_local.h&quot;</span>
<span class="cp">#include &quot;hda_auto_parser.h&quot;</span>
<span class="cp">#include &quot;hda_beep.h&quot;</span>
<span class="cp">#include &quot;hda_jack.h&quot;</span>

<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="o">*</span><span class="n">mixers</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">num_mixers</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">beep_amp</span><span class="p">;</span>	<span class="cm">/* beep amp value, set via set_beep_amp() */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="o">*</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>	<span class="cm">/* initialization verbs</span>
<span class="cm">						 * don&#39;t forget NULL termination!</span>
<span class="cm">						 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_init_verbs</span><span class="p">;</span>

	<span class="cm">/* playback */</span>
	<span class="k">struct</span> <span class="n">hda_multi_out</span> <span class="n">multiout</span><span class="p">;</span>	<span class="cm">/* playback set-up</span>
<span class="cm">					 * max_channels, dacs must be set</span>
<span class="cm">					 * dig_out_nid and hp_nid are optional</span>
<span class="cm">					 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cur_eapd</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">need_dac_fix</span><span class="p">;</span>

	<span class="k">const</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">alt_dac_nid</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">stream_analog_alt_playback</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">independent_hp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_active_streams</span><span class="p">;</span>

	<span class="cm">/* capture */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_adc_nids</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">adc_nids</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">dig_in_nid</span><span class="p">;</span>		<span class="cm">/* digital-in NID; optional */</span>

	<span class="cm">/* capture source */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="o">*</span><span class="n">input_mux</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">capsrc_nids</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cur_mux</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="cm">/* channel model */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hda_channel_mode</span> <span class="o">*</span><span class="n">channel_mode</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_channel_mode</span><span class="p">;</span>

	<span class="cm">/* PCM information */</span>
	<span class="k">struct</span> <span class="n">hda_pcm</span> <span class="n">pcm_rec</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>	<span class="cm">/* used in alc_build_pcms() */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">spdif_route</span><span class="p">;</span>

	<span class="cm">/* dynamic controls, init_verbs and input_mux */</span>
	<span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="n">autocfg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_array</span> <span class="n">kctls</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">private_imux</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">private_dac_nids</span><span class="p">[</span><span class="n">AUTO_CFG_MAX_OUTS</span><span class="p">];</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">jack_present</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">inv_jack_detect</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span><span class="cm">/* inverted jack-detection */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">inv_eapd</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* inverted EAPD implementation */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">analog_beep</span><span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* analog beep input present */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">avoid_init_slave_vol</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="k">struct</span> <span class="n">hda_loopback_check</span> <span class="n">loopback</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="cm">/* for virtual master */</span>
	<span class="n">hda_nid_t</span> <span class="n">vmaster_nid</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">slave_vols</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">slave_sws</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * input MUX handling (common part)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_mux_enum_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">snd_hda_input_mux_info</span><span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span><span class="p">,</span> <span class="n">uinfo</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_mux_enum_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">adc_idx</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>

	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_mux</span><span class="p">[</span><span class="n">adc_idx</span><span class="p">];</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_mux_enum_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">adc_idx</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">snd_hda_input_mux_put</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">,</span>
				     <span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span><span class="p">[</span><span class="n">adc_idx</span><span class="p">],</span>
				     <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_mux</span><span class="p">[</span><span class="n">adc_idx</span><span class="p">]);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * initialization (common callbacks)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">ad_slave_pfxs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Front&quot;</span><span class="p">,</span> <span class="s">&quot;Surround&quot;</span><span class="p">,</span> <span class="s">&quot;Center&quot;</span><span class="p">,</span> <span class="s">&quot;LFE&quot;</span><span class="p">,</span> <span class="s">&quot;Side&quot;</span><span class="p">,</span>
	<span class="s">&quot;Headphone&quot;</span><span class="p">,</span> <span class="s">&quot;Mono&quot;</span><span class="p">,</span> <span class="s">&quot;Speaker&quot;</span><span class="p">,</span> <span class="s">&quot;IEC958&quot;</span><span class="p">,</span>
	<span class="nb">NULL</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">ad1988_6stack_fp_slave_pfxs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Front&quot;</span><span class="p">,</span> <span class="s">&quot;Surround&quot;</span><span class="p">,</span> <span class="s">&quot;Center&quot;</span><span class="p">,</span> <span class="s">&quot;LFE&quot;</span><span class="p">,</span> <span class="s">&quot;Side&quot;</span><span class="p">,</span> <span class="s">&quot;IEC958&quot;</span><span class="p">,</span>
	<span class="nb">NULL</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">ad198x_free_kctls</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_SND_HDA_INPUT_BEEP</span>
<span class="cm">/* additional beep mixers; the actual parameters are overwritten at build */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad_beep_mixer</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Beep Playback Volume&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_BEEP</span><span class="p">(</span><span class="s">&quot;Beep Playback Switch&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad_beep2_mixer</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Digital Beep Playback Volume&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_BEEP</span><span class="p">(</span><span class="s">&quot;Digital Beep Playback Switch&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cp">#define set_beep_amp(spec, nid, idx, dir) \</span>
<span class="cp">	((spec)-&gt;beep_amp = HDA_COMPOSE_AMP_VAL(nid, 1, idx, dir)) </span><span class="cm">/* mono */</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="cp">#define set_beep_amp(spec, nid, idx, dir) </span><span class="cm">/* NOP */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_build_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kctl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_add_new_ctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_create_spdif_out_ctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span>
						    <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">,</span>
						    <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_create_spdif_share_sw</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span>
						    <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">share_spdif</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> 
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_create_spdif_in_ctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* create beep controls if needed */</span>
<span class="cp">#ifdef CONFIG_SND_HDA_INPUT_BEEP</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="o">*</span><span class="n">knew</span><span class="p">;</span>
		<span class="n">knew</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">analog_beep</span> <span class="o">?</span> <span class="n">ad_beep2_mixer</span> <span class="o">:</span> <span class="n">ad_beep_mixer</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span> <span class="p">;</span> <span class="n">knew</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span> <span class="n">knew</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kctl</span><span class="p">;</span>
			<span class="n">kctl</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="n">knew</span><span class="p">,</span> <span class="n">codec</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">kctl</span><span class="p">)</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
			<span class="n">kctl</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">beep_amp</span><span class="p">;</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_ctl_add</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">kctl</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="cp">#endif</span>

	<span class="cm">/* if we have no master control, let&#39;s create it */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">snd_hda_find_mixer_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Master Playback Volume&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vmaster_tlv</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
		<span class="n">snd_hda_set_vmaster_tlv</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span><span class="p">,</span>
					<span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="n">vmaster_tlv</span><span class="p">);</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">__snd_hda_add_vmaster</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span>
					  <span class="n">vmaster_tlv</span><span class="p">,</span>
					  <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_vols</span> <span class="o">?</span>
					   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_vols</span> <span class="o">:</span> <span class="n">ad_slave_pfxs</span><span class="p">),</span>
					  <span class="s">&quot;Playback Volume&quot;</span><span class="p">,</span>
					  <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">avoid_init_slave_vol</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">snd_hda_find_mixer_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_add_vmaster</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
					  <span class="nb">NULL</span><span class="p">,</span>
					  <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_sws</span> <span class="o">?</span>
					   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_sws</span> <span class="o">:</span> <span class="n">ad_slave_pfxs</span><span class="p">),</span>
					  <span class="s">&quot;Playback Switch&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ad198x_free_kctls</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span> <span class="cm">/* no longer needed */</span>

	<span class="cm">/* assign Capture Source enums to NID */</span>
	<span class="n">kctl</span> <span class="o">=</span> <span class="n">snd_hda_find_mixer_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">kctl</span><span class="p">)</span>
		<span class="n">kctl</span> <span class="o">=</span> <span class="n">snd_hda_find_mixer_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Input Source&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">kctl</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">kctl</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_add_nid</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">kctl</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* assign IEC958 enums to NID */</span>
	<span class="n">kctl</span> <span class="o">=</span> <span class="n">snd_hda_find_mixer_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span>
			<span class="n">SNDRV_CTL_NAME_IEC958</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">PLAYBACK</span><span class="p">,</span><span class="n">NONE</span><span class="p">)</span> <span class="s">&quot;Source&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">kctl</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_add_nid</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">kctl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				      <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_check_power_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_check_amp_list_power</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">loopback</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">activate_ctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">active</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">ctl</span> <span class="o">=</span> <span class="n">snd_hda_find_mixer_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ctl</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ctl</span><span class="o">-&gt;</span><span class="n">vd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">access</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SNDRV_CTL_ELEM_ACCESS_INACTIVE</span><span class="p">;</span>
		<span class="n">ctl</span><span class="o">-&gt;</span><span class="n">vd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">access</span> <span class="o">|=</span> <span class="n">active</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span>
			<span class="n">SNDRV_CTL_ELEM_ACCESS_INACTIVE</span><span class="p">;</span>
		<span class="n">ctl</span><span class="o">-&gt;</span><span class="n">vd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">access</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SNDRV_CTL_ELEM_ACCESS_WRITE</span><span class="p">;</span>
		<span class="n">ctl</span><span class="o">-&gt;</span><span class="n">vd</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">access</span> <span class="o">|=</span> <span class="n">active</span> <span class="o">?</span>
			<span class="n">SNDRV_CTL_ELEM_ACCESS_WRITE</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">snd_ctl_notify</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">bus</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span>
			       <span class="n">SNDRV_CTL_EVENT_MASK_INFO</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">set_stream_active</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">bool</span> <span class="n">active</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">active</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_active_streams</span><span class="o">++</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_active_streams</span><span class="o">--</span><span class="p">;</span>
	<span class="n">activate_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="s">&quot;Independent HP&quot;</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_active_streams</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_independent_hp_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">texts</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;OFF&quot;</span><span class="p">,</span> <span class="s">&quot;ON&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">};</span>
	<span class="kt">int</span> <span class="n">index</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_ENUMERATED</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">index</span> <span class="o">=</span> <span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">index</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">texts</span><span class="p">[</span><span class="n">index</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_independent_hp_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">independent_hp</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_independent_hp_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">select</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">independent_hp</span> <span class="o">!=</span> <span class="n">select</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">independent_hp</span> <span class="o">=</span> <span class="n">select</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">independent_hp</span><span class="p">)</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">hp_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">hp_nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">alt_dac_nid</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Analog playback callbacks</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_playback_pcm_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">set_stream_active</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_multi_out_analog_open</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">,</span> <span class="n">substream</span><span class="p">,</span>
					     <span class="n">hinfo</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">set_stream_active</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_playback_pcm_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stream_tag</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_analog_prepare</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">,</span> <span class="n">stream_tag</span><span class="p">,</span>
						<span class="n">format</span><span class="p">,</span> <span class="n">substream</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_playback_pcm_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_analog_cleanup</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_playback_pcm_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">set_stream_active</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_alt_playback_pcm_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">independent_hp</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
	<span class="n">set_stream_active</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_alt_playback_pcm_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">set_stream_active</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">ad198x_pcm_analog_alt_playback</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">open</span>  <span class="o">=</span> <span class="n">ad1988_alt_playback_pcm_open</span><span class="p">,</span>
		<span class="p">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">ad1988_alt_playback_pcm_close</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Digital out</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_dig_playback_pcm_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_dig_open</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_dig_playback_pcm_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_dig_close</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_dig_playback_pcm_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stream_tag</span><span class="p">,</span>
					   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_dig_prepare</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">,</span> <span class="n">stream_tag</span><span class="p">,</span>
					     <span class="n">format</span><span class="p">,</span> <span class="n">substream</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_dig_playback_pcm_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_multi_out_dig_cleanup</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Analog capture</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_capture_pcm_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stream_tag</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_hda_codec_setup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="n">substream</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">],</span>
				   <span class="n">stream_tag</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_capture_pcm_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">snd_hda_codec_cleanup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="n">substream</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">ad198x_pcm_analog_playback</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="cm">/* changed later */</span>
	<span class="p">.</span><span class="n">nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* fill later */</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">ad198x_playback_pcm_open</span><span class="p">,</span>
		<span class="p">.</span><span class="n">prepare</span> <span class="o">=</span> <span class="n">ad198x_playback_pcm_prepare</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="n">ad198x_playback_pcm_cleanup</span><span class="p">,</span>
		<span class="p">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">ad198x_playback_pcm_close</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">ad198x_pcm_analog_capture</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* fill later */</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">prepare</span> <span class="o">=</span> <span class="n">ad198x_capture_pcm_prepare</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="n">ad198x_capture_pcm_cleanup</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">ad198x_pcm_digital_playback</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* fill later */</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">ad198x_dig_playback_pcm_open</span><span class="p">,</span>
		<span class="p">.</span><span class="n">close</span> <span class="o">=</span> <span class="n">ad198x_dig_playback_pcm_close</span><span class="p">,</span>
		<span class="p">.</span><span class="n">prepare</span> <span class="o">=</span> <span class="n">ad198x_dig_playback_pcm_prepare</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="n">ad198x_dig_playback_pcm_cleanup</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">ad198x_pcm_digital_capture</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="cm">/* NID is set in alc_build_pcms */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_build_pcms</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_pcm</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">pcm_rec</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_pcms</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">pcm_info</span> <span class="o">=</span> <span class="n">info</span><span class="p">;</span>

	<span class="n">info</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD198x Analog&quot;</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad198x_pcm_analog_playback</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">].</span><span class="n">channels_max</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">].</span><span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad198x_pcm_analog_capture</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">].</span><span class="n">substreams</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">].</span><span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">info</span><span class="o">++</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_pcms</span><span class="o">++</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD198x Digital&quot;</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">pcm_type</span> <span class="o">=</span> <span class="n">HDA_PCM_TYPE_SPDIF</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad198x_pcm_digital_playback</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">].</span><span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad198x_pcm_digital_capture</span><span class="p">;</span>
			<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">].</span><span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">alt_dac_nid</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">stream_analog_alt_playback</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_pcms</span><span class="o">++</span><span class="p">;</span>
		<span class="n">info</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">pcm_rec</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD198x Headphone&quot;</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">pcm_type</span> <span class="o">=</span> <span class="n">HDA_PCM_TYPE_AUDIO</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">]</span> <span class="o">=</span>
			<span class="o">*</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">stream_analog_alt_playback</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">].</span><span class="n">nid</span> <span class="o">=</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">alt_dac_nid</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad198x_free_kctls</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">kctls</span><span class="p">.</span><span class="n">list</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="o">*</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">kctls</span><span class="p">.</span><span class="n">list</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">kctls</span><span class="p">.</span><span class="n">used</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">kfree</span><span class="p">(</span><span class="n">kctl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">snd_array_free</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">kctls</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad198x_power_eapd_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">front</span><span class="p">,</span>
				<span class="n">hda_nid_t</span> <span class="n">hp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">snd_hda_query_pin_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">front</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_EAPD</span><span class="p">)</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">front</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span>
			    <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">inv_eapd</span> <span class="o">?</span> <span class="mh">0x00</span> <span class="o">:</span> <span class="mh">0x02</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">snd_hda_query_pin_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">hp</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_EAPD</span><span class="p">)</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">hp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span>
			    <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">inv_eapd</span> <span class="o">?</span> <span class="mh">0x00</span> <span class="o">:</span> <span class="mh">0x02</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad198x_power_eapd</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* We currently only handle front, HP */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x11d41882</span>:
	<span class="k">case</span> <span class="mh">0x11d4882a</span>:
	<span class="k">case</span> <span class="mh">0x11d41884</span>:
	<span class="k">case</span> <span class="mh">0x11d41984</span>:
	<span class="k">case</span> <span class="mh">0x11d41883</span>:
	<span class="k">case</span> <span class="mh">0x11d4184a</span>:
	<span class="k">case</span> <span class="mh">0x11d4194a</span>:
	<span class="k">case</span> <span class="mh">0x11d4194b</span>:
	<span class="k">case</span> <span class="mh">0x11d41988</span>:
	<span class="k">case</span> <span class="mh">0x11d4198b</span>:
	<span class="k">case</span> <span class="mh">0x11d4989a</span>:
	<span class="k">case</span> <span class="mh">0x11d4989b</span>:
		<span class="n">ad198x_power_eapd_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x11d41981</span>:
	<span class="k">case</span> <span class="mh">0x11d41983</span>:
		<span class="n">ad198x_power_eapd_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x11d41986</span>:
		<span class="n">ad198x_power_eapd_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad198x_shutup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_hda_shutup_pins</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad198x_power_eapd</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad198x_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">ad198x_shutup</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad198x_free_kctls</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">spec</span><span class="p">);</span>
	<span class="n">snd_hda_detach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_PM</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">pm_message_t</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_shutup</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_codec_ops</span> <span class="n">ad198x_patch_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">build_controls</span> <span class="o">=</span> <span class="n">ad198x_build_controls</span><span class="p">,</span>
	<span class="p">.</span><span class="n">build_pcms</span> <span class="o">=</span> <span class="n">ad198x_build_pcms</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad198x_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">free</span> <span class="o">=</span> <span class="n">ad198x_free</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="p">.</span><span class="n">check_power_status</span> <span class="o">=</span> <span class="n">ad198x_check_power_status</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_PM</span>
	<span class="p">.</span><span class="n">suspend</span> <span class="o">=</span> <span class="n">ad198x_suspend</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="p">.</span><span class="n">reboot_notify</span> <span class="o">=</span> <span class="n">ad198x_shutup</span><span class="p">,</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * EAPD control</span>
<span class="cm"> * the private value = nid</span>
<span class="cm"> */</span>
<span class="cp">#define ad198x_eapd_info	snd_ctl_boolean_mono_info</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_eapd_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">inv_eapd</span><span class="p">)</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">!</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_eapd_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">eapd</span><span class="p">;</span>
	<span class="n">eapd</span> <span class="o">=</span> <span class="o">!!</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">inv_eapd</span><span class="p">)</span>
		<span class="n">eapd</span> <span class="o">=</span> <span class="o">!</span><span class="n">eapd</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">eapd</span> <span class="o">==</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span> <span class="o">=</span> <span class="n">eapd</span><span class="p">;</span>
	<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span>
				  <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span>
				  <span class="n">eapd</span> <span class="o">?</span> <span class="mh">0x02</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">ad198x_ch_mode_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">ad198x_ch_mode_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">ad198x_ch_mode_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">);</span>


<span class="cm">/*</span>
<span class="cm"> * AD1986A specific</span>
<span class="cm"> */</span>

<span class="cp">#define AD1986A_SPDIF_OUT	0x02</span>
<span class="cp">#define AD1986A_FRONT_DAC	0x03</span>
<span class="cp">#define AD1986A_SURR_DAC	0x04</span>
<span class="cp">#define AD1986A_CLFE_DAC	0x05</span>
<span class="cp">#define AD1986A_ADC		0x06</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1986a_dac_nids</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">AD1986A_FRONT_DAC</span><span class="p">,</span> <span class="n">AD1986A_SURR_DAC</span><span class="p">,</span> <span class="n">AD1986A_CLFE_DAC</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1986a_adc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">AD1986A_ADC</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1986a_capsrc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x12</span> <span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1986a_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;CD&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Aux&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Line&quot;</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x5</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mono&quot;</span><span class="p">,</span> <span class="mh">0x6</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Phone&quot;</span><span class="p">,</span> <span class="mh">0x7</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>


<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_bind_ctls</span> <span class="n">ad1986a_bind_pcm_vol</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">snd_hda_bind_vol</span><span class="p">,</span>
	<span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">AD1986A_FRONT_DAC</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">AD1986A_SURR_DAC</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">AD1986A_CLFE_DAC</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="mi">0</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_bind_ctls</span> <span class="n">ad1986a_bind_pcm_sw</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">snd_hda_bind_sw</span><span class="p">,</span>
	<span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">AD1986A_FRONT_DAC</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">AD1986A_SURR_DAC</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">AD1986A_CLFE_DAC</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="mi">0</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * mixers</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1986a_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * bind volumes/mutes of 3 DACs as a single PCM control for simplicity</span>
<span class="cm">	 */</span>
	<span class="n">HDA_BIND_VOL</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ad1986a_bind_pcm_vol</span><span class="p">),</span>
	<span class="n">HDA_BIND_SW</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ad1986a_bind_pcm_sw</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Surround Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Surround Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Headphone Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Aux Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Aux Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mono Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mono Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Stereo Downmix Switch&quot;</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* additional mixers for 3stack mode */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1986a_3st_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Channel Mode&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_ch_mode_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_ch_mode_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_ch_mode_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* laptop model - 2ch only */</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1986a_laptop_dac_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">AD1986A_FRONT_DAC</span> <span class="p">};</span>

<span class="cm">/* master controls both pins 0x1a and 0x1b */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_bind_ctls</span> <span class="n">ad1986a_laptop_master_vol</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">snd_hda_bind_vol</span><span class="p">,</span>
	<span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x1a</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x1b</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_bind_ctls</span> <span class="n">ad1986a_laptop_master_sw</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">snd_hda_bind_sw</span><span class="p">,</span>
	<span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x1a</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x1b</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1986a_laptop_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_VOL</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ad1986a_laptop_master_vol</span><span class="p">),</span>
	<span class="n">HDA_BIND_SW</span><span class="p">(</span><span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ad1986a_laptop_master_sw</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Aux Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Aux Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="cm">/* </span>
<span class="cm">	   HDA_CODEC_VOLUME(&quot;Mono Playback Volume&quot;, 0x1e, 0x0, HDA_OUTPUT),</span>
<span class="cm">	   HDA_CODEC_MUTE(&quot;Mono Playback Switch&quot;, 0x1e, 0x0, HDA_OUTPUT), */</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* laptop-eapd model - 2ch only */</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1986a_laptop_eapd_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Internal Mic&quot;</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x5</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1986a_automic_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x5</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1986a_laptop_master_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_BIND_VOL</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ad1986a_laptop_master_vol</span><span class="p">),</span>
	<span class="n">HDA_BIND_SW</span><span class="p">(</span><span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ad1986a_laptop_master_sw</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1986a_laptop_eapd_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;External Amplifier&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_NID_FLAG</span> <span class="o">|</span> <span class="mh">0x1b</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_eapd_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_eapd_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_eapd_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="cm">/* port-D */</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1986a_laptop_intmic_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Internal Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* re-connect the mic boost input according to the jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1986a_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>
	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">);</span>
	<span class="cm">/* 0 = 0x1f, 2 = 0x1d, 4 = mixed */</span>
	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span>
			    <span class="n">present</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define AD1986A_MIC_EVENT		0x36</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1986a_automic_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="o">!=</span> <span class="n">AD1986A_MIC_EVENT</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">ad1986a_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1986a_automic_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1986a_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* laptop-automute - 2ch only */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1986a_update_hp</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mute</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">jack_present</span><span class="p">)</span>
		<span class="n">mute</span> <span class="o">=</span> <span class="n">HDA_AMP_MUTE</span><span class="p">;</span> <span class="cm">/* mute internal speaker */</span>
	<span class="k">else</span>
		<span class="cm">/* unmute internal speaker if necessary */</span>
		<span class="n">mute</span> <span class="o">=</span> <span class="n">snd_hda_codec_amp_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">mute</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1986a_hp_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">jack_present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">inv_jack_detect</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">jack_present</span> <span class="o">=</span> <span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">jack_present</span><span class="p">;</span>
	<span class="n">ad1986a_update_hp</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define AD1986A_HP_EVENT		0x37</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1986a_hp_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="o">!=</span> <span class="n">AD1986A_HP_EVENT</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">ad1986a_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1986a_hp_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1986a_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* bind hp and internal speaker mute (with plug check) */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1986a_hp_master_sw_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">long</span> <span class="o">*</span><span class="n">valp</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">change</span><span class="p">;</span>

	<span class="n">change</span> <span class="o">=</span> <span class="n">snd_hda_codec_amp_update</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					  <span class="n">HDA_AMP_MUTE</span><span class="p">,</span>
					  <span class="n">valp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">HDA_AMP_MUTE</span><span class="p">);</span>
	<span class="n">change</span> <span class="o">|=</span> <span class="n">snd_hda_codec_amp_update</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					   <span class="n">HDA_AMP_MUTE</span><span class="p">,</span>
					   <span class="n">valp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">HDA_AMP_MUTE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span>
		<span class="n">ad1986a_update_hp</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1986a_automute_master_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_BIND_VOL</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ad1986a_laptop_master_vol</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_AMP_FLAG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_switch_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_switch_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1986a_hp_master_sw_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x1a</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * initialization verbs</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1986a_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Front, Surround, CLFE DAC; mute as default */</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* Downmix - off */</span>
	<span class="p">{</span><span class="mh">0x09</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* HP, Line-Out, Surround, CLFE selectors */</span>
	<span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Mono selector */</span>
	<span class="p">{</span><span class="mh">0x0e</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Mic selector: Mic 1/2 pin */</span>
	<span class="p">{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Line-in selector: Line-in */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Mic 1/2 swap */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Record selector: mic */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Mic, Phone, CD, Aux, Line-In amp; mute as default */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* PC beep */</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* HP, Line-Out, Surround, CLFE, Mono pins; mute as default */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* HP Pin */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span>
	<span class="cm">/* Front, Surround, CLFE Pins */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="cm">/* Mono Pin */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="cm">/* Mic Pin */</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="cm">/* Line, Aux, CD, Beep-In Pin */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x23</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1986a_ch2_init</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Surround out -&gt; Line In */</span>
	<span class="p">{</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span> <span class="p">},</span>
 	<span class="cm">/* Line-in selectors */</span>
	<span class="p">{</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
	<span class="cm">/* CLFE -&gt; Mic in */</span>
	<span class="p">{</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span> <span class="p">},</span>
	<span class="cm">/* Mic selector, mix C/LFE (backmic) and Mic (frontmic) */</span>
	<span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1986a_ch4_init</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Surround out -&gt; Surround */</span>
	<span class="p">{</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
	<span class="cm">/* CLFE -&gt; Mic in */</span>
	<span class="p">{</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1986a_ch6_init</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Surround out -&gt; Surround out */</span>
	<span class="p">{</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
	<span class="cm">/* CLFE -&gt; CLFE */</span>
	<span class="p">{</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_channel_mode</span> <span class="n">ad1986a_modes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ad1986a_ch2_init</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ad1986a_ch4_init</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">6</span><span class="p">,</span> <span class="n">ad1986a_ch6_init</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* eapd initialization */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1986a_eapd_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1986a_automic_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="cm">/*{0x20, AC_VERB_SET_PIN_WIDGET_CONTROL, PIN_VREF80},*/</span>
	<span class="p">{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1986A_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="cm">/* Ultra initialization */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1986a_ultra_init</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* eapd initialization */</span>
	<span class="p">{</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="cm">/* CLFE -&gt; Mic in */</span>
	<span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* pin sensing on HP jack */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1986a_hp_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1986A_HP_EVENT</span><span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1986a_samsung_p50_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1986A_HP_EVENT</span>:
		<span class="n">ad1986a_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1986A_MIC_EVENT</span>:
		<span class="n">ad1986a_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1986a_samsung_p50_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1986a_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1986a_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* models */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">AD1986A_6STACK</span><span class="p">,</span>
	<span class="n">AD1986A_3STACK</span><span class="p">,</span>
	<span class="n">AD1986A_LAPTOP</span><span class="p">,</span>
	<span class="n">AD1986A_LAPTOP_EAPD</span><span class="p">,</span>
	<span class="n">AD1986A_LAPTOP_AUTOMUTE</span><span class="p">,</span>
	<span class="n">AD1986A_ULTRA</span><span class="p">,</span>
	<span class="n">AD1986A_SAMSUNG</span><span class="p">,</span>
	<span class="n">AD1986A_SAMSUNG_P50</span><span class="p">,</span>
	<span class="n">AD1986A_MODELS</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">ad1986a_models</span><span class="p">[</span><span class="n">AD1986A_MODELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">AD1986A_6STACK</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;6stack&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1986A_3STACK</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;3stack&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1986A_LAPTOP</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1986A_LAPTOP_EAPD</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop-eapd&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1986A_LAPTOP_AUTOMUTE</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;laptop-automute&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1986A_ULTRA</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;ultra&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1986A_SAMSUNG</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;samsung&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1986A_SAMSUNG_P50</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;samsung-p50&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">ad1986a_cfg_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x30af</span><span class="p">,</span> <span class="s">&quot;HP B2800&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP_EAPD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x1153</span><span class="p">,</span> <span class="s">&quot;ASUS M9&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP_EAPD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x11f7</span><span class="p">,</span> <span class="s">&quot;ASUS U5A&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP_EAPD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x1213</span><span class="p">,</span> <span class="s">&quot;ASUS A6J&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP_EAPD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x1263</span><span class="p">,</span> <span class="s">&quot;ASUS U5F&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP_EAPD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x1297</span><span class="p">,</span> <span class="s">&quot;ASUS Z62F&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP_EAPD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x12b3</span><span class="p">,</span> <span class="s">&quot;ASUS V1j&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP_EAPD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x1302</span><span class="p">,</span> <span class="s">&quot;ASUS W3j&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP_EAPD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x1443</span><span class="p">,</span> <span class="s">&quot;ASUS VX1&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x1447</span><span class="p">,</span> <span class="s">&quot;ASUS A8J&quot;</span><span class="p">,</span> <span class="n">AD1986A_3STACK</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x817f</span><span class="p">,</span> <span class="s">&quot;ASUS P5&quot;</span><span class="p">,</span> <span class="n">AD1986A_3STACK</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x818f</span><span class="p">,</span> <span class="s">&quot;ASUS P5&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x81b3</span><span class="p">,</span> <span class="s">&quot;ASUS P5&quot;</span><span class="p">,</span> <span class="n">AD1986A_3STACK</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x81cb</span><span class="p">,</span> <span class="s">&quot;ASUS M2N&quot;</span><span class="p">,</span> <span class="n">AD1986A_3STACK</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x8234</span><span class="p">,</span> <span class="s">&quot;ASUS M2N&quot;</span><span class="p">,</span> <span class="n">AD1986A_3STACK</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x10de</span><span class="p">,</span> <span class="mh">0xcb84</span><span class="p">,</span> <span class="s">&quot;ASUS A8N-VM&quot;</span><span class="p">,</span> <span class="n">AD1986A_3STACK</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1179</span><span class="p">,</span> <span class="mh">0xff40</span><span class="p">,</span> <span class="s">&quot;Toshiba Satellite L40-10Q&quot;</span><span class="p">,</span> <span class="n">AD1986A_3STACK</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x144d</span><span class="p">,</span> <span class="mh">0xb03c</span><span class="p">,</span> <span class="s">&quot;Samsung R55&quot;</span><span class="p">,</span> <span class="n">AD1986A_3STACK</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x144d</span><span class="p">,</span> <span class="mh">0xc01e</span><span class="p">,</span> <span class="s">&quot;FSC V2060&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x144d</span><span class="p">,</span> <span class="mh">0xc024</span><span class="p">,</span> <span class="s">&quot;Samsung P50&quot;</span><span class="p">,</span> <span class="n">AD1986A_SAMSUNG_P50</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x144d</span><span class="p">,</span> <span class="mh">0xc027</span><span class="p">,</span> <span class="s">&quot;Samsung Q1&quot;</span><span class="p">,</span> <span class="n">AD1986A_ULTRA</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK_MASK</span><span class="p">(</span><span class="mh">0x144d</span><span class="p">,</span> <span class="mh">0xff00</span><span class="p">,</span> <span class="mh">0xc000</span><span class="p">,</span> <span class="s">&quot;Samsung&quot;</span><span class="p">,</span> <span class="n">AD1986A_SAMSUNG</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x144d</span><span class="p">,</span> <span class="mh">0xc504</span><span class="p">,</span> <span class="s">&quot;Samsung Q35&quot;</span><span class="p">,</span> <span class="n">AD1986A_3STACK</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x1011</span><span class="p">,</span> <span class="s">&quot;Lenovo M55&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x1017</span><span class="p">,</span> <span class="s">&quot;Lenovo A60&quot;</span><span class="p">,</span> <span class="n">AD1986A_3STACK</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x2066</span><span class="p">,</span> <span class="s">&quot;Lenovo N100&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP_AUTOMUTE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17c0</span><span class="p">,</span> <span class="mh">0x2017</span><span class="p">,</span> <span class="s">&quot;Samsung M50&quot;</span><span class="p">,</span> <span class="n">AD1986A_LAPTOP</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_amp_list</span> <span class="n">ad1986a_loopbacks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x13</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Mic */</span>
	<span class="p">{</span> <span class="mh">0x14</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Phone */</span>
	<span class="p">{</span> <span class="mh">0x15</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* CD */</span>
	<span class="p">{</span> <span class="mh">0x16</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Aux */</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Line */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">is_jack_available</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">conf</span> <span class="o">=</span> <span class="n">snd_hda_codec_get_pincfg</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">get_defcfg_connect</span><span class="p">(</span><span class="n">conf</span><span class="p">)</span> <span class="o">!=</span> <span class="n">AC_JACK_PORT_NONE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_ad1986a</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">board_config</span><span class="p">;</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ad198x_free</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1986a_dac_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1986a_dac_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1986A_SPDIF_OUT</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">ad1986a_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span> <span class="o">=</span> <span class="n">ad1986a_capsrc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1986a_capture_source</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_init_verbs</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">loopback</span><span class="p">.</span><span class="n">amplist</span> <span class="o">=</span> <span class="n">ad1986a_loopbacks</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">inv_eapd</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* AD1986A has the inverted EAPD implementation */</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">ad198x_patch_ops</span><span class="p">;</span>

	<span class="cm">/* override some parameters */</span>
	<span class="n">board_config</span> <span class="o">=</span> <span class="n">snd_hda_check_board_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AD1986A_MODELS</span><span class="p">,</span>
						  <span class="n">ad1986a_models</span><span class="p">,</span>
						  <span class="n">ad1986a_cfg_tbl</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1986A_3STACK</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_3st_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_ch2_init</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span> <span class="o">=</span> <span class="n">ad1986a_modes</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1986a_modes</span><span class="p">);</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">need_dac_fix</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1986A_LAPTOP</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_laptop_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1986a_laptop_dac_nids</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1986A_LAPTOP_EAPD</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_laptop_master_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_laptop_eapd_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_laptop_intmic_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_eapd_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1986a_laptop_dac_nids</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_jack_available</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">))</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1986a_laptop_eapd_capture_source</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1986A_SAMSUNG</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_laptop_master_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_laptop_eapd_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_eapd_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_automic_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1986a_laptop_dac_nids</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_jack_available</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">))</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1986a_automic_capture_source</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1986a_automic_unsol_event</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1986a_automic_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1986A_SAMSUNG_P50</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_automute_master_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_laptop_eapd_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_eapd_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_automic_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_hp_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1986a_laptop_dac_nids</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_jack_available</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">))</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1986a_automic_capture_source</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1986a_samsung_p50_unsol_event</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1986a_samsung_p50_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1986A_LAPTOP_AUTOMUTE</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_automute_master_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_laptop_eapd_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_laptop_intmic_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_eapd_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_hp_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1986a_laptop_dac_nids</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_jack_available</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">))</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1986a_laptop_eapd_capture_source</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1986a_hp_unsol_event</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1986a_hp_init</span><span class="p">;</span>
		<span class="cm">/* Lenovo N100 seems to report the reversed bit</span>
<span class="cm">		 * for HP jack-sensing</span>
<span class="cm">		 */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">inv_jack_detect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1986A_ULTRA</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_laptop_eapd_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1986a_ultra_init</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1986a_laptop_dac_nids</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* AD1986A has a hardware problem that it can&#39;t share a stream</span>
<span class="cm">	 * with multiple output pins.  The copy of front to surrounds</span>
<span class="cm">	 * causes noisy or silent outputs at a certain timing, e.g.</span>
<span class="cm">	 * changing the volume.</span>
<span class="cm">	 * So, let&#39;s disable the shared stream.</span>
<span class="cm">	 */</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">no_share_stream</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_trigger_sense</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_sticky_stream</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * AD1983 specific</span>
<span class="cm"> */</span>

<span class="cp">#define AD1983_SPDIF_OUT	0x02</span>
<span class="cp">#define AD1983_DAC		0x03</span>
<span class="cp">#define AD1983_ADC		0x04</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1983_dac_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">AD1983_DAC</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1983_adc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">AD1983_ADC</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1983_capsrc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x15</span> <span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1983_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Line&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix Mono&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * SPDIF playback route</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1983_spdif_route_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">texts</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;PCM&quot;</span><span class="p">,</span> <span class="s">&quot;ADC&quot;</span> <span class="p">};</span>

	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_ENUMERATED</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">texts</span><span class="p">[</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1983_spdif_route_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1983_spdif_route_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span> <span class="o">!=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					  <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span>
					  <span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1983_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Headphone Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SNDRV_CTL_NAME_IEC958</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">PLAYBACK</span><span class="p">,</span><span class="n">NONE</span><span class="p">)</span> <span class="s">&quot;Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1983_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Front, HP, Mono; mute as default */</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* Beep, PCM, Mic, Line-In: mute */</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* Front, HP selectors; from Mix */</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
	<span class="cm">/* Mono selector; from Mix */</span>
	<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="cm">/* Mic selector; Mic */</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Line-in selector: Line-in */</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Mic boost: 0dB */</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb000</span><span class="p">},</span>
	<span class="cm">/* Record selector: mic */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Front Pin */</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="cm">/* HP Pin */</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span>
	<span class="cm">/* Mono Pin */</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="cm">/* Mic Pin */</span>
	<span class="p">{</span><span class="mh">0x08</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="cm">/* Line Pin */</span>
	<span class="p">{</span><span class="mh">0x09</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_amp_list</span> <span class="n">ad1983_loopbacks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Mic */</span>
	<span class="p">{</span> <span class="mh">0x13</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Line */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_ad1983</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ad198x_free</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1983_dac_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1983_dac_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1983_SPDIF_OUT</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">ad1983_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span> <span class="o">=</span> <span class="n">ad1983_capsrc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1983_capture_source</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1983_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1983_init_verbs</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">loopback</span><span class="p">.</span><span class="n">amplist</span> <span class="o">=</span> <span class="n">ad1983_loopbacks</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">ad198x_patch_ops</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_trigger_sense</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_sticky_stream</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * AD1981 HD specific</span>
<span class="cm"> */</span>

<span class="cp">#define AD1981_SPDIF_OUT	0x02</span>
<span class="cp">#define AD1981_DAC		0x03</span>
<span class="cp">#define AD1981_ADC		0x04</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1981_dac_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">AD1981_DAC</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1981_adc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">AD1981_ADC</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1981_capsrc_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x15</span> <span class="p">};</span>

<span class="cm">/* 0x0c, 0x09, 0x0e, 0x0f, 0x19, 0x05, 0x18, 0x17 */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1981_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Front Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Line&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix Mono&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;CD&quot;</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x6</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Aux&quot;</span><span class="p">,</span> <span class="mh">0x7</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1981_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Headphone Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Aux Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Aux Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* identical with AD1983 */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SNDRV_CTL_NAME_IEC958</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">PLAYBACK</span><span class="p">,</span><span class="n">NONE</span><span class="p">)</span> <span class="s">&quot;Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1981_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Front, HP, Mono; mute as default */</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* Beep, PCM, Front Mic, Line, Rear Mic, Aux, CD-In: mute */</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* Front, HP selectors; from Mix */</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
	<span class="cm">/* Mono selector; from Mix */</span>
	<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="cm">/* Mic Mixer; select Front Mic */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb000</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* Mic boost: 0dB */</span>
	<span class="p">{</span><span class="mh">0x08</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="cm">/* Record selector: Front mic */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="cm">/* SPDIF route: PCM */</span>
	<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Front Pin */</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="cm">/* HP Pin */</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span>
	<span class="cm">/* Mono Pin */</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="cm">/* Front &amp; Rear Mic Pins */</span>
	<span class="p">{</span><span class="mh">0x08</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="cm">/* Line Pin */</span>
	<span class="p">{</span><span class="mh">0x09</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="cm">/* Digital Beep */</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="cm">/* Line-Out as Input: disabled */</span>
	<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_amp_list</span> <span class="n">ad1981_loopbacks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Front Mic */</span>
	<span class="p">{</span> <span class="mh">0x13</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Line */</span>
	<span class="p">{</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Aux */</span>
	<span class="p">{</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Mic */</span>
	<span class="p">{</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* CD */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Patch for HP nx6320</span>
<span class="cm"> *</span>
<span class="cm"> * nx6320 uses EAPD in the reverse way - EAPD-on means the internal</span>
<span class="cm"> * speaker output enabled _and_ mute-LED off.</span>
<span class="cm"> */</span>

<span class="cp">#define AD1981_HP_EVENT		0x37</span>
<span class="cp">#define AD1981_MIC_EVENT	0x38</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1981_hp_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* default off */</span>
	<span class="cm">/* pin sensing on HP and Mic jacks */</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1981_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x08</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1981_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="cm">/* turn on/off EAPD (+ mute HP) as a master switch */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1981_hp_master_sw_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">ad198x_eapd_put</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/* change speaker pin appropriately */</span>
	<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span> <span class="o">?</span> <span class="n">PIN_OUT</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="cm">/* toggle HP mute appropriately */</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span>
				 <span class="n">spec</span><span class="o">-&gt;</span><span class="n">cur_eapd</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">HDA_AMP_MUTE</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* bind volumes of both NID 0x05 and 0x06 */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_bind_ctls</span> <span class="n">ad1981_hp_bind_master_vol</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">snd_hda_bind_vol</span><span class="p">,</span>
	<span class="p">.</span><span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x05</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x06</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
		<span class="mi">0</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* mute internal speaker if HP is plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1981_hp_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">present</span> <span class="o">?</span> <span class="n">HDA_AMP_MUTE</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* toggle input of built-in and mic jack appropriately */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1981_hp_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">mic_jack_on</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb000</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">mic_jack_off</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb080</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb000</span><span class="p">},</span>
		<span class="p">{}</span>
	<span class="p">};</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">present</span><span class="p">)</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mic_jack_on</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">mic_jack_off</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* unsolicited event for HP jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1981_hp_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">res</span> <span class="o">&gt;&gt;=</span> <span class="mi">26</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1981_HP_EVENT</span>:
		<span class="n">ad1981_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1981_MIC_EVENT</span>:
		<span class="n">ad1981_hp_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1981_hp_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Docking-Station&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1981_hp_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_BIND_VOL</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ad1981_hp_bind_master_vol</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_NID_FLAG</span> <span class="o">|</span> <span class="mh">0x05</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_eapd_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_eapd_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1981_hp_master_sw_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	/* FIXME: analog mic/line loopback doesn&#39;t work with my tests...</span>
<span class="c">	 *        (although recording is OK)</span>
<span class="c">	 */</span>
<span class="c">	HDA_CODEC_VOLUME(&quot;Mic Playback Volume&quot;, 0x12, 0x0, HDA_OUTPUT),</span>
<span class="c">	HDA_CODEC_MUTE(&quot;Mic Playback Switch&quot;, 0x12, 0x0, HDA_OUTPUT),</span>
<span class="c">	HDA_CODEC_VOLUME(&quot;Docking-Station Playback Volume&quot;, 0x13, 0x0, HDA_OUTPUT),</span>
<span class="c">	HDA_CODEC_MUTE(&quot;Docking-Station Playback Switch&quot;, 0x13, 0x0, HDA_OUTPUT),</span>
<span class="c">	HDA_CODEC_VOLUME(&quot;Internal Mic Playback Volume&quot;, 0x1c, 0x0, HDA_OUTPUT),</span>
<span class="c">	HDA_CODEC_MUTE(&quot;Internal Mic Playback Switch&quot;, 0x1c, 0x0, HDA_OUTPUT),</span>
<span class="c">	/* FIXME: does this laptop have analog CD connection? */</span>
<span class="c">	HDA_CODEC_VOLUME(&quot;CD Playback Volume&quot;, 0x1d, 0x0, HDA_OUTPUT),</span>
<span class="c">	HDA_CODEC_MUTE(&quot;CD Playback Switch&quot;, 0x1d, 0x0, HDA_OUTPUT),</span>
<span class="cp">#endif</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* initialize jack-sensing, too */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1981_hp_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1981_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1981_hp_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* configuration for Toshiba Laptops */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1981_toshiba_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span> <span class="cm">/* default on */</span>
	<span class="cm">/* pin sensing on HP and Mic jacks */</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1981_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x08</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1981_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1981_toshiba_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Amp Volume&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Amp Switch&quot;</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* configuration for Lenovo Thinkpad T60 */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1981_thinkpad_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* identical with AD1983 */</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SNDRV_CTL_NAME_IEC958</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">PLAYBACK</span><span class="p">,</span><span class="n">NONE</span><span class="p">)</span> <span class="s">&quot;Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1981_thinkpad_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;CD&quot;</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* models */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">AD1981_BASIC</span><span class="p">,</span>
	<span class="n">AD1981_HP</span><span class="p">,</span>
	<span class="n">AD1981_THINKPAD</span><span class="p">,</span>
	<span class="n">AD1981_TOSHIBA</span><span class="p">,</span>
	<span class="n">AD1981_MODELS</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">ad1981_models</span><span class="p">[</span><span class="n">AD1981_MODELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">AD1981_HP</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;hp&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1981_THINKPAD</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;thinkpad&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1981_BASIC</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;basic&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1981_TOSHIBA</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;toshiba&quot;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">ad1981_cfg_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1014</span><span class="p">,</span> <span class="mh">0x0597</span><span class="p">,</span> <span class="s">&quot;Lenovo Z60&quot;</span><span class="p">,</span> <span class="n">AD1981_THINKPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1014</span><span class="p">,</span> <span class="mh">0x05b7</span><span class="p">,</span> <span class="s">&quot;Lenovo Z60m&quot;</span><span class="p">,</span> <span class="n">AD1981_THINKPAD</span><span class="p">),</span>
	<span class="cm">/* All HP models */</span>
	<span class="n">SND_PCI_QUIRK_VENDOR</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="s">&quot;HP nx&quot;</span><span class="p">,</span> <span class="n">AD1981_HP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1179</span><span class="p">,</span> <span class="mh">0x0001</span><span class="p">,</span> <span class="s">&quot;Toshiba U205&quot;</span><span class="p">,</span> <span class="n">AD1981_TOSHIBA</span><span class="p">),</span>
	<span class="cm">/* Lenovo Thinkpad T60/X60/Z6xx */</span>
	<span class="n">SND_PCI_QUIRK_VENDOR</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="s">&quot;Lenovo Thinkpad&quot;</span><span class="p">,</span> <span class="n">AD1981_THINKPAD</span><span class="p">),</span>
	<span class="cm">/* HP nx6320 (reversed SSID, H/W bug) */</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x30b0</span><span class="p">,</span> <span class="mh">0x103c</span><span class="p">,</span> <span class="s">&quot;HP nx6320&quot;</span><span class="p">,</span> <span class="n">AD1981_HP</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_ad1981</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">board_config</span><span class="p">;</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ad198x_free</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1981_dac_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1981_dac_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1981_SPDIF_OUT</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">ad1981_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span> <span class="o">=</span> <span class="n">ad1981_capsrc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1981_capture_source</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1981_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1981_init_verbs</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">loopback</span><span class="p">.</span><span class="n">amplist</span> <span class="o">=</span> <span class="n">ad1981_loopbacks</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">ad198x_patch_ops</span><span class="p">;</span>

	<span class="cm">/* override some parameters */</span>
	<span class="n">board_config</span> <span class="o">=</span> <span class="n">snd_hda_check_board_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AD1981_MODELS</span><span class="p">,</span>
						  <span class="n">ad1981_models</span><span class="p">,</span>
						  <span class="n">ad1981_cfg_tbl</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1981_HP</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1981_hp_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1981_hp_init_verbs</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_jack_available</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">))</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1981_hp_capture_source</span><span class="p">;</span>

		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1981_hp_init</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1981_hp_unsol_event</span><span class="p">;</span>
		<span class="cm">/* set the upper-limit for mixer amp to 0dB for avoiding the</span>
<span class="cm">		 * possible damage by overloading</span>
<span class="cm">		 */</span>
		<span class="n">snd_hda_override_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_OFFSET_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_NUM_STEPS_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x05</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_STEP_SIZE_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_MUTE_SHIFT</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1981_THINKPAD</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1981_thinkpad_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1981_thinkpad_capture_source</span><span class="p">;</span>
		<span class="cm">/* set the upper-limit for mixer amp to 0dB for avoiding the</span>
<span class="cm">		 * possible damage by overloading</span>
<span class="cm">		 */</span>
		<span class="n">snd_hda_override_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_OFFSET_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_NUM_STEPS_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x05</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_STEP_SIZE_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_MUTE_SHIFT</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1981_TOSHIBA</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1981_hp_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1981_toshiba_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1981_toshiba_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1981_hp_capture_source</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1981_hp_init</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1981_hp_unsol_event</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_trigger_sense</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_sticky_stream</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * AD1988</span>
<span class="cm"> *</span>
<span class="cm"> * Output pins and routes</span>
<span class="cm"> *</span>
<span class="cm"> *        Pin               Mix     Sel     DAC (*)</span>
<span class="cm"> * port-A 0x11 (mute/hp) &lt;- 0x22 &lt;- 0x37 &lt;- 03/04/06</span>
<span class="cm"> * port-B 0x14 (mute/hp) &lt;- 0x2b &lt;- 0x30 &lt;- 03/04/06</span>
<span class="cm"> * port-C 0x15 (mute)    &lt;- 0x2c &lt;- 0x31 &lt;- 05/0a</span>
<span class="cm"> * port-D 0x12 (mute/hp) &lt;- 0x29         &lt;- 04</span>
<span class="cm"> * port-E 0x17 (mute/hp) &lt;- 0x26 &lt;- 0x32 &lt;- 05/0a</span>
<span class="cm"> * port-F 0x16 (mute)    &lt;- 0x2a         &lt;- 06</span>
<span class="cm"> * port-G 0x24 (mute)    &lt;- 0x27         &lt;- 05</span>
<span class="cm"> * port-H 0x25 (mute)    &lt;- 0x28         &lt;- 0a</span>
<span class="cm"> * mono   0x13 (mute/amp)&lt;- 0x1e &lt;- 0x36 &lt;- 03/04/06</span>
<span class="cm"> *</span>
<span class="cm"> * DAC0 = 03h, DAC1 = 04h, DAC2 = 05h, DAC3 = 06h, DAC4 = 0ah</span>
<span class="cm"> * (*) DAC2/3/4 are swapped to DAC3/4/2 on AD198A rev.2 due to a h/w bug.</span>
<span class="cm"> *</span>
<span class="cm"> * Input pins and routes</span>
<span class="cm"> *</span>
<span class="cm"> *        pin     boost   mix input # / adc input #</span>
<span class="cm"> * port-A 0x11 -&gt; 0x38 -&gt; mix 2, ADC 0</span>
<span class="cm"> * port-B 0x14 -&gt; 0x39 -&gt; mix 0, ADC 1</span>
<span class="cm"> * port-C 0x15 -&gt; 0x3a -&gt; 33:0 - mix 1, ADC 2</span>
<span class="cm"> * port-D 0x12 -&gt; 0x3d -&gt; mix 3, ADC 8</span>
<span class="cm"> * port-E 0x17 -&gt; 0x3c -&gt; 34:0 - mix 4, ADC 4</span>
<span class="cm"> * port-F 0x16 -&gt; 0x3b -&gt; mix 5, ADC 3</span>
<span class="cm"> * port-G 0x24 -&gt; N/A  -&gt; 33:1 - mix 1, 34:1 - mix 4, ADC 6</span>
<span class="cm"> * port-H 0x25 -&gt; N/A  -&gt; 33:2 - mix 1, 34:2 - mix 4, ADC 7</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * DAC assignment</span>
<span class="cm"> *   6stack - front/surr/CLFE/side/opt DACs - 04/06/05/0a/03</span>
<span class="cm"> *   3stack - front/surr/CLFE/opt DACs - 04/05/0a/03</span>
<span class="cm"> *</span>
<span class="cm"> * Inputs of Analog Mix (0x20)</span>
<span class="cm"> *   0:Port-B (front mic)</span>
<span class="cm"> *   1:Port-C/G/H (line-in)</span>
<span class="cm"> *   2:Port-A</span>
<span class="cm"> *   3:Port-D (line-in/2)</span>
<span class="cm"> *   4:Port-E/G/H (mic-in)</span>
<span class="cm"> *   5:Port-F (mic2-in)</span>
<span class="cm"> *   6:CD</span>
<span class="cm"> *   7:Beep</span>
<span class="cm"> *</span>
<span class="cm"> * ADC selection</span>
<span class="cm"> *   0:Port-A</span>
<span class="cm"> *   1:Port-B (front mic-in)</span>
<span class="cm"> *   2:Port-C (line-in)</span>
<span class="cm"> *   3:Port-F (mic2-in)</span>
<span class="cm"> *   4:Port-E (mic-in)</span>
<span class="cm"> *   5:CD</span>
<span class="cm"> *   6:Port-G</span>
<span class="cm"> *   7:Port-H</span>
<span class="cm"> *   8:Port-D (line-in/2)</span>
<span class="cm"> *   9:Mix</span>
<span class="cm"> *</span>
<span class="cm"> * Proposed pin assignments by the datasheet</span>
<span class="cm"> *</span>
<span class="cm"> * 6-stack</span>
<span class="cm"> * Port-A front headphone</span>
<span class="cm"> *      B front mic-in</span>
<span class="cm"> *      C rear line-in</span>
<span class="cm"> *      D rear front-out</span>
<span class="cm"> *      E rear mic-in</span>
<span class="cm"> *      F rear surround</span>
<span class="cm"> *      G rear CLFE</span>
<span class="cm"> *      H rear side</span>
<span class="cm"> *</span>
<span class="cm"> * 3-stack</span>
<span class="cm"> * Port-A front headphone</span>
<span class="cm"> *      B front mic</span>
<span class="cm"> *      C rear line-in/surround</span>
<span class="cm"> *      D rear front-out</span>
<span class="cm"> *      E rear mic-in/CLFE</span>
<span class="cm"> *</span>
<span class="cm"> * laptop</span>
<span class="cm"> * Port-A headphone</span>
<span class="cm"> *      B mic-in</span>
<span class="cm"> *      C docking station</span>
<span class="cm"> *      D internal speaker (with EAPD)</span>
<span class="cm"> *      E/F quad mic array</span>
<span class="cm"> */</span>


<span class="cm">/* models */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">AD1988_6STACK</span><span class="p">,</span>
	<span class="n">AD1988_6STACK_DIG</span><span class="p">,</span>
	<span class="n">AD1988_3STACK</span><span class="p">,</span>
	<span class="n">AD1988_3STACK_DIG</span><span class="p">,</span>
	<span class="n">AD1988_LAPTOP</span><span class="p">,</span>
	<span class="n">AD1988_LAPTOP_DIG</span><span class="p">,</span>
	<span class="n">AD1988_AUTO</span><span class="p">,</span>
	<span class="n">AD1988_MODEL_LAST</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* reivision id to check workarounds */</span>
<span class="cp">#define AD1988A_REV2		0x100200</span>

<span class="cp">#define is_rev2(codec) \</span>
<span class="cp">	((codec)-&gt;vendor_id == 0x11d41988 &amp;&amp; \</span>
<span class="cp">	 (codec)-&gt;revision_id == AD1988A_REV2)</span>

<span class="cm">/*</span>
<span class="cm"> * mixers</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1988_6stack_dac_nids</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0a</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1988_3stack_dac_nids</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0a</span>
<span class="p">};</span>

<span class="cm">/* for AD1988A revision-2, DAC2-4 are swapped */</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1988_6stack_dac_nids_rev2</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x06</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1988_alt_dac_nid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x03</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1988_3stack_dac_nids_rev2</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x06</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1988_adc_nids</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0f</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1988_capsrc_nids</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0e</span>
<span class="p">};</span>

<span class="cp">#define AD1988_SPDIF_OUT		0x02</span>
<span class="cp">#define AD1988_SPDIF_OUT_HDMI	0x0b</span>
<span class="cp">#define AD1988_SPDIF_IN		0x07</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1989b_slave_dig_outs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">AD1988_SPDIF_OUT</span><span class="p">,</span> <span class="n">AD1988_SPDIF_OUT_HDMI</span><span class="p">,</span> <span class="mi">0</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1988_6stack_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Front Mic&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>	<span class="cm">/* port-B */</span>
		<span class="p">{</span> <span class="s">&quot;Line&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>	<span class="cm">/* port-C */</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>		<span class="cm">/* port-E */</span>
		<span class="p">{</span> <span class="s">&quot;CD&quot;</span><span class="p">,</span> <span class="mh">0x5</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x9</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1988_laptop_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic/Line&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>	<span class="cm">/* port-B */</span>
		<span class="p">{</span> <span class="s">&quot;CD&quot;</span><span class="p">,</span> <span class="mh">0x5</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x9</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_ch_mode_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_ch_mode_info</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">uinfo</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span><span class="p">,</span>
				    <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_ch_mode_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_hda_ch_mode_get</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span><span class="p">,</span>
				   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad198x_ch_mode_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_ch_mode_put</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span><span class="p">,</span>
				      <span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span><span class="p">,</span>
				      <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">need_dac_fix</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_hp_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Independent HP&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad1988_independent_hp_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad1988_independent_hp_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1988_independent_hp_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* 6-stack mode */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_6stack_mixers1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Surround Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Side Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_6stack_mixers1_rev2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Surround Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Side Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_6stack_mixers2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Headphone Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="s">&quot;Front Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="s">&quot;Surround Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="s">&quot;Side Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="s">&quot;Mono Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Analog Mix Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Analog Mix Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* 3-stack mode */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_3stack_mixers1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Surround Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_3stack_mixers1_rev2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Surround Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_3stack_mixers2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Headphone Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="s">&quot;Front Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="s">&quot;Surround Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="s">&quot;Mono Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Analog Mix Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Analog Mix Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Channel Mode&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_ch_mode_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_ch_mode_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_ch_mode_put</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* laptop mode */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_laptop_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Headphone Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="s">&quot;Mono Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Analog Mix Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Analog Mix Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>

	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;External Amplifier&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_NID_FLAG</span> <span class="o">|</span> <span class="mh">0x12</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_eapd_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_eapd_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_eapd_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">,</span> <span class="cm">/* port-D */</span>
	<span class="p">},</span>

	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* capture */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_capture_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_IDX</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_IDX</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_IDX</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_IDX</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="cm">/* The multiple &quot;Capture Source&quot; controls confuse alsamixer</span>
<span class="cm">		 * So call somewhat different..</span>
<span class="cm">		 */</span>
		<span class="cm">/* .name = &quot;Capture Source&quot;, */</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Input Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_spdif_playback_source_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">texts</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;PCM&quot;</span><span class="p">,</span> <span class="s">&quot;ADC1&quot;</span><span class="p">,</span> <span class="s">&quot;ADC2&quot;</span><span class="p">,</span> <span class="s">&quot;ADC3&quot;</span>
	<span class="p">};</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_ENUMERATED</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">texts</span><span class="p">[</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_spdif_playback_source_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					    <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sel</span><span class="p">;</span>

	<span class="n">sel</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_GET_AMP_GAIN_MUTE</span><span class="p">,</span>
				 <span class="n">AC_AMP_GET_INPUT</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">sel</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">sel</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					 <span class="n">AC_VERB_GET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sel</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
			<span class="n">sel</span><span class="o">++</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">sel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sel</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_spdif_playback_source_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					    <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="n">sel</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">change</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sel</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					 <span class="n">AC_VERB_GET_AMP_GAIN_MUTE</span><span class="p">,</span>
					 <span class="n">AC_AMP_GET_INPUT</span><span class="p">);</span>
		<span class="n">change</span> <span class="o">=</span> <span class="n">sel</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						  <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
						  <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
			<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						  <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
						  <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">sel</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					 <span class="n">AC_VERB_GET_AMP_GAIN_MUTE</span><span class="p">,</span>
					 <span class="n">AC_AMP_GET_INPUT</span> <span class="o">|</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">change</span> <span class="o">=</span> <span class="n">sel</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						  <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
						  <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
			<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						  <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
						  <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
		<span class="p">}</span>
		<span class="n">sel</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					 <span class="n">AC_VERB_GET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">change</span> <span class="o">|=</span> <span class="n">sel</span> <span class="o">!=</span> <span class="n">val</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span>
			<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						  <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span>
						  <span class="n">val</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_spdif_out_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;IEC958 Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;IEC958 Playback Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_NID_FLAG</span> <span class="o">|</span> <span class="mh">0x1b</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad1988_spdif_playback_source_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad1988_spdif_playback_source_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1988_spdif_playback_source_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_spdif_in_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;IEC958 Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1989_spdif_out_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;IEC958 Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;HDMI Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * initialization verbs</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * for 6-stack (+dig)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_6stack_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Front, Surround, CLFE, side DAC; unmute as default */</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* Port-A front headphon path */</span>
	<span class="p">{</span><span class="mh">0x37</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC0:03h */</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="cm">/* Port-D line-out path */</span>
	<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="cm">/* Port-F surround path */</span>
	<span class="p">{</span><span class="mh">0x2a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x2a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="cm">/* Port-G CLFE path */</span>
	<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="cm">/* Port-H side path */</span>
	<span class="p">{</span><span class="mh">0x28</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x28</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="cm">/* Mono out path */</span>
	<span class="p">{</span><span class="mh">0x36</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span> <span class="cm">/* DAC1:04h */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb01f</span><span class="p">},</span> <span class="cm">/* unmute, 0dB */</span>
	<span class="cm">/* Port-B front mic-in path */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x39</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="cm">/* Port-C line-in path */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x33</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Port-E mic-in path */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x34</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Analog CD Input */</span>
	<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="cm">/* Analog Mix output amp */</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x1f</span><span class="p">},</span> <span class="cm">/* 0dB */</span>

	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_6stack_fp_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Headphone; unmute as default */</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* Port-A front headphon path */</span>
	<span class="p">{</span><span class="mh">0x37</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC0:03h */</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>

	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_capture_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* mute analog mix */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">5</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">6</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">7</span><span class="p">)},</span>
	<span class="cm">/* select ADCs - front-mic */</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0e</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>

	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_spdif_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* SPDIF out sel */</span>
	<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span> <span class="cm">/* PCM */</span>
	<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span> <span class="cm">/* ADC1 */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* SPDIF out pin */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>

	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_spdif_in_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* unmute SPDIF input pin */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* AD1989 has no ADC -&gt; SPDIF route */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1989_spdif_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* SPDIF-1 out pin */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="cm">/* SPDIF-2/HDMI out pin */</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * verbs for 3stack (+dig)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_3stack_ch2_init</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* set port-C to line-in */</span>
	<span class="p">{</span> <span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span> <span class="p">},</span>
	<span class="cm">/* set port-E to mic-in */</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_3stack_ch6_init</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* set port-C to surround out */</span>
	<span class="p">{</span> <span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="p">},</span>
	<span class="cm">/* set port-E to CLFE out */</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_channel_mode</span> <span class="n">ad1988_3stack_modes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ad1988_3stack_ch2_init</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">6</span><span class="p">,</span> <span class="n">ad1988_3stack_ch6_init</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_3stack_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Front, Surround, CLFE, side DAC; unmute as default */</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* Port-A front headphon path */</span>
	<span class="p">{</span><span class="mh">0x37</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC0:03h */</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="cm">/* Port-D line-out path */</span>
	<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="cm">/* Mono out path */</span>
	<span class="p">{</span><span class="mh">0x36</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span> <span class="cm">/* DAC1:04h */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb01f</span><span class="p">},</span> <span class="cm">/* unmute, 0dB */</span>
	<span class="cm">/* Port-B front mic-in path */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x39</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="cm">/* Port-C line-in/surround path - 6ch mode as default */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x31</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span> <span class="cm">/* output sel: DAC 0x05 */</span>
	<span class="p">{</span><span class="mh">0x33</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* Port-E mic-in/CLFE path - 6ch mode as default */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x32</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span> <span class="cm">/* output sel: DAC 0x0a */</span>
	<span class="p">{</span><span class="mh">0x34</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* mute analog mix */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">5</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">6</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">7</span><span class="p">)},</span>
	<span class="cm">/* select ADCs - front-mic */</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0e</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="cm">/* Analog Mix output amp */</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x1f</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * verbs for laptop mode (+dig)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_laptop_hp_on</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* unmute port-A and mute port-D */</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_laptop_hp_off</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* mute port-A and unmute port-D */</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cp">#define AD1988_HP_EVENT	0x01</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1988_laptop_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Front, Surround, CLFE, side DAC; unmute as default */</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* Port-A front headphon path */</span>
	<span class="p">{</span><span class="mh">0x37</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* DAC0:03h */</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="cm">/* unsolicited event for pin-sense */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1988_HP_EVENT</span> <span class="p">},</span>
	<span class="cm">/* Port-D line-out path + EAPD */</span>
	<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="cm">/* EAPD-off */</span>
	<span class="cm">/* Mono out path */</span>
	<span class="p">{</span><span class="mh">0x36</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span> <span class="cm">/* DAC1:04h */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0xb01f</span><span class="p">},</span> <span class="cm">/* unmute, 0dB */</span>
	<span class="cm">/* Port-B mic-in path */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x39</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="cm">/* Port-C docking station - try to output */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x33</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="cm">/* mute analog mix */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">5</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">6</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">7</span><span class="p">)},</span>
	<span class="cm">/* select ADCs - mic */</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0e</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="cm">/* Analog Mix output amp */</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x1f</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1988_laptop_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="o">!=</span> <span class="n">AD1988_HP_EVENT</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">))</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ad1988_laptop_hp_on</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_hda_sequence_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ad1988_laptop_hp_off</span><span class="p">);</span>
<span class="p">}</span> 

<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_amp_list</span> <span class="n">ad1988_loopbacks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Front Mic */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">1</span> <span class="p">},</span> <span class="cm">/* Line */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">4</span> <span class="p">},</span> <span class="cm">/* Mic */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">6</span> <span class="p">},</span> <span class="cm">/* CD */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Automatic parse of I/O pins from the BIOS configuration</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">AD_CTL_WIDGET_VOL</span><span class="p">,</span>
	<span class="n">AD_CTL_WIDGET_MUTE</span><span class="p">,</span>
	<span class="n">AD_CTL_BIND_MUTE</span><span class="p">,</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1988_control_templates</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">HDA_BIND_MUTE</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* add dynamic controls */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">add_control</span><span class="p">(</span><span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span>
		       <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="o">*</span><span class="n">knew</span><span class="p">;</span>

	<span class="n">snd_array_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">kctls</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">knew</span><span class="p">),</span> <span class="mi">32</span><span class="p">);</span>
	<span class="n">knew</span> <span class="o">=</span> <span class="n">snd_array_new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">kctls</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">knew</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="o">*</span><span class="n">knew</span> <span class="o">=</span> <span class="n">ad1988_control_templates</span><span class="p">[</span><span class="n">type</span><span class="p">];</span>
	<span class="n">knew</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="n">kstrdup</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">knew</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">get_amp_nid_</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
		<span class="n">knew</span><span class="o">-&gt;</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_AMP_FLAG</span><span class="p">;</span>
	<span class="n">knew</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define AD1988_PIN_CD_NID		0x18</span>
<span class="cp">#define AD1988_PIN_BEEP_NID		0x10</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1988_mixer_nids</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* A     B     C     D     E     F     G     H */</span>
	<span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x28</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">hda_nid_t</span> <span class="nf">ad1988_idx_to_dac</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">idx_to_dac</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* A     B     C     D     E     F     G     H */</span>
		<span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0a</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">idx_to_dac_rev2</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* A     B     C     D     E     F     G     H */</span>
		<span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x06</span>
	<span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">is_rev2</span><span class="p">(</span><span class="n">codec</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">idx_to_dac_rev2</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="n">idx_to_dac</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1988_boost_nids</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_pin_idx</span><span class="p">(</span><span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1988_io_pins</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x25</span>
	<span class="p">};</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1988_io_pins</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ad1988_io_pins</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">nid</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* should be -1 */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_pin_to_loopback_idx</span><span class="p">(</span><span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">loopback_idx</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span>
	<span class="p">};</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">nid</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1988_PIN_CD_NID</span>:
		<span class="k">return</span> <span class="mi">6</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="n">loopback_idx</span><span class="p">[</span><span class="n">ad1988_pin_idx</span><span class="p">(</span><span class="n">nid</span><span class="p">)];</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_pin_to_adc_idx</span><span class="p">(</span><span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">adc_idx</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span>
	<span class="p">};</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">nid</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1988_PIN_CD_NID</span>:
		<span class="k">return</span> <span class="mi">5</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="n">adc_idx</span><span class="p">[</span><span class="n">ad1988_pin_idx</span><span class="p">(</span><span class="n">nid</span><span class="p">)];</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* fill in the dac_nids table from the parsed pin configuration */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_auto_fill_dac_nids</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				     <span class="k">const</span> <span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_dac_nids</span><span class="p">;</span>

	<span class="cm">/* check the pins hardwired to audio widget */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="n">ad1988_pin_idx</span><span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_dac_nids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_idx_to_dac</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* add playback controls from the parsed DAC table */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_auto_create_multi_out_ctls</span><span class="p">(</span><span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">,</span>
					     <span class="k">const</span> <span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">chname</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Front&quot;</span><span class="p">,</span> <span class="s">&quot;Surround&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="cm">/*CLFE*/</span><span class="p">,</span> <span class="s">&quot;Side&quot;</span>
	<span class="p">};</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_outs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">dac</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">dac</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="n">nid</span> <span class="o">=</span> <span class="n">ad1988_mixer_nids</span><span class="p">[</span><span class="n">ad1988_pin_idx</span><span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">line_out_pins</span><span class="p">[</span><span class="n">i</span><span class="p">])];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Center/LFE */</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_WIDGET_VOL</span><span class="p">,</span>
					  <span class="s">&quot;Center Playback Volume&quot;</span><span class="p">,</span>
					  <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">dac</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_WIDGET_VOL</span><span class="p">,</span>
					  <span class="s">&quot;LFE Playback Volume&quot;</span><span class="p">,</span>
					  <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">dac</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_BIND_MUTE</span><span class="p">,</span>
					  <span class="s">&quot;Center Playback Switch&quot;</span><span class="p">,</span>
					  <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_BIND_MUTE</span><span class="p">,</span>
					  <span class="s">&quot;LFE Playback Switch&quot;</span><span class="p">,</span>
					  <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">sprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;%s Playback Volume&quot;</span><span class="p">,</span> <span class="n">chname</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_WIDGET_VOL</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
					  <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">dac</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
			<span class="n">sprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;%s Playback Switch&quot;</span><span class="p">,</span> <span class="n">chname</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_BIND_MUTE</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
					  <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* add playback controls for speaker and HP outputs */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_auto_create_extra_out</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">,</span>
					<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pfx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">err</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">pin</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">idx</span> <span class="o">=</span> <span class="n">ad1988_pin_idx</span><span class="p">(</span><span class="n">pin</span><span class="p">);</span>
	<span class="n">nid</span> <span class="o">=</span> <span class="n">ad1988_idx_to_dac</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="cm">/* check whether the corresponding DAC was already taken */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">line_outs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">pin</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">line_out_pins</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">hda_nid_t</span> <span class="n">dac</span> <span class="o">=</span> <span class="n">ad1988_idx_to_dac</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ad1988_pin_idx</span><span class="p">(</span><span class="n">pin</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dac</span> <span class="o">==</span> <span class="n">nid</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">line_outs</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* specify the DAC as the extra output */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">hp_nid</span><span class="p">)</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">hp_nid</span> <span class="o">=</span> <span class="n">nid</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">extra_out_nid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">nid</span><span class="p">;</span>
		<span class="cm">/* control HP volume/switch on the output mixer amp */</span>
		<span class="n">sprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;%s Playback Volume&quot;</span><span class="p">,</span> <span class="n">pfx</span><span class="p">);</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_WIDGET_VOL</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
				  <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">nid</span> <span class="o">=</span> <span class="n">ad1988_mixer_nids</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
	<span class="n">sprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;%s Playback Switch&quot;</span><span class="p">,</span> <span class="n">pfx</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_BIND_MUTE</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
			       <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">nid</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* create input playback/capture controls for the given pin */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">new_analog_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">,</span>
			    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ctlname</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ctlidx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">boost</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">idx</span><span class="p">;</span>

	<span class="n">sprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;%s Playback Volume&quot;</span><span class="p">,</span> <span class="n">ctlname</span><span class="p">);</span>
	<span class="n">idx</span> <span class="o">=</span> <span class="n">ad1988_pin_to_loopback_idx</span><span class="p">(</span><span class="n">pin</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_WIDGET_VOL</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
			       <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">sprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;%s Playback Switch&quot;</span><span class="p">,</span> <span class="n">ctlname</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_WIDGET_MUTE</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
			       <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">boost</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">bnid</span><span class="p">;</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="n">ad1988_pin_idx</span><span class="p">(</span><span class="n">pin</span><span class="p">);</span>
		<span class="n">bnid</span> <span class="o">=</span> <span class="n">ad1988_boost_nids</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bnid</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">sprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;%s Boost Volume&quot;</span><span class="p">,</span> <span class="n">ctlname</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_WIDGET_VOL</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
					   <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="n">bnid</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">));</span>

		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* create playback/capture controls for input pins */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_auto_create_analog_input_ctls</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
						<span class="k">const</span> <span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="o">*</span><span class="n">imux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_imux</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">type_idx</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">num_inputs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">;</span>
		<span class="n">type</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">;</span>
		<span class="n">label</span> <span class="o">=</span> <span class="n">hda_get_autocfg_input_label</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">snd_hda_add_imux_item</span><span class="p">(</span><span class="n">imux</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span>
				      <span class="n">ad1988_pin_to_adc_idx</span><span class="p">(</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">),</span>
				      <span class="o">&amp;</span><span class="n">type_idx</span><span class="p">);</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">new_analog_input</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">,</span>
				       <span class="n">label</span><span class="p">,</span> <span class="n">type_idx</span><span class="p">,</span>
				       <span class="n">type</span> <span class="o">==</span> <span class="n">AUTO_PIN_MIC</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">snd_hda_add_imux_item</span><span class="p">(</span><span class="n">imux</span><span class="p">,</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_WIDGET_VOL</span><span class="p">,</span>
			       <span class="s">&quot;Analog Mix Playback Volume&quot;</span><span class="p">,</span>
			       <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">add_control</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">AD_CTL_WIDGET_MUTE</span><span class="p">,</span>
			       <span class="s">&quot;Analog Mix Playback Switch&quot;</span><span class="p">,</span>
			       <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1988_auto_set_output_and_unmute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					      <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pin_type</span><span class="p">,</span>
					      <span class="kt">int</span> <span class="n">dac_idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* set as output */</span>
	<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">pin_type</span><span class="p">);</span>
	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">nid</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x11</span>: <span class="cm">/* port-A - DAC 03 */</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x14</span>: <span class="cm">/* port-B - DAC 06 */</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x15</span>: <span class="cm">/* port-C - DAC 05 */</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x17</span>: <span class="cm">/* port-E - DAC 0a */</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x13</span>: <span class="cm">/* mono - DAC 04 */</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1988_auto_init_multi_out</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">line_outs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">nid</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">line_out_pins</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="n">ad1988_auto_set_output_and_unmute</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1988_auto_init_extra_out</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">pin</span><span class="p">;</span>

	<span class="n">pin</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">speaker_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pin</span><span class="p">)</span> <span class="cm">/* connect to front */</span>
		<span class="n">ad1988_auto_set_output_and_unmute</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">pin</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">hp_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pin</span><span class="p">)</span> <span class="cm">/* connect to front */</span>
		<span class="n">ad1988_auto_set_output_and_unmute</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">pin</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1988_auto_init_analog_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">auto_pin_cfg</span> <span class="o">*</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">num_inputs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hda_nid_t</span> <span class="n">nid</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pin</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="n">cfg</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">nid</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x15</span>: <span class="cm">/* port-C */</span>
			<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mh">0x17</span>: <span class="cm">/* port-E */</span>
			<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">PIN_IN</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">AUTO_PIN_MIC</span><span class="p">)</span>
			<span class="n">val</span> <span class="o">|=</span> <span class="n">snd_hda_get_default_vref</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
		<span class="n">snd_hda_set_pin_ctl</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">nid</span> <span class="o">!=</span> <span class="n">AD1988_PIN_CD_NID</span><span class="p">)</span>
			<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
					    <span class="n">AMP_OUT_MUTE</span><span class="p">);</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="n">ad1988_pin_idx</span><span class="p">(</span><span class="n">nid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ad1988_boost_nids</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
			<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ad1988_boost_nids</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
					    <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span>
					    <span class="n">AMP_OUT_ZERO</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* parse the BIOS configuration and set up the alc_spec */</span>
<span class="cm">/* return 1 if successful, 0 if the proper config is not found, or a negative error code */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_parse_auto_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_parse_pin_def_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">ad1988_auto_fill_dac_nids</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">line_outs</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* can&#39;t find valid BIOS pin config */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">ad1988_auto_create_multi_out_ctls</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">err</span> <span class="o">=</span> <span class="n">ad1988_auto_create_extra_out</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span>
						<span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">speaker_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
						<span class="s">&quot;Speaker&quot;</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">err</span> <span class="o">=</span> <span class="n">ad1988_auto_create_extra_out</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">hp_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
						<span class="s">&quot;Headphone&quot;</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">err</span> <span class="o">=</span> <span class="n">ad1988_auto_create_analog_input_ctls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">dig_outs</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1988_SPDIF_OUT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">dig_in_pin</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span> <span class="o">=</span> <span class="n">AD1988_SPDIF_IN</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">kctls</span><span class="p">.</span><span class="n">list</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">kctls</span><span class="p">.</span><span class="n">list</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_6stack_init_verbs</span><span class="p">;</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">private_imux</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* init callback for auto-configuration model -- overriding the default init */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1988_auto_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1988_auto_init_multi_out</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1988_auto_init_extra_out</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1988_auto_init_analog_input</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">ad1988_models</span><span class="p">[</span><span class="n">AD1988_MODEL_LAST</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">AD1988_6STACK</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;6stack&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1988_6STACK_DIG</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;6stack-dig&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1988_3STACK</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;3stack&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1988_3STACK_DIG</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;3stack-dig&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1988_LAPTOP</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;laptop&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1988_LAPTOP_DIG</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop-dig&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1988_AUTO</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;auto&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">ad1988_cfg_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x81ec</span><span class="p">,</span> <span class="s">&quot;Asus P5B-DLX&quot;</span><span class="p">,</span> <span class="n">AD1988_6STACK_DIG</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x81f6</span><span class="p">,</span> <span class="s">&quot;Asus M2N-SLI&quot;</span><span class="p">,</span> <span class="n">AD1988_6STACK_DIG</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x8277</span><span class="p">,</span> <span class="s">&quot;Asus P5K-E/WIFI-AP&quot;</span><span class="p">,</span> <span class="n">AD1988_6STACK_DIG</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x82c0</span><span class="p">,</span> <span class="s">&quot;Asus M3N-HT Deluxe&quot;</span><span class="p">,</span> <span class="n">AD1988_6STACK_DIG</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1043</span><span class="p">,</span> <span class="mh">0x8311</span><span class="p">,</span> <span class="s">&quot;Asus P5Q-Premium/Pro&quot;</span><span class="p">,</span> <span class="n">AD1988_6STACK_DIG</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_ad1988</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">board_config</span><span class="p">;</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">is_rev2</span><span class="p">(</span><span class="n">codec</span><span class="p">))</span>
		<span class="n">snd_printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;patch_analog: AD1988A rev.2 is detected, enable workarounds</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">board_config</span> <span class="o">=</span> <span class="n">snd_hda_check_board_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AD1988_MODEL_LAST</span><span class="p">,</span>
						  <span class="n">ad1988_models</span><span class="p">,</span> <span class="n">ad1988_cfg_tbl</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;hda_codec: %s: BIOS auto-probing.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">codec</span><span class="o">-&gt;</span><span class="n">chip_name</span><span class="p">);</span>
		<span class="n">board_config</span> <span class="o">=</span> <span class="n">AD1988_AUTO</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">==</span> <span class="n">AD1988_AUTO</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* automatic parse from the BIOS config */</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">ad1988_parse_auto_config</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ad198x_free</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">err</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;hda_codec: Cannot set up configuration from BIOS.  Using 6-stack mode...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">board_config</span> <span class="o">=</span> <span class="n">AD1988_6STACK</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ad198x_free</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">hp_nid</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">hp_nid</span> <span class="o">=</span> <span class="n">ad1988_alt_dac_nid</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1988_6STACK</span>:
	<span class="k">case</span> <span class="n">AD1988_6STACK_DIG</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">is_rev2</span><span class="p">(</span><span class="n">codec</span><span class="p">))</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1988_6stack_dac_nids_rev2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1988_6stack_dac_nids</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1988_6stack_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">is_rev2</span><span class="p">(</span><span class="n">codec</span><span class="p">))</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_6stack_mixers1_rev2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_6stack_mixers1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_6stack_mixers2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_6stack_init_verbs</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">==</span> <span class="n">AD1988_6STACK_DIG</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1988_SPDIF_OUT</span><span class="p">;</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span> <span class="o">=</span> <span class="n">AD1988_SPDIF_IN</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1988_3STACK</span>:
	<span class="k">case</span> <span class="n">AD1988_3STACK_DIG</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">is_rev2</span><span class="p">(</span><span class="n">codec</span><span class="p">))</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1988_3stack_dac_nids_rev2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1988_3stack_dac_nids</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1988_6stack_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span> <span class="o">=</span> <span class="n">ad1988_3stack_modes</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1988_3stack_modes</span><span class="p">);</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">is_rev2</span><span class="p">(</span><span class="n">codec</span><span class="p">))</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_3stack_mixers1_rev2</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_3stack_mixers1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_3stack_mixers2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_3stack_init_verbs</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">==</span> <span class="n">AD1988_3STACK_DIG</span><span class="p">)</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1988_SPDIF_OUT</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1988_LAPTOP</span>:
	<span class="k">case</span> <span class="n">AD1988_LAPTOP_DIG</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1988_3stack_dac_nids</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1988_laptop_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_laptop_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">inv_eapd</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* inverted EAPD */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_laptop_init_verbs</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">board_config</span> <span class="o">==</span> <span class="n">AD1988_LAPTOP_DIG</span><span class="p">)</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1988_SPDIF_OUT</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">autocfg</span><span class="p">.</span><span class="n">hp_pins</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_hp_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_vols</span> <span class="o">=</span> <span class="n">ad1988_6stack_fp_slave_pfxs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_sws</span> <span class="o">=</span> <span class="n">ad1988_6stack_fp_slave_pfxs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">alt_dac_nid</span> <span class="o">=</span> <span class="n">ad1988_alt_dac_nid</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">stream_analog_alt_playback</span> <span class="o">=</span>
			<span class="o">&amp;</span><span class="n">ad198x_pcm_analog_alt_playback</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1988_adc_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">ad1988_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span> <span class="o">=</span> <span class="n">ad1988_capsrc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_capture_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_capture_init_verbs</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_id</span> <span class="o">&gt;=</span> <span class="mh">0x11d4989a</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">ad1989_spdif_out_mixers</span><span class="p">;</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">ad1989_spdif_init_verbs</span><span class="p">;</span>
			<span class="n">codec</span><span class="o">-&gt;</span><span class="n">slave_dig_outs</span> <span class="o">=</span> <span class="n">ad1989b_slave_dig_outs</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">ad1988_spdif_out_mixers</span><span class="p">;</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
				<span class="n">ad1988_spdif_init_verbs</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dig_in_nid</span> <span class="o">&amp;&amp;</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_id</span> <span class="o">&lt;</span> <span class="mh">0x11d4989a</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1988_spdif_in_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">ad1988_spdif_in_init_verbs</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">ad198x_patch_ops</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1988_AUTO</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1988_auto_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1988_LAPTOP</span>:
	<span class="k">case</span> <span class="n">AD1988_LAPTOP_DIG</span>:
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1988_laptop_unsol_event</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">loopback</span><span class="p">.</span><span class="n">amplist</span> <span class="o">=</span> <span class="n">ad1988_loopbacks</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_trigger_sense</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_sticky_stream</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * AD1884 / AD1984</span>
<span class="cm"> *</span>
<span class="cm"> * port-B - front line/mic-in</span>
<span class="cm"> * port-E - aux in/out</span>
<span class="cm"> * port-F - aux in/out</span>
<span class="cm"> * port-C - rear line/mic-in</span>
<span class="cm"> * port-D - rear line/hp-out</span>
<span class="cm"> * port-A - front line/hp-out</span>
<span class="cm"> *</span>
<span class="cm"> * AD1984 = AD1884 + two digital mic-ins</span>
<span class="cm"> *</span>
<span class="cm"> * FIXME:</span>
<span class="cm"> * For simplicity, we share the single DAC for both HP and line-outs</span>
<span class="cm"> * right now.  The inidividual playbacks could be easily implemented,</span>
<span class="cm"> * but no build-up framework is given, so far.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1884_dac_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x04</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1884_adc_nids</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1884_capsrc_nids</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define AD1884_SPDIF_OUT	0x02</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1884_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Front Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;CD&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1884_base_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="cm">/* HDA_CODEC_VOLUME_IDX(&quot;PCM Playback Volume&quot;, 1, 0x03, 0x0, HDA_OUTPUT), */</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_IDX</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_IDX</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="cm">/* The multiple &quot;Capture Source&quot; controls confuse alsamixer</span>
<span class="cm">		 * So call somewhat different..</span>
<span class="cm">		 */</span>
		<span class="cm">/* .name = &quot;Capture Source&quot;, */</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Input Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* SPDIF controls */</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;IEC958 Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SNDRV_CTL_NAME_IEC958</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">PLAYBACK</span><span class="p">,</span><span class="n">NONE</span><span class="p">)</span> <span class="s">&quot;Source&quot;</span><span class="p">,</span>
		<span class="cm">/* identical with ad1983 */</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1984_dmic_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Digital Mic Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Digital Mic Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_IDX</span><span class="p">(</span><span class="s">&quot;Digital Mic Capture Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
			     <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_IDX</span><span class="p">(</span><span class="s">&quot;Digital Mic Capture Switch&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
			   <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * initialization verbs</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1884_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* DACs; mute as default */</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="cm">/* Port-A (HP) mixer */</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-A pin */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* HP selector - select DAC2 */</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="cm">/* Port-D (Line-out) mixer */</span>
	<span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-D pin */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Mono-out mixer */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Mono-out pin */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Mono selector */</span>
	<span class="p">{</span><span class="mh">0x0e</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="cm">/* Port-B (front mic) pin */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="cm">/* Port-C (rear mic) pin */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="cm">/* Analog mixer; mute as default */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="cm">/* Analog Mix output amp */</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x1f</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="cm">/* SPDIF output selector */</span>
	<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span> <span class="cm">/* PCM */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_amp_list</span> <span class="n">ad1884_loopbacks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Front Mic */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">1</span> <span class="p">},</span> <span class="cm">/* Mic */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">2</span> <span class="p">},</span> <span class="cm">/* CD */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">4</span> <span class="p">},</span> <span class="cm">/* Docking */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">ad1884_slave_vols</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;PCM&quot;</span><span class="p">,</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="s">&quot;Mono&quot;</span><span class="p">,</span> <span class="s">&quot;Front Mic&quot;</span><span class="p">,</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="s">&quot;CD&quot;</span><span class="p">,</span>
	<span class="s">&quot;Internal Mic&quot;</span><span class="p">,</span> <span class="s">&quot;Docking Mic&quot;</span><span class="p">,</span> <span class="cm">/* &quot;Beep&quot;, */</span> <span class="s">&quot;IEC958&quot;</span><span class="p">,</span>
	<span class="nb">NULL</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_ad1884</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ad198x_free</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1884_dac_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1884_dac_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1884_SPDIF_OUT</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1884_adc_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">ad1884_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span> <span class="o">=</span> <span class="n">ad1884_capsrc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1884_capture_source</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1884_base_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1884_init_verbs</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">loopback</span><span class="p">.</span><span class="n">amplist</span> <span class="o">=</span> <span class="n">ad1884_loopbacks</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>
	<span class="cm">/* we need to cover all playback volumes */</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">slave_vols</span> <span class="o">=</span> <span class="n">ad1884_slave_vols</span><span class="p">;</span>
	<span class="cm">/* slaves may contain input volumes, so we can&#39;t raise to 0dB blindly */</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">avoid_init_slave_vol</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">ad198x_patch_ops</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_trigger_sense</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_sticky_stream</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Lenovo Thinkpad T61/X61</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1984_thinkpad_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Internal Mic&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Docking-Station&quot;</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * Dell Precision T3400</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1984_dell_desktop_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Front Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Line-In&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>


<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1984_thinkpad_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="cm">/* HDA_CODEC_VOLUME_IDX(&quot;PCM Playback Volume&quot;, 1, 0x03, 0x0, HDA_OUTPUT), */</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Speaker Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Internal Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Beep Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Beep Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Docking Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Docking Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Dock Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_IDX</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_IDX</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="cm">/* The multiple &quot;Capture Source&quot; controls confuse alsamixer</span>
<span class="cm">		 * So call somewhat different..</span>
<span class="cm">		 */</span>
		<span class="cm">/* .name = &quot;Capture Source&quot;, */</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Input Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* SPDIF controls */</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;IEC958 Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SNDRV_CTL_NAME_IEC958</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">PLAYBACK</span><span class="p">,</span><span class="n">NONE</span><span class="p">)</span> <span class="s">&quot;Source&quot;</span><span class="p">,</span>
		<span class="cm">/* identical with ad1983 */</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* additional verbs */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1984_thinkpad_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Port-E (docking station mic) pin */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* docking mic boost */</span>
	<span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="cm">/* Analog PC Beeper - allow firmware/ACPI beeps */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x1a</span><span class="p">},</span>
	<span class="cm">/* Analog mixer - docking mic; mute as default */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="cm">/* enable EAPD bit */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Dell Precision T3400</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1984_dell_desktop_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Speaker Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line-In Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line-In Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line-In Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_IDX</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_IDX</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="cm">/* The multiple &quot;Capture Source&quot; controls confuse alsamixer</span>
<span class="cm">		 * So call somewhat different..</span>
<span class="cm">		 */</span>
		<span class="cm">/* .name = &quot;Capture Source&quot;, */</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Input Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* Digial MIC ADC NID 0x05 + 0x06 */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1984_pcm_dmic_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stream_tag</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_hda_codec_setup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x05</span> <span class="o">+</span> <span class="n">substream</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span>
				   <span class="n">stream_tag</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1984_pcm_dmic_cleanup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="o">*</span><span class="n">hinfo</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_hda_codec_cleanup_stream</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x05</span> <span class="o">+</span> <span class="n">substream</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_pcm_stream</span> <span class="n">ad1984_pcm_dmic_capture</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">substreams</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nid</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">prepare</span> <span class="o">=</span> <span class="n">ad1984_pcm_dmic_prepare</span><span class="p">,</span>
		<span class="p">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="n">ad1984_pcm_dmic_cleanup</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1984_build_pcms</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_pcm</span> <span class="o">*</span><span class="n">info</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">ad198x_build_pcms</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">info</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">pcm_rec</span> <span class="o">+</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_pcms</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_pcms</span><span class="o">++</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1984 Digital Mic&quot;</span><span class="p">;</span>
	<span class="n">info</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">SNDRV_PCM_STREAM_CAPTURE</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1984_pcm_dmic_capture</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* models */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">AD1984_BASIC</span><span class="p">,</span>
	<span class="n">AD1984_THINKPAD</span><span class="p">,</span>
	<span class="n">AD1984_DELL_DESKTOP</span><span class="p">,</span>
	<span class="n">AD1984_MODELS</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">ad1984_models</span><span class="p">[</span><span class="n">AD1984_MODELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">AD1984_BASIC</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;basic&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1984_THINKPAD</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;thinkpad&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1984_DELL_DESKTOP</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;dell_desktop&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">ad1984_cfg_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Lenovo Thinkpad T61/X61 */</span>
	<span class="n">SND_PCI_QUIRK_VENDOR</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="s">&quot;Lenovo Thinkpad&quot;</span><span class="p">,</span> <span class="n">AD1984_THINKPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1028</span><span class="p">,</span> <span class="mh">0x0214</span><span class="p">,</span> <span class="s">&quot;Dell T3400&quot;</span><span class="p">,</span> <span class="n">AD1984_DELL_DESKTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1028</span><span class="p">,</span> <span class="mh">0x0233</span><span class="p">,</span> <span class="s">&quot;Dell Latitude E6400&quot;</span><span class="p">,</span> <span class="n">AD1984_DELL_DESKTOP</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_ad1984</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">board_config</span><span class="p">,</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">patch_ad1884</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">spec</span> <span class="o">=</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="n">board_config</span> <span class="o">=</span> <span class="n">snd_hda_check_board_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AD1984_MODELS</span><span class="p">,</span>
						  <span class="n">ad1984_models</span><span class="p">,</span> <span class="n">ad1984_cfg_tbl</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1984_BASIC</span>:
		<span class="cm">/* additional digital mics */</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1984_dmic_mixers</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">build_pcms</span> <span class="o">=</span> <span class="n">ad1984_build_pcms</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1984_THINKPAD</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">subsystem_id</span> <span class="o">==</span> <span class="mh">0x17aa20fb</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Thinpad X300 does not have the ability to do SPDIF,</span>
<span class="cm">			   or attach to docking station to use SPDIF */</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1884_SPDIF_OUT</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1984_thinkpad_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1984_thinkpad_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1984_thinkpad_init_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">analog_beep</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1984_DELL_DESKTOP</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1984_dell_desktop_capture_source</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1984_dell_desktop_mixers</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * AD1883 / AD1884A / AD1984A / AD1984B</span>
<span class="cm"> *</span>
<span class="cm"> * port-B (0x14) - front mic-in</span>
<span class="cm"> * port-E (0x1c) - rear mic-in</span>
<span class="cm"> * port-F (0x16) - CD / ext out</span>
<span class="cm"> * port-C (0x15) - rear line-in</span>
<span class="cm"> * port-D (0x12) - rear line-out</span>
<span class="cm"> * port-A (0x11) - front hp-out</span>
<span class="cm"> *</span>
<span class="cm"> * AD1984A = AD1884A + digital-mic</span>
<span class="cm"> * AD1883 = equivalent with AD1984A</span>
<span class="cm"> * AD1984B = AD1984A + extra SPDIF-out</span>
<span class="cm"> *</span>
<span class="cm"> * FIXME:</span>
<span class="cm"> * We share the single DAC for both HP and line-outs (see AD1884/1984).</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1884a_dac_nids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x03</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define ad1884a_adc_nids	ad1884_adc_nids</span>
<span class="cp">#define ad1884a_capsrc_nids	ad1884_capsrc_nids</span>

<span class="cp">#define AD1884A_SPDIF_OUT	0x02</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1884a_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Front Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Line&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;CD&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1884a_base_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_IDX</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_IDX</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="cm">/* The multiple &quot;Capture Source&quot; controls confuse alsamixer</span>
<span class="cm">		 * So call somewhat different..</span>
<span class="cm">		 */</span>
		<span class="cm">/* .name = &quot;Capture Source&quot;, */</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Input Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* SPDIF controls */</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;IEC958 Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SNDRV_CTL_NAME_IEC958</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">PLAYBACK</span><span class="p">,</span><span class="n">NONE</span><span class="p">)</span> <span class="s">&quot;Source&quot;</span><span class="p">,</span>
		<span class="cm">/* identical with ad1983 */</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * initialization verbs</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1884a_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* DACs; unmute as default */</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="cm">/* Port-A (HP) mixer - route only from analog mixer */</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-A pin */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Port-D (Line-out) mixer - route only from analog mixer */</span>
	<span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-D pin */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Mono-out mixer - route only from analog mixer */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Mono-out pin */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Port-B (front mic) pin */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="cm">/* Port-C (rear line-in) pin */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="cm">/* Port-E (rear mic) pin */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span> <span class="cm">/* no boost */</span>
	<span class="cm">/* Port-F (CD) pin */</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Analog mixer; mute as default */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span> <span class="cm">/* aux */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">5</span><span class="p">)},</span>
	<span class="cm">/* Analog Mix output amp */</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* capture sources */</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* SPDIF output amp */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_amp_list</span> <span class="n">ad1884a_loopbacks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Front Mic */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">1</span> <span class="p">},</span> <span class="cm">/* Mic */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">2</span> <span class="p">},</span> <span class="cm">/* CD */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">4</span> <span class="p">},</span> <span class="cm">/* Docking */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Laptop model</span>
<span class="cm"> *</span>
<span class="cm"> * Port A: Headphone jack</span>
<span class="cm"> * Port B: MIC jack</span>
<span class="cm"> * Port C: Internal MIC</span>
<span class="cm"> * Port D: Dock Line Out (if enabled)</span>
<span class="cm"> * Port E: Dock Line In (if enabled)</span>
<span class="cm"> * Port F: Internal speakers</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1884a_mobile_master_sw_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_switch_put</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="n">ucontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">mute</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
		    <span class="o">!</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="cm">/* toggle GPIO1 according to the mute state */</span>
	<span class="n">snd_hda_codec_write_cache</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_GPIO_DATA</span><span class="p">,</span>
			    <span class="n">mute</span> <span class="o">?</span> <span class="mh">0x02</span> <span class="o">:</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1884a_laptop_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_AMP_FLAG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_switch_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_switch_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1884a_mobile_master_sw_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">},</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Dock Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Internal Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Dock Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Dock Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Dock Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1884a_mobile_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="cm">/*HDA_CODEC_MUTE(&quot;Master Playback Switch&quot;, 0x21, 0x0, HDA_OUTPUT),*/</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_AMP_FLAG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_switch_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_switch_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1884a_mobile_master_sw_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">},</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* mute internal speaker if HP is plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1884a_hp_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">present</span> <span class="o">?</span> <span class="n">HDA_AMP_MUTE</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span>
			    <span class="n">present</span> <span class="o">?</span> <span class="mh">0x00</span> <span class="o">:</span> <span class="mh">0x02</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* switch to external mic if plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1884a_hp_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">);</span>
	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span>
			    <span class="n">present</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define AD1884A_HP_EVENT		0x37</span>
<span class="cp">#define AD1884A_MIC_EVENT		0x36</span>

<span class="cm">/* unsolicited event for HP jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1884a_hp_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1884A_HP_EVENT</span>:
		<span class="n">ad1884a_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1884A_MIC_EVENT</span>:
		<span class="n">ad1884a_hp_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* initialize jack-sensing, too */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1884a_hp_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1884a_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1884a_hp_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* mute internal speaker if HP or docking HP is plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1884a_laptop_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">present</span><span class="p">)</span>
		<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">);</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">present</span> <span class="o">?</span> <span class="n">HDA_AMP_MUTE</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span>
			    <span class="n">present</span> <span class="o">?</span> <span class="mh">0x00</span> <span class="o">:</span> <span class="mh">0x02</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* switch to external mic if plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1884a_laptop_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">))</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">))</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* unsolicited event for HP jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1884a_laptop_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1884A_HP_EVENT</span>:
		<span class="n">ad1884a_laptop_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1884A_MIC_EVENT</span>:
		<span class="n">ad1884a_laptop_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* initialize jack-sensing, too */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1884a_laptop_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1884a_laptop_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1884a_laptop_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* additional verbs for laptop model */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1884a_laptop_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Port-A (HP) pin - always unmuted */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* Port-F (int speaker) mixer - route only from analog mixer */</span>
	<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-F (int speaker) pin */</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* required for compaq 6530s/6531s speaker output */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="cm">/* Port-C pin - internal mic-in */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x7002</span><span class="p">},</span> <span class="cm">/* raise mic as default */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x7002</span><span class="p">},</span> <span class="cm">/* raise mic as default */</span>
	<span class="cm">/* Port-D (docking line-out) pin - default unmuted */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* analog mix */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="cm">/* unsolicited event for pin-sense */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1884A_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1884A_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1884A_MIC_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1884A_MIC_EVENT</span><span class="p">},</span>
	<span class="cm">/* allow to touch GPIO1 (for mute control) */</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_GPIO_MASK</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_GPIO_DIRECTION</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_GPIO_DATA</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="cm">/* first muted */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1884a_mobile_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* DACs; unmute as default */</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="cm">/* Port-A (HP) mixer - route only from analog mixer */</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-A pin */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="cm">/* Port-A (HP) pin - always unmuted */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* Port-B (mic jack) pin */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x7002</span><span class="p">},</span> <span class="cm">/* raise mic as default */</span>
	<span class="cm">/* Port-C (int mic) pin */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x7002</span><span class="p">},</span> <span class="cm">/* raise mic as default */</span>
	<span class="cm">/* Port-F (int speaker) mixer - route only from analog mixer */</span>
	<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-F pin */</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Analog mixer; mute as default */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">5</span><span class="p">)},</span>
	<span class="cm">/* Analog Mix output amp */</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* capture sources */</span>
	<span class="cm">/* {0x0c, AC_VERB_SET_CONNECT_SEL, 0x0}, */</span> <span class="cm">/* set via unsol */</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* unsolicited event for pin-sense */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1884A_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1884A_MIC_EVENT</span><span class="p">},</span>
	<span class="cm">/* allow to touch GPIO1 (for mute control) */</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_GPIO_MASK</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_GPIO_DIRECTION</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_GPIO_DATA</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="cm">/* first muted */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Thinkpad X300</span>
<span class="cm"> * 0x11 - HP</span>
<span class="cm"> * 0x12 - speaker</span>
<span class="cm"> * 0x14 - mic-in</span>
<span class="cm"> * 0x17 - built-in mic</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1984a_thinkpad_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* HP unmute */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* analog mix */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="cm">/* turn on EAPD */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="cm">/* unsolicited event for pin-sense */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1884A_HP_EVENT</span><span class="p">},</span>
	<span class="cm">/* internal mic - dmic */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="cm">/* set magic COEFs for dmic */</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_COEF_INDEX</span><span class="p">,</span> <span class="mh">0x13f7</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_PROC_COEF</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1984a_thinkpad_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1984a_thinkpad_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x0</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Internal Mic&quot;</span><span class="p">,</span> <span class="mh">0x5</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* mute internal speaker if HP is plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1984a_thinkpad_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">);</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">present</span> <span class="o">?</span> <span class="n">HDA_AMP_MUTE</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* unsolicited event for HP jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1984a_thinkpad_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="o">!=</span> <span class="n">AD1884A_HP_EVENT</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">ad1984a_thinkpad_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* initialize jack-sensing, too */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1984a_thinkpad_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1984a_thinkpad_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Precision R5500</span>
<span class="cm"> * 0x12 - HP/line-out</span>
<span class="cm"> * 0x13 - speaker (mono)</span>
<span class="cm"> * 0x15 - mic-in</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1984a_precision_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Unmute main output path */</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">+</span> <span class="mh">0x1f</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x17</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="cm">/* Analog mixer; mute as default */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="cm">/* Select mic as input */</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">+</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="cm">/* Configure as mic */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x7002</span><span class="p">},</span> <span class="cm">/* raise mic as default */</span>
	<span class="cm">/* HP unmute */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* turn on EAPD */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="cm">/* unsolicited event for pin-sense */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1884A_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1984a_precision_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Speaker Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>


<span class="cm">/* mute internal speaker if HP is plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1984a_precision_automute</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">present</span><span class="p">;</span>

	<span class="n">present</span> <span class="o">=</span> <span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">);</span>
	<span class="n">snd_hda_codec_amp_stereo</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">HDA_AMP_MUTE</span><span class="p">,</span> <span class="n">present</span> <span class="o">?</span> <span class="n">HDA_AMP_MUTE</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* unsolicited event for HP jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1984a_precision_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="o">!=</span> <span class="n">AD1884A_HP_EVENT</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">ad1984a_precision_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* initialize jack-sensing, too */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1984a_precision_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1984a_precision_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * HP Touchsmart</span>
<span class="cm"> * port-A (0x11)      - front hp-out</span>
<span class="cm"> * port-B (0x14)      - unused</span>
<span class="cm"> * port-C (0x15)      - unused</span>
<span class="cm"> * port-D (0x12)      - rear line out</span>
<span class="cm"> * port-E (0x1c)      - front mic-in</span>
<span class="cm"> * port-F (0x16)      - Internal speakers</span>
<span class="cm"> * digital-mic (0x17) - Internal mic</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1984a_touchsmart_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* DACs; unmute as default */</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="cm">/* Port-A (HP) mixer - route only from analog mixer */</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-A pin */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="cm">/* Port-A (HP) pin - always unmuted */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="cm">/* Port-E (int speaker) mixer - route only from analog mixer */</span>
	<span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="cm">/* Port-E pin */</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="cm">/* Port-F (int speaker) mixer - route only from analog mixer */</span>
	<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-F pin */</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Analog mixer; mute as default */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">5</span><span class="p">)},</span>
	<span class="cm">/* Analog Mix output amp */</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* capture sources */</span>
	<span class="cm">/* {0x0c, AC_VERB_SET_CONNECT_SEL, 0x0}, */</span> <span class="cm">/* set via unsol */</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* unsolicited event for pin-sense */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1884A_HP_EVENT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="n">AC_VERB_SET_UNSOLICITED_ENABLE</span><span class="p">,</span> <span class="n">AC_USRSP_EN</span> <span class="o">|</span> <span class="n">AD1884A_MIC_EVENT</span><span class="p">},</span>
	<span class="cm">/* allow to touch GPIO1 (for mute control) */</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_GPIO_MASK</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_GPIO_DIRECTION</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_GPIO_DATA</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="cm">/* first muted */</span>
	<span class="cm">/* internal mic - dmic */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="cm">/* set magic COEFs for dmic */</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_COEF_INDEX</span><span class="p">,</span> <span class="mh">0x13f7</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="n">AC_VERB_SET_PROC_COEF</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1984a_touchsmart_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
<span class="cm">/*	HDA_CODEC_MUTE(&quot;Master Playback Switch&quot;, 0x21, 0x0, HDA_OUTPUT),*/</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">subdevice</span> <span class="o">=</span> <span class="n">HDA_SUBDEV_AMP_FLAG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_switch_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">snd_hda_mixer_amp_switch_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1884a_mobile_master_sw_put</span><span class="p">,</span>
		<span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">HDA_COMPOSE_AMP_VAL</span><span class="p">(</span><span class="mh">0x21</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">},</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Internal Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cm">/* switch to external mic if plugged */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1984a_touchsmart_automic</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">snd_hda_jack_detect</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">))</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				     <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_hda_codec_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				     <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x5</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* unsolicited event for HP jack sensing */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ad1984a_touchsmart_unsol_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">res</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1884A_HP_EVENT</span>:
		<span class="n">ad1884a_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1884A_MIC_EVENT</span>:
		<span class="n">ad1984a_touchsmart_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* initialize jack-sensing, too */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ad1984a_touchsmart_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ad198x_init</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1884a_hp_automute</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">ad1984a_touchsmart_automic</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">AD1884A_DESKTOP</span><span class="p">,</span>
	<span class="n">AD1884A_LAPTOP</span><span class="p">,</span>
	<span class="n">AD1884A_MOBILE</span><span class="p">,</span>
	<span class="n">AD1884A_THINKPAD</span><span class="p">,</span>
	<span class="n">AD1984A_TOUCHSMART</span><span class="p">,</span>
	<span class="n">AD1984A_PRECISION</span><span class="p">,</span>
	<span class="n">AD1884A_MODELS</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">ad1884a_models</span><span class="p">[</span><span class="n">AD1884A_MODELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">AD1884A_DESKTOP</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;desktop&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1884A_LAPTOP</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;laptop&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1884A_MOBILE</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;mobile&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1884A_THINKPAD</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;thinkpad&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1984A_TOUCHSMART</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;touchsmart&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1984A_PRECISION</span><span class="p">]</span>	<span class="o">=</span> <span class="s">&quot;precision&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_pci_quirk</span> <span class="n">ad1884a_cfg_tbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x1028</span><span class="p">,</span> <span class="mh">0x04ac</span><span class="p">,</span> <span class="s">&quot;Precision R5500&quot;</span><span class="p">,</span> <span class="n">AD1984A_PRECISION</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x3030</span><span class="p">,</span> <span class="s">&quot;HP&quot;</span><span class="p">,</span> <span class="n">AD1884A_MOBILE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x3037</span><span class="p">,</span> <span class="s">&quot;HP 2230s&quot;</span><span class="p">,</span> <span class="n">AD1884A_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x3056</span><span class="p">,</span> <span class="s">&quot;HP&quot;</span><span class="p">,</span> <span class="n">AD1884A_MOBILE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK_MASK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0xfff0</span><span class="p">,</span> <span class="mh">0x3070</span><span class="p">,</span> <span class="s">&quot;HP&quot;</span><span class="p">,</span> <span class="n">AD1884A_MOBILE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK_MASK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0xfff0</span><span class="p">,</span> <span class="mh">0x30d0</span><span class="p">,</span> <span class="s">&quot;HP laptop&quot;</span><span class="p">,</span> <span class="n">AD1884A_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK_MASK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0xfff0</span><span class="p">,</span> <span class="mh">0x30e0</span><span class="p">,</span> <span class="s">&quot;HP laptop&quot;</span><span class="p">,</span> <span class="n">AD1884A_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK_MASK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0xff00</span><span class="p">,</span> <span class="mh">0x3600</span><span class="p">,</span> <span class="s">&quot;HP laptop&quot;</span><span class="p">,</span> <span class="n">AD1884A_LAPTOP</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK_MASK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0xfff0</span><span class="p">,</span> <span class="mh">0x7010</span><span class="p">,</span> <span class="s">&quot;HP laptop&quot;</span><span class="p">,</span> <span class="n">AD1884A_MOBILE</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x17aa</span><span class="p">,</span> <span class="mh">0x20ac</span><span class="p">,</span> <span class="s">&quot;Thinkpad X300&quot;</span><span class="p">,</span> <span class="n">AD1884A_THINKPAD</span><span class="p">),</span>
	<span class="n">SND_PCI_QUIRK</span><span class="p">(</span><span class="mh">0x103c</span><span class="p">,</span> <span class="mh">0x2a82</span><span class="p">,</span> <span class="s">&quot;Touchsmart&quot;</span><span class="p">,</span> <span class="n">AD1984A_TOUCHSMART</span><span class="p">),</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_ad1884a</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">board_config</span><span class="p">;</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ad198x_free</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1884a_dac_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1884a_dac_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1884A_SPDIF_OUT</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1884a_adc_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">ad1884a_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span> <span class="o">=</span> <span class="n">ad1884a_capsrc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1884a_capture_source</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1884a_base_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1884a_init_verbs</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">loopback</span><span class="p">.</span><span class="n">amplist</span> <span class="o">=</span> <span class="n">ad1884a_loopbacks</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">ad198x_patch_ops</span><span class="p">;</span>

	<span class="cm">/* override some parameters */</span>
	<span class="n">board_config</span> <span class="o">=</span> <span class="n">snd_hda_check_board_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AD1884A_MODELS</span><span class="p">,</span>
						  <span class="n">ad1884a_models</span><span class="p">,</span>
						  <span class="n">ad1884a_cfg_tbl</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AD1884A_LAPTOP</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1884a_laptop_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1884a_laptop_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1884a_laptop_unsol_event</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1884a_laptop_init</span><span class="p">;</span>
		<span class="cm">/* set the upper-limit for mixer amp to 0dB for avoiding the</span>
<span class="cm">		 * possible damage by overloading</span>
<span class="cm">		 */</span>
		<span class="n">snd_hda_override_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_OFFSET_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_NUM_STEPS_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x05</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_STEP_SIZE_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_MUTE_SHIFT</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1884A_MOBILE</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1884a_mobile_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1884a_mobile_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1884a_hp_unsol_event</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1884a_hp_init</span><span class="p">;</span>
		<span class="cm">/* set the upper-limit for mixer amp to 0dB for avoiding the</span>
<span class="cm">		 * possible damage by overloading</span>
<span class="cm">		 */</span>
		<span class="n">snd_hda_override_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_OFFSET_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_NUM_STEPS_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x05</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_STEP_SIZE_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_MUTE_SHIFT</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1884A_THINKPAD</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1984a_thinkpad_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">ad1984a_thinkpad_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1984a_thinkpad_capture_source</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1984a_thinkpad_unsol_event</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1984a_thinkpad_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1984A_PRECISION</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1984a_precision_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
			<span class="n">ad1984a_precision_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1984a_precision_unsol_event</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1984a_precision_init</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1984A_TOUCHSMART</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1984a_touchsmart_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1984a_touchsmart_verbs</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">unsol_event</span> <span class="o">=</span> <span class="n">ad1984a_touchsmart_unsol_event</span><span class="p">;</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span><span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">ad1984a_touchsmart_init</span><span class="p">;</span>
		<span class="cm">/* set the upper-limit for mixer amp to 0dB for avoiding the</span>
<span class="cm">		 * possible damage by overloading</span>
<span class="cm">		 */</span>
		<span class="n">snd_hda_override_amp_caps</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_OFFSET_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x17</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_NUM_STEPS_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mh">0x05</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_STEP_SIZE_SHIFT</span><span class="p">)</span> <span class="o">|</span>
					  <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AC_AMPCAP_MUTE_SHIFT</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_trigger_sense</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_sticky_stream</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * AD1882 / AD1882A</span>
<span class="cm"> *</span>
<span class="cm"> * port-A - front hp-out</span>
<span class="cm"> * port-B - front mic-in</span>
<span class="cm"> * port-C - rear line-in, shared surr-out (3stack)</span>
<span class="cm"> * port-D - rear line-out</span>
<span class="cm"> * port-E - rear mic-in, shared clfe-out (3stack)</span>
<span class="cm"> * port-F - rear surr-out (6stack)</span>
<span class="cm"> * port-G - rear clfe-out (6stack)</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1882_dac_nids</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x05</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1882_adc_nids</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">hda_nid_t</span> <span class="n">ad1882_capsrc_nids</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define AD1882_SPDIF_OUT	0x02</span>

<span class="cm">/* list: 0x11, 0x39, 0x3a, 0x18, 0x3c, 0x3b, 0x12, 0x20 */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1882_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Front Mic&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x4</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Line&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;CD&quot;</span><span class="p">,</span> <span class="mh">0x3</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x7</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* list: 0x11, 0x39, 0x3a, 0x3c, 0x18, 0x1f, 0x12, 0x20 */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_input_mux</span> <span class="n">ad1882a_capture_source</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">num_items</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;Front Mic&quot;</span><span class="p">,</span> <span class="mh">0x1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="mh">0x4</span><span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Line&quot;</span><span class="p">,</span> <span class="mh">0x2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Digital Mic&quot;</span><span class="p">,</span> <span class="mh">0x06</span> <span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Mix&quot;</span><span class="p">,</span> <span class="mh">0x7</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1882_base_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Surround Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Mono Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>

	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line-In Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME_IDX</span><span class="p">(</span><span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_IDX</span><span class="p">(</span><span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="cm">/* The multiple &quot;Capture Source&quot; controls confuse alsamixer</span>
<span class="cm">		 * So call somewhat different..</span>
<span class="cm">		 */</span>
		<span class="cm">/* .name = &quot;Capture Source&quot;, */</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Input Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_mux_enum_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* SPDIF controls */</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;IEC958 Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">SNDRV_CTL_NAME_IEC958</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">PLAYBACK</span><span class="p">,</span><span class="n">NONE</span><span class="p">)</span> <span class="s">&quot;Source&quot;</span><span class="p">,</span>
		<span class="cm">/* identical with ad1983 */</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad1983_spdif_route_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1882_loopback_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1882a_loopback_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Front Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_VOLUME</span><span class="p">(</span><span class="s">&quot;Digital Mic Boost Volume&quot;</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1882_3stack_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Surround Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Channel Mode&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">ad198x_ch_mode_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">ad198x_ch_mode_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">ad198x_ch_mode_put</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ad1882_6stack_mixers</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">HDA_CODEC_MUTE</span><span class="p">(</span><span class="s">&quot;Surround Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;Center Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="n">HDA_CODEC_MUTE_MONO</span><span class="p">(</span><span class="s">&quot;LFE Playback Switch&quot;</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1882_ch2_init</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1882_ch4_init</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1882_ch6_init</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_channel_mode</span> <span class="n">ad1882_modes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ad1882_ch2_init</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ad1882_ch4_init</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">6</span><span class="p">,</span> <span class="n">ad1882_ch6_init</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * initialization verbs</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_verb</span> <span class="n">ad1882_init_verbs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* DACs; mute as default */</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span>
	<span class="cm">/* Port-A (HP) mixer */</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x22</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-A pin */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* HP selector - select DAC2 */</span>
	<span class="p">{</span><span class="mh">0x37</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x1</span><span class="p">},</span>
	<span class="cm">/* Port-D (Line-out) mixer */</span>
	<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-D pin */</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Mono-out mixer */</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_UNMUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Mono-out pin */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_HP</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Port-B (front mic) pin */</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x39</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span> <span class="cm">/* boost */</span>
	<span class="cm">/* Port-C (line-in) pin */</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_IN</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3a</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span> <span class="cm">/* boost */</span>
	<span class="cm">/* Port-C mixer - mute as input */</span>
	<span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-E (mic-in) pin */</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_VREF80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x3c</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_ZERO</span><span class="p">},</span> <span class="cm">/* boost */</span>
	<span class="cm">/* Port-E mixer - mute as input */</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="cm">/* Port-F (surround) */</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Port-G (CLFE) */</span>
	<span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="n">AC_VERB_SET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="n">PIN_OUT</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_MUTE</span><span class="p">},</span>
	<span class="cm">/* Analog mixer; mute as default */</span>
	<span class="cm">/* list: 0x39, 0x3a, 0x11, 0x12, 0x3c, 0x3b, 0x18, 0x1a */</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">1</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">3</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">4</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">5</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">6</span><span class="p">)},</span>
	<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_IN_MUTE</span><span class="p">(</span><span class="mi">7</span><span class="p">)},</span>
	<span class="cm">/* Analog Mix output amp */</span>
	<span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x1f</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="cm">/* SPDIF output selector */</span>
	<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="n">AC_VERB_SET_CONNECT_SEL</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">},</span> <span class="cm">/* PCM */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="n">AC_VERB_SET_AMP_GAIN_MUTE</span><span class="p">,</span> <span class="n">AMP_OUT_UNMUTE</span> <span class="o">|</span> <span class="mh">0x27</span><span class="p">},</span> <span class="cm">/* 0dB */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_amp_list</span> <span class="n">ad1882_loopbacks</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span> <span class="cm">/* Front Mic */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">1</span> <span class="p">},</span> <span class="cm">/* Mic */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">4</span> <span class="p">},</span> <span class="cm">/* Line */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span> <span class="mi">6</span> <span class="p">},</span> <span class="cm">/* CD */</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* end */</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cm">/* models */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">AD1882_3STACK</span><span class="p">,</span>
	<span class="n">AD1882_6STACK</span><span class="p">,</span>
	<span class="n">AD1882_MODELS</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">ad1882_models</span><span class="p">[</span><span class="n">AD1986A_MODELS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">AD1882_3STACK</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;3stack&quot;</span><span class="p">,</span>
	<span class="p">[</span><span class="n">AD1882_6STACK</span><span class="p">]</span>		<span class="o">=</span> <span class="s">&quot;6stack&quot;</span><span class="p">,</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">patch_ad1882</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ad198x_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">board_config</span><span class="p">;</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_hda_attach_beep_device</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ad198x_free</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">set_beep_amp</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>

	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dac_nids</span> <span class="o">=</span> <span class="n">ad1882_dac_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">dig_out_nid</span> <span class="o">=</span> <span class="n">AD1882_SPDIF_OUT</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_adc_nids</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1882_adc_nids</span><span class="p">);</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">adc_nids</span> <span class="o">=</span> <span class="n">ad1882_adc_nids</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">capsrc_nids</span> <span class="o">=</span> <span class="n">ad1882_capsrc_nids</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_id</span> <span class="o">==</span> <span class="mh">0x11d41882</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1882_capture_source</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">input_mux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ad1882a_capture_source</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1882_base_mixers</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_id</span> <span class="o">==</span> <span class="mh">0x11d41882</span><span class="p">)</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1882_loopback_mixers</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1882a_loopback_mixers</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_init_verbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">init_verbs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1882_init_verbs</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">spdif_route</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_SND_HDA_POWER_SAVE</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">loopback</span><span class="p">.</span><span class="n">amplist</span> <span class="o">=</span> <span class="n">ad1882_loopbacks</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vmaster_nid</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">patch_ops</span> <span class="o">=</span> <span class="n">ad198x_patch_ops</span><span class="p">;</span>

	<span class="cm">/* override some parameters */</span>
	<span class="n">board_config</span> <span class="o">=</span> <span class="n">snd_hda_check_board_config</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AD1882_MODELS</span><span class="p">,</span>
						  <span class="n">ad1882_models</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">board_config</span><span class="p">)</span> <span class="p">{</span>
	<span class="nl">default:</span>
	<span class="k">case</span> <span class="n">AD1882_3STACK</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1882_3stack_mixers</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">channel_mode</span> <span class="o">=</span> <span class="n">ad1882_modes</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_channel_mode</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ad1882_modes</span><span class="p">);</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">need_dac_fix</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">max_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">multiout</span><span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AD1882_6STACK</span>:
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">num_mixers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ad1882_6stack_mixers</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_trigger_sense</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">no_sticky_stream</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * patch entries</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hda_codec_preset</span> <span class="n">snd_hda_preset_analog</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d4184a</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1884A&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1884a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d41882</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1882&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1882</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d41883</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1883&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1884a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d41884</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1884&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1884</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d4194a</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1984A&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1884a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d4194b</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1984B&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1884a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d41981</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1981&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1981</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d41983</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1983&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1983</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d41984</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1984&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1984</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d41986</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1986A&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1986a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d41988</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1988&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1988</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d4198b</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1988B&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1988</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d4882a</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1882A&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1882</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d4989a</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1989A&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1988</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mh">0x11d4989b</span><span class="p">,</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AD1989B&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">patch</span> <span class="o">=</span> <span class="n">patch_ad1988</span> <span class="p">},</span>
	<span class="p">{}</span> <span class="cm">/* terminator */</span>
<span class="p">};</span>

<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;snd-hda-codec-id:11d4*&quot;</span><span class="p">);</span>

<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;Analog Devices HD-audio codec&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">hda_codec_preset_list</span> <span class="n">analog_list</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">preset</span> <span class="o">=</span> <span class="n">snd_hda_preset_analog</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">patch_analog_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">snd_hda_add_codec_preset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">analog_list</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">patch_analog_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_hda_delete_codec_preset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">analog_list</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">patch_analog_init</span><span class="p">)</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">patch_analog_exit</span><span class="p">)</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
