<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › pci › hda › hda_proc.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>hda_proc.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Universal Interface for Intel High Definition Audio Codec</span>
<span class="cm"> * </span>
<span class="cm"> * Generic proc interface</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2004 Takashi Iwai &lt;tiwai@suse.de&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *  This driver is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *  (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This driver is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;sound/core.h&gt;</span>
<span class="cp">#include &quot;hda_codec.h&quot;</span>
<span class="cp">#include &quot;hda_local.h&quot;</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">bits_names</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bits</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">names</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bits</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1U</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="n">n</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">n</span><span class="p">,</span> <span class="s">&quot; %s&quot;</span><span class="p">,</span>
				      <span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>
	<span class="n">buf</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">buf</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">get_wid_type_name</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wid_value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">names</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">AC_WID_AUD_OUT</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Audio Output&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">AC_WID_AUD_IN</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Audio Input&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">AC_WID_AUD_MIX</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Audio Mixer&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">AC_WID_AUD_SEL</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Audio Selector&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">AC_WID_PIN</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Pin Complex&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">AC_WID_POWER</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Power Widget&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">AC_WID_VOL_KNB</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Volume Knob Widget&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">AC_WID_BEEP</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Beep Generator Widget&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">AC_WID_VENDOR</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;Vendor Defined Widget&quot;</span><span class="p">,</span>
	<span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wid_value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="s">&quot;UNKNOWN Widget&quot;</span><span class="p">;</span>
	<span class="n">wid_value</span> <span class="o">&amp;=</span> <span class="mh">0xf</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">wid_value</span><span class="p">])</span>
		<span class="k">return</span> <span class="n">names</span><span class="p">[</span><span class="n">wid_value</span><span class="p">];</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="s">&quot;UNKNOWN Widget&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_nid_array</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">snd_array</span> <span class="o">*</span><span class="n">array</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_nid_item</span> <span class="o">*</span><span class="n">items</span> <span class="o">=</span> <span class="n">array</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">,</span> <span class="o">*</span><span class="n">item</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kctl</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">array</span><span class="o">-&gt;</span><span class="n">used</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">item</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">nid</span> <span class="o">==</span> <span class="n">nid</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">kctl</span> <span class="o">=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">kctl</span><span class="p">;</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span>
			  <span class="s">&quot;  Control: name=</span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">, index=%i, device=%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			  <span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">index</span> <span class="o">+</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">,</span>
			  <span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">device</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">HDA_NID_ITEM_AMP</span><span class="p">)</span>
				<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span>
				  <span class="s">&quot;    ControlAmp: chs=%lu, dir=%s, &quot;</span>
				  <span class="s">&quot;idx=%lu, ofs=%lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				  <span class="n">get_amp_channels</span><span class="p">(</span><span class="n">kctl</span><span class="p">),</span>
				  <span class="n">get_amp_direction</span><span class="p">(</span><span class="n">kctl</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;Out&quot;</span> <span class="o">:</span> <span class="s">&quot;In&quot;</span><span class="p">,</span>
				  <span class="n">get_amp_index</span><span class="p">(</span><span class="n">kctl</span><span class="p">),</span>
				  <span class="n">get_amp_offset</span><span class="p">(</span><span class="n">kctl</span><span class="p">));</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_nid_pcms</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">pcm</span><span class="p">,</span> <span class="n">type</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hda_pcm</span> <span class="o">*</span><span class="n">cpcm</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">pcm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">pcm</span> <span class="o">&lt;</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">num_pcms</span><span class="p">;</span> <span class="n">pcm</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cpcm</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">pcm_info</span><span class="p">[</span><span class="n">pcm</span><span class="p">];</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">type</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">type</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">cpcm</span><span class="o">-&gt;</span><span class="n">stream</span><span class="p">[</span><span class="n">type</span><span class="p">].</span><span class="n">nid</span> <span class="o">!=</span> <span class="n">nid</span> <span class="o">||</span> <span class="n">cpcm</span><span class="o">-&gt;</span><span class="n">pcm</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Device: name=</span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">, &quot;</span>
				    <span class="s">&quot;type=</span><span class="se">\&quot;</span><span class="s">%s</span><span class="se">\&quot;</span><span class="s">, device=%i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				    <span class="n">cpcm</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span>
				    <span class="n">snd_hda_pcm_type_name</span><span class="p">[</span><span class="n">cpcm</span><span class="o">-&gt;</span><span class="n">pcm_type</span><span class="p">],</span>
				    <span class="n">cpcm</span><span class="o">-&gt;</span><span class="n">pcm</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_amp_caps</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">caps</span><span class="p">;</span>
	<span class="n">caps</span> <span class="o">=</span> <span class="n">snd_hda_param_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span>
				  <span class="n">dir</span> <span class="o">==</span> <span class="n">HDA_OUTPUT</span> <span class="o">?</span>
				    <span class="n">AC_PAR_AMP_OUT_CAP</span> <span class="o">:</span> <span class="n">AC_PAR_AMP_IN_CAP</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">caps</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;N/A</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;ofs=0x%02x, nsteps=0x%02x, stepsize=0x%02x, &quot;</span>
		    <span class="s">&quot;mute=%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_AMPCAP_OFFSET</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_AMPCAP_NUM_STEPS</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_AMPCAP_NUM_STEPS_SHIFT</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_AMPCAP_STEP_SIZE</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_AMPCAP_STEP_SIZE_SHIFT</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_AMPCAP_MUTE</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_AMPCAP_MUTE_SHIFT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_amp_vals</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span>
			   <span class="kt">int</span> <span class="n">dir</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stereo</span><span class="p">,</span> <span class="kt">int</span> <span class="n">indices</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">dir</span> <span class="o">=</span> <span class="n">dir</span> <span class="o">==</span> <span class="n">HDA_OUTPUT</span> <span class="o">?</span> <span class="n">AC_AMP_GET_OUTPUT</span> <span class="o">:</span> <span class="n">AC_AMP_GET_INPUT</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">indices</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; [&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">stereo</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						 <span class="n">AC_VERB_GET_AMP_GAIN_MUTE</span><span class="p">,</span>
						 <span class="n">AC_AMP_GET_LEFT</span> <span class="o">|</span> <span class="n">dir</span> <span class="o">|</span> <span class="n">i</span><span class="p">);</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;0x%02x &quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					 <span class="n">AC_VERB_GET_AMP_GAIN_MUTE</span><span class="p">,</span>
					 <span class="n">AC_AMP_GET_RIGHT</span> <span class="o">|</span> <span class="n">dir</span> <span class="o">|</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;0x%02x]&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_pcm_rates</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pcm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rates</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">8000</span><span class="p">,</span> <span class="mi">11025</span><span class="p">,</span> <span class="mi">16000</span><span class="p">,</span> <span class="mi">22050</span><span class="p">,</span> <span class="mi">32000</span><span class="p">,</span> <span class="mi">44100</span><span class="p">,</span> <span class="mi">48000</span><span class="p">,</span> <span class="mi">88200</span><span class="p">,</span>
		<span class="mi">96000</span><span class="p">,</span> <span class="mi">176400</span><span class="p">,</span> <span class="mi">192000</span><span class="p">,</span> <span class="mi">384000</span>
	<span class="p">};</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">pcm</span> <span class="o">&amp;=</span> <span class="n">AC_SUPPCM_RATES</span><span class="p">;</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;    rates [0x%x]:&quot;</span><span class="p">,</span> <span class="n">pcm</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rates</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pcm</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span>  <span class="s">&quot; %d&quot;</span><span class="p">,</span> <span class="n">rates</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_pcm_bits</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pcm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">SND_PRINT_BITS_ADVISED_BUFSIZE</span><span class="p">];</span>

	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;    bits [0x%x]:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">pcm</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
	<span class="n">snd_print_pcm_bits</span><span class="p">(</span><span class="n">pcm</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_pcm_formats</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">streams</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;    formats [0x%x]:&quot;</span><span class="p">,</span> <span class="n">streams</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">streams</span> <span class="o">&amp;</span> <span class="n">AC_SUPFMT_PCM</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; PCM&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">streams</span> <span class="o">&amp;</span> <span class="n">AC_SUPFMT_FLOAT32</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; FLOAT&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">streams</span> <span class="o">&amp;</span> <span class="n">AC_SUPFMT_AC3</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; AC3&quot;</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_pcm_caps</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pcm</span> <span class="o">=</span> <span class="n">snd_hda_param_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">AC_PAR_PCM</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stream</span> <span class="o">=</span> <span class="n">snd_hda_param_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">AC_PAR_STREAM</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pcm</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="n">stream</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;N/A</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">print_pcm_rates</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">pcm</span><span class="p">);</span>
	<span class="n">print_pcm_bits</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">pcm</span><span class="p">);</span>
	<span class="n">print_pcm_formats</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">stream</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">get_jack_connection</span><span class="p">(</span><span class="n">u32</span> <span class="n">cfg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">names</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s">&quot;1/8&quot;</span><span class="p">,</span> <span class="s">&quot;1/4&quot;</span><span class="p">,</span> <span class="s">&quot;ATAPI&quot;</span><span class="p">,</span>
		<span class="s">&quot;RCA&quot;</span><span class="p">,</span> <span class="s">&quot;Optical&quot;</span><span class="p">,</span><span class="s">&quot;Digital&quot;</span><span class="p">,</span> <span class="s">&quot;Analog&quot;</span><span class="p">,</span>
		<span class="s">&quot;DIN&quot;</span><span class="p">,</span> <span class="s">&quot;XLR&quot;</span><span class="p">,</span> <span class="s">&quot;RJ11&quot;</span><span class="p">,</span> <span class="s">&quot;Comb&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Other&quot;</span>
	<span class="p">};</span>
	<span class="n">cfg</span> <span class="o">=</span> <span class="p">(</span><span class="n">cfg</span> <span class="o">&amp;</span> <span class="n">AC_DEFCFG_CONN_TYPE</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_DEFCFG_CONN_TYPE_SHIFT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">cfg</span><span class="p">])</span>
		<span class="k">return</span> <span class="n">names</span><span class="p">[</span><span class="n">cfg</span><span class="p">];</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="s">&quot;UNKNOWN&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">get_jack_color</span><span class="p">(</span><span class="n">u32</span> <span class="n">cfg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">names</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Unknown&quot;</span><span class="p">,</span> <span class="s">&quot;Black&quot;</span><span class="p">,</span> <span class="s">&quot;Grey&quot;</span><span class="p">,</span> <span class="s">&quot;Blue&quot;</span><span class="p">,</span>
		<span class="s">&quot;Green&quot;</span><span class="p">,</span> <span class="s">&quot;Red&quot;</span><span class="p">,</span> <span class="s">&quot;Orange&quot;</span><span class="p">,</span> <span class="s">&quot;Yellow&quot;</span><span class="p">,</span>
		<span class="s">&quot;Purple&quot;</span><span class="p">,</span> <span class="s">&quot;Pink&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
		<span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;White&quot;</span><span class="p">,</span> <span class="s">&quot;Other&quot;</span><span class="p">,</span>
	<span class="p">};</span>
	<span class="n">cfg</span> <span class="o">=</span> <span class="p">(</span><span class="n">cfg</span> <span class="o">&amp;</span> <span class="n">AC_DEFCFG_COLOR</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_DEFCFG_COLOR_SHIFT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">cfg</span><span class="p">])</span>
		<span class="k">return</span> <span class="n">names</span><span class="p">[</span><span class="n">cfg</span><span class="p">];</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="s">&quot;UNKNOWN&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_pin_caps</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span>
			   <span class="kt">int</span> <span class="o">*</span><span class="n">supports_vref</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">jack_conns</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Jack&quot;</span><span class="p">,</span> <span class="s">&quot;N/A&quot;</span><span class="p">,</span> <span class="s">&quot;Fixed&quot;</span><span class="p">,</span> <span class="s">&quot;Both&quot;</span> <span class="p">};</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">caps</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">caps</span> <span class="o">=</span> <span class="n">snd_hda_param_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">AC_PAR_PIN_CAP</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Pincap 0x%08x:&quot;</span><span class="p">,</span> <span class="n">caps</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_IN</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; IN&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_OUT</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; OUT&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_HP_DRV</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; HP&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_EAPD</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; EAPD&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_PRES_DETECT</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Detect&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_BALANCE</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Balanced&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_HDMI</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Realtek uses this bit as a different meaning */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_id</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x10ec</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; R/L&quot;</span><span class="p">);</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_HBR</span><span class="p">)</span>
				<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; HBR&quot;</span><span class="p">);</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; HDMI&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_DP</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; DP&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_TRIG_REQ</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Trigger&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_IMP_SENSE</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; ImpSense&quot;</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_VREF</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vref</span> <span class="o">=</span>
			<span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_VREF</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_PINCAP_VREF_SHIFT</span><span class="p">;</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;    Vref caps:&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vref</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_VREF_HIZ</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; HIZ&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vref</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_VREF_50</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; 50&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vref</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_VREF_GRD</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; GRD&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vref</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_VREF_80</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; 80&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vref</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_VREF_100</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; 100&quot;</span><span class="p">);</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="o">*</span><span class="n">supports_vref</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="o">*</span><span class="n">supports_vref</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_PINCAP_EAPD</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					 <span class="n">AC_VERB_GET_EAPD_BTLENABLE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  EAPD 0x%x:&quot;</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">AC_EAPDBTL_BALANCED</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; BALANCED&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">AC_EAPDBTL_EAPD</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; EAPD&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">AC_EAPDBTL_LR_SWAP</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; R/L&quot;</span><span class="p">);</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">caps</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_GET_CONFIG_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Pin Default 0x%08x: [%s] %s at %s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">caps</span><span class="p">,</span>
		    <span class="n">jack_conns</span><span class="p">[(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_DEFCFG_PORT_CONN</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_DEFCFG_PORT_CONN_SHIFT</span><span class="p">],</span>
		    <span class="n">snd_hda_get_jack_type</span><span class="p">(</span><span class="n">caps</span><span class="p">),</span>
		    <span class="n">snd_hda_get_jack_connectivity</span><span class="p">(</span><span class="n">caps</span><span class="p">),</span>
		    <span class="n">snd_hda_get_jack_location</span><span class="p">(</span><span class="n">caps</span><span class="p">));</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;    Conn = %s, Color = %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">get_jack_connection</span><span class="p">(</span><span class="n">caps</span><span class="p">),</span>
		    <span class="n">get_jack_color</span><span class="p">(</span><span class="n">caps</span><span class="p">));</span>
	<span class="cm">/* Default association and sequence values refer to default grouping</span>
<span class="cm">	 * of pin complexes and their sequence within the group. This is used</span>
<span class="cm">	 * for priority and resource allocation.</span>
<span class="cm">	 */</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;    DefAssociation = 0x%x, Sequence = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_DEFCFG_DEF_ASSOC</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_DEFCFG_ASSOC_SHIFT</span><span class="p">,</span>
		    <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_DEFCFG_SEQUENCE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(((</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">AC_DEFCFG_MISC</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_DEFCFG_MISC_SHIFT</span><span class="p">)</span> <span class="o">&amp;</span>
	    <span class="n">AC_DEFCFG_MISC_NO_PRESENCE</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Miscellaneous bit indicates external hardware does not</span>
<span class="cm">		 * support presence detection even if the pin complex</span>
<span class="cm">		 * indicates it is supported.</span>
<span class="cm">		 */</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;    Misc = NO_PRESENCE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_pin_ctls</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span>
			   <span class="kt">int</span> <span class="n">supports_vref</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pinctls</span><span class="p">;</span>

	<span class="n">pinctls</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				     <span class="n">AC_VERB_GET_PIN_WIDGET_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Pin-ctls: 0x%02x:&quot;</span><span class="p">,</span> <span class="n">pinctls</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pinctls</span> <span class="o">&amp;</span> <span class="n">AC_PINCTL_IN_EN</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; IN&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pinctls</span> <span class="o">&amp;</span> <span class="n">AC_PINCTL_OUT_EN</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; OUT&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pinctls</span> <span class="o">&amp;</span> <span class="n">AC_PINCTL_HP_EN</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; HP&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">supports_vref</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">vref</span> <span class="o">=</span> <span class="n">pinctls</span> <span class="o">&amp;</span> <span class="n">AC_PINCTL_VREFEN</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">vref</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">AC_PINCTL_VREF_HIZ</span>:
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; VREF_HIZ&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">AC_PINCTL_VREF_50</span>:
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; VREF_50&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">AC_PINCTL_VREF_GRD</span>:
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; VREF_GRD&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">AC_PINCTL_VREF_80</span>:
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; VREF_80&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">AC_PINCTL_VREF_100</span>:
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; VREF_100&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_vol_knob</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cap</span> <span class="o">=</span> <span class="n">snd_hda_param_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span>
					      <span class="n">AC_PAR_VOL_KNB_CAP</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Volume-Knob: delta=%d, steps=%d, &quot;</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">cap</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cap</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
	<span class="n">cap</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				 <span class="n">AC_VERB_GET_VOLUME_KNOB_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;direct=%d, val=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">cap</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cap</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_audio_io</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span>
			   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wid_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">conv</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC_VERB_GET_CONV</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span>
		    <span class="s">&quot;  Converter: stream=%d, channel=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">conv</span> <span class="o">&amp;</span> <span class="n">AC_CONV_STREAM</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_CONV_STREAM_SHIFT</span><span class="p">,</span>
		    <span class="n">conv</span> <span class="o">&amp;</span> <span class="n">AC_CONV_CHANNEL</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wid_type</span> <span class="o">==</span> <span class="n">AC_WID_AUD_IN</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">conv</span> <span class="o">&amp;</span> <span class="n">AC_CONV_CHANNEL</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">sdi</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					     <span class="n">AC_VERB_GET_SDI_SELECT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  SDI-Select: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			    <span class="n">sdi</span> <span class="o">&amp;</span> <span class="n">AC_SDI_SELECT</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_digital_conv</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">digi1</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						<span class="n">AC_VERB_GET_DIGI_CONVERT_1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Digital:&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">digi1</span> <span class="o">&amp;</span> <span class="n">AC_DIG1_ENABLE</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Enabled&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">digi1</span> <span class="o">&amp;</span> <span class="n">AC_DIG1_V</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Validity&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">digi1</span> <span class="o">&amp;</span> <span class="n">AC_DIG1_VCFG</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; ValidityCfg&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">digi1</span> <span class="o">&amp;</span> <span class="n">AC_DIG1_EMPHASIS</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Preemphasis&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">digi1</span> <span class="o">&amp;</span> <span class="n">AC_DIG1_COPYRIGHT</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Copyright&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">digi1</span> <span class="o">&amp;</span> <span class="n">AC_DIG1_NONAUDIO</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Non-Audio&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">digi1</span> <span class="o">&amp;</span> <span class="n">AC_DIG1_PROFESSIONAL</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Pro&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">digi1</span> <span class="o">&amp;</span> <span class="n">AC_DIG1_LEVEL</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; GenLevel&quot;</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Digital category: 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">digi1</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">AC_DIG2_CC</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">get_pwr_state</span><span class="p">(</span><span class="n">u32</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">buf</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;D0&quot;</span><span class="p">,</span> <span class="s">&quot;D1&quot;</span><span class="p">,</span> <span class="s">&quot;D2&quot;</span><span class="p">,</span> <span class="s">&quot;D3&quot;</span>
	<span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">state</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">buf</span><span class="p">[</span><span class="n">state</span><span class="p">];</span>
	<span class="k">return</span> <span class="s">&quot;UNKNOWN&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_power_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">names</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">[</span><span class="n">ilog2</span><span class="p">(</span><span class="n">AC_PWRST_D0SUP</span><span class="p">)]</span>		<span class="o">=</span> <span class="s">&quot;D0&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">ilog2</span><span class="p">(</span><span class="n">AC_PWRST_D1SUP</span><span class="p">)]</span>		<span class="o">=</span> <span class="s">&quot;D1&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">ilog2</span><span class="p">(</span><span class="n">AC_PWRST_D2SUP</span><span class="p">)]</span>		<span class="o">=</span> <span class="s">&quot;D2&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">ilog2</span><span class="p">(</span><span class="n">AC_PWRST_D3SUP</span><span class="p">)]</span>		<span class="o">=</span> <span class="s">&quot;D3&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">ilog2</span><span class="p">(</span><span class="n">AC_PWRST_D3COLDSUP</span><span class="p">)]</span>	<span class="o">=</span> <span class="s">&quot;D3cold&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">ilog2</span><span class="p">(</span><span class="n">AC_PWRST_S3D3COLDSUP</span><span class="p">)]</span>	<span class="o">=</span> <span class="s">&quot;S3D3cold&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">ilog2</span><span class="p">(</span><span class="n">AC_PWRST_CLKSTOP</span><span class="p">)]</span>	<span class="o">=</span> <span class="s">&quot;CLKSTOP&quot;</span><span class="p">,</span>
		<span class="p">[</span><span class="n">ilog2</span><span class="p">(</span><span class="n">AC_PWRST_EPSS</span><span class="p">)]</span>		<span class="o">=</span> <span class="s">&quot;EPSS&quot;</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="kt">int</span> <span class="n">sup</span> <span class="o">=</span> <span class="n">snd_hda_param_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">AC_PAR_POWER_STATE</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">pwr</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				     <span class="n">AC_VERB_GET_POWER_STATE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sup</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Power states: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			    <span class="n">bits_names</span><span class="p">(</span><span class="n">sup</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">names</span><span class="p">)));</span>

	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Power: setting=%s, actual=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">get_pwr_state</span><span class="p">(</span><span class="n">pwr</span> <span class="o">&amp;</span> <span class="n">AC_PWRST_SETTING</span><span class="p">),</span>
		    <span class="n">get_pwr_state</span><span class="p">((</span><span class="n">pwr</span> <span class="o">&amp;</span> <span class="n">AC_PWRST_ACTUAL</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
				  <span class="n">AC_PWRST_ACTUAL_SHIFT</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_unsol_cap</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">unsol</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				       <span class="n">AC_VERB_GET_UNSOLICITED_RESPONSE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span>
		    <span class="s">&quot;  Unsolicited: tag=%02x, enabled=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">unsol</span> <span class="o">&amp;</span> <span class="n">AC_UNSOL_TAG</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">unsol</span> <span class="o">&amp;</span> <span class="n">AC_UNSOL_ENABLED</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_proc_caps</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">proc_caps</span> <span class="o">=</span> <span class="n">snd_hda_param_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span>
						    <span class="n">AC_PAR_PROC_CAP</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Processing caps: benign=%d, ncoeff=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">proc_caps</span> <span class="o">&amp;</span> <span class="n">AC_PCAP_BENIGN</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">proc_caps</span> <span class="o">&amp;</span> <span class="n">AC_PCAP_NUM_COEF</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_PCAP_NUM_COEF_SHIFT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_conn_list</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">,</span>
			    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wid_type</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="o">*</span><span class="n">conn</span><span class="p">,</span>
			    <span class="kt">int</span> <span class="n">conn_len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="n">curr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">conn_len</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>
	    <span class="n">wid_type</span> <span class="o">!=</span> <span class="n">AC_WID_AUD_MIX</span> <span class="o">&amp;&amp;</span>
	    <span class="n">wid_type</span> <span class="o">!=</span> <span class="n">AC_WID_VOL_KNB</span> <span class="o">&amp;&amp;</span>
	    <span class="n">wid_type</span> <span class="o">!=</span> <span class="n">AC_WID_POWER</span><span class="p">)</span>
		<span class="n">curr</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					  <span class="n">AC_VERB_GET_CONNECT_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Connection: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">conn_len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">conn_len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;    &quot;</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">conn_len</span><span class="p">;</span> <span class="n">c</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; 0x%02x&quot;</span><span class="p">,</span> <span class="n">conn</span><span class="p">[</span><span class="n">c</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">curr</span><span class="p">)</span>
				<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;*&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_gpio</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gpio</span> <span class="o">=</span>
		<span class="n">snd_hda_param_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg</span><span class="p">,</span> <span class="n">AC_PAR_GPIO_CAP</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">wake</span><span class="p">,</span> <span class="n">unsol</span><span class="p">,</span> <span class="n">sticky</span><span class="p">,</span> <span class="n">data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">max</span><span class="p">;</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;GPIO: io=%d, o=%d, i=%d, &quot;</span>
		    <span class="s">&quot;unsolicited=%d, wake=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">gpio</span> <span class="o">&amp;</span> <span class="n">AC_GPIO_IO_COUNT</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">gpio</span> <span class="o">&amp;</span> <span class="n">AC_GPIO_O_COUNT</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_GPIO_O_COUNT_SHIFT</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">gpio</span> <span class="o">&amp;</span> <span class="n">AC_GPIO_I_COUNT</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">AC_GPIO_I_COUNT_SHIFT</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">gpio</span> <span class="o">&amp;</span> <span class="n">AC_GPIO_UNSOLICITED</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
		    <span class="p">(</span><span class="n">gpio</span> <span class="o">&amp;</span> <span class="n">AC_GPIO_WAKE</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">max</span> <span class="o">=</span> <span class="n">gpio</span> <span class="o">&amp;</span> <span class="n">AC_GPIO_IO_COUNT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">max</span> <span class="o">||</span> <span class="n">max</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">enable</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				    <span class="n">AC_VERB_GET_GPIO_MASK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">direction</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				       <span class="n">AC_VERB_GET_GPIO_DIRECTION</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">wake</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				  <span class="n">AC_VERB_GET_GPIO_WAKE_MASK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">unsol</span>  <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				    <span class="n">AC_VERB_GET_GPIO_UNSOLICITED_RSP_MASK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">sticky</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				    <span class="n">AC_VERB_GET_GPIO_STICKY_MASK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">snd_hda_codec_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				  <span class="n">AC_VERB_GET_GPIO_DATA</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">max</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span>
			    <span class="s">&quot;  IO[%d]: enable=%d, dir=%d, wake=%d, &quot;</span>
			    <span class="s">&quot;sticky=%d, data=%d, unsol=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
			    <span class="p">(</span><span class="n">enable</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="p">(</span><span class="n">direction</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="p">(</span><span class="n">wake</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="p">(</span><span class="n">sticky</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
			    <span class="p">(</span><span class="n">unsol</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">))</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="cm">/* FIXME: add GPO and GPI pin information */</span>
	<span class="n">print_nid_array</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">);</span>
	<span class="n">print_nid_array</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">nids</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_codec_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_info_entry</span> <span class="o">*</span><span class="n">entry</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">snd_info_buffer</span> <span class="o">*</span><span class="n">buffer</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="n">hda_nid_t</span> <span class="n">nid</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">nodes</span><span class="p">;</span>

	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Codec: &quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_name</span> <span class="o">&amp;&amp;</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">chip_name</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;%s %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			    <span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_name</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">chip_name</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Not Set</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Address: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;AFG Function Id: 0x%x (unsol %u)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg_function_id</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg_unsol</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">mfg</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;MFG Function Id: 0x%x (unsol %u)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">codec</span><span class="o">-&gt;</span><span class="n">mfg_function_id</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">mfg_unsol</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Vendor Id: 0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">vendor_id</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Subsystem Id: 0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">subsystem_id</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Revision Id: 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">revision_id</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">mfg</span><span class="p">)</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Modem Function Group: 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">mfg</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;No Modem Function Group found</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">snd_hda_power_up</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Default PCM:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">print_pcm_caps</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Default Amp-In caps: &quot;</span><span class="p">);</span>
	<span class="n">print_amp_caps</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">);</span>
	<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Default Amp-Out caps: &quot;</span><span class="p">);</span>
	<span class="n">print_amp_caps</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>

	<span class="n">nodes</span> <span class="o">=</span> <span class="n">snd_hda_get_sub_nodes</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">nid</span> <span class="o">||</span> <span class="n">nodes</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Invalid AFG subtree</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_hda_power_down</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">print_gpio</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">proc_widget_hook</span><span class="p">)</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">proc_widget_hook</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">afg</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nodes</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">nid</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wid_caps</span> <span class="o">=</span>
			<span class="n">snd_hda_param_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span>
					   <span class="n">AC_PAR_AUDIO_WIDGET_CAP</span><span class="p">);</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">wid_type</span> <span class="o">=</span> <span class="n">get_wcaps_type</span><span class="p">(</span><span class="n">wid_caps</span><span class="p">);</span>
		<span class="n">hda_nid_t</span> <span class="n">conn</span><span class="p">[</span><span class="n">HDA_MAX_CONNECTIONS</span><span class="p">];</span>
		<span class="kt">int</span> <span class="n">conn_len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;Node 0x%02x [%s] wcaps 0x%x:&quot;</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span>
			    <span class="n">get_wid_type_name</span><span class="p">(</span><span class="n">wid_type</span><span class="p">),</span> <span class="n">wid_caps</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_STEREO</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">chans</span> <span class="o">=</span> <span class="n">get_wcaps_channels</span><span class="p">(</span><span class="n">wid_caps</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">chans</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
				<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Stereo&quot;</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; %d-Channels&quot;</span><span class="p">,</span> <span class="n">chans</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Mono&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_DIGITAL</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Digital&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_IN_AMP</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Amp-In&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_OUT_AMP</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Amp-Out&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_STRIPE</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; Stripe&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_LR_SWAP</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; R/L&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_CP_CAPS</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot; CP&quot;</span><span class="p">);</span>
		<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

		<span class="n">print_nid_array</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">mixers</span><span class="p">);</span>
		<span class="n">print_nid_array</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">nids</span><span class="p">);</span>
		<span class="n">print_nid_pcms</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>

		<span class="cm">/* volume knob is a special widget that always have connection</span>
<span class="cm">		 * list</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wid_type</span> <span class="o">==</span> <span class="n">AC_WID_VOL_KNB</span><span class="p">)</span>
			<span class="n">wid_caps</span> <span class="o">|=</span> <span class="n">AC_WCAP_CONN_LIST</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_CONN_LIST</span><span class="p">)</span>
			<span class="n">conn_len</span> <span class="o">=</span> <span class="n">snd_hda_get_raw_connections</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span>
							   <span class="n">HDA_MAX_CONNECTIONS</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_IN_AMP</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Amp-In caps: &quot;</span><span class="p">);</span>
			<span class="n">print_amp_caps</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">);</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Amp-In vals: &quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">wid_type</span> <span class="o">==</span> <span class="n">AC_WID_PIN</span> <span class="o">||</span>
			    <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">single_adc_amp</span> <span class="o">&amp;&amp;</span>
			     <span class="n">wid_type</span> <span class="o">==</span> <span class="n">AC_WID_AUD_IN</span><span class="p">))</span>
				<span class="n">print_amp_vals</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span>
					       <span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_STEREO</span><span class="p">,</span>
					       <span class="mi">1</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">print_amp_vals</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_INPUT</span><span class="p">,</span>
					       <span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_STEREO</span><span class="p">,</span>
					       <span class="n">conn_len</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_OUT_AMP</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Amp-Out caps: &quot;</span><span class="p">);</span>
			<span class="n">print_amp_caps</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">);</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Amp-Out vals: &quot;</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">wid_type</span> <span class="o">==</span> <span class="n">AC_WID_PIN</span> <span class="o">&amp;&amp;</span>
			    <span class="n">codec</span><span class="o">-&gt;</span><span class="n">pin_amp_workaround</span><span class="p">)</span>
				<span class="n">print_amp_vals</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span>
					       <span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_STEREO</span><span class="p">,</span>
					       <span class="n">conn_len</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">print_amp_vals</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">HDA_OUTPUT</span><span class="p">,</span>
					       <span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_STEREO</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">wid_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">AC_WID_PIN</span>: <span class="p">{</span>
			<span class="kt">int</span> <span class="n">supports_vref</span><span class="p">;</span>
			<span class="n">print_pin_caps</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">supports_vref</span><span class="p">);</span>
			<span class="n">print_pin_ctls</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">supports_vref</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">case</span> <span class="n">AC_WID_VOL_KNB</span>:
			<span class="n">print_vol_knob</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">AC_WID_AUD_OUT</span>:
		<span class="k">case</span> <span class="n">AC_WID_AUD_IN</span>:
			<span class="n">print_audio_io</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">wid_type</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_DIGITAL</span><span class="p">)</span>
				<span class="n">print_digital_conv</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_FORMAT_OVRD</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  PCM:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">print_pcm_caps</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_UNSOL_CAP</span><span class="p">)</span>
			<span class="n">print_unsol_cap</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_POWER</span><span class="p">)</span>
			<span class="n">print_power_state</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_DELAY</span><span class="p">)</span>
			<span class="n">snd_iprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">&quot;  Delay: %d samples</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				    <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_DELAY</span><span class="p">)</span> <span class="o">&gt;&gt;</span>
				    <span class="n">AC_WCAP_DELAY_SHIFT</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_CONN_LIST</span><span class="p">)</span>
			<span class="n">print_conn_list</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">,</span> <span class="n">wid_type</span><span class="p">,</span>
					<span class="n">conn</span><span class="p">,</span> <span class="n">conn_len</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">wid_caps</span> <span class="o">&amp;</span> <span class="n">AC_WCAP_PROC_WID</span><span class="p">)</span>
			<span class="n">print_proc_caps</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">proc_widget_hook</span><span class="p">)</span>
			<span class="n">codec</span><span class="o">-&gt;</span><span class="n">proc_widget_hook</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">nid</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">snd_hda_power_down</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * create a proc read</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">snd_hda_codec_proc_new</span><span class="p">(</span><span class="k">struct</span> <span class="n">hda_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">snd_info_entry</span> <span class="o">*</span><span class="n">entry</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">snprintf</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="s">&quot;codec#%d&quot;</span><span class="p">,</span> <span class="n">codec</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">);</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_card_proc_new</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">bus</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">entry</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">snd_info_set_text_ops</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span> <span class="n">print_codec_info</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
