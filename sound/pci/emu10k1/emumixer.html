<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › pci › emu10k1 › emumixer.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>emumixer.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  Copyright (c) by Jaroslav Kysela &lt;perex@perex.cz&gt;,</span>
<span class="cm"> *                   Takashi Iwai &lt;tiwai@suse.de&gt;</span>
<span class="cm"> *                   Creative Labs, Inc.</span>
<span class="cm"> *  Routines for control of EMU10K1 chips / mixer routines</span>
<span class="cm"> *  Multichannel PCM support Copyright (c) Lee Revell &lt;rlrevell@joe-job.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (c) by James Courtier-Dutton &lt;James@superbug.co.uk&gt;</span>
<span class="cm"> *  	Added EMU 1010 support.</span>
<span class="cm"> *</span>
<span class="cm"> *  BUGS:</span>
<span class="cm"> *    --</span>
<span class="cm"> *</span>
<span class="cm"> *  TODO:</span>
<span class="cm"> *    --</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/time.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;sound/core.h&gt;</span>
<span class="cp">#include &lt;sound/emu10k1.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;sound/tlv.h&gt;</span>

<span class="cp">#include &quot;p17v.h&quot;</span>

<span class="cp">#define AC97_ID_STAC9758	0x83847658</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">snd_audigy_db_scale2</span><span class="p">,</span> <span class="o">-</span><span class="mi">10350</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="cm">/* WM8775 gain scale */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_spdif_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_IEC958</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_spdif_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="cm">/* Limit: emu-&gt;spdif_bits */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">spdif_bits</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">spdif_bits</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">spdif_bits</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">spdif_bits</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_spdif_get_mask</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Items labels in enum mixer controls assigning source data to</span>
<span class="cm"> * each destination</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">emu1010_src_texts</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> 
	<span class="s">&quot;Silence&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock Mic A&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock Mic B&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock ADC1 Left&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock ADC1 Right&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock ADC2 Left&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock ADC2 Right&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock ADC3 Left&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock ADC3 Right&quot;</span><span class="p">,</span>
	<span class="s">&quot;0202 ADC Left&quot;</span><span class="p">,</span>
	<span class="s">&quot;0202 ADC Right&quot;</span><span class="p">,</span>
	<span class="s">&quot;0202 SPDIF Left&quot;</span><span class="p">,</span>
	<span class="s">&quot;0202 SPDIF Right&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 0&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 1&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 2&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 3&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 4&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 5&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 6&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 7&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 0&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 1&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 2&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 3&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 4&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 5&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 6&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 7&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 8&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 9&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 10&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 11&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 12&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 13&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 14&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 15&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 16&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 17&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 18&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 19&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 20&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 21&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 22&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 23&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 24&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 25&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 26&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 27&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 28&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 29&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 30&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 31&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* 1616(m) cardbus */</span>

<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">emu1616_src_texts</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Silence&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock Mic A&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock Mic B&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock ADC1 Left&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock ADC1 Right&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock ADC2 Left&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock ADC2 Right&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock SPDIF Left&quot;</span><span class="p">,</span>
	<span class="s">&quot;Dock SPDIF Right&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 0&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 1&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 2&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 3&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 4&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 5&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 6&quot;</span><span class="p">,</span>
	<span class="s">&quot;ADAT 7&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 0&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 1&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 2&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 3&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 4&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 5&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 6&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 7&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 8&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 9&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 10&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 11&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 12&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 13&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 14&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 15&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 16&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 17&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 18&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 19&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 20&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 21&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 22&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 23&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 24&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 25&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 26&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 27&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 28&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 29&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 30&quot;</span><span class="p">,</span>
	<span class="s">&quot;DSP 31&quot;</span><span class="p">,</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * List of data sources available for each destination</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">emu1010_src_regs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EMU_SRC_SILENCE</span><span class="p">,</span><span class="cm">/* 0 */</span>
	<span class="n">EMU_SRC_DOCK_MIC_A1</span><span class="p">,</span> <span class="cm">/* 1 */</span>
	<span class="n">EMU_SRC_DOCK_MIC_B1</span><span class="p">,</span> <span class="cm">/* 2 */</span>
	<span class="n">EMU_SRC_DOCK_ADC1_LEFT1</span><span class="p">,</span> <span class="cm">/* 3 */</span>
	<span class="n">EMU_SRC_DOCK_ADC1_RIGHT1</span><span class="p">,</span> <span class="cm">/* 4 */</span>
	<span class="n">EMU_SRC_DOCK_ADC2_LEFT1</span><span class="p">,</span> <span class="cm">/* 5 */</span>
	<span class="n">EMU_SRC_DOCK_ADC2_RIGHT1</span><span class="p">,</span> <span class="cm">/* 6 */</span>
	<span class="n">EMU_SRC_DOCK_ADC3_LEFT1</span><span class="p">,</span> <span class="cm">/* 7 */</span>
	<span class="n">EMU_SRC_DOCK_ADC3_RIGHT1</span><span class="p">,</span> <span class="cm">/* 8 */</span>
	<span class="n">EMU_SRC_HAMOA_ADC_LEFT1</span><span class="p">,</span> <span class="cm">/* 9 */</span>
	<span class="n">EMU_SRC_HAMOA_ADC_RIGHT1</span><span class="p">,</span> <span class="cm">/* 10 */</span>
	<span class="n">EMU_SRC_HANA_SPDIF_LEFT1</span><span class="p">,</span> <span class="cm">/* 11 */</span>
	<span class="n">EMU_SRC_HANA_SPDIF_RIGHT1</span><span class="p">,</span> <span class="cm">/* 12 */</span>
	<span class="n">EMU_SRC_HANA_ADAT</span><span class="p">,</span> <span class="cm">/* 13 */</span>
	<span class="n">EMU_SRC_HANA_ADAT</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="cm">/* 14 */</span>
	<span class="n">EMU_SRC_HANA_ADAT</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="cm">/* 15 */</span>
	<span class="n">EMU_SRC_HANA_ADAT</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="cm">/* 16 */</span>
	<span class="n">EMU_SRC_HANA_ADAT</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="cm">/* 17 */</span>
	<span class="n">EMU_SRC_HANA_ADAT</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="cm">/* 18 */</span>
	<span class="n">EMU_SRC_HANA_ADAT</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span> <span class="cm">/* 19 */</span>
	<span class="n">EMU_SRC_HANA_ADAT</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span> <span class="cm">/* 20 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="p">,</span> <span class="cm">/* 21 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="cm">/* 22 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="cm">/* 23 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="cm">/* 24 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="cm">/* 25 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="cm">/* 26 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span> <span class="cm">/* 27 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span> <span class="cm">/* 28 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="cm">/* 29 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">9</span><span class="p">,</span> <span class="cm">/* 30 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xa</span><span class="p">,</span> <span class="cm">/* 31 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xb</span><span class="p">,</span> <span class="cm">/* 32 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xc</span><span class="p">,</span> <span class="cm">/* 33 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xd</span><span class="p">,</span> <span class="cm">/* 34 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xe</span><span class="p">,</span> <span class="cm">/* 35 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xf</span><span class="p">,</span> <span class="cm">/* 36 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="p">,</span> <span class="cm">/* 37 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="cm">/* 38 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="cm">/* 39 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="cm">/* 40 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="cm">/* 41 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="cm">/* 42 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span> <span class="cm">/* 43 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span> <span class="cm">/* 44 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span> <span class="cm">/* 45 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">9</span><span class="p">,</span> <span class="cm">/* 46 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xa</span><span class="p">,</span> <span class="cm">/* 47 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xb</span><span class="p">,</span> <span class="cm">/* 48 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xc</span><span class="p">,</span> <span class="cm">/* 49 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xd</span><span class="p">,</span> <span class="cm">/* 50 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xe</span><span class="p">,</span> <span class="cm">/* 51 */</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xf</span><span class="p">,</span> <span class="cm">/* 52 */</span>
<span class="p">};</span>

<span class="cm">/* 1616(m) cardbus */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">emu1616_src_regs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EMU_SRC_SILENCE</span><span class="p">,</span>
	<span class="n">EMU_SRC_DOCK_MIC_A1</span><span class="p">,</span>
	<span class="n">EMU_SRC_DOCK_MIC_B1</span><span class="p">,</span>
	<span class="n">EMU_SRC_DOCK_ADC1_LEFT1</span><span class="p">,</span>
	<span class="n">EMU_SRC_DOCK_ADC1_RIGHT1</span><span class="p">,</span>
	<span class="n">EMU_SRC_DOCK_ADC2_LEFT1</span><span class="p">,</span>
	<span class="n">EMU_SRC_DOCK_ADC2_RIGHT1</span><span class="p">,</span>
	<span class="n">EMU_SRC_MDOCK_SPDIF_LEFT1</span><span class="p">,</span>
	<span class="n">EMU_SRC_MDOCK_SPDIF_RIGHT1</span><span class="p">,</span>
	<span class="n">EMU_SRC_MDOCK_ADAT</span><span class="p">,</span>
	<span class="n">EMU_SRC_MDOCK_ADAT</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">EMU_SRC_MDOCK_ADAT</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
	<span class="n">EMU_SRC_MDOCK_ADAT</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span>
	<span class="n">EMU_SRC_MDOCK_ADAT</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span>
	<span class="n">EMU_SRC_MDOCK_ADAT</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span>
	<span class="n">EMU_SRC_MDOCK_ADAT</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span>
	<span class="n">EMU_SRC_MDOCK_ADAT</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mi">9</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xa</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xb</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xc</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xd</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xe</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32A</span><span class="o">+</span><span class="mh">0xf</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">8</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mi">9</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xa</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xb</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xc</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xd</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xe</span><span class="p">,</span>
	<span class="n">EMU_SRC_ALICE_EMU32B</span><span class="o">+</span><span class="mh">0xf</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Data destinations - physical EMU outputs.</span>
<span class="cm"> * Each destination has an enum mixer control to choose a data source</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">emu1010_output_dst</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EMU_DST_DOCK_DAC1_LEFT1</span><span class="p">,</span> <span class="cm">/* 0 */</span>
	<span class="n">EMU_DST_DOCK_DAC1_RIGHT1</span><span class="p">,</span> <span class="cm">/* 1 */</span>
	<span class="n">EMU_DST_DOCK_DAC2_LEFT1</span><span class="p">,</span> <span class="cm">/* 2 */</span>
	<span class="n">EMU_DST_DOCK_DAC2_RIGHT1</span><span class="p">,</span> <span class="cm">/* 3 */</span>
	<span class="n">EMU_DST_DOCK_DAC3_LEFT1</span><span class="p">,</span> <span class="cm">/* 4 */</span>
	<span class="n">EMU_DST_DOCK_DAC3_RIGHT1</span><span class="p">,</span> <span class="cm">/* 5 */</span>
	<span class="n">EMU_DST_DOCK_DAC4_LEFT1</span><span class="p">,</span> <span class="cm">/* 6 */</span>
	<span class="n">EMU_DST_DOCK_DAC4_RIGHT1</span><span class="p">,</span> <span class="cm">/* 7 */</span>
	<span class="n">EMU_DST_DOCK_PHONES_LEFT1</span><span class="p">,</span> <span class="cm">/* 8 */</span>
	<span class="n">EMU_DST_DOCK_PHONES_RIGHT1</span><span class="p">,</span> <span class="cm">/* 9 */</span>
	<span class="n">EMU_DST_DOCK_SPDIF_LEFT1</span><span class="p">,</span> <span class="cm">/* 10 */</span>
	<span class="n">EMU_DST_DOCK_SPDIF_RIGHT1</span><span class="p">,</span> <span class="cm">/* 11 */</span>
	<span class="n">EMU_DST_HANA_SPDIF_LEFT1</span><span class="p">,</span> <span class="cm">/* 12 */</span>
	<span class="n">EMU_DST_HANA_SPDIF_RIGHT1</span><span class="p">,</span> <span class="cm">/* 13 */</span>
	<span class="n">EMU_DST_HAMOA_DAC_LEFT1</span><span class="p">,</span> <span class="cm">/* 14 */</span>
	<span class="n">EMU_DST_HAMOA_DAC_RIGHT1</span><span class="p">,</span> <span class="cm">/* 15 */</span>
	<span class="n">EMU_DST_HANA_ADAT</span><span class="p">,</span> <span class="cm">/* 16 */</span>
	<span class="n">EMU_DST_HANA_ADAT</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="cm">/* 17 */</span>
	<span class="n">EMU_DST_HANA_ADAT</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="cm">/* 18 */</span>
	<span class="n">EMU_DST_HANA_ADAT</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="cm">/* 19 */</span>
	<span class="n">EMU_DST_HANA_ADAT</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span> <span class="cm">/* 20 */</span>
	<span class="n">EMU_DST_HANA_ADAT</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="cm">/* 21 */</span>
	<span class="n">EMU_DST_HANA_ADAT</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span> <span class="cm">/* 22 */</span>
	<span class="n">EMU_DST_HANA_ADAT</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span> <span class="cm">/* 23 */</span>
<span class="p">};</span>

<span class="cm">/* 1616(m) cardbus */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">emu1616_output_dst</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EMU_DST_DOCK_DAC1_LEFT1</span><span class="p">,</span>
	<span class="n">EMU_DST_DOCK_DAC1_RIGHT1</span><span class="p">,</span>
	<span class="n">EMU_DST_DOCK_DAC2_LEFT1</span><span class="p">,</span>
	<span class="n">EMU_DST_DOCK_DAC2_RIGHT1</span><span class="p">,</span>
	<span class="n">EMU_DST_DOCK_DAC3_LEFT1</span><span class="p">,</span>
	<span class="n">EMU_DST_DOCK_DAC3_RIGHT1</span><span class="p">,</span>
	<span class="n">EMU_DST_MDOCK_SPDIF_LEFT1</span><span class="p">,</span>
	<span class="n">EMU_DST_MDOCK_SPDIF_RIGHT1</span><span class="p">,</span>
	<span class="n">EMU_DST_MDOCK_ADAT</span><span class="p">,</span>
	<span class="n">EMU_DST_MDOCK_ADAT</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">EMU_DST_MDOCK_ADAT</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
	<span class="n">EMU_DST_MDOCK_ADAT</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span>
	<span class="n">EMU_DST_MDOCK_ADAT</span><span class="o">+</span><span class="mi">4</span><span class="p">,</span>
	<span class="n">EMU_DST_MDOCK_ADAT</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span>
	<span class="n">EMU_DST_MDOCK_ADAT</span><span class="o">+</span><span class="mi">6</span><span class="p">,</span>
	<span class="n">EMU_DST_MDOCK_ADAT</span><span class="o">+</span><span class="mi">7</span><span class="p">,</span>
	<span class="n">EMU_DST_MANA_DAC_LEFT</span><span class="p">,</span>
	<span class="n">EMU_DST_MANA_DAC_RIGHT</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Data destinations - HANA outputs going to Alice2 (audigy) for</span>
<span class="cm"> *   capture (EMU32 + I2S links)</span>
<span class="cm"> * Each destination has an enum mixer control to choose a data source</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">emu1010_input_dst</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EMU_DST_ALICE2_EMU32_0</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_1</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_2</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_3</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_4</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_5</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_6</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_7</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_8</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_9</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_A</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_B</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_C</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_D</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_E</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE2_EMU32_F</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE_I2S0_LEFT</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE_I2S0_RIGHT</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE_I2S1_LEFT</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE_I2S1_RIGHT</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE_I2S2_LEFT</span><span class="p">,</span>
	<span class="n">EMU_DST_ALICE_I2S2_RIGHT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_input_output_source_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
						<span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">char</span> <span class="o">**</span><span class="n">items</span><span class="p">;</span>

	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_ENUMERATED</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">emu_model</span> <span class="o">==</span> <span class="n">EMU_MODEL_EMU1616</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="mi">49</span><span class="p">;</span>
		<span class="n">items</span> <span class="o">=</span> <span class="n">emu1616_src_texts</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="mi">53</span><span class="p">;</span>
		<span class="n">items</span> <span class="o">=</span> <span class="n">emu1010_src_texts</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">&gt;=</span> <span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span><span class="p">)</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span>
			<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
	       <span class="n">items</span><span class="p">[</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_output_source_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">;</span>

	<span class="n">channel</span> <span class="o">=</span> <span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="cm">/* Limit: emu1010_output_dst, emu-&gt;emu1010.output_source */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">&gt;=</span> <span class="mi">24</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">emu_model</span> <span class="o">==</span> <span class="n">EMU_MODEL_EMU1616</span> <span class="o">&amp;&amp;</span>
	     <span class="n">channel</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">output_source</span><span class="p">[</span><span class="n">channel</span><span class="p">];</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_output_source_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="mi">53</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">emu_model</span> <span class="o">==</span> <span class="n">EMU_MODEL_EMU1616</span> <span class="o">&amp;&amp;</span>
	     <span class="n">val</span> <span class="o">&gt;=</span> <span class="mi">49</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">channel</span> <span class="o">=</span> <span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="cm">/* Limit: emu1010_output_dst, emu-&gt;emu1010.output_source */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">&gt;=</span> <span class="mi">24</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">emu_model</span> <span class="o">==</span> <span class="n">EMU_MODEL_EMU1616</span> <span class="o">&amp;&amp;</span>
	     <span class="n">channel</span> <span class="o">&gt;=</span> <span class="mi">18</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">output_source</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">output_source</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">emu_model</span> <span class="o">==</span> <span class="n">EMU_MODEL_EMU1616</span><span class="p">)</span>
		<span class="n">snd_emu1010_fpga_link_dst_src_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span>
			<span class="n">emu1616_output_dst</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">emu1616_src_regs</span><span class="p">[</span><span class="n">val</span><span class="p">]);</span>
	<span class="k">else</span>
		<span class="n">snd_emu1010_fpga_link_dst_src_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span>
			<span class="n">emu1010_output_dst</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">emu1010_src_regs</span><span class="p">[</span><span class="n">val</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_input_source_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">;</span>

	<span class="n">channel</span> <span class="o">=</span> <span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="cm">/* Limit: emu1010_input_dst, emu-&gt;emu1010.input_source */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">&gt;=</span> <span class="mi">22</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">input_source</span><span class="p">[</span><span class="n">channel</span><span class="p">];</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_input_source_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="mi">53</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">emu_model</span> <span class="o">==</span> <span class="n">EMU_MODEL_EMU1616</span> <span class="o">&amp;&amp;</span>
	     <span class="n">val</span> <span class="o">&gt;=</span> <span class="mi">49</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">channel</span> <span class="o">=</span> <span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="cm">/* Limit: emu1010_input_dst, emu-&gt;emu1010.input_source */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">&gt;=</span> <span class="mi">22</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">input_source</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">==</span> <span class="n">val</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">input_source</span><span class="p">[</span><span class="n">channel</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">emu_model</span> <span class="o">==</span> <span class="n">EMU_MODEL_EMU1616</span><span class="p">)</span>
		<span class="n">snd_emu1010_fpga_link_dst_src_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span>
			<span class="n">emu1010_input_dst</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">emu1616_src_regs</span><span class="p">[</span><span class="n">val</span><span class="p">]);</span>
	<span class="k">else</span>
		<span class="n">snd_emu1010_fpga_link_dst_src_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span>
			<span class="n">emu1010_input_dst</span><span class="p">[</span><span class="n">channel</span><span class="p">],</span> <span class="n">emu1010_src_regs</span><span class="p">[</span><span class="n">val</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define EMU1010_SOURCE_OUTPUT(xname,chid) \</span>
<span class="cp">{								\</span>
<span class="cp">	.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname,	\</span>
<span class="cp">	.access = SNDRV_CTL_ELEM_ACCESS_READWRITE,		\</span>
<span class="cp">	.info =  snd_emu1010_input_output_source_info,		\</span>
<span class="cp">	.get =   snd_emu1010_output_source_get,			\</span>
<span class="cp">	.put =   snd_emu1010_output_source_put,			\</span>
<span class="cp">	.private_value = chid					\</span>
<span class="cp">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu1010_output_enum_ctls</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC1 Left Playback Enum&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC1 Right Playback Enum&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC2 Left Playback Enum&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC2 Right Playback Enum&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC3 Left Playback Enum&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC3 Right Playback Enum&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC4 Left Playback Enum&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC4 Right Playback Enum&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock Phones Left Playback Enum&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock Phones Right Playback Enum&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock SPDIF Left Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock SPDIF Right Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;1010 SPDIF Left Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;1010 SPDIF Right Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xd</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;0202 DAC Left Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;0202 DAC Right Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;1010 ADAT 0 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;1010 ADAT 1 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;1010 ADAT 2 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;1010 ADAT 3 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;1010 ADAT 4 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;1010 ADAT 5 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;1010 ADAT 6 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;1010 ADAT 7 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">),</span>
<span class="p">};</span>


<span class="cm">/* 1616(m) cardbus */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu1616_output_enum_ctls</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC1 Left Playback Enum&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC1 Right Playback Enum&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC2 Left Playback Enum&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC2 Right Playback Enum&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC3 Left Playback Enum&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock DAC3 Right Playback Enum&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock SPDIF Left Playback Enum&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock SPDIF Right Playback Enum&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock ADAT 0 Playback Enum&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock ADAT 1 Playback Enum&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock ADAT 2 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock ADAT 3 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock ADAT 4 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock ADAT 5 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xd</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock ADAT 6 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Dock ADAT 7 Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Mana DAC Left Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_OUTPUT</span><span class="p">(</span><span class="s">&quot;Mana DAC Right Playback Enum&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">),</span>
<span class="p">};</span>


<span class="cp">#define EMU1010_SOURCE_INPUT(xname,chid) \</span>
<span class="cp">{								\</span>
<span class="cp">	.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname,	\</span>
<span class="cp">	.access = SNDRV_CTL_ELEM_ACCESS_READWRITE,		\</span>
<span class="cp">	.info =  snd_emu1010_input_output_source_info,		\</span>
<span class="cp">	.get =   snd_emu1010_input_source_get,			\</span>
<span class="cp">	.put =   snd_emu1010_input_source_put,			\</span>
<span class="cp">	.private_value = chid					\</span>
<span class="cp">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu1010_input_enum_ctls</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 0 Capture Enum&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 1 Capture Enum&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 2 Capture Enum&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 3 Capture Enum&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 4 Capture Enum&quot;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 5 Capture Enum&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 6 Capture Enum&quot;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 7 Capture Enum&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 8 Capture Enum&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 9 Capture Enum&quot;</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP A Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP B Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0xb</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP C Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0xc</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP D Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0xd</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP E Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP F Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 10 Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 11 Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 12 Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 13 Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 14 Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">),</span>
	<span class="n">EMU1010_SOURCE_INPUT</span><span class="p">(</span><span class="s">&quot;DSP 15 Capture Enum&quot;</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">),</span>
<span class="p">};</span>



<span class="cp">#define snd_emu1010_adc_pads_info	snd_ctl_boolean_mono_info</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_adc_pads_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">adc_pads</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_adc_pads_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="n">cache</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">cache</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">adc_pads</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> 
		<span class="n">cache</span> <span class="o">=</span> <span class="n">cache</span> <span class="o">|</span> <span class="n">mask</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">cache</span> <span class="o">=</span> <span class="n">cache</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cache</span> <span class="o">!=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">adc_pads</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_ADC_PADS</span><span class="p">,</span> <span class="n">cache</span> <span class="p">);</span>
	        <span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">adc_pads</span> <span class="o">=</span> <span class="n">cache</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>



<span class="cp">#define EMU1010_ADC_PADS(xname,chid) \</span>
<span class="cp">{								\</span>
<span class="cp">	.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname,	\</span>
<span class="cp">	.access = SNDRV_CTL_ELEM_ACCESS_READWRITE,		\</span>
<span class="cp">	.info =  snd_emu1010_adc_pads_info,			\</span>
<span class="cp">	.get =   snd_emu1010_adc_pads_get,			\</span>
<span class="cp">	.put =   snd_emu1010_adc_pads_put,			\</span>
<span class="cp">	.private_value = chid					\</span>
<span class="cp">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu1010_adc_pads</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EMU1010_ADC_PADS</span><span class="p">(</span><span class="s">&quot;ADC1 14dB PAD Audio Dock Capture Switch&quot;</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_ADC_PAD1</span><span class="p">),</span>
	<span class="n">EMU1010_ADC_PADS</span><span class="p">(</span><span class="s">&quot;ADC2 14dB PAD Audio Dock Capture Switch&quot;</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_ADC_PAD2</span><span class="p">),</span>
	<span class="n">EMU1010_ADC_PADS</span><span class="p">(</span><span class="s">&quot;ADC3 14dB PAD Audio Dock Capture Switch&quot;</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_ADC_PAD3</span><span class="p">),</span>
	<span class="n">EMU1010_ADC_PADS</span><span class="p">(</span><span class="s">&quot;ADC1 14dB PAD 0202 Capture Switch&quot;</span><span class="p">,</span> <span class="n">EMU_HANA_0202_ADC_PAD1</span><span class="p">),</span>
<span class="p">};</span>

<span class="cp">#define snd_emu1010_dac_pads_info	snd_ctl_boolean_mono_info</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_dac_pads_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">dac_pads</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_dac_pads_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="n">cache</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">cache</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">dac_pads</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> 
		<span class="n">cache</span> <span class="o">=</span> <span class="n">cache</span> <span class="o">|</span> <span class="n">mask</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">cache</span> <span class="o">=</span> <span class="n">cache</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cache</span> <span class="o">!=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">dac_pads</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_DAC_PADS</span><span class="p">,</span> <span class="n">cache</span> <span class="p">);</span>
	        <span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">dac_pads</span> <span class="o">=</span> <span class="n">cache</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>



<span class="cp">#define EMU1010_DAC_PADS(xname,chid) \</span>
<span class="cp">{								\</span>
<span class="cp">	.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname,	\</span>
<span class="cp">	.access = SNDRV_CTL_ELEM_ACCESS_READWRITE,		\</span>
<span class="cp">	.info =  snd_emu1010_dac_pads_info,			\</span>
<span class="cp">	.get =   snd_emu1010_dac_pads_get,			\</span>
<span class="cp">	.put =   snd_emu1010_dac_pads_put,			\</span>
<span class="cp">	.private_value = chid					\</span>
<span class="cp">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu1010_dac_pads</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">EMU1010_DAC_PADS</span><span class="p">(</span><span class="s">&quot;DAC1 Audio Dock 14dB PAD Playback Switch&quot;</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_DAC_PAD1</span><span class="p">),</span>
	<span class="n">EMU1010_DAC_PADS</span><span class="p">(</span><span class="s">&quot;DAC2 Audio Dock 14dB PAD Playback Switch&quot;</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_DAC_PAD2</span><span class="p">),</span>
	<span class="n">EMU1010_DAC_PADS</span><span class="p">(</span><span class="s">&quot;DAC3 Audio Dock 14dB PAD Playback Switch&quot;</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_DAC_PAD3</span><span class="p">),</span>
	<span class="n">EMU1010_DAC_PADS</span><span class="p">(</span><span class="s">&quot;DAC4 Audio Dock 14dB PAD Playback Switch&quot;</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_DAC_PAD4</span><span class="p">),</span>
	<span class="n">EMU1010_DAC_PADS</span><span class="p">(</span><span class="s">&quot;DAC1 0202 14dB PAD Playback Switch&quot;</span><span class="p">,</span> <span class="n">EMU_HANA_0202_DAC_PAD1</span><span class="p">),</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_internal_clock_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">texts</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;44100&quot;</span><span class="p">,</span> <span class="s">&quot;48000&quot;</span><span class="p">,</span> <span class="s">&quot;SPDIF&quot;</span><span class="p">,</span> <span class="s">&quot;ADAT&quot;</span>
	<span class="p">};</span>
		
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_ENUMERATED</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">&gt;=</span> <span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span><span class="p">)</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">texts</span><span class="p">[</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	
	
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_internal_clock_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>

	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">internal_clock</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu1010_internal_clock_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">;</span>
	<span class="cm">/* Limit: uinfo-&gt;value.enumerated.items = 4; */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">change</span> <span class="o">=</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">internal_clock</span> <span class="o">!=</span> <span class="n">val</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu1010</span><span class="p">.</span><span class="n">internal_clock</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="cm">/* 44100 */</span>
			<span class="cm">/* Mute all */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_UNMUTE</span><span class="p">,</span> <span class="n">EMU_MUTE</span> <span class="p">);</span>
			<span class="cm">/* Default fallback clock 48kHz */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_DEFCLOCK</span><span class="p">,</span> <span class="n">EMU_HANA_DEFCLOCK_44_1K</span> <span class="p">);</span>
			<span class="cm">/* Word Clock source, Internal 44.1kHz x1 */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_WCLOCK</span><span class="p">,</span>
			<span class="n">EMU_HANA_WCLOCK_INT_44_1K</span> <span class="o">|</span> <span class="n">EMU_HANA_WCLOCK_1X</span> <span class="p">);</span>
			<span class="cm">/* Set LEDs on Audio Dock */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_LEDS_2</span><span class="p">,</span>
				<span class="n">EMU_HANA_DOCK_LEDS_2_44K</span> <span class="o">|</span> <span class="n">EMU_HANA_DOCK_LEDS_2_LOCK</span> <span class="p">);</span>
			<span class="cm">/* Allow DLL to settle */</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
			<span class="cm">/* Unmute all */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_UNMUTE</span><span class="p">,</span> <span class="n">EMU_UNMUTE</span> <span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="cm">/* 48000 */</span>
			<span class="cm">/* Mute all */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_UNMUTE</span><span class="p">,</span> <span class="n">EMU_MUTE</span> <span class="p">);</span>
			<span class="cm">/* Default fallback clock 48kHz */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_DEFCLOCK</span><span class="p">,</span> <span class="n">EMU_HANA_DEFCLOCK_48K</span> <span class="p">);</span>
			<span class="cm">/* Word Clock source, Internal 48kHz x1 */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_WCLOCK</span><span class="p">,</span>
				<span class="n">EMU_HANA_WCLOCK_INT_48K</span> <span class="o">|</span> <span class="n">EMU_HANA_WCLOCK_1X</span> <span class="p">);</span>
			<span class="cm">/* Set LEDs on Audio Dock */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_LEDS_2</span><span class="p">,</span>
				<span class="n">EMU_HANA_DOCK_LEDS_2_48K</span> <span class="o">|</span> <span class="n">EMU_HANA_DOCK_LEDS_2_LOCK</span> <span class="p">);</span>
			<span class="cm">/* Allow DLL to settle */</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
			<span class="cm">/* Unmute all */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_UNMUTE</span><span class="p">,</span> <span class="n">EMU_UNMUTE</span> <span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
			
		<span class="k">case</span> <span class="mi">2</span>: <span class="cm">/* Take clock from S/PDIF IN */</span>
			<span class="cm">/* Mute all */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_UNMUTE</span><span class="p">,</span> <span class="n">EMU_MUTE</span> <span class="p">);</span>
			<span class="cm">/* Default fallback clock 48kHz */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_DEFCLOCK</span><span class="p">,</span> <span class="n">EMU_HANA_DEFCLOCK_48K</span> <span class="p">);</span>
			<span class="cm">/* Word Clock source, sync to S/PDIF input */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_WCLOCK</span><span class="p">,</span>
				<span class="n">EMU_HANA_WCLOCK_HANA_SPDIF_IN</span> <span class="o">|</span> <span class="n">EMU_HANA_WCLOCK_1X</span> <span class="p">);</span>
			<span class="cm">/* Set LEDs on Audio Dock */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_LEDS_2</span><span class="p">,</span>
				<span class="n">EMU_HANA_DOCK_LEDS_2_EXT</span> <span class="o">|</span> <span class="n">EMU_HANA_DOCK_LEDS_2_LOCK</span> <span class="p">);</span>
			<span class="cm">/* FIXME: We should set EMU_HANA_DOCK_LEDS_2_LOCK only when clock signal is present and valid */</span>	
			<span class="cm">/* Allow DLL to settle */</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
			<span class="cm">/* Unmute all */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_UNMUTE</span><span class="p">,</span> <span class="n">EMU_UNMUTE</span> <span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		
		<span class="k">case</span> <span class="mi">3</span>: 			
			<span class="cm">/* Take clock from ADAT IN */</span>
			<span class="cm">/* Mute all */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_UNMUTE</span><span class="p">,</span> <span class="n">EMU_MUTE</span> <span class="p">);</span>
			<span class="cm">/* Default fallback clock 48kHz */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_DEFCLOCK</span><span class="p">,</span> <span class="n">EMU_HANA_DEFCLOCK_48K</span> <span class="p">);</span>
			<span class="cm">/* Word Clock source, sync to ADAT input */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_WCLOCK</span><span class="p">,</span>
				<span class="n">EMU_HANA_WCLOCK_HANA_ADAT_IN</span> <span class="o">|</span> <span class="n">EMU_HANA_WCLOCK_1X</span> <span class="p">);</span>
			<span class="cm">/* Set LEDs on Audio Dock */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_LEDS_2</span><span class="p">,</span> <span class="n">EMU_HANA_DOCK_LEDS_2_EXT</span> <span class="o">|</span> <span class="n">EMU_HANA_DOCK_LEDS_2_LOCK</span> <span class="p">);</span>
			<span class="cm">/* FIXME: We should set EMU_HANA_DOCK_LEDS_2_LOCK only when clock signal is present and valid */</span>	
			<span class="cm">/* Allow DLL to settle */</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
			<span class="cm">/*   Unmute all */</span>
			<span class="n">snd_emu1010_fpga_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">EMU_HANA_UNMUTE</span><span class="p">,</span> <span class="n">EMU_UNMUTE</span> <span class="p">);</span>
			 
			
			<span class="k">break</span><span class="p">;</span>		
		<span class="p">}</span>
	<span class="p">}</span>
        <span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu1010_internal_clock</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>        <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="s">&quot;Clock Internal Rate&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">count</span> <span class="o">=</span>	<span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">snd_emu1010_internal_clock_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">snd_emu1010_internal_clock_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">snd_emu1010_internal_clock_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_audigy_i2c_capture_source_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	static char *texts[4] = {</span>
<span class="c">		&quot;Unknown1&quot;, &quot;Unknown2&quot;, &quot;Mic&quot;, &quot;Line&quot;</span>
<span class="c">	};</span>
<span class="cp">#endif</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">texts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Mic&quot;</span><span class="p">,</span> <span class="s">&quot;Line&quot;</span>
	<span class="p">};</span>

	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_ENUMERATED</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">texts</span><span class="p">[</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_audigy_i2c_capture_source_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>

	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_source</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_audigy_i2c_capture_source_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">source_id</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ngain</span><span class="p">,</span> <span class="n">ogain</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gpio</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">source</span><span class="p">;</span>
	<span class="cm">/* If the capture source has changed,</span>
<span class="cm">	 * update the capture volume from the cached value</span>
<span class="cm">	 * for the particular source.</span>
<span class="cm">	 */</span>
	<span class="n">source_id</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="cm">/* Limit: uinfo-&gt;value.enumerated.items = 2; */</span>
	<span class="cm">/*        emu-&gt;i2c_capture_volume */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">source_id</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">change</span> <span class="o">=</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_source</span> <span class="o">!=</span> <span class="n">source_id</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_emu10k1_i2c_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">ADC_MUX</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="cm">/* Mute input */</span>
		<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
		<span class="n">gpio</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">+</span> <span class="n">A_IOCFG</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">source_id</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
			<span class="n">outl</span><span class="p">(</span><span class="n">gpio</span> <span class="o">|</span> <span class="mh">0x4</span><span class="p">,</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">+</span> <span class="n">A_IOCFG</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">outl</span><span class="p">(</span><span class="n">gpio</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x4</span><span class="p">,</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">+</span> <span class="n">A_IOCFG</span><span class="p">);</span>
		<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">emu_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

		<span class="n">ngain</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_volume</span><span class="p">[</span><span class="n">source_id</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span> <span class="cm">/* Left */</span>
		<span class="n">ogain</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_volume</span><span class="p">[</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_source</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span> <span class="cm">/* Left */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ngain</span> <span class="o">!=</span> <span class="n">ogain</span><span class="p">)</span>
			<span class="n">snd_emu10k1_i2c_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">ADC_ATTEN_ADCL</span><span class="p">,</span> <span class="p">((</span><span class="n">ngain</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">));</span>
		<span class="n">ngain</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_volume</span><span class="p">[</span><span class="n">source_id</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span> <span class="cm">/* Right */</span>
		<span class="n">ogain</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_volume</span><span class="p">[</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_source</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span> <span class="cm">/* Right */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ngain</span> <span class="o">!=</span> <span class="n">ogain</span><span class="p">)</span>
			<span class="n">snd_emu10k1_i2c_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">ADC_ATTEN_ADCR</span><span class="p">,</span> <span class="p">((</span><span class="n">ngain</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">));</span>

		<span class="n">source</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">source_id</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">snd_emu10k1_i2c_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">ADC_MUX</span><span class="p">,</span> <span class="n">source</span><span class="p">);</span> <span class="cm">/* Set source */</span>
		<span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_source</span> <span class="o">=</span> <span class="n">source_id</span><span class="p">;</span>
	<span class="p">}</span>
        <span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_audigy_i2c_capture_source</span> <span class="o">=</span>
<span class="p">{</span>
		<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span>		<span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">info</span> <span class="o">=</span>		<span class="n">snd_audigy_i2c_capture_source_info</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span>		<span class="n">snd_audigy_i2c_capture_source_get</span><span class="p">,</span>
		<span class="p">.</span><span class="n">put</span> <span class="o">=</span>		<span class="n">snd_audigy_i2c_capture_source_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_audigy_i2c_volume_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_audigy_i2c_volume_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">source_id</span><span class="p">;</span>

	<span class="n">source_id</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="cm">/* Limit: emu-&gt;i2c_capture_volume */</span>
        <span class="cm">/*        capture_source: uinfo-&gt;value.enumerated.items = 2 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">source_id</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_volume</span><span class="p">[</span><span class="n">source_id</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_volume</span><span class="p">[</span><span class="n">source_id</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_audigy_i2c_volume_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ogain</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ngain</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">source_id</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">source_id</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="cm">/* Limit: emu-&gt;i2c_capture_volume */</span>
        <span class="cm">/*        capture_source: uinfo-&gt;value.enumerated.items = 2 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">source_id</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">ogain</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_volume</span><span class="p">[</span><span class="n">source_id</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span> <span class="cm">/* Left */</span>
	<span class="n">ngain</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ngain</span> <span class="o">&gt;</span> <span class="mh">0xff</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ogain</span> <span class="o">!=</span> <span class="n">ngain</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_source</span> <span class="o">==</span> <span class="n">source_id</span><span class="p">)</span>
			<span class="n">snd_emu10k1_i2c_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">ADC_ATTEN_ADCL</span><span class="p">,</span> <span class="p">((</span><span class="n">ngain</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">)</span> <span class="p">);</span>
		<span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_volume</span><span class="p">[</span><span class="n">source_id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ngain</span><span class="p">;</span>
		<span class="n">change</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">ogain</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_volume</span><span class="p">[</span><span class="n">source_id</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span> <span class="cm">/* Right */</span>
	<span class="n">ngain</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ngain</span> <span class="o">&gt;</span> <span class="mh">0xff</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ogain</span> <span class="o">!=</span> <span class="n">ngain</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_source</span> <span class="o">==</span> <span class="n">source_id</span><span class="p">)</span>
			<span class="n">snd_emu10k1_i2c_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">ADC_ATTEN_ADCR</span><span class="p">,</span> <span class="p">((</span><span class="n">ngain</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">));</span>
		<span class="n">emu</span><span class="o">-&gt;</span><span class="n">i2c_capture_volume</span><span class="p">[</span><span class="n">source_id</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ngain</span><span class="p">;</span>
		<span class="n">change</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define I2C_VOLUME(xname,chid) \</span>
<span class="cp">{								\</span>
<span class="cp">	.iface = SNDRV_CTL_ELEM_IFACE_MIXER, .name = xname,	\</span>
<span class="cp">	.access = SNDRV_CTL_ELEM_ACCESS_READWRITE |		\</span>
<span class="cp">	          SNDRV_CTL_ELEM_ACCESS_TLV_READ,		\</span>
<span class="cp">	.info =  snd_audigy_i2c_volume_info,			\</span>
<span class="cp">	.get =   snd_audigy_i2c_volume_get,			\</span>
<span class="cp">	.put =   snd_audigy_i2c_volume_put,			\</span>
<span class="cp">	.tlv = { .p = snd_audigy_db_scale2 },			\</span>
<span class="cp">	.private_value = chid					\</span>
<span class="cp">}</span>


<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_audigy_i2c_volume_ctls</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">I2C_VOLUME</span><span class="p">(</span><span class="s">&quot;Mic Capture Volume&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">I2C_VOLUME</span><span class="p">(</span><span class="s">&quot;Line Capture Volume&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">};</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">static int snd_audigy_spdif_output_rate_info(struct snd_kcontrol *kcontrol, struct snd_ctl_elem_info *uinfo)</span>
<span class="c">{</span>
<span class="c">	static char *texts[] = {&quot;44100&quot;, &quot;48000&quot;, &quot;96000&quot;};</span>

<span class="c">	uinfo-&gt;type = SNDRV_CTL_ELEM_TYPE_ENUMERATED;</span>
<span class="c">	uinfo-&gt;count = 1;</span>
<span class="c">	uinfo-&gt;value.enumerated.items = 3;</span>
<span class="c">	if (uinfo-&gt;value.enumerated.item &gt;= uinfo-&gt;value.enumerated.items)</span>
<span class="c">		uinfo-&gt;value.enumerated.item = uinfo-&gt;value.enumerated.items - 1;</span>
<span class="c">	strcpy(uinfo-&gt;value.enumerated.name, texts[uinfo-&gt;value.enumerated.item]);</span>
<span class="c">	return 0;</span>
<span class="c">}</span>

<span class="c">static int snd_audigy_spdif_output_rate_get(struct snd_kcontrol *kcontrol,</span>
<span class="c">                                 struct snd_ctl_elem_value *ucontrol)</span>
<span class="c">{</span>
<span class="c">	struct snd_emu10k1 *emu = snd_kcontrol_chip(kcontrol);</span>
<span class="c">	unsigned int tmp;</span>
<span class="c">	unsigned long flags;</span>
<span class="c">	</span>

<span class="c">	spin_lock_irqsave(&amp;emu-&gt;reg_lock, flags);</span>
<span class="c">	tmp = snd_emu10k1_ptr_read(emu, A_SPDIF_SAMPLERATE, 0);</span>
<span class="c">	switch (tmp &amp; A_SPDIF_RATE_MASK) {</span>
<span class="c">	case A_SPDIF_44100:</span>
<span class="c">		ucontrol-&gt;value.enumerated.item[0] = 0;</span>
<span class="c">		break;</span>
<span class="c">	case A_SPDIF_48000:</span>
<span class="c">		ucontrol-&gt;value.enumerated.item[0] = 1;</span>
<span class="c">		break;</span>
<span class="c">	case A_SPDIF_96000:</span>
<span class="c">		ucontrol-&gt;value.enumerated.item[0] = 2;</span>
<span class="c">		break;</span>
<span class="c">	default:</span>
<span class="c">		ucontrol-&gt;value.enumerated.item[0] = 1;</span>
<span class="c">	}</span>
<span class="c">	spin_unlock_irqrestore(&amp;emu-&gt;reg_lock, flags);</span>
<span class="c">	return 0;</span>
<span class="c">}</span>

<span class="c">static int snd_audigy_spdif_output_rate_put(struct snd_kcontrol *kcontrol,</span>
<span class="c">                                 struct snd_ctl_elem_value *ucontrol)</span>
<span class="c">{</span>
<span class="c">	struct snd_emu10k1 *emu = snd_kcontrol_chip(kcontrol);</span>
<span class="c">	int change;</span>
<span class="c">	unsigned int reg, val, tmp;</span>
<span class="c">	unsigned long flags;</span>

<span class="c">	switch(ucontrol-&gt;value.enumerated.item[0]) {</span>
<span class="c">	case 0:</span>
<span class="c">		val = A_SPDIF_44100;</span>
<span class="c">		break;</span>
<span class="c">	case 1:</span>
<span class="c">		val = A_SPDIF_48000;</span>
<span class="c">		break;</span>
<span class="c">	case 2:</span>
<span class="c">		val = A_SPDIF_96000;</span>
<span class="c">		break;</span>
<span class="c">	default:</span>
<span class="c">		val = A_SPDIF_48000;</span>
<span class="c">		break;</span>
<span class="c">	}</span>

<span class="c">	</span>
<span class="c">	spin_lock_irqsave(&amp;emu-&gt;reg_lock, flags);</span>
<span class="c">	reg = snd_emu10k1_ptr_read(emu, A_SPDIF_SAMPLERATE, 0);</span>
<span class="c">	tmp = reg &amp; ~A_SPDIF_RATE_MASK;</span>
<span class="c">	tmp |= val;</span>
<span class="c">	if ((change = (tmp != reg)))</span>
<span class="c">		snd_emu10k1_ptr_write(emu, A_SPDIF_SAMPLERATE, 0, tmp);</span>
<span class="c">	spin_unlock_irqrestore(&amp;emu-&gt;reg_lock, flags);</span>
<span class="c">	return change;</span>
<span class="c">}</span>

<span class="c">static struct snd_kcontrol_new snd_audigy_spdif_output_rate =</span>
<span class="c">{</span>
<span class="c">	.access =	SNDRV_CTL_ELEM_ACCESS_READWRITE,</span>
<span class="c">	.iface =        SNDRV_CTL_ELEM_IFACE_MIXER,</span>
<span class="c">	.name =         &quot;Audigy SPDIF Output Sample Rate&quot;,</span>
<span class="c">	.count =	1,</span>
<span class="c">	.info =         snd_audigy_spdif_output_rate_info,</span>
<span class="c">	.get =          snd_audigy_spdif_output_rate_get,</span>
<span class="c">	.put =          snd_audigy_spdif_output_rate_put</span>
<span class="c">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_spdif_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">change</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="cm">/* Limit: emu-&gt;spdif_bits */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
	      <span class="p">(</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
	      <span class="p">(</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
	      <span class="p">(</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">iec958</span><span class="p">.</span><span class="n">status</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">);</span>
	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">change</span> <span class="o">=</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">spdif_bits</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">SPCS0</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">emu</span><span class="o">-&gt;</span><span class="n">spdif_bits</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu10k1_spdif_mask_control</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_ACCESS_READ</span><span class="p">,</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>        <span class="n">SNDRV_CTL_ELEM_IFACE_PCM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="n">SNDRV_CTL_NAME_IEC958</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">PLAYBACK</span><span class="p">,</span><span class="n">MASK</span><span class="p">),</span>
	<span class="p">.</span><span class="n">count</span> <span class="o">=</span>	<span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">snd_emu10k1_spdif_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">snd_emu10k1_spdif_get_mask</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu10k1_spdif_control</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_IFACE_PCM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="n">SNDRV_CTL_NAME_IEC958</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">PLAYBACK</span><span class="p">,</span><span class="n">DEFAULT</span><span class="p">),</span>
	<span class="p">.</span><span class="n">count</span> <span class="o">=</span>	<span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">snd_emu10k1_spdif_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">snd_emu10k1_spdif_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">snd_emu10k1_spdif_put</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">update_emu10k1_fxrt</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span><span class="p">,</span> <span class="kt">int</span> <span class="n">voice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">route</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">A_FXRT1</span><span class="p">,</span> <span class="n">voice</span><span class="p">,</span>
				      <span class="n">snd_emu10k1_compose_audigy_fxrt1</span><span class="p">(</span><span class="n">route</span><span class="p">));</span>
		<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">A_FXRT2</span><span class="p">,</span> <span class="n">voice</span><span class="p">,</span>
				      <span class="n">snd_emu10k1_compose_audigy_fxrt2</span><span class="p">(</span><span class="n">route</span><span class="p">));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">FXRT</span><span class="p">,</span> <span class="n">voice</span><span class="p">,</span>
				      <span class="n">snd_emu10k1_compose_send_routing</span><span class="p">(</span><span class="n">route</span><span class="p">));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">update_emu10k1_send_volume</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span><span class="p">,</span> <span class="kt">int</span> <span class="n">voice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">volume</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">PTRX_FXSENDAMOUNT_A</span><span class="p">,</span> <span class="n">voice</span><span class="p">,</span> <span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">PTRX_FXSENDAMOUNT_B</span><span class="p">,</span> <span class="n">voice</span><span class="p">,</span> <span class="n">volume</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">PSST_FXSENDAMOUNT_C</span><span class="p">,</span> <span class="n">voice</span><span class="p">,</span> <span class="n">volume</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">DSL_FXSENDAMOUNT_D</span><span class="p">,</span> <span class="n">voice</span><span class="p">,</span> <span class="n">volume</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">volume</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">volume</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">((</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">volume</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">volume</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
		<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">A_SENDAMOUNTS</span><span class="p">,</span> <span class="n">voice</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* PCM stream controls */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_send_routing_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">3</span><span class="o">*</span><span class="mi">8</span> <span class="o">:</span> <span class="mi">3</span><span class="o">*</span><span class="mi">4</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mh">0x3f</span> <span class="o">:</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_send_routing_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                        <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">pcm_mixer</span><span class="p">[</span><span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)];</span>
	<span class="kt">int</span> <span class="n">voice</span><span class="p">,</span> <span class="n">idx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_efx</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mh">0x3f</span> <span class="o">:</span> <span class="mh">0x0f</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">voice</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">voice</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">voice</span><span class="o">++</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">num_efx</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
			<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[(</span><span class="n">voice</span> <span class="o">*</span> <span class="n">num_efx</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> 
				<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="n">voice</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">;</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_send_routing_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                        <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">pcm_mixer</span><span class="p">[</span><span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)];</span>
	<span class="kt">int</span> <span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">voice</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_efx</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mh">0x3f</span> <span class="o">:</span> <span class="mh">0x0f</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">voice</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">voice</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">voice</span><span class="o">++</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">num_efx</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[(</span><span class="n">voice</span> <span class="o">*</span> <span class="n">num_efx</span><span class="p">)</span> <span class="o">+</span> <span class="n">idx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="n">voice</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="n">voice</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
				<span class="n">change</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>	
	<span class="k">if</span> <span class="p">(</span><span class="n">change</span> <span class="o">&amp;&amp;</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">update_emu10k1_fxrt</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span>
					    <span class="o">&amp;</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
			<span class="n">update_emu10k1_fxrt</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span>
					    <span class="o">&amp;</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">update_emu10k1_fxrt</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span>
					    <span class="o">&amp;</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu10k1_send_routing_control</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span> <span class="o">|</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_INACTIVE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>        <span class="n">SNDRV_CTL_ELEM_IFACE_PCM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="s">&quot;EMU10K1 PCM Send Routing&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">count</span> <span class="o">=</span>	<span class="mi">32</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">snd_emu10k1_send_routing_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">snd_emu10k1_send_routing_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">snd_emu10k1_send_routing_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_send_volume_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">3</span><span class="o">*</span><span class="mi">8</span> <span class="o">:</span> <span class="mi">3</span><span class="o">*</span><span class="mi">4</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_send_volume_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                       <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">pcm_mixer</span><span class="p">[</span><span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)];</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_efx</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">*</span><span class="n">num_efx</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="n">idx</span><span class="o">/</span><span class="n">num_efx</span><span class="p">][</span><span class="n">idx</span><span class="o">%</span><span class="n">num_efx</span><span class="p">];</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_send_volume_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                       <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">pcm_mixer</span><span class="p">[</span><span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)];</span>
	<span class="kt">int</span> <span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_efx</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="o">*</span><span class="n">num_efx</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="n">idx</span><span class="o">/</span><span class="n">num_efx</span><span class="p">][</span><span class="n">idx</span><span class="o">%</span><span class="n">num_efx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="n">idx</span><span class="o">/</span><span class="n">num_efx</span><span class="p">][</span><span class="n">idx</span><span class="o">%</span><span class="n">num_efx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
			<span class="n">change</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">change</span> <span class="o">&amp;&amp;</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">update_emu10k1_send_volume</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span>
						   <span class="o">&amp;</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
			<span class="n">update_emu10k1_send_volume</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span>
						   <span class="o">&amp;</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">update_emu10k1_send_volume</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span>
						   <span class="o">&amp;</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu10k1_send_volume_control</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span> <span class="o">|</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_INACTIVE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>        <span class="n">SNDRV_CTL_ELEM_IFACE_PCM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="s">&quot;EMU10K1 PCM Send Volume&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">count</span> <span class="o">=</span>	<span class="mi">32</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">snd_emu10k1_send_volume_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">snd_emu10k1_send_volume_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">snd_emu10k1_send_volume_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_attn_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_attn_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">pcm_mixer</span><span class="p">[</span><span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_attn_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">pcm_mixer</span><span class="p">[</span><span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)];</span>
	<span class="kt">int</span> <span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
			<span class="n">change</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">change</span> <span class="o">&amp;&amp;</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">VTFT_VOLUMETARGET</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
			<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">VTFT_VOLUMETARGET</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">VTFT_VOLUMETARGET</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu10k1_attn_control</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span> <span class="o">|</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_INACTIVE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>        <span class="n">SNDRV_CTL_ELEM_IFACE_PCM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="s">&quot;EMU10K1 PCM Volume&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">count</span> <span class="o">=</span>	<span class="mi">32</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">snd_emu10k1_attn_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">snd_emu10k1_attn_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">snd_emu10k1_attn_put</span>
<span class="p">};</span>

<span class="cm">/* Mutichannel PCM stream controls */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_efx_send_routing_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mh">0x3f</span> <span class="o">:</span> <span class="mh">0x0f</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_efx_send_routing_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                        <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">efx_pcm_mixer</span><span class="p">[</span><span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)];</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_efx</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mh">0x3f</span> <span class="o">:</span> <span class="mh">0x0f</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">num_efx</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> 
			<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">;</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_efx_send_routing_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                        <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">efx_pcm_mixer</span><span class="p">[</span><span class="n">ch</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_efx</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mh">0x3f</span> <span class="o">:</span> <span class="mh">0x0f</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">num_efx</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
			<span class="n">change</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>	

	<span class="k">if</span> <span class="p">(</span><span class="n">change</span> <span class="o">&amp;&amp;</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="n">ch</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">update_emu10k1_fxrt</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu10k1_efx_send_routing_control</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span> <span class="o">|</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_INACTIVE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>        <span class="n">SNDRV_CTL_ELEM_IFACE_PCM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="s">&quot;Multichannel PCM Send Routing&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">count</span> <span class="o">=</span>	<span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">snd_emu10k1_efx_send_routing_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">snd_emu10k1_efx_send_routing_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">snd_emu10k1_efx_send_routing_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_efx_send_volume_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_efx_send_volume_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                       <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">efx_pcm_mixer</span><span class="p">[</span><span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)];</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_efx</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">num_efx</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx</span><span class="p">];</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_efx_send_volume_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                       <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">efx_pcm_mixer</span><span class="p">[</span><span class="n">ch</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_efx</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="n">num_efx</span><span class="p">;</span> <span class="n">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">255</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
			<span class="n">change</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">change</span> <span class="o">&amp;&amp;</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="n">ch</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">update_emu10k1_send_volume</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span>
						   <span class="o">&amp;</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu10k1_efx_send_volume_control</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span> <span class="o">|</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_INACTIVE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>        <span class="n">SNDRV_CTL_ELEM_IFACE_PCM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="s">&quot;Multichannel PCM Send Volume&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">count</span> <span class="o">=</span>	<span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">snd_emu10k1_efx_send_volume_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">snd_emu10k1_efx_send_volume_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">snd_emu10k1_efx_send_volume_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_efx_attn_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_efx_attn_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
                                <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span>
		<span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">efx_pcm_mixer</span><span class="p">[</span><span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_efx_attn_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">efx_pcm_mixer</span><span class="p">[</span><span class="n">ch</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
		<span class="n">change</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">change</span> <span class="o">&amp;&amp;</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="n">ch</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">VTFT_VOLUMETARGET</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span><span class="o">-&gt;</span><span class="n">voices</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">number</span><span class="p">,</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu10k1_efx_attn_control</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span> <span class="o">|</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_INACTIVE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>        <span class="n">SNDRV_CTL_ELEM_IFACE_PCM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="s">&quot;Multichannel PCM Volume&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">count</span> <span class="o">=</span>	<span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">snd_emu10k1_efx_attn_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">snd_emu10k1_efx_attn_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">snd_emu10k1_efx_attn_put</span>
<span class="p">};</span>

<span class="cp">#define snd_emu10k1_shared_spdif_info	snd_ctl_boolean_mono_info</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_shared_spdif_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">+</span> <span class="n">A_IOCFG</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">A_IOCFG_GPOUT0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">+</span> <span class="n">HCFG</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">HCFG_GPOUT0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">invert_shared_spdif</span><span class="p">)</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span>
			<span class="o">!</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_emu10k1_shared_spdif_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">sw</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">sw</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">invert_shared_spdif</span><span class="p">)</span>
		<span class="n">sw</span> <span class="o">=</span> <span class="o">!</span><span class="n">sw</span><span class="p">;</span>
	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">i2c_adc</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Do nothing for Audigy 2 ZS Notebook */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">+</span> <span class="n">A_IOCFG</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">sw</span> <span class="o">?</span> <span class="n">A_IOCFG_GPOUT0</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">change</span> <span class="o">=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">A_IOCFG_GPOUT0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">val</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">A_IOCFG_GPOUT0</span><span class="p">;</span>
			<span class="n">reg</span> <span class="o">|=</span> <span class="n">val</span><span class="p">;</span>
			<span class="n">outl</span><span class="p">(</span><span class="n">reg</span> <span class="o">|</span> <span class="n">val</span><span class="p">,</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">+</span> <span class="n">A_IOCFG</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">reg</span> <span class="o">=</span> <span class="n">inl</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">+</span> <span class="n">HCFG</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">sw</span> <span class="o">?</span> <span class="n">HCFG_GPOUT0</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">change</span> <span class="o">|=</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">HCFG_GPOUT0</span><span class="p">)</span> <span class="o">!=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">reg</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HCFG_GPOUT0</span><span class="p">;</span>
		<span class="n">reg</span> <span class="o">|=</span> <span class="n">val</span><span class="p">;</span>
		<span class="n">outl</span><span class="p">(</span><span class="n">reg</span> <span class="o">|</span> <span class="n">val</span><span class="p">,</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">port</span> <span class="o">+</span> <span class="n">HCFG</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">reg_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">change</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_emu10k1_shared_spdif</span> <span class="n">__devinitdata</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>		<span class="s">&quot;SB Live Analog/Digital Output Jack&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>		<span class="n">snd_emu10k1_shared_spdif_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>		<span class="n">snd_emu10k1_shared_spdif_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>		<span class="n">snd_emu10k1_shared_spdif_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_audigy_shared_spdif</span> <span class="n">__devinitdata</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>		<span class="s">&quot;Audigy Analog/Digital Output Jack&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>		<span class="n">snd_emu10k1_shared_spdif_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>		<span class="n">snd_emu10k1_shared_spdif_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>		<span class="n">snd_emu10k1_shared_spdif_put</span>
<span class="p">};</span>

<span class="cm">/* workaround for too low volume on Audigy due to 16bit/24bit conversion */</span>

<span class="cp">#define snd_audigy_capture_boost_info	snd_ctl_boolean_mono_info</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_audigy_capture_boost_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>

	<span class="cm">/* FIXME: better to use a cached version */</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">snd_ac97_read</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">ac97</span><span class="p">,</span> <span class="n">AC97_REC_GAIN</span><span class="p">);</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">!!</span><span class="n">val</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">snd_audigy_capture_boost_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">val</span> <span class="o">=</span> <span class="mh">0x0f0f</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_ac97_update</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">ac97</span><span class="p">,</span> <span class="n">AC97_REC_GAIN</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_audigy_capture_boost</span> <span class="n">__devinitdata</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>		<span class="s">&quot;Analog Capture Boost&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>		<span class="n">snd_audigy_capture_boost_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>		<span class="n">snd_audigy_capture_boost_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>		<span class="n">snd_audigy_capture_boost_put</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">snd_emu10k1_mixer_free_ac97</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ac97</span> <span class="o">*</span><span class="n">ac97</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span> <span class="o">=</span> <span class="n">ac97</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="n">emu</span><span class="o">-&gt;</span><span class="n">ac97</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">remove_ctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ctl_elem_id</span> <span class="n">id</span><span class="p">;</span>
	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">id</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">id</span><span class="p">));</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">id</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
	<span class="n">id</span><span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_ctl_remove_id</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">id</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="nf">ctl_find</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ctl_elem_id</span> <span class="n">sid</span><span class="p">;</span>
	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sid</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sid</span><span class="p">));</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">sid</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
	<span class="n">sid</span><span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">snd_ctl_find_id</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sid</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rename_ctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dst</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">ctl_find</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">src</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">kctl</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">strcpy</span><span class="p">(</span><span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">dst</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOENT</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">snd_emu10k1_mixer</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_emu10k1</span> <span class="o">*</span><span class="n">emu</span><span class="p">,</span>
				<span class="kt">int</span> <span class="n">pcm_device</span><span class="p">,</span> <span class="kt">int</span> <span class="n">multi_device</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">pcm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kctl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">**</span><span class="n">c</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">emu10k1_remove_ctls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* no AC97 mono, surround, center/lfe */</span>
		<span class="s">&quot;Master Mono Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Master Mono Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;PCM Out Path &amp; Mute&quot;</span><span class="p">,</span>
		<span class="s">&quot;Mono Output Select&quot;</span><span class="p">,</span>
		<span class="s">&quot;Surround Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Surround Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Center Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Center Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;LFE Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;LFE Playback Volume&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">emu10k1_rename_ctls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Surround Digital Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Surround Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Center Digital Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Center Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;LFE Digital Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;LFE Playback Volume&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">audigy_remove_ctls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* Master/PCM controls on ac97 of Audigy has no effect */</span>
		<span class="cm">/* On the Audigy2 the AC97 playback is piped into</span>
<span class="cm">		 * the Philips ADC for 24bit capture */</span>
		<span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Master Mono Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Master Mono Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;PCM Out Path &amp; Mute&quot;</span><span class="p">,</span>
		<span class="s">&quot;Mono Output Select&quot;</span><span class="p">,</span>
		<span class="cm">/* remove unused AC97 capture controls */</span>
		<span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Mic Select&quot;</span><span class="p">,</span>
		<span class="s">&quot;Video Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Video Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">audigy_rename_ctls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* use conventional names */</span>
		<span class="s">&quot;Wave Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span>
		<span class="cm">/* &quot;Wave Capture Volume&quot;, &quot;PCM Capture Volume&quot;, */</span>
		<span class="s">&quot;Wave Master Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;AMic Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">audigy_rename_ctls_i2c_adc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>"Analog Mix Capture Volume","OLD Analog Mix Capture Volume",</p></td><td class="code"><div class="highlight"><pre>		<span class="s">&quot;Line Capture Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Analog Mix Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Wave Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;OLD PCM Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Wave Master Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;AMic Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Old Mic Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;CD Capture Volume&quot;</span><span class="p">,</span> <span class="s">&quot;IEC958 Optical Capture Volume&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">audigy_remove_ctls_i2c_adc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* On the Audigy2 ZS Notebook</span>
<span class="cm">		 * Capture via WM8775  */</span>
		<span class="s">&quot;Mic Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Analog Mix Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Aux Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;IEC958 Optical Capture Volume&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">audigy_remove_ctls_1361t_adc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* On the Audigy2 the AC97 playback is piped into</span>
<span class="cm">		 * the Philips ADC for 24bit capture */</span>
		<span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Master Mono Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Master Mono Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Capture Source&quot;</span><span class="p">,</span>
		<span class="s">&quot;Capture Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Mic Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Headphone Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;3D Control - Center&quot;</span><span class="p">,</span>
		<span class="s">&quot;3D Control - Depth&quot;</span><span class="p">,</span>
		<span class="s">&quot;3D Control - Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Line2 Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Line2 Capture Volume&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">audigy_rename_ctls_1361t_adc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Master Capture Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Master Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Wave Master Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Master Playback Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Beep Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Beep Capture Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Beep Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Beep Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Phone Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Phone Capture Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Phone Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Phone Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Mic Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Mic Capture Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Mic Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Mic Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Line Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Line Capture Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Line Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Line Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;CD Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;CD Capture Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;CD Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;CD Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Aux Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Aux Capture Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Aux Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Aux Capture Volume&quot;</span><span class="p">,</span>
		<span class="s">&quot;Video Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Video Capture Switch&quot;</span><span class="p">,</span>
		<span class="s">&quot;Video Playback Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Video Capture Volume&quot;</span><span class="p">,</span>

		<span class="nb">NULL</span>
	<span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">ac97_chip</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">snd_ac97_bus</span> <span class="o">*</span><span class="n">pbus</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">snd_ac97_template</span> <span class="n">ac97</span><span class="p">;</span>
		<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_ac97_bus_ops</span> <span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">snd_emu10k1_ac97_write</span><span class="p">,</span>
			<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">snd_emu10k1_ac97_read</span><span class="p">,</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ac97_bus</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ops</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pbus</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">pbus</span><span class="o">-&gt;</span><span class="n">no_vra</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* we don&#39;t need VRA */</span>
		
		<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ac97</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ac97</span><span class="p">));</span>
		<span class="n">ac97</span><span class="p">.</span><span class="n">private_data</span> <span class="o">=</span> <span class="n">emu</span><span class="p">;</span>
		<span class="n">ac97</span><span class="p">.</span><span class="n">private_free</span> <span class="o">=</span> <span class="n">snd_emu10k1_mixer_free_ac97</span><span class="p">;</span>
		<span class="n">ac97</span><span class="p">.</span><span class="n">scaps</span> <span class="o">=</span> <span class="n">AC97_SCAP_NO_SPDIF</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ac97_mixer</span><span class="p">(</span><span class="n">pbus</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ac97</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">ac97</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">ac97_chip</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
			<span class="n">snd_printd</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;emu10k1: AC97 is optional on this board</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">snd_printd</span><span class="p">(</span><span class="n">KERN_INFO</span><span class="s">&quot;          Proceeding without ac97 mixers...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">snd_device_free</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">pbus</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">no_ac97</span><span class="p">;</span> <span class="cm">/* FIXME: get rid of ugly gotos.. */</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* set master volume to 0 dB */</span>
			<span class="n">snd_ac97_write_cache</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">ac97</span><span class="p">,</span> <span class="n">AC97_MASTER</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
			<span class="cm">/* set capture source to mic */</span>
			<span class="n">snd_ac97_write_cache</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">ac97</span><span class="p">,</span> <span class="n">AC97_REC_SEL</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">adc_1361t</span><span class="p">)</span>
				<span class="n">c</span> <span class="o">=</span> <span class="n">audigy_remove_ctls_1361t_adc</span><span class="p">;</span>
			<span class="k">else</span> 
				<span class="n">c</span> <span class="o">=</span> <span class="n">audigy_remove_ctls</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/*</span>
<span class="cm">			 * Credits for cards based on STAC9758:</span>
<span class="cm">			 *   James Courtier-Dutton &lt;James@superbug.demon.co.uk&gt;</span>
<span class="cm">			 *   Voluspa &lt;voluspa@comhem.se&gt;</span>
<span class="cm">			 */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">ac97</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="n">AC97_ID_STAC9758</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">emu</span><span class="o">-&gt;</span><span class="n">rear_ac97</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">snd_emu10k1_ptr_write</span><span class="p">(</span><span class="n">emu</span><span class="p">,</span> <span class="n">AC97SLOT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">AC97SLOT_CNTR</span><span class="o">|</span><span class="n">AC97SLOT_LFE</span><span class="o">|</span><span class="n">AC97SLOT_REAR_LEFT</span><span class="o">|</span><span class="n">AC97SLOT_REAR_RIGHT</span><span class="p">);</span>
				<span class="n">snd_ac97_write_cache</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">ac97</span><span class="p">,</span> <span class="n">AC97_HEADPHONE</span><span class="p">,</span> <span class="mh">0x0202</span><span class="p">);</span>
				<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span><span class="s">&quot;Front Playback Volume&quot;</span><span class="p">);</span>
				<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span><span class="s">&quot;Front Playback Switch&quot;</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="cm">/* remove unused AC97 controls */</span>
			<span class="n">snd_ac97_write_cache</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">ac97</span><span class="p">,</span> <span class="n">AC97_SURROUND_MASTER</span><span class="p">,</span> <span class="mh">0x0202</span><span class="p">);</span>
			<span class="n">snd_ac97_write_cache</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">ac97</span><span class="p">,</span> <span class="n">AC97_CENTER_LFE_MASTER</span><span class="p">,</span> <span class="mh">0x0202</span><span class="p">);</span>
			<span class="n">c</span> <span class="o">=</span> <span class="n">emu10k1_remove_ctls</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span> <span class="n">c</span><span class="o">++</span><span class="p">)</span>
			<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">i2c_adc</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">audigy_remove_ctls_i2c_adc</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(;</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span> <span class="n">c</span><span class="o">++</span><span class="p">)</span>
			<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="o">*</span><span class="n">c</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	<span class="nl">no_ac97:</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">ecard</span><span class="p">)</span>
			<span class="n">strcpy</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">mixername</span><span class="p">,</span> <span class="s">&quot;EMU APS&quot;</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span>
			<span class="n">strcpy</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">mixername</span><span class="p">,</span> <span class="s">&quot;SB Audigy&quot;</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">strcpy</span><span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card</span><span class="o">-&gt;</span><span class="n">mixername</span><span class="p">,</span> <span class="s">&quot;Emu10k1&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">adc_1361t</span><span class="p">)</span>
			<span class="n">c</span> <span class="o">=</span> <span class="n">audigy_rename_ctls_1361t_adc</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">i2c_adc</span><span class="p">)</span>
			<span class="n">c</span> <span class="o">=</span> <span class="n">audigy_rename_ctls_i2c_adc</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">c</span> <span class="o">=</span> <span class="n">audigy_rename_ctls</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">emu10k1_rename_ctls</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(;</span> <span class="o">*</span><span class="n">c</span><span class="p">;</span> <span class="n">c</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">rename_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">subsystem</span> <span class="o">==</span> <span class="mh">0x80401102</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* SB Live! Platinum CT4760P */</span>
		<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;Center Playback Volume&quot;</span><span class="p">);</span>
		<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;LFE Playback Volume&quot;</span><span class="p">);</span>
		<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;Wave Center Playback Volume&quot;</span><span class="p">);</span>
		<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;Wave LFE Playback Volume&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">subsystem</span> <span class="o">==</span> <span class="mh">0x20071102</span><span class="p">)</span> <span class="p">{</span>  <span class="cm">/* Audigy 4 Pro */</span>
		<span class="n">rename_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;Line2 Capture Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Line1/Mic Capture Volume&quot;</span><span class="p">);</span>
		<span class="n">rename_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;Analog Mix Capture Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Line2 Capture Volume&quot;</span><span class="p">);</span>
		<span class="n">rename_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;Aux2 Capture Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Line3 Capture Volume&quot;</span><span class="p">);</span>
		<span class="n">rename_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;Mic Capture Volume&quot;</span><span class="p">,</span> <span class="s">&quot;Unknown1 Capture Volume&quot;</span><span class="p">);</span>
		<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;Headphone Playback Switch&quot;</span><span class="p">);</span>
		<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;Headphone Playback Volume&quot;</span><span class="p">);</span>
		<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;3D Control - Center&quot;</span><span class="p">);</span>
		<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;3D Control - Depth&quot;</span><span class="p">);</span>
		<span class="n">remove_ctl</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;3D Control - Switch&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">ctl_send_routing</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu10k1_send_routing_control</span><span class="p">,</span> <span class="n">emu</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">pcm_device</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">kctl</span><span class="p">)))</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">ctl_send_volume</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu10k1_send_volume_control</span><span class="p">,</span> <span class="n">emu</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">pcm_device</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">kctl</span><span class="p">)))</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">ctl_attn</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu10k1_attn_control</span><span class="p">,</span> <span class="n">emu</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">pcm_device</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">kctl</span><span class="p">)))</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">ctl_efx_send_routing</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu10k1_efx_send_routing_control</span><span class="p">,</span> <span class="n">emu</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">multi_device</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">kctl</span><span class="p">)))</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	
	<span class="k">if</span> <span class="p">((</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">ctl_efx_send_volume</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu10k1_efx_send_volume_control</span><span class="p">,</span> <span class="n">emu</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">multi_device</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">kctl</span><span class="p">)))</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	
	<span class="k">if</span> <span class="p">((</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">ctl_efx_attn</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu10k1_efx_attn_control</span><span class="p">,</span> <span class="n">emu</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">multi_device</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">kctl</span><span class="p">)))</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="cm">/* initialize the routing and volume table for each pcm playback stream */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">pcm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">pcm</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">;</span> <span class="n">pcm</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
		
		<span class="n">mix</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">pcm_mixer</span><span class="p">[</span><span class="n">pcm</span><span class="p">];</span>
		<span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span>
			<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> 
				<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> 
				<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">;</span>
		
		<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">));</span>
		<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
		<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
		
		<span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="cm">/* initialize the routing and volume table for the multichannel playback stream */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">pcm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">pcm</span> <span class="o">&lt;</span> <span class="n">NUM_EFX_PLAYBACK</span><span class="p">;</span> <span class="n">pcm</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">snd_emu10k1_pcm_mixer</span> <span class="o">*</span><span class="n">mix</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">v</span><span class="p">;</span>
		
		<span class="n">mix</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">efx_pcm_mixer</span><span class="p">[</span><span class="n">pcm</span><span class="p">];</span>
		<span class="n">mix</span><span class="o">-&gt;</span><span class="n">epcm</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

		<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pcm</span><span class="p">;</span>
		<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pcm</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span>
			<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">13</span><span class="o">+</span><span class="n">v</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">v</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">v</span><span class="o">++</span><span class="p">)</span>
				<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_routing</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="o">+</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="o">+</span><span class="n">v</span><span class="p">;</span>
		
		<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">));</span>
		<span class="n">mix</span><span class="o">-&gt;</span><span class="n">send_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
		
		<span class="n">mix</span><span class="o">-&gt;</span><span class="n">attn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="p">}</span>
	
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">ecard</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* FIXME: APS has these controls? */</span>
		<span class="cm">/* sb live! and audigy */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu10k1_spdif_mask_control</span><span class="p">,</span> <span class="n">emu</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span>
			<span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">pcm_efx</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">kctl</span><span class="p">)))</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu10k1_spdif_control</span><span class="p">,</span> <span class="n">emu</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span>
			<span class="n">kctl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">pcm_efx</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">kctl</span><span class="p">)))</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">emu_model</span><span class="p">)</span> <span class="p">{</span>
		<span class="p">;</span>  <span class="cm">/* Disable the snd_audigy_spdif_shared_spdif */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_audigy_shared_spdif</span><span class="p">,</span> <span class="n">emu</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">kctl</span><span class="p">)))</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">		if ((kctl = snd_ctl_new1(&amp;snd_audigy_spdif_output_rate, emu)) == NULL)</span>
<span class="c">			return -ENOMEM;</span>
<span class="c">		if ((err = snd_ctl_add(card, kctl)))</span>
<span class="c">			return err;</span>
<span class="cp">#endif</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">ecard</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* sb live! */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">kctl</span> <span class="o">=</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu10k1_shared_spdif</span><span class="p">,</span> <span class="n">emu</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">kctl</span><span class="p">)))</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">ca0151_chip</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* P16V */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_p16v_mixer</span><span class="p">(</span><span class="n">emu</span><span class="p">)))</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">emu_model</span> <span class="o">==</span> <span class="n">EMU_MODEL_EMU1616</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* 1616(m) cardbus */</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snd_emu1616_output_enum_ctls</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>
				<span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu1616_output_enum_ctls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					     <span class="n">emu</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snd_emu1010_input_enum_ctls</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>
				<span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu1010_input_enum_ctls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					     <span class="n">emu</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snd_emu1010_adc_pads</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>
				<span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu1010_adc_pads</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">emu</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snd_emu1010_dac_pads</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>
				<span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu1010_dac_pads</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">emu</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>
			<span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu1010_internal_clock</span><span class="p">,</span> <span class="n">emu</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">emu_model</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* all other e-mu cards for now */</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snd_emu1010_output_enum_ctls</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>
				<span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu1010_output_enum_ctls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					     <span class="n">emu</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snd_emu1010_input_enum_ctls</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>
				<span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu1010_input_enum_ctls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
					     <span class="n">emu</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snd_emu1010_adc_pads</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>
				<span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu1010_adc_pads</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">emu</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snd_emu1010_dac_pads</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>
				<span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu1010_dac_pads</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">emu</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>
			<span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_emu1010_internal_clock</span><span class="p">,</span> <span class="n">emu</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">i2c_adc</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_audigy_i2c_capture_source</span><span class="p">,</span> <span class="n">emu</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snd_audigy_i2c_volume_ctls</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_audigy_i2c_volume_ctls</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">emu</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
		
	<span class="k">if</span> <span class="p">(</span><span class="n">emu</span><span class="o">-&gt;</span><span class="n">card_capabilities</span><span class="o">-&gt;</span><span class="n">ac97_chip</span> <span class="o">&amp;&amp;</span> <span class="n">emu</span><span class="o">-&gt;</span><span class="n">audigy</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">snd_audigy_capture_boost</span><span class="p">,</span>
						     <span class="n">emu</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
