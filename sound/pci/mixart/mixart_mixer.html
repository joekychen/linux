<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › pci › mixart › mixart_mixer.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>mixart_mixer.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Driver for Digigram miXart soundcards</span>
<span class="cm"> *</span>
<span class="cm"> * mixer callbacks</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2003 by Digigram &lt;alsa@digigram.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/time.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>

<span class="cp">#include &lt;sound/core.h&gt;</span>
<span class="cp">#include &quot;mixart.h&quot;</span>
<span class="cp">#include &quot;mixart_core.h&quot;</span>
<span class="cp">#include &quot;mixart_hwdep.h&quot;</span>
<span class="cp">#include &lt;sound/control.h&gt;</span>
<span class="cp">#include &lt;sound/tlv.h&gt;</span>
<span class="cp">#include &quot;mixart_mixer.h&quot;</span>

<span class="k">static</span> <span class="n">u32</span> <span class="n">mixart_analog_level</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0xc2c00000</span><span class="p">,</span>		<span class="cm">/* [000] -96.0 dB */</span>
	<span class="mh">0xc2bf0000</span><span class="p">,</span>		<span class="cm">/* [001] -95.5 dB */</span>
	<span class="mh">0xc2be0000</span><span class="p">,</span>		<span class="cm">/* [002] -95.0 dB */</span>
	<span class="mh">0xc2bd0000</span><span class="p">,</span>		<span class="cm">/* [003] -94.5 dB */</span>
	<span class="mh">0xc2bc0000</span><span class="p">,</span>		<span class="cm">/* [004] -94.0 dB */</span>
	<span class="mh">0xc2bb0000</span><span class="p">,</span>		<span class="cm">/* [005] -93.5 dB */</span>
	<span class="mh">0xc2ba0000</span><span class="p">,</span>		<span class="cm">/* [006] -93.0 dB */</span>
	<span class="mh">0xc2b90000</span><span class="p">,</span>		<span class="cm">/* [007] -92.5 dB */</span>
	<span class="mh">0xc2b80000</span><span class="p">,</span>		<span class="cm">/* [008] -92.0 dB */</span>
	<span class="mh">0xc2b70000</span><span class="p">,</span>		<span class="cm">/* [009] -91.5 dB */</span>
	<span class="mh">0xc2b60000</span><span class="p">,</span>		<span class="cm">/* [010] -91.0 dB */</span>
	<span class="mh">0xc2b50000</span><span class="p">,</span>		<span class="cm">/* [011] -90.5 dB */</span>
	<span class="mh">0xc2b40000</span><span class="p">,</span>		<span class="cm">/* [012] -90.0 dB */</span>
	<span class="mh">0xc2b30000</span><span class="p">,</span>		<span class="cm">/* [013] -89.5 dB */</span>
	<span class="mh">0xc2b20000</span><span class="p">,</span>		<span class="cm">/* [014] -89.0 dB */</span>
	<span class="mh">0xc2b10000</span><span class="p">,</span>		<span class="cm">/* [015] -88.5 dB */</span>
	<span class="mh">0xc2b00000</span><span class="p">,</span>		<span class="cm">/* [016] -88.0 dB */</span>
	<span class="mh">0xc2af0000</span><span class="p">,</span>		<span class="cm">/* [017] -87.5 dB */</span>
	<span class="mh">0xc2ae0000</span><span class="p">,</span>		<span class="cm">/* [018] -87.0 dB */</span>
	<span class="mh">0xc2ad0000</span><span class="p">,</span>		<span class="cm">/* [019] -86.5 dB */</span>
	<span class="mh">0xc2ac0000</span><span class="p">,</span>		<span class="cm">/* [020] -86.0 dB */</span>
	<span class="mh">0xc2ab0000</span><span class="p">,</span>		<span class="cm">/* [021] -85.5 dB */</span>
	<span class="mh">0xc2aa0000</span><span class="p">,</span>		<span class="cm">/* [022] -85.0 dB */</span>
	<span class="mh">0xc2a90000</span><span class="p">,</span>		<span class="cm">/* [023] -84.5 dB */</span>
	<span class="mh">0xc2a80000</span><span class="p">,</span>		<span class="cm">/* [024] -84.0 dB */</span>
	<span class="mh">0xc2a70000</span><span class="p">,</span>		<span class="cm">/* [025] -83.5 dB */</span>
	<span class="mh">0xc2a60000</span><span class="p">,</span>		<span class="cm">/* [026] -83.0 dB */</span>
	<span class="mh">0xc2a50000</span><span class="p">,</span>		<span class="cm">/* [027] -82.5 dB */</span>
	<span class="mh">0xc2a40000</span><span class="p">,</span>		<span class="cm">/* [028] -82.0 dB */</span>
	<span class="mh">0xc2a30000</span><span class="p">,</span>		<span class="cm">/* [029] -81.5 dB */</span>
	<span class="mh">0xc2a20000</span><span class="p">,</span>		<span class="cm">/* [030] -81.0 dB */</span>
	<span class="mh">0xc2a10000</span><span class="p">,</span>		<span class="cm">/* [031] -80.5 dB */</span>
	<span class="mh">0xc2a00000</span><span class="p">,</span>		<span class="cm">/* [032] -80.0 dB */</span>
	<span class="mh">0xc29f0000</span><span class="p">,</span>		<span class="cm">/* [033] -79.5 dB */</span>
	<span class="mh">0xc29e0000</span><span class="p">,</span>		<span class="cm">/* [034] -79.0 dB */</span>
	<span class="mh">0xc29d0000</span><span class="p">,</span>		<span class="cm">/* [035] -78.5 dB */</span>
	<span class="mh">0xc29c0000</span><span class="p">,</span>		<span class="cm">/* [036] -78.0 dB */</span>
	<span class="mh">0xc29b0000</span><span class="p">,</span>		<span class="cm">/* [037] -77.5 dB */</span>
	<span class="mh">0xc29a0000</span><span class="p">,</span>		<span class="cm">/* [038] -77.0 dB */</span>
	<span class="mh">0xc2990000</span><span class="p">,</span>		<span class="cm">/* [039] -76.5 dB */</span>
	<span class="mh">0xc2980000</span><span class="p">,</span>		<span class="cm">/* [040] -76.0 dB */</span>
	<span class="mh">0xc2970000</span><span class="p">,</span>		<span class="cm">/* [041] -75.5 dB */</span>
	<span class="mh">0xc2960000</span><span class="p">,</span>		<span class="cm">/* [042] -75.0 dB */</span>
	<span class="mh">0xc2950000</span><span class="p">,</span>		<span class="cm">/* [043] -74.5 dB */</span>
	<span class="mh">0xc2940000</span><span class="p">,</span>		<span class="cm">/* [044] -74.0 dB */</span>
	<span class="mh">0xc2930000</span><span class="p">,</span>		<span class="cm">/* [045] -73.5 dB */</span>
	<span class="mh">0xc2920000</span><span class="p">,</span>		<span class="cm">/* [046] -73.0 dB */</span>
	<span class="mh">0xc2910000</span><span class="p">,</span>		<span class="cm">/* [047] -72.5 dB */</span>
	<span class="mh">0xc2900000</span><span class="p">,</span>		<span class="cm">/* [048] -72.0 dB */</span>
	<span class="mh">0xc28f0000</span><span class="p">,</span>		<span class="cm">/* [049] -71.5 dB */</span>
	<span class="mh">0xc28e0000</span><span class="p">,</span>		<span class="cm">/* [050] -71.0 dB */</span>
	<span class="mh">0xc28d0000</span><span class="p">,</span>		<span class="cm">/* [051] -70.5 dB */</span>
	<span class="mh">0xc28c0000</span><span class="p">,</span>		<span class="cm">/* [052] -70.0 dB */</span>
	<span class="mh">0xc28b0000</span><span class="p">,</span>		<span class="cm">/* [053] -69.5 dB */</span>
	<span class="mh">0xc28a0000</span><span class="p">,</span>		<span class="cm">/* [054] -69.0 dB */</span>
	<span class="mh">0xc2890000</span><span class="p">,</span>		<span class="cm">/* [055] -68.5 dB */</span>
	<span class="mh">0xc2880000</span><span class="p">,</span>		<span class="cm">/* [056] -68.0 dB */</span>
	<span class="mh">0xc2870000</span><span class="p">,</span>		<span class="cm">/* [057] -67.5 dB */</span>
	<span class="mh">0xc2860000</span><span class="p">,</span>		<span class="cm">/* [058] -67.0 dB */</span>
	<span class="mh">0xc2850000</span><span class="p">,</span>		<span class="cm">/* [059] -66.5 dB */</span>
	<span class="mh">0xc2840000</span><span class="p">,</span>		<span class="cm">/* [060] -66.0 dB */</span>
	<span class="mh">0xc2830000</span><span class="p">,</span>		<span class="cm">/* [061] -65.5 dB */</span>
	<span class="mh">0xc2820000</span><span class="p">,</span>		<span class="cm">/* [062] -65.0 dB */</span>
	<span class="mh">0xc2810000</span><span class="p">,</span>		<span class="cm">/* [063] -64.5 dB */</span>
	<span class="mh">0xc2800000</span><span class="p">,</span>		<span class="cm">/* [064] -64.0 dB */</span>
	<span class="mh">0xc27e0000</span><span class="p">,</span>		<span class="cm">/* [065] -63.5 dB */</span>
	<span class="mh">0xc27c0000</span><span class="p">,</span>		<span class="cm">/* [066] -63.0 dB */</span>
	<span class="mh">0xc27a0000</span><span class="p">,</span>		<span class="cm">/* [067] -62.5 dB */</span>
	<span class="mh">0xc2780000</span><span class="p">,</span>		<span class="cm">/* [068] -62.0 dB */</span>
	<span class="mh">0xc2760000</span><span class="p">,</span>		<span class="cm">/* [069] -61.5 dB */</span>
	<span class="mh">0xc2740000</span><span class="p">,</span>		<span class="cm">/* [070] -61.0 dB */</span>
	<span class="mh">0xc2720000</span><span class="p">,</span>		<span class="cm">/* [071] -60.5 dB */</span>
	<span class="mh">0xc2700000</span><span class="p">,</span>		<span class="cm">/* [072] -60.0 dB */</span>
	<span class="mh">0xc26e0000</span><span class="p">,</span>		<span class="cm">/* [073] -59.5 dB */</span>
	<span class="mh">0xc26c0000</span><span class="p">,</span>		<span class="cm">/* [074] -59.0 dB */</span>
	<span class="mh">0xc26a0000</span><span class="p">,</span>		<span class="cm">/* [075] -58.5 dB */</span>
	<span class="mh">0xc2680000</span><span class="p">,</span>		<span class="cm">/* [076] -58.0 dB */</span>
	<span class="mh">0xc2660000</span><span class="p">,</span>		<span class="cm">/* [077] -57.5 dB */</span>
	<span class="mh">0xc2640000</span><span class="p">,</span>		<span class="cm">/* [078] -57.0 dB */</span>
	<span class="mh">0xc2620000</span><span class="p">,</span>		<span class="cm">/* [079] -56.5 dB */</span>
	<span class="mh">0xc2600000</span><span class="p">,</span>		<span class="cm">/* [080] -56.0 dB */</span>
	<span class="mh">0xc25e0000</span><span class="p">,</span>		<span class="cm">/* [081] -55.5 dB */</span>
	<span class="mh">0xc25c0000</span><span class="p">,</span>		<span class="cm">/* [082] -55.0 dB */</span>
	<span class="mh">0xc25a0000</span><span class="p">,</span>		<span class="cm">/* [083] -54.5 dB */</span>
	<span class="mh">0xc2580000</span><span class="p">,</span>		<span class="cm">/* [084] -54.0 dB */</span>
	<span class="mh">0xc2560000</span><span class="p">,</span>		<span class="cm">/* [085] -53.5 dB */</span>
	<span class="mh">0xc2540000</span><span class="p">,</span>		<span class="cm">/* [086] -53.0 dB */</span>
	<span class="mh">0xc2520000</span><span class="p">,</span>		<span class="cm">/* [087] -52.5 dB */</span>
	<span class="mh">0xc2500000</span><span class="p">,</span>		<span class="cm">/* [088] -52.0 dB */</span>
	<span class="mh">0xc24e0000</span><span class="p">,</span>		<span class="cm">/* [089] -51.5 dB */</span>
	<span class="mh">0xc24c0000</span><span class="p">,</span>		<span class="cm">/* [090] -51.0 dB */</span>
	<span class="mh">0xc24a0000</span><span class="p">,</span>		<span class="cm">/* [091] -50.5 dB */</span>
	<span class="mh">0xc2480000</span><span class="p">,</span>		<span class="cm">/* [092] -50.0 dB */</span>
	<span class="mh">0xc2460000</span><span class="p">,</span>		<span class="cm">/* [093] -49.5 dB */</span>
	<span class="mh">0xc2440000</span><span class="p">,</span>		<span class="cm">/* [094] -49.0 dB */</span>
	<span class="mh">0xc2420000</span><span class="p">,</span>		<span class="cm">/* [095] -48.5 dB */</span>
	<span class="mh">0xc2400000</span><span class="p">,</span>		<span class="cm">/* [096] -48.0 dB */</span>
	<span class="mh">0xc23e0000</span><span class="p">,</span>		<span class="cm">/* [097] -47.5 dB */</span>
	<span class="mh">0xc23c0000</span><span class="p">,</span>		<span class="cm">/* [098] -47.0 dB */</span>
	<span class="mh">0xc23a0000</span><span class="p">,</span>		<span class="cm">/* [099] -46.5 dB */</span>
	<span class="mh">0xc2380000</span><span class="p">,</span>		<span class="cm">/* [100] -46.0 dB */</span>
	<span class="mh">0xc2360000</span><span class="p">,</span>		<span class="cm">/* [101] -45.5 dB */</span>
	<span class="mh">0xc2340000</span><span class="p">,</span>		<span class="cm">/* [102] -45.0 dB */</span>
	<span class="mh">0xc2320000</span><span class="p">,</span>		<span class="cm">/* [103] -44.5 dB */</span>
	<span class="mh">0xc2300000</span><span class="p">,</span>		<span class="cm">/* [104] -44.0 dB */</span>
	<span class="mh">0xc22e0000</span><span class="p">,</span>		<span class="cm">/* [105] -43.5 dB */</span>
	<span class="mh">0xc22c0000</span><span class="p">,</span>		<span class="cm">/* [106] -43.0 dB */</span>
	<span class="mh">0xc22a0000</span><span class="p">,</span>		<span class="cm">/* [107] -42.5 dB */</span>
	<span class="mh">0xc2280000</span><span class="p">,</span>		<span class="cm">/* [108] -42.0 dB */</span>
	<span class="mh">0xc2260000</span><span class="p">,</span>		<span class="cm">/* [109] -41.5 dB */</span>
	<span class="mh">0xc2240000</span><span class="p">,</span>		<span class="cm">/* [110] -41.0 dB */</span>
	<span class="mh">0xc2220000</span><span class="p">,</span>		<span class="cm">/* [111] -40.5 dB */</span>
	<span class="mh">0xc2200000</span><span class="p">,</span>		<span class="cm">/* [112] -40.0 dB */</span>
	<span class="mh">0xc21e0000</span><span class="p">,</span>		<span class="cm">/* [113] -39.5 dB */</span>
	<span class="mh">0xc21c0000</span><span class="p">,</span>		<span class="cm">/* [114] -39.0 dB */</span>
	<span class="mh">0xc21a0000</span><span class="p">,</span>		<span class="cm">/* [115] -38.5 dB */</span>
	<span class="mh">0xc2180000</span><span class="p">,</span>		<span class="cm">/* [116] -38.0 dB */</span>
	<span class="mh">0xc2160000</span><span class="p">,</span>		<span class="cm">/* [117] -37.5 dB */</span>
	<span class="mh">0xc2140000</span><span class="p">,</span>		<span class="cm">/* [118] -37.0 dB */</span>
	<span class="mh">0xc2120000</span><span class="p">,</span>		<span class="cm">/* [119] -36.5 dB */</span>
	<span class="mh">0xc2100000</span><span class="p">,</span>		<span class="cm">/* [120] -36.0 dB */</span>
	<span class="mh">0xc20e0000</span><span class="p">,</span>		<span class="cm">/* [121] -35.5 dB */</span>
	<span class="mh">0xc20c0000</span><span class="p">,</span>		<span class="cm">/* [122] -35.0 dB */</span>
	<span class="mh">0xc20a0000</span><span class="p">,</span>		<span class="cm">/* [123] -34.5 dB */</span>
	<span class="mh">0xc2080000</span><span class="p">,</span>		<span class="cm">/* [124] -34.0 dB */</span>
	<span class="mh">0xc2060000</span><span class="p">,</span>		<span class="cm">/* [125] -33.5 dB */</span>
	<span class="mh">0xc2040000</span><span class="p">,</span>		<span class="cm">/* [126] -33.0 dB */</span>
	<span class="mh">0xc2020000</span><span class="p">,</span>		<span class="cm">/* [127] -32.5 dB */</span>
	<span class="mh">0xc2000000</span><span class="p">,</span>		<span class="cm">/* [128] -32.0 dB */</span>
	<span class="mh">0xc1fc0000</span><span class="p">,</span>		<span class="cm">/* [129] -31.5 dB */</span>
	<span class="mh">0xc1f80000</span><span class="p">,</span>		<span class="cm">/* [130] -31.0 dB */</span>
	<span class="mh">0xc1f40000</span><span class="p">,</span>		<span class="cm">/* [131] -30.5 dB */</span>
	<span class="mh">0xc1f00000</span><span class="p">,</span>		<span class="cm">/* [132] -30.0 dB */</span>
	<span class="mh">0xc1ec0000</span><span class="p">,</span>		<span class="cm">/* [133] -29.5 dB */</span>
	<span class="mh">0xc1e80000</span><span class="p">,</span>		<span class="cm">/* [134] -29.0 dB */</span>
	<span class="mh">0xc1e40000</span><span class="p">,</span>		<span class="cm">/* [135] -28.5 dB */</span>
	<span class="mh">0xc1e00000</span><span class="p">,</span>		<span class="cm">/* [136] -28.0 dB */</span>
	<span class="mh">0xc1dc0000</span><span class="p">,</span>		<span class="cm">/* [137] -27.5 dB */</span>
	<span class="mh">0xc1d80000</span><span class="p">,</span>		<span class="cm">/* [138] -27.0 dB */</span>
	<span class="mh">0xc1d40000</span><span class="p">,</span>		<span class="cm">/* [139] -26.5 dB */</span>
	<span class="mh">0xc1d00000</span><span class="p">,</span>		<span class="cm">/* [140] -26.0 dB */</span>
	<span class="mh">0xc1cc0000</span><span class="p">,</span>		<span class="cm">/* [141] -25.5 dB */</span>
	<span class="mh">0xc1c80000</span><span class="p">,</span>		<span class="cm">/* [142] -25.0 dB */</span>
	<span class="mh">0xc1c40000</span><span class="p">,</span>		<span class="cm">/* [143] -24.5 dB */</span>
	<span class="mh">0xc1c00000</span><span class="p">,</span>		<span class="cm">/* [144] -24.0 dB */</span>
	<span class="mh">0xc1bc0000</span><span class="p">,</span>		<span class="cm">/* [145] -23.5 dB */</span>
	<span class="mh">0xc1b80000</span><span class="p">,</span>		<span class="cm">/* [146] -23.0 dB */</span>
	<span class="mh">0xc1b40000</span><span class="p">,</span>		<span class="cm">/* [147] -22.5 dB */</span>
	<span class="mh">0xc1b00000</span><span class="p">,</span>		<span class="cm">/* [148] -22.0 dB */</span>
	<span class="mh">0xc1ac0000</span><span class="p">,</span>		<span class="cm">/* [149] -21.5 dB */</span>
	<span class="mh">0xc1a80000</span><span class="p">,</span>		<span class="cm">/* [150] -21.0 dB */</span>
	<span class="mh">0xc1a40000</span><span class="p">,</span>		<span class="cm">/* [151] -20.5 dB */</span>
	<span class="mh">0xc1a00000</span><span class="p">,</span>		<span class="cm">/* [152] -20.0 dB */</span>
	<span class="mh">0xc19c0000</span><span class="p">,</span>		<span class="cm">/* [153] -19.5 dB */</span>
	<span class="mh">0xc1980000</span><span class="p">,</span>		<span class="cm">/* [154] -19.0 dB */</span>
	<span class="mh">0xc1940000</span><span class="p">,</span>		<span class="cm">/* [155] -18.5 dB */</span>
	<span class="mh">0xc1900000</span><span class="p">,</span>		<span class="cm">/* [156] -18.0 dB */</span>
	<span class="mh">0xc18c0000</span><span class="p">,</span>		<span class="cm">/* [157] -17.5 dB */</span>
	<span class="mh">0xc1880000</span><span class="p">,</span>		<span class="cm">/* [158] -17.0 dB */</span>
	<span class="mh">0xc1840000</span><span class="p">,</span>		<span class="cm">/* [159] -16.5 dB */</span>
	<span class="mh">0xc1800000</span><span class="p">,</span>		<span class="cm">/* [160] -16.0 dB */</span>
	<span class="mh">0xc1780000</span><span class="p">,</span>		<span class="cm">/* [161] -15.5 dB */</span>
	<span class="mh">0xc1700000</span><span class="p">,</span>		<span class="cm">/* [162] -15.0 dB */</span>
	<span class="mh">0xc1680000</span><span class="p">,</span>		<span class="cm">/* [163] -14.5 dB */</span>
	<span class="mh">0xc1600000</span><span class="p">,</span>		<span class="cm">/* [164] -14.0 dB */</span>
	<span class="mh">0xc1580000</span><span class="p">,</span>		<span class="cm">/* [165] -13.5 dB */</span>
	<span class="mh">0xc1500000</span><span class="p">,</span>		<span class="cm">/* [166] -13.0 dB */</span>
	<span class="mh">0xc1480000</span><span class="p">,</span>		<span class="cm">/* [167] -12.5 dB */</span>
	<span class="mh">0xc1400000</span><span class="p">,</span>		<span class="cm">/* [168] -12.0 dB */</span>
	<span class="mh">0xc1380000</span><span class="p">,</span>		<span class="cm">/* [169] -11.5 dB */</span>
	<span class="mh">0xc1300000</span><span class="p">,</span>		<span class="cm">/* [170] -11.0 dB */</span>
	<span class="mh">0xc1280000</span><span class="p">,</span>		<span class="cm">/* [171] -10.5 dB */</span>
	<span class="mh">0xc1200000</span><span class="p">,</span>		<span class="cm">/* [172] -10.0 dB */</span>
	<span class="mh">0xc1180000</span><span class="p">,</span>		<span class="cm">/* [173] -9.5 dB */</span>
	<span class="mh">0xc1100000</span><span class="p">,</span>		<span class="cm">/* [174] -9.0 dB */</span>
	<span class="mh">0xc1080000</span><span class="p">,</span>		<span class="cm">/* [175] -8.5 dB */</span>
	<span class="mh">0xc1000000</span><span class="p">,</span>		<span class="cm">/* [176] -8.0 dB */</span>
	<span class="mh">0xc0f00000</span><span class="p">,</span>		<span class="cm">/* [177] -7.5 dB */</span>
	<span class="mh">0xc0e00000</span><span class="p">,</span>		<span class="cm">/* [178] -7.0 dB */</span>
	<span class="mh">0xc0d00000</span><span class="p">,</span>		<span class="cm">/* [179] -6.5 dB */</span>
	<span class="mh">0xc0c00000</span><span class="p">,</span>		<span class="cm">/* [180] -6.0 dB */</span>
	<span class="mh">0xc0b00000</span><span class="p">,</span>		<span class="cm">/* [181] -5.5 dB */</span>
	<span class="mh">0xc0a00000</span><span class="p">,</span>		<span class="cm">/* [182] -5.0 dB */</span>
	<span class="mh">0xc0900000</span><span class="p">,</span>		<span class="cm">/* [183] -4.5 dB */</span>
	<span class="mh">0xc0800000</span><span class="p">,</span>		<span class="cm">/* [184] -4.0 dB */</span>
	<span class="mh">0xc0600000</span><span class="p">,</span>		<span class="cm">/* [185] -3.5 dB */</span>
	<span class="mh">0xc0400000</span><span class="p">,</span>		<span class="cm">/* [186] -3.0 dB */</span>
	<span class="mh">0xc0200000</span><span class="p">,</span>		<span class="cm">/* [187] -2.5 dB */</span>
	<span class="mh">0xc0000000</span><span class="p">,</span>		<span class="cm">/* [188] -2.0 dB */</span>
	<span class="mh">0xbfc00000</span><span class="p">,</span>		<span class="cm">/* [189] -1.5 dB */</span>
	<span class="mh">0xbf800000</span><span class="p">,</span>		<span class="cm">/* [190] -1.0 dB */</span>
	<span class="mh">0xbf000000</span><span class="p">,</span>		<span class="cm">/* [191] -0.5 dB */</span>
	<span class="mh">0x00000000</span><span class="p">,</span>		<span class="cm">/* [192] 0.0 dB */</span>
	<span class="mh">0x3f000000</span><span class="p">,</span>		<span class="cm">/* [193] 0.5 dB */</span>
	<span class="mh">0x3f800000</span><span class="p">,</span>		<span class="cm">/* [194] 1.0 dB */</span>
	<span class="mh">0x3fc00000</span><span class="p">,</span>		<span class="cm">/* [195] 1.5 dB */</span>
	<span class="mh">0x40000000</span><span class="p">,</span>		<span class="cm">/* [196] 2.0 dB */</span>
	<span class="mh">0x40200000</span><span class="p">,</span>		<span class="cm">/* [197] 2.5 dB */</span>
	<span class="mh">0x40400000</span><span class="p">,</span>		<span class="cm">/* [198] 3.0 dB */</span>
	<span class="mh">0x40600000</span><span class="p">,</span>		<span class="cm">/* [199] 3.5 dB */</span>
	<span class="mh">0x40800000</span><span class="p">,</span>		<span class="cm">/* [200] 4.0 dB */</span>
	<span class="mh">0x40900000</span><span class="p">,</span>		<span class="cm">/* [201] 4.5 dB */</span>
	<span class="mh">0x40a00000</span><span class="p">,</span>		<span class="cm">/* [202] 5.0 dB */</span>
	<span class="mh">0x40b00000</span><span class="p">,</span>		<span class="cm">/* [203] 5.5 dB */</span>
	<span class="mh">0x40c00000</span><span class="p">,</span>		<span class="cm">/* [204] 6.0 dB */</span>
	<span class="mh">0x40d00000</span><span class="p">,</span>		<span class="cm">/* [205] 6.5 dB */</span>
	<span class="mh">0x40e00000</span><span class="p">,</span>		<span class="cm">/* [206] 7.0 dB */</span>
	<span class="mh">0x40f00000</span><span class="p">,</span>		<span class="cm">/* [207] 7.5 dB */</span>
	<span class="mh">0x41000000</span><span class="p">,</span>		<span class="cm">/* [208] 8.0 dB */</span>
	<span class="mh">0x41080000</span><span class="p">,</span>		<span class="cm">/* [209] 8.5 dB */</span>
	<span class="mh">0x41100000</span><span class="p">,</span>		<span class="cm">/* [210] 9.0 dB */</span>
	<span class="mh">0x41180000</span><span class="p">,</span>		<span class="cm">/* [211] 9.5 dB */</span>
	<span class="mh">0x41200000</span><span class="p">,</span>		<span class="cm">/* [212] 10.0 dB */</span>
	<span class="mh">0x41280000</span><span class="p">,</span>		<span class="cm">/* [213] 10.5 dB */</span>
	<span class="mh">0x41300000</span><span class="p">,</span>		<span class="cm">/* [214] 11.0 dB */</span>
	<span class="mh">0x41380000</span><span class="p">,</span>		<span class="cm">/* [215] 11.5 dB */</span>
	<span class="mh">0x41400000</span><span class="p">,</span>		<span class="cm">/* [216] 12.0 dB */</span>
	<span class="mh">0x41480000</span><span class="p">,</span>		<span class="cm">/* [217] 12.5 dB */</span>
	<span class="mh">0x41500000</span><span class="p">,</span>		<span class="cm">/* [218] 13.0 dB */</span>
	<span class="mh">0x41580000</span><span class="p">,</span>		<span class="cm">/* [219] 13.5 dB */</span>
	<span class="mh">0x41600000</span><span class="p">,</span>		<span class="cm">/* [220] 14.0 dB */</span>
	<span class="mh">0x41680000</span><span class="p">,</span>		<span class="cm">/* [221] 14.5 dB */</span>
	<span class="mh">0x41700000</span><span class="p">,</span>		<span class="cm">/* [222] 15.0 dB */</span>
	<span class="mh">0x41780000</span><span class="p">,</span>		<span class="cm">/* [223] 15.5 dB */</span>
	<span class="mh">0x41800000</span><span class="p">,</span>		<span class="cm">/* [224] 16.0 dB */</span>
	<span class="mh">0x41840000</span><span class="p">,</span>		<span class="cm">/* [225] 16.5 dB */</span>
	<span class="mh">0x41880000</span><span class="p">,</span>		<span class="cm">/* [226] 17.0 dB */</span>
	<span class="mh">0x418c0000</span><span class="p">,</span>		<span class="cm">/* [227] 17.5 dB */</span>
	<span class="mh">0x41900000</span><span class="p">,</span>		<span class="cm">/* [228] 18.0 dB */</span>
	<span class="mh">0x41940000</span><span class="p">,</span>		<span class="cm">/* [229] 18.5 dB */</span>
	<span class="mh">0x41980000</span><span class="p">,</span>		<span class="cm">/* [230] 19.0 dB */</span>
	<span class="mh">0x419c0000</span><span class="p">,</span>		<span class="cm">/* [231] 19.5 dB */</span>
	<span class="mh">0x41a00000</span><span class="p">,</span>		<span class="cm">/* [232] 20.0 dB */</span>
	<span class="mh">0x41a40000</span><span class="p">,</span>		<span class="cm">/* [233] 20.5 dB */</span>
	<span class="mh">0x41a80000</span><span class="p">,</span>		<span class="cm">/* [234] 21.0 dB */</span>
	<span class="mh">0x41ac0000</span><span class="p">,</span>		<span class="cm">/* [235] 21.5 dB */</span>
	<span class="mh">0x41b00000</span><span class="p">,</span>		<span class="cm">/* [236] 22.0 dB */</span>
	<span class="mh">0x41b40000</span><span class="p">,</span>		<span class="cm">/* [237] 22.5 dB */</span>
	<span class="mh">0x41b80000</span><span class="p">,</span>		<span class="cm">/* [238] 23.0 dB */</span>
	<span class="mh">0x41bc0000</span><span class="p">,</span>		<span class="cm">/* [239] 23.5 dB */</span>
	<span class="mh">0x41c00000</span><span class="p">,</span>		<span class="cm">/* [240] 24.0 dB */</span>
	<span class="mh">0x41c40000</span><span class="p">,</span>		<span class="cm">/* [241] 24.5 dB */</span>
	<span class="mh">0x41c80000</span><span class="p">,</span>		<span class="cm">/* [242] 25.0 dB */</span>
	<span class="mh">0x41cc0000</span><span class="p">,</span>		<span class="cm">/* [243] 25.5 dB */</span>
	<span class="mh">0x41d00000</span><span class="p">,</span>		<span class="cm">/* [244] 26.0 dB */</span>
	<span class="mh">0x41d40000</span><span class="p">,</span>		<span class="cm">/* [245] 26.5 dB */</span>
	<span class="mh">0x41d80000</span><span class="p">,</span>		<span class="cm">/* [246] 27.0 dB */</span>
	<span class="mh">0x41dc0000</span><span class="p">,</span>		<span class="cm">/* [247] 27.5 dB */</span>
	<span class="mh">0x41e00000</span><span class="p">,</span>		<span class="cm">/* [248] 28.0 dB */</span>
	<span class="mh">0x41e40000</span><span class="p">,</span>		<span class="cm">/* [249] 28.5 dB */</span>
	<span class="mh">0x41e80000</span><span class="p">,</span>		<span class="cm">/* [250] 29.0 dB */</span>
	<span class="mh">0x41ec0000</span><span class="p">,</span>		<span class="cm">/* [251] 29.5 dB */</span>
	<span class="mh">0x41f00000</span><span class="p">,</span>		<span class="cm">/* [252] 30.0 dB */</span>
	<span class="mh">0x41f40000</span><span class="p">,</span>		<span class="cm">/* [253] 30.5 dB */</span>
	<span class="mh">0x41f80000</span><span class="p">,</span>		<span class="cm">/* [254] 31.0 dB */</span>
	<span class="mh">0x41fc0000</span><span class="p">,</span>		<span class="cm">/* [255] 31.5 dB */</span>
<span class="p">};</span>

<span class="cp">#define MIXART_ANALOG_CAPTURE_LEVEL_MIN   0      </span><span class="cm">/* -96.0 dB + 8.0 dB = -88.0 dB */</span><span class="cp"></span>
<span class="cp">#define MIXART_ANALOG_CAPTURE_LEVEL_MAX   255    </span><span class="cm">/*  31.5 dB + 8.0 dB =  39.5 dB */</span><span class="cp"></span>
<span class="cp">#define MIXART_ANALOG_CAPTURE_ZERO_LEVEL  176    </span><span class="cm">/*  -8.0 dB + 8.0 dB =  0.0 dB */</span><span class="cp"></span>

<span class="cp">#define MIXART_ANALOG_PLAYBACK_LEVEL_MIN  0      </span><span class="cm">/* -96.0 dB + 1.5 dB = -94.5 dB (possible is down to (-114.0+1.5)dB) */</span><span class="cp"></span>
<span class="cp">#define MIXART_ANALOG_PLAYBACK_LEVEL_MAX  192    </span><span class="cm">/*   0.0 dB + 1.5 dB =  1.5 dB */</span><span class="cp"></span>
<span class="cp">#define MIXART_ANALOG_PLAYBACK_ZERO_LEVEL 189    </span><span class="cm">/*  -1.5 dB + 1.5 dB =  0.0 dB */</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_update_analog_audio_level</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_mixart</span><span class="o">*</span> <span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">is_capture</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mixart_msg</span> <span class="n">request</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mixart_io_level</span> <span class="n">io_level</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mixart_return_uid</span> <span class="n">resp</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">io_level</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">io_level</span><span class="p">));</span>
	<span class="n">io_level</span><span class="p">.</span><span class="n">channel</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* left and right */</span>

	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">is_capture</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">io_level</span><span class="p">.</span><span class="n">level</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">analog_level</span> <span class="o">=</span> <span class="n">mixart_analog_level</span><span class="p">[</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_capture_volume</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_playback_active</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="n">io_level</span><span class="p">.</span><span class="n">level</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">analog_level</span> <span class="o">=</span> <span class="n">mixart_analog_level</span><span class="p">[</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_playback_volume</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
			<span class="k">else</span>
				<span class="n">io_level</span><span class="p">.</span><span class="n">level</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">analog_level</span> <span class="o">=</span> <span class="n">mixart_analog_level</span><span class="p">[</span><span class="n">MIXART_ANALOG_PLAYBACK_LEVEL_MIN</span><span class="p">];</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span><span class="p">(</span><span class="n">is_capture</span><span class="p">)</span>	<span class="n">request</span><span class="p">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">uid_in_analog_physio</span><span class="p">;</span>
	<span class="k">else</span>		<span class="n">request</span><span class="p">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">uid_out_analog_physio</span><span class="p">;</span>
	<span class="n">request</span><span class="p">.</span><span class="n">message_id</span> <span class="o">=</span> <span class="n">MSG_PHYSICALIO_SET_LEVEL</span><span class="p">;</span>
	<span class="n">request</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">io_level</span><span class="p">;</span>
	<span class="n">request</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">io_level</span><span class="p">);</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_mixart_send_msg</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">request</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">resp</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">resp</span><span class="p">);</span>
	<span class="k">if</span><span class="p">((</span><span class="n">err</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="n">error_code</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">snd_printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;error MSG_PHYSICALIO_SET_LEVEL card(%d) is_capture(%d) error_code(%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">chip_idx</span><span class="p">,</span> <span class="n">is_capture</span><span class="p">,</span> <span class="n">resp</span><span class="p">.</span><span class="n">error_code</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * analog level control</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_analog_vol_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* playback */</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">MIXART_ANALOG_PLAYBACK_LEVEL_MIN</span><span class="p">;</span>  <span class="cm">/* -96 dB */</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">MIXART_ANALOG_PLAYBACK_LEVEL_MAX</span><span class="p">;</span>  <span class="cm">/* 0 dB */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>				<span class="cm">/* capture */</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">MIXART_ANALOG_CAPTURE_LEVEL_MIN</span><span class="p">;</span>   <span class="cm">/* -96 dB */</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">MIXART_ANALOG_CAPTURE_LEVEL_MAX</span><span class="p">;</span>   <span class="cm">/* 31.5 dB */</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_analog_vol_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* playback */</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_playback_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_playback_volume</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>				<span class="cm">/* capture */</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_capture_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_capture_volume</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_analog_vol_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">is_capture</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="n">is_capture</span> <span class="o">=</span> <span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">new_volume</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="kt">int</span> <span class="o">*</span><span class="n">stored_volume</span> <span class="o">=</span> <span class="n">is_capture</span> <span class="o">?</span>
			<span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_capture_volume</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">:</span>
			<span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_playback_volume</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">is_capture</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">new_volume</span> <span class="o">&lt;</span> <span class="n">MIXART_ANALOG_CAPTURE_LEVEL_MIN</span> <span class="o">||</span>
			    <span class="n">new_volume</span> <span class="o">&gt;</span> <span class="n">MIXART_ANALOG_CAPTURE_LEVEL_MAX</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">new_volume</span> <span class="o">&lt;</span> <span class="n">MIXART_ANALOG_PLAYBACK_LEVEL_MIN</span> <span class="o">||</span>
			    <span class="n">new_volume</span> <span class="o">&gt;</span> <span class="n">MIXART_ANALOG_PLAYBACK_LEVEL_MAX</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">stored_volume</span> <span class="o">!=</span> <span class="n">new_volume</span><span class="p">)</span> <span class="p">{</span>
			<span class="o">*</span><span class="n">stored_volume</span> <span class="o">=</span> <span class="n">new_volume</span><span class="p">;</span>
			<span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">changed</span><span class="p">)</span>
		<span class="n">mixart_update_analog_audio_level</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">is_capture</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">db_scale_analog</span><span class="p">,</span> <span class="o">-</span><span class="mi">9600</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">mixart_control_analog_level</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span> <span class="p">(</span><span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span> <span class="o">|</span>
		   <span class="n">SNDRV_CTL_ELEM_ACCESS_TLV_READ</span><span class="p">),</span>
	<span class="cm">/* name will be filled later */</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>		<span class="n">mixart_analog_vol_info</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>		<span class="n">mixart_analog_vol_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>		<span class="n">mixart_analog_vol_put</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tlv</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">db_scale_analog</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* shared */</span>
<span class="cp">#define mixart_sw_info		snd_ctl_boolean_stereo_info</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_audio_sw_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_playback_active</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_playback_active</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_audio_sw_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_playback_active</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span>
		    <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">chip</span><span class="o">-&gt;</span><span class="n">analog_playback_active</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
				<span class="o">!!</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">changed</span><span class="p">)</span> <span class="cm">/* update playback levels */</span>
		<span class="n">mixart_update_analog_audio_level</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">mixart_control_output_switch</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="s">&quot;Master Playback Switch&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">mixart_sw_info</span><span class="p">,</span>		<span class="cm">/* shared */</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">mixart_audio_sw_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">mixart_audio_sw_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">u32</span> <span class="n">mixart_digital_level</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00000000</span><span class="p">,</span>		<span class="cm">/* [000] = 0.00e+000 = mute if &lt;= -109.5dB */</span>
	<span class="mh">0x366e1c7a</span><span class="p">,</span>		<span class="cm">/* [001] = 3.55e-006 = pow(10.0, 0.05 * -109.0dB) */</span>
	<span class="mh">0x367c3860</span><span class="p">,</span>		<span class="cm">/* [002] = 3.76e-006 = pow(10.0, 0.05 * -108.5dB) */</span>
	<span class="mh">0x36859525</span><span class="p">,</span>		<span class="cm">/* [003] = 3.98e-006 = pow(10.0, 0.05 * -108.0dB) */</span>
	<span class="mh">0x368d7f74</span><span class="p">,</span>		<span class="cm">/* [004] = 4.22e-006 = pow(10.0, 0.05 * -107.5dB) */</span>
	<span class="mh">0x3695e1d4</span><span class="p">,</span>		<span class="cm">/* [005] = 4.47e-006 = pow(10.0, 0.05 * -107.0dB) */</span>
	<span class="mh">0x369ec362</span><span class="p">,</span>		<span class="cm">/* [006] = 4.73e-006 = pow(10.0, 0.05 * -106.5dB) */</span>
	<span class="mh">0x36a82ba8</span><span class="p">,</span>		<span class="cm">/* [007] = 5.01e-006 = pow(10.0, 0.05 * -106.0dB) */</span>
	<span class="mh">0x36b222a0</span><span class="p">,</span>		<span class="cm">/* [008] = 5.31e-006 = pow(10.0, 0.05 * -105.5dB) */</span>
	<span class="mh">0x36bcb0c1</span><span class="p">,</span>		<span class="cm">/* [009] = 5.62e-006 = pow(10.0, 0.05 * -105.0dB) */</span>
	<span class="mh">0x36c7defd</span><span class="p">,</span>		<span class="cm">/* [010] = 5.96e-006 = pow(10.0, 0.05 * -104.5dB) */</span>
	<span class="mh">0x36d3b6d3</span><span class="p">,</span>		<span class="cm">/* [011] = 6.31e-006 = pow(10.0, 0.05 * -104.0dB) */</span>
	<span class="mh">0x36e0424e</span><span class="p">,</span>		<span class="cm">/* [012] = 6.68e-006 = pow(10.0, 0.05 * -103.5dB) */</span>
	<span class="mh">0x36ed8c14</span><span class="p">,</span>		<span class="cm">/* [013] = 7.08e-006 = pow(10.0, 0.05 * -103.0dB) */</span>
	<span class="mh">0x36fb9f6c</span><span class="p">,</span>		<span class="cm">/* [014] = 7.50e-006 = pow(10.0, 0.05 * -102.5dB) */</span>
	<span class="mh">0x37054423</span><span class="p">,</span>		<span class="cm">/* [015] = 7.94e-006 = pow(10.0, 0.05 * -102.0dB) */</span>
	<span class="mh">0x370d29a5</span><span class="p">,</span>		<span class="cm">/* [016] = 8.41e-006 = pow(10.0, 0.05 * -101.5dB) */</span>
	<span class="mh">0x371586f0</span><span class="p">,</span>		<span class="cm">/* [017] = 8.91e-006 = pow(10.0, 0.05 * -101.0dB) */</span>
	<span class="mh">0x371e631b</span><span class="p">,</span>		<span class="cm">/* [018] = 9.44e-006 = pow(10.0, 0.05 * -100.5dB) */</span>
	<span class="mh">0x3727c5ac</span><span class="p">,</span>		<span class="cm">/* [019] = 1.00e-005 = pow(10.0, 0.05 * -100.0dB) */</span>
	<span class="mh">0x3731b69a</span><span class="p">,</span>		<span class="cm">/* [020] = 1.06e-005 = pow(10.0, 0.05 * -99.5dB) */</span>
	<span class="mh">0x373c3e53</span><span class="p">,</span>		<span class="cm">/* [021] = 1.12e-005 = pow(10.0, 0.05 * -99.0dB) */</span>
	<span class="mh">0x374765c8</span><span class="p">,</span>		<span class="cm">/* [022] = 1.19e-005 = pow(10.0, 0.05 * -98.5dB) */</span>
	<span class="mh">0x3753366f</span><span class="p">,</span>		<span class="cm">/* [023] = 1.26e-005 = pow(10.0, 0.05 * -98.0dB) */</span>
	<span class="mh">0x375fba4f</span><span class="p">,</span>		<span class="cm">/* [024] = 1.33e-005 = pow(10.0, 0.05 * -97.5dB) */</span>
	<span class="mh">0x376cfc07</span><span class="p">,</span>		<span class="cm">/* [025] = 1.41e-005 = pow(10.0, 0.05 * -97.0dB) */</span>
	<span class="mh">0x377b06d5</span><span class="p">,</span>		<span class="cm">/* [026] = 1.50e-005 = pow(10.0, 0.05 * -96.5dB) */</span>
	<span class="mh">0x3784f352</span><span class="p">,</span>		<span class="cm">/* [027] = 1.58e-005 = pow(10.0, 0.05 * -96.0dB) */</span>
	<span class="mh">0x378cd40b</span><span class="p">,</span>		<span class="cm">/* [028] = 1.68e-005 = pow(10.0, 0.05 * -95.5dB) */</span>
	<span class="mh">0x37952c42</span><span class="p">,</span>		<span class="cm">/* [029] = 1.78e-005 = pow(10.0, 0.05 * -95.0dB) */</span>
	<span class="mh">0x379e030e</span><span class="p">,</span>		<span class="cm">/* [030] = 1.88e-005 = pow(10.0, 0.05 * -94.5dB) */</span>
	<span class="mh">0x37a75fef</span><span class="p">,</span>		<span class="cm">/* [031] = 2.00e-005 = pow(10.0, 0.05 * -94.0dB) */</span>
	<span class="mh">0x37b14ad5</span><span class="p">,</span>		<span class="cm">/* [032] = 2.11e-005 = pow(10.0, 0.05 * -93.5dB) */</span>
	<span class="mh">0x37bbcc2c</span><span class="p">,</span>		<span class="cm">/* [033] = 2.24e-005 = pow(10.0, 0.05 * -93.0dB) */</span>
	<span class="mh">0x37c6ecdd</span><span class="p">,</span>		<span class="cm">/* [034] = 2.37e-005 = pow(10.0, 0.05 * -92.5dB) */</span>
	<span class="mh">0x37d2b65a</span><span class="p">,</span>		<span class="cm">/* [035] = 2.51e-005 = pow(10.0, 0.05 * -92.0dB) */</span>
	<span class="mh">0x37df32a3</span><span class="p">,</span>		<span class="cm">/* [036] = 2.66e-005 = pow(10.0, 0.05 * -91.5dB) */</span>
	<span class="mh">0x37ec6c50</span><span class="p">,</span>		<span class="cm">/* [037] = 2.82e-005 = pow(10.0, 0.05 * -91.0dB) */</span>
	<span class="mh">0x37fa6e9b</span><span class="p">,</span>		<span class="cm">/* [038] = 2.99e-005 = pow(10.0, 0.05 * -90.5dB) */</span>
	<span class="mh">0x3804a2b3</span><span class="p">,</span>		<span class="cm">/* [039] = 3.16e-005 = pow(10.0, 0.05 * -90.0dB) */</span>
	<span class="mh">0x380c7ea4</span><span class="p">,</span>		<span class="cm">/* [040] = 3.35e-005 = pow(10.0, 0.05 * -89.5dB) */</span>
	<span class="mh">0x3814d1cc</span><span class="p">,</span>		<span class="cm">/* [041] = 3.55e-005 = pow(10.0, 0.05 * -89.0dB) */</span>
	<span class="mh">0x381da33c</span><span class="p">,</span>		<span class="cm">/* [042] = 3.76e-005 = pow(10.0, 0.05 * -88.5dB) */</span>
	<span class="mh">0x3826fa6f</span><span class="p">,</span>		<span class="cm">/* [043] = 3.98e-005 = pow(10.0, 0.05 * -88.0dB) */</span>
	<span class="mh">0x3830df51</span><span class="p">,</span>		<span class="cm">/* [044] = 4.22e-005 = pow(10.0, 0.05 * -87.5dB) */</span>
	<span class="mh">0x383b5a49</span><span class="p">,</span>		<span class="cm">/* [045] = 4.47e-005 = pow(10.0, 0.05 * -87.0dB) */</span>
	<span class="mh">0x3846743b</span><span class="p">,</span>		<span class="cm">/* [046] = 4.73e-005 = pow(10.0, 0.05 * -86.5dB) */</span>
	<span class="mh">0x38523692</span><span class="p">,</span>		<span class="cm">/* [047] = 5.01e-005 = pow(10.0, 0.05 * -86.0dB) */</span>
	<span class="mh">0x385eab48</span><span class="p">,</span>		<span class="cm">/* [048] = 5.31e-005 = pow(10.0, 0.05 * -85.5dB) */</span>
	<span class="mh">0x386bdcf1</span><span class="p">,</span>		<span class="cm">/* [049] = 5.62e-005 = pow(10.0, 0.05 * -85.0dB) */</span>
	<span class="mh">0x3879d6bc</span><span class="p">,</span>		<span class="cm">/* [050] = 5.96e-005 = pow(10.0, 0.05 * -84.5dB) */</span>
	<span class="mh">0x38845244</span><span class="p">,</span>		<span class="cm">/* [051] = 6.31e-005 = pow(10.0, 0.05 * -84.0dB) */</span>
	<span class="mh">0x388c2971</span><span class="p">,</span>		<span class="cm">/* [052] = 6.68e-005 = pow(10.0, 0.05 * -83.5dB) */</span>
	<span class="mh">0x3894778d</span><span class="p">,</span>		<span class="cm">/* [053] = 7.08e-005 = pow(10.0, 0.05 * -83.0dB) */</span>
	<span class="mh">0x389d43a4</span><span class="p">,</span>		<span class="cm">/* [054] = 7.50e-005 = pow(10.0, 0.05 * -82.5dB) */</span>
	<span class="mh">0x38a6952c</span><span class="p">,</span>		<span class="cm">/* [055] = 7.94e-005 = pow(10.0, 0.05 * -82.0dB) */</span>
	<span class="mh">0x38b0740f</span><span class="p">,</span>		<span class="cm">/* [056] = 8.41e-005 = pow(10.0, 0.05 * -81.5dB) */</span>
	<span class="mh">0x38bae8ac</span><span class="p">,</span>		<span class="cm">/* [057] = 8.91e-005 = pow(10.0, 0.05 * -81.0dB) */</span>
	<span class="mh">0x38c5fbe2</span><span class="p">,</span>		<span class="cm">/* [058] = 9.44e-005 = pow(10.0, 0.05 * -80.5dB) */</span>
	<span class="mh">0x38d1b717</span><span class="p">,</span>		<span class="cm">/* [059] = 1.00e-004 = pow(10.0, 0.05 * -80.0dB) */</span>
	<span class="mh">0x38de2440</span><span class="p">,</span>		<span class="cm">/* [060] = 1.06e-004 = pow(10.0, 0.05 * -79.5dB) */</span>
	<span class="mh">0x38eb4de8</span><span class="p">,</span>		<span class="cm">/* [061] = 1.12e-004 = pow(10.0, 0.05 * -79.0dB) */</span>
	<span class="mh">0x38f93f3a</span><span class="p">,</span>		<span class="cm">/* [062] = 1.19e-004 = pow(10.0, 0.05 * -78.5dB) */</span>
	<span class="mh">0x39040206</span><span class="p">,</span>		<span class="cm">/* [063] = 1.26e-004 = pow(10.0, 0.05 * -78.0dB) */</span>
	<span class="mh">0x390bd472</span><span class="p">,</span>		<span class="cm">/* [064] = 1.33e-004 = pow(10.0, 0.05 * -77.5dB) */</span>
	<span class="mh">0x39141d84</span><span class="p">,</span>		<span class="cm">/* [065] = 1.41e-004 = pow(10.0, 0.05 * -77.0dB) */</span>
	<span class="mh">0x391ce445</span><span class="p">,</span>		<span class="cm">/* [066] = 1.50e-004 = pow(10.0, 0.05 * -76.5dB) */</span>
	<span class="mh">0x39263027</span><span class="p">,</span>		<span class="cm">/* [067] = 1.58e-004 = pow(10.0, 0.05 * -76.0dB) */</span>
	<span class="mh">0x3930090d</span><span class="p">,</span>		<span class="cm">/* [068] = 1.68e-004 = pow(10.0, 0.05 * -75.5dB) */</span>
	<span class="mh">0x393a7753</span><span class="p">,</span>		<span class="cm">/* [069] = 1.78e-004 = pow(10.0, 0.05 * -75.0dB) */</span>
	<span class="mh">0x394583d2</span><span class="p">,</span>		<span class="cm">/* [070] = 1.88e-004 = pow(10.0, 0.05 * -74.5dB) */</span>
	<span class="mh">0x395137ea</span><span class="p">,</span>		<span class="cm">/* [071] = 2.00e-004 = pow(10.0, 0.05 * -74.0dB) */</span>
	<span class="mh">0x395d9d8a</span><span class="p">,</span>		<span class="cm">/* [072] = 2.11e-004 = pow(10.0, 0.05 * -73.5dB) */</span>
	<span class="mh">0x396abf37</span><span class="p">,</span>		<span class="cm">/* [073] = 2.24e-004 = pow(10.0, 0.05 * -73.0dB) */</span>
	<span class="mh">0x3978a814</span><span class="p">,</span>		<span class="cm">/* [074] = 2.37e-004 = pow(10.0, 0.05 * -72.5dB) */</span>
	<span class="mh">0x3983b1f8</span><span class="p">,</span>		<span class="cm">/* [075] = 2.51e-004 = pow(10.0, 0.05 * -72.0dB) */</span>
	<span class="mh">0x398b7fa6</span><span class="p">,</span>		<span class="cm">/* [076] = 2.66e-004 = pow(10.0, 0.05 * -71.5dB) */</span>
	<span class="mh">0x3993c3b2</span><span class="p">,</span>		<span class="cm">/* [077] = 2.82e-004 = pow(10.0, 0.05 * -71.0dB) */</span>
	<span class="mh">0x399c8521</span><span class="p">,</span>		<span class="cm">/* [078] = 2.99e-004 = pow(10.0, 0.05 * -70.5dB) */</span>
	<span class="mh">0x39a5cb5f</span><span class="p">,</span>		<span class="cm">/* [079] = 3.16e-004 = pow(10.0, 0.05 * -70.0dB) */</span>
	<span class="mh">0x39af9e4d</span><span class="p">,</span>		<span class="cm">/* [080] = 3.35e-004 = pow(10.0, 0.05 * -69.5dB) */</span>
	<span class="mh">0x39ba063f</span><span class="p">,</span>		<span class="cm">/* [081] = 3.55e-004 = pow(10.0, 0.05 * -69.0dB) */</span>
	<span class="mh">0x39c50c0b</span><span class="p">,</span>		<span class="cm">/* [082] = 3.76e-004 = pow(10.0, 0.05 * -68.5dB) */</span>
	<span class="mh">0x39d0b90a</span><span class="p">,</span>		<span class="cm">/* [083] = 3.98e-004 = pow(10.0, 0.05 * -68.0dB) */</span>
	<span class="mh">0x39dd1726</span><span class="p">,</span>		<span class="cm">/* [084] = 4.22e-004 = pow(10.0, 0.05 * -67.5dB) */</span>
	<span class="mh">0x39ea30db</span><span class="p">,</span>		<span class="cm">/* [085] = 4.47e-004 = pow(10.0, 0.05 * -67.0dB) */</span>
	<span class="mh">0x39f81149</span><span class="p">,</span>		<span class="cm">/* [086] = 4.73e-004 = pow(10.0, 0.05 * -66.5dB) */</span>
	<span class="mh">0x3a03621b</span><span class="p">,</span>		<span class="cm">/* [087] = 5.01e-004 = pow(10.0, 0.05 * -66.0dB) */</span>
	<span class="mh">0x3a0b2b0d</span><span class="p">,</span>		<span class="cm">/* [088] = 5.31e-004 = pow(10.0, 0.05 * -65.5dB) */</span>
	<span class="mh">0x3a136a16</span><span class="p">,</span>		<span class="cm">/* [089] = 5.62e-004 = pow(10.0, 0.05 * -65.0dB) */</span>
	<span class="mh">0x3a1c2636</span><span class="p">,</span>		<span class="cm">/* [090] = 5.96e-004 = pow(10.0, 0.05 * -64.5dB) */</span>
	<span class="mh">0x3a2566d5</span><span class="p">,</span>		<span class="cm">/* [091] = 6.31e-004 = pow(10.0, 0.05 * -64.0dB) */</span>
	<span class="mh">0x3a2f33cd</span><span class="p">,</span>		<span class="cm">/* [092] = 6.68e-004 = pow(10.0, 0.05 * -63.5dB) */</span>
	<span class="mh">0x3a399570</span><span class="p">,</span>		<span class="cm">/* [093] = 7.08e-004 = pow(10.0, 0.05 * -63.0dB) */</span>
	<span class="mh">0x3a44948c</span><span class="p">,</span>		<span class="cm">/* [094] = 7.50e-004 = pow(10.0, 0.05 * -62.5dB) */</span>
	<span class="mh">0x3a503a77</span><span class="p">,</span>		<span class="cm">/* [095] = 7.94e-004 = pow(10.0, 0.05 * -62.0dB) */</span>
	<span class="mh">0x3a5c9112</span><span class="p">,</span>		<span class="cm">/* [096] = 8.41e-004 = pow(10.0, 0.05 * -61.5dB) */</span>
	<span class="mh">0x3a69a2d7</span><span class="p">,</span>		<span class="cm">/* [097] = 8.91e-004 = pow(10.0, 0.05 * -61.0dB) */</span>
	<span class="mh">0x3a777ada</span><span class="p">,</span>		<span class="cm">/* [098] = 9.44e-004 = pow(10.0, 0.05 * -60.5dB) */</span>
	<span class="mh">0x3a83126f</span><span class="p">,</span>		<span class="cm">/* [099] = 1.00e-003 = pow(10.0, 0.05 * -60.0dB) */</span>
	<span class="mh">0x3a8ad6a8</span><span class="p">,</span>		<span class="cm">/* [100] = 1.06e-003 = pow(10.0, 0.05 * -59.5dB) */</span>
	<span class="mh">0x3a9310b1</span><span class="p">,</span>		<span class="cm">/* [101] = 1.12e-003 = pow(10.0, 0.05 * -59.0dB) */</span>
	<span class="mh">0x3a9bc784</span><span class="p">,</span>		<span class="cm">/* [102] = 1.19e-003 = pow(10.0, 0.05 * -58.5dB) */</span>
	<span class="mh">0x3aa50287</span><span class="p">,</span>		<span class="cm">/* [103] = 1.26e-003 = pow(10.0, 0.05 * -58.0dB) */</span>
	<span class="mh">0x3aaec98e</span><span class="p">,</span>		<span class="cm">/* [104] = 1.33e-003 = pow(10.0, 0.05 * -57.5dB) */</span>
	<span class="mh">0x3ab924e5</span><span class="p">,</span>		<span class="cm">/* [105] = 1.41e-003 = pow(10.0, 0.05 * -57.0dB) */</span>
	<span class="mh">0x3ac41d56</span><span class="p">,</span>		<span class="cm">/* [106] = 1.50e-003 = pow(10.0, 0.05 * -56.5dB) */</span>
	<span class="mh">0x3acfbc31</span><span class="p">,</span>		<span class="cm">/* [107] = 1.58e-003 = pow(10.0, 0.05 * -56.0dB) */</span>
	<span class="mh">0x3adc0b51</span><span class="p">,</span>		<span class="cm">/* [108] = 1.68e-003 = pow(10.0, 0.05 * -55.5dB) */</span>
	<span class="mh">0x3ae91528</span><span class="p">,</span>		<span class="cm">/* [109] = 1.78e-003 = pow(10.0, 0.05 * -55.0dB) */</span>
	<span class="mh">0x3af6e4c6</span><span class="p">,</span>		<span class="cm">/* [110] = 1.88e-003 = pow(10.0, 0.05 * -54.5dB) */</span>
	<span class="mh">0x3b02c2f2</span><span class="p">,</span>		<span class="cm">/* [111] = 2.00e-003 = pow(10.0, 0.05 * -54.0dB) */</span>
	<span class="mh">0x3b0a8276</span><span class="p">,</span>		<span class="cm">/* [112] = 2.11e-003 = pow(10.0, 0.05 * -53.5dB) */</span>
	<span class="mh">0x3b12b782</span><span class="p">,</span>		<span class="cm">/* [113] = 2.24e-003 = pow(10.0, 0.05 * -53.0dB) */</span>
	<span class="mh">0x3b1b690d</span><span class="p">,</span>		<span class="cm">/* [114] = 2.37e-003 = pow(10.0, 0.05 * -52.5dB) */</span>
	<span class="mh">0x3b249e76</span><span class="p">,</span>		<span class="cm">/* [115] = 2.51e-003 = pow(10.0, 0.05 * -52.0dB) */</span>
	<span class="mh">0x3b2e5f8f</span><span class="p">,</span>		<span class="cm">/* [116] = 2.66e-003 = pow(10.0, 0.05 * -51.5dB) */</span>
	<span class="mh">0x3b38b49f</span><span class="p">,</span>		<span class="cm">/* [117] = 2.82e-003 = pow(10.0, 0.05 * -51.0dB) */</span>
	<span class="mh">0x3b43a669</span><span class="p">,</span>		<span class="cm">/* [118] = 2.99e-003 = pow(10.0, 0.05 * -50.5dB) */</span>
	<span class="mh">0x3b4f3e37</span><span class="p">,</span>		<span class="cm">/* [119] = 3.16e-003 = pow(10.0, 0.05 * -50.0dB) */</span>
	<span class="mh">0x3b5b85e0</span><span class="p">,</span>		<span class="cm">/* [120] = 3.35e-003 = pow(10.0, 0.05 * -49.5dB) */</span>
	<span class="mh">0x3b6887cf</span><span class="p">,</span>		<span class="cm">/* [121] = 3.55e-003 = pow(10.0, 0.05 * -49.0dB) */</span>
	<span class="mh">0x3b764f0e</span><span class="p">,</span>		<span class="cm">/* [122] = 3.76e-003 = pow(10.0, 0.05 * -48.5dB) */</span>
	<span class="mh">0x3b8273a6</span><span class="p">,</span>		<span class="cm">/* [123] = 3.98e-003 = pow(10.0, 0.05 * -48.0dB) */</span>
	<span class="mh">0x3b8a2e77</span><span class="p">,</span>		<span class="cm">/* [124] = 4.22e-003 = pow(10.0, 0.05 * -47.5dB) */</span>
	<span class="mh">0x3b925e89</span><span class="p">,</span>		<span class="cm">/* [125] = 4.47e-003 = pow(10.0, 0.05 * -47.0dB) */</span>
	<span class="mh">0x3b9b0ace</span><span class="p">,</span>		<span class="cm">/* [126] = 4.73e-003 = pow(10.0, 0.05 * -46.5dB) */</span>
	<span class="mh">0x3ba43aa2</span><span class="p">,</span>		<span class="cm">/* [127] = 5.01e-003 = pow(10.0, 0.05 * -46.0dB) */</span>
	<span class="mh">0x3badf5d1</span><span class="p">,</span>		<span class="cm">/* [128] = 5.31e-003 = pow(10.0, 0.05 * -45.5dB) */</span>
	<span class="mh">0x3bb8449c</span><span class="p">,</span>		<span class="cm">/* [129] = 5.62e-003 = pow(10.0, 0.05 * -45.0dB) */</span>
	<span class="mh">0x3bc32fc3</span><span class="p">,</span>		<span class="cm">/* [130] = 5.96e-003 = pow(10.0, 0.05 * -44.5dB) */</span>
	<span class="mh">0x3bcec08a</span><span class="p">,</span>		<span class="cm">/* [131] = 6.31e-003 = pow(10.0, 0.05 * -44.0dB) */</span>
	<span class="mh">0x3bdb00c0</span><span class="p">,</span>		<span class="cm">/* [132] = 6.68e-003 = pow(10.0, 0.05 * -43.5dB) */</span>
	<span class="mh">0x3be7facc</span><span class="p">,</span>		<span class="cm">/* [133] = 7.08e-003 = pow(10.0, 0.05 * -43.0dB) */</span>
	<span class="mh">0x3bf5b9b0</span><span class="p">,</span>		<span class="cm">/* [134] = 7.50e-003 = pow(10.0, 0.05 * -42.5dB) */</span>
	<span class="mh">0x3c02248a</span><span class="p">,</span>		<span class="cm">/* [135] = 7.94e-003 = pow(10.0, 0.05 * -42.0dB) */</span>
	<span class="mh">0x3c09daac</span><span class="p">,</span>		<span class="cm">/* [136] = 8.41e-003 = pow(10.0, 0.05 * -41.5dB) */</span>
	<span class="mh">0x3c1205c6</span><span class="p">,</span>		<span class="cm">/* [137] = 8.91e-003 = pow(10.0, 0.05 * -41.0dB) */</span>
	<span class="mh">0x3c1aacc8</span><span class="p">,</span>		<span class="cm">/* [138] = 9.44e-003 = pow(10.0, 0.05 * -40.5dB) */</span>
	<span class="mh">0x3c23d70a</span><span class="p">,</span>		<span class="cm">/* [139] = 1.00e-002 = pow(10.0, 0.05 * -40.0dB) */</span>
	<span class="mh">0x3c2d8c52</span><span class="p">,</span>		<span class="cm">/* [140] = 1.06e-002 = pow(10.0, 0.05 * -39.5dB) */</span>
	<span class="mh">0x3c37d4dd</span><span class="p">,</span>		<span class="cm">/* [141] = 1.12e-002 = pow(10.0, 0.05 * -39.0dB) */</span>
	<span class="mh">0x3c42b965</span><span class="p">,</span>		<span class="cm">/* [142] = 1.19e-002 = pow(10.0, 0.05 * -38.5dB) */</span>
	<span class="mh">0x3c4e4329</span><span class="p">,</span>		<span class="cm">/* [143] = 1.26e-002 = pow(10.0, 0.05 * -38.0dB) */</span>
	<span class="mh">0x3c5a7bf1</span><span class="p">,</span>		<span class="cm">/* [144] = 1.33e-002 = pow(10.0, 0.05 * -37.5dB) */</span>
	<span class="mh">0x3c676e1e</span><span class="p">,</span>		<span class="cm">/* [145] = 1.41e-002 = pow(10.0, 0.05 * -37.0dB) */</span>
	<span class="mh">0x3c7524ac</span><span class="p">,</span>		<span class="cm">/* [146] = 1.50e-002 = pow(10.0, 0.05 * -36.5dB) */</span>
	<span class="mh">0x3c81d59f</span><span class="p">,</span>		<span class="cm">/* [147] = 1.58e-002 = pow(10.0, 0.05 * -36.0dB) */</span>
	<span class="mh">0x3c898712</span><span class="p">,</span>		<span class="cm">/* [148] = 1.68e-002 = pow(10.0, 0.05 * -35.5dB) */</span>
	<span class="mh">0x3c91ad39</span><span class="p">,</span>		<span class="cm">/* [149] = 1.78e-002 = pow(10.0, 0.05 * -35.0dB) */</span>
	<span class="mh">0x3c9a4efc</span><span class="p">,</span>		<span class="cm">/* [150] = 1.88e-002 = pow(10.0, 0.05 * -34.5dB) */</span>
	<span class="mh">0x3ca373af</span><span class="p">,</span>		<span class="cm">/* [151] = 2.00e-002 = pow(10.0, 0.05 * -34.0dB) */</span>
	<span class="mh">0x3cad2314</span><span class="p">,</span>		<span class="cm">/* [152] = 2.11e-002 = pow(10.0, 0.05 * -33.5dB) */</span>
	<span class="mh">0x3cb76563</span><span class="p">,</span>		<span class="cm">/* [153] = 2.24e-002 = pow(10.0, 0.05 * -33.0dB) */</span>
	<span class="mh">0x3cc24350</span><span class="p">,</span>		<span class="cm">/* [154] = 2.37e-002 = pow(10.0, 0.05 * -32.5dB) */</span>
	<span class="mh">0x3ccdc614</span><span class="p">,</span>		<span class="cm">/* [155] = 2.51e-002 = pow(10.0, 0.05 * -32.0dB) */</span>
	<span class="mh">0x3cd9f773</span><span class="p">,</span>		<span class="cm">/* [156] = 2.66e-002 = pow(10.0, 0.05 * -31.5dB) */</span>
	<span class="mh">0x3ce6e1c6</span><span class="p">,</span>		<span class="cm">/* [157] = 2.82e-002 = pow(10.0, 0.05 * -31.0dB) */</span>
	<span class="mh">0x3cf49003</span><span class="p">,</span>		<span class="cm">/* [158] = 2.99e-002 = pow(10.0, 0.05 * -30.5dB) */</span>
	<span class="mh">0x3d0186e2</span><span class="p">,</span>		<span class="cm">/* [159] = 3.16e-002 = pow(10.0, 0.05 * -30.0dB) */</span>
	<span class="mh">0x3d0933ac</span><span class="p">,</span>		<span class="cm">/* [160] = 3.35e-002 = pow(10.0, 0.05 * -29.5dB) */</span>
	<span class="mh">0x3d1154e1</span><span class="p">,</span>		<span class="cm">/* [161] = 3.55e-002 = pow(10.0, 0.05 * -29.0dB) */</span>
	<span class="mh">0x3d19f169</span><span class="p">,</span>		<span class="cm">/* [162] = 3.76e-002 = pow(10.0, 0.05 * -28.5dB) */</span>
	<span class="mh">0x3d231090</span><span class="p">,</span>		<span class="cm">/* [163] = 3.98e-002 = pow(10.0, 0.05 * -28.0dB) */</span>
	<span class="mh">0x3d2cba15</span><span class="p">,</span>		<span class="cm">/* [164] = 4.22e-002 = pow(10.0, 0.05 * -27.5dB) */</span>
	<span class="mh">0x3d36f62b</span><span class="p">,</span>		<span class="cm">/* [165] = 4.47e-002 = pow(10.0, 0.05 * -27.0dB) */</span>
	<span class="mh">0x3d41cd81</span><span class="p">,</span>		<span class="cm">/* [166] = 4.73e-002 = pow(10.0, 0.05 * -26.5dB) */</span>
	<span class="mh">0x3d4d494a</span><span class="p">,</span>		<span class="cm">/* [167] = 5.01e-002 = pow(10.0, 0.05 * -26.0dB) */</span>
	<span class="mh">0x3d597345</span><span class="p">,</span>		<span class="cm">/* [168] = 5.31e-002 = pow(10.0, 0.05 * -25.5dB) */</span>
	<span class="mh">0x3d6655c3</span><span class="p">,</span>		<span class="cm">/* [169] = 5.62e-002 = pow(10.0, 0.05 * -25.0dB) */</span>
	<span class="mh">0x3d73fbb4</span><span class="p">,</span>		<span class="cm">/* [170] = 5.96e-002 = pow(10.0, 0.05 * -24.5dB) */</span>
	<span class="mh">0x3d813856</span><span class="p">,</span>		<span class="cm">/* [171] = 6.31e-002 = pow(10.0, 0.05 * -24.0dB) */</span>
	<span class="mh">0x3d88e078</span><span class="p">,</span>		<span class="cm">/* [172] = 6.68e-002 = pow(10.0, 0.05 * -23.5dB) */</span>
	<span class="mh">0x3d90fcbf</span><span class="p">,</span>		<span class="cm">/* [173] = 7.08e-002 = pow(10.0, 0.05 * -23.0dB) */</span>
	<span class="mh">0x3d99940e</span><span class="p">,</span>		<span class="cm">/* [174] = 7.50e-002 = pow(10.0, 0.05 * -22.5dB) */</span>
	<span class="mh">0x3da2adad</span><span class="p">,</span>		<span class="cm">/* [175] = 7.94e-002 = pow(10.0, 0.05 * -22.0dB) */</span>
	<span class="mh">0x3dac5156</span><span class="p">,</span>		<span class="cm">/* [176] = 8.41e-002 = pow(10.0, 0.05 * -21.5dB) */</span>
	<span class="mh">0x3db68738</span><span class="p">,</span>		<span class="cm">/* [177] = 8.91e-002 = pow(10.0, 0.05 * -21.0dB) */</span>
	<span class="mh">0x3dc157fb</span><span class="p">,</span>		<span class="cm">/* [178] = 9.44e-002 = pow(10.0, 0.05 * -20.5dB) */</span>
	<span class="mh">0x3dcccccd</span><span class="p">,</span>		<span class="cm">/* [179] = 1.00e-001 = pow(10.0, 0.05 * -20.0dB) */</span>
	<span class="mh">0x3dd8ef67</span><span class="p">,</span>		<span class="cm">/* [180] = 1.06e-001 = pow(10.0, 0.05 * -19.5dB) */</span>
	<span class="mh">0x3de5ca15</span><span class="p">,</span>		<span class="cm">/* [181] = 1.12e-001 = pow(10.0, 0.05 * -19.0dB) */</span>
	<span class="mh">0x3df367bf</span><span class="p">,</span>		<span class="cm">/* [182] = 1.19e-001 = pow(10.0, 0.05 * -18.5dB) */</span>
	<span class="mh">0x3e00e9f9</span><span class="p">,</span>		<span class="cm">/* [183] = 1.26e-001 = pow(10.0, 0.05 * -18.0dB) */</span>
	<span class="mh">0x3e088d77</span><span class="p">,</span>		<span class="cm">/* [184] = 1.33e-001 = pow(10.0, 0.05 * -17.5dB) */</span>
	<span class="mh">0x3e10a4d3</span><span class="p">,</span>		<span class="cm">/* [185] = 1.41e-001 = pow(10.0, 0.05 * -17.0dB) */</span>
	<span class="mh">0x3e1936ec</span><span class="p">,</span>		<span class="cm">/* [186] = 1.50e-001 = pow(10.0, 0.05 * -16.5dB) */</span>
	<span class="mh">0x3e224b06</span><span class="p">,</span>		<span class="cm">/* [187] = 1.58e-001 = pow(10.0, 0.05 * -16.0dB) */</span>
	<span class="mh">0x3e2be8d7</span><span class="p">,</span>		<span class="cm">/* [188] = 1.68e-001 = pow(10.0, 0.05 * -15.5dB) */</span>
	<span class="mh">0x3e361887</span><span class="p">,</span>		<span class="cm">/* [189] = 1.78e-001 = pow(10.0, 0.05 * -15.0dB) */</span>
	<span class="mh">0x3e40e2bb</span><span class="p">,</span>		<span class="cm">/* [190] = 1.88e-001 = pow(10.0, 0.05 * -14.5dB) */</span>
	<span class="mh">0x3e4c509b</span><span class="p">,</span>		<span class="cm">/* [191] = 2.00e-001 = pow(10.0, 0.05 * -14.0dB) */</span>
	<span class="mh">0x3e586bd9</span><span class="p">,</span>		<span class="cm">/* [192] = 2.11e-001 = pow(10.0, 0.05 * -13.5dB) */</span>
	<span class="mh">0x3e653ebb</span><span class="p">,</span>		<span class="cm">/* [193] = 2.24e-001 = pow(10.0, 0.05 * -13.0dB) */</span>
	<span class="mh">0x3e72d424</span><span class="p">,</span>		<span class="cm">/* [194] = 2.37e-001 = pow(10.0, 0.05 * -12.5dB) */</span>
	<span class="mh">0x3e809bcc</span><span class="p">,</span>		<span class="cm">/* [195] = 2.51e-001 = pow(10.0, 0.05 * -12.0dB) */</span>
	<span class="mh">0x3e883aa8</span><span class="p">,</span>		<span class="cm">/* [196] = 2.66e-001 = pow(10.0, 0.05 * -11.5dB) */</span>
	<span class="mh">0x3e904d1c</span><span class="p">,</span>		<span class="cm">/* [197] = 2.82e-001 = pow(10.0, 0.05 * -11.0dB) */</span>
	<span class="mh">0x3e98da02</span><span class="p">,</span>		<span class="cm">/* [198] = 2.99e-001 = pow(10.0, 0.05 * -10.5dB) */</span>
	<span class="mh">0x3ea1e89b</span><span class="p">,</span>		<span class="cm">/* [199] = 3.16e-001 = pow(10.0, 0.05 * -10.0dB) */</span>
	<span class="mh">0x3eab8097</span><span class="p">,</span>		<span class="cm">/* [200] = 3.35e-001 = pow(10.0, 0.05 * -9.5dB) */</span>
	<span class="mh">0x3eb5aa1a</span><span class="p">,</span>		<span class="cm">/* [201] = 3.55e-001 = pow(10.0, 0.05 * -9.0dB) */</span>
	<span class="mh">0x3ec06dc3</span><span class="p">,</span>		<span class="cm">/* [202] = 3.76e-001 = pow(10.0, 0.05 * -8.5dB) */</span>
	<span class="mh">0x3ecbd4b4</span><span class="p">,</span>		<span class="cm">/* [203] = 3.98e-001 = pow(10.0, 0.05 * -8.0dB) */</span>
	<span class="mh">0x3ed7e89b</span><span class="p">,</span>		<span class="cm">/* [204] = 4.22e-001 = pow(10.0, 0.05 * -7.5dB) */</span>
	<span class="mh">0x3ee4b3b6</span><span class="p">,</span>		<span class="cm">/* [205] = 4.47e-001 = pow(10.0, 0.05 * -7.0dB) */</span>
	<span class="mh">0x3ef240e2</span><span class="p">,</span>		<span class="cm">/* [206] = 4.73e-001 = pow(10.0, 0.05 * -6.5dB) */</span>
	<span class="mh">0x3f004dce</span><span class="p">,</span>		<span class="cm">/* [207] = 5.01e-001 = pow(10.0, 0.05 * -6.0dB) */</span>
	<span class="mh">0x3f07e80b</span><span class="p">,</span>		<span class="cm">/* [208] = 5.31e-001 = pow(10.0, 0.05 * -5.5dB) */</span>
	<span class="mh">0x3f0ff59a</span><span class="p">,</span>		<span class="cm">/* [209] = 5.62e-001 = pow(10.0, 0.05 * -5.0dB) */</span>
	<span class="mh">0x3f187d50</span><span class="p">,</span>		<span class="cm">/* [210] = 5.96e-001 = pow(10.0, 0.05 * -4.5dB) */</span>
	<span class="mh">0x3f21866c</span><span class="p">,</span>		<span class="cm">/* [211] = 6.31e-001 = pow(10.0, 0.05 * -4.0dB) */</span>
	<span class="mh">0x3f2b1896</span><span class="p">,</span>		<span class="cm">/* [212] = 6.68e-001 = pow(10.0, 0.05 * -3.5dB) */</span>
	<span class="mh">0x3f353bef</span><span class="p">,</span>		<span class="cm">/* [213] = 7.08e-001 = pow(10.0, 0.05 * -3.0dB) */</span>
	<span class="mh">0x3f3ff911</span><span class="p">,</span>		<span class="cm">/* [214] = 7.50e-001 = pow(10.0, 0.05 * -2.5dB) */</span>
	<span class="mh">0x3f4b5918</span><span class="p">,</span>		<span class="cm">/* [215] = 7.94e-001 = pow(10.0, 0.05 * -2.0dB) */</span>
	<span class="mh">0x3f5765ac</span><span class="p">,</span>		<span class="cm">/* [216] = 8.41e-001 = pow(10.0, 0.05 * -1.5dB) */</span>
	<span class="mh">0x3f642905</span><span class="p">,</span>		<span class="cm">/* [217] = 8.91e-001 = pow(10.0, 0.05 * -1.0dB) */</span>
	<span class="mh">0x3f71adf9</span><span class="p">,</span>		<span class="cm">/* [218] = 9.44e-001 = pow(10.0, 0.05 * -0.5dB) */</span>
	<span class="mh">0x3f800000</span><span class="p">,</span>		<span class="cm">/* [219] = 1.00e+000 = pow(10.0, 0.05 * 0.0dB) */</span>
	<span class="mh">0x3f8795a0</span><span class="p">,</span>		<span class="cm">/* [220] = 1.06e+000 = pow(10.0, 0.05 * 0.5dB) */</span>
	<span class="mh">0x3f8f9e4d</span><span class="p">,</span>		<span class="cm">/* [221] = 1.12e+000 = pow(10.0, 0.05 * 1.0dB) */</span>
	<span class="mh">0x3f9820d7</span><span class="p">,</span>		<span class="cm">/* [222] = 1.19e+000 = pow(10.0, 0.05 * 1.5dB) */</span>
	<span class="mh">0x3fa12478</span><span class="p">,</span>		<span class="cm">/* [223] = 1.26e+000 = pow(10.0, 0.05 * 2.0dB) */</span>
	<span class="mh">0x3faab0d5</span><span class="p">,</span>		<span class="cm">/* [224] = 1.33e+000 = pow(10.0, 0.05 * 2.5dB) */</span>
	<span class="mh">0x3fb4ce08</span><span class="p">,</span>		<span class="cm">/* [225] = 1.41e+000 = pow(10.0, 0.05 * 3.0dB) */</span>
	<span class="mh">0x3fbf84a6</span><span class="p">,</span>		<span class="cm">/* [226] = 1.50e+000 = pow(10.0, 0.05 * 3.5dB) */</span>
	<span class="mh">0x3fcaddc8</span><span class="p">,</span>		<span class="cm">/* [227] = 1.58e+000 = pow(10.0, 0.05 * 4.0dB) */</span>
	<span class="mh">0x3fd6e30d</span><span class="p">,</span>		<span class="cm">/* [228] = 1.68e+000 = pow(10.0, 0.05 * 4.5dB) */</span>
	<span class="mh">0x3fe39ea9</span><span class="p">,</span>		<span class="cm">/* [229] = 1.78e+000 = pow(10.0, 0.05 * 5.0dB) */</span>
	<span class="mh">0x3ff11b6a</span><span class="p">,</span>		<span class="cm">/* [230] = 1.88e+000 = pow(10.0, 0.05 * 5.5dB) */</span>
	<span class="mh">0x3fff64c1</span><span class="p">,</span>		<span class="cm">/* [231] = 2.00e+000 = pow(10.0, 0.05 * 6.0dB) */</span>
	<span class="mh">0x40074368</span><span class="p">,</span>		<span class="cm">/* [232] = 2.11e+000 = pow(10.0, 0.05 * 6.5dB) */</span>
	<span class="mh">0x400f4735</span><span class="p">,</span>		<span class="cm">/* [233] = 2.24e+000 = pow(10.0, 0.05 * 7.0dB) */</span>
	<span class="mh">0x4017c496</span><span class="p">,</span>		<span class="cm">/* [234] = 2.37e+000 = pow(10.0, 0.05 * 7.5dB) */</span>
	<span class="mh">0x4020c2bf</span><span class="p">,</span>		<span class="cm">/* [235] = 2.51e+000 = pow(10.0, 0.05 * 8.0dB) */</span>
	<span class="mh">0x402a4952</span><span class="p">,</span>		<span class="cm">/* [236] = 2.66e+000 = pow(10.0, 0.05 * 8.5dB) */</span>
	<span class="mh">0x40346063</span><span class="p">,</span>		<span class="cm">/* [237] = 2.82e+000 = pow(10.0, 0.05 * 9.0dB) */</span>
	<span class="mh">0x403f1082</span><span class="p">,</span>		<span class="cm">/* [238] = 2.99e+000 = pow(10.0, 0.05 * 9.5dB) */</span>
	<span class="mh">0x404a62c2</span><span class="p">,</span>		<span class="cm">/* [239] = 3.16e+000 = pow(10.0, 0.05 * 10.0dB) */</span>
	<span class="mh">0x405660bd</span><span class="p">,</span>		<span class="cm">/* [240] = 3.35e+000 = pow(10.0, 0.05 * 10.5dB) */</span>
	<span class="mh">0x406314a0</span><span class="p">,</span>		<span class="cm">/* [241] = 3.55e+000 = pow(10.0, 0.05 * 11.0dB) */</span>
	<span class="mh">0x40708933</span><span class="p">,</span>		<span class="cm">/* [242] = 3.76e+000 = pow(10.0, 0.05 * 11.5dB) */</span>
	<span class="mh">0x407ec9e1</span><span class="p">,</span>		<span class="cm">/* [243] = 3.98e+000 = pow(10.0, 0.05 * 12.0dB) */</span>
	<span class="mh">0x4086f161</span><span class="p">,</span>		<span class="cm">/* [244] = 4.22e+000 = pow(10.0, 0.05 * 12.5dB) */</span>
	<span class="mh">0x408ef052</span><span class="p">,</span>		<span class="cm">/* [245] = 4.47e+000 = pow(10.0, 0.05 * 13.0dB) */</span>
	<span class="mh">0x4097688d</span><span class="p">,</span>		<span class="cm">/* [246] = 4.73e+000 = pow(10.0, 0.05 * 13.5dB) */</span>
	<span class="mh">0x40a06142</span><span class="p">,</span>		<span class="cm">/* [247] = 5.01e+000 = pow(10.0, 0.05 * 14.0dB) */</span>
	<span class="mh">0x40a9e20e</span><span class="p">,</span>		<span class="cm">/* [248] = 5.31e+000 = pow(10.0, 0.05 * 14.5dB) */</span>
	<span class="mh">0x40b3f300</span><span class="p">,</span>		<span class="cm">/* [249] = 5.62e+000 = pow(10.0, 0.05 * 15.0dB) */</span>
	<span class="mh">0x40be9ca5</span><span class="p">,</span>		<span class="cm">/* [250] = 5.96e+000 = pow(10.0, 0.05 * 15.5dB) */</span>
	<span class="mh">0x40c9e807</span><span class="p">,</span>		<span class="cm">/* [251] = 6.31e+000 = pow(10.0, 0.05 * 16.0dB) */</span>
	<span class="mh">0x40d5debc</span><span class="p">,</span>		<span class="cm">/* [252] = 6.68e+000 = pow(10.0, 0.05 * 16.5dB) */</span>
	<span class="mh">0x40e28aeb</span><span class="p">,</span>		<span class="cm">/* [253] = 7.08e+000 = pow(10.0, 0.05 * 17.0dB) */</span>
	<span class="mh">0x40eff755</span><span class="p">,</span>		<span class="cm">/* [254] = 7.50e+000 = pow(10.0, 0.05 * 17.5dB) */</span>
	<span class="mh">0x40fe2f5e</span><span class="p">,</span>		<span class="cm">/* [255] = 7.94e+000 = pow(10.0, 0.05 * 18.0dB) */</span>
<span class="p">};</span>

<span class="cp">#define MIXART_DIGITAL_LEVEL_MIN   0      </span><span class="cm">/* -109.5 dB */</span><span class="cp"></span>
<span class="cp">#define MIXART_DIGITAL_LEVEL_MAX   255    </span><span class="cm">/*  18.0 dB */</span><span class="cp"></span>
<span class="cp">#define MIXART_DIGITAL_ZERO_LEVEL  219    </span><span class="cm">/*  0.0 dB */</span><span class="cp"></span>


<span class="kt">int</span> <span class="nf">mixart_update_playback_stream_level</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_mixart</span><span class="o">*</span> <span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">is_aes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">volume</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mixart_msg</span> <span class="n">request</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mixart_set_out_stream_level_req</span> <span class="n">set_level</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mixart_pipe</span> <span class="o">*</span><span class="n">pipe</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">set_level</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">set_level</span><span class="p">));</span>
	<span class="n">set_level</span><span class="p">.</span><span class="n">nb_of_stream</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">set_level</span><span class="p">.</span><span class="n">stream_level</span><span class="p">.</span><span class="n">desc</span><span class="p">.</span><span class="n">stream_idx</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">is_aes</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pipe</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">pipe_out_dig</span><span class="p">;</span>	<span class="cm">/* AES playback */</span>
		<span class="n">idx</span> <span class="o">+=</span> <span class="n">MIXART_PLAYBACK_STREAMS</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pipe</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">pipe_out_ana</span><span class="p">;</span>	<span class="cm">/* analog playback */</span>
	<span class="p">}</span>

	<span class="cm">/* only when pipe exists ! */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">==</span> <span class="n">PIPE_UNDEFINED</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">set_level</span><span class="p">.</span><span class="n">stream_level</span><span class="p">.</span><span class="n">desc</span><span class="p">.</span><span class="n">uid_pipe</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">-&gt;</span><span class="n">group_uid</span><span class="p">;</span>

	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_playback_active</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
			<span class="n">volume</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_playback_volume</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
		<span class="k">else</span>
			<span class="n">volume</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">MIXART_DIGITAL_LEVEL_MIN</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">set_level</span><span class="p">.</span><span class="n">stream_level</span><span class="p">.</span><span class="n">out_level</span><span class="p">.</span><span class="n">valid_mask1</span> <span class="o">=</span> <span class="n">MIXART_OUT_STREAM_SET_LEVEL_LEFT_AUDIO1</span> <span class="o">|</span> <span class="n">MIXART_OUT_STREAM_SET_LEVEL_RIGHT_AUDIO2</span><span class="p">;</span>
	<span class="n">set_level</span><span class="p">.</span><span class="n">stream_level</span><span class="p">.</span><span class="n">out_level</span><span class="p">.</span><span class="n">left_to_out1_level</span> <span class="o">=</span> <span class="n">mixart_digital_level</span><span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">0</span><span class="p">]];</span>
	<span class="n">set_level</span><span class="p">.</span><span class="n">stream_level</span><span class="p">.</span><span class="n">out_level</span><span class="p">.</span><span class="n">right_to_out2_level</span> <span class="o">=</span> <span class="n">mixart_digital_level</span><span class="p">[</span><span class="n">volume</span><span class="p">[</span><span class="mi">1</span><span class="p">]];</span>

	<span class="n">request</span><span class="p">.</span><span class="n">message_id</span> <span class="o">=</span> <span class="n">MSG_STREAM_SET_OUT_STREAM_LEVEL</span><span class="p">;</span>
	<span class="n">request</span><span class="p">.</span><span class="n">uid</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mixart_uid</span><span class="p">){</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
	<span class="n">request</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">set_level</span><span class="p">;</span>
	<span class="n">request</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">set_level</span><span class="p">);</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_mixart_send_msg</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">request</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">status</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">);</span>
	<span class="k">if</span><span class="p">((</span><span class="n">err</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="n">status</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;error MSG_STREAM_SET_OUT_STREAM_LEVEL card(%d) status(%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">chip_idx</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">mixart_update_capture_stream_level</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_mixart</span><span class="o">*</span> <span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">is_aes</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">idx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mixart_pipe</span> <span class="o">*</span><span class="n">pipe</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mixart_msg</span> <span class="n">request</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mixart_set_in_audio_level_req</span> <span class="n">set_level</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">status</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">is_aes</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">pipe</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">pipe_in_dig</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">pipe</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">pipe_in_ana</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* only when pipe exists ! */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">pipe</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">==</span> <span class="n">PIPE_UNDEFINED</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">set_level</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">set_level</span><span class="p">));</span>
	<span class="n">set_level</span><span class="p">.</span><span class="n">audio_count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">set_level</span><span class="p">.</span><span class="n">level</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">connector</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">-&gt;</span><span class="n">uid_left_connector</span><span class="p">;</span>
	<span class="n">set_level</span><span class="p">.</span><span class="n">level</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">connector</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">-&gt;</span><span class="n">uid_right_connector</span><span class="p">;</span>

	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">set_level</span><span class="p">.</span><span class="n">level</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">valid_mask1</span> <span class="o">=</span> <span class="n">MIXART_AUDIO_LEVEL_DIGITAL_MASK</span><span class="p">;</span>
		<span class="n">set_level</span><span class="p">.</span><span class="n">level</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">digital_level</span> <span class="o">=</span> <span class="n">mixart_digital_level</span><span class="p">[</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_capture_volume</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="n">i</span><span class="p">]];</span>
	<span class="p">}</span>

	<span class="n">request</span><span class="p">.</span><span class="n">message_id</span> <span class="o">=</span> <span class="n">MSG_STREAM_SET_IN_AUDIO_LEVEL</span><span class="p">;</span>
	<span class="n">request</span><span class="p">.</span><span class="n">uid</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mixart_uid</span><span class="p">){</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">};</span>
	<span class="n">request</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">set_level</span><span class="p">;</span>
	<span class="n">request</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">set_level</span><span class="p">);</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_mixart_send_msg</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">request</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">status</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">);</span>
	<span class="k">if</span><span class="p">((</span><span class="n">err</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="n">status</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;error MSG_STREAM_SET_IN_AUDIO_LEVEL card(%d) status(%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">chip_idx</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* shared */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_digital_vol_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">MIXART_DIGITAL_LEVEL_MIN</span><span class="p">;</span>   <span class="cm">/* -109.5 dB */</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">MIXART_DIGITAL_LEVEL_MAX</span><span class="p">;</span>   <span class="cm">/*   18.0 dB */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define MIXART_VOL_REC_MASK	1</span>
<span class="cp">#define MIXART_VOL_AES_MASK	2</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_pcm_vol_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span> <span class="cm">/* index */</span>
	<span class="kt">int</span> <span class="o">*</span><span class="n">stored_volume</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">is_capture</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="n">MIXART_VOL_REC_MASK</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">is_aes</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="n">MIXART_VOL_AES_MASK</span><span class="p">;</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">is_capture</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span><span class="p">(</span><span class="n">is_aes</span><span class="p">)</span>	<span class="n">stored_volume</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_capture_volume</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>	<span class="cm">/* AES capture */</span>
		<span class="k">else</span>		<span class="n">stored_volume</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_capture_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>	<span class="cm">/* analog capture */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">snd_BUG_ON</span><span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">MIXART_PLAYBACK_STREAMS</span><span class="p">);</span>
		<span class="k">if</span><span class="p">(</span><span class="n">is_aes</span><span class="p">)</span>	<span class="n">stored_volume</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_playback_volume</span><span class="p">[</span><span class="n">MIXART_PLAYBACK_STREAMS</span> <span class="o">+</span> <span class="n">idx</span><span class="p">];</span> <span class="cm">/* AES playback */</span>
		<span class="k">else</span>		<span class="n">stored_volume</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_playback_volume</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>	<span class="cm">/* analog playback */</span>
	<span class="p">}</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">stored_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">stored_volume</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_pcm_vol_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span> <span class="cm">/* index */</span>
	<span class="kt">int</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">is_capture</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="n">MIXART_VOL_REC_MASK</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">is_aes</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="n">MIXART_VOL_AES_MASK</span><span class="p">;</span>
	<span class="kt">int</span><span class="o">*</span> <span class="n">stored_volume</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">is_capture</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">is_aes</span><span class="p">)</span>	<span class="cm">/* AES capture */</span>
			<span class="n">stored_volume</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_capture_volume</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
		<span class="k">else</span>		<span class="cm">/* analog capture */</span>
			<span class="n">stored_volume</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_capture_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">snd_BUG_ON</span><span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">MIXART_PLAYBACK_STREAMS</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">is_aes</span><span class="p">)</span>	<span class="cm">/* AES playback */</span>
			<span class="n">stored_volume</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_playback_volume</span><span class="p">[</span><span class="n">MIXART_PLAYBACK_STREAMS</span> <span class="o">+</span> <span class="n">idx</span><span class="p">];</span>
		<span class="k">else</span>		<span class="cm">/* analog playback */</span>
			<span class="n">stored_volume</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_playback_volume</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">vol</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vol</span> <span class="o">&lt;</span> <span class="n">MIXART_DIGITAL_LEVEL_MIN</span> <span class="o">||</span>
		    <span class="n">vol</span> <span class="o">&gt;</span> <span class="n">MIXART_DIGITAL_LEVEL_MAX</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">stored_volume</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">vol</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">stored_volume</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vol</span><span class="p">;</span>
			<span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">changed</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">is_capture</span><span class="p">)</span>
			<span class="n">mixart_update_capture_stream_level</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">is_aes</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">mixart_update_playback_stream_level</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">is_aes</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">db_scale_digital</span><span class="p">,</span> <span class="o">-</span><span class="mi">10950</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">snd_mixart_pcm_vol</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>        <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span> <span class="p">(</span><span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span> <span class="o">|</span>
		   <span class="n">SNDRV_CTL_ELEM_ACCESS_TLV_READ</span><span class="p">),</span>
	<span class="cm">/* name will be filled later */</span>
	<span class="cm">/* count will be filled later */</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">mixart_digital_vol_info</span><span class="p">,</span>		<span class="cm">/* shared */</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">mixart_pcm_vol_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">mixart_pcm_vol_put</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tlv</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">db_scale_digital</span> <span class="p">},</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_pcm_sw_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span> <span class="cm">/* index */</span>
	<span class="n">snd_BUG_ON</span><span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">MIXART_PLAYBACK_STREAMS</span><span class="p">);</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">if</span><span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="n">MIXART_VOL_AES_MASK</span><span class="p">)</span>	<span class="cm">/* AES playback */</span>
		<span class="n">idx</span> <span class="o">+=</span> <span class="n">MIXART_PLAYBACK_STREAMS</span><span class="p">;</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_playback_active</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_playback_active</span><span class="p">[</span><span class="n">idx</span><span class="p">][</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_pcm_sw_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">is_aes</span> <span class="o">=</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">private_value</span> <span class="o">&amp;</span> <span class="n">MIXART_VOL_AES_MASK</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">snd_ctl_get_ioffidx</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span> <span class="cm">/* index */</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="n">snd_BUG_ON</span><span class="p">(</span><span class="n">idx</span> <span class="o">&gt;=</span> <span class="n">MIXART_PLAYBACK_STREAMS</span><span class="p">);</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="n">j</span> <span class="o">=</span> <span class="n">idx</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">is_aes</span><span class="p">)</span>
		<span class="n">j</span> <span class="o">+=</span> <span class="n">MIXART_PLAYBACK_STREAMS</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_playback_active</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span>
		    <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">chip</span><span class="o">-&gt;</span><span class="n">digital_playback_active</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
				<span class="o">!!</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">changed</span><span class="p">)</span>
		<span class="n">mixart_update_playback_stream_level</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">is_aes</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">mixart_control_pcm_switch</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="cm">/* name will be filled later */</span>
	<span class="p">.</span><span class="n">count</span> <span class="o">=</span>        <span class="n">MIXART_PLAYBACK_STREAMS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">mixart_sw_info</span><span class="p">,</span>		<span class="cm">/* shared */</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">mixart_pcm_sw_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">mixart_pcm_sw_put</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_update_monitoring</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_mixart</span><span class="o">*</span> <span class="n">chip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mixart_msg</span> <span class="n">request</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mixart_set_out_audio_level</span> <span class="n">audio_level</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">resp</span><span class="p">;</span>

	<span class="k">if</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">pipe_out_ana</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PIPE_UNDEFINED</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span> <span class="cm">/* no pipe defined */</span>

	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">channel</span><span class="p">)</span>	<span class="n">request</span><span class="p">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">pipe_out_ana</span><span class="p">.</span><span class="n">uid_left_connector</span><span class="p">;</span>
	<span class="k">else</span>		<span class="n">request</span><span class="p">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">pipe_out_ana</span><span class="p">.</span><span class="n">uid_right_connector</span><span class="p">;</span>
	<span class="n">request</span><span class="p">.</span><span class="n">message_id</span> <span class="o">=</span> <span class="n">MSG_CONNECTOR_SET_OUT_AUDIO_LEVEL</span><span class="p">;</span>
	<span class="n">request</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">audio_level</span><span class="p">;</span>
	<span class="n">request</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">audio_level</span><span class="p">);</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">audio_level</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">audio_level</span><span class="p">));</span>
	<span class="n">audio_level</span><span class="p">.</span><span class="n">valid_mask1</span> <span class="o">=</span> <span class="n">MIXART_AUDIO_LEVEL_MONITOR_MASK</span> <span class="o">|</span> <span class="n">MIXART_AUDIO_LEVEL_MUTE_M1_MASK</span><span class="p">;</span>
	<span class="n">audio_level</span><span class="p">.</span><span class="n">monitor_level</span> <span class="o">=</span> <span class="n">mixart_digital_level</span><span class="p">[</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_volume</span><span class="p">[</span><span class="n">channel</span><span class="o">!=</span><span class="mi">0</span><span class="p">]];</span>
	<span class="n">audio_level</span><span class="p">.</span><span class="n">monitor_mute1</span> <span class="o">=</span> <span class="o">!</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_active</span><span class="p">[</span><span class="n">channel</span><span class="o">!=</span><span class="mi">0</span><span class="p">];</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_mixart_send_msg</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">request</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">resp</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">resp</span><span class="p">);</span>
	<span class="k">if</span><span class="p">((</span><span class="n">err</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="n">resp</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;error MSG_CONNECTOR_SET_OUT_AUDIO_LEVEL card(%d) resp(%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">chip_idx</span><span class="p">,</span> <span class="n">resp</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * monitoring level control</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_monitor_vol_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_volume</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_volume</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_monitor_vol_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_volume</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span>
		    <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_volume</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
				<span class="o">!!</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="n">mixart_update_monitoring</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
			<span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">mixart_control_monitor_vol</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">access</span> <span class="o">=</span> <span class="p">(</span><span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span> <span class="o">|</span>
		   <span class="n">SNDRV_CTL_ELEM_ACCESS_TLV_READ</span><span class="p">),</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="s">&quot;Monitoring Volume&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>		<span class="n">mixart_digital_vol_info</span><span class="p">,</span>		<span class="cm">/* shared */</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>		<span class="n">mixart_monitor_vol_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>		<span class="n">mixart_monitor_vol_put</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tlv</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">db_scale_digital</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * monitoring switch control</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_monitor_sw_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_active</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_active</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mixart_monitor_sw_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">changed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_active</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span>
		    <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_active</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span>
				<span class="o">!!</span><span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
			<span class="n">changed</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="n">i</span><span class="p">);</span> <span class="cm">/* mask 0x01 ans 0x02 */</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">changed</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* allocate or release resources for monitoring */</span>
		<span class="kt">int</span> <span class="n">allocate</span> <span class="o">=</span> <span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_active</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span>
			<span class="n">chip</span><span class="o">-&gt;</span><span class="n">monitoring_active</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">allocate</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* allocate the playback pipe for monitoring */</span>
			<span class="n">snd_mixart_add_ref_pipe</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">MIXART_PCM_ANALOG</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="cm">/* allocate the capture pipe for monitoring */</span>
			<span class="n">snd_mixart_add_ref_pipe</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="n">MIXART_PCM_ANALOG</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">changed</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">)</span>
			<span class="n">mixart_update_monitoring</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">changed</span> <span class="o">&amp;</span> <span class="mh">0x02</span><span class="p">)</span>
			<span class="n">mixart_update_monitoring</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">allocate</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* release the capture pipe for monitoring */</span>
			<span class="n">snd_mixart_kill_ref_pipe</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="p">,</span>
						 <span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">pipe_in_ana</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="cm">/* release the playback pipe for monitoring */</span>
			<span class="n">snd_mixart_kill_ref_pipe</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="p">,</span>
						 <span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">pipe_out_ana</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">changed</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">mixart_control_monitor_sw</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">iface</span> <span class="o">=</span>	<span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span>         <span class="s">&quot;Monitoring Switch&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span>         <span class="n">mixart_sw_info</span><span class="p">,</span>		<span class="cm">/* shared */</span>
	<span class="p">.</span><span class="n">get</span> <span class="o">=</span>          <span class="n">mixart_monitor_sw_get</span><span class="p">,</span>
	<span class="p">.</span><span class="n">put</span> <span class="o">=</span>          <span class="n">mixart_monitor_sw_put</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">mixart_reset_audio_levels</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* analog volumes can be set even if there is no pipe */</span>
	<span class="n">mixart_update_analog_audio_level</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="cm">/* analog levels for capture only on the first two chips */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">chip_idx</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mixart_update_analog_audio_level</span><span class="p">(</span><span class="n">chip</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">snd_mixart_create_mixer</span><span class="p">(</span><span class="k">struct</span> <span class="n">mixart_mgr</span> <span class="o">*</span><span class="n">mgr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_mixart</span> <span class="o">*</span><span class="n">chip</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">mixer_mutex</span><span class="p">);</span> <span class="cm">/* can be in another place */</span>

	<span class="k">for</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">num_cards</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">temp</span><span class="p">;</span>
		<span class="n">chip</span> <span class="o">=</span> <span class="n">mgr</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>

		<span class="cm">/* analog output level control */</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">mixart_control_analog_level</span><span class="p">;</span>
		<span class="n">temp</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Playback Volume&quot;</span><span class="p">;</span>
		<span class="n">temp</span><span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* playback */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="cm">/* output mute controls */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mixart_control_output_switch</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="cm">/* analog input level control only on first two chips !*/</span>
		<span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">temp</span> <span class="o">=</span> <span class="n">mixart_control_analog_level</span><span class="p">;</span>
			<span class="n">temp</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Master Capture Volume&quot;</span><span class="p">;</span>
			<span class="n">temp</span><span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* capture */</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">temp</span> <span class="o">=</span> <span class="n">snd_mixart_pcm_vol</span><span class="p">;</span>
		<span class="n">temp</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">;</span>
		<span class="n">temp</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">MIXART_PLAYBACK_STREAMS</span><span class="p">;</span>
		<span class="n">temp</span><span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* playback analog */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="n">temp</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PCM Capture Volume&quot;</span><span class="p">;</span>
		<span class="n">temp</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">temp</span><span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">MIXART_VOL_REC_MASK</span><span class="p">;</span> <span class="cm">/* capture analog */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="k">if</span><span class="p">(</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">board_type</span> <span class="o">==</span> <span class="n">MIXART_DAUGHTER_TYPE_AES</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">temp</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AES Playback Volume&quot;</span><span class="p">;</span>
			<span class="n">temp</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="n">MIXART_PLAYBACK_STREAMS</span><span class="p">;</span>
			<span class="n">temp</span><span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">MIXART_VOL_AES_MASK</span><span class="p">;</span> <span class="cm">/* playback AES/EBU */</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

			<span class="n">temp</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AES Capture Volume&quot;</span><span class="p">;</span>
			<span class="n">temp</span><span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">temp</span><span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">MIXART_VOL_REC_MASK</span> <span class="o">|</span> <span class="n">MIXART_VOL_AES_MASK</span><span class="p">;</span> <span class="cm">/* capture AES/EBU */</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">temp</span> <span class="o">=</span> <span class="n">mixart_control_pcm_switch</span><span class="p">;</span>
		<span class="n">temp</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">;</span>
		<span class="n">temp</span><span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* playback analog */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="k">if</span><span class="p">(</span><span class="n">mgr</span><span class="o">-&gt;</span><span class="n">board_type</span> <span class="o">==</span> <span class="n">MIXART_DAUGHTER_TYPE_AES</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">temp</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AES Playback Switch&quot;</span><span class="p">;</span>
			<span class="n">temp</span><span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">MIXART_VOL_AES_MASK</span><span class="p">;</span> <span class="cm">/* playback AES/EBU */</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">temp</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="cm">/* monitoring */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mixart_control_monitor_vol</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">chip</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mixart_control_monitor_sw</span><span class="p">,</span> <span class="n">chip</span><span class="p">)))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="cm">/* init all mixer data and program the master volumes/switches */</span>
		<span class="n">mixart_reset_audio_levels</span><span class="p">(</span><span class="n">chip</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
