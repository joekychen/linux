<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › pci › ice1712 › revo.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>revo.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *   ALSA driver for ICEnsemble ICE1712 (Envy24)</span>
<span class="cm"> *</span>
<span class="cm"> *   Lowlevel functions for M-Audio Audiophile 192, Revolution 7.1 and 5.1</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright (c) 2003 Takashi Iwai &lt;tiwai@suse.de&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>      

<span class="cp">#include &lt;asm/io.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;sound/core.h&gt;</span>

<span class="cp">#include &quot;ice1712.h&quot;</span>
<span class="cp">#include &quot;envy24ht.h&quot;</span>
<span class="cp">#include &quot;revo.h&quot;</span>

<span class="cm">/* a non-standard I2C device for revo51 */</span>
<span class="k">struct</span> <span class="n">revo51_spec</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_i2c_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pt2258</span> <span class="o">*</span><span class="n">pt2258</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">revo_i2s_mclk_changed</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* assert PRST# to converters; MT05 bit 7 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">inb</span><span class="p">(</span><span class="n">ICEMT1724</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">AC97_CMD</span><span class="p">))</span> <span class="o">|</span> <span class="mh">0x80</span><span class="p">,</span> <span class="n">ICEMT1724</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">AC97_CMD</span><span class="p">));</span>
	<span class="n">mdelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
	<span class="cm">/* deassert PRST# */</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">inb</span><span class="p">(</span><span class="n">ICEMT1724</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">AC97_CMD</span><span class="p">))</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x80</span><span class="p">,</span> <span class="n">ICEMT1724</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">AC97_CMD</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * change the rate of Envy24HT, AK4355 and AK4381</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">revo_set_rate_val</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="o">*</span><span class="n">ak</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">old</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">dfs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">shift</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>	<span class="cm">/* no hint - S/PDIF input is master, simply return */</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="cm">/* adjust DFS on codecs */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;</span> <span class="mi">96000</span><span class="p">)</span>
		<span class="n">dfs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;</span> <span class="mi">48000</span><span class="p">)</span>
		<span class="n">dfs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">dfs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ak</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">SND_AK4355</span> <span class="o">||</span> <span class="n">ak</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">SND_AK4358</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">shift</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">shift</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">snd_akm4xxx_get</span><span class="p">(</span><span class="n">ak</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="n">old</span> <span class="o">=</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&gt;&gt;</span> <span class="n">shift</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">old</span> <span class="o">==</span> <span class="n">dfs</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="cm">/* reset DFS */</span>
	<span class="n">snd_akm4xxx_reset</span><span class="p">(</span><span class="n">ak</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">snd_akm4xxx_get</span><span class="p">(</span><span class="n">ak</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mh">0x03</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">|=</span> <span class="n">dfs</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">;</span>
	<span class="cm">/* snd_akm4xxx_write(ak, 0, reg, tmp); */</span>
	<span class="n">snd_akm4xxx_set</span><span class="p">(</span><span class="n">ak</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span> <span class="cm">/* value is written in reset(0) */</span>
	<span class="n">snd_akm4xxx_reset</span><span class="p">(</span><span class="n">ak</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * I2C access to the PT2258 volume controller on GPIO 6/7 (Revolution 5.1)</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">revo_i2c_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_i2c_bus</span> <span class="o">*</span><span class="n">bus</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">bus</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="n">snd_ice1712_save_gpio_status</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">revo_i2c_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_i2c_bus</span> <span class="o">*</span><span class="n">bus</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">bus</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="n">snd_ice1712_restore_gpio_status</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">revo_i2c_direction</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_i2c_bus</span> <span class="o">*</span><span class="n">bus</span><span class="p">,</span> <span class="kt">int</span> <span class="n">clock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">bus</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">clock</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">VT1724_REVO_I2C_CLOCK</span><span class="p">;</span>	<span class="cm">/* write SCL */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">VT1724_REVO_I2C_DATA</span><span class="p">;</span>	<span class="cm">/* write SDA */</span>
	<span class="n">mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_I2C_CLOCK</span> <span class="o">|</span> <span class="n">VT1724_REVO_I2C_DATA</span><span class="p">;</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">direction</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">direction</span> <span class="o">|=</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">snd_ice1712_gpio_set_dir</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">direction</span><span class="p">);</span>
	<span class="n">snd_ice1712_gpio_set_mask</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="o">~</span><span class="n">mask</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">revo_i2c_setlines</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_i2c_bus</span> <span class="o">*</span><span class="n">bus</span><span class="p">,</span> <span class="kt">int</span> <span class="n">clk</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">bus</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">VT1724_REVO_I2C_CLOCK</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">VT1724_REVO_I2C_DATA</span><span class="p">;</span>
	<span class="n">snd_ice1712_gpio_write_bits</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span>
				    <span class="n">VT1724_REVO_I2C_DATA</span> <span class="o">|</span>
				    <span class="n">VT1724_REVO_I2C_CLOCK</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">revo_i2c_getdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_i2c_bus</span> <span class="o">*</span><span class="n">bus</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ack</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">bus</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bit</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ack</span><span class="p">)</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
	<span class="n">bit</span> <span class="o">=</span> <span class="n">snd_ice1712_gpio_read_bits</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">VT1724_REVO_I2C_DATA</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">bit</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_i2c_bit_ops</span> <span class="n">revo51_bit_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">revo_i2c_start</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stop</span> <span class="o">=</span> <span class="n">revo_i2c_stop</span><span class="p">,</span>
	<span class="p">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">revo_i2c_direction</span><span class="p">,</span>
	<span class="p">.</span><span class="n">setlines</span> <span class="o">=</span> <span class="n">revo_i2c_setlines</span><span class="p">,</span>
	<span class="p">.</span><span class="n">getdata</span> <span class="o">=</span> <span class="n">revo_i2c_getdata</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">revo51_i2c_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">snd_pt2258</span> <span class="o">*</span><span class="n">pt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">revo51_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>

	<span class="cm">/* create the I2C bus */</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_i2c_bus_create</span><span class="p">(</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="s">&quot;ICE1724 GPIO6&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">i2c</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">i2c</span><span class="o">-&gt;</span><span class="n">private_data</span> <span class="o">=</span> <span class="n">ice</span><span class="p">;</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">i2c</span><span class="o">-&gt;</span><span class="n">hw_ops</span><span class="p">.</span><span class="n">bit</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">revo51_bit_ops</span><span class="p">;</span>

	<span class="cm">/* create the I2C device */</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_i2c_device_create</span><span class="p">(</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">i2c</span><span class="p">,</span> <span class="s">&quot;PT2258&quot;</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">pt</span><span class="o">-&gt;</span><span class="n">card</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">;</span>
	<span class="n">pt</span><span class="o">-&gt;</span><span class="n">i2c_bus</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">i2c</span><span class="p">;</span>
	<span class="n">pt</span><span class="o">-&gt;</span><span class="n">i2c_dev</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
	<span class="n">spec</span><span class="o">-&gt;</span><span class="n">pt2258</span> <span class="o">=</span> <span class="n">pt</span><span class="p">;</span>

	<span class="n">snd_pt2258_reset</span><span class="p">(</span><span class="n">pt</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * initialize the chips on M-Audio Revolution cards</span>
<span class="cm"> */</span>

<span class="cp">#define AK_DAC(xname,xch) { .name = xname, .num_channels = xch }</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_akm4xxx_dac_channel</span> <span class="n">revo71_front</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="cm">/* front channels DAC supports muting */</span>
		<span class="p">.</span><span class="n">switch_name</span> <span class="o">=</span> <span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_akm4xxx_dac_channel</span> <span class="n">revo71_surround</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">AK_DAC</span><span class="p">(</span><span class="s">&quot;PCM Center Playback Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">AK_DAC</span><span class="p">(</span><span class="s">&quot;PCM LFE Playback Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">AK_DAC</span><span class="p">(</span><span class="s">&quot;PCM Side Playback Volume&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">AK_DAC</span><span class="p">(</span><span class="s">&quot;PCM Rear Playback Volume&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_akm4xxx_dac_channel</span> <span class="n">revo51_dac</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">AK_DAC</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">AK_DAC</span><span class="p">(</span><span class="s">&quot;PCM Center Playback Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">AK_DAC</span><span class="p">(</span><span class="s">&quot;PCM LFE Playback Volume&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">AK_DAC</span><span class="p">(</span><span class="s">&quot;PCM Rear Playback Volume&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">AK_DAC</span><span class="p">(</span><span class="s">&quot;PCM Headphone Volume&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">revo51_adc_input_names</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Mic&quot;</span><span class="p">,</span>
	<span class="s">&quot;Line&quot;</span><span class="p">,</span>
	<span class="s">&quot;CD&quot;</span><span class="p">,</span>
	<span class="nb">NULL</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_akm4xxx_adc_channel</span> <span class="n">revo51_adc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PCM Capture Volume&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">switch_name</span> <span class="o">=</span> <span class="s">&quot;PCM Capture Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_channels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">input_names</span> <span class="o">=</span> <span class="n">revo51_adc_input_names</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="n">akm_revo_front</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">SND_AK4381</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">set_rate_val</span> <span class="o">=</span> <span class="n">revo_set_rate_val</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">dac_info</span> <span class="o">=</span> <span class="n">revo71_front</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_ak4xxx_private</span> <span class="n">akm_revo_front_priv</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">caddr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cif</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CDOUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_addr</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_none</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">add_flags</span> <span class="o">=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">,</span> <span class="cm">/* high at init */</span>
	<span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="n">akm_revo_surround</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">SND_AK4355</span><span class="p">,</span>
	<span class="p">.</span><span class="n">idx_offset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">set_rate_val</span> <span class="o">=</span> <span class="n">revo_set_rate_val</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">dac_info</span> <span class="o">=</span> <span class="n">revo71_surround</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_ak4xxx_private</span> <span class="n">akm_revo_surround_priv</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">caddr</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cif</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CDOUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_addr</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_none</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">add_flags</span> <span class="o">=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">,</span> <span class="cm">/* high at init */</span>
	<span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="n">akm_revo51</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">SND_AK4358</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">set_rate_val</span> <span class="o">=</span> <span class="n">revo_set_rate_val</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">dac_info</span> <span class="o">=</span> <span class="n">revo51_dac</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_ak4xxx_private</span> <span class="n">akm_revo51_priv</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">caddr</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cif</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CDOUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_addr</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_none</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">add_flags</span> <span class="o">=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">,</span> <span class="cm">/* high at init */</span>
	<span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="n">akm_revo51_adc</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">SND_AK5365</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_adcs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">adc_info</span> <span class="o">=</span> <span class="n">revo51_adc</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_ak4xxx_private</span> <span class="n">akm_revo51_adc_priv</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">caddr</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cif</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CDOUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_addr</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_none</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">add_flags</span> <span class="o">=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">,</span> <span class="cm">/* high at init */</span>
	<span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_pt2258</span> <span class="n">ptc_revo51_volume</span><span class="p">;</span>

<span class="cm">/* AK4358 for AP192 DAC, AK5385A for ADC */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ap192_set_rate_val</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="o">*</span><span class="n">ak</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">ak</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">dfs</span><span class="p">;</span>

	<span class="n">revo_set_rate_val</span><span class="p">(</span><span class="n">ak</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>

	<span class="cm">/* reset CKS */</span>
	<span class="n">snd_ice1712_gpio_write_bits</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">rate</span> <span class="o">&gt;</span> <span class="mi">96000</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="cm">/* reset DFS pins of AK5385A for ADC, too */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;</span> <span class="mi">96000</span><span class="p">)</span>
		<span class="n">dfs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;</span> <span class="mi">48000</span><span class="p">)</span>
		<span class="n">dfs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">dfs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">snd_ice1712_gpio_write_bits</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">,</span> <span class="n">dfs</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>
	<span class="cm">/* reset ADC */</span>
	<span class="n">snd_ice1712_gpio_write_bits</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">snd_ice1712_gpio_write_bits</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_akm4xxx_dac_channel</span> <span class="n">ap192_dac</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">AK_DAC</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="n">akm_ap192</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">SND_AK4358</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dacs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">set_rate_val</span> <span class="o">=</span> <span class="n">ap192_set_rate_val</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">dac_info</span> <span class="o">=</span> <span class="n">ap192_dac</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_ak4xxx_private</span> <span class="n">akm_ap192_priv</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">caddr</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cif</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CDOUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_mask</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_addr</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">cs_none</span> <span class="o">=</span> <span class="n">VT1724_REVO_CS0</span> <span class="o">|</span> <span class="n">VT1724_REVO_CS1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">add_flags</span> <span class="o">=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">,</span> <span class="cm">/* high at init */</span>
	<span class="p">.</span><span class="n">mask_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* AK4114 support on Audiophile 192 */</span>
<span class="cm">/* CDTO (pin 32) -- GPIO2 pin 52</span>
<span class="cm"> * CDTI (pin 33) -- GPIO3 pin 53 (shared with AK4358)</span>
<span class="cm"> * CCLK (pin 34) -- GPIO1 pin 51 (shared with AK4358)</span>
<span class="cm"> * CSN  (pin 35) -- GPIO7 pin 59</span>
<span class="cm"> */</span>
<span class="cp">#define AK4114_ADDR	0x02</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">write_data</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gpio</span><span class="p">,</span>
		       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(;</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* drop clock */</span>
		<span class="n">gpio</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">VT1724_REVO_CCLK</span><span class="p">;</span>
		<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">gpio</span><span class="p">);</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="cm">/* set data */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">idx</span><span class="p">))</span>
			<span class="n">gpio</span> <span class="o">|=</span> <span class="n">VT1724_REVO_CDOUT</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">gpio</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">VT1724_REVO_CDOUT</span><span class="p">;</span>
		<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">gpio</span><span class="p">);</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="cm">/* raise clock */</span>
		<span class="n">gpio</span> <span class="o">|=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">;</span>
		<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">gpio</span><span class="p">);</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nf">read_data</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gpio</span><span class="p">,</span>
			       <span class="kt">int</span> <span class="n">idx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">data</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(;</span> <span class="n">idx</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">idx</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* drop clock */</span>
		<span class="n">gpio</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">VT1724_REVO_CCLK</span><span class="p">;</span>
		<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">gpio</span><span class="p">);</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="cm">/* read data */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">snd_ice1712_gpio_read</span><span class="p">(</span><span class="n">ice</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">VT1724_REVO_CDIN</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">idx</span><span class="p">);</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="cm">/* raise clock */</span>
		<span class="n">gpio</span> <span class="o">|=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">;</span>
		<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">gpio</span><span class="p">);</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ap192_4wire_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tmp</span><span class="p">;</span>

	<span class="n">snd_ice1712_save_gpio_status</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">snd_ice1712_gpio_read</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">|=</span> <span class="n">VT1724_REVO_CCLK</span><span class="p">;</span> <span class="cm">/* high at init */</span>
	<span class="n">tmp</span> <span class="o">|=</span> <span class="n">VT1724_REVO_CS0</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">VT1724_REVO_CS1</span><span class="p">;</span>
	<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ap192_4wire_finish</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tmp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">tmp</span> <span class="o">|=</span> <span class="n">VT1724_REVO_CS1</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">|=</span> <span class="n">VT1724_REVO_CS0</span><span class="p">;</span>
	<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">snd_ice1712_restore_gpio_status</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ap192_ak4114_write</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">addr</span><span class="p">,</span>
			       <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">private_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">addrdata</span><span class="p">;</span>

	<span class="n">tmp</span> <span class="o">=</span> <span class="n">ap192_4wire_start</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
	<span class="n">addrdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">AK4114_ADDR</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span> <span class="o">|</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">);</span>
	<span class="n">addrdata</span> <span class="o">=</span> <span class="p">(</span><span class="n">addrdata</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">data</span><span class="p">;</span>
	<span class="n">write_data</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">addrdata</span><span class="p">,</span> <span class="mi">15</span><span class="p">);</span>
	<span class="n">ap192_4wire_finish</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nf">ap192_ak4114_read</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">private_data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">private_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">data</span><span class="p">;</span>

	<span class="n">tmp</span> <span class="o">=</span> <span class="n">ap192_4wire_start</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
	<span class="n">write_data</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="p">(</span><span class="n">AK4114_ADDR</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">),</span> <span class="mi">7</span><span class="p">);</span>
	<span class="n">data</span> <span class="o">=</span> <span class="n">read_data</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
	<span class="n">ap192_4wire_finish</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">ap192_ak4114_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ak4114_init_vals</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">AK4114_RST</span> <span class="o">|</span> <span class="n">AK4114_PWN</span> <span class="o">|</span> <span class="n">AK4114_OCKS0</span> <span class="o">|</span> <span class="n">AK4114_OCKS1</span><span class="p">,</span>
		<span class="n">AK4114_DIF_I24I2S</span><span class="p">,</span>
		<span class="n">AK4114_TX1E</span><span class="p">,</span>
		<span class="n">AK4114_EFH_1024</span> <span class="o">|</span> <span class="n">AK4114_DIT</span> <span class="o">|</span> <span class="n">AK4114_IPS</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
		<span class="mi">0</span><span class="p">,</span>
		<span class="mi">0</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ak4114_init_txcsb</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">ak4114</span> <span class="o">*</span><span class="n">ak</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ak4114_create</span><span class="p">(</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span>
				 <span class="n">ap192_ak4114_read</span><span class="p">,</span>
				 <span class="n">ap192_ak4114_write</span><span class="p">,</span>
				 <span class="n">ak4114_init_vals</span><span class="p">,</span> <span class="n">ak4114_init_txcsb</span><span class="p">,</span>
				 <span class="n">ice</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ak</span><span class="p">);</span>
	<span class="cm">/* AK4114 in Revo cannot detect external rate correctly.</span>
<span class="cm">	 * No reason to stop capture stream due to incorrect checks */</span>
	<span class="n">ak</span><span class="o">-&gt;</span><span class="n">check_flags</span> <span class="o">=</span> <span class="n">AK4114_CHECK_NO_RATE</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* error ignored; it&#39;s no fatal error */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">revo_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="o">*</span><span class="n">ak</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="cm">/* determine I2C, DACs and ADCs */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">subvendor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">VT1724_SUBDEVICE_REVOLUTION71</span>:
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">num_total_dacs</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">num_total_adcs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">i2s_mclk_changed</span> <span class="o">=</span> <span class="n">revo_i2s_mclk_changed</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">VT1724_SUBDEVICE_REVOLUTION51</span>:
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">num_total_dacs</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">num_total_adcs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">VT1724_SUBDEVICE_AUDIOPHILE192</span>:
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">num_total_dacs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">num_total_adcs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">snd_BUG</span><span class="p">();</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* second stage of initialization, analog parts and others */</span>
	<span class="n">ak</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">akm</span> <span class="o">=</span> <span class="n">kcalloc</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_akm4xxx</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="n">ak</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">subvendor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">VT1724_SUBDEVICE_REVOLUTION71</span>:
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">akm_codecs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ice1712_akm4xxx_init</span><span class="p">(</span><span class="n">ak</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">akm_revo_front</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">akm_revo_front_priv</span><span class="p">,</span> <span class="n">ice</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ice1712_akm4xxx_init</span><span class="p">(</span><span class="n">ak</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">akm_revo_surround</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">akm_revo_surround_priv</span><span class="p">,</span> <span class="n">ice</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="cm">/* unmute all codecs */</span>
		<span class="n">snd_ice1712_gpio_write_bits</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">VT1724_REVO_MUTE</span><span class="p">,</span>
						<span class="n">VT1724_REVO_MUTE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">VT1724_SUBDEVICE_REVOLUTION51</span>:
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">akm_codecs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ice1712_akm4xxx_init</span><span class="p">(</span><span class="n">ak</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">akm_revo51</span><span class="p">,</span>
					       <span class="o">&amp;</span><span class="n">akm_revo51_priv</span><span class="p">,</span> <span class="n">ice</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ice1712_akm4xxx_init</span><span class="p">(</span><span class="n">ak</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">akm_revo51_adc</span><span class="p">,</span>
					       <span class="o">&amp;</span><span class="n">akm_revo51_adc_priv</span><span class="p">,</span> <span class="n">ice</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">revo51_i2c_init</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ptc_revo51_volume</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="cm">/* unmute all codecs */</span>
		<span class="n">snd_ice1712_gpio_write_bits</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">VT1724_REVO_MUTE</span><span class="p">,</span>
					    <span class="n">VT1724_REVO_MUTE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">VT1724_SUBDEVICE_AUDIOPHILE192</span>:
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">akm_codecs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ice1712_akm4xxx_init</span><span class="p">(</span><span class="n">ak</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">akm_ap192</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">akm_ap192_priv</span><span class="p">,</span>
					       <span class="n">ice</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		
		<span class="cm">/* unmute all codecs */</span>
		<span class="n">snd_ice1712_gpio_write_bits</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">VT1724_REVO_MUTE</span><span class="p">,</span>
					    <span class="n">VT1724_REVO_MUTE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">revo_add_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">revo51_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">subvendor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">VT1724_SUBDEVICE_REVOLUTION71</span>:
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ice1712_akm4xxx_build_controls</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">VT1724_SUBDEVICE_REVOLUTION51</span>:
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ice1712_akm4xxx_build_controls</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">spec</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_pt2258_build_controls</span><span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">pt2258</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">VT1724_SUBDEVICE_AUDIOPHILE192</span>:
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ice1712_akm4xxx_build_controls</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">ap192_ak4114_init</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* entry point */</span>
<span class="k">struct</span> <span class="n">snd_ice1712_card_info</span> <span class="n">snd_vt1724_revo_cards</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">subvendor</span> <span class="o">=</span> <span class="n">VT1724_SUBDEVICE_REVOLUTION71</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;M Audio Revolution-7.1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="s">&quot;revo71&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_init</span> <span class="o">=</span> <span class="n">revo_init</span><span class="p">,</span>
		<span class="p">.</span><span class="n">build_controls</span> <span class="o">=</span> <span class="n">revo_add_controls</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">subvendor</span> <span class="o">=</span> <span class="n">VT1724_SUBDEVICE_REVOLUTION51</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;M Audio Revolution-5.1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="s">&quot;revo51&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_init</span> <span class="o">=</span> <span class="n">revo_init</span><span class="p">,</span>
		<span class="p">.</span><span class="n">build_controls</span> <span class="o">=</span> <span class="n">revo_add_controls</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">subvendor</span> <span class="o">=</span> <span class="n">VT1724_SUBDEVICE_AUDIOPHILE192</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;M Audio Audiophile192&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="s">&quot;ap192&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_init</span> <span class="o">=</span> <span class="n">revo_init</span><span class="p">,</span>
		<span class="p">.</span><span class="n">build_controls</span> <span class="o">=</span> <span class="n">revo_add_controls</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span> <span class="cm">/* terminator */</span>
<span class="p">};</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
