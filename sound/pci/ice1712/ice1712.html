<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › pci › ice1712 › ice1712.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>ice1712.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __SOUND_ICE1712_H</span>
<span class="cp">#define __SOUND_ICE1712_H</span>

<span class="cm">/*</span>
<span class="cm"> *   ALSA driver for ICEnsemble ICE1712 (Envy24)</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright (c) 2000 Jaroslav Kysela &lt;perex@perex.cz&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;sound/control.h&gt;</span>
<span class="cp">#include &lt;sound/ac97_codec.h&gt;</span>
<span class="cp">#include &lt;sound/rawmidi.h&gt;</span>
<span class="cp">#include &lt;sound/i2c.h&gt;</span>
<span class="cp">#include &lt;sound/ak4xxx-adda.h&gt;</span>
<span class="cp">#include &lt;sound/ak4114.h&gt;</span>
<span class="cp">#include &lt;sound/pt2258.h&gt;</span>
<span class="cp">#include &lt;sound/pcm.h&gt;</span>
<span class="cp">#include &lt;sound/mpu401.h&gt;</span>


<span class="cm">/*</span>
<span class="cm"> *  Direct registers</span>
<span class="cm"> */</span>

<span class="cp">#define ICEREG(ice, x) ((ice)-&gt;port + ICE1712_REG_##x)</span>

<span class="cp">#define ICE1712_REG_CONTROL		0x00	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_RESET			0x80	</span><span class="cm">/* reset whole chip */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_SERR_LEVEL		0x04	</span><span class="cm">/* SERR# level otherwise edge */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_NATIVE		0x01	</span><span class="cm">/* native mode otherwise SB */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_IRQMASK		0x01	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_IRQ_MPU1		0x80</span>
<span class="cp">#define   ICE1712_IRQ_TIMER		0x40</span>
<span class="cp">#define   ICE1712_IRQ_MPU2		0x20</span>
<span class="cp">#define   ICE1712_IRQ_PROPCM		0x10</span>
<span class="cp">#define   ICE1712_IRQ_FM		0x08	</span><span class="cm">/* FM/MIDI - legacy */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_IRQ_PBKDS		0x04	</span><span class="cm">/* playback DS channels */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_IRQ_CONCAP		0x02	</span><span class="cm">/* consumer capture */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_IRQ_CONPBK		0x01	</span><span class="cm">/* consumer playback */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_IRQSTAT		0x02	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cm">/* look to ICE1712_IRQ_* */</span>
<span class="cp">#define ICE1712_REG_INDEX		0x03	</span><span class="cm">/* byte - indirect CCIxx regs */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_DATA		0x04	</span><span class="cm">/* byte - indirect CCIxx regs */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_NMI_STAT1		0x05	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_NMI_DATA		0x06	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_NMI_INDEX		0x07	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_AC97_INDEX		0x08	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_AC97_CMD		0x09	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_AC97_COLD		0x80	</span><span class="cm">/* cold reset */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_AC97_WARM		0x40	</span><span class="cm">/* warm reset */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_AC97_WRITE		0x20	</span><span class="cm">/* W: write, R: write in progress */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_AC97_READ		0x10	</span><span class="cm">/* W: read, R: read in progress */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_AC97_READY		0x08	</span><span class="cm">/* codec ready status bit */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_AC97_PBK_VSR		0x02	</span><span class="cm">/* playback VSR */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_AC97_CAP_VSR		0x01	</span><span class="cm">/* capture VSR */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_AC97_DATA		0x0a	</span><span class="cm">/* word (little endian) */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_MPU1_CTRL		0x0c	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_MPU1_DATA		0x0d	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_I2C_DEV_ADDR	0x10	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_I2C_WRITE		0x01	</span><span class="cm">/* write direction */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_I2C_BYTE_ADDR	0x11	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_I2C_DATA		0x12	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_I2C_CTRL		0x13	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_I2C_EEPROM		0x80	</span><span class="cm">/* EEPROM exists */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_I2C_BUSY		0x01	</span><span class="cm">/* busy bit */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_CONCAP_ADDR		0x14	</span><span class="cm">/* dword - consumer capture */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_CONCAP_COUNT	0x18	</span><span class="cm">/* word - current/base count */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_SERR_SHADOW		0x1b	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_MPU2_CTRL		0x1c	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_MPU2_DATA		0x1d	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_REG_TIMER		0x1e	</span><span class="cm">/* word */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *  Indirect registers</span>
<span class="cm"> */</span>

<span class="cp">#define ICE1712_IREG_PBK_COUNT_LO	0x00</span>
<span class="cp">#define ICE1712_IREG_PBK_COUNT_HI	0x01</span>
<span class="cp">#define ICE1712_IREG_PBK_CTRL		0x02</span>
<span class="cp">#define ICE1712_IREG_PBK_LEFT		0x03	</span><span class="cm">/* left volume */</span><span class="cp"></span>
<span class="cp">#define ICE1712_IREG_PBK_RIGHT		0x04	</span><span class="cm">/* right volume */</span><span class="cp"></span>
<span class="cp">#define ICE1712_IREG_PBK_SOFT		0x05	</span><span class="cm">/* soft volume */</span><span class="cp"></span>
<span class="cp">#define ICE1712_IREG_PBK_RATE_LO	0x06</span>
<span class="cp">#define ICE1712_IREG_PBK_RATE_MID	0x07</span>
<span class="cp">#define ICE1712_IREG_PBK_RATE_HI	0x08</span>
<span class="cp">#define ICE1712_IREG_CAP_COUNT_LO	0x10</span>
<span class="cp">#define ICE1712_IREG_CAP_COUNT_HI	0x11</span>
<span class="cp">#define ICE1712_IREG_CAP_CTRL		0x12</span>
<span class="cp">#define ICE1712_IREG_GPIO_DATA		0x20</span>
<span class="cp">#define ICE1712_IREG_GPIO_WRITE_MASK	0x21</span>
<span class="cp">#define ICE1712_IREG_GPIO_DIRECTION	0x22</span>
<span class="cp">#define ICE1712_IREG_CONSUMER_POWERDOWN	0x30</span>
<span class="cp">#define ICE1712_IREG_PRO_POWERDOWN	0x31</span>

<span class="cm">/*</span>
<span class="cm"> *  Consumer section direct DMA registers</span>
<span class="cm"> */</span>

<span class="cp">#define ICEDS(ice, x) ((ice)-&gt;dmapath_port + ICE1712_DS_##x)</span>

<span class="cp">#define ICE1712_DS_INTMASK		0x00	</span><span class="cm">/* word - interrupt mask */</span><span class="cp"></span>
<span class="cp">#define ICE1712_DS_INTSTAT		0x02	</span><span class="cm">/* word - interrupt status */</span><span class="cp"></span>
<span class="cp">#define ICE1712_DS_DATA			0x04	</span><span class="cm">/* dword - channel data */</span><span class="cp"></span>
<span class="cp">#define ICE1712_DS_INDEX		0x08	</span><span class="cm">/* dword - channel index */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *  Consumer section channel registers</span>
<span class="cm"> */</span>

<span class="cp">#define ICE1712_DSC_ADDR0		0x00	</span><span class="cm">/* dword - base address 0 */</span><span class="cp"></span>
<span class="cp">#define ICE1712_DSC_COUNT0		0x01	</span><span class="cm">/* word - count 0 */</span><span class="cp"></span>
<span class="cp">#define ICE1712_DSC_ADDR1		0x02	</span><span class="cm">/* dword - base address 1 */</span><span class="cp"></span>
<span class="cp">#define ICE1712_DSC_COUNT1		0x03	</span><span class="cm">/* word - count 1 */</span><span class="cp"></span>
<span class="cp">#define ICE1712_DSC_CONTROL		0x04	</span><span class="cm">/* byte - control &amp; status */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_BUFFER1		0x80	</span><span class="cm">/* buffer1 is active */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_BUFFER1_AUTO		0x40	</span><span class="cm">/* buffer1 auto init */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_BUFFER0_AUTO		0x20	</span><span class="cm">/* buffer0 auto init */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_FLUSH			0x10	</span><span class="cm">/* flush FIFO */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_STEREO		0x08	</span><span class="cm">/* stereo */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_16BIT			0x04	</span><span class="cm">/* 16-bit data */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_PAUSE			0x02	</span><span class="cm">/* pause */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_START			0x01	</span><span class="cm">/* start */</span><span class="cp"></span>
<span class="cp">#define ICE1712_DSC_RATE		0x05	</span><span class="cm">/* dword - rate */</span><span class="cp"></span>
<span class="cp">#define ICE1712_DSC_VOLUME		0x06	</span><span class="cm">/* word - volume control */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *  Professional multi-track direct control registers</span>
<span class="cm"> */</span>

<span class="cp">#define ICEMT(ice, x) ((ice)-&gt;profi_port + ICE1712_MT_##x)</span>

<span class="cp">#define ICE1712_MT_IRQ			0x00	</span><span class="cm">/* byte - interrupt mask */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_MULTI_CAPTURE		0x80	</span><span class="cm">/* capture IRQ */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_MULTI_PLAYBACK	0x40	</span><span class="cm">/* playback IRQ */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_MULTI_CAPSTATUS	0x02	</span><span class="cm">/* capture IRQ status */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_MULTI_PBKSTATUS	0x01	</span><span class="cm">/* playback IRQ status */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_RATE			0x01	</span><span class="cm">/* byte - sampling rate select */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_SPDIF_MASTER		0x10	</span><span class="cm">/* S/PDIF input is master clock */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_I2S_FORMAT		0x02	</span><span class="cm">/* byte - I2S data format */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_AC97_INDEX		0x04	</span><span class="cm">/* byte - AC&#39;97 index */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_AC97_CMD		0x05	</span><span class="cm">/* byte - AC&#39;97 command &amp; status */</span><span class="cp"></span>
<span class="cm">/* look to ICE1712_AC97_* */</span>
<span class="cp">#define ICE1712_MT_AC97_DATA		0x06	</span><span class="cm">/* word - AC&#39;97 data */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_PLAYBACK_ADDR	0x10	</span><span class="cm">/* dword - playback address */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_PLAYBACK_SIZE	0x14	</span><span class="cm">/* word - playback size */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_PLAYBACK_COUNT	0x16	</span><span class="cm">/* word - playback count */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_PLAYBACK_CONTROL	0x18	</span><span class="cm">/* byte - control */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_CAPTURE_START_SHADOW	0x04	</span><span class="cm">/* capture start */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_PLAYBACK_PAUSE	0x02	</span><span class="cm">/* playback pause */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_PLAYBACK_START	0x01	</span><span class="cm">/* playback start */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_CAPTURE_ADDR		0x20	</span><span class="cm">/* dword - capture address */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_CAPTURE_SIZE		0x24	</span><span class="cm">/* word - capture size */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_CAPTURE_COUNT	0x26	</span><span class="cm">/* word - capture count */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_CAPTURE_CONTROL	0x28	</span><span class="cm">/* byte - control */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_CAPTURE_START		0x01	</span><span class="cm">/* capture start */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_ROUTE_PSDOUT03	0x30	</span><span class="cm">/* word */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_ROUTE_SPDOUT		0x32	</span><span class="cm">/* word */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_ROUTE_CAPTURE	0x34	</span><span class="cm">/* dword */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_MONITOR_VOLUME	0x38	</span><span class="cm">/* word */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_MONITOR_INDEX	0x3a	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_MONITOR_RATE		0x3b	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_MONITOR_ROUTECTRL	0x3c	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_ROUTE_AC97		0x01	</span><span class="cm">/* route digital mixer output to AC&#39;97 */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_MONITOR_PEAKINDEX	0x3e	</span><span class="cm">/* byte */</span><span class="cp"></span>
<span class="cp">#define ICE1712_MT_MONITOR_PEAKDATA	0x3f	</span><span class="cm">/* byte */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *  Codec configuration bits</span>
<span class="cm"> */</span>

<span class="cm">/* PCI[60] System Configuration */</span>
<span class="cp">#define ICE1712_CFG_CLOCK	0xc0</span>
<span class="cp">#define   ICE1712_CFG_CLOCK512	0x00	</span><span class="cm">/* 22.5692Mhz, 44.1kHz*512 */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_CFG_CLOCK384  0x40	</span><span class="cm">/* 16.9344Mhz, 44.1kHz*384 */</span><span class="cp"></span>
<span class="cp">#define   ICE1712_CFG_EXT	0x80	</span><span class="cm">/* external clock */</span><span class="cp"></span>
<span class="cp">#define ICE1712_CFG_2xMPU401	0x20	</span><span class="cm">/* two MPU401 UARTs */</span><span class="cp"></span>
<span class="cp">#define ICE1712_CFG_NO_CON_AC97 0x10	</span><span class="cm">/* consumer AC&#39;97 codec is not present */</span><span class="cp"></span>
<span class="cp">#define ICE1712_CFG_ADC_MASK	0x0c	</span><span class="cm">/* one, two, three, four stereo ADCs */</span><span class="cp"></span>
<span class="cp">#define ICE1712_CFG_DAC_MASK	0x03	</span><span class="cm">/* one, two, three, four stereo DACs */</span><span class="cp"></span>
<span class="cm">/* PCI[61] AC-Link Configuration */</span>
<span class="cp">#define ICE1712_CFG_PRO_I2S	0x80	</span><span class="cm">/* multitrack converter: I2S or AC&#39;97 */</span><span class="cp"></span>
<span class="cp">#define ICE1712_CFG_AC97_PACKED	0x01	</span><span class="cm">/* split or packed mode - AC&#39;97 */</span><span class="cp"></span>
<span class="cm">/* PCI[62] I2S Features */</span>
<span class="cp">#define ICE1712_CFG_I2S_VOLUME	0x80	</span><span class="cm">/* volume/mute capability */</span><span class="cp"></span>
<span class="cp">#define ICE1712_CFG_I2S_96KHZ	0x40	</span><span class="cm">/* supports 96kHz sampling */</span><span class="cp"></span>
<span class="cp">#define ICE1712_CFG_I2S_RESMASK	0x30	</span><span class="cm">/* resolution mask, 16,18,20,24-bit */</span><span class="cp"></span>
<span class="cp">#define ICE1712_CFG_I2S_OTHER	0x0f	</span><span class="cm">/* other I2S IDs */</span><span class="cp"></span>
<span class="cm">/* PCI[63] S/PDIF Configuration */</span>
<span class="cp">#define ICE1712_CFG_I2S_CHIPID	0xfc	</span><span class="cm">/* I2S chip ID */</span><span class="cp"></span>
<span class="cp">#define ICE1712_CFG_SPDIF_IN	0x02	</span><span class="cm">/* S/PDIF input is present */</span><span class="cp"></span>
<span class="cp">#define ICE1712_CFG_SPDIF_OUT	0x01	</span><span class="cm">/* S/PDIF output is present */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * DMA mode values</span>
<span class="cm"> * identical with DMA_XXX on i386 architecture.</span>
<span class="cm"> */</span>
<span class="cp">#define ICE1712_DMA_MODE_WRITE		0x48</span>
<span class="cp">#define ICE1712_DMA_AUTOINIT		0x10</span>


<span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">snd_ice1712</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">snd_ice1712_eeprom</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">subvendor</span><span class="p">;</span>	<span class="cm">/* PCI[2c-2f] */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">size</span><span class="p">;</span>	<span class="cm">/* size of EEPROM image in bytes */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">version</span><span class="p">;</span>	<span class="cm">/* must be 1 (or 2 for vt1724) */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">data</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gpiomask</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gpiostate</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gpiodir</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">ICE_EEP1_CODEC</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* 06 */</span>
	<span class="n">ICE_EEP1_ACLINK</span><span class="p">,</span>	<span class="cm">/* 07 */</span>
	<span class="n">ICE_EEP1_I2SID</span><span class="p">,</span>		<span class="cm">/* 08 */</span>
	<span class="n">ICE_EEP1_SPDIF</span><span class="p">,</span>		<span class="cm">/* 09 */</span>
	<span class="n">ICE_EEP1_GPIO_MASK</span><span class="p">,</span>	<span class="cm">/* 0a */</span>
	<span class="n">ICE_EEP1_GPIO_STATE</span><span class="p">,</span>	<span class="cm">/* 0b */</span>
	<span class="n">ICE_EEP1_GPIO_DIR</span><span class="p">,</span>	<span class="cm">/* 0c */</span>
	<span class="n">ICE_EEP1_AC97_MAIN_LO</span><span class="p">,</span>	<span class="cm">/* 0d */</span>
	<span class="n">ICE_EEP1_AC97_MAIN_HI</span><span class="p">,</span>	<span class="cm">/* 0e */</span>
	<span class="n">ICE_EEP1_AC97_PCM_LO</span><span class="p">,</span>	<span class="cm">/* 0f */</span>
	<span class="n">ICE_EEP1_AC97_PCM_HI</span><span class="p">,</span>	<span class="cm">/* 10 */</span>
	<span class="n">ICE_EEP1_AC97_REC_LO</span><span class="p">,</span>	<span class="cm">/* 11 */</span>
	<span class="n">ICE_EEP1_AC97_REC_HI</span><span class="p">,</span>	<span class="cm">/* 12 */</span>
	<span class="n">ICE_EEP1_AC97_RECSRC</span><span class="p">,</span>	<span class="cm">/* 13 */</span>
	<span class="n">ICE_EEP1_DAC_ID</span><span class="p">,</span>	<span class="cm">/* 14 */</span>
	<span class="n">ICE_EEP1_DAC_ID1</span><span class="p">,</span>
	<span class="n">ICE_EEP1_DAC_ID2</span><span class="p">,</span>
	<span class="n">ICE_EEP1_DAC_ID3</span><span class="p">,</span>
	<span class="n">ICE_EEP1_ADC_ID</span><span class="p">,</span>	<span class="cm">/* 18 */</span>
	<span class="n">ICE_EEP1_ADC_ID1</span><span class="p">,</span>
	<span class="n">ICE_EEP1_ADC_ID2</span><span class="p">,</span>
	<span class="n">ICE_EEP1_ADC_ID3</span>
<span class="p">};</span>

<span class="cp">#define ice_has_con_ac97(ice)	(!((ice)-&gt;eeprom.data[ICE_EEP1_CODEC] &amp; ICE1712_CFG_NO_CON_AC97))</span>


<span class="k">struct</span> <span class="n">snd_ak4xxx_private</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cif</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* CIF mode */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">caddr</span><span class="p">;</span>		<span class="cm">/* C0 and C1 bits */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data_mask</span><span class="p">;</span>		<span class="cm">/* DATA gpio bit */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">clk_mask</span><span class="p">;</span>		<span class="cm">/* CLK gpio bit */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cs_mask</span><span class="p">;</span>		<span class="cm">/* bit mask for select/deselect address */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cs_addr</span><span class="p">;</span>		<span class="cm">/* bits to select address */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cs_none</span><span class="p">;</span>		<span class="cm">/* bits to deselect address */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">add_flags</span><span class="p">;</span>		<span class="cm">/* additional bits at init */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask_flags</span><span class="p">;</span>	<span class="cm">/* total mask bits */</span>
	<span class="k">struct</span> <span class="n">snd_akm4xxx_ops</span> <span class="p">{</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_rate_val</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="o">*</span><span class="n">ak</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">);</span>
	<span class="p">}</span> <span class="n">ops</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_ice1712_spdif</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cs8403_bits</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">cs8403_stream_bits</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">stream_ctl</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_ice1712_spdif_ops</span> <span class="p">{</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">open</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="p">);</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">setup_rate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">);</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">close</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="p">);</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">default_get</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">);</span>
		<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">default_put</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">);</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">stream_get</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">);</span>
		<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">stream_put</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">);</span>
	<span class="p">}</span> <span class="n">ops</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">conp_dma_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">conc_dma_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">prop_dma_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">proc_dma_size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ddma_port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dmapath_port</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">profi_port</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">pcm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">pcm_ds</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">pcm_pro</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">playback_con_substream</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">playback_con_substream_ds</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">capture_con_substream</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">playback_pro_substream</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">capture_pro_substream</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">playback_pro_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">capture_pro_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">playback_con_virt_addr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">playback_con_active_buf</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">capture_con_virt_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ac97_ext_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_ac97</span> <span class="o">*</span><span class="n">ac97</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_rawmidi</span> <span class="o">*</span><span class="n">rmidi</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="n">spinlock_t</span> <span class="n">reg_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_info_entry</span> <span class="o">*</span><span class="n">proc_entry</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_ice1712_eeprom</span> <span class="n">eeprom</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pro_volumes</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">omni</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Delta Omni I/O */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dxr_enable</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Terratec DXR enable for DMX6FIRE */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vt1724</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vt1720</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">has_spdif</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* VT1720/4 - has SPDIF I/O */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">force_pdma4</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* VT1720/4 - PDMA4 as non-spdif */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">force_rdma1</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* VT1720/4 - RDMA1 as non-spdif */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">midi_output</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* VT1720/4: MIDI output triggered */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">midi_input</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* VT1720/4: MIDI input triggered */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">own_routing</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* VT1720/4: use own routing ctls */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_total_dacs</span><span class="p">;</span>	<span class="cm">/* total DACs */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_total_adcs</span><span class="p">;</span>	<span class="cm">/* total ADCs */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cur_rate</span><span class="p">;</span>		<span class="cm">/* current rate */</span>

	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">open_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">pcm_reserved</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">snd_pcm_hw_constraint_list</span> <span class="o">*</span><span class="n">hw_rates</span><span class="p">;</span> <span class="cm">/* card-specific rate constraints */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">akm_codecs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="o">*</span><span class="n">akm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_ice1712_spdif</span> <span class="n">spdif</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">i2c_mutex</span><span class="p">;</span>	<span class="cm">/* I2C mutex for ICE1724 registers */</span>
	<span class="k">struct</span> <span class="n">snd_i2c_bus</span> <span class="o">*</span><span class="n">i2c</span><span class="p">;</span>		<span class="cm">/* I2C bus */</span>
	<span class="k">struct</span> <span class="n">snd_i2c_device</span> <span class="o">*</span><span class="n">cs8427</span><span class="p">;</span>	<span class="cm">/* CS8427 I2C device */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cs8427_timeout</span><span class="p">;</span>	<span class="cm">/* CS8427 reset timeout in HZ/100 */</span>

	<span class="k">struct</span> <span class="n">ice1712_gpio</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">direction</span><span class="p">;</span>		<span class="cm">/* current direction bits */</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">write_mask</span><span class="p">;</span>	<span class="cm">/* current mask bits */</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">saved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>		<span class="cm">/* for ewx_i2c */</span>
		<span class="cm">/* operators */</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_mask</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data</span><span class="p">);</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_mask</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_dir</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data</span><span class="p">);</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_dir</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_data</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data</span><span class="p">);</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_data</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>
		<span class="cm">/* misc operators - move to another place? */</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_pro_rate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">);</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">i2s_mclk_changed</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>
	<span class="p">}</span> <span class="n">gpio</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">gpio_mutex</span><span class="p">;</span>

	<span class="cm">/* other board-specific data */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>

	<span class="cm">/* VT172x specific */</span>
	<span class="kt">int</span> <span class="n">pro_rate_default</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">is_spdif_master</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_rate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_rate</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="p">(</span><span class="o">*</span><span class="n">set_mclk</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">set_spdif_clock</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_spdif_master_type</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>
	<span class="kt">char</span> <span class="o">**</span><span class="n">ext_clock_names</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ext_clock_count</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pro_open</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_PM</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">pm_suspend</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">pm_resume</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_suspend_enabled</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_saved_is_spdif_master</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_saved_spdif_ctrl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">pm_saved_spdif_cfg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pm_saved_route</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * gpio access functions</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">snd_ice1712_gpio_set_dir</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bits</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">set_dir</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">snd_ice1712_gpio_get_dir</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">get_dir</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">snd_ice1712_gpio_set_mask</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bits</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">set_mask</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">snd_ice1712_gpio_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">snd_ice1712_gpio_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * save and restore gpio status</span>
<span class="cm"> * The access to gpio will be protected by mutex, so don&#39;t forget to</span>
<span class="cm"> * restore!</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">snd_ice1712_save_gpio_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio_mutex</span><span class="p">);</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">saved</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">direction</span><span class="p">;</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">saved</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">write_mask</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">snd_ice1712_restore_gpio_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">set_dir</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">saved</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">set_mask</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">saved</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">saved</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">write_mask</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">saved</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio_mutex</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* for bit controls */</span>
<span class="cp">#define ICE1712_GPIO(xiface, xname, xindex, mask, invert, xaccess) \</span>
<span class="cp">{ .iface = xiface, .name = xname, .access = xaccess, .info = snd_ctl_boolean_mono_info, \</span>
<span class="cp">  .get = snd_ice1712_gpio_get, .put = snd_ice1712_gpio_put, \</span>
<span class="cp">  .private_value = mask | (invert &lt;&lt; 24) }</span>

<span class="kt">int</span> <span class="n">snd_ice1712_gpio_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_ice1712_gpio_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * set gpio direction, write mask and data</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">snd_ice1712_gpio_write_bits</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
					       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bits</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">direction</span> <span class="o">|=</span> <span class="n">mask</span><span class="p">;</span>
	<span class="n">snd_ice1712_gpio_set_dir</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">direction</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">snd_ice1712_gpio_read</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
	<span class="n">val</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="n">mask</span> <span class="o">&amp;</span> <span class="n">bits</span><span class="p">;</span>
	<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">snd_ice1712_gpio_read_bits</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
					      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">direction</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>
	<span class="n">snd_ice1712_gpio_set_dir</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">direction</span><span class="p">);</span>
	<span class="k">return</span>  <span class="n">snd_ice1712_gpio_read</span><span class="p">(</span><span class="n">ice</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* route access functions */</span>
<span class="kt">int</span> <span class="n">snd_ice1724_get_route_val</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">int</span> <span class="n">shift</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_ice1724_put_route_val</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span>
								<span class="kt">int</span> <span class="n">shift</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">snd_ice1712_spdif_build_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">snd_ice1712_akm4xxx_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="o">*</span><span class="n">ak</span><span class="p">,</span>
			     <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_akm4xxx</span> <span class="o">*</span><span class="n">template</span><span class="p">,</span>
			     <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_ak4xxx_private</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">snd_ice1712_akm4xxx_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">snd_ice1712_akm4xxx_build_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">snd_ice1712_init_cs8427</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">snd_ice1712_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">ICEREG</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">INDEX</span><span class="p">));</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">ICEREG</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">DATA</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">snd_ice1712_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">outb</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">ICEREG</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">INDEX</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">inb</span><span class="p">(</span><span class="n">ICEREG</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">DATA</span><span class="p">));</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * entry pointer</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">snd_ice1712_card_info</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">subvendor</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">model</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">driver</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">chip_init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">build_controls</span><span class="p">)(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">no_mpu401</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mpu401_1_info_flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mpu401_2_info_flags</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mpu401_1_name</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mpu401_2_name</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">eeprom_size</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">eeprom_data</span><span class="p">;</span>
<span class="p">};</span>


<span class="cp">#endif </span><span class="cm">/* __SOUND_ICE1712_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
