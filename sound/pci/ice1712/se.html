<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › pci › ice1712 › se.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>se.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *   ALSA driver for ICEnsemble VT1724 (Envy24HT)</span>
<span class="cm"> *</span>
<span class="cm"> *   Lowlevel functions for ONKYO WAVIO SE-90PCI and SE-200PCI</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright (c) 2007 Shin-ya Okada  sh_okada(at)d4.dion.ne.jp</span>
<span class="cm"> *                                        (at) -&gt; @</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *   GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program; if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>      

<span class="cp">#include &lt;asm/io.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;sound/core.h&gt;</span>
<span class="cp">#include &lt;sound/tlv.h&gt;</span>

<span class="cp">#include &quot;ice1712.h&quot;</span>
<span class="cp">#include &quot;envy24ht.h&quot;</span>
<span class="cp">#include &quot;se.h&quot;</span>

<span class="k">struct</span> <span class="n">se_spec</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ch1</span><span class="p">,</span> <span class="n">ch2</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">vol</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/*  ONKYO WAVIO SE-200PCI                                                   */</span>
<span class="cm">/****************************************************************************/</span>
<span class="cm">/*</span>
<span class="cm"> *  system configuration ICE_EEP2_SYSCONF=0x4b</span>
<span class="cm"> *    XIN1 49.152MHz</span>
<span class="cm"> *    not have UART</span>
<span class="cm"> *    one stereo ADC and a S/PDIF receiver connected</span>
<span class="cm"> *    four stereo DACs connected</span>
<span class="cm"> *</span>
<span class="cm"> *  AC-Link configuration ICE_EEP2_ACLINK=0x80</span>
<span class="cm"> *    use I2C, not use AC97</span>
<span class="cm"> *</span>
<span class="cm"> *  I2S converters feature ICE_EEP2_I2S=0x78</span>
<span class="cm"> *    I2S codec has no volume/mute control feature</span>
<span class="cm"> *    I2S codec supports 96KHz and 192KHz</span>
<span class="cm"> *    I2S codec 24bits</span>
<span class="cm"> *</span>
<span class="cm"> *  S/PDIF configuration ICE_EEP2_SPDIF=0xc3</span>
<span class="cm"> *    Enable integrated S/PDIF transmitter</span>
<span class="cm"> *    internal S/PDIF out implemented</span>
<span class="cm"> *    S/PDIF is stereo</span>
<span class="cm"> *    External S/PDIF out implemented</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * ** connected chips **</span>
<span class="cm"> *</span>
<span class="cm"> *  WM8740</span>
<span class="cm"> *      A 2ch-DAC of main outputs.</span>
<span class="cm"> *      It setuped as I2S mode by wire, so no way to setup from software.</span>
<span class="cm"> *      The sample-rate are automatically changed. </span>
<span class="cm"> *          ML/I2S (28pin) --------+</span>
<span class="cm"> *          MC/DM1 (27pin) -- 5V   |</span>
<span class="cm"> *          MD/DM0 (26pin) -- GND  |</span>
<span class="cm"> *          MUTEB  (25pin) -- NC   |</span>
<span class="cm"> *          MODE   (24pin) -- GND  |</span>
<span class="cm"> *          CSBIW  (23pin) --------+</span>
<span class="cm"> *                                 |</span>
<span class="cm"> *          RSTB   (22pin) --R(1K)-+</span>
<span class="cm"> *      Probably it reduce the noise from the control line.</span>
<span class="cm"> *</span>
<span class="cm"> *  WM8766</span>
<span class="cm"> *      A 6ch-DAC for surrounds.</span>
<span class="cm"> *      It&#39;s control wire was connected to GPIOxx (3-wire serial interface)</span>
<span class="cm"> *          ML/I2S (11pin) -- GPIO18</span>
<span class="cm"> *          MC/IWL (12pin) -- GPIO17</span>
<span class="cm"> *          MD/DM  (13pin) -- GPIO16</span>
<span class="cm"> *          MUTE   (14pin) -- GPIO01</span>
<span class="cm"> *</span>
<span class="cm"> *  WM8776</span>
<span class="cm"> *     A 2ch-ADC(with 10ch-selector) plus 2ch-DAC.</span>
<span class="cm"> *     It&#39;s control wire was connected to SDA/SCLK (2-wire serial interface)</span>
<span class="cm"> *          MODE (16pin) -- R(1K) -- GND</span>
<span class="cm"> *          CE   (17pin) -- R(1K) -- GND  2-wire mode (address=0x34)</span>
<span class="cm"> *          DI   (18pin) -- SDA</span>
<span class="cm"> *          CL   (19pin) -- SCLK</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * ** output pins and device names **</span>
<span class="cm"> *</span>
<span class="cm"> *   7.1ch name -- output connector color -- device (-D option)</span>
<span class="cm"> *</span>
<span class="cm"> *      FRONT 2ch                  -- green  -- plughw:0,0</span>
<span class="cm"> *      CENTER(Lch) SUBWOOFER(Rch) -- black  -- plughw:0,2,0</span>
<span class="cm"> *      SURROUND 2ch               -- orange -- plughw:0,2,1</span>
<span class="cm"> *      SURROUND BACK 2ch          -- white  -- plughw:0,2,2</span>
<span class="cm"> *</span>
<span class="cm"> */</span>


<span class="cm">/****************************************************************************/</span>
<span class="cm">/*  WM8740 interface                                                        */</span>
<span class="cm">/****************************************************************************/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__devinit</span> <span class="nf">se200pci_WM8740_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* nothing to do */</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8740_set_pro_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
						<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* nothing to do */</span>
<span class="p">}</span>


<span class="cm">/****************************************************************************/</span>
<span class="cm">/*  WM8766 interface                                                        */</span>
<span class="cm">/****************************************************************************/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8766_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">st</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bits</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">DATA</span>  <span class="o">=</span> <span class="mh">0x010000</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">CLOCK</span> <span class="o">=</span> <span class="mh">0x020000</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">LOAD</span>  <span class="o">=</span> <span class="mh">0x040000</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ALL_MASK</span> <span class="o">=</span> <span class="p">(</span><span class="n">DATA</span> <span class="o">|</span> <span class="n">CLOCK</span> <span class="o">|</span> <span class="n">LOAD</span><span class="p">);</span>

	<span class="n">snd_ice1712_save_gpio_status</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>

	<span class="n">st</span> <span class="o">=</span> <span class="p">((</span><span class="n">addr</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="mh">0x1ff</span><span class="p">);</span>
	<span class="n">snd_ice1712_gpio_set_dir</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">direction</span> <span class="o">|</span> <span class="n">ALL_MASK</span><span class="p">);</span>
	<span class="n">snd_ice1712_gpio_set_mask</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">write_mask</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ALL_MASK</span><span class="p">);</span>
	<span class="n">bits</span> <span class="o">=</span> <span class="n">snd_ice1712_gpio_read</span><span class="p">(</span><span class="n">ice</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ALL_MASK</span><span class="p">;</span>

	<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="n">bits</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">CLOCK</span><span class="p">;</span>
		<span class="n">st</span> <span class="o">=</span> <span class="p">(</span><span class="n">st</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">st</span> <span class="o">&amp;</span> <span class="mh">0x10000</span><span class="p">)</span>
			<span class="n">bits</span> <span class="o">|=</span> <span class="n">DATA</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">bits</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">DATA</span><span class="p">;</span>

		<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>

		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="n">bits</span> <span class="o">|=</span> <span class="n">CLOCK</span><span class="p">;</span>
		<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">bits</span> <span class="o">|=</span> <span class="n">LOAD</span><span class="p">;</span>
	<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>

	<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">bits</span> <span class="o">|=</span> <span class="p">(</span><span class="n">DATA</span> <span class="o">|</span> <span class="n">CLOCK</span><span class="p">);</span>
	<span class="n">snd_ice1712_gpio_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span>

	<span class="n">snd_ice1712_restore_gpio_status</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8766_set_volume</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ch</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vol1</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vol2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">,</span> <span class="n">vol1</span><span class="p">);</span>
		<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x001</span><span class="p">,</span> <span class="n">vol2</span> <span class="o">|</span> <span class="mh">0x100</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x004</span><span class="p">,</span> <span class="n">vol1</span><span class="p">);</span>
		<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x005</span><span class="p">,</span> <span class="n">vol2</span> <span class="o">|</span> <span class="mh">0x100</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x006</span><span class="p">,</span> <span class="n">vol1</span><span class="p">);</span>
		<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x007</span><span class="p">,</span> <span class="n">vol2</span> <span class="o">|</span> <span class="mh">0x100</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__devinit</span> <span class="nf">se200pci_WM8766_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">);</span> <span class="cm">/* RESET ALL */</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="n">se200pci_WM8766_set_volume</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="cm">/* volume L=0 R=0 */</span>
	<span class="n">se200pci_WM8766_set_volume</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="cm">/* volume L=0 R=0 */</span>
	<span class="n">se200pci_WM8766_set_volume</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="cm">/* volume L=0 R=0 */</span>

	<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x022</span><span class="p">);</span> <span class="cm">/* serial mode I2S-24bits */</span>
	<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x080</span><span class="p">);</span> <span class="cm">/* MCLK=256fs */</span>
	<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">);</span> <span class="cm">/* MDP=0 */</span>
	<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">);</span> <span class="cm">/* MDP=0 */</span>
	<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">);</span> <span class="cm">/* demp=off mute=off */</span>

	<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x124</span><span class="p">);</span> <span class="cm">/* ch-assign L=L R=R RESET */</span>
	<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x120</span><span class="p">);</span> <span class="cm">/* ch-assign L=L R=R */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8766_set_pro_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&gt;</span> <span class="mi">96000</span><span class="p">)</span>
		<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">);</span> <span class="cm">/* MCLK=128fs */</span>
	<span class="k">else</span>
		<span class="n">se200pci_WM8766_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x080</span><span class="p">);</span> <span class="cm">/* MCLK=256fs */</span>
<span class="p">}</span>


<span class="cm">/****************************************************************************/</span>
<span class="cm">/*  WM8776 interface                                                        */</span>
<span class="cm">/****************************************************************************/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8776_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="n">data</span><span class="p">;</span>
	<span class="n">snd_vt1724_write_i2c</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8776_set_output_volume</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vol1</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vol2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="n">vol1</span><span class="p">);</span>
	<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">vol2</span> <span class="o">|</span> <span class="mh">0x100</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8776_set_input_volume</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vol1</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vol2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="n">vol1</span><span class="p">);</span>
	<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="n">vol2</span> <span class="o">|</span> <span class="mh">0x100</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">se200pci_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;LINE-IN&quot;</span><span class="p">,</span> <span class="s">&quot;CD-IN&quot;</span><span class="p">,</span> <span class="s">&quot;MIC-IN&quot;</span><span class="p">,</span> <span class="s">&quot;ALL-MIX&quot;</span><span class="p">,</span> <span class="nb">NULL</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8776_set_input_selector</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
					       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">vals</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* LINE, CD, MIC, ALL, GND */</span>
		<span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x03</span>
	<span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sel</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">)</span>
		<span class="n">sel</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="n">vals</span><span class="p">[</span><span class="n">sel</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8776_set_afl</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">afl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* AFL -- After Fader Listening */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">afl</span><span class="p">)</span>
		<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x005</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x001</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">se200pci_agc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Off&quot;</span><span class="p">,</span> <span class="s">&quot;LimiterMode&quot;</span><span class="p">,</span> <span class="s">&quot;ALCMode&quot;</span><span class="p">,</span> <span class="nb">NULL</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8776_set_agc</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">agc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* AGC -- Auto Gain Control of the input */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">agc</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">);</span> <span class="cm">/* Off */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x07b</span><span class="p">);</span>
		<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">);</span> <span class="cm">/* LimiterMode */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x1fb</span><span class="p">);</span>
		<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">);</span> <span class="cm">/* ALCMode */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__devinit</span> <span class="nf">se200pci_WM8776_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">__devinitdata</span> <span class="n">default_values</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x100</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span>
		<span class="mh">0x100</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">,</span>
		<span class="mh">0x000</span><span class="p">,</span> <span class="mh">0x090</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">,</span>
		<span class="mh">0x022</span><span class="p">,</span> <span class="mh">0x022</span><span class="p">,</span> <span class="mh">0x022</span><span class="p">,</span>
		<span class="mh">0x008</span><span class="p">,</span> <span class="mh">0x0cf</span><span class="p">,</span> <span class="mh">0x0cf</span><span class="p">,</span> <span class="mh">0x07b</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">,</span>
		<span class="mh">0x032</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">,</span> <span class="mh">0x0a6</span><span class="p">,</span> <span class="mh">0x001</span><span class="p">,</span> <span class="mh">0x001</span>
	<span class="p">};</span>

	<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">);</span> <span class="cm">/* reset all */</span>
	<span class="cm">/* ADC and DAC interface is I2S 24bits mode */</span>
 	<span class="cm">/* The sample-rate are automatically changed */</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="cm">/* BUT my board can not do reset all, so I load all by manually. */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">default_values</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">default_values</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="n">se200pci_WM8776_set_input_selector</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">se200pci_WM8776_set_afl</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">se200pci_WM8776_set_agc</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">se200pci_WM8776_set_input_volume</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">se200pci_WM8776_set_output_volume</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* head phone mute and power down */</span>
	<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x100</span><span class="p">);</span>
	<span class="n">se200pci_WM8776_write</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x080</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_WM8776_set_pro_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span>
						<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* nothing to do */</span>
<span class="p">}</span>


<span class="cm">/****************************************************************************/</span>
<span class="cm">/*  runtime interface                                                       */</span>
<span class="cm">/****************************************************************************/</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_set_pro_rate</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">se200pci_WM8740_set_pro_rate</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="n">se200pci_WM8766_set_pro_rate</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
	<span class="n">se200pci_WM8776_set_pro_rate</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">rate</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">se200pci_control</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">enum</span> <span class="p">{</span>
		<span class="n">WM8766</span><span class="p">,</span>
		<span class="n">WM8776in</span><span class="p">,</span>
		<span class="n">WM8776out</span><span class="p">,</span>
		<span class="n">WM8776sel</span><span class="p">,</span>
		<span class="n">WM8776agc</span><span class="p">,</span>
		<span class="n">WM8776afl</span>
	<span class="p">}</span> <span class="n">target</span><span class="p">;</span>
	<span class="k">enum</span> <span class="p">{</span> <span class="n">VOLUME1</span><span class="p">,</span> <span class="n">VOLUME2</span><span class="p">,</span> <span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">ENUM</span> <span class="p">}</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ch</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">member</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">comment</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">se200pci_control</span> <span class="n">se200pci_cont</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Front Playback Volume&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">WM8776out</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">VOLUME1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s">&quot;Front(green)&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Side Playback Volume&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">WM8766</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">VOLUME1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ch</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s">&quot;Surround(orange)&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Surround Playback Volume&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">WM8766</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">VOLUME1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ch</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s">&quot;SurroundBack(white)&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;CLFE Playback Volume&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">WM8766</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">VOLUME1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ch</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s">&quot;Center(Lch)&amp;SubWoofer(Rch)(black)&quot;</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Volume&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">WM8776in</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">VOLUME2</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Capture Select&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">WM8776sel</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ENUM</span><span class="p">,</span>
		<span class="p">.</span><span class="n">member</span> <span class="o">=</span> <span class="n">se200pci_sel</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AGC Capture Mode&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">WM8776agc</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">ENUM</span><span class="p">,</span>
		<span class="p">.</span><span class="n">member</span> <span class="o">=</span> <span class="n">se200pci_agc</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;AFL Bypass Playback Switch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">target</span> <span class="o">=</span> <span class="n">WM8776afl</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">BOOLEAN</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">se200pci_get_enum_count</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">member</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">c</span><span class="p">;</span>

	<span class="n">member</span> <span class="o">=</span> <span class="n">se200pci_cont</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">member</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">member</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">member</span><span class="p">[</span><span class="n">c</span><span class="p">];</span> <span class="n">c</span><span class="o">++</span><span class="p">)</span>
		<span class="p">;</span>
	<span class="k">return</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">se200pci_cont_volume_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kc</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_INTEGER</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* mute */</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span> <span class="cm">/* 0dB */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define se200pci_cont_boolean_info	snd_ctl_boolean_mono_info</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">se200pci_cont_enum_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kc</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_ctl_elem_info</span> <span class="o">*</span><span class="n">uinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>

	<span class="n">n</span> <span class="o">=</span> <span class="n">kc</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="n">c</span> <span class="o">=</span> <span class="n">se200pci_get_enum_count</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">c</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_TYPE_ENUMERATED</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">&gt;=</span> <span class="n">c</span><span class="p">)</span>
		<span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">name</span><span class="p">,</span>
	       <span class="n">se200pci_cont</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">member</span><span class="p">[</span><span class="n">uinfo</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">se200pci_cont_volume_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kc</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">uc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kc</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">se_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">kc</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="n">uc</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span><span class="p">;</span>
	<span class="n">uc</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch2</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">se200pci_cont_boolean_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kc</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">uc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kc</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">se_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">kc</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="n">uc</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">se200pci_cont_enum_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kc</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">uc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kc</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">se_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">kc</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="n">uc</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">se200pci_cont_update</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">se_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">se200pci_cont</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">target</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">WM8766</span>:
		<span class="n">se200pci_WM8766_set_volume</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span>
					   <span class="n">se200pci_cont</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch</span><span class="p">,</span>
					   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span><span class="p">,</span>
					   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch2</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8776in</span>:
		<span class="n">se200pci_WM8776_set_input_volume</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span>
						 <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span><span class="p">,</span>
						 <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch2</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8776out</span>:
		<span class="n">se200pci_WM8776_set_output_volume</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span>
						  <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span><span class="p">,</span>
						  <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch2</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8776sel</span>:
		<span class="n">se200pci_WM8776_set_input_selector</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span>
						   <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8776agc</span>:
		<span class="n">se200pci_WM8776_set_agc</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8776afl</span>:
		<span class="n">se200pci_WM8776_set_afl</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">se200pci_cont_volume_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kc</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">uc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kc</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">se_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">kc</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vol1</span><span class="p">,</span> <span class="n">vol2</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">changed</span><span class="p">;</span>

	<span class="n">changed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">vol1</span> <span class="o">=</span> <span class="n">uc</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="n">vol2</span> <span class="o">=</span> <span class="n">uc</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span> <span class="o">!=</span> <span class="n">vol1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span> <span class="o">=</span> <span class="n">vol1</span><span class="p">;</span>
		<span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch2</span> <span class="o">!=</span> <span class="n">vol2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch2</span> <span class="o">=</span> <span class="n">vol2</span><span class="p">;</span>
		<span class="n">changed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">changed</span><span class="p">)</span>
		<span class="n">se200pci_cont_update</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">changed</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">se200pci_cont_boolean_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kc</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">uc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kc</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">se_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">kc</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vol1</span><span class="p">;</span>

	<span class="n">vol1</span> <span class="o">=</span> <span class="o">!!</span><span class="n">uc</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span> <span class="o">!=</span> <span class="n">vol1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span> <span class="o">=</span> <span class="n">vol1</span><span class="p">;</span>
		<span class="n">se200pci_cont_update</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">se200pci_cont_enum_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kc</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">uc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kc</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">se_spec</span> <span class="o">*</span><span class="n">spec</span> <span class="o">=</span> <span class="n">ice</span><span class="o">-&gt;</span><span class="n">spec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">kc</span><span class="o">-&gt;</span><span class="n">private_value</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vol1</span><span class="p">;</span>

	<span class="n">vol1</span> <span class="o">=</span> <span class="n">uc</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vol1</span> <span class="o">&gt;=</span> <span class="n">se200pci_get_enum_count</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span> <span class="o">!=</span> <span class="n">vol1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">spec</span><span class="o">-&gt;</span><span class="n">vol</span><span class="p">[</span><span class="n">n</span><span class="p">].</span><span class="n">ch1</span> <span class="o">=</span> <span class="n">vol1</span><span class="p">;</span>
		<span class="n">se200pci_cont_update</span><span class="p">(</span><span class="n">ice</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">db_scale_gain1</span><span class="p">,</span> <span class="o">-</span><span class="mi">12750</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">db_scale_gain2</span><span class="p">,</span> <span class="o">-</span><span class="mi">10350</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">se200pci_add_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">cont</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cont</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cont</span><span class="p">));</span>
	<span class="n">cont</span><span class="p">.</span><span class="n">iface</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_IFACE_MIXER</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">se200pci_cont</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cont</span><span class="p">.</span><span class="n">private_value</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
		<span class="n">cont</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">se200pci_cont</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">;</span>
		<span class="n">cont</span><span class="p">.</span><span class="n">access</span> <span class="o">=</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_READWRITE</span><span class="p">;</span>
		<span class="n">cont</span><span class="p">.</span><span class="n">tlv</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">se200pci_cont</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">VOLUME1</span>:
		<span class="k">case</span> <span class="n">VOLUME2</span>:
			<span class="n">cont</span><span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">se200pci_cont_volume_info</span><span class="p">;</span>
			<span class="n">cont</span><span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">se200pci_cont_volume_get</span><span class="p">;</span>
			<span class="n">cont</span><span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">se200pci_cont_volume_put</span><span class="p">;</span>
			<span class="n">cont</span><span class="p">.</span><span class="n">access</span> <span class="o">|=</span> <span class="n">SNDRV_CTL_ELEM_ACCESS_TLV_READ</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">se200pci_cont</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span> <span class="o">==</span> <span class="n">VOLUME1</span><span class="p">)</span>
				<span class="n">cont</span><span class="p">.</span><span class="n">tlv</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">db_scale_gain1</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">cont</span><span class="p">.</span><span class="n">tlv</span><span class="p">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">db_scale_gain2</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">BOOLEAN</span>:
			<span class="n">cont</span><span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">se200pci_cont_boolean_info</span><span class="p">;</span>
			<span class="n">cont</span><span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">se200pci_cont_boolean_get</span><span class="p">;</span>
			<span class="n">cont</span><span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">se200pci_cont_boolean_put</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">ENUM</span>:
			<span class="n">cont</span><span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="n">se200pci_cont_enum_info</span><span class="p">;</span>
			<span class="n">cont</span><span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">se200pci_cont_enum_get</span><span class="p">;</span>
			<span class="n">cont</span><span class="p">.</span><span class="n">put</span> <span class="o">=</span> <span class="n">se200pci_cont_enum_put</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">snd_BUG</span><span class="p">();</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">snd_ctl_add</span><span class="p">(</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">card</span><span class="p">,</span> <span class="n">snd_ctl_new1</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cont</span><span class="p">,</span> <span class="n">ice</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/****************************************************************************/</span>
<span class="cm">/*  ONKYO WAVIO SE-90PCI                                                    */</span>
<span class="cm">/****************************************************************************/</span>
<span class="cm">/*</span>
<span class="cm"> *  system configuration ICE_EEP2_SYSCONF=0x4b</span>
<span class="cm"> *  AC-Link configuration ICE_EEP2_ACLINK=0x80</span>
<span class="cm"> *  I2S converters feature ICE_EEP2_I2S=0x78</span>
<span class="cm"> *  S/PDIF configuration ICE_EEP2_SPDIF=0xc3</span>
<span class="cm"> *</span>
<span class="cm"> *  ** connected chip **</span>
<span class="cm"> *</span>
<span class="cm"> *   WM8716</span>
<span class="cm"> *      A 2ch-DAC of main outputs.</span>
<span class="cm"> *      It setuped as I2S mode by wire, so no way to setup from software.</span>
<span class="cm"> *         ML/I2S (28pin) -- +5V</span>
<span class="cm"> *         MC/DM1 (27pin) -- GND</span>
<span class="cm"> *         MC/DM0 (26pin) -- GND</span>
<span class="cm"> *         MUTEB  (25pin) -- open (internal pull-up)</span>
<span class="cm"> *         MODE   (24pin) -- GND</span>
<span class="cm"> *         CSBIWO (23pin) -- +5V</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

 <span class="cm">/* Nothing to do for this chip. */</span>


<span class="cm">/****************************************************************************/</span>
<span class="cm">/*  probe/initialize/setup                                                  */</span>
<span class="cm">/****************************************************************************/</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">se_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">se_spec</span> <span class="o">*</span><span class="n">spec</span><span class="p">;</span>

	<span class="n">spec</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">spec</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spec</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">ice</span><span class="o">-&gt;</span><span class="n">spec</span> <span class="o">=</span> <span class="n">spec</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">subvendor</span> <span class="o">==</span> <span class="n">VT1724_SUBDEVICE_SE90PCI</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">num_total_dacs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">num_total_adcs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">vt1720</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">subvendor</span> <span class="o">==</span> <span class="n">VT1724_SUBDEVICE_SE200PCI</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">num_total_dacs</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">num_total_adcs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">se200pci_WM8740_init</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
		<span class="n">se200pci_WM8766_init</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
		<span class="n">se200pci_WM8776_init</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>
		<span class="n">ice</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">set_pro_rate</span> <span class="o">=</span> <span class="n">se200pci_set_pro_rate</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">ENOENT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">se_add_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_ice1712</span> <span class="o">*</span><span class="n">ice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/* nothing to do for VT1724_SUBDEVICE_SE90PCI */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ice</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">subvendor</span> <span class="o">==</span> <span class="n">VT1724_SUBDEVICE_SE200PCI</span><span class="p">)</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">se200pci_add_controls</span><span class="p">(</span><span class="n">ice</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/****************************************************************************/</span>
<span class="cm">/*  entry point                                                             */</span>
<span class="cm">/****************************************************************************/</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">se200pci_eeprom</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">ICE_EEP2_SYSCONF</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x4b</span><span class="p">,</span>	<span class="cm">/* 49.152Hz, spdif-in/ADC, 4DACs */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_ACLINK</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>	<span class="cm">/* I2S */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_I2S</span><span class="p">]</span>		<span class="o">=</span> <span class="mh">0x78</span><span class="p">,</span>	<span class="cm">/* 96k-ok, 24bit, 192k-ok */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_SPDIF</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0xc3</span><span class="p">,</span>	<span class="cm">/* out-en, out-int, spdif-in */</span>

	<span class="p">[</span><span class="n">ICE_EEP2_GPIO_DIR</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span> <span class="cm">/* WM8766 mute      1=output */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_GPIO_DIR1</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* not used */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_GPIO_DIR2</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span> <span class="cm">/* WM8766 ML/MC/MD  1=output */</span>

	<span class="p">[</span><span class="n">ICE_EEP2_GPIO_MASK</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 0=writable */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_GPIO_MASK1</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 0=writable */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_GPIO_MASK2</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 0=writable */</span>

	<span class="p">[</span><span class="n">ICE_EEP2_GPIO_STATE</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* WM8766 mute=0 */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_GPIO_STATE1</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* not used */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_GPIO_STATE2</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span> <span class="cm">/* WM8766 ML/MC/MD */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">se90pci_eeprom</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">ICE_EEP2_SYSCONF</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x4b</span><span class="p">,</span>	<span class="cm">/* 49.152Hz, spdif-in/ADC, 4DACs */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_ACLINK</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>	<span class="cm">/* I2S */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_I2S</span><span class="p">]</span>		<span class="o">=</span> <span class="mh">0x78</span><span class="p">,</span>	<span class="cm">/* 96k-ok, 24bit, 192k-ok */</span>
	<span class="p">[</span><span class="n">ICE_EEP2_SPDIF</span><span class="p">]</span>	<span class="o">=</span> <span class="mh">0xc3</span><span class="p">,</span>	<span class="cm">/* out-en, out-int, spdif-in */</span>

	<span class="cm">/* ALL GPIO bits are in input mode */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">snd_ice1712_card_info</span> <span class="n">snd_vt1724_se_cards</span><span class="p">[]</span> <span class="n">__devinitdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">subvendor</span> <span class="o">=</span> <span class="n">VT1724_SUBDEVICE_SE200PCI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ONKYO SE200PCI&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="s">&quot;se200pci&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_init</span> <span class="o">=</span> <span class="n">se_init</span><span class="p">,</span>
		<span class="p">.</span><span class="n">build_controls</span> <span class="o">=</span> <span class="n">se_add_controls</span><span class="p">,</span>
		<span class="p">.</span><span class="n">eeprom_size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">se200pci_eeprom</span><span class="p">),</span>
		<span class="p">.</span><span class="n">eeprom_data</span> <span class="o">=</span> <span class="n">se200pci_eeprom</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">subvendor</span> <span class="o">=</span> <span class="n">VT1724_SUBDEVICE_SE90PCI</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ONKYO SE90PCI&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">model</span> <span class="o">=</span> <span class="s">&quot;se90pci&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">chip_init</span> <span class="o">=</span> <span class="n">se_init</span><span class="p">,</span>
		<span class="p">.</span><span class="n">build_controls</span> <span class="o">=</span> <span class="n">se_add_controls</span><span class="p">,</span>
		<span class="p">.</span><span class="n">eeprom_size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">se90pci_eeprom</span><span class="p">),</span>
		<span class="p">.</span><span class="n">eeprom_data</span> <span class="o">=</span> <span class="n">se90pci_eeprom</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{}</span> <span class="cm">/*terminator*/</span>
<span class="p">};</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
