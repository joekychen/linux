<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › oss › dmasound › dmasound.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>dmasound.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _dmasound_h_</span>
<span class="cm">/*</span>
<span class="cm"> *  linux/sound/oss/dmasound/dmasound.h</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> *  Minor numbers for the sound driver.</span>
<span class="cm"> *</span>
<span class="cm"> *  Unfortunately Creative called the codec chip of SB as a DSP. For this</span>
<span class="cm"> *  reason the /dev/dsp is reserved for digitized audio use. There is a</span>
<span class="cm"> *  device for true DSP processors but it will be called something else.</span>
<span class="cm"> *  In v3.0 it&#39;s /dev/sndproc but this could be a temporary solution.</span>
<span class="cm"> */</span>
<span class="cp">#define _dmasound_h_</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#define SND_NDEVS	256	</span><span class="cm">/* Number of supported devices */</span><span class="cp"></span>
<span class="cp">#define SND_DEV_CTL	0	</span><span class="cm">/* Control port /dev/mixer */</span><span class="cp"></span>
<span class="cp">#define SND_DEV_SEQ	1	</span><span class="cm">/* Sequencer output /dev/sequencer (FM</span>
<span class="cm">				   synthesizer and MIDI output) */</span><span class="cp"></span>
<span class="cp">#define SND_DEV_MIDIN	2	</span><span class="cm">/* Raw midi access */</span><span class="cp"></span>
<span class="cp">#define SND_DEV_DSP	3	</span><span class="cm">/* Digitized voice /dev/dsp */</span><span class="cp"></span>
<span class="cp">#define SND_DEV_AUDIO	4	</span><span class="cm">/* Sparc compatible /dev/audio */</span><span class="cp"></span>
<span class="cp">#define SND_DEV_DSP16	5	</span><span class="cm">/* Like /dev/dsp but 16 bits/sample */</span><span class="cp"></span>
<span class="cp">#define SND_DEV_STATUS	6	</span><span class="cm">/* /dev/sndstat */</span><span class="cp"></span>
<span class="cm">/* #7 not in use now. Was in 2.4. Free for use after v3.0. */</span>
<span class="cp">#define SND_DEV_SEQ2	8	</span><span class="cm">/* /dev/sequencer, level 2 interface */</span><span class="cp"></span>
<span class="cp">#define SND_DEV_SNDPROC 9	</span><span class="cm">/* /dev/sndproc for programmable devices */</span><span class="cp"></span>
<span class="cp">#define SND_DEV_PSS	SND_DEV_SNDPROC</span>

<span class="cm">/* switch on various prinks */</span>
<span class="cp">#define DEBUG_DMASOUND 1</span>

<span class="cp">#define MAX_AUDIO_DEV	5</span>
<span class="cp">#define MAX_MIXER_DEV	4</span>
<span class="cp">#define MAX_SYNTH_DEV	3</span>
<span class="cp">#define MAX_MIDI_DEV	6</span>
<span class="cp">#define MAX_TIMER_DEV	3</span>

<span class="cp">#define MAX_CATCH_RADIUS	10</span>

<span class="cp">#define le2be16(x)	(((x)&lt;&lt;8 &amp; 0xff00) | ((x)&gt;&gt;8 &amp; 0x00ff))</span>
<span class="cp">#define le2be16dbl(x)	(((x)&lt;&lt;8 &amp; 0xff00ff00) | ((x)&gt;&gt;8 &amp; 0x00ff00ff))</span>

<span class="cp">#define IOCTL_IN(arg, ret) \</span>
<span class="cp">	do { int error = get_user(ret, (int __user *)(arg)); \</span>
<span class="cp">		if (error) return error; \</span>
<span class="cp">	} while (0)</span>
<span class="cp">#define IOCTL_OUT(arg, ret)	ioctl_return((int __user *)(arg), ret)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">ioctl_return</span><span class="p">(</span><span class="kt">int</span> <span class="n">__user</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">value</span> <span class="o">:</span> <span class="n">put_user</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>


    <span class="cm">/*</span>
<span class="cm">     *  Configuration</span>
<span class="cm">     */</span>

<span class="cp">#undef HAS_8BIT_TABLES</span>

<span class="cp">#if defined(CONFIG_DMASOUND_ATARI) || defined(CONFIG_DMASOUND_ATARI_MODULE) ||\</span>
<span class="cp">    defined(CONFIG_DMASOUND_PAULA) || defined(CONFIG_DMASOUND_PAULA_MODULE) ||\</span>
<span class="cp">    defined(CONFIG_DMASOUND_Q40) || defined(CONFIG_DMASOUND_Q40_MODULE)</span>
<span class="cp">#define HAS_8BIT_TABLES</span>
<span class="cp">#define MIN_BUFFERS	4</span>
<span class="cp">#define MIN_BUFSIZE	(1&lt;&lt;12)	</span><span class="cm">/* in bytes (- where does this come from ?) */</span><span class="cp"></span>
<span class="cp">#define MIN_FRAG_SIZE	8	</span><span class="cm">/* not 100% sure about this */</span><span class="cp"></span>
<span class="cp">#define MAX_BUFSIZE	(1&lt;&lt;17)	</span><span class="cm">/* Limit for Amiga is 128 kb */</span><span class="cp"></span>
<span class="cp">#define MAX_FRAG_SIZE	15	</span><span class="cm">/* allow *4 for mono-8 =&gt; stereo-16 (for multi) */</span><span class="cp"></span>

<span class="cp">#else </span><span class="cm">/* is pmac and multi is off */</span><span class="cp"></span>

<span class="cp">#define MIN_BUFFERS	2</span>
<span class="cp">#define MIN_BUFSIZE	(1&lt;&lt;8)	</span><span class="cm">/* in bytes */</span><span class="cp"></span>
<span class="cp">#define MIN_FRAG_SIZE	8</span>
<span class="cp">#define MAX_BUFSIZE	(1&lt;&lt;18)	</span><span class="cm">/* this is somewhat arbitrary for pmac */</span><span class="cp"></span>
<span class="cp">#define MAX_FRAG_SIZE	16	</span><span class="cm">/* need to allow *4 for mono-8 =&gt; stereo-16 */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cp">#define DEFAULT_N_BUFFERS 4</span>
<span class="cp">#define DEFAULT_BUFF_SIZE (1&lt;&lt;15)</span>

    <span class="cm">/*</span>
<span class="cm">     *  Initialization</span>
<span class="cm">     */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">dmasound_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#ifdef MODULE</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">dmasound_deinit</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define dmasound_deinit()	do { } while (0)</span>
<span class="cp">#endif</span>

<span class="cm">/* description of the set-up applies to either hard or soft settings */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">format</span><span class="p">;</span>		<span class="cm">/* AFMT_* */</span>
    <span class="kt">int</span> <span class="n">stereo</span><span class="p">;</span>		<span class="cm">/* 0 = mono, 1 = stereo */</span>
    <span class="kt">int</span> <span class="n">size</span><span class="p">;</span>		<span class="cm">/* 8/16 bit*/</span>
    <span class="kt">int</span> <span class="n">speed</span><span class="p">;</span>		<span class="cm">/* speed */</span>
<span class="p">}</span> <span class="n">SETTINGS</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     *  Machine definitions</span>
<span class="cm">     */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name2</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="n">owner</span><span class="p">;</span>
    <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">dma_alloc</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">gfp_t</span><span class="p">);</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">dma_free</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">irqinit</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#ifdef MODULE</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">irqcleanup</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#endif</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">init</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">silence</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">setFormat</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">setVolume</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">setBass</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">setTreble</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">setGain</span><span class="p">)(</span><span class="kt">int</span><span class="p">);</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">play</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">record</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>		<span class="cm">/* optional */</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">mixer_init</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>		<span class="cm">/* optional */</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">mixer_ioctl</span><span class="p">)(</span><span class="n">u_int</span><span class="p">,</span> <span class="n">u_long</span><span class="p">);</span>	<span class="cm">/* optional */</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">write_sq_setup</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>	<span class="cm">/* optional */</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">read_sq_setup</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>		<span class="cm">/* optional */</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">sq_open</span><span class="p">)(</span><span class="n">fmode_t</span><span class="p">);</span>		<span class="cm">/* optional */</span>
    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">state_info</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">);</span>	<span class="cm">/* optional */</span>
    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">abort_read</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>		<span class="cm">/* optional */</span>
    <span class="kt">int</span> <span class="n">min_dsp_speed</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">max_dsp_speed</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">version</span> <span class="p">;</span>
    <span class="kt">int</span> <span class="n">hardware_afmts</span> <span class="p">;</span>		<span class="cm">/* OSS says we only return h&#39;ware info */</span>
					<span class="cm">/* when queried via SNDCTL_DSP_GETFMTS */</span>
    <span class="kt">int</span> <span class="n">capabilities</span> <span class="p">;</span>		<span class="cm">/* low-level reply to SNDCTL_DSP_GETCAPS */</span>
    <span class="n">SETTINGS</span> <span class="n">default_hard</span> <span class="p">;</span>	<span class="cm">/* open() or init() should set something valid */</span>
    <span class="n">SETTINGS</span> <span class="n">default_soft</span> <span class="p">;</span>	<span class="cm">/* you can make it look like old OSS, if you want to */</span>
<span class="p">}</span> <span class="n">MACHINE</span><span class="p">;</span>

    <span class="cm">/*</span>
<span class="cm">     *  Low level stuff</span>
<span class="cm">     */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">ct_ulaw</span><span class="p">)(</span><span class="k">const</span> <span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span><span class="p">);</span>
    <span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">ct_alaw</span><span class="p">)(</span><span class="k">const</span> <span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span><span class="p">);</span>
    <span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">ct_s8</span><span class="p">)(</span><span class="k">const</span> <span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span><span class="p">);</span>
    <span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">ct_u8</span><span class="p">)(</span><span class="k">const</span> <span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span><span class="p">);</span>
    <span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">ct_s16be</span><span class="p">)(</span><span class="k">const</span> <span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span><span class="p">);</span>
    <span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">ct_u16be</span><span class="p">)(</span><span class="k">const</span> <span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span><span class="p">);</span>
    <span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">ct_s16le</span><span class="p">)(</span><span class="k">const</span> <span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span><span class="p">);</span>
    <span class="kt">ssize_t</span> <span class="p">(</span><span class="o">*</span><span class="n">ct_u16le</span><span class="p">)(</span><span class="k">const</span> <span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">,</span> <span class="kt">size_t</span><span class="p">,</span> <span class="n">u_char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">ssize_t</span><span class="p">);</span>
<span class="p">}</span> <span class="n">TRANS</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">sound_settings</span> <span class="p">{</span>
    <span class="n">MACHINE</span> <span class="n">mach</span><span class="p">;</span>	<span class="cm">/* machine dependent things */</span>
    <span class="n">SETTINGS</span> <span class="n">hard</span><span class="p">;</span>	<span class="cm">/* hardware settings */</span>
    <span class="n">SETTINGS</span> <span class="n">soft</span><span class="p">;</span>	<span class="cm">/* software settings */</span>
    <span class="n">SETTINGS</span> <span class="n">dsp</span><span class="p">;</span>	<span class="cm">/* /dev/dsp default settings */</span>
    <span class="n">TRANS</span> <span class="o">*</span><span class="n">trans_write</span><span class="p">;</span>	<span class="cm">/* supported translations */</span>
    <span class="kt">int</span> <span class="n">volume_left</span><span class="p">;</span>	<span class="cm">/* volume (range is machine dependent) */</span>
    <span class="kt">int</span> <span class="n">volume_right</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">bass</span><span class="p">;</span>		<span class="cm">/* tone (range is machine dependent) */</span>
    <span class="kt">int</span> <span class="n">treble</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">gain</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">minDev</span><span class="p">;</span>		<span class="cm">/* minor device number currently open */</span>
    <span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">sound_settings</span> <span class="n">dmasound</span><span class="p">;</span>

<span class="cp">#ifdef HAS_8BIT_TABLES</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="n">dmasound_ulaw2dma8</span><span class="p">[];</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="n">dmasound_alaw2dma8</span><span class="p">[];</span>
<span class="cp">#endif</span>

    <span class="cm">/*</span>
<span class="cm">     *  Mid level stuff</span>
<span class="cm">     */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">dmasound_set_volume</span><span class="p">(</span><span class="kt">int</span> <span class="n">volume</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dmasound</span><span class="p">.</span><span class="n">mach</span><span class="p">.</span><span class="n">setVolume</span><span class="p">(</span><span class="n">volume</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">dmasound_set_bass</span><span class="p">(</span><span class="kt">int</span> <span class="n">bass</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dmasound</span><span class="p">.</span><span class="n">mach</span><span class="p">.</span><span class="n">setBass</span> <span class="o">?</span> <span class="n">dmasound</span><span class="p">.</span><span class="n">mach</span><span class="p">.</span><span class="n">setBass</span><span class="p">(</span><span class="n">bass</span><span class="p">)</span> <span class="o">:</span> <span class="mi">50</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">dmasound_set_treble</span><span class="p">(</span><span class="kt">int</span> <span class="n">treble</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dmasound</span><span class="p">.</span><span class="n">mach</span><span class="p">.</span><span class="n">setTreble</span> <span class="o">?</span> <span class="n">dmasound</span><span class="p">.</span><span class="n">mach</span><span class="p">.</span><span class="n">setTreble</span><span class="p">(</span><span class="n">treble</span><span class="p">)</span> <span class="o">:</span> <span class="mi">50</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">dmasound_set_gain</span><span class="p">(</span><span class="kt">int</span> <span class="n">gain</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dmasound</span><span class="p">.</span><span class="n">mach</span><span class="p">.</span><span class="n">setGain</span> <span class="o">?</span> <span class="n">dmasound</span><span class="p">.</span><span class="n">mach</span><span class="p">.</span><span class="n">setGain</span><span class="p">(</span><span class="n">gain</span><span class="p">)</span> <span class="o">:</span> <span class="mi">100</span><span class="p">;</span>
<span class="p">}</span>


    <span class="cm">/*</span>
<span class="cm">     * Sound queue stuff, the heart of the driver</span>
<span class="cm">     */</span>

<span class="k">struct</span> <span class="n">sound_queue</span> <span class="p">{</span>
    <span class="cm">/* buffers allocated for this queue */</span>
    <span class="kt">int</span> <span class="n">numBufs</span><span class="p">;</span>		<span class="cm">/* real limits on what the user can have */</span>
    <span class="kt">int</span> <span class="n">bufSize</span><span class="p">;</span>		<span class="cm">/* in bytes */</span>
    <span class="kt">char</span> <span class="o">**</span><span class="n">buffers</span><span class="p">;</span>

    <span class="cm">/* current parameters */</span>
    <span class="kt">int</span> <span class="n">locked</span> <span class="p">;</span>		<span class="cm">/* params cannot be modified when != 0 */</span>
    <span class="kt">int</span> <span class="n">user_frags</span> <span class="p">;</span>		<span class="cm">/* user requests this many */</span>
    <span class="kt">int</span> <span class="n">user_frag_size</span> <span class="p">;</span>	<span class="cm">/* of this size */</span>
    <span class="kt">int</span> <span class="n">max_count</span><span class="p">;</span>		<span class="cm">/* actual # fragments &lt;= numBufs */</span>
    <span class="kt">int</span> <span class="n">block_size</span><span class="p">;</span>		<span class="cm">/* internal block size in bytes */</span>
    <span class="kt">int</span> <span class="n">max_active</span><span class="p">;</span>		<span class="cm">/* in-use fragments &lt;= max_count */</span>

    <span class="cm">/* it shouldn&#39;t be necessary to declare any of these volatile */</span>
    <span class="kt">int</span> <span class="n">front</span><span class="p">,</span> <span class="n">rear</span><span class="p">,</span> <span class="n">count</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">rear_size</span><span class="p">;</span>
    <span class="cm">/*</span>
<span class="cm">     *	The use of the playing field depends on the hardware</span>
<span class="cm">     *</span>
<span class="cm">     *	Atari, PMac: The number of frames that are loaded/playing</span>
<span class="cm">     *</span>
<span class="cm">     *	Amiga: Bit 0 is set: a frame is loaded</span>
<span class="cm">     *	       Bit 1 is set: a frame is playing</span>
<span class="cm">     */</span>
    <span class="kt">int</span> <span class="n">active</span><span class="p">;</span>
    <span class="n">wait_queue_head_t</span> <span class="n">action_queue</span><span class="p">,</span> <span class="n">open_queue</span><span class="p">,</span> <span class="n">sync_queue</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">non_blocking</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">busy</span><span class="p">,</span> <span class="n">syncing</span><span class="p">,</span> <span class="n">xruns</span><span class="p">,</span> <span class="n">died</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SLEEP(queue)		interruptible_sleep_on_timeout(&amp;queue, HZ)</span>
<span class="cp">#define WAKE_UP(queue)		(wake_up_interruptible(&amp;queue))</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">sound_queue</span> <span class="n">dmasound_write_sq</span><span class="p">;</span>
<span class="cp">#define write_sq	dmasound_write_sq</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">dmasound_catchRadius</span><span class="p">;</span>
<span class="cp">#define catchRadius	dmasound_catchRadius</span>

<span class="cm">/* define the value to be put in the byte-swap reg in mac-io</span>
<span class="cm">   when we want it to swap for us.</span>
<span class="cm">*/</span>
<span class="cp">#define BS_VAL 1</span>

<span class="cp">#define SW_INPUT_VOLUME_SCALE	4</span>
<span class="cp">#define SW_INPUT_VOLUME_DEFAULT	(128 / SW_INPUT_VOLUME_SCALE)</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">expand_read_bal</span><span class="p">;</span>	<span class="cm">/* Balance factor for reading */</span>
<span class="k">extern</span> <span class="n">uint</span> <span class="n">software_input_volume</span><span class="p">;</span> <span class="cm">/* software implemented recording volume! */</span>

<span class="cp">#endif </span><span class="cm">/* _dmasound_h_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
