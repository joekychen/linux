<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › oss › sb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>sb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#define DSP_RESET	(devc-&gt;base + 0x6)</span>
<span class="cp">#define DSP_READ	(devc-&gt;base + 0xA)</span>
<span class="cp">#define DSP_WRITE	(devc-&gt;base + 0xC)</span>
<span class="cp">#define DSP_COMMAND	(devc-&gt;base + 0xC)</span>
<span class="cp">#define DSP_STATUS	(devc-&gt;base + 0xC)</span>
<span class="cp">#define DSP_DATA_AVAIL	(devc-&gt;base + 0xE)</span>
<span class="cp">#define DSP_DATA_AVL16	(devc-&gt;base + 0xF)</span>
<span class="cp">#define MIXER_ADDR	(devc-&gt;base + 0x4)</span>
<span class="cp">#define MIXER_DATA	(devc-&gt;base + 0x5)</span>
<span class="cp">#define OPL3_LEFT	(devc-&gt;base + 0x0)</span>
<span class="cp">#define OPL3_RIGHT	(devc-&gt;base + 0x2)</span>
<span class="cp">#define OPL3_BOTH	(devc-&gt;base + 0x8)</span>
<span class="cm">/* DSP Commands */</span>

<span class="cp">#define DSP_CMD_SPKON		0xD1</span>
<span class="cp">#define DSP_CMD_SPKOFF		0xD3</span>
<span class="cp">#define DSP_CMD_DMAON		0xD0</span>
<span class="cp">#define DSP_CMD_DMAOFF		0xD4</span>

<span class="cp">#define IMODE_NONE		0</span>
<span class="cp">#define IMODE_OUTPUT		PCM_ENABLE_OUTPUT</span>
<span class="cp">#define IMODE_INPUT		PCM_ENABLE_INPUT</span>
<span class="cp">#define IMODE_INIT		3</span>
<span class="cp">#define IMODE_MIDI		4</span>

<span class="cp">#define NORMAL_MIDI	0</span>
<span class="cp">#define UART_MIDI	1</span>


<span class="cm">/*</span>
<span class="cm"> * Device models</span>
<span class="cm"> */</span>
<span class="cp">#define MDL_NONE	0</span>
<span class="cp">#define MDL_SB1		1	</span><span class="cm">/* SB1.0 or 1.5 */</span><span class="cp"></span>
<span class="cp">#define MDL_SB2		2	</span><span class="cm">/* SB2.0 */</span><span class="cp"></span>
<span class="cp">#define MDL_SB201	3	</span><span class="cm">/* SB2.01 */</span><span class="cp"></span>
<span class="cp">#define MDL_SBPRO	4	</span><span class="cm">/* SB Pro */</span><span class="cp"></span>
<span class="cp">#define MDL_SB16	5	</span><span class="cm">/* SB16/32/AWE */</span><span class="cp"></span>
<span class="cp">#define MDL_SBPNP 	6	</span><span class="cm">/* SB16/32/AWE PnP */</span><span class="cp"></span>
<span class="cp">#define MDL_JAZZ	10	</span><span class="cm">/* Media Vision Jazz16 */</span><span class="cp"></span>
<span class="cp">#define MDL_SMW		11	</span><span class="cm">/* Logitech SoundMan Wave (Jazz16) */</span><span class="cp"></span>
<span class="cp">#define MDL_ESS		12	</span><span class="cm">/* ESS ES688 and ES1688 */</span><span class="cp"></span>
<span class="cp">#define MDL_AZTECH	13	</span><span class="cm">/* Aztech Sound Galaxy family */</span><span class="cp"></span>
<span class="cp">#define MDL_ES1868MIDI	14	</span><span class="cm">/* MIDI port of ESS1868 */</span><span class="cp"></span>
<span class="cp">#define MDL_AEDSP	15	</span><span class="cm">/* Audio Excel DSP 16 */</span><span class="cp"></span>
<span class="cp">#define MDL_ESSPCI	16	</span><span class="cm">/* ESS PCI card */</span><span class="cp"></span>
<span class="cp">#define MDL_YMPCI	17	</span><span class="cm">/* Yamaha PCI sb in emulation */</span><span class="cp"></span>

<span class="cp">#define SUBMDL_ALS007	42	</span><span class="cm">/* ALS-007 differs from SB16 only in mixer */</span><span class="cp"></span>
				<span class="cm">/* register assignment */</span>
<span class="cp">#define SUBMDL_ALS100	43	</span><span class="cm">/* ALS-100 allows sampling rates of up */</span><span class="cp"></span>
				<span class="cm">/* to 48kHz */</span>
				
<span class="cm">/*</span>
<span class="cm"> * Config flags</span>
<span class="cm"> */</span>
<span class="cp">#define SB_NO_MIDI	0x00000001</span>
<span class="cp">#define SB_NO_MIXER	0x00000002</span>
<span class="cp">#define SB_NO_AUDIO	0x00000004</span>
<span class="cp">#define SB_NO_RECORDING	0x00000008 </span><span class="cm">/* No audio recording */</span><span class="cp"></span>
<span class="cp">#define SB_MIDI_ONLY	(SB_NO_AUDIO|SB_NO_MIXER)</span>
<span class="cp">#define SB_PCI_IRQ	0x00000010 </span><span class="cm">/* PCI shared IRQ */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">mixer_def</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">regno</span><span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bitoffs</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nbits</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">mixer_def</span> <span class="n">mixer_tab</span><span class="p">[</span><span class="mi">32</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">mixer_def</span> <span class="n">mixer_ent</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">sb_module_options</span>
<span class="p">{</span>
	<span class="kt">int</span>  <span class="n">esstype</span><span class="p">;</span>	<span class="cm">/* ESS chip type */</span>
	<span class="kt">int</span>  <span class="n">acer</span><span class="p">;</span>	<span class="cm">/* Do acer notebook init? */</span>
	<span class="kt">int</span>  <span class="n">sm_games</span><span class="p">;</span>	<span class="cm">/* Logitech soundman games? */</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sb_devc</span> <span class="p">{</span>
	   <span class="kt">int</span> <span class="n">dev</span><span class="p">;</span>

	<span class="cm">/* Hardware parameters */</span>
	   <span class="kt">int</span> <span class="o">*</span><span class="n">osp</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">minor</span><span class="p">,</span> <span class="n">major</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">model</span><span class="p">,</span> <span class="n">submodel</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">caps</span><span class="p">;</span>
<span class="cp">#	define SBCAP_STEREO	0x00000001</span>
<span class="cp">#	define SBCAP_16BITS	0x00000002</span>

	<span class="cm">/* Hardware resources */</span>
	   <span class="kt">int</span> <span class="n">base</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">dma8</span><span class="p">,</span> <span class="n">dma16</span><span class="p">;</span>
	   
	   <span class="kt">int</span> <span class="n">pcibase</span><span class="p">;</span>		<span class="cm">/* For ESS Maestro etc */</span>

	<span class="cm">/* State variables */</span>
 	   <span class="kt">int</span> <span class="n">opened</span><span class="p">;</span>
	<span class="cm">/* new audio fields for full duplex support */</span>
	   <span class="kt">int</span> <span class="n">fullduplex</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">duplex</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">speed</span><span class="p">,</span> <span class="n">bits</span><span class="p">,</span> <span class="n">channels</span><span class="p">;</span>
	   <span class="k">volatile</span> <span class="kt">int</span> <span class="n">irq_ok</span><span class="p">;</span>
	   <span class="k">volatile</span> <span class="kt">int</span> <span class="n">intr_active</span><span class="p">,</span> <span class="n">irq_mode</span><span class="p">;</span>
	<span class="cm">/* duplicate audio fields for full duplex support */</span>
	   <span class="k">volatile</span> <span class="kt">int</span> <span class="n">intr_active_16</span><span class="p">,</span> <span class="n">irq_mode_16</span><span class="p">;</span>

	<span class="cm">/* Mixer fields */</span>
	   <span class="kt">int</span> <span class="o">*</span><span class="n">levels</span><span class="p">;</span>
	   <span class="n">mixer_tab</span> <span class="o">*</span><span class="n">iomap</span><span class="p">;</span>
	   <span class="kt">size_t</span> <span class="n">iomap_sz</span><span class="p">;</span> <span class="cm">/* number or records in the iomap table */</span>
	   <span class="kt">int</span> <span class="n">mixer_caps</span><span class="p">,</span> <span class="n">recmask</span><span class="p">,</span> <span class="n">outmask</span><span class="p">,</span> <span class="n">supported_devices</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">supported_rec_devices</span><span class="p">,</span> <span class="n">supported_out_devices</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">my_mixerdev</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">sbmixnum</span><span class="p">;</span>

	<span class="cm">/* Audio fields */</span>
	   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">trg_buf</span><span class="p">;</span>
	   <span class="kt">int</span>      <span class="n">trigger_bits</span><span class="p">;</span>
	   <span class="kt">int</span>      <span class="n">trg_bytes</span><span class="p">;</span>
	   <span class="kt">int</span>      <span class="n">trg_intrflag</span><span class="p">;</span>
	   <span class="kt">int</span>      <span class="n">trg_restart</span><span class="p">;</span>
	<span class="cm">/* duplicate audio fields for full duplex support */</span>
	   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">trg_buf_16</span><span class="p">;</span>
	   <span class="kt">int</span>      <span class="n">trigger_bits_16</span><span class="p">;</span>
	   <span class="kt">int</span>      <span class="n">trg_bytes_16</span><span class="p">;</span>
	   <span class="kt">int</span>      <span class="n">trg_intrflag_16</span><span class="p">;</span>
	   <span class="kt">int</span>      <span class="n">trg_restart_16</span><span class="p">;</span>

	   <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">tconst</span><span class="p">;</span>
	
	<span class="cm">/* MIDI fields */</span>
	   <span class="kt">int</span> <span class="n">my_mididev</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">input_opened</span><span class="p">;</span>
	   <span class="kt">int</span> <span class="n">midi_broken</span><span class="p">;</span>
	   <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">midi_input_intr</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span> <span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">data</span><span class="p">);</span>
	   <span class="kt">void</span> <span class="o">*</span><span class="n">midi_irq_cookie</span><span class="p">;</span>		<span class="cm">/* IRQ cookie for the midi */</span>

	   <span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>

	   <span class="k">struct</span> <span class="n">sb_module_options</span> <span class="n">sbmo</span><span class="p">;</span>	<span class="cm">/* Module options */</span>

	<span class="p">}</span> <span class="n">sb_devc</span><span class="p">;</span>
	
<span class="cm">/*</span>
<span class="cm"> *	PCI card types</span>
<span class="cm"> */</span>

<span class="cp">#define	SB_PCI_ESSMAESTRO	1	</span><span class="cm">/* ESS Maestro Legacy */</span><span class="cp"></span>
<span class="cp">#define	SB_PCI_YAMAHA		2	</span><span class="cm">/* Yamaha Legacy */</span><span class="cp"></span>

<span class="cm">/* </span>
<span class="cm"> *	Functions</span>
<span class="cm"> */</span>
 
<span class="kt">int</span> <span class="n">sb_dsp_command</span> <span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">sb_dsp_get_byte</span><span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span> <span class="n">devc</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">sb_dsp_reset</span> <span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">sb_setmixer</span> <span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sb_getmixer</span> <span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">port</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">sb_dsp_detect</span> <span class="p">(</span><span class="k">struct</span> <span class="n">address_info</span> <span class="o">*</span><span class="n">hw_config</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pci</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pciio</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sb_module_options</span> <span class="o">*</span><span class="n">sbmo</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">sb_dsp_init</span> <span class="p">(</span><span class="k">struct</span> <span class="n">address_info</span> <span class="o">*</span><span class="n">hw_config</span><span class="p">,</span> <span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="n">owner</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">sb_dsp_unload</span><span class="p">(</span><span class="k">struct</span> <span class="n">address_info</span> <span class="o">*</span><span class="n">hw_config</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sbmpu</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">sb_mixer_init</span><span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">,</span> <span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="n">owner</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">sb_mixer_unload</span><span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">sb_mixer_set_stereo</span> <span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">smw_mixer_init</span><span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">sb_dsp_midi_init</span> <span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">,</span> <span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="n">owner</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">sb_audio_init</span> <span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="n">owner</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">sb_midi_interrupt</span> <span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span><span class="n">devc</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">sb_chgmixer</span> <span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span> <span class="n">devc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">sb_common_mixer_set</span><span class="p">(</span><span class="n">sb_devc</span> <span class="o">*</span> <span class="n">devc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">left</span><span class="p">,</span> <span class="kt">int</span> <span class="n">right</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">sb_audio_open</span><span class="p">(</span><span class="kt">int</span> <span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">sb_audio_close</span><span class="p">(</span><span class="kt">int</span> <span class="n">dev</span><span class="p">);</span>

<span class="cm">/*	From sb_common.c */</span>
<span class="kt">void</span> <span class="n">sb_dsp_disable_midi</span><span class="p">(</span><span class="kt">int</span> <span class="n">port</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">probe_sbmpu</span> <span class="p">(</span><span class="k">struct</span> <span class="n">address_info</span> <span class="o">*</span><span class="n">hw_config</span><span class="p">,</span> <span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="n">owner</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">unload_sbmpu</span> <span class="p">(</span><span class="k">struct</span> <span class="n">address_info</span> <span class="o">*</span><span class="n">hw_config</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">unload_sb16</span><span class="p">(</span><span class="k">struct</span> <span class="n">address_info</span> <span class="o">*</span><span class="n">hw_info</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">unload_sb16midi</span><span class="p">(</span><span class="k">struct</span> <span class="n">address_info</span> <span class="o">*</span><span class="n">hw_info</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
