<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › soc › codecs › max98095.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>max98095.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * max98095.c -- MAX98095 ALSA SoC Audio driver</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2011 Maxim Integrated Products</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/moduleparam.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/pm.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;sound/core.h&gt;</span>
<span class="cp">#include &lt;sound/pcm.h&gt;</span>
<span class="cp">#include &lt;sound/pcm_params.h&gt;</span>
<span class="cp">#include &lt;sound/soc.h&gt;</span>
<span class="cp">#include &lt;sound/initval.h&gt;</span>
<span class="cp">#include &lt;sound/tlv.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;asm/div64.h&gt;</span>
<span class="cp">#include &lt;sound/max98095.h&gt;</span>
<span class="cp">#include &lt;sound/jack.h&gt;</span>
<span class="cp">#include &quot;max98095.h&quot;</span>

<span class="k">enum</span> <span class="n">max98095_type</span> <span class="p">{</span>
	<span class="n">MAX98095</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">eq_sel</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bq_sel</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">max98095_type</span> <span class="n">devtype</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_pdata</span> <span class="o">*</span><span class="n">pdata</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sysclk</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="n">dai</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">eq_texts</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">bq_texts</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">eq_enum</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">bq_enum</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">eq_textcnt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bq_textcnt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">lin_state</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mic1pre</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mic2pre</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_soc_jack</span> <span class="o">*</span><span class="n">headphone_jack</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_soc_jack</span> <span class="o">*</span><span class="n">mic_jack</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">max98095_reg_def</span><span class="p">[</span><span class="n">M98095_REG_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 00 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 01 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 02 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 03 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 04 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 05 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 06 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 07 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 08 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 09 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 0A */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 0B */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 0C */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 0D */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 0E */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 0F */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 10 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 11 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 12 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 13 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 14 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 15 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 16 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 17 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 18 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 19 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 1A */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 1B */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 1C */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 1D */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 1E */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 1F */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 20 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 21 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 22 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 23 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 24 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 25 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 26 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 27 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 28 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 29 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 2A */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 2B */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 2C */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 2D */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 2E */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 2F */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 30 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 31 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 32 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 33 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 34 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 35 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 36 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 37 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 38 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 39 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 3A */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 3B */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 3C */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 3D */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 3E */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 3F */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 40 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 41 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 42 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 43 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 44 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 45 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 46 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 47 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 48 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 49 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 4A */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 4B */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 4C */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 4D */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 4E */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 4F */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 50 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 51 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 52 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 53 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 54 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 55 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 56 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 57 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 58 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 59 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 5A */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 5B */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 5C */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 5D */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 5E */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 5F */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 60 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 61 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 62 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 63 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 64 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 65 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 66 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 67 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 68 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 69 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 6A */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 6B */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 6C */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 6D */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 6E */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 6F */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 70 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 71 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 72 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 73 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 74 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 75 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 76 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 77 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 78 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 79 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 7A */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 7B */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 7C */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 7D */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 7E */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 7F */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 80 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 81 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 82 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 83 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 84 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 85 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 86 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 87 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 88 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 89 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 8A */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 8B */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 8C */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 8D */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 8E */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 8F */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 90 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 91 */</span>
	<span class="mh">0x30</span><span class="p">,</span> <span class="cm">/* 92 */</span>
	<span class="mh">0xF0</span><span class="p">,</span> <span class="cm">/* 93 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 94 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 95 */</span>
	<span class="mh">0x3F</span><span class="p">,</span> <span class="cm">/* 96 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 97 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 98 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 99 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 9A */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 9B */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 9C */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 9D */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 9E */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* 9F */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* A0 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* A1 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* A2 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* A3 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* A4 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* A5 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* A6 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* A7 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* A8 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* A9 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* AA */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* AB */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* AC */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* AD */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* AE */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* AF */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* B0 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* B1 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* B2 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* B3 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* B4 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* B5 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* B6 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* B7 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* B8 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* B9 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* BA */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* BB */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* BC */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* BD */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* BE */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* BF */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* C0 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* C1 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* C2 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* C3 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* C4 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* C5 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* C6 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* C7 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* C8 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* C9 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* CA */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* CB */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* CC */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* CD */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* CE */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* CF */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* D0 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* D1 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* D2 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* D3 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* D4 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* D5 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* D6 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* D7 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* D8 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* D9 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* DA */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* DB */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* DC */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* DD */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* DE */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* DF */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* E0 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* E1 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* E2 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* E3 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* E4 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* E5 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* E6 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* E7 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* E8 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* E9 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* EA */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* EB */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* EC */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* ED */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* EE */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* EF */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* F0 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* F1 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* F2 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* F3 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* F4 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* F5 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* F6 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* F7 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* F8 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* F9 */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* FA */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* FB */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* FC */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* FD */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* FE */</span>
	<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* FF */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">readable</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">writable</span><span class="p">;</span>
<span class="p">}</span> <span class="n">max98095_access</span><span class="p">[</span><span class="n">M98095_REG_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 00 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 01 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 02 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 03 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 04 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 05 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 06 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 07 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 08 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 09 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 0A */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 0B */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 0C */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 0D */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 0E */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x9F</span> <span class="p">},</span> <span class="cm">/* 0F */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 10 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 11 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 12 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 13 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 14 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 15 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 16 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 17 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 18 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 19 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 1A */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 1B */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 1C */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 1D */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span> <span class="cm">/* 1E */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span> <span class="cm">/* 1F */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span> <span class="cm">/* 20 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span> <span class="cm">/* 21 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span> <span class="cm">/* 22 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span> <span class="cm">/* 23 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 24 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x7F</span> <span class="p">},</span> <span class="cm">/* 25 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x31</span> <span class="p">},</span> <span class="cm">/* 26 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 27 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 28 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 29 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xF7</span> <span class="p">},</span> <span class="cm">/* 2A */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x2F</span> <span class="p">},</span> <span class="cm">/* 2B */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xEF</span> <span class="p">},</span> <span class="cm">/* 2C */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 2D */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 2E */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 2F */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 30 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 31 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 32 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 33 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xF7</span> <span class="p">},</span> <span class="cm">/* 34 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x2F</span> <span class="p">},</span> <span class="cm">/* 35 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xCF</span> <span class="p">},</span> <span class="cm">/* 36 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 37 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 38 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 39 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 3A */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 3B */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 3C */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 3D */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xF7</span> <span class="p">},</span> <span class="cm">/* 3E */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x2F</span> <span class="p">},</span> <span class="cm">/* 3F */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xCF</span> <span class="p">},</span> <span class="cm">/* 40 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 41 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span> <span class="cm">/* 42 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 43 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 44 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 45 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 46 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 47 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 48 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x0F</span> <span class="p">},</span> <span class="cm">/* 49 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 4A */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 4B */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 4C */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 4D */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 4E */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 4F */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x7F</span> <span class="p">},</span> <span class="cm">/* 50 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x7F</span> <span class="p">},</span> <span class="cm">/* 51 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x0F</span> <span class="p">},</span> <span class="cm">/* 52 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 53 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 54 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 55 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 56 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 57 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xBF</span> <span class="p">},</span> <span class="cm">/* 58 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x1F</span> <span class="p">},</span> <span class="cm">/* 59 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xBF</span> <span class="p">},</span> <span class="cm">/* 5A */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x1F</span> <span class="p">},</span> <span class="cm">/* 5B */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xBF</span> <span class="p">},</span> <span class="cm">/* 5C */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 5D */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 5E */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x7F</span> <span class="p">},</span> <span class="cm">/* 5F */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x7F</span> <span class="p">},</span> <span class="cm">/* 60 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x47</span> <span class="p">},</span> <span class="cm">/* 61 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x9F</span> <span class="p">},</span> <span class="cm">/* 62 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x9F</span> <span class="p">},</span> <span class="cm">/* 63 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x9F</span> <span class="p">},</span> <span class="cm">/* 64 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x9F</span> <span class="p">},</span> <span class="cm">/* 65 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x9F</span> <span class="p">},</span> <span class="cm">/* 66 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xBF</span> <span class="p">},</span> <span class="cm">/* 67 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xBF</span> <span class="p">},</span> <span class="cm">/* 68 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 69 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 6A */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x7F</span> <span class="p">},</span> <span class="cm">/* 6B */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xF7</span> <span class="p">},</span> <span class="cm">/* 6C */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 6D */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 6E */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x1F</span> <span class="p">},</span> <span class="cm">/* 6F */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xF7</span> <span class="p">},</span> <span class="cm">/* 70 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 71 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 72 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x1F</span> <span class="p">},</span> <span class="cm">/* 73 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xF7</span> <span class="p">},</span> <span class="cm">/* 74 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 75 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 76 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x1F</span> <span class="p">},</span> <span class="cm">/* 77 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xF7</span> <span class="p">},</span> <span class="cm">/* 78 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 79 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 7A */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x1F</span> <span class="p">},</span> <span class="cm">/* 7B */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xF7</span> <span class="p">},</span> <span class="cm">/* 7C */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 7D */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 7E */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x1F</span> <span class="p">},</span> <span class="cm">/* 7F */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xF7</span> <span class="p">},</span> <span class="cm">/* 80 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 81 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 82 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x1F</span> <span class="p">},</span> <span class="cm">/* 83 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x7F</span> <span class="p">},</span> <span class="cm">/* 84 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x0F</span> <span class="p">},</span> <span class="cm">/* 85 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xD8</span> <span class="p">},</span> <span class="cm">/* 86 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 87 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xEF</span> <span class="p">},</span> <span class="cm">/* 88 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFE</span> <span class="p">},</span> <span class="cm">/* 89 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFE</span> <span class="p">},</span> <span class="cm">/* 8A */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 8B */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 8C */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 8D */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 8E */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 8F */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x8F</span> <span class="p">},</span> <span class="cm">/* 90 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 91 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 92 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 93 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0xFF</span> <span class="p">},</span> <span class="cm">/* 94 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x0F</span> <span class="p">},</span> <span class="cm">/* 95 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span> <span class="p">},</span> <span class="cm">/* 96 */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x8C</span> <span class="p">},</span> <span class="cm">/* 97 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 98 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 99 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 9A */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 9B */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 9C */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 9D */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 9E */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* 9F */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* A0 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* A1 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* A2 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* A3 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* A4 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* A5 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* A6 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* A7 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* A8 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* A9 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* AA */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* AB */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* AC */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* AD */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* AE */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* AF */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* B0 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* B1 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* B2 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* B3 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* B4 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* B5 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* B6 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* B7 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* B8 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* B9 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* BA */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* BB */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* BC */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* BD */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* BE */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* BF */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* C0 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* C1 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* C2 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* C3 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* C4 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* C5 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* C6 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* C7 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* C8 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* C9 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* CA */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* CB */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* CC */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* CD */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* CE */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* CF */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* D0 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* D1 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* D2 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* D3 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* D4 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* D5 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* D6 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* D7 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* D8 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* D9 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* DA */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* DB */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* DC */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* DD */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* DE */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* DF */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* E0 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* E1 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* E2 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* E3 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* E4 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* E5 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* E6 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* E7 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* E8 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* E9 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* EA */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* EB */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* EC */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* ED */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* EE */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* EF */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* F0 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* F1 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* F2 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* F3 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* F4 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* F5 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* F6 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* F7 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* F8 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* F9 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* FA */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* FB */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* FC */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* FD */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* FE */</span>
	<span class="p">{</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* FF */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_readable</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&gt;=</span> <span class="n">M98095_REG_CNT</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">max98095_access</span><span class="p">[</span><span class="n">reg</span><span class="p">].</span><span class="n">readable</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_volatile</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&gt;</span> <span class="n">M98095_REG_MAX_CACHED</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">M98095_000_HOST_DATA</span>:
	<span class="k">case</span> <span class="n">M98095_001_HOST_INT_STS</span>:
	<span class="k">case</span> <span class="n">M98095_002_HOST_RSP_STS</span>:
	<span class="k">case</span> <span class="n">M98095_003_HOST_CMD_STS</span>:
	<span class="k">case</span> <span class="n">M98095_004_CODEC_STS</span>:
	<span class="k">case</span> <span class="n">M98095_005_DAI1_ALC_STS</span>:
	<span class="k">case</span> <span class="n">M98095_006_DAI2_ALC_STS</span>:
	<span class="k">case</span> <span class="n">M98095_007_JACK_AUTO_STS</span>:
	<span class="k">case</span> <span class="n">M98095_008_JACK_MANUAL_STS</span>:
	<span class="k">case</span> <span class="n">M98095_009_JACK_VBAT_STS</span>:
	<span class="k">case</span> <span class="n">M98095_00A_ACC_ADC_STS</span>:
	<span class="k">case</span> <span class="n">M98095_00B_MIC_NG_AGC_STS</span>:
	<span class="k">case</span> <span class="n">M98095_00C_SPK_L_VOLT_STS</span>:
	<span class="k">case</span> <span class="n">M98095_00D_SPK_R_VOLT_STS</span>:
	<span class="k">case</span> <span class="n">M98095_00E_TEMP_SENSOR_STS</span>:
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Filter coefficients are in a separate register segment</span>
<span class="cm"> * and they share the address space of the normal registers.</span>
<span class="cm"> * The coefficient registers do not need or share the cache.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_hw_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span>
			     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">cache_bypass</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">cache_bypass</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">ret</span> <span class="o">?</span> <span class="o">-</span><span class="n">EIO</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Load equalizer DSP coefficient configurations registers</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">m98095_eq_band</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dai</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">band</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">coefs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">eq_reg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">band</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">dai</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Load the base register address */</span>
	<span class="n">eq_reg</span> <span class="o">=</span> <span class="n">dai</span> <span class="o">?</span> <span class="n">M98095_142_DAI2_EQ_BASE</span> <span class="o">:</span> <span class="n">M98095_110_DAI1_EQ_BASE</span><span class="p">;</span>

	<span class="cm">/* Add the band address offset, note adjustment for word address */</span>
	<span class="n">eq_reg</span> <span class="o">+=</span> <span class="n">band</span> <span class="o">*</span> <span class="p">(</span><span class="n">M98095_COEFS_PER_BAND</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Step through the registers and coefs */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">M98095_COEFS_PER_BAND</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">max98095_hw_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">eq_reg</span><span class="o">++</span><span class="p">,</span> <span class="n">M98095_BYTE1</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
		<span class="n">max98095_hw_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">eq_reg</span><span class="o">++</span><span class="p">,</span> <span class="n">M98095_BYTE0</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Load biquad filter coefficient configurations registers</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">m98095_biquad_band</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dai</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">band</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">coefs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bq_reg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">band</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">dai</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Load the base register address */</span>
	<span class="n">bq_reg</span> <span class="o">=</span> <span class="n">dai</span> <span class="o">?</span> <span class="n">M98095_17E_DAI2_BQ_BASE</span> <span class="o">:</span> <span class="n">M98095_174_DAI1_BQ_BASE</span><span class="p">;</span>

	<span class="cm">/* Add the band address offset, note adjustment for word address */</span>
	<span class="n">bq_reg</span> <span class="o">+=</span> <span class="n">band</span> <span class="o">*</span> <span class="p">(</span><span class="n">M98095_COEFS_PER_BAND</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Step through the registers and coefs */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">M98095_COEFS_PER_BAND</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">max98095_hw_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">bq_reg</span><span class="o">++</span><span class="p">,</span> <span class="n">M98095_BYTE1</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
		<span class="n">max98095_hw_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">bq_reg</span><span class="o">++</span><span class="p">,</span> <span class="n">M98095_BYTE0</span><span class="p">(</span><span class="n">coefs</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">max98095_fltr_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Voice&quot;</span><span class="p">,</span> <span class="s">&quot;Music&quot;</span> <span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">max98095_dai1_filter_mode_enum</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">M98095_02E_DAI1_FILTERS</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max98095_fltr_mode</span><span class="p">),</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">max98095_dai2_filter_mode_enum</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">M98095_038_DAI2_FILTERS</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max98095_fltr_mode</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">max98095_extmic_text</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;None&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2&quot;</span> <span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">max98095_extmic_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">M98095_087_CFG_MIC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">max98095_extmic_text</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_extmic_mux</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;External MIC Mux&quot;</span><span class="p">,</span> <span class="n">max98095_extmic_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">max98095_linein_text</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;INA&quot;</span><span class="p">,</span> <span class="s">&quot;INB&quot;</span> <span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">max98095_linein_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">M98095_086_CFG_LINE</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max98095_linein_text</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_linein_mux</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Linein Input Mux&quot;</span><span class="p">,</span> <span class="n">max98095_linein_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">max98095_line_mode_text</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Stereo&quot;</span><span class="p">,</span> <span class="s">&quot;Differential&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">max98095_linein_mode_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">M98095_086_CFG_LINE</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max98095_line_mode_text</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">max98095_lineout_mode_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">M98095_086_CFG_LINE</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">max98095_line_mode_text</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">max98095_dai_fltr</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Off&quot;</span><span class="p">,</span> <span class="s">&quot;Elliptical-HPF-16k&quot;</span><span class="p">,</span> <span class="s">&quot;Butterworth-HPF-16k&quot;</span><span class="p">,</span>
	<span class="s">&quot;Elliptical-HPF-8k&quot;</span><span class="p">,</span> <span class="s">&quot;Butterworth-HPF-8k&quot;</span><span class="p">,</span> <span class="s">&quot;Butterworth-HPF-Fs/240&quot;</span><span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">max98095_dai1_dac_filter_enum</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">M98095_02E_DAI1_FILTERS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">max98095_dai_fltr</span><span class="p">),</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">max98095_dai2_dac_filter_enum</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">M98095_038_DAI2_FILTERS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">max98095_dai_fltr</span><span class="p">),</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">max98095_dai3_dac_filter_enum</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">M98095_042_DAI3_FILTERS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">max98095_dai_fltr</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_mic1pre_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sel</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic1pre</span> <span class="o">=</span> <span class="n">sel</span><span class="p">;</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_05F_LVL_MIC1</span><span class="p">,</span> <span class="n">M98095_MICPRE_MASK</span><span class="p">,</span>
		<span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sel</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">M98095_MICPRE_SHIFT</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_mic1pre_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic1pre</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_mic2pre_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sel</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic2pre</span> <span class="o">=</span> <span class="n">sel</span><span class="p">;</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_060_LVL_MIC2</span><span class="p">,</span> <span class="n">M98095_MICPRE_MASK</span><span class="p">,</span>
		<span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">sel</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">M98095_MICPRE_SHIFT</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_mic2pre_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic2pre</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max98095_micboost_tlv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">TLV_DB_RANGE_HEAD</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">max98095_mic_tlv</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">max98095_adc_tlv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">max98095_adcboost_tlv</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max98095_hp_tlv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">TLV_DB_RANGE_HEAD</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">6700</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">1700</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">400</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">28</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max98095_spk_tlv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">TLV_DB_RANGE_HEAD</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">5900</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">11</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">1700</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">19</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">200</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">28</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">650</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max98095_rcv_lout_tlv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">TLV_DB_RANGE_HEAD</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">6200</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">7</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">3500</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">15</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">1200</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">28</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">650</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max98095_lin_tlv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">TLV_DB_RANGE_HEAD</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="o">-</span><span class="mi">600</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">1100</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">1400</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_snd_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="n">SOC_DOUBLE_R_TLV</span><span class="p">(</span><span class="s">&quot;Headphone Volume&quot;</span><span class="p">,</span> <span class="n">M98095_064_LVL_HP_L</span><span class="p">,</span>
		<span class="n">M98095_065_LVL_HP_R</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max98095_hp_tlv</span><span class="p">),</span>

	<span class="n">SOC_DOUBLE_R_TLV</span><span class="p">(</span><span class="s">&quot;Speaker Volume&quot;</span><span class="p">,</span> <span class="n">M98095_067_LVL_SPK_L</span><span class="p">,</span>
		<span class="n">M98095_068_LVL_SPK_R</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max98095_spk_tlv</span><span class="p">),</span>

	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;Receiver Volume&quot;</span><span class="p">,</span> <span class="n">M98095_066_LVL_RCV</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max98095_rcv_lout_tlv</span><span class="p">),</span>

	<span class="n">SOC_DOUBLE_R_TLV</span><span class="p">(</span><span class="s">&quot;Lineout Volume&quot;</span><span class="p">,</span> <span class="n">M98095_062_LVL_LINEOUT1</span><span class="p">,</span>
		<span class="n">M98095_063_LVL_LINEOUT2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max98095_rcv_lout_tlv</span><span class="p">),</span>

	<span class="n">SOC_DOUBLE_R</span><span class="p">(</span><span class="s">&quot;Headphone Switch&quot;</span><span class="p">,</span> <span class="n">M98095_064_LVL_HP_L</span><span class="p">,</span>
		<span class="n">M98095_065_LVL_HP_R</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">SOC_DOUBLE_R</span><span class="p">(</span><span class="s">&quot;Speaker Switch&quot;</span><span class="p">,</span> <span class="n">M98095_067_LVL_SPK_L</span><span class="p">,</span>
		<span class="n">M98095_068_LVL_SPK_R</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">SOC_SINGLE</span><span class="p">(</span><span class="s">&quot;Receiver Switch&quot;</span><span class="p">,</span> <span class="n">M98095_066_LVL_RCV</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">SOC_DOUBLE_R</span><span class="p">(</span><span class="s">&quot;Lineout Switch&quot;</span><span class="p">,</span> <span class="n">M98095_062_LVL_LINEOUT1</span><span class="p">,</span>
		<span class="n">M98095_063_LVL_LINEOUT2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;MIC1 Volume&quot;</span><span class="p">,</span> <span class="n">M98095_05F_LVL_MIC1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
		<span class="n">max98095_mic_tlv</span><span class="p">),</span>

	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;MIC2 Volume&quot;</span><span class="p">,</span> <span class="n">M98095_060_LVL_MIC2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
		<span class="n">max98095_mic_tlv</span><span class="p">),</span>

	<span class="n">SOC_SINGLE_EXT_TLV</span><span class="p">(</span><span class="s">&quot;MIC1 Boost Volume&quot;</span><span class="p">,</span>
			<span class="n">M98095_05F_LVL_MIC1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">max98095_mic1pre_get</span><span class="p">,</span> <span class="n">max98095_mic1pre_set</span><span class="p">,</span>
			<span class="n">max98095_micboost_tlv</span><span class="p">),</span>
	<span class="n">SOC_SINGLE_EXT_TLV</span><span class="p">(</span><span class="s">&quot;MIC2 Boost Volume&quot;</span><span class="p">,</span>
			<span class="n">M98095_060_LVL_MIC2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">max98095_mic2pre_get</span><span class="p">,</span> <span class="n">max98095_mic2pre_set</span><span class="p">,</span>
			<span class="n">max98095_micboost_tlv</span><span class="p">),</span>

	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;Linein Volume&quot;</span><span class="p">,</span> <span class="n">M98095_061_LVL_LINEIN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
		<span class="n">max98095_lin_tlv</span><span class="p">),</span>

	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;ADCL Volume&quot;</span><span class="p">,</span> <span class="n">M98095_05D_LVL_ADC_L</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
		<span class="n">max98095_adc_tlv</span><span class="p">),</span>
	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;ADCR Volume&quot;</span><span class="p">,</span> <span class="n">M98095_05E_LVL_ADC_R</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
		<span class="n">max98095_adc_tlv</span><span class="p">),</span>

	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;ADCL Boost Volume&quot;</span><span class="p">,</span> <span class="n">M98095_05D_LVL_ADC_L</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">max98095_adcboost_tlv</span><span class="p">),</span>
	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;ADCR Boost Volume&quot;</span><span class="p">,</span> <span class="n">M98095_05E_LVL_ADC_R</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">max98095_adcboost_tlv</span><span class="p">),</span>

	<span class="n">SOC_SINGLE</span><span class="p">(</span><span class="s">&quot;EQ1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_088_CFG_LEVEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_SINGLE</span><span class="p">(</span><span class="s">&quot;EQ2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_088_CFG_LEVEL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SOC_SINGLE</span><span class="p">(</span><span class="s">&quot;Biquad1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_088_CFG_LEVEL</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_SINGLE</span><span class="p">(</span><span class="s">&quot;Biquad2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_088_CFG_LEVEL</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;DAI1 Filter Mode&quot;</span><span class="p">,</span> <span class="n">max98095_dai1_filter_mode_enum</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;DAI2 Filter Mode&quot;</span><span class="p">,</span> <span class="n">max98095_dai2_filter_mode_enum</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;DAI1 DAC Filter&quot;</span><span class="p">,</span> <span class="n">max98095_dai1_dac_filter_enum</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;DAI2 DAC Filter&quot;</span><span class="p">,</span> <span class="n">max98095_dai2_dac_filter_enum</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;DAI3 DAC Filter&quot;</span><span class="p">,</span> <span class="n">max98095_dai3_dac_filter_enum</span><span class="p">),</span>

	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;Linein Mode&quot;</span><span class="p">,</span> <span class="n">max98095_linein_mode_enum</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;Lineout Mode&quot;</span><span class="p">,</span> <span class="n">max98095_lineout_mode_enum</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Left speaker mixer switch */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_left_speaker_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_050_MIX_SPK_LEFT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_050_MIX_SPK_LEFT</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Mono DAC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_050_MIX_SPK_LEFT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Mono DAC3 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_050_MIX_SPK_LEFT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_050_MIX_SPK_LEFT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_050_MIX_SPK_LEFT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_050_MIX_SPK_LEFT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_050_MIX_SPK_LEFT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Right speaker mixer switch */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_right_speaker_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_051_MIX_SPK_RIGHT</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_051_MIX_SPK_RIGHT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Mono DAC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_051_MIX_SPK_RIGHT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Mono DAC3 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_051_MIX_SPK_RIGHT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_051_MIX_SPK_RIGHT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_051_MIX_SPK_RIGHT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_051_MIX_SPK_RIGHT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_051_MIX_SPK_RIGHT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Left headphone mixer switch */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_left_hp_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04C_MIX_HP_LEFT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04C_MIX_HP_LEFT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04C_MIX_HP_LEFT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04C_MIX_HP_LEFT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04C_MIX_HP_LEFT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04C_MIX_HP_LEFT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Right headphone mixer switch */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_right_hp_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04D_MIX_HP_RIGHT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04D_MIX_HP_RIGHT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04D_MIX_HP_RIGHT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04D_MIX_HP_RIGHT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04D_MIX_HP_RIGHT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04D_MIX_HP_RIGHT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Receiver earpiece mixer switch */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_mono_rcv_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04F_MIX_RCV</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04F_MIX_RCV</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04F_MIX_RCV</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04F_MIX_RCV</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04F_MIX_RCV</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04F_MIX_RCV</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Left lineout mixer switch */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_left_lineout_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_053_MIX_LINEOUT1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_053_MIX_LINEOUT1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_053_MIX_LINEOUT1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_053_MIX_LINEOUT1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_053_MIX_LINEOUT1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_053_MIX_LINEOUT1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Right lineout mixer switch */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_right_lineout_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_054_MIX_LINEOUT2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_054_MIX_LINEOUT2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_054_MIX_LINEOUT2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_054_MIX_LINEOUT2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_054_MIX_LINEOUT2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_054_MIX_LINEOUT2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Left ADC mixer switch */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_left_ADC_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04A_MIX_ADC_LEFT</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04A_MIX_ADC_LEFT</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04A_MIX_ADC_LEFT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04A_MIX_ADC_LEFT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Right ADC mixer switch */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">max98095_right_ADC_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04B_MIX_ADC_RIGHT</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04B_MIX_ADC_RIGHT</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04B_MIX_ADC_RIGHT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="n">M98095_04B_MIX_ADC_RIGHT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_mic_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAPM_POST_PMU</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">==</span> <span class="n">M98095_05F_LVL_MIC1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">,</span> <span class="n">M98095_MICPRE_MASK</span><span class="p">,</span>
				<span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic1pre</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">M98095_MICPRE_SHIFT</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">,</span> <span class="n">M98095_MICPRE_MASK</span><span class="p">,</span>
				<span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic2pre</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="n">M98095_MICPRE_SHIFT</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAPM_POST_PMD</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">,</span> <span class="n">M98095_MICPRE_MASK</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * The line inputs are stereo inputs with the left and right</span>
<span class="cm"> * channels sharing a common PGA power control signal.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_line_pga</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">event</span><span class="p">,</span> <span class="n">u8</span> <span class="n">channel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">state</span><span class="p">;</span>

	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="p">((</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)));</span>

	<span class="n">state</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">lin_state</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAPM_POST_PMU</span>:
		<span class="o">*</span><span class="n">state</span> <span class="o">|=</span> <span class="n">channel</span><span class="p">;</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">,</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">shift</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">shift</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAPM_POST_PMD</span>:
		<span class="o">*</span><span class="n">state</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">channel</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">state</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">,</span>
				<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">shift</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_pga_in1_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">max98095_line_pga</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_pga_in2_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">max98095_line_pga</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * The stereo line out mixer outputs to two stereo line outs.</span>
<span class="cm"> * The 2nd pair has a separate set of enables.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_lineout_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAPM_POST_PMU</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">,</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">shift</span><span class="o">+</span><span class="mi">2</span><span class="p">)),</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">shift</span><span class="o">+</span><span class="mi">2</span><span class="p">)));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAPM_POST_PMD</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">,</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">shift</span><span class="o">+</span><span class="mi">2</span><span class="p">)),</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="n">max98095_dapm_widgets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="n">SND_SOC_DAPM_ADC</span><span class="p">(</span><span class="s">&quot;ADCL&quot;</span><span class="p">,</span> <span class="s">&quot;HiFi Capture&quot;</span><span class="p">,</span> <span class="n">M98095_090_PWR_EN_IN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_ADC</span><span class="p">(</span><span class="s">&quot;ADCR&quot;</span><span class="p">,</span> <span class="s">&quot;HiFi Capture&quot;</span><span class="p">,</span> <span class="n">M98095_090_PWR_EN_IN</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;DACL1&quot;</span><span class="p">,</span> <span class="s">&quot;HiFi Playback&quot;</span><span class="p">,</span>
		<span class="n">M98095_091_PWR_EN_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;DACR1&quot;</span><span class="p">,</span> <span class="s">&quot;HiFi Playback&quot;</span><span class="p">,</span>
		<span class="n">M98095_091_PWR_EN_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;DACM2&quot;</span><span class="p">,</span> <span class="s">&quot;Aux Playback&quot;</span><span class="p">,</span>
		<span class="n">M98095_091_PWR_EN_OUT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;DACM3&quot;</span><span class="p">,</span> <span class="s">&quot;Voice Playback&quot;</span><span class="p">,</span>
		<span class="n">M98095_091_PWR_EN_OUT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;HP Left Out&quot;</span><span class="p">,</span> <span class="n">M98095_091_PWR_EN_OUT</span><span class="p">,</span>
		<span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;HP Right Out&quot;</span><span class="p">,</span> <span class="n">M98095_091_PWR_EN_OUT</span><span class="p">,</span>
		<span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;SPK Left Out&quot;</span><span class="p">,</span> <span class="n">M98095_091_PWR_EN_OUT</span><span class="p">,</span>
		<span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;SPK Right Out&quot;</span><span class="p">,</span> <span class="n">M98095_091_PWR_EN_OUT</span><span class="p">,</span>
		<span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;RCV Mono Out&quot;</span><span class="p">,</span> <span class="n">M98095_091_PWR_EN_OUT</span><span class="p">,</span>
		<span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_PGA_E</span><span class="p">(</span><span class="s">&quot;LINE Left Out&quot;</span><span class="p">,</span> <span class="n">M98095_092_PWR_EN_OUT</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max98095_lineout_event</span><span class="p">,</span> <span class="n">SND_SOC_DAPM_PRE_PMD</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA_E</span><span class="p">(</span><span class="s">&quot;LINE Right Out&quot;</span><span class="p">,</span> <span class="n">M98095_092_PWR_EN_OUT</span><span class="p">,</span>
		<span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max98095_lineout_event</span><span class="p">,</span> <span class="n">SND_SOC_DAPM_PRE_PMD</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;External MIC&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">max98095_extmic_mux</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Linein Mux&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">max98095_linein_mux</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;Left Headphone Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">max98095_left_hp_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_left_hp_mixer_controls</span><span class="p">)),</span>

	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;Right Headphone Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">max98095_right_hp_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_right_hp_mixer_controls</span><span class="p">)),</span>

	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;Left Speaker Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">max98095_left_speaker_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_left_speaker_mixer_controls</span><span class="p">)),</span>

	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;Right Speaker Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">max98095_right_speaker_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_right_speaker_mixer_controls</span><span class="p">)),</span>

	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;Receiver Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	  <span class="o">&amp;</span><span class="n">max98095_mono_rcv_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_mono_rcv_mixer_controls</span><span class="p">)),</span>

	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;Left Lineout Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">max98095_left_lineout_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_left_lineout_mixer_controls</span><span class="p">)),</span>

	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;Right Lineout Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">max98095_right_lineout_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_right_lineout_mixer_controls</span><span class="p">)),</span>

	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;Left ADC Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">max98095_left_ADC_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_left_ADC_mixer_controls</span><span class="p">)),</span>

	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;Right ADC Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">max98095_right_ADC_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_right_ADC_mixer_controls</span><span class="p">)),</span>

	<span class="n">SND_SOC_DAPM_PGA_E</span><span class="p">(</span><span class="s">&quot;MIC1 Input&quot;</span><span class="p">,</span> <span class="n">M98095_05F_LVL_MIC1</span><span class="p">,</span>
		<span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max98095_mic_event</span><span class="p">,</span>
		<span class="n">SND_SOC_DAPM_POST_PMU</span> <span class="o">|</span> <span class="n">SND_SOC_DAPM_POST_PMD</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_PGA_E</span><span class="p">(</span><span class="s">&quot;MIC2 Input&quot;</span><span class="p">,</span> <span class="n">M98095_060_LVL_MIC2</span><span class="p">,</span>
		<span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max98095_mic_event</span><span class="p">,</span>
		<span class="n">SND_SOC_DAPM_POST_PMU</span> <span class="o">|</span> <span class="n">SND_SOC_DAPM_POST_PMD</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_PGA_E</span><span class="p">(</span><span class="s">&quot;IN1 Input&quot;</span><span class="p">,</span> <span class="n">M98095_090_PWR_EN_IN</span><span class="p">,</span>
		<span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max98095_pga_in1_event</span><span class="p">,</span>
		<span class="n">SND_SOC_DAPM_POST_PMU</span> <span class="o">|</span> <span class="n">SND_SOC_DAPM_POST_PMD</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_PGA_E</span><span class="p">(</span><span class="s">&quot;IN2 Input&quot;</span><span class="p">,</span> <span class="n">M98095_090_PWR_EN_IN</span><span class="p">,</span>
		<span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">max98095_pga_in2_event</span><span class="p">,</span>
		<span class="n">SND_SOC_DAPM_POST_PMU</span> <span class="o">|</span> <span class="n">SND_SOC_DAPM_POST_PMD</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_MICBIAS</span><span class="p">(</span><span class="s">&quot;MICBIAS1&quot;</span><span class="p">,</span> <span class="n">M98095_090_PWR_EN_IN</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MICBIAS</span><span class="p">(</span><span class="s">&quot;MICBIAS2&quot;</span><span class="p">,</span> <span class="n">M98095_090_PWR_EN_IN</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;HPL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;HPR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;SPKL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;SPKR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;RCV&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;OUT1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;OUT2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;OUT3&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;OUT4&quot;</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;MIC1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;MIC2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;INA1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;INA2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;INB1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;INB2&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dapm_route</span> <span class="n">max98095_audio_map</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Left headphone output mixer */</span>
	<span class="p">{</span><span class="s">&quot;Left Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACL1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACR1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Input&quot;</span><span class="p">},</span>

	<span class="cm">/* Right headphone output mixer */</span>
	<span class="p">{</span><span class="s">&quot;Right Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACL1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACR1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Headphone Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Input&quot;</span><span class="p">},</span>

	<span class="cm">/* Left speaker output mixer */</span>
	<span class="p">{</span><span class="s">&quot;Left Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACL1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACR1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Mono DAC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACM2&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Mono DAC3 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACM3&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Input&quot;</span><span class="p">},</span>

	<span class="cm">/* Right speaker output mixer */</span>
	<span class="p">{</span><span class="s">&quot;Right Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACL1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACR1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Mono DAC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACM2&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Mono DAC3 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACM3&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Speaker Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Input&quot;</span><span class="p">},</span>

	<span class="cm">/* Earpiece/Receiver output mixer */</span>
	<span class="p">{</span><span class="s">&quot;Receiver Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACL1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Receiver Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACR1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Receiver Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Receiver Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Receiver Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Receiver Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Input&quot;</span><span class="p">},</span>

	<span class="cm">/* Left Lineout output mixer */</span>
	<span class="p">{</span><span class="s">&quot;Left Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACL1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACR1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Input&quot;</span><span class="p">},</span>

	<span class="cm">/* Right lineout output mixer */</span>
	<span class="p">{</span><span class="s">&quot;Right Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACL1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;DACR1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right Lineout Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Input&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;HP Left Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Left Headphone Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;HP Right Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Right Headphone Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPK Left Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Left Speaker Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPK Right Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Right Speaker Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RCV Mono Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Receiver Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LINE Left Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Left Lineout Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LINE Right Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Right Lineout Mixer&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;HPL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;HP Left Out&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;HPR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;HP Right Out&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPKL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;SPK Left Out&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPKR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;SPK Right Out&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RCV&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;RCV Mono Out&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUT1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;LINE Left Out&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUT2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;LINE Right Out&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUT3&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;LINE Left Out&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUT4&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;LINE Right Out&quot;</span><span class="p">},</span>

	<span class="cm">/* Left ADC input mixer */</span>
	<span class="p">{</span><span class="s">&quot;Left ADC Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left ADC Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left ADC Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left ADC Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Input&quot;</span><span class="p">},</span>

	<span class="cm">/* Right ADC input mixer */</span>
	<span class="p">{</span><span class="s">&quot;Right ADC Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right ADC Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right ADC Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN1 Input&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right ADC Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Switch&quot;</span><span class="p">,</span> <span class="s">&quot;IN2 Input&quot;</span><span class="p">},</span>

	<span class="cm">/* Inputs */</span>
	<span class="p">{</span><span class="s">&quot;ADCL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Left ADC Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ADCR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Right ADC Mixer&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;IN1 Input&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;INA1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;IN2 Input&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;INA2&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;MIC1 Input&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MIC1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;MIC2 Input&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MIC2&quot;</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_add_widgets</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_add_codec_controls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">max98095_snd_controls</span><span class="p">,</span>
			     <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_snd_controls</span><span class="p">));</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* codec mclk clock divider coefficients */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">rate</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">sr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">rate_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">8000</span><span class="p">,</span>  <span class="mh">0x01</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">11025</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">16000</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">22050</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24000</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">32000</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">44100</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">48000</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">88200</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">96000</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rate_value</span><span class="p">(</span><span class="kt">int</span> <span class="n">rate</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rate_table</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rate_table</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rate</span> <span class="o">&gt;=</span> <span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
			<span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">rate_table</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">sr</span><span class="p">;</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">rate_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">sr</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_dai1_hw_params</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_pcm_hw_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ni</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">regval</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="n">rate</span> <span class="o">=</span> <span class="n">params_rate</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">params_format</span><span class="p">(</span><span class="n">params</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S16_LE</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_02A_DAI1_FORMAT</span><span class="p">,</span>
			<span class="n">M98095_DAI_WS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S24_LE</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_02A_DAI1_FORMAT</span><span class="p">,</span>
			<span class="n">M98095_DAI_WS</span><span class="p">,</span> <span class="n">M98095_DAI_WS</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rate_value</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regval</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_027_DAI1_CLKMODE</span><span class="p">,</span>
		<span class="n">M98095_CLKMODE_MASK</span><span class="p">,</span> <span class="n">regval</span><span class="p">);</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span>

	<span class="cm">/* Configure NI when operating as master */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_02A_DAI1_FORMAT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">M98095_DAI_MAS</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">sysclk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Invalid system clock frequency</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ni</span> <span class="o">=</span> <span class="mi">65536ULL</span> <span class="o">*</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;</span> <span class="mi">50000</span> <span class="o">?</span> <span class="mi">96ULL</span> <span class="o">:</span> <span class="mi">48ULL</span><span class="p">)</span>
				<span class="o">*</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span><span class="p">)</span><span class="n">rate</span><span class="p">;</span>
		<span class="n">do_div</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span><span class="p">)</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">sysclk</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_028_DAI1_CLKCFG_HI</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ni</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_029_DAI1_CLKCFG_LO</span><span class="p">,</span>
			<span class="n">ni</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Update sample rate mode */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;</span> <span class="mi">50000</span><span class="p">)</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_02E_DAI1_FILTERS</span><span class="p">,</span>
			<span class="n">M98095_DAI_DHF</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_02E_DAI1_FILTERS</span><span class="p">,</span>
			<span class="n">M98095_DAI_DHF</span><span class="p">,</span> <span class="n">M98095_DAI_DHF</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_dai2_hw_params</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_pcm_hw_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ni</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">regval</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

	<span class="n">rate</span> <span class="o">=</span> <span class="n">params_rate</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">params_format</span><span class="p">(</span><span class="n">params</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S16_LE</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_034_DAI2_FORMAT</span><span class="p">,</span>
			<span class="n">M98095_DAI_WS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S24_LE</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_034_DAI2_FORMAT</span><span class="p">,</span>
			<span class="n">M98095_DAI_WS</span><span class="p">,</span> <span class="n">M98095_DAI_WS</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rate_value</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regval</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_031_DAI2_CLKMODE</span><span class="p">,</span>
		<span class="n">M98095_CLKMODE_MASK</span><span class="p">,</span> <span class="n">regval</span><span class="p">);</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span>

	<span class="cm">/* Configure NI when operating as master */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_034_DAI2_FORMAT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">M98095_DAI_MAS</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">sysclk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Invalid system clock frequency</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ni</span> <span class="o">=</span> <span class="mi">65536ULL</span> <span class="o">*</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;</span> <span class="mi">50000</span> <span class="o">?</span> <span class="mi">96ULL</span> <span class="o">:</span> <span class="mi">48ULL</span><span class="p">)</span>
				<span class="o">*</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span><span class="p">)</span><span class="n">rate</span><span class="p">;</span>
		<span class="n">do_div</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span><span class="p">)</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">sysclk</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_032_DAI2_CLKCFG_HI</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ni</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_033_DAI2_CLKCFG_LO</span><span class="p">,</span>
			<span class="n">ni</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Update sample rate mode */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;</span> <span class="mi">50000</span><span class="p">)</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_038_DAI2_FILTERS</span><span class="p">,</span>
			<span class="n">M98095_DAI_DHF</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_038_DAI2_FILTERS</span><span class="p">,</span>
			<span class="n">M98095_DAI_DHF</span><span class="p">,</span> <span class="n">M98095_DAI_DHF</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_dai3_hw_params</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_pcm_hw_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ni</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">regval</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="n">rate</span> <span class="o">=</span> <span class="n">params_rate</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">params_format</span><span class="p">(</span><span class="n">params</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S16_LE</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_03E_DAI3_FORMAT</span><span class="p">,</span>
			<span class="n">M98095_DAI_WS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S24_LE</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_03E_DAI3_FORMAT</span><span class="p">,</span>
			<span class="n">M98095_DAI_WS</span><span class="p">,</span> <span class="n">M98095_DAI_WS</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rate_value</span><span class="p">(</span><span class="n">rate</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regval</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_03B_DAI3_CLKMODE</span><span class="p">,</span>
		<span class="n">M98095_CLKMODE_MASK</span><span class="p">,</span> <span class="n">regval</span><span class="p">);</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span>

	<span class="cm">/* Configure NI when operating as master */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_03E_DAI3_FORMAT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">M98095_DAI_MAS</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">sysclk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Invalid system clock frequency</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">ni</span> <span class="o">=</span> <span class="mi">65536ULL</span> <span class="o">*</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;</span> <span class="mi">50000</span> <span class="o">?</span> <span class="mi">96ULL</span> <span class="o">:</span> <span class="mi">48ULL</span><span class="p">)</span>
				<span class="o">*</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span><span class="p">)</span><span class="n">rate</span><span class="p">;</span>
		<span class="n">do_div</span><span class="p">(</span><span class="n">ni</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span><span class="p">)</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">sysclk</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_03C_DAI3_CLKCFG_HI</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ni</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7F</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_03D_DAI3_CLKCFG_LO</span><span class="p">,</span>
			<span class="n">ni</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Update sample rate mode */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">&lt;</span> <span class="mi">50000</span><span class="p">)</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_042_DAI3_FILTERS</span><span class="p">,</span>
			<span class="n">M98095_DAI_DHF</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_042_DAI3_FILTERS</span><span class="p">,</span>
			<span class="n">M98095_DAI_DHF</span><span class="p">,</span> <span class="n">M98095_DAI_DHF</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_dai_set_sysclk</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span>
				   <span class="kt">int</span> <span class="n">clk_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="cm">/* Requested clock frequency is already setup */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">freq</span> <span class="o">==</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">sysclk</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Setup clocks for slave mode, and using the PLL</span>
<span class="cm">	 * PSCLK = 0x01 (when master clk is 10MHz to 20MHz)</span>
<span class="cm">	 *         0x02 (when master clk is 20MHz to 40MHz)..</span>
<span class="cm">	 *         0x03 (when master clk is 40MHz to 60MHz)..</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="mi">10000000</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&lt;</span> <span class="mi">20000000</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_026_SYS_CLK</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="mi">20000000</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&lt;</span> <span class="mi">40000000</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_026_SYS_CLK</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="mi">40000000</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&lt;</span> <span class="mi">60000000</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_026_SYS_CLK</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Invalid master clock frequency</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">dai</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Clock source is %d at %uHz</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">clk_id</span><span class="p">,</span> <span class="n">freq</span><span class="p">);</span>

	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">sysclk</span> <span class="o">=</span> <span class="n">freq</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_dai1_set_fmt</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">codec_dai</span><span class="p">,</span>
				 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">codec_dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">regval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">!=</span> <span class="n">cdata</span><span class="o">-&gt;</span><span class="n">fmt</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_MASTER_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBS_CFS</span>:
			<span class="cm">/* Slave mode PLL */</span>
			<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_028_DAI1_CLKCFG_HI</span><span class="p">,</span>
				<span class="mh">0x80</span><span class="p">);</span>
			<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_029_DAI1_CLKCFG_LO</span><span class="p">,</span>
				<span class="mh">0x00</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFM</span>:
			<span class="cm">/* Set to master mode */</span>
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_MAS</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBS_CFM</span>:
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFS</span>:
		<span class="nl">default:</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Clock mode unsupported&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_FORMAT_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_I2S</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_DLY</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_LEFT_J</span>:
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_INV_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_NB_NF</span>:
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_NB_IF</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_WCI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_IB_NF</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_BCI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_IB_IF</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_BCI</span><span class="o">|</span><span class="n">M98095_DAI_WCI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_02A_DAI1_FORMAT</span><span class="p">,</span>
			<span class="n">M98095_DAI_MAS</span> <span class="o">|</span> <span class="n">M98095_DAI_DLY</span> <span class="o">|</span> <span class="n">M98095_DAI_BCI</span> <span class="o">|</span>
			<span class="n">M98095_DAI_WCI</span><span class="p">,</span> <span class="n">regval</span><span class="p">);</span>

		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_02B_DAI1_CLOCK</span><span class="p">,</span> <span class="n">M98095_DAI_BSEL64</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_dai2_set_fmt</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">codec_dai</span><span class="p">,</span>
				 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">codec_dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">regval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">!=</span> <span class="n">cdata</span><span class="o">-&gt;</span><span class="n">fmt</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_MASTER_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBS_CFS</span>:
			<span class="cm">/* Slave mode PLL */</span>
			<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_032_DAI2_CLKCFG_HI</span><span class="p">,</span>
				<span class="mh">0x80</span><span class="p">);</span>
			<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_033_DAI2_CLKCFG_LO</span><span class="p">,</span>
				<span class="mh">0x00</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFM</span>:
			<span class="cm">/* Set to master mode */</span>
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_MAS</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBS_CFM</span>:
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFS</span>:
		<span class="nl">default:</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Clock mode unsupported&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_FORMAT_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_I2S</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_DLY</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_LEFT_J</span>:
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_INV_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_NB_NF</span>:
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_NB_IF</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_WCI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_IB_NF</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_BCI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_IB_IF</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_BCI</span><span class="o">|</span><span class="n">M98095_DAI_WCI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_034_DAI2_FORMAT</span><span class="p">,</span>
			<span class="n">M98095_DAI_MAS</span> <span class="o">|</span> <span class="n">M98095_DAI_DLY</span> <span class="o">|</span> <span class="n">M98095_DAI_BCI</span> <span class="o">|</span>
			<span class="n">M98095_DAI_WCI</span><span class="p">,</span> <span class="n">regval</span><span class="p">);</span>

		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_035_DAI2_CLOCK</span><span class="p">,</span>
			<span class="n">M98095_DAI_BSEL64</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_dai3_set_fmt</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">codec_dai</span><span class="p">,</span>
				 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">codec_dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">regval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">!=</span> <span class="n">cdata</span><span class="o">-&gt;</span><span class="n">fmt</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">fmt</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_MASTER_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBS_CFS</span>:
			<span class="cm">/* Slave mode PLL */</span>
			<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_03C_DAI3_CLKCFG_HI</span><span class="p">,</span>
				<span class="mh">0x80</span><span class="p">);</span>
			<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_03D_DAI3_CLKCFG_LO</span><span class="p">,</span>
				<span class="mh">0x00</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFM</span>:
			<span class="cm">/* Set to master mode */</span>
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_MAS</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBS_CFM</span>:
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFS</span>:
		<span class="nl">default:</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Clock mode unsupported&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_FORMAT_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_I2S</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_DLY</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_LEFT_J</span>:
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_INV_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_NB_NF</span>:
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_NB_IF</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_WCI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_IB_NF</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_BCI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_IB_IF</span>:
			<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DAI_BCI</span><span class="o">|</span><span class="n">M98095_DAI_WCI</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_03E_DAI3_FORMAT</span><span class="p">,</span>
			<span class="n">M98095_DAI_MAS</span> <span class="o">|</span> <span class="n">M98095_DAI_DLY</span> <span class="o">|</span> <span class="n">M98095_DAI_BCI</span> <span class="o">|</span>
			<span class="n">M98095_DAI_WCI</span><span class="p">,</span> <span class="n">regval</span><span class="p">);</span>

		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_03F_DAI3_CLOCK</span><span class="p">,</span>
			<span class="n">M98095_DAI_BSEL64</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_set_bias_level</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				   <span class="k">enum</span> <span class="n">snd_soc_bias_level</span> <span class="n">level</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_BIAS_ON</span>:
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SND_SOC_BIAS_PREPARE</span>:
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SND_SOC_BIAS_STANDBY</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dapm</span><span class="p">.</span><span class="n">bias_level</span> <span class="o">==</span> <span class="n">SND_SOC_BIAS_OFF</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_cache_sync</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to sync cache: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
				<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_090_PWR_EN_IN</span><span class="p">,</span>
				<span class="n">M98095_MBEN</span><span class="p">,</span> <span class="n">M98095_MBEN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SND_SOC_BIAS_OFF</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_090_PWR_EN_IN</span><span class="p">,</span>
				<span class="n">M98095_MBEN</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">codec</span><span class="o">-&gt;</span><span class="n">cache_sync</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">dapm</span><span class="p">.</span><span class="n">bias_level</span> <span class="o">=</span> <span class="n">level</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define MAX98095_RATES SNDRV_PCM_RATE_8000_96000</span>
<span class="cp">#define MAX98095_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_S24_LE)</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">max98095_dai1_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">set_sysclk</span> <span class="o">=</span> <span class="n">max98095_dai_set_sysclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_fmt</span> <span class="o">=</span> <span class="n">max98095_dai1_set_fmt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hw_params</span> <span class="o">=</span> <span class="n">max98095_dai1_hw_params</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">max98095_dai2_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">set_sysclk</span> <span class="o">=</span> <span class="n">max98095_dai_set_sysclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_fmt</span> <span class="o">=</span> <span class="n">max98095_dai2_set_fmt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hw_params</span> <span class="o">=</span> <span class="n">max98095_dai2_hw_params</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">max98095_dai3_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">set_sysclk</span> <span class="o">=</span> <span class="n">max98095_dai_set_sysclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_fmt</span> <span class="o">=</span> <span class="n">max98095_dai3_set_fmt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hw_params</span> <span class="o">=</span> <span class="n">max98095_dai3_hw_params</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_dai_driver</span> <span class="n">max98095_dai</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;HiFi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;HiFi Playback&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">MAX98095_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">MAX98095_FORMATS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">capture</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;HiFi Capture&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">MAX98095_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">MAX98095_FORMATS</span><span class="p">,</span>
	<span class="p">},</span>
	 <span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095_dai1_ops</span><span class="p">,</span>
<span class="p">},</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Aux&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Aux Playback&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">MAX98095_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">MAX98095_FORMATS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095_dai2_ops</span><span class="p">,</span>
<span class="p">},</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Voice&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Voice Playback&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">MAX98095_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">MAX98095_FORMATS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095_dai3_ops</span><span class="p">,</span>
<span class="p">}</span>

<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_get_eq_channel</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;EQ1 Mode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;EQ2 Mode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_put_eq_enum</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_pdata</span> <span class="o">*</span><span class="n">pdata</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">max98095_get_eq_channel</span><span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sel</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">max98095_eq_cfg</span> <span class="o">*</span><span class="n">coef_set</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">fs</span><span class="p">,</span> <span class="n">best</span><span class="p">,</span> <span class="n">best_val</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">regmask</span><span class="p">,</span> <span class="n">regsave</span><span class="p">;</span>

	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">channel</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pdata</span> <span class="o">||</span> <span class="o">!</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_textcnt</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sel</span> <span class="o">&gt;=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfgcnt</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="n">channel</span><span class="p">];</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">eq_sel</span> <span class="o">=</span> <span class="n">sel</span><span class="p">;</span>
	<span class="n">fs</span> <span class="o">=</span> <span class="n">cdata</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">;</span>

	<span class="cm">/* Find the selected configuration with nearest sample rate */</span>
	<span class="n">best</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">best_val</span> <span class="o">=</span> <span class="n">INT_MAX</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfgcnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_texts</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
			<span class="n">abs</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rate</span> <span class="o">-</span> <span class="n">fs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">best_val</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">best</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="n">best_val</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rate</span> <span class="o">-</span> <span class="n">fs</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Selected %s/%dHz for %dHz sample rate</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfg</span><span class="p">[</span><span class="n">best</span><span class="p">].</span><span class="n">name</span><span class="p">,</span>
		<span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfg</span><span class="p">[</span><span class="n">best</span><span class="p">].</span><span class="n">rate</span><span class="p">,</span> <span class="n">fs</span><span class="p">);</span>

	<span class="n">coef_set</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfg</span><span class="p">[</span><span class="n">best</span><span class="p">];</span>

	<span class="n">regmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="n">M98095_EQ1EN</span> <span class="o">:</span> <span class="n">M98095_EQ2EN</span><span class="p">;</span>

	<span class="cm">/* Disable filter while configuring, and save current on/off state */</span>
	<span class="n">regsave</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_088_CFG_LEVEL</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_088_CFG_LEVEL</span><span class="p">,</span> <span class="n">regmask</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_00F_HOST_CFG</span><span class="p">,</span> <span class="n">M98095_SEG</span><span class="p">,</span> <span class="n">M98095_SEG</span><span class="p">);</span>
	<span class="n">m98095_eq_band</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">coef_set</span><span class="o">-&gt;</span><span class="n">band1</span><span class="p">);</span>
	<span class="n">m98095_eq_band</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">coef_set</span><span class="o">-&gt;</span><span class="n">band2</span><span class="p">);</span>
	<span class="n">m98095_eq_band</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">coef_set</span><span class="o">-&gt;</span><span class="n">band3</span><span class="p">);</span>
	<span class="n">m98095_eq_band</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">coef_set</span><span class="o">-&gt;</span><span class="n">band4</span><span class="p">);</span>
	<span class="n">m98095_eq_band</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">coef_set</span><span class="o">-&gt;</span><span class="n">band5</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_00F_HOST_CFG</span><span class="p">,</span> <span class="n">M98095_SEG</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>

	<span class="cm">/* Restore the original on/off state */</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_088_CFG_LEVEL</span><span class="p">,</span> <span class="n">regmask</span><span class="p">,</span> <span class="n">regsave</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_get_eq_enum</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">max98095_get_eq_channel</span><span class="p">(</span><span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="n">channel</span><span class="p">];</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdata</span><span class="o">-&gt;</span><span class="n">eq_sel</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">max98095_handle_eq_pdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_pdata</span> <span class="o">*</span><span class="n">pdata</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_eq_cfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cfgcnt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">t</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">SOC_ENUM_EXT</span><span class="p">(</span><span class="s">&quot;EQ1 Mode&quot;</span><span class="p">,</span>
			<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_enum</span><span class="p">,</span>
			<span class="n">max98095_get_eq_enum</span><span class="p">,</span>
			<span class="n">max98095_put_eq_enum</span><span class="p">),</span>
		<span class="n">SOC_ENUM_EXT</span><span class="p">(</span><span class="s">&quot;EQ2 Mode&quot;</span><span class="p">,</span>
			<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_enum</span><span class="p">,</span>
			<span class="n">max98095_get_eq_enum</span><span class="p">,</span>
			<span class="n">max98095_put_eq_enum</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">cfg</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfg</span><span class="p">;</span>
	<span class="n">cfgcnt</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfgcnt</span><span class="p">;</span>

	<span class="cm">/* Setup an array of texts for the equalizer enum.</span>
<span class="cm">	 * This is based on Mark Brown&#39;s equalizer driver code.</span>
<span class="cm">	 */</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_textcnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_texts</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfgcnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_textcnt</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_texts</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_textcnt</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="cm">/* Expand the array */</span>
		<span class="n">t</span> <span class="o">=</span> <span class="n">krealloc</span><span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_texts</span><span class="p">,</span>
			     <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_textcnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
			     <span class="n">GFP_KERNEL</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="cm">/* Store the new entry */</span>
		<span class="n">t</span><span class="p">[</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_textcnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">;</span>
		<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_textcnt</span><span class="o">++</span><span class="p">;</span>
		<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_texts</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Now point the soc_enum to .texts array items */</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_enum</span><span class="p">.</span><span class="n">texts</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_texts</span><span class="p">;</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_enum</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_textcnt</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_add_codec_controls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">controls</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">controls</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to add EQ control: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">bq_mode_name</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Biquad1 Mode&quot;</span><span class="p">,</span> <span class="s">&quot;Biquad2 Mode&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_get_bq_channel</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bq_mode_name</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">bq_mode_name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/* Shouldn&#39;t happen */</span>
	<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Bad biquad channel name &#39;%s&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_put_bq_enum</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_pdata</span> <span class="o">*</span><span class="n">pdata</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">max98095_get_bq_channel</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sel</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">max98095_biquad_cfg</span> <span class="o">*</span><span class="n">coef_set</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">fs</span><span class="p">,</span> <span class="n">best</span><span class="p">,</span> <span class="n">best_val</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">regmask</span><span class="p">,</span> <span class="n">regsave</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">channel</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pdata</span> <span class="o">||</span> <span class="o">!</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_textcnt</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sel</span> <span class="o">&gt;=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfgcnt</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="n">channel</span><span class="p">];</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">bq_sel</span> <span class="o">=</span> <span class="n">sel</span><span class="p">;</span>
	<span class="n">fs</span> <span class="o">=</span> <span class="n">cdata</span><span class="o">-&gt;</span><span class="n">rate</span><span class="p">;</span>

	<span class="cm">/* Find the selected configuration with nearest sample rate */</span>
	<span class="n">best</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">best_val</span> <span class="o">=</span> <span class="n">INT_MAX</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfgcnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_texts</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
			<span class="n">abs</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rate</span> <span class="o">-</span> <span class="n">fs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">best_val</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">best</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="n">best_val</span> <span class="o">=</span> <span class="n">abs</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rate</span> <span class="o">-</span> <span class="n">fs</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Selected %s/%dHz for %dHz sample rate</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfg</span><span class="p">[</span><span class="n">best</span><span class="p">].</span><span class="n">name</span><span class="p">,</span>
		<span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfg</span><span class="p">[</span><span class="n">best</span><span class="p">].</span><span class="n">rate</span><span class="p">,</span> <span class="n">fs</span><span class="p">);</span>

	<span class="n">coef_set</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfg</span><span class="p">[</span><span class="n">best</span><span class="p">];</span>

	<span class="n">regmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">channel</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="n">M98095_BQ1EN</span> <span class="o">:</span> <span class="n">M98095_BQ2EN</span><span class="p">;</span>

	<span class="cm">/* Disable filter while configuring, and save current on/off state */</span>
	<span class="n">regsave</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_088_CFG_LEVEL</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_088_CFG_LEVEL</span><span class="p">,</span> <span class="n">regmask</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_00F_HOST_CFG</span><span class="p">,</span> <span class="n">M98095_SEG</span><span class="p">,</span> <span class="n">M98095_SEG</span><span class="p">);</span>
	<span class="n">m98095_biquad_band</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">coef_set</span><span class="o">-&gt;</span><span class="n">band1</span><span class="p">);</span>
	<span class="n">m98095_biquad_band</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">channel</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">coef_set</span><span class="o">-&gt;</span><span class="n">band2</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_00F_HOST_CFG</span><span class="p">,</span> <span class="n">M98095_SEG</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">mutex</span><span class="p">);</span>

	<span class="cm">/* Restore the original on/off state */</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_088_CFG_LEVEL</span><span class="p">,</span> <span class="n">regmask</span><span class="p">,</span> <span class="n">regsave</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_get_bq_enum</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">channel</span> <span class="o">=</span> <span class="n">max98095_get_bq_channel</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">kcontrol</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">channel</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">channel</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="n">channel</span><span class="p">];</span>
	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">enumerated</span><span class="p">.</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cdata</span><span class="o">-&gt;</span><span class="n">bq_sel</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">max98095_handle_bq_pdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_pdata</span> <span class="o">*</span><span class="n">pdata</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_biquad_cfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cfgcnt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">t</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">SOC_ENUM_EXT</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">bq_mode_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_enum</span><span class="p">,</span>
			<span class="n">max98095_get_bq_enum</span><span class="p">,</span>
			<span class="n">max98095_put_bq_enum</span><span class="p">),</span>
		<span class="n">SOC_ENUM_EXT</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">bq_mode_name</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
			<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_enum</span><span class="p">,</span>
			<span class="n">max98095_get_bq_enum</span><span class="p">,</span>
			<span class="n">max98095_put_bq_enum</span><span class="p">),</span>
	<span class="p">};</span>
	<span class="n">BUILD_BUG_ON</span><span class="p">(</span><span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">controls</span><span class="p">)</span> <span class="o">!=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bq_mode_name</span><span class="p">));</span>

	<span class="n">cfg</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfg</span><span class="p">;</span>
	<span class="n">cfgcnt</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfgcnt</span><span class="p">;</span>

	<span class="cm">/* Setup an array of texts for the biquad enum.</span>
<span class="cm">	 * This is based on Mark Brown&#39;s equalizer driver code.</span>
<span class="cm">	 */</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_textcnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_texts</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cfgcnt</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_textcnt</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">cfg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_texts</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">!=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_textcnt</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="cm">/* Expand the array */</span>
		<span class="n">t</span> <span class="o">=</span> <span class="n">krealloc</span><span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_texts</span><span class="p">,</span>
			     <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_textcnt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
			     <span class="n">GFP_KERNEL</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">t</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="cm">/* Store the new entry */</span>
		<span class="n">t</span><span class="p">[</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_textcnt</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">;</span>
		<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_textcnt</span><span class="o">++</span><span class="p">;</span>
		<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_texts</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Now point the soc_enum to .texts array items */</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_enum</span><span class="p">.</span><span class="n">texts</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_texts</span><span class="p">;</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_enum</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_textcnt</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_add_codec_controls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">controls</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">controls</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to add Biquad control: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">max98095_handle_pdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_pdata</span> <span class="o">*</span><span class="n">pdata</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">regval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pdata</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_dbg</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;No platform data</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Configure mic for analog/digital mic mode */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">digmic_left_mode</span><span class="p">)</span>
		<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DIGMIC_L</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">digmic_right_mode</span><span class="p">)</span>
		<span class="n">regval</span> <span class="o">|=</span> <span class="n">M98095_DIGMIC_R</span><span class="p">;</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_087_CFG_MIC</span><span class="p">,</span> <span class="n">regval</span><span class="p">);</span>

	<span class="cm">/* Configure equalizers */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">eq_cfgcnt</span><span class="p">)</span>
		<span class="n">max98095_handle_eq_pdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="cm">/* Configure bi-quad filters */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">bq_cfgcnt</span><span class="p">)</span>
		<span class="n">max98095_handle_bq_pdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">irqreturn_t</span> <span class="nf">max98095_report_jack</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">hp_report</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mic_report</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Read the Jack Status Register */</span>
	<span class="n">value</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_007_JACK_AUTO_STS</span><span class="p">);</span>

	<span class="cm">/* If ddone is not set, then detection isn&#39;t finished yet */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">M98095_DDONE</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">IRQ_NONE</span><span class="p">;</span>

	<span class="cm">/* if hp, check its bit, and if set, clear it */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">M98095_HP_IN</span> <span class="o">||</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="n">M98095_LO_IN</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">headphone_jack</span><span class="p">)</span>
		<span class="n">hp_report</span> <span class="o">|=</span> <span class="n">SND_JACK_HEADPHONE</span><span class="p">;</span>

	<span class="cm">/* if mic, check its bit, and if set, clear it */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">M98095_MIC_IN</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic_jack</span><span class="p">)</span>
		<span class="n">mic_report</span> <span class="o">|=</span> <span class="n">SND_JACK_MICROPHONE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">headphone_jack</span> <span class="o">==</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic_jack</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_soc_jack_report</span><span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">headphone_jack</span><span class="p">,</span>
					<span class="n">hp_report</span> <span class="o">|</span> <span class="n">mic_report</span><span class="p">,</span>
					<span class="n">SND_JACK_HEADSET</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">headphone_jack</span><span class="p">)</span>
			<span class="n">snd_soc_jack_report</span><span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">headphone_jack</span><span class="p">,</span>
					<span class="n">hp_report</span><span class="p">,</span> <span class="n">SND_JACK_HEADPHONE</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic_jack</span><span class="p">)</span>
			<span class="n">snd_soc_jack_report</span><span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic_jack</span><span class="p">,</span>
					<span class="n">mic_report</span><span class="p">,</span> <span class="n">SND_JACK_MICROPHONE</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">IRQ_HANDLED</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">max98095_jack_detect_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">detect_enable</span> <span class="o">=</span> <span class="n">M98095_JDEN</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">slew</span> <span class="o">=</span> <span class="n">M98095_DEFAULT_SLEW_DELAY</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">jack_detect_pin5en</span><span class="p">)</span>
		<span class="n">detect_enable</span> <span class="o">|=</span> <span class="n">M98095_PIN5EN</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">jack_detect_delay</span><span class="p">)</span>
		<span class="n">slew</span> <span class="o">=</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">jack_detect_delay</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_08E_JACK_DC_SLEW</span><span class="p">,</span> <span class="n">slew</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to cfg auto detect %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* configure auto detection to be enabled */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_089_JACK_DET_AUTO</span><span class="p">,</span> <span class="n">detect_enable</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to cfg auto detect %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">max98095_jack_detect_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* configure auto detection to be disabled */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_089_JACK_DET_AUTO</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to cfg auto detect %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">max98095_jack_detect</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">snd_soc_jack</span> <span class="o">*</span><span class="n">hp_jack</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_soc_jack</span> <span class="o">*</span><span class="n">mic_jack</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">headphone_jack</span> <span class="o">=</span> <span class="n">hp_jack</span><span class="p">;</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic_jack</span> <span class="o">=</span> <span class="n">mic_jack</span><span class="p">;</span>

	<span class="cm">/* only progress if we have at least 1 jack pointer */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hp_jack</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">mic_jack</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">max98095_jack_detect_enable</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="cm">/* enable interrupts for headphone jack detection */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_013_JACK_INT_EN</span><span class="p">,</span>
		<span class="n">M98095_IDDONE</span><span class="p">,</span> <span class="n">M98095_IDDONE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to cfg jack irqs %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">max98095_report_jack</span><span class="p">(</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">,</span> <span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_PM</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">headphone_jack</span> <span class="o">||</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic_jack</span><span class="p">)</span>
		<span class="n">max98095_jack_detect_disable</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">max98095_set_bias_level</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SND_SOC_BIAS_OFF</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_resume</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">max98095_set_bias_level</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SND_SOC_BIAS_STANDBY</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">headphone_jack</span> <span class="o">||</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic_jack</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">max98095_jack_detect_enable</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
		<span class="n">max98095_report_jack</span><span class="p">(</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">,</span> <span class="n">codec</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="cp">#define max98095_suspend NULL</span>
<span class="cp">#define max98095_resume NULL</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>

	<span class="cm">/* Gracefully reset the DSP core and the codec hardware</span>
<span class="cm">	 * in a proper sequence */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_00F_HOST_CFG</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to reset DSP: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_097_PWR_SYS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to reset codec: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Reset to hardware default for registers, as there is not</span>
<span class="cm">	 * a soft reset hardware control register */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">M98095_010_HOST_INT_CFG</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">M98095_REG_MAX_CACHED</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">max98095_reg_def</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to reset: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">max98095_cdata</span> <span class="o">*</span><span class="n">cdata</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_codec_set_cache_io</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">SND_SOC_I2C</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to set cache I/O: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* reset the codec, the DSP core, and disable all interrupts */</span>
	<span class="n">max98095_reset</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* initialize private data */</span>

	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">sysclk</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">eq_textcnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">bq_textcnt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">fmt</span>  <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">eq_sel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">bq_sel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">fmt</span>  <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">eq_sel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">bq_sel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">cdata</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">dai</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">rate</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">fmt</span>  <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">eq_sel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">cdata</span><span class="o">-&gt;</span><span class="n">bq_sel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">lin_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic1pre</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic2pre</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* register an audio interrupt */</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">request_threaded_irq</span><span class="p">(</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
			<span class="n">max98095_report_jack</span><span class="p">,</span>
			<span class="n">IRQF_TRIGGER_FALLING</span> <span class="o">|</span> <span class="n">IRQF_TRIGGER_RISING</span><span class="p">,</span>
			<span class="s">&quot;max98095&quot;</span><span class="p">,</span> <span class="n">codec</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to request IRQ: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">err_access</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_0FF_REV_ID</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failure reading hardware revision: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">ret</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err_irq</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dev_info</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Hardware revision: %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">-</span> <span class="mh">0x40</span> <span class="o">+</span> <span class="sc">&#39;A&#39;</span><span class="p">);</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_097_PWR_SYS</span><span class="p">,</span> <span class="n">M98095_PWRSV</span><span class="p">);</span>

	<span class="cm">/* initialize registers cache to hardware default */</span>
	<span class="n">max98095_set_bias_level</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SND_SOC_BIAS_STANDBY</span><span class="p">);</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_048_MIX_DAC_LR</span><span class="p">,</span>
		<span class="n">M98095_DAI1L_TO_DACL</span><span class="o">|</span><span class="n">M98095_DAI1R_TO_DACR</span><span class="p">);</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_049_MIX_DAC_M</span><span class="p">,</span>
		<span class="n">M98095_DAI2M_TO_DACM</span><span class="o">|</span><span class="n">M98095_DAI3M_TO_DACM</span><span class="p">);</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_092_PWR_EN_OUT</span><span class="p">,</span> <span class="n">M98095_SPK_SPREADSPECTRUM</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_045_CFG_DSP</span><span class="p">,</span> <span class="n">M98095_DSPNORMAL</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_04E_CFG_HP</span><span class="p">,</span> <span class="n">M98095_HPNORMAL</span><span class="p">);</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_02C_DAI1_IOCFG</span><span class="p">,</span>
		<span class="n">M98095_S1NORMAL</span><span class="o">|</span><span class="n">M98095_SDATA</span><span class="p">);</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_036_DAI2_IOCFG</span><span class="p">,</span>
		<span class="n">M98095_S2NORMAL</span><span class="o">|</span><span class="n">M98095_SDATA</span><span class="p">);</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_040_DAI3_IOCFG</span><span class="p">,</span>
		<span class="n">M98095_S3NORMAL</span><span class="o">|</span><span class="n">M98095_SDATA</span><span class="p">);</span>

	<span class="n">max98095_handle_pdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="cm">/* take the codec out of the shut down */</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">M98095_097_PWR_SYS</span><span class="p">,</span> <span class="n">M98095_SHDNRUN</span><span class="p">,</span>
		<span class="n">M98095_SHDNRUN</span><span class="p">);</span>

	<span class="n">max98095_add_widgets</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">err_irq:</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">)</span>
		<span class="n">free_irq</span><span class="p">(</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">,</span> <span class="n">codec</span><span class="p">);</span>
<span class="nl">err_access:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">to_i2c_client</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">max98095_set_bias_level</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SND_SOC_BIAS_OFF</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span><span class="o">-&gt;</span><span class="n">headphone_jack</span> <span class="o">||</span> <span class="n">max98095</span><span class="o">-&gt;</span><span class="n">mic_jack</span><span class="p">)</span>
		<span class="n">max98095_jack_detect_disable</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">)</span>
		<span class="n">free_irq</span><span class="p">(</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">,</span> <span class="n">codec</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_codec_driver</span> <span class="n">soc_codec_dev_max98095</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">probe</span>   <span class="o">=</span> <span class="n">max98095_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>  <span class="o">=</span> <span class="n">max98095_remove</span><span class="p">,</span>
	<span class="p">.</span><span class="n">suspend</span> <span class="o">=</span> <span class="n">max98095_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resume</span>  <span class="o">=</span> <span class="n">max98095_resume</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_bias_level</span> <span class="o">=</span> <span class="n">max98095_set_bias_level</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_cache_size</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_reg_def</span><span class="p">),</span>
	<span class="p">.</span><span class="n">reg_word_size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u8</span><span class="p">),</span>
	<span class="p">.</span><span class="n">reg_cache_default</span> <span class="o">=</span> <span class="n">max98095_reg_def</span><span class="p">,</span>
	<span class="p">.</span><span class="n">readable_register</span> <span class="o">=</span> <span class="n">max98095_readable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">volatile_register</span> <span class="o">=</span> <span class="n">max98095_volatile</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dapm_widgets</span>	  <span class="o">=</span> <span class="n">max98095_dapm_widgets</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dapm_widgets</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_dapm_widgets</span><span class="p">),</span>
	<span class="p">.</span><span class="n">dapm_routes</span>     <span class="o">=</span> <span class="n">max98095_audio_map</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dapm_routes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_audio_map</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">max98095_i2c_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">i2c</span><span class="p">,</span>
			     <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">max98095_priv</span> <span class="o">*</span><span class="n">max98095</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">max98095</span> <span class="o">=</span> <span class="n">devm_kzalloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2c</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">max98095_priv</span><span class="p">),</span>
				<span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">max98095</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">devtype</span> <span class="o">=</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">driver_data</span><span class="p">;</span>
	<span class="n">i2c_set_clientdata</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">max98095</span><span class="p">);</span>
	<span class="n">max98095</span><span class="o">-&gt;</span><span class="n">pdata</span> <span class="o">=</span> <span class="n">i2c</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">platform_data</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_register_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2c</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">soc_codec_dev_max98095</span><span class="p">,</span>
				     <span class="n">max98095_dai</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">max98095_dai</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devexit</span> <span class="nf">max98095_i2c_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_unregister_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_device_id</span> <span class="n">max98095_i2c_id</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="s">&quot;max98095&quot;</span><span class="p">,</span> <span class="n">MAX98095</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">max98095_i2c_id</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_driver</span> <span class="n">max98095_i2c_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;max98095&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">probe</span>  <span class="o">=</span> <span class="n">max98095_i2c_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span> <span class="o">=</span> <span class="n">__devexit_p</span><span class="p">(</span><span class="n">max98095_i2c_remove</span><span class="p">),</span>
	<span class="p">.</span><span class="n">id_table</span> <span class="o">=</span> <span class="n">max98095_i2c_id</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">max98095_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">i2c_add_driver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">max98095_i2c_driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Failed to register max98095 I2C driver: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">module_init</span><span class="p">(</span><span class="n">max98095_init</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">max98095_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">i2c_del_driver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">max98095_i2c_driver</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">max98095_exit</span><span class="p">);</span>

<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;ALSA SoC MAX98095 driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Peter Hsiang&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
