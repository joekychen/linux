<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › soc › codecs › ak4671.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>ak4671.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * ak4671.c  --  audio driver for AK4671</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2009 Samsung Electronics Co.Ltd</span>
<span class="cm"> * Author: Joonyoung Shim &lt;jy0922.shim@samsung.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute  it and/or modify it</span>
<span class="cm"> *  under  the terms of  the GNU General  Public License as published by the</span>
<span class="cm"> *  Free Software Foundation;  either version 2 of the  License, or (at your</span>
<span class="cm"> *  option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;sound/soc.h&gt;</span>
<span class="cp">#include &lt;sound/initval.h&gt;</span>
<span class="cp">#include &lt;sound/tlv.h&gt;</span>

<span class="cp">#include &quot;ak4671.h&quot;</span>


<span class="cm">/* codec private data */</span>
<span class="k">struct</span> <span class="n">ak4671_priv</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">snd_soc_control_type</span> <span class="n">control_type</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* ak4671 register cache &amp; default register settings */</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">ak4671_reg</span><span class="p">[</span><span class="n">AK4671_CACHEREGNUM</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_AD_DA_POWER_MANAGEMENT	(0x00)	*/</span>
	<span class="mh">0xf6</span><span class="p">,</span>	<span class="cm">/* AK4671_PLL_MODE_SELECT0		(0x01)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_PLL_MODE_SELECT1		(0x02)	*/</span>
	<span class="mh">0x02</span><span class="p">,</span>	<span class="cm">/* AK4671_FORMAT_SELECT			(0x03)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_MIC_SIGNAL_SELECT		(0x04)	*/</span>
	<span class="mh">0x55</span><span class="p">,</span>	<span class="cm">/* AK4671_MIC_AMP_GAIN			(0x05)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_MIXING_POWER_MANAGEMENT0	(0x06)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_MIXING_POWER_MANAGEMENT1	(0x07)	*/</span>
	<span class="mh">0xb5</span><span class="p">,</span>	<span class="cm">/* AK4671_OUTPUT_VOLUME_CONTROL		(0x08)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_LOUT1_SIGNAL_SELECT		(0x09)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_ROUT1_SIGNAL_SELECT		(0x0a)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_LOUT2_SIGNAL_SELECT		(0x0b)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_ROUT2_SIGNAL_SELECT		(0x0c)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_LOUT3_SIGNAL_SELECT		(0x0d)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_ROUT3_SIGNAL_SELECT		(0x0e)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_LOUT1_POWER_MANAGERMENT	(0x0f)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_LOUT2_POWER_MANAGERMENT	(0x10)	*/</span>
	<span class="mh">0x80</span><span class="p">,</span>	<span class="cm">/* AK4671_LOUT3_POWER_MANAGERMENT	(0x11)	*/</span>
	<span class="mh">0x91</span><span class="p">,</span>	<span class="cm">/* AK4671_LCH_INPUT_VOLUME_CONTROL	(0x12)	*/</span>
	<span class="mh">0x91</span><span class="p">,</span>	<span class="cm">/* AK4671_RCH_INPUT_VOLUME_CONTROL	(0x13)	*/</span>
	<span class="mh">0xe1</span><span class="p">,</span>	<span class="cm">/* AK4671_ALC_REFERENCE_SELECT		(0x14)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_DIGITAL_MIXING_CONTROL	(0x15)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_ALC_TIMER_SELECT		(0x16)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_ALC_MODE_CONTROL		(0x17)	*/</span>
	<span class="mh">0x02</span><span class="p">,</span>	<span class="cm">/* AK4671_MODE_CONTROL1			(0x18)	*/</span>
	<span class="mh">0x01</span><span class="p">,</span>	<span class="cm">/* AK4671_MODE_CONTROL2			(0x19)	*/</span>
	<span class="mh">0x18</span><span class="p">,</span>	<span class="cm">/* AK4671_LCH_OUTPUT_VOLUME_CONTROL	(0x1a)	*/</span>
	<span class="mh">0x18</span><span class="p">,</span>	<span class="cm">/* AK4671_RCH_OUTPUT_VOLUME_CONTROL	(0x1b)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_SIDETONE_A_CONTROL		(0x1c)	*/</span>
	<span class="mh">0x02</span><span class="p">,</span>	<span class="cm">/* AK4671_DIGITAL_FILTER_SELECT		(0x1d)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL3_COEFFICIENT0		(0x1e)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL3_COEFFICIENT1		(0x1f)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL3_COEFFICIENT2		(0x20)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL3_COEFFICIENT3		(0x21)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_EQ_COEFFICIENT0		(0x22)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_EQ_COEFFICIENT1		(0x23)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_EQ_COEFFICIENT2		(0x24)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_EQ_COEFFICIENT3		(0x25)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_EQ_COEFFICIENT4		(0x26)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_EQ_COEFFICIENT5		(0x27)	*/</span>
	<span class="mh">0xa9</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL1_COEFFICIENT0		(0x28)	*/</span>
	<span class="mh">0x1f</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL1_COEFFICIENT1		(0x29)	*/</span>
	<span class="mh">0xad</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL1_COEFFICIENT2		(0x2a)	*/</span>
	<span class="mh">0x20</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL1_COEFFICIENT3		(0x2b)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL2_COEFFICIENT0		(0x2c)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL2_COEFFICIENT1		(0x2d)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL2_COEFFICIENT2		(0x2e)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_FIL2_COEFFICIENT3		(0x2f)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_DIGITAL_FILTER_SELECT2	(0x30)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* this register not used			*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E1_COEFFICIENT0		(0x32)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E1_COEFFICIENT1		(0x33)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E1_COEFFICIENT2		(0x34)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E1_COEFFICIENT3		(0x35)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E1_COEFFICIENT4		(0x36)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E1_COEFFICIENT5		(0x37)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E2_COEFFICIENT0		(0x38)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E2_COEFFICIENT1		(0x39)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E2_COEFFICIENT2		(0x3a)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E2_COEFFICIENT3		(0x3b)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E2_COEFFICIENT4		(0x3c)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E2_COEFFICIENT5		(0x3d)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E3_COEFFICIENT0		(0x3e)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E3_COEFFICIENT1		(0x3f)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E3_COEFFICIENT2		(0x40)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E3_COEFFICIENT3		(0x41)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E3_COEFFICIENT4		(0x42)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E3_COEFFICIENT5		(0x43)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E4_COEFFICIENT0		(0x44)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E4_COEFFICIENT1		(0x45)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E4_COEFFICIENT2		(0x46)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E4_COEFFICIENT3		(0x47)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E4_COEFFICIENT4		(0x48)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E4_COEFFICIENT5		(0x49)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E5_COEFFICIENT0		(0x4a)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E5_COEFFICIENT1		(0x4b)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E5_COEFFICIENT2		(0x4c)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E5_COEFFICIENT3		(0x4d)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E5_COEFFICIENT4		(0x4e)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_E5_COEFFICIENT5		(0x4f)	*/</span>
	<span class="mh">0x88</span><span class="p">,</span>	<span class="cm">/* AK4671_EQ_CONTROL_250HZ_100HZ	(0x50)	*/</span>
	<span class="mh">0x88</span><span class="p">,</span>	<span class="cm">/* AK4671_EQ_CONTROL_3500HZ_1KHZ	(0x51)	*/</span>
	<span class="mh">0x08</span><span class="p">,</span>	<span class="cm">/* AK4671_EQ_CONTRO_10KHZ		(0x52)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_PCM_IF_CONTROL0		(0x53)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_PCM_IF_CONTROL1		(0x54)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_PCM_IF_CONTROL2		(0x55)	*/</span>
	<span class="mh">0x18</span><span class="p">,</span>	<span class="cm">/* AK4671_DIGITAL_VOLUME_B_CONTROL	(0x56)	*/</span>
	<span class="mh">0x18</span><span class="p">,</span>	<span class="cm">/* AK4671_DIGITAL_VOLUME_C_CONTROL	(0x57)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_SIDETONE_VOLUME_CONTROL	(0x58)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_DIGITAL_MIXING_CONTROL2	(0x59)	*/</span>
	<span class="mh">0x00</span><span class="p">,</span>	<span class="cm">/* AK4671_SAR_ADC_CONTROL		(0x5a)	*/</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * LOUT1/ROUT1 output volume control:</span>
<span class="cm"> * from -24 to 6 dB in 6 dB steps (mute instead of -30 dB)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">out1_tlv</span><span class="p">,</span> <span class="o">-</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * LOUT2/ROUT2 output volume control:</span>
<span class="cm"> * from -33 to 6 dB in 3 dB steps (mute instead of -33 dB)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">out2_tlv</span><span class="p">,</span> <span class="o">-</span><span class="mi">3300</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * LOUT3/ROUT3 output volume control:</span>
<span class="cm"> * from -6 to 3 dB in 3 dB steps</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">out3_tlv</span><span class="p">,</span> <span class="o">-</span><span class="mi">600</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Mic amp gain control:</span>
<span class="cm"> * from -15 to 30 dB in 3 dB steps</span>
<span class="cm"> * REVISIT: The actual min value(0x01) is -12 dB and the reg value 0x00 is not</span>
<span class="cm"> * available</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">mic_amp_tlv</span><span class="p">,</span> <span class="o">-</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ak4671_snd_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Common playback gain controls */</span>
	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;Line Output1 Playback Volume&quot;</span><span class="p">,</span>
			<span class="n">AK4671_OUTPUT_VOLUME_CONTROL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out1_tlv</span><span class="p">),</span>
	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;Headphone Output2 Playback Volume&quot;</span><span class="p">,</span>
			<span class="n">AK4671_OUTPUT_VOLUME_CONTROL</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0xd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out2_tlv</span><span class="p">),</span>
	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;Line Output3 Playback Volume&quot;</span><span class="p">,</span>
			<span class="n">AK4671_LOUT3_POWER_MANAGERMENT</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out3_tlv</span><span class="p">),</span>

	<span class="cm">/* Common capture gain controls */</span>
	<span class="n">SOC_DOUBLE_TLV</span><span class="p">(</span><span class="s">&quot;Mic Amp Capture Volume&quot;</span><span class="p">,</span>
			<span class="n">AK4671_MIC_AMP_GAIN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0xf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mic_amp_tlv</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* event handlers */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ak4671_out2_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAPM_POST_PMU</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_LOUT2_POWER_MANAGERMENT</span><span class="p">,</span>
				    <span class="n">AK4671_MUTEN</span><span class="p">,</span> <span class="n">AK4671_MUTEN</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAPM_PRE_PMD</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_LOUT2_POWER_MANAGERMENT</span><span class="p">,</span>
				    <span class="n">AK4671_MUTEN</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Output Mixers */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ak4671_lout1_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;DACL&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINL1&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINL2&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINL3&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINL4&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LOOPL&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ak4671_rout1_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;DACR&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINR1&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINR2&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINR3&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINR4&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LOOPR&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT1_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ak4671_lout2_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;DACHL&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINH1&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINH2&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINH3&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINH4&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LOOPHL&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ak4671_rout2_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;DACHR&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINH1&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINH2&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINH3&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINH4&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LOOPHR&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT2_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ak4671_lout3_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;DACSL&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINS1&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINS2&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINS3&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LINS4&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LOOPSL&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ak4671_rout3_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;DACSR&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINS1&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINS2&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINS3&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RINS4&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;LOOPSR&quot;</span><span class="p">,</span> <span class="n">AK4671_ROUT3_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Input MUXs */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ak4671_lin_mux_texts</span><span class="p">[]</span> <span class="o">=</span>
		<span class="p">{</span><span class="s">&quot;LIN1&quot;</span><span class="p">,</span> <span class="s">&quot;LIN2&quot;</span><span class="p">,</span> <span class="s">&quot;LIN3&quot;</span><span class="p">,</span> <span class="s">&quot;LIN4&quot;</span><span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">ak4671_lin_mux_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">AK4671_MIC_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_lin_mux_texts</span><span class="p">),</span>
			<span class="n">ak4671_lin_mux_texts</span><span class="p">);</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ak4671_lin_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Route&quot;</span><span class="p">,</span> <span class="n">ak4671_lin_mux_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ak4671_rin_mux_texts</span><span class="p">[]</span> <span class="o">=</span>
		<span class="p">{</span><span class="s">&quot;RIN1&quot;</span><span class="p">,</span> <span class="s">&quot;RIN2&quot;</span><span class="p">,</span> <span class="s">&quot;RIN3&quot;</span><span class="p">,</span> <span class="s">&quot;RIN4&quot;</span><span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">ak4671_rin_mux_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">AK4671_MIC_SIGNAL_SELECT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_rin_mux_texts</span><span class="p">),</span>
			<span class="n">ak4671_rin_mux_texts</span><span class="p">);</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">ak4671_rin_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Route&quot;</span><span class="p">,</span> <span class="n">ak4671_rin_mux_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="n">ak4671_dapm_widgets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Inputs */</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;LIN1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;RIN1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;LIN2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;RIN2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;LIN3&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;RIN3&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;LIN4&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;RIN4&quot;</span><span class="p">),</span>

	<span class="cm">/* Outputs */</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;LOUT1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;ROUT1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;LOUT2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;ROUT2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;LOUT3&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;ROUT3&quot;</span><span class="p">),</span>

	<span class="cm">/* DAC */</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;DAC Left&quot;</span><span class="p">,</span> <span class="s">&quot;Left HiFi Playback&quot;</span><span class="p">,</span>
			<span class="n">AK4671_AD_DA_POWER_MANAGEMENT</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;DAC Right&quot;</span><span class="p">,</span> <span class="s">&quot;Right HiFi Playback&quot;</span><span class="p">,</span>
			<span class="n">AK4671_AD_DA_POWER_MANAGEMENT</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* ADC */</span>
	<span class="n">SND_SOC_DAPM_ADC</span><span class="p">(</span><span class="s">&quot;ADC Left&quot;</span><span class="p">,</span> <span class="s">&quot;Left HiFi Capture&quot;</span><span class="p">,</span>
			<span class="n">AK4671_AD_DA_POWER_MANAGEMENT</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_ADC</span><span class="p">(</span><span class="s">&quot;ADC Right&quot;</span><span class="p">,</span> <span class="s">&quot;Right HiFi Capture&quot;</span><span class="p">,</span>
			<span class="n">AK4671_AD_DA_POWER_MANAGEMENT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* PGA */</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;LOUT2 Mix Amp&quot;</span><span class="p">,</span>
			<span class="n">AK4671_LOUT2_POWER_MANAGERMENT</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;ROUT2 Mix Amp&quot;</span><span class="p">,</span>
			<span class="n">AK4671_LOUT2_POWER_MANAGERMENT</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;LIN1 Mixing Circuit&quot;</span><span class="p">,</span>
			<span class="n">AK4671_MIXING_POWER_MANAGEMENT1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;RIN1 Mixing Circuit&quot;</span><span class="p">,</span>
			<span class="n">AK4671_MIXING_POWER_MANAGEMENT1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;LIN2 Mixing Circuit&quot;</span><span class="p">,</span>
			<span class="n">AK4671_MIXING_POWER_MANAGEMENT1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;RIN2 Mixing Circuit&quot;</span><span class="p">,</span>
			<span class="n">AK4671_MIXING_POWER_MANAGEMENT1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;LIN3 Mixing Circuit&quot;</span><span class="p">,</span>
			<span class="n">AK4671_MIXING_POWER_MANAGEMENT1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;RIN3 Mixing Circuit&quot;</span><span class="p">,</span>
			<span class="n">AK4671_MIXING_POWER_MANAGEMENT1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;LIN4 Mixing Circuit&quot;</span><span class="p">,</span>
			<span class="n">AK4671_MIXING_POWER_MANAGEMENT1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;RIN4 Mixing Circuit&quot;</span><span class="p">,</span>
			<span class="n">AK4671_MIXING_POWER_MANAGEMENT1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* Output Mixers */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;LOUT1 Mixer&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT1_POWER_MANAGERMENT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">ak4671_lout1_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_lout1_mixer_controls</span><span class="p">)),</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;ROUT1 Mixer&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT1_POWER_MANAGERMENT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">ak4671_rout1_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_rout1_mixer_controls</span><span class="p">)),</span>
	<span class="n">SND_SOC_DAPM_MIXER_E</span><span class="p">(</span><span class="s">&quot;LOUT2 Mixer&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT2_POWER_MANAGERMENT</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ak4671_lout2_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_lout2_mixer_controls</span><span class="p">),</span>
			<span class="n">ak4671_out2_event</span><span class="p">,</span>
			<span class="n">SND_SOC_DAPM_POST_PMU</span><span class="o">|</span><span class="n">SND_SOC_DAPM_PRE_PMD</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MIXER_E</span><span class="p">(</span><span class="s">&quot;ROUT2 Mixer&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT2_POWER_MANAGERMENT</span><span class="p">,</span>
			<span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ak4671_rout2_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_rout2_mixer_controls</span><span class="p">),</span>
			<span class="n">ak4671_out2_event</span><span class="p">,</span>
			<span class="n">SND_SOC_DAPM_POST_PMU</span><span class="o">|</span><span class="n">SND_SOC_DAPM_PRE_PMD</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;LOUT3 Mixer&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT3_POWER_MANAGERMENT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">ak4671_lout3_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_lout3_mixer_controls</span><span class="p">)),</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;ROUT3 Mixer&quot;</span><span class="p">,</span> <span class="n">AK4671_LOUT3_POWER_MANAGERMENT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">ak4671_rout3_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_rout3_mixer_controls</span><span class="p">)),</span>

	<span class="cm">/* Input MUXs */</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;LIN MUX&quot;</span><span class="p">,</span> <span class="n">AK4671_AD_DA_POWER_MANAGEMENT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">ak4671_lin_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;RIN MUX&quot;</span><span class="p">,</span> <span class="n">AK4671_AD_DA_POWER_MANAGEMENT</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">ak4671_rin_mux_control</span><span class="p">),</span>

	<span class="cm">/* Mic Power */</span>
	<span class="n">SND_SOC_DAPM_MICBIAS</span><span class="p">(</span><span class="s">&quot;Mic Bias&quot;</span><span class="p">,</span> <span class="n">AK4671_AD_DA_POWER_MANAGEMENT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* Supply */</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;PMPLL&quot;</span><span class="p">,</span> <span class="n">AK4671_PLL_MODE_SELECT1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dapm_route</span> <span class="n">ak4671_intercon</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="s">&quot;DAC Left&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;PMPLL&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;DAC Right&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;PMPLL&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ADC Left&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;PMPLL&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ADC Right&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;PMPLL&quot;</span><span class="p">},</span>

	<span class="cm">/* Outputs */</span>
	<span class="p">{</span><span class="s">&quot;LOUT1&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;LOUT1 Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT1&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;ROUT1 Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT2&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;LOUT2 Mix Amp&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT2&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;ROUT2 Mix Amp&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT3&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;LOUT3 Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT3&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;ROUT3 Mixer&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;LOUT1 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;DACL&quot;</span><span class="p">,</span> <span class="s">&quot;DAC Left&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT1 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;DACR&quot;</span><span class="p">,</span> <span class="s">&quot;DAC Right&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT2 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;DACHL&quot;</span><span class="p">,</span> <span class="s">&quot;DAC Left&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT2 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;DACHR&quot;</span><span class="p">,</span> <span class="s">&quot;DAC Right&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT2 Mix Amp&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;LOUT2 Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT2 Mix Amp&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;ROUT2 Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT3 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;DACSL&quot;</span><span class="p">,</span> <span class="s">&quot;DAC Left&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT3 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;DACSR&quot;</span><span class="p">,</span> <span class="s">&quot;DAC Right&quot;</span><span class="p">},</span>

	<span class="cm">/* Inputs */</span>
	<span class="p">{</span><span class="s">&quot;LIN MUX&quot;</span><span class="p">,</span> <span class="s">&quot;LIN1&quot;</span><span class="p">,</span> <span class="s">&quot;LIN1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LIN MUX&quot;</span><span class="p">,</span> <span class="s">&quot;LIN2&quot;</span><span class="p">,</span> <span class="s">&quot;LIN2&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LIN MUX&quot;</span><span class="p">,</span> <span class="s">&quot;LIN3&quot;</span><span class="p">,</span> <span class="s">&quot;LIN3&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LIN MUX&quot;</span><span class="p">,</span> <span class="s">&quot;LIN4&quot;</span><span class="p">,</span> <span class="s">&quot;LIN4&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;RIN MUX&quot;</span><span class="p">,</span> <span class="s">&quot;RIN1&quot;</span><span class="p">,</span> <span class="s">&quot;RIN1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RIN MUX&quot;</span><span class="p">,</span> <span class="s">&quot;RIN2&quot;</span><span class="p">,</span> <span class="s">&quot;RIN2&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RIN MUX&quot;</span><span class="p">,</span> <span class="s">&quot;RIN3&quot;</span><span class="p">,</span> <span class="s">&quot;RIN3&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RIN MUX&quot;</span><span class="p">,</span> <span class="s">&quot;RIN4&quot;</span><span class="p">,</span> <span class="s">&quot;RIN4&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;LIN1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Mic Bias&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RIN1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Mic Bias&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LIN2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Mic Bias&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RIN2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Mic Bias&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;ADC Left&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;LIN MUX&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ADC Right&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;RIN MUX&quot;</span><span class="p">},</span>

	<span class="cm">/* Analog Loops */</span>
	<span class="p">{</span><span class="s">&quot;LIN1 Mixing Circuit&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;LIN1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RIN1 Mixing Circuit&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;RIN1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LIN2 Mixing Circuit&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;LIN2&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RIN2 Mixing Circuit&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;RIN2&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LIN3 Mixing Circuit&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;LIN3&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RIN3 Mixing Circuit&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;RIN3&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LIN4 Mixing Circuit&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;LIN4&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RIN4 Mixing Circuit&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;RIN4&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;LOUT1 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINL1&quot;</span><span class="p">,</span> <span class="s">&quot;LIN1 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT1 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINR1&quot;</span><span class="p">,</span> <span class="s">&quot;RIN1 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT2 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINH1&quot;</span><span class="p">,</span> <span class="s">&quot;LIN1 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT2 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINH1&quot;</span><span class="p">,</span> <span class="s">&quot;RIN1 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT3 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINS1&quot;</span><span class="p">,</span> <span class="s">&quot;LIN1 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT3 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINS1&quot;</span><span class="p">,</span> <span class="s">&quot;RIN1 Mixing Circuit&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;LOUT1 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINL2&quot;</span><span class="p">,</span> <span class="s">&quot;LIN2 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT1 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINR2&quot;</span><span class="p">,</span> <span class="s">&quot;RIN2 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT2 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINH2&quot;</span><span class="p">,</span> <span class="s">&quot;LIN2 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT2 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINH2&quot;</span><span class="p">,</span> <span class="s">&quot;RIN2 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT3 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINS2&quot;</span><span class="p">,</span> <span class="s">&quot;LIN2 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT3 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINS2&quot;</span><span class="p">,</span> <span class="s">&quot;RIN2 Mixing Circuit&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;LOUT1 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINL3&quot;</span><span class="p">,</span> <span class="s">&quot;LIN3 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT1 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINR3&quot;</span><span class="p">,</span> <span class="s">&quot;RIN3 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT2 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINH3&quot;</span><span class="p">,</span> <span class="s">&quot;LIN3 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT2 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINH3&quot;</span><span class="p">,</span> <span class="s">&quot;RIN3 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT3 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINS3&quot;</span><span class="p">,</span> <span class="s">&quot;LIN3 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT3 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINS3&quot;</span><span class="p">,</span> <span class="s">&quot;RIN3 Mixing Circuit&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;LOUT1 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINL4&quot;</span><span class="p">,</span> <span class="s">&quot;LIN4 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT1 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINR4&quot;</span><span class="p">,</span> <span class="s">&quot;RIN4 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT2 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINH4&quot;</span><span class="p">,</span> <span class="s">&quot;LIN4 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT2 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINH4&quot;</span><span class="p">,</span> <span class="s">&quot;RIN4 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;LOUT3 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;LINS4&quot;</span><span class="p">,</span> <span class="s">&quot;LIN4 Mixing Circuit&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ROUT3 Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RINS4&quot;</span><span class="p">,</span> <span class="s">&quot;RIN4 Mixing Circuit&quot;</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ak4671_hw_params</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">snd_pcm_hw_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fs</span><span class="p">;</span>

	<span class="n">fs</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_PLL_MODE_SELECT0</span><span class="p">);</span>
	<span class="n">fs</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">AK4671_FS</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">params_rate</span><span class="p">(</span><span class="n">params</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">8000</span>:
		<span class="n">fs</span> <span class="o">|=</span> <span class="n">AK4671_FS_8KHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">12000</span>:
		<span class="n">fs</span> <span class="o">|=</span> <span class="n">AK4671_FS_12KHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">16000</span>:
		<span class="n">fs</span> <span class="o">|=</span> <span class="n">AK4671_FS_16KHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">24000</span>:
		<span class="n">fs</span> <span class="o">|=</span> <span class="n">AK4671_FS_24KHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">11025</span>:
		<span class="n">fs</span> <span class="o">|=</span> <span class="n">AK4671_FS_11_025KHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">22050</span>:
		<span class="n">fs</span> <span class="o">|=</span> <span class="n">AK4671_FS_22_05KHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">32000</span>:
		<span class="n">fs</span> <span class="o">|=</span> <span class="n">AK4671_FS_32KHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">44100</span>:
		<span class="n">fs</span> <span class="o">|=</span> <span class="n">AK4671_FS_44_1KHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">48000</span>:
		<span class="n">fs</span> <span class="o">|=</span> <span class="n">AK4671_FS_48KHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_PLL_MODE_SELECT0</span><span class="p">,</span> <span class="n">fs</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ak4671_set_dai_sysclk</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span> <span class="kt">int</span> <span class="n">clk_id</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pll</span><span class="p">;</span>

	<span class="n">pll</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_PLL_MODE_SELECT0</span><span class="p">);</span>
	<span class="n">pll</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">AK4671_PLL</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">11289600</span>:
		<span class="n">pll</span> <span class="o">|=</span> <span class="n">AK4671_PLL_11_2896MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">12000000</span>:
		<span class="n">pll</span> <span class="o">|=</span> <span class="n">AK4671_PLL_12MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">12288000</span>:
		<span class="n">pll</span> <span class="o">|=</span> <span class="n">AK4671_PLL_12_288MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">13000000</span>:
		<span class="n">pll</span> <span class="o">|=</span> <span class="n">AK4671_PLL_13MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">13500000</span>:
		<span class="n">pll</span> <span class="o">|=</span> <span class="n">AK4671_PLL_13_5MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">19200000</span>:
		<span class="n">pll</span> <span class="o">|=</span> <span class="n">AK4671_PLL_19_2MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">24000000</span>:
		<span class="n">pll</span> <span class="o">|=</span> <span class="n">AK4671_PLL_24MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">26000000</span>:
		<span class="n">pll</span> <span class="o">|=</span> <span class="n">AK4671_PLL_26MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">27000000</span>:
		<span class="n">pll</span> <span class="o">|=</span> <span class="n">AK4671_PLL_27MHZ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_PLL_MODE_SELECT0</span><span class="p">,</span> <span class="n">pll</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ak4671_set_dai_fmt</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mode</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">format</span><span class="p">;</span>

	<span class="cm">/* set master/slave audio interface */</span>
	<span class="n">mode</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_PLL_MODE_SELECT1</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_MASTER_MASK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFM</span>:
		<span class="n">mode</span> <span class="o">|=</span> <span class="n">AK4671_M_S</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFS</span>:
		<span class="n">mode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">AK4671_M_S</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* interface format */</span>
	<span class="n">format</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_FORMAT_SELECT</span><span class="p">);</span>
	<span class="n">format</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">AK4671_DIF</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_FORMAT_MASK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_I2S</span>:
		<span class="n">format</span> <span class="o">|=</span> <span class="n">AK4671_DIF_I2S_MODE</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_LEFT_J</span>:
		<span class="n">format</span> <span class="o">|=</span> <span class="n">AK4671_DIF_MSB_MODE</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_DSP_A</span>:
		<span class="n">format</span> <span class="o">|=</span> <span class="n">AK4671_DIF_DSP_MODE</span><span class="p">;</span>
		<span class="n">format</span> <span class="o">|=</span> <span class="n">AK4671_BCKP</span><span class="p">;</span>
		<span class="n">format</span> <span class="o">|=</span> <span class="n">AK4671_MSBS</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* set mode and format */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_PLL_MODE_SELECT1</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_FORMAT_SELECT</span><span class="p">,</span> <span class="n">format</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ak4671_set_bias_level</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
		<span class="k">enum</span> <span class="n">snd_soc_bias_level</span> <span class="n">level</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_BIAS_ON</span>:
	<span class="k">case</span> <span class="n">SND_SOC_BIAS_PREPARE</span>:
	<span class="k">case</span> <span class="n">SND_SOC_BIAS_STANDBY</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_AD_DA_POWER_MANAGEMENT</span><span class="p">,</span>
				    <span class="n">AK4671_PMVCM</span><span class="p">,</span> <span class="n">AK4671_PMVCM</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_BIAS_OFF</span>:
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">AK4671_AD_DA_POWER_MANAGEMENT</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">dapm</span><span class="p">.</span><span class="n">bias_level</span> <span class="o">=</span> <span class="n">level</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define AK4671_RATES		(SNDRV_PCM_RATE_8000 | SNDRV_PCM_RATE_11025 |\</span>
<span class="cp">				SNDRV_PCM_RATE_16000 | SNDRV_PCM_RATE_22050 |\</span>
<span class="cp">				SNDRV_PCM_RATE_32000 | SNDRV_PCM_RATE_44100 |\</span>
<span class="cp">				SNDRV_PCM_RATE_48000)</span>

<span class="cp">#define AK4671_FORMATS		SNDRV_PCM_FMTBIT_S16_LE</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">ak4671_dai_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">hw_params</span>	<span class="o">=</span> <span class="n">ak4671_hw_params</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_sysclk</span>	<span class="o">=</span> <span class="n">ak4671_set_dai_sysclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_fmt</span>	<span class="o">=</span> <span class="n">ak4671_set_dai_fmt</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_dai_driver</span> <span class="n">ak4671_dai</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ak4671-hifi&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Playback&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">AK4671_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">AK4671_FORMATS</span><span class="p">,},</span>
	<span class="p">.</span><span class="n">capture</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Capture&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">AK4671_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">AK4671_FORMATS</span><span class="p">,},</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ak4671_dai_ops</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ak4671_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ak4671_priv</span> <span class="o">*</span><span class="n">ak4671</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_codec_set_cache_io</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">ak4671</span><span class="o">-&gt;</span><span class="n">control_type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to set cache I/O: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">snd_soc_add_codec_controls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">ak4671_snd_controls</span><span class="p">,</span>
			     <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_snd_controls</span><span class="p">));</span>

	<span class="n">ak4671_set_bias_level</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SND_SOC_BIAS_STANDBY</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ak4671_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ak4671_set_bias_level</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SND_SOC_BIAS_OFF</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_codec_driver</span> <span class="n">soc_codec_dev_ak4671</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">ak4671_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span> <span class="o">=</span> <span class="n">ak4671_remove</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_bias_level</span> <span class="o">=</span> <span class="n">ak4671_set_bias_level</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_cache_size</span> <span class="o">=</span> <span class="n">AK4671_CACHEREGNUM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_word_size</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u8</span><span class="p">),</span>
	<span class="p">.</span><span class="n">reg_cache_default</span> <span class="o">=</span> <span class="n">ak4671_reg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dapm_widgets</span> <span class="o">=</span> <span class="n">ak4671_dapm_widgets</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dapm_widgets</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_dapm_widgets</span><span class="p">),</span>
	<span class="p">.</span><span class="n">dapm_routes</span> <span class="o">=</span> <span class="n">ak4671_intercon</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dapm_routes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ak4671_intercon</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">ak4671_i2c_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ak4671_priv</span> <span class="o">*</span><span class="n">ak4671</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ak4671</span> <span class="o">=</span> <span class="n">devm_kzalloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ak4671_priv</span><span class="p">),</span>
			      <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ak4671</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">i2c_set_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">ak4671</span><span class="p">);</span>
	<span class="n">ak4671</span><span class="o">-&gt;</span><span class="n">control_type</span> <span class="o">=</span> <span class="n">SND_SOC_I2C</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_register_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">soc_codec_dev_ak4671</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ak4671_dai</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">__devexit</span> <span class="kt">int</span> <span class="nf">ak4671_i2c_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_unregister_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_device_id</span> <span class="n">ak4671_i2c_id</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="s">&quot;ak4671&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">ak4671_i2c_id</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_driver</span> <span class="n">ak4671_i2c_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ak4671-codec&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">ak4671_i2c_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span> <span class="o">=</span> <span class="n">__devexit_p</span><span class="p">(</span><span class="n">ak4671_i2c_remove</span><span class="p">),</span>
	<span class="p">.</span><span class="n">id_table</span> <span class="o">=</span> <span class="n">ak4671_i2c_id</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">ak4671_modinit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">i2c_add_driver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ak4671_i2c_driver</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_init</span><span class="p">(</span><span class="n">ak4671_modinit</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">ak4671_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">i2c_del_driver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ak4671_i2c_driver</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">ak4671_exit</span><span class="p">);</span>

<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;ASoC AK4671 codec driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Joonyoung Shim &lt;jy0922.shim@samsung.com&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
