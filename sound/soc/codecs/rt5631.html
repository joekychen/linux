<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › soc › codecs › rt5631.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>rt5631.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * rt5631.c  --  RT5631 ALSA Soc Audio driver</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2011 Realtek Microelectronics</span>
<span class="cm"> *</span>
<span class="cm"> * Author: flove &lt;flove@realtek.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Based on WM8753.c</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/moduleparam.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/pm.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/regmap.h&gt;</span>
<span class="cp">#include &lt;sound/core.h&gt;</span>
<span class="cp">#include &lt;sound/pcm.h&gt;</span>
<span class="cp">#include &lt;sound/pcm_params.h&gt;</span>
<span class="cp">#include &lt;sound/soc.h&gt;</span>
<span class="cp">#include &lt;sound/soc-dapm.h&gt;</span>
<span class="cp">#include &lt;sound/initval.h&gt;</span>
<span class="cp">#include &lt;sound/tlv.h&gt;</span>

<span class="cp">#include &quot;rt5631.h&quot;</span>

<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">regmap</span> <span class="o">*</span><span class="n">regmap</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">codec_version</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">master</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sysclk</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_rate</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">bclk_rate</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dmic_used_flag</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">reg_default</span> <span class="n">rt5631_reg</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">RT5631_SPK_OUT_VOL</span><span class="p">,</span> <span class="mh">0x8888</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_HP_OUT_VOL</span><span class="p">,</span> <span class="mh">0x8080</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_MONO_AXO_1_2_VOL</span><span class="p">,</span> <span class="mh">0xa080</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_AUX_IN_VOL</span><span class="p">,</span> <span class="mh">0x0808</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">,</span> <span class="mh">0xf0f0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_VDAC_DIG_VOL</span><span class="p">,</span> <span class="mh">0x0010</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">,</span> <span class="mh">0xffc0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">,</span> <span class="mh">0xffc0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_AXO1MIXER_CTRL</span><span class="p">,</span> <span class="mh">0x88c0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_AXO2MIXER_CTRL</span><span class="p">,</span> <span class="mh">0x88c0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_DIG_MIC_CTRL</span><span class="p">,</span> <span class="mh">0x3000</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_MONO_INPUT_VOL</span><span class="p">,</span> <span class="mh">0x8808</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">,</span> <span class="mh">0xf8f8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_SPK_MONO_OUT_CTRL</span><span class="p">,</span> <span class="mh">0xfc00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_SPK_MONO_HP_OUT_CTRL</span><span class="p">,</span> <span class="mh">0x4440</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_SDP_CTRL</span><span class="p">,</span> <span class="mh">0x8000</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_MONO_SDP_CTRL</span><span class="p">,</span> <span class="mh">0x8000</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_STEREO_AD_DA_CLK_CTRL</span><span class="p">,</span> <span class="mh">0x2010</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_GEN_PUR_CTRL_REG</span><span class="p">,</span> <span class="mh">0x0e00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span> <span class="mh">0x071a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_MISC_CTRL</span><span class="p">,</span> <span class="mh">0x2040</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_DEPOP_FUN_CTRL_2</span><span class="p">,</span> <span class="mh">0x8000</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">,</span> <span class="mh">0x07e0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_ALC_CTRL_1</span><span class="p">,</span> <span class="mh">0x0206</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_ALC_CTRL_3</span><span class="p">,</span> <span class="mh">0x2000</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">RT5631_PSEUDO_SPATL_CTRL</span><span class="p">,</span> <span class="mh">0x0553</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * rt5631_write_index - write index register of 2nd layer</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">rt5631_write_index</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INDEX_ADD</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INDEX_DATA</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * rt5631_read_index - read index register of 2nd layer</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">rt5631_read_index</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">;</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INDEX_ADD</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="n">value</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INDEX_DATA</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_RESET</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">rt5631_volatile_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">RT5631_RESET</span>:
	<span class="k">case</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span>:
	<span class="k">case</span> <span class="n">RT5631_INDEX_ADD</span>:
	<span class="k">case</span> <span class="n">RT5631_INDEX_DATA</span>:
	<span class="k">case</span> <span class="n">RT5631_EQ_CTRL</span>:
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">rt5631_readable_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">RT5631_RESET</span>:
	<span class="k">case</span> <span class="n">RT5631_SPK_OUT_VOL</span>:
	<span class="k">case</span> <span class="n">RT5631_HP_OUT_VOL</span>:
	<span class="k">case</span> <span class="n">RT5631_MONO_AXO_1_2_VOL</span>:
	<span class="k">case</span> <span class="n">RT5631_AUX_IN_VOL</span>:
	<span class="k">case</span> <span class="n">RT5631_STEREO_DAC_VOL_1</span>:
	<span class="k">case</span> <span class="n">RT5631_MIC_CTRL_1</span>:
	<span class="k">case</span> <span class="n">RT5631_STEREO_DAC_VOL_2</span>:
	<span class="k">case</span> <span class="n">RT5631_ADC_CTRL_1</span>:
	<span class="k">case</span> <span class="n">RT5631_ADC_REC_MIXER</span>:
	<span class="k">case</span> <span class="n">RT5631_ADC_CTRL_2</span>:
	<span class="k">case</span> <span class="n">RT5631_VDAC_DIG_VOL</span>:
	<span class="k">case</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_AXO1MIXER_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_AXO2MIXER_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_MIC_CTRL_2</span>:
	<span class="k">case</span> <span class="n">RT5631_DIG_MIC_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_MONO_INPUT_VOL</span>:
	<span class="k">case</span> <span class="n">RT5631_SPK_MIXER_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_SPK_MONO_OUT_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_SPK_MONO_HP_OUT_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_SDP_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_MONO_SDP_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_STEREO_AD_DA_CLK_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_PWR_MANAG_ADD1</span>:
	<span class="k">case</span> <span class="n">RT5631_PWR_MANAG_ADD2</span>:
	<span class="k">case</span> <span class="n">RT5631_PWR_MANAG_ADD3</span>:
	<span class="k">case</span> <span class="n">RT5631_PWR_MANAG_ADD4</span>:
	<span class="k">case</span> <span class="n">RT5631_GEN_PUR_CTRL_REG</span>:
	<span class="k">case</span> <span class="n">RT5631_GLOBAL_CLK_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_PLL_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_1</span>:
	<span class="k">case</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span>:
	<span class="k">case</span> <span class="n">RT5631_GPIO_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_MISC_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_DEPOP_FUN_CTRL_1</span>:
	<span class="k">case</span> <span class="n">RT5631_DEPOP_FUN_CTRL_2</span>:
	<span class="k">case</span> <span class="n">RT5631_JACK_DET_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_SOFT_VOL_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_ALC_CTRL_1</span>:
	<span class="k">case</span> <span class="n">RT5631_ALC_CTRL_2</span>:
	<span class="k">case</span> <span class="n">RT5631_ALC_CTRL_3</span>:
	<span class="k">case</span> <span class="n">RT5631_PSEUDO_SPATL_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_INDEX_ADD</span>:
	<span class="k">case</span> <span class="n">RT5631_INDEX_DATA</span>:
	<span class="k">case</span> <span class="n">RT5631_EQ_CTRL</span>:
	<span class="k">case</span> <span class="n">RT5631_VENDOR_ID</span>:
	<span class="k">case</span> <span class="n">RT5631_VENDOR_ID1</span>:
	<span class="k">case</span> <span class="n">RT5631_VENDOR_ID2</span>:
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">out_vol_tlv</span><span class="p">,</span> <span class="o">-</span><span class="mi">4650</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">dac_vol_tlv</span><span class="p">,</span> <span class="o">-</span><span class="mi">95625</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">in_vol_tlv</span><span class="p">,</span> <span class="o">-</span><span class="mi">3450</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="cm">/* {0, +20, +24, +30, +35, +40, +44, +50, +52}dB */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mic_bst_tlv</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">TLV_DB_RANGE_HEAD</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">2400</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">4400</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">5000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">TLV_DB_SCALE_ITEM</span><span class="p">(</span><span class="mi">5200</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_dmic_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">dmic_used_flag</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_dmic_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">snd_ctl_elem_value</span> <span class="o">*</span><span class="n">ucontrol</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">snd_kcontrol_chip</span><span class="p">(</span><span class="n">kcontrol</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">dmic_used_flag</span> <span class="o">=</span> <span class="n">ucontrol</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">.</span><span class="n">integer</span><span class="p">.</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* MIC Input Type */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_input_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Single ended&quot;</span><span class="p">,</span> <span class="s">&quot;Differential&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_mic1_mode_enum</span><span class="p">,</span> <span class="n">RT5631_MIC_CTRL_1</span><span class="p">,</span>
	<span class="n">RT5631_MIC1_DIFF_INPUT_SHIFT</span><span class="p">,</span> <span class="n">rt5631_input_mode</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_mic2_mode_enum</span><span class="p">,</span> <span class="n">RT5631_MIC_CTRL_1</span><span class="p">,</span>
	<span class="n">RT5631_MIC2_DIFF_INPUT_SHIFT</span><span class="p">,</span> <span class="n">rt5631_input_mode</span><span class="p">);</span>

<span class="cm">/* MONO Input Type */</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_monoin_mode_enum</span><span class="p">,</span> <span class="n">RT5631_MONO_INPUT_VOL</span><span class="p">,</span>
	<span class="n">RT5631_MONO_DIFF_INPUT_SHIFT</span><span class="p">,</span> <span class="n">rt5631_input_mode</span><span class="p">);</span>

<span class="cm">/* SPK Ratio Gain Control */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_spk_ratio</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;1.00x&quot;</span><span class="p">,</span> <span class="s">&quot;1.09x&quot;</span><span class="p">,</span> <span class="s">&quot;1.27x&quot;</span><span class="p">,</span> <span class="s">&quot;1.44x&quot;</span><span class="p">,</span>
			<span class="s">&quot;1.56x&quot;</span><span class="p">,</span> <span class="s">&quot;1.68x&quot;</span><span class="p">,</span> <span class="s">&quot;1.99x&quot;</span><span class="p">,</span> <span class="s">&quot;2.34x&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_spk_ratio_enum</span><span class="p">,</span> <span class="n">RT5631_GEN_PUR_CTRL_REG</span><span class="p">,</span>
	<span class="n">RT5631_SPK_AMP_RATIO_CTRL_SHIFT</span><span class="p">,</span> <span class="n">rt5631_spk_ratio</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_snd_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* MIC */</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;MIC1 Mode Control&quot;</span><span class="p">,</span>  <span class="n">rt5631_mic1_mode_enum</span><span class="p">),</span>
	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;MIC1 Boost&quot;</span><span class="p">,</span> <span class="n">RT5631_MIC_CTRL_2</span><span class="p">,</span>
		<span class="n">RT5631_MIC1_BOOST_SHIFT</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mic_bst_tlv</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;MIC2 Mode Control&quot;</span><span class="p">,</span> <span class="n">rt5631_mic2_mode_enum</span><span class="p">),</span>
	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;MIC2 Boost&quot;</span><span class="p">,</span> <span class="n">RT5631_MIC_CTRL_2</span><span class="p">,</span>
		<span class="n">RT5631_MIC2_BOOST_SHIFT</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mic_bst_tlv</span><span class="p">),</span>
	<span class="cm">/* MONO IN */</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;MONOIN Mode Control&quot;</span><span class="p">,</span> <span class="n">rt5631_monoin_mode_enum</span><span class="p">),</span>
	<span class="n">SOC_DOUBLE_TLV</span><span class="p">(</span><span class="s">&quot;MONOIN_RX Capture Volume&quot;</span><span class="p">,</span> <span class="n">RT5631_MONO_INPUT_VOL</span><span class="p">,</span>
			<span class="n">RT5631_L_VOL_SHIFT</span><span class="p">,</span> <span class="n">RT5631_R_VOL_SHIFT</span><span class="p">,</span>
			<span class="n">RT5631_VOL_MASK</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">in_vol_tlv</span><span class="p">),</span>
	<span class="cm">/* AXI */</span>
	<span class="n">SOC_DOUBLE_TLV</span><span class="p">(</span><span class="s">&quot;AXI Capture Volume&quot;</span><span class="p">,</span> <span class="n">RT5631_AUX_IN_VOL</span><span class="p">,</span>
			<span class="n">RT5631_L_VOL_SHIFT</span><span class="p">,</span> <span class="n">RT5631_R_VOL_SHIFT</span><span class="p">,</span>
			<span class="n">RT5631_VOL_MASK</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">in_vol_tlv</span><span class="p">),</span>
	<span class="cm">/* DAC */</span>
	<span class="n">SOC_DOUBLE_TLV</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="n">RT5631_STEREO_DAC_VOL_2</span><span class="p">,</span>
			<span class="n">RT5631_L_VOL_SHIFT</span><span class="p">,</span> <span class="n">RT5631_R_VOL_SHIFT</span><span class="p">,</span>
			<span class="n">RT5631_DAC_VOL_MASK</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dac_vol_tlv</span><span class="p">),</span>
	<span class="n">SOC_DOUBLE</span><span class="p">(</span><span class="s">&quot;PCM Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_STEREO_DAC_VOL_1</span><span class="p">,</span>
			<span class="n">RT5631_L_MUTE_SHIFT</span><span class="p">,</span> <span class="n">RT5631_R_MUTE_SHIFT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="cm">/* AXO */</span>
	<span class="n">SOC_SINGLE</span><span class="p">(</span><span class="s">&quot;AXO1 Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_MONO_AXO_1_2_VOL</span><span class="p">,</span>
				<span class="n">RT5631_L_MUTE_SHIFT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_SINGLE</span><span class="p">(</span><span class="s">&quot;AXO2 Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_MONO_AXO_1_2_VOL</span><span class="p">,</span>
				<span class="n">RT5631_R_VOL_SHIFT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="cm">/* OUTVOL */</span>
	<span class="n">SOC_DOUBLE</span><span class="p">(</span><span class="s">&quot;OUTVOL Channel Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_OUT_VOL</span><span class="p">,</span>
		<span class="n">RT5631_L_EN_SHIFT</span><span class="p">,</span> <span class="n">RT5631_R_EN_SHIFT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* SPK */</span>
	<span class="n">SOC_DOUBLE</span><span class="p">(</span><span class="s">&quot;Speaker Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_OUT_VOL</span><span class="p">,</span>
		<span class="n">RT5631_L_MUTE_SHIFT</span><span class="p">,</span> <span class="n">RT5631_R_MUTE_SHIFT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DOUBLE_TLV</span><span class="p">(</span><span class="s">&quot;Speaker Playback Volume&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_OUT_VOL</span><span class="p">,</span>
		<span class="n">RT5631_L_VOL_SHIFT</span><span class="p">,</span> <span class="n">RT5631_R_VOL_SHIFT</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out_vol_tlv</span><span class="p">),</span>
	<span class="cm">/* MONO OUT */</span>
	<span class="n">SOC_SINGLE</span><span class="p">(</span><span class="s">&quot;MONO Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_MONO_AXO_1_2_VOL</span><span class="p">,</span>
				<span class="n">RT5631_MUTE_MONO_SHIFT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="cm">/* HP */</span>
	<span class="n">SOC_DOUBLE</span><span class="p">(</span><span class="s">&quot;HP Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_HP_OUT_VOL</span><span class="p">,</span>
		<span class="n">RT5631_L_MUTE_SHIFT</span><span class="p">,</span> <span class="n">RT5631_R_MUTE_SHIFT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DOUBLE_TLV</span><span class="p">(</span><span class="s">&quot;HP Playback Volume&quot;</span><span class="p">,</span> <span class="n">RT5631_HP_OUT_VOL</span><span class="p">,</span>
		<span class="n">RT5631_L_VOL_SHIFT</span><span class="p">,</span> <span class="n">RT5631_R_VOL_SHIFT</span><span class="p">,</span>
		<span class="n">RT5631_VOL_MASK</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out_vol_tlv</span><span class="p">),</span>
	<span class="cm">/* DMIC */</span>
	<span class="n">SOC_SINGLE_EXT</span><span class="p">(</span><span class="s">&quot;DMIC Switch&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">rt5631_dmic_get</span><span class="p">,</span> <span class="n">rt5631_dmic_put</span><span class="p">),</span>
	<span class="n">SOC_DOUBLE</span><span class="p">(</span><span class="s">&quot;DMIC Capture Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_DIG_MIC_CTRL</span><span class="p">,</span>
		<span class="n">RT5631_DMIC_L_CH_MUTE_SHIFT</span><span class="p">,</span>
		<span class="n">RT5631_DMIC_R_CH_MUTE_SHIFT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="cm">/* SPK Ratio Gain Control */</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;SPK Ratio Control&quot;</span><span class="p">,</span> <span class="n">rt5631_spk_ratio_enum</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">check_sysclk1_source</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">source</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">sink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">source</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_GLOBAL_CLK_CTRL</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="n">RT5631_SYSCLK_SOUR_SEL_PLL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">check_dmic_used</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">source</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">sink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">source</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">dmic_used_flag</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">check_dacl_to_outmixl</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">source</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">sink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">source</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">RT5631_M_DAC_L_TO_OUTMIXER_L</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">check_dacr_to_outmixr</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">source</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">sink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">source</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">RT5631_M_DAC_R_TO_OUTMIXER_R</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">check_dacl_to_spkmixl</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">source</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">sink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">source</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">RT5631_M_DAC_L_TO_SPKMIXER_L</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">check_dacr_to_spkmixr</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">source</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">sink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">source</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">RT5631_M_DAC_R_TO_SPKMIXER_R</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">check_adcl_select</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">source</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">sink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">source</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">RT5631_M_MIC1_TO_RECMIXER_L</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">check_adcr_select</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">source</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">sink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">source</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">RT5631_M_MIC2_TO_RECMIXER_R</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * onebit_depop_power_stage - auto depop in power stage.</span>
<span class="cm"> * @enable: power on/off</span>
<span class="cm"> *</span>
<span class="cm"> * When power on/off headphone, the depop sequence is done by hardware.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">onebit_depop_power_stage</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">soft_vol</span><span class="p">,</span> <span class="n">hp_zc</span><span class="p">;</span>

	<span class="cm">/* enable one-bit depop function */</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_2</span><span class="p">,</span>
				<span class="n">RT5631_EN_ONE_BIT_DEPOP</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* keep soft volume and zero crossing setting */</span>
	<span class="n">soft_vol</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">hp_zc</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span> <span class="n">hp_zc</span> <span class="o">&amp;</span> <span class="mh">0xf7ff</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* config one-bit depop parameter */</span>
		<span class="n">rt5631_write_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_TEST_MODE_CTRL</span><span class="p">,</span> <span class="mh">0x84c0</span><span class="p">);</span>
		<span class="n">rt5631_write_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SPK_INTL_CTRL</span><span class="p">,</span> <span class="mh">0x309f</span><span class="p">);</span>
		<span class="n">rt5631_write_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_CP_INTL_REG2</span><span class="p">,</span> <span class="mh">0x6530</span><span class="p">);</span>
		<span class="cm">/* power on capless block */</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_2</span><span class="p">,</span>
				<span class="n">RT5631_EN_CAP_FREE_DEPOP</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* power off capless block */</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* recover soft volume and zero crossing setting */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">,</span> <span class="n">soft_vol</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span> <span class="n">hp_zc</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * onebit_depop_mute_stage - auto depop in mute stage.</span>
<span class="cm"> * @enable: mute/unmute</span>
<span class="cm"> *</span>
<span class="cm"> * When mute/unmute headphone, the depop sequence is done by hardware.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">onebit_depop_mute_stage</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">soft_vol</span><span class="p">,</span> <span class="n">hp_zc</span><span class="p">;</span>

	<span class="cm">/* enable one-bit depop function */</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_2</span><span class="p">,</span>
				<span class="n">RT5631_EN_ONE_BIT_DEPOP</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* keep soft volume and zero crossing setting */</span>
	<span class="n">soft_vol</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">hp_zc</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span> <span class="n">hp_zc</span> <span class="o">&amp;</span> <span class="mh">0xf7ff</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">schedule_timeout_uninterruptible</span><span class="p">(</span><span class="n">msecs_to_jiffies</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>
		<span class="cm">/* config one-bit depop parameter */</span>
		<span class="n">rt5631_write_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SPK_INTL_CTRL</span><span class="p">,</span> <span class="mh">0x307f</span><span class="p">);</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_HP_OUT_VOL</span><span class="p">,</span>
				<span class="n">RT5631_L_MUTE</span> <span class="o">|</span> <span class="n">RT5631_R_MUTE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">300</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_HP_OUT_VOL</span><span class="p">,</span>
			<span class="n">RT5631_L_MUTE</span> <span class="o">|</span> <span class="n">RT5631_R_MUTE</span><span class="p">,</span>
			<span class="n">RT5631_L_MUTE</span> <span class="o">|</span> <span class="n">RT5631_R_MUTE</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* recover soft volume and zero crossing setting */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">,</span> <span class="n">soft_vol</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span> <span class="n">hp_zc</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * onebit_depop_power_stage - step by step depop sequence in power stage.</span>
<span class="cm"> * @enable: power on/off</span>
<span class="cm"> *</span>
<span class="cm"> * When power on/off headphone, the depop sequence is done in step by step.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">depop_seq_power_stage</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">soft_vol</span><span class="p">,</span> <span class="n">hp_zc</span><span class="p">;</span>

	<span class="cm">/* depop control by register */</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_2</span><span class="p">,</span>
		<span class="n">RT5631_EN_ONE_BIT_DEPOP</span><span class="p">,</span> <span class="n">RT5631_EN_ONE_BIT_DEPOP</span><span class="p">);</span>

	<span class="cm">/* keep soft volume and zero crossing setting */</span>
	<span class="n">soft_vol</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">hp_zc</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span> <span class="n">hp_zc</span> <span class="o">&amp;</span> <span class="mh">0xf7ff</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* config depop sequence parameter */</span>
		<span class="n">rt5631_write_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SPK_INTL_CTRL</span><span class="p">,</span> <span class="mh">0x303e</span><span class="p">);</span>

		<span class="cm">/* power on headphone and charge pump */</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
			<span class="n">RT5631_PWR_CHARGE_PUMP</span> <span class="o">|</span> <span class="n">RT5631_PWR_HP_L_AMP</span> <span class="o">|</span>
			<span class="n">RT5631_PWR_HP_R_AMP</span><span class="p">,</span>
			<span class="n">RT5631_PWR_CHARGE_PUMP</span> <span class="o">|</span> <span class="n">RT5631_PWR_HP_L_AMP</span> <span class="o">|</span>
			<span class="n">RT5631_PWR_HP_R_AMP</span><span class="p">);</span>

		<span class="cm">/* power on soft generator and depop mode2 */</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_1</span><span class="p">,</span>
			<span class="n">RT5631_POW_ON_SOFT_GEN</span> <span class="o">|</span> <span class="n">RT5631_EN_DEPOP2_FOR_HP</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

		<span class="cm">/* stop depop mode */</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
			<span class="n">RT5631_PWR_HP_DEPOP_DIS</span><span class="p">,</span> <span class="n">RT5631_PWR_HP_DEPOP_DIS</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* config depop sequence parameter */</span>
		<span class="n">rt5631_write_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SPK_INTL_CTRL</span><span class="p">,</span> <span class="mh">0x303F</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_1</span><span class="p">,</span>
			<span class="n">RT5631_POW_ON_SOFT_GEN</span> <span class="o">|</span> <span class="n">RT5631_EN_MUTE_UNMUTE_DEPOP</span> <span class="o">|</span>
			<span class="n">RT5631_PD_HPAMP_L_ST_UP</span> <span class="o">|</span> <span class="n">RT5631_PD_HPAMP_R_ST_UP</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">75</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_1</span><span class="p">,</span>
			<span class="n">RT5631_POW_ON_SOFT_GEN</span> <span class="o">|</span> <span class="n">RT5631_PD_HPAMP_L_ST_UP</span> <span class="o">|</span>
			<span class="n">RT5631_PD_HPAMP_R_ST_UP</span><span class="p">);</span>

		<span class="cm">/* start depop mode */</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
				<span class="n">RT5631_PWR_HP_DEPOP_DIS</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

		<span class="cm">/* config depop sequence parameter */</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_1</span><span class="p">,</span>
			<span class="n">RT5631_POW_ON_SOFT_GEN</span> <span class="o">|</span> <span class="n">RT5631_EN_DEPOP2_FOR_HP</span> <span class="o">|</span>
			<span class="n">RT5631_PD_HPAMP_L_ST_UP</span> <span class="o">|</span> <span class="n">RT5631_PD_HPAMP_R_ST_UP</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_1</span><span class="p">,</span>
			<span class="n">RT5631_POW_ON_SOFT_GEN</span><span class="p">);</span>

		<span class="cm">/* power down headphone and charge pump */</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
			<span class="n">RT5631_PWR_CHARGE_PUMP</span> <span class="o">|</span> <span class="n">RT5631_PWR_HP_L_AMP</span> <span class="o">|</span>
			<span class="n">RT5631_PWR_HP_R_AMP</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* recover soft volume and zero crossing setting */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">,</span> <span class="n">soft_vol</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span> <span class="n">hp_zc</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * depop_seq_mute_stage - step by step depop sequence in mute stage.</span>
<span class="cm"> * @enable: mute/unmute</span>
<span class="cm"> *</span>
<span class="cm"> * When mute/unmute headphone, the depop sequence is done in step by step.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">depop_seq_mute_stage</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">soft_vol</span><span class="p">,</span> <span class="n">hp_zc</span><span class="p">;</span>

	<span class="cm">/* depop control by register */</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_2</span><span class="p">,</span>
		<span class="n">RT5631_EN_ONE_BIT_DEPOP</span><span class="p">,</span> <span class="n">RT5631_EN_ONE_BIT_DEPOP</span><span class="p">);</span>

	<span class="cm">/* keep soft volume and zero crossing setting */</span>
	<span class="n">soft_vol</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">hp_zc</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span> <span class="n">hp_zc</span> <span class="o">&amp;</span> <span class="mh">0xf7ff</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">schedule_timeout_uninterruptible</span><span class="p">(</span><span class="n">msecs_to_jiffies</span><span class="p">(</span><span class="mi">10</span><span class="p">));</span>

		<span class="cm">/* config depop sequence parameter */</span>
		<span class="n">rt5631_write_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SPK_INTL_CTRL</span><span class="p">,</span> <span class="mh">0x302f</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_1</span><span class="p">,</span>
			<span class="n">RT5631_POW_ON_SOFT_GEN</span> <span class="o">|</span> <span class="n">RT5631_EN_MUTE_UNMUTE_DEPOP</span> <span class="o">|</span>
			<span class="n">RT5631_EN_HP_R_M_UN_MUTE_DEPOP</span> <span class="o">|</span>
			<span class="n">RT5631_EN_HP_L_M_UN_MUTE_DEPOP</span><span class="p">);</span>

		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_HP_OUT_VOL</span><span class="p">,</span>
				<span class="n">RT5631_L_MUTE</span> <span class="o">|</span> <span class="n">RT5631_R_MUTE</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">160</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* config depop sequence parameter */</span>
		<span class="n">rt5631_write_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SPK_INTL_CTRL</span><span class="p">,</span> <span class="mh">0x302f</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DEPOP_FUN_CTRL_1</span><span class="p">,</span>
			<span class="n">RT5631_POW_ON_SOFT_GEN</span> <span class="o">|</span> <span class="n">RT5631_EN_MUTE_UNMUTE_DEPOP</span> <span class="o">|</span>
			<span class="n">RT5631_EN_HP_R_M_UN_MUTE_DEPOP</span> <span class="o">|</span>
			<span class="n">RT5631_EN_HP_L_M_UN_MUTE_DEPOP</span><span class="p">);</span>

		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_HP_OUT_VOL</span><span class="p">,</span>
			<span class="n">RT5631_L_MUTE</span> <span class="o">|</span> <span class="n">RT5631_R_MUTE</span><span class="p">,</span>
			<span class="n">RT5631_L_MUTE</span> <span class="o">|</span> <span class="n">RT5631_R_MUTE</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* recover soft volume and zero crossing setting */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SOFT_VOL_CTRL</span><span class="p">,</span> <span class="n">soft_vol</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span> <span class="n">hp_zc</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hp_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAPM_PRE_PMD</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">codec_version</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">onebit_depop_mute_stage</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">onebit_depop_power_stage</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">depop_seq_mute_stage</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">depop_seq_power_stage</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SND_SOC_DAPM_POST_PMU</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">codec_version</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">onebit_depop_power_stage</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">onebit_depop_mute_stage</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">depop_seq_power_stage</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="n">depop_seq_mute_stage</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">set_dmic_params</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">rx_rate</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">44100</span>:
	<span class="k">case</span> <span class="mi">48000</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DIG_MIC_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_DMIC_CLK_CTRL_MASK</span><span class="p">,</span>
			<span class="n">RT5631_DMIC_CLK_CTRL_TO_32FS</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mi">32000</span>:
	<span class="k">case</span> <span class="mi">22050</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DIG_MIC_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_DMIC_CLK_CTRL_MASK</span><span class="p">,</span>
			<span class="n">RT5631_DMIC_CLK_CTRL_TO_64FS</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mi">16000</span>:
	<span class="k">case</span> <span class="mi">11025</span>:
	<span class="k">case</span> <span class="mi">8000</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DIG_MIC_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_DMIC_CLK_CTRL_MASK</span><span class="p">,</span>
			<span class="n">RT5631_DMIC_CLK_CTRL_TO_128FS</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_recmixl_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;OUTMIXL Capture Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">,</span>
			<span class="n">RT5631_M_OUTMIXL_RECMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1_BST1 Capture Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">,</span>
			<span class="n">RT5631_M_MIC1_RECMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;AXILVOL Capture Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">,</span>
			<span class="n">RT5631_M_AXIL_RECMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MONOIN_RX Capture Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">,</span>
			<span class="n">RT5631_M_MONO_IN_RECMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_recmixr_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MONOIN_RX Capture Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">,</span>
			<span class="n">RT5631_M_MONO_IN_RECMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;AXIRVOL Capture Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">,</span>
			<span class="n">RT5631_M_AXIR_RECMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2_BST2 Capture Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">,</span>
			<span class="n">RT5631_M_MIC2_RECMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;OUTMIXR Capture Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_ADC_REC_MIXER</span><span class="p">,</span>
			<span class="n">RT5631_M_OUTMIXR_RECMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_spkmixl_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RECMIXL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_M_RECMIXL_SPKMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1_P Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_M_MIC1P_SPKMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;DACL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_M_DACL_SPKMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;OUTMIXL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_M_OUTMIXL_SPKMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_spkmixr_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;OUTMIXR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_M_OUTMIXR_SPKMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;DACR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_M_DACR_SPKMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2_P Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_M_MIC2P_SPKMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RECMIXR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MIXER_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_M_RECMIXR_SPKMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_outmixl_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RECMIXL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_RECMIXL_OUTMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RECMIXR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_RECMIXR_OUTMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;DACL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_DACL_OUTMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1_BST1 Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_MIC1_OUTMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2_BST2 Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_MIC2_OUTMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MONOIN_RXP Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_MONO_INP_OUTMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;AXILVOL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_AXIL_OUTMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;AXIRVOL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_AXIR_OUTMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;VDAC Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_L_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_VDAC_OUTMIXL_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_outmixr_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;VDAC Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_VDAC_OUTMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;AXIRVOL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_AXIR_OUTMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;AXILVOL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_AXIL_OUTMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MONOIN_RXN Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_MONO_INN_OUTMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2_BST2 Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_MIC2_OUTMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1_BST1 Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_MIC1_OUTMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;DACR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_DACR_OUTMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RECMIXR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_RECMIXR_OUTMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;RECMIXL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_OUTMIXER_R_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_RECMIXL_OUTMIXR_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_AXO1MIX_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1_BST1 Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_AXO1MIXER_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_MIC1_AXO1MIX_BIT</span> <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2_BST2 Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_AXO1MIXER_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_MIC2_AXO1MIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;OUTVOLL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_AXO1MIXER_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_OUTMIXL_AXO1MIX_BIT</span> <span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;OUTVOLR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_AXO1MIXER_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_OUTMIXR_AXO1MIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_AXO2MIX_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC1_BST1 Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_AXO2MIXER_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_MIC1_AXO2MIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;MIC2_BST2 Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_AXO2MIXER_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_MIC2_AXO2MIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;OUTVOLL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_AXO2MIXER_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_OUTMIXL_AXO2MIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;OUTVOLR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_AXO2MIXER_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_OUTMIXR_AXO2MIX_BIT</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_spolmix_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;SPKVOLL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_OUT_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_SPKVOLL_SPOLMIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;SPKVOLR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_OUT_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_SPKVOLR_SPOLMIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_spormix_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;SPKVOLL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_OUT_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_SPKVOLL_SPORMIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;SPKVOLR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_OUT_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_SPKVOLR_SPORMIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_monomix_mixer_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;OUTVOLL Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_OUT_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_OUTVOLL_MONOMIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;OUTVOLR Playback Switch&quot;</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_OUT_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_M_OUTVOLR_MONOMIX_BIT</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* Left SPK Volume Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_spkvoll_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;SPKMIXL&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_spkvoll_enum</span><span class="p">,</span> <span class="n">RT5631_SPK_OUT_VOL</span><span class="p">,</span>
	<span class="n">RT5631_L_EN_SHIFT</span><span class="p">,</span> <span class="n">rt5631_spkvoll_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_spkvoll_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Left SPKVOL SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_spkvoll_enum</span><span class="p">);</span>

<span class="cm">/* Left HP Volume Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_hpvoll_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXL&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_hpvoll_enum</span><span class="p">,</span> <span class="n">RT5631_HP_OUT_VOL</span><span class="p">,</span>
	<span class="n">RT5631_L_EN_SHIFT</span><span class="p">,</span> <span class="n">rt5631_hpvoll_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_hpvoll_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Left HPVOL SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_hpvoll_enum</span><span class="p">);</span>

<span class="cm">/* Left Out Volume Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_outvoll_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXL&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_outvoll_enum</span><span class="p">,</span> <span class="n">RT5631_MONO_AXO_1_2_VOL</span><span class="p">,</span>
	<span class="n">RT5631_L_EN_SHIFT</span><span class="p">,</span> <span class="n">rt5631_outvoll_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_outvoll_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Left OUTVOL SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_outvoll_enum</span><span class="p">);</span>

<span class="cm">/* Right Out Volume Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_outvolr_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXR&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_outvolr_enum</span><span class="p">,</span> <span class="n">RT5631_MONO_AXO_1_2_VOL</span><span class="p">,</span>
	<span class="n">RT5631_R_EN_SHIFT</span><span class="p">,</span> <span class="n">rt5631_outvolr_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_outvolr_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Right OUTVOL SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_outvolr_enum</span><span class="p">);</span>

<span class="cm">/* Right HP Volume Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_hpvolr_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXR&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_hpvolr_enum</span><span class="p">,</span> <span class="n">RT5631_HP_OUT_VOL</span><span class="p">,</span>
	<span class="n">RT5631_R_EN_SHIFT</span><span class="p">,</span> <span class="n">rt5631_hpvolr_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_hpvolr_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Right HPVOL SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_hpvolr_enum</span><span class="p">);</span>

<span class="cm">/* Right SPK Volume Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_spkvolr_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;SPKMIXR&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_spkvolr_enum</span><span class="p">,</span> <span class="n">RT5631_SPK_OUT_VOL</span><span class="p">,</span>
	<span class="n">RT5631_R_EN_SHIFT</span><span class="p">,</span> <span class="n">rt5631_spkvolr_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_spkvolr_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Right SPKVOL SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_spkvolr_enum</span><span class="p">);</span>

<span class="cm">/* SPO Left Channel Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_spol_src_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;SPOLMIX&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RX&quot;</span><span class="p">,</span> <span class="s">&quot;VDAC&quot;</span><span class="p">,</span> <span class="s">&quot;DACL&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_spol_src_enum</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_HP_OUT_CTRL</span><span class="p">,</span>
	<span class="n">RT5631_SPK_L_MUX_SEL_SHIFT</span><span class="p">,</span> <span class="n">rt5631_spol_src_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_spol_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;SPOL SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_spol_src_enum</span><span class="p">);</span>

<span class="cm">/* SPO Right Channel Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_spor_src_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;SPORMIX&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RX&quot;</span><span class="p">,</span> <span class="s">&quot;VDAC&quot;</span><span class="p">,</span> <span class="s">&quot;DACR&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_spor_src_enum</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_HP_OUT_CTRL</span><span class="p">,</span>
	<span class="n">RT5631_SPK_R_MUX_SEL_SHIFT</span><span class="p">,</span> <span class="n">rt5631_spor_src_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_spor_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;SPOR SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_spor_src_enum</span><span class="p">);</span>

<span class="cm">/* MONO Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_mono_src_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;MONOMIX&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RX&quot;</span><span class="p">,</span> <span class="s">&quot;VDAC&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_mono_src_enum</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_HP_OUT_CTRL</span><span class="p">,</span>
	<span class="n">RT5631_MONO_MUX_SEL_SHIFT</span><span class="p">,</span> <span class="n">rt5631_mono_src_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_mono_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;MONO SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_mono_src_enum</span><span class="p">);</span>

<span class="cm">/* Left HPO Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_hpl_src_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Left HPVOL&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_hpl_src_enum</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_HP_OUT_CTRL</span><span class="p">,</span>
	<span class="n">RT5631_HP_L_MUX_SEL_SHIFT</span><span class="p">,</span> <span class="n">rt5631_hpl_src_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_hpl_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;HPL SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_hpl_src_enum</span><span class="p">);</span>

<span class="cm">/* Right HPO Input */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rt5631_hpr_src_sel</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Right HPVOL&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">SOC_ENUM_SINGLE_DECL</span><span class="p">(</span>
	<span class="n">rt5631_hpr_src_enum</span><span class="p">,</span> <span class="n">RT5631_SPK_MONO_HP_OUT_CTRL</span><span class="p">,</span>
	<span class="n">RT5631_HP_R_MUX_SEL_SHIFT</span><span class="p">,</span> <span class="n">rt5631_hpr_src_sel</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">rt5631_hpr_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;HPR SRC&quot;</span><span class="p">,</span> <span class="n">rt5631_hpr_src_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="n">rt5631_dapm_widgets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Vmid */</span>
	<span class="n">SND_SOC_DAPM_VMID</span><span class="p">(</span><span class="s">&quot;Vmid&quot;</span><span class="p">),</span>
	<span class="cm">/* PLL1 */</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;PLL1&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
			<span class="n">RT5631_PWR_PLL1_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* Input Side */</span>
	<span class="cm">/* Input Lines */</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;MIC1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;MIC2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;AXIL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;AXIR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;MONOIN_RXN&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;MONOIN_RXP&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;DMIC&quot;</span><span class="p">),</span>

	<span class="cm">/* MICBIAS */</span>
	<span class="n">SND_SOC_DAPM_MICBIAS</span><span class="p">(</span><span class="s">&quot;MIC Bias1&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MICBIAS1_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MICBIAS</span><span class="p">(</span><span class="s">&quot;MIC Bias2&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MICBIAS2_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* Boost */</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;MIC1 Boost&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MIC1_BOOT_GAIN_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;MIC2 Boost&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MIC2_BOOT_GAIN_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;MONOIN_RXP Boost&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MONO_IN_P_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;MONOIN_RXN Boost&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MONO_IN_N_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;AXIL Boost&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span>
			<span class="n">RT5631_PWR_AXIL_IN_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;AXIR Boost&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span>
			<span class="n">RT5631_PWR_AXIR_IN_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* MONO In */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;MONO_IN&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* REC Mixer */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;RECMIXL Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
		<span class="n">RT5631_PWR_RECMIXER_L_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">rt5631_recmixl_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_recmixl_mixer_controls</span><span class="p">)),</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;RECMIXR Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
		<span class="n">RT5631_PWR_RECMIXER_R_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">rt5631_recmixr_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_recmixr_mixer_controls</span><span class="p">)),</span>
	<span class="cm">/* Because of record duplication for L/R channel,</span>
<span class="cm">	 * L/R ADCs need power up at the same time */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;ADC Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* DMIC */</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;DMIC Supply&quot;</span><span class="p">,</span> <span class="n">RT5631_DIG_MIC_CTRL</span><span class="p">,</span>
		<span class="n">RT5631_DMIC_ENA_SHIFT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">set_dmic_params</span><span class="p">,</span> <span class="n">SND_SOC_DAPM_PRE_PMU</span><span class="p">),</span>
	<span class="cm">/* ADC Data Srouce */</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;Left ADC Select&quot;</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span>
			<span class="n">RT5631_ADC_DATA_SEL_MIC1_SHIFT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;Right ADC Select&quot;</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span>
			<span class="n">RT5631_ADC_DATA_SEL_MIC2_SHIFT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* ADCs */</span>
	<span class="n">SND_SOC_DAPM_ADC</span><span class="p">(</span><span class="s">&quot;Left ADC&quot;</span><span class="p">,</span> <span class="s">&quot;HIFI Capture&quot;</span><span class="p">,</span>
		<span class="n">RT5631_PWR_MANAG_ADD1</span><span class="p">,</span> <span class="n">RT5631_PWR_ADC_L_CLK_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_ADC</span><span class="p">(</span><span class="s">&quot;Right ADC&quot;</span><span class="p">,</span> <span class="s">&quot;HIFI Capture&quot;</span><span class="p">,</span>
		<span class="n">RT5631_PWR_MANAG_ADD1</span><span class="p">,</span> <span class="n">RT5631_PWR_ADC_R_CLK_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* DAC and ADC supply power */</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;I2S&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD1</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MAIN_I2S_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;DAC REF&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD1</span><span class="p">,</span>
			<span class="n">RT5631_PWR_DAC_REF_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* Output Side */</span>
	<span class="cm">/* DACs */</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;Left DAC&quot;</span><span class="p">,</span> <span class="s">&quot;HIFI Playback&quot;</span><span class="p">,</span>
		<span class="n">RT5631_PWR_MANAG_ADD1</span><span class="p">,</span> <span class="n">RT5631_PWR_DAC_L_CLK_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;Right DAC&quot;</span><span class="p">,</span> <span class="s">&quot;HIFI Playback&quot;</span><span class="p">,</span>
		<span class="n">RT5631_PWR_MANAG_ADD1</span><span class="p">,</span> <span class="n">RT5631_PWR_DAC_R_CLK_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;Voice DAC&quot;</span><span class="p">,</span> <span class="s">&quot;Voice DAC Mono Playback&quot;</span><span class="p">,</span>
				<span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Voice DAC Boost&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="cm">/* DAC supply power */</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;Left DAC To Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD1</span><span class="p">,</span>
			<span class="n">RT5631_PWR_DAC_L_TO_MIXER_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;Right DAC To Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD1</span><span class="p">,</span>
			<span class="n">RT5631_PWR_DAC_R_TO_MIXER_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* Left SPK Mixer */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;SPKMIXL Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
			<span class="n">RT5631_PWR_SPKMIXER_L_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_spkmixl_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_spkmixl_mixer_controls</span><span class="p">)),</span>
	<span class="cm">/* Left Out Mixer */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
			<span class="n">RT5631_PWR_OUTMIXER_L_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_outmixl_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_outmixl_mixer_controls</span><span class="p">)),</span>
	<span class="cm">/* Right Out Mixer */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
			<span class="n">RT5631_PWR_OUTMIXER_R_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_outmixr_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_outmixr_mixer_controls</span><span class="p">)),</span>
	<span class="cm">/* Right SPK Mixer */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;SPKMIXR Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
			<span class="n">RT5631_PWR_SPKMIXER_R_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_spkmixr_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_spkmixr_mixer_controls</span><span class="p">)),</span>

	<span class="cm">/* Volume Mux */</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Left SPKVOL Mux&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span>
			<span class="n">RT5631_PWR_SPK_L_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_spkvoll_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Left HPVOL Mux&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span>
			<span class="n">RT5631_PWR_HP_L_OUT_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_hpvoll_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Left OUTVOL Mux&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span>
			<span class="n">RT5631_PWR_LOUT_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_outvoll_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Right OUTVOL Mux&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span>
			<span class="n">RT5631_PWR_ROUT_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_outvolr_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Right HPVOL Mux&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span>
			<span class="n">RT5631_PWR_HP_R_OUT_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_hpvolr_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Right SPKVOL Mux&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span>
			<span class="n">RT5631_PWR_SPK_R_VOL_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_spkvolr_mux_control</span><span class="p">),</span>

	<span class="cm">/* DAC To HP */</span>
	<span class="n">SND_SOC_DAPM_PGA_S</span><span class="p">(</span><span class="s">&quot;Left DAC_HP&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA_S</span><span class="p">(</span><span class="s">&quot;Right DAC_HP&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* HP Depop */</span>
	<span class="n">SND_SOC_DAPM_PGA_S</span><span class="p">(</span><span class="s">&quot;HP Depop&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">hp_event</span><span class="p">,</span> <span class="n">SND_SOC_DAPM_PRE_PMD</span> <span class="o">|</span> <span class="n">SND_SOC_DAPM_POST_PMU</span><span class="p">),</span>

	<span class="cm">/* AXO1 Mixer */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;AXO1MIX Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
			<span class="n">RT5631_PWR_AXO1MIXER_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_AXO1MIX_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_AXO1MIX_mixer_controls</span><span class="p">)),</span>
	<span class="cm">/* SPOL Mixer */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;SPOLMIX Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_spolmix_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_spolmix_mixer_controls</span><span class="p">)),</span>
	<span class="cm">/* MONO Mixer */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;MONOMIX Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MONOMIXER_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_monomix_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_monomix_mixer_controls</span><span class="p">)),</span>
	<span class="cm">/* SPOR Mixer */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;SPORMIX Mixer&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_spormix_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_spormix_mixer_controls</span><span class="p">)),</span>
	<span class="cm">/* AXO2 Mixer */</span>
	<span class="n">SND_SOC_DAPM_MIXER</span><span class="p">(</span><span class="s">&quot;AXO2MIX Mixer&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
			<span class="n">RT5631_PWR_AXO2MIXER_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_AXO2MIX_mixer_controls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_AXO2MIX_mixer_controls</span><span class="p">)),</span>

	<span class="cm">/* Mux */</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;SPOL Mux&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_spol_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;SPOR Mux&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_spor_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;MONO Mux&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_mono_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;HPL Mux&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_hpl_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;HPR Mux&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">rt5631_hpr_mux_control</span><span class="p">),</span>

	<span class="cm">/* AMP supply */</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;MONO Depop&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MONO_DEPOP_DIS_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;Class D&quot;</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD1</span><span class="p">,</span>
			<span class="n">RT5631_PWR_CLASS_D_BIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* Output Lines */</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;AUXO1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;AUXO2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;SPOL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;SPOR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;HPOL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;HPOR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;MONO&quot;</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dapm_route</span> <span class="n">rt5631_dapm_routes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="s">&quot;MIC1 Boost&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MIC1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;MIC2 Boost&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MIC2&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;MONOIN_RXP Boost&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MONOIN_RXP&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;MONOIN_RXN Boost&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MONOIN_RXN&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;AXIL Boost&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;AXIL&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;AXIR Boost&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;AXIR&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;MONO_IN&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MONOIN_RXP Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;MONO_IN&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MONOIN_RXN Boost&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;RECMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXL Capture Switch&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RECMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1_BST1 Capture Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RECMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;AXILVOL Capture Switch&quot;</span><span class="p">,</span> <span class="s">&quot;AXIL Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RECMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RX Capture Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MONO_IN&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;RECMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXR Capture Switch&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RECMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2_BST2 Capture Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RECMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;AXIRVOL Capture Switch&quot;</span><span class="p">,</span> <span class="s">&quot;AXIR Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;RECMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RX Capture Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MONO_IN&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;ADC Mixer&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;RECMIXL Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;ADC Mixer&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;RECMIXR Mixer&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;Left ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;ADC Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Left ADC Select&quot;</span><span class="p">,</span> <span class="n">check_adcl_select</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;PLL1&quot;</span><span class="p">,</span> <span class="n">check_sysclk1_source</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;I2S&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC REF&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;Right ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;ADC Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Right ADC Select&quot;</span><span class="p">,</span> <span class="n">check_adcr_select</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;PLL1&quot;</span><span class="p">,</span> <span class="n">check_sysclk1_source</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;I2S&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC REF&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;DMIC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC Supply&quot;</span><span class="p">,</span> <span class="n">check_dmic_used</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;Left DAC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;PLL1&quot;</span><span class="p">,</span> <span class="n">check_sysclk1_source</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left DAC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;I2S&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left DAC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC REF&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right DAC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;PLL1&quot;</span><span class="p">,</span> <span class="n">check_sysclk1_source</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right DAC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;I2S&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right DAC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC REF&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;Voice DAC Boost&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Voice DAC&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;SPKMIXL Mixer&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Left DAC To Mixer&quot;</span><span class="p">,</span> <span class="n">check_dacl_to_spkmixl</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPKMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXL Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPKMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1_P Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPKMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;DACL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPKMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;SPKMIXR Mixer&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Right DAC To Mixer&quot;</span><span class="p">,</span> <span class="n">check_dacr_to_spkmixr</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPKMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPKMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;DACR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPKMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2_P Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPKMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXR Mixer&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Left DAC To Mixer&quot;</span><span class="p">,</span> <span class="n">check_dacl_to_outmixl</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXL Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXR Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;DACL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1_BST1 Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2_BST2 Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RXP Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RXP Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;AXILVOL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;AXIL Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;AXIRVOL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;AXIR Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;VDAC Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Voice DAC Boost&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Right DAC To Mixer&quot;</span><span class="p">,</span> <span class="n">check_dacr_to_outmixr</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXL Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;RECMIXR Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;DACR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1_BST1 Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2_BST2 Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RXN Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RXN Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;AXILVOL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;AXIL Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;AXIRVOL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;AXIR Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;VDAC Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Voice DAC Boost&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;Left SPKVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;SPKMIXL&quot;</span><span class="p">,</span> <span class="s">&quot;SPKMIXL Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left SPKVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;Vmid&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left HPVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;OUTMIXL&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left HPVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;Vmid&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left OUTVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;OUTMIXL&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXL Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left OUTVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;Vmid&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right OUTVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;OUTMIXR&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right OUTVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;Vmid&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right HPVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;OUTMIXR&quot;</span><span class="p">,</span> <span class="s">&quot;OUTMIXR Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right HPVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;Vmid&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right SPKVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;SPKMIXR&quot;</span><span class="p">,</span> <span class="s">&quot;SPKMIXR Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Right SPKVOL Mux&quot;</span><span class="p">,</span>  <span class="s">&quot;Vmid&quot;</span><span class="p">,</span> <span class="s">&quot;Vmid&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;AXO1MIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1_BST1 Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;AXO1MIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;OUTVOLL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Left OUTVOL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;AXO1MIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;OUTVOLR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Right OUTVOL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;AXO1MIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2_BST2 Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Boost&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;AXO2MIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1_BST1 Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;AXO2MIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;OUTVOLL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Left OUTVOL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;AXO2MIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;OUTVOLR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Right OUTVOL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;AXO2MIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2_BST2 Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Boost&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;SPOLMIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;SPKVOLL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Left SPKVOL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPOLMIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;SPKVOLR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Right SPKVOL Mux&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;SPORMIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;SPKVOLL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Left SPKVOL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPORMIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;SPKVOLR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Right SPKVOL Mux&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;MONOMIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;OUTVOLL Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Left OUTVOL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;MONOMIX Mixer&quot;</span><span class="p">,</span> <span class="s">&quot;OUTVOLR Playback Switch&quot;</span><span class="p">,</span> <span class="s">&quot;Right OUTVOL Mux&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;SPOL Mux&quot;</span><span class="p">,</span> <span class="s">&quot;SPOLMIX&quot;</span><span class="p">,</span> <span class="s">&quot;SPOLMIX Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPOL Mux&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RX&quot;</span><span class="p">,</span> <span class="s">&quot;MONO_IN&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPOL Mux&quot;</span><span class="p">,</span> <span class="s">&quot;VDAC&quot;</span><span class="p">,</span> <span class="s">&quot;Voice DAC Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPOL Mux&quot;</span><span class="p">,</span> <span class="s">&quot;DACL&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;SPOR Mux&quot;</span><span class="p">,</span> <span class="s">&quot;SPORMIX&quot;</span><span class="p">,</span> <span class="s">&quot;SPORMIX Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPOR Mux&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RX&quot;</span><span class="p">,</span> <span class="s">&quot;MONO_IN&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPOR Mux&quot;</span><span class="p">,</span> <span class="s">&quot;VDAC&quot;</span><span class="p">,</span> <span class="s">&quot;Voice DAC Boost&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPOR Mux&quot;</span><span class="p">,</span> <span class="s">&quot;DACR&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;MONO Mux&quot;</span><span class="p">,</span> <span class="s">&quot;MONOMIX&quot;</span><span class="p">,</span> <span class="s">&quot;MONOMIX Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;MONO Mux&quot;</span><span class="p">,</span> <span class="s">&quot;MONOIN_RX&quot;</span><span class="p">,</span> <span class="s">&quot;MONO_IN&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;MONO Mux&quot;</span><span class="p">,</span> <span class="s">&quot;VDAC&quot;</span><span class="p">,</span> <span class="s">&quot;Voice DAC Boost&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;Right DAC_HP&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Right DAC&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;Left DAC_HP&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Left DAC&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;HPL Mux&quot;</span><span class="p">,</span> <span class="s">&quot;Left HPVOL&quot;</span><span class="p">,</span> <span class="s">&quot;Left HPVOL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;HPL Mux&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC&quot;</span><span class="p">,</span> <span class="s">&quot;Left DAC_HP&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;HPR Mux&quot;</span><span class="p">,</span> <span class="s">&quot;Right HPVOL&quot;</span><span class="p">,</span> <span class="s">&quot;Right HPVOL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;HPR Mux&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC&quot;</span><span class="p">,</span> <span class="s">&quot;Right DAC_HP&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;HP Depop&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;HPL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;HP Depop&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;HPR Mux&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;AUXO1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;AXO1MIX Mixer&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;AUXO2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;AXO2MIX Mixer&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;SPOL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Class D&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPOL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;SPOL Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPOR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Class D&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;SPOR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;SPOR Mux&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;HPOL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;HP Depop&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;HPOR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;HP Depop&quot;</span><span class="p">},</span>

	<span class="p">{</span><span class="s">&quot;MONO&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MONO Depop&quot;</span><span class="p">},</span>
	<span class="p">{</span><span class="s">&quot;MONO&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MONO Mux&quot;</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">coeff_clk_div</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">mclk</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bclk</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rate</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reg_val</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* PLL divisors */</span>
<span class="k">struct</span> <span class="n">pll_div</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">pll_in</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pll_out</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reg_val</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pll_div</span> <span class="n">codec_master_pll_div</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">2048000</span><span class="p">,</span>  <span class="mi">8192000</span><span class="p">,</span>  <span class="mh">0x0ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3686400</span><span class="p">,</span>  <span class="mi">8192000</span><span class="p">,</span>  <span class="mh">0x4e27</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">12000000</span><span class="p">,</span>  <span class="mi">8192000</span><span class="p">,</span>  <span class="mh">0x456b</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13000000</span><span class="p">,</span>  <span class="mi">8192000</span><span class="p">,</span>  <span class="mh">0x495f</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13100000</span><span class="p">,</span>  <span class="mi">8192000</span><span class="p">,</span>  <span class="mh">0x0320</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2048000</span><span class="p">,</span>  <span class="mi">11289600</span><span class="p">,</span>  <span class="mh">0xf637</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3686400</span><span class="p">,</span>  <span class="mi">11289600</span><span class="p">,</span>  <span class="mh">0x2f22</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">12000000</span><span class="p">,</span>  <span class="mi">11289600</span><span class="p">,</span>  <span class="mh">0x3e2f</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13000000</span><span class="p">,</span>  <span class="mi">11289600</span><span class="p">,</span>  <span class="mh">0x4d5b</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13100000</span><span class="p">,</span>  <span class="mi">11289600</span><span class="p">,</span>  <span class="mh">0x363b</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2048000</span><span class="p">,</span>  <span class="mi">16384000</span><span class="p">,</span>  <span class="mh">0x1ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3686400</span><span class="p">,</span>  <span class="mi">16384000</span><span class="p">,</span>  <span class="mh">0x9e27</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">12000000</span><span class="p">,</span>  <span class="mi">16384000</span><span class="p">,</span>  <span class="mh">0x452b</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13000000</span><span class="p">,</span>  <span class="mi">16384000</span><span class="p">,</span>  <span class="mh">0x542f</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13100000</span><span class="p">,</span>  <span class="mi">16384000</span><span class="p">,</span>  <span class="mh">0x03a0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2048000</span><span class="p">,</span>  <span class="mi">16934400</span><span class="p">,</span>  <span class="mh">0xe625</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3686400</span><span class="p">,</span>  <span class="mi">16934400</span><span class="p">,</span>  <span class="mh">0x9126</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">12000000</span><span class="p">,</span>  <span class="mi">16934400</span><span class="p">,</span>  <span class="mh">0x4d2c</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13000000</span><span class="p">,</span>  <span class="mi">16934400</span><span class="p">,</span>  <span class="mh">0x742f</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13100000</span><span class="p">,</span>  <span class="mi">16934400</span><span class="p">,</span>  <span class="mh">0x3c27</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2048000</span><span class="p">,</span>  <span class="mi">22579200</span><span class="p">,</span>  <span class="mh">0x2aa0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3686400</span><span class="p">,</span>  <span class="mi">22579200</span><span class="p">,</span>  <span class="mh">0x2f20</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">12000000</span><span class="p">,</span>  <span class="mi">22579200</span><span class="p">,</span>  <span class="mh">0x7e2f</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13000000</span><span class="p">,</span>  <span class="mi">22579200</span><span class="p">,</span>  <span class="mh">0x742f</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13100000</span><span class="p">,</span>  <span class="mi">22579200</span><span class="p">,</span>  <span class="mh">0x3c27</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2048000</span><span class="p">,</span>  <span class="mi">24576000</span><span class="p">,</span>  <span class="mh">0x2ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3686400</span><span class="p">,</span>  <span class="mi">24576000</span><span class="p">,</span>  <span class="mh">0xee27</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">12000000</span><span class="p">,</span>  <span class="mi">24576000</span><span class="p">,</span>  <span class="mh">0x2915</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13000000</span><span class="p">,</span>  <span class="mi">24576000</span><span class="p">,</span>  <span class="mh">0x772e</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">13100000</span><span class="p">,</span>  <span class="mi">24576000</span><span class="p">,</span>  <span class="mh">0x0d20</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">26000000</span><span class="p">,</span>  <span class="mi">24576000</span><span class="p">,</span>  <span class="mh">0x2027</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">26000000</span><span class="p">,</span>  <span class="mi">22579200</span><span class="p">,</span>  <span class="mh">0x392f</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">22579200</span><span class="p">,</span>  <span class="mh">0x0921</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">24576000</span><span class="p">,</span>  <span class="mh">0x02a0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pll_div</span> <span class="n">codec_slave_pll_div</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">256000</span><span class="p">,</span>  <span class="mi">2048000</span><span class="p">,</span>  <span class="mh">0x46f0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">256000</span><span class="p">,</span>  <span class="mi">4096000</span><span class="p">,</span>  <span class="mh">0x3ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">352800</span><span class="p">,</span>  <span class="mi">5644800</span><span class="p">,</span>  <span class="mh">0x3ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">512000</span><span class="p">,</span>  <span class="mi">8192000</span><span class="p">,</span>  <span class="mh">0x3ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1024000</span><span class="p">,</span>  <span class="mi">8192000</span><span class="p">,</span>  <span class="mh">0x46f0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">705600</span><span class="p">,</span>  <span class="mi">11289600</span><span class="p">,</span>  <span class="mh">0x3ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1024000</span><span class="p">,</span>  <span class="mi">16384000</span><span class="p">,</span>  <span class="mh">0x3ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1411200</span><span class="p">,</span>  <span class="mi">22579200</span><span class="p">,</span>  <span class="mh">0x3ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1536000</span><span class="p">,</span>  <span class="mi">24576000</span><span class="p">,</span>  <span class="mh">0x3ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2048000</span><span class="p">,</span>  <span class="mi">16384000</span><span class="p">,</span>  <span class="mh">0x1ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2822400</span><span class="p">,</span>  <span class="mi">22579200</span><span class="p">,</span>  <span class="mh">0x1ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2822400</span><span class="p">,</span>  <span class="mi">45158400</span><span class="p">,</span>  <span class="mh">0x5ec0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">5644800</span><span class="p">,</span>  <span class="mi">45158400</span><span class="p">,</span>  <span class="mh">0x46f0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3072000</span><span class="p">,</span>  <span class="mi">24576000</span><span class="p">,</span>  <span class="mh">0x1ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3072000</span><span class="p">,</span>  <span class="mi">49152000</span><span class="p">,</span>  <span class="mh">0x5ec0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">6144000</span><span class="p">,</span>  <span class="mi">49152000</span><span class="p">,</span>  <span class="mh">0x46f0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">705600</span><span class="p">,</span>  <span class="mi">11289600</span><span class="p">,</span>  <span class="mh">0x3ea0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">705600</span><span class="p">,</span>  <span class="mi">8467200</span><span class="p">,</span>  <span class="mh">0x3ab0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">24576000</span><span class="p">,</span>  <span class="mh">0x02a0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1411200</span><span class="p">,</span>  <span class="mi">11289600</span><span class="p">,</span>  <span class="mh">0x1690</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2822400</span><span class="p">,</span>  <span class="mi">11289600</span><span class="p">,</span>  <span class="mh">0x0a90</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1536000</span><span class="p">,</span>  <span class="mi">12288000</span><span class="p">,</span>  <span class="mh">0x1690</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">3072000</span><span class="p">,</span>  <span class="mi">12288000</span><span class="p">,</span>  <span class="mh">0x0a90</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">coeff_clk_div</span> <span class="n">coeff_div</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* sysclk is 256fs */</span>
	<span class="p">{</span><span class="mi">2048000</span><span class="p">,</span>  <span class="mi">8000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">8000</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2048000</span><span class="p">,</span>  <span class="mi">8000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">8000</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2822400</span><span class="p">,</span>  <span class="mi">11025</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">11025</span><span class="p">,</span>  <span class="mh">0x1000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2822400</span><span class="p">,</span>  <span class="mi">11025</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">11025</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">4096000</span><span class="p">,</span>  <span class="mi">16000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">16000</span><span class="p">,</span>  <span class="mh">0x1000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">4096000</span><span class="p">,</span>  <span class="mi">16000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">16000</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">5644800</span><span class="p">,</span>  <span class="mi">22050</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">22050</span><span class="p">,</span>  <span class="mh">0x1000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">5644800</span><span class="p">,</span>  <span class="mi">22050</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">22050</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">8192000</span><span class="p">,</span>  <span class="mi">32000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">32000</span><span class="p">,</span>  <span class="mh">0x1000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">8192000</span><span class="p">,</span>  <span class="mi">32000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">32000</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">11289600</span><span class="p">,</span>  <span class="mi">44100</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">44100</span><span class="p">,</span>  <span class="mh">0x1000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">11289600</span><span class="p">,</span>  <span class="mi">44100</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">44100</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">12288000</span><span class="p">,</span>  <span class="mi">48000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">48000</span><span class="p">,</span>  <span class="mh">0x1000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">12288000</span><span class="p">,</span>  <span class="mi">48000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">48000</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">22579200</span><span class="p">,</span>  <span class="mi">88200</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">88200</span><span class="p">,</span>  <span class="mh">0x1000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">22579200</span><span class="p">,</span>  <span class="mi">88200</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">88200</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">96000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">96000</span><span class="p">,</span>  <span class="mh">0x1000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">96000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">96000</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">},</span>
	<span class="cm">/* sysclk is 512fs */</span>
	<span class="p">{</span><span class="mi">4096000</span><span class="p">,</span>  <span class="mi">8000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">8000</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">4096000</span><span class="p">,</span>  <span class="mi">8000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">8000</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">5644800</span><span class="p">,</span>  <span class="mi">11025</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">11025</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">5644800</span><span class="p">,</span>  <span class="mi">11025</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">11025</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">8192000</span><span class="p">,</span>  <span class="mi">16000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">16000</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">8192000</span><span class="p">,</span>  <span class="mi">16000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">16000</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">11289600</span><span class="p">,</span>  <span class="mi">22050</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">22050</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">11289600</span><span class="p">,</span>  <span class="mi">22050</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">22050</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">16384000</span><span class="p">,</span>  <span class="mi">32000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">32000</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">16384000</span><span class="p">,</span>  <span class="mi">32000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">32000</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">22579200</span><span class="p">,</span>  <span class="mi">44100</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">44100</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">22579200</span><span class="p">,</span>  <span class="mi">44100</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">44100</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">48000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">48000</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">48000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">48000</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">45158400</span><span class="p">,</span>  <span class="mi">88200</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">88200</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">45158400</span><span class="p">,</span>  <span class="mi">88200</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">88200</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">49152000</span><span class="p">,</span>  <span class="mi">96000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">96000</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">49152000</span><span class="p">,</span>  <span class="mi">96000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">96000</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">},</span>
	<span class="cm">/* sysclk is 24.576Mhz or 22.5792Mhz */</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">8000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">8000</span><span class="p">,</span>  <span class="mh">0x7080</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">8000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">8000</span><span class="p">,</span>  <span class="mh">0x6080</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">16000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">16000</span><span class="p">,</span>  <span class="mh">0x5080</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">16000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">16000</span><span class="p">,</span>  <span class="mh">0x4080</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">24000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">24000</span><span class="p">,</span>  <span class="mh">0x5000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">24000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">24000</span><span class="p">,</span>  <span class="mh">0x4000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">32000</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">32000</span><span class="p">,</span>  <span class="mh">0x3080</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">24576000</span><span class="p">,</span>  <span class="mi">32000</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">32000</span><span class="p">,</span>  <span class="mh">0x2080</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">22579200</span><span class="p">,</span>  <span class="mi">11025</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">11025</span><span class="p">,</span>  <span class="mh">0x7000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">22579200</span><span class="p">,</span>  <span class="mi">11025</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">11025</span><span class="p">,</span>  <span class="mh">0x6000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">22579200</span><span class="p">,</span>  <span class="mi">22050</span> <span class="o">*</span> <span class="mi">32</span><span class="p">,</span>  <span class="mi">22050</span><span class="p">,</span>  <span class="mh">0x5000</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">22579200</span><span class="p">,</span>  <span class="mi">22050</span> <span class="o">*</span> <span class="mi">64</span><span class="p">,</span>  <span class="mi">22050</span><span class="p">,</span>  <span class="mh">0x4000</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">get_coeff</span><span class="p">(</span><span class="kt">int</span> <span class="n">mclk</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rate</span><span class="p">,</span> <span class="kt">int</span> <span class="n">timesofbclk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">coeff_div</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">coeff_div</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">mclk</span> <span class="o">==</span> <span class="n">mclk</span> <span class="o">&amp;&amp;</span> <span class="n">coeff_div</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rate</span> <span class="o">==</span> <span class="n">rate</span> <span class="o">&amp;&amp;</span>
			<span class="p">(</span><span class="n">coeff_div</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">bclk</span> <span class="o">/</span> <span class="n">coeff_div</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rate</span><span class="p">)</span> <span class="o">==</span> <span class="n">timesofbclk</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">i</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_hifi_pcm_params</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">snd_pcm_hw_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">timesofbclk</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="n">coeff</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iface</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;enter %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>

	<span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">bclk_rate</span> <span class="o">=</span> <span class="n">snd_soc_params_to_bclk</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">bclk_rate</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Fail to get BCLK rate</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">bclk_rate</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">rx_rate</span> <span class="o">=</span> <span class="n">params_rate</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">master</span><span class="p">)</span>
		<span class="n">coeff</span> <span class="o">=</span> <span class="n">get_coeff</span><span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">sysclk</span><span class="p">,</span> <span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">rx_rate</span><span class="p">,</span>
			<span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">bclk_rate</span> <span class="o">/</span> <span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">rx_rate</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">coeff</span> <span class="o">=</span> <span class="n">get_coeff</span><span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">sysclk</span><span class="p">,</span> <span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">rx_rate</span><span class="p">,</span>
					<span class="n">timesofbclk</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">coeff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Fail to get coeff</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">params_format</span><span class="p">(</span><span class="n">params</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S16_LE</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S20_3LE</span>:
		<span class="n">iface</span> <span class="o">|=</span> <span class="n">RT5631_SDP_I2S_DL_20</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S24_LE</span>:
		<span class="n">iface</span> <span class="o">|=</span> <span class="n">RT5631_SDP_I2S_DL_24</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S8</span>:
		<span class="n">iface</span> <span class="o">|=</span> <span class="n">RT5631_SDP_I2S_DL_8</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SDP_CTRL</span><span class="p">,</span>
		<span class="n">RT5631_SDP_I2S_DL_MASK</span><span class="p">,</span> <span class="n">iface</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_STEREO_AD_DA_CLK_CTRL</span><span class="p">,</span>
					<span class="n">coeff_div</span><span class="p">[</span><span class="n">coeff</span><span class="p">].</span><span class="n">reg_val</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_hifi_codec_set_dai_fmt</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">codec_dai</span><span class="p">,</span>
						<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">codec_dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">iface</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;enter %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_MASTER_MASK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFM</span>:
		<span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">master</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBS_CFS</span>:
		<span class="n">iface</span> <span class="o">|=</span> <span class="n">RT5631_SDP_MODE_SEL_SLAVE</span><span class="p">;</span>
		<span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">master</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_FORMAT_MASK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_I2S</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_LEFT_J</span>:
		<span class="n">iface</span> <span class="o">|=</span> <span class="n">RT5631_SDP_I2S_DF_LEFT</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_DSP_A</span>:
		<span class="n">iface</span> <span class="o">|=</span> <span class="n">RT5631_SDP_I2S_DF_PCM_A</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_DSP_B</span>:
		<span class="n">iface</span>  <span class="o">|=</span> <span class="n">RT5631_SDP_I2S_DF_PCM_B</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_INV_MASK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_NB_NF</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_IB_NF</span>:
		<span class="n">iface</span> <span class="o">|=</span> <span class="n">RT5631_SDP_I2S_BCLK_POL_CTRL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_SDP_CTRL</span><span class="p">,</span> <span class="n">iface</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_hifi_codec_set_dai_sysclk</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">codec_dai</span><span class="p">,</span>
				<span class="kt">int</span> <span class="n">clk_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">codec_dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;enter %s, syclk=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">freq</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">freq</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">256</span> <span class="o">*</span> <span class="mi">8000</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">freq</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="mi">512</span> <span class="o">*</span> <span class="mi">96000</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">sysclk</span> <span class="o">=</span> <span class="n">freq</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_codec_set_dai_pll</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">codec_dai</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pll_id</span><span class="p">,</span>
		<span class="kt">int</span> <span class="n">source</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq_in</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq_out</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">codec_dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">dev_dbg</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;enter %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">freq_in</span> <span class="o">||</span> <span class="o">!</span><span class="n">freq_out</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_dbg</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;PLL disabled</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_GLOBAL_CLK_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_SYSCLK_SOUR_SEL_MASK</span><span class="p">,</span>
			<span class="n">RT5631_SYSCLK_SOUR_SEL_MCLK</span><span class="p">);</span>

		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">master</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">codec_master_pll_div</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">freq_in</span> <span class="o">==</span> <span class="n">codec_master_pll_div</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pll_in</span> <span class="o">&amp;&amp;</span>
			<span class="n">freq_out</span> <span class="o">==</span> <span class="n">codec_master_pll_div</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pll_out</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dev_info</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
					<span class="s">&quot;change PLL in master mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PLL_CTRL</span><span class="p">,</span>
					<span class="n">codec_master_pll_div</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reg_val</span><span class="p">);</span>
				<span class="n">schedule_timeout_uninterruptible</span><span class="p">(</span>
					<span class="n">msecs_to_jiffies</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
				<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span>
					<span class="n">RT5631_GLOBAL_CLK_CTRL</span><span class="p">,</span>
					<span class="n">RT5631_SYSCLK_SOUR_SEL_MASK</span> <span class="o">|</span>
					<span class="n">RT5631_PLLCLK_SOUR_SEL_MASK</span><span class="p">,</span>
					<span class="n">RT5631_SYSCLK_SOUR_SEL_PLL</span> <span class="o">|</span>
					<span class="n">RT5631_PLLCLK_SOUR_SEL_MCLK</span><span class="p">);</span>
				<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">codec_slave_pll_div</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">freq_in</span> <span class="o">==</span> <span class="n">codec_slave_pll_div</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pll_in</span> <span class="o">&amp;&amp;</span>
			<span class="n">freq_out</span> <span class="o">==</span> <span class="n">codec_slave_pll_div</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pll_out</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dev_info</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
					<span class="s">&quot;change PLL in slave mode</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PLL_CTRL</span><span class="p">,</span>
					<span class="n">codec_slave_pll_div</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reg_val</span><span class="p">);</span>
				<span class="n">schedule_timeout_uninterruptible</span><span class="p">(</span>
					<span class="n">msecs_to_jiffies</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span>
				<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span>
					<span class="n">RT5631_GLOBAL_CLK_CTRL</span><span class="p">,</span>
					<span class="n">RT5631_SYSCLK_SOUR_SEL_MASK</span> <span class="o">|</span>
					<span class="n">RT5631_PLLCLK_SOUR_SEL_MASK</span><span class="p">,</span>
					<span class="n">RT5631_SYSCLK_SOUR_SEL_PLL</span> <span class="o">|</span>
					<span class="n">RT5631_PLLCLK_SOUR_SEL_BCLK</span><span class="p">);</span>
				<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_set_bias_level</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
			<span class="k">enum</span> <span class="n">snd_soc_bias_level</span> <span class="n">level</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_BIAS_ON</span>:
	<span class="k">case</span> <span class="n">SND_SOC_BIAS_PREPARE</span>:
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MICBIAS1_VOL</span> <span class="o">|</span> <span class="n">RT5631_PWR_MICBIAS2_VOL</span><span class="p">,</span>
			<span class="n">RT5631_PWR_MICBIAS1_VOL</span> <span class="o">|</span> <span class="n">RT5631_PWR_MICBIAS2_VOL</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SND_SOC_BIAS_STANDBY</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dapm</span><span class="p">.</span><span class="n">bias_level</span> <span class="o">==</span> <span class="n">SND_SOC_BIAS_OFF</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
				<span class="n">RT5631_PWR_VREF</span> <span class="o">|</span> <span class="n">RT5631_PWR_MAIN_BIAS</span><span class="p">,</span>
				<span class="n">RT5631_PWR_VREF</span> <span class="o">|</span> <span class="n">RT5631_PWR_MAIN_BIAS</span><span class="p">);</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
			<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
				<span class="n">RT5631_PWR_FAST_VREF_CTRL</span><span class="p">,</span>
				<span class="n">RT5631_PWR_FAST_VREF_CTRL</span><span class="p">);</span>
			<span class="n">regcache_cache_only</span><span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">regmap</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
			<span class="n">regcache_sync</span><span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">regmap</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SND_SOC_BIAS_OFF</span>:
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD1</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD2</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD4</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">dapm</span><span class="p">.</span><span class="n">bias_level</span> <span class="o">=</span> <span class="n">level</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">control_data</span> <span class="o">=</span> <span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">regmap</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_codec_set_cache_io</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">SND_SOC_REGMAP</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to set cache I/O: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">rt5631_read_index</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_ADDA_MIXER_INTL_REG3</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0x0002</span><span class="p">)</span>
		<span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">codec_version</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">codec_version</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">rt5631_reset</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
		<span class="n">RT5631_PWR_VREF</span> <span class="o">|</span> <span class="n">RT5631_PWR_MAIN_BIAS</span><span class="p">,</span>
		<span class="n">RT5631_PWR_VREF</span> <span class="o">|</span> <span class="n">RT5631_PWR_MAIN_BIAS</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_PWR_MANAG_ADD3</span><span class="p">,</span>
		<span class="n">RT5631_PWR_FAST_VREF_CTRL</span><span class="p">,</span> <span class="n">RT5631_PWR_FAST_VREF_CTRL</span><span class="p">);</span>
	<span class="cm">/* enable HP zero cross */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span> <span class="mh">0x0f18</span><span class="p">);</span>
	<span class="cm">/* power off ClassD auto Recovery */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">codec_version</span><span class="p">)</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span>
					<span class="mh">0x2000</span><span class="p">,</span> <span class="mh">0x2000</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_INT_ST_IRQ_CTRL_2</span><span class="p">,</span>
					<span class="mh">0x2000</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="cm">/* DMIC */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">dmic_used_flag</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_GPIO_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_GPIO_PIN_FUN_SEL_MASK</span> <span class="o">|</span>
			<span class="n">RT5631_GPIO_DMIC_FUN_SEL_MASK</span><span class="p">,</span>
			<span class="n">RT5631_GPIO_PIN_FUN_SEL_GPIO_DIMC</span> <span class="o">|</span>
			<span class="n">RT5631_GPIO_DMIC_FUN_SEL_DIMC</span><span class="p">);</span>
		<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">RT5631_DIG_MIC_CTRL</span><span class="p">,</span>
			<span class="n">RT5631_DMIC_L_CH_LATCH_MASK</span> <span class="o">|</span>
			<span class="n">RT5631_DMIC_R_CH_LATCH_MASK</span><span class="p">,</span>
			<span class="n">RT5631_DMIC_L_CH_LATCH_FALLING</span> <span class="o">|</span>
			<span class="n">RT5631_DMIC_R_CH_LATCH_RISING</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">dapm</span><span class="p">.</span><span class="n">bias_level</span> <span class="o">=</span> <span class="n">SND_SOC_BIAS_STANDBY</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rt5631_set_bias_level</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SND_SOC_BIAS_OFF</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_PM</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rt5631_set_bias_level</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SND_SOC_BIAS_OFF</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_resume</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">rt5631_set_bias_level</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SND_SOC_BIAS_STANDBY</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="cp">#define rt5631_suspend NULL</span>
<span class="cp">#define rt5631_resume NULL</span>
<span class="cp">#endif</span>

<span class="cp">#define RT5631_STEREO_RATES SNDRV_PCM_RATE_8000_96000</span>
<span class="cp">#define RT5631_FORMAT	(SNDRV_PCM_FMTBIT_S16_LE | \</span>
<span class="cp">			SNDRV_PCM_FMTBIT_S20_3LE | \</span>
<span class="cp">			SNDRV_PCM_FMTBIT_S24_LE | \</span>
<span class="cp">			SNDRV_PCM_FMTBIT_S8)</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">rt5631_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">hw_params</span> <span class="o">=</span> <span class="n">rt5631_hifi_pcm_params</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_fmt</span> <span class="o">=</span> <span class="n">rt5631_hifi_codec_set_dai_fmt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_sysclk</span> <span class="o">=</span> <span class="n">rt5631_hifi_codec_set_dai_sysclk</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_pll</span> <span class="o">=</span> <span class="n">rt5631_codec_set_dai_pll</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_dai_driver</span> <span class="n">rt5631_dai</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;rt5631-hifi&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;HIFI Playback&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">RT5631_STEREO_RATES</span><span class="p">,</span>
			<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">RT5631_FORMAT</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">capture</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;HIFI Capture&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">RT5631_STEREO_RATES</span><span class="p">,</span>
			<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">RT5631_FORMAT</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rt5631_ops</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_codec_driver</span> <span class="n">soc_codec_dev_rt5631</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">rt5631_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span> <span class="o">=</span> <span class="n">rt5631_remove</span><span class="p">,</span>
	<span class="p">.</span><span class="n">suspend</span> <span class="o">=</span> <span class="n">rt5631_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resume</span> <span class="o">=</span> <span class="n">rt5631_resume</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_bias_level</span> <span class="o">=</span> <span class="n">rt5631_set_bias_level</span><span class="p">,</span>
	<span class="p">.</span><span class="n">controls</span> <span class="o">=</span> <span class="n">rt5631_snd_controls</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_controls</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_snd_controls</span><span class="p">),</span>
	<span class="p">.</span><span class="n">dapm_widgets</span> <span class="o">=</span> <span class="n">rt5631_dapm_widgets</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dapm_widgets</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_dapm_widgets</span><span class="p">),</span>
	<span class="p">.</span><span class="n">dapm_routes</span> <span class="o">=</span> <span class="n">rt5631_dapm_routes</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dapm_routes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_dapm_routes</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_device_id</span> <span class="n">rt5631_i2c_id</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="s">&quot;rt5631&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">rt5631_i2c_id</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">regmap_config</span> <span class="n">rt5631_regmap_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">reg_bits</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">val_bits</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>

	<span class="p">.</span><span class="n">readable_reg</span> <span class="o">=</span> <span class="n">rt5631_readable_register</span><span class="p">,</span>
	<span class="p">.</span><span class="n">volatile_reg</span> <span class="o">=</span> <span class="n">rt5631_volatile_register</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_register</span> <span class="o">=</span> <span class="n">RT5631_VENDOR_ID2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reg_defaults</span> <span class="o">=</span> <span class="n">rt5631_reg</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_reg_defaults</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_reg</span><span class="p">),</span>
	<span class="p">.</span><span class="n">cache_type</span> <span class="o">=</span> <span class="n">REGCACHE_RBTREE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">rt5631_i2c_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">i2c</span><span class="p">,</span>
		    <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rt5631_priv</span> <span class="o">*</span><span class="n">rt5631</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">rt5631</span> <span class="o">=</span> <span class="n">devm_kzalloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2c</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">rt5631_priv</span><span class="p">),</span>
			      <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">rt5631</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">i2c_set_clientdata</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">rt5631</span><span class="p">);</span>

	<span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">regmap</span> <span class="o">=</span> <span class="n">devm_regmap_init_i2c</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rt5631_regmap_config</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">regmap</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">PTR_ERR</span><span class="p">(</span><span class="n">rt5631</span><span class="o">-&gt;</span><span class="n">regmap</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_register_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">i2c</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">soc_codec_dev_rt5631</span><span class="p">,</span>
			<span class="n">rt5631_dai</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rt5631_dai</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">__devexit</span> <span class="kt">int</span> <span class="nf">rt5631_i2c_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_unregister_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_driver</span> <span class="n">rt5631_i2c_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;rt5631&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">rt5631_i2c_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>   <span class="o">=</span> <span class="n">__devexit_p</span><span class="p">(</span><span class="n">rt5631_i2c_remove</span><span class="p">),</span>
	<span class="p">.</span><span class="n">id_table</span> <span class="o">=</span> <span class="n">rt5631_i2c_id</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">module_i2c_driver</span><span class="p">(</span><span class="n">rt5631_i2c_driver</span><span class="p">);</span>

<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;ASoC RT5631 driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;flove &lt;flove@realtek.com&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
