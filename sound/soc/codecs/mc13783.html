<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › soc › codecs › mc13783.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>mc13783.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright 2008 Juergen Beisert, kernel@pengutronix.de</span>
<span class="cm"> * Copyright 2009 Sascha Hauer, s.hauer@pengutronix.de</span>
<span class="cm"> * Copyright 2012 Philippe Retornaz, philippe.retornaz@epfl.ch</span>
<span class="cm"> *</span>
<span class="cm"> * Initial development of this code was funded by</span>
<span class="cm"> * Phytec Messtechnik GmbH, http://www.phytec.de</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * as published by the Free Software Foundation; either version 2</span>
<span class="cm"> * of the License, or (at your option) any later version.</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,</span>
<span class="cm"> * MA  02110-1301, USA.</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/mc13xxx.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;sound/core.h&gt;</span>
<span class="cp">#include &lt;sound/control.h&gt;</span>
<span class="cp">#include &lt;sound/pcm.h&gt;</span>
<span class="cp">#include &lt;sound/soc.h&gt;</span>
<span class="cp">#include &lt;sound/initval.h&gt;</span>
<span class="cp">#include &lt;sound/soc-dapm.h&gt;</span>

<span class="cp">#include &quot;mc13783.h&quot;</span>

<span class="cp">#define MC13783_AUDIO_RX0	36</span>
<span class="cp">#define MC13783_AUDIO_RX1	37</span>
<span class="cp">#define MC13783_AUDIO_TX	38</span>
<span class="cp">#define MC13783_SSI_NETWORK	39</span>
<span class="cp">#define MC13783_AUDIO_CODEC	40</span>
<span class="cp">#define MC13783_AUDIO_DAC	41</span>

<span class="cp">#define AUDIO_RX0_ALSPEN		(1 &lt;&lt; 5)</span>
<span class="cp">#define AUDIO_RX0_ALSPSEL		(1 &lt;&lt; 7)</span>
<span class="cp">#define AUDIO_RX0_ADDCDC		(1 &lt;&lt; 21)</span>
<span class="cp">#define AUDIO_RX0_ADDSTDC		(1 &lt;&lt; 22)</span>
<span class="cp">#define AUDIO_RX0_ADDRXIN		(1 &lt;&lt; 23)</span>

<span class="cp">#define AUDIO_RX1_PGARXEN		(1 &lt;&lt; 0);</span>
<span class="cp">#define AUDIO_RX1_PGASTEN		(1 &lt;&lt; 5)</span>
<span class="cp">#define AUDIO_RX1_ARXINEN		(1 &lt;&lt; 10)</span>

<span class="cp">#define AUDIO_TX_AMC1REN		(1 &lt;&lt; 5)</span>
<span class="cp">#define AUDIO_TX_AMC1LEN		(1 &lt;&lt; 7)</span>
<span class="cp">#define AUDIO_TX_AMC2EN			(1 &lt;&lt; 9)</span>
<span class="cp">#define AUDIO_TX_ATXINEN		(1 &lt;&lt; 11)</span>
<span class="cp">#define AUDIO_TX_RXINREC		(1 &lt;&lt; 13)</span>

<span class="cp">#define SSI_NETWORK_CDCTXRXSLOT(x)	(((x) &amp; 0x3) &lt;&lt; 2)</span>
<span class="cp">#define SSI_NETWORK_CDCTXSECSLOT(x)	(((x) &amp; 0x3) &lt;&lt; 4)</span>
<span class="cp">#define SSI_NETWORK_CDCRXSECSLOT(x)	(((x) &amp; 0x3) &lt;&lt; 6)</span>
<span class="cp">#define SSI_NETWORK_CDCRXSECGAIN(x)	(((x) &amp; 0x3) &lt;&lt; 8)</span>
<span class="cp">#define SSI_NETWORK_CDCSUMGAIN(x)	(1 &lt;&lt; 10)</span>
<span class="cp">#define SSI_NETWORK_CDCFSDLY(x)		(1 &lt;&lt; 11)</span>
<span class="cp">#define SSI_NETWORK_DAC_SLOTS_8		(1 &lt;&lt; 12)</span>
<span class="cp">#define SSI_NETWORK_DAC_SLOTS_4		(2 &lt;&lt; 12)</span>
<span class="cp">#define SSI_NETWORK_DAC_SLOTS_2		(3 &lt;&lt; 12)</span>
<span class="cp">#define SSI_NETWORK_DAC_SLOT_MASK	(3 &lt;&lt; 12)</span>
<span class="cp">#define SSI_NETWORK_DAC_RXSLOT_0_1	(0 &lt;&lt; 14)</span>
<span class="cp">#define SSI_NETWORK_DAC_RXSLOT_2_3	(1 &lt;&lt; 14)</span>
<span class="cp">#define SSI_NETWORK_DAC_RXSLOT_4_5	(2 &lt;&lt; 14)</span>
<span class="cp">#define SSI_NETWORK_DAC_RXSLOT_6_7	(3 &lt;&lt; 14)</span>
<span class="cp">#define SSI_NETWORK_DAC_RXSLOT_MASK	(3 &lt;&lt; 14)</span>
<span class="cp">#define SSI_NETWORK_STDCRXSECSLOT(x)	(((x) &amp; 0x3) &lt;&lt; 16)</span>
<span class="cp">#define SSI_NETWORK_STDCRXSECGAIN(x)	(((x) &amp; 0x3) &lt;&lt; 18)</span>
<span class="cp">#define SSI_NETWORK_STDCSUMGAIN		(1 &lt;&lt; 20)</span>

<span class="cm">/*</span>
<span class="cm"> * MC13783_AUDIO_CODEC and MC13783_AUDIO_DAC mostly share the same</span>
<span class="cm"> * register layout</span>
<span class="cm"> */</span>
<span class="cp">#define AUDIO_SSI_SEL			(1 &lt;&lt; 0)</span>
<span class="cp">#define AUDIO_CLK_SEL			(1 &lt;&lt; 1)</span>
<span class="cp">#define AUDIO_CSM			(1 &lt;&lt; 2)</span>
<span class="cp">#define AUDIO_BCL_INV			(1 &lt;&lt; 3)</span>
<span class="cp">#define AUDIO_CFS_INV			(1 &lt;&lt; 4)</span>
<span class="cp">#define AUDIO_CFS(x)			(((x) &amp; 0x3) &lt;&lt; 5)</span>
<span class="cp">#define AUDIO_CLK(x)			(((x) &amp; 0x7) &lt;&lt; 7)</span>
<span class="cp">#define AUDIO_C_EN			(1 &lt;&lt; 11)</span>
<span class="cp">#define AUDIO_C_CLK_EN			(1 &lt;&lt; 12)</span>
<span class="cp">#define AUDIO_C_RESET			(1 &lt;&lt; 15)</span>

<span class="cp">#define AUDIO_CODEC_CDCFS8K16K		(1 &lt;&lt; 10)</span>
<span class="cp">#define AUDIO_DAC_CFS_DLY_B		(1 &lt;&lt; 10)</span>

<span class="k">struct</span> <span class="n">mc13783_priv</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="n">codec</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mc13xxx</span> <span class="o">*</span><span class="n">mc13xxx</span><span class="p">;</span>

	<span class="k">enum</span> <span class="n">mc13783_ssi_port</span> <span class="n">adc_ssi_port</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">mc13783_ssi_port</span> <span class="n">dac_ssi_port</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">mc13783_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mc13783_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">mc13xxx_lock</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">);</span>

	<span class="n">mc13xxx_reg_read</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>

	<span class="n">mc13xxx_unlock</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mc13783_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">mc13xxx_lock</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">mc13xxx_reg_write</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>

	<span class="n">mc13xxx_unlock</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Mapping between sample rates and register value */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mc13783_rates</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">8000</span><span class="p">,</span> <span class="mi">11025</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="mi">16000</span><span class="p">,</span>
	<span class="mi">22050</span><span class="p">,</span> <span class="mi">24000</span><span class="p">,</span> <span class="mi">32000</span><span class="p">,</span> <span class="mi">44100</span><span class="p">,</span>
	<span class="mi">48000</span><span class="p">,</span> <span class="mi">64000</span><span class="p">,</span> <span class="mi">96000</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_pcm_hw_params_dac</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_pcm_hw_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_pcm_runtime</span> <span class="o">*</span><span class="n">rtd</span> <span class="o">=</span> <span class="n">substream</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">rtd</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">params_rate</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mc13783_rates</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rate</span> <span class="o">==</span> <span class="n">mc13783_rates</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">MC13783_AUDIO_DAC</span><span class="p">,</span>
					<span class="mh">0xf</span> <span class="o">&lt;&lt;</span> <span class="mi">17</span><span class="p">,</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">17</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_pcm_hw_params_codec</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_pcm_hw_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_pcm_runtime</span> <span class="o">*</span><span class="n">rtd</span> <span class="o">=</span> <span class="n">substream</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">rtd</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rate</span> <span class="o">=</span> <span class="n">params_rate</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">8000</span>:
		<span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">16000</span>:
		<span class="n">val</span> <span class="o">=</span> <span class="n">AUDIO_CODEC_CDCFS8K16K</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">MC13783_AUDIO_CODEC</span><span class="p">,</span> <span class="n">AUDIO_CODEC_CDCFS8K16K</span><span class="p">,</span>
			<span class="n">val</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_pcm_hw_params_sync</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_pcm_hw_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">substream</span><span class="o">-&gt;</span><span class="n">stream</span> <span class="o">==</span> <span class="n">SNDRV_PCM_STREAM_PLAYBACK</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">mc13783_pcm_hw_params_dac</span><span class="p">(</span><span class="n">substream</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">dai</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="n">mc13783_pcm_hw_params_codec</span><span class="p">(</span><span class="n">substream</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">dai</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_set_fmt</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">AUDIO_CFS</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="n">AUDIO_BCL_INV</span> <span class="o">|</span> <span class="n">AUDIO_CFS_INV</span> <span class="o">|</span>
				<span class="n">AUDIO_CSM</span> <span class="o">|</span> <span class="n">AUDIO_C_CLK_EN</span> <span class="o">|</span> <span class="n">AUDIO_C_RESET</span><span class="p">;</span>


	<span class="cm">/* DAI mode */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_FORMAT_MASK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_I2S</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">AUDIO_CFS</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_DSP_A</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">AUDIO_CFS</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* DAI clock inversion */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_INV_MASK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_NB_NF</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">AUDIO_BCL_INV</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_NB_IF</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">AUDIO_BCL_INV</span> <span class="o">|</span> <span class="n">AUDIO_CFS_INV</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_IB_NF</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_IB_IF</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">AUDIO_CFS_INV</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* DAI clock master masks */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">fmt</span> <span class="o">&amp;</span> <span class="n">SND_SOC_DAIFMT_MASTER_MASK</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFM</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">AUDIO_C_CLK_EN</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBS_CFS</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">AUDIO_CSM</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBM_CFS</span>:
	<span class="k">case</span> <span class="n">SND_SOC_DAIFMT_CBS_CFM</span>:
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">val</span> <span class="o">|=</span> <span class="n">AUDIO_C_RESET</span><span class="p">;</span>

	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_set_fmt_async</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dai</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="n">MC13783_ID_STEREO_DAC</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">mc13783_set_fmt</span><span class="p">(</span><span class="n">dai</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">MC13783_AUDIO_DAC</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="n">mc13783_set_fmt</span><span class="p">(</span><span class="n">dai</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">MC13783_AUDIO_CODEC</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_set_fmt_sync</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">mc13783_set_fmt</span><span class="p">(</span><span class="n">dai</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">MC13783_AUDIO_DAC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * In synchronous mode force the voice codec into slave mode</span>
<span class="cm">	 * so that the clock / framesync from the stereo DAC is used</span>
<span class="cm">	 */</span>
	<span class="n">fmt</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SND_SOC_DAIFMT_MASTER_MASK</span><span class="p">;</span>
	<span class="n">fmt</span> <span class="o">|=</span> <span class="n">SND_SOC_DAIFMT_CBS_CFS</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">mc13783_set_fmt</span><span class="p">(</span><span class="n">dai</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">MC13783_AUDIO_CODEC</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">mc13783_sysclk</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">13000000</span><span class="p">,</span>
	<span class="mi">15360000</span><span class="p">,</span>
	<span class="mi">16800000</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="mi">26000000</span><span class="p">,</span>
	<span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="cm">/* 12000000, invalid for voice codec */</span>
	<span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="cm">/* 3686400, invalid for voice codec */</span>
	<span class="mi">33600000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_set_sysclk</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span>
				  <span class="kt">int</span> <span class="n">clk_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dir</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">clk</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">AUDIO_CLK</span><span class="p">(</span><span class="mh">0x7</span><span class="p">)</span> <span class="o">|</span> <span class="n">AUDIO_CLK_SEL</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">clk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">clk</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mc13783_sysclk</span><span class="p">);</span> <span class="n">clk</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mc13783_sysclk</span><span class="p">[</span><span class="n">clk</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mc13783_sysclk</span><span class="p">[</span><span class="n">clk</span><span class="p">]</span> <span class="o">==</span> <span class="n">freq</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">clk</span> <span class="o">==</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mc13783_sysclk</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">clk_id</span> <span class="o">==</span> <span class="n">MC13783_CLK_CLIB</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">AUDIO_CLK_SEL</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">|=</span> <span class="n">AUDIO_CLK</span><span class="p">(</span><span class="n">clk</span><span class="p">);</span>

	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_set_sysclk_dac</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span>
				  <span class="kt">int</span> <span class="n">clk_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">mc13783_set_sysclk</span><span class="p">(</span><span class="n">dai</span><span class="p">,</span> <span class="n">clk_id</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">MC13783_AUDIO_DAC</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_set_sysclk_codec</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span>
				  <span class="kt">int</span> <span class="n">clk_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">mc13783_set_sysclk</span><span class="p">(</span><span class="n">dai</span><span class="p">,</span> <span class="n">clk_id</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">MC13783_AUDIO_CODEC</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_set_sysclk_sync</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span>
				  <span class="kt">int</span> <span class="n">clk_id</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">mc13783_set_sysclk</span><span class="p">(</span><span class="n">dai</span><span class="p">,</span> <span class="n">clk_id</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">MC13783_AUDIO_DAC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">mc13783_set_sysclk</span><span class="p">(</span><span class="n">dai</span><span class="p">,</span> <span class="n">clk_id</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">MC13783_AUDIO_CODEC</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_set_tdm_slot_dac</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_mask</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_mask</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slots</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">slot_width</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">SSI_NETWORK_DAC_SLOT_MASK</span> <span class="o">|</span>
				<span class="n">SSI_NETWORK_DAC_RXSLOT_MASK</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">slots</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">SSI_NETWORK_DAC_SLOTS_2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">SSI_NETWORK_DAC_SLOTS_4</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">8</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">SSI_NETWORK_DAC_SLOTS_8</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">rx_mask</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0xfffffffc</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">SSI_NETWORK_DAC_RXSLOT_0_1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0xfffffff3</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">SSI_NETWORK_DAC_RXSLOT_2_3</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0xffffffcf</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">SSI_NETWORK_DAC_RXSLOT_4_5</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0xffffff3f</span>:
		<span class="n">val</span> <span class="o">|=</span> <span class="n">SSI_NETWORK_DAC_RXSLOT_6_7</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">};</span>

	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">MC13783_SSI_NETWORK</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_set_tdm_slot_codec</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_mask</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_mask</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slots</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">slot_width</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span> <span class="o">=</span> <span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="mh">0x3f</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">slots</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tx_mask</span> <span class="o">!=</span> <span class="mh">0xfffffffc</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="mh">0x00</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* primary timeslot RX/TX(?) is 0 */</span>
	<span class="n">val</span> <span class="o">|=</span> <span class="p">(</span><span class="mh">0x01</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>	<span class="cm">/* secondary timeslot TX is 1 */</span>

	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">MC13783_SSI_NETWORK</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_set_tdm_slot_sync</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_mask</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_mask</span><span class="p">,</span> <span class="kt">int</span> <span class="n">slots</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">slot_width</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">mc13783_set_tdm_slot_dac</span><span class="p">(</span><span class="n">dai</span><span class="p">,</span> <span class="n">tx_mask</span><span class="p">,</span> <span class="n">rx_mask</span><span class="p">,</span> <span class="n">slots</span><span class="p">,</span>
			<span class="n">slot_width</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">mc13783_set_tdm_slot_codec</span><span class="p">(</span><span class="n">dai</span><span class="p">,</span> <span class="n">tx_mask</span><span class="p">,</span> <span class="n">rx_mask</span><span class="p">,</span> <span class="n">slots</span><span class="p">,</span>
			<span class="n">slot_width</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">mc1l_amp_ctl</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Switch&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">mc1r_amp_ctl</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Switch&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">mc2_amp_ctl</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Switch&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">atx_amp_ctl</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Switch&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>


<span class="cm">/* Virtual mux. The chip does the input selection automatically</span>
<span class="cm"> * as soon as we enable one input. */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">adcl_enum_text</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;MC1L&quot;</span><span class="p">,</span> <span class="s">&quot;RXINL&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">adcl_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">adcl_enum_text</span><span class="p">),</span> <span class="n">adcl_enum_text</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">left_input_mux</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM_VIRT</span><span class="p">(</span><span class="s">&quot;Route&quot;</span><span class="p">,</span> <span class="n">adcl_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">adcr_enum_text</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;MC1R&quot;</span><span class="p">,</span> <span class="s">&quot;MC2&quot;</span><span class="p">,</span> <span class="s">&quot;RXINR&quot;</span><span class="p">,</span> <span class="s">&quot;TXIN&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">adcr_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">adcr_enum_text</span><span class="p">),</span> <span class="n">adcr_enum_text</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">right_input_mux</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM_VIRT</span><span class="p">(</span><span class="s">&quot;Route&quot;</span><span class="p">,</span> <span class="n">adcr_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">samp_ctl</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Switch&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">lamp_ctl</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Switch&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">hlamp_ctl</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Switch&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">hramp_ctl</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Switch&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">llamp_ctl</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Switch&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">lramp_ctl</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_SINGLE</span><span class="p">(</span><span class="s">&quot;Switch&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="n">mc13783_dapm_widgets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/* Input */</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;MC1LIN&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;MC1RIN&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;MC2IN&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;RXINR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;RXINL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;TXIN&quot;</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;MC1 Bias&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;MC2 Bias&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_SWITCH</span><span class="p">(</span><span class="s">&quot;MC1L Amp&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mc1l_amp_ctl</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SWITCH</span><span class="p">(</span><span class="s">&quot;MC1R Amp&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mc1r_amp_ctl</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SWITCH</span><span class="p">(</span><span class="s">&quot;MC2 Amp&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mc2_amp_ctl</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SWITCH</span><span class="p">(</span><span class="s">&quot;TXIN Amp&quot;</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">atx_amp_ctl</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_VIRT_MUX</span><span class="p">(</span><span class="s">&quot;PGA Left Input Mux&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			      <span class="o">&amp;</span><span class="n">left_input_mux</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_VIRT_MUX</span><span class="p">(</span><span class="s">&quot;PGA Right Input Mux&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			      <span class="o">&amp;</span><span class="n">right_input_mux</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;PGA Left Input&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;PGA Right Input&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_ADC</span><span class="p">(</span><span class="s">&quot;ADC&quot;</span><span class="p">,</span> <span class="s">&quot;Capture&quot;</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;ADC_Reset&quot;</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

<span class="cm">/* Output */</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;DAC_E&quot;</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;DAC_Reset&quot;</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;RXOUTL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;RXOUTR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;HSL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;HSR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;LSP&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;SP&quot;</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_SWITCH</span><span class="p">(</span><span class="s">&quot;Speaker Amp&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">samp_ctl</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SWITCH</span><span class="p">(</span><span class="s">&quot;Loudspeaker Amp&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lamp_ctl</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SWITCH</span><span class="p">(</span><span class="s">&quot;Headset Amp Left&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hlamp_ctl</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SWITCH</span><span class="p">(</span><span class="s">&quot;Headset Amp Right&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hramp_ctl</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SWITCH</span><span class="p">(</span><span class="s">&quot;Line out Amp Left&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">llamp_ctl</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SWITCH</span><span class="p">(</span><span class="s">&quot;Line out Amp Right&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">lramp_ctl</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;DAC&quot;</span><span class="p">,</span> <span class="s">&quot;Playback&quot;</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;DAC PGA&quot;</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_dapm_route</span> <span class="n">mc13783_routes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/* Input */</span>
	<span class="p">{</span> <span class="s">&quot;MC1L Amp&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MC1LIN&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;MC1R Amp&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MC1RIN&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;MC2 Amp&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;MC2IN&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;TXIN Amp&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;TXIN&quot;</span><span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;PGA Left Input Mux&quot;</span><span class="p">,</span> <span class="s">&quot;MC1L&quot;</span><span class="p">,</span> <span class="s">&quot;MC1L Amp&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;PGA Left Input Mux&quot;</span><span class="p">,</span> <span class="s">&quot;RXINL&quot;</span><span class="p">,</span> <span class="s">&quot;RXINL&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;PGA Right Input Mux&quot;</span><span class="p">,</span> <span class="s">&quot;MC1R&quot;</span><span class="p">,</span> <span class="s">&quot;MC1R Amp&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;PGA Right Input Mux&quot;</span><span class="p">,</span> <span class="s">&quot;MC2&quot;</span><span class="p">,</span>  <span class="s">&quot;MC2 Amp&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;PGA Right Input Mux&quot;</span><span class="p">,</span> <span class="s">&quot;TXIN&quot;</span><span class="p">,</span> <span class="s">&quot;TXIN Amp&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;PGA Right Input Mux&quot;</span><span class="p">,</span> <span class="s">&quot;RXINR&quot;</span><span class="p">,</span> <span class="s">&quot;RXINR&quot;</span><span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;PGA Left Input&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;PGA Left Input Mux&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;PGA Right Input&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;PGA Right Input Mux&quot;</span><span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;PGA Left Input&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;PGA Right Input&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;ADC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;ADC_Reset&quot;</span><span class="p">},</span>

<span class="cm">/* Output */</span>
	<span class="p">{</span> <span class="s">&quot;HSL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Amp Left&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;HSR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Amp Right&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;RXOUTL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Line out Amp Left&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;RXOUTR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Line out Amp Right&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SP&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Speaker Amp&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Speaker Amp&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC PGA&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;LSP&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC PGA&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Headset Amp Left&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC PGA&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Headset Amp Right&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC PGA&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Line out Amp Left&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC PGA&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Line out Amp Right&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC PGA&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DAC PGA&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DAC&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DAC_E&quot;</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">mc13783_3d_mixer</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Stereo&quot;</span><span class="p">,</span> <span class="s">&quot;Phase Mix&quot;</span><span class="p">,</span>
						<span class="s">&quot;Mono&quot;</span><span class="p">,</span> <span class="s">&quot;Mono Mix&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">mc13783_enum_3d_mixer</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">MC13783_AUDIO_RX1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mc13783_3d_mixer</span><span class="p">),</span>
			<span class="n">mc13783_3d_mixer</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">mc13783_control_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_SINGLE</span><span class="p">(</span><span class="s">&quot;Loudspeaker enable&quot;</span><span class="p">,</span> <span class="n">MC13783_AUDIO_RX0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_SINGLE</span><span class="p">(</span><span class="s">&quot;PCM Playback Volume&quot;</span><span class="p">,</span> <span class="n">MC13783_AUDIO_RX1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_DOUBLE</span><span class="p">(</span><span class="s">&quot;PCM Capture Volume&quot;</span><span class="p">,</span> <span class="n">MC13783_AUDIO_TX</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;3D Control&quot;</span><span class="p">,</span> <span class="n">mc13783_enum_3d_mixer</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mc13783_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">mc13xxx_lock</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">);</span>

	<span class="cm">/* these are the reset values */</span>
	<span class="n">mc13xxx_reg_write</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_AUDIO_RX0</span><span class="p">,</span> <span class="mh">0x25893</span><span class="p">);</span>
	<span class="n">mc13xxx_reg_write</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_AUDIO_RX1</span><span class="p">,</span> <span class="mh">0x00d35A</span><span class="p">);</span>
	<span class="n">mc13xxx_reg_write</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_AUDIO_TX</span><span class="p">,</span> <span class="mh">0x420000</span><span class="p">);</span>
	<span class="n">mc13xxx_reg_write</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_SSI_NETWORK</span><span class="p">,</span> <span class="mh">0x013060</span><span class="p">);</span>
	<span class="n">mc13xxx_reg_write</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_AUDIO_CODEC</span><span class="p">,</span> <span class="mh">0x180027</span><span class="p">);</span>
	<span class="n">mc13xxx_reg_write</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_AUDIO_DAC</span><span class="p">,</span> <span class="mh">0x0e0004</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adc_ssi_port</span> <span class="o">==</span> <span class="n">MC13783_SSI1_PORT</span><span class="p">)</span>
		<span class="n">mc13xxx_reg_rmw</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_AUDIO_CODEC</span><span class="p">,</span>
				<span class="n">AUDIO_SSI_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">mc13xxx_reg_rmw</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_AUDIO_CODEC</span><span class="p">,</span>
				<span class="mi">0</span><span class="p">,</span> <span class="n">AUDIO_SSI_SEL</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">dac_ssi_port</span> <span class="o">==</span> <span class="n">MC13783_SSI1_PORT</span><span class="p">)</span>
		<span class="n">mc13xxx_reg_rmw</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_AUDIO_DAC</span><span class="p">,</span>
				<span class="n">AUDIO_SSI_SEL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">mc13xxx_reg_rmw</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_AUDIO_DAC</span><span class="p">,</span>
				<span class="mi">0</span><span class="p">,</span> <span class="n">AUDIO_SSI_SEL</span><span class="p">);</span>

	<span class="n">mc13xxx_unlock</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mc13783_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">snd_soc_codec_get_drvdata</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="n">mc13xxx_lock</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">);</span>

	<span class="cm">/* Make sure VAUDIOON is off */</span>
	<span class="n">mc13xxx_reg_rmw</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">,</span> <span class="n">MC13783_AUDIO_RX0</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">mc13xxx_unlock</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define MC13783_RATES_RECORD (SNDRV_PCM_RATE_8000 | SNDRV_PCM_RATE_16000)</span>

<span class="cp">#define MC13783_FORMATS (SNDRV_PCM_FMTBIT_S16_LE | SNDRV_PCM_FMTBIT_S20_3LE |\</span>
<span class="cp">	SNDRV_PCM_FMTBIT_S24_LE)</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">mc13783_ops_dac</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">hw_params</span>	<span class="o">=</span> <span class="n">mc13783_pcm_hw_params_dac</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_fmt</span>	<span class="o">=</span> <span class="n">mc13783_set_fmt_async</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_sysclk</span>	<span class="o">=</span> <span class="n">mc13783_set_sysclk_dac</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_tdm_slot</span>	<span class="o">=</span> <span class="n">mc13783_set_tdm_slot_dac</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">mc13783_ops_codec</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">hw_params</span>	<span class="o">=</span> <span class="n">mc13783_pcm_hw_params_codec</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_fmt</span>	<span class="o">=</span> <span class="n">mc13783_set_fmt_async</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_sysclk</span>	<span class="o">=</span> <span class="n">mc13783_set_sysclk_codec</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_tdm_slot</span>	<span class="o">=</span> <span class="n">mc13783_set_tdm_slot_codec</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * The mc13783 has two SSI ports, both of them can be routed either</span>
<span class="cm"> * to the voice codec or the stereo DAC. When two different SSI ports</span>
<span class="cm"> * are used for the voice codec and the stereo DAC we can do different</span>
<span class="cm"> * formats and sysclock settings for playback and capture</span>
<span class="cm"> * (mc13783-hifi-playback and mc13783-hifi-capture). Using the same port</span>
<span class="cm"> * forces us to use symmetric rates (mc13783-hifi).</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_dai_driver</span> <span class="n">mc13783_dai_async</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;mc13783-hifi-playback&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">MC13783_ID_STEREO_DAC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Playback&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">SNDRV_PCM_RATE_8000_96000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">MC13783_FORMATS</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mc13783_ops_dac</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;mc13783-hifi-capture&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">MC13783_ID_STEREO_CODEC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">capture</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Capture&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">MC13783_RATES_RECORD</span><span class="p">,</span>
			<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">MC13783_FORMATS</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mc13783_ops_codec</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">mc13783_ops_sync</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">hw_params</span>	<span class="o">=</span> <span class="n">mc13783_pcm_hw_params_sync</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_fmt</span>	<span class="o">=</span> <span class="n">mc13783_set_fmt_sync</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_sysclk</span>	<span class="o">=</span> <span class="n">mc13783_set_sysclk_sync</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_tdm_slot</span>	<span class="o">=</span> <span class="n">mc13783_set_tdm_slot_sync</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_dai_driver</span> <span class="n">mc13783_dai_sync</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;mc13783-hifi&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">MC13783_ID_SYNC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Playback&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">SNDRV_PCM_RATE_8000_96000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">MC13783_FORMATS</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">capture</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Capture&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">MC13783_RATES_RECORD</span><span class="p">,</span>
			<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">MC13783_FORMATS</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mc13783_ops_sync</span><span class="p">,</span>
		<span class="p">.</span><span class="n">symmetric_rates</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_codec_driver</span> <span class="n">soc_codec_dev_mc13783</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">probe</span>		<span class="o">=</span> <span class="n">mc13783_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>		<span class="o">=</span> <span class="n">mc13783_remove</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">mc13783_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span>		<span class="o">=</span> <span class="n">mc13783_write</span><span class="p">,</span>
	<span class="p">.</span><span class="n">controls</span>	<span class="o">=</span> <span class="n">mc13783_control_list</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_controls</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mc13783_control_list</span><span class="p">),</span>
	<span class="p">.</span><span class="n">dapm_widgets</span>	<span class="o">=</span> <span class="n">mc13783_dapm_widgets</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dapm_widgets</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mc13783_dapm_widgets</span><span class="p">),</span>
	<span class="p">.</span><span class="n">dapm_routes</span>	<span class="o">=</span> <span class="n">mc13783_routes</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dapm_routes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mc13783_routes</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_codec_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">mc13xxx</span> <span class="o">*</span><span class="n">mc13xxx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mc13783_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mc13xxx_codec_platform_data</span> <span class="o">*</span><span class="n">pdata</span> <span class="o">=</span> <span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">platform_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">mc13xxx</span> <span class="o">=</span> <span class="n">dev_get_drvdata</span><span class="p">(</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">parent</span><span class="p">);</span>


	<span class="n">priv</span> <span class="o">=</span> <span class="n">devm_kzalloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">priv</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">dev_set_drvdata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">priv</span><span class="p">);</span>
	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">mc13xxx</span> <span class="o">=</span> <span class="n">mc13xxx</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pdata</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">adc_ssi_port</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">adc_ssi_port</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dac_ssi_port</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">dac_ssi_port</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">adc_ssi_port</span> <span class="o">=</span> <span class="n">MC13783_SSI1_PORT</span><span class="p">;</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">dac_ssi_port</span> <span class="o">=</span> <span class="n">MC13783_SSI2_PORT</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">adc_ssi_port</span> <span class="o">==</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">dac_ssi_port</span><span class="p">)</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_register_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">soc_codec_dev_mc13783</span><span class="p">,</span>
			<span class="n">mc13783_dai_sync</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mc13783_dai_sync</span><span class="p">));</span>
	<span class="k">else</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">snd_soc_register_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">soc_codec_dev_mc13783</span><span class="p">,</span>
			<span class="n">mc13783_dai_async</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mc13783_dai_async</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err_register_codec</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">err_register_codec:</span>
	<span class="n">dev_err</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;register codec failed with %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mc13783_codec_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_unregister_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_driver</span> <span class="n">mc13783_codec_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
		   <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;mc13783-codec&quot;</span><span class="p">,</span>
		   <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
		   <span class="p">},</span>
	<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">mc13783_codec_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span> <span class="o">=</span> <span class="n">__devexit_p</span><span class="p">(</span><span class="n">mc13783_codec_remove</span><span class="p">),</span>
<span class="p">};</span>

<span class="n">module_platform_driver</span><span class="p">(</span><span class="n">mc13783_codec_driver</span><span class="p">);</span>

<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;ASoC MC13783 driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Sascha Hauer, Pengutronix &lt;s.hauer@pengutronix.de&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Philippe Retornaz &lt;philippe.retornaz@epfl.ch&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
