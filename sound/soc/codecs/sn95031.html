<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › soc › codecs › sn95031.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>sn95031.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  sn95031.c -  TI sn95031 Codec driver</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 2010 Intel Corp</span>
<span class="cm"> *  Author: Vinod Koul &lt;vinod.koul@intel.com&gt;</span>
<span class="cm"> *  Author: Harsha Priya &lt;priya.harsha@intel.com&gt;</span>
<span class="cm"> *  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; version 2 of the License.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> *  WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> *  General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License along</span>
<span class="cm"> *  with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="cm"> *  59 Temple Place, Suite 330, Boston, MA 02111-1307 USA.</span>
<span class="cm"> *</span>
<span class="cm"> * ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#define pr_fmt(fmt) KBUILD_MODNAME &quot;: &quot; fmt</span>

<span class="cp">#include &lt;linux/platform_device.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>

<span class="cp">#include &lt;asm/intel_scu_ipc.h&gt;</span>
<span class="cp">#include &lt;sound/pcm.h&gt;</span>
<span class="cp">#include &lt;sound/pcm_params.h&gt;</span>
<span class="cp">#include &lt;sound/soc.h&gt;</span>
<span class="cp">#include &lt;sound/soc-dapm.h&gt;</span>
<span class="cp">#include &lt;sound/initval.h&gt;</span>
<span class="cp">#include &lt;sound/tlv.h&gt;</span>
<span class="cp">#include &lt;sound/jack.h&gt;</span>
<span class="cp">#include &quot;sn95031.h&quot;</span>

<span class="cp">#define SN95031_RATES (SNDRV_PCM_RATE_48000 | SNDRV_PCM_RATE_44100)</span>
<span class="cp">#define SN95031_FORMATS (SNDRV_PCM_FMTBIT_S24_LE | SNDRV_PCM_FMTBIT_S16_LE)</span>

<span class="cm">/* adc helper functions */</span>

<span class="cm">/* enables mic bias voltage */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">sn95031_enable_mic_bias</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VAUD</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_MICBIAS</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/* Enable/Disable the ADC depending on the argument */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">configure_adc</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">sn95031_codec</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">sn95031_codec</span><span class="p">,</span> <span class="n">SN95031_ADC1CNTL1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Enable and start the ADC */</span>
		<span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="n">SN95031_ADC_ENBL</span> <span class="o">|</span> <span class="n">SN95031_ADC_START</span><span class="p">);</span>
		<span class="n">value</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">SN95031_ADC_NO_LOOP</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* Just stop the ADC */</span>
		<span class="n">value</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="o">~</span><span class="n">SN95031_ADC_START</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">sn95031_codec</span><span class="p">,</span> <span class="n">SN95031_ADC1CNTL1</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * finds an empty channel for conversion</span>
<span class="cm"> * If the ADC is not enabled then start using 0th channel</span>
<span class="cm"> * itself. Otherwise find an empty channel by looking for a</span>
<span class="cm"> * channel in which the stopbit is set to 1. returns the index</span>
<span class="cm"> * of the first free channel if succeeds or an error code.</span>
<span class="cm"> *</span>
<span class="cm"> * Context: can sleep</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">find_free_channel</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">sn95031_codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">value</span><span class="p">;</span>

	<span class="cm">/* check whether ADC is enabled */</span>
	<span class="n">value</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">sn95031_codec</span><span class="p">,</span> <span class="n">SN95031_ADC1CNTL1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">SN95031_ADC_ENBL</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* ADC is already enabled; Looking for an empty channel */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span>	<span class="n">SN95031_ADC_CHANLS_MAX</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">sn95031_codec</span><span class="p">,</span>
				<span class="n">SN95031_ADC_CHNL_START_ADDR</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="n">SN95031_STOPBIT_MASK</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">SN95031_ADC_CHANLS_MAX</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="o">-</span><span class="n">EINVAL</span><span class="p">)</span> <span class="o">:</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Initialize the ADC for reading micbias values. Can sleep. */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_initialize_adc</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">sn95031_codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">base_addr</span><span class="p">,</span> <span class="n">chnl_addr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">channel_index</span><span class="p">;</span>

	<span class="cm">/* Index of the first channel in which the stop bit is set */</span>
	<span class="n">channel_index</span> <span class="o">=</span> <span class="n">find_free_channel</span><span class="p">(</span><span class="n">sn95031_codec</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">channel_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;No free ADC channels&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">channel_index</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">base_addr</span> <span class="o">=</span> <span class="n">SN95031_ADC_CHNL_START_ADDR</span> <span class="o">+</span> <span class="n">channel_index</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">channel_index</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">channel_index</span> <span class="o">==</span>  <span class="n">SN95031_ADC_LOOP_MAX</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/* Reset stop bit for channels other than 0 and 12 */</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">sn95031_codec</span><span class="p">,</span> <span class="n">base_addr</span><span class="p">);</span>
		<span class="cm">/* Set the stop bit to zero */</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">sn95031_codec</span><span class="p">,</span> <span class="n">base_addr</span><span class="p">,</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xEF</span><span class="p">);</span>
		<span class="cm">/* Index of the first free channel */</span>
		<span class="n">base_addr</span><span class="o">++</span><span class="p">;</span>
		<span class="n">channel_index</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Since this is the last channel, set the stop bit</span>
<span class="cm">	   to 1 by ORing the DIE_SENSOR_CODE with 0x10 */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">sn95031_codec</span><span class="p">,</span> <span class="n">base_addr</span><span class="p">,</span>
				<span class="n">SN95031_AUDIO_DETECT_CODE</span> <span class="o">|</span> <span class="mh">0x10</span><span class="p">);</span>

	<span class="n">chnl_addr</span> <span class="o">=</span> <span class="n">SN95031_ADC_DATA_START_ADDR</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">channel_index</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;mid_initialize : %x&quot;</span><span class="p">,</span> <span class="n">chnl_addr</span><span class="p">);</span>
	<span class="n">configure_adc</span><span class="p">(</span><span class="n">sn95031_codec</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">chnl_addr</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* reads the ADC registers and gets the mic bias value in mV. */</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">sn95031_get_mic_bias</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">adc_adr</span> <span class="o">=</span> <span class="n">sn95031_initialize_adc</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>
	<span class="n">u16</span> <span class="n">adc_val1</span><span class="p">,</span> <span class="n">adc_val2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mic_bias</span><span class="p">;</span>

	<span class="n">sn95031_enable_mic_bias</span><span class="p">(</span><span class="n">codec</span><span class="p">);</span>

	<span class="cm">/* Enable the sound card for conversion before reading */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_ADC1CNTL3</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">);</span>
	<span class="cm">/* Re-toggle the RRDATARD bit */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_ADC1CNTL3</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>

	<span class="cm">/* Read the higher bits of data */</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
	<span class="n">adc_val1</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">adc_adr</span><span class="p">);</span>
	<span class="n">adc_adr</span><span class="o">++</span><span class="p">;</span>
	<span class="n">adc_val2</span> <span class="o">=</span> <span class="n">snd_soc_read</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">adc_adr</span><span class="p">);</span>

	<span class="cm">/* Adding lower two bits to the higher bits */</span>
	<span class="n">mic_bias</span> <span class="o">=</span> <span class="p">(</span><span class="n">adc_val1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">adc_val2</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="n">mic_bias</span> <span class="o">=</span> <span class="p">(</span><span class="n">mic_bias</span> <span class="o">*</span> <span class="n">SN95031_ADC_ONE_LSB_MULTIPLIER</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;mic bias = %dmV</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">mic_bias</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">mic_bias</span><span class="p">;</span>
<span class="p">}</span>
<span class="cm">/*end - adc helper functions */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">sn95031_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">intel_scu_ipc_ioread8</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;read of %x failed, err %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">value</span><span class="p">;</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">sn95031_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">intel_scu_ipc_iowrite8</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;write of %x failed, err %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_set_vaud_bias</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">,</span>
		<span class="k">enum</span> <span class="n">snd_soc_bias_level</span> <span class="n">level</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SND_SOC_BIAS_ON</span>:
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SND_SOC_BIAS_PREPARE</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dapm</span><span class="p">.</span><span class="n">bias_level</span> <span class="o">==</span> <span class="n">SND_SOC_BIAS_STANDBY</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;vaud_bias powering up pll</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="cm">/* power up the pll */</span>
			<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_AUDPLLCTRL</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
			<span class="cm">/* enable pcm 2 */</span>
			<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM2C2</span><span class="p">,</span>
					<span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SND_SOC_BIAS_STANDBY</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dapm</span><span class="p">.</span><span class="n">bias_level</span> <span class="o">==</span> <span class="n">SND_SOC_BIAS_OFF</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;vaud_bias power up rail</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="cm">/* power up the rail */</span>
			<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VAUD</span><span class="p">,</span>
					<span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">codec</span><span class="o">-&gt;</span><span class="n">dapm</span><span class="p">.</span><span class="n">bias_level</span> <span class="o">==</span> <span class="n">SND_SOC_BIAS_PREPARE</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* turn off pcm */</span>
			<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;vaud_bias power dn pcm</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM2C2</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_AUDPLLCTRL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>


	<span class="k">case</span> <span class="n">SND_SOC_BIAS_OFF</span>:
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;vaud_bias _OFF doing rail shutdown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VAUD</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">codec</span><span class="o">-&gt;</span><span class="n">dapm</span><span class="p">.</span><span class="n">bias_level</span> <span class="o">=</span> <span class="n">level</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_vhs_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">SND_SOC_DAPM_EVENT_ON</span><span class="p">(</span><span class="n">event</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;VHS SND_SOC_DAPM_EVENT_ON doing rail startup now</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="cm">/* power up the rail */</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VHSP</span><span class="p">,</span> <span class="mh">0x3D</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VHSN</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">SND_SOC_DAPM_EVENT_OFF</span><span class="p">(</span><span class="n">event</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;VHS SND_SOC_DAPM_EVENT_OFF doing rail shutdown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VHSP</span><span class="p">,</span> <span class="mh">0xC4</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VHSN</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_vihf_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">kcontrol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">SND_SOC_DAPM_EVENT_ON</span><span class="p">(</span><span class="n">event</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;VIHF SND_SOC_DAPM_EVENT_ON doing rail startup now</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="cm">/* power up the rail */</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VIHF</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">SND_SOC_DAPM_EVENT_OFF</span><span class="p">(</span><span class="n">event</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;VIHF SND_SOC_DAPM_EVENT_OFF doing rail shutdown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VIHF</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_dmic12_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ldo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">clk_dir</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data_dir</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">SND_SOC_DAPM_EVENT_ON</span><span class="p">(</span><span class="n">event</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ldo</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
		<span class="n">clk_dir</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="n">data_dir</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/* program DMIC LDO, clock and set clock */</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_MICBIAS</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">ldo</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_DMICBUF0123</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">clk_dir</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_DMICBUF0123</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="n">data_dir</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_dmic34_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ldo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">clk_dir</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data_dir</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">SND_SOC_DAPM_EVENT_ON</span><span class="p">(</span><span class="n">event</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ldo</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
		<span class="n">clk_dir</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
		<span class="n">data_dir</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/* program DMIC LDO, clock and set clock */</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_MICBIAS</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="n">ldo</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_DMICBUF0123</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">clk_dir</span><span class="p">);</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_DMICBUF45</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">data_dir</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_dmic56_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="o">*</span><span class="n">w</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">snd_kcontrol</span> <span class="o">*</span><span class="n">k</span><span class="p">,</span> <span class="kt">int</span> <span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ldo</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">SND_SOC_DAPM_EVENT_ON</span><span class="p">(</span><span class="n">event</span><span class="p">))</span>
		<span class="n">ldo</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span>

	<span class="cm">/* program DMIC LDO */</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">w</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_MICBIAS</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span> <span class="n">ldo</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* mux controls */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sn95031_mic_texts</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;AMIC&quot;</span><span class="p">,</span> <span class="s">&quot;LineIn&quot;</span> <span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_micl_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_ADCCONFIG</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sn95031_mic_texts</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">sn95031_micl_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Route&quot;</span><span class="p">,</span> <span class="n">sn95031_micl_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_micr_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_ADCCONFIG</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sn95031_mic_texts</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">sn95031_micr_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Route&quot;</span><span class="p">,</span> <span class="n">sn95031_micr_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sn95031_input_texts</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>	<span class="s">&quot;DMIC1&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">,</span>
						<span class="s">&quot;DMIC4&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">,</span>
						<span class="s">&quot;ADC Left&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Right&quot;</span> <span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_input1_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_AUDIOMUX12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">sn95031_input_texts</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">sn95031_input1_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Route&quot;</span><span class="p">,</span> <span class="n">sn95031_input1_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_input2_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_AUDIOMUX12</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">sn95031_input_texts</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">sn95031_input2_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Route&quot;</span><span class="p">,</span> <span class="n">sn95031_input2_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_input3_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_AUDIOMUX34</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">sn95031_input_texts</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">sn95031_input3_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Route&quot;</span><span class="p">,</span> <span class="n">sn95031_input3_enum</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_input4_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_AUDIOMUX34</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">sn95031_input_texts</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">sn95031_input4_mux_control</span> <span class="o">=</span>
	<span class="n">SOC_DAPM_ENUM</span><span class="p">(</span><span class="s">&quot;Route&quot;</span><span class="p">,</span> <span class="n">sn95031_input4_enum</span><span class="p">);</span>

<span class="cm">/* capture path controls */</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sn95031_micmode_text</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;Single Ended&quot;</span><span class="p">,</span> <span class="s">&quot;Differential&quot;</span><span class="p">};</span>

<span class="cm">/* 0dB to 30dB in 10dB steps */</span>
<span class="k">static</span> <span class="k">const</span> <span class="n">DECLARE_TLV_DB_SCALE</span><span class="p">(</span><span class="n">mic_tlv</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_micmode1_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_MICAMP1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sn95031_micmode_text</span><span class="p">);</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_micmode2_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_MICAMP2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sn95031_micmode_text</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sn95031_dmic_cfg_text</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;GPO&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC&quot;</span><span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_dmic12_cfg_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_DMICMUX</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sn95031_dmic_cfg_text</span><span class="p">);</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_dmic34_cfg_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_DMICMUX</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sn95031_dmic_cfg_text</span><span class="p">);</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">soc_enum</span> <span class="n">sn95031_dmic56_cfg_enum</span> <span class="o">=</span>
	<span class="n">SOC_ENUM_SINGLE</span><span class="p">(</span><span class="n">SN95031_DMICMUX</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sn95031_dmic_cfg_text</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_kcontrol_new</span> <span class="n">sn95031_snd_controls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;Mic1Mode Capture Route&quot;</span><span class="p">,</span> <span class="n">sn95031_micmode1_enum</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;Mic2Mode Capture Route&quot;</span><span class="p">,</span> <span class="n">sn95031_micmode2_enum</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;DMIC12 Capture Route&quot;</span><span class="p">,</span> <span class="n">sn95031_dmic12_cfg_enum</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;DMIC34 Capture Route&quot;</span><span class="p">,</span> <span class="n">sn95031_dmic34_cfg_enum</span><span class="p">),</span>
	<span class="n">SOC_ENUM</span><span class="p">(</span><span class="s">&quot;DMIC56 Capture Route&quot;</span><span class="p">,</span> <span class="n">sn95031_dmic56_cfg_enum</span><span class="p">),</span>
	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;Mic1 Capture Volume&quot;</span><span class="p">,</span> <span class="n">SN95031_MICAMP1</span><span class="p">,</span>
			<span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mic_tlv</span><span class="p">),</span>
	<span class="n">SOC_SINGLE_TLV</span><span class="p">(</span><span class="s">&quot;Mic2 Capture Volume&quot;</span><span class="p">,</span> <span class="n">SN95031_MICAMP2</span><span class="p">,</span>
			<span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mic_tlv</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/* DAPM widgets */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dapm_widget</span> <span class="n">sn95031_dapm_widgets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

	<span class="cm">/* all end points mic, hs etc */</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;HPOUTL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;HPOUTR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;EPOUT&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;IHFOUTL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;IHFOUTR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;LINEOUTL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;LINEOUTR&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;VIB1OUT&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_OUTPUT</span><span class="p">(</span><span class="s">&quot;VIB2OUT&quot;</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;AMIC1&quot;</span><span class="p">),</span> <span class="cm">/* headset mic */</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;AMIC2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;DMIC1&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;DMIC2&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;DMIC3&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;DMIC4&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;DMIC5&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;DMIC6&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;LINEINL&quot;</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_INPUT</span><span class="p">(</span><span class="s">&quot;LINEINR&quot;</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_MICBIAS</span><span class="p">(</span><span class="s">&quot;AMIC1Bias&quot;</span><span class="p">,</span> <span class="n">SN95031_MICBIAS</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MICBIAS</span><span class="p">(</span><span class="s">&quot;AMIC2Bias&quot;</span><span class="p">,</span> <span class="n">SN95031_MICBIAS</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MICBIAS</span><span class="p">(</span><span class="s">&quot;DMIC12Bias&quot;</span><span class="p">,</span> <span class="n">SN95031_DMICMUX</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MICBIAS</span><span class="p">(</span><span class="s">&quot;DMIC34Bias&quot;</span><span class="p">,</span> <span class="n">SN95031_DMICMUX</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MICBIAS</span><span class="p">(</span><span class="s">&quot;DMIC56Bias&quot;</span><span class="p">,</span> <span class="n">SN95031_DMICMUX</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;DMIC12supply&quot;</span><span class="p">,</span> <span class="n">SN95031_DMICLK</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="n">sn95031_dmic12_event</span><span class="p">,</span>
				<span class="n">SND_SOC_DAPM_PRE_PMU</span> <span class="o">|</span> <span class="n">SND_SOC_DAPM_POST_PMD</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;DMIC34supply&quot;</span><span class="p">,</span> <span class="n">SN95031_DMICLK</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="n">sn95031_dmic34_event</span><span class="p">,</span>
				<span class="n">SND_SOC_DAPM_PRE_PMU</span> <span class="o">|</span> <span class="n">SND_SOC_DAPM_POST_PMD</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;DMIC56supply&quot;</span><span class="p">,</span> <span class="n">SN95031_DMICLK</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="n">sn95031_dmic56_event</span><span class="p">,</span>
				<span class="n">SND_SOC_DAPM_PRE_PMU</span> <span class="o">|</span> <span class="n">SND_SOC_DAPM_POST_PMD</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_AIF_OUT</span><span class="p">(</span><span class="s">&quot;PCM_Out&quot;</span><span class="p">,</span> <span class="s">&quot;Capture&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;Headset Rail&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">sn95031_vhs_event</span><span class="p">,</span>
			<span class="n">SND_SOC_DAPM_PRE_PMU</span> <span class="o">|</span> <span class="n">SND_SOC_DAPM_POST_PMD</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_SUPPLY</span><span class="p">(</span><span class="s">&quot;Speaker Rail&quot;</span><span class="p">,</span> <span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">sn95031_vihf_event</span><span class="p">,</span>
			<span class="n">SND_SOC_DAPM_PRE_PMU</span> <span class="o">|</span> <span class="n">SND_SOC_DAPM_POST_PMD</span><span class="p">),</span>

	<span class="cm">/* playback path driver enables */</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Headset Left Playback&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DRIVEREN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Headset Right Playback&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DRIVEREN</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Speaker Left Playback&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DRIVEREN</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Speaker Right Playback&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DRIVEREN</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Vibra1 Playback&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DRIVEREN</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Vibra2 Playback&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DRIVEREN</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Earpiece Playback&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DRIVEREN</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Lineout Left Playback&quot;</span><span class="p">,</span>
			<span class="n">SN95031_LOCTL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Lineout Right Playback&quot;</span><span class="p">,</span>
			<span class="n">SN95031_LOCTL</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* playback path filter enable */</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Headset Left Filter&quot;</span><span class="p">,</span>
			<span class="n">SN95031_HSEPRXCTRL</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Headset Right Filter&quot;</span><span class="p">,</span>
			<span class="n">SN95031_HSEPRXCTRL</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Speaker Left Filter&quot;</span><span class="p">,</span>
			<span class="n">SN95031_IHFRXCTRL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;Speaker Right Filter&quot;</span><span class="p">,</span>
			<span class="n">SN95031_IHFRXCTRL</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>  <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* DACs */</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;HSDAC Left&quot;</span><span class="p">,</span> <span class="s">&quot;Headset&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DACCONFIG</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;HSDAC Right&quot;</span><span class="p">,</span> <span class="s">&quot;Headset&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DACCONFIG</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;IHFDAC Left&quot;</span><span class="p">,</span> <span class="s">&quot;Speaker&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DACCONFIG</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;IHFDAC Right&quot;</span><span class="p">,</span> <span class="s">&quot;Speaker&quot;</span><span class="p">,</span>
			<span class="n">SN95031_DACCONFIG</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;Vibra1 DAC&quot;</span><span class="p">,</span> <span class="s">&quot;Vibra1&quot;</span><span class="p">,</span>
			<span class="n">SN95031_VIB1C5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_DAC</span><span class="p">(</span><span class="s">&quot;Vibra2 DAC&quot;</span><span class="p">,</span> <span class="s">&quot;Vibra2&quot;</span><span class="p">,</span>
			<span class="n">SN95031_VIB2C5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* capture widgets */</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;LineIn Enable Left&quot;</span><span class="p">,</span> <span class="n">SN95031_MICAMP1</span><span class="p">,</span>
				<span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;LineIn Enable Right&quot;</span><span class="p">,</span> <span class="n">SN95031_MICAMP2</span><span class="p">,</span>
				<span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;MIC1 Enable&quot;</span><span class="p">,</span> <span class="n">SN95031_MICAMP1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;MIC2 Enable&quot;</span><span class="p">,</span> <span class="n">SN95031_MICAMP2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;TX1 Enable&quot;</span><span class="p">,</span> <span class="n">SN95031_AUDIOTXEN</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;TX2 Enable&quot;</span><span class="p">,</span> <span class="n">SN95031_AUDIOTXEN</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;TX3 Enable&quot;</span><span class="p">,</span> <span class="n">SN95031_AUDIOTXEN</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_PGA</span><span class="p">(</span><span class="s">&quot;TX4 Enable&quot;</span><span class="p">,</span> <span class="n">SN95031_AUDIOTXEN</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="cm">/* ADC have null stream as they will be turned ON by TX path */</span>
	<span class="n">SND_SOC_DAPM_ADC</span><span class="p">(</span><span class="s">&quot;ADC Left&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
			<span class="n">SN95031_ADCCONFIG</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_ADC</span><span class="p">(</span><span class="s">&quot;ADC Right&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span>
			<span class="n">SN95031_ADCCONFIG</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Mic_InputL Capture Route&quot;</span><span class="p">,</span>
			<span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sn95031_micl_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Mic_InputR Capture Route&quot;</span><span class="p">,</span>
			<span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sn95031_micr_mux_control</span><span class="p">),</span>

	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Txpath1 Capture Route&quot;</span><span class="p">,</span>
			<span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sn95031_input1_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Txpath2 Capture Route&quot;</span><span class="p">,</span>
			<span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sn95031_input2_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Txpath3 Capture Route&quot;</span><span class="p">,</span>
			<span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sn95031_input3_mux_control</span><span class="p">),</span>
	<span class="n">SND_SOC_DAPM_MUX</span><span class="p">(</span><span class="s">&quot;Txpath4 Capture Route&quot;</span><span class="p">,</span>
			<span class="n">SND_SOC_NOPM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sn95031_input4_mux_control</span><span class="p">),</span>

<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dapm_route</span> <span class="n">sn95031_audio_map</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* headset and earpiece map */</span>
	<span class="p">{</span> <span class="s">&quot;HPOUTL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Rail&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;HPOUTR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Rail&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;HPOUTL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Left Playback&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;HPOUTR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Right Playback&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;EPOUT&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Earpiece Playback&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Headset Left Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Left Filter&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Headset Right Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Right Filter&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Earpiece Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Left Filter&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Headset Left Filter&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;HSDAC Left&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Headset Right Filter&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;HSDAC Right&quot;</span><span class="p">},</span>

	<span class="cm">/* speaker map */</span>
	<span class="p">{</span> <span class="s">&quot;IHFOUTL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Speaker Rail&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;IHFOUTR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Speaker Rail&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;IHFOUTL&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;Speaker Left Playback&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;IHFOUTR&quot;</span><span class="p">,</span> <span class="s">&quot;NULL&quot;</span><span class="p">,</span> <span class="s">&quot;Speaker Right Playback&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Speaker Left Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Speaker Left Filter&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Speaker Right Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Speaker Right Filter&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Speaker Left Filter&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;IHFDAC Left&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Speaker Right Filter&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;IHFDAC Right&quot;</span><span class="p">},</span>

	<span class="cm">/* vibra map */</span>
	<span class="p">{</span> <span class="s">&quot;VIB1OUT&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Vibra1 Playback&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Vibra1 Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Vibra1 DAC&quot;</span><span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;VIB2OUT&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Vibra2 Playback&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Vibra2 Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Vibra2 DAC&quot;</span><span class="p">},</span>

	<span class="cm">/* lineout */</span>
	<span class="p">{</span> <span class="s">&quot;LINEOUTL&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Lineout Left Playback&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;LINEOUTR&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Lineout Right Playback&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Lineout Left Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Left Filter&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Lineout Left Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Speaker Left Filter&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Lineout Left Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Vibra1 DAC&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Lineout Right Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Headset Right Filter&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Lineout Right Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Speaker Right Filter&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Lineout Right Playback&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Vibra2 DAC&quot;</span><span class="p">},</span>

	<span class="cm">/* Headset (AMIC1) mic */</span>
	<span class="p">{</span> <span class="s">&quot;AMIC1Bias&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;AMIC1&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;MIC1 Enable&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;AMIC1Bias&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Mic_InputL Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;AMIC&quot;</span><span class="p">,</span> <span class="s">&quot;MIC1 Enable&quot;</span><span class="p">},</span>

	<span class="cm">/* AMIC2 */</span>
	<span class="p">{</span> <span class="s">&quot;AMIC2Bias&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;AMIC2&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;MIC2 Enable&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;AMIC2Bias&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Mic_InputR Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;AMIC&quot;</span><span class="p">,</span> <span class="s">&quot;MIC2 Enable&quot;</span><span class="p">},</span>


	<span class="cm">/* Linein */</span>
	<span class="p">{</span> <span class="s">&quot;LineIn Enable Left&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;LINEINL&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;LineIn Enable Right&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;LINEINR&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Mic_InputL Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;LineIn&quot;</span><span class="p">,</span> <span class="s">&quot;LineIn Enable Left&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Mic_InputR Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;LineIn&quot;</span><span class="p">,</span> <span class="s">&quot;LineIn Enable Right&quot;</span><span class="p">},</span>

	<span class="cm">/* ADC connection */</span>
	<span class="p">{</span> <span class="s">&quot;ADC Left&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Mic_InputL Capture Route&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;ADC Right&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Mic_InputR Capture Route&quot;</span><span class="p">},</span>

	<span class="cm">/*DMIC connections */</span>
	<span class="p">{</span> <span class="s">&quot;DMIC1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC12supply&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC12supply&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC34supply&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DMIC4&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC34supply&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC56supply&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC56supply&quot;</span><span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;DMIC12Bias&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC1&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DMIC12Bias&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DMIC34Bias&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DMIC34Bias&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DMIC56Bias&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;DMIC56Bias&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">},</span>

	<span class="cm">/*TX path inputs*/</span>
	<span class="p">{</span> <span class="s">&quot;Txpath1 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Left&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Left&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath2 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Left&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Left&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath3 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Left&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Left&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath4 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Left&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Left&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath1 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Right&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Right&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath2 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Right&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Right&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath3 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Right&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Right&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath4 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Right&quot;</span><span class="p">,</span> <span class="s">&quot;ADC Right&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath1 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC1&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC1&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath2 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC1&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC1&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath3 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC1&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC1&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath4 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC1&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC1&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath1 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath2 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath3 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath4 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC2&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath1 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath2 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath3 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath4 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath1 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC4&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath2 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC4&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath3 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC4&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath4 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC4&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath1 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath2 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath3 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath4 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath1 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath2 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath3 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;Txpath4 Capture Route&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">,</span> <span class="s">&quot;DMIC6&quot;</span><span class="p">},</span>

	<span class="cm">/* tx path */</span>
	<span class="p">{</span> <span class="s">&quot;TX1 Enable&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Txpath1 Capture Route&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;TX2 Enable&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Txpath2 Capture Route&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;TX3 Enable&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Txpath3 Capture Route&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;TX4 Enable&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;Txpath4 Capture Route&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;PCM_Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;TX1 Enable&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;PCM_Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;TX2 Enable&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;PCM_Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;TX3 Enable&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;PCM_Out&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="s">&quot;TX4 Enable&quot;</span><span class="p">},</span>

<span class="p">};</span>

<span class="cm">/* speaker and headset mutes, for audio pops and clicks */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_pcm_hs_mute</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mute</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span>
			<span class="n">SN95031_HSLVOLCTRL</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="o">!</span><span class="n">mute</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">));</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span>
			<span class="n">SN95031_HSRVOLCTRL</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="o">!</span><span class="n">mute</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_pcm_spkr_mute</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mute</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span>
			<span class="n">SN95031_IHFLVOLCTRL</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="o">!</span><span class="n">mute</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">));</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span>
			<span class="n">SN95031_IHFRVOLCTRL</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="p">(</span><span class="o">!</span><span class="n">mute</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_pcm_hw_params</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">snd_pcm_hw_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="k">struct</span> <span class="n">snd_soc_dai</span> <span class="o">*</span><span class="n">dai</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">format</span><span class="p">,</span> <span class="n">rate</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">params_format</span><span class="p">(</span><span class="n">params</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S16_LE</span>:
		<span class="n">format</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SNDRV_PCM_FORMAT_S24_LE</span>:
		<span class="n">format</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM2C2</span><span class="p">,</span>
			<span class="n">BIT</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">format</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">params_rate</span><span class="p">(</span><span class="n">params</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">48000</span>:
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;RATE_48000</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mi">44100</span>:
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;RATE_44100</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">rate</span> <span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;ERR rate %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">params_rate</span><span class="p">(</span><span class="n">params</span><span class="p">));</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">snd_soc_update_bits</span><span class="p">(</span><span class="n">dai</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM1C1</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="n">rate</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Codec DAI section */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">sn95031_headset_dai_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">digital_mute</span>	<span class="o">=</span> <span class="n">sn95031_pcm_hs_mute</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hw_params</span>	<span class="o">=</span> <span class="n">sn95031_pcm_hw_params</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">sn95031_speaker_dai_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">digital_mute</span>	<span class="o">=</span> <span class="n">sn95031_pcm_spkr_mute</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hw_params</span>	<span class="o">=</span> <span class="n">sn95031_pcm_hw_params</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">sn95031_vib1_dai_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">hw_params</span>	<span class="o">=</span> <span class="n">sn95031_pcm_hw_params</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">snd_soc_dai_ops</span> <span class="n">sn95031_vib2_dai_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">hw_params</span>	<span class="o">=</span> <span class="n">sn95031_pcm_hw_params</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">snd_soc_dai_driver</span> <span class="n">sn95031_dais</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;SN95031 Headset&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Headset&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">SN95031_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">SN95031_FORMATS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">capture</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Capture&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">SN95031_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">SN95031_FORMATS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sn95031_headset_dai_ops</span><span class="p">,</span>
<span class="p">},</span>
<span class="p">{</span>	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;SN95031 Speaker&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Speaker&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">SN95031_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">SN95031_FORMATS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sn95031_speaker_dai_ops</span><span class="p">,</span>
<span class="p">},</span>
<span class="p">{</span>	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;SN95031 Vibra1&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Vibra1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">SN95031_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">SN95031_FORMATS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sn95031_vib1_dai_ops</span><span class="p">,</span>
<span class="p">},</span>
<span class="p">{</span>	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;SN95031 Vibra2&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">playback</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">stream_name</span> <span class="o">=</span> <span class="s">&quot;Vibra2&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_min</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">channels_max</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rates</span> <span class="o">=</span> <span class="n">SN95031_RATES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">formats</span> <span class="o">=</span> <span class="n">SN95031_FORMATS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sn95031_vib2_dai_ops</span><span class="p">,</span>
<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">sn95031_disable_jack_btn</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_BTNCTRL2</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">sn95031_enable_jack_btn</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_BTNCTRL1</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_BTNCTRL2</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_get_headset_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_jack</span> <span class="o">*</span><span class="n">mfld_jack</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">micbias</span> <span class="o">=</span> <span class="n">sn95031_get_mic_bias</span><span class="p">(</span><span class="n">mfld_jack</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">);</span>

	<span class="kt">int</span> <span class="n">jack_type</span> <span class="o">=</span> <span class="n">snd_soc_jack_get_type</span><span class="p">(</span><span class="n">mfld_jack</span><span class="p">,</span> <span class="n">micbias</span><span class="p">);</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;jack type detected = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">jack_type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">jack_type</span> <span class="o">==</span> <span class="n">SND_JACK_HEADSET</span><span class="p">)</span>
		<span class="n">sn95031_enable_jack_btn</span><span class="p">(</span><span class="n">mfld_jack</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">jack_type</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">sn95031_jack_detection</span><span class="p">(</span><span class="k">struct</span> <span class="n">mfld_jack_data</span> <span class="o">*</span><span class="n">jack_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">SND_JACK_BTN_0</span> <span class="o">|</span> <span class="n">SND_JACK_BTN_1</span> <span class="o">|</span> <span class="n">SND_JACK_HEADSET</span><span class="p">;</span>

	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;interrupt id read in sram = 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">jack_data</span><span class="o">-&gt;</span><span class="n">intr_id</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">jack_data</span><span class="o">-&gt;</span><span class="n">intr_id</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;short_push detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">SND_JACK_HEADSET</span> <span class="o">|</span> <span class="n">SND_JACK_BTN_0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">jack_data</span><span class="o">-&gt;</span><span class="n">intr_id</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;long_push detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">SND_JACK_HEADSET</span> <span class="o">|</span> <span class="n">SND_JACK_BTN_1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">jack_data</span><span class="o">-&gt;</span><span class="n">intr_id</span> <span class="o">&amp;</span> <span class="mh">0x4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;headset or headphones inserted</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">sn95031_get_headset_state</span><span class="p">(</span><span class="n">jack_data</span><span class="o">-&gt;</span><span class="n">mfld_jack</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">jack_data</span><span class="o">-&gt;</span><span class="n">intr_id</span> <span class="o">&amp;</span> <span class="mh">0x8</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;headset or headphones removed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">sn95031_disable_jack_btn</span><span class="p">(</span><span class="n">jack_data</span><span class="o">-&gt;</span><span class="n">mfld_jack</span><span class="o">-&gt;</span><span class="n">codec</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;unidentified interrupt</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">snd_soc_jack_report</span><span class="p">(</span><span class="n">jack_data</span><span class="o">-&gt;</span><span class="n">mfld_jack</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
	<span class="cm">/*button pressed and released so we send explicit button release */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">SND_JACK_BTN_0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">SND_JACK_BTN_1</span><span class="p">))</span>
		<span class="n">snd_soc_jack_report</span><span class="p">(</span><span class="n">jack_data</span><span class="o">-&gt;</span><span class="n">mfld_jack</span><span class="p">,</span>
				<span class="n">SND_JACK_HEADSET</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">sn95031_jack_detection</span><span class="p">);</span>

<span class="cm">/* codec registration */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_codec_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;codec_probe called</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="cm">/* PCM interface config</span>
<span class="cm">	 * This sets the pcm rx slot conguration to max 6 slots</span>
<span class="cm">	 * for max 4 dais (2 stereo and 2 mono)</span>
<span class="cm">	 */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM2RXSLOT01</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM2RXSLOT23</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM2RXSLOT45</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM2TXSLOT01</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM2TXSLOT23</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">);</span>
	<span class="cm">/* pcm port setting</span>
<span class="cm">	 * This sets the pcm port to slave and clock at 19.2Mhz which</span>
<span class="cm">	 * can support 6slots, sampling rate set per stream in hw-params</span>
<span class="cm">	 */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM1C1</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM2C1</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_PCM2C2</span><span class="p">,</span> <span class="mh">0x0A</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_HSMIXER</span><span class="p">,</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">|</span><span class="n">BIT</span><span class="p">(</span><span class="mi">4</span><span class="p">));</span>
	<span class="cm">/* vendor vibra workround, the vibras are muted by</span>
<span class="cm">	 * custom register so unmute them</span>
<span class="cm">	 */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_SSR5</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_SSR6</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VIB1C5</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VIB2C5</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="cm">/* configure vibras for pcm port */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VIB1C3</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_VIB2C3</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="cm">/* soft mute ramp time */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_SOFTMUTE</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>
	<span class="cm">/* fix the initial volume at 1dB,</span>
<span class="cm">	 * default in +9dB,</span>
<span class="cm">	 * 1dB give optimal swing on DAC, amps</span>
<span class="cm">	 */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_HSLVOLCTRL</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_HSRVOLCTRL</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_IHFLVOLCTRL</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_IHFRVOLCTRL</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>
	<span class="cm">/* dac mode and lineout workaround */</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_SSR2</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="n">snd_soc_write</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SN95031_SSR3</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>

	<span class="n">snd_soc_add_codec_controls</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">sn95031_snd_controls</span><span class="p">,</span>
			     <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sn95031_snd_controls</span><span class="p">));</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sn95031_codec_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">snd_soc_codec</span> <span class="o">*</span><span class="n">codec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;codec_remove called</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">sn95031_set_vaud_bias</span><span class="p">(</span><span class="n">codec</span><span class="p">,</span> <span class="n">SND_SOC_BIAS_OFF</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">snd_soc_codec_driver</span> <span class="n">sn95031_codec</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">probe</span>		<span class="o">=</span> <span class="n">sn95031_codec_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>		<span class="o">=</span> <span class="n">sn95031_codec_remove</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">sn95031_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span>		<span class="o">=</span> <span class="n">sn95031_write</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_bias_level</span>	<span class="o">=</span> <span class="n">sn95031_set_vaud_bias</span><span class="p">,</span>
	<span class="p">.</span><span class="n">idle_bias_off</span>	<span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dapm_widgets</span>	<span class="o">=</span> <span class="n">sn95031_dapm_widgets</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dapm_widgets</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sn95031_dapm_widgets</span><span class="p">),</span>
	<span class="p">.</span><span class="n">dapm_routes</span>	<span class="o">=</span> <span class="n">sn95031_audio_map</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_dapm_routes</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sn95031_audio_map</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">sn95031_device_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;codec device probe called for %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">snd_soc_register_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sn95031_codec</span><span class="p">,</span>
			<span class="n">sn95031_dais</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sn95031_dais</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devexit</span> <span class="nf">sn95031_device_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pr_debug</span><span class="p">(</span><span class="s">&quot;codec device remove called</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">snd_soc_unregister_codec</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_driver</span> <span class="n">sn95031_codec_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">driver</span>		<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;sn95031&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">probe</span>		<span class="o">=</span> <span class="n">sn95031_device_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>		<span class="o">=</span> <span class="n">__devexit_p</span><span class="p">(</span><span class="n">sn95031_device_remove</span><span class="p">),</span>
<span class="p">};</span>

<span class="n">module_platform_driver</span><span class="p">(</span><span class="n">sn95031_codec_driver</span><span class="p">);</span>

<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;ASoC TI SN95031 codec driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Vinod Koul &lt;vinod.koul@intel.com&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Harsha Priya &lt;priya.harsha@intel.com&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL v2&quot;</span><span class="p">);</span>
<span class="n">MODULE_ALIAS</span><span class="p">(</span><span class="s">&quot;platform:sn95031&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
