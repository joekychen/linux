<!DOCTYPE html>
<html><head><title>joekychen/linux » sound › soc › omap › mcbsp.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>mcbsp.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * sound/soc/omap/mcbsp.h</span>
<span class="cm"> *</span>
<span class="cm"> * OMAP Multi-Channel Buffered Serial Port</span>
<span class="cm"> *</span>
<span class="cm"> * Contact: Jarkko Nikula &lt;jarkko.nikula@bitmer.com&gt;</span>
<span class="cm"> *          Peter Ujfalusi &lt;peter.ujfalusi@ti.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __ASOC_MCBSP_H</span>
<span class="cp">#define __ASOC_MCBSP_H</span>

<span class="cp">#include &quot;omap-pcm.h&quot;</span>

<span class="cm">/* McBSP register numbers. Register address offset = num * reg_step */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="cm">/* Common registers */</span>
	<span class="n">OMAP_MCBSP_REG_SPCR2</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_SPCR1</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCR2</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCR1</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCR2</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCR1</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_SRGR2</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_SRGR1</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_MCR2</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_MCR1</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCERA</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCERB</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCERA</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCERB</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_PCR0</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCERC</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCERD</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCERC</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCERD</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCERE</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCERF</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCERE</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCERF</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCERG</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCERH</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCERG</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCERH</span><span class="p">,</span>

	<span class="cm">/* OMAP1-OMAP2420 registers */</span>
	<span class="n">OMAP_MCBSP_REG_DRR2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_DRR1</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_DXR2</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_DXR1</span><span class="p">,</span>

	<span class="cm">/* OMAP2430 and onwards */</span>
	<span class="n">OMAP_MCBSP_REG_DRR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_DXR</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_SYSCON</span> <span class="o">=</span>	<span class="mi">35</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_THRSH2</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_THRSH1</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_IRQST</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_IRQEN</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_WAKEUPEN</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XCCR</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RCCR</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_XBUFFSTAT</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_RBUFFSTAT</span><span class="p">,</span>
	<span class="n">OMAP_MCBSP_REG_SSELCR</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* OMAP3 sidetone control registers */</span>
<span class="cp">#define OMAP_ST_REG_REV		0x00</span>
<span class="cp">#define OMAP_ST_REG_SYSCONFIG	0x10</span>
<span class="cp">#define OMAP_ST_REG_IRQSTATUS	0x18</span>
<span class="cp">#define OMAP_ST_REG_IRQENABLE	0x1C</span>
<span class="cp">#define OMAP_ST_REG_SGAINCR	0x24</span>
<span class="cp">#define OMAP_ST_REG_SFIRCR	0x28</span>
<span class="cp">#define OMAP_ST_REG_SSELCR	0x2C</span>

<span class="cm">/************************** McBSP SPCR1 bit definitions ***********************/</span>
<span class="cp">#define RRST			BIT(0)</span>
<span class="cp">#define RRDY			BIT(1)</span>
<span class="cp">#define RFULL			BIT(2)</span>
<span class="cp">#define RSYNC_ERR		BIT(3)</span>
<span class="cp">#define RINTM(value)		(((value) &amp; 0x3) &lt;&lt; 4)	</span><span class="cm">/* bits 4:5 */</span><span class="cp"></span>
<span class="cp">#define ABIS			BIT(6)</span>
<span class="cp">#define DXENA			BIT(7)</span>
<span class="cp">#define CLKSTP(value)		(((value) &amp; 0x3) &lt;&lt; 11)	</span><span class="cm">/* bits 11:12 */</span><span class="cp"></span>
<span class="cp">#define RJUST(value)		(((value) &amp; 0x3) &lt;&lt; 13)	</span><span class="cm">/* bits 13:14 */</span><span class="cp"></span>
<span class="cp">#define ALB			BIT(15)</span>
<span class="cp">#define DLB			BIT(15)</span>

<span class="cm">/************************** McBSP SPCR2 bit definitions ***********************/</span>
<span class="cp">#define XRST			BIT(0)</span>
<span class="cp">#define XRDY			BIT(1)</span>
<span class="cp">#define XEMPTY			BIT(2)</span>
<span class="cp">#define XSYNC_ERR		BIT(3)</span>
<span class="cp">#define XINTM(value)		(((value) &amp; 0x3) &lt;&lt; 4)	</span><span class="cm">/* bits 4:5 */</span><span class="cp"></span>
<span class="cp">#define GRST			BIT(6)</span>
<span class="cp">#define FRST			BIT(7)</span>
<span class="cp">#define SOFT			BIT(8)</span>
<span class="cp">#define FREE			BIT(9)</span>

<span class="cm">/************************** McBSP PCR bit definitions *************************/</span>
<span class="cp">#define CLKRP			BIT(0)</span>
<span class="cp">#define CLKXP			BIT(1)</span>
<span class="cp">#define FSRP			BIT(2)</span>
<span class="cp">#define FSXP			BIT(3)</span>
<span class="cp">#define DR_STAT			BIT(4)</span>
<span class="cp">#define DX_STAT			BIT(5)</span>
<span class="cp">#define CLKS_STAT		BIT(6)</span>
<span class="cp">#define SCLKME			BIT(7)</span>
<span class="cp">#define CLKRM			BIT(8)</span>
<span class="cp">#define CLKXM			BIT(9)</span>
<span class="cp">#define FSRM			BIT(10)</span>
<span class="cp">#define FSXM			BIT(11)</span>
<span class="cp">#define RIOEN			BIT(12)</span>
<span class="cp">#define XIOEN			BIT(13)</span>
<span class="cp">#define IDLE_EN			BIT(14)</span>

<span class="cm">/************************** McBSP RCR1 bit definitions ************************/</span>
<span class="cp">#define RWDLEN1(value)		(((value) &amp; 0x7) &lt;&lt; 5)	</span><span class="cm">/* Bits 5:7 */</span><span class="cp"></span>
<span class="cp">#define RFRLEN1(value)		(((value) &amp; 0x7f) &lt;&lt; 8)	</span><span class="cm">/* Bits 8:14 */</span><span class="cp"></span>

<span class="cm">/************************** McBSP XCR1 bit definitions ************************/</span>
<span class="cp">#define XWDLEN1(value)		(((value) &amp; 0x7) &lt;&lt; 5)	</span><span class="cm">/* Bits 5:7 */</span><span class="cp"></span>
<span class="cp">#define XFRLEN1(value)		(((value) &amp; 0x7f) &lt;&lt; 8)	</span><span class="cm">/* Bits 8:14 */</span><span class="cp"></span>

<span class="cm">/*************************** McBSP RCR2 bit definitions ***********************/</span>
<span class="cp">#define RDATDLY(value)		((value) &amp; 0x3)		</span><span class="cm">/* Bits 0:1 */</span><span class="cp"></span>
<span class="cp">#define RFIG			BIT(2)</span>
<span class="cp">#define RCOMPAND(value)		(((value) &amp; 0x3) &lt;&lt; 3)	</span><span class="cm">/* Bits 3:4 */</span><span class="cp"></span>
<span class="cp">#define RWDLEN2(value)		(((value) &amp; 0x7) &lt;&lt; 5)	</span><span class="cm">/* Bits 5:7 */</span><span class="cp"></span>
<span class="cp">#define RFRLEN2(value)		(((value) &amp; 0x7f) &lt;&lt; 8)	</span><span class="cm">/* Bits 8:14 */</span><span class="cp"></span>
<span class="cp">#define RPHASE			BIT(15)</span>

<span class="cm">/*************************** McBSP XCR2 bit definitions ***********************/</span>
<span class="cp">#define XDATDLY(value)		((value) &amp; 0x3)		</span><span class="cm">/* Bits 0:1 */</span><span class="cp"></span>
<span class="cp">#define XFIG			BIT(2)</span>
<span class="cp">#define XCOMPAND(value)		(((value) &amp; 0x3) &lt;&lt; 3)	</span><span class="cm">/* Bits 3:4 */</span><span class="cp"></span>
<span class="cp">#define XWDLEN2(value)		(((value) &amp; 0x7) &lt;&lt; 5)	</span><span class="cm">/* Bits 5:7 */</span><span class="cp"></span>
<span class="cp">#define XFRLEN2(value)		(((value) &amp; 0x7f) &lt;&lt; 8)	</span><span class="cm">/* Bits 8:14 */</span><span class="cp"></span>
<span class="cp">#define XPHASE			BIT(15)</span>

<span class="cm">/************************* McBSP SRGR1 bit definitions ************************/</span>
<span class="cp">#define CLKGDV(value)		((value) &amp; 0x7f)		</span><span class="cm">/* Bits 0:7 */</span><span class="cp"></span>
<span class="cp">#define FWID(value)		(((value) &amp; 0xff) &lt;&lt; 8)	</span><span class="cm">/* Bits 8:15 */</span><span class="cp"></span>

<span class="cm">/************************* McBSP SRGR2 bit definitions ************************/</span>
<span class="cp">#define FPER(value)		((value) &amp; 0x0fff)	</span><span class="cm">/* Bits 0:11 */</span><span class="cp"></span>
<span class="cp">#define FSGM			BIT(12)</span>
<span class="cp">#define CLKSM			BIT(13)</span>
<span class="cp">#define CLKSP			BIT(14)</span>
<span class="cp">#define GSYNC			BIT(15)</span>

<span class="cm">/************************* McBSP MCR1 bit definitions *************************/</span>
<span class="cp">#define RMCM			BIT(0)</span>
<span class="cp">#define RCBLK(value)		(((value) &amp; 0x7) &lt;&lt; 2)	</span><span class="cm">/* Bits 2:4 */</span><span class="cp"></span>
<span class="cp">#define RPABLK(value)		(((value) &amp; 0x3) &lt;&lt; 5)	</span><span class="cm">/* Bits 5:6 */</span><span class="cp"></span>
<span class="cp">#define RPBBLK(value)		(((value) &amp; 0x3) &lt;&lt; 7)	</span><span class="cm">/* Bits 7:8 */</span><span class="cp"></span>

<span class="cm">/************************* McBSP MCR2 bit definitions *************************/</span>
<span class="cp">#define XMCM(value)		((value) &amp; 0x3)		</span><span class="cm">/* Bits 0:1 */</span><span class="cp"></span>
<span class="cp">#define XCBLK(value)		(((value) &amp; 0x7) &lt;&lt; 2)	</span><span class="cm">/* Bits 2:4 */</span><span class="cp"></span>
<span class="cp">#define XPABLK(value)		(((value) &amp; 0x3) &lt;&lt; 5)	</span><span class="cm">/* Bits 5:6 */</span><span class="cp"></span>
<span class="cp">#define XPBBLK(value)		(((value) &amp; 0x3) &lt;&lt; 7)	</span><span class="cm">/* Bits 7:8 */</span><span class="cp"></span>

<span class="cm">/*********************** McBSP XCCR bit definitions *************************/</span>
<span class="cp">#define XDISABLE		BIT(0)</span>
<span class="cp">#define XDMAEN			BIT(3)</span>
<span class="cp">#define DILB			BIT(5)</span>
<span class="cp">#define XFULL_CYCLE		BIT(11)</span>
<span class="cp">#define DXENDLY(value)		(((value) &amp; 0x3) &lt;&lt; 12)	</span><span class="cm">/* Bits 12:13 */</span><span class="cp"></span>
<span class="cp">#define PPCONNECT		BIT(14)</span>
<span class="cp">#define EXTCLKGATE		BIT(15)</span>

<span class="cm">/********************** McBSP RCCR bit definitions *************************/</span>
<span class="cp">#define RDISABLE		BIT(0)</span>
<span class="cp">#define RDMAEN			BIT(3)</span>
<span class="cp">#define RFULL_CYCLE		BIT(11)</span>

<span class="cm">/********************** McBSP SYSCONFIG bit definitions ********************/</span>
<span class="cp">#define SOFTRST			BIT(1)</span>
<span class="cp">#define ENAWAKEUP		BIT(2)</span>
<span class="cp">#define SIDLEMODE(value)	(((value) &amp; 0x3) &lt;&lt; 3)</span>
<span class="cp">#define CLOCKACTIVITY(value)	(((value) &amp; 0x3) &lt;&lt; 8)</span>

<span class="cm">/********************** McBSP SSELCR bit definitions ***********************/</span>
<span class="cp">#define SIDETONEEN		BIT(10)</span>

<span class="cm">/********************** McBSP Sidetone SYSCONFIG bit definitions ***********/</span>
<span class="cp">#define ST_AUTOIDLE		BIT(0)</span>

<span class="cm">/********************** McBSP Sidetone SGAINCR bit definitions *************/</span>
<span class="cp">#define ST_CH0GAIN(value)	((value) &amp; 0xffff)	</span><span class="cm">/* Bits 0:15 */</span><span class="cp"></span>
<span class="cp">#define ST_CH1GAIN(value)	(((value) &amp; 0xffff) &lt;&lt; 16) </span><span class="cm">/* Bits 16:31 */</span><span class="cp"></span>

<span class="cm">/********************** McBSP Sidetone SFIRCR bit definitions **************/</span>
<span class="cp">#define ST_FIRCOEFF(value)	((value) &amp; 0xffff)	</span><span class="cm">/* Bits 0:15 */</span><span class="cp"></span>

<span class="cm">/********************** McBSP Sidetone SSELCR bit definitions **************/</span>
<span class="cp">#define ST_SIDETONEEN		BIT(0)</span>
<span class="cp">#define ST_COEFFWREN		BIT(1)</span>
<span class="cp">#define ST_COEFFWRDONE		BIT(2)</span>

<span class="cm">/********************** McBSP DMA operating modes **************************/</span>
<span class="cp">#define MCBSP_DMA_MODE_ELEMENT		0</span>
<span class="cp">#define MCBSP_DMA_MODE_THRESHOLD	1</span>

<span class="cm">/********************** McBSP WAKEUPEN/IRQST/IRQEN bit definitions *********/</span>
<span class="cp">#define RSYNCERREN		BIT(0)</span>
<span class="cp">#define RFSREN			BIT(1)</span>
<span class="cp">#define REOFEN			BIT(2)</span>
<span class="cp">#define RRDYEN			BIT(3)</span>
<span class="cp">#define RUNDFLEN		BIT(4)</span>
<span class="cp">#define ROVFLEN			BIT(5)</span>
<span class="cp">#define XSYNCERREN		BIT(7)</span>
<span class="cp">#define XFSXEN			BIT(8)</span>
<span class="cp">#define XEOFEN			BIT(9)</span>
<span class="cp">#define XRDYEN			BIT(10)</span>
<span class="cp">#define XUNDFLEN		BIT(11)</span>
<span class="cp">#define XOVFLEN			BIT(12)</span>
<span class="cp">#define XEMPTYEOFEN		BIT(14)</span>

<span class="cm">/* Clock signal muxing options */</span>
<span class="cp">#define CLKR_SRC_CLKR		0 </span><span class="cm">/* CLKR signal is from the CLKR pin */</span><span class="cp"></span>
<span class="cp">#define CLKR_SRC_CLKX		1 </span><span class="cm">/* CLKR signal is from the CLKX pin */</span><span class="cp"></span>
<span class="cp">#define FSR_SRC_FSR		2 </span><span class="cm">/* FSR signal is from the FSR pin */</span><span class="cp"></span>
<span class="cp">#define FSR_SRC_FSX		3 </span><span class="cm">/* FSR signal is from the FSX pin */</span><span class="cp"></span>

<span class="cm">/* McBSP functional clock sources */</span>
<span class="cp">#define MCBSP_CLKS_PRCM_SRC	0</span>
<span class="cp">#define MCBSP_CLKS_PAD_SRC	1</span>

<span class="cm">/* we don&#39;t do multichannel for now */</span>
<span class="k">struct</span> <span class="n">omap_mcbsp_reg_cfg</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">spcr2</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">spcr1</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rcr2</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rcr1</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">xcr2</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">xcr1</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">srgr2</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">srgr1</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">mcr2</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">mcr1</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pcr0</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rcerc</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rcerd</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">xcerc</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">xcerd</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rcere</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rcerf</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">xcere</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">xcerf</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rcerg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rcerh</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">xcerg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">xcerh</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">xccr</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">rccr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">omap_mcbsp_st_data</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">io_base_st</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">running</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">enabled</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">taps</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>	<span class="cm">/* Sidetone filter coefficients */</span>
	<span class="kt">int</span> <span class="n">nr_taps</span><span class="p">;</span>	<span class="cm">/* Number of filter coefficients in use */</span>
	<span class="n">s16</span> <span class="n">ch0gain</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">ch1gain</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">fclk</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_dma_base</span><span class="p">;</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">io_base</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">id</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * Flags indicating is the bus already activated and configured by</span>
<span class="cm">	 * another substream</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">active</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">configured</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">free</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_irq</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tx_irq</span><span class="p">;</span>

	<span class="cm">/* Protect the field .free, while checking if the mcbsp is in use */</span>
	<span class="k">struct</span> <span class="n">omap_mcbsp_platform_data</span> <span class="o">*</span><span class="n">pdata</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">omap_mcbsp_st_data</span> <span class="o">*</span><span class="n">st_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">omap_mcbsp_reg_cfg</span> <span class="n">cfg_regs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">omap_pcm_dma_data</span> <span class="n">dma_data</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">dma_op_mode</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_tx_thres</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">max_rx_thres</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">reg_cache</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">reg_cache_size</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fmt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">in_freq</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">clk_div</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">wlen</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="n">omap_mcbsp_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">,</span>
		       <span class="k">const</span> <span class="k">struct</span> <span class="n">omap_mcbsp_reg_cfg</span> <span class="o">*</span><span class="n">config</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">omap_mcbsp_set_tx_threshold</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">,</span> <span class="n">u16</span> <span class="n">threshold</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">omap_mcbsp_set_rx_threshold</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">,</span> <span class="n">u16</span> <span class="n">threshold</span><span class="p">);</span>
<span class="n">u16</span> <span class="n">omap_mcbsp_get_tx_delay</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">);</span>
<span class="n">u16</span> <span class="n">omap_mcbsp_get_rx_delay</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">omap_mcbsp_get_dma_op_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">omap_mcbsp_request</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">omap_mcbsp_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">omap_mcbsp_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rx</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">omap_mcbsp_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tx</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rx</span><span class="p">);</span>

<span class="cm">/* McBSP functional clock source changing function */</span>
<span class="kt">int</span> <span class="n">omap2_mcbsp_set_clks_src</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">,</span> <span class="n">u8</span> <span class="n">fck_src_id</span><span class="p">);</span>

<span class="cm">/* McBSP signal muxing API */</span>
<span class="kt">int</span> <span class="n">omap_mcbsp_6pin_src_mux</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mux</span><span class="p">);</span>

<span class="cm">/* Sidetone specific API */</span>
<span class="kt">int</span> <span class="n">omap_st_set_chgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">,</span> <span class="n">s16</span> <span class="n">chgain</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">omap_st_get_chgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channel</span><span class="p">,</span> <span class="n">s16</span> <span class="o">*</span><span class="n">chgain</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">omap_st_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">omap_st_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">omap_st_is_enabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">__devinit</span> <span class="n">omap_mcbsp_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__devexit</span> <span class="n">omap_mcbsp_sysfs_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">omap_mcbsp</span> <span class="o">*</span><span class="n">mcbsp</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __ASOC_MCBSP_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
