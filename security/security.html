<!DOCTYPE html>
<html><head><title>joekychen/linux » security › security.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../index.html"></a><h1>security.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Security plug functions</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2001 WireX Communications, Inc &lt;chris@wirex.com&gt;</span>
<span class="cm"> * Copyright (C) 2001-2002 Greg Kroah-Hartman &lt;greg@kroah.com&gt;</span>
<span class="cm"> * Copyright (C) 2001 Networks Associates Technology, Inc &lt;ssmalley@nai.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *	This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *	it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *	the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *	(at your option) any later version.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/capability.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/security.h&gt;</span>
<span class="cp">#include &lt;linux/integrity.h&gt;</span>
<span class="cp">#include &lt;linux/ima.h&gt;</span>
<span class="cp">#include &lt;linux/evm.h&gt;</span>
<span class="cp">#include &lt;linux/fsnotify.h&gt;</span>
<span class="cp">#include &lt;linux/mman.h&gt;</span>
<span class="cp">#include &lt;linux/mount.h&gt;</span>
<span class="cp">#include &lt;linux/personality.h&gt;</span>
<span class="cp">#include &lt;linux/backing-dev.h&gt;</span>
<span class="cp">#include &lt;net/flow.h&gt;</span>

<span class="cp">#define MAX_LSM_EVM_XATTR	2</span>

<span class="cm">/* Boot-time LSM user choice */</span>
<span class="k">static</span> <span class="n">__initdata</span> <span class="kt">char</span> <span class="n">chosen_lsm</span><span class="p">[</span><span class="n">SECURITY_NAME_MAX</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span>
	<span class="n">CONFIG_DEFAULT_SECURITY</span><span class="p">;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">security_operations</span> <span class="o">*</span><span class="n">security_ops</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">security_operations</span> <span class="n">default_security_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;default&quot;</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">verify</span><span class="p">(</span><span class="k">struct</span> <span class="n">security_operations</span> <span class="o">*</span><span class="n">ops</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* verify the security_operations structure exists */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ops</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">security_fixup_ops</span><span class="p">(</span><span class="n">ops</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">do_security_initcalls</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">initcall_t</span> <span class="o">*</span><span class="n">call</span><span class="p">;</span>
	<span class="n">call</span> <span class="o">=</span> <span class="n">__security_initcall_start</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">call</span> <span class="o">&lt;</span> <span class="n">__security_initcall_end</span><span class="p">)</span> <span class="p">{</span>
		<span class="p">(</span><span class="o">*</span><span class="n">call</span><span class="p">)</span> <span class="p">();</span>
		<span class="n">call</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * security_init - initializes the security framework</span>
<span class="cm"> *</span>
<span class="cm"> * This should be called early in the kernel initialization sequence.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">__init</span> <span class="nf">security_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;Security Framework initialized</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">security_fixup_ops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">default_security_ops</span><span class="p">);</span>
	<span class="n">security_ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">default_security_ops</span><span class="p">;</span>
	<span class="n">do_security_initcalls</span><span class="p">();</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">reset_security_ops</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">default_security_ops</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Save user chosen LSM */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">choose_lsm</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">strncpy</span><span class="p">(</span><span class="n">chosen_lsm</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">SECURITY_NAME_MAX</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">__setup</span><span class="p">(</span><span class="s">&quot;security=&quot;</span><span class="p">,</span> <span class="n">choose_lsm</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * security_module_enable - Load given security module on boot ?</span>
<span class="cm"> * @ops: a pointer to the struct security_operations that is to be checked.</span>
<span class="cm"> *</span>
<span class="cm"> * Each LSM must pass this method before registering its own operations</span>
<span class="cm"> * to avoid security registration races. This method may also be used</span>
<span class="cm"> * to check if your LSM is currently loaded during kernel initialization.</span>
<span class="cm"> *</span>
<span class="cm"> * Return true if:</span>
<span class="cm"> *	-The passed LSM is the one chosen by user at boot time,</span>
<span class="cm"> *	-or the passed LSM is configured as the default and the user did not</span>
<span class="cm"> *	 choose an alternate LSM at boot time.</span>
<span class="cm"> * Otherwise, return false.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">__init</span> <span class="nf">security_module_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">security_operations</span> <span class="o">*</span><span class="n">ops</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">chosen_lsm</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * register_security - registers a security framework with the kernel</span>
<span class="cm"> * @ops: a pointer to the struct security_options that is to be registered</span>
<span class="cm"> *</span>
<span class="cm"> * This function allows a security module to register itself with the</span>
<span class="cm"> * kernel security subsystem.  Some rudimentary checking is done on the @ops</span>
<span class="cm"> * value passed to this function. You&#39;ll need to check first if your LSM</span>
<span class="cm"> * is allowed to register its @ops by calling security_module_enable(@ops).</span>
<span class="cm"> *</span>
<span class="cm"> * If there is already a security module registered with the kernel,</span>
<span class="cm"> * an error will be returned.  Otherwise %0 is returned on success.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">__init</span> <span class="nf">register_security</span><span class="p">(</span><span class="k">struct</span> <span class="n">security_operations</span> <span class="o">*</span><span class="n">ops</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">verify</span><span class="p">(</span><span class="n">ops</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;%s could not verify &quot;</span>
		       <span class="s">&quot;security_operations structure.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">security_ops</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">default_security_ops</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="n">security_ops</span> <span class="o">=</span> <span class="n">ops</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Security operations */</span>

<span class="kt">int</span> <span class="nf">security_ptrace_access_check</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">child</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">ptrace_access_check</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_ptrace_traceme</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">ptrace_traceme</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_capget</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span>
		     <span class="n">kernel_cap_t</span> <span class="o">*</span><span class="n">effective</span><span class="p">,</span>
		     <span class="n">kernel_cap_t</span> <span class="o">*</span><span class="n">inheritable</span><span class="p">,</span>
		     <span class="n">kernel_cap_t</span> <span class="o">*</span><span class="n">permitted</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">capget</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">effective</span><span class="p">,</span> <span class="n">inheritable</span><span class="p">,</span> <span class="n">permitted</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_capset</span><span class="p">(</span><span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">new</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">old</span><span class="p">,</span>
		    <span class="k">const</span> <span class="n">kernel_cap_t</span> <span class="o">*</span><span class="n">effective</span><span class="p">,</span>
		    <span class="k">const</span> <span class="n">kernel_cap_t</span> <span class="o">*</span><span class="n">inheritable</span><span class="p">,</span>
		    <span class="k">const</span> <span class="n">kernel_cap_t</span> <span class="o">*</span><span class="n">permitted</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">capset</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span>
				    <span class="n">effective</span><span class="p">,</span> <span class="n">inheritable</span><span class="p">,</span> <span class="n">permitted</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_capable</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">cred</span><span class="p">,</span> <span class="k">struct</span> <span class="n">user_namespace</span> <span class="o">*</span><span class="n">ns</span><span class="p">,</span>
		     <span class="kt">int</span> <span class="n">cap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">capable</span><span class="p">(</span><span class="n">cred</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">cap</span><span class="p">,</span> <span class="n">SECURITY_CAP_AUDIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_capable_noaudit</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">cred</span><span class="p">,</span> <span class="k">struct</span> <span class="n">user_namespace</span> <span class="o">*</span><span class="n">ns</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">cap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">capable</span><span class="p">(</span><span class="n">cred</span><span class="p">,</span> <span class="n">ns</span><span class="p">,</span> <span class="n">cap</span><span class="p">,</span> <span class="n">SECURITY_CAP_NOAUDIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_quotactl</span><span class="p">(</span><span class="kt">int</span> <span class="n">cmds</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">,</span> <span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">quotactl</span><span class="p">(</span><span class="n">cmds</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">sb</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_quota_on</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">quota_on</span><span class="p">(</span><span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_syslog</span><span class="p">(</span><span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">syslog</span><span class="p">(</span><span class="n">type</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_settime</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="n">ts</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">timezone</span> <span class="o">*</span><span class="n">tz</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">settime</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">tz</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_vm_enough_memory_mm</span><span class="p">(</span><span class="k">struct</span> <span class="n">mm_struct</span> <span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="kt">long</span> <span class="n">pages</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">vm_enough_memory</span><span class="p">(</span><span class="n">mm</span><span class="p">,</span> <span class="n">pages</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_bprm_set_creds</span><span class="p">(</span><span class="k">struct</span> <span class="n">linux_binprm</span> <span class="o">*</span><span class="n">bprm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">bprm_set_creds</span><span class="p">(</span><span class="n">bprm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_bprm_check</span><span class="p">(</span><span class="k">struct</span> <span class="n">linux_binprm</span> <span class="o">*</span><span class="n">bprm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">bprm_check_security</span><span class="p">(</span><span class="n">bprm</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">ima_bprm_check</span><span class="p">(</span><span class="n">bprm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_bprm_committing_creds</span><span class="p">(</span><span class="k">struct</span> <span class="n">linux_binprm</span> <span class="o">*</span><span class="n">bprm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">bprm_committing_creds</span><span class="p">(</span><span class="n">bprm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_bprm_committed_creds</span><span class="p">(</span><span class="k">struct</span> <span class="n">linux_binprm</span> <span class="o">*</span><span class="n">bprm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">bprm_committed_creds</span><span class="p">(</span><span class="n">bprm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_bprm_secureexec</span><span class="p">(</span><span class="k">struct</span> <span class="n">linux_binprm</span> <span class="o">*</span><span class="n">bprm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">bprm_secureexec</span><span class="p">(</span><span class="n">bprm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sb_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_alloc_security</span><span class="p">(</span><span class="n">sb</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_sb_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_free_security</span><span class="p">(</span><span class="n">sb</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sb_copy_data</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">orig</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">copy</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_copy_data</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">copy</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_sb_copy_data</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_sb_remount</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_remount</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sb_kern_mount</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_kern_mount</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sb_show_options</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_show_options</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">sb</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sb_statfs</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_statfs</span><span class="p">(</span><span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sb_mount</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">dev_name</span><span class="p">,</span> <span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span>
                       <span class="kt">char</span> <span class="o">*</span><span class="n">type</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_mount</span><span class="p">(</span><span class="n">dev_name</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sb_umount</span><span class="p">(</span><span class="k">struct</span> <span class="n">vfsmount</span> <span class="o">*</span><span class="n">mnt</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_umount</span><span class="p">(</span><span class="n">mnt</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sb_pivotroot</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">old_path</span><span class="p">,</span> <span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">new_path</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_pivotroot</span><span class="p">(</span><span class="n">old_path</span><span class="p">,</span> <span class="n">new_path</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sb_set_mnt_opts</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">security_mnt_opts</span> <span class="o">*</span><span class="n">opts</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_set_mnt_opts</span><span class="p">(</span><span class="n">sb</span><span class="p">,</span> <span class="n">opts</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_sb_set_mnt_opts</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">security_sb_clone_mnt_opts</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">oldsb</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">newsb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_clone_mnt_opts</span><span class="p">(</span><span class="n">oldsb</span><span class="p">,</span> <span class="n">newsb</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_sb_clone_mnt_opts</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_sb_parse_opts_str</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">options</span><span class="p">,</span> <span class="k">struct</span> <span class="n">security_mnt_opts</span> <span class="o">*</span><span class="n">opts</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sb_parse_opts_str</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">opts</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_sb_parse_opts_str</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_inode_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_security</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_alloc_security</span><span class="p">(</span><span class="n">inode</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_inode_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">integrity_inode_free</span><span class="p">(</span><span class="n">inode</span><span class="p">);</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_free_security</span><span class="p">(</span><span class="n">inode</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_init_security</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span>
				 <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="n">qstr</span><span class="p">,</span>
				 <span class="k">const</span> <span class="n">initxattrs</span> <span class="n">initxattrs</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">fs_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">xattr</span> <span class="n">new_xattrs</span><span class="p">[</span><span class="n">MAX_LSM_EVM_XATTR</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">xattr</span> <span class="o">*</span><span class="n">lsm_xattr</span><span class="p">,</span> <span class="o">*</span><span class="n">evm_xattr</span><span class="p">,</span> <span class="o">*</span><span class="n">xattr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">new_xattrs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">new_xattrs</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">initxattrs</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_init_security</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">qstr</span><span class="p">,</span>
							 <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">lsm_xattr</span> <span class="o">=</span> <span class="n">new_xattrs</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_init_security</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">qstr</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">lsm_xattr</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">lsm_xattr</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">lsm_xattr</span><span class="o">-&gt;</span><span class="n">value_len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">evm_xattr</span> <span class="o">=</span> <span class="n">lsm_xattr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">evm_inode_init_security</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">lsm_xattr</span><span class="p">,</span> <span class="n">evm_xattr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">initxattrs</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">new_xattrs</span><span class="p">,</span> <span class="n">fs_data</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">xattr</span> <span class="o">=</span> <span class="n">new_xattrs</span><span class="p">;</span> <span class="n">xattr</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">xattr</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">xattr</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">xattr</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="o">-</span><span class="n">EOPNOTSUPP</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_inode_init_security</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_old_inode_init_security</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span>
				     <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="n">qstr</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">name</span><span class="p">,</span>
				     <span class="kt">void</span> <span class="o">**</span><span class="n">value</span><span class="p">,</span> <span class="kt">size_t</span> <span class="o">*</span><span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EOPNOTSUPP</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_init_security</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">qstr</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
						 <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_old_inode_init_security</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_SECURITY_PATH</span>
<span class="kt">int</span> <span class="nf">security_path_mknod</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="n">umode_t</span> <span class="n">mode</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dir</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_mknod</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_path_mknod</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_path_mkdir</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="n">umode_t</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dir</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_mkdir</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_path_mkdir</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_path_rmdir</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dir</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_rmdir</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_path_unlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dir</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_unlink</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_path_unlink</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_path_symlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span>
			  <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">old_name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dir</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_symlink</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">,</span> <span class="n">old_name</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_path_link</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">old_dentry</span><span class="p">,</span> <span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">new_dir</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">new_dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">old_dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_link</span><span class="p">(</span><span class="n">old_dentry</span><span class="p">,</span> <span class="n">new_dir</span><span class="p">,</span> <span class="n">new_dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_path_rename</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">old_dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">old_dentry</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">new_dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">new_dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">old_dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)</span> <span class="o">||</span>
		     <span class="p">(</span><span class="n">new_dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span> <span class="o">&amp;&amp;</span> <span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">new_dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">))))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_rename</span><span class="p">(</span><span class="n">old_dir</span><span class="p">,</span> <span class="n">old_dentry</span><span class="p">,</span> <span class="n">new_dir</span><span class="p">,</span>
					 <span class="n">new_dentry</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_path_rename</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_path_truncate</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">path</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">path</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_truncate</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_path_chmod</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">umode_t</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">path</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_chmod</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_path_chown</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">path</span><span class="p">,</span> <span class="n">uid_t</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid_t</span> <span class="n">gid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">path</span><span class="o">-&gt;</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_chown</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">gid</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_path_chroot</span><span class="p">(</span><span class="k">struct</span> <span class="n">path</span> <span class="o">*</span><span class="n">path</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">path_chroot</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="kt">int</span> <span class="nf">security_inode_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="n">umode_t</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dir</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_create</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">security_inode_create</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_inode_link</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">old_dentry</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">new_dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">old_dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_link</span><span class="p">(</span><span class="n">old_dentry</span><span class="p">,</span> <span class="n">dir</span><span class="p">,</span> <span class="n">new_dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_unlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_unlink</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_symlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span>
			    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">old_name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dir</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_symlink</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">,</span> <span class="n">old_name</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_mkdir</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="n">umode_t</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dir</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_mkdir</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">security_inode_mkdir</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_inode_rmdir</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_rmdir</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_mknod</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="n">umode_t</span> <span class="n">mode</span><span class="p">,</span> <span class="n">dev_t</span> <span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dir</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_mknod</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">dentry</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_rename</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">old_dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">old_dentry</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">new_dir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">new_dentry</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">old_dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)</span> <span class="o">||</span>
            <span class="p">(</span><span class="n">new_dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span> <span class="o">&amp;&amp;</span> <span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">new_dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">))))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_rename</span><span class="p">(</span><span class="n">old_dir</span><span class="p">,</span> <span class="n">old_dentry</span><span class="p">,</span>
					   <span class="n">new_dir</span><span class="p">,</span> <span class="n">new_dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_readlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_readlink</span><span class="p">(</span><span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_follow_link</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nameidata</span> <span class="o">*</span><span class="n">nd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_follow_link</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">nd</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_permission</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_permission</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_setattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="k">struct</span> <span class="n">iattr</span> <span class="o">*</span><span class="n">attr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_setattr</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">attr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">evm_inode_setattr</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">attr</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">security_inode_setattr</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_inode_getattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">vfsmount</span> <span class="o">*</span><span class="n">mnt</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_getattr</span><span class="p">(</span><span class="n">mnt</span><span class="p">,</span> <span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_setxattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span>
			    <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">value</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_setxattr</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">evm_inode_setxattr</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_inode_post_setxattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span>
				  <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">value</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_post_setxattr</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">evm_inode_post_setxattr</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_getxattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_getxattr</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_listxattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_listxattr</span><span class="p">(</span><span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_removexattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_removexattr</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">evm_inode_removexattr</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_need_killpriv</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_need_killpriv</span><span class="p">(</span><span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_killpriv</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_killpriv</span><span class="p">(</span><span class="n">dentry</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_getsecurity</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">buffer</span><span class="p">,</span> <span class="n">bool</span> <span class="n">alloc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EOPNOTSUPP</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_getsecurity</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">alloc</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_setsecurity</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">value</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EOPNOTSUPP</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_setsecurity</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_inode_listsecurity</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">buffer_size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">inode</span><span class="p">)))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_listsecurity</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">buffer_size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_inode_getsecid</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">secid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_getsecid</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">secid</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_file_permission</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_permission</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">fsnotify_perm</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_file_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_alloc_security</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_file_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_free_security</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_file_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_ioctl</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">mmap_prot</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">prot</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * Does we have PROT_READ and does the application expect</span>
<span class="cm">	 * it to imply PROT_EXEC?  If not, nothing to talk about...</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">prot</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">PROT_READ</span> <span class="o">|</span> <span class="n">PROT_EXEC</span><span class="p">))</span> <span class="o">!=</span> <span class="n">PROT_READ</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">prot</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">current</span><span class="o">-&gt;</span><span class="n">personality</span> <span class="o">&amp;</span> <span class="n">READ_IMPLIES_EXEC</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">prot</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * if that&#39;s an anonymous mapping, let it.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">prot</span> <span class="o">|</span> <span class="n">PROT_EXEC</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * ditto if it&#39;s not on noexec mount, except that on !MMU we need</span>
<span class="cm">	 * BDI_CAP_EXEC_MMAP (== VM_MAYEXEC) in this case</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">file</span><span class="o">-&gt;</span><span class="n">f_path</span><span class="p">.</span><span class="n">mnt</span><span class="o">-&gt;</span><span class="n">mnt_flags</span> <span class="o">&amp;</span> <span class="n">MNT_NOEXEC</span><span class="p">))</span> <span class="p">{</span>
<span class="cp">#ifndef CONFIG_MMU</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">caps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">address_space</span> <span class="o">*</span><span class="n">mapping</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">f_mapping</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mapping</span> <span class="o">&amp;&amp;</span> <span class="n">mapping</span><span class="o">-&gt;</span><span class="n">backing_dev_info</span><span class="p">)</span>
			<span class="n">caps</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">-&gt;</span><span class="n">backing_dev_info</span><span class="o">-&gt;</span><span class="n">capabilities</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">caps</span> <span class="o">&amp;</span> <span class="n">BDI_CAP_EXEC_MAP</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">prot</span><span class="p">;</span>
<span class="cp">#endif</span>
		<span class="k">return</span> <span class="n">prot</span> <span class="o">|</span> <span class="n">PROT_EXEC</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* anything on noexec mount won&#39;t get PROT_EXEC */</span>
	<span class="k">return</span> <span class="n">prot</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_mmap_file</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">prot</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">mmap_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">prot</span><span class="p">,</span>
					<span class="n">mmap_prot</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">prot</span><span class="p">),</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">ima_file_mmap</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">prot</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_mmap_addr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">mmap_addr</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_file_mprotect</span><span class="p">(</span><span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reqprot</span><span class="p">,</span>
			    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">prot</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_mprotect</span><span class="p">(</span><span class="n">vma</span><span class="p">,</span> <span class="n">reqprot</span><span class="p">,</span> <span class="n">prot</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_file_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_lock</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_file_fcntl</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_fcntl</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_file_set_fowner</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_set_fowner</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_file_send_sigiotask</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">tsk</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">fown_struct</span> <span class="o">*</span><span class="n">fown</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sig</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_send_sigiotask</span><span class="p">(</span><span class="n">tsk</span><span class="p">,</span> <span class="n">fown</span><span class="p">,</span> <span class="n">sig</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_file_receive</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_receive</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_file_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">cred</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">file_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cred</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">fsnotify_perm</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">MAY_OPEN</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_create</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">clone_flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_create</span><span class="p">(</span><span class="n">clone_flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_task_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">task</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_free</span><span class="p">(</span><span class="n">task</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_cred_alloc_blank</span><span class="p">(</span><span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">cred</span><span class="p">,</span> <span class="n">gfp_t</span> <span class="n">gfp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">cred_alloc_blank</span><span class="p">(</span><span class="n">cred</span><span class="p">,</span> <span class="n">gfp</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_cred_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">cred</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">cred_free</span><span class="p">(</span><span class="n">cred</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_prepare_creds</span><span class="p">(</span><span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">new</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">old</span><span class="p">,</span> <span class="n">gfp_t</span> <span class="n">gfp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">cred_prepare</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">gfp</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_transfer_creds</span><span class="p">(</span><span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">new</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">old</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">cred_transfer</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_kernel_act_as</span><span class="p">(</span><span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">new</span><span class="p">,</span> <span class="n">u32</span> <span class="n">secid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">kernel_act_as</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">secid</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_kernel_create_files_as</span><span class="p">(</span><span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">new</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">kernel_create_files_as</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">inode</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_kernel_module_request</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">kmod_name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">kernel_module_request</span><span class="p">(</span><span class="n">kmod_name</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_fix_setuid</span><span class="p">(</span><span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">new</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">old</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_fix_setuid</span><span class="p">(</span><span class="n">new</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_setpgid</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">pid_t</span> <span class="n">pgid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_setpgid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">pgid</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_getpgid</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_getpgid</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_getsid</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_getsid</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_task_getsecid</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">secid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_getsecid</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">secid</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_task_getsecid</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_task_setnice</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nice</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_setnice</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">nice</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_setioprio</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ioprio</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_setioprio</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ioprio</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_getioprio</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_getioprio</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_setrlimit</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">resource</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">rlimit</span> <span class="o">*</span><span class="n">new_rlim</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_setrlimit</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">new_rlim</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_setscheduler</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_setscheduler</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_getscheduler</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_getscheduler</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_movememory</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_movememory</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_kill</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">siginfo</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">sig</span><span class="p">,</span> <span class="n">u32</span> <span class="n">secid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_kill</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">secid</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_wait</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_wait</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_task_prctl</span><span class="p">(</span><span class="kt">int</span> <span class="n">option</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg2</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg3</span><span class="p">,</span>
			 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg4</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg5</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_prctl</span><span class="p">(</span><span class="n">option</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">,</span> <span class="n">arg4</span><span class="p">,</span> <span class="n">arg5</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_task_to_inode</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">task_to_inode</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">inode</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_ipc_permission</span><span class="p">(</span><span class="k">struct</span> <span class="n">kern_ipc_perm</span> <span class="o">*</span><span class="n">ipcp</span><span class="p">,</span> <span class="kt">short</span> <span class="n">flag</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">ipc_permission</span><span class="p">(</span><span class="n">ipcp</span><span class="p">,</span> <span class="n">flag</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_ipc_getsecid</span><span class="p">(</span><span class="k">struct</span> <span class="n">kern_ipc_perm</span> <span class="o">*</span><span class="n">ipcp</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">secid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">ipc_getsecid</span><span class="p">(</span><span class="n">ipcp</span><span class="p">,</span> <span class="n">secid</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_msg_msg_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">msg_msg</span> <span class="o">*</span><span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">msg_msg_alloc_security</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_msg_msg_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">msg_msg</span> <span class="o">*</span><span class="n">msg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">msg_msg_free_security</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_msg_queue_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">msg_queue</span> <span class="o">*</span><span class="n">msq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">msg_queue_alloc_security</span><span class="p">(</span><span class="n">msq</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_msg_queue_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">msg_queue</span> <span class="o">*</span><span class="n">msq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">msg_queue_free_security</span><span class="p">(</span><span class="n">msq</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_msg_queue_associate</span><span class="p">(</span><span class="k">struct</span> <span class="n">msg_queue</span> <span class="o">*</span><span class="n">msq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">msqflg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">msg_queue_associate</span><span class="p">(</span><span class="n">msq</span><span class="p">,</span> <span class="n">msqflg</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_msg_queue_msgctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">msg_queue</span> <span class="o">*</span><span class="n">msq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">msg_queue_msgctl</span><span class="p">(</span><span class="n">msq</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_msg_queue_msgsnd</span><span class="p">(</span><span class="k">struct</span> <span class="n">msg_queue</span> <span class="o">*</span><span class="n">msq</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">msg_msg</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">msqflg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">msg_queue_msgsnd</span><span class="p">(</span><span class="n">msq</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">msqflg</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_msg_queue_msgrcv</span><span class="p">(</span><span class="k">struct</span> <span class="n">msg_queue</span> <span class="o">*</span><span class="n">msq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">msg_msg</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span> <span class="kt">long</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">msg_queue_msgrcv</span><span class="p">(</span><span class="n">msq</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_shm_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">shmid_kernel</span> <span class="o">*</span><span class="n">shp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">shm_alloc_security</span><span class="p">(</span><span class="n">shp</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_shm_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">shmid_kernel</span> <span class="o">*</span><span class="n">shp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">shm_free_security</span><span class="p">(</span><span class="n">shp</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_shm_associate</span><span class="p">(</span><span class="k">struct</span> <span class="n">shmid_kernel</span> <span class="o">*</span><span class="n">shp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">shmflg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">shm_associate</span><span class="p">(</span><span class="n">shp</span><span class="p">,</span> <span class="n">shmflg</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_shm_shmctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">shmid_kernel</span> <span class="o">*</span><span class="n">shp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">shm_shmctl</span><span class="p">(</span><span class="n">shp</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_shm_shmat</span><span class="p">(</span><span class="k">struct</span> <span class="n">shmid_kernel</span> <span class="o">*</span><span class="n">shp</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">shmaddr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">shmflg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">shm_shmat</span><span class="p">(</span><span class="n">shp</span><span class="p">,</span> <span class="n">shmaddr</span><span class="p">,</span> <span class="n">shmflg</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sem_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">sem_array</span> <span class="o">*</span><span class="n">sma</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sem_alloc_security</span><span class="p">(</span><span class="n">sma</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_sem_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">sem_array</span> <span class="o">*</span><span class="n">sma</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sem_free_security</span><span class="p">(</span><span class="n">sma</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sem_associate</span><span class="p">(</span><span class="k">struct</span> <span class="n">sem_array</span> <span class="o">*</span><span class="n">sma</span><span class="p">,</span> <span class="kt">int</span> <span class="n">semflg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sem_associate</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span> <span class="n">semflg</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sem_semctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">sem_array</span> <span class="o">*</span><span class="n">sma</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sem_semctl</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span> <span class="n">cmd</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sem_semop</span><span class="p">(</span><span class="k">struct</span> <span class="n">sem_array</span> <span class="o">*</span><span class="n">sma</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sembuf</span> <span class="o">*</span><span class="n">sops</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="n">nsops</span><span class="p">,</span> <span class="kt">int</span> <span class="n">alter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sem_semop</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span> <span class="n">sops</span><span class="p">,</span> <span class="n">nsops</span><span class="p">,</span> <span class="n">alter</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_d_instantiate</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">inode</span> <span class="o">&amp;&amp;</span> <span class="n">IS_PRIVATE</span><span class="p">(</span><span class="n">inode</span><span class="p">)))</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">d_instantiate</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">inode</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_d_instantiate</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_getprocattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">getprocattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_setprocattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">value</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">setprocattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_netlink_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">netlink_send</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="n">skb</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_secid_to_secctx</span><span class="p">(</span><span class="n">u32</span> <span class="n">secid</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">secdata</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">seclen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">secid_to_secctx</span><span class="p">(</span><span class="n">secid</span><span class="p">,</span> <span class="n">secdata</span><span class="p">,</span> <span class="n">seclen</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_secid_to_secctx</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_secctx_to_secid</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">secdata</span><span class="p">,</span> <span class="n">u32</span> <span class="n">seclen</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">secid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">secctx_to_secid</span><span class="p">(</span><span class="n">secdata</span><span class="p">,</span> <span class="n">seclen</span><span class="p">,</span> <span class="n">secid</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_secctx_to_secid</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">security_release_secctx</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">secdata</span><span class="p">,</span> <span class="n">u32</span> <span class="n">seclen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">release_secctx</span><span class="p">(</span><span class="n">secdata</span><span class="p">,</span> <span class="n">seclen</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_release_secctx</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_inode_notifysecctx</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">u32</span> <span class="n">ctxlen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_notifysecctx</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">ctxlen</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_inode_notifysecctx</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_inode_setsecctx</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">u32</span> <span class="n">ctxlen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_setsecctx</span><span class="p">(</span><span class="n">dentry</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">ctxlen</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_inode_setsecctx</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_inode_getsecctx</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">ctx</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">ctxlen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inode_getsecctx</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="n">ctx</span><span class="p">,</span> <span class="n">ctxlen</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_inode_getsecctx</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_SECURITY_NETWORK</span>

<span class="kt">int</span> <span class="nf">security_unix_stream_connect</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">other</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">newsk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">unix_stream_connect</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">newsk</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_unix_stream_connect</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_unix_may_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span>  <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">other</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">unix_may_send</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">other</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_unix_may_send</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_socket_create</span><span class="p">(</span><span class="kt">int</span> <span class="n">family</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">protocol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kern</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_create</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">kern</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_post_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">family</span><span class="p">,</span>
				<span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="kt">int</span> <span class="n">protocol</span><span class="p">,</span> <span class="kt">int</span> <span class="n">kern</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_post_create</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span>
						<span class="n">protocol</span><span class="p">,</span> <span class="n">kern</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_bind</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">address</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addrlen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_bind</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">addrlen</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_connect</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sockaddr</span> <span class="o">*</span><span class="n">address</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addrlen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_connect</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">addrlen</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_listen</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">backlog</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_listen</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">backlog</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_accept</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">newsock</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_accept</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">newsock</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_sendmsg</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">msghdr</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_sendmsg</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_recvmsg</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">msghdr</span> <span class="o">*</span><span class="n">msg</span><span class="p">,</span>
			    <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_recvmsg</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_getsockname</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_getsockname</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_getpeername</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_getpeername</span><span class="p">(</span><span class="n">sock</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_getsockopt</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">optname</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_getsockopt</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">optname</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_setsockopt</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">optname</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_setsockopt</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">optname</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_shutdown</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">int</span> <span class="n">how</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_shutdown</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">how</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_sock_rcv_skb</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_sock_rcv_skb</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="n">skb</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_sock_rcv_skb</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_socket_getpeersec_stream</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">optval</span><span class="p">,</span>
				      <span class="kt">int</span> <span class="n">__user</span> <span class="o">*</span><span class="n">optlen</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_getpeersec_stream</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">optval</span><span class="p">,</span> <span class="n">optlen</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_socket_getpeersec_dgram</span><span class="p">(</span><span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">sock</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">secid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">socket_getpeersec_dgram</span><span class="p">(</span><span class="n">sock</span><span class="p">,</span> <span class="n">skb</span><span class="p">,</span> <span class="n">secid</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_socket_getpeersec_dgram</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_sk_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span> <span class="kt">int</span> <span class="n">family</span><span class="p">,</span> <span class="n">gfp_t</span> <span class="n">priority</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sk_alloc_security</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">priority</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_sk_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sk_free_security</span><span class="p">(</span><span class="n">sk</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_sk_clone</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">newsk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sk_clone_security</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="n">newsk</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_sk_clone</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">security_sk_classify_flow</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span> <span class="k">struct</span> <span class="n">flowi</span> <span class="o">*</span><span class="n">fl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sk_getsecid</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fl</span><span class="o">-&gt;</span><span class="n">flowi_secid</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_sk_classify_flow</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">security_req_classify_flow</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">request_sock</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">flowi</span> <span class="o">*</span><span class="n">fl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">req_classify_flow</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">fl</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_req_classify_flow</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">security_sock_graft</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span> <span class="k">struct</span> <span class="n">socket</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">sock_graft</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="n">parent</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_sock_graft</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_inet_conn_request</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">request_sock</span> <span class="o">*</span><span class="n">req</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inet_conn_request</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="n">skb</span><span class="p">,</span> <span class="n">req</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_inet_conn_request</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">security_inet_csk_clone</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">newsk</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">request_sock</span> <span class="o">*</span><span class="n">req</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inet_csk_clone</span><span class="p">(</span><span class="n">newsk</span><span class="p">,</span> <span class="n">req</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_inet_conn_established</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">inet_conn_established</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span> <span class="n">skb</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_secmark_relabel_packet</span><span class="p">(</span><span class="n">u32</span> <span class="n">secid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">secmark_relabel_packet</span><span class="p">(</span><span class="n">secid</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_secmark_relabel_packet</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">security_secmark_refcount_inc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">secmark_refcount_inc</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_secmark_refcount_inc</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">security_secmark_refcount_dec</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">secmark_refcount_dec</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_secmark_refcount_dec</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_tun_dev_create</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">tun_dev_create</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_tun_dev_create</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">security_tun_dev_post_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">tun_dev_post_create</span><span class="p">(</span><span class="n">sk</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_tun_dev_post_create</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_tun_dev_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">sock</span> <span class="o">*</span><span class="n">sk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">tun_dev_attach</span><span class="p">(</span><span class="n">sk</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_tun_dev_attach</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* CONFIG_SECURITY_NETWORK */</span><span class="cp"></span>

<span class="cp">#ifdef CONFIG_SECURITY_NETWORK_XFRM</span>

<span class="kt">int</span> <span class="nf">security_xfrm_policy_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfrm_sec_ctx</span> <span class="o">**</span><span class="n">ctxp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfrm_user_sec_ctx</span> <span class="o">*</span><span class="n">sec_ctx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_policy_alloc_security</span><span class="p">(</span><span class="n">ctxp</span><span class="p">,</span> <span class="n">sec_ctx</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_xfrm_policy_alloc</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_xfrm_policy_clone</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfrm_sec_ctx</span> <span class="o">*</span><span class="n">old_ctx</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">xfrm_sec_ctx</span> <span class="o">**</span><span class="n">new_ctxp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_policy_clone_security</span><span class="p">(</span><span class="n">old_ctx</span><span class="p">,</span> <span class="n">new_ctxp</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_xfrm_policy_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfrm_sec_ctx</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_policy_free_security</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_xfrm_policy_free</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_xfrm_policy_delete</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfrm_sec_ctx</span> <span class="o">*</span><span class="n">ctx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_policy_delete_security</span><span class="p">(</span><span class="n">ctx</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_xfrm_state_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfrm_state</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfrm_user_sec_ctx</span> <span class="o">*</span><span class="n">sec_ctx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_state_alloc_security</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sec_ctx</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_xfrm_state_alloc</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">security_xfrm_state_alloc_acquire</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfrm_state</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">xfrm_sec_ctx</span> <span class="o">*</span><span class="n">polsec</span><span class="p">,</span> <span class="n">u32</span> <span class="n">secid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">polsec</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * We want the context to be taken from secid which is usually</span>
<span class="cm">	 * from the sock.</span>
<span class="cm">	 */</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_state_alloc_security</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">secid</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_xfrm_state_delete</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfrm_state</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_state_delete_security</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_xfrm_state_delete</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">security_xfrm_state_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfrm_state</span> <span class="o">*</span><span class="n">x</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_state_free_security</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_xfrm_policy_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfrm_sec_ctx</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="n">u32</span> <span class="n">fl_secid</span><span class="p">,</span> <span class="n">u8</span> <span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_policy_lookup</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">fl_secid</span><span class="p">,</span> <span class="n">dir</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_xfrm_state_pol_flow_match</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfrm_state</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">xfrm_policy</span> <span class="o">*</span><span class="n">xp</span><span class="p">,</span>
				       <span class="k">const</span> <span class="k">struct</span> <span class="n">flowi</span> <span class="o">*</span><span class="n">fl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_state_pol_flow_match</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span> <span class="n">fl</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_xfrm_decode_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">secid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_decode_session</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="n">secid</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_skb_classify_flow</span><span class="p">(</span><span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">flowi</span> <span class="o">*</span><span class="n">fl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">xfrm_decode_session</span><span class="p">(</span><span class="n">skb</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fl</span><span class="o">-&gt;</span><span class="n">flowi_secid</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">rc</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">security_skb_classify_flow</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* CONFIG_SECURITY_NETWORK_XFRM */</span><span class="cp"></span>

<span class="cp">#ifdef CONFIG_KEYS</span>

<span class="kt">int</span> <span class="nf">security_key_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">key</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">cred</span><span class="p">,</span>
		       <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">key_alloc</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">cred</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_key_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">key</span> <span class="o">*</span><span class="n">key</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">key_free</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_key_permission</span><span class="p">(</span><span class="n">key_ref_t</span> <span class="n">key_ref</span><span class="p">,</span>
			    <span class="k">const</span> <span class="k">struct</span> <span class="n">cred</span> <span class="o">*</span><span class="n">cred</span><span class="p">,</span> <span class="n">key_perm_t</span> <span class="n">perm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">key_permission</span><span class="p">(</span><span class="n">key_ref</span><span class="p">,</span> <span class="n">cred</span><span class="p">,</span> <span class="n">perm</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_key_getsecurity</span><span class="p">(</span><span class="k">struct</span> <span class="n">key</span> <span class="o">*</span><span class="n">key</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">_buffer</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">key_getsecurity</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_buffer</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endif	</span><span class="cm">/* CONFIG_KEYS */</span><span class="cp"></span>

<span class="cp">#ifdef CONFIG_AUDIT</span>

<span class="kt">int</span> <span class="nf">security_audit_rule_init</span><span class="p">(</span><span class="n">u32</span> <span class="n">field</span><span class="p">,</span> <span class="n">u32</span> <span class="n">op</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">rulestr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">**</span><span class="n">lsmrule</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">audit_rule_init</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">rulestr</span><span class="p">,</span> <span class="n">lsmrule</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_audit_rule_known</span><span class="p">(</span><span class="k">struct</span> <span class="n">audit_krule</span> <span class="o">*</span><span class="n">krule</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">audit_rule_known</span><span class="p">(</span><span class="n">krule</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">security_audit_rule_free</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">lsmrule</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">audit_rule_free</span><span class="p">(</span><span class="n">lsmrule</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">security_audit_rule_match</span><span class="p">(</span><span class="n">u32</span> <span class="n">secid</span><span class="p">,</span> <span class="n">u32</span> <span class="n">field</span><span class="p">,</span> <span class="n">u32</span> <span class="n">op</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">lsmrule</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">audit_context</span> <span class="o">*</span><span class="n">actx</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">security_ops</span><span class="o">-&gt;</span><span class="n">audit_rule_match</span><span class="p">(</span><span class="n">secid</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">lsmrule</span><span class="p">,</span> <span class="n">actx</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_AUDIT */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:1}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../javascript/docco.min.js"></script>
</html>
