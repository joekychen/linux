<!DOCTYPE html>
<html><head><title>joekychen/linux » lib › hexdump.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../index.html"></a><h1>hexdump.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * lib/hexdump.c</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License version 2 as</span>
<span class="cm"> * published by the Free Software Foundation. See README and COPYING for</span>
<span class="cm"> * more details.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/ctype.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/export.h&gt;</span>

<span class="k">const</span> <span class="kt">char</span> <span class="n">hex_asc</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;0123456789abcdef&quot;</span><span class="p">;</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">hex_asc</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * hex_to_bin - convert a hex digit to its real value</span>
<span class="cm"> * @ch: ascii character represents hex digit</span>
<span class="cm"> *</span>
<span class="cm"> * hex_to_bin() converts one hex digit to its actual value or -1 in case of bad</span>
<span class="cm"> * input.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">hex_to_bin</span><span class="p">(</span><span class="kt">char</span> <span class="n">ch</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">ch</span> <span class="o">&gt;=</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ch</span> <span class="o">&lt;=</span> <span class="sc">&#39;9&#39;</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">ch</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
	<span class="n">ch</span> <span class="o">=</span> <span class="n">tolower</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">ch</span> <span class="o">&gt;=</span> <span class="sc">&#39;a&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ch</span> <span class="o">&lt;=</span> <span class="sc">&#39;f&#39;</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">ch</span> <span class="o">-</span> <span class="sc">&#39;a&#39;</span> <span class="o">+</span> <span class="mi">10</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">hex_to_bin</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * hex2bin - convert an ascii hexadecimal string to its binary representation</span>
<span class="cm"> * @dst: binary result</span>
<span class="cm"> * @src: ascii hexadecimal string</span>
<span class="cm"> * @count: result length</span>
<span class="cm"> *</span>
<span class="cm"> * Return 0 on success, -1 in case of bad input.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">hex2bin</span><span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">hi</span> <span class="o">=</span> <span class="n">hex_to_bin</span><span class="p">(</span><span class="o">*</span><span class="n">src</span><span class="o">++</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">lo</span> <span class="o">=</span> <span class="n">hex_to_bin</span><span class="p">(</span><span class="o">*</span><span class="n">src</span><span class="o">++</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">hi</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">lo</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

		<span class="o">*</span><span class="n">dst</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">hi</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="n">lo</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">hex2bin</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * hex_dump_to_buffer - convert a blob of data to &quot;hex ASCII&quot; in memory</span>
<span class="cm"> * @buf: data blob to dump</span>
<span class="cm"> * @len: number of bytes in the @buf</span>
<span class="cm"> * @rowsize: number of bytes to print per line; must be 16 or 32</span>
<span class="cm"> * @groupsize: number of bytes to print at a time (1, 2, 4, 8; default = 1)</span>
<span class="cm"> * @linebuf: where to put the converted data</span>
<span class="cm"> * @linebuflen: total size of @linebuf, including space for terminating NUL</span>
<span class="cm"> * @ascii: include ASCII after the hex output</span>
<span class="cm"> *</span>
<span class="cm"> * hex_dump_to_buffer() works on one &quot;line&quot; of output at a time, i.e.,</span>
<span class="cm"> * 16 or 32 bytes of input data converted to hex + ASCII output.</span>
<span class="cm"> *</span>
<span class="cm"> * Given a buffer of u8 data, hex_dump_to_buffer() converts the input data</span>
<span class="cm"> * to a hex + ASCII dump at the supplied memory location.</span>
<span class="cm"> * The converted output is always NUL-terminated.</span>
<span class="cm"> *</span>
<span class="cm"> * E.g.:</span>
<span class="cm"> *   hex_dump_to_buffer(frame-&gt;data, frame-&gt;len, 16, 1,</span>
<span class="cm"> *			linebuf, sizeof(linebuf), true);</span>
<span class="cm"> *</span>
<span class="cm"> * example output buffer:</span>
<span class="cm"> * 40 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f  @ABCDEFGHIJKLMNO</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">hex_dump_to_buffer</span><span class="p">(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">rowsize</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">groupsize</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">linebuf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">linebuflen</span><span class="p">,</span>
			<span class="n">bool</span> <span class="n">ascii</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ch</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">j</span><span class="p">,</span> <span class="n">lx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ascii_column</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rowsize</span> <span class="o">!=</span> <span class="mi">16</span> <span class="o">&amp;&amp;</span> <span class="n">rowsize</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">)</span>
		<span class="n">rowsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">len</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">nil</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">rowsize</span><span class="p">)</span>		<span class="cm">/* limit to one line at a time */</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">rowsize</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">len</span> <span class="o">%</span> <span class="n">groupsize</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>	<span class="cm">/* no mixed size output */</span>
		<span class="n">groupsize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">groupsize</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">8</span>: <span class="p">{</span>
		<span class="k">const</span> <span class="n">u64</span> <span class="o">*</span><span class="n">ptr8</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">ngroups</span> <span class="o">=</span> <span class="n">len</span> <span class="o">/</span> <span class="n">groupsize</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">ngroups</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="n">lx</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">linebuf</span> <span class="o">+</span> <span class="n">lx</span><span class="p">,</span> <span class="n">linebuflen</span> <span class="o">-</span> <span class="n">lx</span><span class="p">,</span>
					<span class="s">&quot;%s%16.16llx&quot;</span><span class="p">,</span> <span class="n">j</span> <span class="o">?</span> <span class="s">&quot; &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
					<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">ptr8</span> <span class="o">+</span> <span class="n">j</span><span class="p">));</span>
		<span class="n">ascii_column</span> <span class="o">=</span> <span class="mi">17</span> <span class="o">*</span> <span class="n">ngroups</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">case</span> <span class="mi">4</span>: <span class="p">{</span>
		<span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">ptr4</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">ngroups</span> <span class="o">=</span> <span class="n">len</span> <span class="o">/</span> <span class="n">groupsize</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">ngroups</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="n">lx</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">linebuf</span> <span class="o">+</span> <span class="n">lx</span><span class="p">,</span> <span class="n">linebuflen</span> <span class="o">-</span> <span class="n">lx</span><span class="p">,</span>
					<span class="s">&quot;%s%8.8x&quot;</span><span class="p">,</span> <span class="n">j</span> <span class="o">?</span> <span class="s">&quot; &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">ptr4</span> <span class="o">+</span> <span class="n">j</span><span class="p">));</span>
		<span class="n">ascii_column</span> <span class="o">=</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">ngroups</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">case</span> <span class="mi">2</span>: <span class="p">{</span>
		<span class="k">const</span> <span class="n">u16</span> <span class="o">*</span><span class="n">ptr2</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">ngroups</span> <span class="o">=</span> <span class="n">len</span> <span class="o">/</span> <span class="n">groupsize</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">ngroups</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="n">lx</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">linebuf</span> <span class="o">+</span> <span class="n">lx</span><span class="p">,</span> <span class="n">linebuflen</span> <span class="o">-</span> <span class="n">lx</span><span class="p">,</span>
					<span class="s">&quot;%s%4.4x&quot;</span><span class="p">,</span> <span class="n">j</span> <span class="o">?</span> <span class="s">&quot; &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">ptr2</span> <span class="o">+</span> <span class="n">j</span><span class="p">));</span>
		<span class="n">ascii_column</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">ngroups</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="nl">default:</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">lx</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">linebuflen</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ch</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
			<span class="n">linebuf</span><span class="p">[</span><span class="n">lx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_asc_hi</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
			<span class="n">linebuf</span><span class="p">[</span><span class="n">lx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">hex_asc_lo</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
			<span class="n">linebuf</span><span class="p">[</span><span class="n">lx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">j</span><span class="p">)</span>
			<span class="n">lx</span><span class="o">--</span><span class="p">;</span>

		<span class="n">ascii_column</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">rowsize</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ascii</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">nil</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">lx</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">linebuflen</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">lx</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">ascii_column</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
		<span class="n">linebuf</span><span class="p">[</span><span class="n">lx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">lx</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">linebuflen</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ch</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
		<span class="n">linebuf</span><span class="p">[</span><span class="n">lx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">isascii</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">isprint</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span> <span class="o">?</span> <span class="n">ch</span> <span class="o">:</span> <span class="sc">&#39;.&#39;</span><span class="p">;</span>
	<span class="p">}</span>
<span class="nl">nil:</span>
	<span class="n">linebuf</span><span class="p">[</span><span class="n">lx</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">hex_dump_to_buffer</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_PRINTK</span>
<span class="cm">/**</span>
<span class="cm"> * print_hex_dump - print a text hex dump to syslog for a binary blob of data</span>
<span class="cm"> * @level: kernel log level (e.g. KERN_DEBUG)</span>
<span class="cm"> * @prefix_str: string to prefix each line with;</span>
<span class="cm"> *  caller supplies trailing spaces for alignment if desired</span>
<span class="cm"> * @prefix_type: controls whether prefix of an offset, address, or none</span>
<span class="cm"> *  is printed (%DUMP_PREFIX_OFFSET, %DUMP_PREFIX_ADDRESS, %DUMP_PREFIX_NONE)</span>
<span class="cm"> * @rowsize: number of bytes to print per line; must be 16 or 32</span>
<span class="cm"> * @groupsize: number of bytes to print at a time (1, 2, 4, 8; default = 1)</span>
<span class="cm"> * @buf: data blob to dump</span>
<span class="cm"> * @len: number of bytes in the @buf</span>
<span class="cm"> * @ascii: include ASCII after the hex output</span>
<span class="cm"> *</span>
<span class="cm"> * Given a buffer of u8 data, print_hex_dump() prints a hex + ASCII dump</span>
<span class="cm"> * to the kernel log at the specified kernel log level, with an optional</span>
<span class="cm"> * leading prefix.</span>
<span class="cm"> *</span>
<span class="cm"> * print_hex_dump() works on one &quot;line&quot; of output at a time, i.e.,</span>
<span class="cm"> * 16 or 32 bytes of input data converted to hex + ASCII output.</span>
<span class="cm"> * print_hex_dump() iterates over the entire input @buf, breaking it into</span>
<span class="cm"> * &quot;line size&quot; chunks to format and print.</span>
<span class="cm"> *</span>
<span class="cm"> * E.g.:</span>
<span class="cm"> *   print_hex_dump(KERN_DEBUG, &quot;raw data: &quot;, DUMP_PREFIX_ADDRESS,</span>
<span class="cm"> *		    16, 1, frame-&gt;data, frame-&gt;len, true);</span>
<span class="cm"> *</span>
<span class="cm"> * Example output using %DUMP_PREFIX_OFFSET and 1-byte mode:</span>
<span class="cm"> * 0009ab42: 40 41 42 43 44 45 46 47 48 49 4a 4b 4c 4d 4e 4f  @ABCDEFGHIJKLMNO</span>
<span class="cm"> * Example output using %DUMP_PREFIX_ADDRESS and 4-byte mode:</span>
<span class="cm"> * ffffffff88089af0: 73727170 77767574 7b7a7978 7f7e7d7c  pqrstuvwxyz{|}~.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">print_hex_dump</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">level</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">prefix_str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">prefix_type</span><span class="p">,</span>
		    <span class="kt">int</span> <span class="n">rowsize</span><span class="p">,</span> <span class="kt">int</span> <span class="n">groupsize</span><span class="p">,</span>
		    <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">,</span> <span class="n">bool</span> <span class="n">ascii</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">linelen</span><span class="p">,</span> <span class="n">remaining</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">linebuf</span><span class="p">[</span><span class="mi">32</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">32</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rowsize</span> <span class="o">!=</span> <span class="mi">16</span> <span class="o">&amp;&amp;</span> <span class="n">rowsize</span> <span class="o">!=</span> <span class="mi">32</span><span class="p">)</span>
		<span class="n">rowsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">rowsize</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">linelen</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">remaining</span><span class="p">,</span> <span class="n">rowsize</span><span class="p">);</span>
		<span class="n">remaining</span> <span class="o">-=</span> <span class="n">rowsize</span><span class="p">;</span>

		<span class="n">hex_dump_to_buffer</span><span class="p">(</span><span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">linelen</span><span class="p">,</span> <span class="n">rowsize</span><span class="p">,</span> <span class="n">groupsize</span><span class="p">,</span>
				   <span class="n">linebuf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">linebuf</span><span class="p">),</span> <span class="n">ascii</span><span class="p">);</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">prefix_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">DUMP_PREFIX_ADDRESS</span>:
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s%s%p: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">level</span><span class="p">,</span> <span class="n">prefix_str</span><span class="p">,</span> <span class="n">ptr</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">linebuf</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DUMP_PREFIX_OFFSET</span>:
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s%s%.8x: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">prefix_str</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">linebuf</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s%s%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">prefix_str</span><span class="p">,</span> <span class="n">linebuf</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">print_hex_dump</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * print_hex_dump_bytes - shorthand form of print_hex_dump() with default params</span>
<span class="cm"> * @prefix_str: string to prefix each line with;</span>
<span class="cm"> *  caller supplies trailing spaces for alignment if desired</span>
<span class="cm"> * @prefix_type: controls whether prefix of an offset, address, or none</span>
<span class="cm"> *  is printed (%DUMP_PREFIX_OFFSET, %DUMP_PREFIX_ADDRESS, %DUMP_PREFIX_NONE)</span>
<span class="cm"> * @buf: data blob to dump</span>
<span class="cm"> * @len: number of bytes in the @buf</span>
<span class="cm"> *</span>
<span class="cm"> * Calls print_hex_dump(), with log level of KERN_DEBUG,</span>
<span class="cm"> * rowsize of 16, groupsize of 1, and ASCII output included.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">print_hex_dump_bytes</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">prefix_str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">prefix_type</span><span class="p">,</span>
			  <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">print_hex_dump</span><span class="p">(</span><span class="n">KERN_DEBUG</span><span class="p">,</span> <span class="n">prefix_str</span><span class="p">,</span> <span class="n">prefix_type</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
		       <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">print_hex_dump_bytes</span><span class="p">);</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:1}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../javascript/docco.min.js"></script>
</html>
