f | dir.c | s | 20K | 676 | Ian Kent | raven@themaw.net | 1336070987 |  | cifs - check S_AUTOMOUNT in revalidate  When revalidating a dentry, if the inode wasn't known to be a dfs entry when the dentry was instantiated, such as when created via ->readdir(), the DCACHE_NEED_AUTOMOUNT flag needs to be set on the dentry in ->d_revalidate().  The false return from cifs_d_revalidate(), due to the inode now being marked with the S_AUTOMOUNT flag, might not invalidate the dentry if there is a concurrent unlazy path walk. This is because the dentry reference count will be at least 2 in this case causing d_invalidate() to return EBUSY. So the asumption that the dentry will be discarded then correctly instantiated via ->lookup() might not hold.  Signed-off-by: Ian Kent <raven@themaw.net> Reviewed-by: Jeff Layton <jlayton@redhat.com> Cc: Steve French <smfrench@gmail.com> Cc: linux-cifs@vger.kernel.org Signed-off-by: Steve French <sfrench@us.ibm.com>
f | netmisc.c | s | 39K | 961 | Dan Carpenter | dan.carpenter@oracle.com | 1333233138 |  | cifs: writing past end of struct in cifs_convert_address()  "s6->sin6_scope_id" is an int bits but strict_strtoul() writes a long so this can corrupt memory on 64 bit systems.  Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com> Reviewed-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | CHANGES | g | 46K |  | Steve French | sfrench@us.ibm.com | 1266958303 |  | [CIFS] Minor cleanup to EA patch  CC: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | nterr.h | s | 30K | 549 | Steve French | sfrench@us.ibm.com | 1241127075 |  | [CIFS] Remove unneeded QuerySymlink call and fix mapping for unmapped status  Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifs_debug.c | s | 19K | 630 | Pavel Shilovsky | piastry@etersoft.ru | 1337761991 |  | CIFS: Move protocol specific demultiplex thread calls to ops struct  Acked-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com> Signed-off-by: Pavel Shilovsky <piastry@etersoft.ru> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | Makefile | g | 541B |  | Steve French | sfrench@us.ibm.com | 1337761995 |  | CIFS: Introduce SMB2 mounts as vers=2.1  As with Linux nfs client, which uses "nfsvers=" or "vers=" to indicate which protocol to use for mount, specifying  "vers=2.1"  will force an SMB2 mount. When vers is not specified CIFS is used  "vers=1"  We can eventually autonegotiate down from SMB2 to CIFS when SMB2 is stable enough to make it the default, but this is for the future. At that time we could also implement a "maxprotocol" mount option as smbclient and Samba have today, but that would be premature until SMB2 is stable.  Intially the SMB2 Kconfig option will depend on "BROKEN" until the merge is complete, and then be "EXPERIMENTAL" When it is no longer experimental we can consider changing the default protocol to attempt first.  Signed-off-by: Pavel Shilovsky <piastry@etersoft.ru> Signed-off-by: Jeff Layton <jlayton@redhat.com> Acked-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | link.c | s | 14K | 522 | Miklos Szeredi | mszeredi@suse.cz | 1320234823 |  | filesystems: add missing nlink wrappers  Replace direct i_nlink updates with the respective updater function (inc_nlink, drop_nlink, clear_nlink, inode_dec_link_count).  Signed-off-by: Miklos Szeredi <mszeredi@suse.cz>
f | rfc1002pdu.h | s | 2.8K | 67 | Steve French | sfrench@us.ibm.com | 1181068244 |  | [CIFS] whitespace cleanup  Various coding style problems found by running fs/cifs against the new checkpatch.pl script.  Since there were too many to fit in one patch.  Updated the first four files.  Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifsproto.h | s | 21K | 476 | Pavel Shilovsky | pshilovsky@samba.org | 1338572119 |  | CIFS: Move get_next_mid to ops struct  Reviewed-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Pavel Shilovsky <pshilovsky@samba.org> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifsencrypt.c | s | 20K | 635 | Steve French | sfrench@us.ibm.com | 1326947553 |  | CIFS: Rename *UCS* functions to *UTF16*  to reflect the unicode encoding used by CIFS protocol.  Signed-off-by: Pavel Shilovsky <piastry@etersoft.ru> Acked-by: Jeff Layton <jlayton@samba.org> Reviewed-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com>
f | dns_resolve.c | s | 2.8K | 89 | Jeff Layton | jlayton@redhat.com | 1312341568 |  | cifs: demote DFS referral lookup errors to cFYI  cifs: demote DFS referral lookup errors to cFYI  Now that we call into this routine on every mount, anyone who doesn't have the upcall configured will get multiple printks about failed lookups.  Reported-and-Tested-by: Martijn Uffing <mp3project@sarijopen.student.utwente.nl> Signed-off-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | fscache.h | s | 4.5K | 114 | Steve French | sfrench@us.ibm.com | 1306470842 |  | [CIFS] Rename three structures to avoid camel case  secMode to sec_mode and cifsTconInfo to cifs_tcon and cifsSesInfo to cifs_ses  Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifspdu.h | s | 80K | 2406 | Steve French | smfrench@gmail.com | 1319752411 |  | Add definition for share encryption  Samba supports a setfs info level to negotiate encrypted shares.  This patch adds the defines so we recognize this info level.  Later patches will add the enablement for it.  Acked-by: Jeremy Allison <jra@samba.org> Signed-off-by: Steve French <smfrench@gmail.com>
f | smberr.h | s | 7.5K | 176 | Jeff Layton | jlayton@redhat.com | 1280752840 |  | cifs: map NT_STATUS_ERROR_WRITE_PROTECTED to -EROFS  Seems like a more sensible mapping than -EIO.  Signed-off-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | TODO | g | 5.2K |  | J. Bruce Fields | bfields@fieldses.org | 1288723694 |  | cifs: trivial doc fix: note setlease implemented  Signed-off-by: J. Bruce Fields <bfields@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | smbfsctl.h | s | 4.7K | 82 | Steve French | sfrench@us.ibm.com | 1236821781 |  | [CIFS] Add definitions for remoteably fsctl calls  There are about 60 fsctl calls which Windows claims would be able to be sent remotely and handled by the server. This adds the #defines for them.  A few of them look immediately useful, but need to also add the structure definitions for them so they can be sent as SMBs.  Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifsfs.c | s | 31K | 1074 | Linus Torvalds | torvalds@linux-foundation.org | 1338320530 |  | Merge branch 'for-next' of git://git.samba.org/sfrench/cifs-2.6  Pull CIFS updates from Steve French.  * 'for-next' of git://git.samba.org/sfrench/cifs-2.6: (29 commits)   cifs: fix oops while traversing open file list (try #4)   cifs: Fix comment as d_alloc_root() is replaced by d_make_root()   CIFS: Introduce SMB2 mounts as vers=2.1   CIFS: Introduce SMB2 Kconfig option   CIFS: Move add/set_credits and get_credits_field to ops structure   CIFS: Move protocol specific demultiplex thread calls to ops struct   CIFS: Move protocol specific part from cifs_readv_receive to ops struct   CIFS: Move header_size/max_header_size to ops structure   CIFS: Move protocol specific part from SendReceive2 to ops struct   cifs: Include backup intent search flags during searches {try #2)   CIFS: Separate protocol specific part from setlk   CIFS: Separate protocol specific part from getlk   CIFS: Separate protocol specific lock type handling   CIFS: Convert lock type to 32 bit variable   CIFS: Move locks to cifsFileInfo structure   cifs: convert send_nt_cancel into a version specific op   cifs: add a smb_version_operations/values structures and a smb_version enum   cifs: remove the vers= and version= synonyms for ver=   cifs: add warning about change in default cache semantics in 3.7   cifs: display cache= option in /proc/mounts   ...
f | cifsglob.h | s | 35K | 1023 | Pavel Shilovsky | pshilovsky@samba.org | 1338572119 |  | CIFS: Move get_next_mid to ops struct  Reviewed-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Pavel Shilovsky <pshilovsky@samba.org> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | dns_resolve.h | s | 1.2K | 27 | Wang Lei | wang840925@gmail.com | 1281028671 |  | DNS: Separate out CIFS DNS Resolver code  Separate out the DNS resolver key type from the CIFS filesystem into its own module so that it can be made available for general use, including the AFS filesystem module.  This facility makes it possible for the kernel to upcall to userspace to have it issue DNS requests, package up the replies and present them to the kernel in a useful form.  The kernel is then able to cache the DNS replies as keys can be retained in keyrings.  Resolver keys are of type "dns_resolver" and have a case-insensitive description that is of the form "[<type>:]<domain_name>".  The optional <type> indicates the particular DNS lookup and packaging that's required.  The <domain_name> is the query to be made.  If <type> isn't given, a basic hostname to IP address lookup is made, and the result is stored in the key in the form of a printable string consisting of a comma-separated list of IPv4 and IPv6 addresses.  This key type is supported by userspace helpers driven from /sbin/request-key and configured through /etc/request-key.conf.  The cifs.upcall utility is invoked for UNC path server name to IP address resolution.  The CIFS functionality is encapsulated by the dns_resolve_unc_to_ip() function, which is used to resolve a UNC path to an IP address for CIFS filesystem.  This part remains in the CIFS module for now.  See the added Documentation/networking/dns_resolver.txt for more information.  Signed-off-by: Wang Lei <wang840925@gmail.com> Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | AUTHORS | g | 2.6K |  | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
f | connect.c | s | 114K | 3904 | Pavel Shilovsky | pshilovsky@samba.org | 1338572119 |  | CIFS: Move get_next_mid to ops struct  Reviewed-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Pavel Shilovsky <pshilovsky@samba.org> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | fscache.c | s | 6.4K | 201 | David Howells | dhowells@redhat.com | 1310070116 |  | FS-Cache: Add a helper to bulk uncache pages on an inode  Add an FS-Cache helper to bulk uncache pages on an inode.  This will only work for the circumstance where the pages in the cache correspond 1:1 with the pages attached to an inode's page cache.  This is required for CIFS and NFS: When disabling inode cookie, we were returning the cookie and setting cifsi->fscache to NULL but failed to invalidate any previously mapped pages.  This resulted in "Bad page state" errors and manifested in other kind of errors when running fsstress.  Fix it by uncaching mapped pages when we disable the inode cookie.  This patch should fix the following oops and "Bad page state" errors seen during fsstress testing.    ------------[ cut here ]------------   kernel BUG at fs/cachefiles/namei.c:201!   invalid opcode: 0000 [#1] SMP   Pid: 5, comm: kworker/u:0 Not tainted 2.6.38.7-30.fc15.x86_64 #1 Bochs Bochs   RIP: 0010: cachefiles_walk_to_object+0x436/0x745 [cachefiles]   RSP: 0018:ffff88002ce6dd00  EFLAGS: 00010282   RAX: ffff88002ef165f0 RBX: ffff88001811f500 RCX: 0000000000000000   RDX: 0000000000000000 RSI: 0000000000000100 RDI: 0000000000000282   RBP: ffff88002ce6dda0 R08: 0000000000000100 R09: ffffffff81b3a300   R10: 0000ffff00066c0a R11: 0000000000000003 R12: ffff88002ae54840   R13: ffff88002ae54840 R14: ffff880029c29c00 R15: ffff88001811f4b0   FS:  00007f394dd32720(0000) GS:ffff88002ef00000(0000) knlGS:0000000000000000   CS:  0010 DS: 0000 ES: 0000 CR0: 000000008005003b   CR2: 00007fffcb62ddf8 CR3: 000000001825f000 CR4: 00000000000006e0   DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000   DR3: 0000000000000000 DR6: 00000000ffff0ff0 DR7: 0000000000000400   Process kworker/u:0 (pid: 5, threadinfo ffff88002ce6c000, task ffff88002ce55cc0)   Stack:    0000000000000246 ffff88002ce55cc0 ffff88002ce6dd58 ffff88001815dc00    ffff8800185246c0 ffff88001811f618 ffff880029c29d18 ffff88001811f380    ffff88002ce6dd50 ffffffff814757e4 ffff88002ce6dda0 ffffffff8106ac56   Call Trace:    cachefiles_lookup_object+0x78/0xd4 [cachefiles]    fscache_lookup_object+0x131/0x16d [fscache]    fscache_object_work_func+0x1bc/0x669 [fscache]    process_one_work+0x186/0x298    worker_thread+0xda/0x15d    kthread+0x84/0x8c    kernel_thread_helper+0x4/0x10   RIP  cachefiles_walk_to_object+0x436/0x745 [cachefiles]   ---[ end trace 1d481c9af1804caa ]---  I tested the uncaching by the following means:   (1) Create a big file on my NFS server (104857600 bytes).   (2) Read the file into the cache with md5sum on the NFS client.  Look in      /proc/fs/fscache/stats:  	Pages  : mrk=25601 unc=0   (3) Open the file for read/write ("bash 5<>/warthog/bigfile").  Look in proc      again:  	Pages  : mrk=25601 unc=25601  Reported-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: David Howells <dhowells@redhat.com> Reviewed-and-Tested-by: Suresh Jayaraman <sjayaraman@suse.de> cc: stable@kernel.org Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | xattr.c | s | 11K | 378 | Santosh Nayak | santoshprasadnayak@gmail.com | 1331092013 |  | cifs: possible memory leak in xattr.  Memory is allocated irrespective of whether CIFS_ACL is configured or not. But free is happenning only if CIFS_ACL is set. This is a possible memory leak scenario.  Fix is: Allocate and free memory only if CIFS_ACL is configured.  Signed-off-by: Santosh Nayak <santoshprasadnayak@gmail.com> Reviewed-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | smb2ops.c | s | 936B | 24 | Steve French | sfrench@us.ibm.com | 1337761995 |  | CIFS: Introduce SMB2 mounts as vers=2.1  As with Linux nfs client, which uses "nfsvers=" or "vers=" to indicate which protocol to use for mount, specifying  "vers=2.1"  will force an SMB2 mount. When vers is not specified CIFS is used  "vers=1"  We can eventually autonegotiate down from SMB2 to CIFS when SMB2 is stable enough to make it the default, but this is for the future. At that time we could also implement a "maxprotocol" mount option as smbclient and Samba have today, but that would be premature until SMB2 is stable.  Intially the SMB2 Kconfig option will depend on "BROKEN" until the merge is complete, and then be "EXPERIMENTAL" When it is no longer experimental we can consider changing the default protocol to attempt first.  Signed-off-by: Pavel Shilovsky <piastry@etersoft.ru> Signed-off-by: Jeff Layton <jlayton@redhat.com> Acked-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | misc.c | s | 15K | 508 | Pavel Shilovsky | pshilovsky@samba.org | 1338572119 |  | CIFS: Move get_next_mid to ops struct  Reviewed-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Pavel Shilovsky <pshilovsky@samba.org> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifsfs.h | s | 5.6K | 116 | Steve French | sfrench@us.ibm.com | 1336071001 |  | [CIFS] Update cifs version to 1.78  Signed-off-by: Steve French <sfrench@us.ibm.com>
f | sess.c | s | 28K | 828 | Shirish Pargaonkar | shirishpargaonkar@gmail.com | 1328223549 |  | cifs: Fix oops in session setup code for null user mounts  For null user mounts, do not invoke string length function during session setup.  Cc: <stable@kernel.org Reported-and-Tested-by: Chris Clayton <chris2553@googlemail.com> Acked-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com> Signed-off-by: Steve French <smfrench@gmail.com>
f | cifs_unicode.c | s | 8.8K | 305 | Steve French | sfrench@us.ibm.com | 1326947553 |  | CIFS: Rename *UCS* functions to *UTF16*  to reflect the unicode encoding used by CIFS protocol.  Signed-off-by: Pavel Shilovsky <piastry@etersoft.ru> Acked-by: Jeff Layton <jlayton@samba.org> Reviewed-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com>
f | readdir.c | s | 23K | 750 | Shirish Pargaonkar | shirishpargaonkar@gmail.com | 1337245669 |  | cifs: Include backup intent search flags during searches {try #2)  As observed and suggested by Tushar Gosavi...  --------- readdir calls these function to send TRANS2_FIND_FIRST and TRANS2_FIND_NEXT command to the server. The current cifs module is not specifying CIFS_SEARCH_BACKUP_SEARCH flag while sending these command when backupuid/backupgid is specified. This can be resolved by specifying CIFS_SEARCH_BACKUP_SEARCH flag. ---------  Cc: <stable@kernel.org> Reported-and-Tested-by: Tushar Gosavi <tugosavi@in.ibm.com> Signed-off-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com> Acked-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | inode.c | s | 59K | 1996 | Pavel Shilovsky | piastry@etersoft.ru | 1330318783 |  | CIFS: Fix mkdir/rmdir bug for the non-POSIX case  Currently we do inc/drop_nlink for a parent directory for every mkdir/rmdir calls. That's wrong when Unix extensions are disabled because in this case a server doesn't follow the same semantic and returns the old value on the next QueryInfo request. As the result, we update our value with the server one and then decrement it on every rmdir call - go to negative nlink values.  Fix this by removing inc/drop_nlink for the parent directory from mkdir/rmdir, setting it for a revalidation and ignoring NumberOfLinks for directories when Unix extensions are disabled.  Signed-off-by: Pavel Shilovsky <piastry@etersoft.ru> Reviewed-by: Jeff Layton <jlayton@samba.org> Signed-off-by: Steve French <smfrench@gmail.com>
f | export.c | s | 2.4K | 61 | Paul Bolle | pebolle@tiscali.nl | 1318480887 |  | cifs: Fix typo 'CIFS_NFSD_EXPORT'  It should be 'CONFIG_CIFS_NFSD_EXPORT'. No-one noticed because that symbol depends on BROKEN.  Signed-off-by: Paul Bolle <pebolle@tiscali.nl> Signed-off-by: Steve French <smfrench@gmail.com>
f | ntlmssp.h | s | 5.3K | 120 | Shirish Pargaonkar | shirishpargaonkar@gmail.com | 1285787069 |  | cifs NTLMv2/NTLMSSP ntlmv2 within ntlmssp autentication code  Attribue Value (AV) pairs or Target Info (TI) pairs are part of ntlmv2 authentication. Structure ntlmv2_resp had only definition for two av pairs. So removed it, and now allocation of av pairs is dynamic. For servers like Windows 7/2008, av pairs sent by server in challege packet (type 2 in the ntlmssp exchange/negotiation) can vary.  Server sends them during ntlmssp negotiation. So when ntlmssp is used as an authentication mechanism, type 2 challenge packet from server has this information.  Pluck it and use the entire blob for authenticaiton purpose.  If user has not specified, extract (netbios) domain name from the av pairs which is used to calculate ntlmv2 hash.  Servers like Windows 7 are particular about the AV pair blob.  Servers like Windows 2003, are not very strict about the contents of av pair blob used during ntlmv2 authentication. So when security mechanism such as ntlmv2 is used (not ntlmv2 in ntlmssp), there is no negotiation and so genereate a minimal blob that gets used in ntlmv2 authentication as well as gets sent.  Fields tilen and tilbob are session specific.  AV pair values are defined.  To calculate ntlmv2 response we need ti/av pair blob.  For sec mech like ntlmssp, the blob is plucked from type 2 response from the server.  From this blob, netbios name of the domain is retrieved, if user has not already provided, to be included in the Target String as part of ntlmv2 hash calculations.  For sec mech like ntlmv2, create a minimal, two av pair blob.  The allocated blob is freed in case of error.  In case there is no error, this blob is used in calculating ntlmv2 response (in CalcNTLMv2_response) and is also copied on the response to the server, and then freed.  The type 3 ntlmssp response is prepared on a buffer, 5 * sizeof of struct _AUTHENTICATE_MESSAGE, an empirical value large enough to hold _AUTHENTICATE_MESSAGE plus a blob with max possible 10 values as part of ntlmv2 response and lmv2 keys and domain, user, workstation  names etc.  Also, kerberos gets selected as a default mechanism if server supports it, over the other security mechanisms.  Signed-off-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifsacl.c | s | 35K | 1157 | James Morris | jmorris@namei.org | 1328767354 |  | Merge branch 'next-queue' into next
f | cifs_spnego.c | s | 4.8K | 148 | Jeff Layton | jlayton@redhat.com | 1326861626 |  | cifs: sanitize username handling  Currently, it's not very clear whether you're allowed to have a NULL vol->username or ses->user_name. Some places check for it and some don't.  Make it clear that a NULL pointer is OK in these fields, and ensure that all the callers check for that.  Signed-off-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <smfrench@gmail.com>
f | asn1.c | s | 14K | 569 | Steve French | sfrench@us.ibm.com | 1283980258 |  | Revert "[CIFS] Fix ntlmv2 auth with ntlmssp"  This reverts commit 9fbc590860e75785bdaf8b83e48fabfe4d4f7d58.  The change to kernel crypto and fixes to ntlvm2 and ntlmssp series, introduced a regression.  Deferring this patch series to 2.6.37 after Shirish fixes it.  Signed-off-by: Steve French <sfrench@us.ibm.com> Acked-by: Jeff Layton <jlayton@redhat.com> CC: Shirish Pargaonkar <shirishp@us.ibm.com>
f | cifs_uniupr.h | s | 12K | 239 | Igor Druzhinin | jaxbrigs@gmail.com | 1282265202 |  | cifs: correction of unicode header files  This patch corrects a problem of compilation errors at removal of UNIUPR_NOLOWER definition and adds include guards to cifs_unicode.h.  Signed-off-by: Igor Druzhinin <jaxbrigs@gmail.com> Acked-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | transport.c | s | 23K | 795 | Pavel Shilovsky | pshilovsky@samba.org | 1338572119 |  | CIFS: Move get_next_mid to ops struct  Reviewed-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Pavel Shilovsky <pshilovsky@samba.org> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifs_debug.h | s | 2.4K | 84 | Pavel Shilovsky | piastry@etersoft.ru | 1337761991 |  | CIFS: Move protocol specific demultiplex thread calls to ops struct  Acked-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com> Signed-off-by: Pavel Shilovsky <piastry@etersoft.ru> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | README | g | 38K |  | Jeff Layton | jlayton@redhat.com | 1337217211 |  | cifs: remove legacy MultiuserMount option  We've now warned about this for two releases. Remove it for 3.5.  Signed-off-by: Jeff Layton <jlayton@redhat.com>
f | cifs_dfs_ref.c | s | 9.5K | 324 | Jeff Layton | jlayton@redhat.com | 1312341568 |  | cifs: demote DFS referral lookup errors to cFYI  cifs: demote DFS referral lookup errors to cFYI  Now that we call into this routine on every mount, anyone who doesn't have the upcall configured will get multiple printks about failed lookups.  Reported-and-Tested-by: Martijn Uffing <mp3project@sarijopen.student.utwente.nl> Signed-off-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifssmb.c | s | 187K | 5642 | Pavel Shilovsky | pshilovsky@samba.org | 1338572119 |  | CIFS: Move get_next_mid to ops struct  Reviewed-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Pavel Shilovsky <pshilovsky@samba.org> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | Kconfig | g | 7.2K |  | Steve French | sfrench@us.ibm.com | 1337761994 |  | CIFS: Introduce SMB2 Kconfig option  SMB2 is the followon to the CIFS (and SMB) protocols and the default for Windows since Windows Vista, and also now implemented by various non-Windows servers. SMB2 is more secure, has various performance advantages, including larger i/o sizes, flow control, better caching model and more. SMB2 also resolves some scalability limits in the CIFS protocol and adds many new features while being much simpler (only a few dozen commands instead of hundreds) and since the protocol is clearer it is also more consistently implemented across servers and thus easier to optimize.  After much discussion with Jeff Layton, Jeremy Allison and others at Connectathon, we decided to move the SMB2 code from a distinct .ko and fstype into distinct C files that optionally build in cifs.ko. As a result the Kconfig gets simpler.  To avoid destabilizing CIFS, the SMB2 code is going to be moved into its own experimental CONFIG_CIFS_SMB2 ifdef as it is merged and rereviewed. The changes to stable CIFS (builds with the SMB2 ifdef off) are expected to be fairly small.  Reviewed-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com> Signed-off-by: Pavel Shilovsky <piastry@etersoft.ru> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cache.c | s | 7.9K | 275 | Steve French | sfrench@us.ibm.com | 1308066678 |  | [CIFS] trivial cleanup fscache cFYI and cERROR messages  ... for uniformity and cleaner debug logs.  Signed-off-by: Suresh Jayaraman <sjayaraman@suse.de> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | ioctl.c | s | 3.0K | 101 | Jeff Layton | jlayton@redhat.com | 1337217212 |  | cifs: add a deprecation warning to CIFS_IOC_CHECKUMOUNT ioctl  This was used by an ancient version of umount.cifs and in nowhere else that I'm aware of. Let's add a warning now and dump it for 3.7.  Signed-off-by: Jeff Layton <jlayton@redhat.com>
f | smb1ops.c | s | 7.0K | 219 | Pavel Shilovsky | pshilovsky@samba.org | 1338572119 |  | CIFS: Move get_next_mid to ops struct  Reviewed-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Pavel Shilovsky <pshilovsky@samba.org> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifs_fs_sb.h | s | 3.1K | 65 | Al Viro | viro@zeniv.linux.org.uk | 1325649309 |  | cifs: propagate umode_t  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | cifs_spnego.h | s | 1.6K | 42 | Steve French | sfrench@us.ibm.com | 1306470842 |  | [CIFS] Rename three structures to avoid camel case  secMode to sec_mode and cifsTconInfo to cifs_tcon and cifsSesInfo to cifs_ses  Signed-off-by: Steve French <sfrench@us.ibm.com>
f | nterr.c | s | 33K | 685 | Steve French | sfrench@us.ibm.com | 1183763586 |  | [CIFS] whitespace cleanup  Signed-off-by: Steve French <sfrench@us.ibm.com>
f | file.c | s | 87K | 2939 | Pavel Shilovsky | pshilovsky@samba.org | 1338572112 |  | CIFS: Improve identation in cifs_unlock_range  Signed-off-by: Pavel Shilovsky <pshilovsky@samba.org> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | smbencrypt.c | s | 6.0K | 209 | Steve French | sfrench@us.ibm.com | 1326947553 |  | CIFS: Rename *UCS* functions to *UTF16*  to reflect the unicode encoding used by CIFS protocol.  Signed-off-by: Pavel Shilovsky <piastry@etersoft.ru> Acked-by: Jeff Layton <jlayton@samba.org> Reviewed-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com>
f | cifsacl.h | s | 2.9K | 86 | Shirish Pargaonkar | shirishpargaonkar@gmail.com | 1305814256 |  | cifs: Change key name to cifs.idmap, misc. clean-up  Change idmap key name from cifs.cifs_idmap to cifs.idmap. Removed unused structure wksidarr and function match_sid(). Handle errors correctly in function init_cifs().  Signed-off-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com> Reviewed-by: Jeff Layton <jlayton@redhat.com> Signed-off-by: Steve French <sfrench@us.ibm.com>
f | cifs_unicode.h | s | 8.9K | 341 | Steve French | sfrench@us.ibm.com | 1326947553 |  | CIFS: Rename *UCS* functions to *UTF16*  to reflect the unicode encoding used by CIFS protocol.  Signed-off-by: Pavel Shilovsky <piastry@etersoft.ru> Acked-by: Jeff Layton <jlayton@samba.org> Reviewed-by: Shirish Pargaonkar <shirishpargaonkar@gmail.com>
