<!DOCTYPE html>
<html><head><title>joekychen/linux » fs › cifs › cifs_debug.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>cifs_debug.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *   fs/cifs_debug.c</span>
<span class="cm"> *</span>
<span class="cm"> *   Copyright (C) International Business Machines  Corp., 2000,2005</span>
<span class="cm"> *</span>
<span class="cm"> *   Modified by Steve French (sfrench@us.ibm.com)</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software;  you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY;  without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See</span>
<span class="cm"> *   the GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program;  if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<span class="cm"> */</span>
<span class="cp">#include &lt;linux/fs.h&gt;</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/ctype.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/proc_fs.h&gt;</span>
<span class="cp">#include &lt;asm/uaccess.h&gt;</span>
<span class="cp">#include &quot;cifspdu.h&quot;</span>
<span class="cp">#include &quot;cifsglob.h&quot;</span>
<span class="cp">#include &quot;cifsproto.h&quot;</span>
<span class="cp">#include &quot;cifs_debug.h&quot;</span>
<span class="cp">#include &quot;cifsfs.h&quot;</span>

<span class="kt">void</span>
<span class="nf">cifs_dump_mem</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">label</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="kt">int</span> <span class="o">*</span><span class="n">intptr</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">charptr</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;%s: dump of %d bytes of data at 0x%p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">label</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">);</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot; %08x&quot;</span><span class="p">,</span> <span class="n">intptr</span><span class="p">[</span><span class="n">i</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39; &#39;</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">);</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">isprint</span><span class="p">(</span><span class="n">charptr</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">])</span> <span class="o">?</span> <span class="n">charptr</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">:</span> <span class="sc">&#39;.&#39;</span><span class="p">;</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">cifs_dump_detail</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_CIFS_DEBUG2</span>
	<span class="k">struct</span> <span class="n">smb_hdr</span> <span class="o">*</span><span class="n">smb</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">smb_hdr</span> <span class="o">*</span><span class="p">)</span><span class="n">buf</span><span class="p">;</span>

	<span class="n">cERROR</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Cmd: %d Err: 0x%x Flags: 0x%x Flgs2: 0x%x Mid: %d Pid: %d&quot;</span><span class="p">,</span>
		  <span class="n">smb</span><span class="o">-&gt;</span><span class="n">Command</span><span class="p">,</span> <span class="n">smb</span><span class="o">-&gt;</span><span class="n">Status</span><span class="p">.</span><span class="n">CifsError</span><span class="p">,</span>
		  <span class="n">smb</span><span class="o">-&gt;</span><span class="n">Flags</span><span class="p">,</span> <span class="n">smb</span><span class="o">-&gt;</span><span class="n">Flags2</span><span class="p">,</span> <span class="n">smb</span><span class="o">-&gt;</span><span class="n">Mid</span><span class="p">,</span> <span class="n">smb</span><span class="o">-&gt;</span><span class="n">Pid</span><span class="p">);</span>
	<span class="n">cERROR</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;smb buf %p len %d&quot;</span><span class="p">,</span> <span class="n">smb</span><span class="p">,</span> <span class="n">smbCalcSize</span><span class="p">(</span><span class="n">smb</span><span class="p">));</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_CIFS_DEBUG2 */</span><span class="cp"></span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">cifs_dump_mids</span><span class="p">(</span><span class="k">struct</span> <span class="n">TCP_Server_Info</span> <span class="o">*</span><span class="n">server</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_CIFS_DEBUG2</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">tmp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mid_q_entry</span> <span class="o">*</span><span class="n">mid_entry</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">server</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">cERROR</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Dump pending requests:&quot;</span><span class="p">);</span>
	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GlobalMid_Lock</span><span class="p">);</span>
	<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">pending_mid_q</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">mid_entry</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mid_q_entry</span><span class="p">,</span> <span class="n">qhead</span><span class="p">);</span>
		<span class="n">cERROR</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;State: %d Cmd: %d Pid: %d Cbdata: %p Mid %llu&quot;</span><span class="p">,</span>
			<span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">mid_state</span><span class="p">,</span>
			<span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">command</span><span class="p">),</span>
			<span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">pid</span><span class="p">,</span>
			<span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">callback_data</span><span class="p">,</span>
			<span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">mid</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_CIFS_STATS2</span>
		<span class="n">cERROR</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;IsLarge: %d buf: %p time rcv: %ld now: %ld&quot;</span><span class="p">,</span>
			<span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">large_buf</span><span class="p">,</span>
			<span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">resp_buf</span><span class="p">,</span>
			<span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">when_received</span><span class="p">,</span>
			<span class="n">jiffies</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* STATS2 */</span><span class="cp"></span>
		<span class="n">cERROR</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;IsMult: %d IsEnd: %d&quot;</span><span class="p">,</span> <span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">multiRsp</span><span class="p">,</span>
			  <span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">multiEnd</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">resp_buf</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">cifs_dump_detail</span><span class="p">(</span><span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">resp_buf</span><span class="p">);</span>
			<span class="n">cifs_dump_mem</span><span class="p">(</span><span class="s">&quot;existing buf: &quot;</span><span class="p">,</span>
				<span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">resp_buf</span><span class="p">,</span> <span class="mi">62</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GlobalMid_Lock</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_CIFS_DEBUG2 */</span><span class="cp"></span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_PROC_FS</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifs_debug_data_proc_show</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">tmp1</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp2</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp3</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mid_q_entry</span> <span class="o">*</span><span class="n">mid_entry</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">TCP_Server_Info</span> <span class="o">*</span><span class="n">server</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cifs_ses</span> <span class="o">*</span><span class="n">ses</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cifs_tcon</span> <span class="o">*</span><span class="n">tcon</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">dev_type</span><span class="p">;</span>

	<span class="n">seq_puts</span><span class="p">(</span><span class="n">m</span><span class="p">,</span>
		    <span class="s">&quot;Display Internal CIFS Data Structures for Debugging</span><span class="se">\n</span><span class="s">&quot;</span>
		    <span class="s">&quot;---------------------------------------------------</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;CIFS Version %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">CIFS_VERSION</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;Features:&quot;</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_CIFS_DFS_UPCALL</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; dfs&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_CIFS_FSCACHE</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; fscache&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_CIFS_WEAK_PW_HASH</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; lanman&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_CIFS_POSIX</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; posix&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_CIFS_UPCALL</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; spnego&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_CIFS_XATTR</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; xattr&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_CIFS_ACL</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; acl&quot;</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="n">seq_putc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;Active VFS Requests: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">GlobalTotalActiveXid</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;Servers:&quot;</span><span class="p">);</span>

	<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cifs_tcp_ses_lock</span><span class="p">);</span>
	<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cifs_tcp_ses_list</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">server</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp1</span><span class="p">,</span> <span class="k">struct</span> <span class="n">TCP_Server_Info</span><span class="p">,</span>
				    <span class="n">tcp_ses_list</span><span class="p">);</span>
		<span class="n">i</span><span class="o">++</span><span class="p">;</span>
		<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">smb_ses_list</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ses</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp2</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cifs_ses</span><span class="p">,</span>
					 <span class="n">smb_ses_list</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">ses</span><span class="o">-&gt;</span><span class="n">serverDomain</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">||</span>
				<span class="p">(</span><span class="n">ses</span><span class="o">-&gt;</span><span class="n">serverOS</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">||</span>
				<span class="p">(</span><span class="n">ses</span><span class="o">-&gt;</span><span class="n">serverNOS</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">%d) entry for %s not fully &quot;</span>
					   <span class="s">&quot;displayed</span><span class="se">\n\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ses</span><span class="o">-&gt;</span><span class="n">serverName</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span>
				    <span class="s">&quot;</span><span class="se">\n</span><span class="s">%d) Name: %s  Domain: %s Uses: %d OS:&quot;</span>
				    <span class="s">&quot; %s</span><span class="se">\n\t</span><span class="s">NOS: %s</span><span class="se">\t</span><span class="s">Capability: 0x%x</span><span class="se">\n\t</span><span class="s">SMB&quot;</span>
				    <span class="s">&quot; session status: %d</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">i</span><span class="p">,</span> <span class="n">ses</span><span class="o">-&gt;</span><span class="n">serverName</span><span class="p">,</span> <span class="n">ses</span><span class="o">-&gt;</span><span class="n">serverDomain</span><span class="p">,</span>
				<span class="n">ses</span><span class="o">-&gt;</span><span class="n">ses_count</span><span class="p">,</span> <span class="n">ses</span><span class="o">-&gt;</span><span class="n">serverOS</span><span class="p">,</span> <span class="n">ses</span><span class="o">-&gt;</span><span class="n">serverNOS</span><span class="p">,</span>
				<span class="n">ses</span><span class="o">-&gt;</span><span class="n">capabilities</span><span class="p">,</span> <span class="n">ses</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;TCP status: %d</span><span class="se">\n\t</span><span class="s">Local Users To &quot;</span>
				   <span class="s">&quot;Server: %d SecMode: 0x%x Req On Wire: %d&quot;</span><span class="p">,</span>
				   <span class="n">server</span><span class="o">-&gt;</span><span class="n">tcpStatus</span><span class="p">,</span> <span class="n">server</span><span class="o">-&gt;</span><span class="n">srv_count</span><span class="p">,</span>
				   <span class="n">server</span><span class="o">-&gt;</span><span class="n">sec_mode</span><span class="p">,</span> <span class="n">in_flight</span><span class="p">(</span><span class="n">server</span><span class="p">));</span>

<span class="cp">#ifdef CONFIG_CIFS_STATS2</span>
			<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; In Send: %d In MaxReq Wait: %d&quot;</span><span class="p">,</span>
				<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">in_send</span><span class="p">),</span>
				<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">num_waiters</span><span class="p">));</span>
<span class="cp">#endif</span>

			<span class="n">seq_puts</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\t</span><span class="s">Shares:&quot;</span><span class="p">);</span>
			<span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ses</span><span class="o">-&gt;</span><span class="n">tcon_list</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">tcon</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp3</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cifs_tcon</span><span class="p">,</span>
						  <span class="n">tcon_list</span><span class="p">);</span>
				<span class="o">++</span><span class="n">j</span><span class="p">;</span>
				<span class="n">dev_type</span> <span class="o">=</span> <span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">fsDevInfo</span><span class="p">.</span><span class="n">DeviceType</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\t</span><span class="s">%d) %s Mounts: %d &quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span>
					   <span class="n">tcon</span><span class="o">-&gt;</span><span class="n">treeName</span><span class="p">,</span> <span class="n">tcon</span><span class="o">-&gt;</span><span class="n">tc_count</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">nativeFileSystem</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;Type: %s &quot;</span><span class="p">,</span>
						   <span class="n">tcon</span><span class="o">-&gt;</span><span class="n">nativeFileSystem</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;DevInfo: 0x%x Attributes: 0x%x&quot;</span>
					<span class="s">&quot;</span><span class="se">\n</span><span class="s">PathComponentMax: %d Status: 0x%d&quot;</span><span class="p">,</span>
					<span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">fsDevInfo</span><span class="p">.</span><span class="n">DeviceCharacteristics</span><span class="p">),</span>
					<span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">fsAttrInfo</span><span class="p">.</span><span class="n">Attributes</span><span class="p">),</span>
					<span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">fsAttrInfo</span><span class="p">.</span><span class="n">MaxPathNameComponentLength</span><span class="p">),</span>
					<span class="n">tcon</span><span class="o">-&gt;</span><span class="n">tidStatus</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dev_type</span> <span class="o">==</span> <span class="n">FILE_DEVICE_DISK</span><span class="p">)</span>
					<span class="n">seq_puts</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; type: DISK &quot;</span><span class="p">);</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">dev_type</span> <span class="o">==</span> <span class="n">FILE_DEVICE_CD_ROM</span><span class="p">)</span>
					<span class="n">seq_puts</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; type: CDROM &quot;</span><span class="p">);</span>
				<span class="k">else</span>
					<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot; type: %d &quot;</span><span class="p">,</span> <span class="n">dev_type</span><span class="p">);</span>

				<span class="k">if</span> <span class="p">(</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">need_reconnect</span><span class="p">)</span>
					<span class="n">seq_puts</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">DISCONNECTED &quot;</span><span class="p">);</span>
				<span class="n">seq_putc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">);</span>
			<span class="p">}</span>

			<span class="n">seq_puts</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\t</span><span class="s">MIDs:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

			<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GlobalMid_Lock</span><span class="p">);</span>
			<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">pending_mid_q</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">mid_entry</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp3</span><span class="p">,</span> <span class="k">struct</span> <span class="n">mid_q_entry</span><span class="p">,</span>
					<span class="n">qhead</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">State: %d com: %d pid:&quot;</span>
					      <span class="s">&quot; %d cbdata: %p mid %llu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					      <span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">mid_state</span><span class="p">,</span>
					      <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">command</span><span class="p">),</span>
					      <span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">pid</span><span class="p">,</span>
					      <span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">callback_data</span><span class="p">,</span>
					      <span class="n">mid_entry</span><span class="o">-&gt;</span><span class="n">mid</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">GlobalMid_Lock</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cifs_tcp_ses_lock</span><span class="p">);</span>
	<span class="n">seq_putc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">);</span>

	<span class="cm">/* BB add code to dump additional info such as TCP session info now */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifs_debug_data_proc_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cifs_debug_data_proc_show</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">cifs_debug_data_proc_fops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span>		<span class="o">=</span> <span class="n">cifs_debug_data_proc_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span>		<span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>	<span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_CIFS_STATS</span>
<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">cifs_stats_proc_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">tmp1</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp2</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp3</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">TCP_Server_Info</span> <span class="o">*</span><span class="n">server</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cifs_ses</span> <span class="o">*</span><span class="n">ses</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cifs_tcon</span> <span class="o">*</span><span class="n">tcon</span><span class="p">;</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">get_user</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;1&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;y&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;Y&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_CIFS_STATS2</span>
		<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">totBufAllocCount</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">totSmBufAllocCount</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_CIFS_STATS2 */</span><span class="cp"></span>
		<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cifs_tcp_ses_lock</span><span class="p">);</span>
		<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cifs_tcp_ses_list</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">server</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp1</span><span class="p">,</span> <span class="k">struct</span> <span class="n">TCP_Server_Info</span><span class="p">,</span>
					    <span class="n">tcp_ses_list</span><span class="p">);</span>
			<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">smb_ses_list</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">ses</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp2</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cifs_ses</span><span class="p">,</span>
						 <span class="n">smb_ses_list</span><span class="p">);</span>
				<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ses</span><span class="o">-&gt;</span><span class="n">tcon_list</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">tcon</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp3</span><span class="p">,</span>
							  <span class="k">struct</span> <span class="n">cifs_tcon</span><span class="p">,</span>
							  <span class="n">tcon_list</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_smbs_sent</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_writes</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_reads</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_oplock_brks</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_opens</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_posixopens</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_posixmkdirs</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_closes</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_deletes</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_mkdirs</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_rmdirs</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_renames</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_t2renames</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_ffirst</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_fnext</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_fclose</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_hardlinks</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_symlinks</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
					<span class="n">atomic_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_locks</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cifs_tcp_ses_lock</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifs_stats_proc_show</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">tmp1</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp2</span><span class="p">,</span> <span class="o">*</span><span class="n">tmp3</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">TCP_Server_Info</span> <span class="o">*</span><span class="n">server</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cifs_ses</span> <span class="o">*</span><span class="n">ses</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cifs_tcon</span> <span class="o">*</span><span class="n">tcon</span><span class="p">;</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span>
			<span class="s">&quot;Resources in use</span><span class="se">\n</span><span class="s">CIFS Session: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">sesInfoAllocCount</span><span class="p">.</span><span class="n">counter</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;Share (unique mount targets): %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">tconInfoAllocCount</span><span class="p">.</span><span class="n">counter</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;SMB Request/Response Buffer: %d Pool size: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">bufAllocCount</span><span class="p">.</span><span class="n">counter</span><span class="p">,</span>
			<span class="n">cifs_min_rcv</span> <span class="o">+</span> <span class="n">tcpSesAllocCount</span><span class="p">.</span><span class="n">counter</span><span class="p">);</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;SMB Small Req/Resp Buffer: %d Pool size: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">smBufAllocCount</span><span class="p">.</span><span class="n">counter</span><span class="p">,</span> <span class="n">cifs_min_small</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_CIFS_STATS2</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;Total Large %d Small %d Allocations</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">totBufAllocCount</span><span class="p">),</span>
				<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">totSmBufAllocCount</span><span class="p">));</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_CIFS_STATS2 */</span><span class="cp"></span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;Operations (MIDs): %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">midCount</span><span class="p">));</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span>
		<span class="s">&quot;</span><span class="se">\n</span><span class="s">%d session %d share reconnects</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">tcpSesReconnectCount</span><span class="p">.</span><span class="n">counter</span><span class="p">,</span> <span class="n">tconInfoReconnectCount</span><span class="p">.</span><span class="n">counter</span><span class="p">);</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span>
		<span class="s">&quot;Total vfs operations: %d maximum at one time: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">GlobalCurrentXid</span><span class="p">,</span> <span class="n">GlobalMaxActiveXid</span><span class="p">);</span>

	<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cifs_tcp_ses_lock</span><span class="p">);</span>
	<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cifs_tcp_ses_list</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">server</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp1</span><span class="p">,</span> <span class="k">struct</span> <span class="n">TCP_Server_Info</span><span class="p">,</span>
				    <span class="n">tcp_ses_list</span><span class="p">);</span>
		<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">smb_ses_list</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ses</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp2</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cifs_ses</span><span class="p">,</span>
					 <span class="n">smb_ses_list</span><span class="p">);</span>
			<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ses</span><span class="o">-&gt;</span><span class="n">tcon_list</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">tcon</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">tmp3</span><span class="p">,</span>
						  <span class="k">struct</span> <span class="n">cifs_tcon</span><span class="p">,</span>
						  <span class="n">tcon_list</span><span class="p">);</span>
				<span class="n">i</span><span class="o">++</span><span class="p">;</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">%d) %s&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">tcon</span><span class="o">-&gt;</span><span class="n">treeName</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">need_reconnect</span><span class="p">)</span>
					<span class="n">seq_puts</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">DISCONNECTED &quot;</span><span class="p">);</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">SMBs: %d Oplock Breaks: %d&quot;</span><span class="p">,</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_smbs_sent</span><span class="p">),</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_oplock_brks</span><span class="p">));</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Reads:  %d Bytes: %lld&quot;</span><span class="p">,</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_reads</span><span class="p">),</span>
					<span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)(</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">bytes_read</span><span class="p">));</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Writes: %d Bytes: %lld&quot;</span><span class="p">,</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_writes</span><span class="p">),</span>
					<span class="p">(</span><span class="kt">long</span> <span class="kt">long</span><span class="p">)(</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">bytes_written</span><span class="p">));</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Flushes: %d&quot;</span><span class="p">,</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_flushes</span><span class="p">));</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Locks: %d HardLinks: %d &quot;</span>
					      <span class="s">&quot;Symlinks: %d&quot;</span><span class="p">,</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_locks</span><span class="p">),</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_hardlinks</span><span class="p">),</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_symlinks</span><span class="p">));</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Opens: %d Closes: %d &quot;</span>
					      <span class="s">&quot;Deletes: %d&quot;</span><span class="p">,</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_opens</span><span class="p">),</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_closes</span><span class="p">),</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_deletes</span><span class="p">));</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Posix Opens: %d &quot;</span>
					      <span class="s">&quot;Posix Mkdirs: %d&quot;</span><span class="p">,</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_posixopens</span><span class="p">),</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_posixmkdirs</span><span class="p">));</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Mkdirs: %d Rmdirs: %d&quot;</span><span class="p">,</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_mkdirs</span><span class="p">),</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_rmdirs</span><span class="p">));</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Renames: %d T2 Renames %d&quot;</span><span class="p">,</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_renames</span><span class="p">),</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_t2renames</span><span class="p">));</span>
				<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">FindFirst: %d FNext %d &quot;</span>
					      <span class="s">&quot;FClose %d&quot;</span><span class="p">,</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_ffirst</span><span class="p">),</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_fnext</span><span class="p">),</span>
					<span class="n">atomic_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tcon</span><span class="o">-&gt;</span><span class="n">num_fclose</span><span class="p">));</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cifs_tcp_ses_lock</span><span class="p">);</span>

	<span class="n">seq_putc</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="sc">&#39;\n&#39;</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifs_stats_proc_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cifs_stats_proc_show</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">cifs_stats_proc_fops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span>		<span class="o">=</span> <span class="n">cifs_stats_proc_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span>		<span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>	<span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span>		<span class="o">=</span> <span class="n">cifs_stats_proc_write</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif </span><span class="cm">/* STATS */</span><span class="cp"></span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">proc_dir_entry</span> <span class="o">*</span><span class="n">proc_fs_cifs</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">cifsFYI_proc_fops</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">cifs_lookup_cache_proc_fops</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">traceSMB_proc_fops</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">cifs_security_flags_proc_fops</span><span class="p">;</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">cifs_linux_ext_proc_fops</span><span class="p">;</span>

<span class="kt">void</span>
<span class="nf">cifs_proc_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">proc_fs_cifs</span> <span class="o">=</span> <span class="n">proc_mkdir</span><span class="p">(</span><span class="s">&quot;fs/cifs&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">proc_fs_cifs</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">proc_create</span><span class="p">(</span><span class="s">&quot;DebugData&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cifs_debug_data_proc_fops</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_CIFS_STATS</span>
	<span class="n">proc_create</span><span class="p">(</span><span class="s">&quot;Stats&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cifs_stats_proc_fops</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* STATS */</span><span class="cp"></span>
	<span class="n">proc_create</span><span class="p">(</span><span class="s">&quot;cifsFYI&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cifsFYI_proc_fops</span><span class="p">);</span>
	<span class="n">proc_create</span><span class="p">(</span><span class="s">&quot;traceSMB&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">traceSMB_proc_fops</span><span class="p">);</span>
	<span class="n">proc_create</span><span class="p">(</span><span class="s">&quot;LinuxExtensionsEnabled&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">,</span>
		    <span class="o">&amp;</span><span class="n">cifs_linux_ext_proc_fops</span><span class="p">);</span>
	<span class="n">proc_create</span><span class="p">(</span><span class="s">&quot;SecurityFlags&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">,</span>
		    <span class="o">&amp;</span><span class="n">cifs_security_flags_proc_fops</span><span class="p">);</span>
	<span class="n">proc_create</span><span class="p">(</span><span class="s">&quot;LookupCacheEnabled&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">,</span>
		    <span class="o">&amp;</span><span class="n">cifs_lookup_cache_proc_fops</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">cifs_proc_clean</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">proc_fs_cifs</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">remove_proc_entry</span><span class="p">(</span><span class="s">&quot;DebugData&quot;</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">);</span>
	<span class="n">remove_proc_entry</span><span class="p">(</span><span class="s">&quot;cifsFYI&quot;</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">);</span>
	<span class="n">remove_proc_entry</span><span class="p">(</span><span class="s">&quot;traceSMB&quot;</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_CIFS_STATS</span>
	<span class="n">remove_proc_entry</span><span class="p">(</span><span class="s">&quot;Stats&quot;</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="n">remove_proc_entry</span><span class="p">(</span><span class="s">&quot;SecurityFlags&quot;</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">);</span>
	<span class="n">remove_proc_entry</span><span class="p">(</span><span class="s">&quot;LinuxExtensionsEnabled&quot;</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">);</span>
	<span class="n">remove_proc_entry</span><span class="p">(</span><span class="s">&quot;LookupCacheEnabled&quot;</span><span class="p">,</span> <span class="n">proc_fs_cifs</span><span class="p">);</span>
	<span class="n">remove_proc_entry</span><span class="p">(</span><span class="s">&quot;fs/cifs&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifsFYI_proc_show</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">cifsFYI</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifsFYI_proc_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cifsFYI_proc_show</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">cifsFYI_proc_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
		<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">get_user</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;0&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;n&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;N&#39;</span><span class="p">)</span>
		<span class="n">cifsFYI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;1&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;y&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;Y&#39;</span><span class="p">)</span>
		<span class="n">cifsFYI</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">c</span> <span class="o">&gt;</span> <span class="sc">&#39;1&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">c</span> <span class="o">&lt;=</span> <span class="sc">&#39;9&#39;</span><span class="p">))</span>
		<span class="n">cifsFYI</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">);</span> <span class="cm">/* see cifs_debug.h for meanings */</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">cifsFYI_proc_fops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span>		<span class="o">=</span> <span class="n">cifsFYI_proc_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span>		<span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>	<span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span>		<span class="o">=</span> <span class="n">cifsFYI_proc_write</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifs_linux_ext_proc_show</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">linuxExtEnabled</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifs_linux_ext_proc_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cifs_linux_ext_proc_show</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">cifs_linux_ext_proc_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">get_user</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;0&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;n&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;N&#39;</span><span class="p">)</span>
		<span class="n">linuxExtEnabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;1&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;y&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;Y&#39;</span><span class="p">)</span>
		<span class="n">linuxExtEnabled</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">cifs_linux_ext_proc_fops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span>		<span class="o">=</span> <span class="n">cifs_linux_ext_proc_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span>		<span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>	<span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span>		<span class="o">=</span> <span class="n">cifs_linux_ext_proc_write</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifs_lookup_cache_proc_show</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">lookupCacheEnabled</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifs_lookup_cache_proc_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cifs_lookup_cache_proc_show</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">cifs_lookup_cache_proc_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">get_user</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;0&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;n&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;N&#39;</span><span class="p">)</span>
		<span class="n">lookupCacheEnabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;1&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;y&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;Y&#39;</span><span class="p">)</span>
		<span class="n">lookupCacheEnabled</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">cifs_lookup_cache_proc_fops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span>		<span class="o">=</span> <span class="n">cifs_lookup_cache_proc_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span>		<span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>	<span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span>		<span class="o">=</span> <span class="n">cifs_lookup_cache_proc_write</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">traceSMB_proc_show</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">traceSMB</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">traceSMB_proc_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">traceSMB_proc_show</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">traceSMB_proc_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span>
		<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">get_user</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">buffer</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;0&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;n&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;N&#39;</span><span class="p">)</span>
		<span class="n">traceSMB</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;1&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;y&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;Y&#39;</span><span class="p">)</span>
		<span class="n">traceSMB</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">traceSMB_proc_fops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span>		<span class="o">=</span> <span class="n">traceSMB_proc_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span>		<span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>	<span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span>		<span class="o">=</span> <span class="n">traceSMB_proc_write</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifs_security_flags_proc_show</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">global_secflags</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cifs_security_flags_proc_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">single_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">cifs_security_flags_proc_show</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">cifs_security_flags_proc_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">flags_string</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">c</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">flags_string</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">flags_string</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* single char or single char followed by null */</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">flags_string</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;0&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;n&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;N&#39;</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">global_secflags</span> <span class="o">=</span> <span class="n">CIFSSEC_DEF</span><span class="p">;</span> <span class="cm">/* default */</span>
			<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;1&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;y&#39;</span> <span class="o">||</span> <span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;Y&#39;</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">global_secflags</span> <span class="o">=</span> <span class="n">CIFSSEC_MAX</span><span class="p">;</span>
			<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isdigit</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">cERROR</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;invalid flag %c&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="cm">/* else we have a number */</span>

	<span class="n">flags</span> <span class="o">=</span> <span class="n">simple_strtoul</span><span class="p">(</span><span class="n">flags_string</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">cFYI</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;sec flags 0x%x&quot;</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>  <span class="p">{</span>
		<span class="n">cERROR</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;invalid security flags %s&quot;</span><span class="p">,</span> <span class="n">flags_string</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">CIFSSEC_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cERROR</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;attempt to set unsupported security flags 0x%x&quot;</span><span class="p">,</span>
			<span class="n">flags</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">CIFSSEC_MASK</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* flags look ok - update the global security flags for cifs module */</span>
	<span class="n">global_secflags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">global_secflags</span> <span class="o">&amp;</span> <span class="n">CIFSSEC_MUST_SIGN</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* requiring signing implies signing is allowed */</span>
		<span class="n">global_secflags</span> <span class="o">|=</span> <span class="n">CIFSSEC_MAY_SIGN</span><span class="p">;</span>
		<span class="n">cFYI</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;packet signing now required&quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">global_secflags</span> <span class="o">&amp;</span> <span class="n">CIFSSEC_MAY_SIGN</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cFYI</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;packet signing disabled&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/* BB should we turn on MAY flags for other MUST options? */</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">cifs_security_flags_proc_fops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">owner</span>		<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span>		<span class="o">=</span> <span class="n">cifs_security_flags_proc_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span>		<span class="o">=</span> <span class="n">seq_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span>		<span class="o">=</span> <span class="n">seq_lseek</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>	<span class="o">=</span> <span class="n">single_release</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span>		<span class="o">=</span> <span class="n">cifs_security_flags_proc_write</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#else</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cifs_proc_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cifs_proc_clean</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* PROC_FS */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
