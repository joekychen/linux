<!DOCTYPE html>
<html><head><title>joekychen/linux » fs › xfs › xfs_sb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>xfs_sb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2000-2005 Silicon Graphics, Inc.</span>
<span class="cm"> * All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it would be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write the Free Software Foundation,</span>
<span class="cm"> * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __XFS_SB_H__</span>
<span class="cp">#define	__XFS_SB_H__</span>

<span class="cm">/*</span>
<span class="cm"> * Super block</span>
<span class="cm"> * Fits into a sector-sized buffer at address 0 of each allocation group.</span>
<span class="cm"> * Only the first of these is ever updated except during growfs.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">xfs_buf</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_mount</span><span class="p">;</span>

<span class="cp">#define	XFS_SB_MAGIC		0x58465342	</span><span class="cm">/* &#39;XFSB&#39; */</span><span class="cp"></span>
<span class="cp">#define	XFS_SB_VERSION_1	1		</span><span class="cm">/* 5.3, 6.0.1, 6.1 */</span><span class="cp"></span>
<span class="cp">#define	XFS_SB_VERSION_2	2		</span><span class="cm">/* 6.2 - attributes */</span><span class="cp"></span>
<span class="cp">#define	XFS_SB_VERSION_3	3		</span><span class="cm">/* 6.2 - new inode version */</span><span class="cp"></span>
<span class="cp">#define	XFS_SB_VERSION_4	4		</span><span class="cm">/* 6.2+ - bitmask version */</span><span class="cp"></span>
<span class="cp">#define	XFS_SB_VERSION_NUMBITS		0x000f</span>
<span class="cp">#define	XFS_SB_VERSION_ALLFBITS		0xfff0</span>
<span class="cp">#define	XFS_SB_VERSION_SASHFBITS	0xf000</span>
<span class="cp">#define	XFS_SB_VERSION_REALFBITS	0x0ff0</span>
<span class="cp">#define	XFS_SB_VERSION_ATTRBIT		0x0010</span>
<span class="cp">#define	XFS_SB_VERSION_NLINKBIT		0x0020</span>
<span class="cp">#define	XFS_SB_VERSION_QUOTABIT		0x0040</span>
<span class="cp">#define	XFS_SB_VERSION_ALIGNBIT		0x0080</span>
<span class="cp">#define	XFS_SB_VERSION_DALIGNBIT	0x0100</span>
<span class="cp">#define	XFS_SB_VERSION_SHAREDBIT	0x0200</span>
<span class="cp">#define XFS_SB_VERSION_LOGV2BIT		0x0400</span>
<span class="cp">#define XFS_SB_VERSION_SECTORBIT	0x0800</span>
<span class="cp">#define	XFS_SB_VERSION_EXTFLGBIT	0x1000</span>
<span class="cp">#define	XFS_SB_VERSION_DIRV2BIT		0x2000</span>
<span class="cp">#define	XFS_SB_VERSION_BORGBIT		0x4000	</span><span class="cm">/* ASCII only case-insens. */</span><span class="cp"></span>
<span class="cp">#define	XFS_SB_VERSION_MOREBITSBIT	0x8000</span>
<span class="cp">#define	XFS_SB_VERSION_OKSASHFBITS	\</span>
<span class="cp">	(XFS_SB_VERSION_EXTFLGBIT | \</span>
<span class="cp">	 XFS_SB_VERSION_DIRV2BIT | \</span>
<span class="cp">	 XFS_SB_VERSION_BORGBIT)</span>
<span class="cp">#define	XFS_SB_VERSION_OKREALFBITS	\</span>
<span class="cp">	(XFS_SB_VERSION_ATTRBIT | \</span>
<span class="cp">	 XFS_SB_VERSION_NLINKBIT | \</span>
<span class="cp">	 XFS_SB_VERSION_QUOTABIT | \</span>
<span class="cp">	 XFS_SB_VERSION_ALIGNBIT | \</span>
<span class="cp">	 XFS_SB_VERSION_DALIGNBIT | \</span>
<span class="cp">	 XFS_SB_VERSION_SHAREDBIT | \</span>
<span class="cp">	 XFS_SB_VERSION_LOGV2BIT | \</span>
<span class="cp">	 XFS_SB_VERSION_SECTORBIT | \</span>
<span class="cp">	 XFS_SB_VERSION_MOREBITSBIT)</span>
<span class="cp">#define	XFS_SB_VERSION_OKREALBITS	\</span>
<span class="cp">	(XFS_SB_VERSION_NUMBITS | \</span>
<span class="cp">	 XFS_SB_VERSION_OKREALFBITS | \</span>
<span class="cp">	 XFS_SB_VERSION_OKSASHFBITS)</span>

<span class="cm">/*</span>
<span class="cm"> * There are two words to hold XFS &quot;feature&quot; bits: the original</span>
<span class="cm"> * word, sb_versionnum, and sb_features2.  Whenever a bit is set in</span>
<span class="cm"> * sb_features2, the feature bit XFS_SB_VERSION_MOREBITSBIT must be set.</span>
<span class="cm"> *</span>
<span class="cm"> * These defines represent bits in sb_features2.</span>
<span class="cm"> */</span>
<span class="cp">#define XFS_SB_VERSION2_REALFBITS	0x00ffffff	</span><span class="cm">/* Mask: features */</span><span class="cp"></span>
<span class="cp">#define XFS_SB_VERSION2_RESERVED1BIT	0x00000001</span>
<span class="cp">#define XFS_SB_VERSION2_LAZYSBCOUNTBIT	0x00000002	</span><span class="cm">/* Superblk counters */</span><span class="cp"></span>
<span class="cp">#define XFS_SB_VERSION2_RESERVED4BIT	0x00000004</span>
<span class="cp">#define XFS_SB_VERSION2_ATTR2BIT	0x00000008	</span><span class="cm">/* Inline attr rework */</span><span class="cp"></span>
<span class="cp">#define XFS_SB_VERSION2_PARENTBIT	0x00000010	</span><span class="cm">/* parent pointers */</span><span class="cp"></span>
<span class="cp">#define XFS_SB_VERSION2_PROJID32BIT	0x00000080	</span><span class="cm">/* 32 bit project id */</span><span class="cp"></span>

<span class="cp">#define	XFS_SB_VERSION2_OKREALFBITS	\</span>
<span class="cp">	(XFS_SB_VERSION2_LAZYSBCOUNTBIT	| \</span>
<span class="cp">	 XFS_SB_VERSION2_ATTR2BIT	| \</span>
<span class="cp">	 XFS_SB_VERSION2_PROJID32BIT)</span>
<span class="cp">#define	XFS_SB_VERSION2_OKSASHFBITS	\</span>
<span class="cp">	(0)</span>
<span class="cp">#define XFS_SB_VERSION2_OKREALBITS	\</span>
<span class="cp">	(XFS_SB_VERSION2_OKREALFBITS |	\</span>
<span class="cp">	 XFS_SB_VERSION2_OKSASHFBITS )</span>

<span class="cm">/*</span>
<span class="cm"> * Superblock - in core version.  Must match the ondisk version below.</span>
<span class="cm"> * Must be padded to 64 bit alignment.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">xfs_sb</span> <span class="p">{</span>
	<span class="n">__uint32_t</span>	<span class="n">sb_magicnum</span><span class="p">;</span>	<span class="cm">/* magic number == XFS_SB_MAGIC */</span>
	<span class="n">__uint32_t</span>	<span class="n">sb_blocksize</span><span class="p">;</span>	<span class="cm">/* logical block size, bytes */</span>
	<span class="n">xfs_drfsbno_t</span>	<span class="n">sb_dblocks</span><span class="p">;</span>	<span class="cm">/* number of data blocks */</span>
	<span class="n">xfs_drfsbno_t</span>	<span class="n">sb_rblocks</span><span class="p">;</span>	<span class="cm">/* number of realtime blocks */</span>
	<span class="n">xfs_drtbno_t</span>	<span class="n">sb_rextents</span><span class="p">;</span>	<span class="cm">/* number of realtime extents */</span>
	<span class="n">uuid_t</span>		<span class="n">sb_uuid</span><span class="p">;</span>	<span class="cm">/* file system unique id */</span>
	<span class="n">xfs_dfsbno_t</span>	<span class="n">sb_logstart</span><span class="p">;</span>	<span class="cm">/* starting block of log if internal */</span>
	<span class="n">xfs_ino_t</span>	<span class="n">sb_rootino</span><span class="p">;</span>	<span class="cm">/* root inode number */</span>
	<span class="n">xfs_ino_t</span>	<span class="n">sb_rbmino</span><span class="p">;</span>	<span class="cm">/* bitmap inode for realtime extents */</span>
	<span class="n">xfs_ino_t</span>	<span class="n">sb_rsumino</span><span class="p">;</span>	<span class="cm">/* summary inode for rt bitmap */</span>
	<span class="n">xfs_agblock_t</span>	<span class="n">sb_rextsize</span><span class="p">;</span>	<span class="cm">/* realtime extent size, blocks */</span>
	<span class="n">xfs_agblock_t</span>	<span class="n">sb_agblocks</span><span class="p">;</span>	<span class="cm">/* size of an allocation group */</span>
	<span class="n">xfs_agnumber_t</span>	<span class="n">sb_agcount</span><span class="p">;</span>	<span class="cm">/* number of allocation groups */</span>
	<span class="n">xfs_extlen_t</span>	<span class="n">sb_rbmblocks</span><span class="p">;</span>	<span class="cm">/* number of rt bitmap blocks */</span>
	<span class="n">xfs_extlen_t</span>	<span class="n">sb_logblocks</span><span class="p">;</span>	<span class="cm">/* number of log blocks */</span>
	<span class="n">__uint16_t</span>	<span class="n">sb_versionnum</span><span class="p">;</span>	<span class="cm">/* header version == XFS_SB_VERSION */</span>
	<span class="n">__uint16_t</span>	<span class="n">sb_sectsize</span><span class="p">;</span>	<span class="cm">/* volume sector size, bytes */</span>
	<span class="n">__uint16_t</span>	<span class="n">sb_inodesize</span><span class="p">;</span>	<span class="cm">/* inode size, bytes */</span>
	<span class="n">__uint16_t</span>	<span class="n">sb_inopblock</span><span class="p">;</span>	<span class="cm">/* inodes per block */</span>
	<span class="kt">char</span>		<span class="n">sb_fname</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>	<span class="cm">/* file system name */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_blocklog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_blocksize */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_sectlog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_sectsize */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_inodelog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_inodesize */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_inopblog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_inopblock */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_agblklog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_agblocks (rounded up) */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_rextslog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_rextents */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_inprogress</span><span class="p">;</span>	<span class="cm">/* mkfs is in progress, don&#39;t mount */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_imax_pct</span><span class="p">;</span>	<span class="cm">/* max % of fs for inode space */</span>
					<span class="cm">/* statistics */</span>
	<span class="cm">/*</span>
<span class="cm">	 * These fields must remain contiguous.  If you really</span>
<span class="cm">	 * want to change their layout, make sure you fix the</span>
<span class="cm">	 * code in xfs_trans_apply_sb_deltas().</span>
<span class="cm">	 */</span>
	<span class="n">__uint64_t</span>	<span class="n">sb_icount</span><span class="p">;</span>	<span class="cm">/* allocated inodes */</span>
	<span class="n">__uint64_t</span>	<span class="n">sb_ifree</span><span class="p">;</span>	<span class="cm">/* free inodes */</span>
	<span class="n">__uint64_t</span>	<span class="n">sb_fdblocks</span><span class="p">;</span>	<span class="cm">/* free data blocks */</span>
	<span class="n">__uint64_t</span>	<span class="n">sb_frextents</span><span class="p">;</span>	<span class="cm">/* free realtime extents */</span>
	<span class="cm">/*</span>
<span class="cm">	 * End contiguous fields.</span>
<span class="cm">	 */</span>
	<span class="n">xfs_ino_t</span>	<span class="n">sb_uquotino</span><span class="p">;</span>	<span class="cm">/* user quota inode */</span>
	<span class="n">xfs_ino_t</span>	<span class="n">sb_gquotino</span><span class="p">;</span>	<span class="cm">/* group quota inode */</span>
	<span class="n">__uint16_t</span>	<span class="n">sb_qflags</span><span class="p">;</span>	<span class="cm">/* quota flags */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_flags</span><span class="p">;</span>	<span class="cm">/* misc. flags */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_shared_vn</span><span class="p">;</span>	<span class="cm">/* shared version number */</span>
	<span class="n">xfs_extlen_t</span>	<span class="n">sb_inoalignmt</span><span class="p">;</span>	<span class="cm">/* inode chunk alignment, fsblocks */</span>
	<span class="n">__uint32_t</span>	<span class="n">sb_unit</span><span class="p">;</span>	<span class="cm">/* stripe or raid unit */</span>
	<span class="n">__uint32_t</span>	<span class="n">sb_width</span><span class="p">;</span>	<span class="cm">/* stripe or raid width */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_dirblklog</span><span class="p">;</span>	<span class="cm">/* log2 of dir block size (fsbs) */</span>
	<span class="n">__uint8_t</span>	<span class="n">sb_logsectlog</span><span class="p">;</span>	<span class="cm">/* log2 of the log sector size */</span>
	<span class="n">__uint16_t</span>	<span class="n">sb_logsectsize</span><span class="p">;</span>	<span class="cm">/* sector size for the log, bytes */</span>
	<span class="n">__uint32_t</span>	<span class="n">sb_logsunit</span><span class="p">;</span>	<span class="cm">/* stripe unit size for the log */</span>
	<span class="n">__uint32_t</span>	<span class="n">sb_features2</span><span class="p">;</span>	<span class="cm">/* additional feature bits */</span>

	<span class="cm">/*</span>
<span class="cm">	 * bad features2 field as a result of failing to pad the sb</span>
<span class="cm">	 * structure to 64 bits. Some machines will be using this field</span>
<span class="cm">	 * for features2 bits. Easiest just to mark it bad and not use</span>
<span class="cm">	 * it for anything else.</span>
<span class="cm">	 */</span>
	<span class="n">__uint32_t</span>	<span class="n">sb_bad_features2</span><span class="p">;</span>

	<span class="cm">/* must be padded to 64 bit alignment */</span>
<span class="p">}</span> <span class="n">xfs_sb_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Superblock - on disk version.  Must match the in core version above.</span>
<span class="cm"> * Must be padded to 64 bit alignment.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">xfs_dsb</span> <span class="p">{</span>
	<span class="n">__be32</span>		<span class="n">sb_magicnum</span><span class="p">;</span>	<span class="cm">/* magic number == XFS_SB_MAGIC */</span>
	<span class="n">__be32</span>		<span class="n">sb_blocksize</span><span class="p">;</span>	<span class="cm">/* logical block size, bytes */</span>
	<span class="n">__be64</span>		<span class="n">sb_dblocks</span><span class="p">;</span>	<span class="cm">/* number of data blocks */</span>
	<span class="n">__be64</span>		<span class="n">sb_rblocks</span><span class="p">;</span>	<span class="cm">/* number of realtime blocks */</span>
	<span class="n">__be64</span>		<span class="n">sb_rextents</span><span class="p">;</span>	<span class="cm">/* number of realtime extents */</span>
	<span class="n">uuid_t</span>		<span class="n">sb_uuid</span><span class="p">;</span>	<span class="cm">/* file system unique id */</span>
	<span class="n">__be64</span>		<span class="n">sb_logstart</span><span class="p">;</span>	<span class="cm">/* starting block of log if internal */</span>
	<span class="n">__be64</span>		<span class="n">sb_rootino</span><span class="p">;</span>	<span class="cm">/* root inode number */</span>
	<span class="n">__be64</span>		<span class="n">sb_rbmino</span><span class="p">;</span>	<span class="cm">/* bitmap inode for realtime extents */</span>
	<span class="n">__be64</span>		<span class="n">sb_rsumino</span><span class="p">;</span>	<span class="cm">/* summary inode for rt bitmap */</span>
	<span class="n">__be32</span>		<span class="n">sb_rextsize</span><span class="p">;</span>	<span class="cm">/* realtime extent size, blocks */</span>
	<span class="n">__be32</span>		<span class="n">sb_agblocks</span><span class="p">;</span>	<span class="cm">/* size of an allocation group */</span>
	<span class="n">__be32</span>		<span class="n">sb_agcount</span><span class="p">;</span>	<span class="cm">/* number of allocation groups */</span>
	<span class="n">__be32</span>		<span class="n">sb_rbmblocks</span><span class="p">;</span>	<span class="cm">/* number of rt bitmap blocks */</span>
	<span class="n">__be32</span>		<span class="n">sb_logblocks</span><span class="p">;</span>	<span class="cm">/* number of log blocks */</span>
	<span class="n">__be16</span>		<span class="n">sb_versionnum</span><span class="p">;</span>	<span class="cm">/* header version == XFS_SB_VERSION */</span>
	<span class="n">__be16</span>		<span class="n">sb_sectsize</span><span class="p">;</span>	<span class="cm">/* volume sector size, bytes */</span>
	<span class="n">__be16</span>		<span class="n">sb_inodesize</span><span class="p">;</span>	<span class="cm">/* inode size, bytes */</span>
	<span class="n">__be16</span>		<span class="n">sb_inopblock</span><span class="p">;</span>	<span class="cm">/* inodes per block */</span>
	<span class="kt">char</span>		<span class="n">sb_fname</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>	<span class="cm">/* file system name */</span>
	<span class="n">__u8</span>		<span class="n">sb_blocklog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_blocksize */</span>
	<span class="n">__u8</span>		<span class="n">sb_sectlog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_sectsize */</span>
	<span class="n">__u8</span>		<span class="n">sb_inodelog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_inodesize */</span>
	<span class="n">__u8</span>		<span class="n">sb_inopblog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_inopblock */</span>
	<span class="n">__u8</span>		<span class="n">sb_agblklog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_agblocks (rounded up) */</span>
	<span class="n">__u8</span>		<span class="n">sb_rextslog</span><span class="p">;</span>	<span class="cm">/* log2 of sb_rextents */</span>
	<span class="n">__u8</span>		<span class="n">sb_inprogress</span><span class="p">;</span>	<span class="cm">/* mkfs is in progress, don&#39;t mount */</span>
	<span class="n">__u8</span>		<span class="n">sb_imax_pct</span><span class="p">;</span>	<span class="cm">/* max % of fs for inode space */</span>
					<span class="cm">/* statistics */</span>
	<span class="cm">/*</span>
<span class="cm">	 * These fields must remain contiguous.  If you really</span>
<span class="cm">	 * want to change their layout, make sure you fix the</span>
<span class="cm">	 * code in xfs_trans_apply_sb_deltas().</span>
<span class="cm">	 */</span>
	<span class="n">__be64</span>		<span class="n">sb_icount</span><span class="p">;</span>	<span class="cm">/* allocated inodes */</span>
	<span class="n">__be64</span>		<span class="n">sb_ifree</span><span class="p">;</span>	<span class="cm">/* free inodes */</span>
	<span class="n">__be64</span>		<span class="n">sb_fdblocks</span><span class="p">;</span>	<span class="cm">/* free data blocks */</span>
	<span class="n">__be64</span>		<span class="n">sb_frextents</span><span class="p">;</span>	<span class="cm">/* free realtime extents */</span>
	<span class="cm">/*</span>
<span class="cm">	 * End contiguous fields.</span>
<span class="cm">	 */</span>
	<span class="n">__be64</span>		<span class="n">sb_uquotino</span><span class="p">;</span>	<span class="cm">/* user quota inode */</span>
	<span class="n">__be64</span>		<span class="n">sb_gquotino</span><span class="p">;</span>	<span class="cm">/* group quota inode */</span>
	<span class="n">__be16</span>		<span class="n">sb_qflags</span><span class="p">;</span>	<span class="cm">/* quota flags */</span>
	<span class="n">__u8</span>		<span class="n">sb_flags</span><span class="p">;</span>	<span class="cm">/* misc. flags */</span>
	<span class="n">__u8</span>		<span class="n">sb_shared_vn</span><span class="p">;</span>	<span class="cm">/* shared version number */</span>
	<span class="n">__be32</span>		<span class="n">sb_inoalignmt</span><span class="p">;</span>	<span class="cm">/* inode chunk alignment, fsblocks */</span>
	<span class="n">__be32</span>		<span class="n">sb_unit</span><span class="p">;</span>	<span class="cm">/* stripe or raid unit */</span>
	<span class="n">__be32</span>		<span class="n">sb_width</span><span class="p">;</span>	<span class="cm">/* stripe or raid width */</span>
	<span class="n">__u8</span>		<span class="n">sb_dirblklog</span><span class="p">;</span>	<span class="cm">/* log2 of dir block size (fsbs) */</span>
	<span class="n">__u8</span>		<span class="n">sb_logsectlog</span><span class="p">;</span>	<span class="cm">/* log2 of the log sector size */</span>
	<span class="n">__be16</span>		<span class="n">sb_logsectsize</span><span class="p">;</span>	<span class="cm">/* sector size for the log, bytes */</span>
	<span class="n">__be32</span>		<span class="n">sb_logsunit</span><span class="p">;</span>	<span class="cm">/* stripe unit size for the log */</span>
	<span class="n">__be32</span>		<span class="n">sb_features2</span><span class="p">;</span>	<span class="cm">/* additional feature bits */</span>
	<span class="cm">/*</span>
<span class="cm">	 * bad features2 field as a result of failing to pad the sb</span>
<span class="cm">	 * structure to 64 bits. Some machines will be using this field</span>
<span class="cm">	 * for features2 bits. Easiest just to mark it bad and not use</span>
<span class="cm">	 * it for anything else.</span>
<span class="cm">	 */</span>
	<span class="n">__be32</span>	<span class="n">sb_bad_features2</span><span class="p">;</span>

	<span class="cm">/* must be padded to 64 bit alignment */</span>
<span class="p">}</span> <span class="n">xfs_dsb_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Sequence number values for the fields.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">XFS_SBS_MAGICNUM</span><span class="p">,</span> <span class="n">XFS_SBS_BLOCKSIZE</span><span class="p">,</span> <span class="n">XFS_SBS_DBLOCKS</span><span class="p">,</span> <span class="n">XFS_SBS_RBLOCKS</span><span class="p">,</span>
	<span class="n">XFS_SBS_REXTENTS</span><span class="p">,</span> <span class="n">XFS_SBS_UUID</span><span class="p">,</span> <span class="n">XFS_SBS_LOGSTART</span><span class="p">,</span> <span class="n">XFS_SBS_ROOTINO</span><span class="p">,</span>
	<span class="n">XFS_SBS_RBMINO</span><span class="p">,</span> <span class="n">XFS_SBS_RSUMINO</span><span class="p">,</span> <span class="n">XFS_SBS_REXTSIZE</span><span class="p">,</span> <span class="n">XFS_SBS_AGBLOCKS</span><span class="p">,</span>
	<span class="n">XFS_SBS_AGCOUNT</span><span class="p">,</span> <span class="n">XFS_SBS_RBMBLOCKS</span><span class="p">,</span> <span class="n">XFS_SBS_LOGBLOCKS</span><span class="p">,</span>
	<span class="n">XFS_SBS_VERSIONNUM</span><span class="p">,</span> <span class="n">XFS_SBS_SECTSIZE</span><span class="p">,</span> <span class="n">XFS_SBS_INODESIZE</span><span class="p">,</span>
	<span class="n">XFS_SBS_INOPBLOCK</span><span class="p">,</span> <span class="n">XFS_SBS_FNAME</span><span class="p">,</span> <span class="n">XFS_SBS_BLOCKLOG</span><span class="p">,</span>
	<span class="n">XFS_SBS_SECTLOG</span><span class="p">,</span> <span class="n">XFS_SBS_INODELOG</span><span class="p">,</span> <span class="n">XFS_SBS_INOPBLOG</span><span class="p">,</span> <span class="n">XFS_SBS_AGBLKLOG</span><span class="p">,</span>
	<span class="n">XFS_SBS_REXTSLOG</span><span class="p">,</span> <span class="n">XFS_SBS_INPROGRESS</span><span class="p">,</span> <span class="n">XFS_SBS_IMAX_PCT</span><span class="p">,</span> <span class="n">XFS_SBS_ICOUNT</span><span class="p">,</span>
	<span class="n">XFS_SBS_IFREE</span><span class="p">,</span> <span class="n">XFS_SBS_FDBLOCKS</span><span class="p">,</span> <span class="n">XFS_SBS_FREXTENTS</span><span class="p">,</span> <span class="n">XFS_SBS_UQUOTINO</span><span class="p">,</span>
	<span class="n">XFS_SBS_GQUOTINO</span><span class="p">,</span> <span class="n">XFS_SBS_QFLAGS</span><span class="p">,</span> <span class="n">XFS_SBS_FLAGS</span><span class="p">,</span> <span class="n">XFS_SBS_SHARED_VN</span><span class="p">,</span>
	<span class="n">XFS_SBS_INOALIGNMT</span><span class="p">,</span> <span class="n">XFS_SBS_UNIT</span><span class="p">,</span> <span class="n">XFS_SBS_WIDTH</span><span class="p">,</span> <span class="n">XFS_SBS_DIRBLKLOG</span><span class="p">,</span>
	<span class="n">XFS_SBS_LOGSECTLOG</span><span class="p">,</span> <span class="n">XFS_SBS_LOGSECTSIZE</span><span class="p">,</span> <span class="n">XFS_SBS_LOGSUNIT</span><span class="p">,</span>
	<span class="n">XFS_SBS_FEATURES2</span><span class="p">,</span> <span class="n">XFS_SBS_BAD_FEATURES2</span><span class="p">,</span>
	<span class="n">XFS_SBS_FIELDCOUNT</span>
<span class="p">}</span> <span class="n">xfs_sb_field_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Mask values, defined based on the xfs_sb_field_t values.</span>
<span class="cm"> * Only define the ones we&#39;re using.</span>
<span class="cm"> */</span>
<span class="cp">#define	XFS_SB_MVAL(x)		(1LL &lt;&lt; XFS_SBS_ ## x)</span>
<span class="cp">#define	XFS_SB_UUID		XFS_SB_MVAL(UUID)</span>
<span class="cp">#define	XFS_SB_FNAME		XFS_SB_MVAL(FNAME)</span>
<span class="cp">#define	XFS_SB_ROOTINO		XFS_SB_MVAL(ROOTINO)</span>
<span class="cp">#define	XFS_SB_RBMINO		XFS_SB_MVAL(RBMINO)</span>
<span class="cp">#define	XFS_SB_RSUMINO		XFS_SB_MVAL(RSUMINO)</span>
<span class="cp">#define	XFS_SB_VERSIONNUM	XFS_SB_MVAL(VERSIONNUM)</span>
<span class="cp">#define XFS_SB_UQUOTINO		XFS_SB_MVAL(UQUOTINO)</span>
<span class="cp">#define XFS_SB_GQUOTINO		XFS_SB_MVAL(GQUOTINO)</span>
<span class="cp">#define XFS_SB_QFLAGS		XFS_SB_MVAL(QFLAGS)</span>
<span class="cp">#define XFS_SB_SHARED_VN	XFS_SB_MVAL(SHARED_VN)</span>
<span class="cp">#define XFS_SB_UNIT		XFS_SB_MVAL(UNIT)</span>
<span class="cp">#define XFS_SB_WIDTH		XFS_SB_MVAL(WIDTH)</span>
<span class="cp">#define XFS_SB_ICOUNT		XFS_SB_MVAL(ICOUNT)</span>
<span class="cp">#define XFS_SB_IFREE		XFS_SB_MVAL(IFREE)</span>
<span class="cp">#define XFS_SB_FDBLOCKS		XFS_SB_MVAL(FDBLOCKS)</span>
<span class="cp">#define XFS_SB_FEATURES2	XFS_SB_MVAL(FEATURES2)</span>
<span class="cp">#define XFS_SB_BAD_FEATURES2	XFS_SB_MVAL(BAD_FEATURES2)</span>
<span class="cp">#define	XFS_SB_NUM_BITS		((int)XFS_SBS_FIELDCOUNT)</span>
<span class="cp">#define	XFS_SB_ALL_BITS		((1LL &lt;&lt; XFS_SB_NUM_BITS) - 1)</span>
<span class="cp">#define	XFS_SB_MOD_BITS		\</span>
<span class="cp">	(XFS_SB_UUID | XFS_SB_ROOTINO | XFS_SB_RBMINO | XFS_SB_RSUMINO | \</span>
<span class="cp">	 XFS_SB_VERSIONNUM | XFS_SB_UQUOTINO | XFS_SB_GQUOTINO | \</span>
<span class="cp">	 XFS_SB_QFLAGS | XFS_SB_SHARED_VN | XFS_SB_UNIT | XFS_SB_WIDTH | \</span>
<span class="cp">	 XFS_SB_ICOUNT | XFS_SB_IFREE | XFS_SB_FDBLOCKS | XFS_SB_FEATURES2 | \</span>
<span class="cp">	 XFS_SB_BAD_FEATURES2)</span>


<span class="cm">/*</span>
<span class="cm"> * Misc. Flags - warning - these will be cleared by xfs_repair unless</span>
<span class="cm"> * a feature bit is set when the flag is used.</span>
<span class="cm"> */</span>
<span class="cp">#define XFS_SBF_NOFLAGS		0x00	</span><span class="cm">/* no flags set */</span><span class="cp"></span>
<span class="cp">#define XFS_SBF_READONLY	0x01	</span><span class="cm">/* only read-only mounts allowed */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * define max. shared version we can interoperate with</span>
<span class="cm"> */</span>
<span class="cp">#define XFS_SB_MAX_SHARED_VN	0</span>

<span class="cp">#define	XFS_SB_VERSION_NUM(sbp)	((sbp)-&gt;sb_versionnum &amp; XFS_SB_VERSION_NUMBITS)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_good_version</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* We always support version 1-3 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&gt;=</span> <span class="n">XFS_SB_VERSION_1</span> <span class="o">&amp;&amp;</span>
	    <span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&lt;=</span> <span class="n">XFS_SB_VERSION_3</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* We support version 4 if all feature bits are supported */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">XFS_SB_VERSION_OKREALBITS</span><span class="p">)</span> <span class="o">||</span>
		    <span class="p">((</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_MOREBITSBIT</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		     <span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_features2</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">XFS_SB_VERSION2_OKREALBITS</span><span class="p">)))</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="cp">#ifdef __KERNEL__</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_shared_vn</span> <span class="o">&gt;</span> <span class="n">XFS_SB_MAX_SHARED_VN</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#else</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_SHAREDBIT</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_shared_vn</span> <span class="o">&gt;</span> <span class="n">XFS_SB_MAX_SHARED_VN</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#endif</span>

		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Detect a mismatched features2 field.  Older kernels read/wrote</span>
<span class="cm"> * this into the wrong slot, so to be safe we keep them in sync.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_has_mismatched_features2</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_bad_features2</span> <span class="o">!=</span> <span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_features2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="nf">xfs_sb_version_tonew</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">XFS_SB_VERSION_4</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_2</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">|</span> <span class="n">XFS_SB_VERSION_ATTRBIT</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">|</span> <span class="n">XFS_SB_VERSION_ATTRBIT</span> <span class="o">|</span>
		<span class="n">XFS_SB_VERSION_NLINKBIT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="nf">xfs_sb_version_toold</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">XFS_SB_VERSION_QUOTABIT</span> <span class="o">|</span> <span class="n">XFS_SB_VERSION_ALIGNBIT</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_NLINKBIT</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">XFS_SB_VERSION_3</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_ATTRBIT</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">XFS_SB_VERSION_2</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasattr</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_2</span> <span class="o">||</span>
		<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_3</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		 <span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_ATTRBIT</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">xfs_sb_version_addattr</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_1</span><span class="p">)</span>
		<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">=</span> <span class="n">XFS_SB_VERSION_2</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span><span class="p">)</span>
		<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">|=</span> <span class="n">XFS_SB_VERSION_ATTRBIT</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">=</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">|</span> <span class="n">XFS_SB_VERSION_ATTRBIT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasnlink</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_3</span> <span class="o">||</span>
		 <span class="p">(</span><span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		  <span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_NLINKBIT</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">xfs_sb_version_addnlink</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&lt;=</span> <span class="n">XFS_SB_VERSION_2</span><span class="p">)</span>
		<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">=</span> <span class="n">XFS_SB_VERSION_3</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">|=</span> <span class="n">XFS_SB_VERSION_NLINKBIT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasquota</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_QUOTABIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">xfs_sb_version_addquota</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span><span class="p">)</span>
		<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">|=</span> <span class="n">XFS_SB_VERSION_QUOTABIT</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">=</span> <span class="n">xfs_sb_version_tonew</span><span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span><span class="p">)</span> <span class="o">|</span>
					<span class="n">XFS_SB_VERSION_QUOTABIT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasalign</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_ALIGNBIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasdalign</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_DALIGNBIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasshared</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_SHAREDBIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasdirv2</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_DIRV2BIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_haslogv2</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_LOGV2BIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasextflgbit</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_EXTFLGBIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hassector</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_SECTORBIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasasciici</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_BORGBIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasmorebits</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">XFS_SB_VERSION_NUM</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">==</span> <span class="n">XFS_SB_VERSION_4</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION_MOREBITSBIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * sb_features2 bit version macros.</span>
<span class="cm"> *</span>
<span class="cm"> * For example, for a bit defined as XFS_SB_VERSION2_FUNBIT, has a macro:</span>
<span class="cm"> *</span>
<span class="cm"> * SB_VERSION_HASFUNBIT(xfs_sb_t *sbp)</span>
<span class="cm"> *	((xfs_sb_version_hasmorebits(sbp) &amp;&amp;</span>
<span class="cm"> *	 ((sbp)-&gt;sb_features2 &amp; XFS_SB_VERSION2_FUNBIT)</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_haslazysbcount</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">xfs_sb_version_hasmorebits</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_features2</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION2_LAZYSBCOUNTBIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasattr2</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">xfs_sb_version_hasmorebits</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_features2</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION2_ATTR2BIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">xfs_sb_version_addattr2</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">|=</span> <span class="n">XFS_SB_VERSION_MOREBITSBIT</span><span class="p">;</span>
	<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_features2</span> <span class="o">|=</span> <span class="n">XFS_SB_VERSION2_ATTR2BIT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">xfs_sb_version_removeattr2</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_features2</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">XFS_SB_VERSION2_ATTR2BIT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_features2</span><span class="p">)</span>
		<span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_versionnum</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">XFS_SB_VERSION_MOREBITSBIT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">xfs_sb_version_hasprojid32bit</span><span class="p">(</span><span class="n">xfs_sb_t</span> <span class="o">*</span><span class="n">sbp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">xfs_sb_version_hasmorebits</span><span class="p">(</span><span class="n">sbp</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">sbp</span><span class="o">-&gt;</span><span class="n">sb_features2</span> <span class="o">&amp;</span> <span class="n">XFS_SB_VERSION2_PROJID32BIT</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * end of superblock version macros</span>
<span class="cm"> */</span>

<span class="cp">#define XFS_SB_DADDR		((xfs_daddr_t)0) </span><span class="cm">/* daddr in filesystem/ag */</span><span class="cp"></span>
<span class="cp">#define	XFS_SB_BLOCK(mp)	XFS_HDR_BLOCK(mp, XFS_SB_DADDR)</span>
<span class="cp">#define XFS_BUF_TO_SBP(bp)	((xfs_dsb_t *)((bp)-&gt;b_addr))</span>

<span class="cp">#define	XFS_HDR_BLOCK(mp,d)	((xfs_agblock_t)XFS_BB_TO_FSBT(mp,d))</span>
<span class="cp">#define	XFS_DADDR_TO_FSB(mp,d)	XFS_AGB_TO_FSB(mp, \</span>
<span class="cp">			xfs_daddr_to_agno(mp,d), xfs_daddr_to_agbno(mp,d))</span>
<span class="cp">#define	XFS_FSB_TO_DADDR(mp,fsbno)	XFS_AGB_TO_DADDR(mp, \</span>
<span class="cp">			XFS_FSB_TO_AGNO(mp,fsbno), XFS_FSB_TO_AGBNO(mp,fsbno))</span>

<span class="cm">/*</span>
<span class="cm"> * File system sector to basic block conversions.</span>
<span class="cm"> */</span>
<span class="cp">#define XFS_FSS_TO_BB(mp,sec)	((sec) &lt;&lt; (mp)-&gt;m_sectbb_log)</span>

<span class="cm">/*</span>
<span class="cm"> * File system block to basic block conversions.</span>
<span class="cm"> */</span>
<span class="cp">#define	XFS_FSB_TO_BB(mp,fsbno)	((fsbno) &lt;&lt; (mp)-&gt;m_blkbb_log)</span>
<span class="cp">#define	XFS_BB_TO_FSB(mp,bb)	\</span>
<span class="cp">	(((bb) + (XFS_FSB_TO_BB(mp,1) - 1)) &gt;&gt; (mp)-&gt;m_blkbb_log)</span>
<span class="cp">#define	XFS_BB_TO_FSBT(mp,bb)	((bb) &gt;&gt; (mp)-&gt;m_blkbb_log)</span>

<span class="cm">/*</span>
<span class="cm"> * File system block to byte conversions.</span>
<span class="cm"> */</span>
<span class="cp">#define XFS_FSB_TO_B(mp,fsbno)	((xfs_fsize_t)(fsbno) &lt;&lt; (mp)-&gt;m_sb.sb_blocklog)</span>
<span class="cp">#define XFS_B_TO_FSB(mp,b)	\</span>
<span class="cp">	((((__uint64_t)(b)) + (mp)-&gt;m_blockmask) &gt;&gt; (mp)-&gt;m_sb.sb_blocklog)</span>
<span class="cp">#define XFS_B_TO_FSBT(mp,b)	(((__uint64_t)(b)) &gt;&gt; (mp)-&gt;m_sb.sb_blocklog)</span>
<span class="cp">#define XFS_B_FSB_OFFSET(mp,b)	((b) &amp; (mp)-&gt;m_blockmask)</span>

<span class="cp">#endif	</span><span class="cm">/* __XFS_SB_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
