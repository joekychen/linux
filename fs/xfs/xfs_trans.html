<!DOCTYPE html>
<html><head><title>joekychen/linux » fs › xfs › xfs_trans.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>xfs_trans.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2000-2002,2005 Silicon Graphics, Inc.</span>
<span class="cm"> * All Rights Reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it would be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write the Free Software Foundation,</span>
<span class="cm"> * Inc.,  51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<span class="cm"> */</span>
<span class="cp">#ifndef	__XFS_TRANS_H__</span>
<span class="cp">#define	__XFS_TRANS_H__</span>

<span class="k">struct</span> <span class="n">xfs_log_item</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * This is the structure written in the log at the head of</span>
<span class="cm"> * every transaction. It identifies the type and id of the</span>
<span class="cm"> * transaction, and contains the number of items logged by</span>
<span class="cm"> * the transaction so we know how many to expect during recovery.</span>
<span class="cm"> *</span>
<span class="cm"> * Do not change the below structure without redoing the code in</span>
<span class="cm"> * xlog_recover_add_to_trans() and xlog_recover_add_to_cont_trans().</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">xfs_trans_header</span> <span class="p">{</span>
	<span class="n">uint</span>		<span class="n">th_magic</span><span class="p">;</span>		<span class="cm">/* magic number */</span>
	<span class="n">uint</span>		<span class="n">th_type</span><span class="p">;</span>		<span class="cm">/* transaction type */</span>
	<span class="n">__int32_t</span>	<span class="n">th_tid</span><span class="p">;</span>			<span class="cm">/* transaction id (unused) */</span>
	<span class="n">uint</span>		<span class="n">th_num_items</span><span class="p">;</span>		<span class="cm">/* num items logged by trans */</span>
<span class="p">}</span> <span class="n">xfs_trans_header_t</span><span class="p">;</span>

<span class="cp">#define	XFS_TRANS_HEADER_MAGIC	0x5452414e	</span><span class="cm">/* TRAN */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Log item types.</span>
<span class="cm"> */</span>
<span class="cp">#define	XFS_LI_EFI		0x1236</span>
<span class="cp">#define	XFS_LI_EFD		0x1237</span>
<span class="cp">#define	XFS_LI_IUNLINK		0x1238</span>
<span class="cp">#define	XFS_LI_INODE		0x123b	</span><span class="cm">/* aligned ino chunks, var-size ibufs */</span><span class="cp"></span>
<span class="cp">#define	XFS_LI_BUF		0x123c	</span><span class="cm">/* v2 bufs, variable sized inode bufs */</span><span class="cp"></span>
<span class="cp">#define	XFS_LI_DQUOT		0x123d</span>
<span class="cp">#define	XFS_LI_QUOTAOFF		0x123e</span>

<span class="cp">#define XFS_LI_TYPE_DESC \</span>
<span class="cp">	{ XFS_LI_EFI,		&quot;XFS_LI_EFI&quot; }, \</span>
<span class="cp">	{ XFS_LI_EFD,		&quot;XFS_LI_EFD&quot; }, \</span>
<span class="cp">	{ XFS_LI_IUNLINK,	&quot;XFS_LI_IUNLINK&quot; }, \</span>
<span class="cp">	{ XFS_LI_INODE,		&quot;XFS_LI_INODE&quot; }, \</span>
<span class="cp">	{ XFS_LI_BUF,		&quot;XFS_LI_BUF&quot; }, \</span>
<span class="cp">	{ XFS_LI_DQUOT,		&quot;XFS_LI_DQUOT&quot; }, \</span>
<span class="cp">	{ XFS_LI_QUOTAOFF,	&quot;XFS_LI_QUOTAOFF&quot; }</span>

<span class="cm">/*</span>
<span class="cm"> * Transaction types.  Used to distinguish types of buffers.</span>
<span class="cm"> */</span>
<span class="cp">#define XFS_TRANS_SETATTR_NOT_SIZE	1</span>
<span class="cp">#define XFS_TRANS_SETATTR_SIZE		2</span>
<span class="cp">#define XFS_TRANS_INACTIVE		3</span>
<span class="cp">#define XFS_TRANS_CREATE		4</span>
<span class="cp">#define XFS_TRANS_CREATE_TRUNC		5</span>
<span class="cp">#define XFS_TRANS_TRUNCATE_FILE		6</span>
<span class="cp">#define XFS_TRANS_REMOVE		7</span>
<span class="cp">#define XFS_TRANS_LINK			8</span>
<span class="cp">#define XFS_TRANS_RENAME		9</span>
<span class="cp">#define XFS_TRANS_MKDIR			10</span>
<span class="cp">#define XFS_TRANS_RMDIR			11</span>
<span class="cp">#define XFS_TRANS_SYMLINK		12</span>
<span class="cp">#define XFS_TRANS_SET_DMATTRS		13</span>
<span class="cp">#define XFS_TRANS_GROWFS		14</span>
<span class="cp">#define XFS_TRANS_STRAT_WRITE		15</span>
<span class="cp">#define XFS_TRANS_DIOSTRAT		16</span>
<span class="cm">/* 17 was XFS_TRANS_WRITE_SYNC */</span>
<span class="cp">#define	XFS_TRANS_WRITEID		18</span>
<span class="cp">#define	XFS_TRANS_ADDAFORK		19</span>
<span class="cp">#define	XFS_TRANS_ATTRINVAL		20</span>
<span class="cp">#define	XFS_TRANS_ATRUNCATE		21</span>
<span class="cp">#define	XFS_TRANS_ATTR_SET		22</span>
<span class="cp">#define	XFS_TRANS_ATTR_RM		23</span>
<span class="cp">#define	XFS_TRANS_ATTR_FLAG		24</span>
<span class="cp">#define	XFS_TRANS_CLEAR_AGI_BUCKET	25</span>
<span class="cp">#define XFS_TRANS_QM_SBCHANGE		26</span>
<span class="cm">/*</span>
<span class="cm"> * Dummy entries since we use the transaction type to index into the</span>
<span class="cm"> * trans_type[] in xlog_recover_print_trans_head()</span>
<span class="cm"> */</span>
<span class="cp">#define XFS_TRANS_DUMMY1		27</span>
<span class="cp">#define XFS_TRANS_DUMMY2		28</span>
<span class="cp">#define XFS_TRANS_QM_QUOTAOFF		29</span>
<span class="cp">#define XFS_TRANS_QM_DQALLOC		30</span>
<span class="cp">#define XFS_TRANS_QM_SETQLIM		31</span>
<span class="cp">#define XFS_TRANS_QM_DQCLUSTER		32</span>
<span class="cp">#define XFS_TRANS_QM_QINOCREATE		33</span>
<span class="cp">#define XFS_TRANS_QM_QUOTAOFF_END	34</span>
<span class="cp">#define XFS_TRANS_SB_UNIT		35</span>
<span class="cp">#define XFS_TRANS_FSYNC_TS		36</span>
<span class="cp">#define	XFS_TRANS_GROWFSRT_ALLOC	37</span>
<span class="cp">#define	XFS_TRANS_GROWFSRT_ZERO		38</span>
<span class="cp">#define	XFS_TRANS_GROWFSRT_FREE		39</span>
<span class="cp">#define	XFS_TRANS_SWAPEXT		40</span>
<span class="cp">#define	XFS_TRANS_SB_COUNT		41</span>
<span class="cp">#define	XFS_TRANS_CHECKPOINT		42</span>
<span class="cp">#define	XFS_TRANS_TYPE_MAX		42</span>
<span class="cm">/* new transaction types need to be reflected in xfs_logprint(8) */</span>

<span class="cp">#define XFS_TRANS_TYPES \</span>
<span class="cp">	{ XFS_TRANS_SETATTR_NOT_SIZE,	&quot;SETATTR_NOT_SIZE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_SETATTR_SIZE,	&quot;SETATTR_SIZE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_INACTIVE,		&quot;INACTIVE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_CREATE,		&quot;CREATE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_CREATE_TRUNC,	&quot;CREATE_TRUNC&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_TRUNCATE_FILE,	&quot;TRUNCATE_FILE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_REMOVE,		&quot;REMOVE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_LINK,		&quot;LINK&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_RENAME,		&quot;RENAME&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_MKDIR,		&quot;MKDIR&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_RMDIR,		&quot;RMDIR&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_SYMLINK,		&quot;SYMLINK&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_SET_DMATTRS,	&quot;SET_DMATTRS&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_GROWFS,		&quot;GROWFS&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_STRAT_WRITE,	&quot;STRAT_WRITE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_DIOSTRAT,		&quot;DIOSTRAT&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_WRITEID,		&quot;WRITEID&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_ADDAFORK,		&quot;ADDAFORK&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_ATTRINVAL,		&quot;ATTRINVAL&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_ATRUNCATE,		&quot;ATRUNCATE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_ATTR_SET,		&quot;ATTR_SET&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_ATTR_RM,		&quot;ATTR_RM&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_ATTR_FLAG,		&quot;ATTR_FLAG&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_CLEAR_AGI_BUCKET,	&quot;CLEAR_AGI_BUCKET&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_QM_SBCHANGE,	&quot;QM_SBCHANGE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_QM_QUOTAOFF,	&quot;QM_QUOTAOFF&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_QM_DQALLOC,		&quot;QM_DQALLOC&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_QM_SETQLIM,		&quot;QM_SETQLIM&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_QM_DQCLUSTER,	&quot;QM_DQCLUSTER&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_QM_QINOCREATE,	&quot;QM_QINOCREATE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_QM_QUOTAOFF_END,	&quot;QM_QOFF_END&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_SB_UNIT,		&quot;SB_UNIT&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_FSYNC_TS,		&quot;FSYNC_TS&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_GROWFSRT_ALLOC,	&quot;GROWFSRT_ALLOC&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_GROWFSRT_ZERO,	&quot;GROWFSRT_ZERO&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_GROWFSRT_FREE,	&quot;GROWFSRT_FREE&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_SWAPEXT,		&quot;SWAPEXT&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_SB_COUNT,		&quot;SB_COUNT&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_CHECKPOINT,		&quot;CHECKPOINT&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_DUMMY1,		&quot;DUMMY1&quot; }, \</span>
<span class="cp">	{ XFS_TRANS_DUMMY2,		&quot;DUMMY2&quot; }, \</span>
<span class="cp">	{ XLOG_UNMOUNT_REC_TYPE,	&quot;UNMOUNT&quot; }</span>

<span class="cm">/*</span>
<span class="cm"> * This structure is used to track log items associated with</span>
<span class="cm"> * a transaction.  It points to the log item and keeps some</span>
<span class="cm"> * flags to track the state of the log item.  It also tracks</span>
<span class="cm"> * the amount of space needed to log the item it describes</span>
<span class="cm"> * once we get to commit processing (see xfs_trans_commit()).</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">xfs_log_item_desc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">xfs_log_item</span>	<span class="o">*</span><span class="n">lid_item</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">lid_trans</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">lid_flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define XFS_LID_DIRTY		0x1</span>

<span class="cp">#define	XFS_TRANS_MAGIC		0x5452414E	</span><span class="cm">/* &#39;TRAN&#39; */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm"> * Values for t_flags.</span>
<span class="cm"> */</span>
<span class="cp">#define	XFS_TRANS_DIRTY		0x01	</span><span class="cm">/* something needs to be logged */</span><span class="cp"></span>
<span class="cp">#define	XFS_TRANS_SB_DIRTY	0x02	</span><span class="cm">/* superblock is modified */</span><span class="cp"></span>
<span class="cp">#define	XFS_TRANS_PERM_LOG_RES	0x04	</span><span class="cm">/* xact took a permanent log res */</span><span class="cp"></span>
<span class="cp">#define	XFS_TRANS_SYNC		0x08	</span><span class="cm">/* make commit synchronous */</span><span class="cp"></span>
<span class="cp">#define XFS_TRANS_DQ_DIRTY	0x10	</span><span class="cm">/* at least one dquot in trx dirty */</span><span class="cp"></span>
<span class="cp">#define XFS_TRANS_RESERVE	0x20    </span><span class="cm">/* OK to use reserved data blocks */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Values for call flags parameter.</span>
<span class="cm"> */</span>
<span class="cp">#define	XFS_TRANS_RELEASE_LOG_RES	0x4</span>
<span class="cp">#define	XFS_TRANS_ABORT			0x8</span>

<span class="cm">/*</span>
<span class="cm"> * Field values for xfs_trans_mod_sb.</span>
<span class="cm"> */</span>
<span class="cp">#define	XFS_TRANS_SB_ICOUNT		0x00000001</span>
<span class="cp">#define	XFS_TRANS_SB_IFREE		0x00000002</span>
<span class="cp">#define	XFS_TRANS_SB_FDBLOCKS		0x00000004</span>
<span class="cp">#define	XFS_TRANS_SB_RES_FDBLOCKS	0x00000008</span>
<span class="cp">#define	XFS_TRANS_SB_FREXTENTS		0x00000010</span>
<span class="cp">#define	XFS_TRANS_SB_RES_FREXTENTS	0x00000020</span>
<span class="cp">#define	XFS_TRANS_SB_DBLOCKS		0x00000040</span>
<span class="cp">#define	XFS_TRANS_SB_AGCOUNT		0x00000080</span>
<span class="cp">#define	XFS_TRANS_SB_IMAXPCT		0x00000100</span>
<span class="cp">#define	XFS_TRANS_SB_REXTSIZE		0x00000200</span>
<span class="cp">#define	XFS_TRANS_SB_RBMBLOCKS		0x00000400</span>
<span class="cp">#define	XFS_TRANS_SB_RBLOCKS		0x00000800</span>
<span class="cp">#define	XFS_TRANS_SB_REXTENTS		0x00001000</span>
<span class="cp">#define	XFS_TRANS_SB_REXTSLOG		0x00002000</span>


<span class="cm">/*</span>
<span class="cm"> * Per-extent log reservation for the allocation btree changes</span>
<span class="cm"> * involved in freeing or allocating an extent.</span>
<span class="cm"> * 2 trees * (2 blocks/level * max depth - 1) * block size</span>
<span class="cm"> */</span>
<span class="cp">#define	XFS_ALLOCFREE_LOG_RES(mp,nx) \</span>
<span class="cp">	((nx) * (2 * XFS_FSB_TO_B((mp), 2 * XFS_AG_MAXLEVELS(mp) - 1)))</span>
<span class="cp">#define	XFS_ALLOCFREE_LOG_COUNT(mp,nx) \</span>
<span class="cp">	((nx) * (2 * (2 * XFS_AG_MAXLEVELS(mp) - 1)))</span>

<span class="cm">/*</span>
<span class="cm"> * Per-directory log reservation for any directory change.</span>
<span class="cm"> * dir blocks: (1 btree block per level + data block + free block) * dblock size</span>
<span class="cm"> * bmap btree: (levels + 2) * max depth * block size</span>
<span class="cm"> * v2 directory blocks can be fragmented below the dirblksize down to the fsb</span>
<span class="cm"> * size, so account for that in the DAENTER macros.</span>
<span class="cm"> */</span>
<span class="cp">#define	XFS_DIROP_LOG_RES(mp)	\</span>
<span class="cp">	(XFS_FSB_TO_B(mp, XFS_DAENTER_BLOCKS(mp, XFS_DATA_FORK)) + \</span>
<span class="cp">	 (XFS_FSB_TO_B(mp, XFS_DAENTER_BMAPS(mp, XFS_DATA_FORK) + 1)))</span>
<span class="cp">#define	XFS_DIROP_LOG_COUNT(mp)	\</span>
<span class="cp">	(XFS_DAENTER_BLOCKS(mp, XFS_DATA_FORK) + \</span>
<span class="cp">	 XFS_DAENTER_BMAPS(mp, XFS_DATA_FORK) + 1)</span>


<span class="cp">#define	XFS_WRITE_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_write)</span>
<span class="cp">#define	XFS_ITRUNCATE_LOG_RES(mp)   ((mp)-&gt;m_reservations.tr_itruncate)</span>
<span class="cp">#define	XFS_RENAME_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_rename)</span>
<span class="cp">#define	XFS_LINK_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_link)</span>
<span class="cp">#define	XFS_REMOVE_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_remove)</span>
<span class="cp">#define	XFS_SYMLINK_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_symlink)</span>
<span class="cp">#define	XFS_CREATE_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_create)</span>
<span class="cp">#define	XFS_MKDIR_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_mkdir)</span>
<span class="cp">#define	XFS_IFREE_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_ifree)</span>
<span class="cp">#define	XFS_ICHANGE_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_ichange)</span>
<span class="cp">#define	XFS_GROWDATA_LOG_RES(mp)    ((mp)-&gt;m_reservations.tr_growdata)</span>
<span class="cp">#define	XFS_GROWRTALLOC_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_growrtalloc)</span>
<span class="cp">#define	XFS_GROWRTZERO_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_growrtzero)</span>
<span class="cp">#define	XFS_GROWRTFREE_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_growrtfree)</span>
<span class="cp">#define	XFS_SWRITE_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_swrite)</span>
<span class="cm">/*</span>
<span class="cm"> * Logging the inode timestamps on an fsync -- same as SWRITE</span>
<span class="cm"> * as long as SWRITE logs the entire inode core</span>
<span class="cm"> */</span>
<span class="cp">#define XFS_FSYNC_TS_LOG_RES(mp)        ((mp)-&gt;m_reservations.tr_swrite)</span>
<span class="cp">#define	XFS_WRITEID_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_swrite)</span>
<span class="cp">#define	XFS_ADDAFORK_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_addafork)</span>
<span class="cp">#define	XFS_ATTRINVAL_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_attrinval)</span>
<span class="cp">#define	XFS_ATTRSET_LOG_RES(mp, ext)	\</span>
<span class="cp">	((mp)-&gt;m_reservations.tr_attrset + \</span>
<span class="cp">	 (ext * (mp)-&gt;m_sb.sb_sectsize) + \</span>
<span class="cp">	 (ext * XFS_FSB_TO_B((mp), XFS_BM_MAXLEVELS(mp, XFS_ATTR_FORK))) + \</span>
<span class="cp">	 (128 * (ext + (ext * XFS_BM_MAXLEVELS(mp, XFS_ATTR_FORK)))))</span>
<span class="cp">#define	XFS_ATTRRM_LOG_RES(mp)	((mp)-&gt;m_reservations.tr_attrrm)</span>
<span class="cp">#define	XFS_CLEAR_AGI_BUCKET_LOG_RES(mp)  ((mp)-&gt;m_reservations.tr_clearagi)</span>


<span class="cm">/*</span>
<span class="cm"> * Various log count values.</span>
<span class="cm"> */</span>
<span class="cp">#define	XFS_DEFAULT_LOG_COUNT		1</span>
<span class="cp">#define	XFS_DEFAULT_PERM_LOG_COUNT	2</span>
<span class="cp">#define	XFS_ITRUNCATE_LOG_COUNT		2</span>
<span class="cp">#define XFS_INACTIVE_LOG_COUNT		2</span>
<span class="cp">#define	XFS_CREATE_LOG_COUNT		2</span>
<span class="cp">#define	XFS_MKDIR_LOG_COUNT		3</span>
<span class="cp">#define	XFS_SYMLINK_LOG_COUNT		3</span>
<span class="cp">#define	XFS_REMOVE_LOG_COUNT		2</span>
<span class="cp">#define	XFS_LINK_LOG_COUNT		2</span>
<span class="cp">#define	XFS_RENAME_LOG_COUNT		2</span>
<span class="cp">#define	XFS_WRITE_LOG_COUNT		2</span>
<span class="cp">#define	XFS_ADDAFORK_LOG_COUNT		2</span>
<span class="cp">#define	XFS_ATTRINVAL_LOG_COUNT		1</span>
<span class="cp">#define	XFS_ATTRSET_LOG_COUNT		3</span>
<span class="cp">#define	XFS_ATTRRM_LOG_COUNT		3</span>

<span class="cm">/*</span>
<span class="cm"> * Here we centralize the specification of XFS meta-data buffer</span>
<span class="cm"> * reference count values.  This determine how hard the buffer</span>
<span class="cm"> * cache tries to hold onto the buffer.</span>
<span class="cm"> */</span>
<span class="cp">#define	XFS_AGF_REF		4</span>
<span class="cp">#define	XFS_AGI_REF		4</span>
<span class="cp">#define	XFS_AGFL_REF		3</span>
<span class="cp">#define	XFS_INO_BTREE_REF	3</span>
<span class="cp">#define	XFS_ALLOC_BTREE_REF	2</span>
<span class="cp">#define	XFS_BMAP_BTREE_REF	2</span>
<span class="cp">#define	XFS_DIR_BTREE_REF	2</span>
<span class="cp">#define	XFS_INO_REF		2</span>
<span class="cp">#define	XFS_ATTR_BTREE_REF	1</span>
<span class="cp">#define	XFS_DQUOT_REF		1</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="k">struct</span> <span class="n">xfs_buf</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_buftarg</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_efd_log_item</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_efi_log_item</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_inode</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_item_ops</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_log_iovec</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_log_item_desc</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_mount</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_trans</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_dquot_acct</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">xfs_busy_extent</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">xfs_log_item</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span>		<span class="n">li_ail</span><span class="p">;</span>		<span class="cm">/* AIL pointers */</span>
	<span class="n">xfs_lsn_t</span>			<span class="n">li_lsn</span><span class="p">;</span>		<span class="cm">/* last on-disk lsn */</span>
	<span class="k">struct</span> <span class="n">xfs_log_item_desc</span>	<span class="o">*</span><span class="n">li_desc</span><span class="p">;</span>	<span class="cm">/* ptr to current desc*/</span>
	<span class="k">struct</span> <span class="n">xfs_mount</span>		<span class="o">*</span><span class="n">li_mountp</span><span class="p">;</span>	<span class="cm">/* ptr to fs mount */</span>
	<span class="k">struct</span> <span class="n">xfs_ail</span>			<span class="o">*</span><span class="n">li_ailp</span><span class="p">;</span>	<span class="cm">/* ptr to AIL */</span>
	<span class="n">uint</span>				<span class="n">li_type</span><span class="p">;</span>	<span class="cm">/* item type */</span>
	<span class="n">uint</span>				<span class="n">li_flags</span><span class="p">;</span>	<span class="cm">/* misc flags */</span>
	<span class="k">struct</span> <span class="n">xfs_log_item</span>		<span class="o">*</span><span class="n">li_bio_list</span><span class="p">;</span>	<span class="cm">/* buffer item list */</span>
	<span class="kt">void</span>				<span class="p">(</span><span class="o">*</span><span class="n">li_cb</span><span class="p">)(</span><span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">,</span>
						 <span class="k">struct</span> <span class="n">xfs_log_item</span> <span class="o">*</span><span class="p">);</span>
							<span class="cm">/* buffer item iodone */</span>
							<span class="cm">/* callback func */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">xfs_item_ops</span>	<span class="o">*</span><span class="n">li_ops</span><span class="p">;</span>	<span class="cm">/* function list */</span>

	<span class="cm">/* delayed logging */</span>
	<span class="k">struct</span> <span class="n">list_head</span>		<span class="n">li_cil</span><span class="p">;</span>		<span class="cm">/* CIL pointers */</span>
	<span class="k">struct</span> <span class="n">xfs_log_vec</span>		<span class="o">*</span><span class="n">li_lv</span><span class="p">;</span>		<span class="cm">/* active log vector */</span>
	<span class="n">xfs_lsn_t</span>			<span class="n">li_seq</span><span class="p">;</span>		<span class="cm">/* CIL commit seq */</span>
<span class="p">}</span> <span class="n">xfs_log_item_t</span><span class="p">;</span>

<span class="cp">#define	XFS_LI_IN_AIL	0x1</span>
<span class="cp">#define XFS_LI_ABORTED	0x2</span>

<span class="cp">#define XFS_LI_FLAGS \</span>
<span class="cp">	{ XFS_LI_IN_AIL,	&quot;IN_AIL&quot; }, \</span>
<span class="cp">	{ XFS_LI_ABORTED,	&quot;ABORTED&quot; }</span>

<span class="k">struct</span> <span class="n">xfs_item_ops</span> <span class="p">{</span>
	<span class="n">uint</span> <span class="p">(</span><span class="o">*</span><span class="n">iop_size</span><span class="p">)(</span><span class="n">xfs_log_item_t</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">iop_format</span><span class="p">)(</span><span class="n">xfs_log_item_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_log_iovec</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">iop_pin</span><span class="p">)(</span><span class="n">xfs_log_item_t</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">iop_unpin</span><span class="p">)(</span><span class="n">xfs_log_item_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="n">remove</span><span class="p">);</span>
	<span class="n">uint</span> <span class="p">(</span><span class="o">*</span><span class="n">iop_push</span><span class="p">)(</span><span class="k">struct</span> <span class="n">xfs_log_item</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">iop_unlock</span><span class="p">)(</span><span class="n">xfs_log_item_t</span> <span class="o">*</span><span class="p">);</span>
	<span class="n">xfs_lsn_t</span> <span class="p">(</span><span class="o">*</span><span class="n">iop_committed</span><span class="p">)(</span><span class="n">xfs_log_item_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">xfs_lsn_t</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">iop_committing</span><span class="p">)(</span><span class="n">xfs_log_item_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">xfs_lsn_t</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#define IOP_SIZE(ip)		(*(ip)-&gt;li_ops-&gt;iop_size)(ip)</span>
<span class="cp">#define IOP_FORMAT(ip,vp)	(*(ip)-&gt;li_ops-&gt;iop_format)(ip, vp)</span>
<span class="cp">#define IOP_PIN(ip)		(*(ip)-&gt;li_ops-&gt;iop_pin)(ip)</span>
<span class="cp">#define IOP_UNPIN(ip, remove)	(*(ip)-&gt;li_ops-&gt;iop_unpin)(ip, remove)</span>
<span class="cp">#define IOP_PUSH(ip, list)	(*(ip)-&gt;li_ops-&gt;iop_push)(ip, list)</span>
<span class="cp">#define IOP_UNLOCK(ip)		(*(ip)-&gt;li_ops-&gt;iop_unlock)(ip)</span>
<span class="cp">#define IOP_COMMITTED(ip, lsn)	(*(ip)-&gt;li_ops-&gt;iop_committed)(ip, lsn)</span>
<span class="cp">#define IOP_COMMITTING(ip, lsn) (*(ip)-&gt;li_ops-&gt;iop_committing)(ip, lsn)</span>

<span class="cm">/*</span>
<span class="cm"> * Return values for the IOP_PUSH() routines.</span>
<span class="cm"> */</span>
<span class="cp">#define XFS_ITEM_SUCCESS	0</span>
<span class="cp">#define XFS_ITEM_PINNED		1</span>
<span class="cp">#define XFS_ITEM_LOCKED		2</span>
<span class="cp">#define XFS_ITEM_FLUSHING	3</span>

<span class="cm">/*</span>
<span class="cm"> * This is the type of function which can be given to xfs_trans_callback()</span>
<span class="cm"> * to be called upon the transaction&#39;s commit to disk.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">xfs_trans_callback_t</span><span class="p">)(</span><span class="k">struct</span> <span class="n">xfs_trans</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * This is the structure maintained for every active transaction.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">xfs_trans</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_magic</span><span class="p">;</span>	<span class="cm">/* magic number */</span>
	<span class="n">xfs_log_callback_t</span>	<span class="n">t_logcb</span><span class="p">;</span>	<span class="cm">/* log callback struct */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_type</span><span class="p">;</span>		<span class="cm">/* transaction type */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_log_res</span><span class="p">;</span>	<span class="cm">/* amt of log space resvd */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_log_count</span><span class="p">;</span>	<span class="cm">/* count for perm log res */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_blk_res</span><span class="p">;</span>	<span class="cm">/* # of blocks resvd */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_blk_res_used</span><span class="p">;</span>	<span class="cm">/* # of resvd blocks used */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_rtx_res</span><span class="p">;</span>	<span class="cm">/* # of rt extents resvd */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_rtx_res_used</span><span class="p">;</span>	<span class="cm">/* # of resvd rt extents used */</span>
	<span class="k">struct</span> <span class="n">xlog_ticket</span>	<span class="o">*</span><span class="n">t_ticket</span><span class="p">;</span>	<span class="cm">/* log mgr ticket */</span>
	<span class="n">xfs_lsn_t</span>		<span class="n">t_lsn</span><span class="p">;</span>		<span class="cm">/* log seq num of start of</span>
<span class="cm">						 * transaction. */</span>
	<span class="n">xfs_lsn_t</span>		<span class="n">t_commit_lsn</span><span class="p">;</span>	<span class="cm">/* log seq num of end of</span>
<span class="cm">						 * transaction. */</span>
	<span class="k">struct</span> <span class="n">xfs_mount</span>	<span class="o">*</span><span class="n">t_mountp</span><span class="p">;</span>	<span class="cm">/* ptr to fs mount struct */</span>
	<span class="k">struct</span> <span class="n">xfs_dquot_acct</span>   <span class="o">*</span><span class="n">t_dqinfo</span><span class="p">;</span>	<span class="cm">/* acctg info for dquots */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">t_flags</span><span class="p">;</span>	<span class="cm">/* misc flags */</span>
	<span class="kt">int64_t</span>			<span class="n">t_icount_delta</span><span class="p">;</span>	<span class="cm">/* superblock icount change */</span>
	<span class="kt">int64_t</span>			<span class="n">t_ifree_delta</span><span class="p">;</span>	<span class="cm">/* superblock ifree change */</span>
	<span class="kt">int64_t</span>			<span class="n">t_fdblocks_delta</span><span class="p">;</span> <span class="cm">/* superblock fdblocks chg */</span>
	<span class="kt">int64_t</span>			<span class="n">t_res_fdblocks_delta</span><span class="p">;</span> <span class="cm">/* on-disk only chg */</span>
	<span class="kt">int64_t</span>			<span class="n">t_frextents_delta</span><span class="p">;</span><span class="cm">/* superblock freextents chg*/</span>
	<span class="kt">int64_t</span>			<span class="n">t_res_frextents_delta</span><span class="p">;</span> <span class="cm">/* on-disk only chg */</span>
<span class="cp">#ifdef DEBUG</span>
	<span class="kt">int64_t</span>			<span class="n">t_ag_freeblks_delta</span><span class="p">;</span> <span class="cm">/* debugging counter */</span>
	<span class="kt">int64_t</span>			<span class="n">t_ag_flist_delta</span><span class="p">;</span> <span class="cm">/* debugging counter */</span>
	<span class="kt">int64_t</span>			<span class="n">t_ag_btree_delta</span><span class="p">;</span> <span class="cm">/* debugging counter */</span>
<span class="cp">#endif</span>
	<span class="kt">int64_t</span>			<span class="n">t_dblocks_delta</span><span class="p">;</span><span class="cm">/* superblock dblocks change */</span>
	<span class="kt">int64_t</span>			<span class="n">t_agcount_delta</span><span class="p">;</span><span class="cm">/* superblock agcount change */</span>
	<span class="kt">int64_t</span>			<span class="n">t_imaxpct_delta</span><span class="p">;</span><span class="cm">/* superblock imaxpct change */</span>
	<span class="kt">int64_t</span>			<span class="n">t_rextsize_delta</span><span class="p">;</span><span class="cm">/* superblock rextsize chg */</span>
	<span class="kt">int64_t</span>			<span class="n">t_rbmblocks_delta</span><span class="p">;</span><span class="cm">/* superblock rbmblocks chg */</span>
	<span class="kt">int64_t</span>			<span class="n">t_rblocks_delta</span><span class="p">;</span><span class="cm">/* superblock rblocks change */</span>
	<span class="kt">int64_t</span>			<span class="n">t_rextents_delta</span><span class="p">;</span><span class="cm">/* superblocks rextents chg */</span>
	<span class="kt">int64_t</span>			<span class="n">t_rextslog_delta</span><span class="p">;</span><span class="cm">/* superblocks rextslog chg */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">t_items</span><span class="p">;</span>	<span class="cm">/* log item descriptors */</span>
	<span class="n">xfs_trans_header_t</span>	<span class="n">t_header</span><span class="p">;</span>	<span class="cm">/* header for in-log trans */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">t_busy</span><span class="p">;</span>		<span class="cm">/* list of busy extents */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">t_pflags</span><span class="p">;</span>	<span class="cm">/* saved process flags state */</span>
<span class="p">}</span> <span class="n">xfs_trans_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * XFS transaction mechanism exported interfaces that are</span>
<span class="cm"> * actually macros.</span>
<span class="cm"> */</span>
<span class="cp">#define	xfs_trans_get_log_res(tp)	((tp)-&gt;t_log_res)</span>
<span class="cp">#define	xfs_trans_get_log_count(tp)	((tp)-&gt;t_log_count)</span>
<span class="cp">#define	xfs_trans_get_block_res(tp)	((tp)-&gt;t_blk_res)</span>
<span class="cp">#define	xfs_trans_set_sync(tp)		((tp)-&gt;t_flags |= XFS_TRANS_SYNC)</span>

<span class="cp">#ifdef DEBUG</span>
<span class="cp">#define	xfs_trans_agblocks_delta(tp, d)	((tp)-&gt;t_ag_freeblks_delta += (int64_t)d)</span>
<span class="cp">#define	xfs_trans_agflist_delta(tp, d)	((tp)-&gt;t_ag_flist_delta += (int64_t)d)</span>
<span class="cp">#define	xfs_trans_agbtree_delta(tp, d)	((tp)-&gt;t_ag_btree_delta += (int64_t)d)</span>
<span class="cp">#else</span>
<span class="cp">#define	xfs_trans_agblocks_delta(tp, d)</span>
<span class="cp">#define	xfs_trans_agflist_delta(tp, d)</span>
<span class="cp">#define	xfs_trans_agbtree_delta(tp, d)</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * XFS transaction mechanism exported interfaces.</span>
<span class="cm"> */</span>
<span class="n">xfs_trans_t</span>	<span class="o">*</span><span class="n">xfs_trans_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfs_mount</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">);</span>
<span class="n">xfs_trans_t</span>	<span class="o">*</span><span class="n">_xfs_trans_alloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfs_mount</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span> <span class="n">xfs_km_flags_t</span><span class="p">);</span>
<span class="n">xfs_trans_t</span>	<span class="o">*</span><span class="n">xfs_trans_dup</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">xfs_trans_reserve</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span>
				  <span class="n">uint</span><span class="p">,</span> <span class="n">uint</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_mod_sb</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span> <span class="kt">int64_t</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">xfs_buf</span>	<span class="o">*</span><span class="n">xfs_trans_get_buf</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buftarg</span> <span class="o">*</span><span class="p">,</span> <span class="n">xfs_daddr_t</span><span class="p">,</span>
				   <span class="kt">int</span><span class="p">,</span> <span class="n">uint</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">xfs_trans_read_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfs_mount</span> <span class="o">*</span><span class="p">,</span> <span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">xfs_buftarg</span> <span class="o">*</span><span class="p">,</span> <span class="n">xfs_daddr_t</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">**</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">xfs_buf</span>	<span class="o">*</span><span class="n">xfs_trans_getsb</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_mount</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

<span class="kt">void</span>		<span class="n">xfs_trans_brelse</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_bjoin</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_bhold</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_bhold_release</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_binval</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_inode_buf</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_stale_inode_buf</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_dquot_buf</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_inode_alloc_buf</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_ichgtime</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfs_trans</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_inode</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_ijoin</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfs_trans</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_inode</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_log_buf</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_buf</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span> <span class="n">uint</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_log_inode</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_inode</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">xfs_efi_log_item</span>	<span class="o">*</span><span class="n">xfs_trans_get_efi</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_efi_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfs_efi_log_item</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_log_efi_extent</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">xfs_efi_log_item</span> <span class="o">*</span><span class="p">,</span>
					 <span class="n">xfs_fsblock_t</span><span class="p">,</span>
					 <span class="n">xfs_extlen_t</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">xfs_efd_log_item</span>	<span class="o">*</span><span class="n">xfs_trans_get_efd</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">xfs_efi_log_item</span> <span class="o">*</span><span class="p">,</span>
				  <span class="n">uint</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_log_efd_extent</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">xfs_efd_log_item</span> <span class="o">*</span><span class="p">,</span>
					 <span class="n">xfs_fsblock_t</span><span class="p">,</span>
					 <span class="n">xfs_extlen_t</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">xfs_trans_commit</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span> <span class="n">flags</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_cancel</span><span class="p">(</span><span class="n">xfs_trans_t</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">xfs_trans_ail_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfs_mount</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span>		<span class="n">xfs_trans_ail_destroy</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfs_mount</span> <span class="o">*</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">kmem_zone_t</span>	<span class="o">*</span><span class="n">xfs_trans_zone</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">kmem_zone_t</span>	<span class="o">*</span><span class="n">xfs_log_item_desc_zone</span><span class="p">;</span>

<span class="cp">#endif	</span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="kt">void</span>		<span class="n">xfs_trans_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfs_mount</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span>		<span class="n">xfs_trans_roll</span><span class="p">(</span><span class="k">struct</span> <span class="n">xfs_trans</span> <span class="o">**</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xfs_inode</span> <span class="o">*</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* __XFS_TRANS_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
