f | inotify_user.c | s | 22K | 706 | Eric Paris | eparis@redhat.com | 1302042434 |  | inotify: fix double free/corruption of stuct user  On an error path in inotify_init1 a normal user can trigger a double free of struct user.  This is a regression introduced by a2ae4cc9a16e ("inotify: stop kernel memory leak on file creation failure").  We fix this by making sure that if a group exists the user reference is dropped when the group is cleaned up.  We should not explictly drop the reference on error and also drop the reference when the group is cleaned up.  The new lifetime rules are that an inotify group lives from inotify_new_group to the last fsnotify_put_group.  Since the struct user and inotify_devs are directly tied to this lifetime they are only changed/updated in those two locations.  We get rid of all special casing of struct user or user->inotify_devs.  Signed-off-by: Eric Paris <eparis@redhat.com> Cc: stable@kernel.org (2.6.37 and up) Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | Kconfig | g | 649B |  | Eric Paris | eparis@redhat.com | 1280325511 |  | inotify: remove inotify in kernel interface  nothing uses inotify in the kernel, drop it!  Signed-off-by: Eric Paris <eparis@redhat.com>
f | inotify.h | s | 597B | 16 | Eric Paris | eparis@redhat.com | 1280325534 |  | inotify: rename mark_entry to just mark  rename anything in inotify that deals with mark_entry to just be mark.  It makes a lot more sense.  Signed-off-by: Eric Paris <eparis@redhat.com>
f | Makefile | g | 64B |  | Eric Paris | eparis@redhat.com | 1280325511 |  | inotify: remove inotify in kernel interface  nothing uses inotify in the kernel, drop it!  Signed-off-by: Eric Paris <eparis@redhat.com>
f | inotify_fsnotify.c | s | 6.5K | 188 | Linus Torvalds | torvalds@linux-foundation.org | 1302200089 |  | Merge branch 'for-linus2' of git://git.profusion.mobi/users/lucas/linux-2.6  * 'for-linus2' of git://git.profusion.mobi/users/lucas/linux-2.6:   Fix common misspellings
