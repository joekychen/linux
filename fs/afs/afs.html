<!DOCTYPE html>
<html><head><title>joekychen/linux » fs › afs › afs.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>afs.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* AFS common types</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2002, 2007 Red Hat, Inc. All Rights Reserved.</span>
<span class="cm"> * Written by David Howells (dhowells@redhat.com)</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * as published by the Free Software Foundation; either version</span>
<span class="cm"> * 2 of the License, or (at your option) any later version.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef AFS_H</span>
<span class="cp">#define AFS_H</span>

<span class="cp">#include &lt;linux/in.h&gt;</span>

<span class="cp">#define AFS_MAXCELLNAME	64		</span><span class="cm">/* maximum length of a cell name */</span><span class="cp"></span>
<span class="cp">#define AFS_MAXVOLNAME	64		</span><span class="cm">/* maximum length of a volume name */</span><span class="cp"></span>
<span class="cp">#define AFSNAMEMAX	256		</span><span class="cm">/* maximum length of a filename plus NUL */</span><span class="cp"></span>
<span class="cp">#define AFSPATHMAX	1024		</span><span class="cm">/* maximum length of a pathname plus NUL */</span><span class="cp"></span>
<span class="cp">#define AFSOPAQUEMAX	1024		</span><span class="cm">/* maximum length of an opaque field */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="kt">unsigned</span>			<span class="n">afs_volid_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">unsigned</span>			<span class="n">afs_vnodeid_t</span><span class="p">;</span>
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span>		<span class="n">afs_dataversion_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">AFSVL_RWVOL</span><span class="p">,</span>			<span class="cm">/* read/write volume */</span>
	<span class="n">AFSVL_ROVOL</span><span class="p">,</span>			<span class="cm">/* read-only volume */</span>
	<span class="n">AFSVL_BACKVOL</span><span class="p">,</span>			<span class="cm">/* backup volume */</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">afs_voltype_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">AFS_FTYPE_INVALID</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">AFS_FTYPE_FILE</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">AFS_FTYPE_DIR</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">AFS_FTYPE_SYMLINK</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">}</span> <span class="n">afs_file_type_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">AFS_LOCK_READ</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* read lock request */</span>
	<span class="n">AFS_LOCK_WRITE</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* write lock request */</span>
<span class="p">}</span> <span class="n">afs_lock_type_t</span><span class="p">;</span>

<span class="cp">#define AFS_LOCKWAIT		(5 * 60) </span><span class="cm">/* time until a lock times out (seconds) */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * AFS file identifier</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">afs_fid</span> <span class="p">{</span>
	<span class="n">afs_volid_t</span>	<span class="n">vid</span><span class="p">;</span>		<span class="cm">/* volume ID */</span>
	<span class="n">afs_vnodeid_t</span>	<span class="n">vnode</span><span class="p">;</span>		<span class="cm">/* file index within volume */</span>
	<span class="kt">unsigned</span>	<span class="n">unique</span><span class="p">;</span>		<span class="cm">/* unique ID number (file index version) */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * AFS callback notification</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">AFSCM_CB_UNTYPED</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* no type set on CB break */</span>
	<span class="n">AFSCM_CB_EXCLUSIVE</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* CB exclusive to CM [not implemented] */</span>
	<span class="n">AFSCM_CB_SHARED</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* CB shared by other CM&#39;s */</span>
	<span class="n">AFSCM_CB_DROPPED</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>	<span class="cm">/* CB promise cancelled by file server */</span>
<span class="p">}</span> <span class="n">afs_callback_type_t</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">afs_callback</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">afs_fid</span>		<span class="n">fid</span><span class="p">;</span>		<span class="cm">/* file identifier */</span>
	<span class="kt">unsigned</span>		<span class="n">version</span><span class="p">;</span>	<span class="cm">/* callback version */</span>
	<span class="kt">unsigned</span>		<span class="n">expiry</span><span class="p">;</span>		<span class="cm">/* time at which expires */</span>
	<span class="n">afs_callback_type_t</span>	<span class="n">type</span><span class="p">;</span>		<span class="cm">/* type of callback */</span>
<span class="p">};</span>

<span class="cp">#define AFSCBMAX 50	</span><span class="cm">/* maximum callbacks transferred per bulk op */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * AFS volume information</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">afs_volume_info</span> <span class="p">{</span>
	<span class="n">afs_volid_t</span>		<span class="n">vid</span><span class="p">;</span>		<span class="cm">/* volume ID */</span>
	<span class="n">afs_voltype_t</span>		<span class="n">type</span><span class="p">;</span>		<span class="cm">/* type of this volume */</span>
	<span class="n">afs_volid_t</span>		<span class="n">type_vids</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>	<span class="cm">/* volume ID&#39;s for possible types for this vol */</span>

	<span class="cm">/* list of fileservers serving this volume */</span>
	<span class="kt">size_t</span>			<span class="n">nservers</span><span class="p">;</span>	<span class="cm">/* number of entries used in servers[] */</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">in_addr</span>	<span class="n">addr</span><span class="p">;</span>		<span class="cm">/* fileserver address */</span>
	<span class="p">}</span> <span class="n">servers</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * AFS security ACE access mask</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="n">u32</span> <span class="n">afs_access_t</span><span class="p">;</span>
<span class="cp">#define AFS_ACE_READ		0x00000001U	</span><span class="cm">/* - permission to read a file/dir */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_WRITE		0x00000002U	</span><span class="cm">/* - permission to write/chmod a file */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_INSERT		0x00000004U	</span><span class="cm">/* - permission to create dirent in a dir */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_LOOKUP		0x00000008U	</span><span class="cm">/* - permission to lookup a file/dir in a dir */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_DELETE		0x00000010U	</span><span class="cm">/* - permission to delete a dirent from a dir */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_LOCK		0x00000020U	</span><span class="cm">/* - permission to lock a file */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_ADMINISTER	0x00000040U	</span><span class="cm">/* - permission to change ACL */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_USER_A		0x01000000U	</span><span class="cm">/* - &#39;A&#39; user-defined permission */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_USER_B		0x02000000U	</span><span class="cm">/* - &#39;B&#39; user-defined permission */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_USER_C		0x04000000U	</span><span class="cm">/* - &#39;C&#39; user-defined permission */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_USER_D		0x08000000U	</span><span class="cm">/* - &#39;D&#39; user-defined permission */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_USER_E		0x10000000U	</span><span class="cm">/* - &#39;E&#39; user-defined permission */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_USER_F		0x20000000U	</span><span class="cm">/* - &#39;F&#39; user-defined permission */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_USER_G		0x40000000U	</span><span class="cm">/* - &#39;G&#39; user-defined permission */</span><span class="cp"></span>
<span class="cp">#define AFS_ACE_USER_H		0x80000000U	</span><span class="cm">/* - &#39;H&#39; user-defined permission */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * AFS file status information</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">afs_file_status</span> <span class="p">{</span>
	<span class="kt">unsigned</span>		<span class="n">if_version</span><span class="p">;</span>	<span class="cm">/* interface version */</span>
<span class="cp">#define AFS_FSTATUS_VERSION	1</span>

	<span class="n">afs_file_type_t</span>		<span class="n">type</span><span class="p">;</span>		<span class="cm">/* file type */</span>
	<span class="kt">unsigned</span>		<span class="n">nlink</span><span class="p">;</span>		<span class="cm">/* link count */</span>
	<span class="n">u64</span>			<span class="n">size</span><span class="p">;</span>		<span class="cm">/* file size */</span>
	<span class="n">afs_dataversion_t</span>	<span class="n">data_version</span><span class="p">;</span>	<span class="cm">/* current data version */</span>
	<span class="n">u32</span>			<span class="n">author</span><span class="p">;</span>		<span class="cm">/* author ID */</span>
	<span class="n">u32</span>			<span class="n">owner</span><span class="p">;</span>		<span class="cm">/* owner ID */</span>
	<span class="n">u32</span>			<span class="n">group</span><span class="p">;</span>		<span class="cm">/* group ID */</span>
	<span class="n">afs_access_t</span>		<span class="n">caller_access</span><span class="p">;</span>	<span class="cm">/* access rights for authenticated caller */</span>
	<span class="n">afs_access_t</span>		<span class="n">anon_access</span><span class="p">;</span>	<span class="cm">/* access rights for unauthenticated caller */</span>
	<span class="n">umode_t</span>			<span class="n">mode</span><span class="p">;</span>		<span class="cm">/* UNIX mode */</span>
	<span class="k">struct</span> <span class="n">afs_fid</span>		<span class="n">parent</span><span class="p">;</span>		<span class="cm">/* parent dir ID for non-dirs only */</span>
	<span class="kt">time_t</span>			<span class="n">mtime_client</span><span class="p">;</span>	<span class="cm">/* last time client changed data */</span>
	<span class="kt">time_t</span>			<span class="n">mtime_server</span><span class="p">;</span>	<span class="cm">/* last time server changed data */</span>
	<span class="n">s32</span>			<span class="n">lock_count</span><span class="p">;</span>	<span class="cm">/* file lock count (0=UNLK -1=WRLCK +ve=#RDLCK */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * AFS file status change request</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">afs_store_status</span> <span class="p">{</span>
	<span class="n">u32</span>			<span class="n">mask</span><span class="p">;</span>		<span class="cm">/* which bits of the struct are set */</span>
	<span class="n">u32</span>			<span class="n">mtime_client</span><span class="p">;</span>	<span class="cm">/* last time client changed data */</span>
	<span class="n">u32</span>			<span class="n">owner</span><span class="p">;</span>		<span class="cm">/* owner ID */</span>
	<span class="n">u32</span>			<span class="n">group</span><span class="p">;</span>		<span class="cm">/* group ID */</span>
	<span class="n">umode_t</span>			<span class="n">mode</span><span class="p">;</span>		<span class="cm">/* UNIX mode */</span>
<span class="p">};</span>

<span class="cp">#define AFS_SET_MTIME		0x01		</span><span class="cm">/* set the mtime */</span><span class="cp"></span>
<span class="cp">#define AFS_SET_OWNER		0x02		</span><span class="cm">/* set the owner ID */</span><span class="cp"></span>
<span class="cp">#define AFS_SET_GROUP		0x04		</span><span class="cm">/* set the group ID (unsupported?) */</span><span class="cp"></span>
<span class="cp">#define AFS_SET_MODE		0x08		</span><span class="cm">/* set the UNIX mode */</span><span class="cp"></span>
<span class="cp">#define AFS_SET_SEG_SIZE	0x10		</span><span class="cm">/* set the segment size (unsupported) */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * AFS volume synchronisation information</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">afs_volsync</span> <span class="p">{</span>
	<span class="kt">time_t</span>			<span class="n">creation</span><span class="p">;</span>	<span class="cm">/* volume creation time */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * AFS volume status record</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">afs_volume_status</span> <span class="p">{</span>
	<span class="n">u32</span>			<span class="n">vid</span><span class="p">;</span>		<span class="cm">/* volume ID */</span>
	<span class="n">u32</span>			<span class="n">parent_id</span><span class="p">;</span>	<span class="cm">/* parent volume ID */</span>
	<span class="n">u8</span>			<span class="n">online</span><span class="p">;</span>		<span class="cm">/* true if volume currently online and available */</span>
	<span class="n">u8</span>			<span class="n">in_service</span><span class="p">;</span>	<span class="cm">/* true if volume currently in service */</span>
	<span class="n">u8</span>			<span class="n">blessed</span><span class="p">;</span>	<span class="cm">/* same as in_service */</span>
	<span class="n">u8</span>			<span class="n">needs_salvage</span><span class="p">;</span>	<span class="cm">/* true if consistency checking required */</span>
	<span class="n">u32</span>			<span class="n">type</span><span class="p">;</span>		<span class="cm">/* volume type (afs_voltype_t) */</span>
	<span class="n">u32</span>			<span class="n">min_quota</span><span class="p">;</span>	<span class="cm">/* minimum space set aside (blocks) */</span>
	<span class="n">u32</span>			<span class="n">max_quota</span><span class="p">;</span>	<span class="cm">/* maximum space this volume may occupy (blocks) */</span>
	<span class="n">u32</span>			<span class="n">blocks_in_use</span><span class="p">;</span>	<span class="cm">/* space this volume currently occupies (blocks) */</span>
	<span class="n">u32</span>			<span class="n">part_blocks_avail</span><span class="p">;</span> <span class="cm">/* space available in volume&#39;s partition */</span>
	<span class="n">u32</span>			<span class="n">part_max_blocks</span><span class="p">;</span> <span class="cm">/* size of volume&#39;s partition */</span>
<span class="p">};</span>

<span class="cp">#define AFS_BLOCK_SIZE	1024</span>

<span class="cp">#endif </span><span class="cm">/* AFS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
