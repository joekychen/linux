<!DOCTYPE html>
<html><head><title>joekychen/linux » fs › nfsd › xdr4.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>xdr4.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  Server-side types for NFSv4.</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (c) 2002 The Regents of the University of Michigan.</span>
<span class="cm"> *  All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> *  Kendrick Smith &lt;kmsmith@umich.edu&gt;</span>
<span class="cm"> *  Andy Adamson   &lt;andros@umich.edu&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  Redistribution and use in source and binary forms, with or without</span>
<span class="cm"> *  modification, are permitted provided that the following conditions</span>
<span class="cm"> *  are met:</span>
<span class="cm"> *</span>
<span class="cm"> *  1. Redistributions of source code must retain the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer.</span>
<span class="cm"> *  2. Redistributions in binary form must reproduce the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer in the</span>
<span class="cm"> *     documentation and/or other materials provided with the distribution.</span>
<span class="cm"> *  3. Neither the name of the University nor the names of its</span>
<span class="cm"> *     contributors may be used to endorse or promote products derived</span>
<span class="cm"> *     from this software without specific prior written permission.</span>
<span class="cm"> *</span>
<span class="cm"> *  THIS SOFTWARE IS PROVIDED ``AS IS&#39;&#39; AND ANY EXPRESS OR IMPLIED</span>
<span class="cm"> *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<span class="cm"> *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="cm"> *  DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE</span>
<span class="cm"> *  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<span class="cm"> *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<span class="cm"> *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR</span>
<span class="cm"> *  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<span class="cm"> *  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<span class="cm"> *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="cm"> *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _LINUX_NFSD_XDR4_H</span>
<span class="cp">#define _LINUX_NFSD_XDR4_H</span>

<span class="cp">#include &quot;state.h&quot;</span>
<span class="cp">#include &quot;nfsd.h&quot;</span>

<span class="cp">#define NFSD4_MAX_TAGLEN	128</span>
<span class="cp">#define XDR_LEN(n)                     (((n) + 3) &amp; ~3)</span>

<span class="cp">#define CURRENT_STATE_ID_FLAG (1&lt;&lt;0)</span>
<span class="cp">#define SAVED_STATE_ID_FLAG (1&lt;&lt;1)</span>

<span class="cp">#define SET_STATE_ID(c, f) ((c)-&gt;sid_flags |= (f))</span>
<span class="cp">#define HAS_STATE_ID(c, f) ((c)-&gt;sid_flags &amp; (f))</span>
<span class="cp">#define CLEAR_STATE_ID(c, f) ((c)-&gt;sid_flags &amp;= ~(f))</span>

<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">svc_fh</span>		<span class="n">current_fh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">svc_fh</span>		<span class="n">save_fh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfs4_stateowner</span>	<span class="o">*</span><span class="n">replay_owner</span><span class="p">;</span>
	<span class="cm">/* For sessions DRC */</span>
	<span class="k">struct</span> <span class="n">nfsd4_session</span>	<span class="o">*</span><span class="n">session</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfsd4_slot</span>	<span class="o">*</span><span class="n">slot</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="o">*</span><span class="n">datap</span><span class="p">;</span>
	<span class="kt">size_t</span>			<span class="n">iovlen</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">minorversion</span><span class="p">;</span>
	<span class="n">__be32</span>			<span class="n">status</span><span class="p">;</span>
	<span class="n">stateid_t</span>	<span class="n">current_stateid</span><span class="p">;</span>
	<span class="n">stateid_t</span>	<span class="n">save_stateid</span><span class="p">;</span>
	<span class="cm">/* to indicate current and saved state id presents */</span>
	<span class="n">u32</span>		<span class="n">sid_flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">nfsd4_has_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="n">cs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">cs</span><span class="o">-&gt;</span><span class="n">slot</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">nfsd4_change_info</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">atomic</span><span class="p">;</span>
	<span class="n">bool</span>		<span class="n">change_supported</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">before_ctime_sec</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">before_ctime_nsec</span><span class="p">;</span>
	<span class="n">u64</span>		<span class="n">before_change</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">after_ctime_sec</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">after_ctime_nsec</span><span class="p">;</span>
	<span class="n">u64</span>		<span class="n">after_change</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_access</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">ac_req_access</span><span class="p">;</span>      <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">ac_supported</span><span class="p">;</span>       <span class="cm">/* response */</span>
	<span class="n">u32</span>		<span class="n">ac_resp_access</span><span class="p">;</span>     <span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_close</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">cl_seqid</span><span class="p">;</span>           <span class="cm">/* request */</span>
	<span class="n">stateid_t</span>	<span class="n">cl_stateid</span><span class="p">;</span>         <span class="cm">/* request+response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_commit</span> <span class="p">{</span>
	<span class="n">u64</span>		<span class="n">co_offset</span><span class="p">;</span>          <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">co_count</span><span class="p">;</span>           <span class="cm">/* request */</span>
	<span class="n">nfs4_verifier</span>	<span class="n">co_verf</span><span class="p">;</span>            <span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_create</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">cr_namelen</span><span class="p">;</span>         <span class="cm">/* request */</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">cr_name</span><span class="p">;</span>            <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">cr_type</span><span class="p">;</span>            <span class="cm">/* request */</span>
	<span class="k">union</span> <span class="p">{</span>                             <span class="cm">/* request */</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span> <span class="n">namelen</span><span class="p">;</span>
			<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">link</span><span class="p">;</span>   <span class="cm">/* NF4LNK */</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span> <span class="n">specdata1</span><span class="p">;</span>
			<span class="n">u32</span> <span class="n">specdata2</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">dev</span><span class="p">;</span>    <span class="cm">/* NF4BLK, NF4CHR */</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">cr_bmval</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>        <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">iattr</span>	<span class="n">cr_iattr</span><span class="p">;</span>           <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">nfsd4_change_info</span>  <span class="n">cr_cinfo</span><span class="p">;</span> <span class="cm">/* response */</span>
	<span class="k">struct</span> <span class="n">nfs4_acl</span> <span class="o">*</span><span class="n">cr_acl</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define cr_linklen	u.link.namelen</span>
<span class="cp">#define cr_linkname	u.link.name</span>
<span class="cp">#define cr_specdata1	u.dev.specdata1</span>
<span class="cp">#define cr_specdata2	u.dev.specdata2</span>

<span class="k">struct</span> <span class="n">nfsd4_delegreturn</span> <span class="p">{</span>
	<span class="n">stateid_t</span>	<span class="n">dr_stateid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_getattr</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">ga_bmval</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>        <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">svc_fh</span>	<span class="o">*</span><span class="n">ga_fhp</span><span class="p">;</span>            <span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_link</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">li_namelen</span><span class="p">;</span>         <span class="cm">/* request */</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">li_name</span><span class="p">;</span>            <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">nfsd4_change_info</span>  <span class="n">li_cinfo</span><span class="p">;</span> <span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_lock_denied</span> <span class="p">{</span>
	<span class="n">clientid_t</span>	<span class="n">ld_clientid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">xdr_netobj</span>	<span class="n">ld_owner</span><span class="p">;</span>
	<span class="n">u64</span>             <span class="n">ld_start</span><span class="p">;</span>
	<span class="n">u64</span>             <span class="n">ld_length</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">ld_type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_lock</span> <span class="p">{</span>
	<span class="cm">/* request */</span>
	<span class="n">u32</span>             <span class="n">lk_type</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">lk_reclaim</span><span class="p">;</span>         <span class="cm">/* boolean */</span>
	<span class="n">u64</span>             <span class="n">lk_offset</span><span class="p">;</span>
	<span class="n">u64</span>             <span class="n">lk_length</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">lk_is_new</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u32</span>             <span class="n">open_seqid</span><span class="p">;</span>
			<span class="n">stateid_t</span>       <span class="n">open_stateid</span><span class="p">;</span>
			<span class="n">u32</span>             <span class="n">lock_seqid</span><span class="p">;</span>
			<span class="n">clientid_t</span>      <span class="n">clientid</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">xdr_netobj</span> <span class="n">owner</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">new</span><span class="p">;</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">stateid_t</span>       <span class="n">lock_stateid</span><span class="p">;</span>
			<span class="n">u32</span>             <span class="n">lock_seqid</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">old</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">v</span><span class="p">;</span>

	<span class="cm">/* response */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">stateid_t</span>               <span class="n">stateid</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">ok</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_lock_denied</span>        <span class="n">denied</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define lk_new_open_seqid       v.new.open_seqid</span>
<span class="cp">#define lk_new_open_stateid     v.new.open_stateid</span>
<span class="cp">#define lk_new_lock_seqid       v.new.lock_seqid</span>
<span class="cp">#define lk_new_clientid         v.new.clientid</span>
<span class="cp">#define lk_new_owner            v.new.owner</span>
<span class="cp">#define lk_old_lock_stateid     v.old.lock_stateid</span>
<span class="cp">#define lk_old_lock_seqid       v.old.lock_seqid</span>

<span class="cp">#define lk_rflags       u.ok.rflags</span>
<span class="cp">#define lk_resp_stateid u.ok.stateid</span>
<span class="cp">#define lk_denied       u.denied</span>


<span class="k">struct</span> <span class="n">nfsd4_lockt</span> <span class="p">{</span>
	<span class="n">u32</span>				<span class="n">lt_type</span><span class="p">;</span>
	<span class="n">clientid_t</span>			<span class="n">lt_clientid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">xdr_netobj</span>		<span class="n">lt_owner</span><span class="p">;</span>
	<span class="n">u64</span>				<span class="n">lt_offset</span><span class="p">;</span>
	<span class="n">u64</span>				<span class="n">lt_length</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfsd4_lock_denied</span>  	<span class="n">lt_denied</span><span class="p">;</span>
<span class="p">};</span>

 
<span class="k">struct</span> <span class="n">nfsd4_locku</span> <span class="p">{</span>
	<span class="n">u32</span>             <span class="n">lu_type</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">lu_seqid</span><span class="p">;</span>
	<span class="n">stateid_t</span>       <span class="n">lu_stateid</span><span class="p">;</span>
	<span class="n">u64</span>             <span class="n">lu_offset</span><span class="p">;</span>
	<span class="n">u64</span>             <span class="n">lu_length</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">nfsd4_lookup</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">lo_len</span><span class="p">;</span>             <span class="cm">/* request */</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">lo_name</span><span class="p">;</span>            <span class="cm">/* request */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_putfh</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">pf_fhlen</span><span class="p">;</span>           <span class="cm">/* request */</span>
	<span class="kt">char</span>		<span class="o">*</span><span class="n">pf_fhval</span><span class="p">;</span>          <span class="cm">/* request */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_open</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">op_claim_type</span><span class="p">;</span>      <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">xdr_netobj</span> <span class="n">op_fname</span><span class="p">;</span>	    <span class="cm">/* request - everything but CLAIM_PREV */</span>
	<span class="n">u32</span>		<span class="n">op_delegate_type</span><span class="p">;</span>   <span class="cm">/* request - CLAIM_PREV only */</span>
	<span class="n">stateid_t</span>       <span class="n">op_delegate_stateid</span><span class="p">;</span> <span class="cm">/* request - response */</span>
	<span class="n">u32</span>		<span class="n">op_why_no_deleg</span><span class="p">;</span>    <span class="cm">/* response - DELEG_NONE_EXT only */</span>
	<span class="n">u32</span>		<span class="n">op_create</span><span class="p">;</span>     	    <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">op_createmode</span><span class="p">;</span>      <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">op_bmval</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>        <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">iattr</span>	<span class="n">iattr</span><span class="p">;</span>              <span class="cm">/* UNCHECKED4, GUARDED4, EXCLUSIVE4_1 */</span>
	<span class="n">nfs4_verifier</span>	<span class="n">op_verf</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">32</span><span class="p">)));</span>
					    <span class="cm">/* EXCLUSIVE4 */</span>
	<span class="n">clientid_t</span>	<span class="n">op_clientid</span><span class="p">;</span>        <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">xdr_netobj</span> <span class="n">op_owner</span><span class="p">;</span>           <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">op_seqid</span><span class="p">;</span>           <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">op_share_access</span><span class="p">;</span>    <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">op_share_deny</span><span class="p">;</span>      <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">op_deleg_want</span><span class="p">;</span>      <span class="cm">/* request */</span>
	<span class="n">stateid_t</span>	<span class="n">op_stateid</span><span class="p">;</span>         <span class="cm">/* response */</span>
	<span class="n">u32</span>		<span class="n">op_recall</span><span class="p">;</span>          <span class="cm">/* recall */</span>
	<span class="k">struct</span> <span class="n">nfsd4_change_info</span>  <span class="n">op_cinfo</span><span class="p">;</span> <span class="cm">/* response */</span>
	<span class="n">u32</span>		<span class="n">op_rflags</span><span class="p">;</span>          <span class="cm">/* response */</span>
	<span class="n">bool</span>		<span class="n">op_truncate</span><span class="p">;</span>        <span class="cm">/* used during processing */</span>
	<span class="n">bool</span>		<span class="n">op_created</span><span class="p">;</span>         <span class="cm">/* used during processing */</span>
	<span class="k">struct</span> <span class="n">nfs4_openowner</span> <span class="o">*</span><span class="n">op_openowner</span><span class="p">;</span> <span class="cm">/* used during processing */</span>
	<span class="k">struct</span> <span class="n">nfs4_file</span> <span class="o">*</span><span class="n">op_file</span><span class="p">;</span>          <span class="cm">/* used during processing */</span>
	<span class="k">struct</span> <span class="n">nfs4_ol_stateid</span> <span class="o">*</span><span class="n">op_stp</span><span class="p">;</span>	    <span class="cm">/* used during processing */</span>
	<span class="k">struct</span> <span class="n">nfs4_acl</span> <span class="o">*</span><span class="n">op_acl</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#define op_iattr	iattr</span>

<span class="k">struct</span> <span class="n">nfsd4_open_confirm</span> <span class="p">{</span>
	<span class="n">stateid_t</span>	<span class="n">oc_req_stateid</span>		<span class="cm">/* request */</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">oc_seqid</span>    		<span class="cm">/* request */</span><span class="p">;</span>
	<span class="n">stateid_t</span>	<span class="n">oc_resp_stateid</span>		<span class="cm">/* response */</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_open_downgrade</span> <span class="p">{</span>
	<span class="n">stateid_t</span>       <span class="n">od_stateid</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">od_seqid</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">od_share_access</span><span class="p">;</span>	<span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">od_deleg_want</span><span class="p">;</span>		<span class="cm">/* request */</span>
	<span class="n">u32</span>             <span class="n">od_share_deny</span><span class="p">;</span>		<span class="cm">/* request */</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">nfsd4_read</span> <span class="p">{</span>
	<span class="n">stateid_t</span>	<span class="n">rd_stateid</span><span class="p">;</span>         <span class="cm">/* request */</span>
	<span class="n">u64</span>		<span class="n">rd_offset</span><span class="p">;</span>          <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">rd_length</span><span class="p">;</span>          <span class="cm">/* request */</span>
	<span class="kt">int</span>		<span class="n">rd_vlen</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">file</span>     <span class="o">*</span><span class="n">rd_filp</span><span class="p">;</span>
	
	<span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rd_rqstp</span><span class="p">;</span>          <span class="cm">/* response */</span>
	<span class="k">struct</span> <span class="n">svc_fh</span> <span class="o">*</span> <span class="n">rd_fhp</span><span class="p">;</span>             <span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_readdir</span> <span class="p">{</span>
	<span class="n">u64</span>		<span class="n">rd_cookie</span><span class="p">;</span>          <span class="cm">/* request */</span>
	<span class="n">nfs4_verifier</span>	<span class="n">rd_verf</span><span class="p">;</span>            <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">rd_dircount</span><span class="p">;</span>        <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">rd_maxcount</span><span class="p">;</span>        <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">rd_bmval</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>        <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rd_rqstp</span><span class="p">;</span>          <span class="cm">/* response */</span>
	<span class="k">struct</span> <span class="n">svc_fh</span> <span class="o">*</span> <span class="n">rd_fhp</span><span class="p">;</span>             <span class="cm">/* response */</span>

	<span class="k">struct</span> <span class="n">readdir_cd</span>	<span class="n">common</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span>		<span class="n">buffer</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">buflen</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span>		<span class="n">offset</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_release_lockowner</span> <span class="p">{</span>
	<span class="n">clientid_t</span>        <span class="n">rl_clientid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">xdr_netobj</span> <span class="n">rl_owner</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">nfsd4_readlink</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rl_rqstp</span><span class="p">;</span>          <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">svc_fh</span> <span class="o">*</span>	<span class="n">rl_fhp</span><span class="p">;</span>             <span class="cm">/* request */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_remove</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">rm_namelen</span><span class="p">;</span>         <span class="cm">/* request */</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">rm_name</span><span class="p">;</span>            <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">nfsd4_change_info</span>  <span class="n">rm_cinfo</span><span class="p">;</span> <span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_rename</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">rn_snamelen</span><span class="p">;</span>        <span class="cm">/* request */</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">rn_sname</span><span class="p">;</span>           <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">rn_tnamelen</span><span class="p">;</span>        <span class="cm">/* request */</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">rn_tname</span><span class="p">;</span>           <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">nfsd4_change_info</span>  <span class="n">rn_sinfo</span><span class="p">;</span> <span class="cm">/* response */</span>
	<span class="k">struct</span> <span class="n">nfsd4_change_info</span>  <span class="n">rn_tinfo</span><span class="p">;</span> <span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_secinfo</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">si_namelen</span><span class="p">;</span>					<span class="cm">/* request */</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">si_name</span><span class="p">;</span>					<span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span><span class="n">si_exp</span><span class="p">;</span>			<span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_secinfo_no_name</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">sin_style</span><span class="p">;</span>					<span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span><span class="n">sin_exp</span><span class="p">;</span>			<span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_setattr</span> <span class="p">{</span>
	<span class="n">stateid_t</span>	<span class="n">sa_stateid</span><span class="p">;</span>         <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">sa_bmval</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>        <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">iattr</span>	<span class="n">sa_iattr</span><span class="p">;</span>           <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">nfs4_acl</span> <span class="o">*</span><span class="n">sa_acl</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_setclientid</span> <span class="p">{</span>
	<span class="n">nfs4_verifier</span>	<span class="n">se_verf</span><span class="p">;</span>            <span class="cm">/* request */</span>
	<span class="k">struct</span> <span class="n">xdr_netobj</span> <span class="n">se_name</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">se_callback_prog</span><span class="p">;</span>   <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">se_callback_netid_len</span><span class="p">;</span>  <span class="cm">/* request */</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">se_callback_netid_val</span><span class="p">;</span>  <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">se_callback_addr_len</span><span class="p">;</span>   <span class="cm">/* request */</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">se_callback_addr_val</span><span class="p">;</span>   <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">se_callback_ident</span><span class="p">;</span>  <span class="cm">/* request */</span>
	<span class="n">clientid_t</span>	<span class="n">se_clientid</span><span class="p">;</span>        <span class="cm">/* response */</span>
	<span class="n">nfs4_verifier</span>	<span class="n">se_confirm</span><span class="p">;</span>         <span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_setclientid_confirm</span> <span class="p">{</span>
	<span class="n">clientid_t</span>	<span class="n">sc_clientid</span><span class="p">;</span>
	<span class="n">nfs4_verifier</span>	<span class="n">sc_confirm</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_saved_compoundargs</span> <span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">end</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">pagelen</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="n">pagelist</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_test_stateid_id</span> <span class="p">{</span>
	<span class="n">__be32</span>			<span class="n">ts_id_status</span><span class="p">;</span>
	<span class="n">stateid_t</span>		<span class="n">ts_id_stateid</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">ts_id_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_test_stateid</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">ts_num_ids</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">ts_stateid_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_free_stateid</span> <span class="p">{</span>
	<span class="n">stateid_t</span>	<span class="n">fr_stateid</span><span class="p">;</span>         <span class="cm">/* request */</span>
	<span class="n">__be32</span>		<span class="n">fr_status</span><span class="p">;</span>          <span class="cm">/* response */</span>
<span class="p">};</span>

<span class="cm">/* also used for NVERIFY */</span>
<span class="k">struct</span> <span class="n">nfsd4_verify</span> <span class="p">{</span>
	<span class="n">u32</span>		<span class="n">ve_bmval</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>        <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">ve_attrlen</span><span class="p">;</span>         <span class="cm">/* request */</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">ve_attrval</span><span class="p">;</span>         <span class="cm">/* request */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_write</span> <span class="p">{</span>
	<span class="n">stateid_t</span>	<span class="n">wr_stateid</span><span class="p">;</span>         <span class="cm">/* request */</span>
	<span class="n">u64</span>		<span class="n">wr_offset</span><span class="p">;</span>          <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">wr_stable_how</span><span class="p">;</span>      <span class="cm">/* request */</span>
	<span class="n">u32</span>		<span class="n">wr_buflen</span><span class="p">;</span>          <span class="cm">/* request */</span>
	<span class="kt">int</span>		<span class="n">wr_vlen</span><span class="p">;</span>

	<span class="n">u32</span>		<span class="n">wr_bytes_written</span><span class="p">;</span>   <span class="cm">/* response */</span>
	<span class="n">u32</span>		<span class="n">wr_how_written</span><span class="p">;</span>     <span class="cm">/* response */</span>
	<span class="n">nfs4_verifier</span>	<span class="n">wr_verifier</span><span class="p">;</span>        <span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_exchange_id</span> <span class="p">{</span>
	<span class="n">nfs4_verifier</span>	<span class="n">verifier</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">xdr_netobj</span> <span class="n">clname</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">flags</span><span class="p">;</span>
	<span class="n">clientid_t</span>	<span class="n">clientid</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">seqid</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">spa_how</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_sequence</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">nfs4_sessionid</span>	<span class="n">sessionid</span><span class="p">;</span>		<span class="cm">/* request/response */</span>
	<span class="n">u32</span>			<span class="n">seqid</span><span class="p">;</span>			<span class="cm">/* request/response */</span>
	<span class="n">u32</span>			<span class="n">slotid</span><span class="p">;</span>			<span class="cm">/* request/response */</span>
	<span class="n">u32</span>			<span class="n">maxslots</span><span class="p">;</span>		<span class="cm">/* request/response */</span>
	<span class="n">u32</span>			<span class="n">cachethis</span><span class="p">;</span>		<span class="cm">/* request */</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	u32			target_maxslots;	/* response */</span>
<span class="cp">#endif /* not yet */</span>
	<span class="n">u32</span>			<span class="n">status_flags</span><span class="p">;</span>		<span class="cm">/* response */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_destroy_session</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">nfs4_sessionid</span>	<span class="n">sessionid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_destroy_clientid</span> <span class="p">{</span>
	<span class="n">clientid_t</span> <span class="n">clientid</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_reclaim_complete</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">rca_one_fs</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_op</span> <span class="p">{</span>
	<span class="kt">int</span>					<span class="n">opnum</span><span class="p">;</span>
	<span class="n">__be32</span>					<span class="n">status</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">nfsd4_access</span>		<span class="n">access</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_close</span>		<span class="n">close</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_commit</span>		<span class="n">commit</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_create</span>		<span class="n">create</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_delegreturn</span>	<span class="n">delegreturn</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_getattr</span>		<span class="n">getattr</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">svc_fh</span> <span class="o">*</span>			<span class="n">getfh</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_link</span>		<span class="n">link</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_lock</span>		<span class="n">lock</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_lockt</span>		<span class="n">lockt</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_locku</span>		<span class="n">locku</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_lookup</span>		<span class="n">lookup</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_verify</span>		<span class="n">nverify</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_open</span>		<span class="n">open</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_open_confirm</span>	<span class="n">open_confirm</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_open_downgrade</span>	<span class="n">open_downgrade</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_putfh</span>		<span class="n">putfh</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_read</span>		<span class="n">read</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_readdir</span>		<span class="n">readdir</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_readlink</span>		<span class="n">readlink</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_remove</span>		<span class="n">remove</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_rename</span>		<span class="n">rename</span><span class="p">;</span>
		<span class="n">clientid_t</span>			<span class="n">renew</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_secinfo</span>		<span class="n">secinfo</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_setattr</span>		<span class="n">setattr</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_setclientid</span>	<span class="n">setclientid</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_setclientid_confirm</span> <span class="n">setclientid_confirm</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_verify</span>		<span class="n">verify</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_write</span>		<span class="n">write</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_release_lockowner</span>	<span class="n">release_lockowner</span><span class="p">;</span>

		<span class="cm">/* NFSv4.1 */</span>
		<span class="k">struct</span> <span class="n">nfsd4_exchange_id</span>	<span class="n">exchange_id</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_bind_conn_to_session</span> <span class="n">bind_conn_to_session</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_create_session</span>	<span class="n">create_session</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_destroy_session</span>	<span class="n">destroy_session</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_sequence</span>		<span class="n">sequence</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_reclaim_complete</span>	<span class="n">reclaim_complete</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_test_stateid</span>	<span class="n">test_stateid</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfsd4_free_stateid</span>	<span class="n">free_stateid</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfs4_replay</span> <span class="o">*</span>			<span class="n">replay</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">bool</span> <span class="n">nfsd4_cache_this_op</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_op</span> <span class="o">*</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">nfsd4_compoundargs</span> <span class="p">{</span>
	<span class="cm">/* scratch variables for XDR decode */</span>
	<span class="n">__be32</span> <span class="o">*</span>			<span class="n">p</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span>			<span class="n">end</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">page</span> <span class="o">**</span>			<span class="n">pagelist</span><span class="p">;</span>
	<span class="kt">int</span>				<span class="n">pagelen</span><span class="p">;</span>
	<span class="n">__be32</span>				<span class="n">tmp</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">__be32</span> <span class="o">*</span>			<span class="n">tmpp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tmpbuf</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">tmpbuf</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">release</span><span class="p">)(</span><span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
		<span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="p">}</span>				<span class="o">*</span><span class="n">to_free</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">svc_rqst</span>			<span class="o">*</span><span class="n">rqstp</span><span class="p">;</span>

	<span class="n">u32</span>				<span class="n">taglen</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span>				<span class="n">tag</span><span class="p">;</span>
	<span class="n">u32</span>				<span class="n">minorversion</span><span class="p">;</span>
	<span class="n">u32</span>				<span class="n">opcnt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfsd4_op</span>			<span class="o">*</span><span class="n">ops</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfsd4_op</span>			<span class="n">iops</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">int</span>				<span class="n">cachetype</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">nfsd4_compoundres</span> <span class="p">{</span>
	<span class="cm">/* scratch variables for XDR encode */</span>
	<span class="n">__be32</span> <span class="o">*</span>			<span class="n">p</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span>			<span class="n">end</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span>		<span class="n">xbuf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span>		<span class="n">rqstp</span><span class="p">;</span>

	<span class="n">u32</span>				<span class="n">taglen</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span>				<span class="n">tag</span><span class="p">;</span>
	<span class="n">u32</span>				<span class="n">opcnt</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span>			<span class="n">tagp</span><span class="p">;</span> <span class="cm">/* tag, opcount encode location */</span>
	<span class="k">struct</span> <span class="n">nfsd4_compound_state</span>	<span class="n">cstate</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">nfsd4_is_solo_sequence</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_compoundres</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">nfsd4_compoundargs</span> <span class="o">*</span><span class="n">args</span> <span class="o">=</span> <span class="n">resp</span><span class="o">-&gt;</span><span class="n">rqstp</span><span class="o">-&gt;</span><span class="n">rq_argp</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">resp</span><span class="o">-&gt;</span><span class="n">opcnt</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">opnum</span> <span class="o">==</span> <span class="n">OP_SEQUENCE</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">nfsd4_not_cached</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_compoundres</span> <span class="o">*</span><span class="n">resp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">resp</span><span class="o">-&gt;</span><span class="n">cstate</span><span class="p">.</span><span class="n">slot</span><span class="o">-&gt;</span><span class="n">sl_flags</span> <span class="o">&amp;</span> <span class="n">NFSD4_SLOT_CACHETHIS</span><span class="p">)</span>
		<span class="o">||</span> <span class="n">nfsd4_is_solo_sequence</span><span class="p">(</span><span class="n">resp</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define NFS4_SVC_XDRSIZE		sizeof(struct nfsd4_compoundargs)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">set_change_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_change_info</span> <span class="o">*</span><span class="n">cinfo</span><span class="p">,</span> <span class="k">struct</span> <span class="n">svc_fh</span> <span class="o">*</span><span class="n">fhp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">fhp</span><span class="o">-&gt;</span><span class="n">fh_pre_saved</span><span class="p">);</span>
	<span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">atomic</span> <span class="o">=</span> <span class="n">fhp</span><span class="o">-&gt;</span><span class="n">fh_post_saved</span><span class="p">;</span>
	<span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">change_supported</span> <span class="o">=</span> <span class="n">IS_I_VERSION</span><span class="p">(</span><span class="n">fhp</span><span class="o">-&gt;</span><span class="n">fh_dentry</span><span class="o">-&gt;</span><span class="n">d_inode</span><span class="p">);</span>

	<span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">before_change</span> <span class="o">=</span> <span class="n">fhp</span><span class="o">-&gt;</span><span class="n">fh_pre_change</span><span class="p">;</span>
	<span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">after_change</span> <span class="o">=</span> <span class="n">fhp</span><span class="o">-&gt;</span><span class="n">fh_post_change</span><span class="p">;</span>
	<span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">before_ctime_sec</span> <span class="o">=</span> <span class="n">fhp</span><span class="o">-&gt;</span><span class="n">fh_pre_ctime</span><span class="p">.</span><span class="n">tv_sec</span><span class="p">;</span>
	<span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">before_ctime_nsec</span> <span class="o">=</span> <span class="n">fhp</span><span class="o">-&gt;</span><span class="n">fh_pre_ctime</span><span class="p">.</span><span class="n">tv_nsec</span><span class="p">;</span>
	<span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">after_ctime_sec</span> <span class="o">=</span> <span class="n">fhp</span><span class="o">-&gt;</span><span class="n">fh_post_attr</span><span class="p">.</span><span class="n">ctime</span><span class="p">.</span><span class="n">tv_sec</span><span class="p">;</span>
	<span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">after_ctime_nsec</span> <span class="o">=</span> <span class="n">fhp</span><span class="o">-&gt;</span><span class="n">fh_post_attr</span><span class="p">.</span><span class="n">ctime</span><span class="p">.</span><span class="n">tv_nsec</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">int</span> <span class="n">nfs4svc_encode_voidres</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nfs4svc_decode_compoundargs</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compoundargs</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nfs4svc_encode_compoundres</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compoundres</span> <span class="o">*</span><span class="p">);</span>
<span class="n">__be32</span> <span class="n">nfsd4_check_resp_size</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_compoundres</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">nfsd4_encode_operation</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_compoundres</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_op</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">nfsd4_encode_replay</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_compoundres</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_op</span> <span class="o">*</span><span class="n">op</span><span class="p">);</span>
<span class="n">__be32</span> <span class="n">nfsd4_encode_fattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_fh</span> <span class="o">*</span><span class="n">fhp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">svc_export</span> <span class="o">*</span><span class="n">exp</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dentry</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">countp</span><span class="p">,</span>
		       <span class="n">u32</span> <span class="o">*</span><span class="n">bmval</span><span class="p">,</span> <span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ignore_crossmnt</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_setclientid</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_setclientid</span> <span class="o">*</span><span class="n">setclid</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_setclientid_confirm</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_setclientid_confirm</span> <span class="o">*</span><span class="n">setclientid_confirm</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nfsd4_store_cache_entry</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_compoundres</span> <span class="o">*</span><span class="n">resp</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_replay_cache_entry</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_compoundres</span> <span class="o">*</span><span class="n">resp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_sequence</span> <span class="o">*</span><span class="n">seq</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_exchange_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_exchange_id</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_bind_conn_to_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_bind_conn_to_session</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_create_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_create_session</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_sequence</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_sequence</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_destroy_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_destroy_session</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_destroy_clientid</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_destroy_clientid</span> <span class="o">*</span><span class="p">);</span>
<span class="n">__be32</span> <span class="n">nfsd4_reclaim_complete</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_reclaim_complete</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_process_open1</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_open</span> <span class="o">*</span><span class="n">open</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_process_open2</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">svc_fh</span> <span class="o">*</span><span class="n">current_fh</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_open</span> <span class="o">*</span><span class="n">open</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nfsd4_cleanup_open_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">nfsd4_open</span> <span class="o">*</span><span class="n">open</span><span class="p">,</span> <span class="n">__be32</span> <span class="n">status</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_open_confirm</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_open_confirm</span> <span class="o">*</span><span class="n">oc</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_close</span> <span class="o">*</span><span class="n">close</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_open_downgrade</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_open_downgrade</span> <span class="o">*</span><span class="n">od</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_lock</span> <span class="o">*</span><span class="n">lock</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_lockt</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_lockt</span> <span class="o">*</span><span class="n">lockt</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_locku</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_locku</span> <span class="o">*</span><span class="n">locku</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span>
<span class="n">nfsd4_release_lockowner</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_release_lockowner</span> <span class="o">*</span><span class="n">rlockowner</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nfsd4_release_compoundargs</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">rq</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">resp</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_delegreturn</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_delegreturn</span> <span class="o">*</span><span class="n">dr</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_renew</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span> <span class="n">clientid_t</span> <span class="o">*</span><span class="n">clid</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_test_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_test_stateid</span> <span class="o">*</span><span class="n">test_stateid</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__be32</span> <span class="n">nfsd4_free_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">svc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfsd4_compound_state</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfsd4_free_stateid</span> <span class="o">*</span><span class="n">free_stateid</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Local variables:</span>
<span class="cm"> *  c-basic-offset: 8</span>
<span class="cm"> * End:</span>
<span class="cm"> */</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
