f | Makefile | g | 305B |  | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1337187226 |  | UBIFS: remove Kconfig debugging option  Have the debugging stuff always compiled-in instead. It simplifies maintanance a lot.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | dir.c | s | 32K | 1061 | Al Viro | viro@zeniv.linux.org.uk | 1338348512 |  | ubifs: use generic_fillattr()  don't open-code it...  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | debug.h | s | 12K | 288 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | lprops.c | s | 35K | 1178 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1337187226 |  | UBIFS: remove Kconfig debugging option  Have the debugging stuff always compiled-in instead. It simplifies maintanance a lot.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | debug.c | s | 85K | 2868 | Brian Norris | computersforpeace@gmail.com | 1340796135 |  | UBIFS: correct usage of IS_ENABLED()  Commit "818039c UBIFS: fix debugfs-less systems support" fixed one regression but introduced a different regression - the debugfs is now always compiled out. Root cause: IS_ENABLED() arguments should be used with the CONFIG_* prefix.  Signed-off-by: Brian Norris <computersforpeace@gmail.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | tnc_misc.c | s | 12K | 429 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1337188283 |  | UBIFS: get rid of dbg_err  This patch removes the 'dbg_err()' macro and we now use 'ubifs_err()' instead. The idea of 'dbg_err()' was to compile out some error message to make the binary a bit smaller - but I think it was a bad idea.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | tnc_commit.c | s | 26K | 957 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | budget.c | s | 23K | 657 | Curt Wohlgemuth | curtw@google.com | 1319992416 |  | writeback: Add a 'reason' to wb_writeback_work  This creates a new 'reason' field in a wb_writeback_work structure, which unambiguously identifies who initiates writeback activity.  A 'wb_reason' enumeration has been added to writeback.h, to enumerate the possible reasons.  The 'writeback_work_class' and tracepoint event class and 'writeback_queue_io' tracepoints are updated to include the symbolic 'reason' in all trace events.  And the 'writeback_inodes_sbXXX' family of routines has had a wb_stats parameter added to them, so callers can specify why writeback is being started.  Acked-by: Jan Kara <jack@suse.cz> Signed-off-by: Curt Wohlgemuth <curtw@google.com> Signed-off-by: Wu Fengguang <fengguang.wu@intel.com>
f | journal.c | s | 42K | 1302 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | recovery.c | s | 43K | 1415 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | lpt.c | s | 58K | 2086 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | find.c | s | 29K | 898 | Dan Carpenter | dan.carpenter@oracle.com | 1340018228 |  | UBIFS: fix assertion  The asserts here never check anything because it uses '||' instead of '&'.  Now if the flags are not set it prints a warning a a stack trace.  Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | xattr.c | s | 15K | 493 | Linus Torvalds | torvalds@linux-foundation.org | 1337740227 |  | 
f | replay.c | s | 29K | 950 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | misc.h | s | 8.3K | 277 | Artem Bityutskiy | Artem.Bityutskiy@nokia.com | 1309766073 |  | UBIFS: introduce more I/O helpers  Introduce the following I/O helper functions: 'ubifs_leb_read()', 'ubifs_leb_write()', 'ubifs_leb_change()', 'ubifs_leb_unmap()', 'ubifs_leb_map()', 'ubifs_is_mapped().  The idea is to wrap all UBI I/O functions in order to encapsulate various assertions and error path handling (error message, stack dump, switching to R/O mode). And there are some other benefits of this which will be used in the following patches.  This patch does not switch whole UBIFS to use these functions yet.  Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@nokia.com>
f | compress.c | s | 6.6K | 220 | Artem Bityutskiy | Artem.Bityutskiy@nokia.com | 1230725604 |  | UBIFS: fix sparse warnings  fs/ubifs/compress.c:111:8: warning: incorrect type in argument 5 (different signedness) fs/ubifs/compress.c:111:8:    expected unsigned int *dlen fs/ubifs/compress.c:111:8:    got int *out_len fs/ubifs/compress.c:175:10: warning: incorrect type in argument 5 (different signedness) fs/ubifs/compress.c:175:10:    expected unsigned int *dlen fs/ubifs/compress.c:175:10:    got int *out_len  Fix this by adding a cast to (unsigned int *). We guarantee that our lengths are small and no overflow is possible.  Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@nokia.com>
f | scan.c | s | 9.4K | 326 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1337188283 |  | UBIFS: get rid of dbg_err  This patch removes the 'dbg_err()' macro and we now use 'ubifs_err()' instead. The idea of 'dbg_err()' was to compile out some error message to make the binary a bit smaller - but I think it was a bad idea.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | ubifs.h | s | 60K | 1656 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | super.c | s | 60K | 2030 | Linus Torvalds | torvalds@linux-foundation.org | 1338224085 |  | 
f | key.h | s | 14K | 493 | Artem Bityutskiy | Artem.Bityutskiy@nokia.com | 1283152748 |  | UBIFS: mark unused key objects as invalid  When scanning the flash, UBIFS builds a list of flash nodes of type 'struct ubifs_scan_node'. Each scanned node has a 'snod->key' field. This field is valid for most of the nodes, but invalid for some node type, e.g., truncation nodes. It is safer to explicitly initialize such keys to something invalid, rather than leaving them initialized to all zeros, which has key type of UBIFS_INO_KEY.  This patch introduces new "fake" key type UBIFS_INVALID_KEY and initializes unused 'snod->key' objects to this type. It also adds debugging assertions in the TNC code to make sure no one ever tries to look these nodes up in the TNC.  Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@nokia.com>
f | lpt_commit.c | s | 51K | 1872 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | master.c | s | 10K | 338 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | log.c | s | 19K | 677 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | ubifs-media.h | s | 22K | 724 | Matthew L. Creech | mlcreech@gmail.com | 1305544334 |  | UBIFS: add a superblock flag for free space fix-up  The 'space_fixup' flag can be set in the superblock of a new filesystem by mkfs.ubifs to indicate that any eraseblocks with free space remaining should be fixed-up the first time it's mounted (after which the flag is un-set). This means that the UBIFS image has been flashed by a "dumb" flasher and the free space has been actually programmed (writing all 0xFFs), so this free space cannot be used. UBIFS fixes the free space up by re-writing the contents of all LEBs with free space using the atomic LEB change UBI operation.  Artem: improved commit message, add some more commentaries to the code.  Signed-off-by: Matthew L. Creech <mlcreech@gmail.com> Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@nokia.com>
f | commit.c | s | 20K | 674 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1337188283 |  | UBIFS: get rid of dbg_err  This patch removes the 'dbg_err()' macro and we now use 'ubifs_err()' instead. The idea of 'dbg_err()' was to compile out some error message to make the binary a bit smaller - but I think it was a bad idea.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | tnc.c | s | 87K | 3026 | Linus Torvalds | torvalds@linux-foundation.org | 1337740227 |  | 
f | sb.c | s | 22K | 690 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | gc.c | s | 27K | 869 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | orphan.c | s | 24K | 885 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | Kconfig | g | 1.0K |  | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1337187226 |  | UBIFS: remove Kconfig debugging option  Have the debugging stuff always compiled-in instead. It simplifies maintanance a lot.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | io.c | s | 33K | 1019 | Richard Weinberger | richard@nod.at | 1337534759 |  | UBI: Kill data type hint  We do not need this feature and to our shame it even was not working and there was a bug found very recently. 	-- Artem Bityutskiy  Without the data type hint UBI2 (fastmap) will be easier to implement.  Signed-off-by: Richard Weinberger <richard@nod.at> Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | ioctl.c | s | 5.2K | 179 | Al Viro | viro@zeniv.linux.org.uk | 1325649160 |  | vfs: mnt_drop_write_file()  new helper (wrapper around mnt_drop_write()) to be used in pair with mnt_want_write_file().  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | file.c | s | 44K | 1409 | Artem Bityutskiy | artem.bityutskiy@linux.intel.com | 1337184956 |  | UBIFS: rename dumping functions  This commit re-names all functions which dump something from "dbg_dump_*()" to "ubifs_dump_*()". This is done for consistency with UBI and because this way it will be more logical once we remove the debugging sompilation option.  Signed-off-by: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>
f | shrinker.c | s | 9.5K | 290 | Artem Bityutskiy | Artem.Bityutskiy@nokia.com | 1307113944 |  | UBIFS: fix shrinker object count reports  Sometimes VM asks the shrinker to return amount of objects it can shrink, and we return the ubifs_clean_zn_cnt in that case. However, it is possible that this counter is negative for a short period of time, due to the way UBIFS TNC code updates it. And I can observe the following warnings sometimes:  shrink_slab: ubifs_shrinker+0x0/0x2b7 [ubifs] negative objects to delete nr=-8541616642706119788  This patch makes sure UBIFS never returns negative count of objects.  Signed-off-by: Artem Bityutskiy <Artem.Bityutskiy@nokia.com> Cc: stable@kernel.org
