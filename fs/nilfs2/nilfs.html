<!DOCTYPE html>
<html><head><title>joekychen/linux » fs › nilfs2 › nilfs.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>nilfs.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * nilfs.h - NILFS local header file.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2005-2008 Nippon Telegraph and Telephone Corporation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA</span>
<span class="cm"> *</span>
<span class="cm"> * Written by Koji Sato &lt;koji@osrg.net&gt;</span>
<span class="cm"> *            Ryusuke Konishi &lt;ryusuke@osrg.net&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _NILFS_H</span>
<span class="cp">#define _NILFS_H</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/buffer_head.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/blkdev.h&gt;</span>
<span class="cp">#include &lt;linux/nilfs2_fs.h&gt;</span>
<span class="cp">#include &quot;the_nilfs.h&quot;</span>
<span class="cp">#include &quot;bmap.h&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * nilfs inode data in memory</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">nilfs_inode_info</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">i_flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">i_state</span><span class="p">;</span>		<span class="cm">/* Dynamic state flags */</span>
	<span class="k">struct</span> <span class="n">nilfs_bmap</span> <span class="o">*</span><span class="n">i_bmap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nilfs_bmap</span> <span class="n">i_bmap_data</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">i_xattr</span><span class="p">;</span>	<span class="cm">/* sector_t ??? */</span>
	<span class="n">__u32</span> <span class="n">i_dir_start_lookup</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">i_cno</span><span class="p">;</span>		<span class="cm">/* check point number for GC inode */</span>
	<span class="k">struct</span> <span class="n">address_space</span> <span class="n">i_btnode_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">i_dirty</span><span class="p">;</span>	<span class="cm">/* List for connecting dirty files */</span>

<span class="cp">#ifdef CONFIG_NILFS_XATTR</span>
	<span class="cm">/*</span>
<span class="cm">	 * Extended attributes can be read independently of the main file</span>
<span class="cm">	 * data. Taking i_sem even when reading would cause contention</span>
<span class="cm">	 * between readers of EAs and writers of regular file data, so</span>
<span class="cm">	 * instead we synchronize on xattr_sem when reading or changing</span>
<span class="cm">	 * EAs.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">rw_semaphore</span> <span class="n">xattr_sem</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">*</span><span class="n">i_bh</span><span class="p">;</span>	<span class="cm">/* i_bh contains a new or dirty</span>
<span class="cm">					   disk inode */</span>
	<span class="k">struct</span> <span class="n">nilfs_root</span> <span class="o">*</span><span class="n">i_root</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">inode</span> <span class="n">vfs_inode</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">nilfs_inode_info</span> <span class="o">*</span><span class="nf">NILFS_I</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nilfs_inode_info</span><span class="p">,</span> <span class="n">vfs_inode</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">nilfs_inode_info</span> <span class="o">*</span>
<span class="nf">NILFS_BMAP_I</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">nilfs_bmap</span> <span class="o">*</span><span class="n">bmap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">bmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nilfs_inode_info</span><span class="p">,</span> <span class="n">i_bmap_data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="nf">NILFS_BTNC_I</span><span class="p">(</span><span class="k">struct</span> <span class="n">address_space</span> <span class="o">*</span><span class="n">btnc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">nilfs_inode_info</span> <span class="o">*</span><span class="n">ii</span> <span class="o">=</span>
		<span class="n">container_of</span><span class="p">(</span><span class="n">btnc</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nilfs_inode_info</span><span class="p">,</span> <span class="n">i_btnode_cache</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">ii</span><span class="o">-&gt;</span><span class="n">vfs_inode</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Dynamic state flags of NILFS on-memory inode (i_state)</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">NILFS_I_NEW</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>		<span class="cm">/* Inode is newly created */</span>
	<span class="n">NILFS_I_DIRTY</span><span class="p">,</span>			<span class="cm">/* The file is dirty */</span>
	<span class="n">NILFS_I_QUEUED</span><span class="p">,</span>			<span class="cm">/* inode is in dirty_files list */</span>
	<span class="n">NILFS_I_BUSY</span><span class="p">,</span>			<span class="cm">/* inode is grabbed by a segment</span>
<span class="cm">					   constructor */</span>
	<span class="n">NILFS_I_COLLECTED</span><span class="p">,</span>		<span class="cm">/* All dirty blocks are collected */</span>
	<span class="n">NILFS_I_UPDATED</span><span class="p">,</span>		<span class="cm">/* The file has been written back */</span>
	<span class="n">NILFS_I_INODE_DIRTY</span><span class="p">,</span>		<span class="cm">/* write_inode is requested */</span>
	<span class="n">NILFS_I_BMAP</span><span class="p">,</span>			<span class="cm">/* has bmap and btnode_cache */</span>
	<span class="n">NILFS_I_GCINODE</span><span class="p">,</span>		<span class="cm">/* inode for GC, on memory only */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * commit flags for nilfs_commit_super and nilfs_sync_super</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">NILFS_SB_COMMIT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* Commit a super block alternately */</span>
	<span class="n">NILFS_SB_COMMIT_ALL</span>	<span class="cm">/* Commit both super blocks */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Macros to check inode numbers</span>
<span class="cm"> */</span>
<span class="cp">#define NILFS_MDT_INO_BITS   \</span>
<span class="cp">	((unsigned int)(1 &lt;&lt; NILFS_DAT_INO | 1 &lt;&lt; NILFS_CPFILE_INO |	\</span>
<span class="cp">			1 &lt;&lt; NILFS_SUFILE_INO | 1 &lt;&lt; NILFS_IFILE_INO |	\</span>
<span class="cp">			1 &lt;&lt; NILFS_ATIME_INO | 1 &lt;&lt; NILFS_SKETCH_INO))</span>

<span class="cp">#define NILFS_SYS_INO_BITS   \</span>
<span class="cp">	((unsigned int)(1 &lt;&lt; NILFS_ROOT_INO) | NILFS_MDT_INO_BITS)</span>

<span class="cp">#define NILFS_FIRST_INO(sb) (((struct the_nilfs *)sb-&gt;s_fs_info)-&gt;ns_first_ino)</span>

<span class="cp">#define NILFS_MDT_INODE(sb, ino) \</span>
<span class="cp">	((ino) &lt; NILFS_FIRST_INO(sb) &amp;&amp; (NILFS_MDT_INO_BITS &amp; (1 &lt;&lt; (ino))))</span>
<span class="cp">#define NILFS_VALID_INODE(sb, ino) \</span>
<span class="cp">	((ino) &gt;= NILFS_FIRST_INO(sb) || (NILFS_SYS_INO_BITS &amp; (1 &lt;&lt; (ino))))</span>

<span class="cm">/**</span>
<span class="cm"> * struct nilfs_transaction_info: context information for synchronization</span>
<span class="cm"> * @ti_magic: Magic number</span>
<span class="cm"> * @ti_save: Backup of journal_info field of task_struct</span>
<span class="cm"> * @ti_flags: Flags</span>
<span class="cm"> * @ti_count: Nest level</span>
<span class="cm"> * @ti_garbage:	List of inode to be put when releasing semaphore</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">nilfs_transaction_info</span> <span class="p">{</span>
	<span class="n">u32</span>			<span class="n">ti_magic</span><span class="p">;</span>
	<span class="kt">void</span>		       <span class="o">*</span><span class="n">ti_save</span><span class="p">;</span>
				<span class="cm">/* This should never used. If this happens,</span>
<span class="cm">				   one of other filesystems has a bug. */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">ti_flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>		<span class="n">ti_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">ti_garbage</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* ti_magic */</span>
<span class="cp">#define NILFS_TI_MAGIC		0xd9e392fb</span>

<span class="cm">/* ti_flags */</span>
<span class="cp">#define NILFS_TI_DYNAMIC_ALLOC	0x0001  </span><span class="cm">/* Allocated from slab */</span><span class="cp"></span>
<span class="cp">#define NILFS_TI_SYNC		0x0002	</span><span class="cm">/* Force to construct segment at the</span>
<span class="cm">					   end of transaction. */</span><span class="cp"></span>
<span class="cp">#define NILFS_TI_GC		0x0004	</span><span class="cm">/* GC context */</span><span class="cp"></span>
<span class="cp">#define NILFS_TI_COMMIT		0x0008	</span><span class="cm">/* Change happened or not */</span><span class="cp"></span>
<span class="cp">#define NILFS_TI_WRITER		0x0010	</span><span class="cm">/* Constructor context */</span><span class="cp"></span>


<span class="kt">int</span> <span class="n">nilfs_transaction_begin</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">nilfs_transaction_info</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_transaction_commit</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">nilfs_transaction_abort</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">nilfs_set_transaction_flag</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flag</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">nilfs_transaction_info</span> <span class="o">*</span><span class="n">ti</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">journal_info</span><span class="p">;</span>

	<span class="n">ti</span><span class="o">-&gt;</span><span class="n">ti_flags</span> <span class="o">|=</span> <span class="n">flag</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">nilfs_test_transaction_flag</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flag</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">nilfs_transaction_info</span> <span class="o">*</span><span class="n">ti</span> <span class="o">=</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">journal_info</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ti</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">ti</span><span class="o">-&gt;</span><span class="n">ti_magic</span> <span class="o">!=</span> <span class="n">NILFS_TI_MAGIC</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="n">ti</span><span class="o">-&gt;</span><span class="n">ti_flags</span> <span class="o">&amp;</span> <span class="n">flag</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">nilfs_doing_gc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">nilfs_test_transaction_flag</span><span class="p">(</span><span class="n">NILFS_TI_GC</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">nilfs_doing_construction</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">nilfs_test_transaction_flag</span><span class="p">(</span><span class="n">NILFS_TI_WRITER</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * function prototype</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_NILFS_POSIX_ACL</span>
<span class="cp">#error &quot;NILFS: not yet supported POSIX ACL&quot;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_acl_chmod</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_init_acl</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">nilfs_acl_chmod</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">nilfs_init_acl</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">dir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_mode</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">current_umask</span><span class="p">();</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#define NILFS_ATIME_DISABLE</span>

<span class="cm">/* Flags that should be inherited by new inodes from their parent. */</span>
<span class="cp">#define NILFS_FL_INHERITED						\</span>
<span class="cp">	(FS_SECRM_FL | FS_UNRM_FL | FS_COMPR_FL | FS_SYNC_FL |		\</span>
<span class="cp">	 FS_IMMUTABLE_FL | FS_APPEND_FL | FS_NODUMP_FL | FS_NOATIME_FL |\</span>
<span class="cp">	 FS_COMPRBLK_FL | FS_NOCOMP_FL | FS_NOTAIL_FL | FS_DIRSYNC_FL)</span>

<span class="cm">/* Mask out flags that are inappropriate for the given type of inode. */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">__u32</span> <span class="nf">nilfs_mask_flags</span><span class="p">(</span><span class="n">umode_t</span> <span class="n">mode</span><span class="p">,</span> <span class="n">__u32</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">S_ISDIR</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">S_ISREG</span><span class="p">(</span><span class="n">mode</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">FS_DIRSYNC_FL</span> <span class="o">|</span> <span class="n">FS_TOPDIR_FL</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="n">flags</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FS_NODUMP_FL</span> <span class="o">|</span> <span class="n">FS_NOATIME_FL</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* dir.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_add_link</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">ino_t</span> <span class="n">nilfs_inode_by_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_make_empty</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">nilfs_dir_entry</span> <span class="o">*</span>
<span class="n">nilfs_find_entry</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_delete_entry</span><span class="p">(</span><span class="k">struct</span> <span class="n">nilfs_dir_entry</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">page</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_empty_dir</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">nilfs_dir_entry</span> <span class="o">*</span><span class="n">nilfs_dotdot</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">page</span> <span class="o">**</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nilfs_set_link</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nilfs_dir_entry</span> <span class="o">*</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">page</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>

<span class="cm">/* file.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_sync_file</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">,</span> <span class="n">loff_t</span><span class="p">,</span> <span class="n">loff_t</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

<span class="cm">/* ioctl.c */</span>
<span class="kt">long</span> <span class="n">nilfs_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>
<span class="kt">long</span> <span class="n">nilfs_compat_ioctl</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_ioctl_prepare_clean_segments</span><span class="p">(</span><span class="k">struct</span> <span class="n">the_nilfs</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nilfs_argv</span> <span class="o">*</span><span class="p">,</span>
				       <span class="kt">void</span> <span class="o">**</span><span class="p">);</span>

<span class="cm">/* inode.c */</span>
<span class="kt">void</span> <span class="n">nilfs_inode_add_blocks</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">nilfs_inode_sub_blocks</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">nilfs_new_inode</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="n">umode_t</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nilfs_free_inode</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_get_block</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="n">sector_t</span><span class="p">,</span> <span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nilfs_set_inode_flags</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_read_inode_common</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nilfs_inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nilfs_write_inode_common</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nilfs_inode</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">nilfs_ilookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nilfs_root</span> <span class="o">*</span><span class="n">root</span><span class="p">,</span>
			    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ino</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">nilfs_iget_locked</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nilfs_root</span> <span class="o">*</span><span class="n">root</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ino</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">nilfs_iget</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nilfs_root</span> <span class="o">*</span><span class="n">root</span><span class="p">,</span>
			 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ino</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">nilfs_iget_for_gc</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span>
				       <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ino</span><span class="p">,</span> <span class="n">__u64</span> <span class="n">cno</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nilfs_update_inode</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nilfs_truncate</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nilfs_evict_inode</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_setattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">iattr</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_permission</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_load_inode_block</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">**</span><span class="n">pbh</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_inode_dirty</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_set_file_dirty</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">nr_dirty</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_mark_inode_dirty</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nilfs_dirty_inode</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_fiemap</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">fiemap_extent_info</span> <span class="o">*</span><span class="n">fieinfo</span><span class="p">,</span>
		 <span class="n">__u64</span> <span class="n">start</span><span class="p">,</span> <span class="n">__u64</span> <span class="n">len</span><span class="p">);</span>

<span class="cm">/* super.c */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">nilfs_alloc_inode</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nilfs_destroy_inode</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__printf</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="kt">void</span> <span class="n">nilfs_error</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="p">...);</span>
<span class="k">extern</span> <span class="n">__printf</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="kt">void</span> <span class="n">nilfs_warning</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="p">...);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">nilfs_super_block</span> <span class="o">*</span>
<span class="n">nilfs_read_super_block</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">**</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_store_magic_and_option</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">nilfs_super_block</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nilfs_check_feature_compatibility</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">nilfs_super_block</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">nilfs_set_log_cursor</span><span class="p">(</span><span class="k">struct</span> <span class="n">nilfs_super_block</span> <span class="o">*</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">the_nilfs</span> <span class="o">*</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">nilfs_super_block</span> <span class="o">**</span><span class="n">nilfs_prepare_super</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span>
					       <span class="kt">int</span> <span class="n">flip</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_commit_super</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flag</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_cleanup_super</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_resize_fs</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span> <span class="n">__u64</span> <span class="n">newsize</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_attach_checkpoint</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span> <span class="n">__u64</span> <span class="n">cno</span><span class="p">,</span> <span class="kt">int</span> <span class="n">curr_mnt</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">nilfs_root</span> <span class="o">**</span><span class="n">root</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_checkpoint_is_mounted</span><span class="p">(</span><span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sb</span><span class="p">,</span> <span class="n">__u64</span> <span class="n">cno</span><span class="p">);</span>

<span class="cm">/* gcinode.c */</span>
<span class="kt">int</span> <span class="n">nilfs_gccache_submit_read_data</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="n">sector_t</span><span class="p">,</span> <span class="n">sector_t</span><span class="p">,</span> <span class="n">__u64</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">**</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_gccache_submit_read_node</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="p">,</span> <span class="n">sector_t</span><span class="p">,</span> <span class="n">__u64</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">**</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_gccache_wait_and_mark_dirty</span><span class="p">(</span><span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">nilfs_init_gcinode</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">nilfs_remove_all_gcinodes</span><span class="p">(</span><span class="k">struct</span> <span class="n">the_nilfs</span> <span class="o">*</span><span class="n">nilfs</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Inodes and files operations</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">nilfs_dir_operations</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">inode_operations</span> <span class="n">nilfs_file_inode_operations</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">nilfs_file_operations</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">address_space_operations</span> <span class="n">nilfs_aops</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">inode_operations</span> <span class="n">nilfs_dir_inode_operations</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">inode_operations</span> <span class="n">nilfs_special_inode_operations</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">inode_operations</span> <span class="n">nilfs_symlink_inode_operations</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * filesystem type</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">file_system_type</span> <span class="n">nilfs_fs_type</span><span class="p">;</span>


<span class="cp">#endif	</span><span class="cm">/* _NILFS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
