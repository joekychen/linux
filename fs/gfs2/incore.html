<!DOCTYPE html>
<html><head><title>joekychen/linux » fs › gfs2 › incore.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>incore.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) Sistina Software, Inc.  1997-2003 All rights reserved.</span>
<span class="cm"> * Copyright (C) 2004-2008 Red Hat, Inc.  All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> * This copyrighted material is made available to anyone wishing to use,</span>
<span class="cm"> * modify, copy, or redistribute it subject to the terms and conditions</span>
<span class="cm"> * of the GNU General Public License version 2.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __INCORE_DOT_H__</span>
<span class="cp">#define __INCORE_DOT_H__</span>

<span class="cp">#include &lt;linux/fs.h&gt;</span>
<span class="cp">#include &lt;linux/kobject.h&gt;</span>
<span class="cp">#include &lt;linux/workqueue.h&gt;</span>
<span class="cp">#include &lt;linux/dlm.h&gt;</span>
<span class="cp">#include &lt;linux/buffer_head.h&gt;</span>
<span class="cp">#include &lt;linux/rcupdate.h&gt;</span>
<span class="cp">#include &lt;linux/rculist_bl.h&gt;</span>
<span class="cp">#include &lt;linux/completion.h&gt;</span>
<span class="cp">#include &lt;linux/rbtree.h&gt;</span>
<span class="cp">#include &lt;linux/ktime.h&gt;</span>
<span class="cp">#include &lt;linux/percpu.h&gt;</span>

<span class="cp">#define DIO_WAIT	0x00000010</span>
<span class="cp">#define DIO_METADATA	0x00000020</span>

<span class="k">struct</span> <span class="n">gfs2_log_operations</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">gfs2_bufdata</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">gfs2_holder</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">gfs2_glock</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">gfs2_quota_data</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">gfs2_trans</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">gfs2_ail</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">gfs2_jdesc</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">gfs2_sbd</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">lm_lockops</span><span class="p">;</span>

<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">gfs2_glop_bh_t</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">gl</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ret</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">gfs2_log_header_host</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">lh_sequence</span><span class="p">;</span>	<span class="cm">/* Sequence number of this transaction */</span>
	<span class="n">u32</span> <span class="n">lh_flags</span><span class="p">;</span>		<span class="cm">/* GFS2_LOG_HEAD_... */</span>
	<span class="n">u32</span> <span class="n">lh_tail</span><span class="p">;</span>		<span class="cm">/* Block number of log tail */</span>
	<span class="n">u32</span> <span class="n">lh_blkno</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">lh_hash</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Structure of operations that are associated with each</span>
<span class="cm"> * type of element in the log.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">gfs2_log_operations</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">lo_add</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_sbd</span> <span class="o">*</span><span class="n">sdp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">gfs2_bufdata</span> <span class="o">*</span><span class="n">bd</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">lo_before_commit</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_sbd</span> <span class="o">*</span><span class="n">sdp</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">lo_after_commit</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_sbd</span> <span class="o">*</span><span class="n">sdp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">gfs2_ail</span> <span class="o">*</span><span class="n">ai</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">lo_before_scan</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_jdesc</span> <span class="o">*</span><span class="n">jd</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">gfs2_log_header_host</span> <span class="o">*</span><span class="n">head</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pass</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">lo_scan_elements</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_jdesc</span> <span class="o">*</span><span class="n">jd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">start</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">gfs2_log_descriptor</span> <span class="o">*</span><span class="n">ld</span><span class="p">,</span> <span class="n">__be64</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span>
				 <span class="kt">int</span> <span class="n">pass</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">lo_after_scan</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_jdesc</span> <span class="o">*</span><span class="n">jd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">error</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pass</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">lo_name</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define GBF_FULL 1</span>

<span class="k">struct</span> <span class="n">gfs2_bitmap</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">*</span><span class="n">bi_bh</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">bi_clone</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bi_flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bi_offset</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bi_start</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bi_len</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_rgrpd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">rb_node</span> <span class="n">rd_node</span><span class="p">;</span>		<span class="cm">/* Link with superblock */</span>
	<span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">rd_gl</span><span class="p">;</span>	<span class="cm">/* Glock for this rgrp */</span>
	<span class="n">u64</span> <span class="n">rd_addr</span><span class="p">;</span>			<span class="cm">/* grp block disk address */</span>
	<span class="n">u64</span> <span class="n">rd_data0</span><span class="p">;</span>			<span class="cm">/* first data location */</span>
	<span class="n">u32</span> <span class="n">rd_length</span><span class="p">;</span>			<span class="cm">/* length of rgrp header in fs blocks */</span>
	<span class="n">u32</span> <span class="n">rd_data</span><span class="p">;</span>			<span class="cm">/* num of data blocks in rgrp */</span>
	<span class="n">u32</span> <span class="n">rd_bitbytes</span><span class="p">;</span>		<span class="cm">/* number of bytes in data bitmaps */</span>
	<span class="n">u32</span> <span class="n">rd_free</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rd_free_clone</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rd_dinodes</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">rd_igeneration</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_bitmap</span> <span class="o">*</span><span class="n">rd_bits</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_sbd</span> <span class="o">*</span><span class="n">rd_sbd</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rd_last_alloc</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rd_flags</span><span class="p">;</span>
<span class="cp">#define GFS2_RDF_CHECK		0x10000000 </span><span class="cm">/* check for unlinked inodes */</span><span class="cp"></span>
<span class="cp">#define GFS2_RDF_UPTODATE	0x20000000 </span><span class="cm">/* rg is up to date */</span><span class="cp"></span>
<span class="cp">#define GFS2_RDF_ERROR		0x40000000 </span><span class="cm">/* error in rg */</span><span class="cp"></span>
<span class="cp">#define GFS2_RDF_MASK		0xf0000000 </span><span class="cm">/* mask for internal flags */</span><span class="cp"></span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">gfs2_state_bits</span> <span class="p">{</span>
	<span class="n">BH_Pinned</span> <span class="o">=</span> <span class="n">BH_PrivateStart</span><span class="p">,</span>
	<span class="n">BH_Escaped</span> <span class="o">=</span> <span class="n">BH_PrivateStart</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">BH_Zeronew</span> <span class="o">=</span> <span class="n">BH_PrivateStart</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">BUFFER_FNS</span><span class="p">(</span><span class="n">Pinned</span><span class="p">,</span> <span class="n">pinned</span><span class="p">)</span>
<span class="n">TAS_BUFFER_FNS</span><span class="p">(</span><span class="n">Pinned</span><span class="p">,</span> <span class="n">pinned</span><span class="p">)</span>
<span class="n">BUFFER_FNS</span><span class="p">(</span><span class="n">Escaped</span><span class="p">,</span> <span class="n">escaped</span><span class="p">)</span>
<span class="n">TAS_BUFFER_FNS</span><span class="p">(</span><span class="n">Escaped</span><span class="p">,</span> <span class="n">escaped</span><span class="p">)</span>
<span class="n">BUFFER_FNS</span><span class="p">(</span><span class="n">Zeronew</span><span class="p">,</span> <span class="n">zeronew</span><span class="p">)</span>
<span class="n">TAS_BUFFER_FNS</span><span class="p">(</span><span class="n">Zeronew</span><span class="p">,</span> <span class="n">zeronew</span><span class="p">)</span>

<span class="k">struct</span> <span class="n">gfs2_bufdata</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">*</span><span class="n">bd_bh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">bd_gl</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bd_blkno</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">bd_list</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">gfs2_log_operations</span> <span class="o">*</span><span class="n">bd_ops</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">gfs2_ail</span> <span class="o">*</span><span class="n">bd_ail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">bd_ail_st_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">bd_ail_gl_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Internally, we prefix things with gdlm_ and GDLM_ (for gfs-dlm) since a</span>
<span class="cm"> * prefix of lock_dlm_ gets awkward.</span>
<span class="cm"> */</span>

<span class="cp">#define GDLM_STRNAME_BYTES	25</span>
<span class="cp">#define GDLM_LVB_SIZE		32</span>

<span class="cm">/*</span>
<span class="cm"> * ls_recover_flags:</span>
<span class="cm"> *</span>
<span class="cm"> * DFL_BLOCK_LOCKS: dlm is in recovery and will grant locks that had been</span>
<span class="cm"> * held by failed nodes whose journals need recovery.  Those locks should</span>
<span class="cm"> * only be used for journal recovery until the journal recovery is done.</span>
<span class="cm"> * This is set by the dlm recover_prep callback and cleared by the</span>
<span class="cm"> * gfs2_control thread when journal recovery is complete.  To avoid</span>
<span class="cm"> * races between recover_prep setting and gfs2_control clearing, recover_spin</span>
<span class="cm"> * is held while changing this bit and reading/writing recover_block</span>
<span class="cm"> * and recover_start.</span>
<span class="cm"> *</span>
<span class="cm"> * DFL_NO_DLM_OPS: dlm lockspace ops/callbacks are not being used.</span>
<span class="cm"> *</span>
<span class="cm"> * DFL_FIRST_MOUNT: this node is the first to mount this fs and is doing</span>
<span class="cm"> * recovery of all journals before allowing other nodes to mount the fs.</span>
<span class="cm"> * This is cleared when FIRST_MOUNT_DONE is set.</span>
<span class="cm"> *</span>
<span class="cm"> * DFL_FIRST_MOUNT_DONE: this node was the first mounter, and has finished</span>
<span class="cm"> * recovery of all journals, and now allows other nodes to mount the fs.</span>
<span class="cm"> *</span>
<span class="cm"> * DFL_MOUNT_DONE: gdlm_mount has completed successfully and cleared</span>
<span class="cm"> * BLOCK_LOCKS for the first time.  The gfs2_control thread should now</span>
<span class="cm"> * control clearing BLOCK_LOCKS for further recoveries.</span>
<span class="cm"> *</span>
<span class="cm"> * DFL_UNMOUNT: gdlm_unmount sets to keep sdp off gfs2_control_wq.</span>
<span class="cm"> *</span>
<span class="cm"> * DFL_DLM_RECOVERY: set while dlm is in recovery, between recover_prep()</span>
<span class="cm"> * and recover_done(), i.e. set while recover_block == recover_start.</span>
<span class="cm"> */</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">DFL_BLOCK_LOCKS</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">DFL_NO_DLM_OPS</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">DFL_FIRST_MOUNT</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">DFL_FIRST_MOUNT_DONE</span>	<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">DFL_MOUNT_DONE</span>		<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">DFL_UNMOUNT</span>		<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">DFL_DLM_RECOVERY</span>	<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">lm_lockname</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">ln_number</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ln_type</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define lm_name_equal(name1, name2) \</span>
<span class="cp">        (((name1)-&gt;ln_number == (name2)-&gt;ln_number) &amp;&amp; \</span>
<span class="cp">         ((name1)-&gt;ln_type == (name2)-&gt;ln_type))</span>


<span class="k">struct</span> <span class="n">gfs2_glock_operations</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">go_xmote_th</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">gl</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">go_xmote_bh</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">gl</span><span class="p">,</span> <span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="o">*</span><span class="n">gh</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">go_inval</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">gl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">go_demote_ok</span><span class="p">)</span> <span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">gl</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">go_lock</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="o">*</span><span class="n">gh</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">go_unlock</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="o">*</span><span class="n">gh</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">go_dump</span><span class="p">)(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">seq</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">gl</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">go_callback</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">gl</span><span class="p">);</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="n">go_type</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">go_flags</span><span class="p">;</span>
<span class="cp">#define GLOF_ASPACE 1</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">GFS2_LKS_SRTT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* Non blocking smoothed round trip time */</span>
	<span class="n">GFS2_LKS_SRTTVAR</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Non blocking smoothed variance */</span>
	<span class="n">GFS2_LKS_SRTTB</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Blocking smoothed round trip time */</span>
	<span class="n">GFS2_LKS_SRTTVARB</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>	<span class="cm">/* Blocking smoothed variance */</span>
	<span class="n">GFS2_LKS_SIRT</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Smoothed Inter-request time */</span>
	<span class="n">GFS2_LKS_SIRTVAR</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>	<span class="cm">/* Smoothed Inter-request variance */</span>
	<span class="n">GFS2_LKS_DCOUNT</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>	<span class="cm">/* Count of dlm requests */</span>
	<span class="n">GFS2_LKS_QCOUNT</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>	<span class="cm">/* Count of gfs2_holder queues */</span>
	<span class="n">GFS2_NR_LKSTATS</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_lkstats</span> <span class="p">{</span>
	<span class="n">s64</span> <span class="n">stats</span><span class="p">[</span><span class="n">GFS2_NR_LKSTATS</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="cm">/* States */</span>
	<span class="n">HIF_HOLDER</span>		<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>  <span class="cm">/* Set for gh that &quot;holds&quot; the glock */</span>
	<span class="n">HIF_FIRST</span>		<span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">HIF_WAIT</span>		<span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">gh_list</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">gh_gl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pid</span> <span class="o">*</span><span class="n">gh_owner_pid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gh_state</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">gh_flags</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">gh_error</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gh_iflags</span><span class="p">;</span> <span class="cm">/* HIF_... */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gh_ip</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">GLF_LOCK</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">GLF_DEMOTE</span>			<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">GLF_PENDING_DEMOTE</span>		<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">GLF_DEMOTE_IN_PROGRESS</span>		<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">GLF_DIRTY</span>			<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">GLF_LFLUSH</span>			<span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
	<span class="n">GLF_INVALIDATE_IN_PROGRESS</span>	<span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="n">GLF_REPLY_PENDING</span>		<span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
	<span class="n">GLF_INITIAL</span>			<span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
	<span class="n">GLF_FROZEN</span>			<span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
	<span class="n">GLF_QUEUED</span>			<span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
	<span class="n">GLF_LRU</span>				<span class="o">=</span> <span class="mi">13</span><span class="p">,</span>
	<span class="n">GLF_OBJECT</span>			<span class="o">=</span> <span class="mi">14</span><span class="p">,</span> <span class="cm">/* Used only for tracing */</span>
	<span class="n">GLF_BLOCKING</span>			<span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">hlist_bl_node</span> <span class="n">gl_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_sbd</span> <span class="o">*</span><span class="n">gl_sbd</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gl_flags</span><span class="p">;</span>		<span class="cm">/* GLF_... */</span>
	<span class="k">struct</span> <span class="n">lm_lockname</span> <span class="n">gl_name</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">gl_ref</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">gl_spin</span><span class="p">;</span>

	<span class="cm">/* State fields protected by gl_spin */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gl_state</span><span class="o">:</span><span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Current state */</span>
		     <span class="nl">gl_target:</span><span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Target state */</span>
		     <span class="nl">gl_demote_state:</span><span class="mi">2</span><span class="p">,</span>	<span class="cm">/* State requested by remote node */</span>
		     <span class="nl">gl_req:</span><span class="mi">2</span><span class="p">,</span>		<span class="cm">/* State in last dlm request */</span>
		     <span class="nl">gl_reply:</span><span class="mi">8</span><span class="p">;</span>	<span class="cm">/* Last reply from the dlm */</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gl_hash</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gl_demote_time</span><span class="p">;</span> <span class="cm">/* time of first demote request */</span>
	<span class="kt">long</span> <span class="n">gl_hold_time</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">gl_holders</span><span class="p">;</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">gfs2_glock_operations</span> <span class="o">*</span><span class="n">gl_ops</span><span class="p">;</span>
	<span class="n">ktime_t</span> <span class="n">gl_dstamp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_lkstats</span> <span class="n">gl_stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dlm_lksb</span> <span class="n">gl_lksb</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">gl_lvb</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gl_tchange</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">gl_object</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">gl_lru</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">gl_ail_list</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">gl_ail_count</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">gl_revokes</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">gl_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">gl_delete</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rcu_head</span> <span class="n">gl_rcu</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define GFS2_MIN_LVB_SIZE 32	</span><span class="cm">/* Min size of LVB that gfs2 supports */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">gfs2_qadata</span> <span class="p">{</span> <span class="cm">/* quota allocation data */</span>
	<span class="cm">/* Quota stuff */</span>
	<span class="k">struct</span> <span class="n">gfs2_quota_data</span> <span class="o">*</span><span class="n">qa_qd</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">MAXQUOTAS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">qa_qd_ghs</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">MAXQUOTAS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">qa_qd_num</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_blkreserv</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">rs_requested</span><span class="p">;</span> <span class="cm">/* Filled in by caller of gfs2_inplace_reserve() */</span>
	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">rs_rgd_gh</span><span class="p">;</span> <span class="cm">/* Filled in by gfs2_inplace_reserve() */</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">GIF_INVALID</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">GIF_QD_LOCKED</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">GIF_ALLOC_FAILED</span>	<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">GIF_SW_PAGED</span>		<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">gfs2_inode</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">inode</span> <span class="n">i_inode</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">i_no_addr</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">i_no_formal_ino</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">i_generation</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">i_eattr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i_flags</span><span class="p">;</span>		<span class="cm">/* GIF_... */</span>
	<span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">i_gl</span><span class="p">;</span> <span class="cm">/* Move into i_gh? */</span>
	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">i_iopen_gh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">i_gh</span><span class="p">;</span> <span class="cm">/* for prepare/commit_write only */</span>
	<span class="k">struct</span> <span class="n">gfs2_qadata</span> <span class="o">*</span><span class="n">i_qadata</span><span class="p">;</span> <span class="cm">/* quota allocation data */</span>
	<span class="k">struct</span> <span class="n">gfs2_blkreserv</span> <span class="o">*</span><span class="n">i_res</span><span class="p">;</span> <span class="cm">/* resource group block reservation */</span>
	<span class="k">struct</span> <span class="n">gfs2_rgrpd</span> <span class="o">*</span><span class="n">i_rgd</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">i_goal</span><span class="p">;</span>	<span class="cm">/* goal block for allocations */</span>
	<span class="k">struct</span> <span class="n">rw_semaphore</span> <span class="n">i_rw_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">i_trunc_list</span><span class="p">;</span>
	<span class="n">__be64</span> <span class="o">*</span><span class="n">i_hash_cache</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i_entries</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i_diskflags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">i_height</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">i_depth</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Since i_inode is the first element of struct gfs2_inode,</span>
<span class="cm"> * this is effectively a cast.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">gfs2_inode</span> <span class="o">*</span><span class="nf">GFS2_I</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">gfs2_inode</span><span class="p">,</span> <span class="n">i_inode</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">gfs2_sbd</span> <span class="o">*</span><span class="nf">GFS2_SB</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_sb</span><span class="o">-&gt;</span><span class="n">s_fs_info</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">gfs2_file</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">f_fl_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">f_fl_gh</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_revoke_replay</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">rr_list</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">rr_blkno</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rr_where</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">QDF_USER</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">QDF_CHANGE</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">QDF_LOCKED</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">QDF_REFRESH</span>		<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_quota_data</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">qd_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">qd_reclaim</span><span class="p">;</span>

	<span class="n">atomic_t</span> <span class="n">qd_count</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">qd_id</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">qd_flags</span><span class="p">;</span>		<span class="cm">/* QDF_... */</span>

	<span class="n">s64</span> <span class="n">qd_change</span><span class="p">;</span>
	<span class="n">s64</span> <span class="n">qd_change_sync</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">qd_slot</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">qd_slot_count</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">buffer_head</span> <span class="o">*</span><span class="n">qd_bh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_quota_change</span> <span class="o">*</span><span class="n">qd_bh_qc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">qd_bh_count</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">qd_gl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_quota_lvb</span> <span class="n">qd_qb</span><span class="p">;</span>

	<span class="n">u64</span> <span class="n">qd_sync_gen</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">qd_last_warn</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_trans</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tr_ip</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tr_blocks</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tr_revokes</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tr_reserved</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">tr_t_gh</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">tr_touched</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tr_num_buf_new</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tr_num_databuf_new</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tr_num_buf_rm</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tr_num_databuf_rm</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tr_num_revoke</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tr_num_revoke_rm</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_ail</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">ai_list</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ai_first</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">ai_ail1_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">ai_ail2_list</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_journal_extent</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">extent_list</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lblock</span><span class="p">;</span> <span class="cm">/* First logical block */</span>
	<span class="n">u64</span> <span class="n">dblock</span><span class="p">;</span> <span class="cm">/* First disk block */</span>
	<span class="n">u64</span> <span class="n">blocks</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_jdesc</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">jd_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">extent_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">jd_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">jd_inode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">jd_flags</span><span class="p">;</span>
<span class="cp">#define JDF_RECOVERY 1</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">jd_jid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">jd_blocks</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">jd_recover_error</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_statfs_change_host</span> <span class="p">{</span>
	<span class="n">s64</span> <span class="n">sc_total</span><span class="p">;</span>
	<span class="n">s64</span> <span class="n">sc_free</span><span class="p">;</span>
	<span class="n">s64</span> <span class="n">sc_dinodes</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define GFS2_QUOTA_DEFAULT	GFS2_QUOTA_OFF</span>
<span class="cp">#define GFS2_QUOTA_OFF		0</span>
<span class="cp">#define GFS2_QUOTA_ACCOUNT	1</span>
<span class="cp">#define GFS2_QUOTA_ON		2</span>

<span class="cp">#define GFS2_DATA_DEFAULT	GFS2_DATA_ORDERED</span>
<span class="cp">#define GFS2_DATA_WRITEBACK	1</span>
<span class="cp">#define GFS2_DATA_ORDERED	2</span>

<span class="cp">#define GFS2_ERRORS_DEFAULT     GFS2_ERRORS_WITHDRAW</span>
<span class="cp">#define GFS2_ERRORS_WITHDRAW    0</span>
<span class="cp">#define GFS2_ERRORS_CONTINUE    1 </span><span class="cm">/* place holder for future feature */</span><span class="cp"></span>
<span class="cp">#define GFS2_ERRORS_RO          2 </span><span class="cm">/* place holder for future feature */</span><span class="cp"></span>
<span class="cp">#define GFS2_ERRORS_PANIC       3</span>

<span class="k">struct</span> <span class="n">gfs2_args</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">ar_lockproto</span><span class="p">[</span><span class="n">GFS2_LOCKNAME_LEN</span><span class="p">];</span>	<span class="cm">/* Name of the Lock Protocol */</span>
	<span class="kt">char</span> <span class="n">ar_locktable</span><span class="p">[</span><span class="n">GFS2_LOCKNAME_LEN</span><span class="p">];</span>	<span class="cm">/* Name of the Lock Table */</span>
	<span class="kt">char</span> <span class="n">ar_hostdata</span><span class="p">[</span><span class="n">GFS2_LOCKNAME_LEN</span><span class="p">];</span>	<span class="cm">/* Host specific data */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_spectator</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Don&#39;t get a journal */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_localflocks</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Let the VFS do flock|fcntl */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_debug</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Oops on errors */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_posix_acl</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* Enable posix acls */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_quota</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>		<span class="cm">/* off/account/on */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_suiddir</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* suiddir support */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_data</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>			<span class="cm">/* ordered/writeback */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_meta</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>			<span class="cm">/* mount metafs */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_discard</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>		<span class="cm">/* discard requests */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_errors</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>               <span class="cm">/* errors=withdraw | panic */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ar_nobarrier</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>            <span class="cm">/* do not send barriers */</span>
	<span class="kt">int</span> <span class="n">ar_commit</span><span class="p">;</span>				<span class="cm">/* Commit interval */</span>
	<span class="kt">int</span> <span class="n">ar_statfs_quantum</span><span class="p">;</span>			<span class="cm">/* The fast statfs interval */</span>
	<span class="kt">int</span> <span class="n">ar_quota_quantum</span><span class="p">;</span>			<span class="cm">/* The quota interval */</span>
	<span class="kt">int</span> <span class="n">ar_statfs_percent</span><span class="p">;</span>			<span class="cm">/* The % change to force sync */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_tune</span> <span class="p">{</span>
	<span class="n">spinlock_t</span> <span class="n">gt_spin</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_logd_secs</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_quota_simul_sync</span><span class="p">;</span> <span class="cm">/* Max quotavals to sync at once */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_quota_warn_period</span><span class="p">;</span> <span class="cm">/* Secs between quota warn msgs */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_quota_scale_num</span><span class="p">;</span> <span class="cm">/* Numerator */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_quota_scale_den</span><span class="p">;</span> <span class="cm">/* Denominator */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_quota_quantum</span><span class="p">;</span> <span class="cm">/* Secs between syncs to quota file */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_new_files_jdata</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_max_readahead</span><span class="p">;</span> <span class="cm">/* Max bytes to read-ahead from disk */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_complain_secs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_statfs_quantum</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">gt_statfs_slow</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">SDF_JOURNAL_CHECKED</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SDF_JOURNAL_LIVE</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">SDF_SHUTDOWN</span>		<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">SDF_NOBARRIERS</span>		<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">SDF_NORECOVERY</span>		<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">SDF_DEMOTE</span>		<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">SDF_NOJOURNALID</span>		<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">SDF_RORECOVERY</span>		<span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="cm">/* read only recovery */</span>
<span class="p">};</span>

<span class="cp">#define GFS2_FSNAME_LEN		256</span>

<span class="k">struct</span> <span class="n">gfs2_inum_host</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">no_formal_ino</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">no_addr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_sb_host</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">sb_magic</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sb_type</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sb_format</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">sb_fs_format</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sb_multihost_format</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sb_bsize</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sb_bsize_shift</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">gfs2_inum_host</span> <span class="n">sb_master_dir</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_inum_host</span> <span class="n">sb_root_dir</span><span class="p">;</span>

	<span class="kt">char</span> <span class="n">sb_lockproto</span><span class="p">[</span><span class="n">GFS2_LOCKNAME_LEN</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">sb_locktable</span><span class="p">[</span><span class="n">GFS2_LOCKNAME_LEN</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * lm_mount() return values</span>
<span class="cm"> *</span>
<span class="cm"> * ls_jid - the journal ID this node should use</span>
<span class="cm"> * ls_first - this node is the first to mount the file system</span>
<span class="cm"> * ls_lockspace - lock module&#39;s context for this file system</span>
<span class="cm"> * ls_ops - lock module&#39;s functions</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">lm_lockstruct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">ls_jid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ls_first</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">lm_lockops</span> <span class="o">*</span><span class="n">ls_ops</span><span class="p">;</span>
	<span class="n">dlm_lockspace_t</span> <span class="o">*</span><span class="n">ls_dlm</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">ls_recover_jid_done</span><span class="p">;</span>   <span class="cm">/* These two are deprecated, */</span>
	<span class="kt">int</span> <span class="n">ls_recover_jid_status</span><span class="p">;</span> <span class="cm">/* used previously by gfs_controld */</span>

	<span class="k">struct</span> <span class="n">dlm_lksb</span> <span class="n">ls_mounted_lksb</span><span class="p">;</span> <span class="cm">/* mounted_lock */</span>
	<span class="k">struct</span> <span class="n">dlm_lksb</span> <span class="n">ls_control_lksb</span><span class="p">;</span> <span class="cm">/* control_lock */</span>
	<span class="kt">char</span> <span class="n">ls_control_lvb</span><span class="p">[</span><span class="n">GDLM_LVB_SIZE</span><span class="p">];</span> <span class="cm">/* control_lock lvb */</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">ls_sync_wait</span><span class="p">;</span> <span class="cm">/* {control,mounted}_{lock,unlock} */</span>

	<span class="n">spinlock_t</span> <span class="n">ls_recover_spin</span><span class="p">;</span> <span class="cm">/* protects following fields */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ls_recover_flags</span><span class="p">;</span> <span class="cm">/* DFL_ */</span>
	<span class="kt">uint32_t</span> <span class="n">ls_recover_mount</span><span class="p">;</span> <span class="cm">/* gen in first recover_done cb */</span>
	<span class="kt">uint32_t</span> <span class="n">ls_recover_start</span><span class="p">;</span> <span class="cm">/* gen in last recover_done cb */</span>
	<span class="kt">uint32_t</span> <span class="n">ls_recover_block</span><span class="p">;</span> <span class="cm">/* copy recover_start in last recover_prep */</span>
	<span class="kt">uint32_t</span> <span class="n">ls_recover_size</span><span class="p">;</span> <span class="cm">/* size of recover_submit, recover_result */</span>
	<span class="kt">uint32_t</span> <span class="o">*</span><span class="n">ls_recover_submit</span><span class="p">;</span> <span class="cm">/* gen in last recover_slot cb per jid */</span>
	<span class="kt">uint32_t</span> <span class="o">*</span><span class="n">ls_recover_result</span><span class="p">;</span> <span class="cm">/* result of last jid recovery */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_pcpu_lkstats</span> <span class="p">{</span>
	<span class="cm">/* One struct for each glock type */</span>
	<span class="k">struct</span> <span class="n">gfs2_lkstats</span> <span class="n">lkstats</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">gfs2_sbd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">super_block</span> <span class="o">*</span><span class="n">sd_vfs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_pcpu_lkstats</span> <span class="n">__percpu</span> <span class="o">*</span><span class="n">sd_lkstats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kobject</span> <span class="n">sd_kobj</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sd_flags</span><span class="p">;</span>	<span class="cm">/* SDF_... */</span>
	<span class="k">struct</span> <span class="n">gfs2_sb_host</span> <span class="n">sd_sb</span><span class="p">;</span>

	<span class="cm">/* Constants computed on mount */</span>

	<span class="n">u32</span> <span class="n">sd_fsb2bb</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sd_fsb2bb_shift</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sd_diptrs</span><span class="p">;</span>	<span class="cm">/* Number of pointers in a dinode */</span>
	<span class="n">u32</span> <span class="n">sd_inptrs</span><span class="p">;</span>	<span class="cm">/* Number of pointers in a indirect block */</span>
	<span class="n">u32</span> <span class="n">sd_jbsize</span><span class="p">;</span>	<span class="cm">/* Size of a journaled data block */</span>
	<span class="n">u32</span> <span class="n">sd_hash_bsize</span><span class="p">;</span>	<span class="cm">/* sizeof(exhash block) */</span>
	<span class="n">u32</span> <span class="n">sd_hash_bsize_shift</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sd_hash_ptrs</span><span class="p">;</span>	<span class="cm">/* Number of pointers in a hash block */</span>
	<span class="n">u32</span> <span class="n">sd_qc_per_block</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sd_max_dirres</span><span class="p">;</span>	<span class="cm">/* Max blocks needed to add a directory entry */</span>
	<span class="n">u32</span> <span class="n">sd_max_height</span><span class="p">;</span>	<span class="cm">/* Max height of a file&#39;s metadata tree */</span>
	<span class="n">u64</span> <span class="n">sd_heightsize</span><span class="p">[</span><span class="n">GFS2_MAX_META_HEIGHT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">sd_max_jheight</span><span class="p">;</span> <span class="cm">/* Max height of journaled file&#39;s meta tree */</span>
	<span class="n">u64</span> <span class="n">sd_jheightsize</span><span class="p">[</span><span class="n">GFS2_MAX_META_HEIGHT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">gfs2_args</span> <span class="n">sd_args</span><span class="p">;</span>	<span class="cm">/* Mount arguments */</span>
	<span class="k">struct</span> <span class="n">gfs2_tune</span> <span class="n">sd_tune</span><span class="p">;</span>	<span class="cm">/* Filesystem tuning structure */</span>

	<span class="cm">/* Lock Stuff */</span>

	<span class="k">struct</span> <span class="n">lm_lockstruct</span> <span class="n">sd_lockstruct</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">sd_live_gh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">sd_rename_gl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">sd_trans_gl</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">sd_glock_wait</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">sd_glock_disposal</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">sd_locking_init</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">sd_control_work</span><span class="p">;</span>

	<span class="cm">/* Inode Stuff */</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">sd_master_dir</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">sd_root_dir</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">sd_jindex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">sd_statfs_inode</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">sd_sc_inode</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">sd_qc_inode</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">sd_rindex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">sd_quota_inode</span><span class="p">;</span>

	<span class="cm">/* StatFS stuff */</span>

	<span class="n">spinlock_t</span> <span class="n">sd_statfs_spin</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_statfs_change_host</span> <span class="n">sd_statfs_master</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_statfs_change_host</span> <span class="n">sd_statfs_local</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sd_statfs_force_sync</span><span class="p">;</span>

	<span class="cm">/* Resource group stuff */</span>

	<span class="kt">int</span> <span class="n">sd_rindex_uptodate</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">sd_rindex_spin</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rb_root</span> <span class="n">sd_rindex_tree</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_rgrps</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_max_rg_data</span><span class="p">;</span>

	<span class="cm">/* Journal index stuff */</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sd_jindex_list</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">sd_jindex_spin</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">sd_jindex_mutex</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_journals</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">gfs2_jdesc</span> <span class="o">*</span><span class="n">sd_jdesc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">sd_journal_gh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">sd_jinode_gh</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">sd_sc_gh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">sd_qc_gh</span><span class="p">;</span>

	<span class="cm">/* Daemon stuff */</span>

	<span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">sd_logd_process</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">sd_quotad_process</span><span class="p">;</span>

	<span class="cm">/* Quota stuff */</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sd_quota_list</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">sd_quota_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">sd_quota_mutex</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">sd_quota_wait</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sd_trunc_list</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">sd_trunc_lock</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_quota_slots</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_quota_chunks</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">sd_quota_bitmap</span><span class="p">;</span>

	<span class="n">u64</span> <span class="n">sd_quota_sync_gen</span><span class="p">;</span>

	<span class="cm">/* Log stuff */</span>

	<span class="n">spinlock_t</span> <span class="n">sd_log_lock</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_log_blks_reserved</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_log_commited_buf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_log_commited_databuf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sd_log_commited_revoke</span><span class="p">;</span>

	<span class="n">atomic_t</span> <span class="n">sd_log_pinned</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_log_num_buf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_log_num_revoke</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_log_num_rg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_log_num_databuf</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sd_log_le_buf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sd_log_le_revoke</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sd_log_le_databuf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sd_log_le_ordered</span><span class="p">;</span>

	<span class="n">atomic_t</span> <span class="n">sd_log_thresh1</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">sd_log_thresh2</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">sd_log_blks_free</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">sd_log_waitq</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">sd_logd_waitq</span><span class="p">;</span>

	<span class="n">u64</span> <span class="n">sd_log_sequence</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_log_head</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_log_tail</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sd_log_idle</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">rw_semaphore</span> <span class="n">sd_log_flush_lock</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">sd_log_in_flight</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">bio</span> <span class="o">*</span><span class="n">sd_log_bio</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">sd_log_flush_wait</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sd_log_error</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_log_flush_head</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">sd_log_flush_wrapped</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">sd_ail_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sd_ail1_list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sd_ail2_list</span><span class="p">;</span>

	<span class="cm">/* Replay stuff */</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">sd_revoke_list</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_replay_tail</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_found_blocks</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_found_revokes</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_replayed_blocks</span><span class="p">;</span>

	<span class="cm">/* For quiescing the filesystem */</span>

	<span class="k">struct</span> <span class="n">gfs2_holder</span> <span class="n">sd_freeze_gh</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">sd_freeze_lock</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sd_freeze_count</span><span class="p">;</span>

	<span class="kt">char</span> <span class="n">sd_fsname</span><span class="p">[</span><span class="n">GFS2_FSNAME_LEN</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">sd_table_name</span><span class="p">[</span><span class="n">GFS2_FSNAME_LEN</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">sd_proto_name</span><span class="p">[</span><span class="n">GFS2_FSNAME_LEN</span><span class="p">];</span>

	<span class="cm">/* Debugging crud */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sd_last_warning</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">debugfs_dir</span><span class="p">;</span>    <span class="cm">/* debugfs directory */</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">debugfs_dentry_glocks</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">debugfs_dentry_glstats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">debugfs_dentry_sbstats</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">gfs2_glstats_inc</span><span class="p">(</span><span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">gl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">which</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gl</span><span class="o">-&gt;</span><span class="n">gl_stats</span><span class="p">.</span><span class="n">stats</span><span class="p">[</span><span class="n">which</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">gfs2_sbstats_inc</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">gfs2_glock</span> <span class="o">*</span><span class="n">gl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">which</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">gfs2_sbd</span> <span class="o">*</span><span class="n">sdp</span> <span class="o">=</span> <span class="n">gl</span><span class="o">-&gt;</span><span class="n">gl_sbd</span><span class="p">;</span>
	<span class="n">preempt_disable</span><span class="p">();</span>
	<span class="n">this_cpu_ptr</span><span class="p">(</span><span class="n">sdp</span><span class="o">-&gt;</span><span class="n">sd_lkstats</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">lkstats</span><span class="p">[</span><span class="n">gl</span><span class="o">-&gt;</span><span class="n">gl_name</span><span class="p">.</span><span class="n">ln_type</span><span class="p">].</span><span class="n">stats</span><span class="p">[</span><span class="n">which</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
	<span class="n">preempt_enable</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* __INCORE_DOT_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
