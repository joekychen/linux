<!DOCTYPE html>
<html><head><title>joekychen/linux » fs › jfs › jfs_filsys.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>jfs_filsys.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *   Copyright (C) International Business Machines Corp., 2000-2003</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is free software;  you can redistribute it and/or modify</span>
<span class="cm"> *   it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *   the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *   (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *   This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *   but WITHOUT ANY WARRANTY;  without even the implied warranty of</span>
<span class="cm"> *   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See</span>
<span class="cm"> *   the GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *   You should have received a copy of the GNU General Public License</span>
<span class="cm"> *   along with this program;  if not, write to the Free Software</span>
<span class="cm"> *   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _H_JFS_FILSYS</span>
<span class="cp">#define _H_JFS_FILSYS</span>

<span class="cm">/*</span>
<span class="cm"> *	jfs_filsys.h</span>
<span class="cm"> *</span>
<span class="cm"> * file system (implementation-dependent) constants</span>
<span class="cm"> *</span>
<span class="cm"> * refer to &lt;limits.h&gt; for system wide implementation-dependent constants</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> *	 file system option (superblock flag)</span>
<span class="cm"> */</span>

<span class="cm">/* directory option */</span>
<span class="cp">#define JFS_UNICODE	0x00000001	</span><span class="cm">/* unicode name */</span><span class="cp"></span>

<span class="cm">/* mount time flags for error handling */</span>
<span class="cp">#define JFS_ERR_REMOUNT_RO 0x00000002	</span><span class="cm">/* remount read-only */</span><span class="cp"></span>
<span class="cp">#define JFS_ERR_CONTINUE   0x00000004	</span><span class="cm">/* continue */</span><span class="cp"></span>
<span class="cp">#define JFS_ERR_PANIC      0x00000008	</span><span class="cm">/* panic */</span><span class="cp"></span>

<span class="cm">/* Quota support */</span>
<span class="cp">#define	JFS_USRQUOTA	0x00000010</span>
<span class="cp">#define	JFS_GRPQUOTA	0x00000020</span>

<span class="cm">/* mount time flag to disable journaling to disk */</span>
<span class="cp">#define JFS_NOINTEGRITY 0x00000040</span>

<span class="cm">/* commit option */</span>
<span class="cp">#define	JFS_COMMIT	0x00000f00	</span><span class="cm">/* commit option mask */</span><span class="cp"></span>
<span class="cp">#define	JFS_GROUPCOMMIT	0x00000100	</span><span class="cm">/* group (of 1) commit */</span><span class="cp"></span>
<span class="cp">#define	JFS_LAZYCOMMIT	0x00000200	</span><span class="cm">/* lazy commit */</span><span class="cp"></span>
<span class="cp">#define	JFS_TMPFS	0x00000400	</span><span class="cm">/* temporary file system -</span>
<span class="cm">					 * do not log/commit:</span>
<span class="cm">					 * Never implemented</span>
<span class="cm">					 */</span><span class="cp"></span>

<span class="cm">/* log logical volume option */</span>
<span class="cp">#define	JFS_INLINELOG	0x00000800	</span><span class="cm">/* inline log within file system */</span><span class="cp"></span>
<span class="cp">#define JFS_INLINEMOVE	0x00001000	</span><span class="cm">/* inline log being moved */</span><span class="cp"></span>

<span class="cm">/* Secondary aggregate inode table */</span>
<span class="cp">#define JFS_BAD_SAIT	0x00010000	</span><span class="cm">/* current secondary ait is bad */</span><span class="cp"></span>

<span class="cm">/* sparse regular file support */</span>
<span class="cp">#define JFS_SPARSE	0x00020000	</span><span class="cm">/* sparse regular file */</span><span class="cp"></span>

<span class="cm">/* DASD Limits		F226941 */</span>
<span class="cp">#define JFS_DASD_ENABLED 0x00040000	</span><span class="cm">/* DASD limits enabled */</span><span class="cp"></span>
<span class="cp">#define	JFS_DASD_PRIME	0x00080000	</span><span class="cm">/* Prime DASD usage on boot */</span><span class="cp"></span>

<span class="cm">/* big endian flag */</span>
<span class="cp">#define	JFS_SWAP_BYTES	0x00100000	</span><span class="cm">/* running on big endian computer */</span><span class="cp"></span>

<span class="cm">/* Directory index */</span>
<span class="cp">#define JFS_DIR_INDEX	0x00200000	</span><span class="cm">/* Persistent index for */</span><span class="cp"></span>

<span class="cm">/* platform options */</span>
<span class="cp">#define JFS_LINUX	0x10000000	</span><span class="cm">/* Linux support */</span><span class="cp"></span>
<span class="cp">#define JFS_DFS		0x20000000	</span><span class="cm">/* DCE DFS LFS support */</span><span class="cp"></span>
<span class="cm">/*	Never implemented */</span>

<span class="cp">#define JFS_OS2		0x40000000	</span><span class="cm">/* OS/2 support */</span><span class="cp"></span>
<span class="cm">/*	case-insensitive name/directory support */</span>

<span class="cp">#define JFS_AIX		0x80000000	</span><span class="cm">/* AIX support */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	buffer cache configuration</span>
<span class="cm"> */</span>
<span class="cm">/* page size */</span>
<span class="cp">#ifdef PSIZE</span>
<span class="cp">#undef PSIZE</span>
<span class="cp">#endif</span>
<span class="cp">#define	PSIZE		4096	</span><span class="cm">/* page size (in byte) */</span><span class="cp"></span>
<span class="cp">#define	L2PSIZE		12	</span><span class="cm">/* log2(PSIZE) */</span><span class="cp"></span>
<span class="cp">#define	POFFSET		4095	</span><span class="cm">/* offset within page */</span><span class="cp"></span>

<span class="cm">/* buffer page size */</span>
<span class="cp">#define BPSIZE	PSIZE</span>

<span class="cm">/*</span>
<span class="cm"> *	fs fundamental size</span>
<span class="cm"> *</span>
<span class="cm"> * PSIZE &gt;= file system block size &gt;= PBSIZE &gt;= DISIZE</span>
<span class="cm"> */</span>
<span class="cp">#define	PBSIZE		512	</span><span class="cm">/* physical block size (in byte) */</span><span class="cp"></span>
<span class="cp">#define	L2PBSIZE	9	</span><span class="cm">/* log2(PBSIZE) */</span><span class="cp"></span>

<span class="cp">#define DISIZE		512	</span><span class="cm">/* on-disk inode size (in byte) */</span><span class="cp"></span>
<span class="cp">#define L2DISIZE	9	</span><span class="cm">/* log2(DISIZE) */</span><span class="cp"></span>

<span class="cp">#define IDATASIZE	256	</span><span class="cm">/* inode inline data size */</span><span class="cp"></span>
<span class="cp">#define	IXATTRSIZE	128	</span><span class="cm">/* inode inline extended attribute size */</span><span class="cp"></span>

<span class="cp">#define XTPAGE_SIZE	4096</span>
<span class="cp">#define log2_PAGESIZE	12</span>

<span class="cp">#define IAG_SIZE	4096</span>
<span class="cp">#define IAG_EXTENT_SIZE 4096</span>
<span class="cp">#define	INOSPERIAG	4096	</span><span class="cm">/* number of disk inodes per iag */</span><span class="cp"></span>
<span class="cp">#define	L2INOSPERIAG	12	</span><span class="cm">/* l2 number of disk inodes per iag */</span><span class="cp"></span>
<span class="cp">#define INOSPEREXT	32	</span><span class="cm">/* number of disk inode per extent */</span><span class="cp"></span>
<span class="cp">#define L2INOSPEREXT	5	</span><span class="cm">/* l2 number of disk inode per extent */</span><span class="cp"></span>
<span class="cp">#define	IXSIZE		(DISIZE * INOSPEREXT)	</span><span class="cm">/* inode extent size */</span><span class="cp"></span>
<span class="cp">#define	INOSPERPAGE	8	</span><span class="cm">/* number of disk inodes per 4K page */</span><span class="cp"></span>
<span class="cp">#define	L2INOSPERPAGE	3	</span><span class="cm">/* log2(INOSPERPAGE) */</span><span class="cp"></span>

<span class="cp">#define	IAGFREELIST_LWM	64</span>

<span class="cp">#define INODE_EXTENT_SIZE	IXSIZE	</span><span class="cm">/* inode extent size */</span><span class="cp"></span>
<span class="cp">#define NUM_INODE_PER_EXTENT	INOSPEREXT</span>
<span class="cp">#define NUM_INODE_PER_IAG	INOSPERIAG</span>

<span class="cp">#define MINBLOCKSIZE		512</span>
<span class="cp">#define MAXBLOCKSIZE		4096</span>
<span class="cp">#define	MAXFILESIZE		((s64)1 &lt;&lt; 52)</span>

<span class="cp">#define JFS_LINK_MAX		0xffffffff</span>

<span class="cm">/* Minimum number of bytes supported for a JFS partition */</span>
<span class="cp">#define MINJFS			(0x1000000)</span>
<span class="cp">#define MINJFSTEXT		&quot;16&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * file system block size -&gt; physical block size</span>
<span class="cm"> */</span>
<span class="cp">#define LBOFFSET(x)	((x) &amp; (PBSIZE - 1))</span>
<span class="cp">#define LBNUMBER(x)	((x) &gt;&gt; L2PBSIZE)</span>
<span class="cp">#define	LBLK2PBLK(sb,b)	((b) &lt;&lt; (sb-&gt;s_blocksize_bits - L2PBSIZE))</span>
<span class="cp">#define	PBLK2LBLK(sb,b)	((b) &gt;&gt; (sb-&gt;s_blocksize_bits - L2PBSIZE))</span>
<span class="cm">/* size in byte -&gt; last page number */</span>
<span class="cp">#define	SIZE2PN(size)	( ((s64)((size) - 1)) &gt;&gt; (L2PSIZE) )</span>
<span class="cm">/* size in byte -&gt; last file system block number */</span>
<span class="cp">#define	SIZE2BN(size, l2bsize) ( ((s64)((size) - 1)) &gt;&gt; (l2bsize) )</span>

<span class="cm">/*</span>
<span class="cm"> * fixed physical block address (physical block size = 512 byte)</span>
<span class="cm"> *</span>
<span class="cm"> * NOTE: since we can&#39;t guarantee a physical block size of 512 bytes the use of</span>
<span class="cm"> *	 these macros should be removed and the byte offset macros used instead.</span>
<span class="cm"> */</span>
<span class="cp">#define SUPER1_B	64	</span><span class="cm">/* primary superblock */</span><span class="cp"></span>
<span class="cp">#define	AIMAP_B		(SUPER1_B + 8)	</span><span class="cm">/* 1st extent of aggregate inode map */</span><span class="cp"></span>
<span class="cp">#define	AITBL_B		(AIMAP_B + 16)	</span><span class="cm">/*</span>
<span class="cm">					 * 1st extent of aggregate inode table</span>
<span class="cm">					 */</span><span class="cp"></span>
<span class="cp">#define	SUPER2_B	(AITBL_B + 32)	</span><span class="cm">/* 2ndary superblock pbn */</span><span class="cp"></span>
<span class="cp">#define	BMAP_B		(SUPER2_B + 8)	</span><span class="cm">/* block allocation map */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * SIZE_OF_SUPER defines the total amount of space reserved on disk for the</span>
<span class="cm"> * superblock.  This is not the same as the superblock structure, since all of</span>
<span class="cm"> * this space is not currently being used.</span>
<span class="cm"> */</span>
<span class="cp">#define SIZE_OF_SUPER	PSIZE</span>

<span class="cm">/*</span>
<span class="cm"> * SIZE_OF_AG_TABLE defines the amount of space reserved to hold the AG table</span>
<span class="cm"> */</span>
<span class="cp">#define SIZE_OF_AG_TABLE	PSIZE</span>

<span class="cm">/*</span>
<span class="cm"> * SIZE_OF_MAP_PAGE defines the amount of disk space reserved for each page of</span>
<span class="cm"> * the inode allocation map (to hold iag)</span>
<span class="cm"> */</span>
<span class="cp">#define SIZE_OF_MAP_PAGE	PSIZE</span>

<span class="cm">/*</span>
<span class="cm"> * fixed byte offset address</span>
<span class="cm"> */</span>
<span class="cp">#define SUPER1_OFF	0x8000	</span><span class="cm">/* primary superblock */</span><span class="cp"></span>
<span class="cp">#define AIMAP_OFF	(SUPER1_OFF + SIZE_OF_SUPER)</span>
					<span class="cm">/*</span>
<span class="cm">					 * Control page of aggregate inode map</span>
<span class="cm">					 * followed by 1st extent of map</span>
<span class="cm">					 */</span>
<span class="cp">#define AITBL_OFF	(AIMAP_OFF + (SIZE_OF_MAP_PAGE &lt;&lt; 1))</span>
					<span class="cm">/*</span>
<span class="cm">					 * 1st extent of aggregate inode table</span>
<span class="cm">					 */</span>
<span class="cp">#define SUPER2_OFF	(AITBL_OFF + INODE_EXTENT_SIZE)</span>
					<span class="cm">/*</span>
<span class="cm">					 * secondary superblock</span>
<span class="cm">					 */</span>
<span class="cp">#define BMAP_OFF	(SUPER2_OFF + SIZE_OF_SUPER)</span>
					<span class="cm">/*</span>
<span class="cm">					 * block allocation map</span>
<span class="cm">					 */</span>

<span class="cm">/*</span>
<span class="cm"> * The following macro is used to indicate the number of reserved disk blocks at</span>
<span class="cm"> * the front of an aggregate, in terms of physical blocks.  This value is</span>
<span class="cm"> * currently defined to be 32K.  This turns out to be the same as the primary</span>
<span class="cm"> * superblock&#39;s address, since it directly follows the reserved blocks.</span>
<span class="cm"> */</span>
<span class="cp">#define AGGR_RSVD_BLOCKS	SUPER1_B</span>

<span class="cm">/*</span>
<span class="cm"> * The following macro is used to indicate the number of reserved bytes at the</span>
<span class="cm"> * front of an aggregate.  This value is currently defined to be 32K.  This</span>
<span class="cm"> * turns out to be the same as the primary superblock&#39;s byte offset, since it</span>
<span class="cm"> * directly follows the reserved blocks.</span>
<span class="cm"> */</span>
<span class="cp">#define AGGR_RSVD_BYTES	SUPER1_OFF</span>

<span class="cm">/*</span>
<span class="cm"> * The following macro defines the byte offset for the first inode extent in</span>
<span class="cm"> * the aggregate inode table.  This allows us to find the self inode to find the</span>
<span class="cm"> * rest of the table.  Currently this value is 44K.</span>
<span class="cm"> */</span>
<span class="cp">#define AGGR_INODE_TABLE_START	AITBL_OFF</span>

<span class="cm">/*</span>
<span class="cm"> *	fixed reserved inode number</span>
<span class="cm"> */</span>
<span class="cm">/* aggregate inode */</span>
<span class="cp">#define AGGR_RESERVED_I	0	</span><span class="cm">/* aggregate inode (reserved) */</span><span class="cp"></span>
<span class="cp">#define	AGGREGATE_I	1	</span><span class="cm">/* aggregate inode map inode */</span><span class="cp"></span>
<span class="cp">#define	BMAP_I		2	</span><span class="cm">/* aggregate block allocation map inode */</span><span class="cp"></span>
<span class="cp">#define	LOG_I		3	</span><span class="cm">/* aggregate inline log inode */</span><span class="cp"></span>
<span class="cp">#define BADBLOCK_I	4	</span><span class="cm">/* aggregate bad block inode */</span><span class="cp"></span>
<span class="cp">#define	FILESYSTEM_I	16	</span><span class="cm">/* 1st/only fileset inode in ait:</span>
<span class="cm">				 * fileset inode map inode</span>
<span class="cm">				 */</span><span class="cp"></span>

<span class="cm">/* per fileset inode */</span>
<span class="cp">#define FILESET_RSVD_I	0	</span><span class="cm">/* fileset inode (reserved) */</span><span class="cp"></span>
<span class="cp">#define FILESET_EXT_I	1	</span><span class="cm">/* fileset inode extension */</span><span class="cp"></span>
<span class="cp">#define	ROOT_I		2	</span><span class="cm">/* fileset root inode */</span><span class="cp"></span>
<span class="cp">#define ACL_I		3	</span><span class="cm">/* fileset ACL inode */</span><span class="cp"></span>

<span class="cp">#define FILESET_OBJECT_I 4	</span><span class="cm">/* the first fileset inode available for a file</span>
<span class="cm">				 * or directory or link...</span>
<span class="cm">				 */</span><span class="cp"></span>
<span class="cp">#define FIRST_FILESET_INO 16	</span><span class="cm">/* the first aggregate inode which describes</span>
<span class="cm">				 * an inode.  (To fsck this is also the first</span>
<span class="cm">				 * inode in part 2 of the agg inode table.)</span>
<span class="cm">				 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	directory configuration</span>
<span class="cm"> */</span>
<span class="cp">#define JFS_NAME_MAX	255</span>
<span class="cp">#define JFS_PATH_MAX	BPSIZE</span>


<span class="cm">/*</span>
<span class="cm"> *	file system state (superblock state)</span>
<span class="cm"> */</span>
<span class="cp">#define FM_CLEAN 0x00000000	</span><span class="cm">/* file system is unmounted and clean */</span><span class="cp"></span>
<span class="cp">#define FM_MOUNT 0x00000001	</span><span class="cm">/* file system is mounted cleanly */</span><span class="cp"></span>
<span class="cp">#define FM_DIRTY 0x00000002	</span><span class="cm">/* file system was not unmounted and clean</span>
<span class="cm">				 * when mounted or</span>
<span class="cm">				 * commit failure occurred while being mounted:</span>
<span class="cm">				 * fsck() must be run to repair</span>
<span class="cm">				 */</span><span class="cp"></span>
<span class="cp">#define	FM_LOGREDO 0x00000004	</span><span class="cm">/* log based recovery (logredo()) failed:</span>
<span class="cm">				 * fsck() must be run to repair</span>
<span class="cm">				 */</span><span class="cp"></span>
<span class="cp">#define	FM_EXTENDFS 0x00000008	</span><span class="cm">/* file system extendfs() in progress */</span><span class="cp"></span>

<span class="cp">#endif				</span><span class="cm">/* _H_JFS_FILSYS */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
