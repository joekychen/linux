<!DOCTYPE html>
<html><head><title>joekychen/linux » fs › nfs › nfs4xdr.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>nfs4xdr.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  fs/nfs/nfs4xdr.c</span>
<span class="cm"> *</span>
<span class="cm"> *  Client-side XDR for NFSv4.</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (c) 2002 The Regents of the University of Michigan.</span>
<span class="cm"> *  All rights reserved.</span>
<span class="cm"> *</span>
<span class="cm"> *  Kendrick Smith &lt;kmsmith@umich.edu&gt;</span>
<span class="cm"> *  Andy Adamson   &lt;andros@umich.edu&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  Redistribution and use in source and binary forms, with or without</span>
<span class="cm"> *  modification, are permitted provided that the following conditions</span>
<span class="cm"> *  are met:</span>
<span class="cm"> *</span>
<span class="cm"> *  1. Redistributions of source code must retain the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer.</span>
<span class="cm"> *  2. Redistributions in binary form must reproduce the above copyright</span>
<span class="cm"> *     notice, this list of conditions and the following disclaimer in the</span>
<span class="cm"> *     documentation and/or other materials provided with the distribution.</span>
<span class="cm"> *  3. Neither the name of the University nor the names of its</span>
<span class="cm"> *     contributors may be used to endorse or promote products derived</span>
<span class="cm"> *     from this software without specific prior written permission.</span>
<span class="cm"> *</span>
<span class="cm"> *  THIS SOFTWARE IS PROVIDED ``AS IS&#39;&#39; AND ANY EXPRESS OR IMPLIED</span>
<span class="cm"> *  WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<span class="cm"> *  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<span class="cm"> *  DISCLAIMED. IN NO EVENT SHALL THE REGENTS OR CONTRIBUTORS BE LIABLE</span>
<span class="cm"> *  FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<span class="cm"> *  CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<span class="cm"> *  SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR</span>
<span class="cm"> *  BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<span class="cm"> *  LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<span class="cm"> *  NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="cm"> *  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/param.h&gt;</span>
<span class="cp">#include &lt;linux/time.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/in.h&gt;</span>
<span class="cp">#include &lt;linux/pagemap.h&gt;</span>
<span class="cp">#include &lt;linux/proc_fs.h&gt;</span>
<span class="cp">#include &lt;linux/kdev_t.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/utsname.h&gt;</span>
<span class="cp">#include &lt;linux/sunrpc/clnt.h&gt;</span>
<span class="cp">#include &lt;linux/sunrpc/msg_prot.h&gt;</span>
<span class="cp">#include &lt;linux/sunrpc/gss_api.h&gt;</span>
<span class="cp">#include &lt;linux/nfs.h&gt;</span>
<span class="cp">#include &lt;linux/nfs4.h&gt;</span>
<span class="cp">#include &lt;linux/nfs_fs.h&gt;</span>
<span class="cp">#include &lt;linux/nfs_idmap.h&gt;</span>

<span class="cp">#include &quot;nfs4_fs.h&quot;</span>
<span class="cp">#include &quot;internal.h&quot;</span>
<span class="cp">#include &quot;pnfs.h&quot;</span>
<span class="cp">#include &quot;netns.h&quot;</span>

<span class="cp">#define NFSDBG_FACILITY		NFSDBG_XDR</span>

<span class="cm">/* Mapping from NFS error code to &quot;errno&quot; error code. */</span>
<span class="cp">#define errno_NFSERR_IO		EIO</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">nfs4_stat_to_errno</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>

<span class="cm">/* NFSv4 COMPOUND tags are only wanted for debugging purposes */</span>
<span class="cp">#ifdef DEBUG</span>
<span class="cp">#define NFS4_MAXTAGLEN		20</span>
<span class="cp">#else</span>
<span class="cp">#define NFS4_MAXTAGLEN		0</span>
<span class="cp">#endif</span>

<span class="cm">/* lock,open owner id:</span>
<span class="cm"> * we currently use size 2 (u64) out of (NFS4_OPAQUE_LIMIT  &gt;&gt; 2)</span>
<span class="cm"> */</span>
<span class="cp">#define open_owner_id_maxsz	(1 + 2 + 1 + 1 + 2)</span>
<span class="cp">#define lock_owner_id_maxsz	(1 + 1 + 4)</span>
<span class="cp">#define decode_lockowner_maxsz	(1 + XDR_QUADLEN(IDMAP_NAMESZ))</span>
<span class="cp">#define compound_encode_hdr_maxsz	(3 + (NFS4_MAXTAGLEN &gt;&gt; 2))</span>
<span class="cp">#define compound_decode_hdr_maxsz	(3 + (NFS4_MAXTAGLEN &gt;&gt; 2))</span>
<span class="cp">#define op_encode_hdr_maxsz	(1)</span>
<span class="cp">#define op_decode_hdr_maxsz	(2)</span>
<span class="cp">#define encode_stateid_maxsz	(XDR_QUADLEN(NFS4_STATEID_SIZE))</span>
<span class="cp">#define decode_stateid_maxsz	(XDR_QUADLEN(NFS4_STATEID_SIZE))</span>
<span class="cp">#define encode_verifier_maxsz	(XDR_QUADLEN(NFS4_VERIFIER_SIZE))</span>
<span class="cp">#define decode_verifier_maxsz	(XDR_QUADLEN(NFS4_VERIFIER_SIZE))</span>
<span class="cp">#define encode_putfh_maxsz	(op_encode_hdr_maxsz + 1 + \</span>
<span class="cp">				(NFS4_FHSIZE &gt;&gt; 2))</span>
<span class="cp">#define decode_putfh_maxsz	(op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_putrootfh_maxsz	(op_encode_hdr_maxsz)</span>
<span class="cp">#define decode_putrootfh_maxsz	(op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_getfh_maxsz      (op_encode_hdr_maxsz)</span>
<span class="cp">#define decode_getfh_maxsz      (op_decode_hdr_maxsz + 1 + \</span>
<span class="cp">				((3+NFS4_FHSIZE) &gt;&gt; 2))</span>
<span class="cp">#define nfs4_fattr_bitmap_maxsz 4</span>
<span class="cp">#define encode_getattr_maxsz    (op_encode_hdr_maxsz + nfs4_fattr_bitmap_maxsz)</span>
<span class="cp">#define nfs4_name_maxsz		(1 + ((3 + NFS4_MAXNAMLEN) &gt;&gt; 2))</span>
<span class="cp">#define nfs4_path_maxsz		(1 + ((3 + NFS4_MAXPATHLEN) &gt;&gt; 2))</span>
<span class="cp">#define nfs4_owner_maxsz	(1 + XDR_QUADLEN(IDMAP_NAMESZ))</span>
<span class="cp">#define nfs4_group_maxsz	(1 + XDR_QUADLEN(IDMAP_NAMESZ))</span>
<span class="cm">/* We support only one layout type per file system */</span>
<span class="cp">#define decode_mdsthreshold_maxsz (1 + 1 + nfs4_fattr_bitmap_maxsz + 1 + 8)</span>
<span class="cm">/* This is based on getfattr, which uses the most attributes: */</span>
<span class="cp">#define nfs4_fattr_value_maxsz	(1 + (1 + 2 + 2 + 4 + 2 + 1 + 1 + 2 + 2 + \</span>
<span class="cp">				3 + 3 + 3 + nfs4_owner_maxsz + \</span>
<span class="cp">				nfs4_group_maxsz + decode_mdsthreshold_maxsz))</span>
<span class="cp">#define nfs4_fattr_maxsz	(nfs4_fattr_bitmap_maxsz + \</span>
<span class="cp">				nfs4_fattr_value_maxsz)</span>
<span class="cp">#define decode_getattr_maxsz    (op_decode_hdr_maxsz + nfs4_fattr_maxsz)</span>
<span class="cp">#define encode_attrs_maxsz	(nfs4_fattr_bitmap_maxsz + \</span>
<span class="cp">				 1 + 2 + 1 + \</span>
<span class="cp">				nfs4_owner_maxsz + \</span>
<span class="cp">				nfs4_group_maxsz + \</span>
<span class="cp">				4 + 4)</span>
<span class="cp">#define encode_savefh_maxsz     (op_encode_hdr_maxsz)</span>
<span class="cp">#define decode_savefh_maxsz     (op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_restorefh_maxsz  (op_encode_hdr_maxsz)</span>
<span class="cp">#define decode_restorefh_maxsz  (op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_fsinfo_maxsz	(encode_getattr_maxsz)</span>
<span class="cm">/* The 5 accounts for the PNFS attributes, and assumes that at most three</span>
<span class="cm"> * layout types will be returned.</span>
<span class="cm"> */</span>
<span class="cp">#define decode_fsinfo_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 nfs4_fattr_bitmap_maxsz + 4 + 8 + 5)</span>
<span class="cp">#define encode_renew_maxsz	(op_encode_hdr_maxsz + 3)</span>
<span class="cp">#define decode_renew_maxsz	(op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_setclientid_maxsz \</span>
<span class="cp">				(op_encode_hdr_maxsz + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_VERIFIER_SIZE) + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_SETCLIENTID_NAMELEN) + \</span>
<span class="cp">				1 </span><span class="cm">/* sc_prog */</span><span class="cp"> + \</span>
<span class="cp">				XDR_QUADLEN(RPCBIND_MAXNETIDLEN) + \</span>
<span class="cp">				XDR_QUADLEN(RPCBIND_MAXUADDRLEN) + \</span>
<span class="cp">				1) </span><span class="cm">/* sc_cb_ident */</span><span class="cp"></span>
<span class="cp">#define decode_setclientid_maxsz \</span>
<span class="cp">				(op_decode_hdr_maxsz + \</span>
<span class="cp">				2 + \</span>
<span class="cp">				1024) </span><span class="cm">/* large value for CLID_INUSE */</span><span class="cp"></span>
<span class="cp">#define encode_setclientid_confirm_maxsz \</span>
<span class="cp">				(op_encode_hdr_maxsz + \</span>
<span class="cp">				3 + (NFS4_VERIFIER_SIZE &gt;&gt; 2))</span>
<span class="cp">#define decode_setclientid_confirm_maxsz \</span>
<span class="cp">				(op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_lookup_maxsz	(op_encode_hdr_maxsz + nfs4_name_maxsz)</span>
<span class="cp">#define decode_lookup_maxsz	(op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_share_access_maxsz \</span>
<span class="cp">				(2)</span>
<span class="cp">#define encode_createmode_maxsz	(1 + encode_attrs_maxsz + encode_verifier_maxsz)</span>
<span class="cp">#define encode_opentype_maxsz	(1 + encode_createmode_maxsz)</span>
<span class="cp">#define encode_claim_null_maxsz	(1 + nfs4_name_maxsz)</span>
<span class="cp">#define encode_open_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				2 + encode_share_access_maxsz + 2 + \</span>
<span class="cp">				open_owner_id_maxsz + \</span>
<span class="cp">				encode_opentype_maxsz + \</span>
<span class="cp">				encode_claim_null_maxsz)</span>
<span class="cp">#define decode_ace_maxsz	(3 + nfs4_owner_maxsz)</span>
<span class="cp">#define decode_delegation_maxsz	(1 + decode_stateid_maxsz + 1 + \</span>
<span class="cp">				decode_ace_maxsz)</span>
<span class="cp">#define decode_change_info_maxsz	(5)</span>
<span class="cp">#define decode_open_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				decode_stateid_maxsz + \</span>
<span class="cp">				decode_change_info_maxsz + 1 + \</span>
<span class="cp">				nfs4_fattr_bitmap_maxsz + \</span>
<span class="cp">				decode_delegation_maxsz)</span>
<span class="cp">#define encode_open_confirm_maxsz \</span>
<span class="cp">				(op_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_stateid_maxsz + 1)</span>
<span class="cp">#define decode_open_confirm_maxsz \</span>
<span class="cp">				(op_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_stateid_maxsz)</span>
<span class="cp">#define encode_open_downgrade_maxsz \</span>
<span class="cp">				(op_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_stateid_maxsz + 1 + \</span>
<span class="cp">				 encode_share_access_maxsz)</span>
<span class="cp">#define decode_open_downgrade_maxsz \</span>
<span class="cp">				(op_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_stateid_maxsz)</span>
<span class="cp">#define encode_close_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				 1 + encode_stateid_maxsz)</span>
<span class="cp">#define decode_close_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_stateid_maxsz)</span>
<span class="cp">#define encode_setattr_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_stateid_maxsz + \</span>
<span class="cp">				 encode_attrs_maxsz)</span>
<span class="cp">#define decode_setattr_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 nfs4_fattr_bitmap_maxsz)</span>
<span class="cp">#define encode_read_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_stateid_maxsz + 3)</span>
<span class="cp">#define decode_read_maxsz	(op_decode_hdr_maxsz + 2)</span>
<span class="cp">#define encode_readdir_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				 2 + encode_verifier_maxsz + 5)</span>
<span class="cp">#define decode_readdir_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_verifier_maxsz)</span>
<span class="cp">#define encode_readlink_maxsz	(op_encode_hdr_maxsz)</span>
<span class="cp">#define decode_readlink_maxsz	(op_decode_hdr_maxsz + 1)</span>
<span class="cp">#define encode_write_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_stateid_maxsz + 4)</span>
<span class="cp">#define decode_write_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 2 + decode_verifier_maxsz)</span>
<span class="cp">#define encode_commit_maxsz	(op_encode_hdr_maxsz + 3)</span>
<span class="cp">#define decode_commit_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_verifier_maxsz)</span>
<span class="cp">#define encode_remove_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				nfs4_name_maxsz)</span>
<span class="cp">#define decode_remove_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_change_info_maxsz)</span>
<span class="cp">#define encode_rename_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				2 * nfs4_name_maxsz)</span>
<span class="cp">#define decode_rename_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_change_info_maxsz + \</span>
<span class="cp">				 decode_change_info_maxsz)</span>
<span class="cp">#define encode_link_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				nfs4_name_maxsz)</span>
<span class="cp">#define decode_link_maxsz	(op_decode_hdr_maxsz + decode_change_info_maxsz)</span>
<span class="cp">#define encode_lockowner_maxsz	(7)</span>
<span class="cp">#define encode_lock_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				 7 + \</span>
<span class="cp">				 1 + encode_stateid_maxsz + 1 + \</span>
<span class="cp">				 encode_lockowner_maxsz)</span>
<span class="cp">#define decode_lock_denied_maxsz \</span>
<span class="cp">				(8 + decode_lockowner_maxsz)</span>
<span class="cp">#define decode_lock_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_lock_denied_maxsz)</span>
<span class="cp">#define encode_lockt_maxsz	(op_encode_hdr_maxsz + 5 + \</span>
<span class="cp">				encode_lockowner_maxsz)</span>
<span class="cp">#define decode_lockt_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_lock_denied_maxsz)</span>
<span class="cp">#define encode_locku_maxsz	(op_encode_hdr_maxsz + 3 + \</span>
<span class="cp">				 encode_stateid_maxsz + \</span>
<span class="cp">				 4)</span>
<span class="cp">#define decode_locku_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_stateid_maxsz)</span>
<span class="cp">#define encode_release_lockowner_maxsz \</span>
<span class="cp">				(op_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_lockowner_maxsz)</span>
<span class="cp">#define decode_release_lockowner_maxsz \</span>
<span class="cp">				(op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_access_maxsz	(op_encode_hdr_maxsz + 1)</span>
<span class="cp">#define decode_access_maxsz	(op_decode_hdr_maxsz + 2)</span>
<span class="cp">#define encode_symlink_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				1 + nfs4_name_maxsz + \</span>
<span class="cp">				1 + \</span>
<span class="cp">				nfs4_fattr_maxsz)</span>
<span class="cp">#define decode_symlink_maxsz	(op_decode_hdr_maxsz + 8)</span>
<span class="cp">#define encode_create_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				1 + 2 + nfs4_name_maxsz + \</span>
<span class="cp">				encode_attrs_maxsz)</span>
<span class="cp">#define decode_create_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				decode_change_info_maxsz + \</span>
<span class="cp">				nfs4_fattr_bitmap_maxsz)</span>
<span class="cp">#define encode_statfs_maxsz	(encode_getattr_maxsz)</span>
<span class="cp">#define decode_statfs_maxsz	(decode_getattr_maxsz)</span>
<span class="cp">#define encode_delegreturn_maxsz (op_encode_hdr_maxsz + 4)</span>
<span class="cp">#define decode_delegreturn_maxsz (op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_getacl_maxsz	(encode_getattr_maxsz)</span>
<span class="cp">#define decode_getacl_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				 nfs4_fattr_bitmap_maxsz + 1)</span>
<span class="cp">#define encode_setacl_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_stateid_maxsz + 3)</span>
<span class="cp">#define decode_setacl_maxsz	(decode_setattr_maxsz)</span>
<span class="cp">#define encode_fs_locations_maxsz \</span>
<span class="cp">				(encode_getattr_maxsz)</span>
<span class="cp">#define decode_fs_locations_maxsz \</span>
<span class="cp">				(0)</span>
<span class="cp">#define encode_secinfo_maxsz	(op_encode_hdr_maxsz + nfs4_name_maxsz)</span>
<span class="cp">#define decode_secinfo_maxsz	(op_decode_hdr_maxsz + 1 + ((NFS_MAX_SECFLAVORS * (16 + GSS_OID_MAX_LEN)) / 4))</span>

<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
<span class="cp">#define NFS4_MAX_MACHINE_NAME_LEN (64)</span>

<span class="cp">#define encode_exchange_id_maxsz (op_encode_hdr_maxsz + \</span>
<span class="cp">				encode_verifier_maxsz + \</span>
<span class="cp">				1 </span><span class="cm">/* co_ownerid.len */</span><span class="cp"> + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_EXCHANGE_ID_LEN) + \</span>
<span class="cp">				1 </span><span class="cm">/* flags */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* spa_how */</span><span class="cp"> + \</span>
<span class="cp">				0 </span><span class="cm">/* SP4_NONE (for now) */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* implementation id array of size 1 */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* nii_domain */</span><span class="cp"> + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_OPAQUE_LIMIT) + \</span>
<span class="cp">				1 </span><span class="cm">/* nii_name */</span><span class="cp"> + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_OPAQUE_LIMIT) + \</span>
<span class="cp">				3 </span><span class="cm">/* nii_date */</span><span class="cp">)</span>
<span class="cp">#define decode_exchange_id_maxsz (op_decode_hdr_maxsz + \</span>
<span class="cp">				2 </span><span class="cm">/* eir_clientid */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* eir_sequenceid */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* eir_flags */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* spr_how */</span><span class="cp"> + \</span>
<span class="cp">				0 </span><span class="cm">/* SP4_NONE (for now) */</span><span class="cp"> + \</span>
<span class="cp">				2 </span><span class="cm">/* eir_server_owner.so_minor_id */</span><span class="cp"> + \</span>
<span class="cp">				</span><span class="cm">/* eir_server_owner.so_major_id&lt;&gt; */</span><span class="cp"> \</span>
<span class="cp">				XDR_QUADLEN(NFS4_OPAQUE_LIMIT) + 1 + \</span>
<span class="cp">				</span><span class="cm">/* eir_server_scope&lt;&gt; */</span><span class="cp"> \</span>
<span class="cp">				XDR_QUADLEN(NFS4_OPAQUE_LIMIT) + 1 + \</span>
<span class="cp">				1 </span><span class="cm">/* eir_server_impl_id array length */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* nii_domain */</span><span class="cp"> + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_OPAQUE_LIMIT) + \</span>
<span class="cp">				1 </span><span class="cm">/* nii_name */</span><span class="cp"> + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_OPAQUE_LIMIT) + \</span>
<span class="cp">				3 </span><span class="cm">/* nii_date */</span><span class="cp">)</span>
<span class="cp">#define encode_channel_attrs_maxsz  (6 + 1 </span><span class="cm">/* ca_rdma_ird.len (0) */</span><span class="cp">)</span>
<span class="cp">#define decode_channel_attrs_maxsz  (6 + \</span>
<span class="cp">				     1 </span><span class="cm">/* ca_rdma_ird.len */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* ca_rdma_ird */</span><span class="cp">)</span>
<span class="cp">#define encode_create_session_maxsz  (op_encode_hdr_maxsz + \</span>
<span class="cp">				     2 </span><span class="cm">/* csa_clientid */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* csa_sequence */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* csa_flags */</span><span class="cp"> + \</span>
<span class="cp">				     encode_channel_attrs_maxsz + \</span>
<span class="cp">				     encode_channel_attrs_maxsz + \</span>
<span class="cp">				     1 </span><span class="cm">/* csa_cb_program */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* csa_sec_parms.len (1) */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* cb_secflavor (AUTH_SYS) */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* stamp */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* machinename.len */</span><span class="cp"> + \</span>
<span class="cp">				     XDR_QUADLEN(NFS4_MAX_MACHINE_NAME_LEN) + \</span>
<span class="cp">				     1 </span><span class="cm">/* uid */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* gid */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* gids.len (0) */</span><span class="cp">)</span>
<span class="cp">#define decode_create_session_maxsz  (op_decode_hdr_maxsz +	\</span>
<span class="cp">				     XDR_QUADLEN(NFS4_MAX_SESSIONID_LEN) + \</span>
<span class="cp">				     1 </span><span class="cm">/* csr_sequence */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* csr_flags */</span><span class="cp"> + \</span>
<span class="cp">				     decode_channel_attrs_maxsz + \</span>
<span class="cp">				     decode_channel_attrs_maxsz)</span>
<span class="cp">#define encode_bind_conn_to_session_maxsz  (op_encode_hdr_maxsz + \</span>
<span class="cp">				     </span><span class="cm">/* bctsa_sessid */</span><span class="cp"> \</span>
<span class="cp">				     XDR_QUADLEN(NFS4_MAX_SESSIONID_LEN) + \</span>
<span class="cp">				     1 </span><span class="cm">/* bctsa_dir */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* bctsa_use_conn_in_rdma_mode */</span><span class="cp">)</span>
<span class="cp">#define decode_bind_conn_to_session_maxsz  (op_decode_hdr_maxsz +	\</span>
<span class="cp">				     </span><span class="cm">/* bctsr_sessid */</span><span class="cp"> \</span>
<span class="cp">				     XDR_QUADLEN(NFS4_MAX_SESSIONID_LEN) + \</span>
<span class="cp">				     1 </span><span class="cm">/* bctsr_dir */</span><span class="cp"> + \</span>
<span class="cp">				     1 </span><span class="cm">/* bctsr_use_conn_in_rdma_mode */</span><span class="cp">)</span>
<span class="cp">#define encode_destroy_session_maxsz    (op_encode_hdr_maxsz + 4)</span>
<span class="cp">#define decode_destroy_session_maxsz    (op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_destroy_clientid_maxsz   (op_encode_hdr_maxsz + 2)</span>
<span class="cp">#define decode_destroy_clientid_maxsz   (op_decode_hdr_maxsz)</span>
<span class="cp">#define encode_sequence_maxsz	(op_encode_hdr_maxsz + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_MAX_SESSIONID_LEN) + 4)</span>
<span class="cp">#define decode_sequence_maxsz	(op_decode_hdr_maxsz + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_MAX_SESSIONID_LEN) + 5)</span>
<span class="cp">#define encode_reclaim_complete_maxsz	(op_encode_hdr_maxsz + 4)</span>
<span class="cp">#define decode_reclaim_complete_maxsz	(op_decode_hdr_maxsz + 4)</span>
<span class="cp">#define encode_getdevicelist_maxsz (op_encode_hdr_maxsz + 4 + \</span>
<span class="cp">				encode_verifier_maxsz)</span>
<span class="cp">#define decode_getdevicelist_maxsz (op_decode_hdr_maxsz + \</span>
<span class="cp">				2 </span><span class="cm">/* nfs_cookie4 gdlr_cookie */</span><span class="cp"> + \</span>
<span class="cp">				decode_verifier_maxsz \</span>
<span class="cp">				  </span><span class="cm">/* verifier4 gdlr_verifier */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* gdlr_deviceid_list count */</span><span class="cp"> + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_PNFS_GETDEVLIST_MAXNUM * \</span>
<span class="cp">					    NFS4_DEVICEID4_SIZE) \</span>
<span class="cp">				  </span><span class="cm">/* gdlr_deviceid_list */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* bool gdlr_eof */</span><span class="cp">)</span>
<span class="cp">#define encode_getdeviceinfo_maxsz (op_encode_hdr_maxsz + 4 + \</span>
<span class="cp">				XDR_QUADLEN(NFS4_DEVICEID4_SIZE))</span>
<span class="cp">#define decode_getdeviceinfo_maxsz (op_decode_hdr_maxsz + \</span>
<span class="cp">				1 </span><span class="cm">/* layout type */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* opaque devaddr4 length */</span><span class="cp"> + \</span>
<span class="cp">				  </span><span class="cm">/* devaddr4 payload is read into page */</span><span class="cp"> \</span>
<span class="cp">				1 </span><span class="cm">/* notification bitmap length */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* notification bitmap */</span><span class="cp">)</span>
<span class="cp">#define encode_layoutget_maxsz	(op_encode_hdr_maxsz + 10 + \</span>
<span class="cp">				encode_stateid_maxsz)</span>
<span class="cp">#define decode_layoutget_maxsz	(op_decode_hdr_maxsz + 8 + \</span>
<span class="cp">				decode_stateid_maxsz + \</span>
<span class="cp">				XDR_QUADLEN(PNFS_LAYOUT_MAXSIZE))</span>
<span class="cp">#define encode_layoutcommit_maxsz (op_encode_hdr_maxsz +          \</span>
<span class="cp">				2 </span><span class="cm">/* offset */</span><span class="cp"> + \</span>
<span class="cp">				2 </span><span class="cm">/* length */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* reclaim */</span><span class="cp"> + \</span>
<span class="cp">				encode_stateid_maxsz + \</span>
<span class="cp">				1 </span><span class="cm">/* new offset (true) */</span><span class="cp"> + \</span>
<span class="cp">				2 </span><span class="cm">/* last byte written */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* nt_timechanged (false) */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* layoutupdate4 layout type */</span><span class="cp"> + \</span>
<span class="cp">				1 </span><span class="cm">/* NULL filelayout layoutupdate4 payload */</span><span class="cp">)</span>
<span class="cp">#define decode_layoutcommit_maxsz (op_decode_hdr_maxsz + 3)</span>
<span class="cp">#define encode_layoutreturn_maxsz (8 + op_encode_hdr_maxsz + \</span>
<span class="cp">				encode_stateid_maxsz + \</span>
<span class="cp">				1 </span><span class="cm">/* FIXME: opaque lrf_body always empty at the moment */</span><span class="cp">)</span>
<span class="cp">#define decode_layoutreturn_maxsz (op_decode_hdr_maxsz + \</span>
<span class="cp">				1 + decode_stateid_maxsz)</span>
<span class="cp">#define encode_secinfo_no_name_maxsz (op_encode_hdr_maxsz + 1)</span>
<span class="cp">#define decode_secinfo_no_name_maxsz decode_secinfo_maxsz</span>
<span class="cp">#define encode_test_stateid_maxsz	(op_encode_hdr_maxsz + 2 + \</span>
<span class="cp">					 XDR_QUADLEN(NFS4_STATEID_SIZE))</span>
<span class="cp">#define decode_test_stateid_maxsz	(op_decode_hdr_maxsz + 2 + 1)</span>
<span class="cp">#define encode_free_stateid_maxsz	(op_encode_hdr_maxsz + 1 + \</span>
<span class="cp">					 XDR_QUADLEN(NFS4_STATEID_SIZE))</span>
<span class="cp">#define decode_free_stateid_maxsz	(op_decode_hdr_maxsz + 1)</span>
<span class="cp">#else </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>
<span class="cp">#define encode_sequence_maxsz	0</span>
<span class="cp">#define decode_sequence_maxsz	0</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>

<span class="cp">#define NFS4_enc_compound_sz	(1024)  </span><span class="cm">/* XXX: large enough? */</span><span class="cp"></span>
<span class="cp">#define NFS4_dec_compound_sz	(1024)  </span><span class="cm">/* XXX: large enough? */</span><span class="cp"></span>
<span class="cp">#define NFS4_enc_read_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_read_maxsz)</span>
<span class="cp">#define NFS4_dec_read_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_read_maxsz)</span>
<span class="cp">#define NFS4_enc_readlink_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_readlink_maxsz)</span>
<span class="cp">#define NFS4_dec_readlink_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_readlink_maxsz)</span>
<span class="cp">#define NFS4_enc_readdir_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_readdir_maxsz)</span>
<span class="cp">#define NFS4_dec_readdir_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_readdir_maxsz)</span>
<span class="cp">#define NFS4_enc_write_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_write_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_write_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_write_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_commit_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_commit_maxsz)</span>
<span class="cp">#define NFS4_dec_commit_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_commit_maxsz)</span>
<span class="cp">#define NFS4_enc_open_sz        (compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_open_maxsz + \</span>
<span class="cp">				encode_getfh_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_open_sz        (compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_open_maxsz + \</span>
<span class="cp">				decode_getfh_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_open_confirm_sz \</span>
<span class="cp">				(compound_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_putfh_maxsz + \</span>
<span class="cp">				 encode_open_confirm_maxsz)</span>
<span class="cp">#define NFS4_dec_open_confirm_sz \</span>
<span class="cp">				(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_putfh_maxsz + \</span>
<span class="cp">				 decode_open_confirm_maxsz)</span>
<span class="cp">#define NFS4_enc_open_noattr_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">					encode_sequence_maxsz + \</span>
<span class="cp">					encode_putfh_maxsz + \</span>
<span class="cp">					encode_open_maxsz + \</span>
<span class="cp">					encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_open_noattr_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">					decode_sequence_maxsz + \</span>
<span class="cp">					decode_putfh_maxsz + \</span>
<span class="cp">					decode_open_maxsz + \</span>
<span class="cp">					decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_open_downgrade_sz \</span>
<span class="cp">				(compound_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_sequence_maxsz + \</span>
<span class="cp">				 encode_putfh_maxsz + \</span>
<span class="cp">				 encode_open_downgrade_maxsz + \</span>
<span class="cp">				 encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_open_downgrade_sz \</span>
<span class="cp">				(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_sequence_maxsz + \</span>
<span class="cp">				 decode_putfh_maxsz + \</span>
<span class="cp">				 decode_open_downgrade_maxsz + \</span>
<span class="cp">				 decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_close_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_sequence_maxsz + \</span>
<span class="cp">				 encode_putfh_maxsz + \</span>
<span class="cp">				 encode_close_maxsz + \</span>
<span class="cp">				 encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_close_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_sequence_maxsz + \</span>
<span class="cp">				 decode_putfh_maxsz + \</span>
<span class="cp">				 decode_close_maxsz + \</span>
<span class="cp">				 decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_setattr_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_sequence_maxsz + \</span>
<span class="cp">				 encode_putfh_maxsz + \</span>
<span class="cp">				 encode_setattr_maxsz + \</span>
<span class="cp">				 encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_setattr_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_sequence_maxsz + \</span>
<span class="cp">				 decode_putfh_maxsz + \</span>
<span class="cp">				 decode_setattr_maxsz + \</span>
<span class="cp">				 decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_fsinfo_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_fsinfo_maxsz)</span>
<span class="cp">#define NFS4_dec_fsinfo_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_fsinfo_maxsz)</span>
<span class="cp">#define NFS4_enc_renew_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_renew_maxsz)</span>
<span class="cp">#define NFS4_dec_renew_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_renew_maxsz)</span>
<span class="cp">#define NFS4_enc_setclientid_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_setclientid_maxsz)</span>
<span class="cp">#define NFS4_dec_setclientid_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_setclientid_maxsz)</span>
<span class="cp">#define NFS4_enc_setclientid_confirm_sz \</span>
<span class="cp">				(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_setclientid_confirm_maxsz + \</span>
<span class="cp">				encode_putrootfh_maxsz + \</span>
<span class="cp">				encode_fsinfo_maxsz)</span>
<span class="cp">#define NFS4_dec_setclientid_confirm_sz \</span>
<span class="cp">				(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_setclientid_confirm_maxsz + \</span>
<span class="cp">				decode_putrootfh_maxsz + \</span>
<span class="cp">				decode_fsinfo_maxsz)</span>
<span class="cp">#define NFS4_enc_lock_sz        (compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_lock_maxsz)</span>
<span class="cp">#define NFS4_dec_lock_sz        (compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_lock_maxsz)</span>
<span class="cp">#define NFS4_enc_lockt_sz       (compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_lockt_maxsz)</span>
<span class="cp">#define NFS4_dec_lockt_sz       (compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_sequence_maxsz + \</span>
<span class="cp">				 decode_putfh_maxsz + \</span>
<span class="cp">				 decode_lockt_maxsz)</span>
<span class="cp">#define NFS4_enc_locku_sz       (compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_locku_maxsz)</span>
<span class="cp">#define NFS4_dec_locku_sz       (compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_locku_maxsz)</span>
<span class="cp">#define NFS4_enc_release_lockowner_sz \</span>
<span class="cp">				(compound_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_lockowner_maxsz)</span>
<span class="cp">#define NFS4_dec_release_lockowner_sz \</span>
<span class="cp">				(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_lockowner_maxsz)</span>
<span class="cp">#define NFS4_enc_access_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_access_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_access_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_access_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_getattr_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_getattr_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_lookup_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_lookup_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz + \</span>
<span class="cp">				encode_getfh_maxsz)</span>
<span class="cp">#define NFS4_dec_lookup_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_lookup_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz + \</span>
<span class="cp">				decode_getfh_maxsz)</span>
<span class="cp">#define NFS4_enc_lookup_root_sz (compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putrootfh_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz + \</span>
<span class="cp">				encode_getfh_maxsz)</span>
<span class="cp">#define NFS4_dec_lookup_root_sz (compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putrootfh_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz + \</span>
<span class="cp">				decode_getfh_maxsz)</span>
<span class="cp">#define NFS4_enc_remove_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_remove_maxsz)</span>
<span class="cp">#define NFS4_dec_remove_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_remove_maxsz)</span>
<span class="cp">#define NFS4_enc_rename_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_savefh_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_rename_maxsz)</span>
<span class="cp">#define NFS4_dec_rename_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_savefh_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_rename_maxsz)</span>
<span class="cp">#define NFS4_enc_link_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_savefh_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_link_maxsz + \</span>
<span class="cp">				encode_restorefh_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_link_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_savefh_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_link_maxsz + \</span>
<span class="cp">				decode_restorefh_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_symlink_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_symlink_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz + \</span>
<span class="cp">				encode_getfh_maxsz)</span>
<span class="cp">#define NFS4_dec_symlink_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_symlink_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz + \</span>
<span class="cp">				decode_getfh_maxsz)</span>
<span class="cp">#define NFS4_enc_create_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_create_maxsz + \</span>
<span class="cp">				encode_getfh_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_create_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_create_maxsz + \</span>
<span class="cp">				decode_getfh_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_pathconf_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_pathconf_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_statfs_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_statfs_maxsz)</span>
<span class="cp">#define NFS4_dec_statfs_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_statfs_maxsz)</span>
<span class="cp">#define NFS4_enc_server_caps_sz (compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_server_caps_sz (compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_delegreturn_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_delegreturn_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_delegreturn_sz (compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_delegreturn_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_getacl_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_getacl_maxsz)</span>
<span class="cp">#define NFS4_dec_getacl_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_getacl_maxsz)</span>
<span class="cp">#define NFS4_enc_setacl_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_setacl_maxsz)</span>
<span class="cp">#define NFS4_dec_setacl_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_setacl_maxsz)</span>
<span class="cp">#define NFS4_enc_fs_locations_sz \</span>
<span class="cp">				(compound_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_sequence_maxsz + \</span>
<span class="cp">				 encode_putfh_maxsz + \</span>
<span class="cp">				 encode_lookup_maxsz + \</span>
<span class="cp">				 encode_fs_locations_maxsz)</span>
<span class="cp">#define NFS4_dec_fs_locations_sz \</span>
<span class="cp">				(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_sequence_maxsz + \</span>
<span class="cp">				 decode_putfh_maxsz + \</span>
<span class="cp">				 decode_lookup_maxsz + \</span>
<span class="cp">				 decode_fs_locations_maxsz)</span>
<span class="cp">#define NFS4_enc_secinfo_sz 	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_secinfo_maxsz)</span>
<span class="cp">#define NFS4_dec_secinfo_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_secinfo_maxsz)</span>
<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
<span class="cp">#define NFS4_enc_bind_conn_to_session_sz \</span>
<span class="cp">				(compound_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_bind_conn_to_session_maxsz)</span>
<span class="cp">#define NFS4_dec_bind_conn_to_session_sz \</span>
<span class="cp">				(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_bind_conn_to_session_maxsz)</span>
<span class="cp">#define NFS4_enc_exchange_id_sz \</span>
<span class="cp">				(compound_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_exchange_id_maxsz)</span>
<span class="cp">#define NFS4_dec_exchange_id_sz \</span>
<span class="cp">				(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_exchange_id_maxsz)</span>
<span class="cp">#define NFS4_enc_create_session_sz \</span>
<span class="cp">				(compound_encode_hdr_maxsz + \</span>
<span class="cp">				 encode_create_session_maxsz)</span>
<span class="cp">#define NFS4_dec_create_session_sz \</span>
<span class="cp">				(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_create_session_maxsz)</span>
<span class="cp">#define NFS4_enc_destroy_session_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">					 encode_destroy_session_maxsz)</span>
<span class="cp">#define NFS4_dec_destroy_session_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">					 decode_destroy_session_maxsz)</span>
<span class="cp">#define NFS4_enc_destroy_clientid_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">					 encode_destroy_clientid_maxsz)</span>
<span class="cp">#define NFS4_dec_destroy_clientid_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">					 decode_destroy_clientid_maxsz)</span>
<span class="cp">#define NFS4_enc_sequence_sz \</span>
<span class="cp">				(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 encode_sequence_maxsz)</span>
<span class="cp">#define NFS4_dec_sequence_sz \</span>
<span class="cp">				(compound_decode_hdr_maxsz + \</span>
<span class="cp">				 decode_sequence_maxsz)</span>
<span class="cp">#define NFS4_enc_get_lease_time_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">					 encode_sequence_maxsz + \</span>
<span class="cp">					 encode_putrootfh_maxsz + \</span>
<span class="cp">					 encode_fsinfo_maxsz)</span>
<span class="cp">#define NFS4_dec_get_lease_time_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">					 decode_sequence_maxsz + \</span>
<span class="cp">					 decode_putrootfh_maxsz + \</span>
<span class="cp">					 decode_fsinfo_maxsz)</span>
<span class="cp">#define NFS4_enc_reclaim_complete_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">					 encode_sequence_maxsz + \</span>
<span class="cp">					 encode_reclaim_complete_maxsz)</span>
<span class="cp">#define NFS4_dec_reclaim_complete_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">					 decode_sequence_maxsz + \</span>
<span class="cp">					 decode_reclaim_complete_maxsz)</span>
<span class="cp">#define NFS4_enc_getdevicelist_sz (compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_getdevicelist_maxsz)</span>
<span class="cp">#define NFS4_dec_getdevicelist_sz (compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_getdevicelist_maxsz)</span>
<span class="cp">#define NFS4_enc_getdeviceinfo_sz (compound_encode_hdr_maxsz +    \</span>
<span class="cp">				encode_sequence_maxsz +\</span>
<span class="cp">				encode_getdeviceinfo_maxsz)</span>
<span class="cp">#define NFS4_dec_getdeviceinfo_sz (compound_decode_hdr_maxsz +    \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_getdeviceinfo_maxsz)</span>
<span class="cp">#define NFS4_enc_layoutget_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz +        \</span>
<span class="cp">				encode_layoutget_maxsz)</span>
<span class="cp">#define NFS4_dec_layoutget_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz +        \</span>
<span class="cp">				decode_layoutget_maxsz)</span>
<span class="cp">#define NFS4_enc_layoutcommit_sz (compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz +\</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_layoutcommit_maxsz + \</span>
<span class="cp">				encode_getattr_maxsz)</span>
<span class="cp">#define NFS4_dec_layoutcommit_sz (compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_layoutcommit_maxsz + \</span>
<span class="cp">				decode_getattr_maxsz)</span>
<span class="cp">#define NFS4_enc_layoutreturn_sz (compound_encode_hdr_maxsz + \</span>
<span class="cp">				encode_sequence_maxsz + \</span>
<span class="cp">				encode_putfh_maxsz + \</span>
<span class="cp">				encode_layoutreturn_maxsz)</span>
<span class="cp">#define NFS4_dec_layoutreturn_sz (compound_decode_hdr_maxsz + \</span>
<span class="cp">				decode_sequence_maxsz + \</span>
<span class="cp">				decode_putfh_maxsz + \</span>
<span class="cp">				decode_layoutreturn_maxsz)</span>
<span class="cp">#define NFS4_enc_secinfo_no_name_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">					encode_sequence_maxsz + \</span>
<span class="cp">					encode_putrootfh_maxsz +\</span>
<span class="cp">					encode_secinfo_no_name_maxsz)</span>
<span class="cp">#define NFS4_dec_secinfo_no_name_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">					decode_sequence_maxsz + \</span>
<span class="cp">					decode_putrootfh_maxsz + \</span>
<span class="cp">					decode_secinfo_no_name_maxsz)</span>
<span class="cp">#define NFS4_enc_test_stateid_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">					 encode_sequence_maxsz + \</span>
<span class="cp">					 encode_test_stateid_maxsz)</span>
<span class="cp">#define NFS4_dec_test_stateid_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">					 decode_sequence_maxsz + \</span>
<span class="cp">					 decode_test_stateid_maxsz)</span>
<span class="cp">#define NFS4_enc_free_stateid_sz	(compound_encode_hdr_maxsz + \</span>
<span class="cp">					 encode_sequence_maxsz + \</span>
<span class="cp">					 encode_free_stateid_maxsz)</span>
<span class="cp">#define NFS4_dec_free_stateid_sz	(compound_decode_hdr_maxsz + \</span>
<span class="cp">					 decode_sequence_maxsz + \</span>
<span class="cp">					 decode_free_stateid_maxsz)</span>

<span class="k">const</span> <span class="n">u32</span> <span class="n">nfs41_maxwrite_overhead</span> <span class="o">=</span> <span class="p">((</span><span class="n">RPC_MAX_HEADER_WITH_AUTH</span> <span class="o">+</span>
				      <span class="n">compound_encode_hdr_maxsz</span> <span class="o">+</span>
				      <span class="n">encode_sequence_maxsz</span> <span class="o">+</span>
				      <span class="n">encode_putfh_maxsz</span> <span class="o">+</span>
				      <span class="n">encode_getattr_maxsz</span><span class="p">)</span> <span class="o">*</span>
				     <span class="n">XDR_UNIT</span><span class="p">);</span>

<span class="k">const</span> <span class="n">u32</span> <span class="n">nfs41_maxread_overhead</span> <span class="o">=</span> <span class="p">((</span><span class="n">RPC_MAX_HEADER_WITH_AUTH</span> <span class="o">+</span>
				     <span class="n">compound_decode_hdr_maxsz</span> <span class="o">+</span>
				     <span class="n">decode_sequence_maxsz</span> <span class="o">+</span>
				     <span class="n">decode_putfh_maxsz</span><span class="p">)</span> <span class="o">*</span>
				    <span class="n">XDR_UNIT</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">send_implementation_id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

<span class="n">module_param</span><span class="p">(</span><span class="n">send_implementation_id</span><span class="p">,</span> <span class="n">ushort</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">send_implementation_id</span><span class="p">,</span>
		<span class="s">&quot;Send implementation ID with NFSv4.1 exchange_id&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">umode_t</span> <span class="n">nfs_type2fmt</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">NF4BAD</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">[</span><span class="n">NF4REG</span><span class="p">]</span> <span class="o">=</span> <span class="n">S_IFREG</span><span class="p">,</span>
	<span class="p">[</span><span class="n">NF4DIR</span><span class="p">]</span> <span class="o">=</span> <span class="n">S_IFDIR</span><span class="p">,</span>
	<span class="p">[</span><span class="n">NF4BLK</span><span class="p">]</span> <span class="o">=</span> <span class="n">S_IFBLK</span><span class="p">,</span>
	<span class="p">[</span><span class="n">NF4CHR</span><span class="p">]</span> <span class="o">=</span> <span class="n">S_IFCHR</span><span class="p">,</span>
	<span class="p">[</span><span class="n">NF4LNK</span><span class="p">]</span> <span class="o">=</span> <span class="n">S_IFLNK</span><span class="p">,</span>
	<span class="p">[</span><span class="n">NF4SOCK</span><span class="p">]</span> <span class="o">=</span> <span class="n">S_IFSOCK</span><span class="p">,</span>
	<span class="p">[</span><span class="n">NF4FIFO</span><span class="p">]</span> <span class="o">=</span> <span class="n">S_IFIFO</span><span class="p">,</span>
	<span class="p">[</span><span class="n">NF4ATTRDIR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">[</span><span class="n">NF4NAMEDATTR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="p">{</span>
	<span class="kt">int32_t</span>		<span class="n">status</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">nops</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span>	<span class="n">nops_p</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">taglen</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span>		<span class="n">tag</span><span class="p">;</span>
	<span class="kt">uint32_t</span>	<span class="n">replen</span><span class="p">;</span>		<span class="cm">/* expected reply words */</span>
	<span class="n">u32</span>		<span class="n">minorversion</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">__be32</span> <span class="o">*</span><span class="nf">reserve_space</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">nbytes</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">xdr_reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">nbytes</span><span class="p">);</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">p</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_opaque_fixed</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">xdr_encode_opaque_fixed</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_string</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">xdr_encode_opaque</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_uint32</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_uint64</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="n">u64</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_nfs4_seqid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_seqid</span> <span class="o">*</span><span class="n">seqid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">seqid</span><span class="o">-&gt;</span><span class="n">sequence</span><span class="o">-&gt;</span><span class="n">counter</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_compound_hdr</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">rpc_auth</span> <span class="o">*</span><span class="n">auth</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_cred</span><span class="o">-&gt;</span><span class="n">cr_auth</span><span class="p">;</span>

	<span class="cm">/* initialize running count of expected bytes in reply.</span>
<span class="cm">	 * NOTE: the replied tag SHOULD be the same is the one sent,</span>
<span class="cm">	 * but this is not required as a MUST for the server to do so. */</span>
	<span class="n">hdr</span><span class="o">-&gt;</span><span class="n">replen</span> <span class="o">=</span> <span class="n">RPC_REPHDRSIZE</span> <span class="o">+</span> <span class="n">auth</span><span class="o">-&gt;</span><span class="n">au_rslack</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">taglen</span><span class="p">;</span>

	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">taglen</span> <span class="o">&gt;</span> <span class="n">NFS4_MAXTAGLEN</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">taglen</span><span class="p">,</span> <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">tag</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">minorversion</span><span class="p">);</span>
	<span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nops_p</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nops</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_op_hdr</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">enum</span> <span class="n">nfs_opnum4</span> <span class="n">op</span><span class="p">,</span>
		<span class="kt">uint32_t</span> <span class="n">replen</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">op</span><span class="p">);</span>
	<span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nops</span><span class="o">++</span><span class="p">;</span>
	<span class="n">hdr</span><span class="o">-&gt;</span><span class="n">replen</span> <span class="o">+=</span> <span class="n">replen</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_nops</span><span class="p">(</span><span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nops</span> <span class="o">&gt;</span> <span class="n">NFS4_MAX_OPS</span><span class="p">);</span>
	<span class="o">*</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nops_p</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nops</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_nfs4_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">nfs4_stateid</span> <span class="o">*</span><span class="n">stateid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_opaque_fixed</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">stateid</span><span class="p">,</span> <span class="n">NFS4_STATEID_SIZE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_nfs4_verifier</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">nfs4_verifier</span> <span class="o">*</span><span class="n">verf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_opaque_fixed</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">verf</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">NFS4_VERIFIER_SIZE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_attrs</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">iattr</span> <span class="o">*</span><span class="n">iap</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_server</span> <span class="o">*</span><span class="n">server</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">owner_name</span><span class="p">[</span><span class="n">IDMAP_NAMESZ</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">owner_group</span><span class="p">[</span><span class="n">IDMAP_NAMESZ</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">owner_namelen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">owner_grouplen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">q</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">bmval0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">bmval1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * We reserve enough space to write the entire attribute buffer at once.</span>
<span class="cm">	 * In the worst-case, this would be</span>
<span class="cm">	 *   12(bitmap) + 4(attrlen) + 8(size) + 4(mode) + 4(atime) + 4(mtime)</span>
<span class="cm">	 *          = 36 bytes, plus any contribution from variable-length fields</span>
<span class="cm">	 *            such as owner/group.</span>
<span class="cm">	 */</span>
	<span class="n">len</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>

	<span class="cm">/* Sigh */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_SIZE</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_MODE</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_UID</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">owner_namelen</span> <span class="o">=</span> <span class="n">nfs_map_uid_to_name</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_uid</span><span class="p">,</span> <span class="n">owner_name</span><span class="p">,</span> <span class="n">IDMAP_NAMESZ</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">owner_namelen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;nfs: couldn&#39;t resolve uid %d to string</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_uid</span><span class="p">);</span>
			<span class="cm">/* XXX */</span>
			<span class="n">strcpy</span><span class="p">(</span><span class="n">owner_name</span><span class="p">,</span> <span class="s">&quot;nobody&quot;</span><span class="p">);</span>
			<span class="n">owner_namelen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="s">&quot;nobody&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="cm">/* goto out; */</span>
		<span class="p">}</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">(</span><span class="n">XDR_QUADLEN</span><span class="p">(</span><span class="n">owner_namelen</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_GID</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">owner_grouplen</span> <span class="o">=</span> <span class="n">nfs_map_gid_to_group</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_gid</span><span class="p">,</span> <span class="n">owner_group</span><span class="p">,</span> <span class="n">IDMAP_NAMESZ</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">owner_grouplen</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;nfs: couldn&#39;t resolve gid %d to string</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_gid</span><span class="p">);</span>
			<span class="n">strcpy</span><span class="p">(</span><span class="n">owner_group</span><span class="p">,</span> <span class="s">&quot;nobody&quot;</span><span class="p">);</span>
			<span class="n">owner_grouplen</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="s">&quot;nobody&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="cm">/* goto out; */</span>
		<span class="p">}</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">+</span> <span class="p">(</span><span class="n">XDR_QUADLEN</span><span class="p">(</span><span class="n">owner_grouplen</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_ATIME_SET</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_ATIME</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_MTIME_SET</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_MTIME</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * We write the bitmap length now, but leave the bitmap and the attribute</span>
<span class="cm">	 * buffer length to be backfilled at the end of this routine.</span>
<span class="cm">	 */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
	<span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_SIZE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bmval0</span> <span class="o">|=</span> <span class="n">FATTR4_WORD0_SIZE</span><span class="p">;</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_size</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_MODE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bmval1</span> <span class="o">|=</span> <span class="n">FATTR4_WORD1_MODE</span><span class="p">;</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_mode</span> <span class="o">&amp;</span> <span class="n">S_IALLUGO</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_UID</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bmval1</span> <span class="o">|=</span> <span class="n">FATTR4_WORD1_OWNER</span><span class="p">;</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_opaque</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">owner_name</span><span class="p">,</span> <span class="n">owner_namelen</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_GID</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bmval1</span> <span class="o">|=</span> <span class="n">FATTR4_WORD1_OWNER_GROUP</span><span class="p">;</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_opaque</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">owner_group</span><span class="p">,</span> <span class="n">owner_grouplen</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_ATIME_SET</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bmval1</span> <span class="o">|=</span> <span class="n">FATTR4_WORD1_TIME_ACCESS_SET</span><span class="p">;</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_SET_TO_CLIENT_TIME</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_atime</span><span class="p">.</span><span class="n">tv_sec</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_atime</span><span class="p">.</span><span class="n">tv_nsec</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_ATIME</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bmval1</span> <span class="o">|=</span> <span class="n">FATTR4_WORD1_TIME_ACCESS_SET</span><span class="p">;</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_SET_TO_SERVER_TIME</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_MTIME_SET</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bmval1</span> <span class="o">|=</span> <span class="n">FATTR4_WORD1_TIME_MODIFY_SET</span><span class="p">;</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_SET_TO_CLIENT_TIME</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_mtime</span><span class="p">.</span><span class="n">tv_sec</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_mtime</span><span class="p">.</span><span class="n">tv_nsec</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">iap</span><span class="o">-&gt;</span><span class="n">ia_valid</span> <span class="o">&amp;</span> <span class="n">ATTR_MTIME</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bmval1</span> <span class="o">|=</span> <span class="n">FATTR4_WORD1_TIME_MODIFY_SET</span><span class="p">;</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_SET_TO_SERVER_TIME</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * Now we backfill the bitmap and the attribute buffer length.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">!=</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;NFS: Attr length error, %u != %Zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">len</span><span class="p">,</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">q</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">q</span> <span class="o">-</span> <span class="mi">12</span><span class="p">;</span>
	<span class="o">*</span><span class="n">q</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">bmval0</span><span class="p">);</span>
	<span class="o">*</span><span class="n">q</span><span class="o">++</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">bmval1</span><span class="p">);</span>
	<span class="o">*</span><span class="n">q</span> <span class="o">=</span> <span class="n">htonl</span><span class="p">(</span><span class="n">len</span><span class="p">);</span>

<span class="cm">/* out: */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_access</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">access</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_ACCESS</span><span class="p">,</span> <span class="n">decode_access_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">access</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_closeargs</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_CLOSE</span><span class="p">,</span> <span class="n">decode_close_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nfs4_seqid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">seqid</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_commit</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_commitargs</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_COMMIT</span><span class="p">,</span> <span class="n">decode_commit_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_create_arg</span> <span class="o">*</span><span class="n">create</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_CREATE</span><span class="p">,</span> <span class="n">decode_create_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">create</span><span class="o">-&gt;</span><span class="n">ftype</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">create</span><span class="o">-&gt;</span><span class="n">ftype</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">NF4LNK</span>:
		<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">create</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">symlink</span><span class="p">.</span><span class="n">len</span><span class="p">);</span>
		<span class="n">xdr_write_pages</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">create</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">symlink</span><span class="p">.</span><span class="n">pages</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">create</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">symlink</span><span class="p">.</span><span class="n">len</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">NF4BLK</span>: <span class="k">case</span> <span class="n">NF4CHR</span>:
		<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">create</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">device</span><span class="p">.</span><span class="n">specdata1</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">create</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">device</span><span class="p">.</span><span class="n">specdata2</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">create</span><span class="o">-&gt;</span><span class="n">name</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">create</span><span class="o">-&gt;</span><span class="n">name</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="n">encode_attrs</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">create</span><span class="o">-&gt;</span><span class="n">attrs</span><span class="p">,</span> <span class="n">create</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_getattr_one</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">bitmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETATTR</span><span class="p">,</span> <span class="n">decode_getattr_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">bitmap</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_getattr_two</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">bm0</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">bm1</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETATTR</span><span class="p">,</span> <span class="n">decode_getattr_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">bm0</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">bm1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">encode_getattr_three</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		     <span class="kt">uint32_t</span> <span class="n">bm0</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">bm1</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">bm2</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETATTR</span><span class="p">,</span> <span class="n">decode_getattr_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bm2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">bm0</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">bm1</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">bm2</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">bm1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">bm0</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">bm1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">bm0</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_getfattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u32</span><span class="o">*</span> <span class="n">bitmask</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_getattr_two</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">nfs4_fattr_bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			   <span class="n">bitmask</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">nfs4_fattr_bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_getfattr_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">bitmask</span><span class="p">,</span>
				 <span class="k">const</span> <span class="n">u32</span> <span class="o">*</span><span class="n">open_bitmap</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_getattr_three</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span>
			     <span class="n">bitmask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">open_bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			     <span class="n">bitmask</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">open_bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
			     <span class="n">bitmask</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">open_bitmap</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			     <span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_fsinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u32</span><span class="o">*</span> <span class="n">bitmask</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_getattr_three</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span>
			     <span class="n">bitmask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">nfs4_fsinfo_bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			     <span class="n">bitmask</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">nfs4_fsinfo_bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
			     <span class="n">bitmask</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">nfs4_fsinfo_bitmap</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			     <span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_fs_locations</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u32</span><span class="o">*</span> <span class="n">bitmask</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_getattr_two</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">nfs4_fs_locations_bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			   <span class="n">bitmask</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">nfs4_fs_locations_bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_getfh</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETFH</span><span class="p">,</span> <span class="n">decode_getfh_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_link</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LINK</span><span class="p">,</span> <span class="n">decode_link_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">nfs4_lock_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">file_lock</span> <span class="o">*</span><span class="n">fl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">block</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_type</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">F_RDLCK</span><span class="o">|</span><span class="n">F_WRLCK</span><span class="o">|</span><span class="n">F_UNLCK</span><span class="p">))</span> <span class="o">==</span> <span class="n">F_RDLCK</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">block</span> <span class="o">?</span> <span class="n">NFS4_READW_LT</span> <span class="o">:</span> <span class="n">NFS4_READ_LT</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">block</span> <span class="o">?</span> <span class="n">NFS4_WRITEW_LT</span> <span class="o">:</span> <span class="n">NFS4_WRITE_LT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">uint64_t</span> <span class="nf">nfs4_lock_length</span><span class="p">(</span><span class="k">struct</span> <span class="n">file_lock</span> <span class="o">*</span><span class="n">fl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_end</span> <span class="o">==</span> <span class="n">OFFSET_MAX</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">~</span><span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span><span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_end</span> <span class="o">-</span> <span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_lockowner</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_lowner</span> <span class="o">*</span><span class="n">lowner</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lowner</span><span class="o">-&gt;</span><span class="n">clientid</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_opaque_fixed</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&quot;lock id:&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">lowner</span><span class="o">-&gt;</span><span class="n">s_dev</span><span class="p">);</span>
	<span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lowner</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * opcode,type,reclaim,offset,length,new_lock_owner = 32</span>
<span class="cm"> * open_seqid,open_stateid,lock_seqid,lock_owner.clientid, lock_owner.id = 40</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_lock_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LOCK</span><span class="p">,</span> <span class="n">decode_lock_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">28</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">nfs4_lock_type</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">fl</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">block</span><span class="p">));</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">reclaim</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_start</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">nfs4_lock_length</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">fl</span><span class="p">));</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">new_lock_owner</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">new_lock_owner</span><span class="p">){</span>
		<span class="n">encode_nfs4_seqid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">open_seqid</span><span class="p">);</span>
		<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">open_stateid</span><span class="p">);</span>
		<span class="n">encode_nfs4_seqid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">lock_seqid</span><span class="p">);</span>
		<span class="n">encode_lockowner</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">lock_owner</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">lock_stateid</span><span class="p">);</span>
		<span class="n">encode_nfs4_seqid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">lock_seqid</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_lockt</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_lockt_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LOCKT</span><span class="p">,</span> <span class="n">decode_lockt_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">nfs4_lock_type</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">fl</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_start</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">nfs4_lock_length</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">fl</span><span class="p">));</span>
	<span class="n">encode_lockowner</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">lock_owner</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_locku</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_locku_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LOCKU</span><span class="p">,</span> <span class="n">decode_locku_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">nfs4_lock_type</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">fl</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
	<span class="n">encode_nfs4_seqid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">seqid</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_start</span><span class="p">);</span>
	<span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">nfs4_lock_length</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">fl</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_release_lockowner</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_lowner</span> <span class="o">*</span><span class="n">lowner</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_RELEASE_LOCKOWNER</span><span class="p">,</span> <span class="n">decode_release_lockowner_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_lockowner</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">lowner</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LOOKUP</span><span class="p">,</span> <span class="n">decode_lookup_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_share_access</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="n">fmode_t</span> <span class="n">fmode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">fmode</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FMODE_READ</span><span class="o">|</span><span class="n">FMODE_WRITE</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">FMODE_READ</span>:
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_SHARE_ACCESS_READ</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">FMODE_WRITE</span>:
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_SHARE_ACCESS_WRITE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">FMODE_READ</span><span class="o">|</span><span class="n">FMODE_WRITE</span>:
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_SHARE_ACCESS_BOTH</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>		<span class="cm">/* for linux, share_deny = 0 always */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">encode_openhdr</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_openargs</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
 <span class="cm">/*</span>
<span class="cm"> * opcode 4, seqid 4, share_access 4, share_deny 4, clientid 8, ownerlen 4,</span>
<span class="cm"> * owner 4 = 32</span>
<span class="cm"> */</span>
	<span class="n">encode_nfs4_seqid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">seqid</span><span class="p">);</span>
	<span class="n">encode_share_access</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">fmode</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">36</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">clientid</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_opaque_fixed</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&quot;open id:&quot;</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">s_dev</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">uniquifier</span><span class="p">);</span>
	<span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">create_time</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">encode_createmode</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_openargs</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfs_client</span> <span class="o">*</span><span class="n">clp</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">open_flags</span> <span class="o">&amp;</span> <span class="n">O_EXCL</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_CREATE_UNCHECKED</span><span class="p">);</span>
		<span class="n">encode_attrs</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">clp</span> <span class="o">=</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">nfs_client</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_mvops</span><span class="o">-&gt;</span><span class="n">minor_version</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">nfs4_has_persistent_session</span><span class="p">(</span><span class="n">clp</span><span class="p">))</span> <span class="p">{</span>
				<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_CREATE_GUARDED</span><span class="p">);</span>
				<span class="n">encode_attrs</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="k">struct</span> <span class="n">iattr</span> <span class="n">dummy</span><span class="p">;</span>

				<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_CREATE_EXCLUSIVE4_1</span><span class="p">);</span>
				<span class="n">encode_nfs4_verifier</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">verifier</span><span class="p">);</span>
				<span class="n">dummy</span><span class="p">.</span><span class="n">ia_valid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">encode_attrs</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dummy</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_CREATE_EXCLUSIVE</span><span class="p">);</span>
			<span class="n">encode_nfs4_verifier</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">verifier</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_opentype</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_openargs</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">open_flags</span> <span class="o">&amp;</span> <span class="n">O_CREAT</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_OPEN_NOCREATE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">claim</span> <span class="o">!=</span> <span class="n">NFS4_OPEN_CLAIM_NULL</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_OPEN_CREATE</span><span class="p">);</span>
		<span class="n">encode_createmode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">encode_delegation_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="n">fmode_t</span> <span class="n">delegation_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">delegation_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_OPEN_DELEGATE_NONE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">FMODE_READ</span>:
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_OPEN_DELEGATE_READ</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">FMODE_WRITE</span><span class="o">|</span><span class="n">FMODE_READ</span>:
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_OPEN_DELEGATE_WRITE</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">encode_claim_null</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_OPEN_CLAIM_NULL</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">encode_claim_previous</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="n">fmode_t</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_OPEN_CLAIM_PREVIOUS</span><span class="p">);</span>
	<span class="n">encode_delegation_type</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">encode_claim_delegate_cur</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="n">nfs4_stateid</span> <span class="o">*</span><span class="n">stateid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_OPEN_CLAIM_DELEGATE_CUR</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">stateid</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_openargs</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_OPEN</span><span class="p">,</span> <span class="n">decode_open_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_openhdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
	<span class="n">encode_opentype</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">claim</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">NFS4_OPEN_CLAIM_NULL</span>:
		<span class="n">encode_claim_null</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">NFS4_OPEN_CLAIM_PREVIOUS</span>:
		<span class="n">encode_claim_previous</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">delegation_type</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">NFS4_OPEN_CLAIM_DELEGATE_CUR</span>:
		<span class="n">encode_claim_delegate_cur</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">delegation</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_open_confirm</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_open_confirmargs</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_OPEN_CONFIRM</span><span class="p">,</span> <span class="n">decode_open_confirm_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="n">encode_nfs4_seqid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">seqid</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_open_downgrade</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_closeargs</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_OPEN_DOWNGRADE</span><span class="p">,</span> <span class="n">decode_open_downgrade_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="n">encode_nfs4_seqid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">seqid</span><span class="p">);</span>
	<span class="n">encode_share_access</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">fmode</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">encode_putfh</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_fh</span> <span class="o">*</span><span class="n">fh</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_PUTFH</span><span class="p">,</span> <span class="n">decode_putfh_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">fh</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">,</span> <span class="n">fh</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_putrootfh</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_PUTROOTFH</span><span class="p">,</span> <span class="n">decode_putrootfh_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_open_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_open_context</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_lock_context</span> <span class="o">*</span><span class="n">l_ctx</span><span class="p">,</span>
		<span class="n">fmode_t</span> <span class="n">fmode</span><span class="p">,</span>
		<span class="kt">int</span> <span class="n">zero_seqid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">nfs4_stateid</span> <span class="n">stateid</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ctx</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">nfs4_select_rw_stateid</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stateid</span><span class="p">,</span> <span class="n">ctx</span><span class="o">-&gt;</span><span class="n">state</span><span class="p">,</span>
				<span class="n">fmode</span><span class="p">,</span> <span class="n">l_ctx</span><span class="o">-&gt;</span><span class="n">lockowner</span><span class="p">,</span> <span class="n">l_ctx</span><span class="o">-&gt;</span><span class="n">pid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">zero_seqid</span><span class="p">)</span>
			<span class="n">stateid</span><span class="p">.</span><span class="n">seqid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">zero_stateid</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_readargs</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_READ</span><span class="p">,</span> <span class="n">decode_read_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_open_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">context</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">lock_context</span><span class="p">,</span>
			<span class="n">FMODE_READ</span><span class="p">,</span> <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">minorversion</span><span class="p">);</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_readdir</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_readdir_arg</span> <span class="o">*</span><span class="n">readdir</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">FATTR4_WORD0_RDATTR_ERROR</span><span class="p">,</span>
		<span class="n">FATTR4_WORD1_MOUNTED_ON_FILEID</span><span class="p">,</span>
	<span class="p">};</span>
	<span class="kt">uint32_t</span> <span class="n">dircount</span> <span class="o">=</span> <span class="n">readdir</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">verf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">readdir</span><span class="o">-&gt;</span><span class="n">plus</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|=</span> <span class="n">FATTR4_WORD0_TYPE</span><span class="o">|</span><span class="n">FATTR4_WORD0_CHANGE</span><span class="o">|</span><span class="n">FATTR4_WORD0_SIZE</span><span class="o">|</span>
			<span class="n">FATTR4_WORD0_FSID</span><span class="o">|</span><span class="n">FATTR4_WORD0_FILEHANDLE</span><span class="o">|</span><span class="n">FATTR4_WORD0_FILEID</span><span class="p">;</span>
		<span class="n">attrs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">|=</span> <span class="n">FATTR4_WORD1_MODE</span><span class="o">|</span><span class="n">FATTR4_WORD1_NUMLINKS</span><span class="o">|</span><span class="n">FATTR4_WORD1_OWNER</span><span class="o">|</span>
			<span class="n">FATTR4_WORD1_OWNER_GROUP</span><span class="o">|</span><span class="n">FATTR4_WORD1_RAWDEV</span><span class="o">|</span>
			<span class="n">FATTR4_WORD1_SPACE_USED</span><span class="o">|</span><span class="n">FATTR4_WORD1_TIME_ACCESS</span><span class="o">|</span>
			<span class="n">FATTR4_WORD1_TIME_METADATA</span><span class="o">|</span><span class="n">FATTR4_WORD1_TIME_MODIFY</span><span class="p">;</span>
		<span class="n">dircount</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* Use mounted_on_fileid only if the server supports it */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">readdir</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_MOUNTED_ON_FILEID</span><span class="p">))</span>
		<span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|=</span> <span class="n">FATTR4_WORD0_FILEID</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_READDIR</span><span class="p">,</span> <span class="n">decode_readdir_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_uint64</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">readdir</span><span class="o">-&gt;</span><span class="n">cookie</span><span class="p">);</span>
	<span class="n">encode_nfs4_verifier</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">readdir</span><span class="o">-&gt;</span><span class="n">verifier</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">dircount</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">readdir</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">readdir</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">readdir</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">verf</span><span class="p">,</span> <span class="n">readdir</span><span class="o">-&gt;</span><span class="n">verifier</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">verf</span><span class="p">));</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: cookie = %Lu, verifier = %08x:%08x, bitmap = %08x:%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">__func__</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">readdir</span><span class="o">-&gt;</span><span class="n">cookie</span><span class="p">,</span>
			<span class="n">verf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">verf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
			<span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">readdir</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">attrs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">readdir</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_readlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_readlink</span> <span class="o">*</span><span class="n">readlink</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_READLINK</span><span class="p">,</span> <span class="n">decode_readlink_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_REMOVE</span><span class="p">,</span> <span class="n">decode_remove_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_rename</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="n">oldname</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="n">newname</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_RENAME</span><span class="p">,</span> <span class="n">decode_rename_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">oldname</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">oldname</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">newname</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">newname</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_renew</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="n">clientid4</span> <span class="n">clid</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_RENEW</span><span class="p">,</span> <span class="n">decode_renew_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_uint64</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">clid</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">encode_restorefh</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_RESTOREFH</span><span class="p">,</span> <span class="n">decode_restorefh_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">encode_setacl</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_setaclargs</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SETATTR</span><span class="p">,</span> <span class="n">decode_setacl_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">zero_stateid</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="mi">4</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">FATTR4_WORD0_ACL</span><span class="p">);</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">acl_len</span> <span class="o">%</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">acl_len</span><span class="p">);</span>
	<span class="n">xdr_write_pages</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">acl_pages</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">acl_pgbase</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">acl_len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">encode_savefh</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SAVEFH</span><span class="p">,</span> <span class="n">decode_savefh_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_setattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_setattrargs</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_server</span> <span class="o">*</span><span class="n">server</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SETATTR</span><span class="p">,</span> <span class="n">decode_setattr_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="n">encode_attrs</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">iap</span><span class="p">,</span> <span class="n">server</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_setclientid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_setclientid</span> <span class="o">*</span><span class="n">setclientid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SETCLIENTID</span><span class="p">,</span> <span class="n">decode_setclientid_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nfs4_verifier</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">setclientid</span><span class="o">-&gt;</span><span class="n">sc_verifier</span><span class="p">);</span>

	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">setclientid</span><span class="o">-&gt;</span><span class="n">sc_name_len</span><span class="p">,</span> <span class="n">setclientid</span><span class="o">-&gt;</span><span class="n">sc_name</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">setclientid</span><span class="o">-&gt;</span><span class="n">sc_prog</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">setclientid</span><span class="o">-&gt;</span><span class="n">sc_netid_len</span><span class="p">,</span> <span class="n">setclientid</span><span class="o">-&gt;</span><span class="n">sc_netid</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">setclientid</span><span class="o">-&gt;</span><span class="n">sc_uaddr_len</span><span class="p">,</span> <span class="n">setclientid</span><span class="o">-&gt;</span><span class="n">sc_uaddr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">setclientid</span><span class="o">-&gt;</span><span class="n">sc_cb_ident</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_setclientid_confirm</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_setclientid_res</span> <span class="o">*</span><span class="n">arg</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SETCLIENTID_CONFIRM</span><span class="p">,</span>
			<span class="n">decode_setclientid_confirm_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_uint64</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="o">-&gt;</span><span class="n">clientid</span><span class="p">);</span>
	<span class="n">encode_nfs4_verifier</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">arg</span><span class="o">-&gt;</span><span class="n">confirm</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_writeargs</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_WRITE</span><span class="p">,</span> <span class="n">decode_write_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_open_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">context</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">lock_context</span><span class="p">,</span>
			<span class="n">FMODE_WRITE</span><span class="p">,</span> <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">minorversion</span><span class="p">);</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">stable</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>

	<span class="n">xdr_write_pages</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">pgbase</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_delegreturn</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">nfs4_stateid</span> <span class="o">*</span><span class="n">stateid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_DELEGRETURN</span><span class="p">,</span> <span class="n">decode_delegreturn_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">stateid</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_secinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">qstr</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SECINFO</span><span class="p">,</span> <span class="n">decode_secinfo_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
<span class="cm">/* NFSv4.1 operations */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_bind_conn_to_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">nfs4_session</span> <span class="o">*</span><span class="n">session</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_BIND_CONN_TO_SESSION</span><span class="p">,</span>
		<span class="n">decode_bind_conn_to_session_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_opaque_fixed</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">session</span><span class="o">-&gt;</span><span class="n">sess_id</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">NFS4_MAX_SESSIONID_LEN</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_CDFC4_BACK_OR_BOTH</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>	<span class="cm">/* use_conn_in_rdma_mode = False */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_exchange_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs41_exchange_id_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">impl_name</span><span class="p">[</span><span class="n">NFS4_OPAQUE_LIMIT</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_EXCHANGE_ID</span><span class="p">,</span> <span class="n">decode_exchange_id_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nfs4_verifier</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">verifier</span><span class="p">);</span>

	<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">id_len</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>	<span class="cm">/* zero length state_protect4_a */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">send_implementation_id</span> <span class="o">&amp;&amp;</span>
	    <span class="k">sizeof</span><span class="p">(</span><span class="n">CONFIG_NFS_V4_1_IMPLEMENTATION_ID_DOMAIN</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span>
	    <span class="k">sizeof</span><span class="p">(</span><span class="n">CONFIG_NFS_V4_1_IMPLEMENTATION_ID_DOMAIN</span><span class="p">)</span>
		<span class="o">&lt;=</span> <span class="n">NFS4_OPAQUE_LIMIT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">impl_name</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">impl_name</span><span class="p">),</span> <span class="s">&quot;%s %s %s %s&quot;</span><span class="p">,</span>
			       <span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">sysname</span><span class="p">,</span> <span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">release</span><span class="p">,</span>
			       <span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">,</span> <span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">machine</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>	<span class="cm">/* implementation id array length=1 */</span>

		<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="n">CONFIG_NFS_V4_1_IMPLEMENTATION_ID_DOMAIN</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">CONFIG_NFS_V4_1_IMPLEMENTATION_ID_DOMAIN</span><span class="p">);</span>
		<span class="n">encode_string</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">impl_name</span><span class="p">);</span>
		<span class="cm">/* just send zeros for nii_date - the date is in nii_name */</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>	<span class="cm">/* implementation id array length=0 */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_create_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">nfs41_create_session_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">machine_name</span><span class="p">[</span><span class="n">NFS4_MAX_MACHINE_NAME_LEN</span><span class="p">];</span>
	<span class="kt">uint32_t</span> <span class="n">len</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfs_client</span> <span class="o">*</span><span class="n">clp</span> <span class="o">=</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">client</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfs_net</span> <span class="o">*</span><span class="n">nn</span> <span class="o">=</span> <span class="n">net_generic</span><span class="p">(</span><span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_net</span><span class="p">,</span> <span class="n">nfs_net_id</span><span class="p">);</span>
	<span class="n">u32</span> <span class="n">max_resp_sz_cached</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Assumes OPEN is the biggest non-idempotent compound.</span>
<span class="cm">	 * 2 is the verifier.</span>
<span class="cm">	 */</span>
	<span class="n">max_resp_sz_cached</span> <span class="o">=</span> <span class="p">(</span><span class="n">NFS4_dec_open_sz</span> <span class="o">+</span> <span class="n">RPC_REPHDRSIZE</span> <span class="o">+</span>
			      <span class="n">RPC_MAX_AUTH_SIZE</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">XDR_UNIT</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">machine_name</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">machine_name</span><span class="p">),</span> <span class="s">&quot;%s&quot;</span><span class="p">,</span>
			<span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_ipaddr</span><span class="p">);</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_CREATE_SESSION</span><span class="p">,</span> <span class="n">decode_create_session_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">16</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="mi">28</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_clientid</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_seqid</span><span class="p">);</span>			<span class="cm">/*Sequence id */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">);</span>			<span class="cm">/*flags */</span>

	<span class="cm">/* Fore Channel */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>				<span class="cm">/* header padding size */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">fc_attrs</span><span class="p">.</span><span class="n">max_rqst_sz</span><span class="p">);</span>	<span class="cm">/* max req size */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">fc_attrs</span><span class="p">.</span><span class="n">max_resp_sz</span><span class="p">);</span>	<span class="cm">/* max resp size */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">max_resp_sz_cached</span><span class="p">);</span>		<span class="cm">/* Max resp sz cached */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">fc_attrs</span><span class="p">.</span><span class="n">max_ops</span><span class="p">);</span>	<span class="cm">/* max operations */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">fc_attrs</span><span class="p">.</span><span class="n">max_reqs</span><span class="p">);</span>	<span class="cm">/* max requests */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>				<span class="cm">/* rdmachannel_attrs */</span>

	<span class="cm">/* Back Channel */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>				<span class="cm">/* header padding size */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">bc_attrs</span><span class="p">.</span><span class="n">max_rqst_sz</span><span class="p">);</span>	<span class="cm">/* max req size */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">bc_attrs</span><span class="p">.</span><span class="n">max_resp_sz</span><span class="p">);</span>	<span class="cm">/* max resp size */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">bc_attrs</span><span class="p">.</span><span class="n">max_resp_sz_cached</span><span class="p">);</span>	<span class="cm">/* Max resp sz cached */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">bc_attrs</span><span class="p">.</span><span class="n">max_ops</span><span class="p">);</span>	<span class="cm">/* max operations */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">bc_attrs</span><span class="p">.</span><span class="n">max_reqs</span><span class="p">);</span>	<span class="cm">/* max requests */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>				<span class="cm">/* rdmachannel_attrs */</span>

	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">cb_program</span><span class="p">);</span>		<span class="cm">/* cb_program */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">RPC_AUTH_UNIX</span><span class="p">);</span>			<span class="cm">/* auth_sys */</span>

	<span class="cm">/* authsys_parms rfc1831 */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="n">__be32</span><span class="p">)</span><span class="n">nn</span><span class="o">-&gt;</span><span class="n">boot_time</span><span class="p">.</span><span class="n">tv_nsec</span><span class="p">;</span>		<span class="cm">/* stamp */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_opaque</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">machine_name</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>				<span class="cm">/* UID */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>				<span class="cm">/* GID */</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>				<span class="cm">/* No more gids */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_destroy_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">nfs4_session</span> <span class="o">*</span><span class="n">session</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_DESTROY_SESSION</span><span class="p">,</span> <span class="n">decode_destroy_session_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_opaque_fixed</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">session</span><span class="o">-&gt;</span><span class="n">sess_id</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">NFS4_MAX_SESSIONID_LEN</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_destroy_clientid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				   <span class="kt">uint64_t</span> <span class="n">clientid</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_DESTROY_CLIENTID</span><span class="p">,</span> <span class="n">decode_destroy_clientid_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_uint64</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">clientid</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_reclaim_complete</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">nfs41_reclaim_complete_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_RECLAIM_COMPLETE</span><span class="p">,</span> <span class="n">decode_reclaim_complete_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">one_fs</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_sequence</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			    <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_sequence_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
	<span class="k">struct</span> <span class="n">nfs4_session</span> <span class="o">*</span><span class="n">session</span> <span class="o">=</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">sa_session</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfs4_slot_table</span> <span class="o">*</span><span class="n">tp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfs4_slot</span> <span class="o">*</span><span class="n">slot</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">session</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">tp</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">fc_slot_table</span><span class="p">;</span>

	<span class="n">WARN_ON</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">sa_slotid</span> <span class="o">==</span> <span class="n">NFS4_MAX_SLOT_TABLE</span><span class="p">);</span>
	<span class="n">slot</span> <span class="o">=</span> <span class="n">tp</span><span class="o">-&gt;</span><span class="n">slots</span> <span class="o">+</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">sa_slotid</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SEQUENCE</span><span class="p">,</span> <span class="n">decode_sequence_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Sessionid + seqid + slotid + max slotid + cache_this</span>
<span class="cm">	 */</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: sessionid=%u:%u:%u:%u seqid=%d slotid=%d &quot;</span>
		<span class="s">&quot;max_slotid=%d cache_this=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">__func__</span><span class="p">,</span>
		<span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">sess_id</span><span class="p">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
		<span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">sess_id</span><span class="p">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
		<span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">sess_id</span><span class="p">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span>
		<span class="p">((</span><span class="n">u32</span> <span class="o">*</span><span class="p">)</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">sess_id</span><span class="p">.</span><span class="n">data</span><span class="p">)[</span><span class="mi">3</span><span class="p">],</span>
		<span class="n">slot</span><span class="o">-&gt;</span><span class="n">seq_nr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">sa_slotid</span><span class="p">,</span>
		<span class="n">tp</span><span class="o">-&gt;</span><span class="n">highest_used_slotid</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">sa_cache_this</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">NFS4_MAX_SESSIONID_LEN</span> <span class="o">+</span> <span class="mi">16</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_opaque_fixed</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">session</span><span class="o">-&gt;</span><span class="n">sess_id</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">NFS4_MAX_SESSIONID_LEN</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">slot</span><span class="o">-&gt;</span><span class="n">seq_nr</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">sa_slotid</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">tp</span><span class="o">-&gt;</span><span class="n">highest_used_slotid</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">sa_cache_this</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_NFS_V4_1</span>
<span class="k">static</span> <span class="kt">void</span>
<span class="nf">encode_getdevicelist</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		     <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_getdevicelist_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="n">nfs4_verifier</span> <span class="n">dummy</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="s">&quot;dummmmmy&quot;</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETDEVICELIST</span><span class="p">,</span> <span class="n">decode_getdevicelist_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">layoutclass</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS4_PNFS_GETDEVLIST_MAXNUM</span><span class="p">);</span>
	<span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">0ULL</span><span class="p">);</span>                          <span class="cm">/* cookie */</span>
	<span class="n">encode_nfs4_verifier</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dummy</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">encode_getdeviceinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		     <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_getdeviceinfo_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETDEVICEINFO</span><span class="p">,</span> <span class="n">decode_getdeviceinfo_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span> <span class="o">+</span> <span class="n">NFS4_DEVICEID4_SIZE</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_opaque_fixed</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev_id</span><span class="p">.</span><span class="n">data</span><span class="p">,</span>
				    <span class="n">NFS4_DEVICEID4_SIZE</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">layout_type</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">pglen</span><span class="p">);</span>		<span class="cm">/* gdia_maxcount */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>				<span class="cm">/* bitmap length 0 */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">encode_layoutget</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		      <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_layoutget_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LAYOUTGET</span><span class="p">,</span> <span class="n">decode_layoutget_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">36</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>     <span class="cm">/* Signal layout available */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">iomode</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">minlength</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">maxcount</span><span class="p">);</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: 1st type:0x%x iomode:%d off:%lu len:%lu mc:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">__func__</span><span class="p">,</span>
		<span class="n">args</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">,</span>
		<span class="n">args</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">iomode</span><span class="p">,</span>
		<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">offset</span><span class="p">,</span>
		<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">length</span><span class="p">,</span>
		<span class="n">args</span><span class="o">-&gt;</span><span class="n">maxcount</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">encode_layoutcommit</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span>
		    <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_layoutcommit_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: lbw: %llu type: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">lastbytewritten</span><span class="p">,</span>
		<span class="n">NFS_SERVER</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pnfs_curr_ld</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LAYOUTCOMMIT</span><span class="p">,</span> <span class="n">decode_layoutcommit_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
	<span class="cm">/* Only whole file layouts */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="cm">/* offset */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">lastbytewritten</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>	<span class="cm">/* length */</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="cm">/* reclaim */</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* newoffset = TRUE */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">lastbytewritten</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="cm">/* Never send time_modify_changed */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">NFS_SERVER</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pnfs_curr_ld</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">);</span><span class="cm">/* type */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">NFS_SERVER</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pnfs_curr_ld</span><span class="o">-&gt;</span><span class="n">encode_layoutcommit</span><span class="p">)</span>
		<span class="n">NFS_SERVER</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pnfs_curr_ld</span><span class="o">-&gt;</span><span class="n">encode_layoutcommit</span><span class="p">(</span>
			<span class="n">NFS_I</span><span class="p">(</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">layout</span><span class="p">,</span> <span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="cm">/* no layout-type payload */</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">encode_layoutreturn</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		    <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_layoutreturn_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LAYOUTRETURN</span><span class="p">,</span> <span class="n">decode_layoutreturn_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>		<span class="cm">/* reclaim. always 0 for now */</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">layout_type</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span><span class="o">++</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">IOMODE_ANY</span><span class="p">);</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">cpu_to_be32</span><span class="p">(</span><span class="n">RETURN_FILE</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">reserve_space</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_encode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">NFS4_MAX_UINT64</span><span class="p">);</span>
	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_lock</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_lock</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">NFS_SERVER</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pnfs_curr_ld</span><span class="o">-&gt;</span><span class="n">encode_layoutreturn</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">NFS_SERVER</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">pnfs_curr_ld</span><span class="o">-&gt;</span><span class="n">encode_layoutreturn</span><span class="p">(</span>
			<span class="n">NFS_I</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">inode</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">layout</span><span class="p">,</span> <span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">encode_secinfo_no_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		       <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs41_secinfo_no_name_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SECINFO_NO_NAME</span><span class="p">,</span> <span class="n">decode_secinfo_no_name_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">style</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_test_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs41_test_stateid_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_TEST_STATEID</span><span class="p">,</span> <span class="n">decode_test_stateid_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_uint32</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">encode_free_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs41_free_stateid_args</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">encode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_FREE_STATEID</span><span class="p">,</span> <span class="n">decode_free_stateid_maxsz</span><span class="p">,</span> <span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nfs4_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * END OF &quot;GENERIC&quot; ENCODE ROUTINES.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">nfs4_xdr_minorversion</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_sequence_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">sa_session</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">sa_session</span><span class="o">-&gt;</span><span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_mvops</span><span class="o">-&gt;</span><span class="n">minor_version</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode an ACCESS request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_access</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_accessargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_access</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">access</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode LOOKUP request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_lookup_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">dir_fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_lookup</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode LOOKUP_ROOT request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_lookup_root</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_lookup_root_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putrootfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode REMOVE request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_removeargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_remove</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode RENAME request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_rename</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_renameargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">old_dir</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_savefh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">new_dir</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_rename</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">old_name</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">new_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode LINK request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_link</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			     <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_link_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_savefh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">dir_fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_link</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_restorefh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode CREATE request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_create_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">dir_fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_create</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode SYMLINK request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_symlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				 <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_create_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">nfs4_xdr_enc_create</span><span class="p">(</span><span class="n">req</span><span class="p">,</span> <span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode GETATTR request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_getattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				 <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_getattr_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a CLOSE request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs_closeargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_close</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode an OPEN request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">nfs_openargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_open</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr_open</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">open_bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode an OPEN_CONFIRM request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_open_confirm</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">nfs_open_confirmargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">nops</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_open_confirm</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode an OPEN request with no attributes.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_open_noattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs_openargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_open</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode an OPEN_DOWNGRADE request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_open_downgrade</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">nfs_closeargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_open_downgrade</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a LOCK request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">nfs_lock_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_lock</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a LOCKT request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_lockt</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs_lockt_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_lockt</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a LOCKU request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_locku</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs_locku_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_locku</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_release_lockowner</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">nfs_release_lockowner_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_release_lockowner</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">lock_owner</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a READLINK request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_readlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				  <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_readlink</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_readlink</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>

	<span class="n">xdr_inline_pages</span><span class="p">(</span><span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">,</span> <span class="n">hdr</span><span class="p">.</span><span class="n">replen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">,</span>
			<span class="n">args</span><span class="o">-&gt;</span><span class="n">pgbase</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">pglen</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a READDIR request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_readdir</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				 <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_readdir_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_readdir</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>

	<span class="n">xdr_inline_pages</span><span class="p">(</span><span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">,</span> <span class="n">hdr</span><span class="p">.</span><span class="n">replen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">,</span>
			 <span class="n">args</span><span class="o">-&gt;</span><span class="n">pgbase</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: inlined page args = (%u, %p, %u, %u)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">__func__</span><span class="p">,</span> <span class="n">hdr</span><span class="p">.</span><span class="n">replen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">,</span>
			<span class="n">args</span><span class="o">-&gt;</span><span class="n">pgbase</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a READ request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">nfs_readargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_read</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>

	<span class="n">xdr_inline_pages</span><span class="p">(</span><span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">,</span> <span class="n">hdr</span><span class="p">.</span><span class="n">replen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
			 <span class="n">args</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">pgbase</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">);</span>
	<span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">.</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">XDRBUF_READ</span><span class="p">;</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode an SETATTR request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_setattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">nfs_setattrargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_setattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a GETACL request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_getacl</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs_getaclargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>
	<span class="kt">uint32_t</span> <span class="n">replen</span><span class="p">;</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">replen</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">.</span><span class="n">replen</span> <span class="o">+</span> <span class="n">op_decode_hdr_maxsz</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">encode_getattr_two</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">FATTR4_WORD0_ACL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>

	<span class="n">xdr_inline_pages</span><span class="p">(</span><span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">,</span> <span class="n">replen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
		<span class="n">args</span><span class="o">-&gt;</span><span class="n">acl_pages</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">acl_pgbase</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">acl_len</span><span class="p">);</span>

	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode a WRITE request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs_writeargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_write</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_snd_buf</span><span class="p">.</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">XDRBUF_WRITE</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">)</span>
		<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> *  a COMMIT request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_commit</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs_commitargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_commit</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * FSINFO request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_fsinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs4_fsinfo_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_fsinfo</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a PATHCONF request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_pathconf</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				  <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_pathconf_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getattr_one</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">nfs4_pathconf_bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			   <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a STATFS request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_statfs</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_statfs_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getattr_two</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">nfs4_statfs_bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			   <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">nfs4_statfs_bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * GETATTR_BITMAP request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_server_caps</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs4_server_caps_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fhandle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getattr_one</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">FATTR4_WORD0_SUPPORTED_ATTRS</span><span class="o">|</span>
			   <span class="n">FATTR4_WORD0_FH_EXPIRE_TYPE</span><span class="o">|</span>
			   <span class="n">FATTR4_WORD0_LINK_SUPPORT</span><span class="o">|</span>
			   <span class="n">FATTR4_WORD0_SYMLINK_SUPPORT</span><span class="o">|</span>
			   <span class="n">FATTR4_WORD0_ACLSUPPORT</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a RENEW request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_renew</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs_client</span> <span class="o">*</span><span class="n">clp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">nops</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_renew</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_clientid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a SETCLIENTID request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_setclientid</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs4_setclientid</span> <span class="o">*</span><span class="n">sc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">nops</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_setclientid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a SETCLIENTID_CONFIRM request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_setclientid_confirm</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					     <span class="k">struct</span> <span class="n">nfs4_setclientid_res</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">nops</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">};</span>
	<span class="k">const</span> <span class="n">u32</span> <span class="n">lease_bitmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">FATTR4_WORD0_LEASE_TIME</span> <span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_setclientid_confirm</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putrootfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_fsinfo</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">lease_bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * DELEGRETURN request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_delegreturn</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">const</span> <span class="k">struct</span> <span class="n">nfs4_delegreturnargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fhandle</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_delegreturn</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode FS_LOCATIONS request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_fs_locations</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">nfs4_fs_locations_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>
	<span class="kt">uint32_t</span> <span class="n">replen</span><span class="p">;</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">dir_fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_lookup</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">replen</span> <span class="o">=</span> <span class="n">hdr</span><span class="p">.</span><span class="n">replen</span><span class="p">;</span>	<span class="cm">/* get the attribute into args-&gt;page */</span>
	<span class="n">encode_fs_locations</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>

	<span class="n">xdr_inline_pages</span><span class="p">(</span><span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">,</span> <span class="n">replen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">page</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="n">PAGE_SIZE</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode SECINFO request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_secinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs4_secinfo_arg</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">dir_fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_secinfo</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
<span class="cm">/*</span>
<span class="cm"> * BIND_CONN_TO_SESSION request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_bind_conn_to_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs_client</span> <span class="o">*</span><span class="n">clp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_mvops</span><span class="o">-&gt;</span><span class="n">minor_version</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_bind_conn_to_session</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_session</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * EXCHANGE_ID request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_exchange_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs41_exchange_id_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">cl_mvops</span><span class="o">-&gt;</span><span class="n">minor_version</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_exchange_id</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a CREATE_SESSION request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_create_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">nfs41_create_session_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">cl_mvops</span><span class="o">-&gt;</span><span class="n">minor_version</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_create_session</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a DESTROY_SESSION request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_destroy_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">nfs4_session</span> <span class="o">*</span><span class="n">session</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">session</span><span class="o">-&gt;</span><span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_mvops</span><span class="o">-&gt;</span><span class="n">minor_version</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_destroy_session</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a DESTROY_CLIENTID request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_destroy_clientid</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">nfs_client</span> <span class="o">*</span><span class="n">clp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_mvops</span><span class="o">-&gt;</span><span class="n">minor_version</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_destroy_clientid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_clientid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a SEQUENCE request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_sequence</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">nfs4_sequence_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a GET_LEASE_TIME request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_get_lease_time</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">nfs4_get_lease_time_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">la_seq_args</span><span class="p">),</span>
	<span class="p">};</span>
	<span class="k">const</span> <span class="n">u32</span> <span class="n">lease_bitmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">FATTR4_WORD0_LEASE_TIME</span> <span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">la_seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putrootfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_fsinfo</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">lease_bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * a RECLAIM_COMPLETE request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_reclaim_complete</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs41_reclaim_complete_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">)</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_reclaim_complete</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode GETDEVICELIST request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_getdevicelist</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">nfs4_getdevicelist_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getdevicelist</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode GETDEVICEINFO request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_getdeviceinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">nfs4_getdeviceinfo_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getdeviceinfo</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>

	<span class="cm">/* set up reply kvec. Subtract notification bitmap max size (2)</span>
<span class="cm">	 * so that notification bitmap is put in xdr_buf tail */</span>
	<span class="n">xdr_inline_pages</span><span class="p">(</span><span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">,</span> <span class="p">(</span><span class="n">hdr</span><span class="p">.</span><span class="n">replen</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
			 <span class="n">args</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">pages</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">pgbase</span><span class="p">,</span>
			 <span class="n">args</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">pglen</span><span class="p">);</span>

	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> *  Encode LAYOUTGET request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_layoutget</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">nfs4_layoutget_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">NFS_FH</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">inode</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_layoutget</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>

	<span class="n">xdr_inline_pages</span><span class="p">(</span><span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">,</span> <span class="n">hdr</span><span class="p">.</span><span class="n">replen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
	    <span class="n">args</span><span class="o">-&gt;</span><span class="n">layout</span><span class="p">.</span><span class="n">pages</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">layout</span><span class="p">.</span><span class="n">pglen</span><span class="p">);</span>

	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> *  Encode LAYOUTCOMMIT request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_layoutcommit</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">nfs4_layoutcommit_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">nfs4_layoutcommit_data</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span>
		<span class="n">container_of</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_layoutcommit_data</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">NFS_FH</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">inode</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_layoutcommit</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">args</span><span class="p">.</span><span class="n">inode</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">bitmask</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode LAYOUTRETURN request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_layoutreturn</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">nfs4_layoutreturn_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">NFS_FH</span><span class="p">(</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">inode</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_layoutreturn</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode SECINFO_NO_NAME request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_enc_secinfo_no_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">nfs41_secinfo_no_name_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putrootfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_secinfo_no_name</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> *  Encode TEST_STATEID request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_test_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">nfs41_test_stateid_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_test_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> *  Encode FREE_STATEID request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_free_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs41_free_stateid_args</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_free_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">print_overflow_msg</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">func</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;nfs: %s: prematurely hit end of receive buffer. &quot;</span>
		<span class="s">&quot;Remaining buffer length is %tu words.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">func</span><span class="p">,</span> <span class="n">xdr</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">-</span> <span class="n">xdr</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_opaque_inline</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">len</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">string</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="o">*</span><span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">*</span><span class="n">len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="o">*</span><span class="n">string</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_compound_hdr</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">compound_hdr</span> <span class="o">*</span><span class="n">hdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">hdr</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">hdr</span><span class="o">-&gt;</span><span class="n">taglen</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">hdr</span><span class="o">-&gt;</span><span class="n">taglen</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">hdr</span><span class="o">-&gt;</span><span class="n">tag</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">+=</span> <span class="n">XDR_QUADLEN</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">taglen</span><span class="p">);</span>
	<span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nops</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">nops</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">nfs4_stat_to_errno</span><span class="p">(</span><span class="n">hdr</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_op_hdr</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">enum</span> <span class="n">nfs_opnum4</span> <span class="n">expected</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">opnum</span><span class="p">;</span>
	<span class="kt">int32_t</span> <span class="n">nfserr</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">opnum</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">opnum</span> <span class="o">!=</span> <span class="n">expected</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;nfs: Server returned operation&quot;</span>
			<span class="s">&quot; %d but we issued a request for %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">opnum</span><span class="p">,</span> <span class="n">expected</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">nfserr</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">nfserr</span> <span class="o">!=</span> <span class="n">NFS_OK</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">nfs4_stat_to_errno</span><span class="p">(</span><span class="n">nfserr</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Dummy routine */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_ace</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ace</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_client</span> <span class="o">*</span><span class="n">clp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">strlen</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">decode_opaque_inline</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">strlen</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">str</span><span class="p">);</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_bitmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">bmlen</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">bmlen</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="p">(</span><span class="n">bmlen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bmlen</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">bmlen</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">bmlen</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span>
				<span class="n">bitmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">decode_attr_length</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">attrlen</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">**</span><span class="n">savep</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="o">*</span><span class="n">attrlen</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="o">*</span><span class="n">savep</span> <span class="o">=</span> <span class="n">xdr</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_supported</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_SUPPORTED_ATTRS</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">decode_attr_bitmap</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmask</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_SUPPORTED_ATTRS</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">bitmask</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bitmask</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bitmask</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: bitmask=%08x:%08x:%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
		<span class="n">bitmask</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">bitmask</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">bitmask</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_TYPE</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_TYPE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">type</span> <span class="o">&lt;</span> <span class="n">NF4REG</span> <span class="o">||</span> <span class="o">*</span><span class="n">type</span> <span class="o">&gt;</span> <span class="n">NF4NAMEDATTR</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: bad type %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">*</span><span class="n">type</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_TYPE</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_TYPE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: type=0%o</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">nfs_type2fmt</span><span class="p">[</span><span class="o">*</span><span class="n">type</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_fh_expire_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				      <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_FH_EXPIRE_TYPE</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_FH_EXPIRE_TYPE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_FH_EXPIRE_TYPE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: expire type=0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">*</span><span class="n">type</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_change</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">change</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">change</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_CHANGE</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_CHANGE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">change</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_CHANGE</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_CHANGE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: change attribute=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">change</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_size</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_SIZE</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_SIZE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_SIZE</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_SIZE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: file size=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">size</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_link_support</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_LINK_SUPPORT</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_LINK_SUPPORT</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_LINK_SUPPORT</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: link support=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">*</span><span class="n">res</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="s">&quot;false&quot;</span> <span class="o">:</span> <span class="s">&quot;true&quot;</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_symlink_support</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_SYMLINK_SUPPORT</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_SYMLINK_SUPPORT</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_SYMLINK_SUPPORT</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: symlink support=%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">*</span><span class="n">res</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="s">&quot;false&quot;</span> <span class="o">:</span> <span class="s">&quot;true&quot;</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_fsid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_fsid</span> <span class="o">*</span><span class="n">fsid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">fsid</span><span class="o">-&gt;</span><span class="n">major</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">fsid</span><span class="o">-&gt;</span><span class="n">minor</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_FSID</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_FSID</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsid</span><span class="o">-&gt;</span><span class="n">major</span><span class="p">);</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsid</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_FSID</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_FSID</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: fsid=(0x%Lx/0x%Lx)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">fsid</span><span class="o">-&gt;</span><span class="n">major</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="n">fsid</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_lease_time</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">60</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_LEASE_TIME</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_LEASE_TIME</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_LEASE_TIME</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: file size=%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_error</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">int32_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_RDATTR_ERROR</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_RDATTR_ERROR</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_RDATTR_ERROR</span><span class="p">;</span>
		<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_filehandle</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_fh</span> <span class="o">*</span><span class="n">fh</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fh</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">fh</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_FILEHANDLE</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_FILEHANDLE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">NFS4_FHSIZE</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fh</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">fh</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
			<span class="n">fh</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_FILEHANDLE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_aclsupport</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="n">ACL4_SUPPORT_ALLOW_ACL</span><span class="o">|</span><span class="n">ACL4_SUPPORT_DENY_ACL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_ACLSUPPORT</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_ACLSUPPORT</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_ACLSUPPORT</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: ACLs supported=%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_fileid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">fileid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">fileid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_FILEID</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_FILEID</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fileid</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_FILEID</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_FILEID</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: fileid=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">fileid</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_mounted_on_fileid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">fileid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">fileid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_MOUNTED_ON_FILEID</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_MOUNTED_ON_FILEID</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fileid</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_MOUNTED_ON_FILEID</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_MOUNTED_ON_FILEID</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: fileid=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">fileid</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_files_avail</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_FILES_AVAIL</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_FILES_AVAIL</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_FILES_AVAIL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: files avail=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_files_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_FILES_FREE</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_FILES_FREE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_FILES_FREE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: files free=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_files_total</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_FILES_TOTAL</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_FILES_TOTAL</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_FILES_TOTAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: files total=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_pathname</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_pathname</span> <span class="o">*</span><span class="n">path</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">n</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">root_path</span><span class="p">;</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;pathname4: &quot;</span><span class="p">);</span>
	<span class="n">path</span><span class="o">-&gt;</span><span class="n">ncomponents</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">path</span><span class="o">-&gt;</span><span class="n">ncomponents</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">nfs4_string</span> <span class="o">*</span><span class="n">component</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">path</span><span class="o">-&gt;</span><span class="n">components</span><span class="p">[</span><span class="n">path</span><span class="o">-&gt;</span><span class="n">ncomponents</span><span class="p">];</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_opaque_inline</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">component</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">component</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_eio</span><span class="p">;</span>
		<span class="n">ifdebug</span> <span class="p">(</span><span class="n">XDR</span><span class="p">)</span>
			<span class="n">pr_cont</span><span class="p">(</span><span class="s">&quot;%s%.*s &quot;</span><span class="p">,</span>
				<span class="p">(</span><span class="n">path</span><span class="o">-&gt;</span><span class="n">ncomponents</span> <span class="o">!=</span> <span class="n">n</span> <span class="o">?</span> <span class="s">&quot;/ &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">),</span>
				<span class="n">component</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">component</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">path</span><span class="o">-&gt;</span><span class="n">ncomponents</span> <span class="o">&lt;</span> <span class="n">NFS4_PATHNAME_MAXCOMPONENTS</span><span class="p">)</span>
			<span class="n">path</span><span class="o">-&gt;</span><span class="n">ncomponents</span><span class="o">++</span><span class="p">;</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;cannot parse %d components in path</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">out_eio</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">root_path:</span>
<span class="cm">/* a root pathname is sent as a zero component4 */</span>
	<span class="n">path</span><span class="o">-&gt;</span><span class="n">ncomponents</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">path</span><span class="o">-&gt;</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
	<span class="n">path</span><span class="o">-&gt;</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">data</span><span class="o">=</span><span class="nb">NULL</span><span class="p">;</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;pathname4: /</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
<span class="nl">out_eio:</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot; status %d&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
	<span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_fs_locations</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_fs_locations</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_FS_LOCATIONS</span> <span class="o">-</span><span class="mi">1U</span><span class="p">)))</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_FS_LOCATIONS</span><span class="p">)))</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="cm">/* Ignore borken servers that return unrequested attrs */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: fsroot:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_pathname</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">fs_path</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_eio</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">nlocations</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">nlocations</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">m</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">nfs4_fs_location</span> <span class="o">*</span><span class="n">loc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">locations</span><span class="p">[</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">nlocations</span><span class="p">];</span>

		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">m</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

		<span class="n">loc</span><span class="o">-&gt;</span><span class="n">nservers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: servers:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">loc</span><span class="o">-&gt;</span><span class="n">nservers</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">nfs4_string</span> <span class="o">*</span><span class="n">server</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">loc</span><span class="o">-&gt;</span><span class="n">servers</span><span class="p">[</span><span class="n">loc</span><span class="o">-&gt;</span><span class="n">nservers</span><span class="p">];</span>
			<span class="n">status</span> <span class="o">=</span> <span class="n">decode_opaque_inline</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
				<span class="k">goto</span> <span class="n">out_eio</span><span class="p">;</span>
			<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s &quot;</span><span class="p">,</span> <span class="n">server</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">loc</span><span class="o">-&gt;</span><span class="n">nservers</span> <span class="o">&lt;</span> <span class="n">NFS4_FS_LOCATION_MAXSERVERS</span><span class="p">)</span>
				<span class="n">loc</span><span class="o">-&gt;</span><span class="n">nservers</span><span class="o">++</span><span class="p">;</span>
			<span class="k">else</span> <span class="p">{</span>
				<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
				<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: using first %u of %u servers &quot;</span>
					<span class="s">&quot;returned for location %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
						<span class="n">__func__</span><span class="p">,</span>
						<span class="n">NFS4_FS_LOCATION_MAXSERVERS</span><span class="p">,</span>
						<span class="n">m</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">nlocations</span><span class="p">);</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">loc</span><span class="o">-&gt;</span><span class="n">nservers</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
					<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
					<span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
					<span class="n">status</span> <span class="o">=</span> <span class="n">decode_opaque_inline</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">);</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
						<span class="k">goto</span> <span class="n">out_eio</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_pathname</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">loc</span><span class="o">-&gt;</span><span class="n">rootpath</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_eio</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">nlocations</span> <span class="o">&lt;</span> <span class="n">NFS4_FS_LOCATIONS_MAXENTRIES</span><span class="p">)</span>
			<span class="n">res</span><span class="o">-&gt;</span><span class="n">nlocations</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">nlocations</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_V4_LOCATIONS</span><span class="p">;</span>
<span class="nl">out:</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: fs_locations done, error = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
<span class="nl">out_eio:</span>
	<span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_maxfilesize</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_MAXFILESIZE</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_MAXFILESIZE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_MAXFILESIZE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: maxfilesize=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_maxlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">maxlink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">maxlink</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_MAXLINK</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_MAXLINK</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="o">*</span><span class="n">maxlink</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_MAXLINK</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: maxlink=%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">*</span><span class="n">maxlink</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_maxname</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">maxname</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">maxname</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_MAXNAME</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_MAXNAME</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="o">*</span><span class="n">maxname</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_MAXNAME</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: maxname=%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">*</span><span class="n">maxname</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_maxread</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_MAXREAD</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_MAXREAD</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">uint64_t</span> <span class="n">maxread</span><span class="p">;</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">maxread</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">maxread</span> <span class="o">&gt;</span> <span class="mh">0x7FFFFFFF</span><span class="p">)</span>
			<span class="n">maxread</span> <span class="o">=</span> <span class="mh">0x7FFFFFFF</span><span class="p">;</span>
		<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">maxread</span><span class="p">;</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_MAXREAD</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: maxread=%lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_maxwrite</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_MAXWRITE</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_MAXWRITE</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">uint64_t</span> <span class="n">maxwrite</span><span class="p">;</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">maxwrite</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">maxwrite</span> <span class="o">&gt;</span> <span class="mh">0x7FFFFFFF</span><span class="p">)</span>
			<span class="n">maxwrite</span> <span class="o">=</span> <span class="mh">0x7FFFFFFF</span><span class="p">;</span>
		<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint32_t</span><span class="p">)</span><span class="n">maxwrite</span><span class="p">;</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD0_MAXWRITE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: maxwrite=%lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="n">umode_t</span> <span class="o">*</span><span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_MODE</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_MODE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="o">*</span><span class="n">mode</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">S_IFMT</span><span class="p">;</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_MODE</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_MODE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: file mode=0%o</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="n">mode</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_nlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">nlink</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">nlink</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_NUMLINKS</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_NUMLINKS</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="o">*</span><span class="n">nlink</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_NUMLINKS</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_NLINK</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: nlink=%u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="n">nlink</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_owner</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_server</span> <span class="o">*</span><span class="n">server</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">uid</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfs4_string</span> <span class="o">*</span><span class="n">owner_name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">uid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_OWNER</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_OWNER</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">owner_name</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">owner_name</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="n">kmemdup</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">GFP_NOWAIT</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">owner_name</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">owner_name</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
				<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_OWNER_NAME</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;</span> <span class="n">XDR_MAX_NETOBJ</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">nfs_map_name_to_uid</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_OWNER</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: nfs_map_name_to_uid failed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
						<span class="n">__func__</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: name too long (%u)!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">__func__</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_OWNER</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: uid=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="n">uid</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_group</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_server</span> <span class="o">*</span><span class="n">server</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">gid</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfs4_string</span> <span class="o">*</span><span class="n">group_name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">gid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_OWNER_GROUP</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_OWNER_GROUP</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">group_name</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">group_name</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="n">kmemdup</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">GFP_NOWAIT</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">group_name</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">group_name</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
				<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_GROUP_NAME</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;</span> <span class="n">XDR_MAX_NETOBJ</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">nfs_map_group_to_gid</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">p</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">gid</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_GROUP</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: nfs_map_group_to_gid failed!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
						<span class="n">__func__</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: name too long (%u)!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">__func__</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_OWNER_GROUP</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: gid=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="o">*</span><span class="n">gid</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_rdev</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="n">dev_t</span> <span class="o">*</span><span class="n">rdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">major</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">minor</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">rdev</span> <span class="o">=</span> <span class="n">MKDEV</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_RAWDEV</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_RAWDEV</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dev_t</span> <span class="n">tmp</span><span class="p">;</span>

		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">major</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
		<span class="n">minor</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="n">MKDEV</span><span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">MAJOR</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="n">major</span> <span class="o">&amp;&amp;</span> <span class="n">MINOR</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">==</span> <span class="n">minor</span><span class="p">)</span>
			<span class="o">*</span><span class="n">rdev</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span> <span class="n">FATTR4_WORD1_RAWDEV</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_RDEV</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: rdev=(0x%x:0x%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_space_avail</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_SPACE_AVAIL</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_SPACE_AVAIL</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_SPACE_AVAIL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: space avail=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_space_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_SPACE_FREE</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_SPACE_FREE</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_SPACE_FREE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: space free=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_space_total</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_SPACE_TOTAL</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_SPACE_TOTAL</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_SPACE_TOTAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: space total=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_space_used</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">used</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">used</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_SPACE_USED</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_SPACE_USED</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">used</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_SPACE_USED</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_SPACE_USED</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: space used=%Lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
			<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span><span class="p">)</span><span class="o">*</span><span class="n">used</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_time</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="n">time</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">sec</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">nsec</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sec</span><span class="p">);</span>
	<span class="n">nsec</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="p">(</span><span class="kt">time_t</span><span class="p">)</span><span class="n">sec</span><span class="p">;</span>
	<span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">nsec</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_time_access</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="n">time</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_TIME_ACCESS</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_TIME_ACCESS</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_time</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">time</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">status</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_ATIME</span><span class="p">;</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_TIME_ACCESS</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: atime=%ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_sec</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_time_metadata</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="n">time</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_TIME_METADATA</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_TIME_METADATA</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_time</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">time</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">status</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_CTIME</span><span class="p">;</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_TIME_METADATA</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: ctime=%ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_sec</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_time_delta</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="n">time</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_TIME_DELTA</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_TIME_DELTA</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_time</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">time</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_TIME_DELTA</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: time_delta=%ld %ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_sec</span><span class="p">,</span>
		<span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_nsec</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_time_modify</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">timespec</span> <span class="o">*</span><span class="n">time</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_sec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_nsec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_TIME_MODIFY</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_TIME_MODIFY</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_time</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">time</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">status</span> <span class="o">=</span> <span class="n">NFS_ATTR_FATTR_MTIME</span><span class="p">;</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_TIME_MODIFY</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: mtime=%ld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">time</span><span class="o">-&gt;</span><span class="n">tv_sec</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">verify_attr_len</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="n">__be32</span> <span class="o">*</span><span class="n">savep</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">attrlen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">attrwords</span> <span class="o">=</span> <span class="n">XDR_QUADLEN</span><span class="p">(</span><span class="n">attrlen</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nwords</span> <span class="o">=</span> <span class="n">xdr</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">-</span> <span class="n">savep</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">attrwords</span> <span class="o">!=</span> <span class="n">nwords</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: server returned incorrect attribute length: &quot;</span>
			<span class="s">&quot;%u %c %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">__func__</span><span class="p">,</span>
				<span class="n">attrwords</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span>
				<span class="p">(</span><span class="n">attrwords</span> <span class="o">&lt;</span> <span class="n">nwords</span><span class="p">)</span> <span class="o">?</span> <span class="sc">&#39;&lt;&#39;</span> <span class="o">:</span> <span class="sc">&#39;&gt;&#39;</span><span class="p">,</span>
				<span class="n">nwords</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_change_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_change_info</span> <span class="o">*</span><span class="n">cinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">atomic</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">before</span><span class="p">);</span>
	<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cinfo</span><span class="o">-&gt;</span><span class="n">after</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_access</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_accessres</span> <span class="o">*</span><span class="n">access</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">supp</span><span class="p">,</span> <span class="n">acc</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_ACCESS</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">supp</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">acc</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="n">access</span><span class="o">-&gt;</span><span class="n">supported</span> <span class="o">=</span> <span class="n">supp</span><span class="p">;</span>
	<span class="n">access</span><span class="o">-&gt;</span><span class="n">access</span> <span class="o">=</span> <span class="n">acc</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_opaque_fixed</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="n">nfs4_stateid</span> <span class="o">*</span><span class="n">stateid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_opaque_fixed</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">stateid</span><span class="p">,</span> <span class="n">NFS4_STATEID_SIZE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_closeres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_CLOSE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">)</span>
		<span class="n">nfs_increment_open_seqid</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">seqid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_verifier</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">verifier</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_opaque_fixed</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">verifier</span><span class="p">,</span> <span class="n">NFS4_VERIFIER_SIZE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_commit</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_commitres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_COMMIT</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_verifier</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">verf</span><span class="o">-&gt;</span><span class="n">verifier</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_change_info</span> <span class="o">*</span><span class="n">cinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">bmlen</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_CREATE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_change_info</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">)))</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">bmlen</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bmlen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_server_caps</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_server_caps_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">savep</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">attrlen</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETATTR</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_bitmap</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_length</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attrlen</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">savep</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_supported</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">attr_bitmask</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_fh_expire_type</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span>
						 <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">fh_expire_type</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_link_support</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">has_links</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_symlink_support</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">has_symlinks</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_aclsupport</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_bitmask</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">verify_attr_len</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">savep</span><span class="p">,</span> <span class="n">attrlen</span><span class="p">);</span>
<span class="nl">xdr_error:</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: xdr returned %d!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">-</span><span class="n">status</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_statfs</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_fsstat</span> <span class="o">*</span><span class="n">fsstat</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">savep</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">attrlen</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETATTR</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_bitmap</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_length</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attrlen</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">savep</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_files_avail</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsstat</span><span class="o">-&gt;</span><span class="n">afiles</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_files_free</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsstat</span><span class="o">-&gt;</span><span class="n">ffiles</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_files_total</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsstat</span><span class="o">-&gt;</span><span class="n">tfiles</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_space_avail</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsstat</span><span class="o">-&gt;</span><span class="n">abytes</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_space_free</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsstat</span><span class="o">-&gt;</span><span class="n">fbytes</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_space_total</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsstat</span><span class="o">-&gt;</span><span class="n">tbytes</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">verify_attr_len</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">savep</span><span class="p">,</span> <span class="n">attrlen</span><span class="p">);</span>
<span class="nl">xdr_error:</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: xdr returned %d!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">-</span><span class="n">status</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_pathconf</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_pathconf</span> <span class="o">*</span><span class="n">pathconf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">savep</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">attrlen</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETATTR</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_bitmap</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_length</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attrlen</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">savep</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_maxlink</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pathconf</span><span class="o">-&gt;</span><span class="n">max_link</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_maxname</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pathconf</span><span class="o">-&gt;</span><span class="n">max_namelen</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">verify_attr_len</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">savep</span><span class="p">,</span> <span class="n">attrlen</span><span class="p">);</span>
<span class="nl">xdr_error:</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: xdr returned %d!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">-</span><span class="n">status</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_threshold_hint</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				  <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span>
				  <span class="kt">uint64_t</span> <span class="o">*</span><span class="n">res</span><span class="p">,</span>
				  <span class="kt">uint32_t</span> <span class="n">hint_bit</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">hint_bit</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_first_threshold_item4</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">nfs4_threshold</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="o">*</span><span class="n">savep</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,},</span> <span class="n">attrlen</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="cm">/* layout type */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">l_type</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="cm">/* thi_hintset bitmap */</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_bitmap</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="cm">/* thi_hintlist length */</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_length</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attrlen</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">savep</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="cm">/* thi_hintlist */</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_threshold_hint</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">rd_sz</span><span class="p">,</span> <span class="n">THRESHOLD_RD</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_threshold_hint</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">wr_sz</span><span class="p">,</span> <span class="n">THRESHOLD_WR</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_threshold_hint</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">rd_io_sz</span><span class="p">,</span>
				       <span class="n">THRESHOLD_RD_IO</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_threshold_hint</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">wr_io_sz</span><span class="p">,</span>
				       <span class="n">THRESHOLD_WR_IO</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">verify_attr_len</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">savep</span><span class="p">,</span> <span class="n">attrlen</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">bm</span> <span class="o">=</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s bm=0x%x rd_sz=%llu wr_sz=%llu rd_io=%llu wr_io=%llu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		 <span class="n">__func__</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">bm</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">rd_sz</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">wr_sz</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">rd_io_sz</span><span class="p">,</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">wr_io_sz</span><span class="p">);</span>
<span class="nl">xdr_error:</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s ret=%d!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Thresholds on pNFS direct I/O vrs MDS I/O</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_mdsthreshold</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				    <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">nfs4_threshold</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">num</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD2_MDSTHRESHOLD</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD2_MDSTHRESHOLD</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Did the server return an unrequested attribute? */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">res</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EREMOTEIO</span><span class="p">;</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">num</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: Warning: Multiple pNFS layout &quot;</span>
				<span class="s">&quot;drivers per filesystem not supported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">__func__</span><span class="p">);</span>

		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_first_threshold_item4</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD2_MDSTHRESHOLD</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_getfattr_attrs</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfs_fattr</span> <span class="o">*</span><span class="n">fattr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_fh</span> <span class="o">*</span><span class="n">fh</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfs4_fs_locations</span> <span class="o">*</span><span class="n">fs_loc</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_server</span> <span class="o">*</span><span class="n">server</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">umode_t</span> <span class="n">fmode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">int32_t</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_type</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">mode</span> <span class="o">|=</span> <span class="n">nfs_type2fmt</span><span class="p">[</span><span class="n">type</span><span class="p">];</span>
		<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_change</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">change_attr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_size</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_fsid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">fsid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_error</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">err</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_filehandle</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">fh</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_fileid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">fileid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_fs_locations</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">fs_loc</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_mode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fmode</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">mode</span> <span class="o">|=</span> <span class="n">fmode</span><span class="p">;</span>
		<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_nlink</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">nlink</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_owner</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">uid</span><span class="p">,</span> <span class="n">fattr</span><span class="o">-&gt;</span><span class="n">owner_name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_group</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">server</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">gid</span><span class="p">,</span> <span class="n">fattr</span><span class="o">-&gt;</span><span class="n">group_name</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_rdev</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">rdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_space_used</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">du</span><span class="p">.</span><span class="n">nfs3</span><span class="p">.</span><span class="n">used</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_time_access</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">atime</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_time_metadata</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">ctime</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_time_modify</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">mtime</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_mounted_on_fileid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">mounted_on_fileid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">|=</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_mdsthreshold</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">fattr</span><span class="o">-&gt;</span><span class="n">mdsthreshold</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

<span class="nl">xdr_error:</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: xdr returned %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">-</span><span class="n">status</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_getfattr_generic</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_fattr</span> <span class="o">*</span><span class="n">fattr</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">nfs_fh</span> <span class="o">*</span><span class="n">fh</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_fs_locations</span> <span class="o">*</span><span class="n">fs_loc</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_server</span> <span class="o">*</span><span class="n">server</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">savep</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">attrlen</span><span class="p">,</span>
		 <span class="n">bitmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETATTR</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_bitmap</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_length</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attrlen</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">savep</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getfattr_attrs</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">fattr</span><span class="p">,</span> <span class="n">fh</span><span class="p">,</span> <span class="n">fs_loc</span><span class="p">,</span> <span class="n">server</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">verify_attr_len</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">savep</span><span class="p">,</span> <span class="n">attrlen</span><span class="p">);</span>
<span class="nl">xdr_error:</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: xdr returned %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">-</span><span class="n">status</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_getfattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_fattr</span> <span class="o">*</span><span class="n">fattr</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">nfs_server</span> <span class="o">*</span><span class="n">server</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_getfattr_generic</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">fattr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">server</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode potentially multiple layout types. Currently we only support</span>
<span class="cm"> * one layout driver per file system.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_first_pnfs_layout_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					 <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">layouttype</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">num</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="cm">/* pNFS is not supported by the underlying file system */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">layouttype</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">num</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;NFS: %s: Warning: Multiple pNFS layout &quot;</span>
			<span class="s">&quot;drivers per filesystem not supported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>

	<span class="cm">/* Decode and set first layout type, move xdr-&gt;p past unused types */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">num</span> <span class="o">*</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="o">*</span><span class="n">layouttype</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * The type of file system exported.</span>
<span class="cm"> * Note we must ensure that layouttype is set in any non-error case.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_pnfstype</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span>
				<span class="kt">uint32_t</span> <span class="o">*</span><span class="n">layouttype</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: bitmap is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD1_FS_LAYOUT_TYPES</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD1_FS_LAYOUT_TYPES</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_first_pnfs_layout_type</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">layouttype</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD1_FS_LAYOUT_TYPES</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="o">*</span><span class="n">layouttype</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * The prefered block size for layout directed io</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_attr_layout_blksize</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">bitmap</span><span class="p">,</span>
				      <span class="kt">uint32_t</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: bitmap is %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD2_LAYOUT_BLKSIZE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="o">*</span><span class="n">res</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">bitmap</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">FATTR4_WORD2_LAYOUT_BLKSIZE</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_fsinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_fsinfo</span> <span class="o">*</span><span class="n">fsinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">savep</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">attrlen</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETATTR</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_bitmap</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_length</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attrlen</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">savep</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">rtmult</span> <span class="o">=</span> <span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">wtmult</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>	<span class="cm">/* ??? */</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_lease_time</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">lease_time</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_maxfilesize</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">maxfilesize</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_maxread</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">rtmax</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">rtpref</span> <span class="o">=</span> <span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">dtpref</span> <span class="o">=</span> <span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">rtmax</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_maxwrite</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">wtmax</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">wtpref</span> <span class="o">=</span> <span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">wtmax</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_time_delta</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">time_delta</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_pnfstype</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">layouttype</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_layout_blksize</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fsinfo</span><span class="o">-&gt;</span><span class="n">blksize</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">verify_attr_len</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">savep</span><span class="p">,</span> <span class="n">attrlen</span><span class="p">);</span>
<span class="nl">xdr_error:</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: xdr returned %d!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">-</span><span class="n">status</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_getfh</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_fh</span> <span class="o">*</span><span class="n">fh</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">len</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="cm">/* Zero handle first to allow comparisons */</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">fh</span><span class="p">));</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETFH</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">NFS4_FHSIZE</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="n">fh</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">fh</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_link</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_change_info</span> <span class="o">*</span><span class="n">cinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LINK</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">decode_change_info</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * We create the owner, so we know a proper owner.id length is 4.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_lock_denied</span> <span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file_lock</span> <span class="o">*</span><span class="n">fl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint64_t</span> <span class="n">offset</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">clientid</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">namelen</span><span class="p">,</span> <span class="n">type</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span> <span class="cm">/* read 32 bytes */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">offset</span><span class="p">);</span> <span class="cm">/* read 2 8-byte long words */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">length</span><span class="p">);</span>
	<span class="n">type</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span> <span class="cm">/* 4 byte read */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fl</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* manipulate file lock */</span>
		<span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">loff_t</span><span class="p">)</span><span class="n">offset</span><span class="p">;</span>
		<span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_end</span> <span class="o">=</span> <span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_start</span> <span class="o">+</span> <span class="p">(</span><span class="n">loff_t</span><span class="p">)</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">==</span> <span class="o">~</span><span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span><span class="mi">0</span><span class="p">)</span>
			<span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_end</span> <span class="o">=</span> <span class="n">OFFSET_MAX</span><span class="p">;</span>
		<span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_type</span> <span class="o">=</span> <span class="n">F_WRLCK</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_type</span> <span class="o">=</span> <span class="n">F_RDLCK</span><span class="p">;</span>
		<span class="n">fl</span><span class="o">-&gt;</span><span class="n">fl_pid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">clientid</span><span class="p">);</span> <span class="cm">/* read 8 bytes */</span>
	<span class="n">namelen</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="cm">/* read 4 bytes */</span>  <span class="cm">/* have read all 32 bytes now */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">namelen</span><span class="p">);</span> <span class="cm">/* variable size field */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">NFS4ERR_DENIED</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_lock_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LOCK</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="o">-</span><span class="n">EIO</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="o">-</span><span class="n">NFS4ERR_DENIED</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_lock_denied</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">open_seqid</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="n">nfs_increment_open_seqid</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">open_seqid</span><span class="p">);</span>
	<span class="n">nfs_increment_lock_seqid</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">lock_seqid</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_lockt</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_lockt_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LOCKT</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="o">-</span><span class="n">NFS4ERR_DENIED</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">decode_lock_denied</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">denied</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_locku</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_locku_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LOCKU</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">)</span>
		<span class="n">nfs_increment_lock_seqid</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">seqid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_release_lockowner</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_RELEASE_LOCKOWNER</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LOOKUP</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* This is too sick! */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_space_limit</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">maxsize</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">limit_type</span><span class="p">,</span> <span class="n">nblocks</span><span class="p">,</span> <span class="n">blocksize</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">limit_type</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">limit_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">maxsize</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="n">nblocks</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
		<span class="n">blocksize</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="o">*</span><span class="n">maxsize</span> <span class="o">=</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span><span class="n">nblocks</span> <span class="o">*</span> <span class="p">(</span><span class="kt">uint64_t</span><span class="p">)</span><span class="n">blocksize</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_delegation</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_openres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">delegation_type</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">delegation_type</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">delegation_type</span> <span class="o">==</span> <span class="n">NFS4_OPEN_DELEGATE_NONE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">delegation_type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">delegation</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">do_recall</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">delegation_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">NFS4_OPEN_DELEGATE_READ</span>:
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">delegation_type</span> <span class="o">=</span> <span class="n">FMODE_READ</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">NFS4_OPEN_DELEGATE_WRITE</span>:
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">delegation_type</span> <span class="o">=</span> <span class="n">FMODE_WRITE</span><span class="o">|</span><span class="n">FMODE_READ</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">decode_space_limit</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">maxsize</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">decode_ace</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="o">-&gt;</span><span class="n">nfs_client</span><span class="p">);</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_openres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">savewords</span><span class="p">,</span> <span class="n">bmlen</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_OPEN</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">)</span>
		<span class="n">nfs_increment_open_seqid</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">seqid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">decode_change_info</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">cinfo</span><span class="p">);</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">rflags</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">bmlen</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bmlen</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">xdr_error</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bmlen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">savewords</span> <span class="o">=</span> <span class="n">min_t</span><span class="p">(</span><span class="kt">uint32_t</span><span class="p">,</span> <span class="n">bmlen</span><span class="p">,</span> <span class="n">NFS4_BITMAP_SIZE</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">savewords</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">attrset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NFS4_BITMAP_SIZE</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">attrset</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">decode_delegation</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">xdr_error:</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: Bitmap too large! Length = %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">bmlen</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_open_confirm</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_open_confirmres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_OPEN_CONFIRM</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">)</span>
		<span class="n">nfs_increment_open_seqid</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">seqid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_open_downgrade</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_closeres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_OPEN_DOWNGRADE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">)</span>
		<span class="n">nfs_increment_open_seqid</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">seqid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_putfh</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_PUTFH</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_putrootfh</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_PUTROOTFH</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_readres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">kvec</span> <span class="o">*</span><span class="n">iov</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">.</span><span class="n">head</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">eof</span><span class="p">,</span> <span class="n">recvd</span><span class="p">,</span> <span class="n">hdrlen</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_READ</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">eof</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">count</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="n">hdrlen</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">xdr</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">iov</span><span class="o">-&gt;</span><span class="n">iov_base</span><span class="p">;</span>
	<span class="n">recvd</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">.</span><span class="n">len</span> <span class="o">-</span> <span class="n">hdrlen</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="n">recvd</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;NFS: server cheating in read reply: &quot;</span>
				<span class="s">&quot;count %u &gt; recvd %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">recvd</span><span class="p">);</span>
		<span class="n">count</span> <span class="o">=</span> <span class="n">recvd</span><span class="p">;</span>
		<span class="n">eof</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">xdr_read_pages</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">eof</span> <span class="o">=</span> <span class="n">eof</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">count</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_readdir</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_readdir_res</span> <span class="o">*</span><span class="n">readdir</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">xdr_buf</span>	<span class="o">*</span><span class="n">rcvbuf</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kvec</span>	<span class="o">*</span><span class="n">iov</span> <span class="o">=</span> <span class="n">rcvbuf</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">;</span>
	<span class="kt">size_t</span>		<span class="n">hdrlen</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">recvd</span><span class="p">,</span> <span class="n">pglen</span> <span class="o">=</span> <span class="n">rcvbuf</span><span class="o">-&gt;</span><span class="n">page_len</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">status</span><span class="p">;</span>
	<span class="n">__be32</span>		<span class="n">verf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_READDIR</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_verifier</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">readdir</span><span class="o">-&gt;</span><span class="n">verifier</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">verf</span><span class="p">,</span> <span class="n">readdir</span><span class="o">-&gt;</span><span class="n">verifier</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">verf</span><span class="p">));</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: verifier = %08x:%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">__func__</span><span class="p">,</span> <span class="n">verf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">verf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

	<span class="n">hdrlen</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">xdr</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">iov</span><span class="o">-&gt;</span><span class="n">iov_base</span><span class="p">;</span>
	<span class="n">recvd</span> <span class="o">=</span> <span class="n">rcvbuf</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-</span> <span class="n">hdrlen</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pglen</span> <span class="o">&gt;</span> <span class="n">recvd</span><span class="p">)</span>
		<span class="n">pglen</span> <span class="o">=</span> <span class="n">recvd</span><span class="p">;</span>
	<span class="n">xdr_read_pages</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">pglen</span><span class="p">);</span>


	<span class="k">return</span> <span class="n">pglen</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_readlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="n">rcvbuf</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kvec</span> <span class="o">*</span><span class="n">iov</span> <span class="o">=</span> <span class="n">rcvbuf</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">hdrlen</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">len</span><span class="p">,</span> <span class="n">recvd</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_READLINK</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="cm">/* Convert length of symlink */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;=</span> <span class="n">rcvbuf</span><span class="o">-&gt;</span><span class="n">page_len</span> <span class="o">||</span> <span class="n">len</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;nfs: server returned giant symlink!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENAMETOOLONG</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">hdrlen</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">xdr</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">iov</span><span class="o">-&gt;</span><span class="n">iov_base</span><span class="p">;</span>
	<span class="n">recvd</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">.</span><span class="n">len</span> <span class="o">-</span> <span class="n">hdrlen</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">recvd</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;NFS: server cheating in readlink reply: &quot;</span>
				<span class="s">&quot;count %u &gt; recvd %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">recvd</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">xdr_read_pages</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="cm">/*</span>
<span class="cm">	 * The XDR encode routine has set things up so that</span>
<span class="cm">	 * the link text will be copied directly into the</span>
<span class="cm">	 * buffer.  We just have to do overflow-checking,</span>
<span class="cm">	 * and and null-terminate the text (the VFS expects</span>
<span class="cm">	 * null-termination).</span>
<span class="cm">	 */</span>
	<span class="n">xdr_terminate_string</span><span class="p">(</span><span class="n">rcvbuf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_change_info</span> <span class="o">*</span><span class="n">cinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_REMOVE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_change_info</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">cinfo</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_rename</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_change_info</span> <span class="o">*</span><span class="n">old_cinfo</span><span class="p">,</span>
	      <span class="k">struct</span> <span class="n">nfs4_change_info</span> <span class="o">*</span><span class="n">new_cinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_RENAME</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_change_info</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">old_cinfo</span><span class="p">)))</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_change_info</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">new_cinfo</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_renew</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_RENEW</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">decode_restorefh</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_RESTOREFH</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_getacl</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">nfs_getaclres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">savep</span><span class="p">,</span> <span class="o">*</span><span class="n">bm_p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">attrlen</span><span class="p">,</span>
		 <span class="n">bitmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
	<span class="k">struct</span> <span class="n">kvec</span> <span class="o">*</span><span class="n">iov</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">.</span><span class="n">head</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">page_len</span> <span class="o">=</span> <span class="n">xdr</span><span class="o">-&gt;</span><span class="n">buf</span><span class="o">-&gt;</span><span class="n">page_len</span><span class="p">;</span>

	<span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETATTR</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">bm_p</span> <span class="o">=</span> <span class="n">xdr</span><span class="o">-&gt;</span><span class="n">p</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_data_offset</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">bm_p</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_data_offset</span> <span class="o">&lt;&lt;=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="cm">/* Check if the acl data starts beyond the allocated buffer */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_data_offset</span> <span class="o">&gt;</span> <span class="n">page_len</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ERANGE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_bitmap</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">status</span> <span class="o">=</span> <span class="n">decode_attr_length</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attrlen</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">savep</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">FATTR4_WORD0_ACL</span> <span class="o">-</span> <span class="mi">1U</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">bitmap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">FATTR4_WORD0_ACL</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">size_t</span> <span class="n">hdrlen</span><span class="p">;</span>

		<span class="cm">/* The bitmap (xdr len + bitmaps) and the attr xdr len words</span>
<span class="cm">		 * are stored with the acl data to handle the problem of</span>
<span class="cm">		 * variable length bitmaps.*/</span>
		<span class="n">xdr</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">=</span> <span class="n">bm_p</span><span class="p">;</span>

		<span class="cm">/* We ignore &amp;savep and don&#39;t do consistency checks on</span>
<span class="cm">		 * the attr length.  Let userspace figure it out.... */</span>
		<span class="n">hdrlen</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">xdr</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span><span class="n">iov</span><span class="o">-&gt;</span><span class="n">iov_base</span><span class="p">;</span>
		<span class="n">attrlen</span> <span class="o">+=</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_data_offset</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">attrlen</span> <span class="o">&gt;</span> <span class="n">page_len</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_flags</span> <span class="o">&amp;</span> <span class="n">NFS4_ACL_LEN_REQUEST</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* getxattr interface called with a NULL buf */</span>
				<span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_len</span> <span class="o">=</span> <span class="n">attrlen</span><span class="p">;</span>
				<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;NFS: acl reply: attrlen %u &gt; page_len %zu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">attrlen</span><span class="p">,</span> <span class="n">page_len</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">xdr_read_pages</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">attrlen</span><span class="p">);</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_len</span> <span class="o">=</span> <span class="n">attrlen</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="n">EOPNOTSUPP</span><span class="p">;</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">decode_savefh</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SAVEFH</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_setattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">bmlen</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SETATTR</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">bmlen</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bmlen</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">likely</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_setclientid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_setclientid_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">opnum</span><span class="p">;</span>
	<span class="kt">int32_t</span> <span class="n">nfserr</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">opnum</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">opnum</span> <span class="o">!=</span> <span class="n">OP_SETCLIENTID</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;nfs: decode_setclientid: Server returned operation&quot;</span>
			<span class="s">&quot; %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">opnum</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">nfserr</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">nfserr</span> <span class="o">==</span> <span class="n">NFS_OK</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">NFS4_VERIFIER_SIZE</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">clientid</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">confirm</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">NFS4_VERIFIER_SIZE</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">nfserr</span> <span class="o">==</span> <span class="n">NFSERR_CLID_INUSE</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">uint32_t</span> <span class="n">len</span><span class="p">;</span>

		<span class="cm">/* skip netid string */</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>

		<span class="cm">/* skip uaddr string */</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">NFSERR_CLID_INUSE</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="k">return</span> <span class="n">nfs4_stat_to_errno</span><span class="p">(</span><span class="n">nfserr</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_setclientid_confirm</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SETCLIENTID_CONFIRM</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_writeres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_WRITE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">count</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">verf</span><span class="o">-&gt;</span><span class="n">committed</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">verf</span><span class="o">-&gt;</span><span class="n">verifier</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">NFS4_VERIFIER_SIZE</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_delegreturn</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_DELEGRETURN</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_secinfo_gss</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_secinfo_flavor</span> <span class="o">*</span><span class="n">flavor</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">flavor</span><span class="o">-&gt;</span><span class="n">gss</span><span class="p">.</span><span class="n">sec_oid4</span><span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">flavor</span><span class="o">-&gt;</span><span class="n">gss</span><span class="p">.</span><span class="n">sec_oid4</span><span class="p">.</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">GSS_OID_MAX_LEN</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_err</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">flavor</span><span class="o">-&gt;</span><span class="n">gss</span><span class="p">.</span><span class="n">sec_oid4</span><span class="p">.</span><span class="n">len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">flavor</span><span class="o">-&gt;</span><span class="n">gss</span><span class="p">.</span><span class="n">sec_oid4</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">flavor</span><span class="o">-&gt;</span><span class="n">gss</span><span class="p">.</span><span class="n">sec_oid4</span><span class="p">.</span><span class="n">len</span><span class="p">);</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">flavor</span><span class="o">-&gt;</span><span class="n">gss</span><span class="p">.</span><span class="n">qop4</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">flavor</span><span class="o">-&gt;</span><span class="n">gss</span><span class="p">.</span><span class="n">service</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="nl">out_err:</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_secinfo_common</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_secinfo_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">nfs4_secinfo_flavor</span> <span class="o">*</span><span class="n">sec_flavor</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">num_flavors</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>

	<span class="n">res</span><span class="o">-&gt;</span><span class="n">flavors</span><span class="o">-&gt;</span><span class="n">num_flavors</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">num_flavors</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_flavors</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sec_flavor</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">flavors</span><span class="o">-&gt;</span><span class="n">flavors</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">sec_flavor</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">flavors</span> <span class="o">&gt;</span> <span class="n">PAGE_SIZE</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">sec_flavor</span><span class="o">-&gt;</span><span class="n">flavor</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">sec_flavor</span><span class="o">-&gt;</span><span class="n">flavor</span> <span class="o">==</span> <span class="n">RPC_AUTH_GSS</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">status</span> <span class="o">=</span> <span class="n">decode_secinfo_gss</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">sec_flavor</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
				<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">flavors</span><span class="o">-&gt;</span><span class="n">num_flavors</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_secinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_secinfo_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SECINFO</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">decode_secinfo_common</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_secinfo_no_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_secinfo_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SECINFO_NO_NAME</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">decode_secinfo_common</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_exchange_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">nfs41_exchange_id_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">dummy</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">dummy_str</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">impl_id_count</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_EXCHANGE_ID</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">clientid</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">seqid</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>

	<span class="cm">/* We ask for SP4_NONE */</span>
	<span class="n">dummy</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dummy</span> <span class="o">!=</span> <span class="n">SP4_NONE</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>

	<span class="cm">/* server_owner4.so_minor_id */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">server_owner</span><span class="o">-&gt;</span><span class="n">minor_id</span><span class="p">);</span>

	<span class="cm">/* server_owner4.so_major_id */</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_opaque_inline</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dummy</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dummy_str</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">dummy</span> <span class="o">&gt;</span> <span class="n">NFS4_OPAQUE_LIMIT</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">server_owner</span><span class="o">-&gt;</span><span class="n">major_id</span><span class="p">,</span> <span class="n">dummy_str</span><span class="p">,</span> <span class="n">dummy</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">server_owner</span><span class="o">-&gt;</span><span class="n">major_id_sz</span> <span class="o">=</span> <span class="n">dummy</span><span class="p">;</span>

	<span class="cm">/* server_scope4 */</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_opaque_inline</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dummy</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dummy_str</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">dummy</span> <span class="o">&gt;</span> <span class="n">NFS4_OPAQUE_LIMIT</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">server_scope</span><span class="o">-&gt;</span><span class="n">server_scope</span><span class="p">,</span> <span class="n">dummy_str</span><span class="p">,</span> <span class="n">dummy</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">server_scope</span><span class="o">-&gt;</span><span class="n">server_scope_sz</span> <span class="o">=</span> <span class="n">dummy</span><span class="p">;</span>

	<span class="cm">/* Implementation Id */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">impl_id_count</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">impl_id_count</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* nii_domain */</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_opaque_inline</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dummy</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dummy_str</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">dummy</span> <span class="o">&gt;</span> <span class="n">NFS4_OPAQUE_LIMIT</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">impl_id</span><span class="o">-&gt;</span><span class="n">domain</span><span class="p">,</span> <span class="n">dummy_str</span><span class="p">,</span> <span class="n">dummy</span><span class="p">);</span>

		<span class="cm">/* nii_name */</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_opaque_inline</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dummy</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dummy_str</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">dummy</span> <span class="o">&gt;</span> <span class="n">NFS4_OPAQUE_LIMIT</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">impl_id</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">dummy_str</span><span class="p">,</span> <span class="n">dummy</span><span class="p">);</span>

		<span class="cm">/* nii_date */</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">impl_id</span><span class="o">-&gt;</span><span class="n">date</span><span class="p">.</span><span class="n">seconds</span><span class="p">);</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">impl_id</span><span class="o">-&gt;</span><span class="n">date</span><span class="p">.</span><span class="n">nseconds</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

		<span class="cm">/* if there&#39;s more than one entry, ignore the rest */</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_chan_attrs</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">nfs4_channel_attrs</span> <span class="o">*</span><span class="n">attrs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">nr_attrs</span><span class="p">,</span> <span class="n">val</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">28</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>	<span class="cm">/* headerpadsz */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>		<span class="cm">/* no support for header padding yet */</span>
	<span class="n">attrs</span><span class="o">-&gt;</span><span class="n">max_rqst_sz</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">attrs</span><span class="o">-&gt;</span><span class="n">max_resp_sz</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">attrs</span><span class="o">-&gt;</span><span class="n">max_resp_sz_cached</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">attrs</span><span class="o">-&gt;</span><span class="n">max_ops</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">attrs</span><span class="o">-&gt;</span><span class="n">max_reqs</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">nr_attrs</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">nr_attrs</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_WARNING</span> <span class="s">&quot;NFS: %s: Invalid rdma channel attrs &quot;</span>
			<span class="s">&quot;count %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">nr_attrs</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">nr_attrs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span> <span class="cm">/* skip rdma_attrs */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_sessionid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs4_sessionid</span> <span class="o">*</span><span class="n">sid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_opaque_fixed</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">sid</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">NFS4_MAX_SESSIONID_LEN</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_bind_conn_to_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs41_bind_conn_to_session_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_BIND_CONN_TO_SESSION</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sessionid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">sess_id</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="cm">/* dir flags, rdma mode bool */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>

	<span class="n">res</span><span class="o">-&gt;</span><span class="n">dir</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">dir</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">dir</span> <span class="o">&gt;</span> <span class="n">NFS4_CDFS4_BOTH</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">use_conn_in_rdma_mode</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">use_conn_in_rdma_mode</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_create_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">nfs41_create_session_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfs_client</span> <span class="o">*</span><span class="n">clp</span> <span class="o">=</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">client</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfs4_session</span> <span class="o">*</span><span class="n">session</span> <span class="o">=</span> <span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_session</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_CREATE_SESSION</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sessionid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">sess_id</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="cm">/* seqid, flags */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">clp</span><span class="o">-&gt;</span><span class="n">cl_seqid</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">session</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="cm">/* Channel attributes */</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_chan_attrs</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">fc_attrs</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_chan_attrs</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">session</span><span class="o">-&gt;</span><span class="n">bc_attrs</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_destroy_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dummy</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_DESTROY_SESSION</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_destroy_clientid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dummy</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_DESTROY_CLIENTID</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_reclaim_complete</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dummy</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_RECLAIM_COMPLETE</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_sequence</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">nfs4_sequence_res</span> <span class="o">*</span><span class="n">res</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
	<span class="k">struct</span> <span class="n">nfs4_sessionid</span> <span class="n">id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dummy</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">sr_session</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_SEQUENCE</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sessionid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">id</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_err</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * If the server returns different values for sessionID, slotID or</span>
<span class="cm">	 * sequence number, the server is looney tunes.</span>
<span class="cm">	 */</span>
	<span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="n">EREMOTEIO</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">memcmp</span><span class="p">(</span><span class="n">id</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">sr_session</span><span class="o">-&gt;</span><span class="n">sess_id</span><span class="p">.</span><span class="n">data</span><span class="p">,</span>
		   <span class="n">NFS4_MAX_SESSIONID_LEN</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s Invalid session id</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out_err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>

	<span class="cm">/* seqid */</span>
	<span class="n">dummy</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dummy</span> <span class="o">!=</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">sr_slot</span><span class="o">-&gt;</span><span class="n">seq_nr</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s Invalid sequence number</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out_err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* slot id */</span>
	<span class="n">dummy</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dummy</span> <span class="o">!=</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">sr_slot</span> <span class="o">-</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">sr_session</span><span class="o">-&gt;</span><span class="n">fc_slot_table</span><span class="p">.</span><span class="n">slots</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s Invalid slot id</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out_err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* highest slot id - currently not processed */</span>
	<span class="n">dummy</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="cm">/* target highest slot id - currently not processed */</span>
	<span class="n">dummy</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="cm">/* result flags */</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">sr_status_flags</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_err:</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">sr_status</span> <span class="o">=</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="n">status</span> <span class="o">=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">goto</span> <span class="n">out_err</span><span class="p">;</span>
<span class="cp">#else  </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
<span class="cm">/*</span>
<span class="cm"> * TODO: Need to handle case when EOF != true;</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_getdevicelist</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">pnfs_devicelist</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">nfs_writeverf</span> <span class="n">verftemp</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETDEVICELIST</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>

	<span class="cm">/* TODO: Skip cookie for now */</span>
	<span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="cm">/* Read verifier */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_opaque_fixed</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">verftemp</span><span class="p">.</span><span class="n">verifier</span><span class="p">,</span> <span class="n">NFS4_VERIFIER_SIZE</span><span class="p">);</span>

	<span class="n">res</span><span class="o">-&gt;</span><span class="n">num_devs</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: num_dev %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">num_devs</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">num_devs</span> <span class="o">&gt;</span> <span class="n">NFS4_PNFS_GETDEVLIST_MAXNUM</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;NFS: %s too many result dev_num %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">__func__</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">num_devs</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span>
			      <span class="n">res</span><span class="o">-&gt;</span><span class="n">num_devs</span> <span class="o">*</span> <span class="n">NFS4_DEVICEID4_SIZE</span> <span class="o">+</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">num_devs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_opaque_fixed</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">dev_id</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">,</span>
					    <span class="n">NFS4_DEVICEID4_SIZE</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">eof</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_getdeviceinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">pnfs_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">len</span><span class="p">,</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_GETDEVICEINFO</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="o">-</span><span class="n">ETOOSMALL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
				<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
			<span class="n">pdev</span><span class="o">-&gt;</span><span class="n">mincount</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
			<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: Min count too small. mincnt = %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">__func__</span><span class="p">,</span> <span class="n">pdev</span><span class="o">-&gt;</span><span class="n">mincount</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">type</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">!=</span> <span class="n">pdev</span><span class="o">-&gt;</span><span class="n">layout_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: layout mismatch req: %u pdev: %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">__func__</span><span class="p">,</span> <span class="n">pdev</span><span class="o">-&gt;</span><span class="n">layout_type</span><span class="p">,</span> <span class="n">type</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/*</span>
<span class="cm">	 * Get the length of the opaque device_addr4. xdr_read_pages places</span>
<span class="cm">	 * the opaque device_addr4 in the xdr_buf-&gt;pages (pnfs_device-&gt;pages)</span>
<span class="cm">	 * and places the remaining xdr data in xdr_buf-&gt;tail</span>
<span class="cm">	 */</span>
	<span class="n">pdev</span><span class="o">-&gt;</span><span class="n">mincount</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="n">xdr_read_pages</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">pdev</span><span class="o">-&gt;</span><span class="n">mincount</span><span class="p">);</span> <span class="cm">/* include space for the length */</span>

	<span class="cm">/* Parse notification bitmap, verifying that it is zero. */</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">uint32_t</span> <span class="n">i</span><span class="p">;</span>

		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">p</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: notifications not supported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">__func__</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_layoutget</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">nfs4_layoutget_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">layout_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">xdr_buf</span> <span class="o">*</span><span class="n">rcvbuf</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kvec</span> <span class="o">*</span><span class="n">iov</span> <span class="o">=</span> <span class="n">rcvbuf</span><span class="o">-&gt;</span><span class="n">head</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">hdrlen</span><span class="p">,</span> <span class="n">recvd</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LAYOUTGET</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">return_on_close</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="n">decode_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">layout_count</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">layout_count</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: server responded with empty layout array</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">28</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">offset</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">iomode</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">layoutp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s roff:%lu rlen:%lu riomode:%d, lo_type:0x%x, lo.len:%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">__func__</span><span class="p">,</span>
		<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">offset</span><span class="p">,</span>
		<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">length</span><span class="p">,</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">range</span><span class="p">.</span><span class="n">iomode</span><span class="p">,</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">,</span>
		<span class="n">res</span><span class="o">-&gt;</span><span class="n">layoutp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>

	<span class="n">hdrlen</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">xdr</span><span class="o">-&gt;</span><span class="n">p</span> <span class="o">-</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">iov</span><span class="o">-&gt;</span><span class="n">iov_base</span><span class="p">;</span>
	<span class="n">recvd</span> <span class="o">=</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">rq_rcv_buf</span><span class="p">.</span><span class="n">len</span> <span class="o">-</span> <span class="n">hdrlen</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">layoutp</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">recvd</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;NFS: server cheating in layoutget reply: &quot;</span>
				<span class="s">&quot;layout len %u &gt; recvd %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">res</span><span class="o">-&gt;</span><span class="n">layoutp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">,</span> <span class="n">recvd</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">xdr_read_pages</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">layoutp</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">layout_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* We only handle a length one array at the moment.  Any</span>
<span class="cm">		 * further entries are just ignored.  Note that this means</span>
<span class="cm">		 * the client may see a response that is less than the</span>
<span class="cm">		 * minimum it requested.</span>
<span class="cm">		 */</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s: server responded with %d layouts, dropping tail</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">__func__</span><span class="p">,</span> <span class="n">layout_count</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_layoutreturn</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs4_layoutreturn_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LAYOUTRETURN</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">lrs_present</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">lrs_present</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">stateid</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_layoutcommit</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs4_layoutcommit_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">sizechanged</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_LAYOUTCOMMIT</span><span class="p">);</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">sizechanged</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sizechanged</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* throw away new size */</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_test_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs41_test_stateid_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_res</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_TEST_STATEID</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">num_res</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">num_res</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">decode_free_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs41_free_stateid_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_op_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">OP_FREE_STATEID</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">res</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="o">++</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">status</span><span class="p">;</span>
<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * END OF &quot;GENERIC&quot; DECODE ROUTINES.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Decode OPEN_DOWNGRADE response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_open_downgrade</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">nfs_closeres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_open_downgrade</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode ACCESS response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_access</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs4_accessres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_access</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode LOOKUP response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs4_lookup_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_lookup</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode LOOKUP_ROOT response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_lookup_root</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">nfs4_lookup_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putrootfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode REMOVE response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs_removeres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_remove</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">cinfo</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode RENAME response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_rename</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs_renameres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_savefh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_rename</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">old_cinfo</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">new_cinfo</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode LINK response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_link</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">nfs4_link_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_savefh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_link</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">cinfo</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * Note order: OP_LINK leaves the directory as the current</span>
<span class="cm">	 *             filehandle.</span>
<span class="cm">	 */</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_restorefh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode CREATE response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs4_create_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_create</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">dir_cinfo</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode SYMLINK response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_symlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs4_create_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">nfs4_xdr_dec_create</span><span class="p">(</span><span class="n">rqstp</span><span class="p">,</span> <span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode GETATTR response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_getattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs4_getattr_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Encode an SETACL request</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">nfs4_xdr_enc_setacl</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs_setaclargs</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">minorversion</span> <span class="o">=</span> <span class="n">nfs4_xdr_minorversion</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">),</span>
	<span class="p">};</span>

	<span class="n">encode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">req</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">args</span><span class="o">-&gt;</span><span class="n">seq_args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_setacl</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="n">encode_nops</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode SETACL response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">nfs4_xdr_dec_setacl</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">nfs_setaclres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_setattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode GETACL response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">nfs4_xdr_dec_getacl</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
		    <span class="k">struct</span> <span class="n">nfs_getaclres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_scratch</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">void</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">page_address</span><span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">acl_scratch</span><span class="p">);</span>
		<span class="n">xdr_set_scratch_buffer</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">PAGE_SIZE</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getacl</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode CLOSE response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_close</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">nfs_closeres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_close</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * Note: Server may do delete on close for this file</span>
<span class="cm">	 * 	in which case the getattr call will fail with</span>
<span class="cm">	 * 	an ESTALE error. Shouldn&#39;t be a problem,</span>
<span class="cm">	 * 	though, since fattr-&gt;valid will remain unset.</span>
<span class="cm">	 */</span>
	<span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode OPEN response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_open</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">nfs_openres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_open</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">decode_getfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">f_attr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode OPEN_CONFIRM response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_open_confirm</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs_open_confirmres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_open_confirm</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode OPEN response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_open_noattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">nfs_openres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_open</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">f_attr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode SETATTR response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_setattr</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs_setattrres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_setattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode LOCK response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">nfs_lock_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_lock</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode LOCKT response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_lockt</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">nfs_lockt_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_lockt</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode LOCKU response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_locku</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">nfs_locku_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_locku</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_release_lockowner</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
					  <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dummy</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_release_lockowner</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode READLINK response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_readlink</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">nfs4_readlink_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_readlink</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode READDIR response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_readdir</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs4_readdir_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_readdir</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode Read response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">nfs_readres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_read</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode WRITE response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">nfs_writeres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_write</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">)</span>
		<span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode COMMIT response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_commit</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs_commitres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_commit</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode FSINFO response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_fsinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs4_fsinfo_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">req</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_fsinfo</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fsinfo</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode PATHCONF response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_pathconf</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">nfs4_pathconf_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">req</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_pathconf</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">pathconf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode STATFS response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_statfs</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">nfs4_statfs_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">req</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_statfs</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fsstat</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode GETATTR_BITMAP response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_server_caps</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">nfs4_server_caps_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">req</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_server_caps</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode RENEW response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_renew</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
			      <span class="kt">void</span> <span class="o">*</span><span class="n">__unused</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_renew</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode SETCLIENTID response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_setclientid</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">nfs4_setclientid_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_setclientid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode SETCLIENTID_CONFIRM response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_setclientid_confirm</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
					    <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					    <span class="k">struct</span> <span class="n">nfs_fsinfo</span> <span class="o">*</span><span class="n">fsinfo</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_setclientid_confirm</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putrootfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_fsinfo</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">fsinfo</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode DELEGRETURN response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_delegreturn</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">nfs4_delegreturnres</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_delegreturn</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode FS_LOCATIONS response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_fs_locations</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs4_fs_locations_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">req</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_lookup</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">xdr_enter_page</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">PAGE_SIZE</span><span class="p">);</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getfattr_generic</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">fs_locations</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span>
					 <span class="nb">NULL</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fs_locations</span><span class="p">,</span>
					 <span class="n">res</span><span class="o">-&gt;</span><span class="n">fs_locations</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode SECINFO response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_secinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">nfs4_secinfo_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_secinfo</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
<span class="cm">/*</span>
<span class="cm"> * Decode BIND_CONN_TO_SESSION response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_bind_conn_to_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					<span class="kt">void</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_bind_conn_to_session</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode EXCHANGE_ID response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_exchange_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				    <span class="kt">void</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_exchange_id</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode CREATE_SESSION response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_create_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">nfs41_create_session_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_create_session</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode DESTROY_SESSION response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_destroy_session</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					<span class="kt">void</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_destroy_session</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode DESTROY_CLIENTID response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_destroy_clientid</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					<span class="kt">void</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_destroy_clientid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode SEQUENCE response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_sequence</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">nfs4_sequence_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode GET_LEASE_TIME response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_get_lease_time</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">nfs4_get_lease_time_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">lr_seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putrootfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_fsinfo</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">lr_fsinfo</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode RECLAIM_COMPLETE response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_reclaim_complete</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					 <span class="k">struct</span> <span class="n">nfs41_reclaim_complete_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">decode_reclaim_complete</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="nb">NULL</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode GETDEVICELIST response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_getdevicelist</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">nfs4_getdevicelist_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;encoding getdevicelist!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getdevicelist</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">devlist</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode GETDEVINFO response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_getdeviceinfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">nfs4_getdeviceinfo_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_getdeviceinfo</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">pdev</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode LAYOUTGET response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_layoutget</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">nfs4_layoutget_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_layoutget</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode LAYOUTRETURN response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_layoutreturn</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs4_layoutreturn_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_layoutreturn</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode LAYOUTCOMMIT response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_layoutcommit</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs4_layoutcommit_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_layoutcommit</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">decode_getfattr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">res</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode SECINFO_NO_NAME response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_secinfo_no_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">nfs4_secinfo_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_putrootfh</span><span class="p">(</span><span class="n">xdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_secinfo_no_name</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode TEST_STATEID response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_test_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs41_test_stateid_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_test_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Decode FREE_STATEID response</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">nfs4_xdr_dec_free_stateid</span><span class="p">(</span><span class="k">struct</span> <span class="n">rpc_rqst</span> <span class="o">*</span><span class="n">rqstp</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">nfs41_free_stateid_res</span> <span class="o">*</span><span class="n">res</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">compound_hdr</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_compound_hdr</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_sequence</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">res</span><span class="o">-&gt;</span><span class="n">seq_res</span><span class="p">,</span> <span class="n">rqstp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">decode_free_stateid</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">res</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>

<span class="cm">/**</span>
<span class="cm"> * nfs4_decode_dirent - Decode a single NFSv4 directory entry stored in</span>
<span class="cm"> *                      the local page cache.</span>
<span class="cm"> * @xdr: XDR stream where entry resides</span>
<span class="cm"> * @entry: buffer to fill in with entry data</span>
<span class="cm"> * @plus: boolean indicating whether this should be a readdirplus entry</span>
<span class="cm"> *</span>
<span class="cm"> * Returns zero if successful, otherwise a negative errno value is</span>
<span class="cm"> * returned.</span>
<span class="cm"> *</span>
<span class="cm"> * This function is not invoked during READDIR reply decoding, but</span>
<span class="cm"> * rather whenever an application invokes the getdents(2) system call</span>
<span class="cm"> * on a directory already in our cache.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">nfs4_decode_dirent</span><span class="p">(</span><span class="k">struct</span> <span class="n">xdr_stream</span> <span class="o">*</span><span class="n">xdr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">nfs_entry</span> <span class="o">*</span><span class="n">entry</span><span class="p">,</span>
		       <span class="kt">int</span> <span class="n">plus</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">bitmap</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">};</span>
	<span class="kt">uint32_t</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">__be32</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="n">xdr_zero</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
			<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="n">xdr_zero</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>
		<span class="n">entry</span><span class="o">-&gt;</span><span class="n">eof</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EBADCOOKIE</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="mi">12</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">prev_cookie</span> <span class="o">=</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">cookie</span><span class="p">;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_decode_hyper</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">cookie</span><span class="p">);</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">=</span> <span class="n">be32_to_cpup</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>

	<span class="n">p</span> <span class="o">=</span> <span class="n">xdr_inline_decode</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unlikely</span><span class="p">(</span><span class="o">!</span><span class="n">p</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">p</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * In case the server doesn&#39;t return an inode number,</span>
<span class="cm">	 * we fake one here.  (We don&#39;t use inode number 0,</span>
<span class="cm">	 * since glibc seems to choke on it...)</span>
<span class="cm">	 */</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">ino</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">decode_attr_bitmap</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">decode_attr_length</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">decode_getfattr_attrs</span><span class="p">(</span><span class="n">xdr</span><span class="p">,</span> <span class="n">bitmap</span><span class="p">,</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="p">,</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">fh</span><span class="p">,</span>
				  <span class="nb">NULL</span><span class="p">,</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">server</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out_overflow</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">&amp;</span> <span class="n">NFS_ATTR_FATTR_MOUNTED_ON_FILEID</span><span class="p">)</span>
		<span class="n">entry</span><span class="o">-&gt;</span><span class="n">ino</span> <span class="o">=</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">mounted_on_fileid</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">&amp;</span> <span class="n">NFS_ATTR_FATTR_FILEID</span><span class="p">)</span>
		<span class="n">entry</span><span class="o">-&gt;</span><span class="n">ino</span> <span class="o">=</span> <span class="n">entry</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">fileid</span><span class="p">;</span>

	<span class="n">entry</span><span class="o">-&gt;</span><span class="n">d_type</span> <span class="o">=</span> <span class="n">DT_UNKNOWN</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">valid</span> <span class="o">&amp;</span> <span class="n">NFS_ATTR_FATTR_TYPE</span><span class="p">)</span>
		<span class="n">entry</span><span class="o">-&gt;</span><span class="n">d_type</span> <span class="o">=</span> <span class="n">nfs_umode_to_dtype</span><span class="p">(</span><span class="n">entry</span><span class="o">-&gt;</span><span class="n">fattr</span><span class="o">-&gt;</span><span class="n">mode</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">out_overflow:</span>
	<span class="n">print_overflow_msg</span><span class="p">(</span><span class="n">__func__</span><span class="p">,</span> <span class="n">xdr</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * We need to translate between nfs status return values and</span>
<span class="cm"> * the local errno values which may not be the same.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">stat</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">errno</span><span class="p">;</span>
<span class="p">}</span> <span class="n">nfs_errtbl</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">NFS4_OK</span><span class="p">,</span>		<span class="mi">0</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_PERM</span><span class="p">,</span>		<span class="o">-</span><span class="n">EPERM</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_NOENT</span><span class="p">,</span>	<span class="o">-</span><span class="n">ENOENT</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_IO</span><span class="p">,</span>		<span class="o">-</span><span class="n">errno_NFSERR_IO</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_NXIO</span><span class="p">,</span>		<span class="o">-</span><span class="n">ENXIO</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_ACCESS</span><span class="p">,</span>	<span class="o">-</span><span class="n">EACCES</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_EXIST</span><span class="p">,</span>	<span class="o">-</span><span class="n">EEXIST</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_XDEV</span><span class="p">,</span>		<span class="o">-</span><span class="n">EXDEV</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_NOTDIR</span><span class="p">,</span>	<span class="o">-</span><span class="n">ENOTDIR</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_ISDIR</span><span class="p">,</span>	<span class="o">-</span><span class="n">EISDIR</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_INVAL</span><span class="p">,</span>	<span class="o">-</span><span class="n">EINVAL</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_FBIG</span><span class="p">,</span>		<span class="o">-</span><span class="n">EFBIG</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_NOSPC</span><span class="p">,</span>	<span class="o">-</span><span class="n">ENOSPC</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_ROFS</span><span class="p">,</span>		<span class="o">-</span><span class="n">EROFS</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_MLINK</span><span class="p">,</span>	<span class="o">-</span><span class="n">EMLINK</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_NAMETOOLONG</span><span class="p">,</span>	<span class="o">-</span><span class="n">ENAMETOOLONG</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_NOTEMPTY</span><span class="p">,</span>	<span class="o">-</span><span class="n">ENOTEMPTY</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_DQUOT</span><span class="p">,</span>	<span class="o">-</span><span class="n">EDQUOT</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_STALE</span><span class="p">,</span>	<span class="o">-</span><span class="n">ESTALE</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_BADHANDLE</span><span class="p">,</span>	<span class="o">-</span><span class="n">EBADHANDLE</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_BAD_COOKIE</span><span class="p">,</span>	<span class="o">-</span><span class="n">EBADCOOKIE</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_NOTSUPP</span><span class="p">,</span>	<span class="o">-</span><span class="n">ENOTSUPP</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_TOOSMALL</span><span class="p">,</span>	<span class="o">-</span><span class="n">ETOOSMALL</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_SERVERFAULT</span><span class="p">,</span>	<span class="o">-</span><span class="n">EREMOTEIO</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_BADTYPE</span><span class="p">,</span>	<span class="o">-</span><span class="n">EBADTYPE</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_LOCKED</span><span class="p">,</span>	<span class="o">-</span><span class="n">EAGAIN</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_SYMLINK</span><span class="p">,</span>	<span class="o">-</span><span class="n">ELOOP</span>		<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_OP_ILLEGAL</span><span class="p">,</span>	<span class="o">-</span><span class="n">EOPNOTSUPP</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="n">NFS4ERR_DEADLOCK</span><span class="p">,</span>	<span class="o">-</span><span class="n">EDEADLK</span>	<span class="p">},</span>
	<span class="p">{</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>			<span class="o">-</span><span class="n">EIO</span>		<span class="p">}</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Convert an NFS error code to a local one.</span>
<span class="cm"> * This one is used jointly by NFSv2 and NFSv3.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span>
<span class="nf">nfs4_stat_to_errno</span><span class="p">(</span><span class="kt">int</span> <span class="n">stat</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">nfs_errtbl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">stat</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">nfs_errtbl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">stat</span> <span class="o">==</span> <span class="n">stat</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">nfs_errtbl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">errno</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">stat</span> <span class="o">&lt;=</span> <span class="mi">10000</span> <span class="o">||</span> <span class="n">stat</span> <span class="o">&gt;</span> <span class="mi">10100</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The server is looney tunes. */</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EREMOTEIO</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* If we cannot translate the error, the recovery routines should</span>
<span class="cm">	 * handle it.</span>
<span class="cm">	 * Note: remaining NFSv4 error codes have values &gt; 10000, so should</span>
<span class="cm">	 * not conflict with native Linux error codes.</span>
<span class="cm">	 */</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">stat</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define PROC(proc, argtype, restype)				\</span>
<span class="cp">[NFSPROC4_CLNT_##proc] = {					\</span>
<span class="cp">	.p_proc   = NFSPROC4_COMPOUND,				\</span>
<span class="cp">	.p_encode = (kxdreproc_t)nfs4_xdr_##argtype,		\</span>
<span class="cp">	.p_decode = (kxdrdproc_t)nfs4_xdr_##restype,		\</span>
<span class="cp">	.p_arglen = NFS4_##argtype##_sz,			\</span>
<span class="cp">	.p_replen = NFS4_##restype##_sz,			\</span>
<span class="cp">	.p_statidx = NFSPROC4_CLNT_##proc,			\</span>
<span class="cp">	.p_name   = #proc,					\</span>
<span class="cp">}</span>

<span class="k">struct</span> <span class="n">rpc_procinfo</span>	<span class="n">nfs4_procedures</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">READ</span><span class="p">,</span>		<span class="n">enc_read</span><span class="p">,</span>		<span class="n">dec_read</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">WRITE</span><span class="p">,</span>		<span class="n">enc_write</span><span class="p">,</span>		<span class="n">dec_write</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">COMMIT</span><span class="p">,</span>		<span class="n">enc_commit</span><span class="p">,</span>		<span class="n">dec_commit</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">OPEN</span><span class="p">,</span>		<span class="n">enc_open</span><span class="p">,</span>		<span class="n">dec_open</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">OPEN_CONFIRM</span><span class="p">,</span>	<span class="n">enc_open_confirm</span><span class="p">,</span>	<span class="n">dec_open_confirm</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">OPEN_NOATTR</span><span class="p">,</span>	<span class="n">enc_open_noattr</span><span class="p">,</span>	<span class="n">dec_open_noattr</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">OPEN_DOWNGRADE</span><span class="p">,</span>	<span class="n">enc_open_downgrade</span><span class="p">,</span>	<span class="n">dec_open_downgrade</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">CLOSE</span><span class="p">,</span>		<span class="n">enc_close</span><span class="p">,</span>		<span class="n">dec_close</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">SETATTR</span><span class="p">,</span>		<span class="n">enc_setattr</span><span class="p">,</span>		<span class="n">dec_setattr</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">FSINFO</span><span class="p">,</span>		<span class="n">enc_fsinfo</span><span class="p">,</span>		<span class="n">dec_fsinfo</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">RENEW</span><span class="p">,</span>		<span class="n">enc_renew</span><span class="p">,</span>		<span class="n">dec_renew</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">SETCLIENTID</span><span class="p">,</span>	<span class="n">enc_setclientid</span><span class="p">,</span>	<span class="n">dec_setclientid</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">SETCLIENTID_CONFIRM</span><span class="p">,</span> <span class="n">enc_setclientid_confirm</span><span class="p">,</span> <span class="n">dec_setclientid_confirm</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">LOCK</span><span class="p">,</span>		<span class="n">enc_lock</span><span class="p">,</span>		<span class="n">dec_lock</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">LOCKT</span><span class="p">,</span>		<span class="n">enc_lockt</span><span class="p">,</span>		<span class="n">dec_lockt</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">LOCKU</span><span class="p">,</span>		<span class="n">enc_locku</span><span class="p">,</span>		<span class="n">dec_locku</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">ACCESS</span><span class="p">,</span>		<span class="n">enc_access</span><span class="p">,</span>		<span class="n">dec_access</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">GETATTR</span><span class="p">,</span>		<span class="n">enc_getattr</span><span class="p">,</span>		<span class="n">dec_getattr</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">LOOKUP</span><span class="p">,</span>		<span class="n">enc_lookup</span><span class="p">,</span>		<span class="n">dec_lookup</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">LOOKUP_ROOT</span><span class="p">,</span>	<span class="n">enc_lookup_root</span><span class="p">,</span>	<span class="n">dec_lookup_root</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">REMOVE</span><span class="p">,</span>		<span class="n">enc_remove</span><span class="p">,</span>		<span class="n">dec_remove</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">RENAME</span><span class="p">,</span>		<span class="n">enc_rename</span><span class="p">,</span>		<span class="n">dec_rename</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">LINK</span><span class="p">,</span>		<span class="n">enc_link</span><span class="p">,</span>		<span class="n">dec_link</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">SYMLINK</span><span class="p">,</span>		<span class="n">enc_symlink</span><span class="p">,</span>		<span class="n">dec_symlink</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">CREATE</span><span class="p">,</span>		<span class="n">enc_create</span><span class="p">,</span>		<span class="n">dec_create</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">PATHCONF</span><span class="p">,</span>		<span class="n">enc_pathconf</span><span class="p">,</span>		<span class="n">dec_pathconf</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">STATFS</span><span class="p">,</span>		<span class="n">enc_statfs</span><span class="p">,</span>		<span class="n">dec_statfs</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">READLINK</span><span class="p">,</span>		<span class="n">enc_readlink</span><span class="p">,</span>		<span class="n">dec_readlink</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">READDIR</span><span class="p">,</span>		<span class="n">enc_readdir</span><span class="p">,</span>		<span class="n">dec_readdir</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">SERVER_CAPS</span><span class="p">,</span>	<span class="n">enc_server_caps</span><span class="p">,</span>	<span class="n">dec_server_caps</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">DELEGRETURN</span><span class="p">,</span>	<span class="n">enc_delegreturn</span><span class="p">,</span>	<span class="n">dec_delegreturn</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">GETACL</span><span class="p">,</span>		<span class="n">enc_getacl</span><span class="p">,</span>		<span class="n">dec_getacl</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">SETACL</span><span class="p">,</span>		<span class="n">enc_setacl</span><span class="p">,</span>		<span class="n">dec_setacl</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">FS_LOCATIONS</span><span class="p">,</span>	<span class="n">enc_fs_locations</span><span class="p">,</span>	<span class="n">dec_fs_locations</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">RELEASE_LOCKOWNER</span><span class="p">,</span>	<span class="n">enc_release_lockowner</span><span class="p">,</span>	<span class="n">dec_release_lockowner</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">SECINFO</span><span class="p">,</span>		<span class="n">enc_secinfo</span><span class="p">,</span>		<span class="n">dec_secinfo</span><span class="p">),</span>
<span class="cp">#if defined(CONFIG_NFS_V4_1)</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">EXCHANGE_ID</span><span class="p">,</span>	<span class="n">enc_exchange_id</span><span class="p">,</span>	<span class="n">dec_exchange_id</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">CREATE_SESSION</span><span class="p">,</span>	<span class="n">enc_create_session</span><span class="p">,</span>	<span class="n">dec_create_session</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">DESTROY_SESSION</span><span class="p">,</span>	<span class="n">enc_destroy_session</span><span class="p">,</span>	<span class="n">dec_destroy_session</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">SEQUENCE</span><span class="p">,</span>		<span class="n">enc_sequence</span><span class="p">,</span>		<span class="n">dec_sequence</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">GET_LEASE_TIME</span><span class="p">,</span>	<span class="n">enc_get_lease_time</span><span class="p">,</span>	<span class="n">dec_get_lease_time</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">RECLAIM_COMPLETE</span><span class="p">,</span>	<span class="n">enc_reclaim_complete</span><span class="p">,</span>	<span class="n">dec_reclaim_complete</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">GETDEVICEINFO</span><span class="p">,</span>	<span class="n">enc_getdeviceinfo</span><span class="p">,</span>	<span class="n">dec_getdeviceinfo</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">LAYOUTGET</span><span class="p">,</span>		<span class="n">enc_layoutget</span><span class="p">,</span>		<span class="n">dec_layoutget</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">LAYOUTCOMMIT</span><span class="p">,</span>	<span class="n">enc_layoutcommit</span><span class="p">,</span>	<span class="n">dec_layoutcommit</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">LAYOUTRETURN</span><span class="p">,</span>	<span class="n">enc_layoutreturn</span><span class="p">,</span>	<span class="n">dec_layoutreturn</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">SECINFO_NO_NAME</span><span class="p">,</span>	<span class="n">enc_secinfo_no_name</span><span class="p">,</span>	<span class="n">dec_secinfo_no_name</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">TEST_STATEID</span><span class="p">,</span>	<span class="n">enc_test_stateid</span><span class="p">,</span>	<span class="n">dec_test_stateid</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">FREE_STATEID</span><span class="p">,</span>	<span class="n">enc_free_stateid</span><span class="p">,</span>	<span class="n">dec_free_stateid</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">GETDEVICELIST</span><span class="p">,</span>	<span class="n">enc_getdevicelist</span><span class="p">,</span>	<span class="n">dec_getdevicelist</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">BIND_CONN_TO_SESSION</span><span class="p">,</span>
			<span class="n">enc_bind_conn_to_session</span><span class="p">,</span> <span class="n">dec_bind_conn_to_session</span><span class="p">),</span>
	<span class="n">PROC</span><span class="p">(</span><span class="n">DESTROY_CLIENTID</span><span class="p">,</span>	<span class="n">enc_destroy_clientid</span><span class="p">,</span>	<span class="n">dec_destroy_clientid</span><span class="p">),</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_NFS_V4_1 */</span><span class="cp"></span>
<span class="p">};</span>

<span class="k">const</span> <span class="k">struct</span> <span class="n">rpc_version</span> <span class="n">nfs_version4</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">number</span>			<span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nrprocs</span>		<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">nfs4_procedures</span><span class="p">),</span>
	<span class="p">.</span><span class="n">procs</span>			<span class="o">=</span> <span class="n">nfs4_procedures</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Local variables:</span>
<span class="cm"> *  c-basic-offset: 8</span>
<span class="cm"> * End:</span>
<span class="cm"> */</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
