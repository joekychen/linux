<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › parisc › hpux › sys_hpux.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>sys_hpux.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *    Implements HPUX syscalls.</span>
<span class="cm"> *</span>
<span class="cm"> *    Copyright (C) 1999 Matthew Wilcox &lt;willy with parisc-linux.org&gt;</span>
<span class="cm"> *    Copyright (C) 2000 Philipp Rumpf</span>
<span class="cm"> *    Copyright (C) 2000 John Marvin &lt;jsm with parisc-linux.org&gt;</span>
<span class="cm"> *    Copyright (C) 2000 Michael Ang &lt;mang with subcarrier.org&gt;</span>
<span class="cm"> *    Copyright (C) 2001 Nathan Neulinger &lt;nneul at umr.edu&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *    This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *    it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *    the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *    (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *    This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *    GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *    You should have received a copy of the GNU General Public License</span>
<span class="cm"> *    along with this program; if not, write to the Free Software</span>
<span class="cm"> *    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/capability.h&gt;</span>
<span class="cp">#include &lt;linux/file.h&gt;</span>
<span class="cp">#include &lt;linux/fs.h&gt;</span>
<span class="cp">#include &lt;linux/namei.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/syscalls.h&gt;</span>
<span class="cp">#include &lt;linux/utsname.h&gt;</span>
<span class="cp">#include &lt;linux/vfs.h&gt;</span>
<span class="cp">#include &lt;linux/vmalloc.h&gt;</span>

<span class="cp">#include &lt;asm/errno.h&gt;</span>
<span class="cp">#include &lt;asm/pgalloc.h&gt;</span>
<span class="cp">#include &lt;asm/uaccess.h&gt;</span>

<span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">hpux_brk</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* Sigh.  Looks like HP/UX libc relies on kernel bugs. */</span>
	<span class="k">return</span> <span class="n">sys_brk</span><span class="p">(</span><span class="n">addr</span> <span class="o">+</span> <span class="n">PAGE_SIZE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hpux_sbrk</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Random other syscalls */</span>

<span class="kt">int</span> <span class="nf">hpux_nice</span><span class="p">(</span><span class="kt">int</span> <span class="n">priority_change</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hpux_ptrace</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hpux_wait</span><span class="p">(</span><span class="kt">int</span> <span class="n">__user</span> <span class="o">*</span><span class="n">stat_loc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">sys_waitpid</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">stat_loc</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hpux_setpgrp</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">sys_setpgid</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hpux_setpgrp3</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">hpux_setpgrp</span><span class="p">();</span>
<span class="p">}</span>

<span class="cp">#define _SC_CPU_VERSION	10001</span>
<span class="cp">#define _SC_OPEN_MAX	4</span>
<span class="cp">#define CPU_PA_RISC1_1	0x210</span>

<span class="kt">int</span> <span class="nf">hpux_sysconf</span><span class="p">(</span><span class="kt">int</span> <span class="n">which</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">which</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">_SC_CPU_VERSION</span>:
		<span class="k">return</span> <span class="n">CPU_PA_RISC1_1</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">_SC_OPEN_MAX</span>:
		<span class="k">return</span> <span class="n">INT_MAX</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*****************************************************************************/</span>

<span class="cp">#define HPUX_UTSLEN 9</span>
<span class="cp">#define HPUX_SNLEN 15</span>

<span class="k">struct</span> <span class="n">hpux_utsname</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">sysname</span><span class="p">[</span><span class="n">HPUX_UTSLEN</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">nodename</span><span class="p">[</span><span class="n">HPUX_UTSLEN</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">release</span><span class="p">[</span><span class="n">HPUX_UTSLEN</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">version</span><span class="p">[</span><span class="n">HPUX_UTSLEN</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">machine</span><span class="p">[</span><span class="n">HPUX_UTSLEN</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">idnumber</span><span class="p">[</span><span class="n">HPUX_SNLEN</span><span class="p">];</span>
<span class="p">}</span> <span class="p">;</span>

<span class="k">struct</span> <span class="n">hpux_ustat</span> <span class="p">{</span>
	<span class="kt">int32_t</span>		<span class="n">f_tfree</span><span class="p">;</span>	<span class="cm">/* total free (daddr_t)  */</span>
	<span class="n">u_int32_t</span>	<span class="n">f_tinode</span><span class="p">;</span>	<span class="cm">/* total inodes free (ino_t)  */</span>
	<span class="kt">char</span>		<span class="n">f_fname</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>	<span class="cm">/* filsys name */</span>
	<span class="kt">char</span>		<span class="n">f_fpack</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>	<span class="cm">/* filsys pack name */</span>
	<span class="n">u_int32_t</span>	<span class="n">f_blksize</span><span class="p">;</span>	<span class="cm">/* filsys block size (int) */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * HPUX&#39;s utssys() call.  It&#39;s a collection of miscellaneous functions,</span>
<span class="cm"> * alas, so there&#39;s no nice way of splitting them up.</span>
<span class="cm"> */</span>

<span class="cm">/*  This function is called from hpux_utssys(); HP-UX implements</span>
<span class="cm"> *  ustat() as an option to utssys().</span>
<span class="cm"> *</span>
<span class="cm"> *  Now, struct ustat on HP-UX is exactly the same as on Linux, except</span>
<span class="cm"> *  that it contains one addition field on the end, int32_t f_blksize.</span>
<span class="cm"> *  So, we could have written this function to just call the Linux</span>
<span class="cm"> *  sys_ustat(), (defined in linux/fs/super.c), and then just</span>
<span class="cm"> *  added this additional field to the user&#39;s structure.  But I figure</span>
<span class="cm"> *  if we&#39;re gonna be digging through filesystem structures to get</span>
<span class="cm"> *  this, we might as well just do the whole enchilada all in one go.</span>
<span class="cm"> *</span>
<span class="cm"> *  So, most of this function is almost identical to sys_ustat().</span>
<span class="cm"> *  I have placed comments at the few lines changed or added, to</span>
<span class="cm"> *  aid in porting forward if and when sys_ustat() is changed from</span>
<span class="cm"> *  its form in kernel 2.2.5.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">hpux_ustat</span><span class="p">(</span><span class="n">dev_t</span> <span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hpux_ustat</span> <span class="n">__user</span> <span class="o">*</span><span class="n">ubuf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hpux_ustat</span> <span class="n">tmp</span><span class="p">;</span>  <span class="cm">/* Changed to hpux_ustat */</span>
	<span class="k">struct</span> <span class="n">kstatfs</span> <span class="n">sbuf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="n">vfs_ustat</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sbuf</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="n">tmp</span><span class="p">));</span>

	<span class="n">tmp</span><span class="p">.</span><span class="n">f_tfree</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int32_t</span><span class="p">)</span><span class="n">sbuf</span><span class="p">.</span><span class="n">f_bfree</span><span class="p">;</span>
	<span class="n">tmp</span><span class="p">.</span><span class="n">f_tinode</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_int32_t</span><span class="p">)</span><span class="n">sbuf</span><span class="p">.</span><span class="n">f_ffree</span><span class="p">;</span>
	<span class="n">tmp</span><span class="p">.</span><span class="n">f_blksize</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_int32_t</span><span class="p">)</span><span class="n">sbuf</span><span class="p">.</span><span class="n">f_bsize</span><span class="p">;</span>  <span class="cm">/*  Added this line  */</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">copy_to_user</span><span class="p">(</span><span class="n">ubuf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tmp</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tmp</span><span class="p">))</span> <span class="o">?</span> <span class="o">-</span><span class="n">EFAULT</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Wrapper for hpux statfs call. At the moment, just calls the linux native one</span>
<span class="cm"> * and ignores the extra fields at the end of the hpux statfs struct.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="kt">int32_t</span> <span class="n">hpux_fsid_t</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>              <span class="cm">/* file system ID type */</span>
<span class="k">typedef</span> <span class="kt">uint16_t</span> <span class="n">hpux_site_t</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">hpux_statfs</span> <span class="p">{</span>
     <span class="kt">int32_t</span> <span class="n">f_type</span><span class="p">;</span>                    <span class="cm">/* type of info, zero for now */</span>
     <span class="kt">int32_t</span> <span class="n">f_bsize</span><span class="p">;</span>                   <span class="cm">/* fundamental file system block size */</span>
     <span class="kt">int32_t</span> <span class="n">f_blocks</span><span class="p">;</span>                  <span class="cm">/* total blocks in file system */</span>
     <span class="kt">int32_t</span> <span class="n">f_bfree</span><span class="p">;</span>                   <span class="cm">/* free block in fs */</span>
     <span class="kt">int32_t</span> <span class="n">f_bavail</span><span class="p">;</span>                  <span class="cm">/* free blocks avail to non-superuser */</span>
     <span class="kt">int32_t</span> <span class="n">f_files</span><span class="p">;</span>                   <span class="cm">/* total file nodes in file system */</span>
     <span class="kt">int32_t</span> <span class="n">f_ffree</span><span class="p">;</span>                   <span class="cm">/* free file nodes in fs */</span>
     <span class="n">hpux_fsid_t</span>  <span class="n">f_fsid</span><span class="p">;</span>                    <span class="cm">/* file system ID */</span>
     <span class="kt">int32_t</span> <span class="n">f_magic</span><span class="p">;</span>                   <span class="cm">/* file system magic number */</span>
     <span class="kt">int32_t</span> <span class="n">f_featurebits</span><span class="p">;</span>             <span class="cm">/* file system features */</span>
     <span class="kt">int32_t</span> <span class="n">f_spare</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>                <span class="cm">/* spare for later */</span>
     <span class="n">hpux_site_t</span>  <span class="n">f_cnode</span><span class="p">;</span>                   <span class="cm">/* cluster node where mounted */</span>
     <span class="kt">int16_t</span> <span class="n">f_pad</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">do_statfs_hpux</span><span class="p">(</span><span class="k">struct</span> <span class="n">kstatfs</span> <span class="o">*</span><span class="n">st</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hpux_statfs</span> <span class="n">__user</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hpux_statfs</span> <span class="n">buf</span><span class="p">;</span>
	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
	<span class="n">buf</span><span class="p">.</span><span class="n">f_type</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">f_type</span><span class="p">;</span>
	<span class="n">buf</span><span class="p">.</span><span class="n">f_bsize</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">f_bsize</span><span class="p">;</span>
	<span class="n">buf</span><span class="p">.</span><span class="n">f_blocks</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">f_blocks</span><span class="p">;</span>
	<span class="n">buf</span><span class="p">.</span><span class="n">f_bfree</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">f_bfree</span><span class="p">;</span>
	<span class="n">buf</span><span class="p">.</span><span class="n">f_bavail</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">f_bavail</span><span class="p">;</span>
	<span class="n">buf</span><span class="p">.</span><span class="n">f_files</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">f_files</span><span class="p">;</span>
	<span class="n">buf</span><span class="p">.</span><span class="n">f_ffree</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">f_ffree</span><span class="p">;</span>
	<span class="n">buf</span><span class="p">.</span><span class="n">f_fsid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">f_fsid</span><span class="p">.</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">buf</span><span class="p">.</span><span class="n">f_fsid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">f_fsid</span><span class="p">.</span><span class="n">val</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_to_user</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* hpux statfs */</span>
<span class="n">asmlinkage</span> <span class="kt">long</span> <span class="nf">hpux_statfs</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">pathname</span><span class="p">,</span>
						<span class="k">struct</span> <span class="n">hpux_statfs</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">kstatfs</span> <span class="n">st</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">error</span> <span class="o">=</span> <span class="n">user_statfs</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span>
		<span class="n">error</span> <span class="o">=</span> <span class="n">do_statfs_hpux</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">error</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">asmlinkage</span> <span class="kt">long</span> <span class="nf">hpux_fstatfs</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hpux_statfs</span> <span class="n">__user</span> <span class="o">*</span> <span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">kstatfs</span> <span class="n">st</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">error</span> <span class="o">=</span> <span class="n">fd_statfs</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">error</span><span class="p">)</span>
		<span class="n">error</span> <span class="o">=</span> <span class="n">do_statfs_hpux</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">error</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/*  This function is called from hpux_utssys(); HP-UX implements</span>
<span class="cm"> *  uname() as an option to utssys().</span>
<span class="cm"> *</span>
<span class="cm"> *  The form of this function is pretty much copied from sys_olduname(),</span>
<span class="cm"> *  defined in linux/arch/i386/kernel/sys_i386.c.</span>
<span class="cm"> */</span>
<span class="cm">/*  TODO: Are these put_user calls OK?  Should they pass an int?</span>
<span class="cm"> *        (I copied it from sys_i386.c like this.)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">hpux_uname</span><span class="p">(</span><span class="k">struct</span> <span class="n">hpux_utsname</span> <span class="n">__user</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">error</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">name</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">access_ok</span><span class="p">(</span><span class="n">VERIFY_WRITE</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hpux_utsname</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">down_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uts_sem</span><span class="p">);</span>

	<span class="n">error</span> <span class="o">=</span> <span class="n">__copy_to_user</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="o">-&gt;</span><span class="n">sysname</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">sysname</span><span class="p">,</span>
			       <span class="n">HPUX_UTSLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">error</span> <span class="o">|=</span> <span class="n">__put_user</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">sysname</span> <span class="o">+</span> <span class="n">HPUX_UTSLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">error</span> <span class="o">|=</span> <span class="n">__copy_to_user</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="o">-&gt;</span><span class="n">nodename</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">nodename</span><span class="p">,</span>
				<span class="n">HPUX_UTSLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">error</span> <span class="o">|=</span> <span class="n">__put_user</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">nodename</span> <span class="o">+</span> <span class="n">HPUX_UTSLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">error</span> <span class="o">|=</span> <span class="n">__copy_to_user</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="o">-&gt;</span><span class="n">release</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">release</span><span class="p">,</span>
				<span class="n">HPUX_UTSLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">error</span> <span class="o">|=</span> <span class="n">__put_user</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">release</span> <span class="o">+</span> <span class="n">HPUX_UTSLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">error</span> <span class="o">|=</span> <span class="n">__copy_to_user</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">,</span>
				<span class="n">HPUX_UTSLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">error</span> <span class="o">|=</span> <span class="n">__put_user</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">+</span> <span class="n">HPUX_UTSLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">error</span> <span class="o">|=</span> <span class="n">__copy_to_user</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="o">-&gt;</span><span class="n">machine</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">machine</span><span class="p">,</span>
				<span class="n">HPUX_UTSLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">error</span> <span class="o">|=</span> <span class="n">__put_user</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">name</span><span class="o">-&gt;</span><span class="n">machine</span> <span class="o">+</span> <span class="n">HPUX_UTSLEN</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">up_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uts_sem</span><span class="p">);</span>

	<span class="cm">/*  HP-UX  utsname has no domainname field.  */</span>

	<span class="cm">/*  TODO:  Implement idnumber!!!  */</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	error |= __put_user(0,name-&gt;idnumber);</span>
<span class="c">	error |= __put_user(0,name-&gt;idnumber+HPUX_SNLEN-1);</span>
<span class="cp">#endif</span>

	<span class="n">error</span> <span class="o">=</span> <span class="n">error</span> <span class="o">?</span> <span class="o">-</span><span class="n">EFAULT</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">error</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*  Note: HP-UX just uses the old suser() function to check perms</span>
<span class="cm"> *  in this system call.  We&#39;ll use capable(CAP_SYS_ADMIN).</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">hpux_utssys</span><span class="p">(</span><span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">ubuf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">error</span><span class="p">;</span>
	<span class="k">switch</span><span class="p">(</span> <span class="n">type</span> <span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="cm">/*  uname():  */</span>
		<span class="k">return</span> <span class="n">hpux_uname</span><span class="p">((</span><span class="k">struct</span> <span class="n">hpux_utsname</span> <span class="n">__user</span> <span class="o">*</span><span class="p">)</span><span class="n">ubuf</span><span class="p">);</span>
		<span class="k">break</span> <span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="cm">/*  Obsolete (used to be umask().)  */</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span> <span class="p">;</span>
		<span class="k">break</span> <span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="cm">/*  ustat():  */</span>
		<span class="k">return</span> <span class="n">hpux_ustat</span><span class="p">(</span><span class="n">new_decode_dev</span><span class="p">(</span><span class="n">n</span><span class="p">),</span>
				  <span class="p">(</span><span class="k">struct</span> <span class="n">hpux_ustat</span> <span class="n">__user</span> <span class="o">*</span><span class="p">)</span><span class="n">ubuf</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>:
		<span class="cm">/*  setuname():</span>
<span class="cm">		 *</span>
<span class="cm">		 *  On linux (unlike HP-UX), utsname.nodename</span>
<span class="cm">		 *  is the same as the hostname.</span>
<span class="cm">		 *</span>
<span class="cm">		 *  sys_sethostname() is defined in linux/kernel/sys.c.</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">capable</span><span class="p">(</span><span class="n">CAP_SYS_ADMIN</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>
		<span class="cm">/*  Unlike Linux, HP-UX returns an error if n==0:  */</span>
		<span class="k">if</span> <span class="p">(</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span> <span class="p">;</span>
		<span class="cm">/*  Unlike Linux, HP-UX truncates it if n is too big:  */</span>
		<span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">__NEW_UTS_LEN</span><span class="p">)</span> <span class="o">?</span> <span class="n">n</span> <span class="o">:</span> <span class="n">__NEW_UTS_LEN</span> <span class="p">;</span>
		<span class="k">return</span> <span class="n">sys_sethostname</span><span class="p">(</span><span class="n">ubuf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">break</span> <span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>:
		<span class="cm">/*  sethostname():</span>
<span class="cm">		 *</span>
<span class="cm">		 *  sys_sethostname() is defined in linux/kernel/sys.c.</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">capable</span><span class="p">(</span><span class="n">CAP_SYS_ADMIN</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>
		<span class="cm">/*  Unlike Linux, HP-UX returns an error if n==0:  */</span>
		<span class="k">if</span> <span class="p">(</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span> <span class="p">;</span>
		<span class="cm">/*  Unlike Linux, HP-UX truncates it if n is too big:  */</span>
		<span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">__NEW_UTS_LEN</span><span class="p">)</span> <span class="o">?</span> <span class="n">n</span> <span class="o">:</span> <span class="n">__NEW_UTS_LEN</span> <span class="p">;</span>
		<span class="k">return</span> <span class="n">sys_sethostname</span><span class="p">(</span><span class="n">ubuf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">break</span> <span class="p">;</span>
	<span class="k">case</span> <span class="mi">5</span>:
		<span class="cm">/*  gethostname():</span>
<span class="cm">		 *</span>
<span class="cm">		 *  sys_gethostname() is defined in linux/kernel/sys.c.</span>
<span class="cm">		 */</span>
		<span class="cm">/*  Unlike Linux, HP-UX returns an error if n==0:  */</span>
		<span class="k">if</span> <span class="p">(</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span> <span class="p">;</span>
		<span class="k">return</span> <span class="n">sys_gethostname</span><span class="p">(</span><span class="n">ubuf</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
		<span class="k">break</span> <span class="p">;</span>
	<span class="k">case</span> <span class="mi">6</span>:
		<span class="cm">/*  Supposedly called from setuname() in libc.</span>
<span class="cm">		 *  TODO: When and why is this called?</span>
<span class="cm">		 *        Is it ever even called?</span>
<span class="cm">		 *</span>
<span class="cm">		 *  This code should look a lot like sys_sethostname(),</span>
<span class="cm">		 *  defined in linux/kernel/sys.c.  If that gets updated,</span>
<span class="cm">		 *  update this code similarly.</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">capable</span><span class="p">(</span><span class="n">CAP_SYS_ADMIN</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>
		<span class="cm">/*  Unlike Linux, HP-UX returns an error if n==0:  */</span>
		<span class="k">if</span> <span class="p">(</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span> <span class="p">;</span>
		<span class="cm">/*  Unlike Linux, HP-UX truncates it if n is too big:  */</span>
		<span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">__NEW_UTS_LEN</span><span class="p">)</span> <span class="o">?</span> <span class="n">n</span> <span class="o">:</span> <span class="n">__NEW_UTS_LEN</span> <span class="p">;</span>
		<span class="cm">/**/</span>
		<span class="cm">/*  TODO:  print a warning about using this?  */</span>
		<span class="n">down_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uts_sem</span><span class="p">);</span>
		<span class="n">error</span> <span class="o">=</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">sysname</span><span class="p">,</span> <span class="n">ubuf</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">sysname</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">error</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">up_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uts_sem</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">error</span><span class="p">;</span>
		<span class="k">break</span> <span class="p">;</span>
	<span class="k">case</span> <span class="mi">7</span>:
		<span class="cm">/*  Sets utsname.release, if you&#39;re allowed.</span>
<span class="cm">		 *  Undocumented.  Used by swinstall to change the</span>
<span class="cm">		 *  OS version, during OS updates.  Yuck!!!</span>
<span class="cm">		 *</span>
<span class="cm">		 *  This code should look a lot like sys_sethostname()</span>
<span class="cm">		 *  in linux/kernel/sys.c.  If that gets updated, update</span>
<span class="cm">		 *  this code similarly.</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">capable</span><span class="p">(</span><span class="n">CAP_SYS_ADMIN</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>
		<span class="cm">/*  Unlike Linux, HP-UX returns an error if n==0:  */</span>
		<span class="k">if</span> <span class="p">(</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span> <span class="p">;</span>
		<span class="cm">/*  Unlike Linux, HP-UX truncates it if n is too big:  */</span>
		<span class="n">len</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;=</span> <span class="n">__NEW_UTS_LEN</span><span class="p">)</span> <span class="o">?</span> <span class="n">n</span> <span class="o">:</span> <span class="n">__NEW_UTS_LEN</span> <span class="p">;</span>
		<span class="cm">/**/</span>
		<span class="cm">/*  TODO:  print a warning about this?  */</span>
		<span class="n">down_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uts_sem</span><span class="p">);</span>
		<span class="n">error</span> <span class="o">=</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">release</span><span class="p">,</span> <span class="n">ubuf</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">release</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">error</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">up_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uts_sem</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">error</span><span class="p">;</span>
		<span class="k">break</span> <span class="p">;</span>
	<span class="nl">default:</span>
		<span class="cm">/*  This system call returns -EFAULT if given an unknown type.</span>
<span class="cm">	 	 *  Why not -EINVAL?  I don&#39;t know, it&#39;s just not what they did.</span>
<span class="cm">	 	 */</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span> <span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hpux_getdomainname</span><span class="p">(</span><span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
 	<span class="kt">int</span> <span class="n">nlen</span><span class="p">;</span>
 	<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
 	
 	<span class="n">down_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uts_sem</span><span class="p">);</span>
 	
	<span class="n">nlen</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">domainname</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">nlen</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">nlen</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">__NEW_UTS_LEN</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
	<span class="k">if</span><span class="p">(</span><span class="n">copy_to_user</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">utsname</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">domainname</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">done:</span>
	<span class="n">up_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">uts_sem</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hpux_pipe</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">kstack_fildes</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">do_pipe_flags</span><span class="p">(</span><span class="n">kstack_fildes</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* lies - says it works, but it really didn&#39;t lock anything */</span>
<span class="kt">int</span> <span class="nf">hpux_lockf</span><span class="p">(</span><span class="kt">int</span> <span class="n">fildes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">function</span><span class="p">,</span> <span class="kt">off_t</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hpux_sysfs</span><span class="p">(</span><span class="kt">int</span> <span class="n">opcode</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg1</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">fsname</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">fstype</span><span class="p">;</span>

<span class="cm">/*Unimplemented HP-UX syscall emulation. Syscall #334 (sysfs)</span>
<span class="cm">  Args: 1 80057bf4 0 400179f0 0 0 0 */</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;in hpux_sysfs</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;hpux_sysfs called with opcode = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">opcode</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;hpux_sysfs called with arg1=&#39;%lx&#39;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">arg1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span> <span class="n">opcode</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">)</span> <span class="p">{</span> <span class="cm">/* GETFSIND */</span>	
		<span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_fsname</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">)</span><span class="n">arg1</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">strlen_user</span><span class="p">(</span><span class="n">user_fsname</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;len of arg1 = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">fsname</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fsname</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;failed to kmalloc fsname</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">fsname</span><span class="p">,</span> <span class="n">user_fsname</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;failed to copy_from_user fsname</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">kfree</span><span class="p">(</span><span class="n">fsname</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="cm">/* String could be altered by userspace after strlen_user() */</span>
		<span class="n">fsname</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;that is &#39;%s&#39; as (char *)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">fsname</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">fsname</span><span class="p">,</span> <span class="s">&quot;hfs&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
			<span class="n">fstype</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">fstype</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">kfree</span><span class="p">(</span><span class="n">fsname</span><span class="p">);</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;returning fstype=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">fstype</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">fstype</span><span class="p">;</span> <span class="cm">/* something other than default */</span>
	<span class="p">}</span>


	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Table of syscall names and handle for unimplemented routines */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">syscall_names</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;nosys&quot;</span><span class="p">,</span>                  <span class="cm">/* 0 */</span>
	<span class="s">&quot;exit&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;fork&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;read&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;write&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;open&quot;</span><span class="p">,</span>                   <span class="cm">/* 5 */</span>
	<span class="s">&quot;close&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;wait&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;creat&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;link&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;unlink&quot;</span><span class="p">,</span>                 <span class="cm">/* 10 */</span>
	<span class="s">&quot;execv&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;chdir&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;time&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;mknod&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;chmod&quot;</span><span class="p">,</span>                  <span class="cm">/* 15 */</span>
	<span class="s">&quot;chown&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;brk&quot;</span><span class="p">,</span>                   
	<span class="s">&quot;lchmod&quot;</span><span class="p">,</span>                
	<span class="s">&quot;lseek&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;getpid&quot;</span><span class="p">,</span>                 <span class="cm">/* 20 */</span>
	<span class="s">&quot;mount&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;umount&quot;</span><span class="p">,</span>                
	<span class="s">&quot;setuid&quot;</span><span class="p">,</span>                
	<span class="s">&quot;getuid&quot;</span><span class="p">,</span>                
	<span class="s">&quot;stime&quot;</span><span class="p">,</span>                  <span class="cm">/* 25 */</span>
	<span class="s">&quot;ptrace&quot;</span><span class="p">,</span>                
	<span class="s">&quot;alarm&quot;</span><span class="p">,</span>                 
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;pause&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;utime&quot;</span><span class="p">,</span>                  <span class="cm">/* 30 */</span>
	<span class="s">&quot;stty&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;gtty&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;access&quot;</span><span class="p">,</span>                
	<span class="s">&quot;nice&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;ftime&quot;</span><span class="p">,</span>                  <span class="cm">/* 35 */</span>
	<span class="s">&quot;sync&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;kill&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;stat&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;setpgrp3&quot;</span><span class="p">,</span>              
	<span class="s">&quot;lstat&quot;</span><span class="p">,</span>                  <span class="cm">/* 40 */</span>
	<span class="s">&quot;dup&quot;</span><span class="p">,</span>                   
	<span class="s">&quot;pipe&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;times&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;profil&quot;</span><span class="p">,</span>                
	<span class="s">&quot;ki_call&quot;</span><span class="p">,</span>                <span class="cm">/* 45 */</span>
	<span class="s">&quot;setgid&quot;</span><span class="p">,</span>                
	<span class="s">&quot;getgid&quot;</span><span class="p">,</span>                
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 50 */</span>
	<span class="s">&quot;acct&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;set_userthreadid&quot;</span><span class="p">,</span>      
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;ioctl&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;reboot&quot;</span><span class="p">,</span>                 <span class="cm">/* 55 */</span>
	<span class="s">&quot;symlink&quot;</span><span class="p">,</span>               
	<span class="s">&quot;utssys&quot;</span><span class="p">,</span>                
	<span class="s">&quot;readlink&quot;</span><span class="p">,</span>              
	<span class="s">&quot;execve&quot;</span><span class="p">,</span>                
	<span class="s">&quot;umask&quot;</span><span class="p">,</span>                  <span class="cm">/* 60 */</span>
	<span class="s">&quot;chroot&quot;</span><span class="p">,</span>                
	<span class="s">&quot;fcntl&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;ulimit&quot;</span><span class="p">,</span>                
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 65 */</span>
	<span class="s">&quot;vfork&quot;</span><span class="p">,</span>                 
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 70 */</span>
	<span class="s">&quot;mmap&quot;</span><span class="p">,</span>                  
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;munmap&quot;</span><span class="p">,</span>                
	<span class="s">&quot;mprotect&quot;</span><span class="p">,</span>              
	<span class="s">&quot;madvise&quot;</span><span class="p">,</span>                <span class="cm">/* 75 */</span>
	<span class="s">&quot;vhangup&quot;</span><span class="p">,</span>               
	<span class="s">&quot;swapoff&quot;</span><span class="p">,</span>               
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;getgroups&quot;</span><span class="p">,</span>             
	<span class="s">&quot;setgroups&quot;</span><span class="p">,</span>              <span class="cm">/* 80 */</span>
	<span class="s">&quot;getpgrp2&quot;</span><span class="p">,</span>              
	<span class="s">&quot;setpgid/setpgrp2&quot;</span><span class="p">,</span>      
	<span class="s">&quot;setitimer&quot;</span><span class="p">,</span>             
	<span class="s">&quot;wait3&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;swapon&quot;</span><span class="p">,</span>                 <span class="cm">/* 85 */</span>
	<span class="s">&quot;getitimer&quot;</span><span class="p">,</span>             
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;dup2&quot;</span><span class="p">,</span>                   <span class="cm">/* 90 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;fstat&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;select&quot;</span><span class="p">,</span>                
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;fsync&quot;</span><span class="p">,</span>                  <span class="cm">/* 95 */</span>
	<span class="s">&quot;setpriority&quot;</span><span class="p">,</span>           
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;getpriority&quot;</span><span class="p">,</span>            <span class="cm">/* 100 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 105 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;sigvector&quot;</span><span class="p">,</span>             
	<span class="s">&quot;sigblock&quot;</span><span class="p">,</span>              
	<span class="s">&quot;sigsetmask&quot;</span><span class="p">,</span>             <span class="cm">/* 110 */</span>
	<span class="s">&quot;sigpause&quot;</span><span class="p">,</span>              
	<span class="s">&quot;sigstack&quot;</span><span class="p">,</span>              
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 115 */</span>
	<span class="s">&quot;gettimeofday&quot;</span><span class="p">,</span>          
	<span class="s">&quot;getrusage&quot;</span><span class="p">,</span>             
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;readv&quot;</span><span class="p">,</span>                  <span class="cm">/* 120 */</span>
	<span class="s">&quot;writev&quot;</span><span class="p">,</span>                
	<span class="s">&quot;settimeofday&quot;</span><span class="p">,</span>          
	<span class="s">&quot;fchown&quot;</span><span class="p">,</span>                
	<span class="s">&quot;fchmod&quot;</span><span class="p">,</span>                
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 125 */</span>
	<span class="s">&quot;setresuid&quot;</span><span class="p">,</span>             
	<span class="s">&quot;setresgid&quot;</span><span class="p">,</span>             
	<span class="s">&quot;rename&quot;</span><span class="p">,</span>                
	<span class="s">&quot;truncate&quot;</span><span class="p">,</span>              
	<span class="s">&quot;ftruncate&quot;</span><span class="p">,</span>              <span class="cm">/* 130 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;sysconf&quot;</span><span class="p">,</span>               
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 135 */</span>
	<span class="s">&quot;mkdir&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;rmdir&quot;</span><span class="p">,</span>                 
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;sigcleanup&quot;</span><span class="p">,</span>            
	<span class="s">&quot;setcore&quot;</span><span class="p">,</span>                <span class="cm">/* 140 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;gethostid&quot;</span><span class="p">,</span>             
	<span class="s">&quot;sethostid&quot;</span><span class="p">,</span>             
	<span class="s">&quot;getrlimit&quot;</span><span class="p">,</span>             
	<span class="s">&quot;setrlimit&quot;</span><span class="p">,</span>              <span class="cm">/* 145 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;quotactl&quot;</span><span class="p">,</span>              
	<span class="s">&quot;get_sysinfo&quot;</span><span class="p">,</span>           
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 150 */</span>
	<span class="s">&quot;privgrp&quot;</span><span class="p">,</span>               
	<span class="s">&quot;rtprio&quot;</span><span class="p">,</span>                
	<span class="s">&quot;plock&quot;</span><span class="p">,</span>                 
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;lockf&quot;</span><span class="p">,</span>                  <span class="cm">/* 155 */</span>
	<span class="s">&quot;semget&quot;</span><span class="p">,</span>                
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;semop&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;msgget&quot;</span><span class="p">,</span>                
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 160 */</span>
	<span class="s">&quot;msgsnd&quot;</span><span class="p">,</span>                
	<span class="s">&quot;msgrcv&quot;</span><span class="p">,</span>                
	<span class="s">&quot;shmget&quot;</span><span class="p">,</span>                
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;shmat&quot;</span><span class="p">,</span>                  <span class="cm">/* 165 */</span>
	<span class="s">&quot;shmdt&quot;</span><span class="p">,</span>                 
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;csp/nsp_init&quot;</span><span class="p">,</span>          
	<span class="s">&quot;cluster&quot;</span><span class="p">,</span>               
	<span class="s">&quot;mkrnod&quot;</span><span class="p">,</span>                 <span class="cm">/* 170 */</span>
	<span class="s">&quot;test&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;unsp_open&quot;</span><span class="p">,</span>             
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;getcontext&quot;</span><span class="p">,</span>            
	<span class="s">&quot;osetcontext&quot;</span><span class="p">,</span>            <span class="cm">/* 175 */</span>
	<span class="s">&quot;bigio&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;pipenode&quot;</span><span class="p">,</span>              
	<span class="s">&quot;lsync&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;getmachineid&quot;</span><span class="p">,</span>          
	<span class="s">&quot;cnodeid/mysite&quot;</span><span class="p">,</span>         <span class="cm">/* 180 */</span>
	<span class="s">&quot;cnodes/sitels&quot;</span><span class="p">,</span>         
	<span class="s">&quot;swapclients&quot;</span><span class="p">,</span>           
	<span class="s">&quot;rmtprocess&quot;</span><span class="p">,</span>            
	<span class="s">&quot;dskless_stats&quot;</span><span class="p">,</span>         
	<span class="s">&quot;sigprocmask&quot;</span><span class="p">,</span>            <span class="cm">/* 185 */</span>
	<span class="s">&quot;sigpending&quot;</span><span class="p">,</span>            
	<span class="s">&quot;sigsuspend&quot;</span><span class="p">,</span>            
	<span class="s">&quot;sigaction&quot;</span><span class="p">,</span>             
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;nfssvc&quot;</span><span class="p">,</span>                 <span class="cm">/* 190 */</span>
	<span class="s">&quot;getfh&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;getdomainname&quot;</span><span class="p">,</span>         
	<span class="s">&quot;setdomainname&quot;</span><span class="p">,</span>         
	<span class="s">&quot;async_daemon&quot;</span><span class="p">,</span>          
	<span class="s">&quot;getdirentries&quot;</span><span class="p">,</span>          <span class="cm">/* 195 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                
	<span class="nb">NULL</span><span class="p">,</span>               
	<span class="s">&quot;vfsmount&quot;</span><span class="p">,</span>              
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;waitpid&quot;</span><span class="p">,</span>                <span class="cm">/* 200 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 205 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 210 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 215 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 220 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;sigsetreturn&quot;</span><span class="p">,</span>          
	<span class="s">&quot;sigsetstatemask&quot;</span><span class="p">,</span>        <span class="cm">/* 225 */</span>
	<span class="s">&quot;bfactl&quot;</span><span class="p">,</span>                
	<span class="s">&quot;cs&quot;</span><span class="p">,</span>                    
	<span class="s">&quot;cds&quot;</span><span class="p">,</span>                   
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;pathconf&quot;</span><span class="p">,</span>               <span class="cm">/* 230 */</span>
	<span class="s">&quot;fpathconf&quot;</span><span class="p">,</span>             
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;nfs_fcntl&quot;</span><span class="p">,</span>             
	<span class="s">&quot;ogetacl&quot;</span><span class="p">,</span>                <span class="cm">/* 235 */</span>
	<span class="s">&quot;ofgetacl&quot;</span><span class="p">,</span>              
	<span class="s">&quot;osetacl&quot;</span><span class="p">,</span>               
	<span class="s">&quot;ofsetacl&quot;</span><span class="p">,</span>              
	<span class="s">&quot;pstat&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;getaudid&quot;</span><span class="p">,</span>               <span class="cm">/* 240 */</span>
	<span class="s">&quot;setaudid&quot;</span><span class="p">,</span>              
	<span class="s">&quot;getaudproc&quot;</span><span class="p">,</span>            
	<span class="s">&quot;setaudproc&quot;</span><span class="p">,</span>            
	<span class="s">&quot;getevent&quot;</span><span class="p">,</span>              
	<span class="s">&quot;setevent&quot;</span><span class="p">,</span>               <span class="cm">/* 245 */</span>
	<span class="s">&quot;audwrite&quot;</span><span class="p">,</span>              
	<span class="s">&quot;audswitch&quot;</span><span class="p">,</span>             
	<span class="s">&quot;audctl&quot;</span><span class="p">,</span>                
	<span class="s">&quot;ogetaccess&quot;</span><span class="p">,</span>            
	<span class="s">&quot;fsctl&quot;</span><span class="p">,</span>                  <span class="cm">/* 250 */</span>
	<span class="s">&quot;ulconnect&quot;</span><span class="p">,</span>             
	<span class="s">&quot;ulcontrol&quot;</span><span class="p">,</span>             
	<span class="s">&quot;ulcreate&quot;</span><span class="p">,</span>              
	<span class="s">&quot;uldest&quot;</span><span class="p">,</span>                
	<span class="s">&quot;ulrecv&quot;</span><span class="p">,</span>                 <span class="cm">/* 255 */</span>
	<span class="s">&quot;ulrecvcn&quot;</span><span class="p">,</span>              
	<span class="s">&quot;ulsend&quot;</span><span class="p">,</span>                
	<span class="s">&quot;ulshutdown&quot;</span><span class="p">,</span>            
	<span class="s">&quot;swapfs&quot;</span><span class="p">,</span>                
	<span class="s">&quot;fss&quot;</span><span class="p">,</span>                    <span class="cm">/* 260 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 265 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;tsync&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;getnumfds&quot;</span><span class="p">,</span>             
	<span class="s">&quot;poll&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;getmsg&quot;</span><span class="p">,</span>                 <span class="cm">/* 270 */</span>
	<span class="s">&quot;putmsg&quot;</span><span class="p">,</span>                
	<span class="s">&quot;fchdir&quot;</span><span class="p">,</span>                
	<span class="s">&quot;getmount_cnt&quot;</span><span class="p">,</span>          
	<span class="s">&quot;getmount_entry&quot;</span><span class="p">,</span>        
	<span class="s">&quot;accept&quot;</span><span class="p">,</span>                 <span class="cm">/* 275 */</span>
	<span class="s">&quot;bind&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;connect&quot;</span><span class="p">,</span>               
	<span class="s">&quot;getpeername&quot;</span><span class="p">,</span>           
	<span class="s">&quot;getsockname&quot;</span><span class="p">,</span>           
	<span class="s">&quot;getsockopt&quot;</span><span class="p">,</span>             <span class="cm">/* 280 */</span>
	<span class="s">&quot;listen&quot;</span><span class="p">,</span>                
	<span class="s">&quot;recv&quot;</span><span class="p">,</span>                  
	<span class="s">&quot;recvfrom&quot;</span><span class="p">,</span>              
	<span class="s">&quot;recvmsg&quot;</span><span class="p">,</span>               
	<span class="s">&quot;send&quot;</span><span class="p">,</span>                   <span class="cm">/* 285 */</span>
	<span class="s">&quot;sendmsg&quot;</span><span class="p">,</span>               
	<span class="s">&quot;sendto&quot;</span><span class="p">,</span>                
	<span class="s">&quot;setsockopt&quot;</span><span class="p">,</span>            
	<span class="s">&quot;shutdown&quot;</span><span class="p">,</span>              
	<span class="s">&quot;socket&quot;</span><span class="p">,</span>                 <span class="cm">/* 290 */</span>
	<span class="s">&quot;socketpair&quot;</span><span class="p">,</span>            
	<span class="s">&quot;proc_open&quot;</span><span class="p">,</span>             
	<span class="s">&quot;proc_close&quot;</span><span class="p">,</span>            
	<span class="s">&quot;proc_send&quot;</span><span class="p">,</span>             
	<span class="s">&quot;proc_recv&quot;</span><span class="p">,</span>              <span class="cm">/* 295 */</span>
	<span class="s">&quot;proc_sendrecv&quot;</span><span class="p">,</span>         
	<span class="s">&quot;proc_syscall&quot;</span><span class="p">,</span>          
	<span class="s">&quot;ipccreate&quot;</span><span class="p">,</span>             
	<span class="s">&quot;ipcname&quot;</span><span class="p">,</span>               
	<span class="s">&quot;ipcnamerase&quot;</span><span class="p">,</span>            <span class="cm">/* 300 */</span>
	<span class="s">&quot;ipclookup&quot;</span><span class="p">,</span>             
	<span class="s">&quot;ipcselect&quot;</span><span class="p">,</span>             
	<span class="s">&quot;ipcconnect&quot;</span><span class="p">,</span>            
	<span class="s">&quot;ipcrecvcn&quot;</span><span class="p">,</span>             
	<span class="s">&quot;ipcsend&quot;</span><span class="p">,</span>                <span class="cm">/* 305 */</span>
	<span class="s">&quot;ipcrecv&quot;</span><span class="p">,</span>               
	<span class="s">&quot;ipcgetnodename&quot;</span><span class="p">,</span>        
	<span class="s">&quot;ipcsetnodename&quot;</span><span class="p">,</span>        
	<span class="s">&quot;ipccontrol&quot;</span><span class="p">,</span>            
	<span class="s">&quot;ipcshutdown&quot;</span><span class="p">,</span>            <span class="cm">/* 310 */</span>
	<span class="s">&quot;ipcdest&quot;</span><span class="p">,</span>               
	<span class="s">&quot;semctl&quot;</span><span class="p">,</span>                
	<span class="s">&quot;msgctl&quot;</span><span class="p">,</span>                
	<span class="s">&quot;shmctl&quot;</span><span class="p">,</span>                
	<span class="s">&quot;mpctl&quot;</span><span class="p">,</span>                  <span class="cm">/* 315 */</span>
	<span class="s">&quot;exportfs&quot;</span><span class="p">,</span>              
	<span class="s">&quot;getpmsg&quot;</span><span class="p">,</span>               
	<span class="s">&quot;putpmsg&quot;</span><span class="p">,</span>               
	<span class="s">&quot;strioctl&quot;</span><span class="p">,</span>              
	<span class="s">&quot;msync&quot;</span><span class="p">,</span>                  <span class="cm">/* 320 */</span>
	<span class="s">&quot;msleep&quot;</span><span class="p">,</span>                
	<span class="s">&quot;mwakeup&quot;</span><span class="p">,</span>               
	<span class="s">&quot;msem_init&quot;</span><span class="p">,</span>             
	<span class="s">&quot;msem_remove&quot;</span><span class="p">,</span>           
	<span class="s">&quot;adjtime&quot;</span><span class="p">,</span>                <span class="cm">/* 325 */</span>
	<span class="s">&quot;kload&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;fattach&quot;</span><span class="p">,</span>               
	<span class="s">&quot;fdetach&quot;</span><span class="p">,</span>               
	<span class="s">&quot;serialize&quot;</span><span class="p">,</span>             
	<span class="s">&quot;statvfs&quot;</span><span class="p">,</span>                <span class="cm">/* 330 */</span>
	<span class="s">&quot;fstatvfs&quot;</span><span class="p">,</span>              
	<span class="s">&quot;lchown&quot;</span><span class="p">,</span>                
	<span class="s">&quot;getsid&quot;</span><span class="p">,</span>                
	<span class="s">&quot;sysfs&quot;</span><span class="p">,</span>                 
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 335 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;sched_setparam&quot;</span><span class="p">,</span>        
	<span class="s">&quot;sched_getparam&quot;</span><span class="p">,</span>        
	<span class="s">&quot;sched_setscheduler&quot;</span><span class="p">,</span>    
	<span class="s">&quot;sched_getscheduler&quot;</span><span class="p">,</span>     <span class="cm">/* 340 */</span>
	<span class="s">&quot;sched_yield&quot;</span><span class="p">,</span>           
	<span class="s">&quot;sched_get_priority_max&quot;</span><span class="p">,</span>
	<span class="s">&quot;sched_get_priority_min&quot;</span><span class="p">,</span>
	<span class="s">&quot;sched_rr_get_interval&quot;</span><span class="p">,</span> 
	<span class="s">&quot;clock_settime&quot;</span><span class="p">,</span>          <span class="cm">/* 345 */</span>
	<span class="s">&quot;clock_gettime&quot;</span><span class="p">,</span>         
	<span class="s">&quot;clock_getres&quot;</span><span class="p">,</span>          
	<span class="s">&quot;timer_create&quot;</span><span class="p">,</span>          
	<span class="s">&quot;timer_delete&quot;</span><span class="p">,</span>          
	<span class="s">&quot;timer_settime&quot;</span><span class="p">,</span>          <span class="cm">/* 350 */</span>
	<span class="s">&quot;timer_gettime&quot;</span><span class="p">,</span>         
	<span class="s">&quot;timer_getoverrun&quot;</span><span class="p">,</span>      
	<span class="s">&quot;nanosleep&quot;</span><span class="p">,</span>             
	<span class="s">&quot;toolbox&quot;</span><span class="p">,</span>               
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 355 */</span>
	<span class="s">&quot;getdents&quot;</span><span class="p">,</span>              
	<span class="s">&quot;getcontext&quot;</span><span class="p">,</span>            
	<span class="s">&quot;sysinfo&quot;</span><span class="p">,</span>               
	<span class="s">&quot;fcntl64&quot;</span><span class="p">,</span>               
	<span class="s">&quot;ftruncate64&quot;</span><span class="p">,</span>            <span class="cm">/* 360 */</span>
	<span class="s">&quot;fstat64&quot;</span><span class="p">,</span>               
	<span class="s">&quot;getdirentries64&quot;</span><span class="p">,</span>       
	<span class="s">&quot;getrlimit64&quot;</span><span class="p">,</span>           
	<span class="s">&quot;lockf64&quot;</span><span class="p">,</span>               
	<span class="s">&quot;lseek64&quot;</span><span class="p">,</span>                <span class="cm">/* 365 */</span>
	<span class="s">&quot;lstat64&quot;</span><span class="p">,</span>               
	<span class="s">&quot;mmap64&quot;</span><span class="p">,</span>                
	<span class="s">&quot;setrlimit64&quot;</span><span class="p">,</span>           
	<span class="s">&quot;stat64&quot;</span><span class="p">,</span>                
	<span class="s">&quot;truncate64&quot;</span><span class="p">,</span>             <span class="cm">/* 370 */</span>
	<span class="s">&quot;ulimit64&quot;</span><span class="p">,</span>              
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                     <span class="cm">/* 375 */</span>
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="nb">NULL</span><span class="p">,</span>                    
	<span class="s">&quot;setcontext&quot;</span><span class="p">,</span>             <span class="cm">/* 380 */</span>
	<span class="s">&quot;sigaltstack&quot;</span><span class="p">,</span>           
	<span class="s">&quot;waitid&quot;</span><span class="p">,</span>                
	<span class="s">&quot;setpgrp&quot;</span><span class="p">,</span>               
	<span class="s">&quot;recvmsg2&quot;</span><span class="p">,</span>              
	<span class="s">&quot;sendmsg2&quot;</span><span class="p">,</span>               <span class="cm">/* 385 */</span>
	<span class="s">&quot;socket2&quot;</span><span class="p">,</span>               
	<span class="s">&quot;socketpair2&quot;</span><span class="p">,</span>           
	<span class="s">&quot;setregid&quot;</span><span class="p">,</span>              
	<span class="s">&quot;lwp_create&quot;</span><span class="p">,</span>            
	<span class="s">&quot;lwp_terminate&quot;</span><span class="p">,</span>          <span class="cm">/* 390 */</span>
	<span class="s">&quot;lwp_wait&quot;</span><span class="p">,</span>              
	<span class="s">&quot;lwp_suspend&quot;</span><span class="p">,</span>           
	<span class="s">&quot;lwp_resume&quot;</span><span class="p">,</span>            
	<span class="s">&quot;lwp_self&quot;</span><span class="p">,</span>              
	<span class="s">&quot;lwp_abort_syscall&quot;</span><span class="p">,</span>      <span class="cm">/* 395 */</span>
	<span class="s">&quot;lwp_info&quot;</span><span class="p">,</span>              
	<span class="s">&quot;lwp_kill&quot;</span><span class="p">,</span>              
	<span class="s">&quot;ksleep&quot;</span><span class="p">,</span>                
	<span class="s">&quot;kwakeup&quot;</span><span class="p">,</span>               
	<span class="s">&quot;ksleep_abort&quot;</span><span class="p">,</span>           <span class="cm">/* 400 */</span>
	<span class="s">&quot;lwp_proc_info&quot;</span><span class="p">,</span>         
	<span class="s">&quot;lwp_exit&quot;</span><span class="p">,</span>              
	<span class="s">&quot;lwp_continue&quot;</span><span class="p">,</span>          
	<span class="s">&quot;getacl&quot;</span><span class="p">,</span>                
	<span class="s">&quot;fgetacl&quot;</span><span class="p">,</span>                <span class="cm">/* 405 */</span>
	<span class="s">&quot;setacl&quot;</span><span class="p">,</span>                
	<span class="s">&quot;fsetacl&quot;</span><span class="p">,</span>               
	<span class="s">&quot;getaccess&quot;</span><span class="p">,</span>             
	<span class="s">&quot;lwp_mutex_init&quot;</span><span class="p">,</span>        
	<span class="s">&quot;lwp_mutex_lock_sys&quot;</span><span class="p">,</span>     <span class="cm">/* 410 */</span>
	<span class="s">&quot;lwp_mutex_unlock&quot;</span><span class="p">,</span>      
	<span class="s">&quot;lwp_cond_init&quot;</span><span class="p">,</span>         
	<span class="s">&quot;lwp_cond_signal&quot;</span><span class="p">,</span>       
	<span class="s">&quot;lwp_cond_broadcast&quot;</span><span class="p">,</span>    
	<span class="s">&quot;lwp_cond_wait_sys&quot;</span><span class="p">,</span>      <span class="cm">/* 415 */</span>
	<span class="s">&quot;lwp_getscheduler&quot;</span><span class="p">,</span>      
	<span class="s">&quot;lwp_setscheduler&quot;</span><span class="p">,</span>      
	<span class="s">&quot;lwp_getprivate&quot;</span><span class="p">,</span>        
	<span class="s">&quot;lwp_setprivate&quot;</span><span class="p">,</span>        
	<span class="s">&quot;lwp_detach&quot;</span><span class="p">,</span>             <span class="cm">/* 420 */</span>
	<span class="s">&quot;mlock&quot;</span><span class="p">,</span>                 
	<span class="s">&quot;munlock&quot;</span><span class="p">,</span>               
	<span class="s">&quot;mlockall&quot;</span><span class="p">,</span>              
	<span class="s">&quot;munlockall&quot;</span><span class="p">,</span>            
	<span class="s">&quot;shm_open&quot;</span><span class="p">,</span>               <span class="cm">/* 425 */</span>
	<span class="s">&quot;shm_unlink&quot;</span><span class="p">,</span>            
	<span class="s">&quot;sigqueue&quot;</span><span class="p">,</span>              
	<span class="s">&quot;sigwaitinfo&quot;</span><span class="p">,</span>           
	<span class="s">&quot;sigtimedwait&quot;</span><span class="p">,</span>          
	<span class="s">&quot;sigwait&quot;</span><span class="p">,</span>                <span class="cm">/* 430 */</span>
	<span class="s">&quot;aio_read&quot;</span><span class="p">,</span>              
	<span class="s">&quot;aio_write&quot;</span><span class="p">,</span>             
	<span class="s">&quot;lio_listio&quot;</span><span class="p">,</span>            
	<span class="s">&quot;aio_error&quot;</span><span class="p">,</span>             
	<span class="s">&quot;aio_return&quot;</span><span class="p">,</span>             <span class="cm">/* 435 */</span>
	<span class="s">&quot;aio_cancel&quot;</span><span class="p">,</span>            
	<span class="s">&quot;aio_suspend&quot;</span><span class="p">,</span>           
	<span class="s">&quot;aio_fsync&quot;</span><span class="p">,</span>             
	<span class="s">&quot;mq_open&quot;</span><span class="p">,</span>               
	<span class="s">&quot;mq_unlink&quot;</span><span class="p">,</span>              <span class="cm">/* 440 */</span>
	<span class="s">&quot;mq_send&quot;</span><span class="p">,</span>               
	<span class="s">&quot;mq_receive&quot;</span><span class="p">,</span>            
	<span class="s">&quot;mq_notify&quot;</span><span class="p">,</span>             
	<span class="s">&quot;mq_setattr&quot;</span><span class="p">,</span>            
	<span class="s">&quot;mq_getattr&quot;</span><span class="p">,</span>             <span class="cm">/* 445 */</span>
	<span class="s">&quot;ksem_open&quot;</span><span class="p">,</span>             
	<span class="s">&quot;ksem_unlink&quot;</span><span class="p">,</span>           
	<span class="s">&quot;ksem_close&quot;</span><span class="p">,</span>            
	<span class="s">&quot;ksem_destroy&quot;</span><span class="p">,</span>          
	<span class="s">&quot;lw_sem_incr&quot;</span><span class="p">,</span>            <span class="cm">/* 450 */</span>
	<span class="s">&quot;lw_sem_decr&quot;</span><span class="p">,</span>           
	<span class="s">&quot;lw_sem_read&quot;</span><span class="p">,</span>           
	<span class="s">&quot;mq_close&quot;</span><span class="p">,</span>              
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">syscall_names_max</span> <span class="o">=</span> <span class="mi">453</span><span class="p">;</span>

<span class="kt">int</span>
<span class="nf">hpux_unimplemented</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg1</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg2</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg3</span><span class="p">,</span>
		   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg4</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg5</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg6</span><span class="p">,</span>
		   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">arg7</span><span class="p">,</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sc_num</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* NOTE: sc_num trashes arg8 for the few syscalls that actually</span>
<span class="cm">	 * have a valid 8th argument.</span>
<span class="cm">	 */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span> <span class="n">sc_num</span> <span class="o">&lt;=</span> <span class="n">syscall_names_max</span> <span class="o">&amp;&amp;</span> <span class="n">sc_num</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">syscall_names</span><span class="p">[</span><span class="n">sc_num</span><span class="p">];</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span> <span class="n">name</span> <span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;Unimplemented HP-UX syscall emulation. Syscall #%lu (%s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">sc_num</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;Unimplemented unknown HP-UX syscall emulation. Syscall #%lu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">sc_num</span><span class="p">);</span>
	<span class="p">}</span>
	
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;  Args: %lx %lx %lx %lx %lx %lx %lx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">,</span> <span class="n">arg4</span><span class="p">,</span> <span class="n">arg5</span><span class="p">,</span> <span class="n">arg6</span><span class="p">,</span> <span class="n">arg7</span><span class="p">);</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">ENOSYS</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
