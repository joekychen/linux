<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › s390 › oprofile › hwsampler.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>hwsampler.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * CPUMF HW sampler functions and internal structures</span>
<span class="cm"> *</span>
<span class="cm"> *    Copyright IBM Corp. 2010</span>
<span class="cm"> *    Author(s): Heinz Graalfs &lt;graalfs@de.ibm.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef HWSAMPLER_H_</span>
<span class="cp">#define HWSAMPLER_H_</span>

<span class="cp">#include &lt;linux/workqueue.h&gt;</span>

<span class="k">struct</span> <span class="n">hws_qsi_info_block</span>          <span class="cm">/* QUERY SAMPLING information block  */</span>
<span class="p">{</span> <span class="cm">/* Bit(s) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">b0_13</span><span class="o">:</span><span class="mi">14</span><span class="p">;</span>      <span class="cm">/* 0-13: zeros                       */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">as</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>          <span class="cm">/* 14: sampling authorisation control*/</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">b15_21</span><span class="o">:</span><span class="mi">7</span><span class="p">;</span>      <span class="cm">/* 15-21: zeros                      */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">es</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>          <span class="cm">/* 22: sampling enable control       */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">b23_29</span><span class="o">:</span><span class="mi">7</span><span class="p">;</span>      <span class="cm">/* 23-29: zeros                      */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cs</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>          <span class="cm">/* 30: sampling activation control   */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>             <span class="cm">/* 31: reserved                      */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bsdes</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>      <span class="cm">/* 4-5: size of sampling entry       */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>            <span class="cm">/* 6-7: reserved                     */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">min_sampl_rate</span><span class="p">;</span> <span class="cm">/* 8-15: minimum sampling interval */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">max_sampl_rate</span><span class="p">;</span> <span class="cm">/* 16-23: maximum sampling interval*/</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tear</span><span class="p">;</span>         <span class="cm">/* 24-31: TEAR contents              */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dear</span><span class="p">;</span>         <span class="cm">/* 32-39: DEAR contents              */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rsvrd0</span><span class="p">;</span>        <span class="cm">/* 40-43: reserved                   */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cpu_speed</span><span class="p">;</span>     <span class="cm">/* 44-47: CPU speed                  */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">rsvrd1</span><span class="p">;</span>  <span class="cm">/* 48-55: reserved                   */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">rsvrd2</span><span class="p">;</span>  <span class="cm">/* 56-63: reserved                   */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hws_ssctl_request_block</span>     <span class="cm">/* SET SAMPLING CONTROLS req block   */</span>
<span class="p">{</span> <span class="cm">/* bytes 0 - 7  Bit(s) */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">s</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>           <span class="cm">/* 0: maximum buffer indicator       */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">h</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>           <span class="cm">/* 1: part. level reserved for VM use*/</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">b2_53</span><span class="o">:</span><span class="mi">52</span><span class="p">;</span>     <span class="cm">/* 2-53: zeros                       */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">es</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>          <span class="cm">/* 54: sampling enable control       */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">b55_61</span><span class="o">:</span><span class="mi">7</span><span class="p">;</span>      <span class="cm">/* 55-61: - zeros                    */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cs</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>          <span class="cm">/* 62: sampling activation control   */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">b63</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>         <span class="cm">/* 63: zero                          */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">interval</span><span class="p">;</span>     <span class="cm">/* 8-15: sampling interval           */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tear</span><span class="p">;</span>         <span class="cm">/* 16-23: TEAR contents              */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dear</span><span class="p">;</span>         <span class="cm">/* 24-31: DEAR contents              */</span>
	<span class="cm">/* 32-63:                                                        */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rsvrd1</span><span class="p">;</span>       <span class="cm">/* reserved                          */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rsvrd2</span><span class="p">;</span>       <span class="cm">/* reserved                          */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rsvrd3</span><span class="p">;</span>       <span class="cm">/* reserved                          */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rsvrd4</span><span class="p">;</span>       <span class="cm">/* reserved                          */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hws_cpu_buffer</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">first_sdbt</span><span class="p">;</span>       <span class="cm">/* @ of 1st SDB-Table for this CP*/</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">worker_entry</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sample_overflow</span><span class="p">;</span>  <span class="cm">/* taken from SDB ...            */</span>
	<span class="k">struct</span> <span class="n">hws_qsi_info_block</span> <span class="n">qsi</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hws_ssctl_request_block</span> <span class="n">ssctl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">worker</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">ext_params</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">req_alert</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">loss_of_sample_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">invalid_entry_address</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">incorrect_sdbt_entry</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sample_auth_change_alert</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">finish</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">oom</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">stop_mode</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hws_data_entry</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">def</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>        <span class="cm">/* 0-15  Data Entry Format           */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">R</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>           <span class="cm">/* 16-19 reserved                    */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">U</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>           <span class="cm">/* 20-23 Number of unique instruct.  */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">z</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>           <span class="cm">/* zeros                             */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">T</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>           <span class="cm">/* 26 PSW DAT mode                   */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">W</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>           <span class="cm">/* 27 PSW wait state                 */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">P</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>           <span class="cm">/* 28 PSW Problem state              */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">AS</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>          <span class="cm">/* 29-30 PSW address-space control   */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">I</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>           <span class="cm">/* 31 entry valid or invalid         */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">prim_asn</span><span class="o">:</span><span class="mi">16</span><span class="p">;</span>   <span class="cm">/* primary ASN                       */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">ia</span><span class="p">;</span>      <span class="cm">/* Instruction Address               */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">lpp</span><span class="p">;</span>     <span class="cm">/* Logical-Partition Program Param.  */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">vpp</span><span class="p">;</span>     <span class="cm">/* Virtual-Machine Program Param.    */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hws_trailer_entry</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">f</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>           <span class="cm">/* 0 - Block Full Indicator          */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>           <span class="cm">/* 1 - Alert request control         */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span><span class="o">:</span><span class="mi">62</span><span class="p">;</span>           <span class="cm">/* 2 - 63: Reserved                  */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">overflow</span><span class="p">;</span>     <span class="cm">/* 64 - sample Overflow count        */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">timestamp</span><span class="p">;</span>    <span class="cm">/* 16 - time-stamp                   */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">timestamp1</span><span class="p">;</span>   <span class="cm">/*                                   */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reserved1</span><span class="p">;</span>    <span class="cm">/* 32 -Reserved                      */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reserved2</span><span class="p">;</span>    <span class="cm">/*                                   */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">progusage1</span><span class="p">;</span>   <span class="cm">/* 48 - reserved for programming use */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">progusage2</span><span class="p">;</span>   <span class="cm">/*                                   */</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">hwsampler_setup</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hwsampler_shutdown</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hwsampler_allocate</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sdbt</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sdb</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hwsampler_deallocate</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">hwsampler_query_min_interval</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">hwsampler_query_max_interval</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hwsampler_start_all</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">interval</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hwsampler_stop_all</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hwsampler_deactivate</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cpu</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">hwsampler_activate</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cpu</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">hwsampler_get_sample_overflow_count</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cpu</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/*HWSAMPLER_H_*/</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
