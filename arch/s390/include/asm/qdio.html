<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › s390 › include › asm › qdio.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>qdio.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * linux/include/asm-s390/qdio.h</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2000,2008 IBM Corp.</span>
<span class="cm"> * Author(s): Utz Bacher &lt;utz.bacher@de.ibm.com&gt;</span>
<span class="cm"> *	      Jan Glauber &lt;jang@linux.vnet.ibm.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __QDIO_H__</span>
<span class="cp">#define __QDIO_H__</span>

<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;asm/cio.h&gt;</span>
<span class="cp">#include &lt;asm/ccwdev.h&gt;</span>

<span class="cm">/* only use 4 queues to save some cachelines */</span>
<span class="cp">#define QDIO_MAX_QUEUES_PER_IRQ		4</span>
<span class="cp">#define QDIO_MAX_BUFFERS_PER_Q		128</span>
<span class="cp">#define QDIO_MAX_BUFFERS_MASK		(QDIO_MAX_BUFFERS_PER_Q - 1)</span>
<span class="cp">#define QDIO_MAX_ELEMENTS_PER_BUFFER	16</span>
<span class="cp">#define QDIO_SBAL_SIZE			256</span>

<span class="cp">#define QDIO_QETH_QFMT			0</span>
<span class="cp">#define QDIO_ZFCP_QFMT			1</span>
<span class="cp">#define QDIO_IQDIO_QFMT			2</span>

<span class="cm">/**</span>
<span class="cm"> * struct qdesfmt0 - queue descriptor, format 0</span>
<span class="cm"> * @sliba: storage list information block address</span>
<span class="cm"> * @sla: storage list address</span>
<span class="cm"> * @slsba: storage list state block address</span>
<span class="cm"> * @akey: access key for DLIB</span>
<span class="cm"> * @bkey: access key for SL</span>
<span class="cm"> * @ckey: access key for SBALs</span>
<span class="cm"> * @dkey: access key for SLSB</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qdesfmt0</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">sliba</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">sla</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">slsba</span><span class="p">;</span>
	<span class="n">u32</span>	 <span class="o">:</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">akey</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bkey</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ckey</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">dkey</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">u32</span>	 <span class="o">:</span> <span class="mi">16</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cp">#define QDR_AC_MULTI_BUFFER_ENABLE 0x01</span>

<span class="cm">/**</span>
<span class="cm"> * struct qdr - queue description record (QDR)</span>
<span class="cm"> * @qfmt: queue format</span>
<span class="cm"> * @pfmt: implementation dependent parameter format</span>
<span class="cm"> * @ac: adapter characteristics</span>
<span class="cm"> * @iqdcnt: input queue descriptor count</span>
<span class="cm"> * @oqdcnt: output queue descriptor count</span>
<span class="cm"> * @iqdsz: inpout queue descriptor size</span>
<span class="cm"> * @oqdsz: output queue descriptor size</span>
<span class="cm"> * @qiba: queue information block address</span>
<span class="cm"> * @qkey: queue information block key</span>
<span class="cm"> * @qdf0: queue descriptions</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qdr</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">qfmt</span>   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pfmt</span>   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span>	   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ac</span>	   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span>	   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">iqdcnt</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span>	   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">oqdcnt</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span>	   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">iqdsz</span>  <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span>	   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">oqdsz</span>  <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="cm">/* private: */</span>
	<span class="n">u32</span> <span class="n">res</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
	<span class="cm">/* public: */</span>
	<span class="n">u64</span> <span class="n">qiba</span><span class="p">;</span>
	<span class="n">u32</span>	   <span class="o">:</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">qkey</span>   <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">u32</span>	   <span class="o">:</span> <span class="mi">28</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qdesfmt0</span> <span class="n">qdf0</span><span class="p">[</span><span class="mi">126</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span><span class="p">(</span><span class="mi">4096</span><span class="p">)));</span>

<span class="cp">#define QIB_AC_OUTBOUND_PCI_SUPPORTED	0x40</span>
<span class="cp">#define QIB_RFLAGS_ENABLE_QEBSM		0x80</span>
<span class="cp">#define QIB_RFLAGS_ENABLE_DATA_DIV	0x02</span>

<span class="cm">/**</span>
<span class="cm"> * struct qib - queue information block (QIB)</span>
<span class="cm"> * @qfmt: queue format</span>
<span class="cm"> * @pfmt: implementation dependent parameter format</span>
<span class="cm"> * @rflags: QEBSM</span>
<span class="cm"> * @ac: adapter characteristics</span>
<span class="cm"> * @isliba: absolute address of first input SLIB</span>
<span class="cm"> * @osliba: absolute address of first output SLIB</span>
<span class="cm"> * @ebcnam: adapter identifier in EBCDIC</span>
<span class="cm"> * @parm: implementation dependent parameters</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qib</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">qfmt</span>   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pfmt</span>   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rflags</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ac</span>	   <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">u32</span>	   <span class="o">:</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">isliba</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">osliba</span><span class="p">;</span>
	<span class="n">u32</span>	   <span class="o">:</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">u32</span>	   <span class="o">:</span> <span class="mi">32</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ebcnam</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="cm">/* private: */</span>
	<span class="n">u8</span> <span class="n">res</span><span class="p">[</span><span class="mi">88</span><span class="p">];</span>
	<span class="cm">/* public: */</span>
	<span class="n">u8</span> <span class="n">parm</span><span class="p">[</span><span class="n">QDIO_MAX_BUFFERS_PER_Q</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span><span class="p">(</span><span class="mi">256</span><span class="p">)));</span>

<span class="cm">/**</span>
<span class="cm"> * struct slibe - storage list information block element (SLIBE)</span>
<span class="cm"> * @parms: implementation dependent parameters</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">slibe</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">parms</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct qaob - queue asynchronous operation block</span>
<span class="cm"> * @res0: reserved parameters</span>
<span class="cm"> * @res1: reserved parameter</span>
<span class="cm"> * @res2: reserved parameter</span>
<span class="cm"> * @res3: reserved parameter</span>
<span class="cm"> * @aorc: asynchronous operation return code</span>
<span class="cm"> * @flags: internal flags</span>
<span class="cm"> * @cbtbs: control block type</span>
<span class="cm"> * @sb_count: number of storage blocks</span>
<span class="cm"> * @sba: storage block element addresses</span>
<span class="cm"> * @dcount: size of storage block elements</span>
<span class="cm"> * @user0: user defineable value</span>
<span class="cm"> * @res4: reserved paramater</span>
<span class="cm"> * @user1: user defineable value</span>
<span class="cm"> * @user2: user defineable value</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qaob</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">res0</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">res1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">res2</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">res3</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">aorc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">cbtbs</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sb_count</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">sba</span><span class="p">[</span><span class="n">QDIO_MAX_ELEMENTS_PER_BUFFER</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">dcount</span><span class="p">[</span><span class="n">QDIO_MAX_ELEMENTS_PER_BUFFER</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">user0</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">res4</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">user1</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">user2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span><span class="p">(</span><span class="mi">256</span><span class="p">)));</span>

<span class="cm">/**</span>
<span class="cm"> * struct slib - storage list information block (SLIB)</span>
<span class="cm"> * @nsliba: next SLIB address (if any)</span>
<span class="cm"> * @sla: SL address</span>
<span class="cm"> * @slsba: SLSB address</span>
<span class="cm"> * @slibe: SLIB elements</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">slib</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">nsliba</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">sla</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">slsba</span><span class="p">;</span>
	<span class="cm">/* private: */</span>
	<span class="n">u8</span> <span class="n">res</span><span class="p">[</span><span class="mi">1000</span><span class="p">];</span>
	<span class="cm">/* public: */</span>
	<span class="k">struct</span> <span class="n">slibe</span> <span class="n">slibe</span><span class="p">[</span><span class="n">QDIO_MAX_BUFFERS_PER_Q</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span><span class="p">(</span><span class="mi">2048</span><span class="p">)));</span>

<span class="cp">#define SBAL_EFLAGS_LAST_ENTRY		0x40</span>
<span class="cp">#define SBAL_EFLAGS_CONTIGUOUS		0x20</span>
<span class="cp">#define SBAL_EFLAGS_FIRST_FRAG		0x04</span>
<span class="cp">#define SBAL_EFLAGS_MIDDLE_FRAG		0x08</span>
<span class="cp">#define SBAL_EFLAGS_LAST_FRAG		0x0c</span>
<span class="cp">#define SBAL_EFLAGS_MASK		0x6f</span>

<span class="cp">#define SBAL_SFLAGS0_PCI_REQ		0x40</span>
<span class="cp">#define SBAL_SFLAGS0_DATA_CONTINUATION	0x20</span>

<span class="cm">/* Awesome OpenFCP extensions */</span>
<span class="cp">#define SBAL_SFLAGS0_TYPE_STATUS	0x00</span>
<span class="cp">#define SBAL_SFLAGS0_TYPE_WRITE		0x08</span>
<span class="cp">#define SBAL_SFLAGS0_TYPE_READ		0x10</span>
<span class="cp">#define SBAL_SFLAGS0_TYPE_WRITE_READ	0x18</span>
<span class="cp">#define SBAL_SFLAGS0_MORE_SBALS		0x04</span>
<span class="cp">#define SBAL_SFLAGS0_COMMAND		0x02</span>
<span class="cp">#define SBAL_SFLAGS0_LAST_SBAL		0x00</span>
<span class="cp">#define SBAL_SFLAGS0_ONLY_SBAL		SBAL_SFLAGS0_COMMAND</span>
<span class="cp">#define SBAL_SFLAGS0_MIDDLE_SBAL	SBAL_SFLAGS0_MORE_SBALS</span>
<span class="cp">#define SBAL_SFLAGS0_FIRST_SBAL (SBAL_SFLAGS0_MORE_SBALS | SBAL_SFLAGS0_COMMAND)</span>

<span class="cm">/**</span>
<span class="cm"> * struct qdio_buffer_element - SBAL entry</span>
<span class="cm"> * @eflags: SBAL entry flags</span>
<span class="cm"> * @scount: SBAL count</span>
<span class="cm"> * @sflags: whole SBAL flags</span>
<span class="cm"> * @length: length</span>
<span class="cm"> * @addr: address</span>
<span class="cm">*/</span>
<span class="k">struct</span> <span class="n">qdio_buffer_element</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">eflags</span><span class="p">;</span>
	<span class="cm">/* private: */</span>
	<span class="n">u8</span> <span class="n">res1</span><span class="p">;</span>
	<span class="cm">/* public: */</span>
	<span class="n">u8</span> <span class="n">scount</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sflags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">length</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_32BIT</span>
	<span class="cm">/* private: */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">res2</span><span class="p">;</span>
	<span class="cm">/* public: */</span>
<span class="cp">#endif</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span><span class="p">(</span><span class="mi">16</span><span class="p">)));</span>

<span class="cm">/**</span>
<span class="cm"> * struct qdio_buffer - storage block address list (SBAL)</span>
<span class="cm"> * @element: SBAL entries</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qdio_buffer</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">qdio_buffer_element</span> <span class="n">element</span><span class="p">[</span><span class="n">QDIO_MAX_ELEMENTS_PER_BUFFER</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span><span class="p">(</span><span class="mi">256</span><span class="p">)));</span>

<span class="cm">/**</span>
<span class="cm"> * struct sl_element - storage list entry</span>
<span class="cm"> * @sbal: absolute SBAL address</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sl_element</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_32BIT</span>
	<span class="cm">/* private: */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="cm">/* public: */</span>
<span class="cp">#endif</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sbal</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cm">/**</span>
<span class="cm"> * struct sl - storage list (SL)</span>
<span class="cm"> * @element: SL entries</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sl</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">sl_element</span> <span class="n">element</span><span class="p">[</span><span class="n">QDIO_MAX_BUFFERS_PER_Q</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span><span class="p">(</span><span class="mi">1024</span><span class="p">)));</span>

<span class="cm">/**</span>
<span class="cm"> * struct slsb - storage list state block (SLSB)</span>
<span class="cm"> * @val: state per buffer</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">slsb</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">val</span><span class="p">[</span><span class="n">QDIO_MAX_BUFFERS_PER_Q</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">,</span> <span class="n">aligned</span><span class="p">(</span><span class="mi">256</span><span class="p">)));</span>

<span class="cm">/**</span>
<span class="cm"> * struct qdio_outbuf_state - SBAL related asynchronous operation information</span>
<span class="cm"> *   (for communication with upper layer programs)</span>
<span class="cm"> *   (only required for use with completion queues)</span>
<span class="cm"> * @flags: flags indicating state of buffer</span>
<span class="cm"> * @aob: pointer to QAOB used for the particular SBAL</span>
<span class="cm"> * @user: pointer to upper layer program&#39;s state information related to SBAL</span>
<span class="cm"> *        (stored in user1 data of QAOB)</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qdio_outbuf_state</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qaob</span> <span class="o">*</span><span class="n">aob</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">user</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define QDIO_OUTBUF_STATE_FLAG_NONE	0x00</span>
<span class="cp">#define QDIO_OUTBUF_STATE_FLAG_PENDING	0x01</span>

<span class="cp">#define CHSC_AC1_INITIATE_INPUTQ	0x80</span>


<span class="cm">/* qdio adapter-characteristics-1 flag */</span>
<span class="cp">#define AC1_SIGA_INPUT_NEEDED		0x40	</span><span class="cm">/* process input queues */</span><span class="cp"></span>
<span class="cp">#define AC1_SIGA_OUTPUT_NEEDED		0x20	</span><span class="cm">/* process output queues */</span><span class="cp"></span>
<span class="cp">#define AC1_SIGA_SYNC_NEEDED		0x10	</span><span class="cm">/* ask hypervisor to sync */</span><span class="cp"></span>
<span class="cp">#define AC1_AUTOMATIC_SYNC_ON_THININT	0x08	</span><span class="cm">/* set by hypervisor */</span><span class="cp"></span>
<span class="cp">#define AC1_AUTOMATIC_SYNC_ON_OUT_PCI	0x04	</span><span class="cm">/* set by hypervisor */</span><span class="cp"></span>
<span class="cp">#define AC1_SC_QEBSM_AVAILABLE		0x02	</span><span class="cm">/* available for subchannel */</span><span class="cp"></span>
<span class="cp">#define AC1_SC_QEBSM_ENABLED		0x01	</span><span class="cm">/* enabled for subchannel */</span><span class="cp"></span>

<span class="cp">#define CHSC_AC2_MULTI_BUFFER_AVAILABLE	0x0080</span>
<span class="cp">#define CHSC_AC2_MULTI_BUFFER_ENABLED	0x0040</span>
<span class="cp">#define CHSC_AC2_DATA_DIV_AVAILABLE	0x0010</span>
<span class="cp">#define CHSC_AC2_DATA_DIV_ENABLED	0x0002</span>

<span class="cp">#define CHSC_AC3_FORMAT2_CQ_AVAILABLE	0x8000</span>

<span class="k">struct</span> <span class="n">qdio_ssqd_desc</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>
	<span class="nl">u8:</span><span class="mi">8</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">sch</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">qfmt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">parm</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">qdioac1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sch_class</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pcnt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">icnt</span><span class="p">;</span>
	<span class="nl">u8:</span><span class="mi">8</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ocnt</span><span class="p">;</span>
	<span class="nl">u8:</span><span class="mi">8</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mbccnt</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">qdioac2</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">sch_token</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mro</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mri</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">qdioac3</span><span class="p">;</span>
	<span class="nl">u16:</span><span class="mi">16</span><span class="p">;</span>
	<span class="nl">u8:</span><span class="mi">8</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mmwc</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="cm">/* params are: ccw_device, qdio_error, queue_number,</span>
<span class="cm">   first element processed, number of elements processed, int_parm */</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="n">qdio_handler_t</span><span class="p">(</span><span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span>
			    <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>

<span class="cm">/* qdio errors reported to the upper-layer program */</span>
<span class="cp">#define QDIO_ERROR_ACTIVATE			0x0001</span>
<span class="cp">#define QDIO_ERROR_GET_BUF_STATE		0x0002</span>
<span class="cp">#define QDIO_ERROR_SET_BUF_STATE		0x0004</span>
<span class="cp">#define QDIO_ERROR_SLSB_STATE			0x0100</span>

<span class="cp">#define QDIO_ERROR_FATAL			0x00ff</span>
<span class="cp">#define QDIO_ERROR_TEMPORARY			0xff00</span>

<span class="cm">/* for qdio_cleanup */</span>
<span class="cp">#define QDIO_FLAG_CLEANUP_USING_CLEAR		0x01</span>
<span class="cp">#define QDIO_FLAG_CLEANUP_USING_HALT		0x02</span>

<span class="cm">/**</span>
<span class="cm"> * struct qdio_initialize - qdio initalization data</span>
<span class="cm"> * @cdev: associated ccw device</span>
<span class="cm"> * @q_format: queue format</span>
<span class="cm"> * @adapter_name: name for the adapter</span>
<span class="cm"> * @qib_param_field_format: format for qib_parm_field</span>
<span class="cm"> * @qib_param_field: pointer to 128 bytes or NULL, if no param field</span>
<span class="cm"> * @qib_rflags: rflags to set</span>
<span class="cm"> * @input_slib_elements: pointer to no_input_qs * 128 words of data or NULL</span>
<span class="cm"> * @output_slib_elements: pointer to no_output_qs * 128 words of data or NULL</span>
<span class="cm"> * @no_input_qs: number of input queues</span>
<span class="cm"> * @no_output_qs: number of output queues</span>
<span class="cm"> * @input_handler: handler to be called for input queues</span>
<span class="cm"> * @output_handler: handler to be called for output queues</span>
<span class="cm"> * @queue_start_poll_array: polling handlers (one per input queue or NULL)</span>
<span class="cm"> * @int_parm: interruption parameter</span>
<span class="cm"> * @input_sbal_addr_array:  address of no_input_qs * 128 pointers</span>
<span class="cm"> * @output_sbal_addr_array: address of no_output_qs * 128 pointers</span>
<span class="cm"> * @output_sbal_state_array: no_output_qs * 128 state info (for CQ or NULL)</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">qdio_initialize</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="n">cdev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">q_format</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">qdr_ac</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">adapter_name</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">qib_param_field_format</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">qib_param_field</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">qib_rflags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">input_slib_elements</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">output_slib_elements</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">no_input_qs</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">no_output_qs</span><span class="p">;</span>
	<span class="n">qdio_handler_t</span> <span class="o">*</span><span class="n">input_handler</span><span class="p">;</span>
	<span class="n">qdio_handler_t</span> <span class="o">*</span><span class="n">output_handler</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">**</span><span class="n">queue_start_poll_array</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span>
					  <span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">scan_threshold</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">int_parm</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">**</span><span class="n">input_sbal_addr_array</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">**</span><span class="n">output_sbal_addr_array</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">qdio_outbuf_state</span> <span class="o">*</span><span class="n">output_sbal_state_array</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define QDIO_STATE_INACTIVE		0x00000002 </span><span class="cm">/* after qdio_cleanup */</span><span class="cp"></span>
<span class="cp">#define QDIO_STATE_ESTABLISHED		0x00000004 </span><span class="cm">/* after qdio_establish */</span><span class="cp"></span>
<span class="cp">#define QDIO_STATE_ACTIVE		0x00000008 </span><span class="cm">/* after qdio_activate */</span><span class="cp"></span>
<span class="cp">#define QDIO_STATE_STOPPED		0x00000010 </span><span class="cm">/* after queues went down */</span><span class="cp"></span>

<span class="cp">#define QDIO_FLAG_SYNC_INPUT		0x01</span>
<span class="cp">#define QDIO_FLAG_SYNC_OUTPUT		0x02</span>
<span class="cp">#define QDIO_FLAG_PCI_OUT		0x10</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">qdio_allocate</span><span class="p">(</span><span class="k">struct</span> <span class="n">qdio_initialize</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">qdio_establish</span><span class="p">(</span><span class="k">struct</span> <span class="n">qdio_initialize</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">qdio_activate</span><span class="p">(</span><span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">qdio_release_aob</span><span class="p">(</span><span class="k">struct</span> <span class="n">qaob</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">do_QDIO</span><span class="p">(</span><span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span>
		   <span class="kt">unsigned</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">qdio_start_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">qdio_stop_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">qdio_get_next_buffers</span><span class="p">(</span><span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">qdio_shutdown</span><span class="p">(</span><span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">qdio_free</span><span class="p">(</span><span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">qdio_get_ssqd_desc</span><span class="p">(</span><span class="k">struct</span> <span class="n">ccw_device</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">qdio_ssqd_desc</span> <span class="o">*</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __QDIO_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
