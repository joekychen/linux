<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › s390 › include › asm › ptrace.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>ptrace.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  include/asm-s390/ptrace.h</span>
<span class="cm"> *</span>
<span class="cm"> *  S390 version</span>
<span class="cm"> *    Copyright (C) 1999,2000 IBM Deutschland Entwicklung GmbH, IBM Corporation</span>
<span class="cm"> *    Author(s): Denis Joseph Barrow (djbarrow@de.ibm.com,barrow_dj@yahoo.com)</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _S390_PTRACE_H</span>
<span class="cp">#define _S390_PTRACE_H</span>

<span class="cm">/*</span>
<span class="cm"> * Offsets in the user_regs_struct. They are used for the ptrace</span>
<span class="cm"> * system call and in entry.S</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __s390x__</span>

<span class="cp">#define PT_PSWMASK  0x00</span>
<span class="cp">#define PT_PSWADDR  0x04</span>
<span class="cp">#define PT_GPR0     0x08</span>
<span class="cp">#define PT_GPR1     0x0C</span>
<span class="cp">#define PT_GPR2     0x10</span>
<span class="cp">#define PT_GPR3     0x14</span>
<span class="cp">#define PT_GPR4     0x18</span>
<span class="cp">#define PT_GPR5     0x1C</span>
<span class="cp">#define PT_GPR6     0x20</span>
<span class="cp">#define PT_GPR7     0x24</span>
<span class="cp">#define PT_GPR8     0x28</span>
<span class="cp">#define PT_GPR9     0x2C</span>
<span class="cp">#define PT_GPR10    0x30</span>
<span class="cp">#define PT_GPR11    0x34</span>
<span class="cp">#define PT_GPR12    0x38</span>
<span class="cp">#define PT_GPR13    0x3C</span>
<span class="cp">#define PT_GPR14    0x40</span>
<span class="cp">#define PT_GPR15    0x44</span>
<span class="cp">#define PT_ACR0     0x48</span>
<span class="cp">#define PT_ACR1     0x4C</span>
<span class="cp">#define PT_ACR2     0x50</span>
<span class="cp">#define PT_ACR3     0x54</span>
<span class="cp">#define PT_ACR4	    0x58</span>
<span class="cp">#define PT_ACR5	    0x5C</span>
<span class="cp">#define PT_ACR6	    0x60</span>
<span class="cp">#define PT_ACR7	    0x64</span>
<span class="cp">#define PT_ACR8	    0x68</span>
<span class="cp">#define PT_ACR9	    0x6C</span>
<span class="cp">#define PT_ACR10    0x70</span>
<span class="cp">#define PT_ACR11    0x74</span>
<span class="cp">#define PT_ACR12    0x78</span>
<span class="cp">#define PT_ACR13    0x7C</span>
<span class="cp">#define PT_ACR14    0x80</span>
<span class="cp">#define PT_ACR15    0x84</span>
<span class="cp">#define PT_ORIGGPR2 0x88</span>
<span class="cp">#define PT_FPC	    0x90</span>
<span class="cm">/*</span>
<span class="cm"> * A nasty fact of life that the ptrace api</span>
<span class="cm"> * only supports passing of longs.</span>
<span class="cm"> */</span>
<span class="cp">#define PT_FPR0_HI  0x98</span>
<span class="cp">#define PT_FPR0_LO  0x9C</span>
<span class="cp">#define PT_FPR1_HI  0xA0</span>
<span class="cp">#define PT_FPR1_LO  0xA4</span>
<span class="cp">#define PT_FPR2_HI  0xA8</span>
<span class="cp">#define PT_FPR2_LO  0xAC</span>
<span class="cp">#define PT_FPR3_HI  0xB0</span>
<span class="cp">#define PT_FPR3_LO  0xB4</span>
<span class="cp">#define PT_FPR4_HI  0xB8</span>
<span class="cp">#define PT_FPR4_LO  0xBC</span>
<span class="cp">#define PT_FPR5_HI  0xC0</span>
<span class="cp">#define PT_FPR5_LO  0xC4</span>
<span class="cp">#define PT_FPR6_HI  0xC8</span>
<span class="cp">#define PT_FPR6_LO  0xCC</span>
<span class="cp">#define PT_FPR7_HI  0xD0</span>
<span class="cp">#define PT_FPR7_LO  0xD4</span>
<span class="cp">#define PT_FPR8_HI  0xD8</span>
<span class="cp">#define PT_FPR8_LO  0XDC</span>
<span class="cp">#define PT_FPR9_HI  0xE0</span>
<span class="cp">#define PT_FPR9_LO  0xE4</span>
<span class="cp">#define PT_FPR10_HI 0xE8</span>
<span class="cp">#define PT_FPR10_LO 0xEC</span>
<span class="cp">#define PT_FPR11_HI 0xF0</span>
<span class="cp">#define PT_FPR11_LO 0xF4</span>
<span class="cp">#define PT_FPR12_HI 0xF8</span>
<span class="cp">#define PT_FPR12_LO 0xFC</span>
<span class="cp">#define PT_FPR13_HI 0x100</span>
<span class="cp">#define PT_FPR13_LO 0x104</span>
<span class="cp">#define PT_FPR14_HI 0x108</span>
<span class="cp">#define PT_FPR14_LO 0x10C</span>
<span class="cp">#define PT_FPR15_HI 0x110</span>
<span class="cp">#define PT_FPR15_LO 0x114</span>
<span class="cp">#define PT_CR_9	    0x118</span>
<span class="cp">#define PT_CR_10    0x11C</span>
<span class="cp">#define PT_CR_11    0x120</span>
<span class="cp">#define PT_IEEE_IP  0x13C</span>
<span class="cp">#define PT_LASTOFF  PT_IEEE_IP</span>
<span class="cp">#define PT_ENDREGS  0x140-1</span>

<span class="cp">#define GPR_SIZE	4</span>
<span class="cp">#define CR_SIZE		4</span>

<span class="cp">#define STACK_FRAME_OVERHEAD	96	</span><span class="cm">/* size of minimum stack frame */</span><span class="cp"></span>

<span class="cp">#else </span><span class="cm">/* __s390x__ */</span><span class="cp"></span>

<span class="cp">#define PT_PSWMASK  0x00</span>
<span class="cp">#define PT_PSWADDR  0x08</span>
<span class="cp">#define PT_GPR0     0x10</span>
<span class="cp">#define PT_GPR1     0x18</span>
<span class="cp">#define PT_GPR2     0x20</span>
<span class="cp">#define PT_GPR3     0x28</span>
<span class="cp">#define PT_GPR4     0x30</span>
<span class="cp">#define PT_GPR5     0x38</span>
<span class="cp">#define PT_GPR6     0x40</span>
<span class="cp">#define PT_GPR7     0x48</span>
<span class="cp">#define PT_GPR8     0x50</span>
<span class="cp">#define PT_GPR9     0x58</span>
<span class="cp">#define PT_GPR10    0x60</span>
<span class="cp">#define PT_GPR11    0x68</span>
<span class="cp">#define PT_GPR12    0x70</span>
<span class="cp">#define PT_GPR13    0x78</span>
<span class="cp">#define PT_GPR14    0x80</span>
<span class="cp">#define PT_GPR15    0x88</span>
<span class="cp">#define PT_ACR0     0x90</span>
<span class="cp">#define PT_ACR1     0x94</span>
<span class="cp">#define PT_ACR2     0x98</span>
<span class="cp">#define PT_ACR3     0x9C</span>
<span class="cp">#define PT_ACR4	    0xA0</span>
<span class="cp">#define PT_ACR5	    0xA4</span>
<span class="cp">#define PT_ACR6	    0xA8</span>
<span class="cp">#define PT_ACR7	    0xAC</span>
<span class="cp">#define PT_ACR8	    0xB0</span>
<span class="cp">#define PT_ACR9	    0xB4</span>
<span class="cp">#define PT_ACR10    0xB8</span>
<span class="cp">#define PT_ACR11    0xBC</span>
<span class="cp">#define PT_ACR12    0xC0</span>
<span class="cp">#define PT_ACR13    0xC4</span>
<span class="cp">#define PT_ACR14    0xC8</span>
<span class="cp">#define PT_ACR15    0xCC</span>
<span class="cp">#define PT_ORIGGPR2 0xD0</span>
<span class="cp">#define PT_FPC	    0xD8</span>
<span class="cp">#define PT_FPR0     0xE0</span>
<span class="cp">#define PT_FPR1     0xE8</span>
<span class="cp">#define PT_FPR2     0xF0</span>
<span class="cp">#define PT_FPR3     0xF8</span>
<span class="cp">#define PT_FPR4     0x100</span>
<span class="cp">#define PT_FPR5     0x108</span>
<span class="cp">#define PT_FPR6     0x110</span>
<span class="cp">#define PT_FPR7     0x118</span>
<span class="cp">#define PT_FPR8     0x120</span>
<span class="cp">#define PT_FPR9     0x128</span>
<span class="cp">#define PT_FPR10    0x130</span>
<span class="cp">#define PT_FPR11    0x138</span>
<span class="cp">#define PT_FPR12    0x140</span>
<span class="cp">#define PT_FPR13    0x148</span>
<span class="cp">#define PT_FPR14    0x150</span>
<span class="cp">#define PT_FPR15    0x158</span>
<span class="cp">#define PT_CR_9     0x160</span>
<span class="cp">#define PT_CR_10    0x168</span>
<span class="cp">#define PT_CR_11    0x170</span>
<span class="cp">#define PT_IEEE_IP  0x1A8</span>
<span class="cp">#define PT_LASTOFF  PT_IEEE_IP</span>
<span class="cp">#define PT_ENDREGS  0x1B0-1</span>

<span class="cp">#define GPR_SIZE	8</span>
<span class="cp">#define CR_SIZE		8</span>

<span class="cp">#define STACK_FRAME_OVERHEAD    160      </span><span class="cm">/* size of minimum stack frame */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __s390x__ */</span><span class="cp"></span>

<span class="cp">#define NUM_GPRS	16</span>
<span class="cp">#define NUM_FPRS	16</span>
<span class="cp">#define NUM_CRS		16</span>
<span class="cp">#define NUM_ACRS	16</span>

<span class="cp">#define NUM_CR_WORDS	3</span>

<span class="cp">#define FPR_SIZE	8</span>
<span class="cp">#define FPC_SIZE	4</span>
<span class="cp">#define FPC_PAD_SIZE	4 </span><span class="cm">/* gcc insists on aligning the fpregs */</span><span class="cp"></span>
<span class="cp">#define ACR_SIZE	4</span>


<span class="cp">#define PTRACE_OLDSETOPTIONS         21</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="cp">#include &lt;linux/stddef.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="k">typedef</span> <span class="k">union</span>
<span class="p">{</span>
	<span class="kt">float</span>   <span class="n">f</span><span class="p">;</span>
	<span class="kt">double</span>  <span class="n">d</span><span class="p">;</span>
        <span class="n">__u64</span>   <span class="n">ui</span><span class="p">;</span>
	<span class="k">struct</span>
	<span class="p">{</span>
		<span class="n">__u32</span> <span class="n">hi</span><span class="p">;</span>
		<span class="n">__u32</span> <span class="n">lo</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">fp</span><span class="p">;</span>
<span class="p">}</span> <span class="n">freg_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="n">__u32</span>   <span class="n">fpc</span><span class="p">;</span>
	<span class="n">freg_t</span>  <span class="n">fprs</span><span class="p">[</span><span class="n">NUM_FPRS</span><span class="p">];</span>              
<span class="p">}</span> <span class="n">s390_fp_regs</span><span class="p">;</span>

<span class="cp">#define FPC_EXCEPTION_MASK      0xF8000000</span>
<span class="cp">#define FPC_FLAGS_MASK          0x00F80000</span>
<span class="cp">#define FPC_DXC_MASK            0x0000FF00</span>
<span class="cp">#define FPC_RM_MASK             0x00000003</span>
<span class="cp">#define FPC_VALID_MASK          0xF8F8FF03</span>

<span class="cm">/* this typedef defines how a Program Status Word looks like */</span>
<span class="k">typedef</span> <span class="k">struct</span> 
<span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mask</span><span class="p">;</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span> <span class="n">psw_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="n">__u32</span>	<span class="n">mask</span><span class="p">;</span>
	<span class="n">__u32</span>	<span class="n">addr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span> <span class="n">psw_compat_t</span><span class="p">;</span>

<span class="cp">#ifndef __s390x__</span>

<span class="cp">#define PSW_MASK_PER		0x40000000UL</span>
<span class="cp">#define PSW_MASK_DAT		0x04000000UL</span>
<span class="cp">#define PSW_MASK_IO		0x02000000UL</span>
<span class="cp">#define PSW_MASK_EXT		0x01000000UL</span>
<span class="cp">#define PSW_MASK_KEY		0x00F00000UL</span>
<span class="cp">#define PSW_MASK_BASE		0x00080000UL	</span><span class="cm">/* always one */</span><span class="cp"></span>
<span class="cp">#define PSW_MASK_MCHECK		0x00040000UL</span>
<span class="cp">#define PSW_MASK_WAIT		0x00020000UL</span>
<span class="cp">#define PSW_MASK_PSTATE		0x00010000UL</span>
<span class="cp">#define PSW_MASK_ASC		0x0000C000UL</span>
<span class="cp">#define PSW_MASK_CC		0x00003000UL</span>
<span class="cp">#define PSW_MASK_PM		0x00000F00UL</span>
<span class="cp">#define PSW_MASK_EA		0x00000000UL</span>
<span class="cp">#define PSW_MASK_BA		0x00000000UL</span>

<span class="cp">#define PSW_MASK_USER		0x00003F00UL</span>

<span class="cp">#define PSW_ADDR_AMODE		0x80000000UL</span>
<span class="cp">#define PSW_ADDR_INSN		0x7FFFFFFFUL</span>

<span class="cp">#define PSW_DEFAULT_KEY		(((unsigned long) PAGE_DEFAULT_ACC) &lt;&lt; 20)</span>

<span class="cp">#define PSW_ASC_PRIMARY		0x00000000UL</span>
<span class="cp">#define PSW_ASC_ACCREG		0x00004000UL</span>
<span class="cp">#define PSW_ASC_SECONDARY	0x00008000UL</span>
<span class="cp">#define PSW_ASC_HOME		0x0000C000UL</span>

<span class="cp">#else </span><span class="cm">/* __s390x__ */</span><span class="cp"></span>

<span class="cp">#define PSW_MASK_PER		0x4000000000000000UL</span>
<span class="cp">#define PSW_MASK_DAT		0x0400000000000000UL</span>
<span class="cp">#define PSW_MASK_IO		0x0200000000000000UL</span>
<span class="cp">#define PSW_MASK_EXT		0x0100000000000000UL</span>
<span class="cp">#define PSW_MASK_BASE		0x0000000000000000UL</span>
<span class="cp">#define PSW_MASK_KEY		0x00F0000000000000UL</span>
<span class="cp">#define PSW_MASK_MCHECK		0x0004000000000000UL</span>
<span class="cp">#define PSW_MASK_WAIT		0x0002000000000000UL</span>
<span class="cp">#define PSW_MASK_PSTATE		0x0001000000000000UL</span>
<span class="cp">#define PSW_MASK_ASC		0x0000C00000000000UL</span>
<span class="cp">#define PSW_MASK_CC		0x0000300000000000UL</span>
<span class="cp">#define PSW_MASK_PM		0x00000F0000000000UL</span>
<span class="cp">#define PSW_MASK_EA		0x0000000100000000UL</span>
<span class="cp">#define PSW_MASK_BA		0x0000000080000000UL</span>

<span class="cp">#define PSW_MASK_USER		0x00003F0180000000UL</span>

<span class="cp">#define PSW_ADDR_AMODE		0x0000000000000000UL</span>
<span class="cp">#define PSW_ADDR_INSN		0xFFFFFFFFFFFFFFFFUL</span>

<span class="cp">#define PSW_DEFAULT_KEY		(((unsigned long) PAGE_DEFAULT_ACC) &lt;&lt; 52)</span>

<span class="cp">#define PSW_ASC_PRIMARY		0x0000000000000000UL</span>
<span class="cp">#define PSW_ASC_ACCREG		0x0000400000000000UL</span>
<span class="cp">#define PSW_ASC_SECONDARY	0x0000800000000000UL</span>
<span class="cp">#define PSW_ASC_HOME		0x0000C00000000000UL</span>

<span class="cp">#endif </span><span class="cm">/* __s390x__ */</span><span class="cp"></span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="k">extern</span> <span class="kt">long</span> <span class="n">psw_kernel_bits</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">long</span> <span class="n">psw_user_bits</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * The s390_regs structure is used to define the elf_gregset_t.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="n">psw_t</span> <span class="n">psw</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gprs</span><span class="p">[</span><span class="n">NUM_GPRS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">acrs</span><span class="p">[</span><span class="n">NUM_ACRS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">orig_gpr2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">s390_regs</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="n">psw_compat_t</span>	<span class="n">psw</span><span class="p">;</span>
	<span class="n">__u32</span>		<span class="n">gprs</span><span class="p">[</span><span class="n">NUM_GPRS</span><span class="p">];</span>
	<span class="n">__u32</span>		<span class="n">acrs</span><span class="p">[</span><span class="n">NUM_ACRS</span><span class="p">];</span>
	<span class="n">__u32</span>		<span class="n">orig_gpr2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">s390_compat_regs</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="n">__u32</span>		<span class="n">gprs_high</span><span class="p">[</span><span class="n">NUM_GPRS</span><span class="p">];</span>
<span class="p">}</span> <span class="n">s390_compat_regs_high</span><span class="p">;</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/*</span>
<span class="cm"> * The pt_regs struct defines the way the registers are stored on</span>
<span class="cm"> * the stack during a system call.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">pt_regs</span> 
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">psw_t</span> <span class="n">psw</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gprs</span><span class="p">[</span><span class="n">NUM_GPRS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">orig_gpr2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">int_code</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">int_parm_long</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Program event recording (PER) register set.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">per_regs</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">control</span><span class="p">;</span>		<span class="cm">/* PER control bits */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start</span><span class="p">;</span>		<span class="cm">/* PER starting address */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">end</span><span class="p">;</span>		<span class="cm">/* PER ending address */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * PER event contains information about the cause of the last PER exception.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">per_event</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">cause</span><span class="p">;</span>		<span class="cm">/* PER code, ATMID and AI */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">;</span>		<span class="cm">/* PER address */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">paid</span><span class="p">;</span>		<span class="cm">/* PER access identification */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Simplified per_info structure used to decode the ptrace user space ABI.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">per_struct_kernel</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cr9</span><span class="p">;</span>		<span class="cm">/* PER control bits */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cr10</span><span class="p">;</span>		<span class="cm">/* PER starting address */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cr11</span><span class="p">;</span>		<span class="cm">/* PER ending address */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bits</span><span class="p">;</span>		<span class="cm">/* Obsolete software bits */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">starting_addr</span><span class="p">;</span>	<span class="cm">/* User specified start address */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ending_addr</span><span class="p">;</span>	<span class="cm">/* User specified end address */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">perc_atmid</span><span class="p">;</span>	<span class="cm">/* PER trap ATMID */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">;</span>		<span class="cm">/* PER trap instruction address */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">access_id</span><span class="p">;</span>	<span class="cm">/* PER trap access identification */</span>
<span class="p">};</span>

<span class="cp">#define PER_EVENT_MASK			0xE9000000UL</span>

<span class="cp">#define PER_EVENT_BRANCH		0x80000000UL</span>
<span class="cp">#define PER_EVENT_IFETCH		0x40000000UL</span>
<span class="cp">#define PER_EVENT_STORE			0x20000000UL</span>
<span class="cp">#define PER_EVENT_STORE_REAL		0x08000000UL</span>
<span class="cp">#define PER_EVENT_NULLIFICATION		0x01000000UL</span>

<span class="cp">#define PER_CONTROL_MASK		0x00a00000UL</span>

<span class="cp">#define PER_CONTROL_BRANCH_ADDRESS	0x00800000UL</span>
<span class="cp">#define PER_CONTROL_ALTERATION		0x00200000UL</span>

<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Now for the user space program event recording (trace) definitions.</span>
<span class="cm"> * The following structures are used only for the ptrace interface, don&#39;t</span>
<span class="cm"> * touch or even look at it if you don&#39;t want to modify the user-space</span>
<span class="cm"> * ptrace interface. In particular stay away from it for in-kernel PER.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cr</span><span class="p">[</span><span class="n">NUM_CR_WORDS</span><span class="p">];</span>
<span class="p">}</span> <span class="n">per_cr_words</span><span class="p">;</span>

<span class="cp">#define PER_EM_MASK 0xE8000000UL</span>

<span class="k">typedef</span>	<span class="k">struct</span>
<span class="p">{</span>
<span class="cp">#ifdef __s390x__</span>
	<span class="kt">unsigned</span>                       <span class="o">:</span> <span class="mi">32</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* __s390x__ */</span><span class="cp"></span>
	<span class="kt">unsigned</span> <span class="n">em_branching</span>          <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">em_instruction_fetch</span>  <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * Switching on storage alteration automatically fixes</span>
<span class="cm">	 * the storage alteration event bit in the users std.</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="n">em_storage_alteration</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">em_gpr_alt_unused</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">em_store_real_address</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>                       <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">branch_addr_ctl</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>                       <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">storage_alt_space_ctl</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>                       <span class="o">:</span> <span class="mi">21</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">starting_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ending_addr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">per_cr_bits</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">perc_atmid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">access_id</span><span class="p">;</span>
<span class="p">}</span> <span class="n">per_lowcore_words</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">perc_branching</span>          <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">perc_instruction_fetch</span>  <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">perc_storage_alteration</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">perc_gpr_alt_unused</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">perc_store_real_address</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>                         <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">atmid_psw_bit_31</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">atmid_validity_bit</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">atmid_psw_bit_32</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">atmid_psw_bit_5</span>         <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">atmid_psw_bit_16</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">atmid_psw_bit_17</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">si</span>                      <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">;</span>
	<span class="kt">unsigned</span>                         <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">access_id</span>               <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span> <span class="n">per_lowcore_bits</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">per_cr_words</span>   <span class="n">words</span><span class="p">;</span>
		<span class="n">per_cr_bits</span>    <span class="n">bits</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">control_regs</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * Use these flags instead of setting em_instruction_fetch</span>
<span class="cm">	 * directly they are used so that single stepping can be</span>
<span class="cm">	 * switched on &amp; off while not affecting other tracing</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span>  <span class="n">single_step</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>  <span class="n">instruction_fetch</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span>                    <span class="o">:</span> <span class="mi">30</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * These addresses are copied into cr10 &amp; cr11 if single</span>
<span class="cm">	 * stepping is switched off</span>
<span class="cm">	 */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">starting_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ending_addr</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">per_lowcore_words</span> <span class="n">words</span><span class="p">;</span>
		<span class="n">per_lowcore_bits</span>  <span class="n">bits</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">lowcore</span><span class="p">;</span> 
<span class="p">}</span> <span class="n">per_struct</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">len</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">kernel_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">process_addr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ptrace_area</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * S/390 specific non posix ptrace requests. I chose unusual values so</span>
<span class="cm"> * they are unlikely to clash with future ptrace definitions.</span>
<span class="cm"> */</span>
<span class="cp">#define PTRACE_PEEKUSR_AREA           0x5000</span>
<span class="cp">#define PTRACE_POKEUSR_AREA           0x5001</span>
<span class="cp">#define PTRACE_PEEKTEXT_AREA	      0x5002</span>
<span class="cp">#define PTRACE_PEEKDATA_AREA	      0x5003</span>
<span class="cp">#define PTRACE_POKETEXT_AREA	      0x5004</span>
<span class="cp">#define PTRACE_POKEDATA_AREA 	      0x5005</span>
<span class="cp">#define PTRACE_GET_LAST_BREAK	      0x5006</span>
<span class="cp">#define PTRACE_PEEK_SYSTEM_CALL       0x5007</span>
<span class="cp">#define PTRACE_POKE_SYSTEM_CALL	      0x5008</span>

<span class="cm">/*</span>
<span class="cm"> * PT_PROT definition is loosely based on hppa bsd definition in</span>
<span class="cm"> * gdb/hppab-nat.c</span>
<span class="cm"> */</span>
<span class="cp">#define PTRACE_PROT                       21</span>

<span class="k">typedef</span> <span class="k">enum</span>
<span class="p">{</span>
	<span class="n">ptprot_set_access_watchpoint</span><span class="p">,</span>
	<span class="n">ptprot_set_write_watchpoint</span><span class="p">,</span>
	<span class="n">ptprot_disable_watchpoint</span>
<span class="p">}</span> <span class="n">ptprot_flags</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">lowaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">hiaddr</span><span class="p">;</span>
	<span class="n">ptprot_flags</span> <span class="n">prot</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ptprot_area</span><span class="p">;</span>                     

<span class="cm">/* Sequence of bytes for breakpoint illegal instruction.  */</span>
<span class="cp">#define S390_BREAKPOINT     {0x0,0x1}</span>
<span class="cp">#define S390_BREAKPOINT_U16 ((__u16)0x0001)</span>
<span class="cp">#define S390_SYSCALL_OPCODE ((__u16)0x0a00)</span>
<span class="cp">#define S390_SYSCALL_SIZE   2</span>

<span class="cm">/*</span>
<span class="cm"> * The user_regs_struct defines the way the user registers are</span>
<span class="cm"> * store on the stack for signal handling.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">user_regs_struct</span>
<span class="p">{</span>
	<span class="n">psw_t</span> <span class="n">psw</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">gprs</span><span class="p">[</span><span class="n">NUM_GPRS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>  <span class="n">acrs</span><span class="p">[</span><span class="n">NUM_ACRS</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">orig_gpr2</span><span class="p">;</span>
	<span class="n">s390_fp_regs</span> <span class="n">fp_regs</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * These per registers are in here so that gdb can modify them</span>
<span class="cm">	 * itself as there is no &quot;official&quot; ptrace interface for hardware</span>
<span class="cm">	 * watchpoints. This is the way intel does it.</span>
<span class="cm">	 */</span>
	<span class="n">per_struct</span> <span class="n">per_info</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ieee_instruction_pointer</span><span class="p">;</span>	<span class="cm">/* obsolete, always 0 */</span>
<span class="p">};</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cm">/*</span>
<span class="cm"> * These are defined as per linux/ptrace.h, which see.</span>
<span class="cm"> */</span>
<span class="cp">#define arch_has_single_step()	(1)</span>

<span class="cp">#define user_mode(regs) (((regs)-&gt;psw.mask &amp; PSW_MASK_PSTATE) != 0)</span>
<span class="cp">#define instruction_pointer(regs) ((regs)-&gt;psw.addr &amp; PSW_ADDR_INSN)</span>
<span class="cp">#define user_stack_pointer(regs)((regs)-&gt;gprs[15])</span>
<span class="cp">#define profile_pc(regs) instruction_pointer(regs)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">long</span> <span class="nf">regs_return_value</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">gprs</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">regs_query_register_offset</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">);</span>
<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">regs_query_register_name</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">regs_get_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">offset</span><span class="p">);</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">regs_get_kernel_stack_nth</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">kernel_stack_pointer</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">gprs</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">PSW_ADDR_INSN</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _S390_PTRACE_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
