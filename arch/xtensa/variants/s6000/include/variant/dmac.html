<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › xtensa › variants › s6000 › include › variant › dmac.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../../index.html"></a><h1>dmac.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * include/asm-xtensa/variant-s6000/dmac.h</span>
<span class="cm"> *</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2006 Tensilica Inc.</span>
<span class="cm"> * Copyright (C) 2008 Emlix GmbH &lt;info@emlix.com&gt;</span>
<span class="cm"> * Authors:	Fabian Godehardt &lt;fg@emlix.com&gt;</span>
<span class="cm"> *		Oskar Schirmer &lt;oskar@scara.com&gt;</span>
<span class="cm"> *		Daniel Gloeckner &lt;dg@emlix.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASM_XTENSA_S6000_DMAC_H</span>
<span class="cp">#define __ASM_XTENSA_S6000_DMAC_H</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;variant/hardware.h&gt;</span>

<span class="cm">/* DMA global */</span>

<span class="cp">#define S6_DMA_INTSTAT0		0x000</span>
<span class="cp">#define S6_DMA_INTSTAT1		0x004</span>
<span class="cp">#define S6_DMA_INTENABLE0	0x008</span>
<span class="cp">#define S6_DMA_INTENABLE1	0x00C</span>
<span class="cp">#define S6_DMA_INTRAW0		0x010</span>
<span class="cp">#define S6_DMA_INTRAW1		0x014</span>
<span class="cp">#define S6_DMA_INTCLEAR0	0x018</span>
<span class="cp">#define S6_DMA_INTCLEAR1	0x01C</span>
<span class="cp">#define S6_DMA_INTSET0		0x020</span>
<span class="cp">#define S6_DMA_INTSET1		0x024</span>
<span class="cp">#define S6_DMA_INT0_UNDER		0</span>
<span class="cp">#define S6_DMA_INT0_OVER		16</span>
<span class="cp">#define S6_DMA_INT1_CHANNEL		0</span>
<span class="cp">#define S6_DMA_INT1_MASTER		16</span>
<span class="cp">#define S6_DMA_INT1_MASTER_MASK			7</span>
<span class="cp">#define S6_DMA_TERMCNTIRQSTAT	0x028</span>
<span class="cp">#define S6_DMA_TERMCNTIRQCLR	0x02C</span>
<span class="cp">#define S6_DMA_TERMCNTIRQSET	0x030</span>
<span class="cp">#define S6_DMA_PENDCNTIRQSTAT	0x034</span>
<span class="cp">#define S6_DMA_PENDCNTIRQCLR	0x038</span>
<span class="cp">#define S6_DMA_PENDCNTIRQSET	0x03C</span>
<span class="cp">#define S6_DMA_LOWWMRKIRQSTAT	0x040</span>
<span class="cp">#define S6_DMA_LOWWMRKIRQCLR	0x044</span>
<span class="cp">#define S6_DMA_LOWWMRKIRQSET	0x048</span>
<span class="cp">#define S6_DMA_MASTERERRINFO	0x04C</span>
<span class="cp">#define S6_DMA_MASTERERR_CHAN(n)	(4*(n))</span>
<span class="cp">#define S6_DMA_MASTERERR_CHAN_MASK		0xF</span>
<span class="cp">#define S6_DMA_DESCRFIFO0	0x050</span>
<span class="cp">#define S6_DMA_DESCRFIFO1	0x054</span>
<span class="cp">#define S6_DMA_DESCRFIFO2	0x058</span>
<span class="cp">#define S6_DMA_DESCRFIFO2_AUTODISABLE	24</span>
<span class="cp">#define S6_DMA_DESCRFIFO3	0x05C</span>
<span class="cp">#define S6_DMA_MASTER0START	0x060</span>
<span class="cp">#define S6_DMA_MASTER0END	0x064</span>
<span class="cp">#define S6_DMA_MASTER1START	0x068</span>
<span class="cp">#define S6_DMA_MASTER1END	0x06C</span>
<span class="cp">#define S6_DMA_NEXTFREE		0x070</span>
<span class="cp">#define S6_DMA_NEXTFREE_CHAN		0</span>
<span class="cp">#define S6_DMA_NEXTFREE_CHAN_MASK	0x1F</span>
<span class="cp">#define S6_DMA_NEXTFREE_ENA		16</span>
<span class="cp">#define S6_DMA_NEXTFREE_ENA_MASK	((1 &lt;&lt; 16) - 1)</span>
<span class="cp">#define S6_DMA_DPORTCTRLGRP(p)	((p) * 4 + 0x074)</span>
<span class="cp">#define S6_DMA_DPORTCTRLGRP_FRAMEREP	0</span>
<span class="cp">#define S6_DMA_DPORTCTRLGRP_NRCHANS	1</span>
<span class="cp">#define S6_DMA_DPORTCTRLGRP_NRCHANS_1		0</span>
<span class="cp">#define S6_DMA_DPORTCTRLGRP_NRCHANS_3		1</span>
<span class="cp">#define S6_DMA_DPORTCTRLGRP_NRCHANS_4		2</span>
<span class="cp">#define S6_DMA_DPORTCTRLGRP_NRCHANS_2		3</span>
<span class="cp">#define S6_DMA_DPORTCTRLGRP_ENA		31</span>


<span class="cm">/* DMA per channel */</span>

<span class="cp">#define DMA_CHNL(dmac, n)	((dmac) + 0x1000 + (n) * 0x100)</span>
<span class="cp">#define DMA_INDEX_CHNL(addr)	(((addr) &gt;&gt; 8) &amp; 0xF)</span>
<span class="cp">#define DMA_MASK_DMAC(addr)	((addr) &amp; 0xFFFF0000)</span>
<span class="cp">#define S6_DMA_CHNCTRL		0x000</span>
<span class="cp">#define S6_DMA_CHNCTRL_ENABLE		0</span>
<span class="cp">#define S6_DMA_CHNCTRL_PAUSE		1</span>
<span class="cp">#define S6_DMA_CHNCTRL_PRIO		2</span>
<span class="cp">#define S6_DMA_CHNCTRL_PRIO_MASK		3</span>
<span class="cp">#define S6_DMA_CHNCTRL_PERIPHXFER	4</span>
<span class="cp">#define S6_DMA_CHNCTRL_PERIPHENA	5</span>
<span class="cp">#define S6_DMA_CHNCTRL_SRCINC		6</span>
<span class="cp">#define S6_DMA_CHNCTRL_DSTINC		7</span>
<span class="cp">#define S6_DMA_CHNCTRL_BURSTLOG		8</span>
<span class="cp">#define S6_DMA_CHNCTRL_BURSTLOG_MASK		7</span>
<span class="cp">#define S6_DMA_CHNCTRL_DESCFIFODEPTH	12</span>
<span class="cp">#define S6_DMA_CHNCTRL_DESCFIFODEPTH_MASK	0x1F</span>
<span class="cp">#define S6_DMA_CHNCTRL_DESCFIFOFULL	17</span>
<span class="cp">#define S6_DMA_CHNCTRL_BWCONSEL		18</span>
<span class="cp">#define S6_DMA_CHNCTRL_BWCONENA		19</span>
<span class="cp">#define S6_DMA_CHNCTRL_PENDGCNTSTAT	20</span>
<span class="cp">#define S6_DMA_CHNCTRL_PENDGCNTSTAT_MASK	0x3F</span>
<span class="cp">#define S6_DMA_CHNCTRL_LOWWMARK		26</span>
<span class="cp">#define S6_DMA_CHNCTRL_LOWWMARK_MASK		0xF</span>
<span class="cp">#define S6_DMA_CHNCTRL_TSTAMP		30</span>
<span class="cp">#define S6_DMA_TERMCNTNB	0x004</span>
<span class="cp">#define S6_DMA_TERMCNTNB_MASK			0xFFFF</span>
<span class="cp">#define S6_DMA_TERMCNTTMO	0x008</span>
<span class="cp">#define S6_DMA_TERMCNTSTAT	0x00C</span>
<span class="cp">#define S6_DMA_TERMCNTSTAT_MASK		0xFF</span>
<span class="cp">#define S6_DMA_CMONCHUNK	0x010</span>
<span class="cp">#define S6_DMA_SRCSKIP		0x014</span>
<span class="cp">#define S6_DMA_DSTSKIP		0x018</span>
<span class="cp">#define S6_DMA_CUR_SRC		0x024</span>
<span class="cp">#define S6_DMA_CUR_DST		0x028</span>
<span class="cp">#define S6_DMA_TIMESTAMP	0x030</span>

<span class="cm">/* DMA channel lists */</span>

<span class="cp">#define S6_DPDMA_CHAN(stream, channel)	(4 * (stream) + (channel))</span>
<span class="cp">#define S6_DPDMA_NB	16</span>

<span class="cp">#define S6_HIFDMA_GMACTX	0</span>
<span class="cp">#define S6_HIFDMA_GMACRX	1</span>
<span class="cp">#define S6_HIFDMA_I2S0		2</span>
<span class="cp">#define S6_HIFDMA_I2S1		3</span>
<span class="cp">#define S6_HIFDMA_EGIB		4</span>
<span class="cp">#define S6_HIFDMA_PCITX		5</span>
<span class="cp">#define S6_HIFDMA_PCIRX		6</span>
<span class="cp">#define S6_HIFDMA_NB	7</span>

<span class="cp">#define S6_NIDMA_NB	4</span>

<span class="cp">#define S6_LMSDMA_NB	12</span>

<span class="cm">/* controller access */</span>

<span class="cp">#define S6_DMAC_NB	4</span>
<span class="cp">#define S6_DMAC_INDEX(dmac)	(((unsigned)(dmac) &gt;&gt; 18) % S6_DMAC_NB)</span>

<span class="k">struct</span> <span class="n">s6dmac_ctrl</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">dmac</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">chan_nb</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">s6dmac_ctrl</span> <span class="n">s6dmac_ctrl</span><span class="p">[</span><span class="n">S6_DMAC_NB</span><span class="p">];</span>


<span class="cm">/* DMA control, per channel */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">s6dmac_fifo_full</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">readl</span><span class="p">(</span><span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CHNCTRL</span><span class="p">)</span>
		<span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_DESCFIFOFULL</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">s6dmac_termcnt_irq</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">chan</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">readl</span><span class="p">(</span><span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_TERMCNTIRQSTAT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">m</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
		<span class="n">writel</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_TERMCNTIRQCLR</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">s6dmac_pendcnt_irq</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">chan</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">readl</span><span class="p">(</span><span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_PENDCNTIRQSTAT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">m</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
		<span class="n">writel</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_PENDCNTIRQCLR</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">s6dmac_lowwmark_irq</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">readl</span><span class="p">(</span><span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_LOWWMRKIRQSTAT</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">chan</span><span class="p">))</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
		<span class="n">writel</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">chan</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_LOWWMRKIRQCLR</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">s6dmac_pending_count</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">readl</span><span class="p">(</span><span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CHNCTRL</span><span class="p">)</span>
			<span class="o">&gt;&gt;</span> <span class="n">S6_DMA_CHNCTRL_PENDGCNTSTAT</span><span class="p">)</span>
		<span class="o">&amp;</span> <span class="n">S6_DMA_CHNCTRL_PENDGCNTSTAT_MASK</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">s6dmac_set_terminal_count</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">,</span> <span class="n">u32</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">n</span> <span class="o">&amp;=</span> <span class="n">S6_DMA_TERMCNTNB_MASK</span><span class="p">;</span>
	<span class="n">n</span> <span class="o">|=</span> <span class="n">readl</span><span class="p">(</span><span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_TERMCNTNB</span><span class="p">)</span>
	      <span class="o">&amp;</span> <span class="o">~</span><span class="n">S6_DMA_TERMCNTNB_MASK</span><span class="p">;</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_TERMCNTNB</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">s6dmac_get_terminal_count</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">readl</span><span class="p">(</span><span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_TERMCNTNB</span><span class="p">))</span>
		<span class="o">&amp;</span> <span class="n">S6_DMA_TERMCNTNB_MASK</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">s6dmac_timestamp</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">readl</span><span class="p">(</span><span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_TIMESTAMP</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">s6dmac_cur_src</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">readl</span><span class="p">(</span><span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CUR_SRC</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">s6dmac_cur_dst</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">readl</span><span class="p">(</span><span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CUR_DST</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">s6dmac_disable_chan</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">ctrl</span><span class="p">;</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">readl</span><span class="p">(</span><span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CHNCTRL</span><span class="p">)</span>
		<span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_ENABLE</span><span class="p">),</span>
		<span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CHNCTRL</span><span class="p">);</span>
	<span class="k">do</span>
		<span class="n">ctrl</span> <span class="o">=</span> <span class="n">readl</span><span class="p">(</span><span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CHNCTRL</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">ctrl</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_ENABLE</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">s6dmac_set_stride_skip</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">comchunk</span><span class="p">,</span>		<span class="cm">/* 0: disable scatter/gather */</span>
	<span class="kt">int</span> <span class="n">srcskip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dstskip</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">comchunk</span><span class="p">,</span> <span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CMONCHUNK</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">srcskip</span><span class="p">,</span> <span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_SRCSKIP</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">dstskip</span><span class="p">,</span> <span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_DSTSKIP</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">s6dmac_enable_chan</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">prio</span><span class="p">,</span>               <span class="cm">/* 0 (highest) .. 3 (lowest) */</span>
	<span class="kt">int</span> <span class="n">periphxfer</span><span class="p">,</span>         <span class="cm">/* &lt;0: disable p.req.line, 0..1: mode */</span>
	<span class="kt">int</span> <span class="n">srcinc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dstinc</span><span class="p">,</span> <span class="cm">/* 0: dont increment src/dst address */</span>
	<span class="kt">int</span> <span class="n">comchunk</span><span class="p">,</span>		<span class="cm">/* 0: disable scatter/gather */</span>
	<span class="kt">int</span> <span class="n">srcskip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dstskip</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">burstsize</span><span class="p">,</span>		<span class="cm">/* 4 for I2S, 7 for everything else */</span>
	<span class="kt">int</span> <span class="n">bandwidthconserve</span><span class="p">,</span>  <span class="cm">/* &lt;0: disable, 0..1: select */</span>
	<span class="kt">int</span> <span class="n">lowwmark</span><span class="p">,</span>           <span class="cm">/* 0..15 */</span>
	<span class="kt">int</span> <span class="n">timestamp</span><span class="p">,</span>		<span class="cm">/* 0: disable timestamp */</span>
	<span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>		<span class="cm">/* 0: disable for now */</span>
<span class="p">{</span>
	<span class="n">writel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_TERMCNTNB</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_TERMCNTTMO</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">lowwmark</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_LOWWMARK</span><span class="p">,</span>
		<span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CHNCTRL</span><span class="p">);</span>
	<span class="n">s6dmac_set_stride_skip</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">,</span> <span class="n">comchunk</span><span class="p">,</span> <span class="n">srcskip</span><span class="p">,</span> <span class="n">dstskip</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(((</span><span class="n">enable</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_ENABLE</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">prio</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_PRIO</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(((</span><span class="n">periphxfer</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_PERIPHXFER</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(((</span><span class="n">periphxfer</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_PERIPHENA</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">((</span><span class="n">srcinc</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_SRCINC</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">((</span><span class="n">dstinc</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_DSTINC</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">burstsize</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_BURSTLOG</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(((</span><span class="n">bandwidthconserve</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_BWCONSEL</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(((</span><span class="n">bandwidthconserve</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_BWCONENA</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">lowwmark</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_LOWWMARK</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">((</span><span class="n">timestamp</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_TSTAMP</span><span class="p">),</span>
		<span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CHNCTRL</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* DMA control, per engine */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="nf">_dmac_addr_index</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="n">S6_DMAC_INDEX</span><span class="p">(</span><span class="n">dmac</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">s6dmac_ctrl</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">dmac</span> <span class="o">!=</span> <span class="n">dmac</span><span class="p">)</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">_s6dmac_disable_error_irqs</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_TERMCNTIRQCLR</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_PENDCNTIRQCLR</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_LOWWMRKIRQCLR</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">readl</span><span class="p">(</span><span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_INTENABLE0</span><span class="p">)</span>
		<span class="o">&amp;</span> <span class="o">~</span><span class="p">((</span><span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_INT0_UNDER</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_INT0_OVER</span><span class="p">)),</span>
		<span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_INTENABLE0</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">readl</span><span class="p">(</span><span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_INTENABLE1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_INT1_CHANNEL</span><span class="p">),</span>
		<span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_INTENABLE1</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">((</span><span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_INT0_UNDER</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_INT0_OVER</span><span class="p">),</span>
		<span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_INTCLEAR0</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">mask</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_INT1_CHANNEL</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_INTCLEAR1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * request channel from specified engine</span>
<span class="cm"> * with chan&lt;0, accept any channel</span>
<span class="cm"> * further parameters see s6dmac_enable_chan</span>
<span class="cm"> * returns &lt; 0 upon error, channel nb otherwise</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">s6dmac_request_chan</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">prio</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">periphxfer</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">srcinc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dstinc</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">comchunk</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">srcskip</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dstskip</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">burstsize</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">bandwidthconserve</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">lowwmark</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">timestamp</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">r</span> <span class="o">=</span> <span class="n">chan</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="o">*</span><span class="n">spinl</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s6dmac_ctrl</span><span class="p">[</span><span class="n">_dmac_addr_index</span><span class="p">(</span><span class="n">dmac</span><span class="p">)].</span><span class="n">lock</span><span class="p">;</span>
	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="n">spinl</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">readl</span><span class="p">(</span><span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_NEXTFREE</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">S6_DMA_NEXTFREE_CHAN</span><span class="p">)</span>
			<span class="o">&amp;</span> <span class="n">S6_DMA_NEXTFREE_CHAN_MASK</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;=</span> <span class="n">s6dmac_ctrl</span><span class="p">[</span><span class="n">_dmac_addr_index</span><span class="p">(</span><span class="n">dmac</span><span class="p">)].</span><span class="n">chan_nb</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">chan</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENXIO</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(((</span><span class="n">readl</span><span class="p">(</span><span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_NEXTFREE</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">S6_DMA_NEXTFREE_ENA</span><span class="p">)</span>
			<span class="o">&gt;&gt;</span> <span class="n">r</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">r</span> <span class="o">=</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">s6dmac_enable_chan</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">prio</span><span class="p">,</span> <span class="n">periphxfer</span><span class="p">,</span>
			<span class="n">srcinc</span><span class="p">,</span> <span class="n">dstinc</span><span class="p">,</span> <span class="n">comchunk</span><span class="p">,</span> <span class="n">srcskip</span><span class="p">,</span> <span class="n">dstskip</span><span class="p">,</span> <span class="n">burstsize</span><span class="p">,</span>
			<span class="n">bandwidthconserve</span><span class="p">,</span> <span class="n">lowwmark</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">enable</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="n">spinl</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">s6dmac_put_fifo</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">src</span><span class="p">,</span> <span class="n">u32</span> <span class="n">dst</span><span class="p">,</span> <span class="n">u32</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="o">*</span><span class="n">spinl</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s6dmac_ctrl</span><span class="p">[</span><span class="n">_dmac_addr_index</span><span class="p">(</span><span class="n">dmac</span><span class="p">)].</span><span class="n">lock</span><span class="p">;</span>
	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="n">spinl</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_DESCRFIFO0</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_DESCRFIFO1</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_DESCRFIFO2</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">chan</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_DESCRFIFO3</span><span class="p">);</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="n">spinl</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">s6dmac_channel_enabled</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">readl</span><span class="p">(</span><span class="n">DMA_CHNL</span><span class="p">(</span><span class="n">dmac</span><span class="p">,</span> <span class="n">chan</span><span class="p">)</span> <span class="o">+</span> <span class="n">S6_DMA_CHNCTRL</span><span class="p">)</span> <span class="o">&amp;</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_CHNCTRL_ENABLE</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * group 1-4 data port channels</span>
<span class="cm"> * with port=0..3, nrch=1-4 channels,</span>
<span class="cm"> * frrep=0/1 (dis- or enable frame repeat)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">s6dmac_dp_setup_group</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">nrch</span><span class="p">,</span> <span class="kt">int</span> <span class="n">frrep</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">mask</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">};</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">dmac</span> <span class="o">!=</span> <span class="n">S6_REG_DPDMA</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">port</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">port</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">nrch</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">nrch</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">writel</span><span class="p">((</span><span class="n">mask</span><span class="p">[</span><span class="n">nrch</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_DPORTCTRLGRP_NRCHANS</span><span class="p">)</span>
		<span class="o">|</span> <span class="p">((</span><span class="n">frrep</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_DPORTCTRLGRP_FRAMEREP</span><span class="p">),</span>
		<span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_DPORTCTRLGRP</span><span class="p">(</span><span class="n">port</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">s6dmac_dp_switch_group</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">port</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">dmac</span> <span class="o">!=</span> <span class="n">S6_REG_DPDMA</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">readl</span><span class="p">(</span><span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_DPORTCTRLGRP</span><span class="p">(</span><span class="n">port</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span>
		<span class="n">tmp</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_DPORTCTRLGRP_ENA</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">tmp</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">S6_DMA_DPORTCTRLGRP_ENA</span><span class="p">);</span>
	<span class="n">writel</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">dmac</span> <span class="o">+</span> <span class="n">S6_DMA_DPORTCTRLGRP</span><span class="p">(</span><span class="n">port</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">s6dmac_put_fifo_cache</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">src</span><span class="p">,</span> <span class="n">u32</span> <span class="n">dst</span><span class="p">,</span> <span class="n">u32</span> <span class="n">size</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">s6dmac_disable_error_irqs</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u32</span> <span class="n">s6dmac_int_sources</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="n">u32</span> <span class="n">channel</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">s6dmac_release_chan</span><span class="p">(</span><span class="n">u32</span> <span class="n">dmac</span><span class="p">,</span> <span class="kt">int</span> <span class="n">chan</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __ASM_XTENSA_S6000_DMAC_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:6}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../../javascript/docco.min.js"></script>
</html>
