f | cstate.c | s | 5.6K | 173 | David Howells | dhowells@redhat.com | 1332954672 |  | Disintegrate asm/system.h for X86  Disintegrate asm/system.h for X86.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: H. Peter Anvin <hpa@zytor.com> cc: x86@kernel.org
f | wakeup_32.S | g | 1.7K |  | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1335212958 |  | x86, acpi: Call acpi_enter_sleep_state via an asmlinkage C function from assembler  With commit a2ef5c4fd44ce3922435139393b89f2cce47f576 "ACPI: Move module parameter gts and bfs to sleep.c" the wake_sleep_flags is required when calling acpi_enter_sleep_state.  The assembler code in wakeup_*.S did not do that. One solution is to call it from assembler and stick the wake_sleep_flags on the stack (for 32-bit) or in %esi (for 64-bit). hpa and rafael both suggested however to create a wrapper function to call acpi_enter_sleep_state and call said wrapper function ("acpi_enter_s3") from assembler.  For 32-bit, the acpi_enter_s3 ends up looking as so:    push   %ebp   mov    %esp,%ebp   sub    $0x8,%esp   movzbl 0xc1809314,%eax [wake_sleep_flags]   movl   $0x3,(%esp)   mov    %eax,0x4(%esp)   call   0xc12d1fa0 <acpi_enter_sleep_state>   leave   ret  And 64-bit:    movzbl 0x9afde1(%rip),%esi        [wake_sleep_flags]   push   %rbp   mov    $0x3,%edi   mov    %rsp,%rbp   callq  0xffffffff812e9800 <acpi_enter_sleep_state>   leaveq   retq  Reviewed-by: H. Peter Anvin <hpa@zytor.com> Suggested-by: H. Peter Anvin <hpa@zytor.com> [v2: Remove extra assembler operations, per hpa review] Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com> Link: http://lkml.kernel.org/r/1335150198-21899-3-git-send-email-konrad.wilk@oracle.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | Makefile | g | 146B |  | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502765 |  | x86, realmode: Move ACPI wakeup to unified realmode code  Migrated ACPI wakeup code to the real-mode blob. Code existing in .x86_trampoline  can be completely removed. Static descriptor table in wakeup_asm.S is courtesy of H. Peter Anvin.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-7-git-send-email-jarkko.sakkinen@intel.com Cc: Rafael J. Wysocki <rjw@sisk.pl> Cc: Len Brown <len.brown@intel.com> Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | wakeup_64.S | g | 2.6K |  | Konrad Rzeszutek Wilk | konrad.wilk@oracle.com | 1335212958 |  | x86, acpi: Call acpi_enter_sleep_state via an asmlinkage C function from assembler  With commit a2ef5c4fd44ce3922435139393b89f2cce47f576 "ACPI: Move module parameter gts and bfs to sleep.c" the wake_sleep_flags is required when calling acpi_enter_sleep_state.  The assembler code in wakeup_*.S did not do that. One solution is to call it from assembler and stick the wake_sleep_flags on the stack (for 32-bit) or in %esi (for 64-bit). hpa and rafael both suggested however to create a wrapper function to call acpi_enter_sleep_state and call said wrapper function ("acpi_enter_s3") from assembler.  For 32-bit, the acpi_enter_s3 ends up looking as so:    push   %ebp   mov    %esp,%ebp   sub    $0x8,%esp   movzbl 0xc1809314,%eax [wake_sleep_flags]   movl   $0x3,(%esp)   mov    %eax,0x4(%esp)   call   0xc12d1fa0 <acpi_enter_sleep_state>   leave   ret  And 64-bit:    movzbl 0x9afde1(%rip),%esi        [wake_sleep_flags]   push   %rbp   mov    $0x3,%edi   mov    %rsp,%rbp   callq  0xffffffff812e9800 <acpi_enter_sleep_state>   leaveq   retq  Reviewed-by: H. Peter Anvin <hpa@zytor.com> Suggested-by: H. Peter Anvin <hpa@zytor.com> [v2: Remove extra assembler operations, per hpa review] Signed-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com> Link: http://lkml.kernel.org/r/1335150198-21899-3-git-send-email-konrad.wilk@oracle.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | boot.c | s | 39K | 1429 | Feng Tang | feng.tang@intel.com | 1339450184 |  | ACPI: Add a quirk for "AMILO PRO V2030" to ignore the timer overriding  This is the 2nd part of fix for kernel bugzilla 40002:     "IRQ 0 assigned to VGA" https://bugzilla.kernel.org/show_bug.cgi?id=40002  The root cause is the buggy FW, whose ACPI tables assign the GSI 16 to 2 irqs 0 and 16(VGA), and the VGA is the right owner of GSI 16. So add a quirk to ignore the irq0 overriding GSI 16 for the FUJITSU SIEMENS AMILO PRO V2030 platform will solve this issue.  Reported-and-tested-by: Szymon Kowalczyk <fazerxlo@o2.pl> Signed-off-by: Feng Tang <feng.tang@intel.com> Signed-off-by: Len Brown <len.brown@intel.com>
f | sleep.c | s | 2.9K | 98 | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502925 |  | x86, realmode: flattened rm hierachy  Simplified hierarchy under rm directory to a flat directory because it is not anymore really justified to have own directory for wakeup code. It only adds more complexity.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-20-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | sleep.h | s | 423B | 13 | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502765 |  | x86, realmode: Move ACPI wakeup to unified realmode code  Migrated ACPI wakeup code to the real-mode blob. Code existing in .x86_trampoline  can be completely removed. Static descriptor table in wakeup_asm.S is courtesy of H. Peter Anvin.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-7-git-send-email-jarkko.sakkinen@intel.com Cc: Rafael J. Wysocki <rjw@sisk.pl> Cc: Len Brown <len.brown@intel.com> Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
