<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › x86 › math-emu › errors.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>errors.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*---------------------------------------------------------------------------+</span>
<span class="cm"> |  errors.c                                                                 |</span>
<span class="cm"> |                                                                           |</span>
<span class="cm"> |  The error handling functions for wm-FPU-emu                              |</span>
<span class="cm"> |                                                                           |</span>
<span class="cm"> | Copyright (C) 1992,1993,1994,1996                                         |</span>
<span class="cm"> |                  W. Metzenthen, 22 Parker St, Ormond, Vic 3163, Australia |</span>
<span class="cm"> |                  E-mail   billm@jacobi.maths.monash.edu.au                |</span>
<span class="cm"> |                                                                           |</span>
<span class="cm"> |                                                                           |</span>
<span class="cm"> +---------------------------------------------------------------------------*/</span>

<span class="cm">/*---------------------------------------------------------------------------+</span>
<span class="cm"> | Note:                                                                     |</span>
<span class="cm"> |    The file contains code which accesses user memory.                     |</span>
<span class="cm"> |    Emulator static data may change when user memory is accessed, due to   |</span>
<span class="cm"> |    other processes using the emulator while swapping is in progress.      |</span>
<span class="cm"> +---------------------------------------------------------------------------*/</span>

<span class="cp">#include &lt;linux/signal.h&gt;</span>

<span class="cp">#include &lt;asm/uaccess.h&gt;</span>

<span class="cp">#include &quot;fpu_emu.h&quot;</span>
<span class="cp">#include &quot;fpu_system.h&quot;</span>
<span class="cp">#include &quot;exception.h&quot;</span>
<span class="cp">#include &quot;status_w.h&quot;</span>
<span class="cp">#include &quot;control_w.h&quot;</span>
<span class="cp">#include &quot;reg_constant.h&quot;</span>
<span class="cp">#include &quot;version.h&quot;</span>

<span class="cm">/* */</span>
<span class="cp">#undef PRINT_MESSAGES</span>
<span class="cm">/* */</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">void Un_impl(void)</span>
<span class="c">{</span>
<span class="c">	u_char byte1, FPU_modrm;</span>
<span class="c">	unsigned long address = FPU_ORIG_EIP;</span>

<span class="c">	RE_ENTRANT_CHECK_OFF;</span>
<span class="c">	/* No need to check access_ok(), we have previously fetched these bytes. */</span>
<span class="c">	printk(&quot;Unimplemented FPU Opcode at eip=%p : &quot;, (void __user *)address);</span>
<span class="c">	if (FPU_CS == __USER_CS) {</span>
<span class="c">		while (1) {</span>
<span class="c">			FPU_get_user(byte1, (u_char __user *) address);</span>
<span class="c">			if ((byte1 &amp; 0xf8) == 0xd8)</span>
<span class="c">				break;</span>
<span class="c">			printk(&quot;[%02x]&quot;, byte1);</span>
<span class="c">			address++;</span>
<span class="c">		}</span>
<span class="c">		printk(&quot;%02x &quot;, byte1);</span>
<span class="c">		FPU_get_user(FPU_modrm, 1 + (u_char __user *) address);</span>

<span class="c">		if (FPU_modrm &gt;= 0300)</span>
<span class="c">			printk(&quot;%02x (%02x+%d)\n&quot;, FPU_modrm, FPU_modrm &amp; 0xf8,</span>
<span class="c">			       FPU_modrm &amp; 7);</span>
<span class="c">		else</span>
<span class="c">			printk(&quot;/%d\n&quot;, (FPU_modrm &gt;&gt; 3) &amp; 7);</span>
<span class="c">	} else {</span>
<span class="c">		printk(&quot;cs selector = %04x\n&quot;, FPU_CS);</span>
<span class="c">	}</span>

<span class="c">	RE_ENTRANT_CHECK_ON;</span>

<span class="c">	EXCEPTION(EX_Invalid);</span>

<span class="c">}</span>
<span class="cp">#endif /*  0  */</span>

<span class="cm">/*</span>
<span class="cm">   Called for opcodes which are illegal and which are known to result in a</span>
<span class="cm">   SIGILL with a real 80486.</span>
<span class="cm">   */</span>
<span class="kt">void</span> <span class="nf">FPU_illegal</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">math_abort</span><span class="p">(</span><span class="n">FPU_info</span><span class="p">,</span> <span class="n">SIGILL</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">FPU_printall</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tag_desc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Valid&quot;</span><span class="p">,</span> <span class="s">&quot;Zero&quot;</span><span class="p">,</span> <span class="s">&quot;ERROR&quot;</span><span class="p">,</span> <span class="s">&quot;Empty&quot;</span><span class="p">,</span>
		<span class="s">&quot;DeNorm&quot;</span><span class="p">,</span> <span class="s">&quot;Inf&quot;</span><span class="p">,</span> <span class="s">&quot;NaN&quot;</span>
	<span class="p">};</span>
	<span class="n">u_char</span> <span class="n">byte1</span><span class="p">,</span> <span class="n">FPU_modrm</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span> <span class="o">=</span> <span class="n">FPU_ORIG_EIP</span><span class="p">;</span>

	<span class="n">RE_ENTRANT_CHECK_OFF</span><span class="p">;</span>
	<span class="cm">/* No need to check access_ok(), we have previously fetched these bytes. */</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;At %p:&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">address</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">FPU_CS</span> <span class="o">==</span> <span class="n">__USER_CS</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#define MAX_PRINTED_BYTES 20</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">MAX_PRINTED_BYTES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">FPU_get_user</span><span class="p">(</span><span class="n">byte1</span><span class="p">,</span> <span class="p">(</span><span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">)</span> <span class="n">address</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0xf8</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xd8</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot; %02x&quot;</span><span class="p">,</span> <span class="n">byte1</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot; [%02x]&quot;</span><span class="p">,</span> <span class="n">byte1</span><span class="p">);</span>
			<span class="n">address</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">MAX_PRINTED_BYTES</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot; [more..]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">FPU_get_user</span><span class="p">(</span><span class="n">FPU_modrm</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">u_char</span> <span class="n">__user</span> <span class="o">*</span><span class="p">)</span> <span class="n">address</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">FPU_modrm</span> <span class="o">&gt;=</span> <span class="mo">0300</span><span class="p">)</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot; %02x (%02x+%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">FPU_modrm</span><span class="p">,</span>
				       <span class="n">FPU_modrm</span> <span class="o">&amp;</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="n">FPU_modrm</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot; /%d, mod=%d rm=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				       <span class="p">(</span><span class="n">FPU_modrm</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">,</span>
				       <span class="p">(</span><span class="n">FPU_modrm</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">,</span> <span class="n">FPU_modrm</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">FPU_CS</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">partial_status</span> <span class="o">=</span> <span class="n">status_word</span><span class="p">();</span>

<span class="cp">#ifdef DEBUGGING</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Backward</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: backward compatibility</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_C3</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: condition bit 3</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_C2</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: condition bit 2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_C1</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: condition bit 1</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_C0</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: condition bit 0</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Summary</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: exception summary</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Stack_Fault</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: stack fault</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Precision</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: loss of precision</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Underflow</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: underflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Overflow</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Zero_Div</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: divide by zero</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Denorm_Op</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: denormalized operand</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Invalid</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SW: invalid operation</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* DEBUGGING */</span><span class="cp"></span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot; SW: b=%d st=%d es=%d sf=%d cc=%d%d%d%d ef=%d%d%d%d%d%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="mh">0x8000</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* busy */</span>
	       <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="mh">0x3800</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">,</span>	<span class="cm">/* stack top pointer */</span>
	       <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="mh">0x80</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* Error summary status */</span>
	       <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="mh">0x40</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* Stack flag */</span>
	       <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_C3</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_C2</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* cc */</span>
	       <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_C1</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_C0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* cc */</span>
	       <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Precision</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Underflow</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Overflow</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Zero_Div</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Denorm_Op</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">partial_status</span> <span class="o">&amp;</span> <span class="n">SW_Invalid</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot; CW: ic=%d rc=%d%d pc=%d%d iem=%d     ef=%d%d%d%d%d%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">control_word</span> <span class="o">&amp;</span> <span class="mh">0x1000</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="mh">0x800</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">,</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="mh">0x400</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">,</span>
	       <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="mh">0x200</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">9</span><span class="p">,</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="mh">0x100</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span>
	       <span class="n">control_word</span> <span class="o">&amp;</span> <span class="mh">0x80</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">SW_Precision</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">SW_Underflow</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">SW_Overflow</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">SW_Zero_Div</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">SW_Denorm_Op</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">SW_Invalid</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">FPU_REG</span> <span class="o">*</span><span class="n">r</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
		<span class="n">u_char</span> <span class="n">tagi</span> <span class="o">=</span> <span class="n">FPU_gettagi</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">tagi</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">TAG_Empty</span>:
			<span class="k">continue</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">TAG_Zero</span>:
		<span class="k">case</span> <span class="n">TAG_Special</span>:
			<span class="n">tagi</span> <span class="o">=</span> <span class="n">FPU_Special</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
		<span class="k">case</span> <span class="n">TAG_Valid</span>:
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;st(%d)  %c .%04lx %04lx %04lx %04lx e%+-6d &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
			       <span class="n">getsign</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">?</span> <span class="sc">&#39;-&#39;</span> <span class="o">:</span> <span class="sc">&#39;+&#39;</span><span class="p">,</span>
			       <span class="p">(</span><span class="kt">long</span><span class="p">)(</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">),</span>
			       <span class="p">(</span><span class="kt">long</span><span class="p">)(</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">),</span>
			       <span class="p">(</span><span class="kt">long</span><span class="p">)(</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">sigl</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">),</span>
			       <span class="p">(</span><span class="kt">long</span><span class="p">)(</span><span class="n">r</span><span class="o">-&gt;</span><span class="n">sigl</span> <span class="o">&amp;</span> <span class="mh">0xFFFF</span><span class="p">),</span>
			       <span class="n">exponent</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">EXP_BIAS</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;Whoops! Error in errors.c: tag%d is %d &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
			       <span class="n">tagi</span><span class="p">);</span>
			<span class="k">continue</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tag_desc</span><span class="p">[(</span><span class="kt">int</span><span class="p">)(</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">tagi</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="n">RE_ENTRANT_CHECK_ON</span><span class="p">;</span>

<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">type</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span> <span class="n">exception_names</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
	<span class="n">EX_StackOver</span><span class="p">,</span> <span class="s">&quot;stack overflow&quot;</span><span class="p">},</span> <span class="p">{</span>
	<span class="n">EX_StackUnder</span><span class="p">,</span> <span class="s">&quot;stack underflow&quot;</span><span class="p">},</span> <span class="p">{</span>
	<span class="n">EX_Precision</span><span class="p">,</span> <span class="s">&quot;loss of precision&quot;</span><span class="p">},</span> <span class="p">{</span>
	<span class="n">EX_Underflow</span><span class="p">,</span> <span class="s">&quot;underflow&quot;</span><span class="p">},</span> <span class="p">{</span>
	<span class="n">EX_Overflow</span><span class="p">,</span> <span class="s">&quot;overflow&quot;</span><span class="p">},</span> <span class="p">{</span>
	<span class="n">EX_ZeroDiv</span><span class="p">,</span> <span class="s">&quot;divide by zero&quot;</span><span class="p">},</span> <span class="p">{</span>
	<span class="n">EX_Denormal</span><span class="p">,</span> <span class="s">&quot;denormalized operand&quot;</span><span class="p">},</span> <span class="p">{</span>
	<span class="n">EX_Invalid</span><span class="p">,</span> <span class="s">&quot;invalid operation&quot;</span><span class="p">},</span> <span class="p">{</span>
	<span class="n">EX_INTERNAL</span><span class="p">,</span> <span class="s">&quot;INTERNAL BUG in &quot;</span> <span class="n">FPU_VERSION</span><span class="p">},</span> <span class="p">{</span>
	<span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">}</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> EX_INTERNAL is always given with a code which indicates where the</span>
<span class="cm"> error was detected.</span>

<span class="cm"> Internal error types:</span>
<span class="cm">       0x14   in fpu_etc.c</span>
<span class="cm">       0x1nn  in a *.c file:</span>
<span class="cm">              0x101  in reg_add_sub.c</span>
<span class="cm">              0x102  in reg_mul.c</span>
<span class="cm">              0x104  in poly_atan.c</span>
<span class="cm">              0x105  in reg_mul.c</span>
<span class="cm">              0x107  in fpu_trig.c</span>
<span class="cm">	      0x108  in reg_compare.c</span>
<span class="cm">	      0x109  in reg_compare.c</span>
<span class="cm">	      0x110  in reg_add_sub.c</span>
<span class="cm">	      0x111  in fpe_entry.c</span>
<span class="cm">	      0x112  in fpu_trig.c</span>
<span class="cm">	      0x113  in errors.c</span>
<span class="cm">	      0x115  in fpu_trig.c</span>
<span class="cm">	      0x116  in fpu_trig.c</span>
<span class="cm">	      0x117  in fpu_trig.c</span>
<span class="cm">	      0x118  in fpu_trig.c</span>
<span class="cm">	      0x119  in fpu_trig.c</span>
<span class="cm">	      0x120  in poly_atan.c</span>
<span class="cm">	      0x121  in reg_compare.c</span>
<span class="cm">	      0x122  in reg_compare.c</span>
<span class="cm">	      0x123  in reg_compare.c</span>
<span class="cm">	      0x125  in fpu_trig.c</span>
<span class="cm">	      0x126  in fpu_entry.c</span>
<span class="cm">	      0x127  in poly_2xm1.c</span>
<span class="cm">	      0x128  in fpu_entry.c</span>
<span class="cm">	      0x129  in fpu_entry.c</span>
<span class="cm">	      0x130  in get_address.c</span>
<span class="cm">	      0x131  in get_address.c</span>
<span class="cm">	      0x132  in get_address.c</span>
<span class="cm">	      0x133  in get_address.c</span>
<span class="cm">	      0x140  in load_store.c</span>
<span class="cm">	      0x141  in load_store.c</span>
<span class="cm">              0x150  in poly_sin.c</span>
<span class="cm">              0x151  in poly_sin.c</span>
<span class="cm">	      0x160  in reg_ld_str.c</span>
<span class="cm">	      0x161  in reg_ld_str.c</span>
<span class="cm">	      0x162  in reg_ld_str.c</span>
<span class="cm">	      0x163  in reg_ld_str.c</span>
<span class="cm">	      0x164  in reg_ld_str.c</span>
<span class="cm">	      0x170  in fpu_tags.c</span>
<span class="cm">	      0x171  in fpu_tags.c</span>
<span class="cm">	      0x172  in fpu_tags.c</span>
<span class="cm">	      0x180  in reg_convert.c</span>
<span class="cm">       0x2nn  in an *.S file:</span>
<span class="cm">              0x201  in reg_u_add.S</span>
<span class="cm">              0x202  in reg_u_div.S</span>
<span class="cm">              0x203  in reg_u_div.S</span>
<span class="cm">              0x204  in reg_u_div.S</span>
<span class="cm">              0x205  in reg_u_mul.S</span>
<span class="cm">              0x206  in reg_u_sub.S</span>
<span class="cm">              0x207  in wm_sqrt.S</span>
<span class="cm">	      0x208  in reg_div.S</span>
<span class="cm">              0x209  in reg_u_sub.S</span>
<span class="cm">              0x210  in reg_u_sub.S</span>
<span class="cm">              0x211  in reg_u_sub.S</span>
<span class="cm">              0x212  in reg_u_sub.S</span>
<span class="cm">	      0x213  in wm_sqrt.S</span>
<span class="cm">	      0x214  in wm_sqrt.S</span>
<span class="cm">	      0x215  in wm_sqrt.S</span>
<span class="cm">	      0x220  in reg_norm.S</span>
<span class="cm">	      0x221  in reg_norm.S</span>
<span class="cm">	      0x230  in reg_round.S</span>
<span class="cm">	      0x231  in reg_round.S</span>
<span class="cm">	      0x232  in reg_round.S</span>
<span class="cm">	      0x233  in reg_round.S</span>
<span class="cm">	      0x234  in reg_round.S</span>
<span class="cm">	      0x235  in reg_round.S</span>
<span class="cm">	      0x236  in reg_round.S</span>
<span class="cm">	      0x240  in div_Xsig.S</span>
<span class="cm">	      0x241  in div_Xsig.S</span>
<span class="cm">	      0x242  in div_Xsig.S</span>
<span class="cm"> */</span>

<span class="n">asmlinkage</span> <span class="kt">void</span> <span class="nf">FPU_exception</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">int_type</span><span class="p">;</span>

	<span class="n">int_type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>		<span class="cm">/* Needed only to stop compiler warnings */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&amp;</span> <span class="n">EX_INTERNAL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">int_type</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">EX_INTERNAL</span><span class="p">;</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">EX_INTERNAL</span><span class="p">;</span>
		<span class="cm">/* Set lots of exception bits! */</span>
		<span class="n">partial_status</span> <span class="o">|=</span> <span class="p">(</span><span class="n">SW_Exc_Mask</span> <span class="o">|</span> <span class="n">SW_Summary</span> <span class="o">|</span> <span class="n">SW_Backward</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* Extract only the bits which we use to set the status word */</span>
		<span class="n">n</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="n">SW_Exc_Mask</span><span class="p">);</span>
		<span class="cm">/* Set the corresponding exception bit */</span>
		<span class="n">partial_status</span> <span class="o">|=</span> <span class="n">n</span><span class="p">;</span>
		<span class="cm">/* Set summary bits iff exception isn&#39;t masked */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">partial_status</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Exceptions</span><span class="p">)</span>
			<span class="n">partial_status</span> <span class="o">|=</span> <span class="p">(</span><span class="n">SW_Summary</span> <span class="o">|</span> <span class="n">SW_Backward</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">SW_Stack_Fault</span> <span class="o">|</span> <span class="n">EX_Precision</span><span class="p">))</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">n</span> <span class="o">&amp;</span> <span class="n">SW_C1</span><span class="p">))</span>
				<span class="cm">/* This bit distinguishes over- from underflow for a stack fault,</span>
<span class="cm">				   and roundup from round-down for precision loss. */</span>
				<span class="n">partial_status</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW_C1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">RE_ENTRANT_CHECK_OFF</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="o">~</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">n</span> <span class="o">&amp;</span> <span class="n">CW_Exceptions</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">EX_INTERNAL</span><span class="p">))</span> <span class="p">{</span>
<span class="cp">#ifdef PRINT_MESSAGES</span>
		<span class="cm">/* My message from the sponsor */</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">FPU_VERSION</span> <span class="s">&quot; &quot;</span> <span class="n">__DATE__</span> <span class="s">&quot; (C) W. Metzenthen.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* PRINT_MESSAGES */</span><span class="cp"></span>

		<span class="cm">/* Get a name string for error reporting */</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">exception_names</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">exception_names</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span> <span class="o">&amp;</span> <span class="n">n</span><span class="p">)</span> <span class="o">==</span>
			    <span class="n">exception_names</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">exception_names</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#ifdef PRINT_MESSAGES</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;FP Exception: %s!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">exception_names</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* PRINT_MESSAGES */</span><span class="cp"></span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;FPU emulator: Unknown Exception: 0x%04x!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="n">EX_INTERNAL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;FPU emulator: Internal error type 0x%04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">int_type</span><span class="p">);</span>
			<span class="n">FPU_printall</span><span class="p">();</span>
		<span class="p">}</span>
<span class="cp">#ifdef PRINT_MESSAGES</span>
		<span class="k">else</span>
			<span class="n">FPU_printall</span><span class="p">();</span>
<span class="cp">#endif </span><span class="cm">/* PRINT_MESSAGES */</span><span class="cp"></span>

		<span class="cm">/*</span>
<span class="cm">		 * The 80486 generates an interrupt on the next non-control FPU</span>
<span class="cm">		 * instruction. So we need some means of flagging it.</span>
<span class="cm">		 * We use the ES (Error Summary) bit for this.</span>
<span class="cm">		 */</span>
	<span class="p">}</span>
	<span class="n">RE_ENTRANT_CHECK_ON</span><span class="p">;</span>

<span class="cp">#ifdef __DEBUG__</span>
	<span class="n">math_abort</span><span class="p">(</span><span class="n">FPU_info</span><span class="p">,</span> <span class="n">SIGFPE</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* __DEBUG__ */</span><span class="cp"></span>

<span class="p">}</span>

<span class="cm">/* Real operation attempted on a NaN. */</span>
<span class="cm">/* Returns &lt; 0 if the exception is unmasked */</span>
<span class="kt">int</span> <span class="nf">real_1op_NaN</span><span class="p">(</span><span class="n">FPU_REG</span> <span class="o">*</span><span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">signalling</span><span class="p">,</span> <span class="n">isNaN</span><span class="p">;</span>

	<span class="n">isNaN</span> <span class="o">=</span> <span class="p">(</span><span class="n">exponent</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="n">EXP_OVER</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">);</span>

	<span class="cm">/* The default result for the case of two &quot;equal&quot; NaNs (signs may</span>
<span class="cm">	   differ) is chosen to reproduce 80486 behaviour */</span>
	<span class="n">signalling</span> <span class="o">=</span> <span class="n">isNaN</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="mh">0x40000000</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">signalling</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isNaN</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* pseudo-NaN, or other unsupported? */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* Masked response */</span>
				<span class="n">reg_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_QNaN</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Invalid</span><span class="p">);</span>
			<span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="o">?</span> <span class="n">FPU_Exception</span> <span class="o">:</span>
				<span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">TAG_Special</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">TAG_Special</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The masked response */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">))</span> <span class="p">{</span>	<span class="cm">/* pseudo-NaN ? */</span>
			<span class="n">reg_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_QNaN</span><span class="p">,</span> <span class="n">a</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="cm">/* ensure a Quiet NaN */</span>
		<span class="n">a</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">|=</span> <span class="mh">0x40000000</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Invalid</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="o">?</span> <span class="n">FPU_Exception</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">TAG_Special</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Real operation attempted on two operands, one a NaN. */</span>
<span class="cm">/* Returns &lt; 0 if the exception is unmasked */</span>
<span class="kt">int</span> <span class="nf">real_2op_NaN</span><span class="p">(</span><span class="n">FPU_REG</span> <span class="k">const</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="n">u_char</span> <span class="n">tagb</span><span class="p">,</span>
		 <span class="kt">int</span> <span class="n">deststnr</span><span class="p">,</span> <span class="n">FPU_REG</span> <span class="k">const</span> <span class="o">*</span><span class="n">defaultNaN</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">FPU_REG</span> <span class="o">*</span><span class="n">dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">(</span><span class="n">deststnr</span><span class="p">);</span>
	<span class="n">FPU_REG</span> <span class="k">const</span> <span class="o">*</span><span class="n">a</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
	<span class="n">u_char</span> <span class="n">taga</span> <span class="o">=</span> <span class="n">FPU_gettagi</span><span class="p">(</span><span class="n">deststnr</span><span class="p">);</span>
	<span class="n">FPU_REG</span> <span class="k">const</span> <span class="o">*</span><span class="n">x</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">signalling</span><span class="p">,</span> <span class="n">unsupported</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">taga</span> <span class="o">==</span> <span class="n">TAG_Special</span><span class="p">)</span>
		<span class="n">taga</span> <span class="o">=</span> <span class="n">FPU_Special</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tagb</span> <span class="o">==</span> <span class="n">TAG_Special</span><span class="p">)</span>
		<span class="n">tagb</span> <span class="o">=</span> <span class="n">FPU_Special</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>

	<span class="cm">/* TW_NaN is also used for unsupported data types. */</span>
	<span class="n">unsupported</span> <span class="o">=</span> <span class="p">((</span><span class="n">taga</span> <span class="o">==</span> <span class="n">TW_NaN</span><span class="p">)</span>
		       <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">((</span><span class="n">exponent</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="n">EXP_OVER</span><span class="p">)</span>
			    <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">)))</span>
	    <span class="o">||</span> <span class="p">((</span><span class="n">tagb</span> <span class="o">==</span> <span class="n">TW_NaN</span><span class="p">)</span>
		<span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">((</span><span class="n">exponent</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="n">EXP_OVER</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">)));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unsupported</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Masked response */</span>
			<span class="n">FPU_copy_to_regi</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_QNaN</span><span class="p">,</span> <span class="n">TAG_Special</span><span class="p">,</span> <span class="n">deststnr</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Invalid</span><span class="p">);</span>
		<span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="o">?</span> <span class="n">FPU_Exception</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
		    <span class="n">TAG_Special</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">taga</span> <span class="o">==</span> <span class="n">TW_NaN</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">tagb</span> <span class="o">==</span> <span class="n">TW_NaN</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">signalling</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="n">b</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="mh">0x40000000</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">significand</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">significand</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
				<span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">significand</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="n">significand</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="p">{</span>
				<span class="cm">/* The default result for the case of two &quot;equal&quot; NaNs (signs may</span>
<span class="cm">				   differ) is chosen to reproduce 80486 behaviour */</span>
				<span class="n">x</span> <span class="o">=</span> <span class="n">defaultNaN</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/* return the quiet version of the NaN in a */</span>
			<span class="n">signalling</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">a</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="mh">0x40000000</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span>
<span class="cp">#ifdef PARANOID</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tagb</span> <span class="o">==</span> <span class="n">TW_NaN</span><span class="p">)</span>
<span class="cp">#endif </span><span class="cm">/* PARANOID */</span><span class="cp"></span>
	<span class="p">{</span>
		<span class="n">signalling</span> <span class="o">=</span> <span class="o">!</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="mh">0x40000000</span><span class="p">);</span>
		<span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">#ifdef PARANOID</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">signalling</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_INTERNAL</span> <span class="o">|</span> <span class="mh">0x113</span><span class="p">);</span>
		<span class="n">x</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">CONST_QNaN</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* PARANOID */</span><span class="cp"></span>

	<span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="n">signalling</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">x</span><span class="p">)</span>
			<span class="n">x</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">&amp;</span> <span class="mh">0x80000000</span><span class="p">))</span>	<span class="cm">/* pseudo-NaN ? */</span>
			<span class="n">x</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">CONST_QNaN</span><span class="p">;</span>

		<span class="n">FPU_copy_to_regi</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">TAG_Special</span><span class="p">,</span> <span class="n">deststnr</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">signalling</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">TAG_Special</span><span class="p">;</span>

		<span class="cm">/* ensure a Quiet NaN */</span>
		<span class="n">dest</span><span class="o">-&gt;</span><span class="n">sigh</span> <span class="o">|=</span> <span class="mh">0x40000000</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Invalid</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="o">?</span> <span class="n">FPU_Exception</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">TAG_Special</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Invalid arith operation on Valid registers */</span>
<span class="cm">/* Returns &lt; 0 if the exception is unmasked */</span>
<span class="n">asmlinkage</span> <span class="kt">int</span> <span class="nf">arith_invalid</span><span class="p">(</span><span class="kt">int</span> <span class="n">deststnr</span><span class="p">)</span>
<span class="p">{</span>

	<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Invalid</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The masked response */</span>
		<span class="n">FPU_copy_to_regi</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_QNaN</span><span class="p">,</span> <span class="n">TAG_Special</span><span class="p">,</span> <span class="n">deststnr</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="o">?</span> <span class="n">FPU_Exception</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">TAG_Valid</span><span class="p">;</span>

<span class="p">}</span>

<span class="cm">/* Divide a finite number by zero */</span>
<span class="n">asmlinkage</span> <span class="kt">int</span> <span class="nf">FPU_divide_by_zero</span><span class="p">(</span><span class="kt">int</span> <span class="n">deststnr</span><span class="p">,</span> <span class="n">u_char</span> <span class="n">sign</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">FPU_REG</span> <span class="o">*</span><span class="n">dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">st</span><span class="p">(</span><span class="n">deststnr</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_Valid</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_ZeroDiv</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The masked response */</span>
		<span class="n">FPU_copy_to_regi</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_INF</span><span class="p">,</span> <span class="n">TAG_Special</span><span class="p">,</span> <span class="n">deststnr</span><span class="p">);</span>
		<span class="n">setsign</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">sign</span><span class="p">);</span>
		<span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_Special</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_ZeroDiv</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_ZeroDiv</span><span class="p">)</span> <span class="o">?</span> <span class="n">FPU_Exception</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="n">tag</span><span class="p">;</span>

<span class="p">}</span>

<span class="cm">/* This may be called often, so keep it lean */</span>
<span class="kt">int</span> <span class="nf">set_precision_flag</span><span class="p">(</span><span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Precision</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">partial_status</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">SW_C1</span> <span class="o">&amp;</span> <span class="n">flags</span><span class="p">);</span>
		<span class="n">partial_status</span> <span class="o">|=</span> <span class="n">flags</span><span class="p">;</span>	<span class="cm">/* The masked response */</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* This may be called often, so keep it lean */</span>
<span class="n">asmlinkage</span> <span class="kt">void</span> <span class="nf">set_precision_flag_up</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Precision</span><span class="p">)</span>
		<span class="n">partial_status</span> <span class="o">|=</span> <span class="p">(</span><span class="n">SW_Precision</span> <span class="o">|</span> <span class="n">SW_C1</span><span class="p">);</span>	<span class="cm">/* The masked response */</span>
	<span class="k">else</span>
		<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Precision</span> <span class="o">|</span> <span class="n">SW_C1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* This may be called often, so keep it lean */</span>
<span class="n">asmlinkage</span> <span class="kt">void</span> <span class="nf">set_precision_flag_down</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Precision</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* The masked response */</span>
		<span class="n">partial_status</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW_C1</span><span class="p">;</span>
		<span class="n">partial_status</span> <span class="o">|=</span> <span class="n">SW_Precision</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Precision</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">asmlinkage</span> <span class="kt">int</span> <span class="nf">denormal_operand</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Denormal</span><span class="p">)</span> <span class="p">{</span>	<span class="cm">/* The masked response */</span>
		<span class="n">partial_status</span> <span class="o">|=</span> <span class="n">SW_Denorm_Op</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">TAG_Special</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Denormal</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">TAG_Special</span> <span class="o">|</span> <span class="n">FPU_Exception</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="n">asmlinkage</span> <span class="kt">int</span> <span class="nf">arith_overflow</span><span class="p">(</span><span class="n">FPU_REG</span> <span class="o">*</span><span class="n">dest</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_Valid</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Overflow</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The masked response */</span>
<span class="cm">/* ###### The response here depends upon the rounding mode */</span>
		<span class="n">reg_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_INF</span><span class="p">,</span> <span class="n">dest</span><span class="p">);</span>
		<span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_Special</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* Subtract the magic number from the exponent */</span>
		<span class="n">addexponent</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)));</span>
	<span class="p">}</span>

	<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Overflow</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Overflow</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The overflow exception is masked. */</span>
		<span class="cm">/* By definition, precision is lost.</span>
<span class="cm">		   The roundup bit (C1) is also set because we have</span>
<span class="cm">		   &quot;rounded&quot; upwards to Infinity. */</span>
		<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Precision</span> <span class="o">|</span> <span class="n">SW_C1</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">tag</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">tag</span><span class="p">;</span>

<span class="p">}</span>

<span class="n">asmlinkage</span> <span class="kt">int</span> <span class="nf">arith_underflow</span><span class="p">(</span><span class="n">FPU_REG</span> <span class="o">*</span><span class="n">dest</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_Valid</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Underflow</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The masked response */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">exponent16</span><span class="p">(</span><span class="n">dest</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">EXP_UNDER</span> <span class="o">-</span> <span class="mi">63</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">reg_copy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_Z</span><span class="p">,</span> <span class="n">dest</span><span class="p">);</span>
			<span class="n">partial_status</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SW_C1</span><span class="p">;</span>	<span class="cm">/* Round down. */</span>
			<span class="n">tag</span> <span class="o">=</span> <span class="n">TAG_Zero</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">stdexp</span><span class="p">(</span><span class="n">dest</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* Add the magic number to the exponent. */</span>
		<span class="n">addexponent</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">))</span> <span class="o">+</span> <span class="n">EXTENDED_Ebias</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Underflow</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Underflow</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The underflow exception is masked. */</span>
		<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_Precision</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">tag</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">tag</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">FPU_stack_overflow</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The masked response */</span>
		<span class="n">top</span><span class="o">--</span><span class="p">;</span>
		<span class="n">FPU_copy_to_reg0</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_QNaN</span><span class="p">,</span> <span class="n">TAG_Special</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_StackOver</span><span class="p">);</span>

	<span class="k">return</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">FPU_stack_underflow</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The masked response */</span>
		<span class="n">FPU_copy_to_reg0</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_QNaN</span><span class="p">,</span> <span class="n">TAG_Special</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_StackUnder</span><span class="p">);</span>

	<span class="k">return</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">FPU_stack_underflow_i</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The masked response */</span>
		<span class="n">FPU_copy_to_regi</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_QNaN</span><span class="p">,</span> <span class="n">TAG_Special</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_StackUnder</span><span class="p">);</span>

	<span class="k">return</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">FPU_stack_underflow_pop</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">control_word</span> <span class="o">&amp;</span> <span class="n">CW_Invalid</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The masked response */</span>
		<span class="n">FPU_copy_to_regi</span><span class="p">(</span><span class="o">&amp;</span><span class="n">CONST_QNaN</span><span class="p">,</span> <span class="n">TAG_Special</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">FPU_pop</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="n">EXCEPTION</span><span class="p">(</span><span class="n">EX_StackUnder</span><span class="p">);</span>

	<span class="k">return</span><span class="p">;</span>

<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
