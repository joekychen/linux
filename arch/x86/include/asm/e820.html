<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › x86 › include › asm › e820.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>e820.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_X86_E820_H</span>
<span class="cp">#define _ASM_X86_E820_H</span>
<span class="cp">#define E820MAP	0x2d0		</span><span class="cm">/* our map */</span><span class="cp"></span>
<span class="cp">#define E820MAX	128		</span><span class="cm">/* number of entries in E820MAP */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Legacy E820 BIOS limits us to 128 (E820MAX) nodes due to the</span>
<span class="cm"> * constrained space in the zeropage.  If we have more nodes than</span>
<span class="cm"> * that, and if we&#39;ve booted off EFI firmware, then the EFI tables</span>
<span class="cm"> * passed us from the EFI firmware can list more nodes.  Size our</span>
<span class="cm"> * internal memory map tables to have room for these additional</span>
<span class="cm"> * nodes, based on up to three entries per node for which the</span>
<span class="cm"> * kernel was built: MAX_NUMNODES == (1 &lt;&lt; CONFIG_NODES_SHIFT),</span>
<span class="cm"> * plus E820MAX, allowing space for the possible duplicate E820</span>
<span class="cm"> * entries that might need room in the same arrays, prior to the</span>
<span class="cm"> * call to sanitize_e820_map() to remove duplicates.  The allowance</span>
<span class="cm"> * of three memory map entries per node is &quot;enough&quot; entries for</span>
<span class="cm"> * the initial hardware platform motivating this mechanism to make</span>
<span class="cm"> * use of additional EFI map entries.  Future platforms may want</span>
<span class="cm"> * to allow more than three entries per node or otherwise refine</span>
<span class="cm"> * this size.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Odd: &#39;make headers_check&#39; complains about numa.h if I try</span>
<span class="cm"> * to collapse the next two #ifdef lines to a single line:</span>
<span class="cm"> *	#if defined(__KERNEL__) &amp;&amp; defined(CONFIG_EFI)</span>
<span class="cm"> */</span>
<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#ifdef CONFIG_EFI</span>
<span class="cp">#include &lt;linux/numa.h&gt;</span>
<span class="cp">#define E820_X_MAX (E820MAX + 3 * MAX_NUMNODES)</span>
<span class="cp">#else	</span><span class="cm">/* ! CONFIG_EFI */</span><span class="cp"></span>
<span class="cp">#define E820_X_MAX E820MAX</span>
<span class="cp">#endif</span>
<span class="cp">#else	</span><span class="cm">/* ! __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#define E820_X_MAX E820MAX</span>
<span class="cp">#endif</span>

<span class="cp">#define E820NR	0x1e8		</span><span class="cm">/* # entries in E820MAP */</span><span class="cp"></span>

<span class="cp">#define E820_RAM	1</span>
<span class="cp">#define E820_RESERVED	2</span>
<span class="cp">#define E820_ACPI	3</span>
<span class="cp">#define E820_NVS	4</span>
<span class="cp">#define E820_UNUSABLE	5</span>

<span class="cm">/*</span>
<span class="cm"> * reserved RAM used by kernel itself</span>
<span class="cm"> * if CONFIG_INTEL_TXT is enabled, memory of this type will be</span>
<span class="cm"> * included in the S3 integrity calculation and so should not include</span>
<span class="cm"> * any memory that BIOS might alter over the S3 transition</span>
<span class="cm"> */</span>
<span class="cp">#define E820_RESERVED_KERN        128</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="k">struct</span> <span class="n">e820entry</span> <span class="p">{</span>
	<span class="n">__u64</span> <span class="n">addr</span><span class="p">;</span>	<span class="cm">/* start of memory segment */</span>
	<span class="n">__u64</span> <span class="n">size</span><span class="p">;</span>	<span class="cm">/* size of memory segment */</span>
	<span class="n">__u32</span> <span class="n">type</span><span class="p">;</span>	<span class="cm">/* type of memory segment */</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">packed</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">e820map</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">nr_map</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">e820entry</span> <span class="n">map</span><span class="p">[</span><span class="n">E820_X_MAX</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define ISA_START_ADDRESS	0xa0000</span>
<span class="cp">#define ISA_END_ADDRESS		0x100000</span>

<span class="cp">#define BIOS_BEGIN		0x000a0000</span>
<span class="cp">#define BIOS_END		0x00100000</span>

<span class="cp">#define BIOS_ROM_BASE		0xffe00000</span>
<span class="cp">#define BIOS_ROM_END		0xffffffff</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cm">/* see comment in arch/x86/kernel/e820.c */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">e820map</span> <span class="n">e820</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">e820map</span> <span class="n">e820_saved</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pci_mem_start</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">e820_any_mapped</span><span class="p">(</span><span class="n">u64</span> <span class="n">start</span><span class="p">,</span> <span class="n">u64</span> <span class="n">end</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">type</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">e820_all_mapped</span><span class="p">(</span><span class="n">u64</span> <span class="n">start</span><span class="p">,</span> <span class="n">u64</span> <span class="n">end</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">type</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">e820_add_region</span><span class="p">(</span><span class="n">u64</span> <span class="n">start</span><span class="p">,</span> <span class="n">u64</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">e820_print_map</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">who</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>
<span class="n">sanitize_e820_map</span><span class="p">(</span><span class="k">struct</span> <span class="n">e820entry</span> <span class="o">*</span><span class="n">biosmap</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max_nr_map</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">pnr_map</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u64</span> <span class="n">e820_update_range</span><span class="p">(</span><span class="n">u64</span> <span class="n">start</span><span class="p">,</span> <span class="n">u64</span> <span class="n">size</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">old_type</span><span class="p">,</span>
			       <span class="kt">unsigned</span> <span class="n">new_type</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u64</span> <span class="n">e820_remove_range</span><span class="p">(</span><span class="n">u64</span> <span class="n">start</span><span class="p">,</span> <span class="n">u64</span> <span class="n">size</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">old_type</span><span class="p">,</span>
			     <span class="kt">int</span> <span class="n">checktype</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">update_e820</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">e820_setup_gap</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">e820_search_gap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">gapstart</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">gapsize</span><span class="p">,</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start_addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="n">end_addr</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">setup_data</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">parse_e820_ext</span><span class="p">(</span><span class="k">struct</span> <span class="n">setup_data</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>

<span class="cp">#if defined(CONFIG_X86_64) || \</span>
<span class="cp">	(defined(CONFIG_X86_32) &amp;&amp; defined(CONFIG_HIBERNATION))</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">e820_mark_nosave_regions</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">limit_pfn</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">e820_mark_nosave_regions</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">limit_pfn</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_MEMTEST</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">early_memtest</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">end</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">early_memtest</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">start</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">end</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">e820_end_of_ram_pfn</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">e820_end_of_low_ram_pfn</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u64</span> <span class="n">early_reserve_e820</span><span class="p">(</span><span class="n">u64</span> <span class="n">sizet</span><span class="p">,</span> <span class="n">u64</span> <span class="n">align</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">memblock_x86_fill</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">memblock_find_dma_reserve</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">finish_e820_parsing</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">e820_reserve_resources</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">e820_reserve_resources_late</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">setup_memory_map</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="n">default_machine_specific_memory_setup</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Returns true iff the specified range [s,e) is completely contained inside</span>
<span class="cm"> * the ISA region.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">is_ISA_range</span><span class="p">(</span><span class="n">u64</span> <span class="n">s</span><span class="p">,</span> <span class="n">u64</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="n">ISA_START_ADDRESS</span> <span class="o">&amp;&amp;</span> <span class="n">e</span> <span class="o">&lt;=</span> <span class="n">ISA_END_ADDRESS</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#include &lt;linux/ioport.h&gt;</span>

<span class="cp">#define HIGH_MEMORY	(1024*1024)</span>
<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _ASM_X86_E820_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
