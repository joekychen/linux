<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › x86 › include › asm › hyperv.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>hyperv.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_X86_HYPERV_H</span>
<span class="cp">#define _ASM_X86_HYPERV_H</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * The below CPUID leaves are present if VersionAndFeatures.HypervisorPresent</span>
<span class="cm"> * is set by CPUID(HvCpuIdFunctionVersionAndFeatures).</span>
<span class="cm"> */</span>
<span class="cp">#define HYPERV_CPUID_VENDOR_AND_MAX_FUNCTIONS	0x40000000</span>
<span class="cp">#define HYPERV_CPUID_INTERFACE			0x40000001</span>
<span class="cp">#define HYPERV_CPUID_VERSION			0x40000002</span>
<span class="cp">#define HYPERV_CPUID_FEATURES			0x40000003</span>
<span class="cp">#define HYPERV_CPUID_ENLIGHTMENT_INFO		0x40000004</span>
<span class="cp">#define HYPERV_CPUID_IMPLEMENT_LIMITS		0x40000005</span>

<span class="cp">#define HYPERV_HYPERVISOR_PRESENT_BIT		0x80000000</span>
<span class="cp">#define HYPERV_CPUID_MIN			0x40000005</span>
<span class="cp">#define HYPERV_CPUID_MAX			0x4000ffff</span>

<span class="cm">/*</span>
<span class="cm"> * Feature identification. EAX indicates which features are available</span>
<span class="cm"> * to the partition based upon the current partition privileges.</span>
<span class="cm"> */</span>

<span class="cm">/* VP Runtime (HV_X64_MSR_VP_RUNTIME) available */</span>
<span class="cp">#define HV_X64_MSR_VP_RUNTIME_AVAILABLE		(1 &lt;&lt; 0)</span>
<span class="cm">/* Partition Reference Counter (HV_X64_MSR_TIME_REF_COUNT) available*/</span>
<span class="cp">#define HV_X64_MSR_TIME_REF_COUNT_AVAILABLE	(1 &lt;&lt; 1)</span>
<span class="cm">/*</span>
<span class="cm"> * Basic SynIC MSRs (HV_X64_MSR_SCONTROL through HV_X64_MSR_EOM</span>
<span class="cm"> * and HV_X64_MSR_SINT0 through HV_X64_MSR_SINT15) available</span>
<span class="cm"> */</span>
<span class="cp">#define HV_X64_MSR_SYNIC_AVAILABLE		(1 &lt;&lt; 2)</span>
<span class="cm">/*</span>
<span class="cm"> * Synthetic Timer MSRs (HV_X64_MSR_STIMER0_CONFIG through</span>
<span class="cm"> * HV_X64_MSR_STIMER3_COUNT) available</span>
<span class="cm"> */</span>
<span class="cp">#define HV_X64_MSR_SYNTIMER_AVAILABLE		(1 &lt;&lt; 3)</span>
<span class="cm">/*</span>
<span class="cm"> * APIC access MSRs (HV_X64_MSR_EOI, HV_X64_MSR_ICR and HV_X64_MSR_TPR)</span>
<span class="cm"> * are available</span>
<span class="cm"> */</span>
<span class="cp">#define HV_X64_MSR_APIC_ACCESS_AVAILABLE	(1 &lt;&lt; 4)</span>
<span class="cm">/* Hypercall MSRs (HV_X64_MSR_GUEST_OS_ID and HV_X64_MSR_HYPERCALL) available*/</span>
<span class="cp">#define HV_X64_MSR_HYPERCALL_AVAILABLE		(1 &lt;&lt; 5)</span>
<span class="cm">/* Access virtual processor index MSR (HV_X64_MSR_VP_INDEX) available*/</span>
<span class="cp">#define HV_X64_MSR_VP_INDEX_AVAILABLE		(1 &lt;&lt; 6)</span>
<span class="cm">/* Virtual system reset MSR (HV_X64_MSR_RESET) is available*/</span>
<span class="cp">#define HV_X64_MSR_RESET_AVAILABLE		(1 &lt;&lt; 7)</span>
 <span class="cm">/*</span>
<span class="cm">  * Access statistics pages MSRs (HV_X64_MSR_STATS_PARTITION_RETAIL_PAGE,</span>
<span class="cm">  * HV_X64_MSR_STATS_PARTITION_INTERNAL_PAGE, HV_X64_MSR_STATS_VP_RETAIL_PAGE,</span>
<span class="cm">  * HV_X64_MSR_STATS_VP_INTERNAL_PAGE) available</span>
<span class="cm">  */</span>
<span class="cp">#define HV_X64_MSR_STAT_PAGES_AVAILABLE		(1 &lt;&lt; 8)</span>

<span class="cm">/*</span>
<span class="cm"> * Feature identification: EBX indicates which flags were specified at</span>
<span class="cm"> * partition creation. The format is the same as the partition creation</span>
<span class="cm"> * flag structure defined in section Partition Creation Flags.</span>
<span class="cm"> */</span>
<span class="cp">#define HV_X64_CREATE_PARTITIONS		(1 &lt;&lt; 0)</span>
<span class="cp">#define HV_X64_ACCESS_PARTITION_ID		(1 &lt;&lt; 1)</span>
<span class="cp">#define HV_X64_ACCESS_MEMORY_POOL		(1 &lt;&lt; 2)</span>
<span class="cp">#define HV_X64_ADJUST_MESSAGE_BUFFERS		(1 &lt;&lt; 3)</span>
<span class="cp">#define HV_X64_POST_MESSAGES			(1 &lt;&lt; 4)</span>
<span class="cp">#define HV_X64_SIGNAL_EVENTS			(1 &lt;&lt; 5)</span>
<span class="cp">#define HV_X64_CREATE_PORT			(1 &lt;&lt; 6)</span>
<span class="cp">#define HV_X64_CONNECT_PORT			(1 &lt;&lt; 7)</span>
<span class="cp">#define HV_X64_ACCESS_STATS			(1 &lt;&lt; 8)</span>
<span class="cp">#define HV_X64_DEBUGGING			(1 &lt;&lt; 11)</span>
<span class="cp">#define HV_X64_CPU_POWER_MANAGEMENT		(1 &lt;&lt; 12)</span>
<span class="cp">#define HV_X64_CONFIGURE_PROFILER		(1 &lt;&lt; 13)</span>

<span class="cm">/*</span>
<span class="cm"> * Feature identification. EDX indicates which miscellaneous features</span>
<span class="cm"> * are available to the partition.</span>
<span class="cm"> */</span>
<span class="cm">/* The MWAIT instruction is available (per section MONITOR / MWAIT) */</span>
<span class="cp">#define HV_X64_MWAIT_AVAILABLE				(1 &lt;&lt; 0)</span>
<span class="cm">/* Guest debugging support is available */</span>
<span class="cp">#define HV_X64_GUEST_DEBUGGING_AVAILABLE		(1 &lt;&lt; 1)</span>
<span class="cm">/* Performance Monitor support is available*/</span>
<span class="cp">#define HV_X64_PERF_MONITOR_AVAILABLE			(1 &lt;&lt; 2)</span>
<span class="cm">/* Support for physical CPU dynamic partitioning events is available*/</span>
<span class="cp">#define HV_X64_CPU_DYNAMIC_PARTITIONING_AVAILABLE	(1 &lt;&lt; 3)</span>
<span class="cm">/*</span>
<span class="cm"> * Support for passing hypercall input parameter block via XMM</span>
<span class="cm"> * registers is available</span>
<span class="cm"> */</span>
<span class="cp">#define HV_X64_HYPERCALL_PARAMS_XMM_AVAILABLE		(1 &lt;&lt; 4)</span>
<span class="cm">/* Support for a virtual guest idle state is available */</span>
<span class="cp">#define HV_X64_GUEST_IDLE_STATE_AVAILABLE		(1 &lt;&lt; 5)</span>

<span class="cm">/*</span>
<span class="cm"> * Implementation recommendations. Indicates which behaviors the hypervisor</span>
<span class="cm"> * recommends the OS implement for optimal performance.</span>
<span class="cm"> */</span>
 <span class="cm">/*</span>
<span class="cm">  * Recommend using hypercall for address space switches rather</span>
<span class="cm">  * than MOV to CR3 instruction</span>
<span class="cm">  */</span>
<span class="cp">#define HV_X64_MWAIT_RECOMMENDED		(1 &lt;&lt; 0)</span>
<span class="cm">/* Recommend using hypercall for local TLB flushes rather</span>
<span class="cm"> * than INVLPG or MOV to CR3 instructions */</span>
<span class="cp">#define HV_X64_LOCAL_TLB_FLUSH_RECOMMENDED	(1 &lt;&lt; 1)</span>
<span class="cm">/*</span>
<span class="cm"> * Recommend using hypercall for remote TLB flushes rather</span>
<span class="cm"> * than inter-processor interrupts</span>
<span class="cm"> */</span>
<span class="cp">#define HV_X64_REMOTE_TLB_FLUSH_RECOMMENDED	(1 &lt;&lt; 2)</span>
<span class="cm">/*</span>
<span class="cm"> * Recommend using MSRs for accessing APIC registers</span>
<span class="cm"> * EOI, ICR and TPR rather than their memory-mapped counterparts</span>
<span class="cm"> */</span>
<span class="cp">#define HV_X64_APIC_ACCESS_RECOMMENDED		(1 &lt;&lt; 3)</span>
<span class="cm">/* Recommend using the hypervisor-provided MSR to initiate a system RESET */</span>
<span class="cp">#define HV_X64_SYSTEM_RESET_RECOMMENDED		(1 &lt;&lt; 4)</span>
<span class="cm">/*</span>
<span class="cm"> * Recommend using relaxed timing for this partition. If used,</span>
<span class="cm"> * the VM should disable any watchdog timeouts that rely on the</span>
<span class="cm"> * timely delivery of external interrupts</span>
<span class="cm"> */</span>
<span class="cp">#define HV_X64_RELAXED_TIMING_RECOMMENDED	(1 &lt;&lt; 5)</span>

<span class="cm">/* MSR used to identify the guest OS. */</span>
<span class="cp">#define HV_X64_MSR_GUEST_OS_ID			0x40000000</span>

<span class="cm">/* MSR used to setup pages used to communicate with the hypervisor. */</span>
<span class="cp">#define HV_X64_MSR_HYPERCALL			0x40000001</span>

<span class="cm">/* MSR used to provide vcpu index */</span>
<span class="cp">#define HV_X64_MSR_VP_INDEX			0x40000002</span>

<span class="cm">/* MSR used to read the per-partition time reference counter */</span>
<span class="cp">#define HV_X64_MSR_TIME_REF_COUNT		0x40000020</span>

<span class="cm">/* Define the virtual APIC registers */</span>
<span class="cp">#define HV_X64_MSR_EOI				0x40000070</span>
<span class="cp">#define HV_X64_MSR_ICR				0x40000071</span>
<span class="cp">#define HV_X64_MSR_TPR				0x40000072</span>
<span class="cp">#define HV_X64_MSR_APIC_ASSIST_PAGE		0x40000073</span>

<span class="cm">/* Define synthetic interrupt controller model specific registers. */</span>
<span class="cp">#define HV_X64_MSR_SCONTROL			0x40000080</span>
<span class="cp">#define HV_X64_MSR_SVERSION			0x40000081</span>
<span class="cp">#define HV_X64_MSR_SIEFP			0x40000082</span>
<span class="cp">#define HV_X64_MSR_SIMP				0x40000083</span>
<span class="cp">#define HV_X64_MSR_EOM				0x40000084</span>
<span class="cp">#define HV_X64_MSR_SINT0			0x40000090</span>
<span class="cp">#define HV_X64_MSR_SINT1			0x40000091</span>
<span class="cp">#define HV_X64_MSR_SINT2			0x40000092</span>
<span class="cp">#define HV_X64_MSR_SINT3			0x40000093</span>
<span class="cp">#define HV_X64_MSR_SINT4			0x40000094</span>
<span class="cp">#define HV_X64_MSR_SINT5			0x40000095</span>
<span class="cp">#define HV_X64_MSR_SINT6			0x40000096</span>
<span class="cp">#define HV_X64_MSR_SINT7			0x40000097</span>
<span class="cp">#define HV_X64_MSR_SINT8			0x40000098</span>
<span class="cp">#define HV_X64_MSR_SINT9			0x40000099</span>
<span class="cp">#define HV_X64_MSR_SINT10			0x4000009A</span>
<span class="cp">#define HV_X64_MSR_SINT11			0x4000009B</span>
<span class="cp">#define HV_X64_MSR_SINT12			0x4000009C</span>
<span class="cp">#define HV_X64_MSR_SINT13			0x4000009D</span>
<span class="cp">#define HV_X64_MSR_SINT14			0x4000009E</span>
<span class="cp">#define HV_X64_MSR_SINT15			0x4000009F</span>


<span class="cp">#define HV_X64_MSR_HYPERCALL_ENABLE		0x00000001</span>
<span class="cp">#define HV_X64_MSR_HYPERCALL_PAGE_ADDRESS_SHIFT	12</span>
<span class="cp">#define HV_X64_MSR_HYPERCALL_PAGE_ADDRESS_MASK	\</span>
<span class="cp">		(~((1ull &lt;&lt; HV_X64_MSR_HYPERCALL_PAGE_ADDRESS_SHIFT) - 1))</span>

<span class="cm">/* Declare the various hypercall operations. */</span>
<span class="cp">#define HV_X64_HV_NOTIFY_LONG_SPIN_WAIT		0x0008</span>

<span class="cp">#define HV_X64_MSR_APIC_ASSIST_PAGE_ENABLE		0x00000001</span>
<span class="cp">#define HV_X64_MSR_APIC_ASSIST_PAGE_ADDRESS_SHIFT	12</span>
<span class="cp">#define HV_X64_MSR_APIC_ASSIST_PAGE_ADDRESS_MASK	\</span>
<span class="cp">		(~((1ull &lt;&lt; HV_X64_MSR_APIC_ASSIST_PAGE_ADDRESS_SHIFT) - 1))</span>

<span class="cp">#define HV_PROCESSOR_POWER_STATE_C0		0</span>
<span class="cp">#define HV_PROCESSOR_POWER_STATE_C1		1</span>
<span class="cp">#define HV_PROCESSOR_POWER_STATE_C2		2</span>
<span class="cp">#define HV_PROCESSOR_POWER_STATE_C3		3</span>

<span class="cm">/* hypercall status code */</span>
<span class="cp">#define HV_STATUS_SUCCESS			0</span>
<span class="cp">#define HV_STATUS_INVALID_HYPERCALL_CODE	2</span>
<span class="cp">#define HV_STATUS_INVALID_HYPERCALL_INPUT	3</span>
<span class="cp">#define HV_STATUS_INVALID_ALIGNMENT		4</span>
<span class="cp">#define HV_STATUS_INSUFFICIENT_BUFFERS		19</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
