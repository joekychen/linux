<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › x86 › include › asm › nops.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>nops.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_X86_NOPS_H</span>
<span class="cp">#define _ASM_X86_NOPS_H</span>

<span class="cm">/*</span>
<span class="cm"> * Define nops for use with alternative() and for tracing.</span>
<span class="cm"> *</span>
<span class="cm"> * *_NOP5_ATOMIC must be a single instruction.</span>
<span class="cm"> */</span>

<span class="cp">#define NOP_DS_PREFIX 0x3e</span>

<span class="cm">/* generic versions from gas</span>
<span class="cm">   1: nop</span>
<span class="cm">   the following instructions are NOT nops in 64-bit mode,</span>
<span class="cm">   for 64-bit mode use K8 or P6 nops instead</span>
<span class="cm">   2: movl %esi,%esi</span>
<span class="cm">   3: leal 0x00(%esi),%esi</span>
<span class="cm">   4: leal 0x00(,%esi,1),%esi</span>
<span class="cm">   6: leal 0x00000000(%esi),%esi</span>
<span class="cm">   7: leal 0x00000000(,%esi,1),%esi</span>
<span class="cm">*/</span>
<span class="cp">#define GENERIC_NOP1 0x90</span>
<span class="cp">#define GENERIC_NOP2 0x89,0xf6</span>
<span class="cp">#define GENERIC_NOP3 0x8d,0x76,0x00</span>
<span class="cp">#define GENERIC_NOP4 0x8d,0x74,0x26,0x00</span>
<span class="cp">#define GENERIC_NOP5 GENERIC_NOP1,GENERIC_NOP4</span>
<span class="cp">#define GENERIC_NOP6 0x8d,0xb6,0x00,0x00,0x00,0x00</span>
<span class="cp">#define GENERIC_NOP7 0x8d,0xb4,0x26,0x00,0x00,0x00,0x00</span>
<span class="cp">#define GENERIC_NOP8 GENERIC_NOP1,GENERIC_NOP7</span>
<span class="cp">#define GENERIC_NOP5_ATOMIC NOP_DS_PREFIX,GENERIC_NOP4</span>

<span class="cm">/* Opteron 64bit nops</span>
<span class="cm">   1: nop</span>
<span class="cm">   2: osp nop</span>
<span class="cm">   3: osp osp nop</span>
<span class="cm">   4: osp osp osp nop</span>
<span class="cm">*/</span>
<span class="cp">#define K8_NOP1 GENERIC_NOP1</span>
<span class="cp">#define K8_NOP2	0x66,K8_NOP1</span>
<span class="cp">#define K8_NOP3	0x66,K8_NOP2</span>
<span class="cp">#define K8_NOP4	0x66,K8_NOP3</span>
<span class="cp">#define K8_NOP5	K8_NOP3,K8_NOP2</span>
<span class="cp">#define K8_NOP6	K8_NOP3,K8_NOP3</span>
<span class="cp">#define K8_NOP7	K8_NOP4,K8_NOP3</span>
<span class="cp">#define K8_NOP8	K8_NOP4,K8_NOP4</span>
<span class="cp">#define K8_NOP5_ATOMIC 0x66,K8_NOP4</span>

<span class="cm">/* K7 nops</span>
<span class="cm">   uses eax dependencies (arbitrary choice)</span>
<span class="cm">   1: nop</span>
<span class="cm">   2: movl %eax,%eax</span>
<span class="cm">   3: leal (,%eax,1),%eax</span>
<span class="cm">   4: leal 0x00(,%eax,1),%eax</span>
<span class="cm">   6: leal 0x00000000(%eax),%eax</span>
<span class="cm">   7: leal 0x00000000(,%eax,1),%eax</span>
<span class="cm">*/</span>
<span class="cp">#define K7_NOP1	GENERIC_NOP1</span>
<span class="cp">#define K7_NOP2	0x8b,0xc0</span>
<span class="cp">#define K7_NOP3	0x8d,0x04,0x20</span>
<span class="cp">#define K7_NOP4	0x8d,0x44,0x20,0x00</span>
<span class="cp">#define K7_NOP5	K7_NOP4,K7_NOP1</span>
<span class="cp">#define K7_NOP6	0x8d,0x80,0,0,0,0</span>
<span class="cp">#define K7_NOP7	0x8D,0x04,0x05,0,0,0,0</span>
<span class="cp">#define K7_NOP8	K7_NOP7,K7_NOP1</span>
<span class="cp">#define K7_NOP5_ATOMIC NOP_DS_PREFIX,K7_NOP4</span>

<span class="cm">/* P6 nops</span>
<span class="cm">   uses eax dependencies (Intel-recommended choice)</span>
<span class="cm">   1: nop</span>
<span class="cm">   2: osp nop</span>
<span class="cm">   3: nopl (%eax)</span>
<span class="cm">   4: nopl 0x00(%eax)</span>
<span class="cm">   5: nopl 0x00(%eax,%eax,1)</span>
<span class="cm">   6: osp nopl 0x00(%eax,%eax,1)</span>
<span class="cm">   7: nopl 0x00000000(%eax)</span>
<span class="cm">   8: nopl 0x00000000(%eax,%eax,1)</span>
<span class="cm">   Note: All the above are assumed to be a single instruction.</span>
<span class="cm">	There is kernel code that depends on this.</span>
<span class="cm">*/</span>
<span class="cp">#define P6_NOP1	GENERIC_NOP1</span>
<span class="cp">#define P6_NOP2	0x66,0x90</span>
<span class="cp">#define P6_NOP3	0x0f,0x1f,0x00</span>
<span class="cp">#define P6_NOP4	0x0f,0x1f,0x40,0</span>
<span class="cp">#define P6_NOP5	0x0f,0x1f,0x44,0x00,0</span>
<span class="cp">#define P6_NOP6	0x66,0x0f,0x1f,0x44,0x00,0</span>
<span class="cp">#define P6_NOP7	0x0f,0x1f,0x80,0,0,0,0</span>
<span class="cp">#define P6_NOP8	0x0f,0x1f,0x84,0x00,0,0,0,0</span>
<span class="cp">#define P6_NOP5_ATOMIC P6_NOP5</span>

<span class="cp">#ifdef __ASSEMBLY__</span>
<span class="cp">#define _ASM_MK_NOP(x) .byte x</span>
<span class="cp">#else</span>
<span class="cp">#define _ASM_MK_NOP(x) &quot;.byte &quot; __stringify(x) &quot;\n&quot;</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_MK7)</span>
<span class="cp">#define ASM_NOP1 _ASM_MK_NOP(K7_NOP1)</span>
<span class="cp">#define ASM_NOP2 _ASM_MK_NOP(K7_NOP2)</span>
<span class="cp">#define ASM_NOP3 _ASM_MK_NOP(K7_NOP3)</span>
<span class="cp">#define ASM_NOP4 _ASM_MK_NOP(K7_NOP4)</span>
<span class="cp">#define ASM_NOP5 _ASM_MK_NOP(K7_NOP5)</span>
<span class="cp">#define ASM_NOP6 _ASM_MK_NOP(K7_NOP6)</span>
<span class="cp">#define ASM_NOP7 _ASM_MK_NOP(K7_NOP7)</span>
<span class="cp">#define ASM_NOP8 _ASM_MK_NOP(K7_NOP8)</span>
<span class="cp">#define ASM_NOP5_ATOMIC _ASM_MK_NOP(K7_NOP5_ATOMIC)</span>
<span class="cp">#elif defined(CONFIG_X86_P6_NOP)</span>
<span class="cp">#define ASM_NOP1 _ASM_MK_NOP(P6_NOP1)</span>
<span class="cp">#define ASM_NOP2 _ASM_MK_NOP(P6_NOP2)</span>
<span class="cp">#define ASM_NOP3 _ASM_MK_NOP(P6_NOP3)</span>
<span class="cp">#define ASM_NOP4 _ASM_MK_NOP(P6_NOP4)</span>
<span class="cp">#define ASM_NOP5 _ASM_MK_NOP(P6_NOP5)</span>
<span class="cp">#define ASM_NOP6 _ASM_MK_NOP(P6_NOP6)</span>
<span class="cp">#define ASM_NOP7 _ASM_MK_NOP(P6_NOP7)</span>
<span class="cp">#define ASM_NOP8 _ASM_MK_NOP(P6_NOP8)</span>
<span class="cp">#define ASM_NOP5_ATOMIC _ASM_MK_NOP(P6_NOP5_ATOMIC)</span>
<span class="cp">#elif defined(CONFIG_X86_64)</span>
<span class="cp">#define ASM_NOP1 _ASM_MK_NOP(K8_NOP1)</span>
<span class="cp">#define ASM_NOP2 _ASM_MK_NOP(K8_NOP2)</span>
<span class="cp">#define ASM_NOP3 _ASM_MK_NOP(K8_NOP3)</span>
<span class="cp">#define ASM_NOP4 _ASM_MK_NOP(K8_NOP4)</span>
<span class="cp">#define ASM_NOP5 _ASM_MK_NOP(K8_NOP5)</span>
<span class="cp">#define ASM_NOP6 _ASM_MK_NOP(K8_NOP6)</span>
<span class="cp">#define ASM_NOP7 _ASM_MK_NOP(K8_NOP7)</span>
<span class="cp">#define ASM_NOP8 _ASM_MK_NOP(K8_NOP8)</span>
<span class="cp">#define ASM_NOP5_ATOMIC _ASM_MK_NOP(K8_NOP5_ATOMIC)</span>
<span class="cp">#else</span>
<span class="cp">#define ASM_NOP1 _ASM_MK_NOP(GENERIC_NOP1)</span>
<span class="cp">#define ASM_NOP2 _ASM_MK_NOP(GENERIC_NOP2)</span>
<span class="cp">#define ASM_NOP3 _ASM_MK_NOP(GENERIC_NOP3)</span>
<span class="cp">#define ASM_NOP4 _ASM_MK_NOP(GENERIC_NOP4)</span>
<span class="cp">#define ASM_NOP5 _ASM_MK_NOP(GENERIC_NOP5)</span>
<span class="cp">#define ASM_NOP6 _ASM_MK_NOP(GENERIC_NOP6)</span>
<span class="cp">#define ASM_NOP7 _ASM_MK_NOP(GENERIC_NOP7)</span>
<span class="cp">#define ASM_NOP8 _ASM_MK_NOP(GENERIC_NOP8)</span>
<span class="cp">#define ASM_NOP5_ATOMIC _ASM_MK_NOP(GENERIC_NOP5_ATOMIC)</span>
<span class="cp">#endif</span>

<span class="cp">#define ASM_NOP_MAX 8</span>
<span class="cp">#define NOP_ATOMIC5 (ASM_NOP_MAX+1)	</span><span class="cm">/* Entry for the 5-byte atomic NOP */</span><span class="cp"></span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">ideal_nops</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">arch_init_ideal_nops</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_X86_NOPS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
