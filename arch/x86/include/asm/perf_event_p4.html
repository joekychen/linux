<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › x86 › include › asm › perf_event_p4.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>perf_event_p4.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Netburst Performance Events (P4, old Xeon)</span>
<span class="cm"> */</span>

<span class="cp">#ifndef PERF_EVENT_P4_H</span>
<span class="cp">#define PERF_EVENT_P4_H</span>

<span class="cp">#include &lt;linux/cpu.h&gt;</span>
<span class="cp">#include &lt;linux/bitops.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * NetBurst has performance MSRs shared between</span>
<span class="cm"> * threads if HT is turned on, ie for both logical</span>
<span class="cm"> * processors (mem: in turn in Atom with HT support</span>
<span class="cm"> * perf-MSRs are not shared and every thread has its</span>
<span class="cm"> * own perf-MSRs set)</span>
<span class="cm"> */</span>
<span class="cp">#define ARCH_P4_TOTAL_ESCR	(46)</span>
<span class="cp">#define ARCH_P4_RESERVED_ESCR	(2) </span><span class="cm">/* IQ_ESCR(0,1) not always present */</span><span class="cp"></span>
<span class="cp">#define ARCH_P4_MAX_ESCR	(ARCH_P4_TOTAL_ESCR - ARCH_P4_RESERVED_ESCR)</span>
<span class="cp">#define ARCH_P4_MAX_CCCR	(18)</span>

<span class="cp">#define ARCH_P4_CNTRVAL_BITS	(40)</span>
<span class="cp">#define ARCH_P4_CNTRVAL_MASK	((1ULL &lt;&lt; ARCH_P4_CNTRVAL_BITS) - 1)</span>
<span class="cp">#define ARCH_P4_UNFLAGGED_BIT	((1ULL) &lt;&lt; (ARCH_P4_CNTRVAL_BITS - 1))</span>

<span class="cp">#define P4_ESCR_EVENT_MASK	0x7e000000U</span>
<span class="cp">#define P4_ESCR_EVENT_SHIFT	25</span>
<span class="cp">#define P4_ESCR_EVENTMASK_MASK	0x01fffe00U</span>
<span class="cp">#define P4_ESCR_EVENTMASK_SHIFT	9</span>
<span class="cp">#define P4_ESCR_TAG_MASK	0x000001e0U</span>
<span class="cp">#define P4_ESCR_TAG_SHIFT	5</span>
<span class="cp">#define P4_ESCR_TAG_ENABLE	0x00000010U</span>
<span class="cp">#define P4_ESCR_T0_OS		0x00000008U</span>
<span class="cp">#define P4_ESCR_T0_USR		0x00000004U</span>
<span class="cp">#define P4_ESCR_T1_OS		0x00000002U</span>
<span class="cp">#define P4_ESCR_T1_USR		0x00000001U</span>

<span class="cp">#define P4_ESCR_EVENT(v)	((v) &lt;&lt; P4_ESCR_EVENT_SHIFT)</span>
<span class="cp">#define P4_ESCR_EMASK(v)	((v) &lt;&lt; P4_ESCR_EVENTMASK_SHIFT)</span>
<span class="cp">#define P4_ESCR_TAG(v)		((v) &lt;&lt; P4_ESCR_TAG_SHIFT)</span>

<span class="cp">#define P4_CCCR_OVF			0x80000000U</span>
<span class="cp">#define P4_CCCR_CASCADE			0x40000000U</span>
<span class="cp">#define P4_CCCR_OVF_PMI_T0		0x04000000U</span>
<span class="cp">#define P4_CCCR_OVF_PMI_T1		0x08000000U</span>
<span class="cp">#define P4_CCCR_FORCE_OVF		0x02000000U</span>
<span class="cp">#define P4_CCCR_EDGE			0x01000000U</span>
<span class="cp">#define P4_CCCR_THRESHOLD_MASK		0x00f00000U</span>
<span class="cp">#define P4_CCCR_THRESHOLD_SHIFT		20</span>
<span class="cp">#define P4_CCCR_COMPLEMENT		0x00080000U</span>
<span class="cp">#define P4_CCCR_COMPARE			0x00040000U</span>
<span class="cp">#define P4_CCCR_ESCR_SELECT_MASK	0x0000e000U</span>
<span class="cp">#define P4_CCCR_ESCR_SELECT_SHIFT	13</span>
<span class="cp">#define P4_CCCR_ENABLE			0x00001000U</span>
<span class="cp">#define P4_CCCR_THREAD_SINGLE		0x00010000U</span>
<span class="cp">#define P4_CCCR_THREAD_BOTH		0x00020000U</span>
<span class="cp">#define P4_CCCR_THREAD_ANY		0x00030000U</span>
<span class="cp">#define P4_CCCR_RESERVED		0x00000fffU</span>

<span class="cp">#define P4_CCCR_THRESHOLD(v)		((v) &lt;&lt; P4_CCCR_THRESHOLD_SHIFT)</span>
<span class="cp">#define P4_CCCR_ESEL(v)			((v) &lt;&lt; P4_CCCR_ESCR_SELECT_SHIFT)</span>

<span class="cp">#define P4_GEN_ESCR_EMASK(class, name, bit)	\</span>
<span class="cp">	class##__##name = ((1 &lt;&lt; bit) &lt;&lt; P4_ESCR_EVENTMASK_SHIFT)</span>
<span class="cp">#define P4_ESCR_EMASK_BIT(class, name)		class##__##name</span>

<span class="cm">/*</span>
<span class="cm"> * config field is 64bit width and consists of</span>
<span class="cm"> * HT &lt;&lt; 63 | ESCR &lt;&lt; 32 | CCCR</span>
<span class="cm"> * where HT is HyperThreading bit (since ESCR</span>
<span class="cm"> * has it reserved we may use it for own purpose)</span>
<span class="cm"> *</span>
<span class="cm"> * note that this is NOT the addresses of respective</span>
<span class="cm"> * ESCR and CCCR but rather an only packed value should</span>
<span class="cm"> * be unpacked and written to a proper addresses</span>
<span class="cm"> *</span>
<span class="cm"> * the base idea is to pack as much info as possible</span>
<span class="cm"> */</span>
<span class="cp">#define p4_config_pack_escr(v)		(((u64)(v)) &lt;&lt; 32)</span>
<span class="cp">#define p4_config_pack_cccr(v)		(((u64)(v)) &amp; 0xffffffffULL)</span>
<span class="cp">#define p4_config_unpack_escr(v)	(((u64)(v)) &gt;&gt; 32)</span>
<span class="cp">#define p4_config_unpack_cccr(v)	(((u64)(v)) &amp; 0xffffffffULL)</span>

<span class="cp">#define p4_config_unpack_emask(v)			\</span>
<span class="cp">	({						\</span>
<span class="cp">		u32 t = p4_config_unpack_escr((v));	\</span>
<span class="cp">		t = t &amp;  P4_ESCR_EVENTMASK_MASK;	\</span>
<span class="cp">		t = t &gt;&gt; P4_ESCR_EVENTMASK_SHIFT;	\</span>
<span class="cp">		t;					\</span>
<span class="cp">	})</span>

<span class="cp">#define p4_config_unpack_event(v)			\</span>
<span class="cp">	({						\</span>
<span class="cp">		u32 t = p4_config_unpack_escr((v));	\</span>
<span class="cp">		t = t &amp;  P4_ESCR_EVENT_MASK;		\</span>
<span class="cp">		t = t &gt;&gt; P4_ESCR_EVENT_SHIFT;		\</span>
<span class="cp">		t;					\</span>
<span class="cp">	})</span>

<span class="cp">#define P4_CONFIG_HT_SHIFT		63</span>
<span class="cp">#define P4_CONFIG_HT			(1ULL &lt;&lt; P4_CONFIG_HT_SHIFT)</span>

<span class="cm">/*</span>
<span class="cm"> * If an event has alias it should be marked</span>
<span class="cm"> * with a special bit. (Don&#39;t forget to check</span>
<span class="cm"> * P4_PEBS_CONFIG_MASK and related bits on</span>
<span class="cm"> * modification.)</span>
<span class="cm"> */</span>
<span class="cp">#define P4_CONFIG_ALIASABLE		(1 &lt;&lt; 9)</span>

<span class="cm">/*</span>
<span class="cm"> * The bits we allow to pass for RAW events</span>
<span class="cm"> */</span>
<span class="cp">#define P4_CONFIG_MASK_ESCR		\</span>
<span class="cp">	P4_ESCR_EVENT_MASK	|	\</span>
<span class="cp">	P4_ESCR_EVENTMASK_MASK	|	\</span>
<span class="cp">	P4_ESCR_TAG_MASK	|	\</span>
<span class="cp">	P4_ESCR_TAG_ENABLE</span>

<span class="cp">#define P4_CONFIG_MASK_CCCR		\</span>
<span class="cp">	P4_CCCR_EDGE		|	\</span>
<span class="cp">	P4_CCCR_THRESHOLD_MASK	|	\</span>
<span class="cp">	P4_CCCR_COMPLEMENT	|	\</span>
<span class="cp">	P4_CCCR_COMPARE		|	\</span>
<span class="cp">	P4_CCCR_THREAD_ANY	|	\</span>
<span class="cp">	P4_CCCR_RESERVED</span>

<span class="cm">/* some dangerous bits are reserved for kernel internals */</span>
<span class="cp">#define P4_CONFIG_MASK				  	  \</span>
<span class="cp">	(p4_config_pack_escr(P4_CONFIG_MASK_ESCR))	| \</span>
<span class="cp">	(p4_config_pack_cccr(P4_CONFIG_MASK_CCCR))</span>

<span class="cm">/*</span>
<span class="cm"> * In case of event aliasing we need to preserve some</span>
<span class="cm"> * caller bits, otherwise the mapping won&#39;t be complete.</span>
<span class="cm"> */</span>
<span class="cp">#define P4_CONFIG_EVENT_ALIAS_MASK			  \</span>
<span class="cp">	(p4_config_pack_escr(P4_CONFIG_MASK_ESCR)	| \</span>
<span class="cp">	 p4_config_pack_cccr(P4_CCCR_EDGE		| \</span>
<span class="cp">			     P4_CCCR_THRESHOLD_MASK	| \</span>
<span class="cp">			     P4_CCCR_COMPLEMENT		| \</span>
<span class="cp">			     P4_CCCR_COMPARE))</span>

<span class="cp">#define  P4_CONFIG_EVENT_ALIAS_IMMUTABLE_BITS		  \</span>
<span class="cp">	((P4_CONFIG_HT)					| \</span>
<span class="cp">	 p4_config_pack_escr(P4_ESCR_T0_OS		| \</span>
<span class="cp">			     P4_ESCR_T0_USR		| \</span>
<span class="cp">			     P4_ESCR_T1_OS		| \</span>
<span class="cp">			     P4_ESCR_T1_USR)		| \</span>
<span class="cp">	 p4_config_pack_cccr(P4_CCCR_OVF		| \</span>
<span class="cp">			     P4_CCCR_CASCADE		| \</span>
<span class="cp">			     P4_CCCR_FORCE_OVF		| \</span>
<span class="cp">			     P4_CCCR_THREAD_ANY		| \</span>
<span class="cp">			     P4_CCCR_OVF_PMI_T0		| \</span>
<span class="cp">			     P4_CCCR_OVF_PMI_T1		| \</span>
<span class="cp">			     P4_CONFIG_ALIASABLE))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">bool</span> <span class="nf">p4_is_event_cascaded</span><span class="p">(</span><span class="n">u64</span> <span class="n">config</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">cccr</span> <span class="o">=</span> <span class="n">p4_config_unpack_cccr</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="n">cccr</span> <span class="o">&amp;</span> <span class="n">P4_CCCR_CASCADE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">p4_ht_config_thread</span><span class="p">(</span><span class="n">u64</span> <span class="n">config</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">!!</span><span class="p">(</span><span class="n">config</span> <span class="o">&amp;</span> <span class="n">P4_CONFIG_HT</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u64</span> <span class="nf">p4_set_ht_bit</span><span class="p">(</span><span class="n">u64</span> <span class="n">config</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">config</span> <span class="o">|</span> <span class="n">P4_CONFIG_HT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u64</span> <span class="nf">p4_clear_ht_bit</span><span class="p">(</span><span class="n">u64</span> <span class="n">config</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">config</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">P4_CONFIG_HT</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">p4_ht_active</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_SMP</span>
	<span class="k">return</span> <span class="n">smp_num_siblings</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">p4_ht_thread</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_SMP</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">smp_num_siblings</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">cpu</span> <span class="o">!=</span> <span class="n">cpumask_first</span><span class="p">(</span><span class="n">__get_cpu_var</span><span class="p">(</span><span class="n">cpu_sibling_map</span><span class="p">));</span>
<span class="cp">#endif</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">p4_should_swap_ts</span><span class="p">(</span><span class="n">u64</span> <span class="n">config</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cpu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">p4_ht_config_thread</span><span class="p">(</span><span class="n">config</span><span class="p">)</span> <span class="o">^</span> <span class="n">p4_ht_thread</span><span class="p">(</span><span class="n">cpu</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">p4_default_cccr_conf</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * Note that P4_CCCR_THREAD_ANY is &quot;required&quot; on</span>
<span class="cm">	 * non-HT machines (on HT machines we count TS events</span>
<span class="cm">	 * regardless the state of second logical processor</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">cccr</span> <span class="o">=</span> <span class="n">P4_CCCR_THREAD_ANY</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p4_ht_thread</span><span class="p">(</span><span class="n">cpu</span><span class="p">))</span>
		<span class="n">cccr</span> <span class="o">|=</span> <span class="n">P4_CCCR_OVF_PMI_T0</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">cccr</span> <span class="o">|=</span> <span class="n">P4_CCCR_OVF_PMI_T1</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">cccr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">p4_default_escr_conf</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">,</span> <span class="kt">int</span> <span class="n">exclude_os</span><span class="p">,</span> <span class="kt">int</span> <span class="n">exclude_usr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">escr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p4_ht_thread</span><span class="p">(</span><span class="n">cpu</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">exclude_os</span><span class="p">)</span>
			<span class="n">escr</span> <span class="o">|=</span> <span class="n">P4_ESCR_T0_OS</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">exclude_usr</span><span class="p">)</span>
			<span class="n">escr</span> <span class="o">|=</span> <span class="n">P4_ESCR_T0_USR</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">exclude_os</span><span class="p">)</span>
			<span class="n">escr</span> <span class="o">|=</span> <span class="n">P4_ESCR_T1_OS</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">exclude_usr</span><span class="p">)</span>
			<span class="n">escr</span> <span class="o">|=</span> <span class="n">P4_ESCR_T1_USR</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">escr</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This are the events which should be used in &quot;Event Select&quot;</span>
<span class="cm"> * field of ESCR register, they are like unique keys which allow</span>
<span class="cm"> * the kernel to determinate which CCCR and COUNTER should be</span>
<span class="cm"> * used to track an event</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">P4_EVENTS</span> <span class="p">{</span>
	<span class="n">P4_EVENT_TC_DELIVER_MODE</span><span class="p">,</span>
	<span class="n">P4_EVENT_BPU_FETCH_REQUEST</span><span class="p">,</span>
	<span class="n">P4_EVENT_ITLB_REFERENCE</span><span class="p">,</span>
	<span class="n">P4_EVENT_MEMORY_CANCEL</span><span class="p">,</span>
	<span class="n">P4_EVENT_MEMORY_COMPLETE</span><span class="p">,</span>
	<span class="n">P4_EVENT_LOAD_PORT_REPLAY</span><span class="p">,</span>
	<span class="n">P4_EVENT_STORE_PORT_REPLAY</span><span class="p">,</span>
	<span class="n">P4_EVENT_MOB_LOAD_REPLAY</span><span class="p">,</span>
	<span class="n">P4_EVENT_PAGE_WALK_TYPE</span><span class="p">,</span>
	<span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">,</span>
	<span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span>
	<span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span>
	<span class="n">P4_EVENT_FSB_DATA_ACTIVITY</span><span class="p">,</span>
	<span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span>
	<span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span>
	<span class="n">P4_EVENT_SSE_INPUT_ASSIST</span><span class="p">,</span>
	<span class="n">P4_EVENT_PACKED_SP_UOP</span><span class="p">,</span>
	<span class="n">P4_EVENT_PACKED_DP_UOP</span><span class="p">,</span>
	<span class="n">P4_EVENT_SCALAR_SP_UOP</span><span class="p">,</span>
	<span class="n">P4_EVENT_SCALAR_DP_UOP</span><span class="p">,</span>
	<span class="n">P4_EVENT_64BIT_MMX_UOP</span><span class="p">,</span>
	<span class="n">P4_EVENT_128BIT_MMX_UOP</span><span class="p">,</span>
	<span class="n">P4_EVENT_X87_FP_UOP</span><span class="p">,</span>
	<span class="n">P4_EVENT_TC_MISC</span><span class="p">,</span>
	<span class="n">P4_EVENT_GLOBAL_POWER_EVENTS</span><span class="p">,</span>
	<span class="n">P4_EVENT_TC_MS_XFER</span><span class="p">,</span>
	<span class="n">P4_EVENT_UOP_QUEUE_WRITES</span><span class="p">,</span>
	<span class="n">P4_EVENT_RETIRED_MISPRED_BRANCH_TYPE</span><span class="p">,</span>
	<span class="n">P4_EVENT_RETIRED_BRANCH_TYPE</span><span class="p">,</span>
	<span class="n">P4_EVENT_RESOURCE_STALL</span><span class="p">,</span>
	<span class="n">P4_EVENT_WC_BUFFER</span><span class="p">,</span>
	<span class="n">P4_EVENT_B2B_CYCLES</span><span class="p">,</span>
	<span class="n">P4_EVENT_BNR</span><span class="p">,</span>
	<span class="n">P4_EVENT_SNOOP</span><span class="p">,</span>
	<span class="n">P4_EVENT_RESPONSE</span><span class="p">,</span>
	<span class="n">P4_EVENT_FRONT_END_EVENT</span><span class="p">,</span>
	<span class="n">P4_EVENT_EXECUTION_EVENT</span><span class="p">,</span>
	<span class="n">P4_EVENT_REPLAY_EVENT</span><span class="p">,</span>
	<span class="n">P4_EVENT_INSTR_RETIRED</span><span class="p">,</span>
	<span class="n">P4_EVENT_UOPS_RETIRED</span><span class="p">,</span>
	<span class="n">P4_EVENT_UOP_TYPE</span><span class="p">,</span>
	<span class="n">P4_EVENT_BRANCH_RETIRED</span><span class="p">,</span>
	<span class="n">P4_EVENT_MISPRED_BRANCH_RETIRED</span><span class="p">,</span>
	<span class="n">P4_EVENT_X87_ASSIST</span><span class="p">,</span>
	<span class="n">P4_EVENT_MACHINE_CLEAR</span><span class="p">,</span>
	<span class="n">P4_EVENT_INSTR_COMPLETED</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define P4_OPCODE(event)		event##_OPCODE</span>
<span class="cp">#define P4_OPCODE_ESEL(opcode)		((opcode &amp; 0x00ff) &gt;&gt; 0)</span>
<span class="cp">#define P4_OPCODE_EVNT(opcode)		((opcode &amp; 0xff00) &gt;&gt; 8)</span>
<span class="cp">#define P4_OPCODE_PACK(event, sel)	(((event) &lt;&lt; 8) | sel)</span>

<span class="cm">/*</span>
<span class="cm"> * Comments below the event represent ESCR restriction</span>
<span class="cm"> * for this event and counter index per ESCR</span>
<span class="cm"> *</span>
<span class="cm"> * MSR_P4_IQ_ESCR0 and MSR_P4_IQ_ESCR1 are available only on early</span>
<span class="cm"> * processor builds (family 0FH, models 01H-02H). These MSRs</span>
<span class="cm"> * are not available on later versions, so that we don&#39;t use</span>
<span class="cm"> * them completely</span>
<span class="cm"> *</span>
<span class="cm"> * Also note that CCCR1 do not have P4_CCCR_ENABLE bit properly</span>
<span class="cm"> * working so that we should not use this CCCR and respective</span>
<span class="cm"> * counter as result</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">P4_EVENT_OPCODES</span> <span class="p">{</span>
	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_TC_DELIVER_MODE</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_TC_ESCR0:	4, 5</span>
<span class="cm">	 * MSR_P4_TC_ESCR1:	6, 7</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_BPU_FETCH_REQUEST</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_BPU_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_BPU_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_ITLB_REFERENCE</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_ITLB_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_ITLB_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_MEMORY_CANCEL</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_DAC_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_DAC_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_MEMORY_COMPLETE</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_SAAT_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_SAAT_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_LOAD_PORT_REPLAY</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_SAAT_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_SAAT_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_STORE_PORT_REPLAY</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_SAAT_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_SAAT_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_MOB_LOAD_REPLAY</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_MOB_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_MOB_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_PAGE_WALK_TYPE</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_PMH_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_PMH_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_BSU_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_BSU_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FSB_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_FSB_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FSB_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_FSB_DATA_ACTIVITY</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FSB_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_FSB_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_BSU_ESCR0:	0, 1</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * NOTE: no ESCR name in docs, it&#39;s guessed</span>
<span class="cm">	 * MSR_P4_BSU_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_SSE_INPUT_ASSIST</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_PACKED_SP_UOP</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_PACKED_DP_UOP</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_SCALAR_SP_UOP</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_SCALAR_DP_UOP</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_64BIT_MMX_UOP</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_128BIT_MMX_UOP</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_X87_FP_UOP</span><span class="p">)</span>			<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_FIRM_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_TC_MISC</span><span class="p">)</span>			<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_TC_ESCR0:	4, 5</span>
<span class="cm">	 * MSR_P4_TC_ESCR1:	6, 7</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_GLOBAL_POWER_EVENTS</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FSB_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_FSB_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_TC_MS_XFER</span><span class="p">)</span>			<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_MS_ESCR0:	4, 5</span>
<span class="cm">	 * MSR_P4_MS_ESCR1:	6, 7</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_UOP_QUEUE_WRITES</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_MS_ESCR0:	4, 5</span>
<span class="cm">	 * MSR_P4_MS_ESCR1:	6, 7</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_RETIRED_MISPRED_BRANCH_TYPE</span><span class="p">)</span>	<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_TBPU_ESCR0:	4, 5</span>
<span class="cm">	 * MSR_P4_TBPU_ESCR1:	6, 7</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_RETIRED_BRANCH_TYPE</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_TBPU_ESCR0:	4, 5</span>
<span class="cm">	 * MSR_P4_TBPU_ESCR1:	6, 7</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_RESOURCE_STALL</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_ALF_ESCR0:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_ALF_ESCR1:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_WC_BUFFER</span><span class="p">)</span>			<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_DAC_ESCR0:	8, 9</span>
<span class="cm">	 * MSR_P4_DAC_ESCR1:	10, 11</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_B2B_CYCLES</span><span class="p">)</span>			<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FSB_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_FSB_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_BNR</span><span class="p">)</span>				<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FSB_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_FSB_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_SNOOP</span><span class="p">)</span>			<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FSB_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_FSB_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_RESPONSE</span><span class="p">)</span>			<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_FSB_ESCR0:	0, 1</span>
<span class="cm">	 * MSR_P4_FSB_ESCR1:	2, 3</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_FRONT_END_EVENT</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_CRU_ESCR2:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_CRU_ESCR3:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_EXECUTION_EVENT</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_CRU_ESCR2:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_CRU_ESCR3:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_REPLAY_EVENT</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_CRU_ESCR2:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_CRU_ESCR3:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_INSTR_RETIRED</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_CRU_ESCR0:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_CRU_ESCR1:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_UOPS_RETIRED</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_CRU_ESCR0:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_CRU_ESCR1:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_UOP_TYPE</span><span class="p">)</span>			<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_RAT_ESCR0:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_RAT_ESCR1:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_BRANCH_RETIRED</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_CRU_ESCR2:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_CRU_ESCR3:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_MISPRED_BRANCH_RETIRED</span><span class="p">)</span>	<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_CRU_ESCR0:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_CRU_ESCR1:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_X87_ASSIST</span><span class="p">)</span>			<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_CRU_ESCR2:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_CRU_ESCR3:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_MACHINE_CLEAR</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_CRU_ESCR2:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_CRU_ESCR3:	14, 15, 17</span>
<span class="cm">	 */</span>

	<span class="n">P4_OPCODE</span><span class="p">(</span><span class="n">P4_EVENT_INSTR_COMPLETED</span><span class="p">)</span>		<span class="o">=</span> <span class="n">P4_OPCODE_PACK</span><span class="p">(</span><span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">),</span>
	<span class="cm">/*</span>
<span class="cm">	 * MSR_P4_CRU_ESCR0:	12, 13, 16</span>
<span class="cm">	 * MSR_P4_CRU_ESCR1:	14, 15, 17</span>
<span class="cm">	 */</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * a caller should use P4_ESCR_EMASK_NAME helper to</span>
<span class="cm"> * pick the EventMask needed, for example</span>
<span class="cm"> *</span>
<span class="cm"> *	P4_ESCR_EMASK_BIT(P4_EVENT_TC_DELIVER_MODE, DD)</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">P4_ESCR_EMASKS</span> <span class="p">{</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_TC_DELIVER_MODE</span><span class="p">,</span> <span class="n">DD</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_TC_DELIVER_MODE</span><span class="p">,</span> <span class="n">DB</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_TC_DELIVER_MODE</span><span class="p">,</span> <span class="n">DI</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_TC_DELIVER_MODE</span><span class="p">,</span> <span class="n">BD</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_TC_DELIVER_MODE</span><span class="p">,</span> <span class="n">BB</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_TC_DELIVER_MODE</span><span class="p">,</span> <span class="n">BI</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_TC_DELIVER_MODE</span><span class="p">,</span> <span class="n">ID</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BPU_FETCH_REQUEST</span><span class="p">,</span> <span class="n">TCMISS</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_ITLB_REFERENCE</span><span class="p">,</span> <span class="n">HIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_ITLB_REFERENCE</span><span class="p">,</span> <span class="n">MISS</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_ITLB_REFERENCE</span><span class="p">,</span> <span class="n">HIT_UK</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MEMORY_CANCEL</span><span class="p">,</span> <span class="n">ST_RB_FULL</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MEMORY_CANCEL</span><span class="p">,</span> <span class="mi">64</span><span class="n">K_CONF</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MEMORY_COMPLETE</span><span class="p">,</span> <span class="n">LSC</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MEMORY_COMPLETE</span><span class="p">,</span> <span class="n">SSC</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_LOAD_PORT_REPLAY</span><span class="p">,</span> <span class="n">SPLIT_LD</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_STORE_PORT_REPLAY</span><span class="p">,</span> <span class="n">SPLIT_ST</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MOB_LOAD_REPLAY</span><span class="p">,</span> <span class="n">NO_STA</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MOB_LOAD_REPLAY</span><span class="p">,</span> <span class="n">NO_STD</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MOB_LOAD_REPLAY</span><span class="p">,</span> <span class="n">PARTIAL_DATA</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MOB_LOAD_REPLAY</span><span class="p">,</span> <span class="n">UNALGN_ADDR</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_PAGE_WALK_TYPE</span><span class="p">,</span> <span class="n">DTMISS</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_PAGE_WALK_TYPE</span><span class="p">,</span> <span class="n">ITMISS</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">,</span> <span class="n">RD_2ndL_HITS</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">,</span> <span class="n">RD_2ndL_HITE</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">,</span> <span class="n">RD_2ndL_HITM</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">,</span> <span class="n">RD_3rdL_HITS</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">,</span> <span class="n">RD_3rdL_HITE</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">,</span> <span class="n">RD_3rdL_HITM</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">,</span> <span class="n">RD_2ndL_MISS</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">,</span> <span class="n">RD_3rdL_MISS</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_CACHE_REFERENCE</span><span class="p">,</span> <span class="n">WR_2ndL_MISS</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">ALL_READ</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">ALL_WRITE</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">MEM_UC</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">MEM_WC</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">MEM_WT</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">MEM_WP</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">MEM_WB</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">OWN</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">OTHER</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ALLOCATION</span><span class="p">,</span> <span class="n">PREFETCH</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">ALL_READ</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">ALL_WRITE</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">MEM_UC</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">MEM_WC</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">MEM_WT</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">MEM_WP</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">MEM_WB</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">OWN</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">OTHER</span><span class="p">,</span> <span class="mi">14</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_IOQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">PREFETCH</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_FSB_DATA_ACTIVITY</span><span class="p">,</span> <span class="n">DRDY_DRV</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_FSB_DATA_ACTIVITY</span><span class="p">,</span> <span class="n">DRDY_OWN</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_FSB_DATA_ACTIVITY</span><span class="p">,</span> <span class="n">DRDY_OTHER</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_FSB_DATA_ACTIVITY</span><span class="p">,</span> <span class="n">DBSY_DRV</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_FSB_DATA_ACTIVITY</span><span class="p">,</span> <span class="n">DBSY_OWN</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_FSB_DATA_ACTIVITY</span><span class="p">,</span> <span class="n">DBSY_OTHER</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">REQ_TYPE0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">REQ_TYPE1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">REQ_LEN0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">REQ_LEN1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">REQ_IO_TYPE</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">REQ_LOCK_TYPE</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">REQ_CACHE_TYPE</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">REQ_SPLIT_TYPE</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">REQ_DEM_TYPE</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">REQ_ORD_TYPE</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">MEM_TYPE0</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">MEM_TYPE1</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ALLOCATION</span><span class="p">,</span> <span class="n">MEM_TYPE2</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">REQ_TYPE0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">REQ_TYPE1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">REQ_LEN0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">REQ_LEN1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">REQ_IO_TYPE</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">REQ_LOCK_TYPE</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">REQ_CACHE_TYPE</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">REQ_SPLIT_TYPE</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">REQ_DEM_TYPE</span><span class="p">,</span> <span class="mi">9</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">REQ_ORD_TYPE</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">MEM_TYPE0</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">MEM_TYPE1</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BSQ_ACTIVE_ENTRIES</span><span class="p">,</span> <span class="n">MEM_TYPE2</span><span class="p">,</span> <span class="mi">13</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_SSE_INPUT_ASSIST</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_PACKED_SP_UOP</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_PACKED_DP_UOP</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_SCALAR_SP_UOP</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_SCALAR_DP_UOP</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_64BIT_MMX_UOP</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_128BIT_MMX_UOP</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_X87_FP_UOP</span><span class="p">,</span> <span class="n">ALL</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_TC_MISC</span><span class="p">,</span> <span class="n">FLUSH</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_GLOBAL_POWER_EVENTS</span><span class="p">,</span> <span class="n">RUNNING</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_TC_MS_XFER</span><span class="p">,</span> <span class="n">CISC</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_UOP_QUEUE_WRITES</span><span class="p">,</span> <span class="n">FROM_TC_BUILD</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_UOP_QUEUE_WRITES</span><span class="p">,</span> <span class="n">FROM_TC_DELIVER</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_UOP_QUEUE_WRITES</span><span class="p">,</span> <span class="n">FROM_ROM</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_RETIRED_MISPRED_BRANCH_TYPE</span><span class="p">,</span> <span class="n">CONDITIONAL</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_RETIRED_MISPRED_BRANCH_TYPE</span><span class="p">,</span> <span class="n">CALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_RETIRED_MISPRED_BRANCH_TYPE</span><span class="p">,</span> <span class="n">RETURN</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_RETIRED_MISPRED_BRANCH_TYPE</span><span class="p">,</span> <span class="n">INDIRECT</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_RETIRED_BRANCH_TYPE</span><span class="p">,</span> <span class="n">CONDITIONAL</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_RETIRED_BRANCH_TYPE</span><span class="p">,</span> <span class="n">CALL</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_RETIRED_BRANCH_TYPE</span><span class="p">,</span> <span class="n">RETURN</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_RETIRED_BRANCH_TYPE</span><span class="p">,</span> <span class="n">INDIRECT</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_RESOURCE_STALL</span><span class="p">,</span> <span class="n">SBFULL</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_WC_BUFFER</span><span class="p">,</span> <span class="n">WCB_EVICTS</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_WC_BUFFER</span><span class="p">,</span> <span class="n">WCB_FULL_EVICTS</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_FRONT_END_EVENT</span><span class="p">,</span> <span class="n">NBOGUS</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_FRONT_END_EVENT</span><span class="p">,</span> <span class="n">BOGUS</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_EXECUTION_EVENT</span><span class="p">,</span> <span class="n">NBOGUS0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_EXECUTION_EVENT</span><span class="p">,</span> <span class="n">NBOGUS1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_EXECUTION_EVENT</span><span class="p">,</span> <span class="n">NBOGUS2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_EXECUTION_EVENT</span><span class="p">,</span> <span class="n">NBOGUS3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_EXECUTION_EVENT</span><span class="p">,</span> <span class="n">BOGUS0</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_EXECUTION_EVENT</span><span class="p">,</span> <span class="n">BOGUS1</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_EXECUTION_EVENT</span><span class="p">,</span> <span class="n">BOGUS2</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_EXECUTION_EVENT</span><span class="p">,</span> <span class="n">BOGUS3</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_REPLAY_EVENT</span><span class="p">,</span> <span class="n">NBOGUS</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_REPLAY_EVENT</span><span class="p">,</span> <span class="n">BOGUS</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_INSTR_RETIRED</span><span class="p">,</span> <span class="n">NBOGUSNTAG</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_INSTR_RETIRED</span><span class="p">,</span> <span class="n">NBOGUSTAG</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_INSTR_RETIRED</span><span class="p">,</span> <span class="n">BOGUSNTAG</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_INSTR_RETIRED</span><span class="p">,</span> <span class="n">BOGUSTAG</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_UOPS_RETIRED</span><span class="p">,</span> <span class="n">NBOGUS</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_UOPS_RETIRED</span><span class="p">,</span> <span class="n">BOGUS</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_UOP_TYPE</span><span class="p">,</span> <span class="n">TAGLOADS</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_UOP_TYPE</span><span class="p">,</span> <span class="n">TAGSTORES</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BRANCH_RETIRED</span><span class="p">,</span> <span class="n">MMNP</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BRANCH_RETIRED</span><span class="p">,</span> <span class="n">MMNM</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BRANCH_RETIRED</span><span class="p">,</span> <span class="n">MMTP</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_BRANCH_RETIRED</span><span class="p">,</span> <span class="n">MMTM</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MISPRED_BRANCH_RETIRED</span><span class="p">,</span> <span class="n">NBOGUS</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_X87_ASSIST</span><span class="p">,</span> <span class="n">FPSU</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_X87_ASSIST</span><span class="p">,</span> <span class="n">FPSO</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_X87_ASSIST</span><span class="p">,</span> <span class="n">POAO</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_X87_ASSIST</span><span class="p">,</span> <span class="n">POAU</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_X87_ASSIST</span><span class="p">,</span> <span class="n">PREA</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MACHINE_CLEAR</span><span class="p">,</span> <span class="n">CLEAR</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MACHINE_CLEAR</span><span class="p">,</span> <span class="n">MOCLEAR</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_MACHINE_CLEAR</span><span class="p">,</span> <span class="n">SMCLEAR</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>

	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_INSTR_COMPLETED</span><span class="p">,</span> <span class="n">NBOGUS</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
	<span class="n">P4_GEN_ESCR_EMASK</span><span class="p">(</span><span class="n">P4_EVENT_INSTR_COMPLETED</span><span class="p">,</span> <span class="n">BOGUS</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Note we have UOP and PEBS bits reserved for now</span>
<span class="cm"> * just in case if we will need them once</span>
<span class="cm"> */</span>
<span class="cp">#define P4_PEBS_CONFIG_ENABLE		(1 &lt;&lt; 7)</span>
<span class="cp">#define P4_PEBS_CONFIG_UOP_TAG		(1 &lt;&lt; 8)</span>
<span class="cp">#define P4_PEBS_CONFIG_METRIC_MASK	0x3f</span>
<span class="cp">#define P4_PEBS_CONFIG_MASK		0xff</span>

<span class="cm">/*</span>
<span class="cm"> * mem: Only counters MSR_IQ_COUNTER4 (16) and</span>
<span class="cm"> * MSR_IQ_COUNTER5 (17) are allowed for PEBS sampling</span>
<span class="cm"> */</span>
<span class="cp">#define P4_PEBS_ENABLE			0x02000000U</span>
<span class="cp">#define P4_PEBS_ENABLE_UOP_TAG		0x01000000U</span>

<span class="cp">#define p4_config_unpack_metric(v)	(((u64)(v)) &amp; P4_PEBS_CONFIG_METRIC_MASK)</span>
<span class="cp">#define p4_config_unpack_pebs(v)	(((u64)(v)) &amp; P4_PEBS_CONFIG_MASK)</span>

<span class="cp">#define p4_config_pebs_has(v, mask)	(p4_config_unpack_pebs(v) &amp; (mask))</span>

<span class="k">enum</span> <span class="n">P4_PEBS_METRIC</span> <span class="p">{</span>
	<span class="n">P4_PEBS_METRIC__none</span><span class="p">,</span>

	<span class="n">P4_PEBS_METRIC__1stl_cache_load_miss_retired</span><span class="p">,</span>
	<span class="n">P4_PEBS_METRIC__2ndl_cache_load_miss_retired</span><span class="p">,</span>
	<span class="n">P4_PEBS_METRIC__dtlb_load_miss_retired</span><span class="p">,</span>
	<span class="n">P4_PEBS_METRIC__dtlb_store_miss_retired</span><span class="p">,</span>
	<span class="n">P4_PEBS_METRIC__dtlb_all_miss_retired</span><span class="p">,</span>
	<span class="n">P4_PEBS_METRIC__tagged_mispred_branch</span><span class="p">,</span>
	<span class="n">P4_PEBS_METRIC__mob_load_replay_retired</span><span class="p">,</span>
	<span class="n">P4_PEBS_METRIC__split_load_retired</span><span class="p">,</span>
	<span class="n">P4_PEBS_METRIC__split_store_retired</span><span class="p">,</span>

	<span class="n">P4_PEBS_METRIC__max</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Notes on internal configuration of ESCR+CCCR tuples</span>
<span class="cm"> *</span>
<span class="cm"> * Since P4 has quite the different architecture of</span>
<span class="cm"> * performance registers in compare with &quot;architectural&quot;</span>
<span class="cm"> * once and we have on 64 bits to keep configuration</span>
<span class="cm"> * of performance event, the following trick is used.</span>
<span class="cm"> *</span>
<span class="cm"> * 1) Since both ESCR and CCCR registers have only low</span>
<span class="cm"> *    32 bits valuable, we pack them into a single 64 bit</span>
<span class="cm"> *    configuration. Low 32 bits of such config correspond</span>
<span class="cm"> *    to low 32 bits of CCCR register and high 32 bits</span>
<span class="cm"> *    correspond to low 32 bits of ESCR register.</span>
<span class="cm"> *</span>
<span class="cm"> * 2) The meaning of every bit of such config field can</span>
<span class="cm"> *    be found in Intel SDM but it should be noted that</span>
<span class="cm"> *    we &quot;borrow&quot; some reserved bits for own usage and</span>
<span class="cm"> *    clean them or set to a proper value when we do</span>
<span class="cm"> *    a real write to hardware registers.</span>
<span class="cm"> *</span>
<span class="cm"> * 3) The format of bits of config is the following</span>
<span class="cm"> *    and should be either 0 or set to some predefined</span>
<span class="cm"> *    values:</span>
<span class="cm"> *</span>
<span class="cm"> *    Low 32 bits</span>
<span class="cm"> *    -----------</span>
<span class="cm"> *      0-6: P4_PEBS_METRIC enum</span>
<span class="cm"> *     7-11:                    reserved</span>
<span class="cm"> *       12:                    reserved (Enable)</span>
<span class="cm"> *    13-15:                    reserved (ESCR select)</span>
<span class="cm"> *    16-17: Active Thread</span>
<span class="cm"> *       18: Compare</span>
<span class="cm"> *       19: Complement</span>
<span class="cm"> *    20-23: Threshold</span>
<span class="cm"> *       24: Edge</span>
<span class="cm"> *       25:                    reserved (FORCE_OVF)</span>
<span class="cm"> *       26:                    reserved (OVF_PMI_T0)</span>
<span class="cm"> *       27:                    reserved (OVF_PMI_T1)</span>
<span class="cm"> *    28-29:                    reserved</span>
<span class="cm"> *       30:                    reserved (Cascade)</span>
<span class="cm"> *       31:                    reserved (OVF)</span>
<span class="cm"> *</span>
<span class="cm"> *    High 32 bits</span>
<span class="cm"> *    ------------</span>
<span class="cm"> *        0:                    reserved (T1_USR)</span>
<span class="cm"> *        1:                    reserved (T1_OS)</span>
<span class="cm"> *        2:                    reserved (T0_USR)</span>
<span class="cm"> *        3:                    reserved (T0_OS)</span>
<span class="cm"> *        4: Tag Enable</span>
<span class="cm"> *      5-8: Tag Value</span>
<span class="cm"> *     9-24: Event Mask (may use P4_ESCR_EMASK_BIT helper)</span>
<span class="cm"> *    25-30: enum P4_EVENTS</span>
<span class="cm"> *       31:                    reserved (HT thread)</span>
<span class="cm"> */</span>

<span class="cp">#endif </span><span class="cm">/* PERF_EVENT_P4_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
