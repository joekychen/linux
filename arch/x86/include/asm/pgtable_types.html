<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › x86 › include › asm › pgtable_types.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>pgtable_types.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_X86_PGTABLE_DEFS_H</span>
<span class="cp">#define _ASM_X86_PGTABLE_DEFS_H</span>

<span class="cp">#include &lt;linux/const.h&gt;</span>
<span class="cp">#include &lt;asm/page_types.h&gt;</span>

<span class="cp">#define FIRST_USER_ADDRESS	0</span>

<span class="cp">#define _PAGE_BIT_PRESENT	0	</span><span class="cm">/* is present */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_RW		1	</span><span class="cm">/* writeable */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_USER		2	</span><span class="cm">/* userspace addressable */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_PWT		3	</span><span class="cm">/* page write through */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_PCD		4	</span><span class="cm">/* page cache disabled */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_ACCESSED	5	</span><span class="cm">/* was accessed (raised by CPU) */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_DIRTY		6	</span><span class="cm">/* was written to (raised by CPU) */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_PSE		7	</span><span class="cm">/* 4 MB (or 2MB) page */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_PAT		7	</span><span class="cm">/* on 4KB pages */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_GLOBAL	8	</span><span class="cm">/* Global TLB entry PPro+ */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_UNUSED1	9	</span><span class="cm">/* available for programmer */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_IOMAP		10	</span><span class="cm">/* flag used to indicate IO mapping */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_HIDDEN	11	</span><span class="cm">/* hidden by kmemcheck */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_PAT_LARGE	12	</span><span class="cm">/* On 2MB or 1GB pages */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_SPECIAL	_PAGE_BIT_UNUSED1</span>
<span class="cp">#define _PAGE_BIT_CPA_TEST	_PAGE_BIT_UNUSED1</span>
<span class="cp">#define _PAGE_BIT_SPLITTING	_PAGE_BIT_UNUSED1 </span><span class="cm">/* only valid on a PSE pmd */</span><span class="cp"></span>
<span class="cp">#define _PAGE_BIT_NX           63       </span><span class="cm">/* No execute: only valid after cpuid check */</span><span class="cp"></span>

<span class="cm">/* If _PAGE_BIT_PRESENT is clear, we use these: */</span>
<span class="cm">/* - if the user mapped it with PROT_NONE; pte_present gives true */</span>
<span class="cp">#define _PAGE_BIT_PROTNONE	_PAGE_BIT_GLOBAL</span>
<span class="cm">/* - set: nonlinear file mapping, saved PTE; unset:swap */</span>
<span class="cp">#define _PAGE_BIT_FILE		_PAGE_BIT_DIRTY</span>

<span class="cp">#define _PAGE_PRESENT	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_PRESENT)</span>
<span class="cp">#define _PAGE_RW	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_RW)</span>
<span class="cp">#define _PAGE_USER	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_USER)</span>
<span class="cp">#define _PAGE_PWT	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_PWT)</span>
<span class="cp">#define _PAGE_PCD	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_PCD)</span>
<span class="cp">#define _PAGE_ACCESSED	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_ACCESSED)</span>
<span class="cp">#define _PAGE_DIRTY	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_DIRTY)</span>
<span class="cp">#define _PAGE_PSE	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_PSE)</span>
<span class="cp">#define _PAGE_GLOBAL	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_GLOBAL)</span>
<span class="cp">#define _PAGE_UNUSED1	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_UNUSED1)</span>
<span class="cp">#define _PAGE_IOMAP	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_IOMAP)</span>
<span class="cp">#define _PAGE_PAT	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_PAT)</span>
<span class="cp">#define _PAGE_PAT_LARGE (_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_PAT_LARGE)</span>
<span class="cp">#define _PAGE_SPECIAL	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_SPECIAL)</span>
<span class="cp">#define _PAGE_CPA_TEST	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_CPA_TEST)</span>
<span class="cp">#define _PAGE_SPLITTING	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_SPLITTING)</span>
<span class="cp">#define __HAVE_ARCH_PTE_SPECIAL</span>

<span class="cp">#ifdef CONFIG_KMEMCHECK</span>
<span class="cp">#define _PAGE_HIDDEN	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_HIDDEN)</span>
<span class="cp">#else</span>
<span class="cp">#define _PAGE_HIDDEN	(_AT(pteval_t, 0))</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_X86_64) || defined(CONFIG_X86_PAE)</span>
<span class="cp">#define _PAGE_NX	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_NX)</span>
<span class="cp">#else</span>
<span class="cp">#define _PAGE_NX	(_AT(pteval_t, 0))</span>
<span class="cp">#endif</span>

<span class="cp">#define _PAGE_FILE	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_FILE)</span>
<span class="cp">#define _PAGE_PROTNONE	(_AT(pteval_t, 1) &lt;&lt; _PAGE_BIT_PROTNONE)</span>

<span class="cp">#define _PAGE_TABLE	(_PAGE_PRESENT | _PAGE_RW | _PAGE_USER |	\</span>
<span class="cp">			 _PAGE_ACCESSED | _PAGE_DIRTY)</span>
<span class="cp">#define _KERNPG_TABLE	(_PAGE_PRESENT | _PAGE_RW | _PAGE_ACCESSED |	\</span>
<span class="cp">			 _PAGE_DIRTY)</span>

<span class="cm">/* Set of bits not changed in pte_modify */</span>
<span class="cp">#define _PAGE_CHG_MASK	(PTE_PFN_MASK | _PAGE_PCD | _PAGE_PWT |		\</span>
<span class="cp">			 _PAGE_SPECIAL | _PAGE_ACCESSED | _PAGE_DIRTY)</span>
<span class="cp">#define _HPAGE_CHG_MASK (_PAGE_CHG_MASK | _PAGE_PSE)</span>

<span class="cp">#define _PAGE_CACHE_MASK	(_PAGE_PCD | _PAGE_PWT)</span>
<span class="cp">#define _PAGE_CACHE_WB		(0)</span>
<span class="cp">#define _PAGE_CACHE_WC		(_PAGE_PWT)</span>
<span class="cp">#define _PAGE_CACHE_UC_MINUS	(_PAGE_PCD)</span>
<span class="cp">#define _PAGE_CACHE_UC		(_PAGE_PCD | _PAGE_PWT)</span>

<span class="cp">#define PAGE_NONE	__pgprot(_PAGE_PROTNONE | _PAGE_ACCESSED)</span>
<span class="cp">#define PAGE_SHARED	__pgprot(_PAGE_PRESENT | _PAGE_RW | _PAGE_USER | \</span>
<span class="cp">				 _PAGE_ACCESSED | _PAGE_NX)</span>

<span class="cp">#define PAGE_SHARED_EXEC	__pgprot(_PAGE_PRESENT | _PAGE_RW |	\</span>
<span class="cp">					 _PAGE_USER | _PAGE_ACCESSED)</span>
<span class="cp">#define PAGE_COPY_NOEXEC	__pgprot(_PAGE_PRESENT | _PAGE_USER |	\</span>
<span class="cp">					 _PAGE_ACCESSED | _PAGE_NX)</span>
<span class="cp">#define PAGE_COPY_EXEC		__pgprot(_PAGE_PRESENT | _PAGE_USER |	\</span>
<span class="cp">					 _PAGE_ACCESSED)</span>
<span class="cp">#define PAGE_COPY		PAGE_COPY_NOEXEC</span>
<span class="cp">#define PAGE_READONLY		__pgprot(_PAGE_PRESENT | _PAGE_USER |	\</span>
<span class="cp">					 _PAGE_ACCESSED | _PAGE_NX)</span>
<span class="cp">#define PAGE_READONLY_EXEC	__pgprot(_PAGE_PRESENT | _PAGE_USER |	\</span>
<span class="cp">					 _PAGE_ACCESSED)</span>

<span class="cp">#define __PAGE_KERNEL_EXEC						\</span>
<span class="cp">	(_PAGE_PRESENT | _PAGE_RW | _PAGE_DIRTY | _PAGE_ACCESSED | _PAGE_GLOBAL)</span>
<span class="cp">#define __PAGE_KERNEL		(__PAGE_KERNEL_EXEC | _PAGE_NX)</span>

<span class="cp">#define __PAGE_KERNEL_RO		(__PAGE_KERNEL &amp; ~_PAGE_RW)</span>
<span class="cp">#define __PAGE_KERNEL_RX		(__PAGE_KERNEL_EXEC &amp; ~_PAGE_RW)</span>
<span class="cp">#define __PAGE_KERNEL_EXEC_NOCACHE	(__PAGE_KERNEL_EXEC | _PAGE_PCD | _PAGE_PWT)</span>
<span class="cp">#define __PAGE_KERNEL_WC		(__PAGE_KERNEL | _PAGE_CACHE_WC)</span>
<span class="cp">#define __PAGE_KERNEL_NOCACHE		(__PAGE_KERNEL | _PAGE_PCD | _PAGE_PWT)</span>
<span class="cp">#define __PAGE_KERNEL_UC_MINUS		(__PAGE_KERNEL | _PAGE_PCD)</span>
<span class="cp">#define __PAGE_KERNEL_VSYSCALL		(__PAGE_KERNEL_RX | _PAGE_USER)</span>
<span class="cp">#define __PAGE_KERNEL_VVAR		(__PAGE_KERNEL_RO | _PAGE_USER)</span>
<span class="cp">#define __PAGE_KERNEL_VVAR_NOCACHE	(__PAGE_KERNEL_VVAR | _PAGE_PCD | _PAGE_PWT)</span>
<span class="cp">#define __PAGE_KERNEL_LARGE		(__PAGE_KERNEL | _PAGE_PSE)</span>
<span class="cp">#define __PAGE_KERNEL_LARGE_NOCACHE	(__PAGE_KERNEL | _PAGE_CACHE_UC | _PAGE_PSE)</span>
<span class="cp">#define __PAGE_KERNEL_LARGE_EXEC	(__PAGE_KERNEL_EXEC | _PAGE_PSE)</span>

<span class="cp">#define __PAGE_KERNEL_IO		(__PAGE_KERNEL | _PAGE_IOMAP)</span>
<span class="cp">#define __PAGE_KERNEL_IO_NOCACHE	(__PAGE_KERNEL_NOCACHE | _PAGE_IOMAP)</span>
<span class="cp">#define __PAGE_KERNEL_IO_UC_MINUS	(__PAGE_KERNEL_UC_MINUS | _PAGE_IOMAP)</span>
<span class="cp">#define __PAGE_KERNEL_IO_WC		(__PAGE_KERNEL_WC | _PAGE_IOMAP)</span>

<span class="cp">#define PAGE_KERNEL			__pgprot(__PAGE_KERNEL)</span>
<span class="cp">#define PAGE_KERNEL_RO			__pgprot(__PAGE_KERNEL_RO)</span>
<span class="cp">#define PAGE_KERNEL_EXEC		__pgprot(__PAGE_KERNEL_EXEC)</span>
<span class="cp">#define PAGE_KERNEL_RX			__pgprot(__PAGE_KERNEL_RX)</span>
<span class="cp">#define PAGE_KERNEL_WC			__pgprot(__PAGE_KERNEL_WC)</span>
<span class="cp">#define PAGE_KERNEL_NOCACHE		__pgprot(__PAGE_KERNEL_NOCACHE)</span>
<span class="cp">#define PAGE_KERNEL_UC_MINUS		__pgprot(__PAGE_KERNEL_UC_MINUS)</span>
<span class="cp">#define PAGE_KERNEL_EXEC_NOCACHE	__pgprot(__PAGE_KERNEL_EXEC_NOCACHE)</span>
<span class="cp">#define PAGE_KERNEL_LARGE		__pgprot(__PAGE_KERNEL_LARGE)</span>
<span class="cp">#define PAGE_KERNEL_LARGE_NOCACHE	__pgprot(__PAGE_KERNEL_LARGE_NOCACHE)</span>
<span class="cp">#define PAGE_KERNEL_LARGE_EXEC		__pgprot(__PAGE_KERNEL_LARGE_EXEC)</span>
<span class="cp">#define PAGE_KERNEL_VSYSCALL		__pgprot(__PAGE_KERNEL_VSYSCALL)</span>
<span class="cp">#define PAGE_KERNEL_VVAR		__pgprot(__PAGE_KERNEL_VVAR)</span>
<span class="cp">#define PAGE_KERNEL_VVAR_NOCACHE	__pgprot(__PAGE_KERNEL_VVAR_NOCACHE)</span>

<span class="cp">#define PAGE_KERNEL_IO			__pgprot(__PAGE_KERNEL_IO)</span>
<span class="cp">#define PAGE_KERNEL_IO_NOCACHE		__pgprot(__PAGE_KERNEL_IO_NOCACHE)</span>
<span class="cp">#define PAGE_KERNEL_IO_UC_MINUS		__pgprot(__PAGE_KERNEL_IO_UC_MINUS)</span>
<span class="cp">#define PAGE_KERNEL_IO_WC		__pgprot(__PAGE_KERNEL_IO_WC)</span>

<span class="cm">/*         xwr */</span>
<span class="cp">#define __P000	PAGE_NONE</span>
<span class="cp">#define __P001	PAGE_READONLY</span>
<span class="cp">#define __P010	PAGE_COPY</span>
<span class="cp">#define __P011	PAGE_COPY</span>
<span class="cp">#define __P100	PAGE_READONLY_EXEC</span>
<span class="cp">#define __P101	PAGE_READONLY_EXEC</span>
<span class="cp">#define __P110	PAGE_COPY_EXEC</span>
<span class="cp">#define __P111	PAGE_COPY_EXEC</span>

<span class="cp">#define __S000	PAGE_NONE</span>
<span class="cp">#define __S001	PAGE_READONLY</span>
<span class="cp">#define __S010	PAGE_SHARED</span>
<span class="cp">#define __S011	PAGE_SHARED</span>
<span class="cp">#define __S100	PAGE_READONLY_EXEC</span>
<span class="cp">#define __S101	PAGE_READONLY_EXEC</span>
<span class="cp">#define __S110	PAGE_SHARED_EXEC</span>
<span class="cp">#define __S111	PAGE_SHARED_EXEC</span>

<span class="cm">/*</span>
<span class="cm"> * early identity mapping  pte attrib macros.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_X86_64</span>
<span class="cp">#define __PAGE_KERNEL_IDENT_LARGE_EXEC	__PAGE_KERNEL_LARGE_EXEC</span>
<span class="cp">#else</span>
<span class="cm">/*</span>
<span class="cm"> * For PDE_IDENT_ATTR include USER bit. As the PDE and PTE protection</span>
<span class="cm"> * bits are combined, this will alow user to access the high address mapped</span>
<span class="cm"> * VDSO in the presence of CONFIG_COMPAT_VDSO</span>
<span class="cm"> */</span>
<span class="cp">#define PTE_IDENT_ATTR	 0x003		</span><span class="cm">/* PRESENT+RW */</span><span class="cp"></span>
<span class="cp">#define PDE_IDENT_ATTR	 0x067		</span><span class="cm">/* PRESENT+RW+USER+DIRTY+ACCESSED */</span><span class="cp"></span>
<span class="cp">#define PGD_IDENT_ATTR	 0x001		</span><span class="cm">/* PRESENT (no other attributes) */</span><span class="cp"></span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_X86_32</span>
<span class="cp"># include &quot;pgtable_32_types.h&quot;</span>
<span class="cp">#else</span>
<span class="cp"># include &quot;pgtable_64_types.h&quot;</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cm">/* PTE_PFN_MASK extracts the PFN from a (pte|pmd|pud|pgd)val_t */</span>
<span class="cp">#define PTE_PFN_MASK		((pteval_t)PHYSICAL_PAGE_MASK)</span>

<span class="cm">/* PTE_FLAGS_MASK extracts the flags from a (pte|pmd|pud|pgd)val_t */</span>
<span class="cp">#define PTE_FLAGS_MASK		(~PTE_PFN_MASK)</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pgprot</span> <span class="p">{</span> <span class="n">pgprotval_t</span> <span class="n">pgprot</span><span class="p">;</span> <span class="p">}</span> <span class="n">pgprot_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span> <span class="n">pgdval_t</span> <span class="n">pgd</span><span class="p">;</span> <span class="p">}</span> <span class="n">pgd_t</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pgd_t</span> <span class="nf">native_make_pgd</span><span class="p">(</span><span class="n">pgdval_t</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">pgd_t</span><span class="p">)</span> <span class="p">{</span> <span class="n">val</span> <span class="p">};</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pgdval_t</span> <span class="nf">native_pgd_val</span><span class="p">(</span><span class="n">pgd_t</span> <span class="n">pgd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">pgd</span><span class="p">.</span><span class="n">pgd</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pgdval_t</span> <span class="nf">pgd_flags</span><span class="p">(</span><span class="n">pgd_t</span> <span class="n">pgd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">native_pgd_val</span><span class="p">(</span><span class="n">pgd</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">PTE_FLAGS_MASK</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#if PAGETABLE_LEVELS &gt; 3</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span> <span class="n">pudval_t</span> <span class="n">pud</span><span class="p">;</span> <span class="p">}</span> <span class="n">pud_t</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pud_t</span> <span class="nf">native_make_pud</span><span class="p">(</span><span class="n">pmdval_t</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">pud_t</span><span class="p">)</span> <span class="p">{</span> <span class="n">val</span> <span class="p">};</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pudval_t</span> <span class="nf">native_pud_val</span><span class="p">(</span><span class="n">pud_t</span> <span class="n">pud</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">pud</span><span class="p">.</span><span class="n">pud</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="cp">#include &lt;asm-generic/pgtable-nopud.h&gt;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pudval_t</span> <span class="nf">native_pud_val</span><span class="p">(</span><span class="n">pud_t</span> <span class="n">pud</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">native_pgd_val</span><span class="p">(</span><span class="n">pud</span><span class="p">.</span><span class="n">pgd</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#if PAGETABLE_LEVELS &gt; 2</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span> <span class="n">pmdval_t</span> <span class="n">pmd</span><span class="p">;</span> <span class="p">}</span> <span class="n">pmd_t</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pmd_t</span> <span class="nf">native_make_pmd</span><span class="p">(</span><span class="n">pmdval_t</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">pmd_t</span><span class="p">)</span> <span class="p">{</span> <span class="n">val</span> <span class="p">};</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pmdval_t</span> <span class="nf">native_pmd_val</span><span class="p">(</span><span class="n">pmd_t</span> <span class="n">pmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">pmd</span><span class="p">.</span><span class="n">pmd</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="cp">#include &lt;asm-generic/pgtable-nopmd.h&gt;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pmdval_t</span> <span class="nf">native_pmd_val</span><span class="p">(</span><span class="n">pmd_t</span> <span class="n">pmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">native_pgd_val</span><span class="p">(</span><span class="n">pmd</span><span class="p">.</span><span class="n">pud</span><span class="p">.</span><span class="n">pgd</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pudval_t</span> <span class="nf">pud_flags</span><span class="p">(</span><span class="n">pud_t</span> <span class="n">pud</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">native_pud_val</span><span class="p">(</span><span class="n">pud</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">PTE_FLAGS_MASK</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pmdval_t</span> <span class="nf">pmd_flags</span><span class="p">(</span><span class="n">pmd_t</span> <span class="n">pmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">native_pmd_val</span><span class="p">(</span><span class="n">pmd</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">PTE_FLAGS_MASK</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">native_make_pte</span><span class="p">(</span><span class="n">pteval_t</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">pte_t</span><span class="p">)</span> <span class="p">{</span> <span class="p">.</span><span class="n">pte</span> <span class="o">=</span> <span class="n">val</span> <span class="p">};</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pteval_t</span> <span class="nf">native_pte_val</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">pte</span><span class="p">.</span><span class="n">pte</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pteval_t</span> <span class="nf">pte_flags</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">native_pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">PTE_FLAGS_MASK</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define pgprot_val(x)	((x).pgprot)</span>
<span class="cp">#define __pgprot(x)	((pgprot_t) { (x) } )</span>


<span class="k">typedef</span> <span class="k">struct</span> <span class="n">page</span> <span class="o">*</span><span class="n">pgtable_t</span><span class="p">;</span>

<span class="k">extern</span> <span class="n">pteval_t</span> <span class="n">__supported_pte_mask</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">set_nx</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">nx_enabled</span><span class="p">;</span>

<span class="cp">#define pgprot_writecombine	pgprot_writecombine</span>
<span class="k">extern</span> <span class="n">pgprot_t</span> <span class="n">pgprot_writecombine</span><span class="p">(</span><span class="n">pgprot_t</span> <span class="n">prot</span><span class="p">);</span>

<span class="cm">/* Indicate that x86 has its own track and untrack pfn vma functions */</span>
<span class="cp">#define __HAVE_PFNMAP_TRACKING</span>

<span class="cp">#define __HAVE_PHYS_MEM_ACCESS_PROT</span>
<span class="k">struct</span> <span class="n">file</span><span class="p">;</span>
<span class="n">pgprot_t</span> <span class="n">phys_mem_access_prot</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pfn</span><span class="p">,</span>
                              <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">,</span> <span class="n">pgprot_t</span> <span class="n">vma_prot</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">phys_mem_access_prot_allowed</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pfn</span><span class="p">,</span>
                              <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">,</span> <span class="n">pgprot_t</span> <span class="o">*</span><span class="n">vma_prot</span><span class="p">);</span>

<span class="cm">/* Install a pte for a particular vaddr in kernel space. */</span>
<span class="kt">void</span> <span class="n">set_pte_vaddr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vaddr</span><span class="p">,</span> <span class="n">pte_t</span> <span class="n">pte</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">native_pagetable_reserve</span><span class="p">(</span><span class="n">u64</span> <span class="n">start</span><span class="p">,</span> <span class="n">u64</span> <span class="n">end</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_X86_32</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">native_pagetable_setup_start</span><span class="p">(</span><span class="n">pgd_t</span> <span class="o">*</span><span class="n">base</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">native_pagetable_setup_done</span><span class="p">(</span><span class="n">pgd_t</span> <span class="o">*</span><span class="n">base</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="cp">#define native_pagetable_setup_start x86_init_pgd_noop</span>
<span class="cp">#define native_pagetable_setup_done  x86_init_pgd_noop</span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">seq_file</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">arch_report_meminfo</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">);</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">PG_LEVEL_NONE</span><span class="p">,</span>
	<span class="n">PG_LEVEL_4K</span><span class="p">,</span>
	<span class="n">PG_LEVEL_2M</span><span class="p">,</span>
	<span class="n">PG_LEVEL_1G</span><span class="p">,</span>
	<span class="n">PG_LEVEL_NUM</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_PROC_FS</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">update_page_count</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pages</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">update_page_count</span><span class="p">(</span><span class="kt">int</span> <span class="n">level</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pages</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Helper function that returns the kernel pagetable entry controlling</span>
<span class="cm"> * the virtual address &#39;address&#39;. NULL means no pagetable entry present.</span>
<span class="cm"> * NOTE: the return type is pte_t but if the pmd is PSE then we return it</span>
<span class="cm"> * as a pte too.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="n">pte_t</span> <span class="o">*</span><span class="n">lookup_address</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">level</span><span class="p">);</span>

<span class="cp">#endif	</span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _ASM_X86_PGTABLE_DEFS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
