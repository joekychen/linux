d | tools |  | 8 items |  | Masami Hiramatsu | masami.hiramatsu.pt@hitachi.com | 1338965658 |  | x86/decoder: Fix bsr/bsf/jmpe decoding with operand-size prefix  Fix the x86 instruction decoder to decode bsr/bsf/jmpe with operand-size prefix (66h). This fixes the test case failure reported by Linus, attached below.  bsf/bsr/jmpe have a special encoding. Opcode map in Intel Software Developers Manual vol2 says they have TZCNT/LZCNT variants if it has F3h prefix. However, there is no information if it has other 66h or F2h prefixes. Current instruction decoder supposes that those are bad instructions, but it actually accepts at least operand-size prefixes.  H. Peter Anvin further explains:   " TZCNT/LZCNT are F3 + BSF/BSR exactly because the F2 and    F3 prefixes have historically been no-ops with most instructions.    This allows software to unconditionally use the prefixed versions    and get TZCNT/LZCNT on the processors that have them if they don't    care about the difference. "  This fixes errors reported by test_get_len:    Warning: arch/x86/tools/test_get_len found difference at <em_bsf>:ffffffff81036d87   Warning: ffffffff81036de5:	66 0f bc c2          	bsf    %dx,%ax   Warning: objdump says 4 bytes, but insn_get_length() says 3   Warning: arch/x86/tools/test_get_len found difference at <em_bsr>:ffffffff81036ea6   Warning: ffffffff81036f04:	66 0f bd c2          	bsr    %dx,%ax   Warning: objdump says 4 bytes, but insn_get_length() says 3   Warning: decoded and checked 13298882 instructions with 2 warnings  Reported-by: Linus Torvalds <torvalds@linux-foundation.org> Reported-by: Pekka Enberg <penberg@kernel.org> Signed-off-by: Masami Hiramatsu <masami.hiramatsu.pt@hitachi.com> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: <yrl.pp-manager.tt@hitachi.com> Link: http://lkml.kernel.org/r/20120604150911.22338.43296.stgit@localhost.localdomain Signed-off-by: Ingo Molnar <mingo@kernel.org>
d | kernel |  | 127 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1341079918 |  | Merge branch 'release' of git://git.kernel.org/pub/scm/linux/kernel/git/lenb/linux  Pull ACPI & Power Management patches from Len Brown.  * 'release' of git://git.kernel.org/pub/scm/linux/kernel/git/lenb/linux:   acpi_pad: fix power_saving thread deadlock   ACPI video: Still use ACPI backlight control if _DOS doesn't exist   ACPI, APEI, Avoid too much error reporting in runtime   ACPI: Add a quirk for "AMILO PRO V2030" to ignore the timer overriding   ACPI: Remove one board specific WARN when ignoring timer overriding   ACPI: Make acpi_skip_timer_override cover all source_irq==0 cases   ACPI, x86: fix Dell M6600 ACPI reboot regression via DMI   ACPI sysfs.c strlen fix
f | Makefile | g | 7.4K |  | Linus Torvalds | torvalds@linux-foundation.org | 1337818120 |  | 
d | net |  | 3 items |  | Jan Seiffert | kaffeemonster@googlemail.com | 1333490501 |  | bpf jit: Let the x86 jit handle negative offsets  Now the helper function from filter.c for negative offsets is exported, it can be used it in the jit to handle negative offsets.  First modify the asm load helper functions to handle: - know positive offsets - know negative offsets - any offset  then the compiler can be modified to explicitly use these helper when appropriate.  This fixes the case of a negative X register and allows to lift the restriction that bpf programs with negative offsets can't be jited.  Signed-of-by: Jan Seiffert <kaffeemonster@googlemail.com> Signed-off-by: Eric Dumazet <eric.dumazet@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
d | boot |  | 39 items |  | Jordan Justen | jordan.l.justen@intel.com | 1339087953 |  | x86, efi stub: Add .reloc section back into image  Some UEFI firmware will not load a .efi with a .reloc section with a size of 0.  Therefore, we create a .efi image with 4 main areas and 3 sections. 1. PE/COFF file header 2. .setup section (covers all setup code following the first sector) 3. .reloc section (contains 1 dummy reloc entry, created in build.c) 4. .text section (covers the remaining kernel image)  To make room for the new .setup section data, the header bugger_off_msg had to be shortened.  Reported-by: Henrik Rydberg <rydberg@euromail.se> Signed-off-by: Jordan Justen <jordan.l.justen@intel.com> Link: http://lkml.kernel.org/r/1339085121-12760-1-git-send-email-jordan.l.justen@intel.com Tested-by: Lee G Rosenbaum <lee.g.rosenbaum@intel.com> Tested-by: Henrik Rydberg <rydberg@euromail.se> Cc: Matt Fleming <matt.fleming@intel.com> Signed-off-by: H. Peter Anvin <hpa@zytor.com>
d | include |  | 1 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1340990994 |  | Merge branch 'x86-urgent-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip  Pull x86 fixes from Ingo Molnar.  * 'x86-urgent-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip:   x86, cpufeature: Remove stray %s, add -w to mkcapflags.pl   x86, cpufeature: Catch duplicate CPU feature strings   x86, cpufeature: Rename X86_FEATURE_DTS to X86_FEATURE_DTHERM   x86: Fix kernel-doc warnings   x86, compat: Use test_thread_flag(TIF_IA32) in compat signal delivery
d | xen |  | 30 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1339805835 |  | 
f | Kconfig.debug | g | 9.1K |  | Linus Torvalds | torvalds@linux-foundation.org | 1326338020 |  | Merge branch 'x86-platform-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip  * 'x86-platform-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip:   x86/intel config: Fix the APB_TIMER selection   x86/mrst: Add additional debug prints for pb_keys   x86/intel config: Revamp configuration to allow for Moorestown and Medfield   x86/intel/scu/ipc: Match the changes in the x86 configuration   x86/apb: Fix configuration constraints   x86: Fix INTEL_MID silly   x86/Kconfig: Cyclone-timer depends on x86-summit   x86: Reduce clock calibration time during slave cpu startup   x86/config: Revamp configuration for MID devices   x86/sfi: Kill the IRQ as id hack
d | crypto |  | 27 items |  | Mathias Krause | minipli@googlemail.com | 1338461602 |  | crypto: aesni-intel - fix unaligned cbc decrypt for x86-32  The 32 bit variant of cbc(aes) decrypt is using instructions requiring 128 bit aligned memory locations but fails to ensure this constraint in the code. Fix this by loading the data into intermediate registers with load unaligned instructions.  This fixes reported general protection faults related to aesni.  References: https://bugzilla.kernel.org/show_bug.cgi?id=43223 Reported-by: Daniel <garkein@mailueberfall.de> Cc: stable@kernel.org [v2.6.39+] Signed-off-by: Mathias Krause <minipli@googlemail.com> Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
d | realmode |  | 4 items |  | H. Peter Anvin | hpa@linux.intel.com | 1337583765 |  | x86, realmode: Move end signature into header.S  The end signature was defined in wakeup_asm.S as it originally came from the ACPI wakeup code.  However, we rely on the existence of the .signature section to expand .bss, otherwise we would have to include code to explicitly zero the .bss depending on the configuration. Since the expanded .bss is just in .init.data anyway, it's easier to always have it expanded.  This fixes failures when compiled without CONFIG_ACPI_SLEEP.  Reported-by: Ingo Molnar <mingo@kernel.org> Signed-off-by: H. Peter Anvin <hpa@zytor.com> Cc: Jarkko Sakkinen <jarkko.sakkinen@intel.com>
d | syscalls |  | 5 items |  | Cyrill Gorcunov | gorcunov@openvz.org | 1338511772 |  | syscalls, x86: add __NR_kcmp syscall  While doing the checkpoint-restore in the user space one need to determine whether various kernel objects (like mm_struct-s of file_struct-s) are shared between tasks and restore this state.  The 2nd step can be solved by using appropriate CLONE_ flags and the unshare syscall, while there's currently no ways for solving the 1st one.  One of the ways for checking whether two tasks share e.g.  mm_struct is to provide some mm_struct ID of a task to its proc file, but showing such info considered to be not that good for security reasons.  Thus after some debates we end up in conclusion that using that named 'comparison' syscall might be the best candidate.  So here is it -- __NR_kcmp.  It takes up to 5 arguments - the pids of the two tasks (which characteristics should be compared), the comparison type and (in case of comparison of files) two file descriptors.  Lookups for pids are done in the caller's PID namespace only.  At moment only x86 is supported and tested.  [akpm@linux-foundation.org: fix up selftests, warnings] [akpm@linux-foundation.org: include errno.h] [akpm@linux-foundation.org: tweak comment text] Signed-off-by: Cyrill Gorcunov <gorcunov@openvz.org> Acked-by: "Eric W. Biederman" <ebiederm@xmission.com> Cc: Pavel Emelyanov <xemul@parallels.com> Cc: Andrey Vagin <avagin@openvz.org> Cc: KOSAKI Motohiro <kosaki.motohiro@gmail.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: H. Peter Anvin <hpa@zytor.com> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Glauber Costa <glommer@parallels.com> Cc: Andi Kleen <andi@firstfloor.org> Cc: Tejun Heo <tj@kernel.org> Cc: Matt Helsley <matthltc@us.ibm.com> Cc: Pekka Enberg <penberg@kernel.org> Cc: Eric Dumazet <eric.dumazet@gmail.com> Cc: Vasiliy Kulikov <segoon@openwall.com> Cc: Alexey Dobriyan <adobriyan@gmail.com> Cc: Valdis.Kletnieks@vt.edu Cc: Michal Marek <mmarek@suse.cz> Cc: Frederic Weisbecker <fweisbec@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
d | power |  | 6 items |  | Marcelo Tosatti | mtosatti@redhat.com | 1333367580 |  | x86, kvm: Call restore_sched_clock_state() only after %gs is initialized  s2ram broke due to this KVM commit:    b74f05d61b73 x86: kvmclock: abstract save/restore sched_clock_state  restore_sched_clock_state() methods use percpu data, therefore they must run after %gs is initialized, but before mtrr_bp_restore() (due to lockstat using sched_clock).  Move it to the correct place.  Reported-and-tested-by: Konstantin Khlebnikov <khlebnikov@openvz.org> Signed-off-by: Marcelo Tosatti <mtosatti@redhat.com> Cc: Avi Kivity <avi@redhat.com> Signed-off-by: Ingo Molnar <mingo@kernel.org>
d | mm |  | 38 items |  | Wanpeng Li | liwp@linux.vnet.ibm.com | 1339404885 |  | x86/mm: Fix some kernel-doc warnings  Fix kernel-doc warnings in arch/x86/mm/ioremap.c and arch/x86/mm/pageattr.c, just like this one:    Warning(arch/x86/mm/ioremap.c:204):      No description found for parameter 'phys_addr'   Warning(arch/x86/mm/ioremap.c:204):      Excess function parameter 'offset' description in 'ioremap_nocache'  Signed-off-by: Wanpeng Li <liwp@linux.vnet.ibm.com> Cc: Gavin Shan <shangw@linux.vnet.ibm.com> Cc: Wanpeng Li <liwp.linux@gmail.com> Link: http://lkml.kernel.org/r/1339296652-2935-1-git-send-email-liwp.linux@gmail.com Signed-off-by: Ingo Molnar <mingo@kernel.org>
d | vdso |  | 15 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1333069943 |  | Merge branch 'x86-x32-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip  Pull x32 support for x86-64 from Ingo Molnar:  "This tree introduces the X32 binary format and execution mode for x86:   32-bit data space binaries using 64-bit instructions and 64-bit kernel   syscalls.    This allows applications whose working set fits into a 32 bits address   space to make use of 64-bit instructions while using a 32-bit address   space with shorter pointers, more compressed data structures, etc."  Fix up trivial context conflicts in arch/x86/{Kconfig,vdso/vma.c}  * 'x86-x32-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip: (71 commits)   x32: Fix alignment fail in struct compat_siginfo   x32: Fix stupid ia32/x32 inversion in the siginfo format   x32: Add ptrace for x32   x32: Switch to a 64-bit clock_t   x32: Provide separate is_ia32_task() and is_x32_task() predicates   x86, mtrr: Use explicit sizing and padding for the 64-bit ioctls   x86/x32: Fix the binutils auto-detect   x32: Warn and disable rather than error if binutils too old   x32: Only clear TIF_X32 flag once   x32: Make sure TS_COMPAT is cleared for x32 tasks   fs: Remove missed ->fds_bits from cessation use of fd_set structs internally   fs: Fix close_on_exec pointer in alloc_fdtable   x32: Drop non-__vdso weak symbols from the x32 VDSO   x32: Fix coding style violations in the x32 VDSO code   x32: Add x32 VDSO support   x32: Allow x32 to be configured   x32: If configured, add x32 system calls to system call tables   x32: Handle process creation   x32: Signal-related system calls   x86: Add #ifdef CONFIG_COMPAT to <asm/sys_ia32.h>   ...
d | oprofile |  | 9 items |  | H. Peter Anvin | hpa@zytor.com | 1329770926 |  | x86: Factor out TIF_IA32 from 32-bit address space  Factor out IA32 (compatibility instruction set) from 32-bit address space in the thread_info flags; this is a precondition patch for x32 support.  Originally-by: H. J. Lu <hjl.tools@gmail.com> Signed-off-by: H. Peter Anvin <hpa@zytor.com> Link: http://lkml.kernel.org/n/tip-4pr1xnnksprt7t0h3w5fw4rv@git.kernel.org
d | math-emu |  | 47 items |  | Srikar Dronamraju | srikar@linux.vnet.ibm.com | 1331616249 |  | x86: Rename trap_no to trap_nr in thread_struct  There are precedences of trap number being referred to as trap_nr. However thread struct refers trap number as trap_no. Change it to trap_nr.  Also use enum instead of left-over literals for trap values.  This is pure cleanup, no functional change intended.  Suggested-by: Ingo Molnar <mingo@eltu.hu> Signed-off-by: Srikar Dronamraju <srikar@linux.vnet.ibm.com> Cc: Linus Torvalds <torvalds@linux-foundation.org> Cc: Ananth N Mavinakayanahalli <ananth@in.ibm.com> Cc: Jim Keniston <jkenisto@linux.vnet.ibm.com> Cc: Linux-mm <linux-mm@kvack.org> Cc: Oleg Nesterov <oleg@redhat.com> Cc: Andi Kleen <andi@firstfloor.org> Cc: Christoph Hellwig <hch@infradead.org> Cc: Steven Rostedt <rostedt@goodmis.org> Cc: Arnaldo Carvalho de Melo <acme@infradead.org> Cc: Masami Hiramatsu <masami.hiramatsu.pt@hitachi.com> Cc: Peter Zijlstra <peterz@infradead.org> Link: http://lkml.kernel.org/r/20120312092555.5379.942.sendpatchset@srdronam.in.ibm.com [ Fixed the math-emu build ] Signed-off-by: Ingo Molnar <mingo@elte.hu>
d | lib |  | 42 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1340990994 |  | Merge branch 'x86-urgent-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip  Pull x86 fixes from Ingo Molnar.  * 'x86-urgent-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip:   x86, cpufeature: Remove stray %s, add -w to mkcapflags.pl   x86, cpufeature: Catch duplicate CPU feature strings   x86, cpufeature: Rename X86_FEATURE_DTS to X86_FEATURE_DTHERM   x86: Fix kernel-doc warnings   x86, compat: Use test_thread_flag(TIF_IA32) in compat signal delivery
f | Makefile.um | g | 1.6K |  | Al Viro | viro@zeniv.linux.org.uk | 1333994340 |  | um: fix linker script generation  while we can't just use -U$(SUBARCH), we still need to kill idiotic define (implicit -Di386=1), both for SUBARCH=i386 and SUBARCH=x86/CONFIG_64BIT=n builds.  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | Makefile_32.cpu | g | 3.2K |  | Ian Campbell | ijc@hellion.org.uk | 1302292885 |  | x86, cpu: Move AMD Elan Kconfig under "Processor family"  Currently the option resides under X86_EXTENDED_PLATFORM due to historical nonstandard A20M# handling. However that is no longer the case and so Elan can be treated as part of the standard processor choice Kconfig option.  Signed-off-by: Ian Campbell <ian.campbell@citrix.com> Link: http://lkml.kernel.org/r/1302245177.31620.47.camel@localhost.localdomain Cc: H. Peter Anvin <hpa@zytor.com> Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | Kbuild | g | 316B |  | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502508 |  | x86, realmode: realmode.bin infrastructure  Create realmode.bin and realmode.relocs files. Piggy pack them into relocatable object that will be included into .init.data section of the main kernel image.  The first file includes binary image of the real-mode code. The latter file includes all relocations. The layout of the binary image is specified in realmode.lds.S. The makefile generates pa_ prefixed symbols for each exported global. These are used in 32-bit code and in realmode header to define symbols that need to be relocated.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-3-git-send-email-jarkko.sakkinen@intel.com Originally-by: H. Peter Anvin <hpa@linux.intel.com> Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
d | um |  | 35 items |  | Martin Pelikan | pelikan@storkhole.cz | 1339271469 |  | x86, um: Correct syscall table type attributes breaking gcc 4.8  The latest GCC 4.8 does some more checking on type attributes that break the build for ARCH=um -> fill them in.  Specifically, the "asmlinkage" attributes is now tested for consistency.  Signed-off-by: Martin Pelikan <pelikan@storkhole.cz> Link: http://lkml.kernel.org/r/1339269731-10772-1-git-send-email-pelikan@storkhole.cz Acked-by: Richard Weinberger <richard@nod.at> Signed-off-by: H. Peter Anvin <hpa@zytor.com>
d | ia32 |  | 9 items |  | Suresh Siddha | suresh.b.siddha@intel.com | 1339722964 |  | x86, compat: Use test_thread_flag(TIF_IA32) in compat signal delivery  Signal delivery compat path may not have the 'TS_COMPAT' flag (that flag indicates how we entered the kernel).  So use test_thread_flag(TIF_IA32) instead of is_ia32_task(): one of the functions of TIF_IA32 is just what kind of signal frame we want.  Signed-off-by: Suresh Siddha <suresh.b.siddha@intel.com> Link: http://lkml.kernel.org/r/1339722435.3475.57.camel@sbsiddha-desk.sc.intel.com Cc: stable@kernel.org	# v3.4 Signed-off-by: H. Peter Anvin <hpa@zytor.com>
d | pci |  | 25 items |  | Linus Torvalds | torvalds@linux-foundation.org | 1337900528 |  | 
f | Kconfig.cpu | g | 15K |  | Jan Beulich | JBeulich@suse.com | 1331200654 |  | x86: Tighten dependencies of CPU_SUP_*_32  Building in support for either of these CPUs is pointless when e.g. M686 was selected (since such a kernel would use cmov instructions, which aren't available on these older CPUs).  Signed-off-by: Jan Beulich <jbeulich@suse.com> Link: http://lkml.kernel.org/r/4F58875A02000078000770E0@nat28.tlf.novell.com Signed-off-by: Ingo Molnar <mingo@elte.hu>
d | kvm |  | 27 items |  | Xiao Guangrong | xiaoguangrong@linux.vnet.ibm.com | 1338216075 |  | KVM: MMU: fix huge page adapted on non-PAE host  The huge page size is 4M on non-PAE host, but 2M page size is used in transparent_hugepage_adjust(), so the page we get after adjust the mapping level is not the head page, the BUG_ON() will be triggered  Signed-off-by: Xiao Guangrong <xiaoguangrong@linux.vnet.ibm.com> Signed-off-by: Avi Kivity <avi@redhat.com>
d | platform |  | 11 items |  | Kay Sievers | kay@vrfy.org | 1339797239 |  | kmsg - kmsg_dump() use iterator to receive log buffer content  Provide an iterator to receive the log buffer content, and convert all kmsg_dump() users to it.  The structured data in the kmsg buffer now contains binary data, which should no longer be copied verbatim to the kmsg_dump() users.  The iterator should provide reliable access to the buffer data, and also supports proper log line-aware chunking of data while iterating.  Signed-off-by: Kay Sievers <kay@vrfy.org> Tested-by: Tony Luck <tony.luck@intel.com> Reported-by: Anton Vorontsov <anton.vorontsov@linaro.org> Tested-by: Anton Vorontsov <anton.vorontsov@linaro.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | Kconfig | g | 70K |  | Matt Fleming | matt.fleming@intel.com | 1338567101 |  | x86, efi: Add EFI boot stub documentation  Since we can't expect every user to read the EFI boot stub code it seems prudent to have a couple of paragraphs explaining what it is and how it works.  The "initrd=" option in particular is tricky because it only understands absolute EFI-style paths (backslashes as directory separators), and until now this hasn't been documented anywhere. This has tripped up a couple of users.  Cc: Matthew Garrett <mjg@redhat.com> Cc: Randy Dunlap <rdunlap@xenotime.net> Signed-off-by: Matt Fleming <matt.fleming@intel.com> Link: http://lkml.kernel.org/r/1331907517-3985-4-git-send-email-matt@console-pimps.org Signed-off-by: H. Peter Anvin <hpa@zytor.com>
d | video |  | 2 items |  | Matthew Garrett | mjg@redhat.com | 1335257417 |  | x86: Use vga_default_device() when determining whether an fb is primary  IORESOURCE_ROM_SHADOW is not necessarily an indication that the hardware is the primary device. Add support for using the vgaarb functions and fall back if nothing's set them.  Signed-off-by: Matthew Garrett <mjg@redhat.com> Cc: mingo@redhat.com Acked-by: hpa@zytor.com Signed-off-by: Dave Airlie <airlied@redhat.com>
d | configs |  | 2 items |  | Randy Dunlap | rdunlap@xenotime.net | 1332573483 |  | x86/kconfig: Remove CONFIG_TR=y from the defconfigs  Remove CONFIG_TR=y from the x86 defconfigs since token ring support is antiquated and obsolete.  ( I reviewed both x86 defconfigs - I didn't come up with   anything else that obviously should be removed. )  Signed-off-by: Randy Dunlap <rdunlap@xenotime.net> Link: http://lkml.kernel.org/r/4F6D05CA.2050801@xenotime.net [ Twiddled the changelog a bit ] Signed-off-by: Ingo Molnar <mingo@kernel.org>
d | lguest |  | 4 items |  | Stratos Psomadakis | psomas@cslab.ece.ntua.gr | 1326345287 |  | lguest: Make sure interrupt is allocated ok by lguest_setup_irq  Make sure the interrupt is allocated correctly by lguest_setup_irq (check the return value of irq_alloc_desc_at for -ENOMEM)  Signed-off-by: Stratos Psomadakis <psomas@cslab.ece.ntua.gr> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au> (cleanups and commentry)
