f | Makefile | g | 245B |  | Daniel Drake | dsd@laptop.org | 1309988683 |  | x86, olpc: Add XO-1.5 SCI driver  Add a driver for the ACPI-based EC event interface found on the OLPC XO-1.5 laptop. This enables notification of battery/AC power events, and enables various devices to be used as wakeup sources through regular ACPI mechanisms.  This driver can't be built as a module, because some drivers need to know at boot-time if SCI-based functionality is available via olpc_ec_wakeup_available().  Signed-off-by: Daniel Drake <dsd@laptop.org> Link: http://lkml.kernel.org/r/1309019658-1712-12-git-send-email-dsd@laptop.org Acked-by: Andres Salomon <dilinger@queued.net> Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | olpc-xo15-sci.c | s | 5.4K | 192 | Daniel Drake | dsd@laptop.org | 1331024231 |  | x86/olpc/xo15/sci: Enable lid close wakeup control  Like most systems, OLPC's ACPI LID switch wakes up the system when the lid is opened, but not when it is closed.  Under OLPC's opportunistic suspend model, the lid may be closed while the system was oportunistically suspended with the screen running.  In this event, we want to wake up to turn the screen off.  Enable control of normal ACPI wakeups through lid close events through a new sysfs attribute "lid_wake_on_closed".  When set, and when LID wakeups are enabled through ACPI, the system will wake up on both open and close lid events.  Signed-off-by: Daniel Drake <dsd@laptop.org> Cc: Andres Salomon <dilinger@queued.net> Cc: Matthew Garrett <mjg@redhat.com> [ Fixed sscanf checking] Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Link: http://lkml.kernel.org/n/tip-bgt8hxu2wwe0x5p8edhogtf7@git.kernel.org [ Did very minor readability tweaks ] Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | olpc-xo1-pm.c | s | 5.1K | 174 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103835 |  | x86: Fix files explicitly requiring export.h for EXPORT_SYMBOL/THIS_MODULE  These files were implicitly getting EXPORT_SYMBOL via device.h which was including module.h, but that will be fixed up shortly.  By fixing these now, we can avoid seeing things like:  arch/x86/kernel/rtc.c:29: warning: type defaults to ‘int’ in declaration of ‘EXPORT_SYMBOL’ arch/x86/kernel/pci-dma.c:20: warning: type defaults to ‘int’ in declaration of ‘EXPORT_SYMBOL’ arch/x86/kernel/e820.c:69: warning: type defaults to ‘int’ in declaration of ‘EXPORT_SYMBOL_GPL’  [ with input from Randy Dunlap <rdunlap@xenotime.net> and also   from Stephen Rothwell <sfr@canb.auug.org.au> ]  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | olpc-xo1-rtc.c | s | 1.8K | 69 | Daniel Drake | dsd@laptop.org | 1309988682 |  | x86, olpc: Add XO-1 RTC driver  Add a driver to configure the XO-1 RTC via CS5536 MSRs, to be used as a system wakeup source via olpc-xo1-pm.  Device detection is based on finding the relevant device tree node.  Signed-off-by: Daniel Drake <dsd@laptop.org> Link: http://lkml.kernel.org/r/1309019658-1712-11-git-send-email-dsd@laptop.org Acked-by: Andres Salomon <dilinger@queued.net> Acked-by: Grant Likely <grant.likely@secretlab.ca> Reviewed-by: Sebastian Andrzej Siewior <bigeasy@linutronix.de> Cc: devicetree-discuss@lists.ozlabs.org Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | olpc-xo1-sci.c | s | 15K | 524 | Daniel Drake | dsd@laptop.org | 1336395746 |  | x86/olpc/xo1/sci: Report RTC wakeup events  When the system is woken due to a RTC event, report the wakeup event on the relevant rtc device (if it can be found).  Signed-off-by: Daniel Drake <dsd@laptop.org> Cc: dilinger@queued.net Cc: pgf@laptop.org Link: http://lkml.kernel.org/r/20120418223402.D73249D401E@zog.reactivated.net Signed-off-by: Ingo Molnar <mingo@kernel.org>
f | olpc_dt.c | s | 6.6K | 247 | Daniel Drake | dsd@laptop.org | 1309988659 |  | x86, olpc: Add missing elements to device tree  In response to new device tree code in the kernel, OLPC will start using it for probing of certain devices. However, some firmware fixes are needed to put the devicetree into a usable state.  Retain compatibility with old firmware by fixing up the device tree at boot-time if it does not contain the new nodes/properties that we need for probing. This is the same approach taken on PPC platforms.  Signed-off-by: Daniel Drake <dsd@laptop.org> Link: http://lkml.kernel.org/r/1309019658-1712-2-git-send-email-dsd@laptop.org Acked-by: Grant Likely <grant.likely@secretlab.ca> Acked-by: Andres Salomon <dilinger@queued.net> Cc: devicetree-discuss@lists.ozlabs.org Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | olpc_ofw.c | s | 2.7K | 91 | Andres Salomon | dilinger@queued.net | 1292461890 |  | x86, olpc: Add OLPC device-tree support  Make use of PROC_DEVICETREE to export the tree, and sparc's PROMTREE code to call into OLPC's Open Firmware to build the tree.  v5: fix buglet with root node check (introduced in v4)  v4: address some minor style issues pointed out by Grant, and explicitly cast     negative phandle checks to s32.  v3: rename olpc_prom to olpc_dt   - rework Kconfig entries   - drop devtree build hook from proc, instead adding a call to x86's     paging_init (similarly to how sparc64 does it)   - switch allocation from using slab to alloc_bootmem.  this allows     the DT to be built earlier during boot (during setup_arch); the     downside is that there are some 1200 bootmem reservations that are     done during boot.  Not ideal..   - add a helper olpc_ofw_is_installed function to test for the     existence and successful detection of OLPC's OFW.  Signed-off-by: Andres Salomon <dilinger@queued.net> LKML-Reference: <20101116220952.26526a80@queued.net> Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | xo1-wakeup.S | g | 2.1K |  | Daniel Drake | dsd@laptop.org | 1309988672 |  | x86, olpc: Add XO-1 suspend/resume support  Add code needed for basic suspend/resume of the XO-1 laptop. Based on earlier work by Jordan Crouse, Andres Salomon, and others.  This patch incorporates all earlier feedback from Thomas Gleixner. To clarify a certain point (now more obvious in the code itself): On resume, OpenFirmware returns execution to Linux in protected mode with a kernel-compatible GDT already set up. The changes and simplifications suggested have all been included.  Signed-off-by: Daniel Drake <dsd@laptop.org> Link: http://lkml.kernel.org/r/1309019658-1712-5-git-send-email-dsd@laptop.org Acked-by: Andres Salomon <dilinger@queued.net> Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | olpc.c | s | 11K | 395 | Daniel Drake | dsd@laptop.org | 1332874492 |  | x86/olpc: Add debugfs interface for EC commands  Add a debugfs interface for sending commands to the OLPC Embedded Controller (EC) and reading the responses.  The EC provides functionality for machine identification, battery and AC control, wakeup control, etc.  Having a debugfs interface available is useful for EC development and debugging.  Based on code by Paul Fox (who also approves of the end result).  Signed-off-by: Daniel Drake <dsd@laptop.org> Acked-by: Paul Fox <pgf@laptop.org> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: Andres Salomon <dilinger@queued.net> Link: http://lkml.kernel.org/r/20120327150740.667D09D401E@zog.reactivated.net Signed-off-by: Ingo Molnar <mingo@kernel.org>
