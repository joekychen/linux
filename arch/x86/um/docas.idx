d | asm |  | 21 items |  | Al Viro | viro@zeniv.linux.org.uk | 1337632114 |  | um/x86: merge (and trim) 32- and 64-bit variants of ptrace.h  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | bugs_32.c | s | 1.8K | 61 | Al Viro | viro@zeniv.linux.org.uk | 1332631795 |  | um: kill HOST_TASK_PID  just provide get_current_pid() to the userland side of things instead of get_current() + manual poking in its results  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | Makefile | g | 1.1K |  | H. Peter Anvin | hpa@linux.intel.com | 1323130129 |  | x86, um: Use the same style generated syscall tables as native  Now when the native kernel uses a single style of generated system call table, follow suite for UML and implement the same style, all in C.  This requires __NR_syscall_max and NR_syscalls to be generated; on native this is done in asm-headers.h but that file is common to all UML architectures; therefore put it in user-headers.h instead which already have accommodations for architecture-specific values.  Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | stub_32.S | g | 764B |  | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | ptrace_32.c | s | 6.0K | 242 | Al Viro | viro@ftp.linux.org.uk | 1320239718 |  | um: merge HOST_... of registers common on i386 and amd64  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | tls_32.c | s | 8.9K | 325 | Al Viro | viro@zeniv.linux.org.uk | 1337632114 |  | um/x86: merge (and trim) 32- and 64-bit variants of ptrace.h  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | mem_32.c | s | 1.1K | 42 | Jason Baron | jbaron@redhat.com | 1332547122 |  | coredump: remove VM_ALWAYSDUMP flag  The motivation for this patchset was that I was looking at a way for a qemu-kvm process, to exclude the guest memory from its core dump, which can be quite large.  There are already a number of filter flags in /proc/<pid>/coredump_filter, however, these allow one to specify 'types' of kernel memory, not specific address ranges (which is needed in this case).  Since there are no more vma flags available, the first patch eliminates the need for the 'VM_ALWAYSDUMP' flag.  The flag is used internally by the kernel to mark vdso and vsyscall pages.  However, it is simple enough to check if a vma covers a vdso or vsyscall page without the need for this flag.  The second patch then replaces the 'VM_ALWAYSDUMP' flag with a new 'VM_NODUMP' flag, which can be set by userspace using new madvise flags: 'MADV_DONTDUMP', and unset via 'MADV_DODUMP'.  The core dump filters continue to work the same as before unless 'MADV_DONTDUMP' is set on the region.  The qemu code which implements this features is at:    http://people.redhat.com/~jbaron/qemu-dump/qemu-dump.patch  In my testing the qemu core dump shrunk from 383MB -> 13MB with this patch.  I also believe that the 'MADV_DONTDUMP' flag might be useful for security sensitive apps, which might want to select which areas are dumped.  This patch:  The VM_ALWAYSDUMP flag is currently used by the coredump code to indicate that a vma is part of a vsyscall or vdso section.  However, we can determine if a vma is in one these sections by checking it against the gate_vma and checking for a non-NULL return value from arch_vma_name().  Thus, freeing a valuable vma bit.  Signed-off-by: Jason Baron <jbaron@redhat.com> Acked-by: Roland McGrath <roland@hack.frob.com> Cc: Chris Metcalf <cmetcalf@tilera.com> Cc: Avi Kivity <avi@redhat.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | setjmp_64.S | g | 932B |  | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | syscalls_32.c | s | 1.8K | 57 | Al Viro | viro@zeniv.linux.org.uk | 1337632142 |  | um: missing checks of __put_user()/__get_user() return values  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | sysrq_32.c | s | 2.6K | 86 | Al Viro | viro@zeniv.linux.org.uk | 1337632114 |  | um/x86: merge (and trim) 32- and 64-bit variants of ptrace.h  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | delay.c | s | 1.1K | 50 | Richard Weinberger | richard@nod.at | 1320239737 |  | um: merge delay_{32,64}.c  Signed-off-by: Richard Weinberger <richard@nod.at>
f | tls_64.c | s | 361B | 14 | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
d | vdso |  | 8 items |  | Jason Baron | jbaron@redhat.com | 1332547122 |  | coredump: remove VM_ALWAYSDUMP flag  The motivation for this patchset was that I was looking at a way for a qemu-kvm process, to exclude the guest memory from its core dump, which can be quite large.  There are already a number of filter flags in /proc/<pid>/coredump_filter, however, these allow one to specify 'types' of kernel memory, not specific address ranges (which is needed in this case).  Since there are no more vma flags available, the first patch eliminates the need for the 'VM_ALWAYSDUMP' flag.  The flag is used internally by the kernel to mark vdso and vsyscall pages.  However, it is simple enough to check if a vma covers a vdso or vsyscall page without the need for this flag.  The second patch then replaces the 'VM_ALWAYSDUMP' flag with a new 'VM_NODUMP' flag, which can be set by userspace using new madvise flags: 'MADV_DONTDUMP', and unset via 'MADV_DODUMP'.  The core dump filters continue to work the same as before unless 'MADV_DONTDUMP' is set on the region.  The qemu code which implements this features is at:    http://people.redhat.com/~jbaron/qemu-dump/qemu-dump.patch  In my testing the qemu core dump shrunk from 383MB -> 13MB with this patch.  I also believe that the 'MADV_DONTDUMP' flag might be useful for security sensitive apps, which might want to select which areas are dumped.  This patch:  The VM_ALWAYSDUMP flag is currently used by the coredump code to indicate that a vma is part of a vsyscall or vdso section.  However, we can determine if a vma is in one these sections by checking it against the gate_vma and checking for a non-NULL return value from arch_vma_name().  Thus, freeing a valuable vma bit.  Signed-off-by: Jason Baron <jbaron@redhat.com> Acked-by: Roland McGrath <roland@hack.frob.com> Cc: Chris Metcalf <cmetcalf@tilera.com> Cc: Avi Kivity <avi@redhat.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
d | os-Linux |  | 6 items |  | Richard Weinberger | richard@nod.at | 1320239738 |  | um: we need sys/user.h only on i386  Signed-off-by: Richard Weinberger <richard@nod.at>
f | ksyms.c | s | 319B | 12 | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | mem_64.c | s | 420B | 21 | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | sys_call_table_64.c | s | 1.6K | 45 | Al Viro | viro@zeniv.linux.org.uk | 1337632141 |  | um: stub_rt_sigsuspend isn't needed these days anymore  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
d | shared |  | 1 items |  | Al Viro | viro@zeniv.linux.org.uk | 1337632114 |  | um/x86: merge (and trim) 32- and 64-bit variants of ptrace.h  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | setjmp_32.S | g | 963B |  | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | syscalls_64.c | s | 2.6K | 91 | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | user-offsets.c | s | 2.4K | 88 | H. Peter Anvin | hpa@zytor.com | 1329770929 |  | x32: Add x32 system calls to syscall/syscall_64.tbl  Split the 64-bit system calls into "64" (64-bit only) and "common" (64-bit or x32) and add the x32 system call numbers.  Signed-off-by: H. Peter Anvin <hpa@zytor.com>
f | ldt.c | s | 11K | 438 | Al Viro | viro@ftp.linux.org.uk | 1320239721 |  | um: take ldt.h to arch/x86/um/asm/mm_context.h  it's x86-only and we have no business playing with it in asm/mmu.h; make the latter have 	struct uml_arch_mm_context arch; instead of 	struct uml_ldt ldt; and let arch/<subarch>/um/asm/mm_context.h decide what'll be in there. While we are at it, kill host_ldt.h - it's not needed in part of places that include it (we want asm/ldt.h in those) and it can be trivially expanded into the single remaining one.  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | ptrace_64.c | s | 5.6K | 244 | Al Viro | viro@ftp.linux.org.uk | 1320239727 |  | um: unify ptrace_user.h  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | bug.c | s | 403B | 16 | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | Kconfig | g | 1.2K |  | Al Viro | viro@zeniv.linux.org.uk | 1332631796 |  | um: allow SUBARCH=x86  nicked from patch by dwmw2 back in July  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | sysrq_64.c | s | 1.3K | 38 | Al Viro | viro@zeniv.linux.org.uk | 1337632114 |  | um/x86: merge (and trim) 32- and 64-bit variants of ptrace.h  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | bugs_64.c | s | 195B | 12 | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | ptrace_user.c | s | 419B | 18 | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | sys_call_table_32.c | s | 1.4K | 42 | Martin Pelikan | pelikan@storkhole.cz | 1339271469 |  | x86, um: Correct syscall table type attributes breaking gcc 4.8  The latest GCC 4.8 does some more checking on type attributes that break the build for ARCH=um -> fill them in.  Specifically, the "asmlinkage" attributes is now tested for consistency.  Signed-off-by: Martin Pelikan <pelikan@storkhole.cz> Link: http://lkml.kernel.org/r/1339269731-10772-1-git-send-email-pelikan@storkhole.cz Acked-by: Richard Weinberger <richard@nod.at> Signed-off-by: H. Peter Anvin <hpa@zytor.com>
f | checksum_32.S | g | 9.4K |  | H. Peter Anvin | hpa@zytor.com | 1334955099 |  | x86, extable: Remove open-coded exception table entries in arch/x86/um/checksum_32.S  Remove open-coded exception table entries in arch/x86/um/checksum_32.S, and replace them with _ASM_EXTABLE() macros; this will allow us to change the format and type of the exception table entries.  Signed-off-by: H. Peter Anvin <hpa@zytor.com> Cc: David Daney <david.daney@cavium.com> Cc: Richard Weinberger <richard@nod.at> Cc: Al Viro <viro@zeniv.linux.org.uk> Link: http://lkml.kernel.org/r/CA%2B55aFyijf43qSu3N9nWHEBwaGbb7T2Oq9A=9EyR=Jtyqfq_cQ@mail.gmail.com
f | stub_64.S | g | 1.1K |  | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | stub_segv.c | s | 434B | 15 | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | signal.c | s | 15K | 531 | Al Viro | viro@zeniv.linux.org.uk | 1338569931 |  | most of set_current_blocked() callers want SIGKILL/SIGSTOP removed from set  Only 3 out of 63 do not.  Renamed the current variant to __set_current_blocked(), added set_current_blocked() that will exclude unblockable signals, switched open-coded instances to it.  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | elfcore.c | s | 1.9K | 72 | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
f | fault.c | s | 664B | 23 | Al Viro | viro@ftp.linux.org.uk | 1320239705 |  | um: take arch/um/sys-x86 to arch/x86/um  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk> Signed-off-by: Richard Weinberger <richard@nod.at>
