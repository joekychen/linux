f | trampoline_32.S | g | 1.8K |  | H. Peter Anvin | hpa@linux.intel.com | 1337201050 |  | x86, realmode: Move not-common bits out of trampoline_common.S  Move the bits that aren't actually common out of trampoline_common.S and into the arch-specific files.  Furthermore, make sure the page directory is first in the .bss section for trampoline_64.S in order to not waste an entire page of memory.  Signed-off-by: H. Peter Anvin <hpa@linux.intel.com> Cc: Jarkko Sakkinen <jarkko.sakkinen@intel.com>
f | Makefile | g | 2.6K |  | H. Peter Anvin | hpa@linux.intel.com | 1336600381 |  | x86, realmode: Make sure all generated files are listed in targets  Kbuild expects all generated files to be listed in the targets variable.  If it isn't, weird things happen.  Cc: Sam Ravnborg <sam@ravnborg.org> Cc: Michal Marek <mmarek@suse.cz> Signed-off-by: H. Peter Anvin <hpa@linux.intel.com> Link: http://lkml.kernel.org/r/1336595106-21135-1-git-send-email-jarkko.sakkinen@intel.com
f | wakemain.c | s | 1.5K | 70 | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502925 |  | x86, realmode: flattened rm hierachy  Simplified hierarchy under rm directory to a flat directory because it is not anymore really justified to have own directory for wakeup code. It only adds more complexity.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-20-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | video-vga.c | s | 34B | 1 | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502925 |  | x86, realmode: flattened rm hierachy  Simplified hierarchy under rm directory to a flat directory because it is not anymore really justified to have own directory for wakeup code. It only adds more complexity.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-20-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | trampoline_64.S | g | 3.6K |  | H. Peter Anvin | hpa@linux.intel.com | 1337202125 |  | x86, realmode: Change EFER to a single u64 field  Change EFER to be a single u64 field instead of two u32 fields; change the order to maintain alignment.  Note that on x86-64 cr4 is really also a 64-bit quantity, although we can only set the low 32 bits from the trampoline code since it is still executing in 32-bit mode at that point.  Signed-off-by: H. Peter Anvin <hpa@linux.intel.com> Cc: Jarkko Sakkinen <jarkko.sakkinen@intel.com>
f | header.S | g | 878B |  | H. Peter Anvin | hpa@linux.intel.com | 1337583765 |  | x86, realmode: Move end signature into header.S  The end signature was defined in wakeup_asm.S as it originally came from the ACPI wakeup code.  However, we rely on the existence of the .signature section to expand .bss, otherwise we would have to include code to explicitly zero the .bss depending on the configuration. Since the expanded .bss is just in .init.data anyway, it's easier to always have it expanded.  This fixes failures when compiled without CONFIG_ACPI_SLEEP.  Reported-by: Ingo Molnar <mingo@kernel.org> Signed-off-by: H. Peter Anvin <hpa@zytor.com> Cc: Jarkko Sakkinen <jarkko.sakkinen@intel.com>
f | regs.c | s | 29B | 1 | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502925 |  | x86, realmode: flattened rm hierachy  Simplified hierarchy under rm directory to a flat directory because it is not anymore really justified to have own directory for wakeup code. It only adds more complexity.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-20-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | video-mode.c | s | 35B | 1 | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502925 |  | x86, realmode: flattened rm hierachy  Simplified hierarchy under rm directory to a flat directory because it is not anymore really justified to have own directory for wakeup code. It only adds more complexity.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-20-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | realmode.lds.S | g | 886B |  | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502925 |  | x86, realmode: don't copy real_mode_header  Replaced copying of real_mode_header with a pointer to beginning of RM memory.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-19-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | stack.S | g | 240B |  | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502891 |  | x86, realmode: fix 64-bit wakeup sequence  There were number of issues in wakeup sequence:  - Wakeup stack was placed in hardcoded address. - NX bit in EFER was not enabled. - Initialization incorrectly set physical address of secondary_startup_64. - Some alignment issues.  This patch fixes these issues and in addition:  - Unifies coding conventions in .S files. - Sets alignments of code and data right.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-18-git-send-email-jarkko.sakkinen@intel.com Originally-by: H. Peter Anvin <hpa@linux.intel.com> Cc: Rafael J. Wysocki <rjw@sisk.pl> Cc: Len Brown <len.brown@intel.com> Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | copy.S | g | 29B |  | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502925 |  | x86, realmode: flattened rm hierachy  Simplified hierarchy under rm directory to a flat directory because it is not anymore really justified to have own directory for wakeup code. It only adds more complexity.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-20-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | video-bios.c | s | 35B | 1 | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502925 |  | x86, realmode: flattened rm hierachy  Simplified hierarchy under rm directory to a flat directory because it is not anymore really justified to have own directory for wakeup code. It only adds more complexity.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-20-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | wakeup.h | s | 1.1K | 33 | H. Peter Anvin | hpa@linux.intel.com | 1337583765 |  | x86, realmode: Move end signature into header.S  The end signature was defined in wakeup_asm.S as it originally came from the ACPI wakeup code.  However, we rely on the existence of the .signature section to expand .bss, otherwise we would have to include code to explicitly zero the .bss depending on the configuration. Since the expanded .bss is just in .init.data anyway, it's easier to always have it expanded.  This fixes failures when compiled without CONFIG_ACPI_SLEEP.  Reported-by: Ingo Molnar <mingo@kernel.org> Signed-off-by: H. Peter Anvin <hpa@zytor.com> Cc: Jarkko Sakkinen <jarkko.sakkinen@intel.com>
f | reboot_32.S | g | 3.5K |  | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336703482 |  | x86, realmode: Fix no cache bits test in reboot_32.S  Before the new real-mode code infrastructure %edx was used for testing CD and NW bits with andl in order to decide whether to flush the processor caches or not. The value of cr0 was also stored in %eax, which was later used to set cr0 after masking out lower byte (except TS bit) in order to enter real-mode.  In the new real-mode code infrastructure we wanted to keep input parameter in %eax so we are using %edx for both cr0 cases. This has caused regression since andl overwrites the value of %edx.  This patch fixes the issue by replacing andl with testl, which is essentially andl without writing result to the register.  Special thanks to Paolo Bonzini for noting this and proposing a fix.  Reported-and-tested-by: Paolo Bonzini <pbonzini@redhat.com> Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336633898-23743-1-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | realmode.h | s | 485B | 16 | H. Peter Anvin | hpa@linux.intel.com | 1337583765 |  | x86, realmode: Move end signature into header.S  The end signature was defined in wakeup_asm.S as it originally came from the ACPI wakeup code.  However, we rely on the existence of the .signature section to expand .bss, otherwise we would have to include code to explicitly zero the .bss depending on the configuration. Since the expanded .bss is just in .init.data anyway, it's easier to always have it expanded.  This fixes failures when compiled without CONFIG_ACPI_SLEEP.  Reported-by: Ingo Molnar <mingo@kernel.org> Signed-off-by: H. Peter Anvin <hpa@zytor.com> Cc: Jarkko Sakkinen <jarkko.sakkinen@intel.com>
f | bioscall.S | g | 33B |  | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502925 |  | x86, realmode: flattened rm hierachy  Simplified hierarchy under rm directory to a flat directory because it is not anymore really justified to have own directory for wakeup code. It only adds more complexity.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-20-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
f | trampoline_common.S | g | 111B |  | H. Peter Anvin | hpa@linux.intel.com | 1337201050 |  | x86, realmode: Move not-common bits out of trampoline_common.S  Move the bits that aren't actually common out of trampoline_common.S and into the arch-specific files.  Furthermore, make sure the page directory is first in the .bss section for trampoline_64.S in order to not waste an entire page of memory.  Signed-off-by: H. Peter Anvin <hpa@linux.intel.com> Cc: Jarkko Sakkinen <jarkko.sakkinen@intel.com>
f | wakeup_asm.S | g | 3.6K |  | H. Peter Anvin | hpa@linux.intel.com | 1337583765 |  | x86, realmode: Move end signature into header.S  The end signature was defined in wakeup_asm.S as it originally came from the ACPI wakeup code.  However, we rely on the existence of the .signature section to expand .bss, otherwise we would have to include code to explicitly zero the .bss depending on the configuration. Since the expanded .bss is just in .init.data anyway, it's easier to always have it expanded.  This fixes failures when compiled without CONFIG_ACPI_SLEEP.  Reported-by: Ingo Molnar <mingo@kernel.org> Signed-off-by: H. Peter Anvin <hpa@zytor.com> Cc: Jarkko Sakkinen <jarkko.sakkinen@intel.com>
f | video-vesa.c | s | 35B | 1 | Jarkko Sakkinen | jarkko.sakkinen@intel.com | 1336502925 |  | x86, realmode: flattened rm hierachy  Simplified hierarchy under rm directory to a flat directory because it is not anymore really justified to have own directory for wakeup code. It only adds more complexity.  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@intel.com> Link: http://lkml.kernel.org/r/1336501366-28617-20-git-send-email-jarkko.sakkinen@intel.com Signed-off-by: H. Peter Anvin <hpa@linux.intel.com>
