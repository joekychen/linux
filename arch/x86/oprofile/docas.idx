f | init.c | s | 836B | 32 | Robert Richter | robert.richter@amd.com | 1320420438 |  | oprofile, x86: Reimplement nmi timer mode using perf event  The legacy x86 nmi watchdog code was removed with the implementation of the perf based nmi watchdog. This broke Oprofile's nmi timer mode. To run nmi timer mode we relied on a continuous ticking nmi source which the nmi watchdog provided. The nmi tick was no longer available and current watchdog can not be used anymore since it runs with very long periods in the range of seconds. This patch reimplements the nmi timer mode using a perf counter nmi source.  V2: * removing pr_info() * fix undefined reference to `__udivdi3' for 32 bit build * fix section mismatch of .cpuinit.data:nmi_timer_cpu_nb * removed nmi timer setup in arch/x86 * implemented function stubs for op_nmi_init/exit() * made code more readable in oprofile_init()  V3: * fix architectural initialization in oprofile_init() * fix CONFIG_OPROFILE_NMI_TIMER dependencies  Acked-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Signed-off-by: Robert Richter <robert.richter@amd.com>
f | nmi_int.c | s | 16K | 662 | Ingo Molnar | mingo@elte.hu | 1321351518 |  | Merge branch 'core' of git://amd64.org/linux/rric into perf/core
f | op_model_p4.c | s | 17K | 602 | Jesper Juhl | jj@chaosbits.net | 1295448188 |  | Kill off warning: ‘inline’ is not at beginning of declaration  Fix a bunch of 	warning: ‘inline’ is not at beginning of declaration messages when building a 'make allyesconfig' kernel with -Wextra.  These warnings are trivial to kill, yet rather annoying when building with -Wextra. The more we can cut down on pointless crap like this the better (IMHO).  A previous patch to do this for a 'allnoconfig' build has already been merged. This just takes the cleanup a little further.  Signed-off-by: Jesper Juhl <jj@chaosbits.net> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | Makefile | g | 391B |  | Robert Richter | robert.richter@amd.com | 1320420438 |  | oprofile, x86: Reimplement nmi timer mode using perf event  The legacy x86 nmi watchdog code was removed with the implementation of the perf based nmi watchdog. This broke Oprofile's nmi timer mode. To run nmi timer mode we relied on a continuous ticking nmi source which the nmi watchdog provided. The nmi tick was no longer available and current watchdog can not be used anymore since it runs with very long periods in the range of seconds. This patch reimplements the nmi timer mode using a perf counter nmi source.  V2: * removing pr_info() * fix undefined reference to `__udivdi3' for 32 bit build * fix section mismatch of .cpuinit.data:nmi_timer_cpu_nb * removed nmi timer setup in arch/x86 * implemented function stubs for op_nmi_init/exit() * made code more readable in oprofile_init()  V3: * fix architectural initialization in oprofile_init() * fix CONFIG_OPROFILE_NMI_TIMER dependencies  Acked-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Signed-off-by: Robert Richter <robert.richter@amd.com>
f | backtrace.c | s | 2.8K | 101 | H. Peter Anvin | hpa@zytor.com | 1329770926 |  | x86: Factor out TIF_IA32 from 32-bit address space  Factor out IA32 (compatibility instruction set) from 32-bit address space in the thread_info flags; this is a precondition patch for x32 support.  Originally-by: H. J. Lu <hjl.tools@gmail.com> Signed-off-by: H. Peter Anvin <hpa@zytor.com> Link: http://lkml.kernel.org/n/tip-4pr1xnnksprt7t0h3w5fw4rv@git.kernel.org
f | op_model_amd.c | s | 12K | 462 | Robert Richter | robert.richter@amd.com | 1318222636 |  | perf, x86: Implement IBS initialization  This patch implements IBS feature detection and initialzation. The code is shared between perf and oprofile. If IBS is available on the system for perf, a pmu is setup.  Signed-off-by: Robert Richter <robert.richter@amd.com> Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Link: http://lkml.kernel.org/r/1316597423-25723-3-git-send-email-robert.richter@amd.com Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | op_x86_model.h | s | 2.5K | 77 | Robert Richter | robert.richter@amd.com | 1318222636 |  | perf, x86: Implement IBS initialization  This patch implements IBS feature detection and initialzation. The code is shared between perf and oprofile. If IBS is available on the system for perf, a pmu is setup.  Signed-off-by: Robert Richter <robert.richter@amd.com> Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Link: http://lkml.kernel.org/r/1316597423-25723-3-git-send-email-robert.richter@amd.com Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | op_counter.h | s | 532B | 25 | Andi Kleen | ak@linux.intel.com | 1300988744 |  | oprofile, x86: Allow setting EDGE/INV/CMASK for counter events  For some performance events it's useful to set the EDGE and INV bits and the CMASK mask in the counter control register. The list of predefined events Intel releases for each CPU has some events which require these settings to get more "natural" to use higher level events.  oprofile currently doesn't allow this.  This patch adds new extra configuration fields for them, so that they can be specified in oprofilefs.  An updated oprofile daemon can then make use of this to set them.  v2: Write back masked extra value to variable.  Signed-off-by: Andi Kleen <ak@linux.intel.com> Signed-off-by: Robert Richter <robert.richter@amd.com>
f | op_model_ppro.c | s | 5.9K | 208 | Robert Richter | robert.richter@amd.com | 1313531460 |  | oprofile, x86: Fix overflow and warning (commit 1d12d35)  Following fixes for:   1d12d35 oprofile, x86: Convert memory allocation to static array  Fix potential buffer overflow.  Fix the following warning:   arch/x86/oprofile/op_model_ppro.c: In function ‘ppro_check_ctrs’:  arch/x86/oprofile/op_model_ppro.c:143: warning: label ‘out’ defined but not used  Cc: Maarten Lankhorst <m.b.lankhorst@gmail.com> Cc: Andi Kleen <andi@firstfloor.org> Signed-off-by: Robert Richter <robert.richter@amd.com>
