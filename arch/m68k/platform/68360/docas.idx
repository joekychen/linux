f | config.c | s | 4.5K | 144 | Greg Ungerer | gerg@uclinux.org | 1339466308 |  | m68knommu: fix 68360 local setting of timer interrupt handler  Compiling for 68360 based targets fails with:      arch/m68k/platform/68360/config.c: In function ‘hw_tick’:     arch/m68k/platform/68360/config.c:55:2: error: implicit declaration of function ‘arch_timer_interrupt’     arch/m68k/platform/68360/config.c: At top level:     arch/m68k/platform/68360/config.c:64:6: error: conflicting types for ‘hw_timer_init’     arch/m68k/include/asm/machdep.h:36:13: note: previous declaration of ‘hw_timer_init’ was here  Changes made to hw_timer_init() didn't get updated in the 68328 timer code. So process and call the "handler" arg that is now passed into that hw_timer_init() function.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | Makefile | g | 247B |  | Greg Ungerer | gerg@uclinux.org | 1318911745 |  | m68k: merge mmu and non-mmu arch Makefiles  Most of the build logic is the same for the mmu and non-mmu m68k targets. Merge the top level architecture Makefiles back into a single Makefile.  For the most part this is just adding the non-mmu processor types and their specific cflags and other options into the mmu Makefile.  Note that all the BOARD setting logic that was in the non-mmu Makefile is completely removed. It was no longer being used at all.  This has been build and run tested on ColdFire targets and ARAnyM. It has been build tested on all the m68k defconfig targets using a gcc-4.5.1 based toolchain.  Signed-off-by: Greg Ungerer <gerg@uclinux.org> Acked-by: Sam Ravnborg <sam@ravnborg.org>
f | commproc.c | s | 7.9K | 240 | Greg Ungerer | gerg@uclinux.org | 1301025913 |  | m68k: merge m68k and m68knommu arch directories  There is a lot of common code that could be shared between the m68k and m68knommu arch branches. It makes sense to merge the two branches into a single directory structure so that we can more easily share that common code.  This is a brute force merge, based on a script from Stephen King <sfking@fdwdc.com>, which was originally written by Arnd Bergmann <arnd@arndb.de>.  > The script was inspired by the script Sam Ravnborg used to merge the > includes from m68knommu. For those files common to both arches but > differing in content, the m68k version of the file is renamed to > <file>_mm.<ext> and the m68knommu version of the file is moved into the > corresponding m68k directory and renamed <file>_no.<ext> and a small > wrapper file <file>.<ext> is used to select between the two version. Files > that are common to both but don't differ are removed from the m68knommu > tree and files and directories that are unique to the m68knommu tree are > moved to the m68k tree. Finally, the arch/m68knommu tree is removed. > > To select between the the versions of the files, the wrapper uses > > #ifdef CONFIG_MMU > #include <file>_mm.<ext> > #else > #include <file>_no.<ext> > #endif  On top of this file merge I have done a simplistic merge of m68k and m68knommu Kconfig, which primarily attempts to keep existing options and menus in place. Other than a handful of options being moved it produces identical .config outputs on m68k and m68knommu targets I tested it on.  With this in place there is now quite a bit of scope for merge cleanups in future patches.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | head-ram.S | g | 15K |  | Greg Ungerer | gerg@uclinux.org | 1301025913 |  | m68k: merge m68k and m68knommu arch directories  There is a lot of common code that could be shared between the m68k and m68knommu arch branches. It makes sense to merge the two branches into a single directory structure so that we can more easily share that common code.  This is a brute force merge, based on a script from Stephen King <sfking@fdwdc.com>, which was originally written by Arnd Bergmann <arnd@arndb.de>.  > The script was inspired by the script Sam Ravnborg used to merge the > includes from m68knommu. For those files common to both arches but > differing in content, the m68k version of the file is renamed to > <file>_mm.<ext> and the m68knommu version of the file is moved into the > corresponding m68k directory and renamed <file>_no.<ext> and a small > wrapper file <file>.<ext> is used to select between the two version. Files > that are common to both but don't differ are removed from the m68knommu > tree and files and directories that are unique to the m68knommu tree are > moved to the m68k tree. Finally, the arch/m68knommu tree is removed. > > To select between the the versions of the files, the wrapper uses > > #ifdef CONFIG_MMU > #include <file>_mm.<ext> > #else > #include <file>_no.<ext> > #endif  On top of this file merge I have done a simplistic merge of m68k and m68knommu Kconfig, which primarily attempts to keep existing options and menus in place. Other than a handful of options being moved it produces identical .config outputs on m68k and m68knommu targets I tested it on.  With this in place there is now quite a bit of scope for merge cleanups in future patches.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | entry.S | g | 4.0K |  | Al Viro | viro@zeniv.linux.org.uk | 1337659187 |  | m68k: add TIF_NOTIFY_RESUME and handle it.  TIF_NOTIFY_RESUME added (as bit 5).  That way nommu glue needs no changes at all; mmu one needs just to replace jmi do_signal_return to jne do_signal_return There we have flags shifted up, until bit 6 (SIGPENDING) is in MSBit; instead of checking that MSBit is set (jmi) we check that MSBit or something below it is set (jne); bits 0..4 are never set, so that's precisely "bit 6 or bit 5 is set".  Usual handling of NOTIFY_RESUME/SIGPENDING is done in do_notify_resume(); glue calls it instead of do_signal().  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | ints.c | s | 4.2K | 119 | Greg Ungerer | gerg@uclinux.org | 1330904583 |  | m68knommu: remove reduntant definitions of _ramvec  The base of the real RAM resident hardware vectors, _ramvec, is declared in our asm/traps.h. No need to have local declarations spread around in other files that use this. So remove them.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | head-rom.S | g | 16K |  | Greg Ungerer | gerg@uclinux.org | 1301025913 |  | m68k: merge m68k and m68knommu arch directories  There is a lot of common code that could be shared between the m68k and m68knommu arch branches. It makes sense to merge the two branches into a single directory structure so that we can more easily share that common code.  This is a brute force merge, based on a script from Stephen King <sfking@fdwdc.com>, which was originally written by Arnd Bergmann <arnd@arndb.de>.  > The script was inspired by the script Sam Ravnborg used to merge the > includes from m68knommu. For those files common to both arches but > differing in content, the m68k version of the file is renamed to > <file>_mm.<ext> and the m68knommu version of the file is moved into the > corresponding m68k directory and renamed <file>_no.<ext> and a small > wrapper file <file>.<ext> is used to select between the two version. Files > that are common to both but don't differ are removed from the m68knommu > tree and files and directories that are unique to the m68knommu tree are > moved to the m68k tree. Finally, the arch/m68knommu tree is removed. > > To select between the the versions of the files, the wrapper uses > > #ifdef CONFIG_MMU > #include <file>_mm.<ext> > #else > #include <file>_no.<ext> > #endif  On top of this file merge I have done a simplistic merge of m68k and m68knommu Kconfig, which primarily attempts to keep existing options and menus in place. Other than a handful of options being moved it produces identical .config outputs on m68k and m68knommu targets I tested it on.  With this in place there is now quite a bit of scope for merge cleanups in future patches.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
