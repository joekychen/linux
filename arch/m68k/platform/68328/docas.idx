f | timers.c | s | 3.4K | 109 | Greg Ungerer | gerg@uclinux.org | 1339466307 |  | m68knommu: fix 68328 local setting of timer interrupt handler  Compiling for 68328 based targets fails with:      arch/m68k/platform/68328/timers.c: In function ‘hw_tick’:     arch/m68k/platform/68328/timers.c:65:2: error: implicit declaration of function ‘arch_timer_interrupt’     arch/m68k/platform/68328/timers.c: At top level:     arch/m68k/platform/68328/timers.c:102:6: error: conflicting types for ‘hw_timer_init’     arch/m68k/include/asm/machdep.h:36:13: note: previous declaration of ‘hw_timer_init’ was here  Changes made to hw_timer_init() didn't get updated in the 68328 timer code. So process and call the "handler" arg that is now passed into that hw_timer_init() function.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | config.c | s | 1.6K | 44 | David Howells | dhowells@redhat.com | 1332955802 |  | Disintegrate asm/system.h for M68K  Disintegrate asm/system.h for M68K.  Signed-off-by: David Howells <dhowells@redhat.com> Acked-by: Greg Ungerer <gerg@uclinux.org> cc: linux-m68k@lists.linux-m68k.org
f | head-pilot.S | g | 3.5K |  | Greg Ungerer | gerg@uclinux.org | 1325204415 |  | m68knommu: remove no longer used rom_length from Palm/Pilot start up code  Compiling for the m68knommu/68328 Palm/Pilot target you get:    LD      vmlinux arch/m68k/platform/68328/head.o: In function `L3': (.text+0x170): undefined reference to `rom_length'  "rom_length" is not used any longer by any of the m68knommu code. So remove it from here too.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | Makefile | g | 430B |  | Greg Ungerer | gerg@uclinux.org | 1325204254 |  | m68knommu: fix broken boot logo inclusion  Compiling for the m68knommu/68328 Palm/Pilot target you get:    AS      arch/m68k/platform/68328/head-pilot.o arch/m68k/platform/68328/head-pilot.S:37:23: fatal error: bootlogo.rh: No such file or directory  The build for this target used to do a conversion on a C coded boot logo and include this in the head assembler code. This got broken by changes to the local Makefile.  Clean all this up by just including the C coded boot logo struct in the C code. With the appropriate alignment attribute there is no difference to the way it can be used.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | bootlogo.h | s | 19K | 270 | Greg Ungerer | gerg@uclinux.org | 1325204254 |  | m68knommu: fix broken boot logo inclusion  Compiling for the m68knommu/68328 Palm/Pilot target you get:    AS      arch/m68k/platform/68328/head-pilot.o arch/m68k/platform/68328/head-pilot.S:37:23: fatal error: bootlogo.rh: No such file or directory  The build for this target used to do a conversion on a C coded boot logo and include this in the head assembler code. This got broken by changes to the local Makefile.  Clean all this up by just including the C coded boot logo struct in the C code. With the appropriate alignment attribute there is no difference to the way it can be used.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | head-rom.S | g | 1.8K |  | Greg Ungerer | gerg@uclinux.org | 1325204254 |  | m68knommu: fix broken boot logo inclusion  Compiling for the m68knommu/68328 Palm/Pilot target you get:    AS      arch/m68k/platform/68328/head-pilot.o arch/m68k/platform/68328/head-pilot.S:37:23: fatal error: bootlogo.rh: No such file or directory  The build for this target used to do a conversion on a C coded boot logo and include this in the head assembler code. This got broken by changes to the local Makefile.  Clean all this up by just including the C coded boot logo struct in the C code. With the appropriate alignment attribute there is no difference to the way it can be used.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | head-ram.S | g | 2.5K |  | Greg Ungerer | gerg@uclinux.org | 1301025913 |  | m68k: merge m68k and m68knommu arch directories  There is a lot of common code that could be shared between the m68k and m68knommu arch branches. It makes sense to merge the two branches into a single directory structure so that we can more easily share that common code.  This is a brute force merge, based on a script from Stephen King <sfking@fdwdc.com>, which was originally written by Arnd Bergmann <arnd@arndb.de>.  > The script was inspired by the script Sam Ravnborg used to merge the > includes from m68knommu. For those files common to both arches but > differing in content, the m68k version of the file is renamed to > <file>_mm.<ext> and the m68knommu version of the file is moved into the > corresponding m68k directory and renamed <file>_no.<ext> and a small > wrapper file <file>.<ext> is used to select between the two version. Files > that are common to both but don't differ are removed from the m68knommu > tree and files and directories that are unique to the m68knommu tree are > moved to the m68k tree. Finally, the arch/m68knommu tree is removed. > > To select between the the versions of the files, the wrapper uses > > #ifdef CONFIG_MMU > #include <file>_mm.<ext> > #else > #include <file>_no.<ext> > #endif  On top of this file merge I have done a simplistic merge of m68k and m68knommu Kconfig, which primarily attempts to keep existing options and menus in place. Other than a handful of options being moved it produces identical .config outputs on m68k and m68knommu targets I tested it on.  With this in place there is now quite a bit of scope for merge cleanups in future patches.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | romvec.S | g | 910B |  | Greg Ungerer | gerg@uclinux.org | 1301025913 |  | m68k: merge m68k and m68knommu arch directories  There is a lot of common code that could be shared between the m68k and m68knommu arch branches. It makes sense to merge the two branches into a single directory structure so that we can more easily share that common code.  This is a brute force merge, based on a script from Stephen King <sfking@fdwdc.com>, which was originally written by Arnd Bergmann <arnd@arndb.de>.  > The script was inspired by the script Sam Ravnborg used to merge the > includes from m68knommu. For those files common to both arches but > differing in content, the m68k version of the file is renamed to > <file>_mm.<ext> and the m68knommu version of the file is moved into the > corresponding m68k directory and renamed <file>_no.<ext> and a small > wrapper file <file>.<ext> is used to select between the two version. Files > that are common to both but don't differ are removed from the m68knommu > tree and files and directories that are unique to the m68knommu tree are > moved to the m68k tree. Finally, the arch/m68knommu tree is removed. > > To select between the the versions of the files, the wrapper uses > > #ifdef CONFIG_MMU > #include <file>_mm.<ext> > #else > #include <file>_no.<ext> > #endif  On top of this file merge I have done a simplistic merge of m68k and m68knommu Kconfig, which primarily attempts to keep existing options and menus in place. Other than a handful of options being moved it produces identical .config outputs on m68k and m68knommu targets I tested it on.  With this in place there is now quite a bit of scope for merge cleanups in future patches.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | entry.S | g | 5.8K |  | Al Viro | viro@zeniv.linux.org.uk | 1337659187 |  | m68k: add TIF_NOTIFY_RESUME and handle it.  TIF_NOTIFY_RESUME added (as bit 5).  That way nommu glue needs no changes at all; mmu one needs just to replace jmi do_signal_return to jne do_signal_return There we have flags shifted up, until bit 6 (SIGPENDING) is in MSBit; instead of checking that MSBit is set (jmi) we check that MSBit or something below it is set (jne); bits 0..4 are never set, so that's precisely "bit 6 or bit 5 is set".  Usual handling of NOTIFY_RESUME/SIGPENDING is done in do_notify_resume(); glue calls it instead of do_signal().  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | ints.c | s | 4.2K | 166 | Greg Ungerer | gerg@uclinux.org | 1330904583 |  | m68knommu: remove reduntant definitions of _ramvec  The base of the real RAM resident hardware vectors, _ramvec, is declared in our asm/traps.h. No need to have local declarations spread around in other files that use this. So remove them.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
f | head-de2.S | g | 1.6K |  | Greg Ungerer | gerg@uclinux.org | 1301025913 |  | m68k: merge m68k and m68knommu arch directories  There is a lot of common code that could be shared between the m68k and m68knommu arch branches. It makes sense to merge the two branches into a single directory structure so that we can more easily share that common code.  This is a brute force merge, based on a script from Stephen King <sfking@fdwdc.com>, which was originally written by Arnd Bergmann <arnd@arndb.de>.  > The script was inspired by the script Sam Ravnborg used to merge the > includes from m68knommu. For those files common to both arches but > differing in content, the m68k version of the file is renamed to > <file>_mm.<ext> and the m68knommu version of the file is moved into the > corresponding m68k directory and renamed <file>_no.<ext> and a small > wrapper file <file>.<ext> is used to select between the two version. Files > that are common to both but don't differ are removed from the m68knommu > tree and files and directories that are unique to the m68knommu tree are > moved to the m68k tree. Finally, the arch/m68knommu tree is removed. > > To select between the the versions of the files, the wrapper uses > > #ifdef CONFIG_MMU > #include <file>_mm.<ext> > #else > #include <file>_no.<ext> > #endif  On top of this file merge I have done a simplistic merge of m68k and m68knommu Kconfig, which primarily attempts to keep existing options and menus in place. Other than a handful of options being moved it produces identical .config outputs on m68k and m68knommu targets I tested it on.  With this in place there is now quite a bit of scope for merge cleanups in future patches.  Signed-off-by: Greg Ungerer <gerg@uclinux.org>
