<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › m68k › atari › config.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>config.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  linux/arch/m68k/atari/config.c</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 1994 Bjoern Brauel</span>
<span class="cm"> *</span>
<span class="cm"> *  5/2/94 Roman Hodek:</span>
<span class="cm"> *    Added setting of time_adj to get a better clock.</span>
<span class="cm"> *</span>
<span class="cm"> *  5/14/94 Roman Hodek:</span>
<span class="cm"> *    gettod() for TT</span>
<span class="cm"> *</span>
<span class="cm"> *  5/15/94 Roman Hodek:</span>
<span class="cm"> *    hard_reset_now() for Atari (and others?)</span>
<span class="cm"> *</span>
<span class="cm"> *  94/12/30 Andreas Schwab:</span>
<span class="cm"> *    atari_sched_init fixed to get precise clock.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file COPYING in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Miscellaneous atari stuff</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;linux/seq_file.h&gt;</span>
<span class="cp">#include &lt;linux/console.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/ioport.h&gt;</span>
<span class="cp">#include &lt;linux/vt_kern.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>

<span class="cp">#include &lt;asm/bootinfo.h&gt;</span>
<span class="cp">#include &lt;asm/setup.h&gt;</span>
<span class="cp">#include &lt;asm/atarihw.h&gt;</span>
<span class="cp">#include &lt;asm/atariints.h&gt;</span>
<span class="cp">#include &lt;asm/atari_stram.h&gt;</span>
<span class="cp">#include &lt;asm/machdep.h&gt;</span>
<span class="cp">#include &lt;asm/hwtest.h&gt;</span>
<span class="cp">#include &lt;asm/io.h&gt;</span>

<span class="n">u_long</span> <span class="n">atari_mch_cookie</span><span class="p">;</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">atari_mch_cookie</span><span class="p">);</span>

<span class="n">u_long</span> <span class="n">atari_mch_type</span><span class="p">;</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">atari_mch_type</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">atari_hw_present</span> <span class="n">atari_hw_present</span><span class="p">;</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">atari_hw_present</span><span class="p">);</span>

<span class="n">u_long</span> <span class="n">atari_switches</span><span class="p">;</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">atari_switches</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">atari_dont_touch_floppy_select</span><span class="p">;</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">atari_dont_touch_floppy_select</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">atari_rtc_year_offset</span><span class="p">;</span>

<span class="cm">/* local function prototypes */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">atari_reset</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">atari_get_model</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">model</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">atari_get_hardware_list</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">);</span>

<span class="cm">/* atari specific irq functions */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">atari_init_IRQ</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">atari_mksound</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">count</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ticks</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_HEARTBEAT</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">atari_heartbeat</span><span class="p">(</span><span class="kt">int</span> <span class="n">on</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cm">/* atari specific timer functions (in time.c) */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">atari_sched_init</span><span class="p">(</span><span class="n">irq_handler_t</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">atari_gettimeoffset</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">atari_mste_hwclk</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rtc_time</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">atari_tt_hwclk</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rtc_time</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">atari_mste_set_clock_mmss</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">atari_tt_set_clock_mmss</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>


<span class="cm">/* ++roman: This is a more elaborate test for an SCC chip, since the plain</span>
<span class="cm"> * Medusa board generates DTACK at the SCC&#39;s standard addresses, but a SCC</span>
<span class="cm"> * board in the Medusa is possible. Also, the addresses where the ST_ESCC</span>
<span class="cm"> * resides generate DTACK without the chip, too.</span>
<span class="cm"> * The method is to write values into the interrupt vector register, that</span>
<span class="cm"> * should be readable without trouble (from channel A!).</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">scc_test</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ctla</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hwreg_present</span><span class="p">(</span><span class="n">ctla</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">MFPDELAY</span><span class="p">();</span>

	<span class="o">*</span><span class="n">ctla</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">MFPDELAY</span><span class="p">();</span>
	<span class="o">*</span><span class="n">ctla</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
	<span class="n">MFPDELAY</span><span class="p">();</span>

	<span class="o">*</span><span class="n">ctla</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">MFPDELAY</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">ctla</span> <span class="o">!=</span> <span class="mh">0x40</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">MFPDELAY</span><span class="p">();</span>

	<span class="o">*</span><span class="n">ctla</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">MFPDELAY</span><span class="p">();</span>
	<span class="o">*</span><span class="n">ctla</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span>
	<span class="n">MFPDELAY</span><span class="p">();</span>

	<span class="o">*</span><span class="n">ctla</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">MFPDELAY</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">ctla</span> <span class="o">!=</span> <span class="mh">0x60</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>


    <span class="cm">/*</span>
<span class="cm">     *  Parse an Atari-specific record in the bootinfo</span>
<span class="cm">     */</span>

<span class="kt">int</span> <span class="n">__init</span> <span class="nf">atari_parse_bootinfo</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">bi_record</span> <span class="o">*</span><span class="n">record</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">unknown</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">const</span> <span class="n">u_long</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">record</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">record</span><span class="o">-&gt;</span><span class="n">tag</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BI_ATARI_MCH_COOKIE</span>:
		<span class="n">atari_mch_cookie</span> <span class="o">=</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BI_ATARI_MCH_TYPE</span>:
		<span class="n">atari_mch_type</span> <span class="o">=</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">unknown</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">unknown</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Parse the Atari-specific switches= option. */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">atari_switches_setup</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">switches</span><span class="p">[</span><span class="n">strlen</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ovsc_shift</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">args</span> <span class="o">=</span> <span class="n">switches</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">MACH_IS_ATARI</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* copy string to local array, strsep works destructively... */</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">switches</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
	<span class="n">atari_switches</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* parse the options */</span>
	<span class="k">while</span> <span class="p">((</span><span class="n">p</span> <span class="o">=</span> <span class="n">strsep</span><span class="p">(</span><span class="o">&amp;</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;,&quot;</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!*</span><span class="n">p</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="n">ovsc_shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&quot;ov_&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">p</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
			<span class="n">ovsc_shift</span> <span class="o">=</span> <span class="n">ATARI_SWITCH_OVSC_SHIFT</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&quot;ikbd&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* RTS line of IKBD ACIA */</span>
			<span class="n">atari_switches</span> <span class="o">|=</span> <span class="n">ATARI_SWITCH_IKBD</span> <span class="o">&lt;&lt;</span> <span class="n">ovsc_shift</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&quot;midi&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* RTS line of MIDI ACIA */</span>
			<span class="n">atari_switches</span> <span class="o">|=</span> <span class="n">ATARI_SWITCH_MIDI</span> <span class="o">&lt;&lt;</span> <span class="n">ovsc_shift</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&quot;snd6&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">atari_switches</span> <span class="o">|=</span> <span class="n">ATARI_SWITCH_SND6</span> <span class="o">&lt;&lt;</span> <span class="n">ovsc_shift</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s">&quot;snd7&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">atari_switches</span> <span class="o">|=</span> <span class="n">ATARI_SWITCH_SND7</span> <span class="o">&lt;&lt;</span> <span class="n">ovsc_shift</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">early_param</span><span class="p">(</span><span class="s">&quot;switches&quot;</span><span class="p">,</span> <span class="n">atari_switches_setup</span><span class="p">);</span>


    <span class="cm">/*</span>
<span class="cm">     *  Setup the Atari configuration info</span>
<span class="cm">     */</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">config_atari</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">tos_version</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">atari_hw_present</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">atari_hw_present</span><span class="p">));</span>

	<span class="cm">/* Change size of I/O space from 64KB to 4GB. */</span>
	<span class="n">ioport_resource</span><span class="p">.</span><span class="n">end</span>  <span class="o">=</span> <span class="mh">0xFFFFFFFF</span><span class="p">;</span>

	<span class="n">mach_sched_init</span>      <span class="o">=</span> <span class="n">atari_sched_init</span><span class="p">;</span>
	<span class="n">mach_init_IRQ</span>        <span class="o">=</span> <span class="n">atari_init_IRQ</span><span class="p">;</span>
	<span class="n">mach_get_model</span>	 <span class="o">=</span> <span class="n">atari_get_model</span><span class="p">;</span>
	<span class="n">mach_get_hardware_list</span> <span class="o">=</span> <span class="n">atari_get_hardware_list</span><span class="p">;</span>
	<span class="n">mach_gettimeoffset</span>   <span class="o">=</span> <span class="n">atari_gettimeoffset</span><span class="p">;</span>
	<span class="n">mach_reset</span>           <span class="o">=</span> <span class="n">atari_reset</span><span class="p">;</span>
	<span class="n">mach_max_dma_address</span> <span class="o">=</span> <span class="mh">0xffffff</span><span class="p">;</span>
<span class="cp">#if defined(CONFIG_INPUT_M68K_BEEP) || defined(CONFIG_INPUT_M68K_BEEP_MODULE)</span>
	<span class="n">mach_beep</span>          <span class="o">=</span> <span class="n">atari_mksound</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef CONFIG_HEARTBEAT</span>
	<span class="n">mach_heartbeat</span> <span class="o">=</span> <span class="n">atari_heartbeat</span><span class="p">;</span>
<span class="cp">#endif</span>

	<span class="cm">/* Set switches as requested by the user */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">atari_switches</span> <span class="o">&amp;</span> <span class="n">ATARI_SWITCH_IKBD</span><span class="p">)</span>
		<span class="n">acia</span><span class="p">.</span><span class="n">key_ctrl</span> <span class="o">=</span> <span class="n">ACIA_DIV64</span> <span class="o">|</span> <span class="n">ACIA_D8N1S</span> <span class="o">|</span> <span class="n">ACIA_RHTID</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">atari_switches</span> <span class="o">&amp;</span> <span class="n">ATARI_SWITCH_MIDI</span><span class="p">)</span>
		<span class="n">acia</span><span class="p">.</span><span class="n">mid_ctrl</span> <span class="o">=</span> <span class="n">ACIA_DIV16</span> <span class="o">|</span> <span class="n">ACIA_D8N1S</span> <span class="o">|</span> <span class="n">ACIA_RHTID</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">atari_switches</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ATARI_SWITCH_SND6</span><span class="o">|</span><span class="n">ATARI_SWITCH_SND7</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">sound_ym</span><span class="p">.</span><span class="n">rd_data_reg_sel</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
		<span class="n">sound_ym</span><span class="p">.</span><span class="n">wd_data</span> <span class="o">=</span> <span class="n">sound_ym</span><span class="p">.</span><span class="n">rd_data_reg_sel</span> <span class="o">|</span>
				   <span class="p">((</span><span class="n">atari_switches</span><span class="o">&amp;</span><span class="n">ATARI_SWITCH_SND6</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0x40</span> <span class="o">:</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
				   <span class="p">((</span><span class="n">atari_switches</span><span class="o">&amp;</span><span class="n">ATARI_SWITCH_SND7</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0x80</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* ++bjoern:</span>
<span class="cm">	 * Determine hardware present</span>
<span class="cm">	 */</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;Atari hardware found: &quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">MACH_IS_MEDUSA</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* There&#39;s no Atari video hardware on the Medusa, but all the</span>
<span class="cm">		 * addresses below generate a DTACK so no bus error occurs! */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="n">f030_xreg</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">VIDEL_SHIFTER</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;VIDEL &quot;</span><span class="p">);</span>
		<span class="cm">/* This is a temporary hack: If there is Falcon video</span>
<span class="cm">		 * hardware, we assume that the ST-DMA serves SCSI instead of</span>
<span class="cm">		 * ACSI. In the future, there should be a better method for</span>
<span class="cm">		 * this...</span>
<span class="cm">		 */</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">ST_SCSI</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;STDMA-SCSI &quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="n">tt_palette</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">TT_SHIFTER</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;TT_SHIFTER &quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">shifter</span><span class="p">.</span><span class="n">bas_hi</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">shifter</span><span class="p">.</span><span class="n">bas_lo</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="p">(</span><span class="n">shifter</span><span class="p">.</span><span class="n">bas_lo</span> <span class="o">=</span> <span class="mh">0x0aau</span><span class="p">,</span> <span class="n">shifter</span><span class="p">.</span><span class="n">bas_lo</span> <span class="o">==</span> <span class="mh">0x0aau</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">EXTD_SHIFTER</span><span class="p">);</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXTD_SHIFTER &quot;</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">STND_SHIFTER</span><span class="p">);</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;STND_SHIFTER &quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st_mfp</span><span class="p">.</span><span class="n">par_dt_reg</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">ST_MFP</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;ST_MFP &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tt_mfp</span><span class="p">.</span><span class="n">par_dt_reg</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">TT_MFP</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;TT_MFP &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tt_scsi_dma</span><span class="p">.</span><span class="n">dma_addr_hi</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">SCSI_DMA</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;TT_SCSI_DMA &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/*</span>
<span class="cm">	 * The ST-DMA address registers aren&#39;t readable</span>
<span class="cm">	 * on all Medusas, so the test below may fail</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">MACH_IS_MEDUSA</span> <span class="o">||</span>
	    <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st_dma</span><span class="p">.</span><span class="n">dma_vhi</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	     <span class="p">(</span><span class="n">st_dma</span><span class="p">.</span><span class="n">dma_vhi</span> <span class="o">=</span> <span class="mh">0x55</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">st_dma</span><span class="p">.</span><span class="n">dma_hi</span> <span class="o">=</span> <span class="mh">0xaa</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	     <span class="n">st_dma</span><span class="p">.</span><span class="n">dma_vhi</span> <span class="o">==</span> <span class="mh">0x55</span> <span class="o">&amp;&amp;</span> <span class="n">st_dma</span><span class="p">.</span><span class="n">dma_hi</span> <span class="o">==</span> <span class="mh">0xaa</span> <span class="o">&amp;&amp;</span>
	     <span class="p">(</span><span class="n">st_dma</span><span class="p">.</span><span class="n">dma_vhi</span> <span class="o">=</span> <span class="mh">0xaa</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">st_dma</span><span class="p">.</span><span class="n">dma_hi</span> <span class="o">=</span> <span class="mh">0x55</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	     <span class="n">st_dma</span><span class="p">.</span><span class="n">dma_vhi</span> <span class="o">==</span> <span class="mh">0xaa</span> <span class="o">&amp;&amp;</span> <span class="n">st_dma</span><span class="p">.</span><span class="n">dma_hi</span> <span class="o">==</span> <span class="mh">0x55</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">EXTD_DMA</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;EXTD_DMA &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tt_scsi</span><span class="p">.</span><span class="n">scsi_data</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">TT_SCSI</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;TT_SCSI &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sound_ym</span><span class="p">.</span><span class="n">rd_data_reg_sel</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">YM_2149</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;YM2149 &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">MACH_IS_MEDUSA</span> <span class="o">&amp;&amp;</span> <span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tt_dmasnd</span><span class="p">.</span><span class="n">ctrl</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">PCM_8BIT</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;PCM &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">falcon_codec</span><span class="p">.</span><span class="n">unused5</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">CODEC</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;CODEC &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dsp56k_host_interface</span><span class="p">.</span><span class="n">icr</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">DSP56K</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;DSP56K &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tt_scc_dma</span><span class="p">.</span><span class="n">dma_ctrl</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	    /* This test sucks! Who knows some better? */</span>
<span class="c">	    (tt_scc_dma.dma_ctrl = 0x01, (tt_scc_dma.dma_ctrl &amp; 1) == 1) &amp;&amp;</span>
<span class="c">	    (tt_scc_dma.dma_ctrl = 0x00, (tt_scc_dma.dma_ctrl &amp; 1) == 0)</span>
<span class="cp">#else</span>
	    <span class="o">!</span><span class="n">MACH_IS_MEDUSA</span>
<span class="cp">#endif</span>
	    <span class="p">)</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">SCC_DMA</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SCC_DMA &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">scc_test</span><span class="p">(</span><span class="o">&amp;</span><span class="n">atari_scc</span><span class="p">.</span><span class="n">cha_a_ctrl</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">SCC</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;SCC &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">scc_test</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st_escc</span><span class="p">.</span><span class="n">cha_b_ctrl</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">ST_ESCC</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;ST_ESCC &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tt_scu</span><span class="p">.</span><span class="n">sys_mask</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">SCU</span><span class="p">);</span>
		<span class="cm">/* Assume a VME bus if there&#39;s a SCU */</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">VME</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;VME SCU &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="mh">0xffff9210</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">ANALOG_JOY</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;ANALOG_JOY &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="n">blitter</span><span class="p">.</span><span class="n">halftone</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">BLITTER</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;BLITTER &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">((</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xfff00039</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">IDE</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;IDE &quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="cp">#if 1 </span><span class="cm">/* This maybe wrong */</span><span class="cp"></span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">MACH_IS_MEDUSA</span> <span class="o">&amp;&amp;</span> <span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tt_microwire</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tt_microwire</span><span class="p">.</span><span class="n">mask</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">tt_microwire</span><span class="p">.</span><span class="n">mask</span> <span class="o">=</span> <span class="mh">0x7ff</span><span class="p">,</span>
	     <span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
	     <span class="n">tt_microwire</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">MW_LM1992_PSG_HIGH</span> <span class="o">|</span> <span class="n">MW_LM1992_ADDR</span><span class="p">,</span>
	     <span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
	     <span class="n">tt_microwire</span><span class="p">.</span><span class="n">data</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">MICROWIRE</span><span class="p">);</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">tt_microwire</span><span class="p">.</span><span class="n">mask</span> <span class="o">!=</span> <span class="mh">0x7ff</span><span class="p">)</span>
			<span class="p">;</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;MICROWIRE &quot;</span><span class="p">);</span>
	<span class="p">}</span>
<span class="cp">#endif</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tt_rtc</span><span class="p">.</span><span class="n">regsel</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">TT_CLK</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;TT_CLK &quot;</span><span class="p">);</span>
		<span class="n">mach_hwclk</span> <span class="o">=</span> <span class="n">atari_tt_hwclk</span><span class="p">;</span>
		<span class="n">mach_set_clock_mmss</span> <span class="o">=</span> <span class="n">atari_tt_set_clock_mmss</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mste_rtc</span><span class="p">.</span><span class="n">sec_ones</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">MSTE_CLK</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;MSTE_CLK &quot;</span><span class="p">);</span>
		<span class="n">mach_hwclk</span> <span class="o">=</span> <span class="n">atari_mste_hwclk</span><span class="p">;</span>
		<span class="n">mach_set_clock_mmss</span> <span class="o">=</span> <span class="n">atari_mste_set_clock_mmss</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">MACH_IS_MEDUSA</span> <span class="o">&amp;&amp;</span> <span class="n">hwreg_present</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dma_wd</span><span class="p">.</span><span class="n">fdc_speed</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">hwreg_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dma_wd</span><span class="p">.</span><span class="n">fdc_speed</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">FDCSPEED</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;FDC_SPEED &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ATARIHW_PRESENT</span><span class="p">(</span><span class="n">ST_SCSI</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ATARIHW_SET</span><span class="p">(</span><span class="n">ACSI</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;ACSI &quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CPU_IS_040_OR_060</span><span class="p">)</span>
		<span class="cm">/* Now it seems to be safe to turn of the tt0 transparent</span>
<span class="cm">		 * translation (the one that must not be turned off in</span>
<span class="cm">		 * head.S...)</span>
<span class="cm">		 */</span>
		<span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	moveq	#0,%%d0</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	.chip	68040</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	movec	%%d0,%%itt0</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	movec	%%d0,%%dtt0</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	.chip	68k&quot;</span>
			<span class="o">:</span> <span class="cm">/* no outputs */</span>
			<span class="o">:</span> <span class="cm">/* no inputs */</span>
			<span class="o">:</span> <span class="s">&quot;d0&quot;</span><span class="p">);</span>

	<span class="cm">/* allocator for memory that must reside in st-ram */</span>
	<span class="n">atari_stram_init</span><span class="p">();</span>

	<span class="cm">/* Set up a mapping for the VMEbus address region:</span>
<span class="cm">	 *</span>
<span class="cm">	 * VME is either at phys. 0xfexxxxxx (TT) or 0xa00000..0xdfffff</span>
<span class="cm">	 * (MegaSTE) In both cases, the whole 16 MB chunk is mapped at</span>
<span class="cm">	 * 0xfe000000 virt., because this can be done with a single</span>
<span class="cm">	 * transparent translation. On the 68040, lots of often unused</span>
<span class="cm">	 * page tables would be needed otherwise. On a MegaSTE or similar,</span>
<span class="cm">	 * the highest byte is stripped off by hardware due to the 24 bit</span>
<span class="cm">	 * design of the bus.</span>
<span class="cm">	 */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CPU_IS_020_OR_030</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tt1_val</span><span class="p">;</span>
		<span class="n">tt1_val</span> <span class="o">=</span> <span class="mh">0xfe008543</span><span class="p">;</span>	<span class="cm">/* Translate 0xfexxxxxx, enable, cache</span>
<span class="cm">					 * inhibit, read and write, FDC mask = 3,</span>
<span class="cm">					 * FDC val = 4 -&gt; Supervisor only */</span>
		<span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	.chip	68030</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	pmove	%0,%/tt1</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	.chip	68k&quot;</span>
			<span class="o">:</span> <span class="o">:</span> <span class="s">&quot;m&quot;</span> <span class="p">(</span><span class="n">tt1_val</span><span class="p">));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	        <span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	.chip	68040</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	movec	%0,%%itt1</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	movec	%0,%%dtt1</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	.chip	68k&quot;</span>
			<span class="o">:</span>
			<span class="o">:</span> <span class="s">&quot;d&quot;</span> <span class="p">(</span><span class="mh">0xfe00a040</span><span class="p">));</span>	<span class="cm">/* Translate 0xfexxxxxx, enable,</span>
<span class="cm">						 * supervisor only, non-cacheable/</span>
<span class="cm">						 * serialized, writable */</span>

	<span class="p">}</span>

	<span class="cm">/* Fetch tos version at Physical 2 */</span>
	<span class="cm">/*</span>
<span class="cm">	 * We my not be able to access this address if the kernel is</span>
<span class="cm">	 * loaded to st ram, since the first page is unmapped.  On the</span>
<span class="cm">	 * Medusa this is always the case and there is nothing we can do</span>
<span class="cm">	 * about this, so we just assume the smaller offset.  For the TT</span>
<span class="cm">	 * we use the fact that in head.S we have set up a mapping</span>
<span class="cm">	 * 0xFFxxxxxx -&gt; 0x00xxxxxx, so that the first 16MB is accessible</span>
<span class="cm">	 * in the last 16MB of the address space.</span>
<span class="cm">	 */</span>
	<span class="n">tos_version</span> <span class="o">=</span> <span class="p">(</span><span class="n">MACH_IS_MEDUSA</span><span class="p">)</span> <span class="o">?</span>
			<span class="mh">0xfff</span> <span class="o">:</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xff000002</span><span class="p">;</span>
	<span class="n">atari_rtc_year_offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">tos_version</span> <span class="o">&lt;</span> <span class="mh">0x306</span><span class="p">)</span> <span class="o">?</span> <span class="mi">70</span> <span class="o">:</span> <span class="mi">68</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_HEARTBEAT</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">atari_heartbeat</span><span class="p">(</span><span class="kt">int</span> <span class="n">on</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">atari_dont_touch_floppy_select</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">local_irq_save</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
	<span class="n">sound_ym</span><span class="p">.</span><span class="n">rd_data_reg_sel</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>	<span class="cm">/* Select PSG Port A */</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">sound_ym</span><span class="p">.</span><span class="n">rd_data_reg_sel</span><span class="p">;</span>
	<span class="n">sound_ym</span><span class="p">.</span><span class="n">wd_data</span> <span class="o">=</span> <span class="n">on</span> <span class="o">?</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x02</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">|</span> <span class="mh">0x02</span><span class="p">);</span>
	<span class="n">local_irq_restore</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/* ++roman:</span>
<span class="cm"> *</span>
<span class="cm"> * This function does a reset on machines that lack the ability to</span>
<span class="cm"> * assert the processor&#39;s _RESET signal somehow via hardware. It is</span>
<span class="cm"> * based on the fact that you can find the initial SP and PC values</span>
<span class="cm"> * after a reset at physical addresses 0 and 4. This works pretty well</span>
<span class="cm"> * for Atari machines, since the lowest 8 bytes of physical memory are</span>
<span class="cm"> * really ROM (mapped by hardware). For other 680x0 machines: don&#39;t</span>
<span class="cm"> * know if it works...</span>
<span class="cm"> *</span>
<span class="cm"> * To get the values at addresses 0 and 4, the MMU better is turned</span>
<span class="cm"> * off first. After that, we have to jump into physical address space</span>
<span class="cm"> * (the PC before the pmove statement points to the virtual address of</span>
<span class="cm"> * the code). Getting that physical address is not hard, but the code</span>
<span class="cm"> * becomes a bit complex since I&#39;ve tried to ensure that the jump</span>
<span class="cm"> * statement after the pmove is in the cache already (otherwise the</span>
<span class="cm"> * processor can&#39;t fetch it!). For that, the code first jumps to the</span>
<span class="cm"> * jump statement with the (virtual) address of the pmove section in</span>
<span class="cm"> * an address register . The jump statement is surely in the cache</span>
<span class="cm"> * now. After that, that physical address of the reset code is loaded</span>
<span class="cm"> * into the same address register, pmove is done and the same jump</span>
<span class="cm"> * statements goes to the reset code. Since there are not many</span>
<span class="cm"> * statements between the two jumps, I hope it stays in the cache.</span>
<span class="cm"> *</span>
<span class="cm"> * The C code makes heavy use of the GCC features that you can get the</span>
<span class="cm"> * address of a C label. No hope to compile this with another compiler</span>
<span class="cm"> * than GCC!</span>
<span class="cm"> */</span>

<span class="cm">/* ++andreas: no need for complicated code, just depend on prefetch */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">atari_reset</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">long</span> <span class="n">tc_val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">reset_addr</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * On the Medusa, phys. 0x4 may contain garbage because it&#39;s no</span>
<span class="cm">	 * ROM.  See above for explanation why we cannot use PTOV(4).</span>
<span class="cm">	 */</span>
	<span class="n">reset_addr</span> <span class="o">=</span> <span class="n">MACH_IS_MEDUSA</span> <span class="o">||</span> <span class="n">MACH_IS_AB40</span> <span class="o">?</span> <span class="mh">0xe00030</span> <span class="o">:</span>
		     <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span> <span class="mh">0xff000004</span><span class="p">;</span>

	<span class="cm">/* reset ACIA for switch off OverScan, if it&#39;s active */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">atari_switches</span> <span class="o">&amp;</span> <span class="n">ATARI_SWITCH_OVSC_IKBD</span><span class="p">)</span>
		<span class="n">acia</span><span class="p">.</span><span class="n">key_ctrl</span> <span class="o">=</span> <span class="n">ACIA_RESET</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">atari_switches</span> <span class="o">&amp;</span> <span class="n">ATARI_SWITCH_OVSC_MIDI</span><span class="p">)</span>
		<span class="n">acia</span><span class="p">.</span><span class="n">mid_ctrl</span> <span class="o">=</span> <span class="n">ACIA_RESET</span><span class="p">;</span>

	<span class="cm">/* processor independent: turn off interrupts and reset the VBR;</span>
<span class="cm">	 * the caches must be left enabled, else prefetching the final jump</span>
<span class="cm">	 * instruction doesn&#39;t work.</span>
<span class="cm">	 */</span>
	<span class="n">local_irq_disable</span><span class="p">();</span>
	<span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot;movec	%0,%%vbr&quot;</span>
			<span class="o">:</span> <span class="o">:</span> <span class="s">&quot;d&quot;</span> <span class="p">(</span><span class="mi">0</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">CPU_IS_040_OR_060</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">jmp_addr040</span> <span class="o">=</span> <span class="n">virt_to_phys</span><span class="p">(</span><span class="o">&amp;&amp;</span><span class="n">jmp_addr_label040</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">CPU_IS_060</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* 68060: clear PCR to turn off superscalar operation */</span>
			<span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
				<span class="s">&quot;	.chip 68060</span><span class="se">\n</span><span class="s">&quot;</span>
				<span class="s">&quot;	movec %0,%%pcr</span><span class="se">\n</span><span class="s">&quot;</span>
				<span class="s">&quot;	.chip 68k&quot;</span>
				<span class="o">:</span> <span class="o">:</span> <span class="s">&quot;d&quot;</span> <span class="p">(</span><span class="mi">0</span><span class="p">));</span>
		<span class="p">}</span>

		<span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	move.l	%0,%%d0</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	and.l	#0xff000000,%%d0</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	or.w	#0xe020,%%d0</span><span class="se">\n</span><span class="s">&quot;</span>   <span class="cm">/* map 16 MB, enable, cacheable */</span>
			<span class="s">&quot;	.chip	68040</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	movec	%%d0,%%itt0</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	movec	%%d0,%%dtt0</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	.chip	68k</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	jmp	%0@&quot;</span>
			<span class="o">:</span> <span class="o">:</span> <span class="s">&quot;a&quot;</span> <span class="p">(</span><span class="n">jmp_addr040</span><span class="p">)</span>
			<span class="o">:</span> <span class="s">&quot;d0&quot;</span><span class="p">);</span>
	<span class="nl">jmp_addr_label040:</span>
		<span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	moveq	#0,%%d0</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	nop</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	.chip	68040</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	cinva	%%bc</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	nop</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	pflusha</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	nop</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	movec	%%d0,%%tc</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	nop</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="cm">/* the following setup of transparent translations is needed on the</span>
<span class="cm">			 * Afterburner040 to successfully reboot. Other machines shouldn&#39;t</span>
<span class="cm">			 * care about a different tt regs setup, they also didn&#39;t care in</span>
<span class="cm">			 * the past that the regs weren&#39;t turned off. */</span>
			<span class="s">&quot;	move.l	#0xffc000,%%d0</span><span class="se">\n</span><span class="s">&quot;</span> <span class="cm">/* whole insn space cacheable */</span>
			<span class="s">&quot;	movec	%%d0,%%itt0</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	movec	%%d0,%%itt1</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	or.w	#0x40,%/d0</span><span class="se">\n</span><span class="s">&quot;</span> <span class="cm">/* whole data space non-cacheable/ser. */</span>
			<span class="s">&quot;	movec	%%d0,%%dtt0</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	movec	%%d0,%%dtt1</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	.chip	68k</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	jmp	%0@&quot;</span>
			<span class="o">:</span> <span class="cm">/* no outputs */</span>
			<span class="o">:</span> <span class="s">&quot;a&quot;</span> <span class="p">(</span><span class="n">reset_addr</span><span class="p">)</span>
			<span class="o">:</span> <span class="s">&quot;d0&quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	pmove	%0,%%tc</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;	jmp	%1@&quot;</span>
			<span class="o">:</span> <span class="cm">/* no outputs */</span>
			<span class="o">:</span> <span class="s">&quot;m&quot;</span> <span class="p">(</span><span class="n">tc_val</span><span class="p">),</span> <span class="s">&quot;a&quot;</span> <span class="p">(</span><span class="n">reset_addr</span><span class="p">));</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">atari_get_model</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">model</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&quot;Atari &quot;</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">atari_mch_cookie</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">ATARI_MCH_ST</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">ATARIHW_PRESENT</span><span class="p">(</span><span class="n">MSTE_CLK</span><span class="p">))</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&quot;Mega ST&quot;</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&quot;ST&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ATARI_MCH_STE</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">MACH_IS_MSTE</span><span class="p">)</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&quot;Mega STE&quot;</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&quot;STE&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ATARI_MCH_TT</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">MACH_IS_MEDUSA</span><span class="p">)</span>
			<span class="cm">/* Medusa has TT _MCH cookie */</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&quot;Medusa&quot;</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&quot;TT&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">ATARI_MCH_FALCON</span>:
		<span class="n">strcat</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&quot;Falcon&quot;</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">MACH_IS_AB40</span><span class="p">)</span>
			<span class="n">strcat</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&quot; (with Afterburner040)&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">sprintf</span><span class="p">(</span><span class="n">model</span> <span class="o">+</span> <span class="n">strlen</span><span class="p">(</span><span class="n">model</span><span class="p">),</span> <span class="s">&quot;(unknown mach cookie 0x%lx)&quot;</span><span class="p">,</span>
			<span class="n">atari_mch_cookie</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">atari_get_hardware_list</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">m68k_num_memory</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\t</span><span class="s">%3ld MB at 0x%08lx (%s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">m68k_memory</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span> <span class="o">&gt;&gt;</span> <span class="mi">20</span><span class="p">,</span> <span class="n">m68k_memory</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">addr</span><span class="p">,</span>
				<span class="p">(</span><span class="n">m68k_memory</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">addr</span> <span class="o">&amp;</span> <span class="mh">0xff000000</span> <span class="o">?</span>
				 <span class="s">&quot;alternate RAM&quot;</span> <span class="o">:</span> <span class="s">&quot;ST-RAM&quot;</span><span class="p">));</span>

<span class="cp">#define ATARIHW_ANNOUNCE(name, str)			\</span>
<span class="cp">	if (ATARIHW_PRESENT(name))			\</span>
<span class="cp">		seq_printf(m, &quot;\t%s\n&quot;, str)</span>

	<span class="n">seq_printf</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;Detected hardware:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">STND_SHIFTER</span><span class="p">,</span> <span class="s">&quot;ST Shifter&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">EXTD_SHIFTER</span><span class="p">,</span> <span class="s">&quot;STe Shifter&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">TT_SHIFTER</span><span class="p">,</span> <span class="s">&quot;TT Shifter&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">VIDEL_SHIFTER</span><span class="p">,</span> <span class="s">&quot;Falcon Shifter&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">YM_2149</span><span class="p">,</span> <span class="s">&quot;Programmable Sound Generator&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">PCM_8BIT</span><span class="p">,</span> <span class="s">&quot;PCM 8 Bit Sound&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">CODEC</span><span class="p">,</span> <span class="s">&quot;CODEC Sound&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">TT_SCSI</span><span class="p">,</span> <span class="s">&quot;SCSI Controller NCR5380 (TT style)&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">ST_SCSI</span><span class="p">,</span> <span class="s">&quot;SCSI Controller NCR5380 (Falcon style)&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">ACSI</span><span class="p">,</span> <span class="s">&quot;ACSI Interface&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">IDE</span><span class="p">,</span> <span class="s">&quot;IDE Interface&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">FDCSPEED</span><span class="p">,</span> <span class="s">&quot;8/16 Mhz Switch for FDC&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">ST_MFP</span><span class="p">,</span> <span class="s">&quot;Multi Function Peripheral MFP 68901&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">TT_MFP</span><span class="p">,</span> <span class="s">&quot;Second Multi Function Peripheral MFP 68901&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">SCC</span><span class="p">,</span> <span class="s">&quot;Serial Communications Controller SCC 8530&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">ST_ESCC</span><span class="p">,</span> <span class="s">&quot;Extended Serial Communications Controller SCC 85230&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">ANALOG_JOY</span><span class="p">,</span> <span class="s">&quot;Paddle Interface&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">MICROWIRE</span><span class="p">,</span> <span class="s">&quot;MICROWIRE(tm) Interface&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">STND_DMA</span><span class="p">,</span> <span class="s">&quot;DMA Controller (24 bit)&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">EXTD_DMA</span><span class="p">,</span> <span class="s">&quot;DMA Controller (32 bit)&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">SCSI_DMA</span><span class="p">,</span> <span class="s">&quot;DMA Controller for NCR5380&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">SCC_DMA</span><span class="p">,</span> <span class="s">&quot;DMA Controller for SCC&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">TT_CLK</span><span class="p">,</span> <span class="s">&quot;Clock Chip MC146818A&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">MSTE_CLK</span><span class="p">,</span> <span class="s">&quot;Clock Chip RP5C15&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">SCU</span><span class="p">,</span> <span class="s">&quot;System Control Unit&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">BLITTER</span><span class="p">,</span> <span class="s">&quot;Blitter&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">VME</span><span class="p">,</span> <span class="s">&quot;VME Bus&quot;</span><span class="p">);</span>
	<span class="n">ATARIHW_ANNOUNCE</span><span class="p">(</span><span class="n">DSP56K</span><span class="p">,</span> <span class="s">&quot;DSP56001 processor&quot;</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
