<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › m68k › mvme16x › config.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>config.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  arch/m68k/mvme16x/config.c</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 1995 Richard Hirst [richard@sleepie.demon.co.uk]</span>
<span class="cm"> *</span>
<span class="cm"> * Based on:</span>
<span class="cm"> *</span>
<span class="cm"> *  linux/amiga/config.c</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 1993 Hamish Macdonald</span>
<span class="cm"> *</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file README.legal in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;linux/seq_file.h&gt;</span>
<span class="cp">#include &lt;linux/tty.h&gt;</span>
<span class="cp">#include &lt;linux/console.h&gt;</span>
<span class="cp">#include &lt;linux/linkage.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/major.h&gt;</span>
<span class="cp">#include &lt;linux/genhd.h&gt;</span>
<span class="cp">#include &lt;linux/rtc.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>

<span class="cp">#include &lt;asm/bootinfo.h&gt;</span>
<span class="cp">#include &lt;asm/pgtable.h&gt;</span>
<span class="cp">#include &lt;asm/setup.h&gt;</span>
<span class="cp">#include &lt;asm/irq.h&gt;</span>
<span class="cp">#include &lt;asm/traps.h&gt;</span>
<span class="cp">#include &lt;asm/rtc.h&gt;</span>
<span class="cp">#include &lt;asm/machdep.h&gt;</span>
<span class="cp">#include &lt;asm/mvme16xhw.h&gt;</span>

<span class="k">extern</span> <span class="n">t_bdid</span> <span class="n">mvme_bdid</span><span class="p">;</span>

<span class="k">static</span> <span class="n">MK48T08ptr_t</span> <span class="k">volatile</span> <span class="n">rtc</span> <span class="o">=</span> <span class="p">(</span><span class="n">MK48T08ptr_t</span><span class="p">)</span><span class="n">MVME_RTC_BASE</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">mvme16x_get_model</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">model</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mvme16x_sched_init</span><span class="p">(</span><span class="n">irq_handler_t</span> <span class="n">handler</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mvme16x_gettimeoffset</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mvme16x_hwclk</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rtc_time</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mvme16x_set_clock_mmss</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mvme16x_reset</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">bcd2int</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b</span><span class="p">);</span>

<span class="cm">/* Save tick handler routine pointer, will point to xtime_update() in</span>
<span class="cm"> * kernel/time/timekeeping.c, called via mvme16x_process_int() */</span>

<span class="k">static</span> <span class="n">irq_handler_t</span> <span class="n">tick_handler</span><span class="p">;</span>


<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">mvme16x_config</span><span class="p">;</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">mvme16x_config</span><span class="p">);</span>


<span class="kt">int</span> <span class="nf">mvme16x_parse_bootinfo</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">bi_record</span> <span class="o">*</span><span class="n">bi</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bi</span><span class="o">-&gt;</span><span class="n">tag</span> <span class="o">==</span> <span class="n">BI_VME_TYPE</span> <span class="o">||</span> <span class="n">bi</span><span class="o">-&gt;</span><span class="n">tag</span> <span class="o">==</span> <span class="n">BI_VME_BRDINFO</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">mvme16x_reset</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">printk</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\r\n\n</span><span class="s">Called mvme16x_reset</span><span class="se">\r\n</span><span class="s">&quot;</span>
			<span class="s">&quot;</span><span class="se">\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r\r</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="cm">/* The string of returns is to delay the reset until the whole</span>
<span class="cm">	 * message is output.  Assert reset bit in GCSR */</span>
	<span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xfff40107</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mvme16x_get_model</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">model</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">p_bdid</span> <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mvme_bdid</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">suf</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

    <span class="n">suf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">brdsuffix</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">suf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">brdsuffix</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">suf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
    <span class="n">suf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">suf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">?</span> <span class="sc">&#39;-&#39;</span> <span class="o">:</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>

    <span class="n">sprintf</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s">&quot;Motorola MVME%x%s&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span><span class="p">,</span> <span class="n">suf</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">mvme16x_get_hardware_list</span><span class="p">(</span><span class="k">struct</span> <span class="n">seq_file</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">p_bdid</span> <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mvme_bdid</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span> <span class="o">==</span> <span class="mh">0x0162</span> <span class="o">||</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span> <span class="o">==</span> <span class="mh">0x0172</span><span class="p">)</span>
    <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">rev</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">MVME162_VERSION_REG</span><span class="p">;</span>

	<span class="n">seq_printf</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;VMEchip2        %spresent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rev</span> <span class="o">&amp;</span> <span class="n">MVME16x_CONFIG_NO_VMECHIP2</span> <span class="o">?</span> <span class="s">&quot;NOT &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;SCSI interface  %spresent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rev</span> <span class="o">&amp;</span> <span class="n">MVME16x_CONFIG_NO_SCSICHIP</span> <span class="o">?</span> <span class="s">&quot;NOT &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="n">seq_printf</span> <span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s">&quot;Ethernet i/f    %spresent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rev</span> <span class="o">&amp;</span> <span class="n">MVME16x_CONFIG_NO_ETHERNET</span> <span class="o">?</span> <span class="s">&quot;NOT &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This function is called during kernel startup to initialize</span>
<span class="cm"> * the mvme16x IRQ handling routines.  Should probably ensure</span>
<span class="cm"> * that the base vectors for the VMEChip2 and PCCChip2 are valid.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mvme16x_init_IRQ</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">m68k_setup_user_interrupt</span><span class="p">(</span><span class="n">VEC_USER</span><span class="p">,</span> <span class="mi">192</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define pcc2chip	((volatile u_char *)0xfff42000)</span>
<span class="cp">#define PccSCCMICR	0x1d</span>
<span class="cp">#define PccSCCTICR	0x1e</span>
<span class="cp">#define PccSCCRICR	0x1f</span>
<span class="cp">#define PccTPIACKR	0x25</span>

<span class="cp">#ifdef CONFIG_EARLY_PRINTK</span>

<span class="cm">/**** cd2401 registers ****/</span>
<span class="cp">#define CD2401_ADDR	(0xfff45000)</span>

<span class="cp">#define CyGFRCR         (0x81)</span>
<span class="cp">#define CyCCR		(0x13)</span>
<span class="cp">#define      CyCLR_CHAN		(0x40)</span>
<span class="cp">#define      CyINIT_CHAN	(0x20)</span>
<span class="cp">#define      CyCHIP_RESET	(0x10)</span>
<span class="cp">#define      CyENB_XMTR		(0x08)</span>
<span class="cp">#define      CyDIS_XMTR		(0x04)</span>
<span class="cp">#define      CyENB_RCVR		(0x02)</span>
<span class="cp">#define      CyDIS_RCVR		(0x01)</span>
<span class="cp">#define CyCAR		(0xee)</span>
<span class="cp">#define CyIER		(0x11)</span>
<span class="cp">#define      CyMdmCh		(0x80)</span>
<span class="cp">#define      CyRxExc		(0x20)</span>
<span class="cp">#define      CyRxData		(0x08)</span>
<span class="cp">#define      CyTxMpty		(0x02)</span>
<span class="cp">#define      CyTxRdy		(0x01)</span>
<span class="cp">#define CyLICR		(0x26)</span>
<span class="cp">#define CyRISR		(0x89)</span>
<span class="cp">#define      CyTIMEOUT		(0x80)</span>
<span class="cp">#define      CySPECHAR		(0x70)</span>
<span class="cp">#define      CyOVERRUN		(0x08)</span>
<span class="cp">#define      CyPARITY		(0x04)</span>
<span class="cp">#define      CyFRAME		(0x02)</span>
<span class="cp">#define      CyBREAK		(0x01)</span>
<span class="cp">#define CyREOIR		(0x84)</span>
<span class="cp">#define CyTEOIR		(0x85)</span>
<span class="cp">#define CyMEOIR		(0x86)</span>
<span class="cp">#define      CyNOTRANS		(0x08)</span>
<span class="cp">#define CyRFOC		(0x30)</span>
<span class="cp">#define CyRDR		(0xf8)</span>
<span class="cp">#define CyTDR		(0xf8)</span>
<span class="cp">#define CyMISR		(0x8b)</span>
<span class="cp">#define CyRISR		(0x89)</span>
<span class="cp">#define CyTISR		(0x8a)</span>
<span class="cp">#define CyMSVR1		(0xde)</span>
<span class="cp">#define CyMSVR2		(0xdf)</span>
<span class="cp">#define      CyDSR		(0x80)</span>
<span class="cp">#define      CyDCD		(0x40)</span>
<span class="cp">#define      CyCTS		(0x20)</span>
<span class="cp">#define      CyDTR		(0x02)</span>
<span class="cp">#define      CyRTS		(0x01)</span>
<span class="cp">#define CyRTPRL		(0x25)</span>
<span class="cp">#define CyRTPRH		(0x24)</span>
<span class="cp">#define CyCOR1		(0x10)</span>
<span class="cp">#define      CyPARITY_NONE	(0x00)</span>
<span class="cp">#define      CyPARITY_E		(0x40)</span>
<span class="cp">#define      CyPARITY_O		(0xC0)</span>
<span class="cp">#define      Cy_5_BITS		(0x04)</span>
<span class="cp">#define      Cy_6_BITS		(0x05)</span>
<span class="cp">#define      Cy_7_BITS		(0x06)</span>
<span class="cp">#define      Cy_8_BITS		(0x07)</span>
<span class="cp">#define CyCOR2		(0x17)</span>
<span class="cp">#define      CyETC		(0x20)</span>
<span class="cp">#define      CyCtsAE		(0x02)</span>
<span class="cp">#define CyCOR3		(0x16)</span>
<span class="cp">#define      Cy_1_STOP		(0x02)</span>
<span class="cp">#define      Cy_2_STOP		(0x04)</span>
<span class="cp">#define CyCOR4		(0x15)</span>
<span class="cp">#define      CyREC_FIFO		(0x0F)  </span><span class="cm">/* Receive FIFO threshold */</span><span class="cp"></span>
<span class="cp">#define CyCOR5		(0x14)</span>
<span class="cp">#define CyCOR6		(0x18)</span>
<span class="cp">#define CyCOR7		(0x07)</span>
<span class="cp">#define CyRBPR		(0xcb)</span>
<span class="cp">#define CyRCOR		(0xc8)</span>
<span class="cp">#define CyTBPR		(0xc3)</span>
<span class="cp">#define CyTCOR		(0xc0)</span>
<span class="cp">#define CySCHR1		(0x1f)</span>
<span class="cp">#define CySCHR2 	(0x1e)</span>
<span class="cp">#define CyTPR		(0xda)</span>
<span class="cp">#define CyPILR1		(0xe3)</span>
<span class="cp">#define CyPILR2		(0xe0)</span>
<span class="cp">#define CyPILR3		(0xe1)</span>
<span class="cp">#define CyCMR		(0x1b)</span>
<span class="cp">#define      CyASYNC		(0x02)</span>
<span class="cp">#define CyLICR          (0x26)</span>
<span class="cp">#define CyLIVR          (0x09)</span>
<span class="cp">#define CySCRL		(0x23)</span>
<span class="cp">#define CySCRH		(0x22)</span>
<span class="cp">#define CyTFTC		(0x80)</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cons_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">console</span> <span class="o">*</span><span class="n">co</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">base_addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="p">)</span><span class="n">CD2401_ADDR</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="n">u_char</span> <span class="n">sink</span><span class="p">;</span>
	<span class="n">u_char</span> <span class="n">ier</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">port</span><span class="p">;</span>
	<span class="n">u_char</span> <span class="n">do_lf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Ensure transmitter is enabled! */</span>

	<span class="n">port</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">base_addr</span><span class="p">[</span><span class="n">CyCAR</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_char</span><span class="p">)</span><span class="n">port</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">base_addr</span><span class="p">[</span><span class="n">CyCCR</span><span class="p">])</span>
		<span class="p">;</span>
	<span class="n">base_addr</span><span class="p">[</span><span class="n">CyCCR</span><span class="p">]</span> <span class="o">=</span> <span class="n">CyENB_XMTR</span><span class="p">;</span>

	<span class="n">ier</span> <span class="o">=</span> <span class="n">base_addr</span><span class="p">[</span><span class="n">CyIER</span><span class="p">];</span>
	<span class="n">base_addr</span><span class="p">[</span><span class="n">CyIER</span><span class="p">]</span> <span class="o">=</span> <span class="n">CyTxMpty</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">pcc2chip</span><span class="p">[</span><span class="n">PccSCCTICR</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="cm">/* We have a Tx int. Acknowledge it */</span>
			<span class="n">sink</span> <span class="o">=</span> <span class="n">pcc2chip</span><span class="p">[</span><span class="n">PccTPIACKR</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">base_addr</span><span class="p">[</span><span class="n">CyLICR</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="n">port</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="n">count</span><span class="p">)</span> <span class="p">{</span>
					<span class="cm">/* Last char of string is now output */</span>
					<span class="n">base_addr</span><span class="p">[</span><span class="n">CyTEOIR</span><span class="p">]</span> <span class="o">=</span> <span class="n">CyNOTRANS</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">do_lf</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">base_addr</span><span class="p">[</span><span class="n">CyTDR</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\n&#39;</span><span class="p">;</span>
					<span class="n">str</span><span class="o">++</span><span class="p">;</span>
					<span class="n">i</span><span class="o">++</span><span class="p">;</span>
					<span class="n">do_lf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">str</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">base_addr</span><span class="p">[</span><span class="n">CyTDR</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\r&#39;</span><span class="p">;</span>
					<span class="n">do_lf</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="k">else</span> <span class="p">{</span>
					<span class="n">base_addr</span><span class="p">[</span><span class="n">CyTDR</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">str</span><span class="o">++</span><span class="p">;</span>
					<span class="n">i</span><span class="o">++</span><span class="p">;</span>
				<span class="p">}</span>
				<span class="n">base_addr</span><span class="p">[</span><span class="n">CyTEOIR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">else</span>
				<span class="n">base_addr</span><span class="p">[</span><span class="n">CyTEOIR</span><span class="p">]</span> <span class="o">=</span> <span class="n">CyNOTRANS</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">base_addr</span><span class="p">[</span><span class="n">CyIER</span><span class="p">]</span> <span class="o">=</span> <span class="n">ier</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">console</span> <span class="n">cons_info</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;sercon&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span>	<span class="o">=</span> <span class="n">cons_write</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">CON_PRINTBUFFER</span> <span class="o">|</span> <span class="n">CON_BOOT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">index</span>	<span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mvme16x_early_console</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">register_console</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cons_info</span><span class="p">);</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;MVME16x: early console registered</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="kt">void</span> <span class="n">__init</span> <span class="nf">config_mvme16x</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">p_bdid</span> <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mvme_bdid</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">id</span><span class="p">[</span><span class="mi">40</span><span class="p">];</span>

    <span class="n">mach_max_dma_address</span> <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">;</span>
    <span class="n">mach_sched_init</span>      <span class="o">=</span> <span class="n">mvme16x_sched_init</span><span class="p">;</span>
    <span class="n">mach_init_IRQ</span>        <span class="o">=</span> <span class="n">mvme16x_init_IRQ</span><span class="p">;</span>
    <span class="n">mach_gettimeoffset</span>   <span class="o">=</span> <span class="n">mvme16x_gettimeoffset</span><span class="p">;</span>
    <span class="n">mach_hwclk</span>           <span class="o">=</span> <span class="n">mvme16x_hwclk</span><span class="p">;</span>
    <span class="n">mach_set_clock_mmss</span>	 <span class="o">=</span> <span class="n">mvme16x_set_clock_mmss</span><span class="p">;</span>
    <span class="n">mach_reset</span>		 <span class="o">=</span> <span class="n">mvme16x_reset</span><span class="p">;</span>
    <span class="n">mach_get_model</span>       <span class="o">=</span> <span class="n">mvme16x_get_model</span><span class="p">;</span>
    <span class="n">mach_get_hardware_list</span> <span class="o">=</span> <span class="n">mvme16x_get_hardware_list</span><span class="p">;</span>

    <span class="cm">/* Report board revision */</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strncmp</span><span class="p">(</span><span class="s">&quot;BDID&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">bdid</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
    <span class="p">{</span>
	<span class="n">printk</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n\n</span><span class="s">Bug call .BRD_ID returned garbage - giving up</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
		<span class="p">;</span>
    <span class="p">}</span>
    <span class="cm">/* Board type is only set by newer versions of vmelilo/tftplilo */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">vme_brdtype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
	<span class="n">vme_brdtype</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span><span class="p">;</span>

    <span class="n">mvme16x_get_model</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
    <span class="n">printk</span> <span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">BRD_ID: %s   BUG %x.%x %02x/%02x/%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">rev</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">,</span>
					<span class="n">p</span><span class="o">-&gt;</span><span class="n">rev</span><span class="o">&amp;</span><span class="mh">0xf</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">yr</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">mth</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">day</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span> <span class="o">==</span> <span class="mh">0x0162</span> <span class="o">||</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span> <span class="o">==</span> <span class="mh">0x172</span><span class="p">)</span>
    <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">rev</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">MVME162_VERSION_REG</span><span class="p">;</span>

	<span class="n">mvme16x_config</span> <span class="o">=</span> <span class="n">rev</span> <span class="o">|</span> <span class="n">MVME16x_CONFIG_GOT_SCCA</span><span class="p">;</span>

	<span class="n">printk</span> <span class="p">(</span><span class="s">&quot;MVME%x Hardware status:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span><span class="p">);</span>
	<span class="n">printk</span> <span class="p">(</span><span class="s">&quot;    CPU Type           68%s040</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rev</span> <span class="o">&amp;</span> <span class="n">MVME16x_CONFIG_GOT_FPU</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="s">&quot;LC&quot;</span><span class="p">);</span>
	<span class="n">printk</span> <span class="p">(</span><span class="s">&quot;    CPU clock          %dMHz</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rev</span> <span class="o">&amp;</span> <span class="n">MVME16x_CONFIG_SPEED_32</span> <span class="o">?</span> <span class="mi">32</span> <span class="o">:</span> <span class="mi">25</span><span class="p">);</span>
	<span class="n">printk</span> <span class="p">(</span><span class="s">&quot;    VMEchip2           %spresent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rev</span> <span class="o">&amp;</span> <span class="n">MVME16x_CONFIG_NO_VMECHIP2</span> <span class="o">?</span> <span class="s">&quot;NOT &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="n">printk</span> <span class="p">(</span><span class="s">&quot;    SCSI interface     %spresent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rev</span> <span class="o">&amp;</span> <span class="n">MVME16x_CONFIG_NO_SCSICHIP</span> <span class="o">?</span> <span class="s">&quot;NOT &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="n">printk</span> <span class="p">(</span><span class="s">&quot;    Ethernet interface %spresent</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">rev</span> <span class="o">&amp;</span> <span class="n">MVME16x_CONFIG_NO_ETHERNET</span> <span class="o">?</span> <span class="s">&quot;NOT &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
	<span class="n">mvme16x_config</span> <span class="o">=</span> <span class="n">MVME16x_CONFIG_GOT_LP</span> <span class="o">|</span> <span class="n">MVME16x_CONFIG_GOT_CD2401</span><span class="p">;</span>

	<span class="cm">/* Dont allow any interrupts from the CD2401 until the interrupt */</span>
	<span class="cm">/* handlers are installed					 */</span>

	<span class="n">pcc2chip</span><span class="p">[</span><span class="n">PccSCCMICR</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">pcc2chip</span><span class="p">[</span><span class="n">PccSCCTICR</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="n">pcc2chip</span><span class="p">[</span><span class="n">PccSCCRICR</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
<span class="cp">#ifdef CONFIG_EARLY_PRINTK</span>
	<span class="n">mvme16x_early_console</span><span class="p">();</span>
<span class="cp">#endif</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">irqreturn_t</span> <span class="nf">mvme16x_abort_int</span> <span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dev_id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">p_bdid</span> <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mvme_bdid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">new</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="n">vectors</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">old</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xffe00000</span><span class="p">;</span>
	<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">uc</span><span class="p">,</span> <span class="o">*</span><span class="n">ucp</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span> <span class="o">==</span> <span class="mh">0x0162</span> <span class="o">||</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span> <span class="o">==</span> <span class="mh">0x172</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">ucp</span> <span class="o">=</span> <span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xfff42043</span><span class="p">;</span>
		<span class="n">uc</span> <span class="o">=</span> <span class="o">*</span><span class="n">ucp</span> <span class="o">|</span> <span class="mi">8</span><span class="p">;</span>
		<span class="o">*</span><span class="n">ucp</span> <span class="o">=</span> <span class="n">uc</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">else</span>
	<span class="p">{</span>
		<span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xfff40074</span> <span class="o">=</span> <span class="mh">0x40000000</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="o">*</span><span class="p">(</span><span class="n">new</span><span class="o">+</span><span class="mi">4</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">old</span><span class="o">+</span><span class="mi">4</span><span class="p">);</span>		<span class="cm">/* Illegal instruction */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">new</span><span class="o">+</span><span class="mi">9</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">old</span><span class="o">+</span><span class="mi">9</span><span class="p">);</span>		<span class="cm">/* Trace */</span>
	<span class="o">*</span><span class="p">(</span><span class="n">new</span><span class="o">+</span><span class="mi">47</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">old</span><span class="o">+</span><span class="mi">47</span><span class="p">);</span>		<span class="cm">/* Trap #15 */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span> <span class="o">==</span> <span class="mh">0x0162</span> <span class="o">||</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span> <span class="o">==</span> <span class="mh">0x172</span><span class="p">)</span>
		<span class="o">*</span><span class="p">(</span><span class="n">new</span><span class="o">+</span><span class="mh">0x5e</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">old</span><span class="o">+</span><span class="mh">0x5e</span><span class="p">);</span>	<span class="cm">/* ABORT switch */</span>
	<span class="k">else</span>
		<span class="o">*</span><span class="p">(</span><span class="n">new</span><span class="o">+</span><span class="mh">0x6e</span><span class="p">)</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">old</span><span class="o">+</span><span class="mh">0x6e</span><span class="p">);</span>	<span class="cm">/* ABORT switch */</span>
	<span class="k">return</span> <span class="n">IRQ_HANDLED</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">irqreturn_t</span> <span class="nf">mvme16x_timer_int</span> <span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dev_id</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xfff4201b</span> <span class="o">|=</span> <span class="mi">8</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">tick_handler</span><span class="p">(</span><span class="n">irq</span><span class="p">,</span> <span class="n">dev_id</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">mvme16x_sched_init</span> <span class="p">(</span><span class="n">irq_handler_t</span> <span class="n">timer_routine</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">p_bdid</span> <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">mvme_bdid</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>

    <span class="n">tick_handler</span> <span class="o">=</span> <span class="n">timer_routine</span><span class="p">;</span>
    <span class="cm">/* Using PCCchip2 or MC2 chip tick timer 1 */</span>
    <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xfff42008</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xfff42004</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">;</span>	<span class="cm">/* 10ms */</span>
    <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xfff42017</span> <span class="o">|=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xfff4201b</span> <span class="o">=</span> <span class="mh">0x16</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">request_irq</span><span class="p">(</span><span class="n">MVME16x_IRQ_TIMER</span><span class="p">,</span> <span class="n">mvme16x_timer_int</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s">&quot;timer&quot;</span><span class="p">,</span> <span class="n">mvme16x_timer_int</span><span class="p">))</span>
	<span class="n">panic</span> <span class="p">(</span><span class="s">&quot;Couldn&#39;t register timer int&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span> <span class="o">==</span> <span class="mh">0x0162</span> <span class="o">||</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">brdno</span> <span class="o">==</span> <span class="mh">0x172</span><span class="p">)</span>
	<span class="n">irq</span> <span class="o">=</span> <span class="n">MVME162_IRQ_ABORT</span><span class="p">;</span>
    <span class="k">else</span>
        <span class="n">irq</span> <span class="o">=</span> <span class="n">MVME167_IRQ_ABORT</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">request_irq</span><span class="p">(</span><span class="n">irq</span><span class="p">,</span> <span class="n">mvme16x_abort_int</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s">&quot;abort&quot;</span><span class="p">,</span> <span class="n">mvme16x_abort_int</span><span class="p">))</span>
	<span class="n">panic</span> <span class="p">(</span><span class="s">&quot;Couldn&#39;t register abort int&quot;</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/* This is always executed with interrupts disabled.  */</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">mvme16x_gettimeoffset</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="p">)</span><span class="mh">0xfff42008</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">bcd2int</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">((</span><span class="n">b</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="mi">15</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">mvme16x_hwclk</span><span class="p">(</span><span class="kt">int</span> <span class="n">op</span><span class="p">,</span> <span class="k">struct</span> <span class="n">rtc_time</span> <span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#warning check me!</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">op</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rtc</span><span class="o">-&gt;</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">RTC_READ</span><span class="p">;</span>
		<span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_year</span> <span class="o">=</span> <span class="n">bcd2int</span> <span class="p">(</span><span class="n">rtc</span><span class="o">-&gt;</span><span class="n">bcd_year</span><span class="p">);</span>
		<span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_mon</span>  <span class="o">=</span> <span class="n">bcd2int</span> <span class="p">(</span><span class="n">rtc</span><span class="o">-&gt;</span><span class="n">bcd_mth</span><span class="p">);</span>
		<span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_mday</span> <span class="o">=</span> <span class="n">bcd2int</span> <span class="p">(</span><span class="n">rtc</span><span class="o">-&gt;</span><span class="n">bcd_dom</span><span class="p">);</span>
		<span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_hour</span> <span class="o">=</span> <span class="n">bcd2int</span> <span class="p">(</span><span class="n">rtc</span><span class="o">-&gt;</span><span class="n">bcd_hr</span><span class="p">);</span>
		<span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_min</span>  <span class="o">=</span> <span class="n">bcd2int</span> <span class="p">(</span><span class="n">rtc</span><span class="o">-&gt;</span><span class="n">bcd_min</span><span class="p">);</span>
		<span class="n">t</span><span class="o">-&gt;</span><span class="n">tm_sec</span>  <span class="o">=</span> <span class="n">bcd2int</span> <span class="p">(</span><span class="n">rtc</span><span class="o">-&gt;</span><span class="n">bcd_sec</span><span class="p">);</span>
		<span class="n">rtc</span><span class="o">-&gt;</span><span class="n">ctrl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">mvme16x_set_clock_mmss</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">nowtime</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
