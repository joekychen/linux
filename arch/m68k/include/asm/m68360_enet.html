<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › m68k › include › asm › m68360_enet.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>m68360_enet.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/***********************************</span>
<span class="cm"> * $Id: m68360_enet.h,v 1.1 2002/03/02 15:01:07 gerg Exp $</span>
<span class="cm"> ***********************************</span>
<span class="cm"> *</span>
<span class="cm"> ***************************************</span>
<span class="cm"> * Definitions for the ETHERNET controllers</span>
<span class="cm"> ***************************************</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ETHER_H</span>
<span class="cp">#define __ETHER_H</span>

<span class="cp">#include &quot;quicc_simple.h&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * transmit BD&#39;s</span>
<span class="cm"> */</span>
<span class="cp">#define T_R     0x8000          </span><span class="cm">/* ready bit */</span><span class="cp"></span>
<span class="cp">#define E_T_PAD 0x4000          </span><span class="cm">/* short frame padding */</span><span class="cp"></span>
<span class="cp">#define T_W     0x2000          </span><span class="cm">/* wrap bit */</span><span class="cp"></span>
<span class="cp">#define T_I     0x1000          </span><span class="cm">/* interrupt on completion */</span><span class="cp"></span>
<span class="cp">#define T_L     0x0800          </span><span class="cm">/* last in frame */</span><span class="cp"></span>
<span class="cp">#define T_TC    0x0400          </span><span class="cm">/* transmit CRC (when last) */</span><span class="cp"></span>

<span class="cp">#define T_DEF   0x0200          </span><span class="cm">/* defer indication */</span><span class="cp"></span>
<span class="cp">#define T_HB    0x0100          </span><span class="cm">/* heartbeat */</span><span class="cp"></span>
<span class="cp">#define T_LC    0x0080          </span><span class="cm">/* error: late collision */</span><span class="cp"></span>
<span class="cp">#define T_RL    0x0040          </span><span class="cm">/* error: retransmission limit */</span><span class="cp"></span>
<span class="cp">#define T_RC    0x003c          </span><span class="cm">/* retry count */</span><span class="cp"></span>
<span class="cp">#define T_UN    0x0002          </span><span class="cm">/* error: underrun */</span><span class="cp"></span>
<span class="cp">#define T_CSL   0x0001          </span><span class="cm">/* carier sense lost */</span><span class="cp"></span>
<span class="cp">#define T_ERROR (T_HB | T_LC | T_RL | T_UN | T_CSL)</span>

<span class="cm">/*</span>
<span class="cm"> * receive BD&#39;s</span>
<span class="cm"> */</span>
<span class="cp">#define R_E     0x8000          </span><span class="cm">/* buffer empty */</span><span class="cp"></span>
<span class="cp">#define R_W     0x2000          </span><span class="cm">/* wrap bit */</span><span class="cp"></span>
<span class="cp">#define R_I     0x1000          </span><span class="cm">/* interrupt on reception */</span><span class="cp"></span>
<span class="cp">#define R_L     0x0800          </span><span class="cm">/* last BD in frame */</span><span class="cp"></span>
<span class="cp">#define R_F     0x0400          </span><span class="cm">/* first BD in frame */</span><span class="cp"></span>
<span class="cp">#define R_M     0x0100          </span><span class="cm">/* received because of promisc. mode */</span><span class="cp"></span>

<span class="cp">#define R_LG    0x0020          </span><span class="cm">/* frame too long */</span><span class="cp"></span>
<span class="cp">#define R_NO    0x0010          </span><span class="cm">/* non-octet aligned */</span><span class="cp"></span>
<span class="cp">#define R_SH    0x0008          </span><span class="cm">/* short frame */</span><span class="cp"></span>
<span class="cp">#define R_CR    0x0004          </span><span class="cm">/* receive CRC error */</span><span class="cp"></span>
<span class="cp">#define R_OV    0x0002          </span><span class="cm">/* receive overrun */</span><span class="cp"></span>
<span class="cp">#define R_CL    0x0001          </span><span class="cm">/* collision */</span><span class="cp"></span>
<span class="cp">#define ETHER_R_ERROR (R_LG | R_NO | R_SH | R_CR | R_OV | R_CL)</span>


<span class="cm">/*</span>
<span class="cm"> * ethernet interrupts</span>
<span class="cm"> */</span>
<span class="cp">#define ETHERNET_GRA    0x0080  </span><span class="cm">/* graceful stop complete */</span><span class="cp"></span>
<span class="cp">#define ETHERNET_TXE    0x0010  </span><span class="cm">/* transmit error         */</span><span class="cp"></span>
<span class="cp">#define ETHERNET_RXF    0x0008  </span><span class="cm">/* receive frame          */</span><span class="cp"></span>
<span class="cp">#define ETHERNET_BSY    0x0004  </span><span class="cm">/* busy condition         */</span><span class="cp"></span>
<span class="cp">#define ETHERNET_TXB    0x0002  </span><span class="cm">/* transmit buffer        */</span><span class="cp"></span>
<span class="cp">#define ETHERNET_RXB    0x0001  </span><span class="cm">/* receive buffer         */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * ethernet protocol specific mode register (PSMR)</span>
<span class="cm"> */</span>
<span class="cp">#define ETHER_HBC       0x8000    </span><span class="cm">/* heartbeat checking      */</span><span class="cp"></span>
<span class="cp">#define ETHER_FC        0x4000    </span><span class="cm">/* force collision         */</span><span class="cp"></span>
<span class="cp">#define ETHER_RSH       0x2000    </span><span class="cm">/* receive short frames    */</span><span class="cp"></span>
<span class="cp">#define ETHER_IAM       0x1000    </span><span class="cm">/* individual address mode */</span><span class="cp"></span>
<span class="cp">#define ETHER_CRC_32    (0x2&lt;&lt;10) </span><span class="cm">/* Enable CRC              */</span><span class="cp"></span>
<span class="cp">#define ETHER_PRO       0x0200    </span><span class="cm">/* promiscuous             */</span><span class="cp"></span>
<span class="cp">#define ETHER_BRO       0x0100    </span><span class="cm">/* broadcast address       */</span><span class="cp"></span>
<span class="cp">#define ETHER_SBT       0x0080    </span><span class="cm">/* stop backoff timer      */</span><span class="cp"></span>
<span class="cp">#define ETHER_LPB       0x0040    </span><span class="cm">/* Loop Back Mode          */</span><span class="cp"></span>
<span class="cp">#define ETHER_SIP       0x0020    </span><span class="cm">/* sample input pins       */</span><span class="cp"></span>
<span class="cp">#define ETHER_LCW       0x0010    </span><span class="cm">/* late collision window   */</span><span class="cp"></span>
<span class="cp">#define ETHER_NIB_13    (0x0&lt;&lt;1)  </span><span class="cm">/* # of ignored bits 13    */</span><span class="cp"></span>
<span class="cp">#define ETHER_NIB_14    (0x1&lt;&lt;1)  </span><span class="cm">/* # of ignored bits 14    */</span><span class="cp"></span>
<span class="cp">#define ETHER_NIB_15    (0x2&lt;&lt;1)  </span><span class="cm">/* # of ignored bits 15    */</span><span class="cp"></span>
<span class="cp">#define ETHER_NIB_16    (0x3&lt;&lt;1)  </span><span class="cm">/* # of ignored bits 16    */</span><span class="cp"></span>
<span class="cp">#define ETHER_NIB_21    (0x4&lt;&lt;1)  </span><span class="cm">/* # of ignored bits 21    */</span><span class="cp"></span>
<span class="cp">#define ETHER_NIB_22    (0x5&lt;&lt;1)  </span><span class="cm">/* # of ignored bits 22    */</span><span class="cp"></span>
<span class="cp">#define ETHER_NIB_23    (0x6&lt;&lt;1)  </span><span class="cm">/* # of ignored bits 23    */</span><span class="cp"></span>
<span class="cp">#define ETHER_NIB_24    (0x7&lt;&lt;1)  </span><span class="cm">/* # of ignored bits 24    */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * ethernet specific parameters</span>
<span class="cm"> */</span>
<span class="cp">#define CRC_WORD 4          </span><span class="cm">/* Length in bytes of CRC */</span><span class="cp">               </span>
<span class="cp">#define C_PRES   0xffffffff </span><span class="cm">/* preform 32 bit CRC */</span><span class="cp"></span>
<span class="cp">#define C_MASK   0xdebb20e3 </span><span class="cm">/* comply with 32 bit CRC */</span><span class="cp">       </span>
<span class="cp">#define CRCEC    0x00000000</span>
<span class="cp">#define ALEC     0x00000000</span>
<span class="cp">#define DISFC    0x00000000</span>
<span class="cp">#define PADS     0x00000000</span>
<span class="cp">#define RET_LIM  0x000f     </span><span class="cm">/* retry 15 times to send a frame before interrupt */</span><span class="cp"></span>
<span class="cp">#define ETH_MFLR 0x05ee     </span><span class="cm">/* 1518 max frame size */</span><span class="cp"></span>
<span class="cp">#define MINFLR   0x0040     </span><span class="cm">/* Minimum frame size 64 */</span><span class="cp"></span>
<span class="cp">#define MAXD1    0x05ee     </span><span class="cm">/* Max dma count 1518 */</span><span class="cp"></span>
<span class="cp">#define MAXD2    0x05ee</span>
<span class="cp">#define GADDR1   0x00000000 </span><span class="cm">/* Clear group address */</span><span class="cp">  </span>
<span class="cp">#define GADDR2   0x00000000</span>
<span class="cp">#define GADDR3   0x00000000    </span>
<span class="cp">#define GADDR4   0x00000000    </span>
<span class="cp">#define P_PER    0x00000000 </span><span class="cm">/*not used */</span><span class="cp">              </span>
<span class="cp">#define IADDR1   0x00000000 </span><span class="cm">/* Individual hash table not used */</span><span class="cp">       </span>
<span class="cp">#define IADDR2   0x00000000</span>
<span class="cp">#define IADDR3   0x00000000    </span>
<span class="cp">#define IADDR4   0x00000000            </span>
<span class="cp">#define TADDR_H  0x00000000 </span><span class="cm">/* clear this regs */</span><span class="cp">              </span>
<span class="cp">#define TADDR_M  0x00000000            </span>
<span class="cp">#define TADDR_L  0x00000000            </span>

<span class="cm">/*       SCC Parameter Ram */</span>
<span class="cp">#define RFCR    0x18 </span><span class="cm">/* normal operation */</span><span class="cp"></span>
<span class="cp">#define TFCR    0x18 </span><span class="cm">/* normal operation */</span><span class="cp"></span>
<span class="cp">#define E_MRBLR 1518 </span><span class="cm">/* Max ethernet frame length */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * ethernet specific structure</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">b</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
        <span class="k">struct</span> <span class="p">{</span>
            <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">high</span><span class="p">;</span>
            <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">middl</span><span class="p">;</span>
            <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">low</span><span class="p">;</span>
        <span class="p">}</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ETHER_ADDR</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">int</span>        <span class="n">max_frame_length</span><span class="p">;</span>
    <span class="kt">int</span>        <span class="n">promisc_mode</span><span class="p">;</span>
    <span class="kt">int</span>        <span class="n">reject_broadcast</span><span class="p">;</span>
    <span class="n">ETHER_ADDR</span> <span class="n">phys_adr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ETHER_SPECIFIC</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">ETHER_ADDR</span>     <span class="n">dst_addr</span><span class="p">;</span>
    <span class="n">ETHER_ADDR</span>     <span class="n">src_addr</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">type_or_len</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span> <span class="n">ETHER_FRAME</span><span class="p">;</span>

<span class="cp">#define MAX_DATALEN 1500</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="n">ETHER_ADDR</span>     <span class="n">dst_addr</span><span class="p">;</span>
    <span class="n">ETHER_ADDR</span>     <span class="n">src_addr</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">type_or_len</span><span class="p">;</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">data</span><span class="p">[</span><span class="n">MAX_DATALEN</span><span class="p">];</span>
    <span class="kt">unsigned</span> <span class="kt">char</span>  <span class="n">fcs</span><span class="p">[</span><span class="n">CRC_WORD</span><span class="p">];</span>
<span class="p">}</span> <span class="n">ETHER_MAX_FRAME</span><span class="p">;</span>


<span class="cm">/*</span>
<span class="cm"> * Internal ethernet function prototypes</span>
<span class="cm"> */</span>
<span class="kt">void</span>        <span class="n">ether_interrupt</span><span class="p">(</span><span class="kt">int</span> <span class="n">scc_num</span><span class="p">);</span>
<span class="cm">/* mleslie: debug */</span>
<span class="cm">/* static void ethernet_rx_internal(int scc_num); */</span>
<span class="cm">/* static void ethernet_tx_internal(int scc_num); */</span>

<span class="cm">/*</span>
<span class="cm"> * User callable routines prototypes (ethernet specific)</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="n">ethernet_init</span><span class="p">(</span><span class="kt">int</span>                       <span class="n">scc_number</span><span class="p">,</span>
                   <span class="n">alloc_routine</span>             <span class="o">*</span><span class="n">alloc_buffer</span><span class="p">,</span>
                   <span class="n">free_routine</span>              <span class="o">*</span><span class="n">free_buffer</span><span class="p">,</span>
                   <span class="n">store_rx_buffer_routine</span>   <span class="o">*</span><span class="n">store_rx_buffer</span><span class="p">,</span>
                   <span class="n">handle_tx_error_routine</span>   <span class="o">*</span><span class="n">handle_tx_error</span><span class="p">,</span>
                   <span class="n">handle_rx_error_routine</span>   <span class="o">*</span><span class="n">handle_rx_error</span><span class="p">,</span>
                   <span class="n">handle_lost_error_routine</span> <span class="o">*</span><span class="n">handle_lost_error</span><span class="p">,</span>
                   <span class="n">ETHER_SPECIFIC</span>            <span class="o">*</span><span class="n">ether_spec</span><span class="p">);</span>
<span class="kt">int</span>  <span class="n">ethernet_tx</span><span class="p">(</span><span class="kt">int</span> <span class="n">scc_number</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">length</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
