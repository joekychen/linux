<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › m68k › include › asm › sun3_pgtable.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>sun3_pgtable.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _SUN3_PGTABLE_H</span>
<span class="cp">#define _SUN3_PGTABLE_H</span>

<span class="cp">#include &lt;asm/sun3mmu.h&gt;</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="cp">#include &lt;asm/virtconvert.h&gt;</span>
<span class="cp">#include &lt;linux/linkage.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * This file contains all the things which change drastically for the sun3</span>
<span class="cm"> * pagetable stuff, to avoid making too much of a mess of the generic m68k</span>
<span class="cm"> * `pgtable.h&#39;; this should only be included from the generic file. --m</span>
<span class="cm"> */</span>

<span class="cm">/* For virtual address to physical address conversion */</span>
<span class="cp">#define VTOP(addr)	__pa(addr)</span>
<span class="cp">#define PTOV(addr)	__va(addr)</span>


<span class="cp">#endif	</span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/* These need to be defined for compatibility although the sun3 doesn&#39;t use them */</span>
<span class="cp">#define _PAGE_NOCACHE030 0x040</span>
<span class="cp">#define _CACHEMASK040   (~0x060)</span>
<span class="cp">#define _PAGE_NOCACHE_S 0x040</span>

<span class="cm">/* Page protection values within PTE. */</span>
<span class="cp">#define SUN3_PAGE_VALID     (0x80000000)</span>
<span class="cp">#define SUN3_PAGE_WRITEABLE (0x40000000)</span>
<span class="cp">#define SUN3_PAGE_SYSTEM    (0x20000000)</span>
<span class="cp">#define SUN3_PAGE_NOCACHE   (0x10000000)</span>
<span class="cp">#define SUN3_PAGE_ACCESSED  (0x02000000)</span>
<span class="cp">#define SUN3_PAGE_MODIFIED  (0x01000000)</span>


<span class="cm">/* Externally used page protection values. */</span>
<span class="cp">#define _PAGE_PRESENT	(SUN3_PAGE_VALID)</span>
<span class="cp">#define _PAGE_ACCESSED	(SUN3_PAGE_ACCESSED)</span>

<span class="cp">#define PTE_FILE_MAX_BITS 28</span>

<span class="cm">/* Compound page protection values. */</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>todo: work out which ones <em>should</em> have SUN3<em>PAGE</em>NOCACHE and fix...
is it just PAGE<em>KERNEL and PAGE</em>SHARED?</p></td><td class="code"><div class="highlight"><pre><span class="cp">#define PAGE_NONE	__pgprot(SUN3_PAGE_VALID \</span>
<span class="cp">				 | SUN3_PAGE_ACCESSED \</span>
<span class="cp">				 | SUN3_PAGE_NOCACHE)</span>
<span class="cp">#define PAGE_SHARED	__pgprot(SUN3_PAGE_VALID \</span>
<span class="cp">				 | SUN3_PAGE_WRITEABLE \</span>
<span class="cp">				 | SUN3_PAGE_ACCESSED \</span>
<span class="cp">				 | SUN3_PAGE_NOCACHE)</span>
<span class="cp">#define PAGE_COPY	__pgprot(SUN3_PAGE_VALID \</span>
<span class="cp">				 | SUN3_PAGE_ACCESSED \</span>
<span class="cp">				 | SUN3_PAGE_NOCACHE)</span>
<span class="cp">#define PAGE_READONLY	__pgprot(SUN3_PAGE_VALID \</span>
<span class="cp">				 | SUN3_PAGE_ACCESSED \</span>
<span class="cp">				 | SUN3_PAGE_NOCACHE)</span>
<span class="cp">#define PAGE_KERNEL	__pgprot(SUN3_PAGE_VALID \</span>
<span class="cp">				 | SUN3_PAGE_WRITEABLE \</span>
<span class="cp">				 | SUN3_PAGE_SYSTEM \</span>
<span class="cp">				 | SUN3_PAGE_NOCACHE \</span>
<span class="cp">				 | SUN3_PAGE_ACCESSED \</span>
<span class="cp">				 | SUN3_PAGE_MODIFIED)</span>
<span class="cp">#define PAGE_INIT	__pgprot(SUN3_PAGE_VALID \</span>
<span class="cp">				 | SUN3_PAGE_WRITEABLE \</span>
<span class="cp">				 | SUN3_PAGE_SYSTEM \</span>
<span class="cp">				 | SUN3_PAGE_NOCACHE)</span>

<span class="cm">/*</span>
<span class="cm"> * Page protections for initialising protection_map. The sun3 has only two</span>
<span class="cm"> * protection settings, valid (implying read and execute) and writeable. These</span>
<span class="cm"> * are as close as we can get...</span>
<span class="cm"> */</span>
<span class="cp">#define __P000	PAGE_NONE</span>
<span class="cp">#define __P001	PAGE_READONLY</span>
<span class="cp">#define __P010	PAGE_COPY</span>
<span class="cp">#define __P011	PAGE_COPY</span>
<span class="cp">#define __P100	PAGE_READONLY</span>
<span class="cp">#define __P101	PAGE_READONLY</span>
<span class="cp">#define __P110	PAGE_COPY</span>
<span class="cp">#define __P111	PAGE_COPY</span>

<span class="cp">#define __S000	PAGE_NONE</span>
<span class="cp">#define __S001	PAGE_READONLY</span>
<span class="cp">#define __S010	PAGE_SHARED</span>
<span class="cp">#define __S011	PAGE_SHARED</span>
<span class="cp">#define __S100	PAGE_READONLY</span>
<span class="cp">#define __S101	PAGE_READONLY</span>
<span class="cp">#define __S110	PAGE_SHARED</span>
<span class="cp">#define __S111	PAGE_SHARED</span>

<span class="cm">/* Use these fake page-protections on PMDs. */</span>
<span class="cp">#define SUN3_PMD_VALID	(0x00000001)</span>
<span class="cp">#define SUN3_PMD_MASK	(0x0000003F)</span>
<span class="cp">#define SUN3_PMD_MAGIC	(0x0000002B)</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cm">/*</span>
<span class="cm"> * Conversion functions: convert a page and protection to a page entry,</span>
<span class="cm"> * and a page entry and page directory to the page they refer to.</span>
<span class="cm"> */</span>
<span class="cp">#define mk_pte(page, pgprot) pfn_pte(page_to_pfn(page), (pgprot))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pte_modify</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">,</span> <span class="n">pgprot_t</span> <span class="n">newprot</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SUN3_PAGE_CHG_MASK</span><span class="p">)</span> <span class="o">|</span> <span class="n">pgprot_val</span><span class="p">(</span><span class="n">newprot</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">pte</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define pmd_set(pmdp,ptep) do {} while (0)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">pgd_set</span><span class="p">(</span><span class="n">pgd_t</span> <span class="o">*</span><span class="n">pgdp</span><span class="p">,</span> <span class="n">pmd_t</span> <span class="o">*</span><span class="n">pmdp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pgd_val</span><span class="p">(</span><span class="o">*</span><span class="n">pgdp</span><span class="p">)</span> <span class="o">=</span> <span class="n">virt_to_phys</span><span class="p">(</span><span class="n">pmdp</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define __pte_page(pte) \</span>
<span class="cp">((unsigned long) __va ((pte_val (pte) &amp; SUN3_PAGE_PGNUM_MASK) &lt;&lt; PAGE_SHIFT))</span>
<span class="cp">#define __pmd_page(pmd) \</span>
<span class="cp">((unsigned long) __va (pmd_val (pmd) &amp; PAGE_MASK))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pte_none</span> <span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="n">pte_val</span> <span class="p">(</span><span class="n">pte</span><span class="p">);</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pte_present</span> <span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pte_val</span> <span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SUN3_PAGE_VALID</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">pte_clear</span> <span class="p">(</span><span class="k">struct</span> <span class="n">mm_struct</span> <span class="o">*</span><span class="n">mm</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span> <span class="n">pte_t</span> <span class="o">*</span><span class="n">ptep</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pte_val</span> <span class="p">(</span><span class="o">*</span><span class="n">ptep</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define pte_pfn(pte)            (pte_val(pte) &amp; SUN3_PAGE_PGNUM_MASK)</span>
<span class="cp">#define pfn_pte(pfn, pgprot) \</span>
<span class="cp">({ pte_t __pte; pte_val(__pte) = pfn | pgprot_val(pgprot); __pte; })</span>

<span class="cp">#define pte_page(pte)		virt_to_page(__pte_page(pte))</span>
<span class="cp">#define pmd_page(pmd)		virt_to_page(__pmd_page(pmd))</span>


<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pmd_none2</span> <span class="p">(</span><span class="n">pmd_t</span> <span class="o">*</span><span class="n">pmd</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="n">pmd_val</span> <span class="p">(</span><span class="o">*</span><span class="n">pmd</span><span class="p">);</span> <span class="p">}</span>
<span class="cp">#define pmd_none(pmd) pmd_none2(&amp;(pmd))</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>static inline int pmd<em>bad (pmd</em>t pmd) { return (pmd<em>val (pmd) &amp; SUN3</em>PMD<em>MASK) != SUN3</em>PMD_MAGIC; }</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pmd_bad2</span> <span class="p">(</span><span class="n">pmd_t</span> <span class="o">*</span><span class="n">pmd</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="cp">#define pmd_bad(pmd) pmd_bad2(&amp;(pmd))</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pmd_present2</span> <span class="p">(</span><span class="n">pmd_t</span> <span class="o">*</span><span class="n">pmd</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">pmd_val</span> <span class="p">(</span><span class="o">*</span><span class="n">pmd</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SUN3_PMD_VALID</span><span class="p">;</span> <span class="p">}</span>
<span class="cm">/* #define pmd_present(pmd) pmd_present2(&amp;(pmd)) */</span>
<span class="cp">#define pmd_present(pmd) (!pmd_none2(&amp;(pmd)))</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">pmd_clear</span> <span class="p">(</span><span class="n">pmd_t</span> <span class="o">*</span><span class="n">pmdp</span><span class="p">)</span> <span class="p">{</span> <span class="n">pmd_val</span> <span class="p">(</span><span class="o">*</span><span class="n">pmdp</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pgd_none</span> <span class="p">(</span><span class="n">pgd_t</span> <span class="n">pgd</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pgd_bad</span> <span class="p">(</span><span class="n">pgd_t</span> <span class="n">pgd</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pgd_present</span> <span class="p">(</span><span class="n">pgd_t</span> <span class="n">pgd</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">pgd_clear</span> <span class="p">(</span><span class="n">pgd_t</span> <span class="o">*</span><span class="n">pgdp</span><span class="p">)</span> <span class="p">{}</span>


<span class="cp">#define pte_ERROR(e) \</span>
<span class="cp">	printk(&quot;%s:%d: bad pte %08lx.\n&quot;, __FILE__, __LINE__, pte_val(e))</span>
<span class="cp">#define pmd_ERROR(e) \</span>
<span class="cp">	printk(&quot;%s:%d: bad pmd %08lx.\n&quot;, __FILE__, __LINE__, pmd_val(e))</span>
<span class="cp">#define pgd_ERROR(e) \</span>
<span class="cp">	printk(&quot;%s:%d: bad pgd %08lx.\n&quot;, __FILE__, __LINE__, pgd_val(e))</span>


<span class="cm">/*</span>
<span class="cm"> * The following only work if pte_present() is true.</span>
<span class="cm"> * Undefined behaviour if not...</span>
<span class="cm"> * [we have the full set here even if they don&#39;t change from m68k]</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pte_write</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>		<span class="p">{</span> <span class="k">return</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SUN3_PAGE_WRITEABLE</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pte_dirty</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>		<span class="p">{</span> <span class="k">return</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SUN3_PAGE_MODIFIED</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pte_young</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>		<span class="p">{</span> <span class="k">return</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SUN3_PAGE_ACCESSED</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pte_file</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>		<span class="p">{</span> <span class="k">return</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">SUN3_PAGE_ACCESSED</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">pte_special</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>	<span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pte_wrprotect</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>	<span class="p">{</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SUN3_PAGE_WRITEABLE</span><span class="p">;</span> <span class="k">return</span> <span class="n">pte</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pte_mkclean</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>	<span class="p">{</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SUN3_PAGE_MODIFIED</span><span class="p">;</span> <span class="k">return</span> <span class="n">pte</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pte_mkold</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>	<span class="p">{</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SUN3_PAGE_ACCESSED</span><span class="p">;</span> <span class="k">return</span> <span class="n">pte</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pte_mkwrite</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>	<span class="p">{</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">|=</span> <span class="n">SUN3_PAGE_WRITEABLE</span><span class="p">;</span> <span class="k">return</span> <span class="n">pte</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pte_mkdirty</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>	<span class="p">{</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">|=</span> <span class="n">SUN3_PAGE_MODIFIED</span><span class="p">;</span> <span class="k">return</span> <span class="n">pte</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pte_mkyoung</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>	<span class="p">{</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">|=</span> <span class="n">SUN3_PAGE_ACCESSED</span><span class="p">;</span> <span class="k">return</span> <span class="n">pte</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pte_mknocache</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>	<span class="p">{</span> <span class="n">pte_val</span><span class="p">(</span><span class="n">pte</span><span class="p">)</span> <span class="o">|=</span> <span class="n">SUN3_PAGE_NOCACHE</span><span class="p">;</span> <span class="k">return</span> <span class="n">pte</span><span class="p">;</span> <span class="p">}</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>use this version when caches work...
static inline pte<em>t pte</em>mkcache(pte<em>t pte)    { pte</em>val(pte) &amp;= SUN3<em>PAGE</em>NOCACHE; return pte; }
until then, use:</p></td><td class="code"><div class="highlight"><pre><span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pte_mkcache</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>	<span class="p">{</span> <span class="k">return</span> <span class="n">pte</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pte_mkspecial</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>	<span class="p">{</span> <span class="k">return</span> <span class="n">pte</span><span class="p">;</span> <span class="p">}</span>

<span class="k">extern</span> <span class="n">pgd_t</span> <span class="n">swapper_pg_dir</span><span class="p">[</span><span class="n">PTRS_PER_PGD</span><span class="p">];</span>
<span class="k">extern</span> <span class="n">pgd_t</span> <span class="n">kernel_pg_dir</span><span class="p">[</span><span class="n">PTRS_PER_PGD</span><span class="p">];</span>

<span class="cm">/* Find an entry in a pagetable directory. */</span>
<span class="cp">#define pgd_index(address)     ((address) &gt;&gt; PGDIR_SHIFT)</span>

<span class="cp">#define pgd_offset(mm, address) \</span>
<span class="cp">((mm)-&gt;pgd + pgd_index(address))</span>

<span class="cm">/* Find an entry in a kernel pagetable directory. */</span>
<span class="cp">#define pgd_offset_k(address) pgd_offset(&amp;init_mm, address)</span>

<span class="cm">/* Find an entry in the second-level pagetable. */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">pmd_t</span> <span class="o">*</span><span class="nf">pmd_offset</span> <span class="p">(</span><span class="n">pgd_t</span> <span class="o">*</span><span class="n">pgd</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">pmd_t</span> <span class="o">*</span><span class="p">)</span> <span class="n">pgd</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">pte_to_pgoff</span><span class="p">(</span><span class="n">pte_t</span> <span class="n">pte</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">pte</span><span class="p">.</span><span class="n">pte</span> <span class="o">&amp;</span> <span class="n">SUN3_PAGE_PGNUM_MASK</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">pte_t</span> <span class="nf">pgoff_to_pte</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">off</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pte_t</span> <span class="n">pte</span> <span class="o">=</span> <span class="p">{</span> <span class="n">off</span> <span class="o">+</span> <span class="n">SUN3_PAGE_ACCESSED</span> <span class="p">};</span>
	<span class="k">return</span> <span class="n">pte</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Find an entry in the third-level pagetable. */</span>
<span class="cp">#define pte_index(address) ((address &gt;&gt; PAGE_SHIFT) &amp; (PTRS_PER_PTE-1))</span>
<span class="cp">#define pte_offset_kernel(pmd, address) ((pte_t *) __pmd_page(*pmd) + pte_index(address))</span>
<span class="cp">#define pte_offset_map(pmd, address) ((pte_t *)page_address(pmd_page(*pmd)) + pte_index(address))</span>
<span class="cp">#define pte_unmap(pte) do { } while (0)</span>

<span class="cm">/* Macros to (de)construct the fake PTEs representing swap pages. */</span>
<span class="cp">#define __swp_type(x)		((x).val &amp; 0x7F)</span>
<span class="cp">#define __swp_offset(x)		(((x).val) &gt;&gt; 7)</span>
<span class="cp">#define __swp_entry(type,offset) ((swp_entry_t) { ((type) | ((offset) &lt;&lt; 7)) })</span>
<span class="cp">#define __pte_to_swp_entry(pte)	((swp_entry_t) { pte_val(pte) })</span>
<span class="cp">#define __swp_entry_to_pte(x)	((pte_t) { (x).val })</span>

<span class="cp">#endif	</span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>
<span class="cp">#endif	</span><span class="cm">/* !_SUN3_PGTABLE_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
