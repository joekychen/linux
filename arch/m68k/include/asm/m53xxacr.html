<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › m68k › include › asm › m53xxacr.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>m53xxacr.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/****************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> * m53xxacr.h -- ColdFire version 3 core cache support</span>
<span class="cm"> *</span>
<span class="cm"> * (C) Copyright 2010, Greg Ungerer &lt;gerg@snapgear.com&gt;</span>
<span class="cm"> */</span>

<span class="cm">/****************************************************************************/</span>
<span class="cp">#ifndef m53xxacr_h</span>
<span class="cp">#define m53xxacr_h</span>
<span class="cm">/****************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> * All varients of the ColdFire using version 3 cores have a similar</span>
<span class="cm"> * cache setup. They have a unified instruction and data cache, with</span>
<span class="cm"> * configurable write-through or copy-back operation.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Define the Cache Control register flags.</span>
<span class="cm"> */</span>
<span class="cp">#define CACR_EC		0x80000000	</span><span class="cm">/* Enable cache */</span><span class="cp"></span>
<span class="cp">#define CACR_ESB	0x20000000	</span><span class="cm">/* Enable store buffer */</span><span class="cp"></span>
<span class="cp">#define CACR_DPI	0x10000000	</span><span class="cm">/* Disable invalidation by CPUSHL */</span><span class="cp"></span>
<span class="cp">#define CACR_HLCK	0x08000000	</span><span class="cm">/* Half cache lock mode */</span><span class="cp"></span>
<span class="cp">#define CACR_CINVA	0x01000000	</span><span class="cm">/* Invalidate cache */</span><span class="cp"></span>
<span class="cp">#define CACR_DNFB	0x00000400	</span><span class="cm">/* Inhibited fill buffer */</span><span class="cp"></span>
<span class="cp">#define CACR_DCM_WT	0x00000000	</span><span class="cm">/* Cacheable write-through */</span><span class="cp"></span>
<span class="cp">#define CACR_DCM_CB	0x00000100	</span><span class="cm">/* Cacheable copy-back */</span><span class="cp"></span>
<span class="cp">#define CACR_DCM_PRE	0x00000200	</span><span class="cm">/* Cache inhibited, precise */</span><span class="cp"></span>
<span class="cp">#define CACR_DCM_IMPRE	0x00000300	</span><span class="cm">/* Cache inhibited, imprecise */</span><span class="cp"></span>
<span class="cp">#define CACR_WPROTECT	0x00000020	</span><span class="cm">/* Write protect*/</span><span class="cp"></span>
<span class="cp">#define CACR_EUSP	0x00000010	</span><span class="cm">/* Eanble separate user a7 */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Define the Access Control register flags.</span>
<span class="cm"> */</span>
<span class="cp">#define ACR_BASE_POS	24		</span><span class="cm">/* Address Base (upper 8 bits) */</span><span class="cp"></span>
<span class="cp">#define ACR_MASK_POS	16		</span><span class="cm">/* Address Mask (next 8 bits) */</span><span class="cp"></span>
<span class="cp">#define ACR_ENABLE	0x00008000	</span><span class="cm">/* Enable this ACR */</span><span class="cp"></span>
<span class="cp">#define ACR_USER	0x00000000	</span><span class="cm">/* Allow only user accesses */</span><span class="cp"></span>
<span class="cp">#define ACR_SUPER	0x00002000	</span><span class="cm">/* Allow supervisor access only */</span><span class="cp"></span>
<span class="cp">#define ACR_ANY		0x00004000	</span><span class="cm">/* Allow any access type */</span><span class="cp"></span>
<span class="cp">#define ACR_CM_WT	0x00000000	</span><span class="cm">/* Cacheable, write-through */</span><span class="cp"></span>
<span class="cp">#define ACR_CM_CB	0x00000020	</span><span class="cm">/* Cacheable, copy-back */</span><span class="cp"></span>
<span class="cp">#define ACR_CM_PRE	0x00000040	</span><span class="cm">/* Cache inhibited, precise */</span><span class="cp"></span>
<span class="cp">#define ACR_CM_IMPRE	0x00000060	</span><span class="cm">/* Cache inhibited, imprecise */</span><span class="cp"></span>
<span class="cp">#define ACR_WPROTECT	0x00000004	</span><span class="cm">/* Write protect region */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Define the cache type and arrangement (needed for pushes).</span>
<span class="cm"> */</span>
<span class="cp">#if defined(CONFIG_M5307)</span>
<span class="cp">#define	CACHE_SIZE	0x2000		</span><span class="cm">/* 8k of unified cache */</span><span class="cp"></span>
<span class="cp">#define	ICACHE_SIZE	CACHE_SIZE</span>
<span class="cp">#define	DCACHE_SIZE	CACHE_SIZE</span>
<span class="cp">#elif defined(CONFIG_M532x)</span>
<span class="cp">#define	CACHE_SIZE	0x4000		</span><span class="cm">/* 32k of unified cache */</span><span class="cp"></span>
<span class="cp">#define	ICACHE_SIZE	CACHE_SIZE</span>
<span class="cp">#define	DCACHE_SIZE	CACHE_SIZE</span>
<span class="cp">#endif</span>

<span class="cp">#define	CACHE_LINE_SIZE	16		</span><span class="cm">/* 16 byte line size */</span><span class="cp"></span>
<span class="cp">#define	CACHE_WAYS	4		</span><span class="cm">/* 4 ways - set associative */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Set the cache controller settings we will use. This default in the</span>
<span class="cm"> * CACR is cache inhibited, we use the ACR register to set cacheing</span>
<span class="cm"> * enabled on the regions we want (eg RAM).</span>
<span class="cm"> */</span>
<span class="cp">#if defined(CONFIG_CACHE_COPYBACK)</span>
<span class="cp">#define CACHE_TYPE	ACR_CM_CB</span>
<span class="cp">#define CACHE_PUSH</span>
<span class="cp">#else</span>
<span class="cp">#define CACHE_TYPE	ACR_CM_WT</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef CONFIG_COLDFIRE_SW_A7</span>
<span class="cp">#define CACHE_MODE	(CACR_EC + CACR_ESB + CACR_DCM_PRE)</span>
<span class="cp">#else</span>
<span class="cp">#define CACHE_MODE	(CACR_EC + CACR_ESB + CACR_DCM_PRE + CACR_EUSP)</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Unified cache means we will never need to flush for coherency of</span>
<span class="cm"> * instruction fetch. We will need to flush to maintain memory/DMA</span>
<span class="cm"> * coherency though in all cases. And for copyback caches we will need</span>
<span class="cm"> * to push cached data as well.</span>
<span class="cm"> */</span>
<span class="cp">#define CACHE_INIT	  CACR_CINVA</span>
<span class="cp">#define CACHE_INVALIDATE  CACR_CINVA</span>
<span class="cp">#define CACHE_INVALIDATED CACR_CINVA</span>

<span class="cp">#define ACR0_MODE	((CONFIG_RAMBASE &amp; 0xff000000) + \</span>
<span class="cp">			 (0x000f0000) + \</span>
<span class="cp">			 (ACR_ENABLE + ACR_ANY + CACHE_TYPE))</span>
<span class="cp">#define ACR1_MODE	0</span>

<span class="cm">/****************************************************************************/</span>
<span class="cp">#endif  </span><span class="cm">/* m53xxsim_h */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
