<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › m68k › include › asm › m54xxacr.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>m54xxacr.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Bit definitions for the MCF54xx ACR and CACR registers.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef	m54xxacr_h</span>
<span class="cp">#define m54xxacr_h</span>

<span class="cm">/*</span>
<span class="cm"> *	Define the Cache register flags.</span>
<span class="cm"> */</span>
<span class="cp">#define CACR_DEC	0x80000000	</span><span class="cm">/* Enable data cache */</span><span class="cp"></span>
<span class="cp">#define CACR_DWP	0x40000000	</span><span class="cm">/* Data write protection */</span><span class="cp"></span>
<span class="cp">#define CACR_DESB	0x20000000	</span><span class="cm">/* Enable data store buffer */</span><span class="cp"></span>
<span class="cp">#define CACR_DDPI	0x10000000	</span><span class="cm">/* Disable invalidation by CPUSHL */</span><span class="cp"></span>
<span class="cp">#define CACR_DHCLK	0x08000000	</span><span class="cm">/* Half data cache lock mode */</span><span class="cp"></span>
<span class="cp">#define CACR_DDCM_WT	0x00000000	</span><span class="cm">/* Write through cache*/</span><span class="cp"></span>
<span class="cp">#define CACR_DDCM_CP	0x02000000	</span><span class="cm">/* Copyback cache */</span><span class="cp"></span>
<span class="cp">#define CACR_DDCM_P	0x04000000	</span><span class="cm">/* No cache, precise */</span><span class="cp"></span>
<span class="cp">#define CACR_DDCM_IMP	0x06000000	</span><span class="cm">/* No cache, imprecise */</span><span class="cp"></span>
<span class="cp">#define CACR_DCINVA	0x01000000	</span><span class="cm">/* Invalidate data cache */</span><span class="cp"></span>
<span class="cp">#define CACR_BEC	0x00080000	</span><span class="cm">/* Enable branch cache */</span><span class="cp"></span>
<span class="cp">#define CACR_BCINVA	0x00040000	</span><span class="cm">/* Invalidate branch cache */</span><span class="cp"></span>
<span class="cp">#define CACR_IEC	0x00008000	</span><span class="cm">/* Enable instruction cache */</span><span class="cp"></span>
<span class="cp">#define CACR_DNFB	0x00002000	</span><span class="cm">/* Inhibited fill buffer */</span><span class="cp"></span>
<span class="cp">#define CACR_IDPI	0x00001000	</span><span class="cm">/* Disable CPUSHL */</span><span class="cp"></span>
<span class="cp">#define CACR_IHLCK	0x00000800	</span><span class="cm">/* Intruction cache half lock */</span><span class="cp"></span>
<span class="cp">#define CACR_IDCM	0x00000400	</span><span class="cm">/* Intruction cache inhibit */</span><span class="cp"></span>
<span class="cp">#define CACR_ICINVA	0x00000100	</span><span class="cm">/* Invalidate instr cache */</span><span class="cp"></span>
<span class="cp">#define CACR_EUSP	0x00000020	</span><span class="cm">/* Enable separate user a7 */</span><span class="cp"></span>

<span class="cp">#define ACR_BASE_POS	24		</span><span class="cm">/* Address Base */</span><span class="cp"></span>
<span class="cp">#define ACR_MASK_POS	16		</span><span class="cm">/* Address Mask */</span><span class="cp"></span>
<span class="cp">#define ACR_ENABLE	0x00008000	</span><span class="cm">/* Enable address */</span><span class="cp"></span>
<span class="cp">#define ACR_USER	0x00000000	</span><span class="cm">/* User mode access only */</span><span class="cp"></span>
<span class="cp">#define ACR_SUPER	0x00002000	</span><span class="cm">/* Supervisor mode only */</span><span class="cp"></span>
<span class="cp">#define ACR_ANY		0x00004000	</span><span class="cm">/* Match any access mode */</span><span class="cp"></span>
<span class="cp">#define ACR_CM_WT	0x00000000	</span><span class="cm">/* Write through mode */</span><span class="cp"></span>
<span class="cp">#define ACR_CM_CP	0x00000020	</span><span class="cm">/* Copyback mode */</span><span class="cp"></span>
<span class="cp">#define ACR_CM_OFF_PRE	0x00000040	</span><span class="cm">/* No cache, precise */</span><span class="cp"></span>
<span class="cp">#define ACR_CM_OFF_IMP	0x00000060	</span><span class="cm">/* No cache, imprecise */</span><span class="cp"></span>
<span class="cp">#define ACR_CM		0x00000060	</span><span class="cm">/* Cache mode mask */</span><span class="cp"></span>
<span class="cp">#define ACR_SP		0x00000008	</span><span class="cm">/* Supervisor protect */</span><span class="cp"></span>
<span class="cp">#define ACR_WPROTECT	0x00000004	</span><span class="cm">/* Write protect */</span><span class="cp"></span>

<span class="cp">#define ACR_BA(x)	((x) &amp; 0xff000000)</span>
<span class="cp">#define ACR_ADMSK(x)	((((x) - 1) &amp; 0xff000000) &gt;&gt; 8)</span>

<span class="cp">#if defined(CONFIG_M5407)</span>

<span class="cp">#define ICACHE_SIZE 0x4000	</span><span class="cm">/* instruction - 16k */</span><span class="cp"></span>
<span class="cp">#define DCACHE_SIZE 0x2000	</span><span class="cm">/* data - 8k */</span><span class="cp"></span>

<span class="cp">#elif defined(CONFIG_M54xx)</span>

<span class="cp">#define ICACHE_SIZE 0x8000	</span><span class="cm">/* instruction - 32k */</span><span class="cp"></span>
<span class="cp">#define DCACHE_SIZE 0x8000	</span><span class="cm">/* data - 32k */</span><span class="cp"></span>

<span class="cp">#endif</span>

<span class="cp">#define CACHE_LINE_SIZE 0x0010	</span><span class="cm">/* 16 bytes */</span><span class="cp"></span>
<span class="cp">#define CACHE_WAYS 4		</span><span class="cm">/* 4 ways */</span><span class="cp"></span>

<span class="cp">#define ICACHE_SET_MASK	((ICACHE_SIZE / 64 - 1) &lt;&lt; CACHE_WAYS)</span>
<span class="cp">#define DCACHE_SET_MASK	((DCACHE_SIZE / 64 - 1) &lt;&lt; CACHE_WAYS)</span>
<span class="cp">#define ICACHE_MAX_ADDR	ICACHE_SET_MASK</span>
<span class="cp">#define DCACHE_MAX_ADDR	DCACHE_SET_MASK</span>

<span class="cm">/*</span>
<span class="cm"> *	Version 4 cores have a true harvard style separate instruction</span>
<span class="cm"> *	and data cache. Enable data and instruction caches, also enable write</span>
<span class="cm"> *	buffers and branch accelerator.</span>
<span class="cm"> */</span>
<span class="cm">/* attention : enabling CACR_DESB requires a &quot;nop&quot; to flush the store buffer */</span>
<span class="cm">/* use &#39;+&#39; instead of &#39;|&#39; for assembler&#39;s sake */</span>

	<span class="cm">/* Enable data cache */</span>
	<span class="cm">/* Enable data store buffer */</span>
	<span class="cm">/* outside ACRs : No cache, precise */</span>
	<span class="cm">/* Enable instruction+branch caches */</span>
<span class="cp">#if defined(CONFIG_M5407)</span>
<span class="cp">#define CACHE_MODE (CACR_DEC+CACR_DESB+CACR_DDCM_P+CACR_BEC+CACR_IEC)</span>
<span class="cp">#else</span>
<span class="cp">#define CACHE_MODE (CACR_DEC+CACR_DESB+CACR_DDCM_P+CACR_BEC+CACR_IEC+CACR_EUSP)</span>
<span class="cp">#endif</span>
<span class="cp">#define CACHE_INIT (CACR_DCINVA+CACR_BCINVA+CACR_ICINVA)</span>

<span class="cp">#if defined(CONFIG_MMU)</span>
<span class="cm">/*</span>
<span class="cm"> *	If running with the MMU enabled then we need to map the internal</span>
<span class="cm"> *	register region as non-cacheable. And then we map all our RAM as</span>
<span class="cm"> *	cacheable and supervisor access only.</span>
<span class="cm"> */</span>
<span class="cp">#define ACR0_MODE	(ACR_BA(CONFIG_MBAR)+ACR_ADMSK(0x1000000)+ \</span>
<span class="cp">			 ACR_ENABLE+ACR_SUPER+ACR_CM_OFF_PRE+ACR_SP)</span>
<span class="cp">#define ACR1_MODE	(ACR_BA(CONFIG_RAMBASE)+ACR_ADMSK(CONFIG_RAMSIZE)+ \</span>
<span class="cp">			 ACR_ENABLE+ACR_SUPER+ACR_SP)</span>
<span class="cp">#define ACR2_MODE	0</span>
<span class="cp">#define ACR3_MODE	(ACR_BA(CONFIG_RAMBASE)+ACR_ADMSK(CONFIG_RAMSIZE)+ \</span>
<span class="cp">			 ACR_ENABLE+ACR_SUPER+ACR_SP)</span>

<span class="cp">#else</span>

<span class="cm">/*</span>
<span class="cm"> *	For the non-MMU enabled case we map all of RAM as cacheable.</span>
<span class="cm"> */</span>
<span class="cp">#if defined(CONFIG_CACHE_COPYBACK)</span>
<span class="cp">#define DATA_CACHE_MODE (ACR_ENABLE+ACR_ANY+ACR_CM_CP)</span>
<span class="cp">#else</span>
<span class="cp">#define DATA_CACHE_MODE (ACR_ENABLE+ACR_ANY+ACR_CM_WT)</span>
<span class="cp">#endif</span>
<span class="cp">#define INSN_CACHE_MODE (ACR_ENABLE+ACR_ANY)</span>

<span class="cp">#define CACHE_INVALIDATE  (CACHE_MODE+CACR_DCINVA+CACR_BCINVA+CACR_ICINVA)</span>
<span class="cp">#define CACHE_INVALIDATEI (CACHE_MODE+CACR_BCINVA+CACR_ICINVA)</span>
<span class="cp">#define CACHE_INVALIDATED (CACHE_MODE+CACR_DCINVA)</span>
<span class="cp">#define ACR0_MODE	(0x000f0000+DATA_CACHE_MODE)</span>
<span class="cp">#define ACR1_MODE	0</span>
<span class="cp">#define ACR2_MODE	(0x000f0000+INSN_CACHE_MODE)</span>
<span class="cp">#define ACR3_MODE	0</span>

<span class="cp">#if ((DATA_CACHE_MODE &amp; ACR_CM) == ACR_CM_CP)</span>
<span class="cm">/* Copyback cache mode must push dirty cache lines first */</span>
<span class="cp">#define	CACHE_PUSH</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_MMU */</span><span class="cp"></span>
<span class="cp">#endif	</span><span class="cm">/* m54xxacr_h */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
