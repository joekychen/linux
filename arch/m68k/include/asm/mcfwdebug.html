<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › m68k › include › asm › mcfwdebug.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>mcfwdebug.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/****************************************************************************/</span>

<span class="cm">/*</span>
<span class="cm"> *	mcfdebug.h -- ColdFire Debug Module support.</span>
<span class="cm"> *</span>
<span class="cm"> * 	(C) Copyright 2001, Lineo Inc. (www.lineo.com) </span>
<span class="cm"> */</span>

<span class="cm">/****************************************************************************/</span>
<span class="cp">#ifndef mcfdebug_h</span>
<span class="cp">#define mcfdebug_h</span>
<span class="cm">/****************************************************************************/</span>

<span class="cm">/* Define the debug module registers */</span>
<span class="cp">#define MCFDEBUG_CSR	0x0			</span><span class="cm">/* Configuration status		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_BAAR	0x5			</span><span class="cm">/* BDM address attribute	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_AATR	0x6			</span><span class="cm">/* Address attribute trigger	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR	0x7			</span><span class="cm">/* Trigger definition		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_PBR	0x8			</span><span class="cm">/* PC breakpoint		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_PBMR	0x9			</span><span class="cm">/* PC breakpoint mask		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_ABHR	0xc			</span><span class="cm">/* High address breakpoint	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_ABLR	0xd			</span><span class="cm">/* Low address breakpoint	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_DBR	0xe			</span><span class="cm">/* Data breakpoint		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_DBMR	0xf			</span><span class="cm">/* Data breakpoint mask		*/</span><span class="cp"></span>

<span class="cm">/* Define some handy constants for the trigger definition register */</span>
<span class="cp">#define MCFDEBUG_TDR_TRC_DISP	0x00000000	</span><span class="cm">/* display on DDATA only	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_TRC_HALT	0x40000000	</span><span class="cm">/* Processor halt on BP		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_TRC_INTR	0x80000000	</span><span class="cm">/* Debug intr on BP		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_LXT1	0x00004000	</span><span class="cm">/* TDR level 1			*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_LXT2	0x00008000	</span><span class="cm">/* TDR level 2			*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EBL1	0x00002000	</span><span class="cm">/* Enable breakpoint level 1	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EBL2	0x20000000	</span><span class="cm">/* Enable breakpoint level 2	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EDLW1	0x00001000	</span><span class="cm">/* Enable data BP longword	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EDLW2	0x10000000</span>
<span class="cp">#define MCFDEBUG_TDR_EDWL1	0x00000800	</span><span class="cm">/* Enable data BP lower word	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EDWL2	0x08000000</span>
<span class="cp">#define MCFDEBUG_TDR_EDWU1	0x00000400	</span><span class="cm">/* Enable data BP upper word	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EDWU2	0x04000000</span>
<span class="cp">#define MCFDEBUG_TDR_EDLL1	0x00000200	</span><span class="cm">/* Enable data BP low low byte	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EDLL2	0x02000000</span>
<span class="cp">#define MCFDEBUG_TDR_EDLM1	0x00000100	</span><span class="cm">/* Enable data BP low mid byte	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EDLM2	0x01000000</span>
<span class="cp">#define MCFDEBUG_TDR_EDUM1	0x00000080	</span><span class="cm">/* Enable data BP up mid byte	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EDUM2	0x00800000</span>
<span class="cp">#define MCFDEBUG_TDR_EDUU1	0x00000040	</span><span class="cm">/* Enable data BP up up byte	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EDUU2	0x00400000</span>
<span class="cp">#define MCFDEBUG_TDR_DI1	0x00000020	</span><span class="cm">/* Data BP invert		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_DI2	0x00200000</span>
<span class="cp">#define MCFDEBUG_TDR_EAI1	0x00000010	</span><span class="cm">/* Enable address BP inverted	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EAI2	0x00100000</span>
<span class="cp">#define MCFDEBUG_TDR_EAR1	0x00000008	</span><span class="cm">/* Enable address BP range	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EAR2	0x00080000</span>
<span class="cp">#define MCFDEBUG_TDR_EAL1	0x00000004	</span><span class="cm">/* Enable address BP low	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EAL2	0x00040000</span>
<span class="cp">#define MCFDEBUG_TDR_EPC1	0x00000002	</span><span class="cm">/* Enable PC BP			*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_EPC2	0x00020000</span>
<span class="cp">#define MCFDEBUG_TDR_PCI1	0x00000001	</span><span class="cm">/* PC BP invert			*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_TDR_PCI2	0x00010000</span>

<span class="cm">/* Constants for the address attribute trigger register */</span>
<span class="cp">#define MCFDEBUG_AAR_RESET	0x00000005</span>
<span class="cm">/* Fields not yet implemented */</span>

<span class="cm">/* And some definitions for the writable sections of the CSR */</span>
<span class="cp">#define MCFDEBUG_CSR_RESET	0x00100000</span>
<span class="cp">#define MCFDEBUG_CSR_PSTCLK	0x00020000	</span><span class="cm">/* PSTCLK disable		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_IPW	0x00010000	</span><span class="cm">/* Inhibit processor writes	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_MAP	0x00008000	</span><span class="cm">/* Processor refs in emul mode	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_TRC	0x00004000	</span><span class="cm">/* Emul mode on trace exception	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_EMU	0x00002000	</span><span class="cm">/* Force emulation mode		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_DDC_READ	0x00000800	</span><span class="cm">/* Debug data control		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_DDC_WRITE	0x00001000</span>
<span class="cp">#define MCFDEBUG_CSR_UHE	0x00000400	</span><span class="cm">/* User mode halt enable	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_BTB0	0x00000000	</span><span class="cm">/* Branch target 0 bytes	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_BTB2	0x00000100	</span><span class="cm">/* Branch target 2 bytes	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_BTB3	0x00000200	</span><span class="cm">/* Branch target 3 bytes	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_BTB4	0x00000300	</span><span class="cm">/* Branch target 4 bytes	*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_NPL	0x00000040	</span><span class="cm">/* Non-pipelined mode		*/</span><span class="cp"></span>
<span class="cp">#define MCFDEBUG_CSR_SSM	0x00000010	</span><span class="cm">/* Single step mode		*/</span><span class="cp"></span>

<span class="cm">/* Constants for the BDM address attribute register */</span>
<span class="cp">#define MCFDEBUG_BAAR_RESET	0x00000005</span>
<span class="cm">/* Fields not yet implemented */</span>


<span class="cm">/* This routine wrappers up the wdebug asm instruction so that the register</span>
<span class="cm"> * and value can be relatively easily specified.  The biggest hassle here is</span>
<span class="cm"> * that the debug module instructions (2 longs) must be long word aligned and</span>
<span class="cm"> * some pointer fiddling is performed to ensure this.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">wdebug</span><span class="p">(</span><span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data</span><span class="p">)</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">dbg_spc</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">dbg</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>Force alignment to long word boundary</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dbg</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="p">)((((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">dbg_spc</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xfffffffc</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Build up the debug instruction</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dbg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2c80</span> <span class="o">|</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
	<span class="n">dbg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="n">dbg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="n">dbg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Perform the wdebug instruction</p></td><td class="code"><div class="highlight"><pre><span class="cp">#if 0</span><span class="c"></span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>This strain is for gas which doesn't have the wdebug instructions defined</p></td><td class="code"><div class="highlight"><pre><span class="c">	asm(	&quot;move.l	%0, %%a0\n\t&quot;</span>
<span class="c">		&quot;.word	0xfbd0\n\t&quot;</span>
<span class="c">		&quot;.word	0x0003\n\t&quot;</span>
<span class="c">	    :: &quot;g&quot; (dbg) : &quot;a0&quot;);</span>
<span class="cp">#else</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>And this is for when it does</p></td><td class="code"><div class="highlight"><pre>	<span class="n">asm</span><span class="p">(</span>	<span class="s">&quot;wdebug	(%0)&quot;</span> <span class="o">::</span> <span class="s">&quot;a&quot;</span> <span class="p">(</span><span class="n">dbg</span><span class="p">));</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
