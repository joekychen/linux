<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › m68k › include › asm › mac_via.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>mac_via.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *	6522 Versatile Interface Adapter (VIA)</span>
<span class="cm"> *</span>
<span class="cm"> *	There are two of these on the Mac II. Some IRQ&#39;s are vectored</span>
<span class="cm"> *	via them as are assorted bits and bobs - eg rtc, adb. The picture</span>
<span class="cm"> *	is a bit incomplete as the Mac documentation doesn&#39;t cover this well</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _ASM_MAC_VIA_H_</span>
<span class="cp">#define _ASM_MAC_VIA_H_</span>

<span class="cm">/*</span>
<span class="cm"> * Base addresses for the VIAs. There are two in every machine,</span>
<span class="cm"> * although on some machines the second is an RBV or an OSS.</span>
<span class="cm"> * The OSS is different enough that it&#39;s handled separately.</span>
<span class="cm"> *</span>
<span class="cm"> * Do not use these values directly; use the via1 and via2 variables</span>
<span class="cm"> * instead (and don&#39;t forget to check rbv_present when using via2!)</span>
<span class="cm"> */</span>

<span class="cp">#define VIA1_BASE	(0x50F00000)</span>
<span class="cp">#define VIA2_BASE	(0x50F02000)</span>
<span class="cp">#define  RBV_BASE	(0x50F26000)</span>

<span class="cm">/*</span>
<span class="cm"> *	Not all of these are true post MacII I think.</span>
<span class="cm"> *      CSA: probably the ones CHRP marks as &#39;unused&#39; change purposes</span>
<span class="cm"> *      when the IWM becomes the SWIM.</span>
<span class="cm"> *      http://www.rs6000.ibm.com/resource/technology/chrpio/via5.mak.html</span>
<span class="cm"> *      ftp://ftp.austin.ibm.com/pub/technology/spec/chrp/inwork/CHRP_IORef_1.0.pdf</span>
<span class="cm"> *</span>
<span class="cm"> * also, http://developer.apple.com/technotes/hw/hw_09.html claims the</span>
<span class="cm"> * following changes for IIfx:</span>
<span class="cm"> * VIA1A_vSccWrReq not available and that VIA1A_vSync has moved to an IOP.</span>
<span class="cm"> * Also, &quot;All of the functionality of VIA2 has been moved to other chips&quot;.</span>
<span class="cm"> */</span>

<span class="cp">#define VIA1A_vSccWrReq	0x80	</span><span class="cm">/* SCC write. (input)</span>
<span class="cm">				 * [CHRP] SCC WREQ: Reflects the state of the</span>
<span class="cm">				 * Wait/Request pins from the SCC.</span>
<span class="cm">				 * [Macintosh Family Hardware]</span>
<span class="cm">				 * as CHRP on SE/30,II,IIx,IIcx,IIci.</span>
<span class="cm">				 * on IIfx, &quot;0 means an active request&quot;</span>
<span class="cm">				 */</span><span class="cp"></span>
<span class="cp">#define VIA1A_vRev8	0x40	</span><span class="cm">/* Revision 8 board ???</span>
<span class="cm">                                 * [CHRP] En WaitReqB: Lets the WaitReq_L</span>
<span class="cm">				 * signal from port B of the SCC appear on</span>
<span class="cm">				 * the PA7 input pin. Output.</span>
<span class="cm">				 * [Macintosh Family] On the SE/30, this</span>
<span class="cm">				 * is the bit to flip screen buffers.</span>
<span class="cm">				 * 0=alternate, 1=main.</span>
<span class="cm">				 * on II,IIx,IIcx,IIci,IIfx this is a bit</span>
<span class="cm">				 * for Rev ID. 0=II,IIx, 1=IIcx,IIci,IIfx</span>
<span class="cm">				 */</span><span class="cp"></span>
<span class="cp">#define VIA1A_vHeadSel	0x20	</span><span class="cm">/* Head select for IWM.</span>
<span class="cm">				 * [CHRP] unused.</span>
<span class="cm">				 * [Macintosh Family] &quot;Floppy disk</span>
<span class="cm">				 * state-control line SEL&quot; on all but IIfx</span>
<span class="cm">				 */</span><span class="cp"></span>
<span class="cp">#define VIA1A_vOverlay	0x10    </span><span class="cm">/* [Macintosh Family] On SE/30,II,IIx,IIcx</span>
<span class="cm">				 * this bit enables the &quot;Overlay&quot; address</span>
<span class="cm">				 * map in the address decoders as it is on</span>
<span class="cm">				 * reset for mapping the ROM over the reset</span>
<span class="cm">				 * vector. 1=use overlay map.</span>
<span class="cm">				 * On the IIci,IIfx it is another bit of the</span>
<span class="cm">				 * CPU ID: 0=normal IIci, 1=IIci with parity</span>
<span class="cm">				 * feature or IIfx.</span>
<span class="cm">				 * [CHRP] En WaitReqA: Lets the WaitReq_L</span>
<span class="cm">				 * signal from port A of the SCC appear</span>
<span class="cm">				 * on the PA7 input pin (CHRP). Output.</span>
<span class="cm">				 * [MkLinux] &quot;Drive Select&quot;</span>
<span class="cm">				 *  (with 0x20 being &#39;disk head select&#39;)</span>
<span class="cm">				 */</span><span class="cp"></span>
<span class="cp">#define VIA1A_vSync	0x08    </span><span class="cm">/* [CHRP] Sync Modem: modem clock select:</span>
<span class="cm">                                 * 1: select the external serial clock to</span>
<span class="cm">				 *    drive the SCC&#39;s /RTxCA pin.</span>
<span class="cm">				 * 0: Select the 3.6864MHz clock to drive</span>
<span class="cm">				 *    the SCC cell.</span>
<span class="cm">				 * [Macintosh Family] Correct on all but IIfx</span>
<span class="cm">				 */</span><span class="cp"></span>

<span class="cm">/* Macintosh Family Hardware sez: bits 0-2 of VIA1A are volume control</span>
<span class="cm"> * on Macs which had the PWM sound hardware.  Reserved on newer models.</span>
<span class="cm"> * On IIci,IIfx, bits 1-2 are the rest of the CPU ID:</span>
<span class="cm"> * bit 2: 1=IIci, 0=IIfx</span>
<span class="cm"> * bit 1: 1 on both IIci and IIfx.</span>
<span class="cm"> * MkLinux sez bit 0 is &#39;burnin flag&#39; in this case.</span>
<span class="cm"> * CHRP sez: VIA1A bits 0-2 and 5 are &#39;unused&#39;: if programmed as</span>
<span class="cm"> * inputs, these bits will read 0.</span>
<span class="cm"> */</span>
<span class="cp">#define VIA1A_vVolume	0x07	</span><span class="cm">/* Audio volume mask for PWM */</span><span class="cp"></span>
<span class="cp">#define VIA1A_CPUID0	0x02	</span><span class="cm">/* CPU id bit 0 on RBV, others */</span><span class="cp"></span>
<span class="cp">#define VIA1A_CPUID1	0x04	</span><span class="cm">/* CPU id bit 0 on RBV, others */</span><span class="cp"></span>
<span class="cp">#define VIA1A_CPUID2	0x10	</span><span class="cm">/* CPU id bit 0 on RBV, others */</span><span class="cp"></span>
<span class="cp">#define VIA1A_CPUID3	0x40	</span><span class="cm">/* CPU id bit 0 on RBV, others */</span><span class="cp"></span>

<span class="cm">/* Info on VIA1B is from Macintosh Family Hardware &amp; MkLinux.</span>
<span class="cm"> * CHRP offers no info. */</span>
<span class="cp">#define VIA1B_vSound	0x80	</span><span class="cm">/* Sound enable (for compatibility with</span>
<span class="cm">				 * PWM hardware) 0=enabled.</span>
<span class="cm">				 * Also, on IIci w/parity, shows parity error</span>
<span class="cm">				 * 0=error, 1=OK. */</span><span class="cp"></span>
<span class="cp">#define VIA1B_vMystery	0x40    </span><span class="cm">/* On IIci, parity enable. 0=enabled,1=disabled</span>
<span class="cm">				 * On SE/30, vertical sync interrupt enable.</span>
<span class="cm">				 * 0=enabled. This vSync interrupt shows up</span>
<span class="cm">				 * as a slot $E interrupt. */</span><span class="cp"></span>
<span class="cp">#define VIA1B_vADBS2	0x20	</span><span class="cm">/* ADB state input bit 1 (unused on IIfx) */</span><span class="cp"></span>
<span class="cp">#define VIA1B_vADBS1	0x10	</span><span class="cm">/* ADB state input bit 0 (unused on IIfx) */</span><span class="cp"></span>
<span class="cp">#define VIA1B_vADBInt	0x08	</span><span class="cm">/* ADB interrupt 0=interrupt (unused on IIfx)*/</span><span class="cp"></span>
<span class="cp">#define VIA1B_vRTCEnb	0x04	</span><span class="cm">/* Enable Real time clock. 0=enabled. */</span><span class="cp"></span>
<span class="cp">#define VIA1B_vRTCClk	0x02    </span><span class="cm">/* Real time clock serial-clock line. */</span><span class="cp"></span>
<span class="cp">#define VIA1B_vRTCData	0x01    </span><span class="cm">/* Real time clock serial-data line. */</span><span class="cp"></span>

<span class="cm">/* MkLinux defines the following &quot;VIA1 Register B contents where they</span>
<span class="cm"> * differ from standard VIA1&quot;.  From the naming scheme, we assume they</span>
<span class="cm"> * correspond to a VIA work-alike named &#39;EVR&#39;. */</span>
<span class="cp">#define	EVRB_XCVR	0x08	</span><span class="cm">/* XCVR_SESSION* */</span><span class="cp"></span>
<span class="cp">#define	EVRB_FULL	0x10	</span><span class="cm">/* VIA_FULL */</span><span class="cp"></span>
<span class="cp">#define	EVRB_SYSES	0x20	</span><span class="cm">/* SYS_SESSION */</span><span class="cp"></span>
<span class="cp">#define	EVRB_AUXIE	0x00	</span><span class="cm">/* Enable A/UX Interrupt Scheme */</span><span class="cp"></span>
<span class="cp">#define	EVRB_AUXID	0x40	</span><span class="cm">/* Disable A/UX Interrupt Scheme */</span><span class="cp"></span>
<span class="cp">#define	EVRB_SFTWRIE	0x00	</span><span class="cm">/* Software Interrupt ReQuest */</span><span class="cp"></span>
<span class="cp">#define	EVRB_SFTWRID	0x80	</span><span class="cm">/* Software Interrupt ReQuest */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *	VIA2 A register is the interrupt lines raised off the nubus</span>
<span class="cm"> *	slots.</span>
<span class="cm"> *      The below info is from &#39;Macintosh Family Hardware.&#39;</span>
<span class="cm"> *      MkLinux calls the &#39;IIci internal video IRQ&#39; below the &#39;RBV slot 0 irq.&#39;</span>
<span class="cm"> *      It also notes that the slot $9 IRQ is the &#39;Ethernet IRQ&#39; and</span>
<span class="cm"> *      defines the &#39;Video IRQ&#39; as 0x40 for the &#39;EVR&#39; VIA work-alike.</span>
<span class="cm"> *      Perhaps OSS uses vRAM1 and vRAM2 for ADB.</span>
<span class="cm"> */</span>

<span class="cp">#define VIA2A_vRAM1	0x80	</span><span class="cm">/* RAM size bit 1 (IIci: reserved) */</span><span class="cp"></span>
<span class="cp">#define VIA2A_vRAM0	0x40	</span><span class="cm">/* RAM size bit 0 (IIci: internal video IRQ) */</span><span class="cp"></span>
<span class="cp">#define VIA2A_vIRQE	0x20	</span><span class="cm">/* IRQ from slot $E */</span><span class="cp"></span>
<span class="cp">#define VIA2A_vIRQD	0x10	</span><span class="cm">/* IRQ from slot $D */</span><span class="cp"></span>
<span class="cp">#define VIA2A_vIRQC	0x08	</span><span class="cm">/* IRQ from slot $C */</span><span class="cp"></span>
<span class="cp">#define VIA2A_vIRQB	0x04	</span><span class="cm">/* IRQ from slot $B */</span><span class="cp"></span>
<span class="cp">#define VIA2A_vIRQA	0x02	</span><span class="cm">/* IRQ from slot $A */</span><span class="cp"></span>
<span class="cp">#define VIA2A_vIRQ9	0x01	</span><span class="cm">/* IRQ from slot $9 */</span><span class="cp"></span>

<span class="cm">/* RAM size bits decoded as follows:</span>
<span class="cm"> * bit1 bit0  size of ICs in bank A</span>
<span class="cm"> *  0    0    256 kbit</span>
<span class="cm"> *  0    1    1 Mbit</span>
<span class="cm"> *  1    0    4 Mbit</span>
<span class="cm"> *  1    1   16 Mbit</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> *	Register B has the fun stuff in it</span>
<span class="cm"> */</span>

<span class="cp">#define VIA2B_vVBL	0x80	</span><span class="cm">/* VBL output to VIA1 (60.15Hz) driven by</span>
<span class="cm">				 * timer T1.</span>
<span class="cm">				 * on IIci, parity test: 0=test mode.</span>
<span class="cm">				 * [MkLinux] RBV_PARODD: 1=odd,0=even. */</span><span class="cp"></span>
<span class="cp">#define VIA2B_vSndJck	0x40	</span><span class="cm">/* External sound jack status.</span>
<span class="cm">				 * 0=plug is inserted.  On SE/30, always 0 */</span><span class="cp"></span>
<span class="cp">#define VIA2B_vTfr0	0x20	</span><span class="cm">/* Transfer mode bit 0 ack from NuBus */</span><span class="cp"></span>
<span class="cp">#define VIA2B_vTfr1	0x10	</span><span class="cm">/* Transfer mode bit 1 ack from NuBus */</span><span class="cp"></span>
<span class="cp">#define VIA2B_vMode32	0x08	</span><span class="cm">/* 24/32bit switch - doubles as cache flush</span>
<span class="cm">				 * on II, AMU/PMMU control.</span>
<span class="cm">				 *   if AMU, 0=24bit to 32bit translation</span>
<span class="cm">				 *   if PMMU, 1=PMMU is accessing page table.</span>
<span class="cm">				 * on SE/30 tied low.</span>
<span class="cm">				 * on IIx,IIcx,IIfx, unused.</span>
<span class="cm">				 * on IIci/RBV, cache control. 0=flush cache.</span>
<span class="cm">				 */</span><span class="cp"></span>
<span class="cp">#define VIA2B_vPower	0x04	</span><span class="cm">/* Power off, 0=shut off power.</span>
<span class="cm">				 * on SE/30 this signal sent to PDS card. */</span><span class="cp"></span>
<span class="cp">#define VIA2B_vBusLk	0x02	</span><span class="cm">/* Lock NuBus transactions, 0=locked.</span>
<span class="cm">				 * on SE/30 sent to PDS card. */</span><span class="cp"></span>
<span class="cp">#define VIA2B_vCDis	0x01	</span><span class="cm">/* Cache control. On IIci, 1=disable cache card</span>
<span class="cm">				 * on others, 0=disable processor&#39;s instruction</span>
<span class="cm">				 * and data caches. */</span><span class="cp"></span>

<span class="cm">/* Apple sez: http://developer.apple.com/technotes/ov/ov_04.html</span>
<span class="cm"> * Another example of a valid function that has no ROM support is the use</span>
<span class="cm"> * of the alternate video page for page-flipping animation. Since there</span>
<span class="cm"> * is no ROM call to flip pages, it is necessary to go play with the</span>
<span class="cm"> * right bit in the VIA chip (6522 Versatile Interface Adapter).</span>
<span class="cm"> * [CSA: don&#39;t know which one this is, but it&#39;s one of &#39;em!]</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> *	6522 registers - see databook.</span>
<span class="cm"> * CSA: Assignments for VIA1 confirmed from CHRP spec.</span>
<span class="cm"> */</span>

<span class="cm">/* partial address decode.  0xYYXX : XX part for RBV, YY part for VIA */</span>
<span class="cm">/* Note: 15 VIA regs, 8 RBV regs */</span>

<span class="cp">#define vBufB	0x0000	</span><span class="cm">/* [VIA/RBV]  Register B */</span><span class="cp"></span>
<span class="cp">#define vBufAH	0x0200  </span><span class="cm">/* [VIA only] Buffer A, with handshake. DON&#39;T USE! */</span><span class="cp"></span>
<span class="cp">#define vDirB	0x0400  </span><span class="cm">/* [VIA only] Data Direction Register B. */</span><span class="cp"></span>
<span class="cp">#define vDirA	0x0600  </span><span class="cm">/* [VIA only] Data Direction Register A. */</span><span class="cp"></span>
<span class="cp">#define vT1CL	0x0800  </span><span class="cm">/* [VIA only] Timer one counter low. */</span><span class="cp"></span>
<span class="cp">#define vT1CH	0x0a00  </span><span class="cm">/* [VIA only] Timer one counter high. */</span><span class="cp"></span>
<span class="cp">#define vT1LL	0x0c00  </span><span class="cm">/* [VIA only] Timer one latches low. */</span><span class="cp"></span>
<span class="cp">#define vT1LH	0x0e00  </span><span class="cm">/* [VIA only] Timer one latches high. */</span><span class="cp"></span>
<span class="cp">#define vT2CL	0x1000  </span><span class="cm">/* [VIA only] Timer two counter low. */</span><span class="cp"></span>
<span class="cp">#define vT2CH	0x1200  </span><span class="cm">/* [VIA only] Timer two counter high. */</span><span class="cp"></span>
<span class="cp">#define vSR	0x1400  </span><span class="cm">/* [VIA only] Shift register. */</span><span class="cp"></span>
<span class="cp">#define vACR	0x1600  </span><span class="cm">/* [VIA only] Auxiliary control register. */</span><span class="cp"></span>
<span class="cp">#define vPCR	0x1800  </span><span class="cm">/* [VIA only] Peripheral control register. */</span><span class="cp"></span>
                        <span class="cm">/*            CHRP sez never ever to *write* this.</span>
<span class="cm">			 *            Mac family says never to *change* this.</span>
<span class="cm">			 * In fact we need to initialize it once at start. */</span>
<span class="cp">#define vIFR	0x1a00  </span><span class="cm">/* [VIA/RBV]  Interrupt flag register. */</span><span class="cp"></span>
<span class="cp">#define vIER	0x1c00  </span><span class="cm">/* [VIA/RBV]  Interrupt enable register. */</span><span class="cp"></span>
<span class="cp">#define vBufA	0x1e00  </span><span class="cm">/* [VIA/RBV] register A (no handshake) */</span><span class="cp"></span>

<span class="cm">/* The RBV only decodes the bottom eight address lines; the VIA doesn&#39;t</span>
<span class="cm"> * decode the bottom eight -- so vBufB | rBufB will always get you BufB */</span>
<span class="cm">/* CSA: in fact, only bits 0,1, and 4 seem to be decoded.</span>
<span class="cm"> * BUT note the values for rIER and rIFR, where the top 8 bits *do* seem</span>
<span class="cm"> * to matter.  In fact *all* of the top 8 bits seem to matter;</span>
<span class="cm"> * setting rIER=0x1813 and rIFR=0x1803 doesn&#39;t work, either.</span>
<span class="cm"> * Perhaps some sort of &#39;compatibility mode&#39; is built-in? [21-May-1999]</span>
<span class="cm"> */</span>

<span class="cp">#define rBufB   0x0000  </span><span class="cm">/* [VIA/RBV]  Register B */</span><span class="cp"></span>
<span class="cp">#define rExp	0x0001	</span><span class="cm">/* [RBV only] RBV future expansion (always 0) */</span><span class="cp"></span>
<span class="cp">#define rSIFR	0x0002  </span><span class="cm">/* [RBV only] RBV slot interrupts register. */</span><span class="cp"></span>
<span class="cp">#define rIFR	0x1a03  </span><span class="cm">/* [VIA/RBV]  RBV interrupt flag register. */</span><span class="cp"></span>
<span class="cp">#define rMonP   0x0010  </span><span class="cm">/* [RBV only] RBV video monitor type. */</span><span class="cp"></span>
<span class="cp">#define rChpT   0x0011  </span><span class="cm">/* [RBV only] RBV test mode register (reads as 0). */</span><span class="cp"></span>
<span class="cp">#define rSIER   0x0012  </span><span class="cm">/* [RBV only] RBV slot interrupt enables. */</span><span class="cp"></span>
<span class="cp">#define rIER    0x1c13  </span><span class="cm">/* [VIA/RBV]  RBV interrupt flag enable register. */</span><span class="cp"></span>
<span class="cp">#define rBufA	rSIFR   </span><span class="cm">/* the &#39;slot interrupts register&#39; is BufA on a VIA */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Video monitor parameters, for rMonP:</span>
<span class="cm"> */</span>
<span class="cp">#define RBV_DEPTH  0x07	</span><span class="cm">/* bits per pixel: 000=1,001=2,010=4,011=8 */</span><span class="cp"></span>
<span class="cp">#define RBV_MONID  0x38	</span><span class="cm">/* monitor type, as below. */</span><span class="cp"></span>
<span class="cp">#define RBV_VIDOFF 0x40	</span><span class="cm">/* 1 turns off onboard video */</span><span class="cp"></span>
<span class="cm">/* Supported monitor types: */</span>
<span class="cp">#define MON_15BW   (1&lt;&lt;3) </span><span class="cm">/* 15&quot; BW portrait. */</span><span class="cp"></span>
<span class="cp">#define MON_IIGS   (2&lt;&lt;3) </span><span class="cm">/* 12&quot; color (modified IIGS monitor). */</span><span class="cp"></span>
<span class="cp">#define MON_15RGB  (5&lt;&lt;3) </span><span class="cm">/* 15&quot; RGB portrait. */</span><span class="cp"></span>
<span class="cp">#define MON_12OR13 (6&lt;&lt;3) </span><span class="cm">/* 12&quot; BW or 13&quot; RGB. */</span><span class="cp"></span>
<span class="cp">#define MON_NONE   (7&lt;&lt;3) </span><span class="cm">/* No monitor attached. */</span><span class="cp"></span>

<span class="cm">/* To clarify IER manipulations */</span>
<span class="cp">#define IER_SET_BIT(b) (0x80 | (1&lt;&lt;(b)) )</span>
<span class="cp">#define IER_CLR_BIT(b) (0x7F &amp; (1&lt;&lt;(b)) )</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">extern</span> <span class="k">volatile</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">via1</span><span class="p">,</span><span class="o">*</span><span class="n">via2</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">rbv_present</span><span class="p">,</span><span class="n">via_alt_mapping</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">via_register_interrupts</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">via_irq_enable</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">via_irq_disable</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">via_nubus_irq_startup</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">via_nubus_irq_shutdown</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">via1_irq</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">irq_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">via1_set_head</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">via2_scsi_drq_pending</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">rbv_set_video_bpp</span><span class="p">(</span><span class="kt">int</span> <span class="n">bpp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">bpp</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span><span class="o">?</span><span class="mi">0</span><span class="o">:</span><span class="p">(</span><span class="n">bpp</span><span class="o">==</span><span class="mi">2</span><span class="p">)</span><span class="o">?</span><span class="mi">1</span><span class="o">:</span><span class="p">(</span><span class="n">bpp</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span><span class="o">?</span><span class="mi">2</span><span class="o">:</span><span class="p">(</span><span class="n">bpp</span><span class="o">==</span><span class="mi">8</span><span class="p">)</span><span class="o">?</span><span class="mi">3</span><span class="o">:-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rbv_present</span> <span class="o">||</span> <span class="n">val</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">via2</span><span class="p">[</span><span class="n">rMonP</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">via2</span><span class="p">[</span><span class="n">rMonP</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">RBV_DEPTH</span><span class="p">)</span> <span class="o">|</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _ASM_MAC_VIA_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
