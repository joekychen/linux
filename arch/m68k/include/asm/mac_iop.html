<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › m68k › include › asm › mac_iop.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>mac_iop.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * I/O Processor (IOP) defines and structures, mostly snagged from A/UX</span>
<span class="cm"> * header files.</span>
<span class="cm"> *</span>
<span class="cm"> * The original header from which this was taken is copyrighted. I&#39;ve done some</span>
<span class="cm"> * rewriting (in fact my changes make this a bit more readable, IMHO) but some</span>
<span class="cm"> * more should be done.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * This is the base address of the IOPs. Use this as the address of</span>
<span class="cm"> * a &quot;struct iop&quot; (see below) to see where the actual registers fall.</span>
<span class="cm"> */</span>

<span class="cp">#define SCC_IOP_BASE_IIFX	(0x50F04000)</span>
<span class="cp">#define ISM_IOP_BASE_IIFX	(0x50F12000)</span>

<span class="cp">#define SCC_IOP_BASE_QUADRA	(0x50F0C000)</span>
<span class="cp">#define ISM_IOP_BASE_QUADRA	(0x50F1E000)</span>

<span class="cm">/* IOP status/control register bits: */</span>

<span class="cp">#define	IOP_BYPASS	0x01	</span><span class="cm">/* bypass-mode hardware access */</span><span class="cp"></span>
<span class="cp">#define	IOP_AUTOINC	0x02	</span><span class="cm">/* allow autoincrement of ramhi/lo */</span><span class="cp"></span>
<span class="cp">#define	IOP_RUN		0x04	</span><span class="cm">/* set to 0 to reset IOP chip */</span><span class="cp"></span>
<span class="cp">#define	IOP_IRQ		0x08	</span><span class="cm">/* generate IRQ to IOP if 1 */</span><span class="cp"></span>
<span class="cp">#define	IOP_INT0	0x10	</span><span class="cm">/* intr priority from IOP to host */</span><span class="cp"></span>
<span class="cp">#define	IOP_INT1	0x20	</span><span class="cm">/* intr priority from IOP to host */</span><span class="cp"></span>
<span class="cp">#define	IOP_HWINT	0x40	</span><span class="cm">/* IRQ from hardware; bypass mode only */</span><span class="cp"></span>
<span class="cp">#define	IOP_DMAINACTIVE	0x80	</span><span class="cm">/* no DMA request active; bypass mode only */</span><span class="cp"></span>

<span class="cp">#define NUM_IOPS	2</span>
<span class="cp">#define NUM_IOP_CHAN	7</span>
<span class="cp">#define NUM_IOP_MSGS	NUM_IOP_CHAN*8</span>
<span class="cp">#define IOP_MSG_LEN	32</span>

<span class="cm">/* IOP reference numbers, used by the globally-visible iop_xxx functions */</span>

<span class="cp">#define IOP_NUM_SCC	0</span>
<span class="cp">#define IOP_NUM_ISM	1</span>

<span class="cm">/* IOP channel states */</span>

<span class="cp">#define IOP_MSG_IDLE		0       </span><span class="cm">/* idle                         */</span><span class="cp"></span>
<span class="cp">#define IOP_MSG_NEW		1       </span><span class="cm">/* new message sent             */</span><span class="cp"></span>
<span class="cp">#define IOP_MSG_RCVD		2       </span><span class="cm">/* message received; processing */</span><span class="cp"></span>
<span class="cp">#define IOP_MSG_COMPLETE	3       </span><span class="cm">/* message processing complete  */</span><span class="cp"></span>

<span class="cm">/* IOP message status codes */</span>

<span class="cp">#define IOP_MSGSTATUS_UNUSED	0	</span><span class="cm">/* Unusued message structure       */</span><span class="cp"></span>
<span class="cp">#define IOP_MSGSTATUS_WAITING	1	</span><span class="cm">/* waiting for channel             */</span><span class="cp"></span>
<span class="cp">#define IOP_MSGSTATUS_SENT	2	</span><span class="cm">/* message sent, awaiting reply    */</span><span class="cp"></span>
<span class="cp">#define IOP_MSGSTATUS_COMPLETE	3	</span><span class="cm">/* message complete and reply rcvd */</span><span class="cp"></span>
<span class="cp">#define IOP_MSGSTATUS_UNSOL	6	</span><span class="cm">/* message is unsolicited          */</span><span class="cp"></span>

<span class="cm">/* IOP memory addresses of the members of the mac_iop_kernel structure. */</span>

<span class="cp">#define IOP_ADDR_MAX_SEND_CHAN	0x0200</span>
<span class="cp">#define IOP_ADDR_SEND_STATE	0x0201</span>
<span class="cp">#define IOP_ADDR_PATCH_CTRL	0x021F</span>
<span class="cp">#define IOP_ADDR_SEND_MSG	0x0220</span>
<span class="cp">#define IOP_ADDR_MAX_RECV_CHAN	0x0300</span>
<span class="cp">#define IOP_ADDR_RECV_STATE	0x0301</span>
<span class="cp">#define IOP_ADDR_ALIVE		0x031F</span>
<span class="cp">#define IOP_ADDR_RECV_MSG	0x0320</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cm">/*</span>
<span class="cm"> * IOP Control registers, staggered because in usual Apple style they were</span>
<span class="cm"> * too lazy to decode the A0 bit. This structure is assumed to begin at</span>
<span class="cm"> * one of the xxx_IOP_BASE addresses given above.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">mac_iop</span> <span class="p">{</span>
    <span class="n">__u8</span>	<span class="n">ram_addr_hi</span><span class="p">;</span>	<span class="cm">/* shared RAM address hi byte */</span>
    <span class="n">__u8</span>	<span class="n">pad0</span><span class="p">;</span>
    <span class="n">__u8</span>	<span class="n">ram_addr_lo</span><span class="p">;</span>	<span class="cm">/* shared RAM address lo byte */</span>
    <span class="n">__u8</span>	<span class="n">pad1</span><span class="p">;</span>
    <span class="n">__u8</span>	<span class="n">status_ctrl</span><span class="p">;</span>	<span class="cm">/* status/control register */</span>
    <span class="n">__u8</span>	<span class="n">pad2</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="n">__u8</span>	<span class="n">ram_data</span><span class="p">;</span>	<span class="cm">/* RAM data byte at ramhi/lo */</span>

    <span class="n">__u8</span>	<span class="n">pad3</span><span class="p">[</span><span class="mi">23</span><span class="p">];</span>

    <span class="cm">/* Bypass-mode hardware access registers */</span>

    <span class="k">union</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>		<span class="cm">/* SCC registers */</span>
	    <span class="n">__u8</span> <span class="n">sccb_cmd</span><span class="p">;</span>	<span class="cm">/* SCC B command reg */</span>
	    <span class="n">__u8</span> <span class="n">pad4</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">scca_cmd</span><span class="p">;</span>	<span class="cm">/* SCC A command reg */</span>
	    <span class="n">__u8</span> <span class="n">pad5</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">sccb_data</span><span class="p">;</span>	<span class="cm">/* SCC B data */</span>
	    <span class="n">__u8</span> <span class="n">pad6</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">scca_data</span><span class="p">;</span>	<span class="cm">/* SCC A data */</span>
	<span class="p">}</span> <span class="n">scc_regs</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>		<span class="cm">/* ISM registers */</span>
	    <span class="n">__u8</span> <span class="n">wdata</span><span class="p">;</span>		<span class="cm">/* write a data byte */</span>
	    <span class="n">__u8</span> <span class="n">pad7</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">wmark</span><span class="p">;</span>		<span class="cm">/* write a mark byte */</span>
	    <span class="n">__u8</span> <span class="n">pad8</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">wcrc</span><span class="p">;</span>		<span class="cm">/* write 2-byte crc to disk */</span>
	    <span class="n">__u8</span> <span class="n">pad9</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">wparams</span><span class="p">;</span>	<span class="cm">/* write the param regs */</span>
	    <span class="n">__u8</span> <span class="n">pad10</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">wphase</span><span class="p">;</span>	<span class="cm">/* write the phase states &amp; dirs */</span>
	    <span class="n">__u8</span> <span class="n">pad11</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">wsetup</span><span class="p">;</span>	<span class="cm">/* write the setup register */</span>
	    <span class="n">__u8</span> <span class="n">pad12</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">wzeroes</span><span class="p">;</span>	<span class="cm">/* mode reg: 1&#39;s clr bits, 0&#39;s are x */</span>
	    <span class="n">__u8</span> <span class="n">pad13</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">wones</span><span class="p">;</span>		<span class="cm">/* mode reg: 1&#39;s set bits, 0&#39;s are x */</span>
	    <span class="n">__u8</span> <span class="n">pad14</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">rdata</span><span class="p">;</span>		<span class="cm">/* read a data byte */</span>
	    <span class="n">__u8</span> <span class="n">pad15</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">rmark</span><span class="p">;</span>		<span class="cm">/* read a mark byte */</span>
	    <span class="n">__u8</span> <span class="n">pad16</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">rerror</span><span class="p">;</span>	<span class="cm">/* read the error register */</span>
	    <span class="n">__u8</span> <span class="n">pad17</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">rparams</span><span class="p">;</span>	<span class="cm">/* read the param regs */</span>
	    <span class="n">__u8</span> <span class="n">pad18</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">rphase</span><span class="p">;</span>	<span class="cm">/* read the phase states &amp; dirs */</span>
	    <span class="n">__u8</span> <span class="n">pad19</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">rsetup</span><span class="p">;</span>	<span class="cm">/* read the setup register */</span>
	    <span class="n">__u8</span> <span class="n">pad20</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">rmode</span><span class="p">;</span>		<span class="cm">/* read the mode register */</span>
	    <span class="n">__u8</span> <span class="n">pad21</span><span class="p">;</span>
	    <span class="n">__u8</span> <span class="n">rhandshake</span><span class="p">;</span>	<span class="cm">/* read the handshake register */</span>
	<span class="p">}</span> <span class="n">ism_regs</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">b</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* This structure is used to track IOP messages in the Linux kernel */</span>

<span class="k">struct</span> <span class="n">iop_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">iop_msg</span>	<span class="o">*</span><span class="n">next</span><span class="p">;</span>		<span class="cm">/* next message in queue or NULL     */</span>
	<span class="n">uint</span>	<span class="n">iop_num</span><span class="p">;</span>		<span class="cm">/* IOP number                        */</span>
	<span class="n">uint</span>	<span class="n">channel</span><span class="p">;</span>		<span class="cm">/* channel number                    */</span>
	<span class="kt">void</span>	<span class="o">*</span><span class="n">caller_priv</span><span class="p">;</span>		<span class="cm">/* caller private data               */</span>
	<span class="kt">int</span>	<span class="n">status</span><span class="p">;</span>			<span class="cm">/* status of this message            */</span>
	<span class="n">__u8</span>	<span class="n">message</span><span class="p">[</span><span class="n">IOP_MSG_LEN</span><span class="p">];</span>	<span class="cm">/* the message being sent/received   */</span>
	<span class="n">__u8</span>	<span class="n">reply</span><span class="p">[</span><span class="n">IOP_MSG_LEN</span><span class="p">];</span>	<span class="cm">/* the reply to the message          */</span>
	<span class="kt">void</span>	<span class="p">(</span><span class="o">*</span><span class="n">handler</span><span class="p">)(</span><span class="k">struct</span> <span class="n">iop_msg</span> <span class="o">*</span><span class="p">);</span>
					<span class="cm">/* function to call when reply recvd */</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">iop_scc_present</span><span class="p">,</span><span class="n">iop_ism_present</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">iop_listen</span><span class="p">(</span><span class="n">uint</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span>
			<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">handler</span><span class="p">)(</span><span class="k">struct</span> <span class="n">iop_msg</span> <span class="o">*</span><span class="p">),</span>
			<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">iop_send_message</span><span class="p">(</span><span class="n">uint</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="p">,</span>
			    <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="p">)(</span><span class="k">struct</span> <span class="n">iop_msg</span> <span class="o">*</span><span class="p">));</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">iop_complete_message</span><span class="p">(</span><span class="k">struct</span> <span class="n">iop_msg</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">iop_upload_code</span><span class="p">(</span><span class="n">uint</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span> <span class="n">__u16</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">iop_download_code</span><span class="p">(</span><span class="n">uint</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span> <span class="n">__u16</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">iop_compare_code</span><span class="p">(</span><span class="n">uint</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="p">,</span> <span class="n">uint</span><span class="p">,</span> <span class="n">__u16</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">iop_register_interrupts</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
