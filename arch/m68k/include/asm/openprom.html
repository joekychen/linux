<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › m68k › include › asm › openprom.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>openprom.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __SPARC_OPENPROM_H</span>
<span class="cp">#define __SPARC_OPENPROM_H</span>

<span class="cm">/* openprom.h:  Prom structures and defines for access to the OPENBOOT</span>
<span class="cm"> *              prom routines and data areas.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1995 David S. Miller (davem@caip.rutgers.edu)</span>
<span class="cm"> */</span>


<span class="cm">/* Empirical constants... */</span>
<span class="cp">#ifdef CONFIG_SUN3</span>
<span class="cp">#define KADB_DEBUGGER_BEGVM     0x0fee0000    </span><span class="cm">/* There is no kadb yet but...*/</span><span class="cp"></span>
<span class="cp">#define LINUX_OPPROM_BEGVM      0x0fef0000</span>
<span class="cp">#define LINUX_OPPROM_ENDVM      0x0ff10000    </span><span class="cm">/* I think this is right - tm */</span><span class="cp"></span>
<span class="cp">#else</span>
<span class="cp">#define KADB_DEBUGGER_BEGVM     0xffc00000    </span><span class="cm">/* Where kern debugger is in virt-mem */</span><span class="cp"></span>
<span class="cp">#define	LINUX_OPPROM_BEGVM	0xffd00000</span>
<span class="cp">#define	LINUX_OPPROM_ENDVM	0xfff00000</span>
<span class="cp">#define	LINUX_OPPROM_MAGIC      0x10010407</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="cm">/* V0 prom device operations. */</span>
<span class="k">struct</span> <span class="n">linux_dev_v0_funcs</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v0_devopen</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="n">device_str</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v0_devclose</span><span class="p">)(</span><span class="kt">int</span> <span class="n">dev_desc</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v0_rdblkdev</span><span class="p">)(</span><span class="kt">int</span> <span class="n">dev_desc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_blks</span><span class="p">,</span> <span class="kt">int</span> <span class="n">blk_st</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v0_wrblkdev</span><span class="p">)(</span><span class="kt">int</span> <span class="n">dev_desc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_blks</span><span class="p">,</span> <span class="kt">int</span> <span class="n">blk_st</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v0_wrnetdev</span><span class="p">)(</span><span class="kt">int</span> <span class="n">dev_desc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_bytes</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v0_rdnetdev</span><span class="p">)(</span><span class="kt">int</span> <span class="n">dev_desc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_bytes</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v0_rdchardev</span><span class="p">)(</span><span class="kt">int</span> <span class="n">dev_desc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_bytes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dummy</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v0_wrchardev</span><span class="p">)(</span><span class="kt">int</span> <span class="n">dev_desc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_bytes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dummy</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v0_seekdev</span><span class="p">)(</span><span class="kt">int</span> <span class="n">dev_desc</span><span class="p">,</span> <span class="kt">long</span> <span class="n">logical_offst</span><span class="p">,</span> <span class="kt">int</span> <span class="n">from</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* V2 and later prom device operations. */</span>
<span class="k">struct</span> <span class="n">linux_dev_v2_funcs</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_inst2pkg</span><span class="p">)(</span><span class="kt">int</span> <span class="n">d</span><span class="p">);</span>	<span class="cm">/* Convert ihandle to phandle */</span>
	<span class="kt">char</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_dumb_mem_alloc</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="n">va</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">sz</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_dumb_mem_free</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="n">va</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">sz</span><span class="p">);</span>

	<span class="cm">/* To map devices into virtual I/O space. */</span>
	<span class="kt">char</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_dumb_mmap</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="n">virta</span><span class="p">,</span> <span class="kt">int</span> <span class="n">which_io</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">paddr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">sz</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_dumb_munmap</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="n">virta</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span><span class="p">);</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_dev_open</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="n">devpath</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_dev_close</span><span class="p">)(</span><span class="kt">int</span> <span class="n">d</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_dev_read</span><span class="p">)(</span><span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nbytes</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_dev_write</span><span class="p">)(</span><span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nbytes</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_dev_seek</span><span class="p">)(</span><span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">hi</span><span class="p">,</span> <span class="kt">int</span> <span class="n">lo</span><span class="p">);</span>

	<span class="cm">/* Never issued (multistage load support) */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_wheee2</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_wheee3</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">linux_mlist_v0</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">linux_mlist_v0</span> <span class="o">*</span><span class="n">theres_more</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">start_adr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">num_bytes</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">linux_mem_v0</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">linux_mlist_v0</span> <span class="o">**</span><span class="n">v0_totphys</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">linux_mlist_v0</span> <span class="o">**</span><span class="n">v0_prommap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">linux_mlist_v0</span> <span class="o">**</span><span class="n">v0_available</span><span class="p">;</span> <span class="cm">/* What we can use */</span>
<span class="p">};</span>

<span class="cm">/* Arguments sent to the kernel from the boot prompt. */</span>
<span class="k">struct</span> <span class="n">linux_arguments_v0</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">args</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">boot_dev</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">boot_dev_ctrl</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">boot_dev_unit</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">dev_partition</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">kernel_file_name</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">aieee1</span><span class="p">;</span>           <span class="cm">/* XXX */</span>
<span class="p">};</span>

<span class="cm">/* V2 and up boot things. */</span>
<span class="k">struct</span> <span class="n">linux_bootargs_v2</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">**</span><span class="n">bootpath</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">**</span><span class="n">bootargs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="o">*</span><span class="n">fd_stdin</span><span class="p">;</span>
	<span class="kt">int</span> <span class="o">*</span><span class="n">fd_stdout</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#if defined(CONFIG_SUN3) || defined(CONFIG_SUN3X)</span>
<span class="k">struct</span> <span class="n">linux_romvec</span> <span class="p">{</span>
	<span class="kt">char</span>		<span class="o">*</span><span class="n">pv_initsp</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_startmon</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>

	<span class="kt">int</span>		<span class="o">*</span><span class="n">diagberr</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">linux_arguments_v0</span> <span class="o">**</span><span class="n">pv_v0bootargs</span><span class="p">;</span>
	<span class="kt">unsigned</span>	<span class="o">*</span><span class="n">pv_sun3mem</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="p">(</span><span class="o">*</span><span class="n">pv_getchar</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_putchar</span><span class="p">)(</span><span class="kt">int</span> <span class="n">ch</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_nbgetchar</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_nbputchar</span><span class="p">)(</span><span class="kt">int</span> <span class="n">ch</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">pv_echo</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">pv_insource</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">pv_outsink</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_getkey</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_initgetkey</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="o">*</span><span class="n">pv_translation</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">pv_keybid</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="o">*</span><span class="n">pv_screen_x</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="o">*</span><span class="n">pv_screen_y</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">keybuf</span>	<span class="o">*</span><span class="n">pv_keybuf</span><span class="p">;</span>

	<span class="kt">char</span>		<span class="o">*</span><span class="n">pv_monid</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Frame buffer output and terminal emulation</span>
<span class="cm">	 */</span>

	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_fbwritechar</span><span class="p">)(</span><span class="kt">char</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="o">*</span><span class="n">pv_fbaddr</span><span class="p">;</span>
	<span class="kt">char</span>		<span class="o">**</span><span class="n">pv_font</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_fbwritestr</span><span class="p">)(</span><span class="kt">char</span><span class="p">);</span>

	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_reboot</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="n">bootstr</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Line input and parsing</span>
<span class="cm">	 */</span>

	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">pv_linebuf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">**</span><span class="n">pv_lineptr</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="o">*</span><span class="n">pv_linesize</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_getline</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="p">(</span><span class="o">*</span><span class="n">pv_getnextchar</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="p">(</span><span class="o">*</span><span class="n">pv_peeknextchar</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="o">*</span><span class="n">pv_fbthere</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_getnum</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>

	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_printf</span><span class="p">)(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_printhex</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>

	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">pv_leds</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_setleds</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Non-maskable interrupt  (nmi) information</span>
<span class="cm">	 */</span>

	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_nmiaddr</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_abortentry</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="o">*</span><span class="n">pv_nmiclock</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="o">*</span><span class="n">pv_fbtype</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Assorted other things</span>
<span class="cm">	 */</span>

	<span class="kt">unsigned</span>	<span class="n">pv_romvers</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">globram</span>  <span class="o">*</span><span class="n">pv_globram</span><span class="p">;</span>
	<span class="kt">char</span>		<span class="o">*</span><span class="n">pv_kbdzscc</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="o">*</span><span class="n">pv_keyrinit</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">pv_keyrtick</span><span class="p">;</span>
	<span class="kt">unsigned</span>	<span class="o">*</span><span class="n">pv_memoryavail</span><span class="p">;</span>
	<span class="kt">long</span>		<span class="o">*</span><span class="n">pv_resetaddr</span><span class="p">;</span>
	<span class="kt">long</span>		<span class="o">*</span><span class="n">pv_resetmap</span><span class="p">;</span>

	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_halt</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="o">*</span><span class="n">pv_memorybitmap</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_SUN3</span>
	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_setctxt</span><span class="p">)(</span><span class="kt">int</span> <span class="n">ctxt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">va</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pmeg</span><span class="p">);</span>
	<span class="kt">void</span>		<span class="p">(</span><span class="o">*</span><span class="n">pv_vector_cmd</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">int</span>		<span class="n">dummy1z</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">dummy2z</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">dummy3z</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">dummy4z</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">};</span>
<span class="cp">#else</span>
<span class="cm">/* The top level PROM vector. */</span>
<span class="k">struct</span> <span class="n">linux_romvec</span> <span class="p">{</span>
	<span class="cm">/* Version numbers. */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pv_magic_cookie</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pv_romvers</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pv_plugin_revision</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pv_printrev</span><span class="p">;</span>

	<span class="cm">/* Version 0 memory descriptors. */</span>
	<span class="k">struct</span> <span class="n">linux_mem_v0</span> <span class="n">pv_v0mem</span><span class="p">;</span>

	<span class="cm">/* Node operations. */</span>
	<span class="k">struct</span> <span class="n">linux_nodeops</span> <span class="o">*</span><span class="n">pv_nodeops</span><span class="p">;</span>

	<span class="kt">char</span> <span class="o">**</span><span class="n">pv_bootstr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">linux_dev_v0_funcs</span> <span class="n">pv_v0devops</span><span class="p">;</span>

	<span class="kt">char</span> <span class="o">*</span><span class="n">pv_stdin</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">pv_stdout</span><span class="p">;</span>
<span class="cp">#define	PROMDEV_KBD	0		</span><span class="cm">/* input from keyboard */</span><span class="cp"></span>
<span class="cp">#define	PROMDEV_SCREEN	0		</span><span class="cm">/* output to screen */</span><span class="cp"></span>
<span class="cp">#define	PROMDEV_TTYA	1		</span><span class="cm">/* in/out to ttya */</span><span class="cp"></span>
<span class="cp">#define	PROMDEV_TTYB	2		</span><span class="cm">/* in/out to ttyb */</span><span class="cp"></span>

	<span class="cm">/* Blocking getchar/putchar.  NOT REENTRANT! (grr) */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_getchar</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_putchar</span><span class="p">)(</span><span class="kt">int</span> <span class="n">ch</span><span class="p">);</span>

	<span class="cm">/* Non-blocking variants. */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_nbgetchar</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_nbputchar</span><span class="p">)(</span><span class="kt">int</span> <span class="n">ch</span><span class="p">);</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_putstr</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>

	<span class="cm">/* Miscellany. */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_reboot</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="n">bootstr</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_printf</span><span class="p">)(</span><span class="n">__const__</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fmt</span><span class="p">,</span> <span class="p">...);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_abort</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="n">__volatile__</span> <span class="kt">int</span> <span class="o">*</span><span class="n">pv_ticks</span><span class="p">;</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_halt</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">**</span><span class="n">pv_synchook</span><span class="p">)(</span><span class="kt">void</span><span class="p">);</span>

	<span class="cm">/* Evaluate a forth string, not different proto for V0 and V2-&gt;up. */</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">v0_eval</span><span class="p">)(</span><span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">);</span>
		<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">v2_eval</span><span class="p">)(</span><span class="kt">char</span> <span class="o">*</span><span class="n">str</span><span class="p">);</span>
	<span class="p">}</span> <span class="n">pv_fortheval</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">linux_arguments_v0</span> <span class="o">**</span><span class="n">pv_v0bootargs</span><span class="p">;</span>

	<span class="cm">/* Get ether address. */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_enaddr</span><span class="p">)(</span><span class="kt">int</span> <span class="n">d</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">enaddr</span><span class="p">);</span>

	<span class="k">struct</span> <span class="n">linux_bootargs_v2</span> <span class="n">pv_v2bootargs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">linux_dev_v2_funcs</span> <span class="n">pv_v2devops</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">filler</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>

	<span class="cm">/* This one is sun4c/sun4 only. */</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">pv_setctxt</span><span class="p">)(</span><span class="kt">int</span> <span class="n">ctxt</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">va</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pmeg</span><span class="p">);</span>

	<span class="cm">/* Prom version 3 Multiprocessor routines. This stuff is crazy.</span>
<span class="cm">	 * No joke. Calling these when there is only one cpu probably</span>
<span class="cm">	 * crashes the machine, have to test this. :-)</span>
<span class="cm">	 */</span>

	<span class="cm">/* v3_cpustart() will start the cpu &#39;whichcpu&#39; in mmu-context</span>
<span class="cm">	 * &#39;thiscontext&#39; executing at address &#39;prog_counter&#39;</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v3_cpustart</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">whichcpu</span><span class="p">,</span> <span class="kt">int</span> <span class="n">ctxtbl_ptr</span><span class="p">,</span>
			   <span class="kt">int</span> <span class="n">thiscontext</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">prog_counter</span><span class="p">);</span>

	<span class="cm">/* v3_cpustop() will cause cpu &#39;whichcpu&#39; to stop executing</span>
<span class="cm">	 * until a resume cpu call is made.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v3_cpustop</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">whichcpu</span><span class="p">);</span>

	<span class="cm">/* v3_cpuidle() will idle cpu &#39;whichcpu&#39; until a stop or</span>
<span class="cm">	 * resume cpu call is made.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v3_cpuidle</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">whichcpu</span><span class="p">);</span>

	<span class="cm">/* v3_cpuresume() will resume processor &#39;whichcpu&#39; executing</span>
<span class="cm">	 * starting with whatever &#39;pc&#39; and &#39;npc&#39; were left at the</span>
<span class="cm">	 * last &#39;idle&#39; or &#39;stop&#39; call.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">v3_cpuresume</span><span class="p">)(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">whichcpu</span><span class="p">);</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cm">/* Routines for traversing the prom device tree. */</span>
<span class="k">struct</span> <span class="n">linux_nodeops</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">no_nextnode</span><span class="p">)(</span><span class="kt">int</span> <span class="n">node</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">no_child</span><span class="p">)(</span><span class="kt">int</span> <span class="n">node</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">no_proplen</span><span class="p">)(</span><span class="kt">int</span> <span class="n">node</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">no_getprop</span><span class="p">)(</span><span class="kt">int</span> <span class="n">node</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">no_setprop</span><span class="p">)(</span><span class="kt">int</span> <span class="n">node</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">val</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
	<span class="kt">char</span> <span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">no_nextprop</span><span class="p">)(</span><span class="kt">int</span> <span class="n">node</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* More fun PROM structures for device probing. */</span>
<span class="cp">#define PROMREG_MAX     16</span>
<span class="cp">#define PROMVADDR_MAX   16</span>
<span class="cp">#define PROMINTR_MAX    15</span>

<span class="k">struct</span> <span class="n">linux_prom_registers</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">which_io</span><span class="p">;</span>         <span class="cm">/* is this in OBIO space? */</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">phys_addr</span><span class="p">;</span>      <span class="cm">/* The physical address of this register */</span>
	<span class="kt">int</span> <span class="n">reg_size</span><span class="p">;</span>         <span class="cm">/* How many bytes does this register take up? */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">linux_prom_irqs</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">pri</span><span class="p">;</span>    <span class="cm">/* IRQ priority */</span>
	<span class="kt">int</span> <span class="n">vector</span><span class="p">;</span> <span class="cm">/* This is foobar, what does it do? */</span>
<span class="p">};</span>

<span class="cm">/* Element of the &quot;ranges&quot; vector */</span>
<span class="k">struct</span> <span class="n">linux_prom_ranges</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ot_child_space</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ot_child_base</span><span class="p">;</span>		<span class="cm">/* Bus feels this */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ot_parent_space</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ot_parent_base</span><span class="p">;</span>		<span class="cm">/* CPU looks from here */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">or_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif </span><span class="cm">/* !(__ASSEMBLY__) */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* !(__SPARC_OPENPROM_H) */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
