<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › microblaze › include › asm › mmu.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>mmu.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2008-2009 Michal Simek &lt;monstr@monstr.eu&gt;</span>
<span class="cm"> * Copyright (C) 2008-2009 PetaLogix</span>
<span class="cm"> * Copyright (C) 2006 Atmark Techno, Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License. See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _ASM_MICROBLAZE_MMU_H</span>
<span class="cp">#define _ASM_MICROBLAZE_MMU_H</span>

<span class="cp"># ifndef CONFIG_MMU</span>
<span class="cp">#  include &lt;asm-generic/mmu.h&gt;</span>
<span class="cp"># else </span><span class="cm">/* CONFIG_MMU */</span><span class="cp"></span>
<span class="cp">#  ifdef __KERNEL__</span>
<span class="cp">#   ifndef __ASSEMBLY__</span>

<span class="cm">/* Default &quot;unsigned long&quot; context */</span>
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mm_context_t</span><span class="p">;</span>

<span class="cm">/* Hardware Page Table Entry */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_PTE</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">v</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Entry is valid */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vsid</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>	<span class="cm">/* Virtual segment identifier */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">h</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Hash algorithm indicator */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">api</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span>	<span class="cm">/* Abbreviated page index */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>  <span class="n">rpn</span><span class="o">:</span><span class="mi">20</span><span class="p">;</span>	<span class="cm">/* Real (physical) page number */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>     <span class="o">:</span><span class="mi">3</span><span class="p">;</span>	<span class="cm">/* Unused */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">r</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Referenced */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">c</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Changed */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">w</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Write-thru cache mode */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">i</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Cache inhibited */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">m</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Memory coherence */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">g</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Guarded */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>     <span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Unused */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>   <span class="n">pp</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>	<span class="cm">/* Page protection */</span>
<span class="p">}</span> <span class="n">PTE</span><span class="p">;</span>

<span class="cm">/* Values for PP (assumes Ks=0, Kp=1) */</span>
<span class="cp">#  define PP_RWXX	0 </span><span class="cm">/* Supervisor read/write, User none */</span><span class="cp"></span>
<span class="cp">#  define PP_RWRX	1 </span><span class="cm">/* Supervisor read/write, User read */</span><span class="cp"></span>
<span class="cp">#  define PP_RWRW	2 </span><span class="cm">/* Supervisor read/write, User read/write */</span><span class="cp"></span>
<span class="cp">#  define PP_RXRX	3 </span><span class="cm">/* Supervisor read,       User read */</span><span class="cp"></span>

<span class="cm">/* Segment Register */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_SEGREG</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">t</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Normal or I/O  type */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>   <span class="n">ks</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Supervisor &#39;key&#39; (normally 0) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>   <span class="n">kp</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* User &#39;key&#39; (normally 1) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>    <span class="n">n</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>	<span class="cm">/* No-execute */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>     <span class="o">:</span><span class="mi">4</span><span class="p">;</span>	<span class="cm">/* Unused */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vsid</span><span class="o">:</span><span class="mi">24</span><span class="p">;</span>	<span class="cm">/* Virtual Segment Identifier */</span>
<span class="p">}</span> <span class="n">SEGREG</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">_tlbie</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">va</span><span class="p">);</span>	<span class="cm">/* invalidate a TLB entry */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">_tlbia</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>		<span class="cm">/* invalidate all TLB entries */</span>

<span class="cm">/*</span>
<span class="cm"> * tlb_skip size stores actual number skipped TLBs from TLB0 - every directy TLB</span>
<span class="cm"> * mapping has to increase tlb_skip size.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="n">u32</span> <span class="n">tlb_skip</span><span class="p">;</span>
<span class="cp">#   endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * The MicroBlaze processor has a TLB architecture identical to PPC-40x. The</span>
<span class="cm"> * instruction and data sides share a unified, 64-entry, semi-associative</span>
<span class="cm"> * TLB which is maintained totally under software control. In addition, the</span>
<span class="cm"> * instruction side has a hardware-managed, 2,4, or 8-entry, fully-associative</span>
<span class="cm"> * TLB which serves as a first level to the shared TLB. These two TLBs are</span>
<span class="cm"> * known as the UTLB and ITLB, respectively.</span>
<span class="cm"> */</span>

<span class="cp">#  define MICROBLAZE_TLB_SIZE 64</span>

<span class="cm">/* For cases when you want to skip some TLB entries */</span>
<span class="cp">#  define MICROBLAZE_TLB_SKIP 0</span>

<span class="cm">/* Use the last TLB for temporary access to LMB */</span>
<span class="cp">#  define MICROBLAZE_LMB_TLB_ID 63</span>

<span class="cm">/*</span>
<span class="cm"> * TLB entries are defined by a &quot;high&quot; tag portion and a &quot;low&quot; data</span>
<span class="cm"> * portion. The data portion is 32-bits.</span>
<span class="cm"> *</span>
<span class="cm"> * TLB entries are managed entirely under software control by reading,</span>
<span class="cm"> * writing, and searching using the MTS and MFS instructions.</span>
<span class="cm"> */</span>

<span class="cp">#  define TLB_LO		1</span>
<span class="cp">#  define TLB_HI		0</span>
<span class="cp">#  define TLB_DATA		TLB_LO</span>
<span class="cp">#  define TLB_TAG		TLB_HI</span>

<span class="cm">/* Tag portion */</span>
<span class="cp">#  define TLB_EPN_MASK		0xFFFFFC00 </span><span class="cm">/* Effective Page Number */</span><span class="cp"></span>
<span class="cp">#  define TLB_PAGESZ_MASK	0x00000380</span>
<span class="cp">#  define TLB_PAGESZ(x)		(((x) &amp; 0x7) &lt;&lt; 7)</span>
<span class="cp">#  define PAGESZ_1K		0</span>
<span class="cp">#  define PAGESZ_4K		1</span>
<span class="cp">#  define PAGESZ_16K		2</span>
<span class="cp">#  define PAGESZ_64K		3</span>
<span class="cp">#  define PAGESZ_256K		4</span>
<span class="cp">#  define PAGESZ_1M		5</span>
<span class="cp">#  define PAGESZ_4M		6</span>
<span class="cp">#  define PAGESZ_16M		7</span>
<span class="cp">#  define TLB_VALID		0x00000040 </span><span class="cm">/* Entry is valid */</span><span class="cp"></span>

<span class="cm">/* Data portion */</span>
<span class="cp">#  define TLB_RPN_MASK		0xFFFFFC00 </span><span class="cm">/* Real Page Number */</span><span class="cp"></span>
<span class="cp">#  define TLB_PERM_MASK		0x00000300</span>
<span class="cp">#  define TLB_EX		0x00000200 </span><span class="cm">/* Instruction execution allowed */</span><span class="cp"></span>
<span class="cp">#  define TLB_WR		0x00000100 </span><span class="cm">/* Writes permitted */</span><span class="cp"></span>
<span class="cp">#  define TLB_ZSEL_MASK		0x000000F0</span>
<span class="cp">#  define TLB_ZSEL(x)		(((x) &amp; 0xF) &lt;&lt; 4)</span>
<span class="cp">#  define TLB_ATTR_MASK		0x0000000F</span>
<span class="cp">#  define TLB_W			0x00000008 </span><span class="cm">/* Caching is write-through */</span><span class="cp"></span>
<span class="cp">#  define TLB_I			0x00000004 </span><span class="cm">/* Caching is inhibited */</span><span class="cp"></span>
<span class="cp">#  define TLB_M			0x00000002 </span><span class="cm">/* Memory is coherent */</span><span class="cp"></span>
<span class="cp">#  define TLB_G			0x00000001 </span><span class="cm">/* Memory is guarded from prefetch */</span><span class="cp"></span>

<span class="cp">#  endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>
<span class="cp"># endif </span><span class="cm">/* CONFIG_MMU */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* _ASM_MICROBLAZE_MMU_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
