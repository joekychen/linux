f | pcic.c | s | 24K | 855 | Sam Ravnborg | sam@ravnborg.org | 1337029508 |  | sparc32: remove remaining users of btfixup  Use sparc_config to hold the last two function pointers.  There was no point generating dedicated _ops structures only for these.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | signal32.c | s | 25K | 805 | Al Viro | viro@zeniv.linux.org.uk | 1338569932 |  | new helper: signal_delivered()  Does block_sigmask() + tracehook_signal_handler();  called when sigframe has been successfully built.  All architectures converted to it; block_sigmask() itself is gone now (merged into this one).  I'm still not too happy with the signature, but that's a separate story (IMO we need a structure that would contain signal number + siginfo + k_sigaction, so that get_signal_to_deliver() would fill one, signal_delivered(), handle_signal() and probably setup...frame() - take one).  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | of_device_common.c | s | 3.9K | 140 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ivec.S | g | 1.1K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | setup_32.c | s | 9.2K | 360 | Sam Ravnborg | sam@ravnborg.org | 1338187963 |  | sparc32: add support for run-time patching of leon/sun single instructions  This will be used to handle that MMUREGS has different ASI for SUN and LEON. This is the infrastructure only - users will come later.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | trampoline_32.S | g | 3.9K |  | Sam Ravnborg | sam@ravnborg.org | 1338187967 |  | sparc32,leon: always include leon_smp + leon_mm in build  Fix-up leon specific assembler to use ASI_LEON_MMUREGS  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | process_32.c | s | 15K | 503 | Sam Ravnborg | sam@ravnborg.org | 1338187972 |  | sparc32: refactor cpu_idle()  With the removal of sun4c we can use the same cpu_idle() implementation on UP and SMP. This also fix it so we use the same version independent on LEON enabled or not.  V2: Fixed whitespace issue pointed out by Josip Rodin.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Josip Rodin <joy@entuzijast.net> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | pmc.c | s | 2.0K | 82 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103854 |  | sparc: Add module.h to files previously implicitly using it.  The file mm/extable.c needs module.h for within_module_init(), and also for search_exception_tables [which arguably could be living somewhere more appropriate than module.h] - eventually causing this:  arch/sparc/mm/extable.c: In function 'trim_init_extable': arch/sparc/mm/extable.c:74: error: dereferencing pointer to incomplete type arch/sparc/mm/extable.c:75: error: dereferencing pointer to incomplete type arch/sparc/mm/extable.c:77: error: implicit declaration of function 'within_module_init' arch/sparc/mm/extable.c:77: error: dereferencing pointer to incomplete type arch/sparc/mm/extable.c:78: error: dereferencing pointer to incomplete type arch/sparc/mm/extable.c:80: error: dereferencing pointer to incomplete type arch/sparc/mm/extable.c: In function 'search_extables_range': arch/sparc/mm/extable.c:93: error: implicit declaration of function 'search_exception_tables'  The other instances are more straight forward uses of things like MODULE_* and module_*  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | Makefile | g | 3.7K |  | Sam Ravnborg | sam@ravnborg.org | 1338187973 |  | sparc32,leon: always include leon_pmc in build  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | pci.c | s | 28K | 943 | Bjorn Helgaas | bhelgaas@google.com | 1332265321 |  | sparc/PCI: convert devtree and arch-probed bus addresses to resource  Normal PCI enumeration via PCI config space uses __pci_read_base(), where the PCI core applies any bus-to-resource offset.  But sparc sometimes reads PCI config space itself, and sometimes it gets addresses from the device tree.  In ac1edcc579b6, I converted sparc to use the PCI core bus-to-resource conversion, but I missed these sparc-specific paths.  I don't have a way to test it, but I think sparc is broken between that commit and this one.  This patch replaces the sparc-specific pci_resource_adjust() with the generic pcibios_bus_to_resource() in the following paths:      pci_cfg_fake_ranges()       (addresses read from PCI config)     apb_fake_ranges()           (addresses computed based on PCI config)     of_scan_pci_bridge()        (addresses from OF "ranges" property)  N.B.: Resources of non-P2P bridge devices are set in pci_parse_of_addrs() and, as far as I can see, never converted to CPU addresses.  I do not understand why these would be treated differently than bridge windows.  CC: "David S. Miller" <davem@davemloft.net> CC: sparclinux@vger.kernel.org Signed-off-by: Bjorn Helgaas <bhelgaas@google.com> Signed-off-by: Jesse Barnes <jbarnes@virtuousgeek.org>
f | starfire.c | s | 2.6K | 102 | Andres Salomon | dilinger@queued.net | 1294110126 |  | sparc: explicitly cast negative phandle checks to s32  When we switched sparc from using 'int's to 'phandle's (which is a u32), we neglected to do anything with the various checks for -1.  For those tests, explicitly cast the phandles to s32.  Signed-off-by: Andres Salomon <dilinger@queued.net> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | misctrap.S | g | 2.0K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | devices.c | s | 3.1K | 121 | Sam Ravnborg | sam@ravnborg.org | 1336789666 |  | sparc32: remove sun4c traps  We used to runtime patch the trap table for srmmu. With the removal of sun4c support this is no longer required.  With the sun4c trap removed we can remove all the referenced trap handling which is sun4c specific. This also allows us to get rid of the nosun4c.c file that contained only dummy functions/data.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | setup_64.c | s | 12K | 481 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | visemul.c | s | 19K | 719 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | windows.c | s | 3.2K | 108 | Arnd Bergmann | arnd@arndb.de | 1290013172 |  | BKL: remove extraneous #include <smp_lock.h>  The big kernel lock has been removed from all these files at some point, leaving only the #include.  Remove this too as a cleanup.  Signed-off-by: Arnd Bergmann <arnd@arndb.de> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | wof.S | g | 11K |  | Sam Ravnborg | sam@ravnborg.org | 1338187969 |  | sparc32: introduce support for run-time patching for all shared assembler code  All users of MMUREGS ASI in kernel/ now uses run-time patching.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | rtrap_64.S | g | 9.4K |  | David S. Miller | davem@davemloft.net | 1334350606 |  | sparc64: Remove trap return code which is now unnecessary.  Noticed by Linus.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | hvcalls.S | g | 13K |  | David S. Miller | davem@davemloft.net | 1312345732 |  | sparc: Set reboot-cmd using reboot data hypervisor call if available.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | spiterrs.S | g | 7.0K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | iommu.c | s | 20K | 699 | Andrzej Pietrasiewicz | andrzej.p@samsung.com | 1332945394 |  | SPARC: adapt for dma_map_ops changes  Adapt core SPARC architecture code for dma_map_ops changes: replace alloc/free_coherent with generic alloc/free methods.  Signed-off-by: Andrzej Pietrasiewicz <andrzej.p@samsung.com> Acked-by: Kyungmin Park <kyungmin.park@samsung.com> Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com> Reviewed-by: Arnd Bergmann <arnd@arndb.de> Acked-by: David S. Miller <davem@davemloft.net>
f | nmi.c | s | 6.0K | 229 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | trampoline_64.S | g | 9.1K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | dtlb_prot.S | g | 1.2K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ptrace_32.c | s | 9.8K | 402 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | prom_64.c | s | 13K | 497 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103854 |  | sparc: remove several unnecessary module.h include instances  Building an allyesconfig doesn't reveal a hidden need for any of these.  Since module.h brings in the whole kitchen sink, it just needlessly adds 30k+ lines to the cpp burden.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | asm-offsets.c | s | 885B | 36 | Sam Ravnborg | sam@ravnborg.org | 1228411032 |  | sparc,sparc64: unify asm-offsets.c  sparc64 does not use constants generated from asm-offsets but to prepare it to do so the parts that could be shared do now generate constants for sparc64 too.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | hvtramp.S | g | 2.7K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ioport.c | s | 18K | 614 | David S. Miller | davem@davemloft.net | 1338188823 |  | sparc32: Export leon_dma_ops to modules.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | auxio_32.c | s | 3.5K | 122 | David S. Miller | davem@davemloft.net | 1336807403 |  | sparc32: Remove sun4 and sun4c from enum sparc_cpu.  All the remaining references are trivially removed since we've just eliminated the final reference to sparc_cpu_model from assembler code in commit b7d96ce189564e661909fbf8df39d7358149885b ("sparc32: Remove sparc_cpu_model read from floppy interrupt handler.")  Signed-off-by: David S. Miller <davem@davemloft.net>
f | sys32.S | g | 12K |  | NeilBrown | neilb@suse.de | 1314396598 |  | All Arch: remove linkage for sys_nfsservctl system call  The nfsservctl system call is now gone, so we should remove all linkage for it.  Signed-off-by: NeilBrown <neilb@suse.de> Signed-off-by: J. Bruce Fields <bfields@redhat.com> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | us3_cpufreq.c | s | 6.0K | 221 | Joe Perches | joe@perches.com | 1307487994 |  | sparc: Remove unnecessary semicolons  Semicolons are not necessary after switch/while/for/if braces so remove them.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ds.c | s | 25K | 1033 | David S. Miller | davem@davemloft.net | 1334349127 |  | Merge git://git.kernel.org/pub/scm/linux/kernel/git/davem/sparc
f | pci_sabre.c | s | 20K | 541 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103852 |  | sparc: add export.h to arch/sparc files as required  These files are only exporting symbols, so they don't need the full module.h header file.  Previously they were getting access to EXPORT_SYMBOL implicitly via overuse of module.h from within other .h files, but that is being cleaned up.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | dma.c | s | 255B | 10 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103854 |  | sparc: remove several unnecessary module.h include instances  Building an allyesconfig doesn't reveal a hidden need for any of these.  Since module.h brings in the whole kitchen sink, it just needlessly adds 30k+ lines to the cpp burden.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | compat_audit.c | s | 689B | 37 | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | time_32.c | s | 8.8K | 316 | Sam Ravnborg | sam@ravnborg.org | 1337029509 |  | sparc32: remove runtime btfix support  - remove all uses of btfixup header - remove the btfixup header - remove the btfixup code  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | wuf.S | g | 8.4K |  | Sam Ravnborg | sam@ravnborg.org | 1338187969 |  | sparc32: introduce support for run-time patching for all shared assembler code  All users of MMUREGS ASI in kernel/ now uses run-time patching.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | vmlinux.lds.S | g | 2.6K |  | Sam Ravnborg | sam@ravnborg.org | 1338187963 |  | sparc32: add support for run-time patching of leon/sun single instructions  This will be used to handle that MMUREGS has different ASI for SUN and LEON. This is the infrastructure only - users will come later.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | apc.c | s | 4.1K | 161 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103854 |  | sparc: Add module.h to files previously implicitly using it.  The file mm/extable.c needs module.h for within_module_init(), and also for search_exception_tables [which arguably could be living somewhere more appropriate than module.h] - eventually causing this:  arch/sparc/mm/extable.c: In function 'trim_init_extable': arch/sparc/mm/extable.c:74: error: dereferencing pointer to incomplete type arch/sparc/mm/extable.c:75: error: dereferencing pointer to incomplete type arch/sparc/mm/extable.c:77: error: implicit declaration of function 'within_module_init' arch/sparc/mm/extable.c:77: error: dereferencing pointer to incomplete type arch/sparc/mm/extable.c:78: error: dereferencing pointer to incomplete type arch/sparc/mm/extable.c:80: error: dereferencing pointer to incomplete type arch/sparc/mm/extable.c: In function 'search_extables_range': arch/sparc/mm/extable.c:93: error: implicit declaration of function 'search_exception_tables'  The other instances are more straight forward uses of things like MODULE_* and module_*  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | sigutil_32.c | s | 3.2K | 107 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | ldc.c | s | 48K | 1878 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | prom.h | s | 187B | 7 | Andres Salomon | dilinger@queued.net | 1286769210 |  | of/promtree: make drivers/of/pdt.c no longer sparc-only  Clean up pdt.c:  - make build dependent upon config OF_PROMTREE  - #ifdef out the sparc-specific stuff  - create pdt-specific header  Signed-off-by: Andres Salomon <dilinger@queued.net> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | sun4v_ivec.S | g | 8.5K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | irq_64.c | s | 24K | 805 | David S. Miller | davem@davemloft.net | 1336808145 |  | sparc32: Trivial removal of sun4c references in comments.  I left some around, like the ones in the openprom headers, since we need to think about which pieces of those datastructures and code we can completely toss now.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | leon_pci_grpci2.c | s | 23K | 764 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ebus.c | s | 5.8K | 211 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | tsb.S | g | 12K |  | David S. Miller | davem@davemloft.net | 1266621592 |  | sparc64: Fix sun4u execute bit check in TSB I-TLB load.  Thanks to testcase and report from Brad Spengler:  -------------------- #include <stdio.h>  typedef int (* _wee)(void);  int main(void) {         char buf[8] = { '\x81', '\xc7', '\xe0', '\x08', '\x81', '\xe8',                         '\x00', '\x00' };         _wee wee;         printf("%p\n", &buf);         wee = (_wee)&buf;         wee();          return 0; } --------------------  TSB I-tlb load code tries to use andcc to check the _PAGE_EXEC_4U bit, but that's bit 12 so it gets sign extended all the way up to bit 63 and the test nearly always passes as a result.  Use sethi to fix the bug.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | perf_event.c | s | 35K | 1264 | Robert Richter | robert.richter@amd.com | 1336569792 |  | perf: Pass last sampling period to perf_sample_data_init()  We always need to pass the last sample period to perf_sample_data_init(), otherwise the event distribution will be wrong. Thus, modifiyng the function interface with the required period as argument. So basically a pattern like this:          perf_sample_data_init(&data, ~0ULL);         data.period = event->hw.last_period;  will now be like that:          perf_sample_data_init(&data, ~0ULL, event->hw.last_period);  Avoids unininitialized data.period and simplifies code.  Signed-off-by: Robert Richter <robert.richter@amd.com> Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Link: http://lkml.kernel.org/r/1333390758-10893-3-git-send-email-robert.richter@amd.com Signed-off-by: Ingo Molnar <mingo@kernel.org>
f | unaligned_64.c | s | 17K | 615 | David S. Miller | davem@davemloft.net | 1334349127 |  | Merge git://git.kernel.org/pub/scm/linux/kernel/git/davem/sparc
f | power.c | s | 1.5K | 60 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | audit.c | s | 1.9K | 74 | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | sun4m_smp.c | s | 6.2K | 233 | Linus Torvalds | torvalds@linux-foundation.org | 1337654637 |  | Merge branch 'smp-hotplug-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip  Pull smp hotplug cleanups from Thomas Gleixner:  "This series is merily a cleanup of code copied around in arch/* and   not changing any of the real cpu hotplug horrors yet.  I wish I'd had   something more substantial for 3.5, but I underestimated the lurking   horror..."  Fix up trivial conflicts in arch/{arm,sparc,x86}/Kconfig and arch/sparc/include/asm/thread_info_32.h  * 'smp-hotplug-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip: (79 commits)   um: Remove leftover declaration of alloc_task_struct_node()   task_allocator: Use config switches instead of magic defines   sparc: Use common threadinfo allocator   score: Use common threadinfo allocator   sh-use-common-threadinfo-allocator   mn10300: Use common threadinfo allocator   powerpc: Use common threadinfo allocator   mips: Use common threadinfo allocator   hexagon: Use common threadinfo allocator   m32r: Use common threadinfo allocator   frv: Use common threadinfo allocator   cris: Use common threadinfo allocator   x86: Use common threadinfo allocator   c6x: Use common threadinfo allocator   fork: Provide kmemcache based thread_info allocator   tile: Use common threadinfo allocator   fork: Provide weak arch_release_[task_struct||thread_info] functions   fork: Move thread info gfp flags to header   fork: Remove the weak insanity   sh: Remove cpu_idle_wait()   ...
f | systbls_64.S | g | 12K |  | David Howells | dhowells@redhat.com | 1336730216 |  | KEYS: Use the compat keyctl() syscall wrapper on Sparc64 for Sparc32 compat  Use the 32-bit compat keyctl() syscall wrapper on Sparc64 for Sparc32 binary compatibility.  Without this, keyctl(KEYCTL_INSTANTIATE_IOV) is liable to malfunction as it uses an iovec array read from userspace - though the kernel should survive this as it checks pointers and sizes anyway.  I think all the other keyctl() function should just work, provided (a) the top 32-bits of each 64-bit argument register are cleared prior to invoking the syscall routine, and the 32-bit address space is right at the 0-end of the 64-bit address space.  Most of the arguments are 32-bit anyway, and so for those clearing is not required.  Signed-off-by: David Howells <dhowells@redhat.com cc: "David S. Miller" <davem@davemloft.net> cc: sparclinux@vger.kernel.org cc: stable@vger.kernel.org
f | sparc_ksyms_64.c | s | 1.2K | 44 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | syscalls.S | g | 6.8K |  | David S. Miller | davem@davemloft.net | 1267632529 |  | sparc64: Kill off old sys_perfctr system call and state.  People should be using the perf events interfaces, and the way these system call facilities used the %pcr conflicts with the usage of the NMI watchdog and perf events.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | sparc_ksyms_32.c | s | 643B | 26 | David S. Miller | davem@davemloft.net | 1337027498 |  | sparc32: Implement hard_smp_processor_id() via instruction patching.  This is the last non-trivial user of btfixup.  Like sparc64, use a special patch section to resolve the various implementations of how to read the current CPU's ID when we don't have current_thread_info()->cpu necessarily available.  Signed-off-by: David S. Miller <davem@davemloft.net> Tested-by: Sam Ravnborg <sam@ravnborg.org>
f | prom_common.c | s | 3.5K | 130 | Sam Ravnborg | sam@ravnborg.org | 1338320858 |  | sparc: fix sparc64 build due to leon.h inclusion  Stephen Rothwell <sfr@canb.auug.org.au> reported following error: In file included from arch/sparc/kernel/prom_common.c:26:0: arch/sparc/include/asm/leon.h:221:9: error: unknown type name 'irq_flow_handler_t' arch/sparc/include/asm/leon.h:224:10: error: unknown type name 'irq_flow_handler_t'  Fix this by: 1) Avoid including leon.h in prom_commen.h (not needed) 2) Include irq.h in leon.h to avoid the missing symbol error  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: David S. Miller <davem@davemloft.net>
f | winfixup.S | g | 3.8K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cpumap.h | s | 320B | 14 | Hong H. Pham | hong.pham@windriver.com | 1245153388 |  | sparc64: fix and optimize irq distribution  irq_choose_cpu() should compare the affinity mask against cpu_online_map rather than CPU_MASK_ALL, since irq_select_affinity() sets the interrupt's affinity mask to cpu_online_map "and" CPU_MASK_ALL (which ends up being just cpu_online_map).  The mask comparison in irq_choose_cpu() will always fail since the two masks are not the same.  So the CPU chosen is the first CPU in the intersection of cpu_online_map and CPU_MASK_ALL, which is always CPU0. That means all interrupts are reassigned to CPU0...  Distributing interrupts to CPUs in a linearly increasing round robin fashion is not optimal for the UltraSPARC T1/T2.  Also, the irq_rover in irq_choose_cpu() causes an interrupt to be assigned to a different processor each time the interrupt is allocated and released.  This may lead to an unbalanced distribution over time.  A static mapping of interrupts to processors is done to optimize and balance interrupt distribution.  For the T1/T2, interrupts are spread to different cores first, and then to strands within a core.  The following is some benchmarks showing the effects of interrupt distribution on a T2.  The test was done with iperf using a pair of T5220 boxes, each with a 10GBe NIU (XAUI) connected back to back.    TCP     || Stock       Linear RR IRQ  Optimized IRQ   Streams || 2.6.30-rc5  Distribution   Distribution           || GBits/sec   GBits/sec      GBits/sec   --------+-----------------------------------------     1       0.839       0.862          0.868     8       1.16        4.96           5.88    16       1.15        6.40           8.04   100       1.09        7.28           8.68  Signed-off-by: Hong H. Pham <hong.pham@windriver.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | signal_32.c | s | 15K | 506 | Al Viro | viro@zeniv.linux.org.uk | 1338569932 |  | new helper: signal_delivered()  Does block_sigmask() + tracehook_signal_handler();  called when sigframe has been successfully built.  All architectures converted to it; block_sigmask() itself is gone now (merged into this one).  I'm still not too happy with the signature, but that's a separate story (IMO we need a structure that would contain signal number + siginfo + k_sigaction, so that get_signal_to_deliver() would fill one, signal_delivered(), handle_signal() and probably setup...frame() - take one).  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | sys_sparc_32.c | s | 6.9K | 240 | Al Viro | viro@zeniv.linux.org.uk | 1337659163 |  | sparc: kill ancient comment in sparc_sigaction()  It used to be true, until 2.1.78 (14 years ago) when we switched to do_sigaction()...  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | kprobes.c | s | 15K | 516 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | ttable_64.S | g | 10K |  | Sam Ravnborg | sam@ravnborg.org | 1337495201 |  | sparc64: renamed ttable.S to ttable_64.S  To allow us to add ttable_32.S  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | jump_label.c | s | 794B | 33 | David S. Miller | davem@davemloft.net | 1333086052 |  | sparc: Fix even more fallout from system.h split.  jump_label.c needs asm/cacheflush.h to get flushi(). kgdb_64.c needs asm/cacheflush.h to get flushw_all().  Signed-off-by: David S. Miller <davem@davemloft.net>
f | pci_schizo.c | s | 47K | 1305 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103852 |  | sparc: add export.h to arch/sparc files as required  These files are only exporting symbols, so they don't need the full module.h header file.  Previously they were getting access to EXPORT_SYMBOL implicitly via overuse of module.h from within other .h files, but that is being cleaned up.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | sbus.c | s | 20K | 587 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103852 |  | sparc: add export.h to arch/sparc files as required  These files are only exporting symbols, so they don't need the full module.h header file.  Previously they were getting access to EXPORT_SYMBOL implicitly via overuse of module.h from within other .h files, but that is being cleaned up.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | tadpole.c | s | 2.8K | 111 | Andres Salomon | dilinger@queued.net | 1286613214 |  | of/sparc: convert various prom_* functions to use phandle  Rather than passing around ints everywhere, use the phandle type where appropriate for the various functions that talk to the PROM.  Signed-off-by: Andres Salomon <dilinger@queued.net> Acked-by: David S. Miller <davem@davemloft.net> Signed-off-by: Grant Likely <grant.likely@secretlab.ca>
f | smp_64.c | s | 34K | 1241 | Thomas Gleixner | tglx@linutronix.de | 1335434772 |  | sparc: Use generic idle thread allocation  Signed-off-by: Thomas Gleixner <tglx@linutronix.de> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Rusty Russell <rusty@rustcorp.com.au> Cc: Paul E. McKenney <paulmck@linux.vnet.ibm.com> Cc: Srivatsa S. Bhat <srivatsa.bhat@linux.vnet.ibm.com> Tested-by: David S. Miller <davem@davemloft.net> Link: http://lkml.kernel.org/r/20120420124558.055198736@linutronix.de
f | pcr.c | s | 3.5K | 146 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | viohs.c | s | 17K | 644 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | pci_sun4v.h | s | 3.5K | 88 | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | of_device_32.c | s | 8.9K | 354 | Sam Ravnborg | sam@ravnborg.org | 1334510929 |  | sparc32: rename sparc_irq_config to sparc_config  This struct holds platform specific config and is thus not limited to irq stuff. Do not let the name confuse us to think this is irq only.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | idprom.c | s | 2.7K | 74 | David S. Miller | davem@davemloft.net | 1336794318 |  | sparc: Clear out unused asm/machines.h values.  Remove sun4 and sun4c machine ID values from asm/machines.h  Also kill NUM_SUN_MACHINES, use ARRAY_SIZE instead.  Kill asm/machines.h include and sun4c checks from asm/floppy_32.h  Remove asm/machines.h include from setup_32.c and time_32.c, unused.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | auxio_64.c | s | 3.1K | 127 | David S. Miller | davem@davemloft.net | 1301531876 |  | sparc64: Fix section mis-match errors.  Fix all of the problems spotted by CONFIG_DEBUG_SECTION_MISMATCH under arch/sparc during a 64-bit defconfig build.  They fall into two categorites:  1) of_device_id is marked as __initdata, and we can never do this    since these objects sit in the device core data structures way    past boot.  So even if a driver will never be reloaded, we have    to keep the device ID table around.     Mark such cases const instead.  2) The bootmem alloc/free handling code in mdesc.c was not fully    marked __init as it should be, thus generating a reference    to free_bootmem_late() (which is __init) from non-__init code.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | pci_psycho.c | s | 21K | 541 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103852 |  | sparc: add export.h to arch/sparc files as required  These files are only exporting symbols, so they don't need the full module.h header file.  Previously they were getting access to EXPORT_SYMBOL implicitly via overuse of module.h from within other .h files, but that is being cleaned up.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | psycho_common.c | s | 14K | 411 | Joe Perches | joe@perches.com | 1307487994 |  | sparc: Remove unnecessary semicolons  Semicolons are not necessary after switch/while/for/if braces so remove them.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | helpers.S | g | 1.3K |  | David S. Miller | davem@davemloft.net | 1281330456 |  | sparc64: Fix perf_arch_get_caller_regs().  After b0f82b81fe6bbcf78d478071f33e44554726bc81 ("perf: Drop the skip argument from perf_arch_fetch_regs_caller") the build broke on sparc64 due to the lack of a module symbol export of __perf_arch_fetch_caller_regs.  But that assembler helper can actually be complete eliminated now that the semantics of this interface have been greatly simplified.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | stacktrace.c | s | 2.0K | 74 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | getsetcc.S | g | 475B |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | etrap_32.S | g | 8.1K |  | Sam Ravnborg | sam@ravnborg.org | 1338187969 |  | sparc32: introduce support for run-time patching for all shared assembler code  All users of MMUREGS ASI in kernel/ now uses run-time patching.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | unaligned_32.c | s | 9.2K | 324 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | module.c | s | 5.2K | 198 | David S. Miller | davem@davemloft.net | 1337106227 |  | sparc32: Kill off software 32-bit multiply/divide routines.  For the explicit calls to .udiv/.umul in assembler, I made a mechanical (read as: safe) transformation.  I didn't attempt to make any simplifications.  In particular, __ndelay and __udelay can be simplified significantly. Some of the %y reads are unnecessary and these routines have no need any longer for allocating a register window, they can be leaf functions.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | pci_fire.c | s | 13K | 410 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103852 |  | sparc: add export.h to arch/sparc files as required  These files are only exporting symbols, so they don't need the full module.h header file.  Previously they were getting access to EXPORT_SYMBOL implicitly via overuse of module.h from within other .h files, but that is being cleaned up.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | ptrace_64.c | s | 24K | 958 | Will Drewry | wad@chromium.org | 1334715890 |  | seccomp: ignore secure_computing return values  This change is inspired by   https://lkml.org/lkml/2012/4/16/14 which fixes the build warnings for arches that don't support CONFIG_HAVE_ARCH_SECCOMP_FILTER.  In particular, there is no requirement for the return value of secure_computing() to be checked unless the architecture supports seccomp filter.  Instead of silencing the warnings with (void) a new static inline is added to encode the expected behavior in a compiler and human friendly way.  v2: - cleans things up with a static inline     - removes sfr's signed-off-by since it is a different approach v1: - matches sfr's original change  Reported-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Will Drewry <wad@chromium.org> Acked-by: Kees Cook <keescook@chromium.org> Signed-off-by: James Morris <james.l.morris@oracle.com>
f | chmc.c | s | 20K | 716 | Joe Perches | joe@perches.com | 1307487994 |  | sparc: Remove unnecessary semicolons  Semicolons are not necessary after switch/while/for/if braces so remove them.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | psycho_common.h | s | 1.4K | 40 | Grant Likely | grant.likely@secretlab.ca | 1279987102 |  | sparc: remove references to of_device and to_of_device  of_device is just a #define alias to platform_device.  This patch replaces all references to it with platform_device.  Signed-off-by: Grant Likely <grant.likely@secretlab.ca> Acked-by: David S. Miller <davem@davemloft.net>
f | iommu_common.h | s | 1.5K | 48 | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | sun4m_irq.c | s | 13K | 410 | Sam Ravnborg | sam@ravnborg.org | 1337029508 |  | sparc32: remove remaining users of btfixup  Use sparc_config to hold the last two function pointers.  There was no point generating dedicated _ops structures only for these.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | traps_32.c | s | 12K | 407 | David S. Miller | davem@davemloft.net | 1337106227 |  | sparc32: Kill off software 32-bit multiply/divide routines.  For the explicit calls to .udiv/.umul in assembler, I made a mechanical (read as: safe) transformation.  I didn't attempt to make any simplifications.  In particular, __ndelay and __udelay can be simplified significantly. Some of the %y reads are unnecessary and these routines have no need any longer for allocating a register window, they can be leaf functions.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | pci_msi.c | s | 9.7K | 361 | KOSAKI Motohiro | kosaki.motohiro@jp.fujitsu.com | 1305578287 |  | sparc: convert old cpumask API into new one  Adapt new API. Almost change is trivial, most important change are to remove following like =operator.   cpumask_t cpu_mask = *mm_cpumask(mm);  cpus_allowed = current->cpus_allowed;  Because cpumask_var_t is =operator unsafe. These usage might prevent kernel core improvement.  No functional change.  Signed-off-by: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | systbls.h | s | 1.7K | 39 | Christoph Hellwig | hch@lst.de | 1268437952 |  | improve sys_newuname() for compat architectures  On an architecture that supports 32-bit compat we need to override the reported machine in uname with the 32-bit value.  Instead of doing this separately in every architecture introduce a COMPAT_UTS_MACHINE define in <asm/compat.h> and apply it directly in sys_newuname().  Signed-off-by: Christoph Hellwig <hch@lst.de> Cc: Ralf Baechle <ralf@linux-mips.org> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mundt <lethal@linux-sh.org> Cc: Jeff Dike <jdike@addtoit.com> Cc: Hirokazu Takata <takata@linux-m32r.org> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Ingo Molnar <mingo@elte.hu> Cc: H. Peter Anvin <hpa@zytor.com> Cc: Al Viro <viro@zeniv.linux.org.uk> Cc: Arnd Bergmann <arnd@arndb.de> Cc: Heiko Carstens <heiko.carstens@de.ibm.com> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: "Luck, Tony" <tony.luck@intel.com> Cc: James Morris <jmorris@namei.org> Cc: Andreas Schwab <schwab@linux-m68k.org> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | signal_64.c | s | 17K | 513 | Al Viro | viro@zeniv.linux.org.uk | 1338569932 |  | new helper: signal_delivered()  Does block_sigmask() + tracehook_signal_handler();  called when sigframe has been successfully built.  All architectures converted to it; block_sigmask() itself is gone now (merged into this one).  I'm still not too happy with the signature, but that's a separate story (IMO we need a structure that would contain signal number + siginfo + k_sigaction, so that get_signal_to_deliver() would fill one, signal_delivered(), handle_signal() and probably setup...frame() - take one).  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | process_64.c | s | 20K | 672 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | sys_sparc32.c | s | 15K | 506 | Eric W. Biederman | ebiederm@xmission.com | 1337116115 |  | userns: Convert stat to return values mapped from kuids and kgids  - Store uids and gids with kuid_t and kgid_t in struct kstat - Convert uid and gids to userspace usable values with   from_kuid and from_kgid  Acked-by: Serge Hallyn <serge.hallyn@canonical.com> Signed-off-by: Eric W. Biederman <ebiederm@xmission.com>
f | central.c | s | 6.0K | 227 | David S. Miller | davem@davemloft.net | 1336672846 |  | sparc64: Do not clobber %g2 in xcall_fetch_glob_regs().  %g2 is meant to hold the CPUID number throughout this routine, since at the very beginning, and at the very end, we use %g2 to calculate indexes into per-cpu arrays.  However we erroneously clobber it in order to hold the %cwp register value mid-stream.  Fix this code to use %g3 for the %cwp read and related calulcations instead.  Reported-by: Meelis Roos <mroos@linux.ee> Signed-off-by: David S. Miller <davem@davemloft.net>
f | cpu.c | s | 11K | 478 | Sam Ravnborg | sam@ravnborg.org | 1338187965 |  | sparc32: handle leon in cpu.c  A few hardcoded constant were replaced by symbolic versions to improve readability  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | vio.c | s | 10K | 378 | Anatol Pomozov | anatol.pomozov@gmail.com | 1340561032 |  | Fix typo in printed messages  Coult -> Could  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | kgdb_64.c | s | 4.3K | 157 | David S. Miller | davem@davemloft.net | 1333086052 |  | sparc: Fix even more fallout from system.h split.  jump_label.c needs asm/cacheflush.h to get flushi(). kgdb_64.c needs asm/cacheflush.h to get flushw_all().  Signed-off-by: David S. Miller <davem@davemloft.net>
f | etrap_64.S | g | 5.5K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | leon_kernel.c | s | 13K | 446 | Sam Ravnborg | sam@ravnborg.org | 1338187965 |  | sparc32,leon: clean up leon.h  - Drop unused stuff accumulated over time - Drop non-leon stuff - Include almost all of the header unconditionally  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | irq_32.c | s | 8.6K | 300 | Sam Ravnborg | sam@ravnborg.org | 1338187964 |  | sparc32: handle leon in irq_32.c  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | kstack.h | s | 2.1K | 68 | David S. Miller | davem@davemloft.net | 1271235869 |  | sparc64: Run NMIs on the hardirq stack.  Otherwise we can overflow the main stack with the function tracer enabled.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | sigutil.h | s | 326B | 7 | David S. Miller | davem@davemloft.net | 1313885694 |  | sparc: Allow handling signals when stack is corrupted.  If we can't push the pending register windows onto the user's stack, we disallow signal delivery even if the signal would be delivered on a valid seperate signal stack.  Add a register window save area in the signal frame, and store any unsavable windows there.  On sigreturn, if any windows are still queued up in the signal frame, try to push them back onto the stack and if that fails we kill the process immediately.  This allows the debug/tst-longjmp_chk2 glibc test case to pass.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | sun4d_irq.c | s | 12K | 436 | Sam Ravnborg | sam@ravnborg.org | 1337029508 |  | sparc32: remove remaining users of btfixup  Use sparc_config to hold the last two function pointers.  There was no point generating dedicated _ops structures only for these.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | pci_sun4v.c | s | 23K | 815 | Andrzej Pietrasiewicz | andrzej.p@samsung.com | 1332945394 |  | SPARC: adapt for dma_map_ops changes  Adapt core SPARC architecture code for dma_map_ops changes: replace alloc/free_coherent with generic alloc/free methods.  Signed-off-by: Andrzej Pietrasiewicz <andrzej.p@samsung.com> Acked-by: Kyungmin Park <kyungmin.park@samsung.com> Signed-off-by: Marek Szyprowski <m.szyprowski@samsung.com> Reviewed-by: Arnd Bergmann <arnd@arndb.de> Acked-by: David S. Miller <davem@davemloft.net>
f | kgdb_32.c | s | 3.7K | 139 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | una_asm_64.S | g | 3.0K |  | Ben Hutchings | ben@decadent.org.uk | 1300324755 |  | sparc: Fix .size directive for do_int_load  gas used to accept (and ignore?) .size directives which referred to undefined symbols, as this does.  In binutils 2.21 these are treated as errors.  Signed-off-by: Ben Hutchings <ben@decadent.org.uk> Signed-off-by: David S. Miller <davem@davemloft.net>
f | systbls_32.S | g | 6.3K |  | David S. Miller | davem@davemloft.net | 1320133890 |  | sparc: Hook up process_vm_{readv,writev} syscalls.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | entry.h | s | 9.3K | 214 | David S. Miller | davem@davemloft.net | 1321598698 |  | sparc64: Patch sun4v code sequences properly on module load.  Some of the sun4v code patching occurs in inline functions visible to, and usable by, modules.  Therefore we have to patch them up during module load.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | prom_32.c | s | 7.5K | 283 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103854 |  | sparc: remove several unnecessary module.h include instances  Building an allyesconfig doesn't reveal a hidden need for any of these.  Since module.h brings in the whole kitchen sink, it just needlessly adds 30k+ lines to the cpp burden.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | cherrs.S | g | 14K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | leon_smp.c | s | 12K | 417 | Sam Ravnborg | sam@ravnborg.org | 1338187968 |  | sparc32,leon: fix section mismatch warning  Fix following warning:  WARNING: arch/sparc/kernel/built-in.o(.cpuinit.text+0x9f4): Section mismatch in reference from the function leon_callin() to the function .init.text:leon_configure_cache_smp() The function __cpuinit leon_callin() references a function __init leon_configure_cache_smp(). If leon_configure_cache_smp is only used by leon_callin then annotate leon_configure_cache_smp with a matching annotation.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | hvapi.c | s | 4.4K | 175 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | reboot.c | s | 1015B | 44 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | ttable_32.S | g | 20K |  | Sam Ravnborg | sam@ravnborg.org | 1337495245 |  | sparc32: move trap table to a separate file  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | sys_sparc_64.c | s | 18K | 662 | Al Viro | viro@zeniv.linux.org.uk | 1338426296 |  | ia64, sparc64: convert wrappers around do_mremap() to sys_mremap()  they contain open-coded sys_mremap()  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
f | pci_common.c | s | 12K | 472 | Joe Perches | joe@perches.com | 1307487994 |  | sparc: Remove unnecessary semicolons  Semicolons are not necessary after switch/while/for/if braces so remove them.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | prom_irqtrans.c | s | 21K | 705 | Joe Perches | joe@perches.com | 1307487994 |  | sparc: Remove unnecessary semicolons  Semicolons are not necessary after switch/while/for/if braces so remove them.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | sysfs.c | s | 8.8K | 264 | Kay Sievers | kay.sievers@vrfy.org | 1324506582 |  | cpu: convert 'cpu' and 'machinecheck' sysdev_class to a regular subsystem  This moves the 'cpu sysdev_class' over to a regular 'cpu' subsystem and converts the devices to regular devices. The sysdev drivers are implemented as subsystem interfaces now.  After all sysdev classes are ported to regular driver core entities, the sysdev implementation will be entirely removed from the kernel.  Userspace relies on events and generic sysfs subsystem infrastructure from sysdev devices, which are made available with this conversion.  Cc: Haavard Skinnemoen <hskinnemoen@gmail.com> Cc: Hans-Christian Egtvedt <egtvedt@samfundet.no> Cc: Tony Luck <tony.luck@intel.com> Cc: Fenghua Yu <fenghua.yu@intel.com> Cc: Arnd Bergmann <arnd@arndb.de> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Paul Mackerras <paulus@samba.org> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: Heiko Carstens <heiko.carstens@de.ibm.com> Cc: Paul Mundt <lethal@linux-sh.org> Cc: "David S. Miller" <davem@davemloft.net> Cc: Chris Metcalf <cmetcalf@tilera.com> Cc: Thomas Gleixner <tglx@linutronix.de> Cc: Ingo Molnar <mingo@redhat.com> Cc: "H. Peter Anvin" <hpa@zytor.com> Cc: Borislav Petkov <bp@amd64.org> Cc: Tigran Aivazian <tigran@aivazian.fsnet.co.uk> Cc: Len Brown <lenb@kernel.org> Cc: Zhang Rui <rui.zhang@intel.com> Cc: Dave Jones <davej@redhat.com> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Russell King <rmk+kernel@arm.linux.org.uk> Cc: Andrew Morton <akpm@linux-foundation.org> Cc: Arjan van de Ven <arjan@linux.intel.com> Cc: "Rafael J. Wysocki" <rjw@sisk.pl> Cc: "Srivatsa S. Bhat" <srivatsa.bhat@linux.vnet.ibm.com> Signed-off-by: Kay Sievers <kay.sievers@vrfy.org> Signed-off-by: Greg Kroah-Hartman <gregkh@suse.de>
f | irq.h | s | 2.4K | 69 | Sam Ravnborg | sam@ravnborg.org | 1337029509 |  | sparc32: remove runtime btfix support  - remove all uses of btfixup header - remove the btfixup header - remove the btfixup code  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | of_device_64.c | s | 15K | 604 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | sstate.c | s | 2.6K | 93 | David S. Miller | davem@davemloft.net | 1312345732 |  | sparc: Set reboot-cmd using reboot data hypervisor call if available.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | una_asm_32.S | g | 2.9K |  | Daniel Hellstrom | daniel@gaisler.com | 1296592799 |  | sparc32: unaligned memory access (MNA) trap handler bug  Since commit f0e98c387e61de00646be31fab4c2fa0224e1efb ("[SPARC]: Fix link errors with gcc-4.3") the MNA trap handler does not emulate stores to unaligned addresses correctly. MNA operation from both kernel and user space are affected.  A typical effect of this bug is nr_frags in skbs are overwritten during buffer copying/checksum-calculation, or maximally 6 bytes of data in the network buffer will be overwitten with garbage.  Signed-off-by: Daniel Hellstrom <daniel@gaisler.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | head_32.S | g | 19K |  | Sam Ravnborg | sam@ravnborg.org | 1338320857 |  | sparc32: remove unused variable in head_32.S  It was assigned, but never referenced later.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | sun4d_smp.c | s | 9.8K | 343 | Linus Torvalds | torvalds@linux-foundation.org | 1337654637 |  | Merge branch 'smp-hotplug-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip  Pull smp hotplug cleanups from Thomas Gleixner:  "This series is merily a cleanup of code copied around in arch/* and   not changing any of the real cpu hotplug horrors yet.  I wish I'd had   something more substantial for 3.5, but I underestimated the lurking   horror..."  Fix up trivial conflicts in arch/{arm,sparc,x86}/Kconfig and arch/sparc/include/asm/thread_info_32.h  * 'smp-hotplug-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip: (79 commits)   um: Remove leftover declaration of alloc_task_struct_node()   task_allocator: Use config switches instead of magic defines   sparc: Use common threadinfo allocator   score: Use common threadinfo allocator   sh-use-common-threadinfo-allocator   mn10300: Use common threadinfo allocator   powerpc: Use common threadinfo allocator   mips: Use common threadinfo allocator   hexagon: Use common threadinfo allocator   m32r: Use common threadinfo allocator   frv: Use common threadinfo allocator   cris: Use common threadinfo allocator   x86: Use common threadinfo allocator   c6x: Use common threadinfo allocator   fork: Provide kmemcache based thread_info allocator   tile: Use common threadinfo allocator   fork: Provide weak arch_release_[task_struct||thread_info] functions   fork: Move thread info gfp flags to header   fork: Remove the weak insanity   sh: Remove cpu_idle_wait()   ...
f | cpumap.c | s | 10K | 359 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | utrap.S | g | 576B |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | sigutil_64.c | s | 2.5K | 81 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | btext.c | s | 31K | 630 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103854 |  | sparc: remove several unnecessary module.h include instances  Building an allyesconfig doesn't reveal a hidden need for any of these.  Since module.h brings in the whole kitchen sink, it just needlessly adds 30k+ lines to the cpp burden.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | pci_impl.h | s | 5.3K | 151 | Sam Ravnborg | sam@ravnborg.org | 1300324743 |  | sparc64: rename virt_irq => irq - II  The generic irq support uses the term 'irq' for the allocated irq number. Fix it so sparc64 use the same term for an irq as the generic irq support does. For a naive reader this is less confusing.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | sun4v_tlb_miss.S | g | 10K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | entry.S | s | 28K | 1183 | Sam Ravnborg | sam@ravnborg.org | 1338187969 |  | sparc32: introduce support for run-time patching for all shared assembler code  All users of MMUREGS ASI in kernel/ now uses run-time patching.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | smp_32.c | s | 6.4K | 272 | Linus Torvalds | torvalds@linux-foundation.org | 1337654637 |  | Merge branch 'smp-hotplug-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip  Pull smp hotplug cleanups from Thomas Gleixner:  "This series is merily a cleanup of code copied around in arch/* and   not changing any of the real cpu hotplug horrors yet.  I wish I'd had   something more substantial for 3.5, but I underestimated the lurking   horror..."  Fix up trivial conflicts in arch/{arm,sparc,x86}/Kconfig and arch/sparc/include/asm/thread_info_32.h  * 'smp-hotplug-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip: (79 commits)   um: Remove leftover declaration of alloc_task_struct_node()   task_allocator: Use config switches instead of magic defines   sparc: Use common threadinfo allocator   score: Use common threadinfo allocator   sh-use-common-threadinfo-allocator   mn10300: Use common threadinfo allocator   powerpc: Use common threadinfo allocator   mips: Use common threadinfo allocator   hexagon: Use common threadinfo allocator   m32r: Use common threadinfo allocator   frv: Use common threadinfo allocator   cris: Use common threadinfo allocator   x86: Use common threadinfo allocator   c6x: Use common threadinfo allocator   fork: Provide kmemcache based thread_info allocator   tile: Use common threadinfo allocator   fork: Provide weak arch_release_[task_struct||thread_info] functions   fork: Move thread info gfp flags to header   fork: Remove the weak insanity   sh: Remove cpu_idle_wait()   ...
f | leon_pci.c | s | 4.8K | 182 | Sam Ravnborg | sam@ravnborg.org | 1333579479 |  | sparc32,leon: fix leon build  Minimal fix to allow leon to be built.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Konrad Eisele <konrad@gaisler.com> Cc: Daniel Hellstrom <daniel@gaisler.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | head_64.S | g | 22K |  | Sam Ravnborg | sam@ravnborg.org | 1337495201 |  | sparc64: renamed ttable.S to ttable_64.S  To allow us to add ttable_32.S  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | kernel.h | s | 2.3K | 68 | Sam Ravnborg | sam@ravnborg.org | 1338187962 |  | sparc32: introduce sparc32_start_kernel called from head_32.S  This gives us a C hook before we call start_kernel()  Signed-off-by: Sam Ravnborg <sam@ravnborg.org>
f | rtrap_32.S | g | 5.6K |  | Sam Ravnborg | sam@ravnborg.org | 1338187969 |  | sparc32: introduce support for run-time patching for all shared assembler code  All users of MMUREGS ASI in kernel/ now uses run-time patching.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | leon_pmc.c | s | 1.9K | 73 | Sam Ravnborg | sam@ravnborg.org | 1338187973 |  | sparc32,leon: always include leon_pmc in build  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | dtlb_miss.S | g | 747B |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | ktlb.S | g | 7.2K |  | David S. Miller | davem@davemloft.net | 1312530837 |  | sparc: Access kernel TSB using physical addressing when possible.  On sun4v this is basically required since we point the hypervisor and the TSB walking hardware at these tables using physical addressing too.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | ftrace.c | s | 3.3K | 119 | David S. Miller | davem@davemloft.net | 1271137046 |  | sparc64: Add function graph tracer support.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | fpu_traps.S | g | 8.1K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | of_device_common.h | s | 1.1K | 30 | Robert Reif | reif@earthlink.net | 1245153409 |  | sparc: move of_device common code to of_device_common  This patch moves code common to of_device_32.c and of_device_64.c into of_device_common.h and of_device_common.c.  The only functional difference is in sparc32 where of_bus_default_map is used in place of of_bus_sbus_map because they are equivelent.  There is still room for further code consolidation with some minor refactoring.  Boot tested on sparc32 and compile tested on sparc64.  Signed-off-by: Robert Reif <reif@earthlink.net> Signed-off-by: David S. Miller <davem@davemloft.net>
f | mdesc.c | s | 20K | 776 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103852 |  | sparc: add export.h to arch/sparc files as required  These files are only exporting symbols, so they don't need the full module.h header file.  Previously they were getting access to EXPORT_SYMBOL implicitly via overuse of module.h from within other .h files, but that is being cleaned up.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | time_64.c | s | 19K | 697 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103853 |  | sparc: move symbol exporters to use export.h not module.h  Many of the core sparc kernel files are not modules, but just including module.h for exporting symbols.  Now these files can use the lighter footprint export.h for this role.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | us2e_cpufreq.c | s | 9.6K | 333 | Joe Perches | joe@perches.com | 1307487994 |  | sparc: Remove unnecessary semicolons  Semicolons are not necessary after switch/while/for/if braces so remove them.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | itlb_miss.S | g | 854B |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | traps_64.c | s | 74K | 2280 | David S. Miller | davem@davemloft.net | 1337931116 |  | sparc64: Fix several bugs in quad floating point emulation.  UltraSPARC-T2 and later do not use the fp_exception_other trap and do not set the floating point trap type field in the %fsr at all when you try to execute an unimplemented FPU operation.  Instead, it uses the illegal_instruction trap and it leaves the floating point trap type field clear.  So we should not validate the %fsr trap type field when do_mathemu() is invoked from the illegal instruction handler.  Also, the floating point trap type field is 3 bits, not 4 bits.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | led.c | s | 3.1K | 120 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | pci_sun4v_asm.S | g | 6.2K |  | Sam Ravnborg | sam@ravnborg.org | 1228411041 |  | sparc,sparc64: unify kernel/  o Move all files from sparc64/kernel/ to sparc/kernel   - rename as appropriate o Update sparc/Makefile to the changes o Update sparc/kernel/Makefile to include the sparc64 files  NOTE: This commit changes link order on sparc64!  Link order had to change for either of sparc32 and sparc64. And assuming sparc64 see more testing than sparc32 change link order on sparc64 where issues will be caught faster.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
