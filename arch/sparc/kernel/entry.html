<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › sparc › kernel › entry.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>entry.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ENTRY_H</span>
<span class="cp">#define _ENTRY_H</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>

<span class="cm">/* irq */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">handler_irq</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_SPARC32</span>
<span class="cm">/* traps */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_hw_interrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_illegal_instruction</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span><span class="p">,</span>
                                   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">npc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psr</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_priv_instruction</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span><span class="p">,</span>
                                <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">npc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_memaccess_unaligned</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span><span class="p">,</span>
                                   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">npc</span><span class="p">,</span>
                                   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_fpd_trap</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span><span class="p">,</span>
                        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">npc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_fpe_trap</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span><span class="p">,</span>
                        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">npc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">handle_tag_overflow</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span><span class="p">,</span>
                                <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">npc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">handle_watchpoint</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span><span class="p">,</span>
                              <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">npc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">handle_reg_access</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span><span class="p">,</span>
                              <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">npc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">handle_cp_disabled</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span><span class="p">,</span>
                               <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">npc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">handle_cp_exception</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pc</span><span class="p">,</span>
                                <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">npc</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psr</span><span class="p">);</span>



<span class="cm">/* entry.S */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fpsave</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">fpregs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">fsr</span><span class="p">,</span>
                   <span class="kt">void</span> <span class="o">*</span><span class="n">fpqueue</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">fpqdepth</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">fpload</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">fpregs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">fsr</span><span class="p">);</span>

<span class="cp">#else </span><span class="cm">/* CONFIG_SPARC32 */</span><span class="cp"></span>

<span class="cp">#include &lt;asm/trap_block.h&gt;</span>

<span class="k">struct</span> <span class="n">popc_3insn_patch_entry</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">insns</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">};</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">popc_3insn_patch_entry</span> <span class="n">__popc_3insn_patch</span><span class="p">,</span>
	<span class="n">__popc_3insn_patch_end</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">popc_6insn_patch_entry</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>	<span class="n">insns</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">};</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">popc_6insn_patch_entry</span> <span class="n">__popc_6insn_patch</span><span class="p">,</span>
	<span class="n">__popc_6insn_patch_end</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">per_cpu_patch</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_patch_1insn_range</span><span class="p">(</span><span class="k">struct</span> <span class="n">sun4v_1insn_patch_entry</span> <span class="o">*</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">sun4v_1insn_patch_entry</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_patch_2insn_range</span><span class="p">(</span><span class="k">struct</span> <span class="n">sun4v_2insn_patch_entry</span> <span class="o">*</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">sun4v_2insn_patch_entry</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">sun4v_patch</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">boot_cpu_id_too_large</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">dcache_parity_tl1_occurred</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">icache_parity_tl1_occurred</span><span class="p">;</span>

<span class="k">extern</span> <span class="n">asmlinkage</span> <span class="kt">void</span> <span class="n">sparc_breakpoint</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">timer_interrupt</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_notify_resume</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
			     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">orig_i0</span><span class="p">,</span>
			     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">thread_info_flags</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">asmlinkage</span> <span class="kt">int</span> <span class="n">syscall_trace_enter</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">asmlinkage</span> <span class="kt">void</span> <span class="n">syscall_trace_leave</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">bad_trap_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">long</span> <span class="n">lvl</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_fpe_common</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_fpieee</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_fpother</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_tof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_div0</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_illegal_instruction</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mem_address_unaligned</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sfar</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sfsr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_do_mna</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
			 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span>
			 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type_ctx</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_privop</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_privact</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_cee</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_cee_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_dae_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_iae_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_div0_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_fpdis_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_fpieee_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_fpother_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_ill_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_irq_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_lddfmna_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_stdfmna_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_paw</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_paw_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_vaw</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_vaw_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_tof_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">do_getpsr</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">spitfire_insn_access_exception</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
					   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sfsr</span><span class="p">,</span>
					   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sfar</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">spitfire_insn_access_exception_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
					       <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sfsr</span><span class="p">,</span>
					       <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sfar</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">spitfire_data_access_exception</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
					   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sfsr</span><span class="p">,</span>
					   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sfar</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">spitfire_data_access_exception_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
					       <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sfsr</span><span class="p">,</span>
					       <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sfar</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">spitfire_access_error</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">status_encoded</span><span class="p">,</span>
				  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">afar</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">cheetah_fecc_handler</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
				 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">afsr</span><span class="p">,</span>
				 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">afar</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cheetah_cee_handler</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">afsr</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">afar</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cheetah_deferred_handler</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
				     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">afsr</span><span class="p">,</span>
				     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">afar</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cheetah_plus_parity_error</span><span class="p">(</span><span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_insn_access_exception</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type_ctx</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_insn_access_exception_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type_ctx</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_data_access_exception</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type_ctx</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_data_access_exception_tl1</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type_ctx</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_resum_error</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
			      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_resum_overflow</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_nonresum_error</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span>
				 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_nonresum_overflow</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sun4v_err_itlb_vaddr</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sun4v_err_itlb_ctx</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sun4v_err_itlb_pte</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sun4v_err_itlb_error</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_itlb_error_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tl</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sun4v_err_dtlb_vaddr</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sun4v_err_dtlb_ctx</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sun4v_err_dtlb_pte</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sun4v_err_dtlb_error</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">sun4v_dtlb_error_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tl</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">hypervisor_tlbop_error</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">err</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">op</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">hypervisor_tlbop_error_xcall</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">err</span><span class="p">,</span>
					 <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">op</span><span class="p">);</span>

<span class="cm">/* WARNING: The error trap handlers in assembly know the precise</span>
<span class="cm"> *	    layout of the following structure.</span>
<span class="cm"> *</span>
<span class="cm"> * C-level handlers in traps.c use this information to log the</span>
<span class="cm"> * error and then determine how to recover (if possible).</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">cheetah_err_info</span> <span class="p">{</span>
<span class="cm">/*0x00*/</span><span class="n">u64</span> <span class="n">afsr</span><span class="p">;</span>
<span class="cm">/*0x08*/</span><span class="n">u64</span> <span class="n">afar</span><span class="p">;</span>

	<span class="cm">/* D-cache state */</span>
<span class="cm">/*0x10*/</span><span class="n">u64</span> <span class="n">dcache_data</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* The actual data	*/</span>
<span class="cm">/*0x30*/</span><span class="n">u64</span> <span class="n">dcache_index</span><span class="p">;</span>	<span class="cm">/* D-cache index	*/</span>
<span class="cm">/*0x38*/</span><span class="n">u64</span> <span class="n">dcache_tag</span><span class="p">;</span>		<span class="cm">/* D-cache tag/valid	*/</span>
<span class="cm">/*0x40*/</span><span class="n">u64</span> <span class="n">dcache_utag</span><span class="p">;</span>	<span class="cm">/* D-cache microtag	*/</span>
<span class="cm">/*0x48*/</span><span class="n">u64</span> <span class="n">dcache_stag</span><span class="p">;</span>	<span class="cm">/* D-cache snooptag	*/</span>

	<span class="cm">/* I-cache state */</span>
<span class="cm">/*0x50*/</span><span class="n">u64</span> <span class="n">icache_data</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>	<span class="cm">/* The actual insns + predecode	*/</span>
<span class="cm">/*0x90*/</span><span class="n">u64</span> <span class="n">icache_index</span><span class="p">;</span>	<span class="cm">/* I-cache index	*/</span>
<span class="cm">/*0x98*/</span><span class="n">u64</span> <span class="n">icache_tag</span><span class="p">;</span>		<span class="cm">/* I-cache phys tag	*/</span>
<span class="cm">/*0xa0*/</span><span class="n">u64</span> <span class="n">icache_utag</span><span class="p">;</span>	<span class="cm">/* I-cache microtag	*/</span>
<span class="cm">/*0xa8*/</span><span class="n">u64</span> <span class="n">icache_stag</span><span class="p">;</span>	<span class="cm">/* I-cache snooptag	*/</span>
<span class="cm">/*0xb0*/</span><span class="n">u64</span> <span class="n">icache_upper</span><span class="p">;</span>	<span class="cm">/* I-cache upper-tag	*/</span>
<span class="cm">/*0xb8*/</span><span class="n">u64</span> <span class="n">icache_lower</span><span class="p">;</span>	<span class="cm">/* I-cache lower-tag	*/</span>

	<span class="cm">/* E-cache state */</span>
<span class="cm">/*0xc0*/</span><span class="n">u64</span> <span class="n">ecache_data</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* 32 bytes from staging registers */</span>
<span class="cm">/*0xe0*/</span><span class="n">u64</span> <span class="n">ecache_index</span><span class="p">;</span>	<span class="cm">/* E-cache index	*/</span>
<span class="cm">/*0xe8*/</span><span class="n">u64</span> <span class="n">ecache_tag</span><span class="p">;</span>		<span class="cm">/* E-cache tag/state	*/</span>

<span class="cm">/*0xf0*/</span><span class="n">u64</span> <span class="n">__pad</span><span class="p">[</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">30</span><span class="p">];</span>
<span class="p">};</span>
<span class="cp">#define CHAFSR_INVALID		((u64)-1L)</span>

<span class="cm">/* This is allocated at boot time based upon the largest hardware</span>
<span class="cm"> * cpu ID in the system.  We allocate two entries per cpu, one for</span>
<span class="cm"> * TL==0 logging and one for TL &gt;= 1 logging.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">cheetah_err_info</span> <span class="o">*</span><span class="n">cheetah_error_log</span><span class="p">;</span>

<span class="cm">/* UPA nodes send interrupt packet to UltraSparc with first data reg</span>
<span class="cm"> * value low 5 (7 on Starfire) bits holding the IRQ identifier being</span>
<span class="cm"> * delivered.  We must translate this into a non-vector IRQ so we can</span>
<span class="cm"> * set the softint on this cpu.</span>
<span class="cm"> *</span>
<span class="cm"> * To make processing these packets efficient and race free we use</span>
<span class="cm"> * an array of irq buckets below.  The interrupt vector handler in</span>
<span class="cm"> * entry.S feeds incoming packets into per-cpu pil-indexed lists.</span>
<span class="cm"> *</span>
<span class="cm"> * If you make changes to ino_bucket, please update hand coded assembler</span>
<span class="cm"> * of the vectored interrupt trap handler(s) in entry.S and sun4v_ivec.S</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ino_bucket</span> <span class="p">{</span>
<span class="cm">/*0x00*/</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__irq_chain_pa</span><span class="p">;</span>

	<span class="cm">/* Interrupt number assigned to this INO.  */</span>
<span class="cm">/*0x08*/</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">__irq</span><span class="p">;</span>
<span class="cm">/*0x0c*/</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">__pad</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">ino_bucket</span> <span class="o">*</span><span class="n">ivector_table</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ivector_table_pa</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">init_irqwork_curcpu</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__cpuinit</span> <span class="n">sun4v_register_mondo_queues</span><span class="p">(</span><span class="kt">int</span> <span class="n">this_cpu</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_SPARC32 */</span><span class="cp"></span>
<span class="cp">#endif </span><span class="cm">/* _ENTRY_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
