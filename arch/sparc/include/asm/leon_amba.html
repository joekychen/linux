<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › sparc › include › asm › leon_amba.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>leon_amba.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">*Copyright (C) 2004 Konrad Eisele (eiselekd@web.de,konrad@gaisler.com), Gaisler Research</span>
<span class="cm">*Copyright (C) 2004 Stefan Holst (mail@s-holst.de), Uni-Stuttgart</span>
<span class="cm">*Copyright (C) 2009 Daniel Hellstrom (daniel@gaisler.com),Konrad Eisele (konrad@gaisler.com) Aeroflex Gaisler AB</span>
<span class="cm">*/</span>

<span class="cp">#ifndef LEON_AMBA_H_INCLUDE</span>
<span class="cp">#define LEON_AMBA_H_INCLUDE</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">struct</span> <span class="n">amba_prom_registers</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">phys_addr</span><span class="p">;</span>	<span class="cm">/* The physical address of this register */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg_size</span><span class="p">;</span>	<span class="cm">/* How many bytes does this register take up? */</span>
<span class="p">};</span>

<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> *  The following defines the bits in the LEON UART Status Registers.</span>
<span class="cm"> */</span>

<span class="cp">#define LEON_REG_UART_STATUS_DR   0x00000001	</span><span class="cm">/* Data Ready */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_STATUS_TSE  0x00000002	</span><span class="cm">/* TX Send Register Empty */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_STATUS_THE  0x00000004	</span><span class="cm">/* TX Hold Register Empty */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_STATUS_BR   0x00000008	</span><span class="cm">/* Break Error */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_STATUS_OE   0x00000010	</span><span class="cm">/* RX Overrun Error */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_STATUS_PE   0x00000020	</span><span class="cm">/* RX Parity Error */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_STATUS_FE   0x00000040	</span><span class="cm">/* RX Framing Error */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_STATUS_ERR  0x00000078	</span><span class="cm">/* Error Mask */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *  The following defines the bits in the LEON UART Ctrl Registers.</span>
<span class="cm"> */</span>

<span class="cp">#define LEON_REG_UART_CTRL_RE     0x00000001	</span><span class="cm">/* Receiver enable */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_CTRL_TE     0x00000002	</span><span class="cm">/* Transmitter enable */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_CTRL_RI     0x00000004	</span><span class="cm">/* Receiver interrupt enable */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_CTRL_TI     0x00000008	</span><span class="cm">/* Transmitter irq */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_CTRL_PS     0x00000010	</span><span class="cm">/* Parity select */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_CTRL_PE     0x00000020	</span><span class="cm">/* Parity enable */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_CTRL_FL     0x00000040	</span><span class="cm">/* Flow control enable */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_UART_CTRL_LB     0x00000080	</span><span class="cm">/* Loop Back enable */</span><span class="cp"></span>

<span class="cp">#define LEON3_GPTIMER_EN 1</span>
<span class="cp">#define LEON3_GPTIMER_RL 2</span>
<span class="cp">#define LEON3_GPTIMER_LD 4</span>
<span class="cp">#define LEON3_GPTIMER_IRQEN 8</span>
<span class="cp">#define LEON3_GPTIMER_SEPIRQ 8</span>

<span class="cp">#define LEON23_REG_TIMER_CONTROL_EN    0x00000001 </span><span class="cm">/* 1 = enable counting */</span><span class="cp"></span>
<span class="cm">/* 0 = hold scalar and counter */</span>
<span class="cp">#define LEON23_REG_TIMER_CONTROL_RL    0x00000002 </span><span class="cm">/* 1 = reload at 0 */</span><span class="cp"></span>
						  <span class="cm">/* 0 = stop at 0 */</span>
<span class="cp">#define LEON23_REG_TIMER_CONTROL_LD    0x00000004 </span><span class="cm">/* 1 = load counter */</span><span class="cp"></span>
						  <span class="cm">/* 0 = no function */</span>
<span class="cp">#define LEON23_REG_TIMER_CONTROL_IQ    0x00000008 </span><span class="cm">/* 1 = irq enable */</span><span class="cp"></span>
						  <span class="cm">/* 0 = no function */</span>

<span class="cm">/*</span>
<span class="cm"> *  The following defines the bits in the LEON PS/2 Status Registers.</span>
<span class="cm"> */</span>

<span class="cp">#define LEON_REG_PS2_STATUS_DR   0x00000001	</span><span class="cm">/* Data Ready */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_PS2_STATUS_PE   0x00000002	</span><span class="cm">/* Parity error */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_PS2_STATUS_FE   0x00000004	</span><span class="cm">/* Framing error */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_PS2_STATUS_KI   0x00000008	</span><span class="cm">/* Keyboard inhibit */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_PS2_STATUS_RF   0x00000010	</span><span class="cm">/* RX buffer full */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_PS2_STATUS_TF   0x00000020	</span><span class="cm">/* TX buffer full */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> *  The following defines the bits in the LEON PS/2 Ctrl Registers.</span>
<span class="cm"> */</span>

<span class="cp">#define LEON_REG_PS2_CTRL_RE 0x00000001	</span><span class="cm">/* Receiver enable */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_PS2_CTRL_TE 0x00000002	</span><span class="cm">/* Transmitter enable */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_PS2_CTRL_RI 0x00000004	</span><span class="cm">/* Keyboard receive irq  */</span><span class="cp"></span>
<span class="cp">#define LEON_REG_PS2_CTRL_TI 0x00000008	</span><span class="cm">/* Keyboard transmit irq */</span><span class="cp"></span>

<span class="cp">#define LEON3_IRQMPSTATUS_CPUNR     28</span>
<span class="cp">#define LEON3_IRQMPSTATUS_BROADCAST 27</span>

<span class="cp">#define GPTIMER_CONFIG_IRQNT(a)          (((a) &gt;&gt; 3) &amp; 0x1f)</span>
<span class="cp">#define GPTIMER_CONFIG_ISSEP(a)          ((a) &amp; (1 &lt;&lt; 8))</span>
<span class="cp">#define GPTIMER_CONFIG_NTIMERS(a)        ((a) &amp; (0x7))</span>
<span class="cp">#define LEON3_GPTIMER_CTRL_PENDING       0x10</span>
<span class="cp">#define LEON3_GPTIMER_CONFIG_NRTIMERS(c) ((c)-&gt;config &amp; 0x7)</span>
<span class="cp">#define LEON3_GPTIMER_CTRL_ISPENDING(r)  (((r)&amp;LEON3_GPTIMER_CTRL_PENDING) ? 1 : 0)</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">struct</span> <span class="n">leon3_irqctrl_regs_map</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">ilevel</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ipend</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">iforce</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">iclear</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mpstatus</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mpbroadcast</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">notused02</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">notused03</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ampctrl</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">icsel</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">notused13</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">notused20</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">notused21</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">notused22</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">notused23</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">mask</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">force</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="cm">/* Extended IRQ registers */</span>
	<span class="n">u32</span> <span class="n">intid</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>	<span class="cm">/* 0xc0 */</span>
	<span class="n">u32</span> <span class="n">unused</span><span class="p">[(</span><span class="mh">0x1000</span><span class="o">-</span><span class="mh">0x100</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">leon3_apbuart_regs_map</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">data</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ctrl</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">scaler</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">leon3_gptimerelem_regs_map</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rld</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ctrl</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">unused</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">leon3_gptimer_regs_map</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">scalar</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">scalar_reload</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">config</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">unused</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">leon3_gptimerelem_regs_map</span> <span class="n">e</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *  Types and structure used for AMBA Plug &amp; Play bus scanning</span>
<span class="cm"> */</span>

<span class="cp">#define AMBA_MAXAPB_DEVS 64</span>
<span class="cp">#define AMBA_MAXAPB_DEVS_PERBUS 16</span>

<span class="k">struct</span> <span class="n">amba_device_table</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">devnr</span><span class="p">;</span>		   <span class="cm">/* number of devices on AHB or APB bus */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">addr</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>    <span class="cm">/* addresses to the devices configuration tables */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">allocbits</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="cm">/* 0=unallocated, 1=allocated driver */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">amba_apbslv_device_table</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">devnr</span><span class="p">;</span>		                  <span class="cm">/* number of devices on AHB or APB bus */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">addr</span><span class="p">[</span><span class="n">AMBA_MAXAPB_DEVS</span><span class="p">];</span>     <span class="cm">/* addresses to the devices configuration tables */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">apbmst</span><span class="p">[</span><span class="n">AMBA_MAXAPB_DEVS</span><span class="p">];</span>    <span class="cm">/* apb master if a entry is a apb slave */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">apbmstidx</span><span class="p">[</span><span class="n">AMBA_MAXAPB_DEVS</span><span class="p">];</span> <span class="cm">/* apb master idx if a entry is a apb slave */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">allocbits</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>                <span class="cm">/* 0=unallocated, 1=allocated driver */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">amba_confarea_type</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">amba_confarea_type</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span><span class="cm">/* next bus in chain */</span>
	<span class="k">struct</span> <span class="n">amba_device_table</span> <span class="n">ahbmst</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">amba_device_table</span> <span class="n">ahbslv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">amba_apbslv_device_table</span> <span class="n">apbslv</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">apbmst</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* collect apb slaves */</span>
<span class="k">struct</span> <span class="n">amba_apb_device</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">start</span><span class="p">,</span> <span class="n">irq</span><span class="p">,</span> <span class="n">bus_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">amba_confarea_type</span> <span class="o">*</span><span class="n">bus</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* collect ahb slaves */</span>
<span class="k">struct</span> <span class="n">amba_ahb_device</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">start</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">irq</span><span class="p">,</span> <span class="n">bus_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">amba_confarea_type</span> <span class="o">*</span><span class="n">bus</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">device_node</span><span class="p">;</span>
<span class="kt">void</span> <span class="n">_amba_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device_node</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_node</span> <span class="o">***</span><span class="n">nextp</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">amba_system_id</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">leon3_irqctrl_regs_map</span> <span class="o">*</span><span class="n">leon3_irqctrl_regs</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">leon3_gptimer_regs_map</span> <span class="o">*</span><span class="n">leon3_gptimer_regs</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">amba_apb_device</span> <span class="n">leon_percpu_timer_dev</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">leondebug_irq_disable</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">leon_debug_irqout</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">leon3_gptimer_irq</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">sparc_leon_eirq</span><span class="p">;</span>

<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#define LEON3_IO_AREA 0xfff00000</span>
<span class="cp">#define LEON3_CONF_AREA 0xff000</span>
<span class="cp">#define LEON3_AHB_SLAVE_CONF_AREA (1 &lt;&lt; 11)</span>

<span class="cp">#define LEON3_AHB_CONF_WORDS 8</span>
<span class="cp">#define LEON3_APB_CONF_WORDS 2</span>
<span class="cp">#define LEON3_AHB_MASTERS 16</span>
<span class="cp">#define LEON3_AHB_SLAVES 16</span>
<span class="cp">#define LEON3_APB_SLAVES 16</span>
<span class="cp">#define LEON3_APBUARTS 8</span>

<span class="cm">/* Vendor codes */</span>
<span class="cp">#define VENDOR_GAISLER   1</span>
<span class="cp">#define VENDOR_PENDER    2</span>
<span class="cp">#define VENDOR_ESA       4</span>
<span class="cp">#define VENDOR_OPENCORES 8</span>

<span class="cm">/* Gaisler Research device id&#39;s */</span>
<span class="cp">#define GAISLER_LEON3    0x003</span>
<span class="cp">#define GAISLER_LEON3DSU 0x004</span>
<span class="cp">#define GAISLER_ETHAHB   0x005</span>
<span class="cp">#define GAISLER_APBMST   0x006</span>
<span class="cp">#define GAISLER_AHBUART  0x007</span>
<span class="cp">#define GAISLER_SRCTRL   0x008</span>
<span class="cp">#define GAISLER_SDCTRL   0x009</span>
<span class="cp">#define GAISLER_APBUART  0x00C</span>
<span class="cp">#define GAISLER_IRQMP    0x00D</span>
<span class="cp">#define GAISLER_AHBRAM   0x00E</span>
<span class="cp">#define GAISLER_GPTIMER  0x011</span>
<span class="cp">#define GAISLER_PCITRG   0x012</span>
<span class="cp">#define GAISLER_PCISBRG  0x013</span>
<span class="cp">#define GAISLER_PCIFBRG  0x014</span>
<span class="cp">#define GAISLER_PCITRACE 0x015</span>
<span class="cp">#define GAISLER_PCIDMA   0x016</span>
<span class="cp">#define GAISLER_AHBTRACE 0x017</span>
<span class="cp">#define GAISLER_ETHDSU   0x018</span>
<span class="cp">#define GAISLER_PIOPORT  0x01A</span>
<span class="cp">#define GAISLER_GRGPIO   0x01A</span>
<span class="cp">#define GAISLER_AHBJTAG  0x01c</span>
<span class="cp">#define GAISLER_ETHMAC   0x01D</span>
<span class="cp">#define GAISLER_AHB2AHB  0x020</span>
<span class="cp">#define GAISLER_USBDC    0x021</span>
<span class="cp">#define GAISLER_ATACTRL  0x024</span>
<span class="cp">#define GAISLER_DDRSPA   0x025</span>
<span class="cp">#define GAISLER_USBEHC   0x026</span>
<span class="cp">#define GAISLER_USBUHC   0x027</span>
<span class="cp">#define GAISLER_I2CMST   0x028</span>
<span class="cp">#define GAISLER_SPICTRL  0x02D</span>
<span class="cp">#define GAISLER_DDR2SPA  0x02E</span>
<span class="cp">#define GAISLER_SPIMCTRL 0x045</span>
<span class="cp">#define GAISLER_LEON4    0x048</span>
<span class="cp">#define GAISLER_LEON4DSU 0x049</span>
<span class="cp">#define GAISLER_AHBSTAT  0x052</span>
<span class="cp">#define GAISLER_FTMCTRL  0x054</span>
<span class="cp">#define GAISLER_KBD      0x060</span>
<span class="cp">#define GAISLER_VGA      0x061</span>
<span class="cp">#define GAISLER_SVGA     0x063</span>
<span class="cp">#define GAISLER_GRSYSMON 0x066</span>
<span class="cp">#define GAISLER_GRACECTRL 0x067</span>

<span class="cp">#define GAISLER_L2TIME   0xffd	</span><span class="cm">/* internal device: leon2 timer */</span><span class="cp"></span>
<span class="cp">#define GAISLER_L2C      0xffe	</span><span class="cm">/* internal device: leon2compat */</span><span class="cp"></span>
<span class="cp">#define GAISLER_PLUGPLAY 0xfff	</span><span class="cm">/* internal device: plug &amp; play configarea */</span><span class="cp"></span>

<span class="cm">/* Chip IDs */</span>
<span class="cp">#define AEROFLEX_UT699    0x0699</span>
<span class="cp">#define LEON4_NEXTREME1   0x0102</span>
<span class="cp">#define GAISLER_GR712RC   0x0712</span>

<span class="cp">#define amba_vendor(x) (((x) &gt;&gt; 24) &amp; 0xff)</span>

<span class="cp">#define amba_device(x) (((x) &gt;&gt; 12) &amp; 0xfff)</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
