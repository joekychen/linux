<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › sparc › include › asm › head_32.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>head_32.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __SPARC_HEAD_H</span>
<span class="cp">#define __SPARC_HEAD_H</span>

<span class="cp">#define KERNBASE        0xf0000000  </span><span class="cm">/* First address the kernel will eventually be */</span><span class="cp"></span>

<span class="cp">#define WRITE_PAUSE      nop; nop; nop; </span><span class="cm">/* Have to do this after %wim/%psr chg */</span><span class="cp"></span>

<span class="cm">/* Here are some trap goodies */</span>

<span class="cm">/* Generic trap entry. */</span>
<span class="cp">#define TRAP_ENTRY(type, label) \</span>
<span class="cp">	rd %psr, %l0; b label; rd %wim, %l3; nop;</span>

<span class="cm">/* Data/text faults */</span>
<span class="cp">#define SRMMU_TFAULT rd %psr, %l0; rd %wim, %l3; b srmmu_fault; mov 1, %l7;</span>
<span class="cp">#define SRMMU_DFAULT rd %psr, %l0; rd %wim, %l3; b srmmu_fault; mov 0, %l7;</span>

<span class="cm">/* This is for traps we should NEVER get. */</span>
<span class="cp">#define BAD_TRAP(num) \</span>
<span class="cp">        rd %psr, %l0; mov num, %l7; b bad_trap_handler; rd %wim, %l3;</span>

<span class="cm">/* This is for traps when we want just skip the instruction which caused it */</span>
<span class="cp">#define SKIP_TRAP(type, name) \</span>
<span class="cp">	jmpl %l2, %g0; rett %l2 + 4; nop; nop;</span>

<span class="cm">/* Notice that for the system calls we pull a trick.  We load up a</span>
<span class="cm"> * different pointer to the system call vector table in %l7, but call</span>
<span class="cm"> * the same generic system call low-level entry point.  The trap table</span>
<span class="cm"> * entry sequences are also HyperSparc pipeline friendly ;-)</span>
<span class="cm"> */</span>

<span class="cm">/* Software trap for Linux system calls. */</span>
<span class="cp">#define LINUX_SYSCALL_TRAP \</span>
<span class="cp">        sethi %hi(sys_call_table), %l7; \</span>
<span class="cp">        or %l7, %lo(sys_call_table), %l7; \</span>
<span class="cp">        b linux_sparc_syscall; \</span>
<span class="cp">        rd %psr, %l0;</span>

<span class="cp">#define BREAKPOINT_TRAP \</span>
<span class="cp">	b breakpoint_trap; \</span>
<span class="cp">	rd %psr,%l0; \</span>
<span class="cp">	nop; \</span>
<span class="cp">	nop;</span>

<span class="cp">#ifdef CONFIG_KGDB</span>
<span class="cp">#define KGDB_TRAP(num) \</span>
<span class="cp">	b kgdb_trap_low; \</span>
<span class="cp">	rd %psr,%l0; \</span>
<span class="cp">	nop; \</span>
<span class="cp">	nop;</span>
<span class="cp">#else</span>
<span class="cp">#define KGDB_TRAP(num) \</span>
<span class="cp">	BAD_TRAP(num)</span>
<span class="cp">#endif</span>

<span class="cm">/* The Get Condition Codes software trap for userland. */</span>
<span class="cp">#define GETCC_TRAP \</span>
<span class="cp">        b getcc_trap_handler; mov %psr, %l0; nop; nop;</span>

<span class="cm">/* The Set Condition Codes software trap for userland. */</span>
<span class="cp">#define SETCC_TRAP \</span>
<span class="cp">        b setcc_trap_handler; mov %psr, %l0; nop; nop;</span>

<span class="cm">/* The Get PSR software trap for userland. */</span>
<span class="cp">#define GETPSR_TRAP \</span>
<span class="cp">	mov %psr, %i0; jmp %l2; rett %l2 + 4; nop;</span>

<span class="cm">/* This is for hard interrupts from level 1-14, 15 is non-maskable (nmi) and</span>
<span class="cm"> * gets handled with another macro.</span>
<span class="cm"> */</span>
<span class="cp">#define TRAP_ENTRY_INTERRUPT(int_level) \</span>
<span class="cp">        mov int_level, %l7; rd %psr, %l0; b real_irq_entry; rd %wim, %l3;</span>

<span class="cm">/* Window overflows/underflows are special and we need to try to be as</span>
<span class="cm"> * efficient as possible here....</span>
<span class="cm"> */</span>
<span class="cp">#define WINDOW_SPILL \</span>
<span class="cp">        rd %psr, %l0; rd %wim, %l3; b spill_window_entry; andcc %l0, PSR_PS, %g0;</span>

<span class="cp">#define WINDOW_FILL \</span>
<span class="cp">        rd %psr, %l0; rd %wim, %l3; b fill_window_entry; andcc %l0, PSR_PS, %g0;</span>

<span class="cp">#endif </span><span class="cm">/* __SPARC_HEAD_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
