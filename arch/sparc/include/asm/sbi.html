<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › sparc › include › asm › sbi.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>sbi.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * sbi.h:  SBI (Sbus Interface on sun4d) definitions</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1997 Jakub Jelinek &lt;jj@sunsite.mff.cuni.cz&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _SPARC_SBI_H</span>
<span class="cp">#define _SPARC_SBI_H</span>

<span class="cp">#include &lt;asm/obio.h&gt;</span>

<span class="cm">/* SBI */</span>
<span class="k">struct</span> <span class="n">sbi_regs</span> <span class="p">{</span>
<span class="cm">/* 0x0000 */</span>	<span class="n">u32</span>		<span class="n">cid</span><span class="p">;</span>		<span class="cm">/* Component ID */</span>
<span class="cm">/* 0x0004 */</span>	<span class="n">u32</span>		<span class="n">ctl</span><span class="p">;</span>		<span class="cm">/* Control */</span>
<span class="cm">/* 0x0008 */</span>	<span class="n">u32</span>		<span class="n">status</span><span class="p">;</span>		<span class="cm">/* Status */</span>
		<span class="n">u32</span>		<span class="n">_unused1</span><span class="p">;</span>
		
<span class="cm">/* 0x0010 */</span>	<span class="n">u32</span>		<span class="n">cfg0</span><span class="p">;</span>		<span class="cm">/* Slot0 config reg */</span>
<span class="cm">/* 0x0014 */</span>	<span class="n">u32</span>		<span class="n">cfg1</span><span class="p">;</span>		<span class="cm">/* Slot1 config reg */</span>
<span class="cm">/* 0x0018 */</span>	<span class="n">u32</span>		<span class="n">cfg2</span><span class="p">;</span>		<span class="cm">/* Slot2 config reg */</span>
<span class="cm">/* 0x001c */</span>	<span class="n">u32</span>		<span class="n">cfg3</span><span class="p">;</span>		<span class="cm">/* Slot3 config reg */</span>

<span class="cm">/* 0x0020 */</span>	<span class="n">u32</span>		<span class="n">stb0</span><span class="p">;</span>		<span class="cm">/* Streaming buf control for slot 0 */</span>
<span class="cm">/* 0x0024 */</span>	<span class="n">u32</span>		<span class="n">stb1</span><span class="p">;</span>		<span class="cm">/* Streaming buf control for slot 1 */</span>
<span class="cm">/* 0x0028 */</span>	<span class="n">u32</span>		<span class="n">stb2</span><span class="p">;</span>		<span class="cm">/* Streaming buf control for slot 2 */</span>
<span class="cm">/* 0x002c */</span>	<span class="n">u32</span>		<span class="n">stb3</span><span class="p">;</span>		<span class="cm">/* Streaming buf control for slot 3 */</span>

<span class="cm">/* 0x0030 */</span>	<span class="n">u32</span>		<span class="n">intr_state</span><span class="p">;</span>	<span class="cm">/* Interrupt state */</span>
<span class="cm">/* 0x0034 */</span>	<span class="n">u32</span>		<span class="n">intr_tid</span><span class="p">;</span>	<span class="cm">/* Interrupt target ID */</span>
<span class="cm">/* 0x0038 */</span>	<span class="n">u32</span>		<span class="n">intr_diag</span><span class="p">;</span>	<span class="cm">/* Interrupt diagnostics */</span>
<span class="p">};</span>

<span class="cp">#define SBI_CID			0x02800000</span>
<span class="cp">#define SBI_CTL			0x02800004</span>
<span class="cp">#define SBI_STATUS		0x02800008</span>
<span class="cp">#define SBI_CFG0		0x02800010</span>
<span class="cp">#define SBI_CFG1		0x02800014</span>
<span class="cp">#define SBI_CFG2		0x02800018</span>
<span class="cp">#define SBI_CFG3		0x0280001c</span>
<span class="cp">#define SBI_STB0		0x02800020</span>
<span class="cp">#define SBI_STB1		0x02800024</span>
<span class="cp">#define SBI_STB2		0x02800028</span>
<span class="cp">#define SBI_STB3		0x0280002c</span>
<span class="cp">#define SBI_INTR_STATE		0x02800030</span>
<span class="cp">#define SBI_INTR_TID		0x02800034</span>
<span class="cp">#define SBI_INTR_DIAG		0x02800038</span>

<span class="cm">/* Burst bits for 8, 16, 32, 64 are in cfgX registers at bits 2, 3, 4, 5 respectively */</span>
<span class="cp">#define SBI_CFG_BURST_MASK	0x0000001e</span>

<span class="cm">/* How to make devid from sbi no */</span>
<span class="cp">#define SBI2DEVID(sbino) ((sbino&lt;&lt;4)|2)</span>

<span class="cm">/* intr_state has 4 bits for slots 0 .. 3 and these bits are repeated for each sbus irq level</span>
<span class="cm"> *</span>
<span class="cm"> *		   +-------+-------+-------+-------+-------+-------+-------+-------+</span>
<span class="cm"> *  SBUS IRQ LEVEL |   7   |   6   |   5   |   4   |   3   |   2   |   1   |       |</span>
<span class="cm"> *		   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ Reser |</span>
<span class="cm"> *  SLOT #         |3|2|1|0|3|2|1|0|3|2|1|0|3|2|1|0|3|2|1|0|3|2|1|0|3|2|1|0|  ved  |</span>
<span class="cm"> *                 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-------+</span>
<span class="cm"> *  Bits           31      27      23      19      15      11      7       3      0</span>
<span class="cm"> */</span>


<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">acquire_sbi</span><span class="p">(</span><span class="kt">int</span> <span class="n">devid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;swapa [%2] %3, %0&quot;</span> <span class="o">:</span>
			      <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="o">:</span>
			      <span class="s">&quot;0&quot;</span> <span class="p">(</span><span class="n">mask</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">ECSR_DEV_BASE</span><span class="p">(</span><span class="n">devid</span><span class="p">)</span> <span class="o">|</span> <span class="n">SBI_INTR_STATE</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">mask</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">release_sbi</span><span class="p">(</span><span class="kt">int</span> <span class="n">devid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;sta %0, [%1] %2&quot;</span> <span class="o">:</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">mask</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">ECSR_DEV_BASE</span><span class="p">(</span><span class="n">devid</span><span class="p">)</span> <span class="o">|</span> <span class="n">SBI_INTR_STATE</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_sbi_tid</span><span class="p">(</span><span class="kt">int</span> <span class="n">devid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">targetid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;sta %0, [%1] %2&quot;</span> <span class="o">:</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">targetid</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">ECSR_DEV_BASE</span><span class="p">(</span><span class="n">devid</span><span class="p">)</span> <span class="o">|</span> <span class="n">SBI_INTR_TID</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">get_sbi_ctl</span><span class="p">(</span><span class="kt">int</span> <span class="n">devid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cfgno</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">cfg</span><span class="p">;</span>
	
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;lda [%1] %2, %0&quot;</span> <span class="o">:</span>
			      <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">cfg</span><span class="p">)</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">((</span><span class="n">ECSR_DEV_BASE</span><span class="p">(</span><span class="n">devid</span><span class="p">)</span> <span class="o">|</span> <span class="n">SBI_CFG0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cfgno</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">)),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">cfg</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_sbi_ctl</span><span class="p">(</span><span class="kt">int</span> <span class="n">devid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cfgno</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cfg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;sta %0, [%1] %2&quot;</span> <span class="o">:</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">cfg</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">((</span><span class="n">ECSR_DEV_BASE</span><span class="p">(</span><span class="n">devid</span><span class="p">)</span> <span class="o">|</span> <span class="n">SBI_CFG0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">cfgno</span><span class="o">&lt;&lt;</span><span class="mi">2</span><span class="p">)),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* !(_SPARC_SBI_H) */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
