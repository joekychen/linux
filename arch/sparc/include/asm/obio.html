<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › sparc › include › asm › obio.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>obio.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * obio.h:  Some useful locations in 0xFXXXXXXXX PA obio space on sun4d.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1997 Jakub Jelinek &lt;jj@sunsite.mff.cuni.cz&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _SPARC_OBIO_H</span>
<span class="cp">#define _SPARC_OBIO_H</span>

<span class="cp">#include &lt;asm/asi.h&gt;</span>

<span class="cm">/* This weird monster likes to use the very upper parts of</span>
<span class="cm">   36bit PA for these things :) */</span>
   
<span class="cm">/* CSR space (for each XDBUS)</span>
<span class="cm"> *  ------------------------------------------------------------------------</span>
<span class="cm"> *  |   0xFE  |   DEVID    |                | XDBUS ID |                   |</span>
<span class="cm"> *  ------------------------------------------------------------------------</span>
<span class="cm"> *  35      28 27        20 19            10 9        8 7                 0</span>
<span class="cm"> */</span>
   
<span class="cp">#define CSR_BASE_ADDR		0xe0000000</span>
<span class="cp">#define CSR_CPU_SHIFT		(32 - 4 - 5)</span>
<span class="cp">#define CSR_XDBUS_SHIFT		8</span>

<span class="cp">#define CSR_BASE(cpu) (((CSR_BASE_ADDR &gt;&gt; CSR_CPU_SHIFT) + cpu) &lt;&lt; CSR_CPU_SHIFT)</span>

<span class="cm">/* ECSR space (not for each XDBUS)</span>
<span class="cm"> *  ------------------------------------------------------------------------</span>
<span class="cm"> *  |   0xF  | DEVID[7:1] |                			           |</span>
<span class="cm"> *  ------------------------------------------------------------------------</span>
<span class="cm"> *  35     32 31        25 24                 				  0</span>
<span class="cm"> */</span>
   
<span class="cp">#define ECSR_BASE_ADDR		0x00000000</span>
<span class="cp">#define ECSR_CPU_SHIFT		(32 - 5)</span>
<span class="cp">#define ECSR_DEV_SHIFT		(32 - 8)</span>

<span class="cp">#define ECSR_BASE(cpu) ((cpu) &lt;&lt; ECSR_CPU_SHIFT)</span>
<span class="cp">#define ECSR_DEV_BASE(devid) ((devid) &lt;&lt; ECSR_DEV_SHIFT) </span>

<span class="cm">/* Bus Watcher */</span>
<span class="cp">#define BW_LOCAL_BASE		0xfff00000</span>

<span class="cp">#define BW_CID			0x00000000</span>
<span class="cp">#define BW_DBUS_CTRL		0x00000008</span>
<span class="cp">#define BW_DBUS_DATA		0x00000010</span>
<span class="cp">#define BW_CTRL			0x00001000</span>
<span class="cp">#define BW_INTR_TABLE		0x00001040</span>
<span class="cp">#define BW_INTR_TABLE_CLEAR	0x00001080</span>
<span class="cp">#define BW_PRESCALER		0x000010c0</span>
<span class="cp">#define BW_PTIMER_LIMIT		0x00002000</span>
<span class="cp">#define BW_PTIMER_COUNTER2	0x00002004</span>
<span class="cp">#define BW_PTIMER_NDLIMIT	0x00002008</span>
<span class="cp">#define BW_PTIMER_CTRL		0x0000200c</span>
<span class="cp">#define BW_PTIMER_COUNTER	0x00002010</span>
<span class="cp">#define BW_TIMER_LIMIT		0x00003000</span>
<span class="cp">#define BW_TIMER_COUNTER2	0x00003004</span>
<span class="cp">#define BW_TIMER_NDLIMIT	0x00003008</span>
<span class="cp">#define BW_TIMER_CTRL		0x0000300c</span>
<span class="cp">#define BW_TIMER_COUNTER	0x00003010</span>

<span class="cm">/* BW Control */</span>
<span class="cp">#define BW_CTRL_USER_TIMER	0x00000004	</span><span class="cm">/* Is User Timer Free run enabled */</span><span class="cp"></span>

<span class="cm">/* Boot Bus */</span>
<span class="cp">#define BB_LOCAL_BASE		0xf0000000</span>

<span class="cp">#define BB_STAT1		0x00100000</span>
<span class="cp">#define BB_STAT2		0x00120000</span>
<span class="cp">#define BB_STAT3		0x00140000</span>
<span class="cp">#define BB_LEDS			0x002e0000</span>

<span class="cm">/* Bits in BB_STAT2 */</span>
<span class="cp">#define BB_STAT2_AC_INTR	0x04	</span><span class="cm">/* Aiee! 5ms and power is gone... */</span><span class="cp"></span>
<span class="cp">#define BB_STAT2_TMP_INTR	0x10	</span><span class="cm">/* My Penguins are burning. Are you able to smell it? */</span><span class="cp"></span>
<span class="cp">#define BB_STAT2_FAN_INTR	0x20	</span><span class="cm">/* My fan refuses to work */</span><span class="cp"></span>
<span class="cp">#define BB_STAT2_PWR_INTR	0x40	</span><span class="cm">/* On SC2000, one of the two ACs died. Ok, we go on... */</span><span class="cp"></span>
<span class="cp">#define BB_STAT2_MASK		(BB_STAT2_AC_INTR|BB_STAT2_TMP_INTR|BB_STAT2_FAN_INTR|BB_STAT2_PWR_INTR)</span>

<span class="cm">/* Cache Controller */</span>
<span class="cp">#define CC_BASE		0x1F00000</span>
<span class="cp">#define CC_DATSTREAM	0x1F00000  </span><span class="cm">/* Data stream register */</span><span class="cp"></span>
<span class="cp">#define CC_DATSIZE	0x1F0003F  </span><span class="cm">/* Size */</span><span class="cp"></span>
<span class="cp">#define CC_SRCSTREAM	0x1F00100  </span><span class="cm">/* Source stream register */</span><span class="cp"></span>
<span class="cp">#define CC_DESSTREAM	0x1F00200  </span><span class="cm">/* Destination stream register */</span><span class="cp"></span>
<span class="cp">#define CC_RMCOUNT	0x1F00300  </span><span class="cm">/* Count of references and misses */</span><span class="cp"></span>
<span class="cp">#define CC_IPEN		0x1F00406  </span><span class="cm">/* Pending Interrupts */</span><span class="cp"></span>
<span class="cp">#define CC_IMSK		0x1F00506  </span><span class="cm">/* Interrupt Mask */</span><span class="cp"></span>
<span class="cp">#define CC_ICLR		0x1F00606  </span><span class="cm">/* Clear pending Interrupts */</span><span class="cp"></span>
<span class="cp">#define CC_IGEN		0x1F00704  </span><span class="cm">/* Generate Interrupt register */</span><span class="cp"></span>
<span class="cp">#define CC_STEST	0x1F00804  </span><span class="cm">/* Internal self-test */</span><span class="cp"></span>
<span class="cp">#define CC_CREG		0x1F00A04  </span><span class="cm">/* Control register */</span><span class="cp"></span>
<span class="cp">#define CC_SREG		0x1F00B00  </span><span class="cm">/* Status register */</span><span class="cp"></span>
<span class="cp">#define CC_RREG		0x1F00C04  </span><span class="cm">/* Reset register */</span><span class="cp"></span>
<span class="cp">#define CC_EREG		0x1F00E00  </span><span class="cm">/* Error code register */</span><span class="cp"></span>
<span class="cp">#define CC_CID		0x1F00F04  </span><span class="cm">/* Component ID */</span><span class="cp"></span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">bw_get_intr_mask</span><span class="p">(</span><span class="kt">int</span> <span class="n">sbus_level</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">mask</span><span class="p">;</span>
	
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;lduha [%1] %2, %0&quot;</span> <span class="o">:</span>
			      <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">BW_LOCAL_BASE</span> <span class="o">+</span> <span class="n">BW_INTR_TABLE</span> <span class="o">+</span> <span class="p">(</span><span class="n">sbus_level</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">mask</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bw_clear_intr_mask</span><span class="p">(</span><span class="kt">int</span> <span class="n">sbus_level</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;stha %0, [%1] %2&quot;</span> <span class="o">:</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">mask</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">BW_LOCAL_BASE</span> <span class="o">+</span> <span class="n">BW_INTR_TABLE_CLEAR</span> <span class="o">+</span> <span class="p">(</span><span class="n">sbus_level</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="nf">bw_get_prof_limit</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">limit</span><span class="p">;</span>
	
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;lda [%1] %2, %0&quot;</span> <span class="o">:</span>
			      <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">limit</span><span class="p">)</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">CSR_BASE</span><span class="p">(</span><span class="n">cpu</span><span class="p">)</span> <span class="o">+</span> <span class="n">BW_PTIMER_LIMIT</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">limit</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bw_set_prof_limit</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">limit</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;sta %0, [%1] %2&quot;</span> <span class="o">:</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">limit</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">CSR_BASE</span><span class="p">(</span><span class="n">cpu</span><span class="p">)</span> <span class="o">+</span> <span class="n">BW_PTIMER_LIMIT</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="nf">bw_get_ctrl</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">ctrl</span><span class="p">;</span>
	
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;lda [%1] %2, %0&quot;</span> <span class="o">:</span>
			      <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">ctrl</span><span class="p">)</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">CSR_BASE</span><span class="p">(</span><span class="n">cpu</span><span class="p">)</span> <span class="o">+</span> <span class="n">BW_CTRL</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">ctrl</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">bw_set_ctrl</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;sta %0, [%1] %2&quot;</span> <span class="o">:</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">ctrl</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">CSR_BASE</span><span class="p">(</span><span class="n">cpu</span><span class="p">)</span> <span class="o">+</span> <span class="n">BW_CTRL</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="nf">cc_get_ipen</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">pending</span><span class="p">;</span>
	
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;lduha [%1] %2, %0&quot;</span> <span class="o">:</span>
			      <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">pending</span><span class="p">)</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">CC_IPEN</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_MXCC</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">pending</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cc_set_iclr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">clear</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;stha %0, [%1] %2&quot;</span> <span class="o">:</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">clear</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">CC_ICLR</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_MXCC</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="nf">cc_get_imsk</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">mask</span><span class="p">;</span>
	
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;lduha [%1] %2, %0&quot;</span> <span class="o">:</span>
			      <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">CC_IMSK</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_MXCC</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">mask</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cc_set_imsk</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;stha %0, [%1] %2&quot;</span> <span class="o">:</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">mask</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">CC_IMSK</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_MXCC</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="nf">cc_get_imsk_other</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpuid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">mask</span><span class="p">;</span>
	
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;lduha [%1] %2, %0&quot;</span> <span class="o">:</span>
			      <span class="s">&quot;=r&quot;</span> <span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">ECSR_BASE</span><span class="p">(</span><span class="n">cpuid</span><span class="p">)</span> <span class="o">|</span> <span class="n">CC_IMSK</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">mask</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cc_set_imsk_other</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpuid</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;stha %0, [%1] %2&quot;</span> <span class="o">:</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">mask</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">ECSR_BASE</span><span class="p">(</span><span class="n">cpuid</span><span class="p">)</span> <span class="o">|</span> <span class="n">CC_IMSK</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_CTL</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">cc_set_igen</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">gen</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__asm__</span> <span class="n">__volatile__</span> <span class="p">(</span><span class="s">&quot;sta %0, [%1] %2&quot;</span> <span class="o">:</span> <span class="o">:</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">gen</span><span class="p">),</span>
			      <span class="s">&quot;r&quot;</span> <span class="p">(</span><span class="n">CC_IGEN</span><span class="p">),</span>
			      <span class="s">&quot;i&quot;</span> <span class="p">(</span><span class="n">ASI_M_MXCC</span><span class="p">));</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* !(_SPARC_OBIO_H) */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
