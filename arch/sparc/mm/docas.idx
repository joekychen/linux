f | Makefile | g | 589B |  | Sam Ravnborg | sam@ravnborg.org | 1338187969 |  | sparc32: introduce run-time patching of srmmu access functions  LEON uses a different ASI than SUN for MMUREGS  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | iommu.c | s | 11K | 386 | Sam Ravnborg | sam@ravnborg.org | 1337029509 |  | sparc32: remove runtime btfix support  - remove all uses of btfixup header - remove the btfixup header - remove the btfixup code  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | fault_64.c | s | 13K | 453 | Kautuk Consul | consul.kautuk@gmail.com | 1333579344 |  | sparc/mm/fault_64.c: Port OOM changes to do_sparc64_fault  Commit d065bd810b6deb67d4897a14bfe21f8eb526ba99 (mm: retry page fault when blocking on disk transfer) and commit 37b23e0525d393d48a7d59f870b3bc061a30ccdb (x86,mm: make pagefault killable)  The above commits introduced changes into the x86 pagefault handler for making the page fault handler retryable as well as killable.  These changes reduce the mmap_sem hold time, which is crucial during OOM killer invocation.  Port these changes to 64-bit sparc.  Signed-off-by: Kautuk Consul <consul.kautuk@gmail.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | srmmu.h | s | 73B | 3 | Sam Ravnborg | sam@ravnborg.org | 1337495258 |  | sparc32,leon: move leon mmu functions to leon_mm.c  We already have a leaon specific file - so keep all the laon stuff in one place.  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Konrad Eisele <konrad@gaisler.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | io-unit.c | s | 6.8K | 219 | David S. Miller | davem@davemloft.net | 1336942625 |  | sparc32: Convert mmu_* interfaces from btfixup to method ops.  This set of changes displays one major danger of btfixup, interface signatures are not always type checked fully.  As seen here the iounit variant of the map_dma_area routine had an incorrect type for one of it's arguments.  It turns out to be harmless in this case, but just imagine trying to debug something involving this kind of problem.  No thanks.  Signed-off-by: David S. Miller <davem@davemloft.net>
f | init_64.c | s | 56K | 1887 | Paul Gortmaker | paul.gortmaker@windriver.com | 1336618687 |  | sparc: fix build fail in mm/init_64.c when NEED_MULTIPLE_NODES is off  Commit 625d693e9784f988371e69c2b41a2172c0be6c11 (linux-next)      "sparc64: Convert over to NO_BOOTMEM."  causes the following compile failure for sparc64 allnoconfig:    arch/sparc/mm/init_64.c:822:16: error: unused variable 'paddr'   arch/sparc/mm/init_64.c:1759:7: error: unused variable 'node'   arch/sparc/mm/init_64.c:809:12: error: 'memblock_nid_range' defined but not used  The paddr decl can easily be shuffled within the ifdef.  The memblock_nid_range is just a stub function for when NEED_MULTIPLE_NODES is off, but the only caller is within a NEED_MULTIPLE_NODES enabled section, so we can simply delete it.  The unused "node" is slightly more interesting.  In the case of "# CONFIG_NEED_MULTIPLE_NODES is not set" we no longer get the definition of:   #define NODE_DATA(nid)          (node_data[nid])  from arch/sparc/include/asm/mmzone.h - but instead we get:   #define NODE_DATA(nid)          (&contig_page_data)  from include/linux/mmzone.h -- and since the arg is ignored, the thing really is unused.  Rather than put in a confusing looking __maybe_unused, simply splitting the declaration from the assignment seemed to me to be the least offensive.  Cc: Sam Ravnborg <sam@ravnborg.org> Cc: "David S. Miller" <davem@davemloft.net> Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com> Signed-off-by: David S. Miller <davem@davemloft.net>
f | init_64.h | s | 1.6K | 40 | David Howells | dhowells@redhat.com | 1332955803 |  | Move all declarations of free_initmem() to linux/mm.h  Move all declarations of free_initmem() to linux/mm.h so that there's only one and it's used by everything.  Signed-off-by: David Howells <dhowells@redhat.com> cc: linux-c6x-dev@linux-c6x.org cc: microblaze-uclinux@itee.uq.edu.au cc: linux-sh@vger.kernel.org cc: sparclinux@vger.kernel.org cc: x86@kernel.org cc: linux-mm@kvack.org
f | tsunami.S | g | 3.2K |  | Adrian Bunk | bunk@kernel.org | 1216355881 |  | sparc/mm/: possible cleanups  This patch contains the following possible cleanups: - make the following needlessly global code static:   - fault.c: force_user_fault()   - init.c: calc_max_low_pfn()   - init.c: pgt_cache_water[]   - init.c: map_high_region()   - srmmu.c: hwbug_bitmask   - srmmu.c: srmmu_swapper_pg_dir   - srmmu.c: srmmu_context_table   - srmmu.c: is_hypersparc   - srmmu.c: srmmu_cache_pagetables   - srmmu.c: srmmu_nocache_size   - srmmu.c: srmmu_nocache_end   - srmmu.c: srmmu_get_nocache()   - srmmu.c: srmmu_free_nocache()   - srmmu.c: srmmu_early_allocate_ptable_skeleton()   - srmmu.c: srmmu_nocache_calcsize()   - srmmu.c: srmmu_nocache_init()   - srmmu.c: srmmu_alloc_thread_info()   - srmmu.c: early_pgtable_allocfail()   - srmmu.c: srmmu_early_allocate_ptable_skeleton()   - srmmu.c: srmmu_allocate_ptable_skeleton()   - srmmu.c: srmmu_inherit_prom_mappings()   - sunami.S: tsunami_copy_1page - remove the following unused code:   - init.c: struct sparc_aliases  Signed-off-by: Adrian Bunk <bunk@kernel.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | gup.c | s | 4.2K | 154 | Andrea Arcangeli | aarcange@redhat.com | 1320275218 |  | thp: share get_huge_page_tail()  This avoids duplicating the function in every arch gup_fast.  Signed-off-by: Andrea Arcangeli <aarcange@redhat.com> Cc: Peter Zijlstra <a.p.zijlstra@chello.nl> Cc: Hugh Dickins <hughd@google.com> Cc: Johannes Weiner <jweiner@redhat.com> Cc: Rik van Riel <riel@redhat.com> Cc: Mel Gorman <mgorman@suse.de> Cc: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: David Gibson <david@gibson.dropbear.id.au> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: Heiko Carstens <heiko.carstens@de.ibm.com> Cc: David Miller <davem@davemloft.net> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | tlb.c | s | 1.9K | 80 | Peter Zijlstra | a.p.zijlstra@chello.nl | 1306337953 |  | sparc: mmu_gather rework  Rework the sparc mmu_gather usage to conform to the new world order :-)  Sparc mmu_gather does two things:  - tracks vaddrs to unhash  - tracks pages to free  Split these two things like powerpc has done and keep the vaddrs in per-cpu data structures and flush them on context switch.  The remaining bits can then use the generic mmu_gather.  Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl> Acked-by: David Miller <davem@davemloft.net> Cc: Benjamin Herrenschmidt <benh@kernel.crashing.org> Cc: Martin Schwidefsky <schwidefsky@de.ibm.com> Cc: Russell King <rmk@arm.linux.org.uk> Cc: Paul Mundt <lethal@linux-sh.org> Cc: Jeff Dike <jdike@addtoit.com> Cc: Richard Weinberger <richard@nod.at> Cc: Tony Luck <tony.luck@intel.com> Cc: KAMEZAWA Hiroyuki <kamezawa.hiroyu@jp.fujitsu.com> Cc: Hugh Dickins <hughd@google.com> Cc: Mel Gorman <mel@csn.ul.ie> Cc: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com> Cc: Nick Piggin <npiggin@kernel.dk> Cc: Namhyung Kim <namhyung@gmail.com> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | swift.S | g | 5.3K |  | Adrian Bunk | bunk@kernel.org | 1211268824 |  | sparc: remove CVS keywords  This patch removes the CVS keywords that weren't updated for a long time from comments.  Signed-off-by: Adrian Bunk <bunk@kernel.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | srmmu_access.S | g | 1.9K |  | Sam Ravnborg | sam@ravnborg.org | 1338187969 |  | sparc32: introduce run-time patching of srmmu access functions  LEON uses a different ASI than SUN for MMUREGS  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | leon_mm.c | s | 8.2K | 303 | Sam Ravnborg | sam@ravnborg.org | 1338187971 |  | sparc32: srmmu_probe now knows about leon too  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | tsb.c | s | 13K | 432 | David Howells | dhowells@redhat.com | 1332955803 |  | Disintegrate asm/system.h for Sparc  Disintegrate asm/system.h for Sparc.  Signed-off-by: David Howells <dhowells@redhat.com> cc: sparclinux@vger.kernel.org
f | viking.S | g | 6.1K |  | Sam Ravnborg | sam@ravnborg.org | 1337029509 |  | sparc32: remove runtime btfix support  - remove all uses of btfixup header - remove the btfixup header - remove the btfixup code  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | extable.c | s | 2.2K | 87 | Rusty Russell | rusty@rustcorp.com.au | 1244809024 |  | module: trim exception table on init free.  It's theoretically possible that there are exception table entries which point into the (freed) init text of modules.  These could cause future problems if other modules get loaded into that memory and cause an exception as we'd see the wrong fixup.  The only case I know of is kvm-intel.ko (when CONFIG_CC_OPTIMIZE_FOR_SIZE=n).  Amerigo fixed this long-standing FIXME in the x86 version, but this patch is more general.  This implements trim_init_extable(); most archs are simple since they use the standard lib/extable.c sort code.  Alpha and IA64 use relative addresses in their fixups, so thier trimming is a slight variation.  Sparc32 is unique; it doesn't seem to define ARCH_HAS_SORT_EXTABLE, yet it defines its own sort_extable() which overrides the one in lib. It doesn't sort, so we have to mark deleted entries instead of actually trimming them.  Inspired-by: Amerigo Wang <amwang@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au> Cc: linux-alpha@vger.kernel.org Cc: sparclinux@vger.kernel.org Cc: linux-ia64@vger.kernel.org
f | srmmu.c | s | 47K | 1495 | Sam Ravnborg | sam@ravnborg.org | 1338187971 |  | sparc32: srmmu_probe now knows about leon too  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Cc: Daniel Hellstrom <daniel@gaisler.com> Cc: Konrad Eisele <konrad@gaisler.com>
f | init_32.c | s | 12K | 394 | Sam Ravnborg | sam@ravnborg.org | 1337029509 |  | sparc32: remove runtime btfix support  - remove all uses of btfixup header - remove the btfixup header - remove the btfixup code  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | highmem.c | s | 3.1K | 112 | Cong Wang | amwang@redhat.com | 1332251310 |  | highmem: kill all __kmap_atomic() [swarren@nvidia.com: highmem: Fix ARM build break due to __kmap_atomic rename]  Signed-off-by: Stephen Warren <swarren@nvidia.com> Signed-off-by: Cong Wang <amwang@redhat.com>
f | ultra.S | g | 17K |  | David S. Miller | davem@davemloft.net | 1336672846 |  | sparc64: Do not clobber %g2 in xcall_fetch_glob_regs().  %g2 is meant to hold the CPUID number throughout this routine, since at the very beginning, and at the very end, we use %g2 to calculate indexes into per-cpu arrays.  However we erroneously clobber it in order to hold the %cwp register value mid-stream.  Fix this code to use %g3 for the %cwp read and related calulcations instead.  Reported-by: Meelis Roos <mroos@linux.ee> Signed-off-by: David S. Miller <davem@davemloft.net>
f | fault_32.c | s | 10K | 405 | Sam Ravnborg | sam@ravnborg.org | 1337103828 |  | sparc32: cleanup mm/fault_32.c  - remove unused variables - fix coding style issues that hurts my eyes  Signed-off-by: Sam Ravnborg <sam@ravnborg.org> Signed-off-by: David S. Miller <davem@davemloft.net>
f | hugetlbpage.c | s | 8.3K | 300 | Paul Gortmaker | paul.gortmaker@windriver.com | 1320103854 |  | sparc: remove several unnecessary module.h include instances  Building an allyesconfig doesn't reveal a hidden need for any of these.  Since module.h brings in the whole kitchen sink, it just needlessly adds 30k+ lines to the cpp burden.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | hypersparc.S | g | 9.6K |  | Adrian Bunk | bunk@kernel.org | 1211268824 |  | sparc: remove CVS keywords  This patch removes the CVS keywords that weren't updated for a long time from comments.  Signed-off-by: Adrian Bunk <bunk@kernel.org> Signed-off-by: David S. Miller <davem@davemloft.net>
