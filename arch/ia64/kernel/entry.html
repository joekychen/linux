<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › kernel › entry.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>entry.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Preserved registers that are shared between code in ivt.S and</span>
<span class="cm"> * entry.S.  Be careful not to step on these!</span>
<span class="cm"> */</span>
<span class="cp">#define PRED_LEAVE_SYSCALL	1 </span><span class="cm">/* TRUE iff leave from syscall */</span><span class="cp"></span>
<span class="cp">#define PRED_KERNEL_STACK	2 </span><span class="cm">/* returning to kernel-stacks? */</span><span class="cp"></span>
<span class="cp">#define PRED_USER_STACK		3 </span><span class="cm">/* returning to user-stacks? */</span><span class="cp"></span>
<span class="cp">#define PRED_SYSCALL		4 </span><span class="cm">/* inside a system call? */</span><span class="cp"></span>
<span class="cp">#define PRED_NON_SYSCALL	5 </span><span class="cm">/* complement of PRED_SYSCALL */</span><span class="cp"></span>

<span class="cp">#ifdef __ASSEMBLY__</span>
<span class="cp"># define PASTE2(x,y)	x##y</span>
<span class="cp"># define PASTE(x,y)	PASTE2(x,y)</span>

<span class="cp"># define pLvSys		PASTE(p,PRED_LEAVE_SYSCALL)</span>
<span class="cp"># define pKStk		PASTE(p,PRED_KERNEL_STACK)</span>
<span class="cp"># define pUStk		PASTE(p,PRED_USER_STACK)</span>
<span class="cp"># define pSys		PASTE(p,PRED_SYSCALL)</span>
<span class="cp"># define pNonSys	PASTE(p,PRED_NON_SYSCALL)</span>
<span class="cp">#endif</span>

<span class="cp">#define PT(f)		(IA64_PT_REGS_##f##_OFFSET)</span>
<span class="cp">#define SW(f)		(IA64_SWITCH_STACK_##f##_OFFSET)</span>
<span class="cp">#define SOS(f)		(IA64_SAL_OS_STATE_##f##_OFFSET)</span>

<span class="cp">#define PT_REGS_SAVES(off)			\</span>
<span class="cp">	.unwabi 3, &#39;i&#39;;				\</span>
<span class="cp">	.fframe IA64_PT_REGS_SIZE+16+(off);	\</span>
<span class="cp">	.spillsp rp, PT(CR_IIP)+16+(off);	\</span>
<span class="cp">	.spillsp ar.pfs, PT(CR_IFS)+16+(off);	\</span>
<span class="cp">	.spillsp ar.unat, PT(AR_UNAT)+16+(off);	\</span>
<span class="cp">	.spillsp ar.fpsr, PT(AR_FPSR)+16+(off);	\</span>
<span class="cp">	.spillsp pr, PT(PR)+16+(off);</span>

<span class="cp">#define PT_REGS_UNWIND_INFO(off)		\</span>
<span class="cp">	.prologue;				\</span>
<span class="cp">	PT_REGS_SAVES(off);			\</span>
<span class="cp">	.body</span>

<span class="cp">#define SWITCH_STACK_SAVES(off)							\</span>
<span class="cp">	.savesp ar.unat,SW(CALLER_UNAT)+16+(off);				\</span>
<span class="cp">	.savesp ar.fpsr,SW(AR_FPSR)+16+(off);					\</span>
<span class="cp">	.spillsp f2,SW(F2)+16+(off); .spillsp f3,SW(F3)+16+(off);		\</span>
<span class="cp">	.spillsp f4,SW(F4)+16+(off); .spillsp f5,SW(F5)+16+(off);		\</span>
<span class="cp">	.spillsp f16,SW(F16)+16+(off); .spillsp f17,SW(F17)+16+(off);		\</span>
<span class="cp">	.spillsp f18,SW(F18)+16+(off); .spillsp f19,SW(F19)+16+(off);		\</span>
<span class="cp">	.spillsp f20,SW(F20)+16+(off); .spillsp f21,SW(F21)+16+(off);		\</span>
<span class="cp">	.spillsp f22,SW(F22)+16+(off); .spillsp f23,SW(F23)+16+(off);		\</span>
<span class="cp">	.spillsp f24,SW(F24)+16+(off); .spillsp f25,SW(F25)+16+(off);		\</span>
<span class="cp">	.spillsp f26,SW(F26)+16+(off); .spillsp f27,SW(F27)+16+(off);		\</span>
<span class="cp">	.spillsp f28,SW(F28)+16+(off); .spillsp f29,SW(F29)+16+(off);		\</span>
<span class="cp">	.spillsp f30,SW(F30)+16+(off); .spillsp f31,SW(F31)+16+(off);		\</span>
<span class="cp">	.spillsp r4,SW(R4)+16+(off); .spillsp r5,SW(R5)+16+(off);		\</span>
<span class="cp">	.spillsp r6,SW(R6)+16+(off); .spillsp r7,SW(R7)+16+(off);		\</span>
<span class="cp">	.spillsp b0,SW(B0)+16+(off); .spillsp b1,SW(B1)+16+(off);		\</span>
<span class="cp">	.spillsp b2,SW(B2)+16+(off); .spillsp b3,SW(B3)+16+(off);		\</span>
<span class="cp">	.spillsp b4,SW(B4)+16+(off); .spillsp b5,SW(B5)+16+(off);		\</span>
<span class="cp">	.spillsp ar.pfs,SW(AR_PFS)+16+(off); .spillsp ar.lc,SW(AR_LC)+16+(off);	\</span>
<span class="cp">	.spillsp @priunat,SW(AR_UNAT)+16+(off);					\</span>
<span class="cp">	.spillsp ar.rnat,SW(AR_RNAT)+16+(off);					\</span>
<span class="cp">	.spillsp ar.bspstore,SW(AR_BSPSTORE)+16+(off);				\</span>
<span class="cp">	.spillsp pr,SW(PR)+16+(off)</span>

<span class="cp">#define DO_SAVE_SWITCH_STACK			\</span>
<span class="cp">	movl r28=1f;				\</span>
<span class="cp">	;;					\</span>
<span class="cp">	.fframe IA64_SWITCH_STACK_SIZE;		\</span>
<span class="cp">	adds sp=-IA64_SWITCH_STACK_SIZE,sp;	\</span>
<span class="cp">	mov.ret.sptk b7=r28,1f;			\</span>
<span class="cp">	SWITCH_STACK_SAVES(0);			\</span>
<span class="cp">	br.cond.sptk.many save_switch_stack;	\</span>
<span class="cp">1:</span>

<span class="cp">#define DO_LOAD_SWITCH_STACK			\</span>
<span class="cp">	movl r28=1f;				\</span>
<span class="cp">	;;					\</span>
<span class="cp">	invala;					\</span>
<span class="cp">	mov.ret.sptk b7=r28,1f;			\</span>
<span class="cp">	br.cond.sptk.many load_switch_stack;	\</span>
<span class="cp">1:	.restore sp;				\</span>
<span class="cp">	adds sp=IA64_SWITCH_STACK_SIZE,sp</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
