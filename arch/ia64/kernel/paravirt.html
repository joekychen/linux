<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › kernel › paravirt.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>paravirt.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/******************************************************************************</span>
<span class="cm"> * arch/ia64/kernel/paravirt.c</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2008 Isaku Yamahata &lt;yamahata at valinux co jp&gt;</span>
<span class="cm"> *                    VA Linux Systems Japan K.K.</span>
<span class="cm"> *     Yaozu (Eddie) Dong &lt;eddie.dong@intel.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>

<span class="cp">#include &lt;linux/compiler.h&gt;</span>
<span class="cp">#include &lt;linux/io.h&gt;</span>
<span class="cp">#include &lt;linux/irq.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>

<span class="cp">#include &lt;asm/iosapic.h&gt;</span>
<span class="cp">#include &lt;asm/paravirt.h&gt;</span>

<span class="cm">/***************************************************************************</span>
<span class="cm"> * general info</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">pv_info</span> <span class="n">pv_info</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">kernel_rpl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">paravirt_enabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;bare hardware&quot;</span>
<span class="p">};</span>

<span class="cm">/***************************************************************************</span>
<span class="cm"> * pv_init_ops</span>
<span class="cm"> * initialization hooks.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span>
<span class="n">ia64_native_patch_branch</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tag</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">pv_init_ops</span> <span class="n">pv_init_ops</span> <span class="o">=</span>
<span class="p">{</span>
<span class="cp">#ifdef ASM_SUPPORTED</span>
	<span class="p">.</span><span class="n">patch_bundle</span> <span class="o">=</span> <span class="n">ia64_native_patch_bundle</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="p">.</span><span class="n">patch_branch</span> <span class="o">=</span> <span class="n">ia64_native_patch_branch</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/***************************************************************************</span>
<span class="cm"> * pv_cpu_ops</span>
<span class="cm"> * intrinsics hooks.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef ASM_SUPPORTED</span>
<span class="cm">/* ia64_native_xxx are macros so that we have to make them real functions */</span>

<span class="cp">#define DEFINE_VOID_FUNC1(name)					\</span>
<span class="cp">	static void						\</span>
<span class="cp">	ia64_native_ ## name ## _func(unsigned long arg)	\</span>
<span class="cp">	{							\</span>
<span class="cp">		ia64_native_ ## name(arg);			\</span>
<span class="cp">	}</span>

<span class="cp">#define DEFINE_VOID_FUNC1_VOID(name)				\</span>
<span class="cp">	static void						\</span>
<span class="cp">	ia64_native_ ## name ## _func(void *arg)		\</span>
<span class="cp">	{							\</span>
<span class="cp">		ia64_native_ ## name(arg);			\</span>
<span class="cp">	}</span>

<span class="cp">#define DEFINE_VOID_FUNC2(name)					\</span>
<span class="cp">	static void						\</span>
<span class="cp">	ia64_native_ ## name ## _func(unsigned long arg0,	\</span>
<span class="cp">				      unsigned long arg1)	\</span>
<span class="cp">	{							\</span>
<span class="cp">		ia64_native_ ## name(arg0, arg1);		\</span>
<span class="cp">	}</span>

<span class="cp">#define DEFINE_FUNC0(name)			\</span>
<span class="cp">	static unsigned long			\</span>
<span class="cp">	ia64_native_ ## name ## _func(void)	\</span>
<span class="cp">	{					\</span>
<span class="cp">		return ia64_native_ ## name();	\</span>
<span class="cp">	}</span>

<span class="cp">#define DEFINE_FUNC1(name, type)			\</span>
<span class="cp">	static unsigned long				\</span>
<span class="cp">	ia64_native_ ## name ## _func(type arg)		\</span>
<span class="cp">	{						\</span>
<span class="cp">		return ia64_native_ ## name(arg);	\</span>
<span class="cp">	}						\</span>

<span class="n">DEFINE_VOID_FUNC1_VOID</span><span class="p">(</span><span class="n">fc</span><span class="p">);</span>
<span class="n">DEFINE_VOID_FUNC1</span><span class="p">(</span><span class="n">intrin_local_irq_restore</span><span class="p">);</span>

<span class="n">DEFINE_VOID_FUNC2</span><span class="p">(</span><span class="n">ptcga</span><span class="p">);</span>
<span class="n">DEFINE_VOID_FUNC2</span><span class="p">(</span><span class="n">set_rr</span><span class="p">);</span>

<span class="n">DEFINE_FUNC0</span><span class="p">(</span><span class="n">get_psr_i</span><span class="p">);</span>

<span class="n">DEFINE_FUNC1</span><span class="p">(</span><span class="n">thash</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>
<span class="n">DEFINE_FUNC1</span><span class="p">(</span><span class="n">get_cpuid</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="n">DEFINE_FUNC1</span><span class="p">(</span><span class="n">get_pmd</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="n">DEFINE_FUNC1</span><span class="p">(</span><span class="n">get_rr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ia64_native_ssm_i_func</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ia64_native_ssm</span><span class="p">(</span><span class="n">IA64_PSR_I</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ia64_native_rsm_i_func</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ia64_native_rsm</span><span class="p">(</span><span class="n">IA64_PSR_I</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ia64_native_set_rr0_to_rr4_func</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val0</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val1</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val2</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val3</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val4</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ia64_native_set_rr0_to_rr4</span><span class="p">(</span><span class="n">val0</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">val3</span><span class="p">,</span> <span class="n">val4</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define CASE_GET_REG(id)				\</span>
<span class="cp">	case _IA64_REG_ ## id:				\</span>
<span class="cp">	res = ia64_native_getreg(_IA64_REG_ ## id);	\</span>
<span class="cp">	break;</span>
<span class="cp">#define CASE_GET_AR(id) CASE_GET_REG(AR_ ## id)</span>
<span class="cp">#define CASE_GET_CR(id) CASE_GET_REG(CR_ ## id)</span>

<span class="kt">unsigned</span> <span class="kt">long</span>
<span class="nf">ia64_native_getreg_func</span><span class="p">(</span><span class="kt">int</span> <span class="n">regnum</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">res</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">regnum</span><span class="p">)</span> <span class="p">{</span>
	<span class="n">CASE_GET_REG</span><span class="p">(</span><span class="n">GP</span><span class="p">);</span>
	<span class="cm">/*CASE_GET_REG(IP);*/</span> <span class="cm">/* returned ip value shouldn&#39;t be constant */</span>
	<span class="n">CASE_GET_REG</span><span class="p">(</span><span class="n">PSR</span><span class="p">);</span>
	<span class="n">CASE_GET_REG</span><span class="p">(</span><span class="n">TP</span><span class="p">);</span>
	<span class="n">CASE_GET_REG</span><span class="p">(</span><span class="n">SP</span><span class="p">);</span>

	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">KR0</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">KR1</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">KR2</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">KR3</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">KR4</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">KR5</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">KR6</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">KR7</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">RSC</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">BSP</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">BSPSTORE</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">RNAT</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">FCR</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">EFLAG</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">CSD</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">SSD</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">CFLAG</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">FSR</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">FIR</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">FDR</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">CCV</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">UNAT</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">FPSR</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">ITC</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">PFS</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">LC</span><span class="p">);</span>
	<span class="n">CASE_GET_AR</span><span class="p">(</span><span class="n">EC</span><span class="p">);</span>

	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">DCR</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">ITM</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IVA</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">PTA</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IPSR</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">ISR</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IIP</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IFA</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">ITIR</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IIPA</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IFS</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IIM</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IHA</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">LID</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IVR</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">TPR</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">EOI</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IRR0</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IRR1</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IRR2</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">IRR3</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">ITV</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">PMV</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">CMCV</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">LRR0</span><span class="p">);</span>
	<span class="n">CASE_GET_CR</span><span class="p">(</span><span class="n">LRR1</span><span class="p">);</span>

	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_CRIT</span> <span class="s">&quot;wrong_getreg %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">regnum</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">res</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define CASE_SET_REG(id)				\</span>
<span class="cp">	case _IA64_REG_ ## id:				\</span>
<span class="cp">	ia64_native_setreg(_IA64_REG_ ## id, val);	\</span>
<span class="cp">	break;</span>
<span class="cp">#define CASE_SET_AR(id) CASE_SET_REG(AR_ ## id)</span>
<span class="cp">#define CASE_SET_CR(id) CASE_SET_REG(CR_ ## id)</span>

<span class="kt">void</span>
<span class="nf">ia64_native_setreg_func</span><span class="p">(</span><span class="kt">int</span> <span class="n">regnum</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">regnum</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">_IA64_REG_PSR_L</span>:
		<span class="n">ia64_native_setreg</span><span class="p">(</span><span class="n">_IA64_REG_PSR_L</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="n">ia64_dv_serialize_data</span><span class="p">();</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="n">CASE_SET_REG</span><span class="p">(</span><span class="n">SP</span><span class="p">);</span>
	<span class="n">CASE_SET_REG</span><span class="p">(</span><span class="n">GP</span><span class="p">);</span>

	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">KR0</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">KR1</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">KR2</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">KR3</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">KR4</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">KR5</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">KR6</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">KR7</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">RSC</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">BSP</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">BSPSTORE</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">RNAT</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">FCR</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">EFLAG</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">CSD</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">SSD</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">CFLAG</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">FSR</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">FIR</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">FDR</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">CCV</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">UNAT</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">FPSR</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">ITC</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">PFS</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">LC</span><span class="p">);</span>
	<span class="n">CASE_SET_AR</span><span class="p">(</span><span class="n">EC</span><span class="p">);</span>

	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">DCR</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">ITM</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IVA</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">PTA</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IPSR</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">ISR</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IIP</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IFA</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">ITIR</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IIPA</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IFS</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IIM</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IHA</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">LID</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IVR</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">TPR</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">EOI</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IRR0</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IRR1</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IRR2</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">IRR3</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">ITV</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">PMV</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">CMCV</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">LRR0</span><span class="p">);</span>
	<span class="n">CASE_SET_CR</span><span class="p">(</span><span class="n">LRR1</span><span class="p">);</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_CRIT</span> <span class="s">&quot;wrong setreg %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">regnum</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="cp">#else</span>

<span class="cp">#define __DEFINE_FUNC(name, code)					\</span>
<span class="cp">	extern const char ia64_native_ ## name ## _direct_start[];	\</span>
<span class="cp">	extern const char ia64_native_ ## name ## _direct_end[];	\</span>
<span class="cp">	asm (&quot;.align 32\n&quot;						\</span>
<span class="cp">	     &quot;.proc ia64_native_&quot; #name &quot;_func\n&quot;			\</span>
<span class="cp">	     &quot;ia64_native_&quot; #name &quot;_func:\n&quot;				\</span>
<span class="cp">	     &quot;ia64_native_&quot; #name &quot;_direct_start:\n&quot;			\</span>
<span class="cp">	     code							\</span>
<span class="cp">	     &quot;ia64_native_&quot; #name &quot;_direct_end:\n&quot;			\</span>
<span class="cp">	     &quot;br.cond.sptk.many b6\n&quot;					\</span>
<span class="cp">	     &quot;.endp ia64_native_&quot; #name &quot;_func\n&quot;)</span>

<span class="cp">#define DEFINE_VOID_FUNC0(name, code)				\</span>
<span class="cp">	extern void						\</span>
<span class="cp">	ia64_native_ ## name ## _func(void);			\</span>
<span class="cp">	__DEFINE_FUNC(name, code)</span>

<span class="cp">#define DEFINE_VOID_FUNC1(name, code)				\</span>
<span class="cp">	extern void						\</span>
<span class="cp">	ia64_native_ ## name ## _func(unsigned long arg);	\</span>
<span class="cp">	__DEFINE_FUNC(name, code)</span>

<span class="cp">#define DEFINE_VOID_FUNC1_VOID(name, code)			\</span>
<span class="cp">	extern void						\</span>
<span class="cp">	ia64_native_ ## name ## _func(void *arg);		\</span>
<span class="cp">	__DEFINE_FUNC(name, code)</span>

<span class="cp">#define DEFINE_VOID_FUNC2(name, code)				\</span>
<span class="cp">	extern void						\</span>
<span class="cp">	ia64_native_ ## name ## _func(unsigned long arg0,	\</span>
<span class="cp">				      unsigned long arg1);	\</span>
<span class="cp">	__DEFINE_FUNC(name, code)</span>

<span class="cp">#define DEFINE_FUNC0(name, code)		\</span>
<span class="cp">	extern unsigned long			\</span>
<span class="cp">	ia64_native_ ## name ## _func(void);	\</span>
<span class="cp">	__DEFINE_FUNC(name, code)</span>

<span class="cp">#define DEFINE_FUNC1(name, type, code)			\</span>
<span class="cp">	extern unsigned long				\</span>
<span class="cp">	ia64_native_ ## name ## _func(type arg);	\</span>
<span class="cp">	__DEFINE_FUNC(name, code)</span>

<span class="n">DEFINE_VOID_FUNC1_VOID</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span>
		       <span class="s">&quot;fc r8</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">DEFINE_VOID_FUNC1</span><span class="p">(</span><span class="n">intrin_local_irq_restore</span><span class="p">,</span>
		  <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
		  <span class="s">&quot;     cmp.ne p6, p7 = r8, r0</span><span class="se">\n</span><span class="s">&quot;</span>
		  <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
		  <span class="s">&quot;(p6) ssm psr.i</span><span class="se">\n</span><span class="s">&quot;</span>
		  <span class="s">&quot;(p7) rsm psr.i</span><span class="se">\n</span><span class="s">&quot;</span>
		  <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
		  <span class="s">&quot;(p6) srlz.d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="n">DEFINE_VOID_FUNC2</span><span class="p">(</span><span class="n">ptcga</span><span class="p">,</span>
		  <span class="s">&quot;ptc.ga r8, r9</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">DEFINE_VOID_FUNC2</span><span class="p">(</span><span class="n">set_rr</span><span class="p">,</span>
		  <span class="s">&quot;mov rr[r8] = r9</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="cm">/* ia64_native_getreg(_IA64_REG_PSR) &amp; IA64_PSR_I */</span>
<span class="n">DEFINE_FUNC0</span><span class="p">(</span><span class="n">get_psr_i</span><span class="p">,</span>
	     <span class="s">&quot;mov r2 = &quot;</span> <span class="n">__stringify</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IA64_PSR_I_BIT</span><span class="p">)</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	     <span class="s">&quot;mov r8 = psr</span><span class="se">\n</span><span class="s">&quot;</span>
	     <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
	     <span class="s">&quot;and r8 = r2, r8</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="n">DEFINE_FUNC1</span><span class="p">(</span><span class="n">thash</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="p">,</span>
	     <span class="s">&quot;thash r8 = r8</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">DEFINE_FUNC1</span><span class="p">(</span><span class="n">get_cpuid</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span>
	     <span class="s">&quot;mov r8 = cpuid[r8]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">DEFINE_FUNC1</span><span class="p">(</span><span class="n">get_pmd</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span>
	     <span class="s">&quot;mov r8 = pmd[r8]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">DEFINE_FUNC1</span><span class="p">(</span><span class="n">get_rr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="p">,</span>
	     <span class="s">&quot;mov r8 = rr[r8]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="n">DEFINE_VOID_FUNC0</span><span class="p">(</span><span class="n">ssm_i</span><span class="p">,</span>
		  <span class="s">&quot;ssm psr.i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="n">DEFINE_VOID_FUNC0</span><span class="p">(</span><span class="n">rsm_i</span><span class="p">,</span>
		  <span class="s">&quot;rsm psr.i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span>
<span class="n">ia64_native_set_rr0_to_rr4_func</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val0</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val1</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val2</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val3</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val4</span><span class="p">);</span>
<span class="n">__DEFINE_FUNC</span><span class="p">(</span><span class="n">set_rr0_to_rr4</span><span class="p">,</span>
	      <span class="s">&quot;mov rr[r0] = r8</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;movl r2 = 0x2000000000000000</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;mov rr[r2] = r9</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;shl r3 = r2, 1</span><span class="se">\n</span><span class="s">&quot;</span>	<span class="cm">/* movl r3 = 0x4000000000000000 */</span>
	      <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;add r2 = r2, r3</span><span class="se">\n</span><span class="s">&quot;</span>	<span class="cm">/* movl r2 = 0x6000000000000000 */</span>
	      <span class="s">&quot;mov rr[r3] = r10</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;mov rr[r2] = r11</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;shl r3 = r3, 1</span><span class="se">\n</span><span class="s">&quot;</span>	<span class="cm">/* movl r3 = 0x8000000000000000 */</span>
	      <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;mov rr[r3] = r14</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ia64_native_getreg_func</span><span class="p">(</span><span class="kt">int</span> <span class="n">regnum</span><span class="p">);</span>
<span class="n">asm</span><span class="p">(</span><span class="s">&quot;.global ia64_native_getreg_func</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="cp">#define __DEFINE_GET_REG(id, reg)			\</span>
<span class="cp">	&quot;mov r2 = &quot; __stringify(_IA64_REG_ ## id) &quot;\n&quot;	\</span>
<span class="cp">	&quot;;;\n&quot;						\</span>
<span class="cp">	&quot;cmp.eq p6, p0 = r2, r8\n&quot;			\</span>
<span class="cp">	&quot;;;\n&quot;						\</span>
<span class="cp">	&quot;(p6) mov r8 = &quot; #reg &quot;\n&quot;			\</span>
<span class="cp">	&quot;(p6) br.cond.sptk.many b6\n&quot;			\</span>
<span class="cp">	&quot;;;\n&quot;</span>
<span class="cp">#define __DEFINE_GET_AR(id, reg)	__DEFINE_GET_REG(AR_ ## id, ar.reg)</span>
<span class="cp">#define __DEFINE_GET_CR(id, reg)	__DEFINE_GET_REG(CR_ ## id, cr.reg)</span>

<span class="n">__DEFINE_FUNC</span><span class="p">(</span><span class="n">getreg</span><span class="p">,</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">GP</span><span class="p">,</span> <span class="n">gp</span><span class="p">)</span>
	      <span class="cm">/*__DEFINE_GET_REG(IP, ip)*/</span> <span class="cm">/* returned ip value shouldn&#39;t be constant */</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">PSR</span><span class="p">,</span> <span class="n">psr</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">TP</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="n">sp</span><span class="p">)</span>

	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">AR_KR0</span><span class="p">,</span> <span class="n">ar0</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">AR_KR1</span><span class="p">,</span> <span class="n">ar1</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">AR_KR2</span><span class="p">,</span> <span class="n">ar2</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">AR_KR3</span><span class="p">,</span> <span class="n">ar3</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">AR_KR4</span><span class="p">,</span> <span class="n">ar4</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">AR_KR5</span><span class="p">,</span> <span class="n">ar5</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">AR_KR6</span><span class="p">,</span> <span class="n">ar6</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">AR_KR7</span><span class="p">,</span> <span class="n">ar7</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">RSC</span><span class="p">,</span> <span class="n">rsc</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">BSP</span><span class="p">,</span> <span class="n">bsp</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">BSPSTORE</span><span class="p">,</span> <span class="n">bspstore</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">RNAT</span><span class="p">,</span> <span class="n">rnat</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">FCR</span><span class="p">,</span> <span class="n">fcr</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">EFLAG</span><span class="p">,</span> <span class="n">eflag</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">CSD</span><span class="p">,</span> <span class="n">csd</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">SSD</span><span class="p">,</span> <span class="n">ssd</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_REG</span><span class="p">(</span><span class="n">AR_CFLAG</span><span class="p">,</span> <span class="n">ar27</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">FSR</span><span class="p">,</span> <span class="n">fsr</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">FIR</span><span class="p">,</span> <span class="n">fir</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">FDR</span><span class="p">,</span> <span class="n">fdr</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">CCV</span><span class="p">,</span> <span class="n">ccv</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">UNAT</span><span class="p">,</span> <span class="n">unat</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">FPSR</span><span class="p">,</span> <span class="n">fpsr</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">ITC</span><span class="p">,</span> <span class="n">itc</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">PFS</span><span class="p">,</span> <span class="n">pfs</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">LC</span><span class="p">,</span> <span class="n">lc</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_AR</span><span class="p">(</span><span class="n">EC</span><span class="p">,</span> <span class="n">ec</span><span class="p">)</span>

	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">DCR</span><span class="p">,</span> <span class="n">dcr</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">ITM</span><span class="p">,</span> <span class="n">itm</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IVA</span><span class="p">,</span> <span class="n">iva</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">PTA</span><span class="p">,</span> <span class="n">pta</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IPSR</span><span class="p">,</span> <span class="n">ipsr</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">ISR</span><span class="p">,</span> <span class="n">isr</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IIP</span><span class="p">,</span> <span class="n">iip</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IFA</span><span class="p">,</span> <span class="n">ifa</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">ITIR</span><span class="p">,</span> <span class="n">itir</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IIPA</span><span class="p">,</span> <span class="n">iipa</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IFS</span><span class="p">,</span> <span class="n">ifs</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IIM</span><span class="p">,</span> <span class="n">iim</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IHA</span><span class="p">,</span> <span class="n">iha</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">LID</span><span class="p">,</span> <span class="n">lid</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IVR</span><span class="p">,</span> <span class="n">ivr</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">TPR</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">EOI</span><span class="p">,</span> <span class="n">eoi</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IRR0</span><span class="p">,</span> <span class="n">irr0</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IRR1</span><span class="p">,</span> <span class="n">irr1</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IRR2</span><span class="p">,</span> <span class="n">irr2</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">IRR3</span><span class="p">,</span> <span class="n">irr3</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">ITV</span><span class="p">,</span> <span class="n">itv</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">PMV</span><span class="p">,</span> <span class="n">pmv</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">CMCV</span><span class="p">,</span> <span class="n">cmcv</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">LRR0</span><span class="p">,</span> <span class="n">lrr0</span><span class="p">)</span>
	      <span class="n">__DEFINE_GET_CR</span><span class="p">(</span><span class="n">LRR1</span><span class="p">,</span> <span class="n">lrr1</span><span class="p">)</span>

	      <span class="s">&quot;mov r8 = -1</span><span class="se">\n</span><span class="s">&quot;</span>	<span class="cm">/* unsupported case */</span>
	<span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_native_setreg_func</span><span class="p">(</span><span class="kt">int</span> <span class="n">regnum</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">);</span>
<span class="n">asm</span><span class="p">(</span><span class="s">&quot;.global ia64_native_setreg_func</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="cp">#define __DEFINE_SET_REG(id, reg)			\</span>
<span class="cp">	&quot;mov r2 = &quot; __stringify(_IA64_REG_ ## id) &quot;\n&quot;	\</span>
<span class="cp">	&quot;;;\n&quot;						\</span>
<span class="cp">	&quot;cmp.eq p6, p0 = r2, r9\n&quot;			\</span>
<span class="cp">	&quot;;;\n&quot;						\</span>
<span class="cp">	&quot;(p6) mov &quot; #reg &quot; = r8\n&quot;			\</span>
<span class="cp">	&quot;(p6) br.cond.sptk.many b6\n&quot;			\</span>
<span class="cp">	&quot;;;\n&quot;</span>
<span class="cp">#define __DEFINE_SET_AR(id, reg)	__DEFINE_SET_REG(AR_ ## id, ar.reg)</span>
<span class="cp">#define __DEFINE_SET_CR(id, reg)	__DEFINE_SET_REG(CR_ ## id, cr.reg)</span>
<span class="n">__DEFINE_FUNC</span><span class="p">(</span><span class="n">setreg</span><span class="p">,</span>
	      <span class="s">&quot;mov r2 = &quot;</span> <span class="n">__stringify</span><span class="p">(</span><span class="n">_IA64_REG_PSR_L</span><span class="p">)</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;cmp.eq p6, p0 = r2, r9</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;(p6) mov psr.l = r8</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="cp">#ifdef HAVE_SERIALIZE_DIRECTIVE</span>
	      <span class="s">&quot;.serialize.data</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="cp">#endif</span>
	      <span class="s">&quot;(p6) br.cond.sptk.many b6</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">GP</span><span class="p">,</span> <span class="n">gp</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">SP</span><span class="p">,</span> <span class="n">sp</span><span class="p">)</span>

	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">AR_KR0</span><span class="p">,</span> <span class="n">ar0</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">AR_KR1</span><span class="p">,</span> <span class="n">ar1</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">AR_KR2</span><span class="p">,</span> <span class="n">ar2</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">AR_KR3</span><span class="p">,</span> <span class="n">ar3</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">AR_KR4</span><span class="p">,</span> <span class="n">ar4</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">AR_KR5</span><span class="p">,</span> <span class="n">ar5</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">AR_KR6</span><span class="p">,</span> <span class="n">ar6</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">AR_KR7</span><span class="p">,</span> <span class="n">ar7</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">RSC</span><span class="p">,</span> <span class="n">rsc</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">BSP</span><span class="p">,</span> <span class="n">bsp</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">BSPSTORE</span><span class="p">,</span> <span class="n">bspstore</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">RNAT</span><span class="p">,</span> <span class="n">rnat</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">FCR</span><span class="p">,</span> <span class="n">fcr</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">EFLAG</span><span class="p">,</span> <span class="n">eflag</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">CSD</span><span class="p">,</span> <span class="n">csd</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">SSD</span><span class="p">,</span> <span class="n">ssd</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_REG</span><span class="p">(</span><span class="n">AR_CFLAG</span><span class="p">,</span> <span class="n">ar27</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">FSR</span><span class="p">,</span> <span class="n">fsr</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">FIR</span><span class="p">,</span> <span class="n">fir</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">FDR</span><span class="p">,</span> <span class="n">fdr</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">CCV</span><span class="p">,</span> <span class="n">ccv</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">UNAT</span><span class="p">,</span> <span class="n">unat</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">FPSR</span><span class="p">,</span> <span class="n">fpsr</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">ITC</span><span class="p">,</span> <span class="n">itc</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">PFS</span><span class="p">,</span> <span class="n">pfs</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">LC</span><span class="p">,</span> <span class="n">lc</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_AR</span><span class="p">(</span><span class="n">EC</span><span class="p">,</span> <span class="n">ec</span><span class="p">)</span>

	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">DCR</span><span class="p">,</span> <span class="n">dcr</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">ITM</span><span class="p">,</span> <span class="n">itm</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IVA</span><span class="p">,</span> <span class="n">iva</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">PTA</span><span class="p">,</span> <span class="n">pta</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IPSR</span><span class="p">,</span> <span class="n">ipsr</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">ISR</span><span class="p">,</span> <span class="n">isr</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IIP</span><span class="p">,</span> <span class="n">iip</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IFA</span><span class="p">,</span> <span class="n">ifa</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">ITIR</span><span class="p">,</span> <span class="n">itir</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IIPA</span><span class="p">,</span> <span class="n">iipa</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IFS</span><span class="p">,</span> <span class="n">ifs</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IIM</span><span class="p">,</span> <span class="n">iim</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IHA</span><span class="p">,</span> <span class="n">iha</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">LID</span><span class="p">,</span> <span class="n">lid</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IVR</span><span class="p">,</span> <span class="n">ivr</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">TPR</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">EOI</span><span class="p">,</span> <span class="n">eoi</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IRR0</span><span class="p">,</span> <span class="n">irr0</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IRR1</span><span class="p">,</span> <span class="n">irr1</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IRR2</span><span class="p">,</span> <span class="n">irr2</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">IRR3</span><span class="p">,</span> <span class="n">irr3</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">ITV</span><span class="p">,</span> <span class="n">itv</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">PMV</span><span class="p">,</span> <span class="n">pmv</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">CMCV</span><span class="p">,</span> <span class="n">cmcv</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">LRR0</span><span class="p">,</span> <span class="n">lrr0</span><span class="p">)</span>
	      <span class="n">__DEFINE_SET_CR</span><span class="p">(</span><span class="n">LRR1</span><span class="p">,</span> <span class="n">lrr1</span><span class="p">)</span>
	<span class="p">);</span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">pv_cpu_ops</span> <span class="n">pv_cpu_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">fc</span>		<span class="o">=</span> <span class="n">ia64_native_fc_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">thash</span>		<span class="o">=</span> <span class="n">ia64_native_thash_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_cpuid</span>	<span class="o">=</span> <span class="n">ia64_native_get_cpuid_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_pmd</span>	<span class="o">=</span> <span class="n">ia64_native_get_pmd_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ptcga</span>		<span class="o">=</span> <span class="n">ia64_native_ptcga_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_rr</span>		<span class="o">=</span> <span class="n">ia64_native_get_rr_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rr</span>		<span class="o">=</span> <span class="n">ia64_native_set_rr_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_rr0_to_rr4</span>	<span class="o">=</span> <span class="n">ia64_native_set_rr0_to_rr4_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ssm_i</span>		<span class="o">=</span> <span class="n">ia64_native_ssm_i_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">getreg</span>		<span class="o">=</span> <span class="n">ia64_native_getreg_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">setreg</span>		<span class="o">=</span> <span class="n">ia64_native_setreg_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rsm_i</span>		<span class="o">=</span> <span class="n">ia64_native_rsm_i_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_psr_i</span>	<span class="o">=</span> <span class="n">ia64_native_get_psr_i_func</span><span class="p">,</span>
	<span class="p">.</span><span class="n">intrin_local_irq_restore</span>
			<span class="o">=</span> <span class="n">ia64_native_intrin_local_irq_restore_func</span><span class="p">,</span>
<span class="p">};</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">pv_cpu_ops</span><span class="p">);</span>

<span class="cm">/******************************************************************************</span>
<span class="cm"> * replacement of hand written assembly codes.</span>
<span class="cm"> */</span>

<span class="kt">void</span>
<span class="nf">paravirt_cpu_asm_init</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">pv_cpu_asm_switch</span> <span class="o">*</span><span class="n">cpu_asm_switch</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">paravirt_switch_to_targ</span><span class="p">;</span>
	<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">paravirt_leave_syscall_targ</span><span class="p">;</span>
	<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">paravirt_work_processed_syscall_targ</span><span class="p">;</span>
	<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">paravirt_leave_kernel_targ</span><span class="p">;</span>

	<span class="n">paravirt_switch_to_targ</span> <span class="o">=</span> <span class="n">cpu_asm_switch</span><span class="o">-&gt;</span><span class="n">switch_to</span><span class="p">;</span>
	<span class="n">paravirt_leave_syscall_targ</span> <span class="o">=</span> <span class="n">cpu_asm_switch</span><span class="o">-&gt;</span><span class="n">leave_syscall</span><span class="p">;</span>
	<span class="n">paravirt_work_processed_syscall_targ</span> <span class="o">=</span>
		<span class="n">cpu_asm_switch</span><span class="o">-&gt;</span><span class="n">work_processed_syscall</span><span class="p">;</span>
	<span class="n">paravirt_leave_kernel_targ</span> <span class="o">=</span> <span class="n">cpu_asm_switch</span><span class="o">-&gt;</span><span class="n">leave_kernel</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/***************************************************************************</span>
<span class="cm"> * pv_iosapic_ops</span>
<span class="cm"> * iosapic read/write hooks.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span>
<span class="nf">ia64_native_iosapic_read</span><span class="p">(</span><span class="kt">char</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">iosapic</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__ia64_native_iosapic_read</span><span class="p">(</span><span class="n">iosapic</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">ia64_native_iosapic_write</span><span class="p">(</span><span class="kt">char</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">iosapic</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__ia64_native_iosapic_write</span><span class="p">(</span><span class="n">iosapic</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">pv_iosapic_ops</span> <span class="n">pv_iosapic_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">pcat_compat_init</span> <span class="o">=</span> <span class="n">ia64_native_iosapic_pcat_compat_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">__get_irq_chip</span> <span class="o">=</span> <span class="n">ia64_native_iosapic_get_irq_chip</span><span class="p">,</span>

	<span class="p">.</span><span class="n">__read</span> <span class="o">=</span> <span class="n">ia64_native_iosapic_read</span><span class="p">,</span>
	<span class="p">.</span><span class="n">__write</span> <span class="o">=</span> <span class="n">ia64_native_iosapic_write</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/***************************************************************************</span>
<span class="cm"> * pv_irq_ops</span>
<span class="cm"> * irq operations</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">pv_irq_ops</span> <span class="n">pv_irq_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">register_ipi</span> <span class="o">=</span> <span class="n">ia64_native_register_ipi</span><span class="p">,</span>

	<span class="p">.</span><span class="n">assign_irq_vector</span> <span class="o">=</span> <span class="n">ia64_native_assign_irq_vector</span><span class="p">,</span>
	<span class="p">.</span><span class="n">free_irq_vector</span> <span class="o">=</span> <span class="n">ia64_native_free_irq_vector</span><span class="p">,</span>
	<span class="p">.</span><span class="n">register_percpu_irq</span> <span class="o">=</span> <span class="n">ia64_native_register_percpu_irq</span><span class="p">,</span>

	<span class="p">.</span><span class="n">resend_irq</span> <span class="o">=</span> <span class="n">ia64_native_resend_irq</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/***************************************************************************</span>
<span class="cm"> * pv_time_ops</span>
<span class="cm"> * time operations</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">static_key</span> <span class="n">paravirt_steal_enabled</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">static_key</span> <span class="n">paravirt_steal_rq_enabled</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">ia64_native_do_steal_accounting</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">new_itm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">pv_time_ops</span> <span class="n">pv_time_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">do_steal_accounting</span> <span class="o">=</span> <span class="n">ia64_native_do_steal_accounting</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sched_clock</span> <span class="o">=</span> <span class="n">ia64_native_sched_clock</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/***************************************************************************</span>
<span class="cm"> * binary pacthing</span>
<span class="cm"> * pv_init_ops.patch_bundle</span>
<span class="cm"> */</span>

<span class="cp">#ifdef ASM_SUPPORTED</span>
<span class="cp">#define IA64_NATIVE_PATCH_DEFINE_GET_REG(name, reg)	\</span>
<span class="cp">	__DEFINE_FUNC(get_ ## name,			\</span>
<span class="cp">		      &quot;;;\n&quot;				\</span>
<span class="cp">		      &quot;mov r8 = &quot; #reg &quot;\n&quot;		\</span>
<span class="cp">		      &quot;;;\n&quot;)</span>

<span class="cp">#define IA64_NATIVE_PATCH_DEFINE_SET_REG(name, reg)	\</span>
<span class="cp">	__DEFINE_FUNC(set_ ## name,			\</span>
<span class="cp">		      &quot;;;\n&quot;				\</span>
<span class="cp">		      &quot;mov &quot; #reg &quot; = r8\n&quot;		\</span>
<span class="cp">		      &quot;;;\n&quot;)</span>

<span class="cp">#define IA64_NATIVE_PATCH_DEFINE_REG(name, reg)		\</span>
<span class="cp">	IA64_NATIVE_PATCH_DEFINE_GET_REG(name, reg);	\</span>
<span class="cp">	IA64_NATIVE_PATCH_DEFINE_SET_REG(name, reg)	\</span>

<span class="cp">#define IA64_NATIVE_PATCH_DEFINE_AR(name, reg)			\</span>
<span class="cp">	IA64_NATIVE_PATCH_DEFINE_REG(ar_ ## name, ar.reg)</span>

<span class="cp">#define IA64_NATIVE_PATCH_DEFINE_CR(name, reg)			\</span>
<span class="cp">	IA64_NATIVE_PATCH_DEFINE_REG(cr_ ## name, cr.reg)</span>


<span class="n">IA64_NATIVE_PATCH_DEFINE_GET_REG</span><span class="p">(</span><span class="n">psr</span><span class="p">,</span> <span class="n">psr</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_GET_REG</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">tp</span><span class="p">);</span>

<span class="cm">/* IA64_NATIVE_PATCH_DEFINE_SET_REG(psr_l, psr.l); */</span>
<span class="n">__DEFINE_FUNC</span><span class="p">(</span><span class="n">set_psr_l</span><span class="p">,</span>
	      <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span>
	      <span class="s">&quot;mov psr.l = r8</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="cp">#ifdef HAVE_SERIALIZE_DIRECTIVE</span>
	      <span class="s">&quot;.serialize.data</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="cp">#endif</span>
	      <span class="s">&quot;;;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">gp</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">sp</span><span class="p">);</span>

<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">kr0</span><span class="p">,</span> <span class="n">ar0</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">kr1</span><span class="p">,</span> <span class="n">ar1</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">kr2</span><span class="p">,</span> <span class="n">ar2</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">kr3</span><span class="p">,</span> <span class="n">ar3</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">kr4</span><span class="p">,</span> <span class="n">ar4</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">kr5</span><span class="p">,</span> <span class="n">ar5</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">kr6</span><span class="p">,</span> <span class="n">ar6</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">kr7</span><span class="p">,</span> <span class="n">ar7</span><span class="p">);</span>

<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">rsc</span><span class="p">,</span> <span class="n">rsc</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">bsp</span><span class="p">,</span> <span class="n">bsp</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">bspstore</span><span class="p">,</span> <span class="n">bspstore</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">rnat</span><span class="p">,</span> <span class="n">rnat</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">fcr</span><span class="p">,</span> <span class="n">fcr</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">eflag</span><span class="p">,</span> <span class="n">eflag</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">csd</span><span class="p">,</span> <span class="n">csd</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">ssd</span><span class="p">,</span> <span class="n">ssd</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_REG</span><span class="p">(</span><span class="n">ar27</span><span class="p">,</span> <span class="n">ar27</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">fsr</span><span class="p">,</span> <span class="n">fsr</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">fir</span><span class="p">,</span> <span class="n">fir</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">fdr</span><span class="p">,</span> <span class="n">fdr</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">ccv</span><span class="p">,</span> <span class="n">ccv</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">unat</span><span class="p">,</span> <span class="n">unat</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">fpsr</span><span class="p">,</span> <span class="n">fpsr</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">itc</span><span class="p">,</span> <span class="n">itc</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">pfs</span><span class="p">,</span> <span class="n">pfs</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">lc</span><span class="p">,</span> <span class="n">lc</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_AR</span><span class="p">(</span><span class="n">ec</span><span class="p">,</span> <span class="n">ec</span><span class="p">);</span>

<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">dcr</span><span class="p">,</span> <span class="n">dcr</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">itm</span><span class="p">,</span> <span class="n">itm</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">iva</span><span class="p">,</span> <span class="n">iva</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">pta</span><span class="p">,</span> <span class="n">pta</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">ipsr</span><span class="p">,</span> <span class="n">ipsr</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">isr</span><span class="p">,</span> <span class="n">isr</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">iip</span><span class="p">,</span> <span class="n">iip</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">ifa</span><span class="p">,</span> <span class="n">ifa</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">itir</span><span class="p">,</span> <span class="n">itir</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">iipa</span><span class="p">,</span> <span class="n">iipa</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">ifs</span><span class="p">,</span> <span class="n">ifs</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">iim</span><span class="p">,</span> <span class="n">iim</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">iha</span><span class="p">,</span> <span class="n">iha</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">lid</span><span class="p">,</span> <span class="n">lid</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">ivr</span><span class="p">,</span> <span class="n">ivr</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">tpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">eoi</span><span class="p">,</span> <span class="n">eoi</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">irr0</span><span class="p">,</span> <span class="n">irr0</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">irr1</span><span class="p">,</span> <span class="n">irr1</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">irr2</span><span class="p">,</span> <span class="n">irr2</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">irr3</span><span class="p">,</span> <span class="n">irr3</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">itv</span><span class="p">,</span> <span class="n">itv</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">pmv</span><span class="p">,</span> <span class="n">pmv</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">cmcv</span><span class="p">,</span> <span class="n">cmcv</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">lrr0</span><span class="p">,</span> <span class="n">lrr0</span><span class="p">);</span>
<span class="n">IA64_NATIVE_PATCH_DEFINE_CR</span><span class="p">(</span><span class="n">lrr1</span><span class="p">,</span> <span class="n">lrr1</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">paravirt_patch_bundle_elem</span> <span class="n">ia64_native_patch_bundle_elems</span><span class="p">[]</span>
<span class="n">__initdata_or_module</span> <span class="o">=</span>
<span class="p">{</span>
<span class="cp">#define IA64_NATIVE_PATCH_BUNDLE_ELEM(name, type)		\</span>
<span class="cp">	{							\</span>
<span class="cp">		(void*)ia64_native_ ## name ## _direct_start,	\</span>
<span class="cp">		(void*)ia64_native_ ## name ## _direct_end,	\</span>
<span class="cp">		PARAVIRT_PATCH_TYPE_ ## type,			\</span>
<span class="cp">	}</span>

	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">fc</span><span class="p">,</span> <span class="n">FC</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">thash</span><span class="p">,</span> <span class="n">THASH</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">get_cpuid</span><span class="p">,</span> <span class="n">GET_CPUID</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">get_pmd</span><span class="p">,</span> <span class="n">GET_PMD</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">ptcga</span><span class="p">,</span> <span class="n">PTCGA</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">get_rr</span><span class="p">,</span> <span class="n">GET_RR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">set_rr</span><span class="p">,</span> <span class="n">SET_RR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">set_rr0_to_rr4</span><span class="p">,</span> <span class="n">SET_RR0_TO_RR4</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">ssm_i</span><span class="p">,</span> <span class="n">SSM_I</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">rsm_i</span><span class="p">,</span> <span class="n">RSM_I</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">get_psr_i</span><span class="p">,</span> <span class="n">GET_PSR_I</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM</span><span class="p">(</span><span class="n">intrin_local_irq_restore</span><span class="p">,</span>
				      <span class="n">INTRIN_LOCAL_IRQ_RESTORE</span><span class="p">),</span>

<span class="cp">#define IA64_NATIVE_PATCH_BUNDLE_ELEM_GETREG(name, reg)			\</span>
<span class="cp">	{								\</span>
<span class="cp">		(void*)ia64_native_get_ ## name ## _direct_start,	\</span>
<span class="cp">		(void*)ia64_native_get_ ## name ## _direct_end,		\</span>
<span class="cp">		PARAVIRT_PATCH_TYPE_GETREG + _IA64_REG_ ## reg,		\</span>
<span class="cp">	}</span>

<span class="cp">#define IA64_NATIVE_PATCH_BUNDLE_ELEM_SETREG(name, reg)			\</span>
<span class="cp">	{								\</span>
<span class="cp">		(void*)ia64_native_set_ ## name ## _direct_start,	\</span>
<span class="cp">		(void*)ia64_native_set_ ## name ## _direct_end,		\</span>
<span class="cp">		PARAVIRT_PATCH_TYPE_SETREG + _IA64_REG_ ## reg,		\</span>
<span class="cp">	}</span>

<span class="cp">#define IA64_NATIVE_PATCH_BUNDLE_ELEM_REG(name, reg)		\</span>
<span class="cp">	IA64_NATIVE_PATCH_BUNDLE_ELEM_GETREG(name, reg),	\</span>
<span class="cp">	IA64_NATIVE_PATCH_BUNDLE_ELEM_SETREG(name, reg)		\</span>

<span class="cp">#define IA64_NATIVE_PATCH_BUNDLE_ELEM_AR(name, reg)		\</span>
<span class="cp">	IA64_NATIVE_PATCH_BUNDLE_ELEM_REG(ar_ ## name, AR_ ## reg)</span>

<span class="cp">#define IA64_NATIVE_PATCH_BUNDLE_ELEM_CR(name, reg)		\</span>
<span class="cp">	IA64_NATIVE_PATCH_BUNDLE_ELEM_REG(cr_ ## name, CR_ ## reg)</span>

	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_GETREG</span><span class="p">(</span><span class="n">psr</span><span class="p">,</span> <span class="n">PSR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_GETREG</span><span class="p">(</span><span class="n">tp</span><span class="p">,</span> <span class="n">TP</span><span class="p">),</span>

	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_SETREG</span><span class="p">(</span><span class="n">psr_l</span><span class="p">,</span> <span class="n">PSR_L</span><span class="p">),</span>

	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">gp</span><span class="p">,</span> <span class="n">GP</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">SP</span><span class="p">),</span>

	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">kr0</span><span class="p">,</span> <span class="n">AR_KR0</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">kr1</span><span class="p">,</span> <span class="n">AR_KR1</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">kr2</span><span class="p">,</span> <span class="n">AR_KR2</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">kr3</span><span class="p">,</span> <span class="n">AR_KR3</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">kr4</span><span class="p">,</span> <span class="n">AR_KR4</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">kr5</span><span class="p">,</span> <span class="n">AR_KR5</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">kr6</span><span class="p">,</span> <span class="n">AR_KR6</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">kr7</span><span class="p">,</span> <span class="n">AR_KR7</span><span class="p">),</span>

	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">rsc</span><span class="p">,</span> <span class="n">RSC</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">bsp</span><span class="p">,</span> <span class="n">BSP</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">bspstore</span><span class="p">,</span> <span class="n">BSPSTORE</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">rnat</span><span class="p">,</span> <span class="n">RNAT</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">fcr</span><span class="p">,</span> <span class="n">FCR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">eflag</span><span class="p">,</span> <span class="n">EFLAG</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">csd</span><span class="p">,</span> <span class="n">CSD</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">ssd</span><span class="p">,</span> <span class="n">SSD</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_REG</span><span class="p">(</span><span class="n">ar27</span><span class="p">,</span> <span class="n">AR_CFLAG</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">fsr</span><span class="p">,</span> <span class="n">FSR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">fir</span><span class="p">,</span> <span class="n">FIR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">fdr</span><span class="p">,</span> <span class="n">FDR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">ccv</span><span class="p">,</span> <span class="n">CCV</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">unat</span><span class="p">,</span> <span class="n">UNAT</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">fpsr</span><span class="p">,</span> <span class="n">FPSR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">itc</span><span class="p">,</span> <span class="n">ITC</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">pfs</span><span class="p">,</span> <span class="n">PFS</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">lc</span><span class="p">,</span> <span class="n">LC</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_AR</span><span class="p">(</span><span class="n">ec</span><span class="p">,</span> <span class="n">EC</span><span class="p">),</span>

	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">dcr</span><span class="p">,</span> <span class="n">DCR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">itm</span><span class="p">,</span> <span class="n">ITM</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">iva</span><span class="p">,</span> <span class="n">IVA</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">pta</span><span class="p">,</span> <span class="n">PTA</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">ipsr</span><span class="p">,</span> <span class="n">IPSR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">isr</span><span class="p">,</span> <span class="n">ISR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">iip</span><span class="p">,</span> <span class="n">IIP</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">ifa</span><span class="p">,</span> <span class="n">IFA</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">itir</span><span class="p">,</span> <span class="n">ITIR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">iipa</span><span class="p">,</span> <span class="n">IIPA</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">ifs</span><span class="p">,</span> <span class="n">IFS</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">iim</span><span class="p">,</span> <span class="n">IIM</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">iha</span><span class="p">,</span> <span class="n">IHA</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">lid</span><span class="p">,</span> <span class="n">LID</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">ivr</span><span class="p">,</span> <span class="n">IVR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">tpr</span><span class="p">,</span> <span class="n">TPR</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">eoi</span><span class="p">,</span> <span class="n">EOI</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">irr0</span><span class="p">,</span> <span class="n">IRR0</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">irr1</span><span class="p">,</span> <span class="n">IRR1</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">irr2</span><span class="p">,</span> <span class="n">IRR2</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">irr3</span><span class="p">,</span> <span class="n">IRR3</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">itv</span><span class="p">,</span> <span class="n">ITV</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">pmv</span><span class="p">,</span> <span class="n">PMV</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">cmcv</span><span class="p">,</span> <span class="n">CMCV</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">lrr0</span><span class="p">,</span> <span class="n">LRR0</span><span class="p">),</span>
	<span class="n">IA64_NATIVE_PATCH_BUNDLE_ELEM_CR</span><span class="p">(</span><span class="n">lrr1</span><span class="p">,</span> <span class="n">LRR1</span><span class="p">),</span>
<span class="p">};</span>

<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__init_or_module</span>
<span class="nf">ia64_native_patch_bundle</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">sbundle</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">ebundle</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">nelems</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ia64_native_patch_bundle_elems</span><span class="p">)</span> <span class="o">/</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">ia64_native_patch_bundle_elems</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

	<span class="k">return</span> <span class="n">__paravirt_patch_apply_bundle</span><span class="p">(</span><span class="n">sbundle</span><span class="p">,</span> <span class="n">ebundle</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span>
					      <span class="n">ia64_native_patch_bundle_elems</span><span class="p">,</span>
					      <span class="n">nelems</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* ASM_SUPPOTED */</span><span class="cp"></span>

<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">ia64_native_switch_to</span><span class="p">[];</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">ia64_native_leave_syscall</span><span class="p">[];</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">ia64_native_work_processed_syscall</span><span class="p">[];</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">ia64_native_leave_kernel</span><span class="p">[];</span>

<span class="k">const</span> <span class="k">struct</span> <span class="n">paravirt_patch_branch_target</span> <span class="n">ia64_native_branch_target</span><span class="p">[]</span>
<span class="n">__initconst</span> <span class="o">=</span> <span class="p">{</span>
<span class="cp">#define PARAVIRT_BR_TARGET(name, type)			\</span>
<span class="cp">	{						\</span>
<span class="cp">		ia64_native_ ## name,			\</span>
<span class="cp">		PARAVIRT_PATCH_TYPE_BR_ ## type,	\</span>
<span class="cp">	}</span>
	<span class="n">PARAVIRT_BR_TARGET</span><span class="p">(</span><span class="n">switch_to</span><span class="p">,</span> <span class="n">SWITCH_TO</span><span class="p">),</span>
	<span class="n">PARAVIRT_BR_TARGET</span><span class="p">(</span><span class="n">leave_syscall</span><span class="p">,</span> <span class="n">LEAVE_SYSCALL</span><span class="p">),</span>
	<span class="n">PARAVIRT_BR_TARGET</span><span class="p">(</span><span class="n">work_processed_syscall</span><span class="p">,</span> <span class="n">WORK_PROCESSED_SYSCALL</span><span class="p">),</span>
	<span class="n">PARAVIRT_BR_TARGET</span><span class="p">(</span><span class="n">leave_kernel</span><span class="p">,</span> <span class="n">LEAVE_KERNEL</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span>
<span class="nf">ia64_native_patch_branch</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tag</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">nelem</span> <span class="o">=</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">ia64_native_branch_target</span><span class="p">)</span> <span class="o">/</span>
		<span class="k">sizeof</span><span class="p">(</span><span class="n">ia64_native_branch_target</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">__paravirt_patch_apply_branch</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span>
				      <span class="n">ia64_native_branch_target</span><span class="p">,</span> <span class="n">nelem</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
