<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › kernel › unwind_decoder.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>unwind_decoder.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2000 Hewlett-Packard Co</span>
<span class="cm"> * Copyright (C) 2000 David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Generic IA-64 unwind info decoder.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is used both by the Linux kernel and objdump.  Please keep</span>
<span class="cm"> * the two copies of this file in sync.</span>
<span class="cm"> *</span>
<span class="cm"> * You need to customize the decoder by defining the following</span>
<span class="cm"> * macros/constants before including this file:</span>
<span class="cm"> *</span>
<span class="cm"> *  Types:</span>
<span class="cm"> *	unw_word	Unsigned integer type with at least 64 bits </span>
<span class="cm"> *</span>
<span class="cm"> *  Register names:</span>
<span class="cm"> *	UNW_REG_BSP</span>
<span class="cm"> *	UNW_REG_BSPSTORE</span>
<span class="cm"> *	UNW_REG_FPSR</span>
<span class="cm"> *	UNW_REG_LC</span>
<span class="cm"> *	UNW_REG_PFS</span>
<span class="cm"> *	UNW_REG_PR</span>
<span class="cm"> *	UNW_REG_RNAT</span>
<span class="cm"> *	UNW_REG_PSP</span>
<span class="cm"> *	UNW_REG_RP</span>
<span class="cm"> *	UNW_REG_UNAT</span>
<span class="cm"> *</span>
<span class="cm"> *  Decoder action macros:</span>
<span class="cm"> *	UNW_DEC_BAD_CODE(code)</span>
<span class="cm"> *	UNW_DEC_ABI(fmt,abi,context,arg)</span>
<span class="cm"> *	UNW_DEC_BR_GR(fmt,brmask,gr,arg)</span>
<span class="cm"> *	UNW_DEC_BR_MEM(fmt,brmask,arg)</span>
<span class="cm"> *	UNW_DEC_COPY_STATE(fmt,label,arg)</span>
<span class="cm"> *	UNW_DEC_EPILOGUE(fmt,t,ecount,arg)</span>
<span class="cm"> *	UNW_DEC_FRGR_MEM(fmt,grmask,frmask,arg)</span>
<span class="cm"> *	UNW_DEC_FR_MEM(fmt,frmask,arg)</span>
<span class="cm"> *	UNW_DEC_GR_GR(fmt,grmask,gr,arg)</span>
<span class="cm"> *	UNW_DEC_GR_MEM(fmt,grmask,arg)</span>
<span class="cm"> *	UNW_DEC_LABEL_STATE(fmt,label,arg)</span>
<span class="cm"> *	UNW_DEC_MEM_STACK_F(fmt,t,size,arg)</span>
<span class="cm"> *	UNW_DEC_MEM_STACK_V(fmt,t,arg)</span>
<span class="cm"> *	UNW_DEC_PRIUNAT_GR(fmt,r,arg)</span>
<span class="cm"> *	UNW_DEC_PRIUNAT_WHEN_GR(fmt,t,arg)</span>
<span class="cm"> *	UNW_DEC_PRIUNAT_WHEN_MEM(fmt,t,arg)</span>
<span class="cm"> *	UNW_DEC_PRIUNAT_WHEN_PSPREL(fmt,pspoff,arg)</span>
<span class="cm"> *	UNW_DEC_PRIUNAT_WHEN_SPREL(fmt,spoff,arg)</span>
<span class="cm"> *	UNW_DEC_PROLOGUE(fmt,body,rlen,arg)</span>
<span class="cm"> *	UNW_DEC_PROLOGUE_GR(fmt,rlen,mask,grsave,arg)</span>
<span class="cm"> *	UNW_DEC_REG_PSPREL(fmt,reg,pspoff,arg)</span>
<span class="cm"> *	UNW_DEC_REG_REG(fmt,src,dst,arg)</span>
<span class="cm"> *	UNW_DEC_REG_SPREL(fmt,reg,spoff,arg)</span>
<span class="cm"> *	UNW_DEC_REG_WHEN(fmt,reg,t,arg)</span>
<span class="cm"> *	UNW_DEC_RESTORE(fmt,t,abreg,arg)</span>
<span class="cm"> *	UNW_DEC_RESTORE_P(fmt,qp,t,abreg,arg)</span>
<span class="cm"> *	UNW_DEC_SPILL_BASE(fmt,pspoff,arg)</span>
<span class="cm"> *	UNW_DEC_SPILL_MASK(fmt,imaskp,arg)</span>
<span class="cm"> *	UNW_DEC_SPILL_PSPREL(fmt,t,abreg,pspoff,arg)</span>
<span class="cm"> *	UNW_DEC_SPILL_PSPREL_P(fmt,qp,t,abreg,pspoff,arg)</span>
<span class="cm"> *	UNW_DEC_SPILL_REG(fmt,t,abreg,x,ytreg,arg)</span>
<span class="cm"> *	UNW_DEC_SPILL_REG_P(fmt,qp,t,abreg,x,ytreg,arg)</span>
<span class="cm"> *	UNW_DEC_SPILL_SPREL(fmt,t,abreg,spoff,arg)</span>
<span class="cm"> *	UNW_DEC_SPILL_SPREL_P(fmt,qp,t,abreg,pspoff,arg)</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="n">unw_word</span>
<span class="nf">unw_decode_uleb128</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">**</span><span class="n">dpp</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="n">shift</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">unw_word</span> <span class="n">byte</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">bp</span> <span class="o">=</span> <span class="o">*</span><span class="n">dpp</span><span class="p">;</span>

  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">byte</span> <span class="o">=</span> <span class="o">*</span><span class="n">bp</span><span class="o">++</span><span class="p">;</span>
      <span class="n">result</span> <span class="o">|=</span> <span class="p">(</span><span class="n">byte</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">shift</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">byte</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
	<span class="k">break</span><span class="p">;</span>
      <span class="n">shift</span> <span class="o">+=</span> <span class="mi">7</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="o">*</span><span class="n">dpp</span> <span class="o">=</span> <span class="n">bp</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_x1</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte1</span><span class="p">,</span> <span class="n">abreg</span><span class="p">;</span>
  <span class="n">unw_word</span> <span class="n">t</span><span class="p">,</span> <span class="n">off</span><span class="p">;</span>

  <span class="n">byte1</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
  <span class="n">off</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
  <span class="n">abreg</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span>
	  <span class="n">UNW_DEC_SPILL_SPREL</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">else</span>
	  <span class="n">UNW_DEC_SPILL_PSPREL</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_x2</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte1</span><span class="p">,</span> <span class="n">byte2</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ytreg</span><span class="p">;</span>
  <span class="n">unw_word</span> <span class="n">t</span><span class="p">;</span>

  <span class="n">byte1</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span> <span class="n">byte2</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
  <span class="n">abreg</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
  <span class="n">ytreg</span> <span class="o">=</span> <span class="n">byte2</span><span class="p">;</span>
  <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte1</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">ytreg</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">UNW_DEC_RESTORE</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">UNW_DEC_SPILL_REG</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ytreg</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_x3</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte1</span><span class="p">,</span> <span class="n">byte2</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">qp</span><span class="p">;</span>
  <span class="n">unw_word</span> <span class="n">t</span><span class="p">,</span> <span class="n">off</span><span class="p">;</span>

  <span class="n">byte1</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span> <span class="n">byte2</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
  <span class="n">off</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>

  <span class="n">qp</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">);</span>
  <span class="n">abreg</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte2</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span>
    <span class="n">UNW_DEC_SPILL_SPREL_P</span><span class="p">(</span><span class="n">X3</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">UNW_DEC_SPILL_PSPREL_P</span><span class="p">(</span><span class="n">X3</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">off</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_x4</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte1</span><span class="p">,</span> <span class="n">byte2</span><span class="p">,</span> <span class="n">byte3</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ytreg</span><span class="p">;</span>
  <span class="n">unw_word</span> <span class="n">t</span><span class="p">;</span>

  <span class="n">byte1</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span> <span class="n">byte2</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span> <span class="n">byte3</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>

  <span class="n">qp</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">);</span>
  <span class="n">abreg</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte2</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
  <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte2</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">ytreg</span> <span class="o">=</span> <span class="n">byte3</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">((</span><span class="n">byte2</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">byte3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">UNW_DEC_RESTORE_P</span><span class="p">(</span><span class="n">X4</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">UNW_DEC_SPILL_REG_P</span><span class="p">(</span><span class="n">X4</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">abreg</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">ytreg</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_r1</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">body</span> <span class="o">=</span> <span class="p">(</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">unw_word</span> <span class="n">rlen</span><span class="p">;</span>

  <span class="n">rlen</span> <span class="o">=</span> <span class="p">(</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">);</span>
  <span class="n">UNW_DEC_PROLOGUE</span><span class="p">(</span><span class="n">R1</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">rlen</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_r2</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte1</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">grsave</span><span class="p">;</span>
  <span class="n">unw_word</span> <span class="n">rlen</span><span class="p">;</span>

  <span class="n">byte1</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>

  <span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">byte1</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">grsave</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
  <span class="n">rlen</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
  <span class="n">UNW_DEC_PROLOGUE_GR</span><span class="p">(</span><span class="n">R2</span><span class="p">,</span> <span class="n">rlen</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">grsave</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_r3</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">unw_word</span> <span class="n">rlen</span><span class="p">;</span>

  <span class="n">rlen</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
  <span class="n">UNW_DEC_PROLOGUE</span><span class="p">(</span><span class="n">R3</span><span class="p">,</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span> <span class="n">rlen</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_p1</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">brmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">);</span>

  <span class="n">UNW_DEC_BR_MEM</span><span class="p">(</span><span class="n">P1</span><span class="p">,</span> <span class="n">brmask</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_p2_p5</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte1</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>

      <span class="n">UNW_DEC_BR_GR</span><span class="p">(</span><span class="n">P2</span><span class="p">,</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">byte1</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">),</span>
		    <span class="p">(</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">),</span> <span class="n">arg</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">byte1</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">dst</span><span class="p">;</span>

      <span class="n">r</span> <span class="o">=</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">byte1</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
      <span class="n">dst</span> <span class="o">=</span> <span class="p">(</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">);</span>
      <span class="k">switch</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>: <span class="n">UNW_DEC_REG_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">UNW_REG_PSP</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>: <span class="n">UNW_DEC_REG_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">UNW_REG_RP</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>: <span class="n">UNW_DEC_REG_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">UNW_REG_PFS</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>: <span class="n">UNW_DEC_REG_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">UNW_REG_PR</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>: <span class="n">UNW_DEC_REG_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">UNW_REG_UNAT</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">5</span>: <span class="n">UNW_DEC_REG_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">UNW_REG_LC</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">6</span>: <span class="n">UNW_DEC_RP_BR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">7</span>: <span class="n">UNW_DEC_REG_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">UNW_REG_RNAT</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">8</span>: <span class="n">UNW_DEC_REG_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">UNW_REG_BSP</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">9</span>: <span class="n">UNW_DEC_REG_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">UNW_REG_BSPSTORE</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">10</span>: <span class="n">UNW_DEC_REG_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">UNW_REG_FPSR</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">11</span>: <span class="n">UNW_DEC_PRIUNAT_GR</span><span class="p">(</span><span class="n">P3</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span> <span class="n">UNW_DEC_BAD_CODE</span><span class="p">(</span><span class="n">r</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">UNW_DEC_SPILL_MASK</span><span class="p">(</span><span class="n">P4</span><span class="p">,</span> <span class="n">dp</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">unw_word</span> <span class="n">grmask</span><span class="p">,</span> <span class="n">frmask</span><span class="p">,</span> <span class="n">byte1</span><span class="p">,</span> <span class="n">byte2</span><span class="p">,</span> <span class="n">byte3</span><span class="p">;</span>

      <span class="n">byte1</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span> <span class="n">byte2</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span> <span class="n">byte3</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>
      <span class="n">grmask</span> <span class="o">=</span> <span class="p">((</span><span class="n">byte1</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
      <span class="n">frmask</span> <span class="o">=</span> <span class="p">((</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">byte2</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">byte3</span><span class="p">;</span>
      <span class="n">UNW_DEC_FRGR_MEM</span><span class="p">(</span><span class="n">P5</span><span class="p">,</span> <span class="n">grmask</span><span class="p">,</span> <span class="n">frmask</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">else</span>
    <span class="n">UNW_DEC_BAD_CODE</span><span class="p">(</span><span class="n">code</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_p6</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">gregs</span> <span class="o">=</span> <span class="p">(</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">gregs</span><span class="p">)</span>
    <span class="n">UNW_DEC_GR_MEM</span><span class="p">(</span><span class="n">P6</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">UNW_DEC_FR_MEM</span><span class="p">(</span><span class="n">P6</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_p7_p10</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">r</span><span class="p">,</span> <span class="n">byte1</span><span class="p">,</span> <span class="n">byte2</span><span class="p">;</span>
  <span class="n">unw_word</span> <span class="n">t</span><span class="p">,</span> <span class="n">size</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">);</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
      <span class="k">switch</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
	<span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
	  <span class="n">size</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
	  <span class="n">UNW_DEC_MEM_STACK_F</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
	  <span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mi">1</span>: <span class="n">UNW_DEC_MEM_STACK_V</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>: <span class="n">UNW_DEC_SPILL_BASE</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">3</span>: <span class="n">UNW_DEC_REG_SPREL</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_PSP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>: <span class="n">UNW_DEC_REG_WHEN</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_RP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">5</span>: <span class="n">UNW_DEC_REG_PSPREL</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_RP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">6</span>: <span class="n">UNW_DEC_REG_WHEN</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_PFS</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">7</span>: <span class="n">UNW_DEC_REG_PSPREL</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_PFS</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">8</span>: <span class="n">UNW_DEC_REG_WHEN</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_PR</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">9</span>: <span class="n">UNW_DEC_REG_PSPREL</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_PR</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">10</span>: <span class="n">UNW_DEC_REG_WHEN</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_LC</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">11</span>: <span class="n">UNW_DEC_REG_PSPREL</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_LC</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">12</span>: <span class="n">UNW_DEC_REG_WHEN</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_UNAT</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">13</span>: <span class="n">UNW_DEC_REG_PSPREL</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_UNAT</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">14</span>: <span class="n">UNW_DEC_REG_WHEN</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_FPSR</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">15</span>: <span class="n">UNW_DEC_REG_PSPREL</span><span class="p">(</span><span class="n">P7</span><span class="p">,</span> <span class="n">UNW_REG_FPSR</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span> <span class="n">UNW_DEC_BAD_CODE</span><span class="p">(</span><span class="n">r</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
  <span class="k">else</span>
    <span class="p">{</span>
      <span class="k">switch</span> <span class="p">(</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span>
	<span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x0</span>: <span class="cm">/* p8 */</span>
	  <span class="p">{</span>
	    <span class="n">r</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>
	    <span class="n">t</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
	    <span class="k">switch</span> <span class="p">(</span><span class="n">r</span><span class="p">)</span>
	      <span class="p">{</span>
	      <span class="k">case</span>  <span class="mi">1</span>: <span class="n">UNW_DEC_REG_SPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_RP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span>  <span class="mi">2</span>: <span class="n">UNW_DEC_REG_SPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_PFS</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span>  <span class="mi">3</span>: <span class="n">UNW_DEC_REG_SPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_PR</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span>  <span class="mi">4</span>: <span class="n">UNW_DEC_REG_SPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_LC</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span>  <span class="mi">5</span>: <span class="n">UNW_DEC_REG_SPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_UNAT</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span>  <span class="mi">6</span>: <span class="n">UNW_DEC_REG_SPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_FPSR</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span>  <span class="mi">7</span>: <span class="n">UNW_DEC_REG_WHEN</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_BSP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span>  <span class="mi">8</span>: <span class="n">UNW_DEC_REG_PSPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_BSP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span>  <span class="mi">9</span>: <span class="n">UNW_DEC_REG_SPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_BSP</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">10</span>: <span class="n">UNW_DEC_REG_WHEN</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_BSPSTORE</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">11</span>: <span class="n">UNW_DEC_REG_PSPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_BSPSTORE</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">12</span>: <span class="n">UNW_DEC_REG_SPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_BSPSTORE</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">13</span>: <span class="n">UNW_DEC_REG_WHEN</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_RNAT</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">14</span>: <span class="n">UNW_DEC_REG_PSPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_RNAT</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">15</span>: <span class="n">UNW_DEC_REG_SPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">UNW_REG_RNAT</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">16</span>: <span class="n">UNW_DEC_PRIUNAT_WHEN_GR</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">17</span>: <span class="n">UNW_DEC_PRIUNAT_PSPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">18</span>: <span class="n">UNW_DEC_PRIUNAT_SPREL</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="k">case</span> <span class="mi">19</span>: <span class="n">UNW_DEC_PRIUNAT_WHEN_MEM</span><span class="p">(</span><span class="n">P8</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	      <span class="nl">default:</span> <span class="n">UNW_DEC_BAD_CODE</span><span class="p">(</span><span class="n">r</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	    <span class="p">}</span>
	  <span class="p">}</span>
	  <span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mh">0x1</span>:
	  <span class="n">byte1</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span> <span class="n">byte2</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>
	  <span class="n">UNW_DEC_GR_GR</span><span class="p">(</span><span class="n">P9</span><span class="p">,</span> <span class="p">(</span><span class="n">byte1</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">),</span> <span class="p">(</span><span class="n">byte2</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">),</span> <span class="n">arg</span><span class="p">);</span>
	  <span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mh">0xf</span>: <span class="cm">/* p10 */</span>
	  <span class="n">byte1</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span> <span class="n">byte2</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>
	  <span class="n">UNW_DEC_ABI</span><span class="p">(</span><span class="n">P10</span><span class="p">,</span> <span class="n">byte1</span><span class="p">,</span> <span class="n">byte2</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
	  <span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mh">0x9</span>:
	  <span class="k">return</span> <span class="n">unw_decode_x1</span> <span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>

	<span class="k">case</span> <span class="mh">0xa</span>:
	  <span class="k">return</span> <span class="n">unw_decode_x2</span> <span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>

	<span class="k">case</span> <span class="mh">0xb</span>:
	  <span class="k">return</span> <span class="n">unw_decode_x3</span> <span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>

	<span class="k">case</span> <span class="mh">0xc</span>:
	  <span class="k">return</span> <span class="n">unw_decode_x4</span> <span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>

	<span class="nl">default:</span>
	  <span class="n">UNW_DEC_BAD_CODE</span><span class="p">(</span><span class="n">code</span><span class="p">);</span>
	  <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_b1</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">unw_word</span> <span class="n">label</span> <span class="o">=</span> <span class="p">(</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">UNW_DEC_COPY_STATE</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="n">UNW_DEC_LABEL_STATE</span><span class="p">(</span><span class="n">B1</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_b2</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">unw_word</span> <span class="n">t</span><span class="p">;</span>

  <span class="n">t</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
  <span class="n">UNW_DEC_EPILOGUE</span><span class="p">(</span><span class="n">B2</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x1f</span><span class="p">),</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode_b3_x4</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">unw_word</span> <span class="n">t</span><span class="p">,</span> <span class="n">ecount</span><span class="p">,</span> <span class="n">label</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
      <span class="n">ecount</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
      <span class="n">UNW_DEC_EPILOGUE</span><span class="p">(</span><span class="n">B3</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">ecount</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">label</span> <span class="o">=</span> <span class="n">unw_decode_uleb128</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">dp</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">((</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
	<span class="n">UNW_DEC_COPY_STATE</span><span class="p">(</span><span class="n">B4</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
      <span class="k">else</span>
	<span class="n">UNW_DEC_LABEL_STATE</span><span class="p">(</span><span class="n">B4</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">else</span>
    <span class="k">switch</span> <span class="p">(</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span>
      <span class="p">{</span>
      <span class="k">case</span> <span class="mi">1</span>: <span class="k">return</span> <span class="n">unw_decode_x1</span> <span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
      <span class="k">case</span> <span class="mi">2</span>: <span class="k">return</span> <span class="n">unw_decode_x2</span> <span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
      <span class="k">case</span> <span class="mi">3</span>: <span class="k">return</span> <span class="n">unw_decode_x3</span> <span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
      <span class="k">case</span> <span class="mi">4</span>: <span class="k">return</span> <span class="n">unw_decode_x4</span> <span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
      <span class="nl">default:</span> <span class="n">UNW_DEC_BAD_CODE</span><span class="p">(</span><span class="n">code</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">unw_decoder</span><span class="p">)</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">);</span>

<span class="k">static</span> <span class="n">unw_decoder</span> <span class="n">unw_decode_table</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span>
<span class="p">{</span>
  <span class="cm">/* prologue table: */</span>
  <span class="p">{</span>
    <span class="n">unw_decode_r1</span><span class="p">,</span>	<span class="cm">/* 0 */</span>
    <span class="n">unw_decode_r1</span><span class="p">,</span>
    <span class="n">unw_decode_r2</span><span class="p">,</span>
    <span class="n">unw_decode_r3</span><span class="p">,</span>
    <span class="n">unw_decode_p1</span><span class="p">,</span>	<span class="cm">/* 4 */</span>
    <span class="n">unw_decode_p2_p5</span><span class="p">,</span>
    <span class="n">unw_decode_p6</span><span class="p">,</span>
    <span class="n">unw_decode_p7_p10</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="n">unw_decode_r1</span><span class="p">,</span>	<span class="cm">/* 0 */</span>
    <span class="n">unw_decode_r1</span><span class="p">,</span>
    <span class="n">unw_decode_r2</span><span class="p">,</span>
    <span class="n">unw_decode_r3</span><span class="p">,</span>
    <span class="n">unw_decode_b1</span><span class="p">,</span>	<span class="cm">/* 4 */</span>
    <span class="n">unw_decode_b1</span><span class="p">,</span>
    <span class="n">unw_decode_b2</span><span class="p">,</span>
    <span class="n">unw_decode_b3_x4</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Decode one descriptor and return address of next descriptor.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span>
<span class="nf">unw_decode</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">inside_body</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">unw_decoder</span> <span class="n">decoder</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">code</span><span class="p">;</span>

  <span class="n">code</span> <span class="o">=</span> <span class="o">*</span><span class="n">dp</span><span class="o">++</span><span class="p">;</span>
  <span class="n">decoder</span> <span class="o">=</span> <span class="n">unw_decode_table</span><span class="p">[</span><span class="n">inside_body</span><span class="p">][</span><span class="n">code</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">];</span>
  <span class="n">dp</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">decoder</span><span class="p">)</span> <span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">dp</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
