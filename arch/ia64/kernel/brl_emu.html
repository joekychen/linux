<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › kernel › brl_emu.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>brl_emu.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  Emulation of the &quot;brl&quot; instruction for IA64 processors that</span>
<span class="cm"> *  don&#39;t support it in hardware.</span>
<span class="cm"> *  Author: Stephan Zeisset, Intel Corp. &lt;Stephan.Zeisset@intel.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *    02/22/02	D. Mosberger	Clear si_flgs, si_isr, and si_imm to avoid</span>
<span class="cm"> *				leaking kernel bits.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;asm/uaccess.h&gt;</span>
<span class="cp">#include &lt;asm/processor.h&gt;</span>

<span class="k">extern</span> <span class="kt">char</span> <span class="n">ia64_set_b1</span><span class="p">,</span> <span class="n">ia64_set_b2</span><span class="p">,</span> <span class="n">ia64_set_b3</span><span class="p">,</span> <span class="n">ia64_set_b4</span><span class="p">,</span> <span class="n">ia64_set_b5</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">illegal_op_return</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">fkt</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> *  The unimplemented bits of a virtual address must be set</span>
<span class="cm"> *  to the value of the most significant implemented bit.</span>
<span class="cm"> *  unimpl_va_mask includes all unimplemented bits and</span>
<span class="cm"> *  the most significant implemented bit, so the result</span>
<span class="cm"> *  of an and operation with the mask must be all 0&#39;s</span>
<span class="cm"> *  or all 1&#39;s for the address to be valid.</span>
<span class="cm"> */</span>
<span class="cp">#define unimplemented_virtual_address(va) (						\</span>
<span class="cp">	((va) &amp; local_cpu_data-&gt;unimpl_va_mask) != 0 &amp;&amp;					\</span>
<span class="cp">	((va) &amp; local_cpu_data-&gt;unimpl_va_mask) != local_cpu_data-&gt;unimpl_va_mask	\</span>
<span class="cp">)</span>

<span class="cm">/*</span>
<span class="cm"> *  The unimplemented bits of a physical address must be 0.</span>
<span class="cm"> *  unimpl_pa_mask includes all unimplemented bits, so the result</span>
<span class="cm"> *  of an and operation with the mask must be all 0&#39;s for the</span>
<span class="cm"> *  address to be valid.</span>
<span class="cm"> */</span>
<span class="cp">#define unimplemented_physical_address(pa) (		\</span>
<span class="cp">	((pa) &amp; local_cpu_data-&gt;unimpl_pa_mask) != 0	\</span>
<span class="cp">)</span>

<span class="cm">/*</span>
<span class="cm"> *  Handle an illegal operation fault that was caused by an</span>
<span class="cm"> *  unimplemented &quot;brl&quot; instruction.</span>
<span class="cm"> *  If we are not successful (e.g because the illegal operation</span>
<span class="cm"> *  wasn&#39;t caused by a &quot;brl&quot; after all), we return -1.</span>
<span class="cm"> *  If we are successful, we return either 0 or the address</span>
<span class="cm"> *  of a &quot;fixup&quot; function for manipulating preserved register</span>
<span class="cm"> *  state.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">illegal_op_return</span>
<span class="nf">ia64_emulate_brl</span> <span class="p">(</span><span class="k">struct</span> <span class="n">pt_regs</span> <span class="o">*</span><span class="n">regs</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar_ec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bundle</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">btype</span><span class="p">,</span> <span class="n">qp</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="n">cpl</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">next_ip</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">siginfo</span> <span class="n">siginfo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">illegal_op_return</span> <span class="n">rv</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">tmp_taken</span><span class="p">,</span> <span class="n">unimplemented_address</span><span class="p">;</span>

	<span class="n">rv</span><span class="p">.</span><span class="n">fkt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 *  Decode the instruction bundle.</span>
<span class="cm">	 */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">bundle</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_iip</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">bundle</span><span class="p">)))</span>
		<span class="k">return</span> <span class="n">rv</span><span class="p">;</span>

	<span class="n">next_ip</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_iip</span> <span class="o">+</span> <span class="mi">16</span><span class="p">;</span>

	<span class="cm">/* &quot;brl&quot; must be in slot 2. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ia64_psr</span><span class="p">(</span><span class="n">regs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ri</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="n">rv</span><span class="p">;</span>

	<span class="cm">/* Must be &quot;mlx&quot; template */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x1e</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0x4</span><span class="p">)</span> <span class="k">return</span> <span class="n">rv</span><span class="p">;</span>

	<span class="n">opcode</span> <span class="o">=</span> <span class="p">(</span><span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">60</span><span class="p">);</span>
	<span class="n">btype</span> <span class="o">=</span> <span class="p">((</span><span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">29</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">);</span>
	<span class="n">qp</span> <span class="o">=</span> <span class="p">((</span><span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">23</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">);</span>
	<span class="n">offset</span> <span class="o">=</span> <span class="p">((</span><span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x0800000000000000L</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span>
		<span class="o">|</span> <span class="p">((</span><span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x00fffff000000000L</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">)</span>
		<span class="o">|</span> <span class="p">((</span><span class="n">bundle</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x00000000007fffffL</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">40</span><span class="p">)</span>
		<span class="o">|</span> <span class="p">((</span><span class="n">bundle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xffff000000000000L</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">);</span>

	<span class="n">tmp_taken</span> <span class="o">=</span> <span class="n">regs</span><span class="o">-&gt;</span><span class="n">pr</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1L</span> <span class="o">&lt;&lt;</span> <span class="n">qp</span><span class="p">);</span>

	<span class="k">switch</span><span class="p">(</span><span class="n">opcode</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">case</span> <span class="mh">0xC</span>:
			<span class="cm">/*</span>
<span class="cm">			 *  Long Branch.</span>
<span class="cm">			 */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">btype</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">rv</span><span class="p">;</span>
			<span class="n">rv</span><span class="p">.</span><span class="n">fkt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tmp_taken</span><span class="p">))</span> <span class="p">{</span>
				<span class="cm">/*</span>
<span class="cm">				 *  Qualifying predicate is 0.</span>
<span class="cm">				 *  Skip instruction.</span>
<span class="cm">				 */</span>
				<span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_iip</span> <span class="o">=</span> <span class="n">next_ip</span><span class="p">;</span>
				<span class="n">ia64_psr</span><span class="p">(</span><span class="n">regs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ri</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">return</span> <span class="n">rv</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mh">0xD</span>:
			<span class="cm">/*</span>
<span class="cm">			 *  Long Call.</span>
<span class="cm">			 */</span>
			<span class="n">rv</span><span class="p">.</span><span class="n">fkt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tmp_taken</span><span class="p">))</span> <span class="p">{</span>
				<span class="cm">/*</span>
<span class="cm">				 *  Qualifying predicate is 0.</span>
<span class="cm">				 *  Skip instruction.</span>
<span class="cm">				 */</span>
				<span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_iip</span> <span class="o">=</span> <span class="n">next_ip</span><span class="p">;</span>
				<span class="n">ia64_psr</span><span class="p">(</span><span class="n">regs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ri</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">return</span> <span class="n">rv</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="cm">/*</span>
<span class="cm">			 *  BR[btype] = IP+16</span>
<span class="cm">			 */</span>
			<span class="k">switch</span><span class="p">(</span><span class="n">btype</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">case</span> <span class="mi">0</span>:
					<span class="n">regs</span><span class="o">-&gt;</span><span class="n">b0</span> <span class="o">=</span> <span class="n">next_ip</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">1</span>:
					<span class="n">rv</span><span class="p">.</span><span class="n">fkt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">ia64_set_b1</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">2</span>:
					<span class="n">rv</span><span class="p">.</span><span class="n">fkt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">ia64_set_b2</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">3</span>:
					<span class="n">rv</span><span class="p">.</span><span class="n">fkt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">ia64_set_b3</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">4</span>:
					<span class="n">rv</span><span class="p">.</span><span class="n">fkt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">ia64_set_b4</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">5</span>:
					<span class="n">rv</span><span class="p">.</span><span class="n">fkt</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">ia64_set_b5</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">6</span>:
					<span class="n">regs</span><span class="o">-&gt;</span><span class="n">b6</span> <span class="o">=</span> <span class="n">next_ip</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="k">case</span> <span class="mi">7</span>:
					<span class="n">regs</span><span class="o">-&gt;</span><span class="n">b7</span> <span class="o">=</span> <span class="n">next_ip</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">rv</span><span class="p">.</span><span class="n">arg1</span> <span class="o">=</span> <span class="n">next_ip</span><span class="p">;</span>

			<span class="cm">/*</span>
<span class="cm">			 *  AR[PFS].pfm = CFM</span>
<span class="cm">			 *  AR[PFS].pec = AR[EC]</span>
<span class="cm">			 *  AR[PFS].ppl = PSR.cpl</span>
<span class="cm">			 */</span>
			<span class="n">cpl</span> <span class="o">=</span> <span class="n">ia64_psr</span><span class="p">(</span><span class="n">regs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">cpl</span><span class="p">;</span>
			<span class="n">regs</span><span class="o">-&gt;</span><span class="n">ar_pfs</span> <span class="o">=</span> <span class="p">((</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_ifs</span> <span class="o">&amp;</span> <span class="mh">0x3fffffffff</span><span class="p">)</span>
					<span class="o">|</span> <span class="p">(</span><span class="n">ar_ec</span> <span class="o">&lt;&lt;</span> <span class="mi">52</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cpl</span> <span class="o">&lt;&lt;</span> <span class="mi">62</span><span class="p">));</span>

			<span class="cm">/*</span>
<span class="cm">			 *  CFM.sof -= CFM.sol</span>
<span class="cm">			 *  CFM.sol = 0</span>
<span class="cm">			 *  CFM.sor = 0</span>
<span class="cm">			 *  CFM.rrb.gr = 0</span>
<span class="cm">			 *  CFM.rrb.fr = 0</span>
<span class="cm">			 *  CFM.rrb.pr = 0</span>
<span class="cm">			 */</span>
			<span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_ifs</span> <span class="o">=</span> <span class="p">((</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_ifs</span> <span class="o">&amp;</span> <span class="mh">0xffffffc00000007f</span><span class="p">)</span>
					<span class="o">-</span> <span class="p">((</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_ifs</span> <span class="o">&gt;&gt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">));</span>

			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span>
			<span class="cm">/*</span>
<span class="cm">			 *  Unknown opcode.</span>
<span class="cm">			 */</span>
			<span class="k">return</span> <span class="n">rv</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_iip</span> <span class="o">+=</span> <span class="n">offset</span><span class="p">;</span>
	<span class="n">ia64_psr</span><span class="p">(</span><span class="n">regs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ri</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ia64_psr</span><span class="p">(</span><span class="n">regs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">it</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">unimplemented_address</span> <span class="o">=</span> <span class="n">unimplemented_physical_address</span><span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_iip</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">unimplemented_address</span> <span class="o">=</span> <span class="n">unimplemented_virtual_address</span><span class="p">(</span><span class="n">regs</span><span class="o">-&gt;</span><span class="n">cr_iip</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">unimplemented_address</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 *  The target address contains unimplemented bits.</span>
<span class="cm">		 */</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_DEBUG</span> <span class="s">&quot;Woah! Unimplemented Instruction Address Trap!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_signo</span> <span class="o">=</span> <span class="n">SIGILL</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_errno</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_isr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_imm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_code</span> <span class="o">=</span> <span class="n">ILL_BADIADDR</span><span class="p">;</span>
		<span class="n">force_sig_info</span><span class="p">(</span><span class="n">SIGILL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">siginfo</span><span class="p">,</span> <span class="n">current</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ia64_psr</span><span class="p">(</span><span class="n">regs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">tb</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 *  Branch Tracing is enabled.</span>
<span class="cm">		 *  Force a taken branch signal.</span>
<span class="cm">		 */</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_signo</span> <span class="o">=</span> <span class="n">SIGTRAP</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_errno</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_code</span> <span class="o">=</span> <span class="n">TRAP_BRANCH</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_isr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_addr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_imm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">force_sig_info</span><span class="p">(</span><span class="n">SIGTRAP</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">siginfo</span><span class="p">,</span> <span class="n">current</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ia64_psr</span><span class="p">(</span><span class="n">regs</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">ss</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 *  Single Step is enabled.</span>
<span class="cm">		 *  Force a trace signal.</span>
<span class="cm">		 */</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_signo</span> <span class="o">=</span> <span class="n">SIGTRAP</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_errno</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_code</span> <span class="o">=</span> <span class="n">TRAP_TRACE</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_isr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_addr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">siginfo</span><span class="p">.</span><span class="n">si_imm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">force_sig_info</span><span class="p">(</span><span class="n">SIGTRAP</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">siginfo</span><span class="p">,</span> <span class="n">current</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">rv</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
