<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › include › asm › hw_irq.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>hw_irq.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_IA64_HW_IRQ_H</span>
<span class="cp">#define _ASM_IA64_HW_IRQ_H</span>

<span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2001-2003 Hewlett-Packard Co</span>
<span class="cm"> *	David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/profile.h&gt;</span>

<span class="cp">#include &lt;asm/machvec.h&gt;</span>
<span class="cp">#include &lt;asm/ptrace.h&gt;</span>
<span class="cp">#include &lt;asm/smp.h&gt;</span>

<span class="cp">#ifndef CONFIG_PARAVIRT</span>
<span class="k">typedef</span> <span class="n">u8</span> <span class="n">ia64_vector</span><span class="p">;</span>
<span class="cp">#else</span>
<span class="k">typedef</span> <span class="n">u16</span> <span class="n">ia64_vector</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * 0 special</span>
<span class="cm"> *</span>
<span class="cm"> * 1,3-14 are reserved from firmware</span>
<span class="cm"> *</span>
<span class="cm"> * 16-255 (vectored external interrupts) are available</span>
<span class="cm"> *</span>
<span class="cm"> * 15 spurious interrupt (see IVR)</span>
<span class="cm"> *</span>
<span class="cm"> * 16 lowest priority, 255 highest priority</span>
<span class="cm"> *</span>
<span class="cm"> * 15 classes of 16 interrupts each.</span>
<span class="cm"> */</span>
<span class="cp">#define IA64_MIN_VECTORED_IRQ		 16</span>
<span class="cp">#define IA64_MAX_VECTORED_IRQ		255</span>
<span class="cp">#define IA64_NUM_VECTORS		256</span>

<span class="cp">#define AUTO_ASSIGN			-1</span>

<span class="cp">#define IA64_SPURIOUS_INT_VECTOR	0x0f</span>

<span class="cm">/*</span>
<span class="cm"> * Vectors 0x10-0x1f are used for low priority interrupts, e.g. CMCI.</span>
<span class="cm"> */</span>
<span class="cp">#define IA64_CPEP_VECTOR		0x1c	</span><span class="cm">/* corrected platform error polling vector */</span><span class="cp"></span>
<span class="cp">#define IA64_CMCP_VECTOR		0x1d	</span><span class="cm">/* corrected machine-check polling vector */</span><span class="cp"></span>
<span class="cp">#define IA64_CPE_VECTOR			0x1e	</span><span class="cm">/* corrected platform error interrupt vector */</span><span class="cp"></span>
<span class="cp">#define IA64_CMC_VECTOR			0x1f	</span><span class="cm">/* corrected machine-check interrupt vector */</span><span class="cp"></span>
<span class="cm">/*</span>
<span class="cm"> * Vectors 0x20-0x2f are reserved for legacy ISA IRQs.</span>
<span class="cm"> * Use vectors 0x30-0xe7 as the default device vector range for ia64.</span>
<span class="cm"> * Platforms may choose to reduce this range in platform_irq_setup, but the</span>
<span class="cm"> * platform range must fall within</span>
<span class="cm"> *	[IA64_DEF_FIRST_DEVICE_VECTOR..IA64_DEF_LAST_DEVICE_VECTOR]</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ia64_first_device_vector</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ia64_last_device_vector</span><span class="p">;</span>

<span class="cp">#if defined(CONFIG_SMP) &amp;&amp; (defined(CONFIG_IA64_GENERIC) || defined (CONFIG_IA64_DIG))</span>
<span class="cm">/* Reserve the lower priority vector than device vectors for &quot;move IRQ&quot; IPI */</span>
<span class="cp">#define IA64_IRQ_MOVE_VECTOR		0x30	</span><span class="cm">/* &quot;move IRQ&quot; IPI */</span><span class="cp"></span>
<span class="cp">#define IA64_DEF_FIRST_DEVICE_VECTOR	0x31</span>
<span class="cp">#else</span>
<span class="cp">#define IA64_DEF_FIRST_DEVICE_VECTOR	0x30</span>
<span class="cp">#endif</span>
<span class="cp">#define IA64_DEF_LAST_DEVICE_VECTOR	0xe7</span>
<span class="cp">#define IA64_FIRST_DEVICE_VECTOR	ia64_first_device_vector</span>
<span class="cp">#define IA64_LAST_DEVICE_VECTOR		ia64_last_device_vector</span>
<span class="cp">#define IA64_MAX_DEVICE_VECTORS		(IA64_DEF_LAST_DEVICE_VECTOR - IA64_DEF_FIRST_DEVICE_VECTOR + 1)</span>
<span class="cp">#define IA64_NUM_DEVICE_VECTORS		(IA64_LAST_DEVICE_VECTOR - IA64_FIRST_DEVICE_VECTOR + 1)</span>

<span class="cp">#define IA64_MCA_RENDEZ_VECTOR		0xe8	</span><span class="cm">/* MCA rendez interrupt */</span><span class="cp"></span>
<span class="cp">#define IA64_PERFMON_VECTOR		0xee	</span><span class="cm">/* performance monitor interrupt vector */</span><span class="cp"></span>
<span class="cp">#define IA64_TIMER_VECTOR		0xef	</span><span class="cm">/* use highest-prio group 15 interrupt for timer */</span><span class="cp"></span>
<span class="cp">#define	IA64_MCA_WAKEUP_VECTOR		0xf0	</span><span class="cm">/* MCA wakeup (must be &gt;MCA_RENDEZ_VECTOR) */</span><span class="cp"></span>
<span class="cp">#define IA64_IPI_LOCAL_TLB_FLUSH	0xfc	</span><span class="cm">/* SMP flush local TLB */</span><span class="cp"></span>
<span class="cp">#define IA64_IPI_RESCHEDULE		0xfd	</span><span class="cm">/* SMP reschedule */</span><span class="cp"></span>
<span class="cp">#define IA64_IPI_VECTOR			0xfe	</span><span class="cm">/* inter-processor interrupt vector */</span><span class="cp"></span>

<span class="cm">/* Used for encoding redirected irqs */</span>

<span class="cp">#define IA64_IRQ_REDIRECTED		(1 &lt;&lt; 31)</span>

<span class="cm">/* IA64 inter-cpu interrupt related definitions */</span>

<span class="cp">#define IA64_IPI_DEFAULT_BASE_ADDR	0xfee00000</span>

<span class="cm">/* Delivery modes for inter-cpu interrupts */</span>
<span class="k">enum</span> <span class="p">{</span>
        <span class="n">IA64_IPI_DM_INT</span> <span class="o">=</span>       <span class="mh">0x0</span><span class="p">,</span>    <span class="cm">/* pend an external interrupt */</span>
        <span class="n">IA64_IPI_DM_PMI</span> <span class="o">=</span>       <span class="mh">0x2</span><span class="p">,</span>    <span class="cm">/* pend a PMI */</span>
        <span class="n">IA64_IPI_DM_NMI</span> <span class="o">=</span>       <span class="mh">0x4</span><span class="p">,</span>    <span class="cm">/* pend an NMI (vector 2) */</span>
        <span class="n">IA64_IPI_DM_INIT</span> <span class="o">=</span>      <span class="mh">0x5</span><span class="p">,</span>    <span class="cm">/* pend an INIT interrupt */</span>
        <span class="n">IA64_IPI_DM_EXTINT</span> <span class="o">=</span>    <span class="mh">0x7</span><span class="p">,</span>    <span class="cm">/* pend an 8259-compatible interrupt. */</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="n">__u8</span> <span class="n">isa_irq_to_vector_map</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="cp">#define isa_irq_to_vector(x)	isa_irq_to_vector_map[(x)]</span>

<span class="k">struct</span> <span class="n">irq_cfg</span> <span class="p">{</span>
	<span class="n">ia64_vector</span> <span class="n">vector</span><span class="p">;</span>
	<span class="n">cpumask_t</span> <span class="n">domain</span><span class="p">;</span>
	<span class="n">cpumask_t</span> <span class="n">old_domain</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">move_cleanup_count</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">move_in_progress</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">extern</span> <span class="n">spinlock_t</span> <span class="n">vector_lock</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">irq_cfg</span> <span class="n">irq_cfg</span><span class="p">[</span><span class="n">NR_IRQS</span><span class="p">];</span>
<span class="cp">#define irq_to_domain(x)	irq_cfg[(x)].domain</span>
<span class="n">DECLARE_PER_CPU</span><span class="p">(</span><span class="kt">int</span><span class="p">[</span><span class="n">IA64_NUM_VECTORS</span><span class="p">],</span> <span class="n">vector_irq</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">irq_chip</span> <span class="n">irq_type_ia64_lsapic</span><span class="p">;</span>	<span class="cm">/* CPU-internal interrupt controller */</span>

<span class="cp">#ifdef CONFIG_PARAVIRT_GUEST</span>
<span class="cp">#include &lt;asm/paravirt.h&gt;</span>
<span class="cp">#else</span>
<span class="cp">#define ia64_register_ipi	ia64_native_register_ipi</span>
<span class="cp">#define assign_irq_vector	ia64_native_assign_irq_vector</span>
<span class="cp">#define free_irq_vector		ia64_native_free_irq_vector</span>
<span class="cp">#define register_percpu_irq	ia64_native_register_percpu_irq</span>
<span class="cp">#define ia64_resend_irq		ia64_native_resend_irq</span>
<span class="cp">#endif</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_native_register_ipi</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">bind_irq_vector</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">vector</span><span class="p">,</span> <span class="n">cpumask_t</span> <span class="n">domain</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ia64_native_assign_irq_vector</span> <span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">);</span>	<span class="cm">/* allocate a free vector */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_native_free_irq_vector</span> <span class="p">(</span><span class="kt">int</span> <span class="n">vector</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">reserve_irq_vector</span> <span class="p">(</span><span class="kt">int</span> <span class="n">vector</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__setup_vector_irq</span><span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_send_ipi</span> <span class="p">(</span><span class="kt">int</span> <span class="n">cpu</span><span class="p">,</span> <span class="kt">int</span> <span class="n">vector</span><span class="p">,</span> <span class="kt">int</span> <span class="n">delivery_mode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">redirect</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_native_register_percpu_irq</span> <span class="p">(</span><span class="n">ia64_vector</span> <span class="n">vec</span><span class="p">,</span> <span class="k">struct</span> <span class="n">irqaction</span> <span class="o">*</span><span class="n">action</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">check_irq_used</span> <span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">destroy_and_reserve_irq</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">);</span>

<span class="cp">#if defined(CONFIG_SMP) &amp;&amp; (defined(CONFIG_IA64_GENERIC) || defined(CONFIG_IA64_DIG))</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">irq_prepare_move</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cpu</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">irq_complete_move</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">);</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">irq_prepare_move</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cpu</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="p">}</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">irq_complete_move</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">)</span> <span class="p">{}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ia64_native_resend_irq</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vector</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">platform_send_ipi</span><span class="p">(</span><span class="n">smp_processor_id</span><span class="p">(),</span> <span class="n">vector</span><span class="p">,</span> <span class="n">IA64_IPI_DM_INT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Default implementations for the irq-descriptor API:</span>
<span class="cm"> */</span>
<span class="cp">#ifndef CONFIG_IA64_GENERIC</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">ia64_vector</span> <span class="nf">__ia64_irq_to_vector</span><span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">irq_cfg</span><span class="p">[</span><span class="n">irq</span><span class="p">].</span><span class="n">vector</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span>
<span class="nf">__ia64_local_vector_to_irq</span> <span class="p">(</span><span class="n">ia64_vector</span> <span class="n">vec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__get_cpu_var</span><span class="p">(</span><span class="n">vector_irq</span><span class="p">)[</span><span class="n">vec</span><span class="p">];</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * Next follows the irq descriptor interface.  On IA-64, each CPU supports 256 interrupt</span>
<span class="cm"> * vectors.  On smaller systems, there is a one-to-one correspondence between interrupt</span>
<span class="cm"> * vectors and the Linux irq numbers.  However, larger systems may have multiple interrupt</span>
<span class="cm"> * domains meaning that the translation from vector number to irq number depends on the</span>
<span class="cm"> * interrupt domain that a CPU belongs to.  This API abstracts such platform-dependent</span>
<span class="cm"> * differences and provides a uniform means to translate between vector and irq numbers</span>
<span class="cm"> * and to obtain the irq descriptor for a given irq number.</span>
<span class="cm"> */</span>

<span class="cm">/* Extract the IA-64 vector that corresponds to IRQ.  */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">ia64_vector</span>
<span class="nf">irq_to_vector</span> <span class="p">(</span><span class="kt">int</span> <span class="n">irq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">platform_irq_to_vector</span><span class="p">(</span><span class="n">irq</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Convert the local IA-64 vector to the corresponding irq number.  This translation is</span>
<span class="cm"> * done in the context of the interrupt domain that the currently executing CPU belongs</span>
<span class="cm"> * to.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span>
<span class="nf">local_vector_to_irq</span> <span class="p">(</span><span class="n">ia64_vector</span> <span class="n">vec</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">platform_local_vector_to_irq</span><span class="p">(</span><span class="n">vec</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_IA64_HW_IRQ_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
