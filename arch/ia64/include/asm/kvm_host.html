<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › include › asm › kvm_host.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>kvm_host.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * kvm_host.h: used for kvm module, and hold ia64-specific sections.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2007, Intel Corporation.</span>
<span class="cm"> *</span>
<span class="cm"> * Xiantao Zhang &lt;xiantao.zhang@intel.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms and conditions of the GNU General Public License,</span>
<span class="cm"> * version 2, as published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope it will be useful, but WITHOUT</span>
<span class="cm"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>
<span class="cm"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>
<span class="cm"> * more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License along with</span>
<span class="cm"> * this program; if not, write to the Free Software Foundation, Inc., 59 Temple</span>
<span class="cm"> * Place - Suite 330, Boston, MA 02111-1307 USA.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASM_KVM_HOST_H</span>
<span class="cp">#define __ASM_KVM_HOST_H</span>

<span class="cp">#define KVM_MEMORY_SLOTS 32</span>
<span class="cm">/* memory slots that does not exposed to userspace */</span>
<span class="cp">#define KVM_PRIVATE_MEM_SLOTS 4</span>

<span class="cp">#define KVM_COALESCED_MMIO_PAGE_OFFSET 1</span>

<span class="cm">/* define exit reasons from vmm to kvm*/</span>
<span class="cp">#define EXIT_REASON_VM_PANIC		0</span>
<span class="cp">#define EXIT_REASON_MMIO_INSTRUCTION	1</span>
<span class="cp">#define EXIT_REASON_PAL_CALL		2</span>
<span class="cp">#define EXIT_REASON_SAL_CALL		3</span>
<span class="cp">#define EXIT_REASON_SWITCH_RR6		4</span>
<span class="cp">#define EXIT_REASON_VM_DESTROY		5</span>
<span class="cp">#define EXIT_REASON_EXTERNAL_INTERRUPT	6</span>
<span class="cp">#define EXIT_REASON_IPI			7</span>
<span class="cp">#define EXIT_REASON_PTC_G		8</span>
<span class="cp">#define EXIT_REASON_DEBUG		20</span>

<span class="cm">/*Define vmm address space and vm data space.*/</span>
<span class="cp">#define KVM_VMM_SIZE (__IA64_UL_CONST(16)&lt;&lt;20)</span>
<span class="cp">#define KVM_VMM_SHIFT 24</span>
<span class="cp">#define KVM_VMM_BASE 0xD000000000000000</span>
<span class="cp">#define VMM_SIZE (__IA64_UL_CONST(8)&lt;&lt;20)</span>

<span class="cm">/*</span>
<span class="cm"> * Define vm_buffer, used by PAL Services, base address.</span>
<span class="cm"> * Note: vm_buffer is in the VMM-BLOCK, the size must be &lt; 8M</span>
<span class="cm"> */</span>
<span class="cp">#define KVM_VM_BUFFER_BASE (KVM_VMM_BASE + VMM_SIZE)</span>
<span class="cp">#define KVM_VM_BUFFER_SIZE (__IA64_UL_CONST(8)&lt;&lt;20)</span>

<span class="cm">/*</span>
<span class="cm"> * kvm guest&#39;s data area looks as follow:</span>
<span class="cm"> *</span>
<span class="cm"> *            +----------------------+	-------	KVM_VM_DATA_SIZE</span>
<span class="cm"> *	      |	    vcpu[n]&#39;s data   |	 |     ___________________KVM_STK_OFFSET</span>
<span class="cm"> *     	      |			     |	 |    /			  |</span>
<span class="cm"> *     	      |	       ..........    |	 |   /vcpu&#39;s struct&amp;stack |</span>
<span class="cm"> *     	      |	       ..........    |	 |  /---------------------|---- 0</span>
<span class="cm"> *	      |	    vcpu[5]&#39;s data   |	 | /	   vpd		  |</span>
<span class="cm"> *	      |	    vcpu[4]&#39;s data   |	 |/-----------------------|</span>
<span class="cm"> *	      |	    vcpu[3]&#39;s data   |	 /	   vtlb		  |</span>
<span class="cm"> *	      |	    vcpu[2]&#39;s data   |	/|------------------------|</span>
<span class="cm"> *	      |	    vcpu[1]&#39;s data   |/  |	   vhpt		  |</span>
<span class="cm"> *	      |	    vcpu[0]&#39;s data   |____________________________|</span>
<span class="cm"> *            +----------------------+	 |</span>
<span class="cm"> *	      |	   memory dirty log  |	 |</span>
<span class="cm"> *            +----------------------+	 |</span>
<span class="cm"> *	      |	   vm&#39;s data struct  |	 |</span>
<span class="cm"> *            +----------------------+	 |</span>
<span class="cm"> *	      |			     |	 |</span>
<span class="cm"> *	      |			     |	 |</span>
<span class="cm"> *	      |			     |	 |</span>
<span class="cm"> *	      |			     |	 |</span>
<span class="cm"> *	      |			     |	 |</span>
<span class="cm"> *	      |			     |	 |</span>
<span class="cm"> *	      |			     |	 |</span>
<span class="cm"> *	      |	  vm&#39;s p2m table  |	 |</span>
<span class="cm"> *	      |			     |	 |</span>
<span class="cm"> *            |			     |	 |</span>
<span class="cm"> *	      |			     |	 |  |</span>
<span class="cm"> * vm&#39;s data-&gt;|			     |   |  |</span>
<span class="cm"> *	      +----------------------+ ------- 0</span>
<span class="cm"> * To support large memory, needs to increase the size of p2m.</span>
<span class="cm"> * To support more vcpus, needs to ensure it has enough space to</span>
<span class="cm"> * hold vcpus&#39; data.</span>
<span class="cm"> */</span>

<span class="cp">#define KVM_VM_DATA_SHIFT	26</span>
<span class="cp">#define KVM_VM_DATA_SIZE	(__IA64_UL_CONST(1) &lt;&lt; KVM_VM_DATA_SHIFT)</span>
<span class="cp">#define KVM_VM_DATA_BASE	(KVM_VMM_BASE + KVM_VM_DATA_SIZE)</span>

<span class="cp">#define KVM_P2M_BASE		KVM_VM_DATA_BASE</span>
<span class="cp">#define KVM_P2M_SIZE		(__IA64_UL_CONST(24) &lt;&lt; 20)</span>

<span class="cp">#define VHPT_SHIFT		16</span>
<span class="cp">#define VHPT_SIZE		(__IA64_UL_CONST(1) &lt;&lt; VHPT_SHIFT)</span>
<span class="cp">#define VHPT_NUM_ENTRIES	(__IA64_UL_CONST(1) &lt;&lt; (VHPT_SHIFT-5))</span>

<span class="cp">#define VTLB_SHIFT		16</span>
<span class="cp">#define VTLB_SIZE		(__IA64_UL_CONST(1) &lt;&lt; VTLB_SHIFT)</span>
<span class="cp">#define VTLB_NUM_ENTRIES	(1UL &lt;&lt; (VHPT_SHIFT-5))</span>

<span class="cp">#define VPD_SHIFT		16</span>
<span class="cp">#define VPD_SIZE		(__IA64_UL_CONST(1) &lt;&lt; VPD_SHIFT)</span>

<span class="cp">#define VCPU_STRUCT_SHIFT	16</span>
<span class="cp">#define VCPU_STRUCT_SIZE	(__IA64_UL_CONST(1) &lt;&lt; VCPU_STRUCT_SHIFT)</span>

<span class="cm">/*</span>
<span class="cm"> * This must match KVM_IA64_VCPU_STACK_{SHIFT,SIZE} arch/ia64/include/asm/kvm.h</span>
<span class="cm"> */</span>
<span class="cp">#define KVM_STK_SHIFT		16</span>
<span class="cp">#define KVM_STK_OFFSET		(__IA64_UL_CONST(1)&lt;&lt; KVM_STK_SHIFT)</span>

<span class="cp">#define KVM_VM_STRUCT_SHIFT	19</span>
<span class="cp">#define KVM_VM_STRUCT_SIZE	(__IA64_UL_CONST(1) &lt;&lt; KVM_VM_STRUCT_SHIFT)</span>

<span class="cp">#define KVM_MEM_DIRY_LOG_SHIFT	19</span>
<span class="cp">#define KVM_MEM_DIRTY_LOG_SIZE (__IA64_UL_CONST(1) &lt;&lt; KVM_MEM_DIRY_LOG_SHIFT)</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cm">/*Define the max vcpus and memory for Guests.*/</span>
<span class="cp">#define KVM_MAX_VCPUS	(KVM_VM_DATA_SIZE - KVM_P2M_SIZE - KVM_VM_STRUCT_SIZE -\</span>
<span class="cp">			KVM_MEM_DIRTY_LOG_SIZE) / sizeof(struct kvm_vcpu_data)</span>
<span class="cp">#define KVM_MAX_MEM_SIZE (KVM_P2M_SIZE &gt;&gt; 3 &lt;&lt; PAGE_SHIFT)</span>

<span class="cp">#define VMM_LOG_LEN 256</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;linux/kvm.h&gt;</span>
<span class="cp">#include &lt;linux/kvm_para.h&gt;</span>
<span class="cp">#include &lt;linux/kvm_types.h&gt;</span>

<span class="cp">#include &lt;asm/pal.h&gt;</span>
<span class="cp">#include &lt;asm/sal.h&gt;</span>
<span class="cp">#include &lt;asm/page.h&gt;</span>

<span class="k">struct</span> <span class="n">kvm_vcpu_data</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">vcpu_vhpt</span><span class="p">[</span><span class="n">VHPT_SIZE</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">vcpu_vtlb</span><span class="p">[</span><span class="n">VTLB_SIZE</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">vcpu_vpd</span><span class="p">[</span><span class="n">VPD_SIZE</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">vcpu_struct</span><span class="p">[</span><span class="n">VCPU_STRUCT_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">kvm_vm_data</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">kvm_p2m</span><span class="p">[</span><span class="n">KVM_P2M_SIZE</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">kvm_vm_struct</span><span class="p">[</span><span class="n">KVM_VM_STRUCT_SIZE</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">kvm_mem_dirty_log</span><span class="p">[</span><span class="n">KVM_MEM_DIRTY_LOG_SIZE</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">kvm_vcpu_data</span> <span class="n">vcpu_data</span><span class="p">[</span><span class="n">KVM_MAX_VCPUS</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define VCPU_BASE(n)	(KVM_VM_DATA_BASE + \</span>
<span class="cp">				offsetof(struct kvm_vm_data, vcpu_data[n]))</span>
<span class="cp">#define KVM_VM_BASE	(KVM_VM_DATA_BASE + \</span>
<span class="cp">				offsetof(struct kvm_vm_data, kvm_vm_struct))</span>
<span class="cp">#define KVM_MEM_DIRTY_LOG_BASE	KVM_VM_DATA_BASE + \</span>
<span class="cp">				offsetof(struct kvm_vm_data, kvm_mem_dirty_log)</span>

<span class="cp">#define VHPT_BASE(n) (VCPU_BASE(n) + offsetof(struct kvm_vcpu_data, vcpu_vhpt))</span>
<span class="cp">#define VTLB_BASE(n) (VCPU_BASE(n) + offsetof(struct kvm_vcpu_data, vcpu_vtlb))</span>
<span class="cp">#define VPD_BASE(n)  (VCPU_BASE(n) + offsetof(struct kvm_vcpu_data, vcpu_vpd))</span>
<span class="cp">#define VCPU_STRUCT_BASE(n)	(VCPU_BASE(n) + \</span>
<span class="cp">				offsetof(struct kvm_vcpu_data, vcpu_struct))</span>

<span class="cm">/*IO section definitions*/</span>
<span class="cp">#define IOREQ_READ      1</span>
<span class="cp">#define IOREQ_WRITE     0</span>

<span class="cp">#define STATE_IOREQ_NONE        0</span>
<span class="cp">#define STATE_IOREQ_READY       1</span>
<span class="cp">#define STATE_IOREQ_INPROCESS   2</span>
<span class="cp">#define STATE_IORESP_READY      3</span>

<span class="cm">/*Guest Physical address layout.*/</span>
<span class="cp">#define GPFN_MEM        (0UL &lt;&lt; 60) </span><span class="cm">/* Guest pfn is normal mem */</span><span class="cp"></span>
<span class="cp">#define GPFN_FRAME_BUFFER   (1UL &lt;&lt; 60) </span><span class="cm">/* VGA framebuffer */</span><span class="cp"></span>
<span class="cp">#define GPFN_LOW_MMIO       (2UL &lt;&lt; 60) </span><span class="cm">/* Low MMIO range */</span><span class="cp"></span>
<span class="cp">#define GPFN_PIB        (3UL &lt;&lt; 60) </span><span class="cm">/* PIB base */</span><span class="cp"></span>
<span class="cp">#define GPFN_IOSAPIC        (4UL &lt;&lt; 60) </span><span class="cm">/* IOSAPIC base */</span><span class="cp"></span>
<span class="cp">#define GPFN_LEGACY_IO      (5UL &lt;&lt; 60) </span><span class="cm">/* Legacy I/O base */</span><span class="cp"></span>
<span class="cp">#define GPFN_GFW        (6UL &lt;&lt; 60) </span><span class="cm">/* Guest Firmware */</span><span class="cp"></span>
<span class="cp">#define GPFN_PHYS_MMIO      (7UL &lt;&lt; 60) </span><span class="cm">/* Directed MMIO Range */</span><span class="cp"></span>

<span class="cp">#define GPFN_IO_MASK        (7UL &lt;&lt; 60) </span><span class="cm">/* Guest pfn is I/O type */</span><span class="cp"></span>
<span class="cp">#define GPFN_INV_MASK       (1UL &lt;&lt; 63) </span><span class="cm">/* Guest pfn is invalid */</span><span class="cp"></span>
<span class="cp">#define INVALID_MFN       (~0UL)</span>
<span class="cp">#define MEM_G   (1UL &lt;&lt; 30)</span>
<span class="cp">#define MEM_M   (1UL &lt;&lt; 20)</span>
<span class="cp">#define MMIO_START       (3 * MEM_G)</span>
<span class="cp">#define MMIO_SIZE        (512 * MEM_M)</span>
<span class="cp">#define VGA_IO_START     0xA0000UL</span>
<span class="cp">#define VGA_IO_SIZE      0x20000</span>
<span class="cp">#define LEGACY_IO_START  (MMIO_START + MMIO_SIZE)</span>
<span class="cp">#define LEGACY_IO_SIZE   (64 * MEM_M)</span>
<span class="cp">#define IO_SAPIC_START   0xfec00000UL</span>
<span class="cp">#define IO_SAPIC_SIZE    0x100000</span>
<span class="cp">#define PIB_START 0xfee00000UL</span>
<span class="cp">#define PIB_SIZE 0x200000</span>
<span class="cp">#define GFW_START        (4 * MEM_G - 16 * MEM_M)</span>
<span class="cp">#define GFW_SIZE         (16 * MEM_M)</span>

<span class="cm">/*Deliver mode, defined for ioapic.c*/</span>
<span class="cp">#define dest_Fixed IOSAPIC_FIXED</span>
<span class="cp">#define dest_LowestPrio IOSAPIC_LOWEST_PRIORITY</span>

<span class="cp">#define NMI_VECTOR      		2</span>
<span class="cp">#define ExtINT_VECTOR       		0</span>
<span class="cp">#define NULL_VECTOR     		(-1)</span>
<span class="cp">#define IA64_SPURIOUS_INT_VECTOR    	0x0f</span>

<span class="cp">#define VCPU_LID(v) (((u64)(v)-&gt;vcpu_id) &lt;&lt; 24)</span>

<span class="cm">/*</span>
<span class="cm"> *Delivery mode</span>
<span class="cm"> */</span>
<span class="cp">#define SAPIC_DELIV_SHIFT      8</span>
<span class="cp">#define SAPIC_FIXED            0x0</span>
<span class="cp">#define SAPIC_LOWEST_PRIORITY  0x1</span>
<span class="cp">#define SAPIC_PMI              0x2</span>
<span class="cp">#define SAPIC_NMI              0x4</span>
<span class="cp">#define SAPIC_INIT             0x5</span>
<span class="cp">#define SAPIC_EXTINT           0x7</span>

<span class="cm">/*</span>
<span class="cm"> * vcpu-&gt;requests bit members for arch</span>
<span class="cm"> */</span>
<span class="cp">#define KVM_REQ_PTC_G		32</span>
<span class="cp">#define KVM_REQ_RESUME		33</span>

<span class="cp">#define KVM_HPAGE_GFN_SHIFT(x)	0</span>
<span class="cp">#define KVM_NR_PAGE_SIZES	1</span>
<span class="cp">#define KVM_PAGES_PER_HPAGE(x)	1</span>

<span class="k">struct</span> <span class="n">kvm</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">kvm_vcpu</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">kvm_mmio_req</span> <span class="p">{</span>
	<span class="kt">uint64_t</span> <span class="n">addr</span><span class="p">;</span>          <span class="cm">/*  physical address		*/</span>
	<span class="kt">uint64_t</span> <span class="n">size</span><span class="p">;</span>          <span class="cm">/*  size in bytes		*/</span>
	<span class="kt">uint64_t</span> <span class="n">data</span><span class="p">;</span>          <span class="cm">/*  data (or paddr of data)     */</span>
	<span class="kt">uint8_t</span> <span class="n">state</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
	<span class="kt">uint8_t</span> <span class="n">dir</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>          <span class="cm">/*  1=read, 0=write             */</span>
<span class="p">};</span>

<span class="cm">/*Pal data struct */</span>
<span class="k">struct</span> <span class="n">kvm_pal_call</span><span class="p">{</span>
	<span class="cm">/*In area*/</span>
	<span class="kt">uint64_t</span> <span class="n">gr28</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">gr29</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">gr30</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">gr31</span><span class="p">;</span>
	<span class="cm">/*Out area*/</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Sal data structure */</span>
<span class="k">struct</span> <span class="n">kvm_sal_call</span><span class="p">{</span>
	<span class="cm">/*In area*/</span>
	<span class="kt">uint64_t</span> <span class="n">in0</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">in1</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">in2</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">in3</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">in4</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">in5</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">in6</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">in7</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">sal_ret_values</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*Guest change rr6*/</span>
<span class="k">struct</span> <span class="n">kvm_switch_rr6</span> <span class="p">{</span>
	<span class="kt">uint64_t</span> <span class="n">old_rr</span><span class="p">;</span>
	<span class="kt">uint64_t</span> <span class="n">new_rr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">ia64_ipi_a</span><span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rv</span>  <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ir</span>  <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">eid</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">id</span>  <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ib_base</span> <span class="o">:</span> <span class="mi">44</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">ia64_ipi_d</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vector</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dm</span>  <span class="o">:</span> <span class="mi">3</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ig</span>  <span class="o">:</span> <span class="mi">53</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="cm">/*ipi check exit data*/</span>
<span class="k">struct</span> <span class="n">kvm_ipi_data</span><span class="p">{</span>
	<span class="k">union</span> <span class="n">ia64_ipi_a</span> <span class="n">addr</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">ia64_ipi_d</span> <span class="n">data</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*global purge data*/</span>
<span class="k">struct</span> <span class="n">kvm_ptc_g</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ps</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kvm_vcpu</span> <span class="o">*</span><span class="n">vcpu</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*Exit control data */</span>
<span class="k">struct</span> <span class="n">exit_ctl_data</span><span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">exit_reason</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">vm_status</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">kvm_mmio_req</span>	<span class="n">ioreq</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">kvm_pal_call</span>	<span class="n">pal_data</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">kvm_sal_call</span>	<span class="n">sal_data</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">kvm_switch_rr6</span>	<span class="n">rr_data</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">kvm_ipi_data</span>	<span class="n">ipi_data</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">kvm_ptc_g</span>	<span class="n">ptc_g_data</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">u</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">pte_flags</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">p</span>    <span class="o">:</span>  <span class="mi">1</span><span class="p">;</span> <span class="cm">/*0      */</span>
		<span class="kt">unsigned</span> <span class="kt">long</span>      <span class="o">:</span>  <span class="mi">1</span><span class="p">;</span> <span class="cm">/* 1     */</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ma</span>   <span class="o">:</span>  <span class="mi">3</span><span class="p">;</span> <span class="cm">/* 2-4   */</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">a</span>    <span class="o">:</span>  <span class="mi">1</span><span class="p">;</span> <span class="cm">/* 5     */</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">d</span>    <span class="o">:</span>  <span class="mi">1</span><span class="p">;</span> <span class="cm">/* 6     */</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pl</span>   <span class="o">:</span>  <span class="mi">2</span><span class="p">;</span> <span class="cm">/* 7-8   */</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar</span>   <span class="o">:</span>  <span class="mi">3</span><span class="p">;</span> <span class="cm">/* 9-11  */</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ppn</span>  <span class="o">:</span> <span class="mi">38</span><span class="p">;</span> <span class="cm">/* 12-49 */</span>
		<span class="kt">unsigned</span> <span class="kt">long</span>      <span class="o">:</span>  <span class="mi">2</span><span class="p">;</span> <span class="cm">/* 50-51 */</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ed</span>   <span class="o">:</span>  <span class="mi">1</span><span class="p">;</span> <span class="cm">/* 52    */</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">ia64_pta</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ve</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reserved0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span> <span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vf</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">reserved1</span> <span class="o">:</span> <span class="mi">6</span><span class="p">;</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">base</span> <span class="o">:</span> <span class="mi">49</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">thash_cb</span> <span class="p">{</span>
	<span class="cm">/* THASH base information */</span>
	<span class="k">struct</span> <span class="n">thash_data</span>	<span class="o">*</span><span class="n">hash</span><span class="p">;</span> <span class="cm">/* hash table pointer */</span>
	<span class="k">union</span> <span class="n">ia64_pta</span>		<span class="n">pta</span><span class="p">;</span>
	<span class="kt">int</span>           <span class="n">num</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">kvm_vcpu_stat</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">halt_wakeup</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">kvm_vcpu_arch</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">launched</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">last_exit</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">last_run_cpu</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">vmm_tr_slot</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">vm_tr_slot</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sn_rtc_tr_slot</span><span class="p">;</span>

<span class="cp">#define KVM_MP_STATE_RUNNABLE          0</span>
<span class="cp">#define KVM_MP_STATE_UNINITIALIZED     1</span>
<span class="cp">#define KVM_MP_STATE_INIT_RECEIVED     2</span>
<span class="cp">#define KVM_MP_STATE_HALTED            3</span>
	<span class="kt">int</span> <span class="n">mp_state</span><span class="p">;</span>

<span class="cp">#define MAX_PTC_G_NUM			3</span>
	<span class="kt">int</span> <span class="n">ptc_g_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kvm_ptc_g</span> <span class="n">ptc_g_data</span><span class="p">[</span><span class="n">MAX_PTC_G_NUM</span><span class="p">];</span>

	<span class="cm">/*halt timer to wake up sleepy vcpus*/</span>
	<span class="k">struct</span> <span class="n">hrtimer</span> <span class="n">hlt_timer</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">ht_active</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">kvm_lapic</span> <span class="o">*</span><span class="n">apic</span><span class="p">;</span>    <span class="cm">/* kernel irqchip context */</span>
	<span class="k">struct</span> <span class="n">vpd</span> <span class="o">*</span><span class="n">vpd</span><span class="p">;</span>

	<span class="cm">/* Exit data for vmm_transition*/</span>
	<span class="k">struct</span> <span class="n">exit_ctl_data</span> <span class="n">exit_data</span><span class="p">;</span>

	<span class="n">cpumask_t</span> <span class="n">cache_coherent_map</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vmm_rr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">host_rr6</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">psbits</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cr_iipa</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cr_isr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vsa_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dirty_log_lock_pa</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__gp</span><span class="p">;</span>
	<span class="cm">/* TR and TC.  */</span>
	<span class="k">struct</span> <span class="n">thash_data</span> <span class="n">itrs</span><span class="p">[</span><span class="n">NITRS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">thash_data</span> <span class="n">dtrs</span><span class="p">[</span><span class="n">NDTRS</span><span class="p">];</span>
	<span class="cm">/* Bit is set if there is a tr/tc for the region.  */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">itr_regions</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">dtr_regions</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">tc_regions</span><span class="p">;</span>
	<span class="cm">/* purge all */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ptce_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ptce_count</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ptce_stride</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="cm">/* itc/itm */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">last_itc</span><span class="p">;</span>
	<span class="kt">long</span> <span class="n">itc_offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">itc_check</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">timer_check</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">timer_pending</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">timer_fired</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vrr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ibr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dbr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">insvc</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* Interrupt in service.  */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">xtp</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">metaphysical_rr0</span><span class="p">;</span> <span class="cm">/* from kvm_arch (so is pinned) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">metaphysical_rr4</span><span class="p">;</span>	<span class="cm">/* from kvm_arch (so is pinned) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">metaphysical_saved_rr0</span><span class="p">;</span> <span class="cm">/* from kvm_arch          */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">metaphysical_saved_rr4</span><span class="p">;</span> <span class="cm">/* from kvm_arch          */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">fp_psr</span><span class="p">;</span>       <span class="cm">/*used for lazy float register */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">saved_gp</span><span class="p">;</span>
	<span class="cm">/*for phycial  emulation */</span>
	<span class="kt">int</span> <span class="n">mode_flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">thash_cb</span> <span class="n">vtlb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">thash_cb</span> <span class="n">vhpt</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">irq_check</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">irq_new_pending</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">opcode</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cause</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">log_buf</span><span class="p">[</span><span class="n">VMM_LOG_LEN</span><span class="p">];</span>
	<span class="k">union</span> <span class="n">context</span> <span class="n">host</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">context</span> <span class="n">guest</span><span class="p">;</span>

	<span class="kt">char</span> <span class="n">mmio_data</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">kvm_vm_stat</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">remote_tlb_flush</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">kvm_sal_data</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">boot_ip</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">boot_gp</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">kvm_arch_memory_slot</span> <span class="p">{</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">kvm_arch</span> <span class="p">{</span>
	<span class="n">spinlock_t</span> <span class="n">dirty_log_lock</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">vm_base</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">metaphysical_rr0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">metaphysical_rr4</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">vmm_init_rr</span><span class="p">;</span>

	<span class="kt">int</span>		<span class="n">is_sn2</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">kvm_ioapic</span> <span class="o">*</span><span class="n">vioapic</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kvm_vm_stat</span> <span class="n">stat</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">kvm_sal_data</span> <span class="n">rdv_sal_data</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">assigned_dev_head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">iommu_domain</span> <span class="o">*</span><span class="n">iommu_domain</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">iommu_flags</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">irq_sources_bitmap</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">irq_states</span><span class="p">[</span><span class="n">KVM_IOAPIC_NUM_PINS</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">union</span> <span class="n">cpuid3_t</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">value</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">number</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span> <span class="n">revision</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span> <span class="n">model</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span> <span class="n">family</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span> <span class="n">archrev</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span> <span class="n">rv</span> <span class="o">:</span> <span class="mi">24</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">kvm_pt_regs</span> <span class="p">{</span>
	<span class="cm">/* The following registers are saved by SAVE_MIN: */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">b6</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">b7</span><span class="p">;</span>  <span class="cm">/* scratch */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar_csd</span><span class="p">;</span> <span class="cm">/* used by cmp8xchg16 (scratch) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar_ssd</span><span class="p">;</span> <span class="cm">/* reserved for future use (scratch) */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r8</span><span class="p">;</span>  <span class="cm">/* scratch (return value register 0) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r9</span><span class="p">;</span>  <span class="cm">/* scratch (return value register 1) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r10</span><span class="p">;</span> <span class="cm">/* scratch (return value register 2) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r11</span><span class="p">;</span> <span class="cm">/* scratch (return value register 3) */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cr_ipsr</span><span class="p">;</span> <span class="cm">/* interrupted task&#39;s psr */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cr_iip</span><span class="p">;</span>  <span class="cm">/* interrupted task&#39;s instruction pointer */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">cr_ifs</span><span class="p">;</span>  <span class="cm">/* interrupted task&#39;s function state */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar_unat</span><span class="p">;</span> <span class="cm">/* interrupted task&#39;s NaT register (preserved) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar_pfs</span><span class="p">;</span>  <span class="cm">/* prev function state  */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar_rsc</span><span class="p">;</span>  <span class="cm">/* RSE configuration */</span>
	<span class="cm">/* The following two are valid only if cr_ipsr.cpl &gt; 0: */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar_rnat</span><span class="p">;</span>  <span class="cm">/* RSE NaT */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar_bspstore</span><span class="p">;</span> <span class="cm">/* RSE bspstore */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pr</span><span class="p">;</span>  <span class="cm">/* 64 predicate registers (1 bit each) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">b0</span><span class="p">;</span>  <span class="cm">/* return pointer (bp) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">loadrs</span><span class="p">;</span>  <span class="cm">/* size of dirty partition &lt;&lt; 16 */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r1</span><span class="p">;</span>  <span class="cm">/* the gp pointer */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r12</span><span class="p">;</span> <span class="cm">/* interrupted task&#39;s memory stack pointer */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r13</span><span class="p">;</span> <span class="cm">/* thread pointer */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar_fpsr</span><span class="p">;</span>  <span class="cm">/* floating point status (preserved) */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r15</span><span class="p">;</span>  <span class="cm">/* scratch */</span>

	<span class="cm">/* The remaining registers are NOT saved for system calls.  */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r14</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r2</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r3</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r16</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r17</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r18</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r19</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r20</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r21</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r22</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r23</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r24</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r25</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r26</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r27</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r28</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r29</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r30</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r31</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ar_ccv</span><span class="p">;</span>  <span class="cm">/* compare/exchange value (scratch) */</span>

	<span class="cm">/*</span>
<span class="cm">	 * Floating point registers that the kernel considers scratch:</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">ia64_fpreg</span> <span class="n">f6</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="k">struct</span> <span class="n">ia64_fpreg</span> <span class="n">f7</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="k">struct</span> <span class="n">ia64_fpreg</span> <span class="n">f8</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="k">struct</span> <span class="n">ia64_fpreg</span> <span class="n">f9</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="k">struct</span> <span class="n">ia64_fpreg</span> <span class="n">f10</span><span class="p">;</span>  <span class="cm">/* scratch */</span>
	<span class="k">struct</span> <span class="n">ia64_fpreg</span> <span class="n">f11</span><span class="p">;</span>  <span class="cm">/* scratch */</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r4</span><span class="p">;</span>  <span class="cm">/* preserved */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r5</span><span class="p">;</span>  <span class="cm">/* preserved */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r6</span><span class="p">;</span>  <span class="cm">/* preserved */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">r7</span><span class="p">;</span>  <span class="cm">/* preserved */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">eml_unat</span><span class="p">;</span>    <span class="cm">/* used for emulating instruction */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pad0</span><span class="p">;</span>     <span class="cm">/* alignment pad */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">kvm_pt_regs</span> <span class="o">*</span><span class="nf">vcpu_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">kvm_vcpu</span> <span class="o">*</span><span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="k">struct</span> <span class="n">kvm_pt_regs</span> <span class="o">*</span><span class="p">)</span> <span class="p">((</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">v</span> <span class="o">+</span> <span class="n">KVM_STK_OFFSET</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="kt">int</span> <span class="n">kvm_vmm_entry</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="n">kvm_tramp_entry</span><span class="p">(</span><span class="k">union</span> <span class="n">context</span> <span class="o">*</span><span class="n">host</span><span class="p">,</span> <span class="k">union</span> <span class="n">context</span> <span class="o">*</span><span class="n">guest</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">kvm_vmm_info</span><span class="p">{</span>
	<span class="k">struct</span> <span class="n">module</span>	<span class="o">*</span><span class="n">module</span><span class="p">;</span>
	<span class="n">kvm_vmm_entry</span> 	<span class="o">*</span><span class="n">vmm_entry</span><span class="p">;</span>
	<span class="n">kvm_tramp_entry</span> <span class="o">*</span><span class="n">tramp_entry</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> 	<span class="n">vmm_ivt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">patch_mov_ar</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">patch_mov_ar_sn2</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">kvm_highest_pending_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">kvm_vcpu</span> <span class="o">*</span><span class="n">vcpu</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">kvm_emulate_halt</span><span class="p">(</span><span class="k">struct</span> <span class="n">kvm_vcpu</span> <span class="o">*</span><span class="n">vcpu</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">kvm_pal_emul</span><span class="p">(</span><span class="k">struct</span> <span class="n">kvm_vcpu</span> <span class="o">*</span><span class="n">vcpu</span><span class="p">,</span> <span class="k">struct</span> <span class="n">kvm_run</span> <span class="o">*</span><span class="n">kvm_run</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">kvm_sal_emul</span><span class="p">(</span><span class="k">struct</span> <span class="n">kvm_vcpu</span> <span class="o">*</span><span class="n">vcpu</span><span class="p">);</span>

<span class="cp">#define __KVM_HAVE_ARCH_VM_ALLOC 1</span>
<span class="k">struct</span> <span class="n">kvm</span> <span class="o">*</span><span class="n">kvm_arch_alloc_vm</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">kvm_arch_free_vm</span><span class="p">(</span><span class="k">struct</span> <span class="n">kvm</span> <span class="o">*</span><span class="n">kvm</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__*/</span><span class="cp"></span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
