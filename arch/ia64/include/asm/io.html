<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › include › asm › io.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>io.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_IA64_IO_H</span>
<span class="cp">#define _ASM_IA64_IO_H</span>

<span class="cm">/*</span>
<span class="cm"> * This file contains the definitions for the emulated IO instructions</span>
<span class="cm"> * inb/inw/inl/outb/outw/outl and the &quot;string versions&quot; of the same</span>
<span class="cm"> * (insb/insw/insl/outsb/outsw/outsl). You can also use &quot;pausing&quot;</span>
<span class="cm"> * versions of the single-IO instructions (inb_p/inw_p/..).</span>
<span class="cm"> *</span>
<span class="cm"> * This file is not meant to be obfuscating: it&#39;s just complicated to</span>
<span class="cm"> * (a) handle it all in a way that makes gcc able to optimize it as</span>
<span class="cm"> * well as possible and (b) trying to avoid writing the same thing</span>
<span class="cm"> * over and over again with slight variations and possibly making a</span>
<span class="cm"> * mistake somewhere.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1998-2003 Hewlett-Packard Co</span>
<span class="cm"> *	David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;</span>
<span class="cm"> * Copyright (C) 1999 Asit Mallick &lt;asit.k.mallick@intel.com&gt;</span>
<span class="cm"> * Copyright (C) 1999 Don Dugger &lt;don.dugger@intel.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;asm/unaligned.h&gt;</span>

<span class="cm">/* We don&#39;t use IO slowdowns on the ia64, but.. */</span>
<span class="cp">#define __SLOW_DOWN_IO	do { } while (0)</span>
<span class="cp">#define SLOW_DOWN_IO	do { } while (0)</span>

<span class="cp">#define __IA64_UNCACHED_OFFSET	RGN_BASE(RGN_UNCACHED)</span>

<span class="cm">/*</span>
<span class="cm"> * The legacy I/O space defined by the ia64 architecture supports only 65536 ports, but</span>
<span class="cm"> * large machines may have multiple other I/O spaces so we can&#39;t place any a priori limit</span>
<span class="cm"> * on IO_SPACE_LIMIT.  These additional spaces are described in ACPI.</span>
<span class="cm"> */</span>
<span class="cp">#define IO_SPACE_LIMIT		0xffffffffffffffffUL</span>

<span class="cp">#define MAX_IO_SPACES_BITS		8</span>
<span class="cp">#define MAX_IO_SPACES			(1UL &lt;&lt; MAX_IO_SPACES_BITS)</span>
<span class="cp">#define IO_SPACE_BITS			24</span>
<span class="cp">#define IO_SPACE_SIZE			(1UL &lt;&lt; IO_SPACE_BITS)</span>

<span class="cp">#define IO_SPACE_NR(port)		((port) &gt;&gt; IO_SPACE_BITS)</span>
<span class="cp">#define IO_SPACE_BASE(space)		((space) &lt;&lt; IO_SPACE_BITS)</span>
<span class="cp">#define IO_SPACE_PORT(port)		((port) &amp; (IO_SPACE_SIZE - 1))</span>

<span class="cp">#define IO_SPACE_SPARSE_ENCODING(p)	((((p) &gt;&gt; 2) &lt;&lt; 12) | ((p) &amp; 0xfff))</span>

<span class="k">struct</span> <span class="n">io_space</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mmio_base</span><span class="p">;</span>	<span class="cm">/* base in MMIO space */</span>
	<span class="kt">int</span> <span class="n">sparse</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">io_space</span> <span class="n">io_space</span><span class="p">[];</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">num_io_spaces</span><span class="p">;</span>

<span class="cp"># ifdef __KERNEL__</span>

<span class="cm">/*</span>
<span class="cm"> * All MMIO iomem cookies are in region 6; anything less is a PIO cookie:</span>
<span class="cm"> *	0xCxxxxxxxxxxxxxxx	MMIO cookie (return from ioremap)</span>
<span class="cm"> *	0x000000001SPPPPPP	PIO cookie (S=space number, P..P=port)</span>
<span class="cm"> *</span>
<span class="cm"> * ioread/writeX() uses the leading 1 in PIO cookies (PIO_OFFSET) to catch</span>
<span class="cm"> * code that uses bare port numbers without the prerequisite pci_iomap().</span>
<span class="cm"> */</span>
<span class="cp">#define PIO_OFFSET		(1UL &lt;&lt; (MAX_IO_SPACES_BITS + IO_SPACE_BITS))</span>
<span class="cp">#define PIO_MASK		(PIO_OFFSET - 1)</span>
<span class="cp">#define PIO_RESERVED		__IA64_UNCACHED_OFFSET</span>
<span class="cp">#define HAVE_ARCH_PIO_SIZE</span>

<span class="cp">#include &lt;asm/intrinsics.h&gt;</span>
<span class="cp">#include &lt;asm/machvec.h&gt;</span>
<span class="cp">#include &lt;asm/page.h&gt;</span>
<span class="cp">#include &lt;asm-generic/iomap.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Change virtual addresses to physical addresses and vv.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span>
<span class="nf">virt_to_phys</span> <span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="o">*</span><span class="n">address</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">address</span> <span class="o">-</span> <span class="n">PAGE_OFFSET</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span><span class="o">*</span>
<span class="nf">phys_to_virt</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">address</span> <span class="o">+</span> <span class="n">PAGE_OFFSET</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define ARCH_HAS_VALID_PHYS_ADDR_RANGE</span>
<span class="k">extern</span> <span class="n">u64</span> <span class="n">kern_mem_attribute</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">valid_phys_addr_range</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">);</span> <span class="cm">/* efi.c */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">valid_mmap_phys_addr_range</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pfn</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * The following two macros are deprecated and scheduled for removal.</span>
<span class="cm"> * Please use the PCI-DMA interface defined in &lt;asm/pci.h&gt; instead.</span>
<span class="cm"> */</span>
<span class="cp">#define bus_to_virt	phys_to_virt</span>
<span class="cp">#define virt_to_bus	virt_to_phys</span>
<span class="cp">#define page_to_bus	page_to_phys</span>

<span class="cp"># endif </span><span class="cm">/* KERNEL */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Memory fence w/accept.  This should never be used in code that is</span>
<span class="cm"> * not IA-64 specific.</span>
<span class="cm"> */</span>
<span class="cp">#define __ia64_mf_a()	ia64_mfa()</span>

<span class="cm">/**</span>
<span class="cm"> * ___ia64_mmiowb - I/O write barrier</span>
<span class="cm"> *</span>
<span class="cm"> * Ensure ordering of I/O space writes.  This will make sure that writes</span>
<span class="cm"> * following the barrier will arrive after all previous writes.  For most</span>
<span class="cm"> * ia64 platforms, this is a simple &#39;mf.a&#39; instruction.</span>
<span class="cm"> *</span>
<span class="cm"> * See Documentation/DocBook/deviceiobook.tmpl for more information.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">___ia64_mmiowb</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ia64_mfa</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span><span class="o">*</span>
<span class="nf">__ia64_mk_io_addr</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">io_space</span> <span class="o">*</span><span class="n">space</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">;</span>

	<span class="n">space</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">io_space</span><span class="p">[</span><span class="n">IO_SPACE_NR</span><span class="p">(</span><span class="n">port</span><span class="p">)];</span>
	<span class="n">port</span> <span class="o">=</span> <span class="n">IO_SPACE_PORT</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">space</span><span class="o">-&gt;</span><span class="n">sparse</span><span class="p">)</span>
		<span class="n">offset</span> <span class="o">=</span> <span class="n">IO_SPACE_SPARSE_ENCODING</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">offset</span> <span class="o">=</span> <span class="n">port</span><span class="p">;</span>

	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">space</span><span class="o">-&gt;</span><span class="n">mmio_base</span> <span class="o">|</span> <span class="n">offset</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define __ia64_inb	___ia64_inb</span>
<span class="cp">#define __ia64_inw	___ia64_inw</span>
<span class="cp">#define __ia64_inl	___ia64_inl</span>
<span class="cp">#define __ia64_outb	___ia64_outb</span>
<span class="cp">#define __ia64_outw	___ia64_outw</span>
<span class="cp">#define __ia64_outl	___ia64_outl</span>
<span class="cp">#define __ia64_readb	___ia64_readb</span>
<span class="cp">#define __ia64_readw	___ia64_readw</span>
<span class="cp">#define __ia64_readl	___ia64_readl</span>
<span class="cp">#define __ia64_readq	___ia64_readq</span>
<span class="cp">#define __ia64_readb_relaxed	___ia64_readb</span>
<span class="cp">#define __ia64_readw_relaxed	___ia64_readw</span>
<span class="cp">#define __ia64_readl_relaxed	___ia64_readl</span>
<span class="cp">#define __ia64_readq_relaxed	___ia64_readq</span>
<span class="cp">#define __ia64_writeb	___ia64_writeb</span>
<span class="cp">#define __ia64_writew	___ia64_writew</span>
<span class="cp">#define __ia64_writel	___ia64_writel</span>
<span class="cp">#define __ia64_writeq	___ia64_writeq</span>
<span class="cp">#define __ia64_mmiowb	___ia64_mmiowb</span>

<span class="cm">/*</span>
<span class="cm"> * For the in/out routines, we need to do &quot;mf.a&quot; _after_ doing the I/O access to ensure</span>
<span class="cm"> * that the access has completed before executing other I/O accesses.  Since we&#39;re doing</span>
<span class="cm"> * the accesses through an uncachable (UC) translation, the CPU will execute them in</span>
<span class="cm"> * program order.  However, we still need to tell the compiler not to shuffle them around</span>
<span class="cm"> * during optimization, which is why we use &quot;volatile&quot; pointers.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span>
<span class="nf">___ia64_inb</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">__ia64_mk_io_addr</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="o">*</span><span class="n">addr</span><span class="p">;</span>
	<span class="n">__ia64_mf_a</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span>
<span class="nf">___ia64_inw</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">__ia64_mk_io_addr</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="o">*</span><span class="n">addr</span><span class="p">;</span>
	<span class="n">__ia64_mf_a</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span>
<span class="nf">___ia64_inl</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">__ia64_mk_io_addr</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="o">*</span><span class="n">addr</span><span class="p">;</span>
	<span class="n">__ia64_mf_a</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">___ia64_outb</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">__ia64_mk_io_addr</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>

	<span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">__ia64_mf_a</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">___ia64_outw</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">val</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">__ia64_mk_io_addr</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>

	<span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">__ia64_mf_a</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">___ia64_outl</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">__ia64_mk_io_addr</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>

	<span class="o">*</span><span class="n">addr</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">__ia64_mf_a</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">__insb</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dst</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="o">*</span><span class="n">dp</span><span class="o">++</span> <span class="o">=</span> <span class="n">platform_inb</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">__insw</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dst</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">put_unaligned</span><span class="p">(</span><span class="n">platform_inw</span><span class="p">(</span><span class="n">port</span><span class="p">),</span> <span class="n">dp</span><span class="o">++</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">__insl</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">dp</span> <span class="o">=</span> <span class="n">dst</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">put_unaligned</span><span class="p">(</span><span class="n">platform_inl</span><span class="p">(</span><span class="n">port</span><span class="p">),</span> <span class="n">dp</span><span class="o">++</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">__outsb</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sp</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">platform_outb</span><span class="p">(</span><span class="o">*</span><span class="n">sp</span><span class="o">++</span><span class="p">,</span> <span class="n">port</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">__outsw</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="o">*</span><span class="n">sp</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">platform_outw</span><span class="p">(</span><span class="n">get_unaligned</span><span class="p">(</span><span class="n">sp</span><span class="o">++</span><span class="p">),</span> <span class="n">port</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">__outsl</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">sp</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">count</span><span class="o">--</span><span class="p">)</span>
		<span class="n">platform_outl</span><span class="p">(</span><span class="n">get_unaligned</span><span class="p">(</span><span class="n">sp</span><span class="o">++</span><span class="p">),</span> <span class="n">port</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Unfortunately, some platforms are broken and do not follow the IA-64 architecture</span>
<span class="cm"> * specification regarding legacy I/O support.  Thus, we have to make these operations</span>
<span class="cm"> * platform dependent...</span>
<span class="cm"> */</span>
<span class="cp">#define __inb		platform_inb</span>
<span class="cp">#define __inw		platform_inw</span>
<span class="cp">#define __inl		platform_inl</span>
<span class="cp">#define __outb		platform_outb</span>
<span class="cp">#define __outw		platform_outw</span>
<span class="cp">#define __outl		platform_outl</span>
<span class="cp">#define __mmiowb	platform_mmiowb</span>

<span class="cp">#define inb(p)		__inb(p)</span>
<span class="cp">#define inw(p)		__inw(p)</span>
<span class="cp">#define inl(p)		__inl(p)</span>
<span class="cp">#define insb(p,d,c)	__insb(p,d,c)</span>
<span class="cp">#define insw(p,d,c)	__insw(p,d,c)</span>
<span class="cp">#define insl(p,d,c)	__insl(p,d,c)</span>
<span class="cp">#define outb(v,p)	__outb(v,p)</span>
<span class="cp">#define outw(v,p)	__outw(v,p)</span>
<span class="cp">#define outl(v,p)	__outl(v,p)</span>
<span class="cp">#define outsb(p,s,c)	__outsb(p,s,c)</span>
<span class="cp">#define outsw(p,s,c)	__outsw(p,s,c)</span>
<span class="cp">#define outsl(p,s,c)	__outsl(p,s,c)</span>
<span class="cp">#define mmiowb()	__mmiowb()</span>

<span class="cm">/*</span>
<span class="cm"> * The address passed to these functions are ioremap()ped already.</span>
<span class="cm"> *</span>
<span class="cm"> * We need these to be machine vectors since some platforms don&#39;t provide</span>
<span class="cm"> * DMA coherence via PIO reads (PCI drivers and the spec imply that this is</span>
<span class="cm"> * a good idea).  Writes are ok though for all existing ia64 platforms (and</span>
<span class="cm"> * hopefully it&#39;ll stay that way).</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">char</span>
<span class="nf">___ia64_readb</span> <span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">__force</span> <span class="o">*</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">short</span>
<span class="nf">___ia64_readw</span> <span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">__force</span> <span class="o">*</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span>
<span class="nf">___ia64_readl</span> <span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">__force</span> <span class="o">*</span><span class="p">)</span> <span class="n">addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span>
<span class="nf">___ia64_readq</span> <span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span> <span class="o">*</span><span class="p">)</span> <span class="n">addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">__writeb</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">__force</span> <span class="o">*</span><span class="p">)</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">__writew</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">val</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">__force</span> <span class="o">*</span><span class="p">)</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">__writel</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">__force</span> <span class="o">*</span><span class="p">)</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span>
<span class="nf">__writeq</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__force</span> <span class="o">*</span><span class="p">)</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define __readb		platform_readb</span>
<span class="cp">#define __readw		platform_readw</span>
<span class="cp">#define __readl		platform_readl</span>
<span class="cp">#define __readq		platform_readq</span>
<span class="cp">#define __readb_relaxed	platform_readb_relaxed</span>
<span class="cp">#define __readw_relaxed	platform_readw_relaxed</span>
<span class="cp">#define __readl_relaxed	platform_readl_relaxed</span>
<span class="cp">#define __readq_relaxed	platform_readq_relaxed</span>

<span class="cp">#define readb(a)	__readb((a))</span>
<span class="cp">#define readw(a)	__readw((a))</span>
<span class="cp">#define readl(a)	__readl((a))</span>
<span class="cp">#define readq(a)	__readq((a))</span>
<span class="cp">#define readb_relaxed(a)	__readb_relaxed((a))</span>
<span class="cp">#define readw_relaxed(a)	__readw_relaxed((a))</span>
<span class="cp">#define readl_relaxed(a)	__readl_relaxed((a))</span>
<span class="cp">#define readq_relaxed(a)	__readq_relaxed((a))</span>
<span class="cp">#define __raw_readb	readb</span>
<span class="cp">#define __raw_readw	readw</span>
<span class="cp">#define __raw_readl	readl</span>
<span class="cp">#define __raw_readq	readq</span>
<span class="cp">#define __raw_readb_relaxed	readb_relaxed</span>
<span class="cp">#define __raw_readw_relaxed	readw_relaxed</span>
<span class="cp">#define __raw_readl_relaxed	readl_relaxed</span>
<span class="cp">#define __raw_readq_relaxed	readq_relaxed</span>
<span class="cp">#define writeb(v,a)	__writeb((v), (a))</span>
<span class="cp">#define writew(v,a)	__writew((v), (a))</span>
<span class="cp">#define writel(v,a)	__writel((v), (a))</span>
<span class="cp">#define writeq(v,a)	__writeq((v), (a))</span>
<span class="cp">#define __raw_writeb	writeb</span>
<span class="cp">#define __raw_writew	writew</span>
<span class="cp">#define __raw_writel	writel</span>
<span class="cp">#define __raw_writeq	writeq</span>

<span class="cp">#ifndef inb_p</span>
<span class="cp"># define inb_p		inb</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef inw_p</span>
<span class="cp"># define inw_p		inw</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef inl_p</span>
<span class="cp"># define inl_p		inl</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef outb_p</span>
<span class="cp"># define outb_p		outb</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef outw_p</span>
<span class="cp"># define outw_p		outw</span>
<span class="cp">#endif</span>
<span class="cp">#ifndef outl_p</span>
<span class="cp"># define outl_p		outl</span>
<span class="cp">#endif</span>

<span class="cp"># ifdef __KERNEL__</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">ioremap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">ioremap_nocache</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">iounmap</span> <span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="n">early_ioremap</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">early_iounmap</span> <span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="nf">ioremap_cache</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys_addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ioremap</span><span class="p">(</span><span class="n">phys_addr</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * String version of IO memory access ops:</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">memcpy_fromio</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">long</span> <span class="n">n</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">memcpy_toio</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">long</span> <span class="n">n</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">memset_io</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="kt">long</span> <span class="n">n</span><span class="p">);</span>

<span class="cp"># endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _ASM_IA64_IO_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
