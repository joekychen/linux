<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › include › asm › intrinsics.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>intrinsics.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_IA64_INTRINSICS_H</span>
<span class="cp">#define _ASM_IA64_INTRINSICS_H</span>

<span class="cm">/*</span>
<span class="cm"> * Compiler-dependent intrinsics.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2002-2003 Hewlett-Packard Co</span>
<span class="cm"> *	David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cm">/* include compiler specific intrinsics */</span>
<span class="cp">#include &lt;asm/ia64regs.h&gt;</span>
<span class="cp">#ifdef __INTEL_COMPILER</span>
<span class="cp"># include &lt;asm/intel_intrin.h&gt;</span>
<span class="cp">#else</span>
<span class="cp"># include &lt;asm/gcc_intrin.h&gt;</span>
<span class="cp">#endif</span>
<span class="cp">#include &lt;asm/cmpxchg.h&gt;</span>

<span class="cp">#define ia64_native_get_psr_i()	(ia64_native_getreg(_IA64_REG_PSR) &amp; IA64_PSR_I)</span>

<span class="cp">#define ia64_native_set_rr0_to_rr4(val0, val1, val2, val3, val4)	\</span>
<span class="cp">do {									\</span>
<span class="cp">	ia64_native_set_rr(0x0000000000000000UL, (val0));		\</span>
<span class="cp">	ia64_native_set_rr(0x2000000000000000UL, (val1));		\</span>
<span class="cp">	ia64_native_set_rr(0x4000000000000000UL, (val2));		\</span>
<span class="cp">	ia64_native_set_rr(0x6000000000000000UL, (val3));		\</span>
<span class="cp">	ia64_native_set_rr(0x8000000000000000UL, (val4));		\</span>
<span class="cp">} while (0)</span>

<span class="cm">/*</span>
<span class="cm"> * Force an unresolved reference if someone tries to use</span>
<span class="cm"> * ia64_fetch_and_add() with a bad value.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__bad_size_for_ia64_fetch_and_add</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__bad_increment_for_ia64_fetch_and_add</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#define IA64_FETCHADD(tmp,v,n,sz,sem)						\</span>
<span class="cp">({										\</span>
<span class="cp">	switch (sz) {								\</span>
<span class="cp">	      case 4:								\</span>
<span class="cp">	        tmp = ia64_fetchadd4_##sem((unsigned int *) v, n);		\</span>
<span class="cp">		break;								\</span>
<span class="cp">										\</span>
<span class="cp">	      case 8:								\</span>
<span class="cp">	        tmp = ia64_fetchadd8_##sem((unsigned long *) v, n);		\</span>
<span class="cp">		break;								\</span>
<span class="cp">										\</span>
<span class="cp">	      default:								\</span>
<span class="cp">		__bad_size_for_ia64_fetch_and_add();				\</span>
<span class="cp">	}									\</span>
<span class="cp">})</span>

<span class="cp">#define ia64_fetchadd(i,v,sem)								\</span>
<span class="cp">({											\</span>
<span class="cp">	__u64 _tmp;									\</span>
<span class="cp">	volatile __typeof__(*(v)) *_v = (v);						\</span>
<span class="cp">	</span><span class="cm">/* Can&#39;t use a switch () here: gcc isn&#39;t always smart enough for that... */</span><span class="cp">	\</span>
<span class="cp">	if ((i) == -16)									\</span>
<span class="cp">		IA64_FETCHADD(_tmp, _v, -16, sizeof(*(v)), sem);			\</span>
<span class="cp">	else if ((i) == -8)								\</span>
<span class="cp">		IA64_FETCHADD(_tmp, _v, -8, sizeof(*(v)), sem);				\</span>
<span class="cp">	else if ((i) == -4)								\</span>
<span class="cp">		IA64_FETCHADD(_tmp, _v, -4, sizeof(*(v)), sem);				\</span>
<span class="cp">	else if ((i) == -1)								\</span>
<span class="cp">		IA64_FETCHADD(_tmp, _v, -1, sizeof(*(v)), sem);				\</span>
<span class="cp">	else if ((i) == 1)								\</span>
<span class="cp">		IA64_FETCHADD(_tmp, _v, 1, sizeof(*(v)), sem);				\</span>
<span class="cp">	else if ((i) == 4)								\</span>
<span class="cp">		IA64_FETCHADD(_tmp, _v, 4, sizeof(*(v)), sem);				\</span>
<span class="cp">	else if ((i) == 8)								\</span>
<span class="cp">		IA64_FETCHADD(_tmp, _v, 8, sizeof(*(v)), sem);				\</span>
<span class="cp">	else if ((i) == 16)								\</span>
<span class="cp">		IA64_FETCHADD(_tmp, _v, 16, sizeof(*(v)), sem);				\</span>
<span class="cp">	else										\</span>
<span class="cp">		_tmp = __bad_increment_for_ia64_fetch_and_add();			\</span>
<span class="cp">	(__typeof__(*(v))) (_tmp);	</span><span class="cm">/* return old value */</span><span class="cp">				\</span>
<span class="cp">})</span>

<span class="cp">#define ia64_fetch_and_add(i,v)	(ia64_fetchadd(i, v, rel) + (i)) </span><span class="cm">/* return new value */</span><span class="cp"></span>

<span class="cp">#endif</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#include &lt;asm/paravirt_privop.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cp">#define IA64_INTRINSIC_API(name)	ia64_native_ ## name</span>
<span class="cp">#define IA64_INTRINSIC_MACRO(name)	ia64_native_ ## name</span>

<span class="cp">#if defined(__KERNEL__)</span>
<span class="cp">#if defined(CONFIG_PARAVIRT)</span>
<span class="cp"># undef IA64_INTRINSIC_API</span>
<span class="cp"># undef IA64_INTRINSIC_MACRO</span>
<span class="cp"># ifdef ASM_SUPPORTED</span>
<span class="cp">#  define IA64_INTRINSIC_API(name)	paravirt_ ## name</span>
<span class="cp"># else</span>
<span class="cp">#  define IA64_INTRINSIC_API(name)	pv_cpu_ops.name</span>
<span class="cp"># endif</span>
<span class="cp">#define IA64_INTRINSIC_MACRO(name)	paravirt_ ## name</span>
<span class="cp">#endif</span>
<span class="cp">#endif</span>

<span class="cm">/************************************************/</span>
<span class="cm">/* Instructions paravirtualized for correctness */</span>
<span class="cm">/************************************************/</span>
<span class="cm">/* fc, thash, get_cpuid, get_pmd, get_eflags, set_eflags */</span>
<span class="cm">/* Note that &quot;ttag&quot; and &quot;cover&quot; are also privilege-sensitive; &quot;ttag&quot;</span>
<span class="cm"> * is not currently used (though it may be in a long-format VHPT system!)</span>
<span class="cm"> */</span>
<span class="cp">#define ia64_fc				IA64_INTRINSIC_API(fc)</span>
<span class="cp">#define ia64_thash			IA64_INTRINSIC_API(thash)</span>
<span class="cp">#define ia64_get_cpuid			IA64_INTRINSIC_API(get_cpuid)</span>
<span class="cp">#define ia64_get_pmd			IA64_INTRINSIC_API(get_pmd)</span>


<span class="cm">/************************************************/</span>
<span class="cm">/* Instructions paravirtualized for performance */</span>
<span class="cm">/************************************************/</span>
<span class="cp">#define ia64_ssm			IA64_INTRINSIC_MACRO(ssm)</span>
<span class="cp">#define ia64_rsm			IA64_INTRINSIC_MACRO(rsm)</span>
<span class="cp">#define ia64_getreg			IA64_INTRINSIC_MACRO(getreg)</span>
<span class="cp">#define ia64_setreg			IA64_INTRINSIC_API(setreg)</span>
<span class="cp">#define ia64_set_rr			IA64_INTRINSIC_API(set_rr)</span>
<span class="cp">#define ia64_get_rr			IA64_INTRINSIC_API(get_rr)</span>
<span class="cp">#define ia64_ptcga			IA64_INTRINSIC_API(ptcga)</span>
<span class="cp">#define ia64_get_psr_i			IA64_INTRINSIC_API(get_psr_i)</span>
<span class="cp">#define ia64_intrin_local_irq_restore	\</span>
<span class="cp">	IA64_INTRINSIC_API(intrin_local_irq_restore)</span>
<span class="cp">#define ia64_set_rr0_to_rr4		IA64_INTRINSIC_API(set_rr0_to_rr4)</span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _ASM_IA64_INTRINSICS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
