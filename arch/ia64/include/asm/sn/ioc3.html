<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › include › asm › sn › ioc3.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>ioc3.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2005 Silicon Graphics, Inc.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef IA64_SN_IOC3_H</span>
<span class="cp">#define IA64_SN_IOC3_H</span>

<span class="cm">/* serial port register map */</span>
<span class="k">struct</span> <span class="n">ioc3_serialregs</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">sscr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">stpir</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">stcir</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">srpir</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">srcir</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">srtr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">shadow</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* SUPERIO uart register map */</span>
<span class="k">struct</span> <span class="n">ioc3_uartregs</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">iu_lcr</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="kt">char</span> <span class="n">iir</span><span class="p">;</span>	<span class="cm">/* read only */</span>
		<span class="kt">char</span> <span class="n">fcr</span><span class="p">;</span>	<span class="cm">/* write only */</span>
	<span class="p">}</span> <span class="n">u3</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="kt">char</span> <span class="n">ier</span><span class="p">;</span>	<span class="cm">/* DLAB == 0 */</span>
		<span class="kt">char</span> <span class="n">dlm</span><span class="p">;</span>	<span class="cm">/* DLAB == 1 */</span>
	<span class="p">}</span> <span class="n">u2</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="kt">char</span> <span class="n">rbr</span><span class="p">;</span>	<span class="cm">/* read only, DLAB == 0 */</span>
		<span class="kt">char</span> <span class="n">thr</span><span class="p">;</span>	<span class="cm">/* write only, DLAB == 0 */</span>
		<span class="kt">char</span> <span class="n">dll</span><span class="p">;</span>	<span class="cm">/* DLAB == 1 */</span>
	<span class="p">}</span> <span class="n">u1</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">iu_scr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">iu_msr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">iu_lsr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">iu_mcr</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define iu_rbr u1.rbr</span>
<span class="cp">#define iu_thr u1.thr</span>
<span class="cp">#define iu_dll u1.dll</span>
<span class="cp">#define iu_ier u2.ier</span>
<span class="cp">#define iu_dlm u2.dlm</span>
<span class="cp">#define iu_iir u3.iir</span>
<span class="cp">#define iu_fcr u3.fcr</span>

<span class="k">struct</span> <span class="n">ioc3_sioregs</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">fill</span><span class="p">[</span><span class="mh">0x170</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ioc3_uartregs</span> <span class="n">uartb</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ioc3_uartregs</span> <span class="n">uarta</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* PCI IO/mem space register map */</span>
<span class="k">struct</span> <span class="n">ioc3</span> <span class="p">{</span>
	<span class="kt">uint32_t</span> <span class="n">pci_id</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pci_scr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pci_rev</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pci_lat</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pci_addr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pci_err_addr_l</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">pci_err_addr_h</span><span class="p">;</span>

	<span class="kt">uint32_t</span> <span class="n">sio_ir</span><span class="p">;</span>
	<span class="cm">/* these registers are read-only for general kernel code. To</span>
<span class="cm">	 * modify them use the functions in ioc3.c</span>
<span class="cm">	 */</span>
	<span class="kt">uint32_t</span> <span class="n">sio_ies</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">sio_iec</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">sio_cr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">int_out</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">mcr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">gpcr_s</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">gpcr_c</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">gpdr</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">gppr</span><span class="p">[</span><span class="mi">9</span><span class="p">];</span>
	<span class="kt">char</span> <span class="n">fill</span><span class="p">[</span><span class="mh">0x4c</span><span class="p">];</span>

	<span class="cm">/* serial port registers */</span>
	<span class="kt">uint32_t</span> <span class="n">sbbr_h</span><span class="p">;</span>
	<span class="kt">uint32_t</span> <span class="n">sbbr_l</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ioc3_serialregs</span> <span class="n">port_a</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ioc3_serialregs</span> <span class="n">port_b</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">fill1</span><span class="p">[</span><span class="mh">0x1ff10</span><span class="p">];</span>
	<span class="cm">/* superio registers */</span>
	<span class="k">struct</span> <span class="n">ioc3_sioregs</span> <span class="n">sregs</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* These don&#39;t exist on the ioc3 serial card... */</span>
<span class="cp">#define eier	fill1[8]</span>
<span class="cp">#define eisr	fill1[4]</span>

<span class="cp">#define PCI_LAT			0xc	</span><span class="cm">/* Latency Timer */</span><span class="cp"></span>
<span class="cp">#define PCI_SCR_DROP_MODE_EN	0x00008000 </span><span class="cm">/* drop pios on parity err */</span><span class="cp"></span>
<span class="cp">#define UARTA_BASE		0x178</span>
<span class="cp">#define UARTB_BASE		0x170</span>


<span class="cm">/* bitmasks for serial RX status byte */</span>
<span class="cp">#define RXSB_OVERRUN		0x01	</span><span class="cm">/* char(s) lost */</span><span class="cp"></span>
<span class="cp">#define RXSB_PAR_ERR		0x02	</span><span class="cm">/* parity error */</span><span class="cp"></span>
<span class="cp">#define RXSB_FRAME_ERR		0x04	</span><span class="cm">/* framing error */</span><span class="cp"></span>
<span class="cp">#define RXSB_BREAK		0x08	</span><span class="cm">/* break character */</span><span class="cp"></span>
<span class="cp">#define RXSB_CTS		0x10	</span><span class="cm">/* state of CTS */</span><span class="cp"></span>
<span class="cp">#define RXSB_DCD		0x20	</span><span class="cm">/* state of DCD */</span><span class="cp"></span>
<span class="cp">#define RXSB_MODEM_VALID	0x40	</span><span class="cm">/* DCD, CTS and OVERRUN are valid */</span><span class="cp"></span>
<span class="cp">#define RXSB_DATA_VALID		0x80	</span><span class="cm">/* FRAME_ERR PAR_ERR &amp; BREAK valid */</span><span class="cp"></span>

<span class="cm">/* bitmasks for serial TX control byte */</span>
<span class="cp">#define TXCB_INT_WHEN_DONE	0x20	</span><span class="cm">/* interrupt after this byte is sent */</span><span class="cp"></span>
<span class="cp">#define TXCB_INVALID		0x00	</span><span class="cm">/* byte is invalid */</span><span class="cp"></span>
<span class="cp">#define TXCB_VALID		0x40	</span><span class="cm">/* byte is valid */</span><span class="cp"></span>
<span class="cp">#define TXCB_MCR		0x80	</span><span class="cm">/* data&lt;7:0&gt; to modem cntrl register */</span><span class="cp"></span>
<span class="cp">#define TXCB_DELAY		0xc0	</span><span class="cm">/* delay data&lt;7:0&gt; mSec */</span><span class="cp"></span>

<span class="cm">/* bitmasks for SBBR_L */</span>
<span class="cp">#define SBBR_L_SIZE		0x00000001	</span><span class="cm">/* 0 1KB rings, 1 4KB rings */</span><span class="cp"></span>

<span class="cm">/* bitmasks for SSCR_&lt;A:B&gt; */</span>
<span class="cp">#define SSCR_RX_THRESHOLD	0x000001ff	</span><span class="cm">/* hiwater mark */</span><span class="cp"></span>
<span class="cp">#define SSCR_TX_TIMER_BUSY	0x00010000	</span><span class="cm">/* TX timer in progress */</span><span class="cp"></span>
<span class="cp">#define SSCR_HFC_EN		0x00020000	</span><span class="cm">/* h/w flow cntrl enabled */</span><span class="cp"></span>
<span class="cp">#define SSCR_RX_RING_DCD	0x00040000	</span><span class="cm">/* postRX record on delta-DCD */</span><span class="cp"></span>
<span class="cp">#define SSCR_RX_RING_CTS	0x00080000	</span><span class="cm">/* postRX record on delta-CTS */</span><span class="cp"></span>
<span class="cp">#define SSCR_HIGH_SPD		0x00100000	</span><span class="cm">/* 4X speed */</span><span class="cp"></span>
<span class="cp">#define SSCR_DIAG		0x00200000	</span><span class="cm">/* bypass clock divider */</span><span class="cp"></span>
<span class="cp">#define SSCR_RX_DRAIN		0x08000000	</span><span class="cm">/* drain RX buffer to memory */</span><span class="cp"></span>
<span class="cp">#define SSCR_DMA_EN		0x10000000	</span><span class="cm">/* enable ring buffer DMA */</span><span class="cp"></span>
<span class="cp">#define SSCR_DMA_PAUSE		0x20000000	</span><span class="cm">/* pause DMA */</span><span class="cp"></span>
<span class="cp">#define SSCR_PAUSE_STATE	0x40000000	</span><span class="cm">/* set when PAUSE takes effect*/</span><span class="cp"></span>
<span class="cp">#define SSCR_RESET		0x80000000	</span><span class="cm">/* reset DMA channels */</span><span class="cp"></span>

<span class="cm">/* all producer/comsumer pointers are the same bitfield */</span>
<span class="cp">#define PROD_CONS_PTR_4K	0x00000ff8	</span><span class="cm">/* for 4K buffers */</span><span class="cp"></span>
<span class="cp">#define PROD_CONS_PTR_1K	0x000003f8	</span><span class="cm">/* for 1K buffers */</span><span class="cp"></span>
<span class="cp">#define PROD_CONS_PTR_OFF	3</span>

<span class="cm">/* bitmasks for SRCIR_&lt;A:B&gt; */</span>
<span class="cp">#define SRCIR_ARM		0x80000000	</span><span class="cm">/* arm RX timer */</span><span class="cp"></span>

<span class="cm">/* bitmasks for SHADOW_&lt;A:B&gt; */</span>
<span class="cp">#define SHADOW_DR		0x00000001	</span><span class="cm">/* data ready */</span><span class="cp"></span>
<span class="cp">#define SHADOW_OE		0x00000002	</span><span class="cm">/* overrun error */</span><span class="cp"></span>
<span class="cp">#define SHADOW_PE		0x00000004	</span><span class="cm">/* parity error */</span><span class="cp"></span>
<span class="cp">#define SHADOW_FE		0x00000008	</span><span class="cm">/* framing error */</span><span class="cp"></span>
<span class="cp">#define SHADOW_BI		0x00000010	</span><span class="cm">/* break interrupt */</span><span class="cp"></span>
<span class="cp">#define SHADOW_THRE		0x00000020	</span><span class="cm">/* transmit holding reg empty */</span><span class="cp"></span>
<span class="cp">#define SHADOW_TEMT		0x00000040	</span><span class="cm">/* transmit shift reg empty */</span><span class="cp"></span>
<span class="cp">#define SHADOW_RFCE		0x00000080	</span><span class="cm">/* char in RX fifo has error */</span><span class="cp"></span>
<span class="cp">#define SHADOW_DCTS		0x00010000	</span><span class="cm">/* delta clear to send */</span><span class="cp"></span>
<span class="cp">#define SHADOW_DDCD		0x00080000	</span><span class="cm">/* delta data carrier detect */</span><span class="cp"></span>
<span class="cp">#define SHADOW_CTS		0x00100000	</span><span class="cm">/* clear to send */</span><span class="cp"></span>
<span class="cp">#define SHADOW_DCD		0x00800000	</span><span class="cm">/* data carrier detect */</span><span class="cp"></span>
<span class="cp">#define SHADOW_DTR		0x01000000	</span><span class="cm">/* data terminal ready */</span><span class="cp"></span>
<span class="cp">#define SHADOW_RTS		0x02000000	</span><span class="cm">/* request to send */</span><span class="cp"></span>
<span class="cp">#define SHADOW_OUT1		0x04000000	</span><span class="cm">/* 16550 OUT1 bit */</span><span class="cp"></span>
<span class="cp">#define SHADOW_OUT2		0x08000000	</span><span class="cm">/* 16550 OUT2 bit */</span><span class="cp"></span>
<span class="cp">#define SHADOW_LOOP		0x10000000	</span><span class="cm">/* loopback enabled */</span><span class="cp"></span>

<span class="cm">/* bitmasks for SRTR_&lt;A:B&gt; */</span>
<span class="cp">#define SRTR_CNT		0x00000fff	</span><span class="cm">/* reload value for RX timer */</span><span class="cp"></span>
<span class="cp">#define SRTR_CNT_VAL		0x0fff0000	</span><span class="cm">/* current value of RX timer */</span><span class="cp"></span>
<span class="cp">#define SRTR_CNT_VAL_SHIFT	16</span>
<span class="cp">#define SRTR_HZ			16000		</span><span class="cm">/* SRTR clock frequency */</span><span class="cp"></span>

<span class="cm">/* bitmasks for SIO_IR, SIO_IEC and SIO_IES  */</span>
<span class="cp">#define SIO_IR_SA_TX_MT		0x00000001	</span><span class="cm">/* Serial port A TX empty */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_SA_RX_FULL	0x00000002	</span><span class="cm">/* port A RX buf full */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_SA_RX_HIGH	0x00000004	</span><span class="cm">/* port A RX hiwat */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_SA_RX_TIMER	0x00000008	</span><span class="cm">/* port A RX timeout */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_SA_DELTA_DCD	0x00000010	</span><span class="cm">/* port A delta DCD */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_SA_DELTA_CTS	0x00000020	</span><span class="cm">/* port A delta CTS */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_SA_INT		0x00000040	</span><span class="cm">/* port A pass-thru intr */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_SA_TX_EXPLICIT	0x00000080	</span><span class="cm">/* port A explicit TX thru */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_SA_MEMERR	0x00000100	</span><span class="cm">/* port A PCI error */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_SB_TX_MT		0x00000200</span>
<span class="cp">#define SIO_IR_SB_RX_FULL	0x00000400</span>
<span class="cp">#define SIO_IR_SB_RX_HIGH	0x00000800</span>
<span class="cp">#define SIO_IR_SB_RX_TIMER	0x00001000</span>
<span class="cp">#define SIO_IR_SB_DELTA_DCD	0x00002000</span>
<span class="cp">#define SIO_IR_SB_DELTA_CTS	0x00004000</span>
<span class="cp">#define SIO_IR_SB_INT		0x00008000</span>
<span class="cp">#define SIO_IR_SB_TX_EXPLICIT	0x00010000</span>
<span class="cp">#define SIO_IR_SB_MEMERR	0x00020000</span>
<span class="cp">#define SIO_IR_PP_INT		0x00040000	</span><span class="cm">/* P port pass-thru intr */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_PP_INTA		0x00080000	</span><span class="cm">/* PP context A thru */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_PP_INTB		0x00100000	</span><span class="cm">/* PP context B thru */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_PP_MEMERR	0x00200000	</span><span class="cm">/* PP PCI error */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_KBD_INT		0x00400000	</span><span class="cm">/* kbd/mouse intr */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_RT_INT		0x08000000	</span><span class="cm">/* RT output pulse */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_GEN_INT1		0x10000000	</span><span class="cm">/* RT input pulse */</span><span class="cp"></span>
<span class="cp">#define SIO_IR_GEN_INT_SHIFT	28</span>

<span class="cm">/* per device interrupt masks */</span>
<span class="cp">#define SIO_IR_SA		(SIO_IR_SA_TX_MT | \</span>
<span class="cp">				 SIO_IR_SA_RX_FULL | \</span>
<span class="cp">				 SIO_IR_SA_RX_HIGH | \</span>
<span class="cp">				 SIO_IR_SA_RX_TIMER | \</span>
<span class="cp">				 SIO_IR_SA_DELTA_DCD | \</span>
<span class="cp">				 SIO_IR_SA_DELTA_CTS | \</span>
<span class="cp">				 SIO_IR_SA_INT | \</span>
<span class="cp">				 SIO_IR_SA_TX_EXPLICIT | \</span>
<span class="cp">				 SIO_IR_SA_MEMERR)</span>

<span class="cp">#define SIO_IR_SB		(SIO_IR_SB_TX_MT | \</span>
<span class="cp">				 SIO_IR_SB_RX_FULL | \</span>
<span class="cp">				 SIO_IR_SB_RX_HIGH | \</span>
<span class="cp">				 SIO_IR_SB_RX_TIMER | \</span>
<span class="cp">				 SIO_IR_SB_DELTA_DCD | \</span>
<span class="cp">				 SIO_IR_SB_DELTA_CTS | \</span>
<span class="cp">				 SIO_IR_SB_INT | \</span>
<span class="cp">				 SIO_IR_SB_TX_EXPLICIT | \</span>
<span class="cp">				 SIO_IR_SB_MEMERR)</span>

<span class="cp">#define SIO_IR_PP		(SIO_IR_PP_INT | SIO_IR_PP_INTA | \</span>
<span class="cp">				 SIO_IR_PP_INTB | SIO_IR_PP_MEMERR)</span>
<span class="cp">#define SIO_IR_RT		(SIO_IR_RT_INT | SIO_IR_GEN_INT1)</span>

<span class="cm">/* bitmasks for SIO_CR */</span>
<span class="cp">#define SIO_CR_CMD_PULSE_SHIFT 15</span>
<span class="cp">#define SIO_CR_SER_A_BASE_SHIFT 1</span>
<span class="cp">#define SIO_CR_SER_B_BASE_SHIFT 8</span>
<span class="cp">#define SIO_CR_ARB_DIAG		0x00380000	</span><span class="cm">/* cur !enet PCI requet (ro) */</span><span class="cp"></span>
<span class="cp">#define SIO_CR_ARB_DIAG_TXA	0x00000000</span>
<span class="cp">#define SIO_CR_ARB_DIAG_RXA	0x00080000</span>
<span class="cp">#define SIO_CR_ARB_DIAG_TXB	0x00100000</span>
<span class="cp">#define SIO_CR_ARB_DIAG_RXB	0x00180000</span>
<span class="cp">#define SIO_CR_ARB_DIAG_PP	0x00200000</span>
<span class="cp">#define SIO_CR_ARB_DIAG_IDLE	0x00400000	</span><span class="cm">/* 0 -&gt; active request (ro) */</span><span class="cp"></span>

<span class="cm">/* defs for some of the generic I/O pins */</span>
<span class="cp">#define GPCR_PHY_RESET		0x20	</span><span class="cm">/* pin is output to PHY reset */</span><span class="cp"></span>
<span class="cp">#define GPCR_UARTB_MODESEL	0x40	</span><span class="cm">/* pin is output to port B mode sel */</span><span class="cp"></span>
<span class="cp">#define GPCR_UARTA_MODESEL	0x80	</span><span class="cm">/* pin is output to port A mode sel */</span><span class="cp"></span>

<span class="cp">#define GPPR_PHY_RESET_PIN	5	</span><span class="cm">/* GIO pin controlling phy reset */</span><span class="cp"></span>
<span class="cp">#define GPPR_UARTB_MODESEL_PIN	6	</span><span class="cm">/* GIO pin cntrling uartb modeselect */</span><span class="cp"></span>
<span class="cp">#define GPPR_UARTA_MODESEL_PIN	7	</span><span class="cm">/* GIO pin cntrling uarta modeselect */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* IA64_SN_IOC3_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
