<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › include › asm › sn › klconfig.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>klconfig.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is subject to the terms and conditions of the GNU General Public</span>
<span class="cm"> * License.  See the file &quot;COPYING&quot; in the main directory of this archive</span>
<span class="cm"> * for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * Derived from IRIX &lt;sys/SN/klconfig.h&gt;.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1992-1997,1999,2001-2004 Silicon Graphics, Inc.  All Rights Reserved.</span>
<span class="cm"> * Copyright (C) 1999 by Ralf Baechle</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _ASM_IA64_SN_KLCONFIG_H</span>
<span class="cp">#define _ASM_IA64_SN_KLCONFIG_H</span>

<span class="cm">/*</span>
<span class="cm"> * The KLCONFIG structures store info about the various BOARDs found</span>
<span class="cm"> * during Hardware Discovery. In addition, it stores info about the</span>
<span class="cm"> * components found on the BOARDs.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="n">s32</span> <span class="n">klconf_off_t</span><span class="p">;</span>


<span class="cm">/* Functions/macros needed to use this structure */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">kl_config_hdr</span> <span class="p">{</span>
	<span class="kt">char</span>		<span class="n">pad</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
	<span class="n">klconf_off_t</span>	<span class="n">ch_board_info</span><span class="p">;</span>	<span class="cm">/* the link list of boards */</span>
	<span class="kt">char</span>		<span class="n">pad0</span><span class="p">[</span><span class="mi">88</span><span class="p">];</span>
<span class="p">}</span> <span class="n">kl_config_hdr_t</span><span class="p">;</span>


<span class="cp">#define NODE_OFFSET_TO_LBOARD(nasid,off)        (lboard_t*)(GLOBAL_CAC_ADDR((nasid), (off)))</span>

<span class="cm">/*</span>
<span class="cm"> * The KLCONFIG area is organized as a LINKED LIST of BOARDs. A BOARD</span>
<span class="cm"> * can be either &#39;LOCAL&#39; or &#39;REMOTE&#39;. LOCAL means it is attached to </span>
<span class="cm"> * the LOCAL/current NODE. REMOTE means it is attached to a different</span>
<span class="cm"> * node.(TBD - Need a way to treat ROUTER boards.)</span>
<span class="cm"> *</span>
<span class="cm"> * There are 2 different structures to represent these boards -</span>
<span class="cm"> * lboard - Local board, rboard - remote board. These 2 structures</span>
<span class="cm"> * can be arbitrarily mixed in the LINKED LIST of BOARDs. (Refer</span>
<span class="cm"> * Figure below). The first byte of the rboard or lboard structure</span>
<span class="cm"> * is used to find out its type - no unions are used.</span>
<span class="cm"> * If it is a lboard, then the config info of this board will be found</span>
<span class="cm"> * on the local node. (LOCAL NODE BASE + offset value gives pointer to </span>
<span class="cm"> * the structure.</span>
<span class="cm"> * If it is a rboard, the local structure contains the node number</span>
<span class="cm"> * and the offset of the beginning of the LINKED LIST on the remote node.</span>
<span class="cm"> * The details of the hardware on a remote node can be built locally,</span>
<span class="cm"> * if required, by reading the LINKED LIST on the remote node and </span>
<span class="cm"> * ignoring all the rboards on that node.</span>
<span class="cm"> *</span>
<span class="cm"> * The local node uses the REMOTE NODE NUMBER + OFFSET to point to the </span>
<span class="cm"> * First board info on the remote node. The remote node list is </span>
<span class="cm"> * traversed as the local list, using the REMOTE BASE ADDRESS and not</span>
<span class="cm"> * the local base address and ignoring all rboard values.</span>
<span class="cm"> *</span>
<span class="cm"> * </span>
<span class="cm"> KLCONFIG</span>

<span class="cm"> +------------+      +------------+      +------------+      +------------+</span>
<span class="cm"> |  lboard    |  +--&gt;|   lboard   |  +--&gt;|   rboard   |  +--&gt;|   lboard   |</span>
<span class="cm"> +------------+  |   +------------+  |   +------------+  |   +------------+</span>
<span class="cm"> | board info |  |   | board info |  |   |errinfo,bptr|  |   | board info |</span>
<span class="cm"> +------------+  |   +------------+  |   +------------+  |   +------------+</span>
<span class="cm"> | offset     |--+   |  offset    |--+   |  offset    |--+   |offset=NULL |</span>
<span class="cm"> +------------+      +------------+      +------------+      +------------+</span>


<span class="cm"> +------------+</span>
<span class="cm"> | board info |</span>
<span class="cm"> +------------+       +--------------------------------+</span>
<span class="cm"> | compt 1    |------&gt;| type, rev, diaginfo, size ...  |  (CPU)</span>
<span class="cm"> +------------+       +--------------------------------+</span>
<span class="cm"> | compt 2    |--+</span>
<span class="cm"> +------------+  |    +--------------------------------+</span>
<span class="cm"> |  ...       |  +---&gt;| type, rev, diaginfo, size ...  |  (MEM_BANK)</span>
<span class="cm"> +------------+       +--------------------------------+</span>
<span class="cm"> | errinfo    |--+</span>
<span class="cm"> +------------+  |    +--------------------------------+</span>
<span class="cm">                 +---&gt;|r/l brd errinfo,compt err flags |</span>
<span class="cm">                      +--------------------------------+</span>

<span class="cm"> *</span>
<span class="cm"> * Each BOARD consists of COMPONENTs and the BOARD structure has </span>
<span class="cm"> * pointers (offsets) to its COMPONENT structure.</span>
<span class="cm"> * The COMPONENT structure has version info, size and speed info, revision,</span>
<span class="cm"> * error info and the NIC info. This structure can accommodate any</span>
<span class="cm"> * BOARD with arbitrary COMPONENT composition.</span>
<span class="cm"> *</span>
<span class="cm"> * The ERRORINFO part of each BOARD has error information</span>
<span class="cm"> * that describes errors about the BOARD itself. It also has flags to</span>
<span class="cm"> * indicate the COMPONENT(s) on the board that have errors. The error </span>
<span class="cm"> * information specific to the COMPONENT is present in the respective </span>
<span class="cm"> * COMPONENT structure.</span>
<span class="cm"> *</span>
<span class="cm"> * The ERRORINFO structure is also treated like a COMPONENT, ie. the </span>
<span class="cm"> * BOARD has pointers(offset) to the ERRORINFO structure. The rboard</span>
<span class="cm"> * structure also has a pointer to the ERRORINFO structure. This is </span>
<span class="cm"> * the place to store ERRORINFO about a REMOTE NODE, if the HUB on</span>
<span class="cm"> * that NODE is not working or if the REMOTE MEMORY is BAD. In cases where </span>
<span class="cm"> * only the CPU of the REMOTE NODE is disabled, the ERRORINFO pointer can</span>
<span class="cm"> * be a NODE NUMBER, REMOTE OFFSET combination, pointing to error info </span>
<span class="cm"> * which is present on the REMOTE NODE.(TBD)</span>
<span class="cm"> * REMOTE ERRINFO can be stored on any of the nearest nodes </span>
<span class="cm"> * or on all the nearest nodes.(TBD)</span>
<span class="cm"> * Like BOARD structures, REMOTE ERRINFO structures can be built locally</span>
<span class="cm"> * using the rboard errinfo pointer.</span>
<span class="cm"> *</span>
<span class="cm"> * In order to get useful information from this Data organization, a set of</span>
<span class="cm"> * interface routines are provided (TBD). The important thing to remember while</span>
<span class="cm"> * manipulating the structures, is that, the NODE number information should</span>
<span class="cm"> * be used. If the NODE is non-zero (remote) then each offset should</span>
<span class="cm"> * be added to the REMOTE BASE ADDR else it should be added to the LOCAL BASE ADDR. </span>
<span class="cm"> * This includes offsets for BOARDS, COMPONENTS and ERRORINFO.</span>
<span class="cm"> * </span>
<span class="cm"> * Note that these structures do not provide much info about connectivity.</span>
<span class="cm"> * That info will be part of HWGRAPH, which is an extension of the cfg_t</span>
<span class="cm"> * data structure. (ref IP27prom/cfg.h) It has to be extended to include</span>
<span class="cm"> * the IO part of the Network(TBD).</span>
<span class="cm"> *</span>
<span class="cm"> * The data structures below define the above concepts.</span>
<span class="cm"> */</span>


<span class="cm">/*</span>
<span class="cm"> * BOARD classes</span>
<span class="cm"> */</span>

<span class="cp">#define KLCLASS_MASK	0xf0   </span>
<span class="cp">#define KLCLASS_NONE	0x00</span>
<span class="cp">#define KLCLASS_NODE	0x10             </span><span class="cm">/* CPU, Memory and HUB board */</span><span class="cp"></span>
<span class="cp">#define KLCLASS_CPU	KLCLASS_NODE	</span>
<span class="cp">#define KLCLASS_IO	0x20             </span><span class="cm">/* BaseIO, 4 ch SCSI, ethernet, FDDI </span>
<span class="cm">					    and the non-graphics widget boards */</span><span class="cp"></span>
<span class="cp">#define KLCLASS_ROUTER	0x30             </span><span class="cm">/* Router board */</span><span class="cp"></span>
<span class="cp">#define KLCLASS_MIDPLANE 0x40            </span><span class="cm">/* We need to treat this as a board</span>
<span class="cm">                                            so that we can record error info */</span><span class="cp"></span>
<span class="cp">#define KLCLASS_IOBRICK	0x70		</span><span class="cm">/* IP35 iobrick */</span><span class="cp"></span>
<span class="cp">#define KLCLASS_MAX	8		</span><span class="cm">/* Bump this if a new CLASS is added */</span><span class="cp"></span>

<span class="cp">#define KLCLASS(_x) ((_x) &amp; KLCLASS_MASK)</span>


<span class="cm">/*</span>
<span class="cm"> * board types</span>
<span class="cm"> */</span>

<span class="cp">#define KLTYPE_MASK	0x0f</span>
<span class="cp">#define KLTYPE(_x)      ((_x) &amp; KLTYPE_MASK)</span>

<span class="cp">#define KLTYPE_SNIA	(KLCLASS_CPU | 0x1)</span>
<span class="cp">#define KLTYPE_TIO	(KLCLASS_CPU | 0x2)</span>

<span class="cp">#define KLTYPE_ROUTER     (KLCLASS_ROUTER | 0x1)</span>
<span class="cp">#define KLTYPE_META_ROUTER (KLCLASS_ROUTER | 0x3)</span>
<span class="cp">#define KLTYPE_REPEATER_ROUTER (KLCLASS_ROUTER | 0x4)</span>

<span class="cp">#define KLTYPE_IOBRICK_XBOW	(KLCLASS_MIDPLANE | 0x2)</span>

<span class="cp">#define KLTYPE_IOBRICK		(KLCLASS_IOBRICK | 0x0)</span>
<span class="cp">#define KLTYPE_NBRICK		(KLCLASS_IOBRICK | 0x4)</span>
<span class="cp">#define KLTYPE_PXBRICK		(KLCLASS_IOBRICK | 0x6)</span>
<span class="cp">#define KLTYPE_IXBRICK		(KLCLASS_IOBRICK | 0x7)</span>
<span class="cp">#define KLTYPE_CGBRICK		(KLCLASS_IOBRICK | 0x8)</span>
<span class="cp">#define KLTYPE_OPUSBRICK	(KLCLASS_IOBRICK | 0x9)</span>
<span class="cp">#define KLTYPE_SABRICK          (KLCLASS_IOBRICK | 0xa)</span>
<span class="cp">#define KLTYPE_IABRICK		(KLCLASS_IOBRICK | 0xb)</span>
<span class="cp">#define KLTYPE_PABRICK          (KLCLASS_IOBRICK | 0xc)</span>
<span class="cp">#define KLTYPE_GABRICK		(KLCLASS_IOBRICK | 0xd)</span>


<span class="cm">/* </span>
<span class="cm"> * board structures</span>
<span class="cm"> */</span>

<span class="cp">#define MAX_COMPTS_PER_BRD 24</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">lboard_s</span> <span class="p">{</span>
	<span class="n">klconf_off_t</span> 	<span class="n">brd_next_any</span><span class="p">;</span>     <span class="cm">/* Next BOARD */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">struct_type</span><span class="p">;</span>      <span class="cm">/* type of structure, local or remote */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_type</span><span class="p">;</span>         <span class="cm">/* type+class */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_sversion</span><span class="p">;</span>     <span class="cm">/* version of this structure */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_brevision</span><span class="p">;</span>    <span class="cm">/* board revision */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_promver</span><span class="p">;</span>      <span class="cm">/* board prom version, if any */</span>
 	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_flags</span><span class="p">;</span>        <span class="cm">/* Enabled, Disabled etc */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_slot</span><span class="p">;</span>         <span class="cm">/* slot number */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span>	<span class="n">brd_debugsw</span><span class="p">;</span>      <span class="cm">/* Debug switches */</span>
	<span class="n">geoid_t</span>		<span class="n">brd_geoid</span><span class="p">;</span>	  <span class="cm">/* geo id */</span>
	<span class="n">partid_t</span> 	<span class="n">brd_partition</span><span class="p">;</span>    <span class="cm">/* Partition number */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span> 	<span class="n">brd_diagval</span><span class="p">;</span>      <span class="cm">/* diagnostic value */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span> 	<span class="n">brd_diagparm</span><span class="p">;</span>     <span class="cm">/* diagnostic parameter */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_inventory</span><span class="p">;</span>    <span class="cm">/* inventory history */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_numcompts</span><span class="p">;</span>    <span class="cm">/* Number of components */</span>
        <span class="n">nic_t</span>         	<span class="n">brd_nic</span><span class="p">;</span>          <span class="cm">/* Number in CAN */</span>
	<span class="n">nasid_t</span>		<span class="n">brd_nasid</span><span class="p">;</span>        <span class="cm">/* passed parameter */</span>
	<span class="n">klconf_off_t</span> 	<span class="n">brd_compts</span><span class="p">[</span><span class="n">MAX_COMPTS_PER_BRD</span><span class="p">];</span> <span class="cm">/* pointers to COMPONENTS */</span>
	<span class="n">klconf_off_t</span> 	<span class="n">brd_errinfo</span><span class="p">;</span>      <span class="cm">/* Board&#39;s error information */</span>
	<span class="k">struct</span> <span class="n">lboard_s</span> <span class="o">*</span><span class="n">brd_parent</span><span class="p">;</span>	  <span class="cm">/* Logical parent for this brd */</span>
	<span class="kt">char</span>            <span class="n">pad0</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">brd_confidence</span><span class="p">;</span>	  <span class="cm">/* confidence that the board is bad */</span>
	<span class="n">nasid_t</span>		<span class="n">brd_owner</span><span class="p">;</span>        <span class="cm">/* who owns this board */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> 	<span class="n">brd_nic_flags</span><span class="p">;</span>    <span class="cm">/* To handle 8 more NICs */</span>
	<span class="kt">char</span>		<span class="n">pad1</span><span class="p">[</span><span class="mi">24</span><span class="p">];</span>	  <span class="cm">/* future expansion */</span>
	<span class="kt">char</span>		<span class="n">brd_name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="n">nasid_t</span>		<span class="n">brd_next_same_host</span><span class="p">;</span> <span class="cm">/* host of next brd w/same nasid */</span>
	<span class="n">klconf_off_t</span>	<span class="n">brd_next_same</span><span class="p">;</span>    <span class="cm">/* Next BOARD with same nasid */</span>
<span class="p">}</span> <span class="n">lboard_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Generic info structure. This stores common info about a </span>
<span class="cm"> * component.</span>
<span class="cm"> */</span>
 
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">klinfo_s</span> <span class="p">{</span>                  <span class="cm">/* Generic info */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">struct_type</span><span class="p">;</span>       <span class="cm">/* type of this structure */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">struct_version</span><span class="p">;</span>    <span class="cm">/* version of this structure */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">flags</span><span class="p">;</span>            <span class="cm">/* Enabled, disabled etc */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">revision</span><span class="p">;</span>         <span class="cm">/* component revision */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">diagval</span><span class="p">;</span>          <span class="cm">/* result of diagnostics */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">diagparm</span><span class="p">;</span>         <span class="cm">/* diagnostic parameter */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">inventory</span><span class="p">;</span>        <span class="cm">/* previous inventory status */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">partid</span><span class="p">;</span>		   <span class="cm">/* widget part number */</span>
	<span class="n">nic_t</span> 		<span class="n">nic</span><span class="p">;</span>              <span class="cm">/* MUst be aligned properly */</span>
        <span class="kt">unsigned</span> <span class="kt">char</span>   <span class="n">physid</span><span class="p">;</span>           <span class="cm">/* physical id of component */</span>
        <span class="kt">unsigned</span> <span class="kt">int</span>    <span class="n">virtid</span><span class="p">;</span>           <span class="cm">/* virtual id as seen by system */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">widid</span><span class="p">;</span>	          <span class="cm">/* Widget id - if applicable */</span>
	<span class="n">nasid_t</span>		<span class="n">nasid</span><span class="p">;</span>            <span class="cm">/* node number - from parent */</span>
	<span class="kt">char</span>		<span class="n">pad1</span><span class="p">;</span>		  <span class="cm">/* pad out structure. */</span>
	<span class="kt">char</span>		<span class="n">pad2</span><span class="p">;</span>		  <span class="cm">/* pad out structure. */</span>
	<span class="kt">void</span>		<span class="o">*</span><span class="n">data</span><span class="p">;</span>
        <span class="n">klconf_off_t</span>	<span class="n">errinfo</span><span class="p">;</span>          <span class="cm">/* component specific errors */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">pad3</span><span class="p">;</span>             <span class="cm">/* pci fields have moved over to */</span>
        <span class="kt">unsigned</span> <span class="kt">short</span>  <span class="n">pad4</span><span class="p">;</span>             <span class="cm">/* klbri_t */</span>
<span class="p">}</span> <span class="n">klinfo_t</span> <span class="p">;</span>


<span class="k">static</span> <span class="kr">inline</span> <span class="n">lboard_t</span> <span class="o">*</span><span class="nf">find_lboard_next</span><span class="p">(</span><span class="n">lboard_t</span> <span class="o">*</span> <span class="n">brd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">brd</span> <span class="o">&amp;&amp;</span> <span class="n">brd</span><span class="o">-&gt;</span><span class="n">brd_next_any</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">NODE_OFFSET_TO_LBOARD</span><span class="p">(</span><span class="n">NASID_GET</span><span class="p">(</span><span class="n">brd</span><span class="p">),</span> <span class="n">brd</span><span class="o">-&gt;</span><span class="n">brd_next_any</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_IA64_SN_KLCONFIG_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
