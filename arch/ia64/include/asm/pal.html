<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › include › asm › pal.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>pal.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_IA64_PAL_H</span>
<span class="cp">#define _ASM_IA64_PAL_H</span>

<span class="cm">/*</span>
<span class="cm"> * Processor Abstraction Layer definitions.</span>
<span class="cm"> *</span>
<span class="cm"> * This is based on Intel IA-64 Architecture Software Developer&#39;s Manual rev 1.0</span>
<span class="cm"> * chapter 11 IA-64 Processor Abstraction Layer</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 1998-2001 Hewlett-Packard Co</span>
<span class="cm"> *	David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;</span>
<span class="cm"> *	Stephane Eranian &lt;eranian@hpl.hp.com&gt;</span>
<span class="cm"> * Copyright (C) 1999 VA Linux Systems</span>
<span class="cm"> * Copyright (C) 1999 Walt Drummond &lt;drummond@valinux.com&gt;</span>
<span class="cm"> * Copyright (C) 1999 Srinivasa Prasad Thirumalachar &lt;sprasad@sprasad.engr.sgi.com&gt;</span>
<span class="cm"> * Copyright (C) 2008 Silicon Graphics, Inc. (SGI)</span>
<span class="cm"> *</span>
<span class="cm"> * 99/10/01	davidm	Make sure we pass zero for reserved parameters.</span>
<span class="cm"> * 00/03/07	davidm	Updated pal_cache_flush() to be in sync with PAL v2.6.</span>
<span class="cm"> * 00/03/23     cfleck  Modified processor min-state save area to match updated PAL &amp; SAL info</span>
<span class="cm"> * 00/05/24     eranian Updated to latest PAL spec, fix structures bugs, added</span>
<span class="cm"> * 00/05/25	eranian Support for stack calls, and static physical calls</span>
<span class="cm"> * 00/06/18	eranian Support for stacked physical calls</span>
<span class="cm"> * 06/10/26	rja	Support for Intel Itanium Architecture Software Developer&#39;s</span>
<span class="cm"> *			Manual Rev 2.2 (Jan 2006)</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Note that some of these calls use a static-register only calling</span>
<span class="cm"> * convention which has nothing to do with the regular calling</span>
<span class="cm"> * convention.</span>
<span class="cm"> */</span>
<span class="cp">#define PAL_CACHE_FLUSH		1	</span><span class="cm">/* flush i/d cache */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_INFO		2	</span><span class="cm">/* get detailed i/d cache info */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_INIT		3	</span><span class="cm">/* initialize i/d cache */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_SUMMARY	4	</span><span class="cm">/* get summary of cache hierarchy */</span><span class="cp"></span>
<span class="cp">#define PAL_MEM_ATTRIB		5	</span><span class="cm">/* list supported memory attributes */</span><span class="cp"></span>
<span class="cp">#define PAL_PTCE_INFO		6	</span><span class="cm">/* purge TLB info */</span><span class="cp"></span>
<span class="cp">#define PAL_VM_INFO		7	</span><span class="cm">/* return supported virtual memory features */</span><span class="cp"></span>
<span class="cp">#define PAL_VM_SUMMARY		8	</span><span class="cm">/* return summary on supported vm features */</span><span class="cp"></span>
<span class="cp">#define PAL_BUS_GET_FEATURES	9	</span><span class="cm">/* return processor bus interface features settings */</span><span class="cp"></span>
<span class="cp">#define PAL_BUS_SET_FEATURES	10	</span><span class="cm">/* set processor bus features */</span><span class="cp"></span>
<span class="cp">#define PAL_DEBUG_INFO		11	</span><span class="cm">/* get number of debug registers */</span><span class="cp"></span>
<span class="cp">#define PAL_FIXED_ADDR		12	</span><span class="cm">/* get fixed component of processors&#39;s directed address */</span><span class="cp"></span>
<span class="cp">#define PAL_FREQ_BASE		13	</span><span class="cm">/* base frequency of the platform */</span><span class="cp"></span>
<span class="cp">#define PAL_FREQ_RATIOS		14	</span><span class="cm">/* ratio of processor, bus and ITC frequency */</span><span class="cp"></span>
<span class="cp">#define PAL_PERF_MON_INFO	15	</span><span class="cm">/* return performance monitor info */</span><span class="cp"></span>
<span class="cp">#define PAL_PLATFORM_ADDR	16	</span><span class="cm">/* set processor interrupt block and IO port space addr */</span><span class="cp"></span>
<span class="cp">#define PAL_PROC_GET_FEATURES	17	</span><span class="cm">/* get configurable processor features &amp; settings */</span><span class="cp"></span>
<span class="cp">#define PAL_PROC_SET_FEATURES	18	</span><span class="cm">/* enable/disable configurable processor features */</span><span class="cp"></span>
<span class="cp">#define PAL_RSE_INFO		19	</span><span class="cm">/* return rse information */</span><span class="cp"></span>
<span class="cp">#define PAL_VERSION		20	</span><span class="cm">/* return version of PAL code */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_CLEAR_LOG	21	</span><span class="cm">/* clear all processor log info */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_DRAIN		22	</span><span class="cm">/* drain operations which could result in an MCA */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_EXPECTED		23	</span><span class="cm">/* set/reset expected MCA indicator */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_DYNAMIC_STATE	24	</span><span class="cm">/* get processor dynamic state */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_ERROR_INFO	25	</span><span class="cm">/* get processor MCA info and static state */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_RESUME		26	</span><span class="cm">/* Return to interrupted process */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_REGISTER_MEM	27	</span><span class="cm">/* Register memory for PAL to use during MCAs and inits */</span><span class="cp"></span>
<span class="cp">#define PAL_HALT		28	</span><span class="cm">/* enter the low power HALT state */</span><span class="cp"></span>
<span class="cp">#define PAL_HALT_LIGHT		29	</span><span class="cm">/* enter the low power light halt state*/</span><span class="cp"></span>
<span class="cp">#define PAL_COPY_INFO		30	</span><span class="cm">/* returns info needed to relocate PAL */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_LINE_INIT	31	</span><span class="cm">/* init tags &amp; data of cache line */</span><span class="cp"></span>
<span class="cp">#define PAL_PMI_ENTRYPOINT	32	</span><span class="cm">/* register PMI memory entry points with the processor */</span><span class="cp"></span>
<span class="cp">#define PAL_ENTER_IA_32_ENV	33	</span><span class="cm">/* enter IA-32 system environment */</span><span class="cp"></span>
<span class="cp">#define PAL_VM_PAGE_SIZE	34	</span><span class="cm">/* return vm TC and page walker page sizes */</span><span class="cp"></span>

<span class="cp">#define PAL_MEM_FOR_TEST	37	</span><span class="cm">/* get amount of memory needed for late processor test */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_PROT_INFO	38	</span><span class="cm">/* get i/d cache protection info */</span><span class="cp"></span>
<span class="cp">#define PAL_REGISTER_INFO	39	</span><span class="cm">/* return AR and CR register information*/</span><span class="cp"></span>
<span class="cp">#define PAL_SHUTDOWN		40	</span><span class="cm">/* enter processor shutdown state */</span><span class="cp"></span>
<span class="cp">#define PAL_PREFETCH_VISIBILITY	41	</span><span class="cm">/* Make Processor Prefetches Visible */</span><span class="cp"></span>
<span class="cp">#define PAL_LOGICAL_TO_PHYSICAL 42	</span><span class="cm">/* returns information on logical to physical processor mapping */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_SHARED_INFO	43	</span><span class="cm">/* returns information on caches shared by logical processor */</span><span class="cp"></span>
<span class="cp">#define PAL_GET_HW_POLICY	48	</span><span class="cm">/* Get current hardware resource sharing policy */</span><span class="cp"></span>
<span class="cp">#define PAL_SET_HW_POLICY	49	</span><span class="cm">/* Set current hardware resource sharing policy */</span><span class="cp"></span>
<span class="cp">#define PAL_VP_INFO		50	</span><span class="cm">/* Information about virtual processor features */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_HW_TRACKING	51	</span><span class="cm">/* Hardware tracking status */</span><span class="cp"></span>

<span class="cp">#define PAL_COPY_PAL		256	</span><span class="cm">/* relocate PAL procedures and PAL PMI */</span><span class="cp"></span>
<span class="cp">#define PAL_HALT_INFO		257	</span><span class="cm">/* return the low power capabilities of processor */</span><span class="cp"></span>
<span class="cp">#define PAL_TEST_PROC		258	</span><span class="cm">/* perform late processor self-test */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_READ		259	</span><span class="cm">/* read tag &amp; data of cacheline for diagnostic testing */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_WRITE		260	</span><span class="cm">/* write tag &amp; data of cacheline for diagnostic testing */</span><span class="cp"></span>
<span class="cp">#define PAL_VM_TR_READ		261	</span><span class="cm">/* read contents of translation register */</span><span class="cp"></span>
<span class="cp">#define PAL_GET_PSTATE		262	</span><span class="cm">/* get the current P-state */</span><span class="cp"></span>
<span class="cp">#define PAL_SET_PSTATE		263	</span><span class="cm">/* set the P-state */</span><span class="cp"></span>
<span class="cp">#define PAL_BRAND_INFO		274	</span><span class="cm">/* Processor branding information */</span><span class="cp"></span>

<span class="cp">#define PAL_GET_PSTATE_TYPE_LASTSET	0</span>
<span class="cp">#define PAL_GET_PSTATE_TYPE_AVGANDRESET	1</span>
<span class="cp">#define PAL_GET_PSTATE_TYPE_AVGNORESET	2</span>
<span class="cp">#define PAL_GET_PSTATE_TYPE_INSTANT	3</span>

<span class="cp">#define PAL_MC_ERROR_INJECT	276	</span><span class="cm">/* Injects processor error or returns injection capabilities */</span><span class="cp"></span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;asm/fpu.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * Data types needed to pass information into PAL procedures and</span>
<span class="cm"> * interpret information returned by them.</span>
<span class="cm"> */</span>

<span class="cm">/* Return status from the PAL procedure */</span>
<span class="k">typedef</span> <span class="n">s64</span>				<span class="n">pal_status_t</span><span class="p">;</span>

<span class="cp">#define PAL_STATUS_SUCCESS		0	</span><span class="cm">/* No error */</span><span class="cp"></span>
<span class="cp">#define PAL_STATUS_UNIMPLEMENTED	(-1)	</span><span class="cm">/* Unimplemented procedure */</span><span class="cp"></span>
<span class="cp">#define PAL_STATUS_EINVAL		(-2)	</span><span class="cm">/* Invalid argument */</span><span class="cp"></span>
<span class="cp">#define PAL_STATUS_ERROR		(-3)	</span><span class="cm">/* Error */</span><span class="cp"></span>
<span class="cp">#define PAL_STATUS_CACHE_INIT_FAIL	(-4)	</span><span class="cm">/* Could not initialize the</span>
<span class="cm">						 * specified level and type of</span>
<span class="cm">						 * cache without sideeffects</span>
<span class="cm">						 * and &quot;restrict&quot; was 1</span>
<span class="cm">						 */</span><span class="cp"></span>
<span class="cp">#define PAL_STATUS_REQUIRES_MEMORY	(-9)	</span><span class="cm">/* Call requires PAL memory buffer */</span><span class="cp"></span>

<span class="cm">/* Processor cache level in the hierarchy */</span>
<span class="k">typedef</span> <span class="n">u64</span>				<span class="n">pal_cache_level_t</span><span class="p">;</span>
<span class="cp">#define PAL_CACHE_LEVEL_L0		0	</span><span class="cm">/* L0 */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_LEVEL_L1		1	</span><span class="cm">/* L1 */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_LEVEL_L2		2	</span><span class="cm">/* L2 */</span><span class="cp"></span>


<span class="cm">/* Processor cache type at a particular level in the hierarchy */</span>

<span class="k">typedef</span> <span class="n">u64</span>				<span class="n">pal_cache_type_t</span><span class="p">;</span>
<span class="cp">#define PAL_CACHE_TYPE_INSTRUCTION	1	</span><span class="cm">/* Instruction cache */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_TYPE_DATA		2	</span><span class="cm">/* Data or unified cache */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_TYPE_INSTRUCTION_DATA	3	</span><span class="cm">/* Both Data &amp; Instruction */</span><span class="cp"></span>


<span class="cp">#define PAL_CACHE_FLUSH_INVALIDATE	1	</span><span class="cm">/* Invalidate clean lines */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_FLUSH_CHK_INTRS	2	</span><span class="cm">/* check for interrupts/mc while flushing */</span><span class="cp"></span>

<span class="cm">/* Processor cache line size in bytes  */</span>
<span class="k">typedef</span> <span class="kt">int</span>				<span class="n">pal_cache_line_size_t</span><span class="p">;</span>

<span class="cm">/* Processor cache line state */</span>
<span class="k">typedef</span> <span class="n">u64</span>				<span class="n">pal_cache_line_state_t</span><span class="p">;</span>
<span class="cp">#define PAL_CACHE_LINE_STATE_INVALID	0	</span><span class="cm">/* Invalid */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_LINE_STATE_SHARED	1	</span><span class="cm">/* Shared */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_LINE_STATE_EXCLUSIVE	2	</span><span class="cm">/* Exclusive */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_LINE_STATE_MODIFIED	3	</span><span class="cm">/* Modified */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_freq_ratio</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">den</span><span class="p">,</span> <span class="n">num</span><span class="p">;</span>		<span class="cm">/* numerator &amp; denominator */</span>
<span class="p">}</span> <span class="n">itc_ratio</span><span class="p">,</span> <span class="n">proc_ratio</span><span class="p">;</span>

<span class="k">typedef</span>	<span class="k">union</span>  <span class="n">pal_cache_config_info_1_s</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>		<span class="n">u</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* 0 Unified cache ? */</span>
				<span class="n">at</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* 2-1 Cache mem attr*/</span>
				<span class="n">reserved</span>	<span class="o">:</span> <span class="mi">5</span><span class="p">,</span>	<span class="cm">/* 7-3 Reserved */</span>
				<span class="n">associativity</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 16-8 Associativity*/</span>
				<span class="n">line_size</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 23-17 Line size */</span>
				<span class="n">stride</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 31-24 Stride */</span>
				<span class="n">store_latency</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/*39-32 Store latency*/</span>
				<span class="n">load_latency</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 47-40 Load latency*/</span>
				<span class="n">store_hints</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 55-48 Store hints*/</span>
				<span class="n">load_hints</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">;</span>	<span class="cm">/* 63-56 Load hints */</span>
	<span class="p">}</span> <span class="n">pcci1_bits</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">pcci1_data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_cache_config_info_1_t</span><span class="p">;</span>

<span class="k">typedef</span>	<span class="k">union</span>  <span class="n">pal_cache_config_info_2_s</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u32</span>		<span class="n">cache_size</span><span class="p">;</span>		<span class="cm">/*cache size in bytes*/</span>


		<span class="n">u32</span>		<span class="n">alias_boundary</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 39-32 aliased addr</span>
<span class="cm">							 * separation for max</span>
<span class="cm">							 * performance.</span>
<span class="cm">							 */</span>
				<span class="n">tag_ls_bit</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 47-40 LSb of addr*/</span>
				<span class="n">tag_ms_bit</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 55-48 MSb of addr*/</span>
				<span class="n">reserved</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">;</span>	<span class="cm">/* 63-56 Reserved */</span>
	<span class="p">}</span> <span class="n">pcci2_bits</span><span class="p">;</span>
	<span class="n">u64</span>			<span class="n">pcci2_data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_cache_config_info_2_t</span><span class="p">;</span>


<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_cache_config_info_s</span> <span class="p">{</span>
	<span class="n">pal_status_t</span>			<span class="n">pcci_status</span><span class="p">;</span>
	<span class="n">pal_cache_config_info_1_t</span>	<span class="n">pcci_info_1</span><span class="p">;</span>
	<span class="n">pal_cache_config_info_2_t</span>	<span class="n">pcci_info_2</span><span class="p">;</span>
	<span class="n">u64</span>				<span class="n">pcci_reserved</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_cache_config_info_t</span><span class="p">;</span>

<span class="cp">#define pcci_ld_hints		pcci_info_1.pcci1_bits.load_hints</span>
<span class="cp">#define pcci_st_hints		pcci_info_1.pcci1_bits.store_hints</span>
<span class="cp">#define pcci_ld_latency		pcci_info_1.pcci1_bits.load_latency</span>
<span class="cp">#define pcci_st_latency		pcci_info_1.pcci1_bits.store_latency</span>
<span class="cp">#define pcci_stride		pcci_info_1.pcci1_bits.stride</span>
<span class="cp">#define pcci_line_size		pcci_info_1.pcci1_bits.line_size</span>
<span class="cp">#define pcci_assoc		pcci_info_1.pcci1_bits.associativity</span>
<span class="cp">#define pcci_cache_attr		pcci_info_1.pcci1_bits.at</span>
<span class="cp">#define pcci_unified		pcci_info_1.pcci1_bits.u</span>
<span class="cp">#define pcci_tag_msb		pcci_info_2.pcci2_bits.tag_ms_bit</span>
<span class="cp">#define pcci_tag_lsb		pcci_info_2.pcci2_bits.tag_ls_bit</span>
<span class="cp">#define pcci_alias_boundary	pcci_info_2.pcci2_bits.alias_boundary</span>
<span class="cp">#define pcci_cache_size		pcci_info_2.pcci2_bits.cache_size</span>



<span class="cm">/* Possible values for cache attributes */</span>

<span class="cp">#define PAL_CACHE_ATTR_WT		0	</span><span class="cm">/* Write through cache */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_ATTR_WB		1	</span><span class="cm">/* Write back cache */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_ATTR_WT_OR_WB		2	</span><span class="cm">/* Either write thru or write</span>
<span class="cm">						 * back depending on TLB</span>
<span class="cm">						 * memory attributes</span>
<span class="cm">						 */</span><span class="cp"></span>


<span class="cm">/* Possible values for cache hints */</span>

<span class="cp">#define PAL_CACHE_HINT_TEMP_1		0	</span><span class="cm">/* Temporal level 1 */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_HINT_NTEMP_1		1	</span><span class="cm">/* Non-temporal level 1 */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_HINT_NTEMP_ALL	3	</span><span class="cm">/* Non-temporal all levels */</span><span class="cp"></span>

<span class="cm">/* Processor cache protection  information */</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_cache_protection_element_u</span> <span class="p">{</span>
	<span class="n">u32</span>			<span class="n">pcpi_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u32</span>		<span class="n">data_bits</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span> <span class="cm">/* # data bits covered by</span>
<span class="cm">						      * each unit of protection</span>
<span class="cm">						      */</span>

				<span class="n">tagprot_lsb</span>	<span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="cm">/* Least -do- */</span>
				<span class="n">tagprot_msb</span>	<span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="cm">/* Most Sig. tag address</span>
<span class="cm">						      * bit that this</span>
<span class="cm">						      * protection covers.</span>
<span class="cm">						      */</span>
				<span class="n">prot_bits</span>	<span class="o">:</span> <span class="mi">6</span><span class="p">,</span> <span class="cm">/* # of protection bits */</span>
				<span class="n">method</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">,</span> <span class="cm">/* Protection method */</span>
				<span class="n">t_d</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span> <span class="cm">/* Indicates which part</span>
<span class="cm">						      * of the cache this</span>
<span class="cm">						      * protection encoding</span>
<span class="cm">						      * applies.</span>
<span class="cm">						      */</span>
	<span class="p">}</span> <span class="n">pcp_info</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_cache_protection_element_t</span><span class="p">;</span>

<span class="cp">#define pcpi_cache_prot_part	pcp_info.t_d</span>
<span class="cp">#define pcpi_prot_method	pcp_info.method</span>
<span class="cp">#define pcpi_prot_bits		pcp_info.prot_bits</span>
<span class="cp">#define pcpi_tagprot_msb	pcp_info.tagprot_msb</span>
<span class="cp">#define pcpi_tagprot_lsb	pcp_info.tagprot_lsb</span>
<span class="cp">#define pcpi_data_bits		pcp_info.data_bits</span>

<span class="cm">/* Processor cache part encodings */</span>
<span class="cp">#define PAL_CACHE_PROT_PART_DATA	0	</span><span class="cm">/* Data protection  */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_PROT_PART_TAG		1	</span><span class="cm">/* Tag  protection */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_PROT_PART_TAG_DATA	2	</span><span class="cm">/* Tag+data protection (tag is</span>
<span class="cm">						 * more significant )</span>
<span class="cm">						 */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_PROT_PART_DATA_TAG	3	</span><span class="cm">/* Data+tag protection (data is</span>
<span class="cm">						 * more significant )</span>
<span class="cm">						 */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_PROT_PART_MAX		6</span>


<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_cache_protection_info_s</span> <span class="p">{</span>
	<span class="n">pal_status_t</span>			<span class="n">pcpi_status</span><span class="p">;</span>
	<span class="n">pal_cache_protection_element_t</span>	<span class="n">pcp_info</span><span class="p">[</span><span class="n">PAL_CACHE_PROT_PART_MAX</span><span class="p">];</span>
<span class="p">}</span> <span class="n">pal_cache_protection_info_t</span><span class="p">;</span>


<span class="cm">/* Processor cache protection method encodings */</span>
<span class="cp">#define PAL_CACHE_PROT_METHOD_NONE		0	</span><span class="cm">/* No protection */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_PROT_METHOD_ODD_PARITY	1	</span><span class="cm">/* Odd parity */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_PROT_METHOD_EVEN_PARITY	2	</span><span class="cm">/* Even parity */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_PROT_METHOD_ECC		3	</span><span class="cm">/* ECC protection */</span><span class="cp"></span>


<span class="cm">/* Processor cache line identification in the hierarchy */</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_cache_line_id_u</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">pclid_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>		<span class="n">cache_type</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 7-0 cache type */</span>
				<span class="n">level</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 15-8 level of the</span>
<span class="cm">							 * cache in the</span>
<span class="cm">							 * hierarchy.</span>
<span class="cm">							 */</span>
				<span class="n">way</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 23-16 way in the set</span>
<span class="cm">							 */</span>
				<span class="n">part</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 31-24 part of the</span>
<span class="cm">							 * cache</span>
<span class="cm">							 */</span>
				<span class="n">reserved</span>	<span class="o">:</span> <span class="mi">32</span><span class="p">;</span>	<span class="cm">/* 63-32 is reserved*/</span>
	<span class="p">}</span> <span class="n">pclid_info_read</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>		<span class="n">cache_type</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 7-0 cache type */</span>
				<span class="n">level</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 15-8 level of the</span>
<span class="cm">							 * cache in the</span>
<span class="cm">							 * hierarchy.</span>
<span class="cm">							 */</span>
				<span class="n">way</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 23-16 way in the set</span>
<span class="cm">							 */</span>
				<span class="n">part</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 31-24 part of the</span>
<span class="cm">							 * cache</span>
<span class="cm">							 */</span>
				<span class="n">mesi</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 39-32 cache line</span>
<span class="cm">							 * state</span>
<span class="cm">							 */</span>
				<span class="n">start</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 47-40 lsb of data to</span>
<span class="cm">							 * invert</span>
<span class="cm">							 */</span>
				<span class="n">length</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* 55-48 #bits to</span>
<span class="cm">							 * invert</span>
<span class="cm">							 */</span>
				<span class="n">trigger</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">;</span>	<span class="cm">/* 63-56 Trigger error</span>
<span class="cm">							 * by doing a load</span>
<span class="cm">							 * after the write</span>
<span class="cm">							 */</span>

	<span class="p">}</span> <span class="n">pclid_info_write</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_cache_line_id_u_t</span><span class="p">;</span>

<span class="cp">#define pclid_read_part		pclid_info_read.part</span>
<span class="cp">#define pclid_read_way		pclid_info_read.way</span>
<span class="cp">#define pclid_read_level	pclid_info_read.level</span>
<span class="cp">#define pclid_read_cache_type	pclid_info_read.cache_type</span>

<span class="cp">#define pclid_write_trigger	pclid_info_write.trigger</span>
<span class="cp">#define pclid_write_length	pclid_info_write.length</span>
<span class="cp">#define pclid_write_start	pclid_info_write.start</span>
<span class="cp">#define pclid_write_mesi	pclid_info_write.mesi</span>
<span class="cp">#define pclid_write_part	pclid_info_write.part</span>
<span class="cp">#define pclid_write_way		pclid_info_write.way</span>
<span class="cp">#define pclid_write_level	pclid_info_write.level</span>
<span class="cp">#define pclid_write_cache_type	pclid_info_write.cache_type</span>

<span class="cm">/* Processor cache line part encodings */</span>
<span class="cp">#define PAL_CACHE_LINE_ID_PART_DATA		0	</span><span class="cm">/* Data */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_LINE_ID_PART_TAG		1	</span><span class="cm">/* Tag */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_LINE_ID_PART_DATA_PROT	2	</span><span class="cm">/* Data protection */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_LINE_ID_PART_TAG_PROT		3	</span><span class="cm">/* Tag protection */</span><span class="cp"></span>
<span class="cp">#define PAL_CACHE_LINE_ID_PART_DATA_TAG_PROT	4	</span><span class="cm">/* Data+tag</span>
<span class="cm">							 * protection</span>
<span class="cm">							 */</span><span class="cp"></span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_cache_line_info_s</span> <span class="p">{</span>
	<span class="n">pal_status_t</span>		<span class="n">pcli_status</span><span class="p">;</span>		<span class="cm">/* Return status of the read cache line</span>
<span class="cm">							 * info call.</span>
<span class="cm">							 */</span>
	<span class="n">u64</span>			<span class="n">pcli_data</span><span class="p">;</span>		<span class="cm">/* 64-bit data, tag, protection bits .. */</span>
	<span class="n">u64</span>			<span class="n">pcli_data_len</span><span class="p">;</span>		<span class="cm">/* data length in bits */</span>
	<span class="n">pal_cache_line_state_t</span>	<span class="n">pcli_cache_line_state</span><span class="p">;</span>	<span class="cm">/* mesi state */</span>

<span class="p">}</span> <span class="n">pal_cache_line_info_t</span><span class="p">;</span>


<span class="cm">/* Machine Check related crap */</span>

<span class="cm">/* Pending event status bits  */</span>
<span class="k">typedef</span> <span class="n">u64</span>					<span class="n">pal_mc_pending_events_t</span><span class="p">;</span>

<span class="cp">#define PAL_MC_PENDING_MCA			(1 &lt;&lt; 0)</span>
<span class="cp">#define PAL_MC_PENDING_INIT			(1 &lt;&lt; 1)</span>

<span class="cm">/* Error information type */</span>
<span class="k">typedef</span> <span class="n">u64</span>					<span class="n">pal_mc_info_index_t</span><span class="p">;</span>

<span class="cp">#define PAL_MC_INFO_PROCESSOR			0	</span><span class="cm">/* Processor */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_INFO_CACHE_CHECK			1	</span><span class="cm">/* Cache check */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_INFO_TLB_CHECK			2	</span><span class="cm">/* Tlb check */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_INFO_BUS_CHECK			3	</span><span class="cm">/* Bus check */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_INFO_REQ_ADDR			4	</span><span class="cm">/* Requestor address */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_INFO_RESP_ADDR			5	</span><span class="cm">/* Responder address */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_INFO_TARGET_ADDR			6	</span><span class="cm">/* Target address */</span><span class="cp"></span>
<span class="cp">#define PAL_MC_INFO_IMPL_DEP			7	</span><span class="cm">/* Implementation</span>
<span class="cm">							 * dependent</span>
<span class="cm">							 */</span><span class="cp"></span>

<span class="cp">#define PAL_TLB_CHECK_OP_PURGE			8</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_process_state_info_s</span> <span class="p">{</span>
	<span class="n">u64</span>		<span class="n">reserved1</span>	<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
			<span class="n">rz</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* PAL_CHECK processor</span>
<span class="cm">						 * rendezvous</span>
<span class="cm">						 * successful.</span>
<span class="cm">						 */</span>

			<span class="n">ra</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* PAL_CHECK attempted</span>
<span class="cm">						 * a rendezvous.</span>
<span class="cm">						 */</span>
			<span class="n">me</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Distinct multiple</span>
<span class="cm">						 * errors occurred</span>
<span class="cm">						 */</span>

			<span class="n">mn</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Min. state save</span>
<span class="cm">						 * area has been</span>
<span class="cm">						 * registered with PAL</span>
<span class="cm">						 */</span>

			<span class="n">sy</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Storage integrity</span>
<span class="cm">						 * synched</span>
<span class="cm">						 */</span>


			<span class="n">co</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Continuable */</span>
			<span class="n">ci</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* MC isolated */</span>
			<span class="n">us</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Uncontained storage</span>
<span class="cm">						 * damage.</span>
<span class="cm">						 */</span>


			<span class="n">hd</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Non-essential hw</span>
<span class="cm">						 * lost (no loss of</span>
<span class="cm">						 * functionality)</span>
<span class="cm">						 * causing the</span>
<span class="cm">						 * processor to run in</span>
<span class="cm">						 * degraded mode.</span>
<span class="cm">						 */</span>

			<span class="n">tl</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* 1 =&gt; MC occurred</span>
<span class="cm">						 * after an instr was</span>
<span class="cm">						 * executed but before</span>
<span class="cm">						 * the trap that</span>
<span class="cm">						 * resulted from instr</span>
<span class="cm">						 * execution was</span>
<span class="cm">						 * generated.</span>
<span class="cm">						 * (Trap Lost )</span>
<span class="cm">						 */</span>
			<span class="n">mi</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* More information available</span>
<span class="cm">						 * call PAL_MC_ERROR_INFO</span>
<span class="cm">						 */</span>
			<span class="n">pi</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Precise instruction pointer */</span>
			<span class="n">pm</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Precise min-state save area */</span>

			<span class="n">dy</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Processor dynamic</span>
<span class="cm">						 * state valid</span>
<span class="cm">						 */</span>


			<span class="n">in</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* 0 = MC, 1 = INIT */</span>
			<span class="n">rs</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* RSE valid */</span>
			<span class="n">cm</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* MC corrected */</span>
			<span class="n">ex</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* MC is expected */</span>
			<span class="n">cr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Control regs valid*/</span>
			<span class="n">pc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Perf cntrs valid */</span>
			<span class="n">dr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Debug regs valid */</span>
			<span class="n">tr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Translation regs</span>
<span class="cm">						 * valid</span>
<span class="cm">						 */</span>
			<span class="n">rr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Region regs valid */</span>
			<span class="n">ar</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* App regs valid */</span>
			<span class="n">br</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Branch regs valid */</span>
			<span class="n">pr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Predicate registers</span>
<span class="cm">						 * valid</span>
<span class="cm">						 */</span>

			<span class="n">fp</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* fp registers valid*/</span>
			<span class="n">b1</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Preserved bank one</span>
<span class="cm">						 * general registers</span>
<span class="cm">						 * are valid</span>
<span class="cm">						 */</span>
			<span class="n">b0</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Preserved bank zero</span>
<span class="cm">						 * general registers</span>
<span class="cm">						 * are valid</span>
<span class="cm">						 */</span>
			<span class="n">gr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* General registers</span>
<span class="cm">						 * are valid</span>
<span class="cm">						 * (excl. banked regs)</span>
<span class="cm">						 */</span>
			<span class="n">dsize</span>		<span class="o">:</span> <span class="mi">16</span><span class="p">,</span>	<span class="cm">/* size of dynamic</span>
<span class="cm">						 * state returned</span>
<span class="cm">						 * by the processor</span>
<span class="cm">						 */</span>

			<span class="n">se</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Shared error.  MCA in a</span>
<span class="cm">						   shared structure */</span>
			<span class="n">reserved2</span>	<span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
			<span class="n">cc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Cache check */</span>
			<span class="n">tc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* TLB check */</span>
			<span class="n">bc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Bus check */</span>
			<span class="n">rc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Register file check */</span>
			<span class="n">uc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Uarch check */</span>

<span class="p">}</span> <span class="n">pal_processor_state_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_cache_check_info_s</span> <span class="p">{</span>
	<span class="n">u64</span>		<span class="n">op</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Type of cache</span>
<span class="cm">						 * operation that</span>
<span class="cm">						 * caused the machine</span>
<span class="cm">						 * check.</span>
<span class="cm">						 */</span>
			<span class="n">level</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Cache level */</span>
			<span class="n">reserved1</span>	<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
			<span class="n">dl</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Failure in data part</span>
<span class="cm">						 * of cache line</span>
<span class="cm">						 */</span>
			<span class="n">tl</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Failure in tag part</span>
<span class="cm">						 * of cache line</span>
<span class="cm">						 */</span>
			<span class="n">dc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Failure in dcache */</span>
			<span class="n">ic</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Failure in icache */</span>
			<span class="n">mesi</span>		<span class="o">:</span> <span class="mi">3</span><span class="p">,</span>	<span class="cm">/* Cache line state */</span>
			<span class="n">mv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* mesi valid */</span>
			<span class="n">way</span>		<span class="o">:</span> <span class="mi">5</span><span class="p">,</span>	<span class="cm">/* Way in which the</span>
<span class="cm">						 * error occurred</span>
<span class="cm">						 */</span>
			<span class="n">wiv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Way field valid */</span>
			<span class="n">reserved2</span>	<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">dp</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Data poisoned on MBE */</span>
			<span class="n">reserved3</span>	<span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
			<span class="n">hlth</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Health indicator */</span>

			<span class="n">index</span>		<span class="o">:</span> <span class="mi">20</span><span class="p">,</span>	<span class="cm">/* Cache line index */</span>
			<span class="n">reserved4</span>	<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>

			<span class="n">is</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* instruction set (1 == ia32) */</span>
			<span class="n">iv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* instruction set field valid */</span>
			<span class="n">pl</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* privilege level */</span>
			<span class="n">pv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* privilege level field valid */</span>
			<span class="n">mcc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Machine check corrected */</span>
			<span class="n">tv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Target address</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">rq</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Requester identifier</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">rp</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Responder identifier</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">pi</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Precise instruction pointer</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
<span class="p">}</span> <span class="n">pal_cache_check_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_tlb_check_info_s</span> <span class="p">{</span>

	<span class="n">u64</span>		<span class="n">tr_slot</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Slot# of TR where</span>
<span class="cm">						 * error occurred</span>
<span class="cm">						 */</span>
			<span class="n">trv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* tr_slot field is valid */</span>
			<span class="n">reserved1</span>	<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">level</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* TLB level where failure occurred */</span>
			<span class="n">reserved2</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
			<span class="n">dtr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Fail in data TR */</span>
			<span class="n">itr</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Fail in inst TR */</span>
			<span class="n">dtc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Fail in data TC */</span>
			<span class="n">itc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Fail in inst. TC */</span>
			<span class="n">op</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Cache operation */</span>
			<span class="n">reserved3</span>	<span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
			<span class="n">hlth</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Health indicator */</span>
			<span class="n">reserved4</span>	<span class="o">:</span> <span class="mi">22</span><span class="p">,</span>

			<span class="n">is</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* instruction set (1 == ia32) */</span>
			<span class="n">iv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* instruction set field valid */</span>
			<span class="n">pl</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* privilege level */</span>
			<span class="n">pv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* privilege level field valid */</span>
			<span class="n">mcc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Machine check corrected */</span>
			<span class="n">tv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Target address</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">rq</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Requester identifier</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">rp</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Responder identifier</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">pi</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Precise instruction pointer</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
<span class="p">}</span> <span class="n">pal_tlb_check_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_bus_check_info_s</span> <span class="p">{</span>
	<span class="n">u64</span>		<span class="n">size</span>		<span class="o">:</span> <span class="mi">5</span><span class="p">,</span>	<span class="cm">/* Xaction size */</span>
			<span class="n">ib</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Internal bus error */</span>
			<span class="n">eb</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* External bus error */</span>
			<span class="n">cc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Error occurred</span>
<span class="cm">						 * during cache-cache</span>
<span class="cm">						 * transfer.</span>
<span class="cm">						 */</span>
			<span class="n">type</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Bus xaction type*/</span>
			<span class="n">sev</span>		<span class="o">:</span> <span class="mi">5</span><span class="p">,</span>	<span class="cm">/* Bus error severity*/</span>
			<span class="n">hier</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Bus hierarchy level */</span>
			<span class="n">dp</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Data poisoned on MBE */</span>
			<span class="n">bsi</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Bus error status</span>
<span class="cm">						 * info</span>
<span class="cm">						 */</span>
			<span class="n">reserved2</span>	<span class="o">:</span> <span class="mi">22</span><span class="p">,</span>

			<span class="n">is</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* instruction set (1 == ia32) */</span>
			<span class="n">iv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* instruction set field valid */</span>
			<span class="n">pl</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* privilege level */</span>
			<span class="n">pv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* privilege level field valid */</span>
			<span class="n">mcc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Machine check corrected */</span>
			<span class="n">tv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Target address</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">rq</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Requester identifier</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">rp</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Responder identifier</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">pi</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Precise instruction pointer</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
<span class="p">}</span> <span class="n">pal_bus_check_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_reg_file_check_info_s</span> <span class="p">{</span>
	<span class="n">u64</span>		<span class="n">id</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Register file identifier */</span>
			<span class="n">op</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Type of register</span>
<span class="cm">						 * operation that</span>
<span class="cm">						 * caused the machine</span>
<span class="cm">						 * check.</span>
<span class="cm">						 */</span>
			<span class="n">reg_num</span>		<span class="o">:</span> <span class="mi">7</span><span class="p">,</span>	<span class="cm">/* Register number */</span>
			<span class="n">rnv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* reg_num valid */</span>
			<span class="n">reserved2</span>	<span class="o">:</span> <span class="mi">38</span><span class="p">,</span>

			<span class="n">is</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* instruction set (1 == ia32) */</span>
			<span class="n">iv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* instruction set field valid */</span>
			<span class="n">pl</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* privilege level */</span>
			<span class="n">pv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* privilege level field valid */</span>
			<span class="n">mcc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Machine check corrected */</span>
			<span class="n">reserved3</span>	<span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
			<span class="n">pi</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Precise instruction pointer</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
<span class="p">}</span> <span class="n">pal_reg_file_check_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_uarch_check_info_s</span> <span class="p">{</span>
	<span class="n">u64</span>		<span class="n">sid</span>		<span class="o">:</span> <span class="mi">5</span><span class="p">,</span>	<span class="cm">/* Structure identification */</span>
			<span class="n">level</span>		<span class="o">:</span> <span class="mi">3</span><span class="p">,</span>	<span class="cm">/* Level of failure */</span>
			<span class="n">array_id</span>	<span class="o">:</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Array identification */</span>
			<span class="n">op</span>		<span class="o">:</span> <span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Type of</span>
<span class="cm">						 * operation that</span>
<span class="cm">						 * caused the machine</span>
<span class="cm">						 * check.</span>
<span class="cm">						 */</span>
			<span class="n">way</span>		<span class="o">:</span> <span class="mi">6</span><span class="p">,</span>	<span class="cm">/* Way of structure */</span>
			<span class="n">wv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* way valid */</span>
			<span class="n">xv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* index valid */</span>
			<span class="n">reserved1</span>	<span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
			<span class="n">hlth</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Health indicator */</span>
			<span class="n">index</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Index or set of the uarch</span>
<span class="cm">						 * structure that failed.</span>
<span class="cm">						 */</span>
			<span class="n">reserved2</span>	<span class="o">:</span> <span class="mi">24</span><span class="p">,</span>

			<span class="n">is</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* instruction set (1 == ia32) */</span>
			<span class="n">iv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* instruction set field valid */</span>
			<span class="n">pl</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* privilege level */</span>
			<span class="n">pv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* privilege level field valid */</span>
			<span class="n">mcc</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Machine check corrected */</span>
			<span class="n">tv</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Target address</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">rq</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Requester identifier</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">rp</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Responder identifier</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
			<span class="n">pi</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* Precise instruction pointer</span>
<span class="cm">						 * structure is valid</span>
<span class="cm">						 */</span>
<span class="p">}</span> <span class="n">pal_uarch_check_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_mc_error_info_u</span> <span class="p">{</span>
	<span class="n">u64</span>				<span class="n">pmei_data</span><span class="p">;</span>
	<span class="n">pal_processor_state_info_t</span>	<span class="n">pme_processor</span><span class="p">;</span>
	<span class="n">pal_cache_check_info_t</span>		<span class="n">pme_cache</span><span class="p">;</span>
	<span class="n">pal_tlb_check_info_t</span>		<span class="n">pme_tlb</span><span class="p">;</span>
	<span class="n">pal_bus_check_info_t</span>		<span class="n">pme_bus</span><span class="p">;</span>
	<span class="n">pal_reg_file_check_info_t</span>	<span class="n">pme_reg_file</span><span class="p">;</span>
	<span class="n">pal_uarch_check_info_t</span>		<span class="n">pme_uarch</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_mc_error_info_t</span><span class="p">;</span>

<span class="cp">#define pmci_proc_unknown_check			pme_processor.uc</span>
<span class="cp">#define pmci_proc_bus_check			pme_processor.bc</span>
<span class="cp">#define pmci_proc_tlb_check			pme_processor.tc</span>
<span class="cp">#define pmci_proc_cache_check			pme_processor.cc</span>
<span class="cp">#define pmci_proc_dynamic_state_size		pme_processor.dsize</span>
<span class="cp">#define pmci_proc_gpr_valid			pme_processor.gr</span>
<span class="cp">#define pmci_proc_preserved_bank0_gpr_valid	pme_processor.b0</span>
<span class="cp">#define pmci_proc_preserved_bank1_gpr_valid	pme_processor.b1</span>
<span class="cp">#define pmci_proc_fp_valid			pme_processor.fp</span>
<span class="cp">#define pmci_proc_predicate_regs_valid		pme_processor.pr</span>
<span class="cp">#define pmci_proc_branch_regs_valid		pme_processor.br</span>
<span class="cp">#define pmci_proc_app_regs_valid		pme_processor.ar</span>
<span class="cp">#define pmci_proc_region_regs_valid		pme_processor.rr</span>
<span class="cp">#define pmci_proc_translation_regs_valid	pme_processor.tr</span>
<span class="cp">#define pmci_proc_debug_regs_valid		pme_processor.dr</span>
<span class="cp">#define pmci_proc_perf_counters_valid		pme_processor.pc</span>
<span class="cp">#define pmci_proc_control_regs_valid		pme_processor.cr</span>
<span class="cp">#define pmci_proc_machine_check_expected	pme_processor.ex</span>
<span class="cp">#define pmci_proc_machine_check_corrected	pme_processor.cm</span>
<span class="cp">#define pmci_proc_rse_valid			pme_processor.rs</span>
<span class="cp">#define pmci_proc_machine_check_or_init		pme_processor.in</span>
<span class="cp">#define pmci_proc_dynamic_state_valid		pme_processor.dy</span>
<span class="cp">#define pmci_proc_operation			pme_processor.op</span>
<span class="cp">#define pmci_proc_trap_lost			pme_processor.tl</span>
<span class="cp">#define pmci_proc_hardware_damage		pme_processor.hd</span>
<span class="cp">#define pmci_proc_uncontained_storage_damage	pme_processor.us</span>
<span class="cp">#define pmci_proc_machine_check_isolated	pme_processor.ci</span>
<span class="cp">#define pmci_proc_continuable			pme_processor.co</span>
<span class="cp">#define pmci_proc_storage_intergrity_synced	pme_processor.sy</span>
<span class="cp">#define pmci_proc_min_state_save_area_regd	pme_processor.mn</span>
<span class="cp">#define	pmci_proc_distinct_multiple_errors	pme_processor.me</span>
<span class="cp">#define pmci_proc_pal_attempted_rendezvous	pme_processor.ra</span>
<span class="cp">#define pmci_proc_pal_rendezvous_complete	pme_processor.rz</span>


<span class="cp">#define pmci_cache_level			pme_cache.level</span>
<span class="cp">#define pmci_cache_line_state			pme_cache.mesi</span>
<span class="cp">#define pmci_cache_line_state_valid		pme_cache.mv</span>
<span class="cp">#define pmci_cache_line_index			pme_cache.index</span>
<span class="cp">#define pmci_cache_instr_cache_fail		pme_cache.ic</span>
<span class="cp">#define pmci_cache_data_cache_fail		pme_cache.dc</span>
<span class="cp">#define pmci_cache_line_tag_fail		pme_cache.tl</span>
<span class="cp">#define pmci_cache_line_data_fail		pme_cache.dl</span>
<span class="cp">#define pmci_cache_operation			pme_cache.op</span>
<span class="cp">#define pmci_cache_way_valid			pme_cache.wv</span>
<span class="cp">#define pmci_cache_target_address_valid		pme_cache.tv</span>
<span class="cp">#define pmci_cache_way				pme_cache.way</span>
<span class="cp">#define pmci_cache_mc				pme_cache.mc</span>

<span class="cp">#define pmci_tlb_instr_translation_cache_fail	pme_tlb.itc</span>
<span class="cp">#define pmci_tlb_data_translation_cache_fail	pme_tlb.dtc</span>
<span class="cp">#define pmci_tlb_instr_translation_reg_fail	pme_tlb.itr</span>
<span class="cp">#define pmci_tlb_data_translation_reg_fail	pme_tlb.dtr</span>
<span class="cp">#define pmci_tlb_translation_reg_slot		pme_tlb.tr_slot</span>
<span class="cp">#define pmci_tlb_mc				pme_tlb.mc</span>

<span class="cp">#define pmci_bus_status_info			pme_bus.bsi</span>
<span class="cp">#define pmci_bus_req_address_valid		pme_bus.rq</span>
<span class="cp">#define pmci_bus_resp_address_valid		pme_bus.rp</span>
<span class="cp">#define pmci_bus_target_address_valid		pme_bus.tv</span>
<span class="cp">#define pmci_bus_error_severity			pme_bus.sev</span>
<span class="cp">#define pmci_bus_transaction_type		pme_bus.type</span>
<span class="cp">#define pmci_bus_cache_cache_transfer		pme_bus.cc</span>
<span class="cp">#define pmci_bus_transaction_size		pme_bus.size</span>
<span class="cp">#define pmci_bus_internal_error			pme_bus.ib</span>
<span class="cp">#define pmci_bus_external_error			pme_bus.eb</span>
<span class="cp">#define pmci_bus_mc				pme_bus.mc</span>

<span class="cm">/*</span>
<span class="cm"> * NOTE: this min_state_save area struct only includes the 1KB</span>
<span class="cm"> * architectural state save area.  The other 3 KB is scratch space</span>
<span class="cm"> * for PAL.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_min_state_area_s</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">pmsa_nat_bits</span><span class="p">;</span>		<span class="cm">/* nat bits for saved GRs  */</span>
	<span class="n">u64</span>	<span class="n">pmsa_gr</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>		<span class="cm">/* GR1	- GR15		   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_bank0_gr</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>	<span class="cm">/* GR16 - GR31		   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_bank1_gr</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>	<span class="cm">/* GR16 - GR31		   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_pr</span><span class="p">;</span>		<span class="cm">/* predicate registers	   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_br0</span><span class="p">;</span>		<span class="cm">/* branch register 0	   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_rsc</span><span class="p">;</span>		<span class="cm">/* ar.rsc		   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_iip</span><span class="p">;</span>		<span class="cm">/* cr.iip		   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_ipsr</span><span class="p">;</span>		<span class="cm">/* cr.ipsr		   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_ifs</span><span class="p">;</span>		<span class="cm">/* cr.ifs		   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_xip</span><span class="p">;</span>		<span class="cm">/* previous iip		   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_xpsr</span><span class="p">;</span>		<span class="cm">/* previous psr		   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_xfs</span><span class="p">;</span>		<span class="cm">/* previous ifs		   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_br1</span><span class="p">;</span>		<span class="cm">/* branch register 1	   */</span>
	<span class="n">u64</span>	<span class="n">pmsa_reserved</span><span class="p">[</span><span class="mi">70</span><span class="p">];</span>	<span class="cm">/* pal_min_state_area should total to 1KB */</span>
<span class="p">}</span> <span class="n">pal_min_state_area_t</span><span class="p">;</span>


<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * A zero status value indicates call completed without error.</span>
<span class="cm">	 * A negative status value indicates reason of call failure.</span>
<span class="cm">	 * A positive status value indicates success but an</span>
<span class="cm">	 * informational value should be printed (e.g., &quot;reboot for</span>
<span class="cm">	 * change to take effect&quot;).</span>
<span class="cm">	 */</span>
	<span class="n">s64</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">v0</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">v1</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">v2</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Note: Currently unused PAL arguments are generally labeled</span>
<span class="cm"> * &quot;reserved&quot; so the value specified in the PAL documentation</span>
<span class="cm"> * (generally 0) MUST be passed.  Reserved parameters are not optional</span>
<span class="cm"> * parameters.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">ia64_pal_call_static</span> <span class="p">(</span><span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">ia64_pal_call_stacked</span> <span class="p">(</span><span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">ia64_pal_call_phys_static</span> <span class="p">(</span><span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">ia64_pal_call_phys_stacked</span> <span class="p">(</span><span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_save_scratch_fpregs</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ia64_fpreg</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_load_scratch_fpregs</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ia64_fpreg</span> <span class="o">*</span><span class="p">);</span>

<span class="cp">#define PAL_CALL(iprv,a0,a1,a2,a3) do {			\</span>
<span class="cp">	struct ia64_fpreg fr[6];			\</span>
<span class="cp">	ia64_save_scratch_fpregs(fr);			\</span>
<span class="cp">	iprv = ia64_pal_call_static(a0, a1, a2, a3);	\</span>
<span class="cp">	ia64_load_scratch_fpregs(fr);			\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define PAL_CALL_STK(iprv,a0,a1,a2,a3) do {		\</span>
<span class="cp">	struct ia64_fpreg fr[6];			\</span>
<span class="cp">	ia64_save_scratch_fpregs(fr);			\</span>
<span class="cp">	iprv = ia64_pal_call_stacked(a0, a1, a2, a3);	\</span>
<span class="cp">	ia64_load_scratch_fpregs(fr);			\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define PAL_CALL_PHYS(iprv,a0,a1,a2,a3) do {			\</span>
<span class="cp">	struct ia64_fpreg fr[6];				\</span>
<span class="cp">	ia64_save_scratch_fpregs(fr);				\</span>
<span class="cp">	iprv = ia64_pal_call_phys_static(a0, a1, a2, a3);	\</span>
<span class="cp">	ia64_load_scratch_fpregs(fr);				\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define PAL_CALL_PHYS_STK(iprv,a0,a1,a2,a3) do {		\</span>
<span class="cp">	struct ia64_fpreg fr[6];				\</span>
<span class="cp">	ia64_save_scratch_fpregs(fr);				\</span>
<span class="cp">	iprv = ia64_pal_call_phys_stacked(a0, a1, a2, a3);	\</span>
<span class="cp">	ia64_load_scratch_fpregs(fr);				\</span>
<span class="cp">} while (0)</span>

<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">ia64_pal_handler</span><span class="p">)</span> <span class="p">(</span><span class="n">u64</span><span class="p">,</span> <span class="p">...);</span>
<span class="k">extern</span> <span class="n">ia64_pal_handler</span> <span class="n">ia64_pal</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_pal_handler_init</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">ia64_pal_handler</span> <span class="n">ia64_pal</span><span class="p">;</span>

<span class="k">extern</span> <span class="n">pal_cache_config_info_t</span>		<span class="n">l0d_cache_config_info</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">pal_cache_config_info_t</span>		<span class="n">l0i_cache_config_info</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">pal_cache_config_info_t</span>		<span class="n">l1_cache_config_info</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">pal_cache_config_info_t</span>		<span class="n">l2_cache_config_info</span><span class="p">;</span>

<span class="k">extern</span> <span class="n">pal_cache_protection_info_t</span>	<span class="n">l0d_cache_protection_info</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">pal_cache_protection_info_t</span>	<span class="n">l0i_cache_protection_info</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">pal_cache_protection_info_t</span>	<span class="n">l1_cache_protection_info</span><span class="p">;</span>
<span class="k">extern</span> <span class="n">pal_cache_protection_info_t</span>	<span class="n">l2_cache_protection_info</span><span class="p">;</span>

<span class="k">extern</span> <span class="n">pal_cache_config_info_t</span>		<span class="n">pal_cache_config_info_get</span><span class="p">(</span><span class="n">pal_cache_level_t</span><span class="p">,</span>
								  <span class="n">pal_cache_type_t</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">pal_cache_protection_info_t</span>	<span class="n">pal_cache_protection_info_get</span><span class="p">(</span><span class="n">pal_cache_level_t</span><span class="p">,</span>
								      <span class="n">pal_cache_type_t</span><span class="p">);</span>


<span class="k">extern</span> <span class="kt">void</span>				<span class="n">pal_error</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>


<span class="cm">/* Useful wrappers for the current list of pal procedures */</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_bus_features_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">pal_bus_features_val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">pbf_reserved1</span>				<span class="o">:</span>	<span class="mi">29</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_req_bus_parking</span>			<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_bus_lock_mask</span>			<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_enable_half_xfer_rate</span>		<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_reserved2</span>				<span class="o">:</span>	<span class="mi">20</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_enable_shared_line_replace</span>		<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_enable_exclusive_line_replace</span>	<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_disable_xaction_queueing</span>		<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_disable_resp_err_check</span>		<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_disable_berr_check</span>			<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_disable_bus_req_internal_err_signal</span>	<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_disable_bus_req_berr_signal</span>		<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_disable_bus_init_event_check</span>	<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_disable_bus_init_event_signal</span>	<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_disable_bus_addr_err_check</span>		<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_disable_bus_addr_err_signal</span>		<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pbf_disable_bus_data_err_check</span>		<span class="o">:</span>	<span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pal_bus_features_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_bus_features_u_t</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">pal_bus_features_print</span> <span class="p">(</span><span class="n">u64</span><span class="p">);</span>

<span class="cm">/* Provide information about configurable processor bus features */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_bus_get_features</span> <span class="p">(</span><span class="n">pal_bus_features_u_t</span> <span class="o">*</span><span class="n">features_avail</span><span class="p">,</span>
			   <span class="n">pal_bus_features_u_t</span> <span class="o">*</span><span class="n">features_status</span><span class="p">,</span>
			   <span class="n">pal_bus_features_u_t</span> <span class="o">*</span><span class="n">features_control</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_PHYS</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_BUS_GET_FEATURES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">features_avail</span><span class="p">)</span>
		<span class="n">features_avail</span><span class="o">-&gt;</span><span class="n">pal_bus_features_val</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">features_status</span><span class="p">)</span>
		<span class="n">features_status</span><span class="o">-&gt;</span><span class="n">pal_bus_features_val</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">features_control</span><span class="p">)</span>
		<span class="n">features_control</span><span class="o">-&gt;</span><span class="n">pal_bus_features_val</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Enables/disables specific processor bus features */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_bus_set_features</span> <span class="p">(</span><span class="n">pal_bus_features_u_t</span> <span class="n">feature_select</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_PHYS</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_BUS_SET_FEATURES</span><span class="p">,</span> <span class="n">feature_select</span><span class="p">.</span><span class="n">pal_bus_features_val</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Get detailed cache information */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_cache_config_info</span> <span class="p">(</span><span class="n">u64</span> <span class="n">cache_level</span><span class="p">,</span> <span class="n">u64</span> <span class="n">cache_type</span><span class="p">,</span> <span class="n">pal_cache_config_info_t</span> <span class="o">*</span><span class="n">conf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>

	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_CACHE_INFO</span><span class="p">,</span> <span class="n">cache_level</span><span class="p">,</span> <span class="n">cache_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">iprv</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">conf</span><span class="o">-&gt;</span><span class="n">pcci_status</span>                 <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
		<span class="n">conf</span><span class="o">-&gt;</span><span class="n">pcci_info_1</span><span class="p">.</span><span class="n">pcci1_data</span>      <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
		<span class="n">conf</span><span class="o">-&gt;</span><span class="n">pcci_info_2</span><span class="p">.</span><span class="n">pcci2_data</span>      <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
		<span class="n">conf</span><span class="o">-&gt;</span><span class="n">pcci_reserved</span>               <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>

<span class="p">}</span>

<span class="cm">/* Get detailed cche protection information */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_cache_prot_info</span> <span class="p">(</span><span class="n">u64</span> <span class="n">cache_level</span><span class="p">,</span> <span class="n">u64</span> <span class="n">cache_type</span><span class="p">,</span> <span class="n">pal_cache_protection_info_t</span> <span class="o">*</span><span class="n">prot</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>

	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_CACHE_PROT_INFO</span><span class="p">,</span> <span class="n">cache_level</span><span class="p">,</span> <span class="n">cache_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">iprv</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">prot</span><span class="o">-&gt;</span><span class="n">pcpi_status</span>           <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
		<span class="n">prot</span><span class="o">-&gt;</span><span class="n">pcp_info</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pcpi_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">;</span>
		<span class="n">prot</span><span class="o">-&gt;</span><span class="n">pcp_info</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">pcpi_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">prot</span><span class="o">-&gt;</span><span class="n">pcp_info</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">pcpi_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">;</span>
		<span class="n">prot</span><span class="o">-&gt;</span><span class="n">pcp_info</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">pcpi_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">prot</span><span class="o">-&gt;</span><span class="n">pcp_info</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="n">pcpi_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">;</span>
		<span class="n">prot</span><span class="o">-&gt;</span><span class="n">pcp_info</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="n">pcpi_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Flush the processor instruction or data caches.  *PROGRESS must be</span>
<span class="cm"> * initialized to zero before calling this for the first time..</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_cache_flush</span> <span class="p">(</span><span class="n">u64</span> <span class="n">cache_type</span><span class="p">,</span> <span class="n">u64</span> <span class="n">invalidate</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">progress</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">vector</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_CACHE_FLUSH</span><span class="p">,</span> <span class="n">cache_type</span><span class="p">,</span> <span class="n">invalidate</span><span class="p">,</span> <span class="o">*</span><span class="n">progress</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vector</span><span class="p">)</span>
		<span class="o">*</span><span class="n">vector</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="o">*</span><span class="n">progress</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Initialize the processor controlled caches */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_cache_init</span> <span class="p">(</span><span class="n">u64</span> <span class="n">level</span><span class="p">,</span> <span class="n">u64</span> <span class="n">cache_type</span><span class="p">,</span> <span class="n">u64</span> <span class="n">rest</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_CACHE_INIT</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">cache_type</span><span class="p">,</span> <span class="n">rest</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Initialize the tags and data of a data or unified cache line of</span>
<span class="cm"> * processor controlled cache to known values without the availability</span>
<span class="cm"> * of backing memory.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_cache_line_init</span> <span class="p">(</span><span class="n">u64</span> <span class="n">physical_addr</span><span class="p">,</span> <span class="n">u64</span> <span class="n">data_value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_CACHE_LINE_INIT</span><span class="p">,</span> <span class="n">physical_addr</span><span class="p">,</span> <span class="n">data_value</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Read the data and tag of a processor controlled cache line for diags */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_cache_read</span> <span class="p">(</span><span class="n">pal_cache_line_id_u_t</span> <span class="n">line_id</span><span class="p">,</span> <span class="n">u64</span> <span class="n">physical_addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_PHYS_STK</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_CACHE_READ</span><span class="p">,</span> <span class="n">line_id</span><span class="p">.</span><span class="n">pclid_data</span><span class="p">,</span>
				<span class="n">physical_addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Return summary information about the hierarchy of caches controlled by the processor */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">long</span> <span class="nf">ia64_pal_cache_summary</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">cache_levels</span><span class="p">,</span>
						<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">unique_caches</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_CACHE_SUMMARY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cache_levels</span><span class="p">)</span>
		<span class="o">*</span><span class="n">cache_levels</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">unique_caches</span><span class="p">)</span>
		<span class="o">*</span><span class="n">unique_caches</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Write the data and tag of a processor-controlled cache line for diags */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_cache_write</span> <span class="p">(</span><span class="n">pal_cache_line_id_u_t</span> <span class="n">line_id</span><span class="p">,</span> <span class="n">u64</span> <span class="n">physical_addr</span><span class="p">,</span> <span class="n">u64</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_PHYS_STK</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_CACHE_WRITE</span><span class="p">,</span> <span class="n">line_id</span><span class="p">.</span><span class="n">pclid_data</span><span class="p">,</span>
				<span class="n">physical_addr</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Return the parameters needed to copy relocatable PAL procedures from ROM to memory */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_copy_info</span> <span class="p">(</span><span class="n">u64</span> <span class="n">copy_type</span><span class="p">,</span> <span class="n">u64</span> <span class="n">num_procs</span><span class="p">,</span> <span class="n">u64</span> <span class="n">num_iopics</span><span class="p">,</span>
		    <span class="n">u64</span> <span class="o">*</span><span class="n">buffer_size</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">buffer_align</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_COPY_INFO</span><span class="p">,</span> <span class="n">copy_type</span><span class="p">,</span> <span class="n">num_procs</span><span class="p">,</span> <span class="n">num_iopics</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buffer_size</span><span class="p">)</span>
		<span class="o">*</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buffer_align</span><span class="p">)</span>
		<span class="o">*</span><span class="n">buffer_align</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Copy relocatable PAL procedures from ROM to memory */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_copy_pal</span> <span class="p">(</span><span class="n">u64</span> <span class="n">target_addr</span><span class="p">,</span> <span class="n">u64</span> <span class="n">alloc_size</span><span class="p">,</span> <span class="n">u64</span> <span class="n">processor</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">pal_proc_offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_COPY_PAL</span><span class="p">,</span> <span class="n">target_addr</span><span class="p">,</span> <span class="n">alloc_size</span><span class="p">,</span> <span class="n">processor</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pal_proc_offset</span><span class="p">)</span>
		<span class="o">*</span><span class="n">pal_proc_offset</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Return the number of instruction and data debug register pairs */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">long</span> <span class="nf">ia64_pal_debug_info</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">inst_regs</span><span class="p">,</span>
						<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">data_regs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_DEBUG_INFO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">inst_regs</span><span class="p">)</span>
		<span class="o">*</span><span class="n">inst_regs</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data_regs</span><span class="p">)</span>
		<span class="o">*</span><span class="n">data_regs</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef TBD</span>
<span class="cm">/* Switch from IA64-system environment to IA-32 system environment */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_enter_ia32_env</span> <span class="p">(</span><span class="n">ia32_env1</span><span class="p">,</span> <span class="n">ia32_env2</span><span class="p">,</span> <span class="n">ia32_env3</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_ENTER_IA_32_ENV</span><span class="p">,</span> <span class="n">ia32_env1</span><span class="p">,</span> <span class="n">ia32_env2</span><span class="p">,</span> <span class="n">ia32_env3</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cm">/* Get unique geographical address of this processor on its bus */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_fixed_addr</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">global_unique_addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_FIXED_ADDR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">global_unique_addr</span><span class="p">)</span>
		<span class="o">*</span><span class="n">global_unique_addr</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Get base frequency of the platform if generated by the processor */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">long</span> <span class="nf">ia64_pal_freq_base</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">platform_base_freq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_FREQ_BASE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">platform_base_freq</span><span class="p">)</span>
		<span class="o">*</span><span class="n">platform_base_freq</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Get the ratios for processor frequency, bus frequency and interval timer to</span>
<span class="cm"> * to base frequency of the platform</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_freq_ratios</span> <span class="p">(</span><span class="k">struct</span> <span class="n">pal_freq_ratio</span> <span class="o">*</span><span class="n">proc_ratio</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pal_freq_ratio</span> <span class="o">*</span><span class="n">bus_ratio</span><span class="p">,</span>
		      <span class="k">struct</span> <span class="n">pal_freq_ratio</span> <span class="o">*</span><span class="n">itc_ratio</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_FREQ_RATIOS</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">proc_ratio</span><span class="p">)</span>
		<span class="o">*</span><span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="p">)</span><span class="n">proc_ratio</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bus_ratio</span><span class="p">)</span>
		<span class="o">*</span><span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="p">)</span><span class="n">bus_ratio</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">itc_ratio</span><span class="p">)</span>
		<span class="o">*</span><span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="p">)</span><span class="n">itc_ratio</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Get the current hardware resource sharing policy of the processor</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_get_hw_policy</span> <span class="p">(</span><span class="n">u64</span> <span class="n">proc_num</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">cur_policy</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">num_impacted</span><span class="p">,</span>
			<span class="n">u64</span> <span class="o">*</span><span class="n">la</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_GET_HW_POLICY</span><span class="p">,</span> <span class="n">proc_num</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cur_policy</span><span class="p">)</span>
		<span class="o">*</span><span class="n">cur_policy</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">num_impacted</span><span class="p">)</span>
		<span class="o">*</span><span class="n">num_impacted</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">la</span><span class="p">)</span>
		<span class="o">*</span><span class="n">la</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Make the processor enter HALT or one of the implementation dependent low</span>
<span class="cm"> * power states where prefetching and execution are suspended and cache and</span>
<span class="cm"> * TLB coherency is not maintained.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_halt</span> <span class="p">(</span><span class="n">u64</span> <span class="n">halt_state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_HALT</span><span class="p">,</span> <span class="n">halt_state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_power_mgmt_info_u</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">ppmi_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
	       <span class="n">u64</span>		<span class="n">exit_latency</span>		<span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
				<span class="n">entry_latency</span>		<span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
				<span class="n">power_consumption</span>	<span class="o">:</span> <span class="mi">28</span><span class="p">,</span>
				<span class="n">im</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">co</span>			<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">reserved</span>		<span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pal_power_mgmt_info_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_power_mgmt_info_u_t</span><span class="p">;</span>

<span class="cm">/* Return information about processor&#39;s optional power management capabilities. */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_halt_info</span> <span class="p">(</span><span class="n">pal_power_mgmt_info_u_t</span> <span class="o">*</span><span class="n">power_buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_STK</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_HALT_INFO</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">power_buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Get the current P-state information */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_get_pstate</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">pstate_index</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_STK</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_GET_PSTATE</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="o">*</span><span class="n">pstate_index</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Set the P-state */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_set_pstate</span> <span class="p">(</span><span class="n">u64</span> <span class="n">pstate_index</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_STK</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_SET_PSTATE</span><span class="p">,</span> <span class="n">pstate_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Processor branding information*/</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_get_brand_info</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">brand_info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_STK</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_BRAND_INFO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">u64</span><span class="p">)</span><span class="n">brand_info</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Cause the processor to enter LIGHT HALT state, where prefetching and execution are</span>
<span class="cm"> * suspended, but cache and TLB coherency is maintained.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_halt_light</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_HALT_LIGHT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Clear all the processor error logging   registers and reset the indicator that allows</span>
<span class="cm"> * the error logging registers to be written. This procedure also checks the pending</span>
<span class="cm"> * machine check bit and pending INIT bit and reports their states.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mc_clear_log</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">pending_vector</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MC_CLEAR_LOG</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pending_vector</span><span class="p">)</span>
		<span class="o">*</span><span class="n">pending_vector</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Ensure that all outstanding transactions in a processor are completed or that any</span>
<span class="cm"> * MCA due to thes outstanding transaction is taken.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mc_drain</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MC_DRAIN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Return the machine check dynamic processor state */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mc_dynamic_state</span> <span class="p">(</span><span class="n">u64</span> <span class="n">info_type</span><span class="p">,</span> <span class="n">u64</span> <span class="n">dy_buffer</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MC_DYNAMIC_STATE</span><span class="p">,</span> <span class="n">info_type</span><span class="p">,</span> <span class="n">dy_buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">)</span>
		<span class="o">*</span><span class="n">size</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Return processor machine check information */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mc_error_info</span> <span class="p">(</span><span class="n">u64</span> <span class="n">info_index</span><span class="p">,</span> <span class="n">u64</span> <span class="n">type_index</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">size</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">error_info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MC_ERROR_INFO</span><span class="p">,</span> <span class="n">info_index</span><span class="p">,</span> <span class="n">type_index</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">size</span><span class="p">)</span>
		<span class="o">*</span><span class="n">size</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">error_info</span><span class="p">)</span>
		<span class="o">*</span><span class="n">error_info</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Injects the requested processor error or returns info on</span>
<span class="cm"> * supported injection capabilities for current processor implementation</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mc_error_inject_phys</span> <span class="p">(</span><span class="n">u64</span> <span class="n">err_type_info</span><span class="p">,</span> <span class="n">u64</span> <span class="n">err_struct_info</span><span class="p">,</span>
			<span class="n">u64</span> <span class="n">err_data_buffer</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">capabilities</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">resources</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_PHYS_STK</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MC_ERROR_INJECT</span><span class="p">,</span> <span class="n">err_type_info</span><span class="p">,</span>
			  <span class="n">err_struct_info</span><span class="p">,</span> <span class="n">err_data_buffer</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">capabilities</span><span class="p">)</span>
		<span class="o">*</span><span class="n">capabilities</span><span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">resources</span><span class="p">)</span>
		<span class="o">*</span><span class="n">resources</span><span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mc_error_inject_virt</span> <span class="p">(</span><span class="n">u64</span> <span class="n">err_type_info</span><span class="p">,</span> <span class="n">u64</span> <span class="n">err_struct_info</span><span class="p">,</span>
			<span class="n">u64</span> <span class="n">err_data_buffer</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">capabilities</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">resources</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_STK</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MC_ERROR_INJECT</span><span class="p">,</span> <span class="n">err_type_info</span><span class="p">,</span>
			  <span class="n">err_struct_info</span><span class="p">,</span> <span class="n">err_data_buffer</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">capabilities</span><span class="p">)</span>
		<span class="o">*</span><span class="n">capabilities</span><span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">resources</span><span class="p">)</span>
		<span class="o">*</span><span class="n">resources</span><span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Inform PALE_CHECK whether a machine check is expected so that PALE_CHECK willnot</span>
<span class="cm"> * attempt to correct any expected machine checks.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mc_expected</span> <span class="p">(</span><span class="n">u64</span> <span class="n">expected</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">previous</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MC_EXPECTED</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">previous</span><span class="p">)</span>
		<span class="o">*</span><span class="n">previous</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_hw_tracking_u</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">pht_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>		<span class="n">itc</span>	<span class="o">:</span><span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Instruction cache tracking */</span>
				<span class="n">dct</span>	<span class="o">:</span><span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Date cache tracking */</span>
				<span class="n">itt</span>	<span class="o">:</span><span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Instruction TLB tracking */</span>
				<span class="n">ddt</span>	<span class="o">:</span><span class="mi">4</span><span class="p">,</span>	<span class="cm">/* Data TLB tracking */</span>
				<span class="nl">reserved:</span><span class="mi">48</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pal_hw_tracking_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_hw_tracking_u_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Hardware tracking status.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mc_hw_tracking</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MC_HW_TRACKING</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="o">*</span><span class="n">status</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Register a platform dependent location with PAL to which it can save</span>
<span class="cm"> * minimal processor state in the event of a machine check or initialization</span>
<span class="cm"> * event.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mc_register_mem</span> <span class="p">(</span><span class="n">u64</span> <span class="n">physical_addr</span><span class="p">,</span> <span class="n">u64</span> <span class="n">size</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">req_size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MC_REGISTER_MEM</span><span class="p">,</span> <span class="n">physical_addr</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">req_size</span><span class="p">)</span>
		<span class="o">*</span><span class="n">req_size</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Restore minimal architectural processor state, set CMC interrupt if necessary</span>
<span class="cm"> * and resume execution</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mc_resume</span> <span class="p">(</span><span class="n">u64</span> <span class="n">set_cmci</span><span class="p">,</span> <span class="n">u64</span> <span class="n">save_ptr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MC_RESUME</span><span class="p">,</span> <span class="n">set_cmci</span><span class="p">,</span> <span class="n">save_ptr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Return the memory attributes implemented by the processor */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mem_attrib</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">mem_attrib</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MEM_ATTRIB</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mem_attrib</span><span class="p">)</span>
		<span class="o">*</span><span class="n">mem_attrib</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Return the amount of memory needed for second phase of processor</span>
<span class="cm"> * self-test and the required alignment of memory.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_mem_for_test</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">bytes_needed</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">alignment</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_MEM_FOR_TEST</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">bytes_needed</span><span class="p">)</span>
		<span class="o">*</span><span class="n">bytes_needed</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">alignment</span><span class="p">)</span>
		<span class="o">*</span><span class="n">alignment</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_perf_mon_info_u</span> <span class="p">{</span>
	<span class="n">u64</span>			  <span class="n">ppmi_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
	       <span class="n">u64</span>		<span class="n">generic</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">width</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">cycles</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">retired</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">reserved</span>	<span class="o">:</span> <span class="mi">32</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pal_perf_mon_info_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_perf_mon_info_u_t</span><span class="p">;</span>

<span class="cm">/* Return the performance monitor information about what can be counted</span>
<span class="cm"> * and how to configure the monitors to count the desired events.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_perf_mon_info</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">pm_buffer</span><span class="p">,</span> <span class="n">pal_perf_mon_info_u_t</span> <span class="o">*</span><span class="n">pm_info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_PERF_MON_INFO</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">pm_buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pm_info</span><span class="p">)</span>
		<span class="n">pm_info</span><span class="o">-&gt;</span><span class="n">ppmi_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Specifies the physical address of the processor interrupt block</span>
<span class="cm"> * and I/O port space.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_platform_addr</span> <span class="p">(</span><span class="n">u64</span> <span class="n">type</span><span class="p">,</span> <span class="n">u64</span> <span class="n">physical_addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_PLATFORM_ADDR</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">physical_addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Set the SAL PMI entrypoint in memory */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_pmi_entrypoint</span> <span class="p">(</span><span class="n">u64</span> <span class="n">sal_pmi_entry_addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_PMI_ENTRYPOINT</span><span class="p">,</span> <span class="n">sal_pmi_entry_addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">pal_features_s</span><span class="p">;</span>
<span class="cm">/* Provide information about configurable processor features */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_proc_get_features</span> <span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">features_avail</span><span class="p">,</span>
			    <span class="n">u64</span> <span class="o">*</span><span class="n">features_status</span><span class="p">,</span>
			    <span class="n">u64</span> <span class="o">*</span><span class="n">features_control</span><span class="p">,</span>
			    <span class="n">u64</span> <span class="n">features_set</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_PHYS</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_PROC_GET_FEATURES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">features_set</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iprv</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="o">*</span><span class="n">features_avail</span>   <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
		<span class="o">*</span><span class="n">features_status</span>  <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
		<span class="o">*</span><span class="n">features_control</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Enable/disable processor dependent features */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_proc_set_features</span> <span class="p">(</span><span class="n">u64</span> <span class="n">feature_select</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_PHYS</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_PROC_SET_FEATURES</span><span class="p">,</span> <span class="n">feature_select</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Put everything in a struct so we avoid the global offset table whenever</span>
<span class="cm"> * possible.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ia64_ptce_info_s</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">base</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">count</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span>		<span class="n">stride</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span> <span class="n">ia64_ptce_info_t</span><span class="p">;</span>

<span class="cm">/* Return the information required for the architected loop used to purge</span>
<span class="cm"> * (initialize) the entire TC</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_get_ptce</span> <span class="p">(</span><span class="n">ia64_ptce_info_t</span> <span class="o">*</span><span class="n">ptce</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ptce</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_PTCE_INFO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">iprv</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ptce</span><span class="o">-&gt;</span><span class="n">base</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
		<span class="n">ptce</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">ptce</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">;</span>
		<span class="n">ptce</span><span class="o">-&gt;</span><span class="n">stride</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="p">;</span>
		<span class="n">ptce</span><span class="o">-&gt;</span><span class="n">stride</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Return info about implemented application and control registers. */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_register_info</span> <span class="p">(</span><span class="n">u64</span> <span class="n">info_request</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">reg_info_1</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">reg_info_2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_REGISTER_INFO</span><span class="p">,</span> <span class="n">info_request</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg_info_1</span><span class="p">)</span>
		<span class="o">*</span><span class="n">reg_info_1</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg_info_2</span><span class="p">)</span>
		<span class="o">*</span><span class="n">reg_info_2</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_hints_u</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		<span class="n">ph_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
	       <span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">si</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">li</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">reserved</span>	<span class="o">:</span> <span class="mi">62</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pal_hints_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_hints_u_t</span><span class="p">;</span>

<span class="cm">/* Return information about the register stack and RSE for this processor</span>
<span class="cm"> * implementation.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">long</span> <span class="nf">ia64_pal_rse_info</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">num_phys_stacked</span><span class="p">,</span>
							<span class="n">pal_hints_u_t</span> <span class="o">*</span><span class="n">hints</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_RSE_INFO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">num_phys_stacked</span><span class="p">)</span>
		<span class="o">*</span><span class="n">num_phys_stacked</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hints</span><span class="p">)</span>
		<span class="n">hints</span><span class="o">-&gt;</span><span class="n">ph_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Set the current hardware resource sharing policy of the processor</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_set_hw_policy</span> <span class="p">(</span><span class="n">u64</span> <span class="n">policy</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_SET_HW_POLICY</span><span class="p">,</span> <span class="n">policy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Cause the processor to enter	SHUTDOWN state, where prefetching and execution are</span>
<span class="cm"> * suspended, but cause cache and TLB coherency to be maintained.</span>
<span class="cm"> * This is usually called in IA-32 mode.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_shutdown</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_SHUTDOWN</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Perform the second phase of processor self-test. */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_test_proc</span> <span class="p">(</span><span class="n">u64</span> <span class="n">test_addr</span><span class="p">,</span> <span class="n">u64</span> <span class="n">test_size</span><span class="p">,</span> <span class="n">u64</span> <span class="n">attributes</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">self_test_state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_TEST_PROC</span><span class="p">,</span> <span class="n">test_addr</span><span class="p">,</span> <span class="n">test_size</span><span class="p">,</span> <span class="n">attributes</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">self_test_state</span><span class="p">)</span>
		<span class="o">*</span><span class="n">self_test_state</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">union</span>  <span class="n">pal_version_u</span> <span class="p">{</span>
	<span class="n">u64</span>	<span class="n">pal_version_val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">pv_pal_b_rev</span>		<span class="o">:</span>	<span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pv_pal_b_model</span>		<span class="o">:</span>	<span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pv_reserved1</span>		<span class="o">:</span>	<span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pv_pal_vendor</span>		<span class="o">:</span>	<span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pv_pal_a_rev</span>		<span class="o">:</span>	<span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pv_pal_a_model</span>		<span class="o">:</span>	<span class="mi">8</span><span class="p">;</span>
		<span class="n">u64</span>	<span class="n">pv_reserved2</span>		<span class="o">:</span>	<span class="mi">16</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pal_version_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_version_u_t</span><span class="p">;</span>


<span class="cm">/*</span>
<span class="cm"> * Return PAL version information.  While the documentation states that</span>
<span class="cm"> * PAL_VERSION can be called in either physical or virtual mode, some</span>
<span class="cm"> * implementations only allow physical calls.  We don&#39;t call it very often,</span>
<span class="cm"> * so the overhead isn&#39;t worth eliminating.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_version</span> <span class="p">(</span><span class="n">pal_version_u_t</span> <span class="o">*</span><span class="n">pal_min_version</span><span class="p">,</span> <span class="n">pal_version_u_t</span> <span class="o">*</span><span class="n">pal_cur_version</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_PHYS</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_VERSION</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pal_min_version</span><span class="p">)</span>
		<span class="n">pal_min_version</span><span class="o">-&gt;</span><span class="n">pal_version_val</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pal_cur_version</span><span class="p">)</span>
		<span class="n">pal_cur_version</span><span class="o">-&gt;</span><span class="n">pal_version_val</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_tc_info_u</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">pti_val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
	       <span class="n">u64</span>		<span class="n">num_sets</span>	<span class="o">:</span>	<span class="mi">8</span><span class="p">,</span>
				<span class="n">associativity</span>	<span class="o">:</span>	<span class="mi">8</span><span class="p">,</span>
				<span class="n">num_entries</span>	<span class="o">:</span>	<span class="mi">16</span><span class="p">,</span>
				<span class="n">pf</span>		<span class="o">:</span>	<span class="mi">1</span><span class="p">,</span>
				<span class="n">unified</span>		<span class="o">:</span>	<span class="mi">1</span><span class="p">,</span>
				<span class="n">reduce_tr</span>	<span class="o">:</span>	<span class="mi">1</span><span class="p">,</span>
				<span class="n">reserved</span>	<span class="o">:</span>	<span class="mi">29</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pal_tc_info_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_tc_info_u_t</span><span class="p">;</span>

<span class="cp">#define tc_reduce_tr		pal_tc_info_s.reduce_tr</span>
<span class="cp">#define tc_unified		pal_tc_info_s.unified</span>
<span class="cp">#define tc_pf			pal_tc_info_s.pf</span>
<span class="cp">#define tc_num_entries		pal_tc_info_s.num_entries</span>
<span class="cp">#define tc_associativity	pal_tc_info_s.associativity</span>
<span class="cp">#define tc_num_sets		pal_tc_info_s.num_sets</span>


<span class="cm">/* Return information about the virtual memory characteristics of the processor</span>
<span class="cm"> * implementation.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_vm_info</span> <span class="p">(</span><span class="n">u64</span> <span class="n">tc_level</span><span class="p">,</span> <span class="n">u64</span> <span class="n">tc_type</span><span class="p">,</span>  <span class="n">pal_tc_info_u_t</span> <span class="o">*</span><span class="n">tc_info</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">tc_pages</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_VM_INFO</span><span class="p">,</span> <span class="n">tc_level</span><span class="p">,</span> <span class="n">tc_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tc_info</span><span class="p">)</span>
		<span class="n">tc_info</span><span class="o">-&gt;</span><span class="n">pti_val</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tc_pages</span><span class="p">)</span>
		<span class="o">*</span><span class="n">tc_pages</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Get page size information about the virtual memory characteristics of the processor</span>
<span class="cm"> * implementation.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span> <span class="nf">ia64_pal_vm_page_size</span><span class="p">(</span><span class="n">u64</span> <span class="o">*</span><span class="n">tr_pages</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">vw_pages</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_VM_PAGE_SIZE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tr_pages</span><span class="p">)</span>
		<span class="o">*</span><span class="n">tr_pages</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vw_pages</span><span class="p">)</span>
		<span class="o">*</span><span class="n">vw_pages</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_vm_info_1_u</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">pvi1_val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>		<span class="n">vw</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">phys_add_size</span>	<span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
				<span class="n">key_size</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">max_pkr</span>		<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">hash_tag_id</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">max_dtr_entry</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">max_itr_entry</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">max_unique_tcs</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">num_tc_levels</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pal_vm_info_1_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_vm_info_1_u_t</span><span class="p">;</span>

<span class="cp">#define PAL_MAX_PURGES		0xFFFF		</span><span class="cm">/* all ones is means unlimited */</span><span class="cp"></span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_vm_info_2_u</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">pvi2_val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>		<span class="n">impl_va_msb</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">rid_size</span>	<span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
				<span class="n">max_purges</span>	<span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
				<span class="n">reserved</span>	<span class="o">:</span> <span class="mi">32</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pal_vm_info_2_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_vm_info_2_u_t</span><span class="p">;</span>

<span class="cm">/* Get summary information about the virtual memory characteristics of the processor</span>
<span class="cm"> * implementation.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_vm_summary</span> <span class="p">(</span><span class="n">pal_vm_info_1_u_t</span> <span class="o">*</span><span class="n">vm_info_1</span><span class="p">,</span> <span class="n">pal_vm_info_2_u_t</span> <span class="o">*</span><span class="n">vm_info_2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_VM_SUMMARY</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vm_info_1</span><span class="p">)</span>
		<span class="n">vm_info_1</span><span class="o">-&gt;</span><span class="n">pvi1_val</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vm_info_2</span><span class="p">)</span>
		<span class="n">vm_info_2</span><span class="o">-&gt;</span><span class="n">pvi2_val</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_vp_info_u</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">pvi_val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>		<span class="n">index</span><span class="o">:</span>		<span class="mi">48</span><span class="p">,</span>	<span class="cm">/* virtual feature set info */</span>
				<span class="nl">vmm_id:</span>		<span class="mi">16</span><span class="p">;</span>	<span class="cm">/* feature set id */</span>
	<span class="p">}</span> <span class="n">pal_vp_info_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_vp_info_u_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Returns information about virtual processor features</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_vp_info</span> <span class="p">(</span><span class="n">u64</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">u64</span> <span class="n">vp_buffer</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">vp_info</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">vmm_id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_VP_INFO</span><span class="p">,</span> <span class="n">feature_set</span><span class="p">,</span> <span class="n">vp_buffer</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vp_info</span><span class="p">)</span>
		<span class="o">*</span><span class="n">vp_info</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">vmm_id</span><span class="p">)</span>
		<span class="o">*</span><span class="n">vmm_id</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_itr_valid_u</span> <span class="p">{</span>
	<span class="n">u64</span>			<span class="n">piv_val</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
	       <span class="n">u64</span>		<span class="n">access_rights_valid</span>	<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">priv_level_valid</span>	<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">dirty_bit_valid</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">mem_attr_valid</span>		<span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">reserved</span>		<span class="o">:</span> <span class="mi">60</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pal_tr_valid_s</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_tr_valid_u_t</span><span class="p">;</span>

<span class="cm">/* Read a translation register */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_tr_read</span> <span class="p">(</span><span class="n">u64</span> <span class="n">reg_num</span><span class="p">,</span> <span class="n">u64</span> <span class="n">tr_type</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">tr_buffer</span><span class="p">,</span> <span class="n">pal_tr_valid_u_t</span> <span class="o">*</span><span class="n">tr_valid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL_PHYS_STK</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_VM_TR_READ</span><span class="p">,</span> <span class="n">reg_num</span><span class="p">,</span> <span class="n">tr_type</span><span class="p">,(</span><span class="n">u64</span><span class="p">)</span><span class="n">ia64_tpa</span><span class="p">(</span><span class="n">tr_buffer</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tr_valid</span><span class="p">)</span>
		<span class="n">tr_valid</span><span class="o">-&gt;</span><span class="n">piv_val</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * PAL_PREFETCH_VISIBILITY transaction types</span>
<span class="cm"> */</span>
<span class="cp">#define PAL_VISIBILITY_VIRTUAL		0</span>
<span class="cp">#define PAL_VISIBILITY_PHYSICAL		1</span>

<span class="cm">/*</span>
<span class="cm"> * PAL_PREFETCH_VISIBILITY return codes</span>
<span class="cm"> */</span>
<span class="cp">#define PAL_VISIBILITY_OK		1</span>
<span class="cp">#define PAL_VISIBILITY_OK_REMOTE_NEEDED	0</span>
<span class="cp">#define PAL_VISIBILITY_INVAL_ARG	-2</span>
<span class="cp">#define PAL_VISIBILITY_ERROR		-3</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_prefetch_visibility</span> <span class="p">(</span><span class="n">s64</span> <span class="n">trans_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>
	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_PREFETCH_VISIBILITY</span><span class="p">,</span> <span class="n">trans_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* data structure for getting information on logical to physical mappings */</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_log_overview_u</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">num_log</span>		<span class="o">:</span><span class="mi">16</span><span class="p">,</span>	<span class="cm">/* Total number of logical</span>
<span class="cm">						 * processors on this die</span>
<span class="cm">						 */</span>
			<span class="n">tpc</span>		<span class="o">:</span><span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Threads per core */</span>
			<span class="n">reserved3</span>	<span class="o">:</span><span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Reserved */</span>
			<span class="n">cpp</span>		<span class="o">:</span><span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Cores per processor */</span>
			<span class="n">reserved2</span>	<span class="o">:</span><span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Reserved */</span>
			<span class="n">ppid</span>		<span class="o">:</span><span class="mi">8</span><span class="p">,</span>	<span class="cm">/* Physical processor ID */</span>
			<span class="n">reserved1</span>	<span class="o">:</span><span class="mi">8</span><span class="p">;</span>	<span class="cm">/* Reserved */</span>
	<span class="p">}</span> <span class="n">overview_bits</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">overview_data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_log_overview_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_proc_n_log_info1_u</span><span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">tid</span>		<span class="o">:</span><span class="mi">16</span><span class="p">,</span>	<span class="cm">/* Thread id */</span>
			<span class="n">reserved2</span>	<span class="o">:</span><span class="mi">16</span><span class="p">,</span>	<span class="cm">/* Reserved */</span>
			<span class="n">cid</span>		<span class="o">:</span><span class="mi">16</span><span class="p">,</span>	<span class="cm">/* Core id */</span>
			<span class="n">reserved1</span>	<span class="o">:</span><span class="mi">16</span><span class="p">;</span>	<span class="cm">/* Reserved */</span>
	<span class="p">}</span> <span class="n">ppli1_bits</span><span class="p">;</span>
	<span class="n">u64</span>	<span class="n">ppli1_data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_proc_n_log_info1_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">pal_proc_n_log_info2_u</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span>	<span class="n">la</span>		<span class="o">:</span><span class="mi">16</span><span class="p">,</span>	<span class="cm">/* Logical address */</span>
			<span class="n">reserved</span>	<span class="o">:</span><span class="mi">48</span><span class="p">;</span>	<span class="cm">/* Reserved */</span>
	<span class="p">}</span> <span class="n">ppli2_bits</span><span class="p">;</span>
	<span class="n">u64</span>	<span class="n">ppli2_data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_proc_n_log_info2_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_logical_to_physical_s</span>
<span class="p">{</span>
	<span class="n">pal_log_overview_t</span> <span class="n">overview</span><span class="p">;</span>
	<span class="n">pal_proc_n_log_info1_t</span> <span class="n">ppli1</span><span class="p">;</span>
	<span class="n">pal_proc_n_log_info2_t</span> <span class="n">ppli2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_logical_to_physical_t</span><span class="p">;</span>

<span class="cp">#define overview_num_log	overview.overview_bits.num_log</span>
<span class="cp">#define overview_tpc		overview.overview_bits.tpc</span>
<span class="cp">#define overview_cpp		overview.overview_bits.cpp</span>
<span class="cp">#define overview_ppid		overview.overview_bits.ppid</span>
<span class="cp">#define log1_tid		ppli1.ppli1_bits.tid</span>
<span class="cp">#define log1_cid		ppli1.ppli1_bits.cid</span>
<span class="cp">#define log2_la			ppli2.ppli2_bits.la</span>

<span class="cm">/* Get information on logical to physical processor mappings. */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_logical_to_phys</span><span class="p">(</span><span class="n">u64</span> <span class="n">proc_number</span><span class="p">,</span> <span class="n">pal_logical_to_physical_t</span> <span class="o">*</span><span class="n">mapping</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>

	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_LOGICAL_TO_PHYSICAL</span><span class="p">,</span> <span class="n">proc_number</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">iprv</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PAL_STATUS_SUCCESS</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">mapping</span><span class="o">-&gt;</span><span class="n">overview</span><span class="p">.</span><span class="n">overview_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
		<span class="n">mapping</span><span class="o">-&gt;</span><span class="n">ppli1</span><span class="p">.</span><span class="n">ppli1_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
		<span class="n">mapping</span><span class="o">-&gt;</span><span class="n">ppli2</span><span class="p">.</span><span class="n">ppli2_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">pal_cache_shared_info_s</span>
<span class="p">{</span>
	<span class="n">u64</span> <span class="n">num_shared</span><span class="p">;</span>
	<span class="n">pal_proc_n_log_info1_t</span> <span class="n">ppli1</span><span class="p">;</span>
	<span class="n">pal_proc_n_log_info2_t</span> <span class="n">ppli2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">pal_cache_shared_info_t</span><span class="p">;</span>

<span class="cm">/* Get information on logical to physical processor mappings. */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_pal_cache_shared_info</span><span class="p">(</span><span class="n">u64</span> <span class="n">level</span><span class="p">,</span>
		<span class="n">u64</span> <span class="n">type</span><span class="p">,</span>
		<span class="n">u64</span> <span class="n">proc_number</span><span class="p">,</span>
		<span class="n">pal_cache_shared_info_t</span> <span class="o">*</span><span class="n">info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_pal_retval</span> <span class="n">iprv</span><span class="p">;</span>

	<span class="n">PAL_CALL</span><span class="p">(</span><span class="n">iprv</span><span class="p">,</span> <span class="n">PAL_CACHE_SHARED_INFO</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">proc_number</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">iprv</span><span class="p">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">PAL_STATUS_SUCCESS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">num_shared</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">ppli1</span><span class="p">.</span><span class="n">ppli1_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
		<span class="n">info</span><span class="o">-&gt;</span><span class="n">ppli2</span><span class="p">.</span><span class="n">ppli2_data</span> <span class="o">=</span> <span class="n">iprv</span><span class="p">.</span><span class="n">v2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">iprv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _ASM_IA64_PAL_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
