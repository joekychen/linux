<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › include › asm › sal.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>sal.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_IA64_SAL_H</span>
<span class="cp">#define _ASM_IA64_SAL_H</span>

<span class="cm">/*</span>
<span class="cm"> * System Abstraction Layer definitions.</span>
<span class="cm"> *</span>
<span class="cm"> * This is based on version 2.5 of the manual &quot;IA-64 System</span>
<span class="cm"> * Abstraction Layer&quot;.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2001 Intel</span>
<span class="cm"> * Copyright (C) 2002 Jenna Hall &lt;jenna.s.hall@intel.com&gt;</span>
<span class="cm"> * Copyright (C) 2001 Fred Lewis &lt;frederick.v.lewis@intel.com&gt;</span>
<span class="cm"> * Copyright (C) 1998, 1999, 2001, 2003 Hewlett-Packard Co</span>
<span class="cm"> *	David Mosberger-Tang &lt;davidm@hpl.hp.com&gt;</span>
<span class="cm"> * Copyright (C) 1999 Srinivasa Prasad Thirumalachar &lt;sprasad@sprasad.engr.sgi.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * 02/01/04 J. Hall Updated Error Record Structures to conform to July 2001</span>
<span class="cm"> *		    revision of the SAL spec.</span>
<span class="cm"> * 01/01/03 fvlewis Updated Error Record Structures to conform with Nov. 2000</span>
<span class="cm"> *                  revision of the SAL spec.</span>
<span class="cm"> * 99/09/29 davidm	Updated for SAL 2.6.</span>
<span class="cm"> * 00/03/29 cfleck      Updated SAL Error Logging info for processor (SAL 2.6)</span>
<span class="cm"> *                      (plus examples of platform error info structures from smariset @ Intel)</span>
<span class="cm"> */</span>

<span class="cp">#define IA64_SAL_PLATFORM_FEATURE_BUS_LOCK_BIT		0</span>
<span class="cp">#define IA64_SAL_PLATFORM_FEATURE_IRQ_REDIR_HINT_BIT	1</span>
<span class="cp">#define IA64_SAL_PLATFORM_FEATURE_IPI_REDIR_HINT_BIT	2</span>
<span class="cp">#define IA64_SAL_PLATFORM_FEATURE_ITC_DRIFT_BIT	 	3</span>

<span class="cp">#define IA64_SAL_PLATFORM_FEATURE_BUS_LOCK	  (1&lt;&lt;IA64_SAL_PLATFORM_FEATURE_BUS_LOCK_BIT)</span>
<span class="cp">#define IA64_SAL_PLATFORM_FEATURE_IRQ_REDIR_HINT (1&lt;&lt;IA64_SAL_PLATFORM_FEATURE_IRQ_REDIR_HINT_BIT)</span>
<span class="cp">#define IA64_SAL_PLATFORM_FEATURE_IPI_REDIR_HINT (1&lt;&lt;IA64_SAL_PLATFORM_FEATURE_IPI_REDIR_HINT_BIT)</span>
<span class="cp">#define IA64_SAL_PLATFORM_FEATURE_ITC_DRIFT	  (1&lt;&lt;IA64_SAL_PLATFORM_FEATURE_ITC_DRIFT_BIT)</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cp">#include &lt;linux/bcd.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;linux/efi.h&gt;</span>

<span class="cp">#include &lt;asm/pal.h&gt;</span>
<span class="cp">#include &lt;asm/fpu.h&gt;</span>

<span class="k">extern</span> <span class="n">spinlock_t</span> <span class="n">sal_lock</span><span class="p">;</span>

<span class="cm">/* SAL spec _requires_ eight args for each call. */</span>
<span class="cp">#define __IA64_FW_CALL(entry,result,a0,a1,a2,a3,a4,a5,a6,a7)	\</span>
<span class="cp">	result = (*entry)(a0,a1,a2,a3,a4,a5,a6,a7)</span>

<span class="cp"># define IA64_FW_CALL(entry,result,args...) do {		\</span>
<span class="cp">	unsigned long __ia64_sc_flags;				\</span>
<span class="cp">	struct ia64_fpreg __ia64_sc_fr[6];			\</span>
<span class="cp">	ia64_save_scratch_fpregs(__ia64_sc_fr);			\</span>
<span class="cp">	spin_lock_irqsave(&amp;sal_lock, __ia64_sc_flags);		\</span>
<span class="cp">	__IA64_FW_CALL(entry, result, args);			\</span>
<span class="cp">	spin_unlock_irqrestore(&amp;sal_lock, __ia64_sc_flags);	\</span>
<span class="cp">	ia64_load_scratch_fpregs(__ia64_sc_fr);			\</span>
<span class="cp">} while (0)</span>

<span class="cp"># define SAL_CALL(result,args...)			\</span>
<span class="cp">	IA64_FW_CALL(ia64_sal, result, args);</span>

<span class="cp"># define SAL_CALL_NOLOCK(result,args...) do {		\</span>
<span class="cp">	unsigned long __ia64_scn_flags;			\</span>
<span class="cp">	struct ia64_fpreg __ia64_scn_fr[6];		\</span>
<span class="cp">	ia64_save_scratch_fpregs(__ia64_scn_fr);	\</span>
<span class="cp">	local_irq_save(__ia64_scn_flags);		\</span>
<span class="cp">	__IA64_FW_CALL(ia64_sal, result, args);		\</span>
<span class="cp">	local_irq_restore(__ia64_scn_flags);		\</span>
<span class="cp">	ia64_load_scratch_fpregs(__ia64_scn_fr);	\</span>
<span class="cp">} while (0)</span>

<span class="cp"># define SAL_CALL_REENTRANT(result,args...) do {	\</span>
<span class="cp">	struct ia64_fpreg __ia64_scs_fr[6];		\</span>
<span class="cp">	ia64_save_scratch_fpregs(__ia64_scs_fr);	\</span>
<span class="cp">	preempt_disable();				\</span>
<span class="cp">	__IA64_FW_CALL(ia64_sal, result, args);		\</span>
<span class="cp">	preempt_enable();				\</span>
<span class="cp">	ia64_load_scratch_fpregs(__ia64_scs_fr);	\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define SAL_SET_VECTORS			0x01000000</span>
<span class="cp">#define SAL_GET_STATE_INFO		0x01000001</span>
<span class="cp">#define SAL_GET_STATE_INFO_SIZE		0x01000002</span>
<span class="cp">#define SAL_CLEAR_STATE_INFO		0x01000003</span>
<span class="cp">#define SAL_MC_RENDEZ			0x01000004</span>
<span class="cp">#define SAL_MC_SET_PARAMS		0x01000005</span>
<span class="cp">#define SAL_REGISTER_PHYSICAL_ADDR	0x01000006</span>

<span class="cp">#define SAL_CACHE_FLUSH			0x01000008</span>
<span class="cp">#define SAL_CACHE_INIT			0x01000009</span>
<span class="cp">#define SAL_PCI_CONFIG_READ		0x01000010</span>
<span class="cp">#define SAL_PCI_CONFIG_WRITE		0x01000011</span>
<span class="cp">#define SAL_FREQ_BASE			0x01000012</span>
<span class="cp">#define SAL_PHYSICAL_ID_INFO		0x01000013</span>

<span class="cp">#define SAL_UPDATE_PAL			0x01000020</span>

<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * A zero status value indicates call completed without error.</span>
<span class="cm">	 * A negative status value indicates reason of call failure.</span>
<span class="cm">	 * A positive status value indicates success but an</span>
<span class="cm">	 * informational value should be printed (e.g., &quot;reboot for</span>
<span class="cm">	 * change to take effect&quot;).</span>
<span class="cm">	 */</span>
	<span class="kt">long</span> <span class="n">status</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">v0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">v1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">v2</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="p">(</span><span class="o">*</span><span class="n">ia64_sal_handler</span><span class="p">)</span> <span class="p">(</span><span class="n">u64</span><span class="p">,</span> <span class="p">...);</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">SAL_FREQ_BASE_PLATFORM</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SAL_FREQ_BASE_INTERVAL_TIMER</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">SAL_FREQ_BASE_REALTIME_CLOCK</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * The SAL system table is followed by a variable number of variable</span>
<span class="cm"> * length descriptors.  The structure of these descriptors follows</span>
<span class="cm"> * below.</span>
<span class="cm"> * The defininition follows SAL specs from July 2000</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">ia64_sal_systab</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">signature</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* should be &quot;SST_&quot; */</span>
	<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>		<span class="cm">/* size of this table in bytes */</span>
	<span class="n">u8</span> <span class="n">sal_rev_minor</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sal_rev_major</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">entry_count</span><span class="p">;</span>	<span class="cm">/* # of entries in variable portion */</span>
	<span class="n">u8</span> <span class="n">checksum</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">sal_a_rev_minor</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sal_a_rev_major</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sal_b_rev_minor</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sal_b_rev_major</span><span class="p">;</span>
	<span class="cm">/* oem_id &amp; product_id: terminating NUL is missing if string is exactly 32 bytes long. */</span>
	<span class="n">u8</span> <span class="n">oem_id</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">product_id</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>	<span class="cm">/* ASCII product id  */</span>
	<span class="n">u8</span> <span class="n">reserved2</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">sal_systab_entry_type</span> <span class="p">{</span>
	<span class="n">SAL_DESC_ENTRY_POINT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SAL_DESC_MEMORY</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">SAL_DESC_PLATFORM_FEATURE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">SAL_DESC_TR</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">SAL_DESC_PTC</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">SAL_DESC_AP_WAKEUP</span> <span class="o">=</span> <span class="mi">5</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Entry type:	Size:</span>
<span class="cm"> *	0	48</span>
<span class="cm"> *	1	32</span>
<span class="cm"> *	2	16</span>
<span class="cm"> *	3	32</span>
<span class="cm"> *	4	16</span>
<span class="cm"> *	5	16</span>
<span class="cm"> */</span>
<span class="cp">#define SAL_DESC_SIZE(type)	&quot;\060\040\020\040\020\020&quot;[(unsigned) type]</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ia64_sal_desc_entry_point</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">pal_proc</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">sal_proc</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">gp</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved2</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
<span class="p">}</span><span class="n">ia64_sal_desc_entry_point_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ia64_sal_desc_memory</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">used_by_sal</span><span class="p">;</span>	<span class="cm">/* needs to be mapped for SAL? */</span>
	<span class="n">u8</span> <span class="n">mem_attr</span><span class="p">;</span>		<span class="cm">/* current memory attribute setting */</span>
	<span class="n">u8</span> <span class="n">access_rights</span><span class="p">;</span>	<span class="cm">/* access rights set up by SAL */</span>
	<span class="n">u8</span> <span class="n">mem_attr_mask</span><span class="p">;</span>	<span class="cm">/* mask of supported memory attributes */</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mem_type</span><span class="p">;</span>		<span class="cm">/* memory type */</span>
	<span class="n">u8</span> <span class="n">mem_usage</span><span class="p">;</span>		<span class="cm">/* memory usage */</span>
	<span class="n">u64</span> <span class="n">addr</span><span class="p">;</span>		<span class="cm">/* physical address of memory */</span>
	<span class="n">u32</span> <span class="n">length</span><span class="p">;</span>	<span class="cm">/* length (multiple of 4KB pages) */</span>
	<span class="n">u32</span> <span class="n">reserved2</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">oem_reserved</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span> <span class="n">ia64_sal_desc_memory_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ia64_sal_desc_platform_feature</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">feature_mask</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">14</span><span class="p">];</span>
<span class="p">}</span> <span class="n">ia64_sal_desc_platform_feature_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ia64_sal_desc_tr</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tr_type</span><span class="p">;</span>		<span class="cm">/* 0 == instruction, 1 == data */</span>
	<span class="n">u8</span> <span class="n">regnum</span><span class="p">;</span>		<span class="cm">/* translation register number */</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">addr</span><span class="p">;</span>		<span class="cm">/* virtual address of area covered */</span>
	<span class="n">u64</span> <span class="n">page_size</span><span class="p">;</span>		<span class="cm">/* encoded page size */</span>
	<span class="n">u8</span> <span class="n">reserved2</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span> <span class="n">ia64_sal_desc_tr_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ia64_sal_desc_ptc</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">num_domains</span><span class="p">;</span>	<span class="cm">/* # of coherence domains */</span>
	<span class="n">u64</span> <span class="n">domain_info</span><span class="p">;</span>	<span class="cm">/* physical address of domain info table */</span>
<span class="p">}</span> <span class="n">ia64_sal_desc_ptc_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ia64_sal_ptc_domain_info</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">proc_count</span><span class="p">;</span>		<span class="cm">/* number of processors in domain */</span>
	<span class="n">u64</span> <span class="n">proc_list</span><span class="p">;</span>		<span class="cm">/* physical address of LID array */</span>
<span class="p">}</span> <span class="n">ia64_sal_ptc_domain_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ia64_sal_ptc_domain_proc_entry</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">id</span>  <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>		<span class="cm">/* id of processor */</span>
	<span class="n">u64</span> <span class="n">eid</span> <span class="o">:</span> <span class="mi">8</span><span class="p">;</span>		<span class="cm">/* eid of processor */</span>
<span class="p">}</span> <span class="n">ia64_sal_ptc_domain_proc_entry_t</span><span class="p">;</span>


<span class="cp">#define IA64_SAL_AP_EXTERNAL_INT 0</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">ia64_sal_desc_ap_wakeup</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mechanism</span><span class="p">;</span>		<span class="cm">/* 0 == external interrupt */</span>
	<span class="n">u8</span> <span class="n">reserved1</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">vector</span><span class="p">;</span>		<span class="cm">/* interrupt vector in range 0x10-0xff */</span>
<span class="p">}</span> <span class="n">ia64_sal_desc_ap_wakeup_t</span> <span class="p">;</span>

<span class="k">extern</span> <span class="n">ia64_sal_handler</span> <span class="n">ia64_sal</span><span class="p">;</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">ia64_sal_desc_ptc</span> <span class="o">*</span><span class="n">ia64_ptc_domain_info</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">sal_revision</span><span class="p">;</span>	<span class="cm">/* supported SAL spec revision */</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">sal_version</span><span class="p">;</span>	<span class="cm">/* SAL version; OEM dependent */</span>
<span class="cp">#define SAL_VERSION_CODE(major, minor) ((bin2bcd(major) &lt;&lt; 8) | bin2bcd(minor))</span>

<span class="k">extern</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">ia64_sal_strerror</span> <span class="p">(</span><span class="kt">long</span> <span class="n">status</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_sal_init</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ia64_sal_systab</span> <span class="o">*</span><span class="n">sal_systab</span><span class="p">);</span>

<span class="cm">/* SAL information type encodings */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">SAL_INFO_TYPE_MCA</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>		<span class="cm">/* Machine check abort information */</span>
        <span class="n">SAL_INFO_TYPE_INIT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>		<span class="cm">/* Init information */</span>
        <span class="n">SAL_INFO_TYPE_CMC</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>		<span class="cm">/* Corrected machine check information */</span>
        <span class="n">SAL_INFO_TYPE_CPE</span>  <span class="o">=</span> <span class="mi">3</span>		<span class="cm">/* Corrected platform error information */</span>
<span class="p">};</span>

<span class="cm">/* Encodings for machine check parameter types */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">SAL_MC_PARAM_RENDEZ_INT</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Rendezvous interrupt */</span>
	<span class="n">SAL_MC_PARAM_RENDEZ_WAKEUP</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* Wakeup */</span>
	<span class="n">SAL_MC_PARAM_CPE_INT</span>	   <span class="o">=</span> <span class="mi">3</span>	<span class="cm">/* Corrected Platform Error Int */</span>
<span class="p">};</span>

<span class="cm">/* Encodings for rendezvous mechanisms */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">SAL_MC_PARAM_MECHANISM_INT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* Use interrupt */</span>
	<span class="n">SAL_MC_PARAM_MECHANISM_MEM</span> <span class="o">=</span> <span class="mi">2</span>	<span class="cm">/* Use memory synchronization variable*/</span>
<span class="p">};</span>

<span class="cm">/* Encodings for vectors which can be registered by the OS with SAL */</span>
<span class="k">enum</span> <span class="p">{</span>
	<span class="n">SAL_VECTOR_OS_MCA</span>	  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SAL_VECTOR_OS_INIT</span>	  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">SAL_VECTOR_OS_BOOT_RENDEZ</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">};</span>

<span class="cm">/* Encodings for mca_opt parameter sent to SAL_MC_SET_PARAMS */</span>
<span class="cp">#define	SAL_MC_PARAM_RZ_ALWAYS		0x1</span>
<span class="cp">#define	SAL_MC_PARAM_BINIT_ESCALATE	0x10</span>

<span class="cm">/*</span>
<span class="cm"> * Definition of the SAL Error Log from the SAL spec</span>
<span class="cm"> */</span>

<span class="cm">/* SAL Error Record Section GUID Definitions */</span>
<span class="cp">#define SAL_PROC_DEV_ERR_SECT_GUID  \</span>
<span class="cp">    EFI_GUID(0xe429faf1, 0x3cb7, 0x11d4, 0xbc, 0xa7, 0x0, 0x80, 0xc7, 0x3c, 0x88, 0x81)</span>
<span class="cp">#define SAL_PLAT_MEM_DEV_ERR_SECT_GUID  \</span>
<span class="cp">    EFI_GUID(0xe429faf2, 0x3cb7, 0x11d4, 0xbc, 0xa7, 0x0, 0x80, 0xc7, 0x3c, 0x88, 0x81)</span>
<span class="cp">#define SAL_PLAT_SEL_DEV_ERR_SECT_GUID  \</span>
<span class="cp">    EFI_GUID(0xe429faf3, 0x3cb7, 0x11d4, 0xbc, 0xa7, 0x0, 0x80, 0xc7, 0x3c, 0x88, 0x81)</span>
<span class="cp">#define SAL_PLAT_PCI_BUS_ERR_SECT_GUID  \</span>
<span class="cp">    EFI_GUID(0xe429faf4, 0x3cb7, 0x11d4, 0xbc, 0xa7, 0x0, 0x80, 0xc7, 0x3c, 0x88, 0x81)</span>
<span class="cp">#define SAL_PLAT_SMBIOS_DEV_ERR_SECT_GUID  \</span>
<span class="cp">    EFI_GUID(0xe429faf5, 0x3cb7, 0x11d4, 0xbc, 0xa7, 0x0, 0x80, 0xc7, 0x3c, 0x88, 0x81)</span>
<span class="cp">#define SAL_PLAT_PCI_COMP_ERR_SECT_GUID  \</span>
<span class="cp">    EFI_GUID(0xe429faf6, 0x3cb7, 0x11d4, 0xbc, 0xa7, 0x0, 0x80, 0xc7, 0x3c, 0x88, 0x81)</span>
<span class="cp">#define SAL_PLAT_SPECIFIC_ERR_SECT_GUID  \</span>
<span class="cp">    EFI_GUID(0xe429faf7, 0x3cb7, 0x11d4, 0xbc, 0xa7, 0x0, 0x80, 0xc7, 0x3c, 0x88, 0x81)</span>
<span class="cp">#define SAL_PLAT_HOST_CTLR_ERR_SECT_GUID  \</span>
<span class="cp">    EFI_GUID(0xe429faf8, 0x3cb7, 0x11d4, 0xbc, 0xa7, 0x0, 0x80, 0xc7, 0x3c, 0x88, 0x81)</span>
<span class="cp">#define SAL_PLAT_BUS_ERR_SECT_GUID  \</span>
<span class="cp">    EFI_GUID(0xe429faf9, 0x3cb7, 0x11d4, 0xbc, 0xa7, 0x0, 0x80, 0xc7, 0x3c, 0x88, 0x81)</span>
<span class="cp">#define PROCESSOR_ABSTRACTION_LAYER_OVERWRITE_GUID \</span>
<span class="cp">    EFI_GUID(0x6cb0a200, 0x893a, 0x11da, 0x96, 0xd2, 0x0, 0x10, 0x83, 0xff, \</span>
<span class="cp">		0xca, 0x4d)</span>

<span class="cp">#define MAX_CACHE_ERRORS	6</span>
<span class="cp">#define MAX_TLB_ERRORS		6</span>
<span class="cp">#define MAX_BUS_ERRORS		1</span>

<span class="cm">/* Definition of version  according to SAL spec for logging purposes */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_revision</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">minor</span><span class="p">;</span>		<span class="cm">/* BCD (0..99) */</span>
	<span class="n">u8</span> <span class="n">major</span><span class="p">;</span>		<span class="cm">/* BCD (0..99) */</span>
<span class="p">}</span> <span class="n">sal_log_revision_t</span><span class="p">;</span>

<span class="cm">/* Definition of timestamp according to SAL spec for logging purposes */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_timestamp</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">slh_second</span><span class="p">;</span>		<span class="cm">/* Second (0..59) */</span>
	<span class="n">u8</span> <span class="n">slh_minute</span><span class="p">;</span>		<span class="cm">/* Minute (0..59) */</span>
	<span class="n">u8</span> <span class="n">slh_hour</span><span class="p">;</span>		<span class="cm">/* Hour (0..23) */</span>
	<span class="n">u8</span> <span class="n">slh_reserved</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">slh_day</span><span class="p">;</span>		<span class="cm">/* Day (1..31) */</span>
	<span class="n">u8</span> <span class="n">slh_month</span><span class="p">;</span>		<span class="cm">/* Month (1..12) */</span>
	<span class="n">u8</span> <span class="n">slh_year</span><span class="p">;</span>		<span class="cm">/* Year (00..99) */</span>
	<span class="n">u8</span> <span class="n">slh_century</span><span class="p">;</span>		<span class="cm">/* Century (19, 20, 21, ...) */</span>
<span class="p">}</span> <span class="n">sal_log_timestamp_t</span><span class="p">;</span>

<span class="cm">/* Definition of log record  header structures */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_record_header</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">id</span><span class="p">;</span>				<span class="cm">/* Unique monotonically increasing ID */</span>
	<span class="n">sal_log_revision_t</span> <span class="n">revision</span><span class="p">;</span>	<span class="cm">/* Major and Minor revision of header */</span>
	<span class="n">u8</span> <span class="n">severity</span><span class="p">;</span>			<span class="cm">/* Error Severity */</span>
	<span class="n">u8</span> <span class="n">validation_bits</span><span class="p">;</span>		<span class="cm">/* 0: platform_guid, 1: !timestamp */</span>
	<span class="n">u32</span> <span class="n">len</span><span class="p">;</span>			<span class="cm">/* Length of this error log in bytes */</span>
	<span class="n">sal_log_timestamp_t</span> <span class="n">timestamp</span><span class="p">;</span>	<span class="cm">/* Timestamp */</span>
	<span class="n">efi_guid_t</span> <span class="n">platform_guid</span><span class="p">;</span>	<span class="cm">/* Unique OEM Platform ID */</span>
<span class="p">}</span> <span class="n">sal_log_record_header_t</span><span class="p">;</span>

<span class="cp">#define sal_log_severity_recoverable	0</span>
<span class="cp">#define sal_log_severity_fatal		1</span>
<span class="cp">#define sal_log_severity_corrected	2</span>

<span class="cm">/*</span>
<span class="cm"> * Error Recovery Info (ERI) bit decode.  From SAL Spec section B.2.2 Table B-3</span>
<span class="cm"> * Error Section Error_Recovery_Info Field Definition.</span>
<span class="cm"> */</span>
<span class="cp">#define ERI_NOT_VALID		0x0	</span><span class="cm">/* Error Recovery Field is not valid */</span><span class="cp"></span>
<span class="cp">#define ERI_NOT_ACCESSIBLE	0x30	</span><span class="cm">/* Resource not accessible */</span><span class="cp"></span>
<span class="cp">#define ERI_CONTAINMENT_WARN	0x22	</span><span class="cm">/* Corrupt data propagated */</span><span class="cp"></span>
<span class="cp">#define ERI_UNCORRECTED_ERROR	0x20	</span><span class="cm">/* Uncorrected error */</span><span class="cp"></span>
<span class="cp">#define ERI_COMPONENT_RESET	0x24	</span><span class="cm">/* Component must be reset */</span><span class="cp"></span>
<span class="cp">#define ERI_CORR_ERROR_LOG	0x21	</span><span class="cm">/* Corrected error, needs logging */</span><span class="cp"></span>
<span class="cp">#define ERI_CORR_ERROR_THRESH	0x29	</span><span class="cm">/* Corrected error threshold exceeded */</span><span class="cp"></span>

<span class="cm">/* Definition of log section header structures */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_sec_header</span> <span class="p">{</span>
    <span class="n">efi_guid_t</span> <span class="n">guid</span><span class="p">;</span>			<span class="cm">/* Unique Section ID */</span>
    <span class="n">sal_log_revision_t</span> <span class="n">revision</span><span class="p">;</span>	<span class="cm">/* Major and Minor revision of Section */</span>
    <span class="n">u8</span> <span class="n">error_recovery_info</span><span class="p">;</span>		<span class="cm">/* Platform error recovery status */</span>
    <span class="n">u8</span> <span class="n">reserved</span><span class="p">;</span>
    <span class="n">u32</span> <span class="n">len</span><span class="p">;</span>				<span class="cm">/* Section length */</span>
<span class="p">}</span> <span class="n">sal_log_section_hdr_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_mod_error_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">check_info</span>              <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">requestor_identifier</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">responder_identifier</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">target_identifier</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">precise_ip</span>              <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved</span>                <span class="o">:</span> <span class="mi">59</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">check_info</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">requestor_identifier</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">responder_identifier</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">target_identifier</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">precise_ip</span><span class="p">;</span>
<span class="p">}</span> <span class="n">sal_log_mod_error_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_processor_static_info</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">minstate</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">br</span>              <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">cr</span>              <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">ar</span>              <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">rr</span>              <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">fr</span>              <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved</span>        <span class="o">:</span> <span class="mi">58</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">pal_min_state_area_t</span> <span class="n">min_state_area</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">br</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">cr</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">ar</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">rr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ia64_fpreg</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">packed</span><span class="p">))</span> <span class="n">fr</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>
<span class="p">}</span> <span class="n">sal_processor_static_info_t</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">sal_cpuid_info</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">regs</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">reserved</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_processor_info</span> <span class="p">{</span>
	<span class="n">sal_log_section_hdr_t</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">proc_error_map</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">proc_state_param</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">proc_cr_lid</span>         <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">psi_static_struct</span>   <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">num_cache_check</span>     <span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
		    <span class="n">num_tlb_check</span>       <span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
		    <span class="n">num_bus_check</span>       <span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
		    <span class="n">num_reg_file_check</span>  <span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
		    <span class="n">num_ms_check</span>        <span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
		    <span class="n">cpuid_info</span>          <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved1</span>           <span class="o">:</span> <span class="mi">39</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">proc_error_map</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">proc_state_parameter</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">proc_cr_lid</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * The rest of this structure consists of variable-length arrays, which can&#39;t be</span>
<span class="cm">	 * expressed in C.</span>
<span class="cm">	 */</span>
	<span class="n">sal_log_mod_error_info_t</span> <span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="cm">/*</span>
<span class="cm">	 * This is what the rest looked like if C supported variable-length arrays:</span>
<span class="cm">	 *</span>
<span class="cm">	 * sal_log_mod_error_info_t cache_check_info[.valid.num_cache_check];</span>
<span class="cm">	 * sal_log_mod_error_info_t tlb_check_info[.valid.num_tlb_check];</span>
<span class="cm">	 * sal_log_mod_error_info_t bus_check_info[.valid.num_bus_check];</span>
<span class="cm">	 * sal_log_mod_error_info_t reg_file_check_info[.valid.num_reg_file_check];</span>
<span class="cm">	 * sal_log_mod_error_info_t ms_check_info[.valid.num_ms_check];</span>
<span class="cm">	 * struct sal_cpuid_info cpuid_info;</span>
<span class="cm">	 * sal_processor_static_info_t processor_static_info;</span>
<span class="cm">	 */</span>
<span class="p">}</span> <span class="n">sal_log_processor_info_t</span><span class="p">;</span>

<span class="cm">/* Given a sal_log_processor_info_t pointer, return a pointer to the processor_static_info: */</span>
<span class="cp">#define SAL_LPI_PSI_INFO(l)									\</span>
<span class="cp">({	sal_log_processor_info_t *_l = (l);							\</span>
<span class="cp">	((sal_processor_static_info_t *)							\</span>
<span class="cp">	 ((char *) _l-&gt;info + ((_l-&gt;valid.num_cache_check + _l-&gt;valid.num_tlb_check		\</span>
<span class="cp">				+ _l-&gt;valid.num_bus_check + _l-&gt;valid.num_reg_file_check	\</span>
<span class="cp">				+ _l-&gt;valid.num_ms_check) * sizeof(sal_log_mod_error_info_t)	\</span>
<span class="cp">			       + sizeof(struct sal_cpuid_info))));				\</span>
<span class="cp">})</span>

<span class="cm">/* platform error log structures */</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_mem_dev_err_info</span> <span class="p">{</span>
	<span class="n">sal_log_section_hdr_t</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">error_status</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">physical_addr</span>   <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">addr_mask</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">node</span>            <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">card</span>            <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">module</span>          <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">bank</span>            <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">device</span>          <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">row</span>             <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">column</span>          <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">bit_position</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">requestor_id</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">responder_id</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">target_id</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">bus_spec_data</span>   <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">oem_id</span>          <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">oem_data</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved</span>        <span class="o">:</span> <span class="mi">47</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">error_status</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">physical_addr</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">addr_mask</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">node</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">card</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">module</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">bank</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">device</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">row</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">column</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">bit_position</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">requestor_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">responder_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">target_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bus_spec_data</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">oem_id</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">oem_data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>			<span class="cm">/* Variable length data */</span>
<span class="p">}</span> <span class="n">sal_log_mem_dev_err_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_sel_dev_err_info</span> <span class="p">{</span>
	<span class="n">sal_log_section_hdr_t</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">record_id</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">record_type</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">generator_id</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">evm_rev</span>         <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">sensor_type</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">sensor_num</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">event_dir</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">event_data1</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">event_data2</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">event_data3</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved</span>        <span class="o">:</span> <span class="mi">54</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">record_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">record_type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">timestamp</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">generator_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">evm_rev</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sensor_type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sensor_num</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">event_dir</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">event_data1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">event_data2</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">event_data3</span><span class="p">;</span>
<span class="p">}</span> <span class="n">sal_log_sel_dev_err_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_pci_bus_err_info</span> <span class="p">{</span>
	<span class="n">sal_log_section_hdr_t</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">err_status</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">err_type</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">bus_id</span>          <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">bus_address</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">bus_data</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">bus_cmd</span>         <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">requestor_id</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">responder_id</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">target_id</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">oem_data</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved</span>        <span class="o">:</span> <span class="mi">54</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">err_status</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">err_type</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">bus_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reserved</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bus_address</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bus_data</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bus_cmd</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">requestor_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">responder_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">target_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">oem_data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>			<span class="cm">/* Variable length data */</span>
<span class="p">}</span> <span class="n">sal_log_pci_bus_err_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_smbios_dev_err_info</span> <span class="p">{</span>
	<span class="n">sal_log_section_hdr_t</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">event_type</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">length</span>          <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">time_stamp</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">data</span>            <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved1</span>       <span class="o">:</span> <span class="mi">60</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">event_type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">length</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">time_stamp</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>			<span class="cm">/* data of variable length, length == slsmb_length */</span>
<span class="p">}</span> <span class="n">sal_log_smbios_dev_err_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_pci_comp_err_info</span> <span class="p">{</span>
	<span class="n">sal_log_section_hdr_t</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">err_status</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">comp_info</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">num_mem_regs</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">num_io_regs</span>     <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reg_data_pairs</span>  <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">oem_data</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved</span>        <span class="o">:</span> <span class="mi">58</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">err_status</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">vendor_id</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">device_id</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">class_code</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">u8</span> <span class="n">func_num</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">dev_num</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">bus_num</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">seg_num</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">reserved</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">comp_info</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">num_mem_regs</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">num_io_regs</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">reg_data_pairs</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="cm">/*</span>
<span class="cm">	 * array of address/data register pairs is num_mem_regs + num_io_regs elements</span>
<span class="cm">	 * long.  Each array element consists of a u64 address followed by a u64 data</span>
<span class="cm">	 * value.  The oem_data array immediately follows the reg_data_pairs array</span>
<span class="cm">	 */</span>
	<span class="n">u8</span> <span class="n">oem_data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>			<span class="cm">/* Variable length data */</span>
<span class="p">}</span> <span class="n">sal_log_pci_comp_err_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_plat_specific_err_info</span> <span class="p">{</span>
	<span class="n">sal_log_section_hdr_t</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">err_status</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">guid</span>            <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">oem_data</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved</span>        <span class="o">:</span> <span class="mi">61</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">err_status</span><span class="p">;</span>
	<span class="n">efi_guid_t</span> <span class="n">guid</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">oem_data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>			<span class="cm">/* platform specific variable length data */</span>
<span class="p">}</span> <span class="n">sal_log_plat_specific_err_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_host_ctlr_err_info</span> <span class="p">{</span>
	<span class="n">sal_log_section_hdr_t</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">err_status</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">requestor_id</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">responder_id</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">target_id</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">bus_spec_data</span>   <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">oem_data</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved</span>        <span class="o">:</span> <span class="mi">58</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">err_status</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">requestor_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">responder_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">target_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bus_spec_data</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">oem_data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>			<span class="cm">/* Variable length OEM data */</span>
<span class="p">}</span> <span class="n">sal_log_host_ctlr_err_info_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">sal_log_plat_bus_err_info</span> <span class="p">{</span>
	<span class="n">sal_log_section_hdr_t</span> <span class="n">header</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u64</span> <span class="n">err_status</span>      <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">requestor_id</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">responder_id</span>    <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">target_id</span>       <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">bus_spec_data</span>   <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">oem_data</span>        <span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
		    <span class="n">reserved</span>        <span class="o">:</span> <span class="mi">58</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">valid</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">err_status</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">requestor_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">responder_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">target_id</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bus_spec_data</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">oem_data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>			<span class="cm">/* Variable length OEM data */</span>
<span class="p">}</span> <span class="n">sal_log_plat_bus_err_info_t</span><span class="p">;</span>

<span class="cm">/* Overall platform error section structure */</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">sal_log_platform_err_info</span> <span class="p">{</span>
	<span class="n">sal_log_mem_dev_err_info_t</span> <span class="n">mem_dev_err</span><span class="p">;</span>
	<span class="n">sal_log_sel_dev_err_info_t</span> <span class="n">sel_dev_err</span><span class="p">;</span>
	<span class="n">sal_log_pci_bus_err_info_t</span> <span class="n">pci_bus_err</span><span class="p">;</span>
	<span class="n">sal_log_smbios_dev_err_info_t</span> <span class="n">smbios_dev_err</span><span class="p">;</span>
	<span class="n">sal_log_pci_comp_err_info_t</span> <span class="n">pci_comp_err</span><span class="p">;</span>
	<span class="n">sal_log_plat_specific_err_info_t</span> <span class="n">plat_specific_err</span><span class="p">;</span>
	<span class="n">sal_log_host_ctlr_err_info_t</span> <span class="n">host_ctlr_err</span><span class="p">;</span>
	<span class="n">sal_log_plat_bus_err_info_t</span> <span class="n">plat_bus_err</span><span class="p">;</span>
<span class="p">}</span> <span class="n">sal_log_platform_err_info_t</span><span class="p">;</span>

<span class="cm">/* SAL log over-all, multi-section error record structure (processor+platform) */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">err_rec</span> <span class="p">{</span>
	<span class="n">sal_log_record_header_t</span> <span class="n">sal_elog_header</span><span class="p">;</span>
	<span class="n">sal_log_processor_info_t</span> <span class="n">proc_err</span><span class="p">;</span>
	<span class="n">sal_log_platform_err_info_t</span> <span class="n">plat_err</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">oem_data_pad</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<span class="p">}</span> <span class="n">ia64_err_rec_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Now define a couple of inline functions for improved type checking</span>
<span class="cm"> * and convenience.</span>
<span class="cm"> */</span>

<span class="k">extern</span> <span class="n">s64</span> <span class="n">ia64_sal_cache_flush</span> <span class="p">(</span><span class="n">u64</span> <span class="n">cache_type</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__init</span> <span class="n">check_sal_cache_flush</span> <span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cm">/* Initialize all the processor and platform level instruction and data caches */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_sal_cache_init</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_CACHE_INIT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Clear the processor and platform information logged by SAL with respect to the machine</span>
<span class="cm"> * state at the time of MCA&#39;s, INITs, CMCs, or CPEs.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_sal_clear_state_info</span> <span class="p">(</span><span class="n">u64</span> <span class="n">sal_info_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL_REENTRANT</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_CLEAR_STATE_INFO</span><span class="p">,</span> <span class="n">sal_info_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	              <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* Get the processor and platform information logged by SAL with respect to the machine</span>
<span class="cm"> * state at the time of the MCAs, INITs, CMCs, or CPEs.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u64</span>
<span class="nf">ia64_sal_get_state_info</span> <span class="p">(</span><span class="n">u64</span> <span class="n">sal_info_type</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">sal_info</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL_REENTRANT</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_GET_STATE_INFO</span><span class="p">,</span> <span class="n">sal_info_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	              <span class="n">sal_info</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Get the maximum size of the information logged by SAL with respect to the machine state</span>
<span class="cm"> * at the time of MCAs, INITs, CMCs, or CPEs.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">u64</span>
<span class="nf">ia64_sal_get_state_info_size</span> <span class="p">(</span><span class="n">u64</span> <span class="n">sal_info_type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL_REENTRANT</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_GET_STATE_INFO_SIZE</span><span class="p">,</span> <span class="n">sal_info_type</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	              <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Causes the processor to go into a spin loop within SAL where SAL awaits a wakeup from</span>
<span class="cm"> * the monarch processor.  Must not lock, because it will not return on any cpu until the</span>
<span class="cm"> * monarch processor sends a wake up.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_sal_mc_rendez</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL_NOLOCK</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_MC_RENDEZ</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Allow the OS to specify the interrupt number to be used by SAL to interrupt OS during</span>
<span class="cm"> * the machine check rendezvous sequence as well as the mechanism to wake up the</span>
<span class="cm"> * non-monarch processor at the end of machine check processing.</span>
<span class="cm"> * Returns the complete ia64_sal_retval because some calls return more than just a status</span>
<span class="cm"> * value.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">ia64_sal_retval</span>
<span class="nf">ia64_sal_mc_set_params</span> <span class="p">(</span><span class="n">u64</span> <span class="n">param_type</span><span class="p">,</span> <span class="n">u64</span> <span class="n">i_or_m</span><span class="p">,</span> <span class="n">u64</span> <span class="n">i_or_m_val</span><span class="p">,</span> <span class="n">u64</span> <span class="n">timeout</span><span class="p">,</span> <span class="n">u64</span> <span class="n">rz_always</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_MC_SET_PARAMS</span><span class="p">,</span> <span class="n">param_type</span><span class="p">,</span> <span class="n">i_or_m</span><span class="p">,</span> <span class="n">i_or_m_val</span><span class="p">,</span>
		 <span class="n">timeout</span><span class="p">,</span> <span class="n">rz_always</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">isrv</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Read from PCI configuration space */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_sal_pci_config_read</span> <span class="p">(</span><span class="n">u64</span> <span class="n">pci_config_addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="n">u64</span> <span class="n">size</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_PCI_CONFIG_READ</span><span class="p">,</span> <span class="n">pci_config_addr</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span>
		<span class="o">*</span><span class="n">value</span> <span class="o">=</span> <span class="n">isrv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Write to PCI configuration space */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_sal_pci_config_write</span> <span class="p">(</span><span class="n">u64</span> <span class="n">pci_config_addr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="n">u64</span> <span class="n">size</span><span class="p">,</span> <span class="n">u64</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_PCI_CONFIG_WRITE</span><span class="p">,</span> <span class="n">pci_config_addr</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
	         <span class="n">type</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Register physical addresses of locations needed by SAL when SAL procedures are invoked</span>
<span class="cm"> * in virtual mode.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_sal_register_physical_addr</span> <span class="p">(</span><span class="n">u64</span> <span class="n">phys_entry</span><span class="p">,</span> <span class="n">u64</span> <span class="n">phys_addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_REGISTER_PHYSICAL_ADDR</span><span class="p">,</span> <span class="n">phys_entry</span><span class="p">,</span> <span class="n">phys_addr</span><span class="p">,</span>
	         <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Register software dependent code locations within SAL. These locations are handlers or</span>
<span class="cm"> * entry points where SAL will pass control for the specified event. These event handlers</span>
<span class="cm"> * are for the bott rendezvous, MCAs and INIT scenarios.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_sal_set_vectors</span> <span class="p">(</span><span class="n">u64</span> <span class="n">vector_type</span><span class="p">,</span>
		      <span class="n">u64</span> <span class="n">handler_addr1</span><span class="p">,</span> <span class="n">u64</span> <span class="n">gp1</span><span class="p">,</span> <span class="n">u64</span> <span class="n">handler_len1</span><span class="p">,</span>
		      <span class="n">u64</span> <span class="n">handler_addr2</span><span class="p">,</span> <span class="n">u64</span> <span class="n">gp2</span><span class="p">,</span> <span class="n">u64</span> <span class="n">handler_len2</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_SET_VECTORS</span><span class="p">,</span> <span class="n">vector_type</span><span class="p">,</span>
			<span class="n">handler_addr1</span><span class="p">,</span> <span class="n">gp1</span><span class="p">,</span> <span class="n">handler_len1</span><span class="p">,</span>
			<span class="n">handler_addr2</span><span class="p">,</span> <span class="n">gp2</span><span class="p">,</span> <span class="n">handler_len2</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Update the contents of PAL block in the non-volatile storage device */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_sal_update_pal</span> <span class="p">(</span><span class="n">u64</span> <span class="n">param_buf</span><span class="p">,</span> <span class="n">u64</span> <span class="n">scratch_buf</span><span class="p">,</span> <span class="n">u64</span> <span class="n">scratch_buf_size</span><span class="p">,</span>
		     <span class="n">u64</span> <span class="o">*</span><span class="n">error_code</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="n">scratch_buf_size_needed</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>
	<span class="n">SAL_CALL</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_UPDATE_PAL</span><span class="p">,</span> <span class="n">param_buf</span><span class="p">,</span> <span class="n">scratch_buf</span><span class="p">,</span> <span class="n">scratch_buf_size</span><span class="p">,</span>
	         <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">error_code</span><span class="p">)</span>
		<span class="o">*</span><span class="n">error_code</span> <span class="o">=</span> <span class="n">isrv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">scratch_buf_size_needed</span><span class="p">)</span>
		<span class="o">*</span><span class="n">scratch_buf_size_needed</span> <span class="o">=</span> <span class="n">isrv</span><span class="p">.</span><span class="n">v1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Get physical processor die mapping in the platform. */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="n">s64</span>
<span class="nf">ia64_sal_physical_id_info</span><span class="p">(</span><span class="n">u16</span> <span class="o">*</span><span class="n">splid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="n">isrv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sal_revision</span> <span class="o">&lt;</span> <span class="n">SAL_VERSION_CODE</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">SAL_CALL</span><span class="p">(</span><span class="n">isrv</span><span class="p">,</span> <span class="n">SAL_PHYSICAL_ID_INFO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">splid</span><span class="p">)</span>
		<span class="o">*</span><span class="n">splid</span> <span class="o">=</span> <span class="n">isrv</span><span class="p">.</span><span class="n">v0</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">isrv</span><span class="p">.</span><span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">sal_platform_features</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">salinfo_platform_oemdata</span><span class="p">)(</span><span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="p">,</span> <span class="n">u8</span> <span class="o">**</span><span class="p">,</span> <span class="n">u64</span> <span class="o">*</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">sal_ret_values</span> <span class="p">{</span>
	<span class="kt">long</span> <span class="n">r8</span><span class="p">;</span> <span class="kt">long</span> <span class="n">r9</span><span class="p">;</span> <span class="kt">long</span> <span class="n">r10</span><span class="p">;</span> <span class="kt">long</span> <span class="n">r11</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define IA64_SAL_OEMFUNC_MIN		0x02000000</span>
<span class="cp">#define IA64_SAL_OEMFUNC_MAX		0x03ffffff</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">ia64_sal_oemcall</span><span class="p">(</span><span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="o">*</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span>
			    <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ia64_sal_oemcall_nolock</span><span class="p">(</span><span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="o">*</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span>
				   <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">ia64_sal_oemcall_reentrant</span><span class="p">(</span><span class="k">struct</span> <span class="n">ia64_sal_retval</span> <span class="o">*</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span>
				      <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">u64</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">long</span>
<span class="n">ia64_sal_freq_base</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">which</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">ticks_per_second</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">*</span><span class="n">drift_info</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_HOTPLUG_CPU</span>
<span class="cm">/*</span>
<span class="cm"> * System Abstraction Layer Specification</span>
<span class="cm"> * Section 3.2.5.1: OS_BOOT_RENDEZ to SAL return State.</span>
<span class="cm"> * Note: region regs are stored first in head.S _start. Hence they must</span>
<span class="cm"> * stay up front.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">sal_to_os_boot</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">rr</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>		<span class="cm">/* Region Registers */</span>
	<span class="n">u64</span> <span class="n">br</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>		<span class="cm">/* br0:</span>
<span class="cm">				 * return addr into SAL boot rendez routine */</span>
	<span class="n">u64</span> <span class="n">gr1</span><span class="p">;</span>		<span class="cm">/* SAL:GP */</span>
	<span class="n">u64</span> <span class="n">gr12</span><span class="p">;</span>		<span class="cm">/* SAL:SP */</span>
	<span class="n">u64</span> <span class="n">gr13</span><span class="p">;</span>		<span class="cm">/* SAL: Task Pointer */</span>
	<span class="n">u64</span> <span class="n">fpsr</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">pfs</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">rnat</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">unat</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bspstore</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">dcr</span><span class="p">;</span>		<span class="cm">/* Default Control Register */</span>
	<span class="n">u64</span> <span class="n">iva</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">pta</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">itv</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">pmv</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">cmcv</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">lrr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">gr</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u64</span> <span class="n">pr</span><span class="p">;</span>			<span class="cm">/* Predicate registers */</span>
	<span class="n">u64</span> <span class="n">lc</span><span class="p">;</span>			<span class="cm">/* Loop Count */</span>
	<span class="k">struct</span> <span class="n">ia64_fpreg</span> <span class="n">fp</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * Global array allocated for NR_CPUS at boot time</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">sal_to_os_boot</span> <span class="n">sal_boot_rendez_state</span><span class="p">[</span><span class="n">NR_CPUS</span><span class="p">];</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_jump_to_sal</span><span class="p">(</span><span class="k">struct</span> <span class="n">sal_to_os_boot</span> <span class="o">*</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">ia64_sal_handler_init</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">entry_point</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">gpval</span><span class="p">);</span>

<span class="cp">#define PALO_MAX_TLB_PURGES	0xFFFF</span>
<span class="cp">#define PALO_SIG	&quot;PALO&quot;</span>

<span class="k">struct</span> <span class="n">palo_table</span> <span class="p">{</span>
	<span class="n">u8</span>  <span class="n">signature</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* Should be &quot;PALO&quot; */</span>
	<span class="n">u32</span> <span class="n">length</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">minor_revision</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">major_revision</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">checksum</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">reserved1</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="n">u16</span> <span class="n">max_tlb_purges</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">reserved2</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define NPTCG_FROM_PAL			0</span>
<span class="cp">#define NPTCG_FROM_PALO			1</span>
<span class="cp">#define NPTCG_FROM_KERNEL_PARAMETER	2</span>

<span class="cp">#endif </span><span class="cm">/* __ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _ASM_IA64_SAL_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
