<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › include › asm › native › pvchk_inst.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>pvchk_inst.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_NATIVE_PVCHK_INST_H</span>
<span class="cp">#define _ASM_NATIVE_PVCHK_INST_H</span>

<span class="cm">/******************************************************************************</span>
<span class="cm"> * arch/ia64/include/asm/native/pvchk_inst.h</span>
<span class="cm"> * Checker for paravirtualizations of privileged operations.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2005 Hewlett-Packard Co</span>
<span class="cm"> *      Dan Magenheimer &lt;dan.magenheimer@hp.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2008 Isaku Yamahata &lt;yamahata at valinux co jp&gt;</span>
<span class="cm"> *                    VA Linux Systems Japan K.K.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/**********************************************</span>
<span class="cm"> * Instructions paravirtualized for correctness</span>
<span class="cm"> **********************************************/</span>

<span class="cm">/* &quot;fc&quot; and &quot;thash&quot; are privilege-sensitive instructions, meaning they</span>
<span class="cm"> *  may have different semantics depending on whether they are executed</span>
<span class="cm"> *  at PL0 vs PL!=0.  When paravirtualized, these instructions mustn&#39;t</span>
<span class="cm"> *  be allowed to execute directly, lest incorrect semantics result.</span>
<span class="cm"> */</span>

<span class="cp">#define fc	.error &quot;fc should not be used directly.&quot;</span>
<span class="cp">#define thash	.error &quot;thash should not be used directly.&quot;</span>

<span class="cm">/* Note that &quot;ttag&quot; and &quot;cover&quot; are also privilege-sensitive; &quot;ttag&quot;</span>
<span class="cm"> * is not currently used (though it may be in a long-format VHPT system!)</span>
<span class="cm"> * and the semantics of cover only change if psr.ic is off which is very</span>
<span class="cm"> * rare (and currently non-existent outside of assembly code</span>
<span class="cm"> */</span>
<span class="cp">#define ttag	.error &quot;ttag should not be used directly.&quot;</span>
<span class="cp">#define cover	.error &quot;cover should not be used directly.&quot;</span>

<span class="cm">/* There are also privilege-sensitive registers.  These registers are</span>
<span class="cm"> * readable at any privilege level but only writable at PL0.</span>
<span class="cm"> */</span>
<span class="cp">#define cpuid	.error &quot;cpuid should not be used directly.&quot;</span>
<span class="cp">#define pmd	.error &quot;pmd should not be used directly.&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * mov ar.eflag =</span>
<span class="cm"> * mov = ar.eflag</span>
<span class="cm"> */</span>

<span class="cm">/**********************************************</span>
<span class="cm"> * Instructions paravirtualized for performance</span>
<span class="cm"> **********************************************/</span>
<span class="cm">/*</span>
<span class="cm"> * Those instructions include &#39;.&#39; which can&#39;t be handled by cpp.</span>
<span class="cm"> * or can&#39;t be handled by cpp easily.</span>
<span class="cm"> * They are handled by sed instead of cpp.</span>
<span class="cm"> */</span>

<span class="cm">/* for .S</span>
<span class="cm"> * itc.i</span>
<span class="cm"> * itc.d</span>
<span class="cm"> *</span>
<span class="cm"> * bsw.0</span>
<span class="cm"> * bsw.1</span>
<span class="cm"> *</span>
<span class="cm"> * ssm psr.ic | PSR_DEFAULT_BITS</span>
<span class="cm"> * ssm psr.ic</span>
<span class="cm"> * rsm psr.ic</span>
<span class="cm"> * ssm psr.i</span>
<span class="cm"> * rsm psr.i</span>
<span class="cm"> * rsm psr.i | psr.ic</span>
<span class="cm"> * rsm psr.dt</span>
<span class="cm"> * ssm psr.dt</span>
<span class="cm"> *</span>
<span class="cm"> * mov = cr.ifa</span>
<span class="cm"> * mov = cr.itir</span>
<span class="cm"> * mov = cr.isr</span>
<span class="cm"> * mov = cr.iha</span>
<span class="cm"> * mov = cr.ipsr</span>
<span class="cm"> * mov = cr.iim</span>
<span class="cm"> * mov = cr.iip</span>
<span class="cm"> * mov = cr.ivr</span>
<span class="cm"> * mov = psr</span>
<span class="cm"> *</span>
<span class="cm"> * mov cr.ifa =</span>
<span class="cm"> * mov cr.itir =</span>
<span class="cm"> * mov cr.iha =</span>
<span class="cm"> * mov cr.ipsr =</span>
<span class="cm"> * mov cr.ifs =</span>
<span class="cm"> * mov cr.iip =</span>
<span class="cm"> * mov cr.kr =</span>
<span class="cm"> */</span>

<span class="cm">/* for intrinsics</span>
<span class="cm"> * ssm psr.i</span>
<span class="cm"> * rsm psr.i</span>
<span class="cm"> * mov = psr</span>
<span class="cm"> * mov = ivr</span>
<span class="cm"> * mov = tpr</span>
<span class="cm"> * mov cr.itm =</span>
<span class="cm"> * mov eoi =</span>
<span class="cm"> * mov rr[] =</span>
<span class="cm"> * mov = rr[]</span>
<span class="cm"> * mov = kr</span>
<span class="cm"> * mov kr =</span>
<span class="cm"> * ptc.ga</span>
<span class="cm"> */</span>

<span class="cm">/*************************************************************</span>
<span class="cm"> * define paravirtualized instrcution macros as nop to ingore.</span>
<span class="cm"> * and check whether arguments are appropriate.</span>
<span class="cm"> *************************************************************/</span>

<span class="cm">/* check whether reg is a regular register */</span>
<span class="p">.</span><span class="n">macro</span> <span class="n">is_rreg_in</span> <span class="n">reg</span>
	<span class="p">.</span><span class="n">ifc</span> <span class="s">&quot;</span><span class="se">\r</span><span class="s">eg&quot;</span><span class="p">,</span> <span class="s">&quot;r0&quot;</span>
		<span class="n">nop</span> <span class="mi">0</span>
		<span class="p">.</span><span class="n">exitm</span>
	<span class="p">.</span><span class="n">endif</span>
	<span class="p">;;</span>
	<span class="n">mov</span> <span class="err">\</span><span class="n">reg</span> <span class="o">=</span> <span class="n">r0</span>
	<span class="p">;;</span>
<span class="p">.</span><span class="n">endm</span>
<span class="cp">#define IS_RREG_IN(reg)	is_rreg_in reg ;</span>

<span class="cp">#define IS_RREG_OUT(reg)			\</span>
<span class="cp">	;;					\</span>
<span class="cp">	mov reg = r0				\</span>
<span class="cp">	;;</span>

<span class="cp">#define IS_RREG_CLOB(reg)	IS_RREG_OUT(reg)</span>

<span class="cm">/* check whether pred is a predicate register */</span>
<span class="cp">#define IS_PRED_IN(pred)			\</span>
<span class="cp">	;;					\</span>
<span class="cp">	(pred)	nop 0				\</span>
<span class="cp">	;;</span>

<span class="cp">#define IS_PRED_OUT(pred)			\</span>
<span class="cp">	;;					\</span>
<span class="cp">	cmp.eq pred, p0 = r0, r0		\</span>
<span class="cp">	;;</span>

<span class="cp">#define IS_PRED_CLOB(pred)	IS_PRED_OUT(pred)</span>


<span class="cp">#define DO_SAVE_MIN(__COVER, SAVE_IFS, EXTRA, WORKAROUND)	\</span>
<span class="cp">	nop 0</span>
<span class="cp">#define MOV_FROM_IFA(reg)			\</span>
<span class="cp">	IS_RREG_OUT(reg)</span>
<span class="cp">#define MOV_FROM_ITIR(reg)			\</span>
<span class="cp">	IS_RREG_OUT(reg)</span>
<span class="cp">#define MOV_FROM_ISR(reg)			\</span>
<span class="cp">	IS_RREG_OUT(reg)</span>
<span class="cp">#define MOV_FROM_IHA(reg)			\</span>
<span class="cp">	IS_RREG_OUT(reg)</span>
<span class="cp">#define MOV_FROM_IPSR(pred, reg)		\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_RREG_OUT(reg)</span>
<span class="cp">#define MOV_FROM_IIM(reg)			\</span>
<span class="cp">	IS_RREG_OUT(reg)</span>
<span class="cp">#define MOV_FROM_IIP(reg)			\</span>
<span class="cp">	IS_RREG_OUT(reg)</span>
<span class="cp">#define MOV_FROM_IVR(reg, clob)			\</span>
<span class="cp">	IS_RREG_OUT(reg)			\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define MOV_FROM_PSR(pred, reg, clob)		\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_RREG_OUT(reg)			\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define MOV_FROM_ITC(pred, pred_clob, reg, clob)	\</span>
<span class="cp">	IS_PRED_IN(pred)				\</span>
<span class="cp">	IS_PRED_CLOB(pred_clob)				\</span>
<span class="cp">	IS_RREG_OUT(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define MOV_TO_IFA(reg, clob)			\</span>
<span class="cp">	IS_RREG_IN(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define MOV_TO_ITIR(pred, reg, clob)		\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_RREG_IN(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define MOV_TO_IHA(pred, reg, clob)		\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_RREG_IN(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define MOV_TO_IPSR(pred, reg, clob)		\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_RREG_IN(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define MOV_TO_IFS(pred, reg, clob)		\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_RREG_IN(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define MOV_TO_IIP(reg, clob)			\</span>
<span class="cp">	IS_RREG_IN(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define MOV_TO_KR(kr, reg, clob0, clob1)	\</span>
<span class="cp">	IS_RREG_IN(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob0)			\</span>
<span class="cp">	IS_RREG_CLOB(clob1)</span>
<span class="cp">#define ITC_I(pred, reg, clob)			\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_RREG_IN(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define ITC_D(pred, reg, clob)			\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_RREG_IN(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define ITC_I_AND_D(pred_i, pred_d, reg, clob)	\</span>
<span class="cp">	IS_PRED_IN(pred_i)			\</span>
<span class="cp">	IS_PRED_IN(pred_d)			\</span>
<span class="cp">	IS_RREG_IN(reg)				\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define THASH(pred, reg0, reg1, clob)		\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_RREG_OUT(reg0)			\</span>
<span class="cp">	IS_RREG_IN(reg1)			\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define SSM_PSR_IC_AND_DEFAULT_BITS_AND_SRLZ_I(clob0, clob1)	\</span>
<span class="cp">	IS_RREG_CLOB(clob0)					\</span>
<span class="cp">	IS_RREG_CLOB(clob1)</span>
<span class="cp">#define SSM_PSR_IC_AND_SRLZ_D(clob0, clob1)	\</span>
<span class="cp">	IS_RREG_CLOB(clob0)			\</span>
<span class="cp">	IS_RREG_CLOB(clob1)</span>
<span class="cp">#define RSM_PSR_IC(clob)			\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define SSM_PSR_I(pred, pred_clob, clob)	\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_PRED_CLOB(pred_clob)			\</span>
<span class="cp">	IS_RREG_CLOB(clob)</span>
<span class="cp">#define RSM_PSR_I(pred, clob0, clob1)		\</span>
<span class="cp">	IS_PRED_IN(pred)			\</span>
<span class="cp">	IS_RREG_CLOB(clob0)			\</span>
<span class="cp">	IS_RREG_CLOB(clob1)</span>
<span class="cp">#define RSM_PSR_I_IC(clob0, clob1, clob2)	\</span>
<span class="cp">	IS_RREG_CLOB(clob0)			\</span>
<span class="cp">	IS_RREG_CLOB(clob1)			\</span>
<span class="cp">	IS_RREG_CLOB(clob2)</span>
<span class="cp">#define RSM_PSR_DT				\</span>
<span class="cp">	nop 0</span>
<span class="cp">#define RSM_PSR_BE_I(clob0, clob1)		\</span>
<span class="cp">	IS_RREG_CLOB(clob0)			\</span>
<span class="cp">	IS_RREG_CLOB(clob1)</span>
<span class="cp">#define SSM_PSR_DT_AND_SRLZ_I			\</span>
<span class="cp">	nop 0</span>
<span class="cp">#define BSW_0(clob0, clob1, clob2)		\</span>
<span class="cp">	IS_RREG_CLOB(clob0)			\</span>
<span class="cp">	IS_RREG_CLOB(clob1)			\</span>
<span class="cp">	IS_RREG_CLOB(clob2)</span>
<span class="cp">#define BSW_1(clob0, clob1)			\</span>
<span class="cp">	IS_RREG_CLOB(clob0)			\</span>
<span class="cp">	IS_RREG_CLOB(clob1)</span>
<span class="cp">#define COVER					\</span>
<span class="cp">	nop 0</span>
<span class="cp">#define RFI					\</span>
<span class="cp">	br.ret.sptk.many rp </span><span class="cm">/* defining nop causes dependency error */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _ASM_NATIVE_PVCHK_INST_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
