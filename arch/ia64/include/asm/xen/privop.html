<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › ia64 › include › asm › xen › privop.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>privop.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef _ASM_IA64_XEN_PRIVOP_H</span>
<span class="cp">#define _ASM_IA64_XEN_PRIVOP_H</span>

<span class="cm">/*</span>
<span class="cm"> * Copyright (C) 2005 Hewlett-Packard Co</span>
<span class="cm"> *	Dan Magenheimer &lt;dan.magenheimer@hp.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Paravirtualizations of privileged operations for Xen/ia64</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * inline privop and paravirt_alt support</span>
<span class="cm"> * Copyright (c) 2007 Isaku Yamahata &lt;yamahata at valinux co jp&gt;</span>
<span class="cm"> *                    VA Linux Systems Japan K.K.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ASSEMBLY__</span>
<span class="cp">#include &lt;linux/types.h&gt;		</span><span class="cm">/* arch-ia64.h requires uint64_t */</span><span class="cp"></span>
<span class="cp">#endif</span>
<span class="cp">#include &lt;asm/xen/interface.h&gt;</span>

<span class="cm">/* At 1 MB, before per-cpu space but still addressable using addl instead</span>
<span class="cm">   of movl. */</span>
<span class="cp">#define XSI_BASE			0xfffffffffff00000</span>

<span class="cm">/* Address of mapped regs.  */</span>
<span class="cp">#define XMAPPEDREGS_BASE		(XSI_BASE + XSI_SIZE)</span>

<span class="cp">#ifdef __ASSEMBLY__</span>
<span class="cp">#define XEN_HYPER_RFI			break HYPERPRIVOP_RFI</span>
<span class="cp">#define XEN_HYPER_RSM_PSR_DT		break HYPERPRIVOP_RSM_DT</span>
<span class="cp">#define XEN_HYPER_SSM_PSR_DT		break HYPERPRIVOP_SSM_DT</span>
<span class="cp">#define XEN_HYPER_COVER			break HYPERPRIVOP_COVER</span>
<span class="cp">#define XEN_HYPER_ITC_D			break HYPERPRIVOP_ITC_D</span>
<span class="cp">#define XEN_HYPER_ITC_I			break HYPERPRIVOP_ITC_I</span>
<span class="cp">#define XEN_HYPER_SSM_I			break HYPERPRIVOP_SSM_I</span>
<span class="cp">#define XEN_HYPER_GET_IVR		break HYPERPRIVOP_GET_IVR</span>
<span class="cp">#define XEN_HYPER_THASH			break HYPERPRIVOP_THASH</span>
<span class="cp">#define XEN_HYPER_ITR_D			break HYPERPRIVOP_ITR_D</span>
<span class="cp">#define XEN_HYPER_SET_KR		break HYPERPRIVOP_SET_KR</span>
<span class="cp">#define XEN_HYPER_GET_PSR		break HYPERPRIVOP_GET_PSR</span>
<span class="cp">#define XEN_HYPER_SET_RR0_TO_RR4	break HYPERPRIVOP_SET_RR0_TO_RR4</span>

<span class="cp">#define XSI_IFS				(XSI_BASE + XSI_IFS_OFS)</span>
<span class="cp">#define XSI_PRECOVER_IFS		(XSI_BASE + XSI_PRECOVER_IFS_OFS)</span>
<span class="cp">#define XSI_IFA				(XSI_BASE + XSI_IFA_OFS)</span>
<span class="cp">#define XSI_ISR				(XSI_BASE + XSI_ISR_OFS)</span>
<span class="cp">#define XSI_IIM				(XSI_BASE + XSI_IIM_OFS)</span>
<span class="cp">#define XSI_ITIR			(XSI_BASE + XSI_ITIR_OFS)</span>
<span class="cp">#define XSI_PSR_I_ADDR			(XSI_BASE + XSI_PSR_I_ADDR_OFS)</span>
<span class="cp">#define XSI_PSR_IC			(XSI_BASE + XSI_PSR_IC_OFS)</span>
<span class="cp">#define XSI_IPSR			(XSI_BASE + XSI_IPSR_OFS)</span>
<span class="cp">#define XSI_IIP				(XSI_BASE + XSI_IIP_OFS)</span>
<span class="cp">#define XSI_B1NAT			(XSI_BASE + XSI_B1NATS_OFS)</span>
<span class="cp">#define XSI_BANK1_R16			(XSI_BASE + XSI_BANK1_R16_OFS)</span>
<span class="cp">#define XSI_BANKNUM			(XSI_BASE + XSI_BANKNUM_OFS)</span>
<span class="cp">#define XSI_IHA				(XSI_BASE + XSI_IHA_OFS)</span>
<span class="cp">#define XSI_ITC_OFFSET			(XSI_BASE + XSI_ITC_OFFSET_OFS)</span>
<span class="cp">#define XSI_ITC_LAST			(XSI_BASE + XSI_ITC_LAST_OFS)</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef __ASSEMBLY__</span>

<span class="cm">/************************************************/</span>
<span class="cm">/* Instructions paravirtualized for correctness */</span>
<span class="cm">/************************************************/</span>

<span class="cm">/* &quot;fc&quot; and &quot;thash&quot; are privilege-sensitive instructions, meaning they</span>
<span class="cm"> *  may have different semantics depending on whether they are executed</span>
<span class="cm"> *  at PL0 vs PL!=0.  When paravirtualized, these instructions mustn&#39;t</span>
<span class="cm"> *  be allowed to execute directly, lest incorrect semantics result. */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xen_fc</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">xen_thash</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">);</span>

<span class="cm">/* Note that &quot;ttag&quot; and &quot;cover&quot; are also privilege-sensitive; &quot;ttag&quot;</span>
<span class="cm"> * is not currently used (though it may be in a long-format VHPT system!)</span>
<span class="cm"> * and the semantics of cover only change if psr.ic is off which is very</span>
<span class="cm"> * rare (and currently non-existent outside of assembly code */</span>

<span class="cm">/* There are also privilege-sensitive registers.  These registers are</span>
<span class="cm"> * readable at any privilege level but only writable at PL0. */</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">xen_get_cpuid</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">xen_get_pmd</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">);</span>

<span class="cp">#ifndef ASM_SUPPORTED</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">xen_get_eflag</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>	<span class="cm">/* see xen_ia64_getreg */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xen_set_eflag</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>	<span class="cm">/* see xen_ia64_setreg */</span>
<span class="cp">#endif</span>

<span class="cm">/************************************************/</span>
<span class="cm">/* Instructions paravirtualized for performance */</span>
<span class="cm">/************************************************/</span>

<span class="cm">/* Xen uses memory-mapped virtual privileged registers for access to many</span>
<span class="cm"> * performance-sensitive privileged registers.  Some, like the processor</span>
<span class="cm"> * status register (psr), are broken up into multiple memory locations.</span>
<span class="cm"> * Others, like &quot;pend&quot;, are abstractions based on privileged registers.</span>
<span class="cm"> * &quot;Pend&quot; is guaranteed to be set if reading cr.ivr would return a</span>
<span class="cm"> * (non-spurious) interrupt. */</span>
<span class="cp">#define XEN_MAPPEDREGS ((struct mapped_regs *)XMAPPEDREGS_BASE)</span>

<span class="cp">#define XSI_PSR_I			\</span>
<span class="cp">	(*XEN_MAPPEDREGS-&gt;interrupt_mask_addr)</span>
<span class="cp">#define xen_get_virtual_psr_i()		\</span>
<span class="cp">	(!XSI_PSR_I)</span>
<span class="cp">#define xen_set_virtual_psr_i(_val)	\</span>
<span class="cp">	({ XSI_PSR_I = (uint8_t)(_val) ? 0 : 1; })</span>
<span class="cp">#define xen_set_virtual_psr_ic(_val)	\</span>
<span class="cp">	({ XEN_MAPPEDREGS-&gt;interrupt_collection_enabled = _val ? 1 : 0; })</span>
<span class="cp">#define xen_get_virtual_pend()		\</span>
<span class="cp">	(*(((uint8_t *)XEN_MAPPEDREGS-&gt;interrupt_mask_addr) - 1))</span>

<span class="cp">#ifndef ASM_SUPPORTED</span>
<span class="cm">/* Although all privileged operations can be left to trap and will</span>
<span class="cm"> * be properly handled by Xen, some are frequent enough that we use</span>
<span class="cm"> * hyperprivops for performance. */</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">xen_get_psr</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">xen_get_ivr</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">xen_get_tpr</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xen_hyper_ssm_i</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xen_set_itm</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xen_set_tpr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xen_eoi</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">xen_get_rr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">index</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xen_set_rr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">index</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xen_set_rr0_to_rr4</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val0</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val1</span><span class="p">,</span>
			       <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val2</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val3</span><span class="p">,</span>
			       <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val4</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xen_set_kr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">index</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">val</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">xen_ptcga</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>
<span class="cp">#endif </span><span class="cm">/* !ASM_SUPPORTED */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* !__ASSEMBLY__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* _ASM_IA64_XEN_PRIVOP_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
