<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › alpha › kernel › machvec_impl.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>machvec_impl.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *	linux/arch/alpha/kernel/machvec_impl.h</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright (C) 1997, 1998  Richard Henderson</span>
<span class="cm"> *</span>
<span class="cm"> * This file has goodies to help simplify instantiation of machine vectors.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;asm/pgalloc.h&gt;</span>

<span class="cm">/* Whee.  These systems don&#39;t have an HAE:</span>
<span class="cm">       IRONGATE, MARVEL, POLARIS, TSUNAMI, TITAN, WILDFIRE</span>
<span class="cm">   Fix things up for the GENERIC kernel by defining the HAE address</span>
<span class="cm">   to be that of the cache. Now we can read and write it as we like.  ;-)  */</span>
<span class="cp">#define IRONGATE_HAE_ADDRESS	(&amp;alpha_mv.hae_cache)</span>
<span class="cp">#define MARVEL_HAE_ADDRESS	(&amp;alpha_mv.hae_cache)</span>
<span class="cp">#define POLARIS_HAE_ADDRESS	(&amp;alpha_mv.hae_cache)</span>
<span class="cp">#define TSUNAMI_HAE_ADDRESS	(&amp;alpha_mv.hae_cache)</span>
<span class="cp">#define TITAN_HAE_ADDRESS	(&amp;alpha_mv.hae_cache)</span>
<span class="cp">#define WILDFIRE_HAE_ADDRESS	(&amp;alpha_mv.hae_cache)</span>

<span class="cp">#ifdef CIA_ONE_HAE_WINDOW</span>
<span class="cp">#define CIA_HAE_ADDRESS		(&amp;alpha_mv.hae_cache)</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef MCPCIA_ONE_HAE_WINDOW</span>
<span class="cp">#define MCPCIA_HAE_ADDRESS	(&amp;alpha_mv.hae_cache)</span>
<span class="cp">#endif</span>
<span class="cp">#ifdef T2_ONE_HAE_WINDOW</span>
<span class="cp">#define T2_HAE_ADDRESS		(&amp;alpha_mv.hae_cache)</span>
<span class="cp">#endif</span>

<span class="cm">/* Only a few systems don&#39;t define IACK_SC, handling all interrupts through</span>
<span class="cm">   the SRM console.  But splitting out that one case from IO() below</span>
<span class="cm">   seems like such a pain.  Define this to get things to compile.  */</span>
<span class="cp">#define JENSEN_IACK_SC		1</span>
<span class="cp">#define T2_IACK_SC		1</span>
<span class="cp">#define WILDFIRE_IACK_SC	1 </span><span class="cm">/* FIXME */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * Some helpful macros for filling in the blanks.</span>
<span class="cm"> */</span>

<span class="cp">#define CAT1(x,y)  x##y</span>
<span class="cp">#define CAT(x,y)   CAT1(x,y)</span>

<span class="cp">#define DO_DEFAULT_RTC \</span>
<span class="cp">	.rtc_port = 0x70, \</span>
<span class="cp">	.rtc_get_time = common_get_rtc_time, \</span>
<span class="cp">	.rtc_set_time = common_set_rtc_time</span>

<span class="cp">#define DO_EV4_MMU							\</span>
<span class="cp">	.max_asn =			EV4_MAX_ASN,			\</span>
<span class="cp">	.mv_switch_mm =			ev4_switch_mm,			\</span>
<span class="cp">	.mv_activate_mm =		ev4_activate_mm,		\</span>
<span class="cp">	.mv_flush_tlb_current =		ev4_flush_tlb_current,		\</span>
<span class="cp">	.mv_flush_tlb_current_page =	ev4_flush_tlb_current_page</span>

<span class="cp">#define DO_EV5_MMU							\</span>
<span class="cp">	.max_asn =			EV5_MAX_ASN,			\</span>
<span class="cp">	.mv_switch_mm =			ev5_switch_mm,			\</span>
<span class="cp">	.mv_activate_mm =		ev5_activate_mm,		\</span>
<span class="cp">	.mv_flush_tlb_current =		ev5_flush_tlb_current,		\</span>
<span class="cp">	.mv_flush_tlb_current_page =	ev5_flush_tlb_current_page</span>

<span class="cp">#define DO_EV6_MMU							\</span>
<span class="cp">	.max_asn =			EV6_MAX_ASN,			\</span>
<span class="cp">	.mv_switch_mm =			ev5_switch_mm,			\</span>
<span class="cp">	.mv_activate_mm =		ev5_activate_mm,		\</span>
<span class="cp">	.mv_flush_tlb_current =		ev5_flush_tlb_current,		\</span>
<span class="cp">	.mv_flush_tlb_current_page =	ev5_flush_tlb_current_page</span>

<span class="cp">#define DO_EV7_MMU							\</span>
<span class="cp">	.max_asn =			EV6_MAX_ASN,			\</span>
<span class="cp">	.mv_switch_mm =			ev5_switch_mm,			\</span>
<span class="cp">	.mv_activate_mm =		ev5_activate_mm,		\</span>
<span class="cp">	.mv_flush_tlb_current =		ev5_flush_tlb_current,		\</span>
<span class="cp">	.mv_flush_tlb_current_page =	ev5_flush_tlb_current_page</span>

<span class="cp">#define IO_LITE(UP,low)							\</span>
<span class="cp">	.hae_register =		(unsigned long *) CAT(UP,_HAE_ADDRESS),	\</span>
<span class="cp">	.iack_sc =		CAT(UP,_IACK_SC),			\</span>
<span class="cp">	.mv_ioread8 =		CAT(low,_ioread8),			\</span>
<span class="cp">	.mv_ioread16 =		CAT(low,_ioread16),			\</span>
<span class="cp">	.mv_ioread32 =		CAT(low,_ioread32),			\</span>
<span class="cp">	.mv_iowrite8 =		CAT(low,_iowrite8),			\</span>
<span class="cp">	.mv_iowrite16 =		CAT(low,_iowrite16),			\</span>
<span class="cp">	.mv_iowrite32 =		CAT(low,_iowrite32),			\</span>
<span class="cp">	.mv_readb =		CAT(low,_readb),			\</span>
<span class="cp">	.mv_readw =		CAT(low,_readw),			\</span>
<span class="cp">	.mv_readl =		CAT(low,_readl),			\</span>
<span class="cp">	.mv_readq =		CAT(low,_readq),			\</span>
<span class="cp">	.mv_writeb =		CAT(low,_writeb),			\</span>
<span class="cp">	.mv_writew =		CAT(low,_writew),			\</span>
<span class="cp">	.mv_writel =		CAT(low,_writel),			\</span>
<span class="cp">	.mv_writeq =		CAT(low,_writeq),			\</span>
<span class="cp">	.mv_ioportmap =		CAT(low,_ioportmap),			\</span>
<span class="cp">	.mv_ioremap =		CAT(low,_ioremap),			\</span>
<span class="cp">	.mv_iounmap =		CAT(low,_iounmap),			\</span>
<span class="cp">	.mv_is_ioaddr =		CAT(low,_is_ioaddr),			\</span>
<span class="cp">	.mv_is_mmio =		CAT(low,_is_mmio)			\</span>

<span class="cp">#define IO(UP,low)							\</span>
<span class="cp">	IO_LITE(UP,low),						\</span>
<span class="cp">	.pci_ops =		&amp;CAT(low,_pci_ops),			\</span>
<span class="cp">	.mv_pci_tbi =		CAT(low,_pci_tbi)</span>

<span class="cp">#define DO_APECS_IO	IO(APECS,apecs)</span>
<span class="cp">#define DO_CIA_IO	IO(CIA,cia)</span>
<span class="cp">#define DO_IRONGATE_IO	IO(IRONGATE,irongate)</span>
<span class="cp">#define DO_LCA_IO	IO(LCA,lca)</span>
<span class="cp">#define DO_MARVEL_IO	IO(MARVEL,marvel)</span>
<span class="cp">#define DO_MCPCIA_IO	IO(MCPCIA,mcpcia)</span>
<span class="cp">#define DO_POLARIS_IO	IO(POLARIS,polaris)</span>
<span class="cp">#define DO_T2_IO	IO(T2,t2)</span>
<span class="cp">#define DO_TSUNAMI_IO	IO(TSUNAMI,tsunami)</span>
<span class="cp">#define DO_TITAN_IO	IO(TITAN,titan)</span>
<span class="cp">#define DO_WILDFIRE_IO	IO(WILDFIRE,wildfire)</span>

<span class="cp">#define DO_PYXIS_IO	IO_LITE(CIA,cia_bwx), \</span>
<span class="cp">			.pci_ops = &amp;cia_pci_ops, \</span>
<span class="cp">			.mv_pci_tbi = cia_pci_tbi</span>

<span class="cm">/*</span>
<span class="cm"> * In a GENERIC kernel, we have lots of these vectors floating about,</span>
<span class="cm"> * all but one of which we want to go away.  In a non-GENERIC kernel,</span>
<span class="cm"> * we want only one, ever.</span>
<span class="cm"> *</span>
<span class="cm"> * Accomplish this in the GENERIC kernel by putting all of the vectors</span>
<span class="cm"> * in the .init.data section where they&#39;ll go away.  We&#39;ll copy the</span>
<span class="cm"> * one we want to the real alpha_mv vector in setup_arch.</span>
<span class="cm"> *</span>
<span class="cm"> * Accomplish this in a non-GENERIC kernel by ifdef&#39;ing out all but</span>
<span class="cm"> * one of the vectors, which will not reside in .init.data.  We then</span>
<span class="cm"> * alias this one vector to alpha_mv, so no copy is needed.</span>
<span class="cm"> *</span>
<span class="cm"> * Upshot: set __initdata to nothing for non-GENERIC kernels.</span>
<span class="cm"> */</span>

<span class="cp">#ifdef CONFIG_ALPHA_GENERIC</span>
<span class="cp">#define __initmv __initdata</span>
<span class="cp">#define ALIAS_MV(x)</span>
<span class="cp">#else</span>
<span class="cp">#define __initmv __initdata_refok</span>

<span class="cm">/* GCC actually has a syntax for defining aliases, but is under some</span>
<span class="cm">   delusion that you shouldn&#39;t be able to declare it extern somewhere</span>
<span class="cm">   else beforehand.  Fine.  We&#39;ll do it ourselves.  */</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">#define ALIAS_MV(system) \</span>
<span class="c">  struct alpha_machine_vector alpha_mv __attribute__((alias(#system &quot;_mv&quot;)));</span>
<span class="cp">#else</span>
<span class="cp">#define ALIAS_MV(system) \</span>
<span class="cp">  asm(&quot;.global alpha_mv\nalpha_mv = &quot; #system &quot;_mv&quot;);</span>
<span class="cp">#endif</span>
<span class="cp">#endif </span><span class="cm">/* GENERIC */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
