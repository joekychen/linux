<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › alpha › kernel › err_marvel.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>err_marvel.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *	linux/arch/alpha/kernel/err_marvel.c</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright (C) 2001 Jeff Wiedemeier (Compaq Computer Corporation)</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>

<span class="cp">#include &lt;asm/io.h&gt;</span>
<span class="cp">#include &lt;asm/console.h&gt;</span>
<span class="cp">#include &lt;asm/core_marvel.h&gt;</span>
<span class="cp">#include &lt;asm/hwrpb.h&gt;</span>
<span class="cp">#include &lt;asm/smp.h&gt;</span>
<span class="cp">#include &lt;asm/err_common.h&gt;</span>
<span class="cp">#include &lt;asm/err_ev7.h&gt;</span>

<span class="cp">#include &quot;err_impl.h&quot;</span>
<span class="cp">#include &quot;proto.h&quot;</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">marvel_print_680_frame</span><span class="p">(</span><span class="k">struct</span> <span class="n">ev7_lf_subpackets</span> <span class="o">*</span><span class="n">lf_subpackets</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#ifdef CONFIG_VERBOSE_MCHECK</span>
	<span class="k">struct</span> <span class="n">ev7_pal_environmental_subpacket</span> <span class="o">*</span><span class="n">env</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span> <span class="kt">int</span> <span class="n">type</span><span class="p">;</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span> <span class="p">}</span> <span class="n">ev_packets</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="n">EL_TYPE__PAL__ENV__AMBIENT_TEMPERATURE</span><span class="p">,</span>
		  <span class="s">&quot;Ambient Temperature&quot;</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">EL_TYPE__PAL__ENV__AIRMOVER_FAN</span><span class="p">,</span>
		  <span class="s">&quot;AirMover / Fan&quot;</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">EL_TYPE__PAL__ENV__VOLTAGE</span><span class="p">,</span>
		  <span class="s">&quot;Voltage&quot;</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">EL_TYPE__PAL__ENV__INTRUSION</span><span class="p">,</span>
		  <span class="s">&quot;Intrusion&quot;</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">EL_TYPE__PAL__ENV__POWER_SUPPLY</span><span class="p">,</span>
		  <span class="s">&quot;Power Supply&quot;</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">EL_TYPE__PAL__ENV__LAN</span><span class="p">,</span>
		  <span class="s">&quot;LAN&quot;</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">EL_TYPE__PAL__ENV__HOT_PLUG</span><span class="p">,</span>
		  <span class="s">&quot;Hot Plug&quot;</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">}</span>
	<span class="p">};</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ev_packets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">env</span> <span class="o">=</span> <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">env</span><span class="p">[</span><span class="n">ev7_lf_env_index</span><span class="p">(</span><span class="n">ev_packets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">type</span><span class="p">)];</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">env</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s**%s event (cabinet %d, drawer %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">,</span>
		       <span class="n">ev_packets</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span>
		       <span class="n">env</span><span class="o">-&gt;</span><span class="n">cabinet</span><span class="p">,</span>
		       <span class="n">env</span><span class="o">-&gt;</span><span class="n">drawer</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s   Module Type: 0x%x - Unit ID 0x%x - &quot;</span>
		       <span class="s">&quot;Condition 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">,</span>
		       <span class="n">env</span><span class="o">-&gt;</span><span class="n">module_type</span><span class="p">,</span>
		       <span class="n">env</span><span class="o">-&gt;</span><span class="n">unit_id</span><span class="p">,</span>
		       <span class="n">env</span><span class="o">-&gt;</span><span class="n">condition</span><span class="p">);</span>
	<span class="p">}</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_VERBOSE_MCHECK */</span><span class="cp"></span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">marvel_process_680_frame</span><span class="p">(</span><span class="k">struct</span> <span class="n">ev7_lf_subpackets</span> <span class="o">*</span><span class="n">lf_subpackets</span><span class="p">,</span> <span class="kt">int</span> <span class="n">print</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">MCHK_DISPOSITION_UNKNOWN_ERROR</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">ev7_lf_env_index</span><span class="p">(</span><span class="n">EL_TYPE__PAL__ENV__AMBIENT_TEMPERATURE</span><span class="p">);</span>
	     <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">ev7_lf_env_index</span><span class="p">(</span><span class="n">EL_TYPE__PAL__ENV__HOT_PLUG</span><span class="p">);</span>
	     <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">env</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
			<span class="n">status</span> <span class="o">=</span> <span class="n">MCHK_DISPOSITION_REPORT</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">print</span><span class="p">)</span>
		<span class="n">marvel_print_680_frame</span><span class="p">(</span><span class="n">lf_subpackets</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_VERBOSE_MCHECK</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">marvel_print_err_cyc</span><span class="p">(</span><span class="n">u64</span> <span class="n">err_cyc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">packet_desc</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;No Error&quot;</span><span class="p">,</span>
		<span class="s">&quot;UNKNOWN&quot;</span><span class="p">,</span>
		<span class="s">&quot;1 cycle (1 or 2 flit packet)&quot;</span><span class="p">,</span>
		<span class="s">&quot;2 cycles (3 flit packet)&quot;</span><span class="p">,</span>
		<span class="s">&quot;9 cycles (18 flit packet)&quot;</span><span class="p">,</span>
		<span class="s">&quot;10 cycles (19 flit packet)&quot;</span><span class="p">,</span>
		<span class="s">&quot;UNKNOWN&quot;</span><span class="p">,</span>
		<span class="s">&quot;UNKNOWN&quot;</span><span class="p">,</span>
		<span class="s">&quot;UNKNOWN&quot;</span>
	<span class="p">};</span>

<span class="cp">#define IO7__ERR_CYC__ODD_FLT	(1UL &lt;&lt;  0)</span>
<span class="cp">#define IO7__ERR_CYC__EVN_FLT	(1UL &lt;&lt;  1)</span>
<span class="cp">#define IO7__ERR_CYC__PACKET__S	(6)</span>
<span class="cp">#define IO7__ERR_CYC__PACKET__M	(0x7)</span>
<span class="cp">#define IO7__ERR_CYC__LOC	(1UL &lt;&lt;  5)</span>
<span class="cp">#define IO7__ERR_CYC__CYCLE__S	(2)</span>
<span class="cp">#define IO7__ERR_CYC__CYCLE__M	(0x7)</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s        Packet In Error: %s</span><span class="se">\n</span><span class="s">&quot;</span>
	       <span class="s">&quot;%s        Error in %s, cycle %lld%s%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span> 
	       <span class="n">packet_desc</span><span class="p">[</span><span class="n">EXTRACT</span><span class="p">(</span><span class="n">err_cyc</span><span class="p">,</span> <span class="n">IO7__ERR_CYC__PACKET</span><span class="p">)],</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="p">(</span><span class="n">err_cyc</span> <span class="o">&amp;</span> <span class="n">IO7__ERR_CYC__LOC</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;DATA&quot;</span> <span class="o">:</span> <span class="s">&quot;HEADER&quot;</span><span class="p">,</span>
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">err_cyc</span><span class="p">,</span> <span class="n">IO7__ERR_CYC__CYCLE</span><span class="p">),</span>
	       <span class="p">(</span><span class="n">err_cyc</span> <span class="o">&amp;</span> <span class="n">IO7__ERR_CYC__ODD_FLT</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; [ODD Flit]&quot;</span><span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
	       <span class="p">(</span><span class="n">err_cyc</span> <span class="o">&amp;</span> <span class="n">IO7__ERR_CYC__EVN_FLT</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; [Even Flit]&quot;</span><span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">marvel_print_po7_crrct_sym</span><span class="p">(</span><span class="n">u64</span> <span class="n">crrct_sym</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define IO7__PO7_CRRCT_SYM__SYN__S	(0)</span>
<span class="cp">#define IO7__PO7_CRRCT_SYM__SYN__M	(0x7f)</span>
<span class="cp">#define IO7__PO7_CRRCT_SYM__ERR_CYC__S	(7)   </span><span class="cm">/* ERR_CYC + ODD_FLT + EVN_FLT */</span><span class="cp"></span>
<span class="cp">#define IO7__PO7_CRRCT_SYM__ERR_CYC__M	(0x1ff)</span>


	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s      Correctable Error Symptoms:</span><span class="se">\n</span><span class="s">&quot;</span>
	       <span class="s">&quot;%s        Syndrome: 0x%llx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">EXTRACT</span><span class="p">(</span><span class="n">crrct_sym</span><span class="p">,</span> <span class="n">IO7__PO7_CRRCT_SYM__SYN</span><span class="p">));</span>
	<span class="n">marvel_print_err_cyc</span><span class="p">(</span><span class="n">EXTRACT</span><span class="p">(</span><span class="n">crrct_sym</span><span class="p">,</span> <span class="n">IO7__PO7_CRRCT_SYM__ERR_CYC</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">marvel_print_po7_uncrr_sym</span><span class="p">(</span><span class="n">u64</span> <span class="n">uncrr_sym</span><span class="p">,</span> <span class="n">u64</span> <span class="n">valid_mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">clk_names</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;_h[0]&quot;</span><span class="p">,</span> <span class="s">&quot;_h[1]&quot;</span><span class="p">,</span> <span class="s">&quot;_n[0]&quot;</span><span class="p">,</span> <span class="s">&quot;_n[1]&quot;</span> <span class="p">};</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">clk_decode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;No Error&quot;</span><span class="p">,</span>
		<span class="s">&quot;One extra rising edge&quot;</span><span class="p">,</span>
		<span class="s">&quot;Two extra rising edges&quot;</span><span class="p">,</span>
		<span class="s">&quot;Lost one clock&quot;</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">port_names</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Port 0&quot;</span><span class="p">,</span> 	<span class="s">&quot;Port 1&quot;</span><span class="p">,</span> 
				      <span class="s">&quot;Port 2&quot;</span><span class="p">,</span> 	<span class="s">&quot;Port 3&quot;</span><span class="p">,</span>
				      <span class="s">&quot;Unknown Port&quot;</span><span class="p">,</span>	<span class="s">&quot;Unknown Port&quot;</span><span class="p">,</span>
				      <span class="s">&quot;Unknown Port&quot;</span><span class="p">,</span>	<span class="s">&quot;Port 7&quot;</span> <span class="p">};</span>
	<span class="kt">int</span> <span class="n">scratch</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

<span class="cp">#define IO7__PO7_UNCRR_SYM__SYN__S	    (0)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__SYN__M	    (0x7f)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__ERR_CYC__S	    (7)      </span><span class="cm">/* ERR_CYC + ODD_FLT... */</span><span class="cp"></span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__ERR_CYC__M	    (0x1ff)  </span><span class="cm">/* ... + EVN_FLT        */</span><span class="cp"></span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__CLK__S	    (16)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__CLK__M	    (0xff)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__CDT_OVF_TO__REQ (1UL &lt;&lt; 24)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__CDT_OVF_TO__RIO (1UL &lt;&lt; 25)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__CDT_OVF_TO__WIO (1UL &lt;&lt; 26)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__CDT_OVF_TO__BLK (1UL &lt;&lt; 27)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__CDT_OVF_TO__NBK (1UL &lt;&lt; 28)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__OVF__READIO	    (1UL &lt;&lt; 29)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__OVF__WRITEIO    (1UL &lt;&lt; 30)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__OVF__FWD        (1UL &lt;&lt; 31)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__VICTIM_SP__S    (32)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__VICTIM_SP__M    (0xff)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__DETECT_SP__S    (40)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__DETECT_SP__M    (0xff)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__STRV_VTR__S     (48)</span>
<span class="cp">#define IO7__PO7_UNCRR_SYM__STRV_VTR__M     (0x3ff)</span>

<span class="cp">#define IO7__STRV_VTR__LSI__INTX__S	    (0)</span>
<span class="cp">#define IO7__STRV_VTR__LSI__INTX__M	    (0x3)</span>
<span class="cp">#define IO7__STRV_VTR__LSI__SLOT__S	    (2)</span>
<span class="cp">#define IO7__STRV_VTR__LSI__SLOT__M	    (0x7)</span>
<span class="cp">#define IO7__STRV_VTR__LSI__BUS__S	    (5)</span>
<span class="cp">#define IO7__STRV_VTR__LSI__BUS__M	    (0x3)</span>
<span class="cp">#define IO7__STRV_VTR__MSI__INTNUM__S	    (0)</span>
<span class="cp">#define IO7__STRV_VTR__MSI__INTNUM__M	    (0x1ff)</span>
<span class="cp">#define IO7__STRV_VTR__IS_MSI		    (1UL &lt;&lt; 9)</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s      Uncorrectable Error Symptoms:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="n">uncrr_sym</span> <span class="o">&amp;=</span> <span class="n">valid_mask</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">EXTRACT</span><span class="p">(</span><span class="n">valid_mask</span><span class="p">,</span> <span class="n">IO7__PO7_UNCRR_SYM__SYN</span><span class="p">))</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s        Syndrome: 0x%llx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">,</span> 
		       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">uncrr_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UNCRR_SYM__SYN</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">EXTRACT</span><span class="p">(</span><span class="n">valid_mask</span><span class="p">,</span> <span class="n">IO7__PO7_UNCRR_SYM__ERR_CYC</span><span class="p">))</span>
		<span class="n">marvel_print_err_cyc</span><span class="p">(</span><span class="n">EXTRACT</span><span class="p">(</span><span class="n">uncrr_sym</span><span class="p">,</span> 
					     <span class="n">IO7__PO7_UNCRR_SYM__ERR_CYC</span><span class="p">));</span>

	<span class="n">scratch</span> <span class="o">=</span> <span class="n">EXTRACT</span><span class="p">(</span><span class="n">uncrr_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UNCRR_SYM__CLK</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">scratch</span> <span class="o">&gt;&gt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">scratch</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s        Clock %s: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">err_print_prefix</span><span class="p">,</span>
			       <span class="n">clk_names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">clk_decode</span><span class="p">[</span><span class="n">scratch</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">uncrr_sym</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_UNCRR_SYM__CDT_OVF_TO__REQ</span><span class="p">)</span> 
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s       REQ Credit Timeout or Overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uncrr_sym</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_UNCRR_SYM__CDT_OVF_TO__RIO</span><span class="p">)</span> 
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s       RIO Credit Timeout or Overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uncrr_sym</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_UNCRR_SYM__CDT_OVF_TO__WIO</span><span class="p">)</span> 
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s       WIO Credit Timeout or Overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uncrr_sym</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_UNCRR_SYM__CDT_OVF_TO__BLK</span><span class="p">)</span> 
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s       BLK Credit Timeout or Overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uncrr_sym</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_UNCRR_SYM__CDT_OVF_TO__NBK</span><span class="p">)</span> 
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s       NBK Credit Timeout or Overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">uncrr_sym</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_UNCRR_SYM__OVF__READIO</span><span class="p">)</span> 
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s       Read I/O Buffer Overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> 
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uncrr_sym</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_UNCRR_SYM__OVF__WRITEIO</span><span class="p">)</span> 
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s       Write I/O Buffer Overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> 
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uncrr_sym</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_UNCRR_SYM__OVF__FWD</span><span class="p">)</span> 
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s       FWD Buffer Overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> 
		       <span class="n">err_print_prefix</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">scratch</span> <span class="o">=</span> <span class="n">EXTRACT</span><span class="p">(</span><span class="n">uncrr_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UNCRR_SYM__VICTIM_SP</span><span class="p">)))</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">lost</span> <span class="o">=</span> <span class="n">scratch</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1UL</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
		<span class="n">scratch</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">lost</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">scratch</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">scratch</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s        Error Response sent to %s&quot;</span><span class="p">,</span>
			       <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">port_names</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">lost</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s        Lost Error sent somewhere else</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="p">}</span>
	
	<span class="k">if</span> <span class="p">((</span><span class="n">scratch</span> <span class="o">=</span> <span class="n">EXTRACT</span><span class="p">(</span><span class="n">uncrr_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UNCRR_SYM__DETECT_SP</span><span class="p">)))</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">scratch</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">scratch</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">))</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s        Error Reported by %s&quot;</span><span class="p">,</span>
			       <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">port_names</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">EXTRACT</span><span class="p">(</span><span class="n">valid_mask</span><span class="p">,</span> <span class="n">IO7__PO7_UNCRR_SYM__STRV_VTR</span><span class="p">))</span> <span class="p">{</span>
		<span class="kt">char</span> <span class="n">starvation_message</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>

		<span class="n">scratch</span> <span class="o">=</span> <span class="n">EXTRACT</span><span class="p">(</span><span class="n">uncrr_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UNCRR_SYM__STRV_VTR</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">scratch</span> <span class="o">&amp;</span> <span class="n">IO7__STRV_VTR__IS_MSI</span><span class="p">)</span> 
			<span class="n">sprintf</span><span class="p">(</span><span class="n">starvation_message</span><span class="p">,</span> 
				<span class="s">&quot;MSI Interrupt 0x%x&quot;</span><span class="p">,</span>
				<span class="n">EXTRACT</span><span class="p">(</span><span class="n">scratch</span><span class="p">,</span> <span class="n">IO7__STRV_VTR__MSI__INTNUM</span><span class="p">));</span>
		<span class="k">else</span>
			<span class="n">sprintf</span><span class="p">(</span><span class="n">starvation_message</span><span class="p">,</span>
				<span class="s">&quot;LSI INT%c for Bus:Slot (%d:%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="n">EXTRACT</span><span class="p">(</span><span class="n">scratch</span><span class="p">,</span> 
					      <span class="n">IO7__STRV_VTR__LSI__INTX</span><span class="p">),</span>
				<span class="n">EXTRACT</span><span class="p">(</span><span class="n">scratch</span><span class="p">,</span> <span class="n">IO7__STRV_VTR__LSI__BUS</span><span class="p">),</span>
				<span class="n">EXTRACT</span><span class="p">(</span><span class="n">scratch</span><span class="p">,</span> <span class="n">IO7__STRV_VTR__LSI__SLOT</span><span class="p">));</span>

		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s        Starvation Int Trigger By: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">starvation_message</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">marvel_print_po7_ugbge_sym</span><span class="p">(</span><span class="n">u64</span> <span class="n">ugbge_sym</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">opcode_str</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>

<span class="cp">#define IO7__PO7_UGBGE_SYM__UPH_PKT_OFF__S	(6)</span>
<span class="cp">#define IO7__PO7_UGBGE_SYM__UPH_PKT_OFF__M	(0xfffffffful)</span>
<span class="cp">#define IO7__PO7_UGBGE_SYM__UPH_OPCODE__S	(40)</span>
<span class="cp">#define IO7__PO7_UGBGE_SYM__UPH_OPCODE__M	(0xff)</span>
<span class="cp">#define IO7__PO7_UGBGE_SYM__UPH_SRC_PORT__S	(48)</span>
<span class="cp">#define IO7__PO7_UGBGE_SYM__UPH_SRC_PORT__M	(0xf)</span>
<span class="cp">#define IO7__PO7_UGBGE_SYM__UPH_DEST_PID__S	(52)</span>
<span class="cp">#define IO7__PO7_UGBGE_SYM__UPH_DEST_PID__M	(0x7ff)</span>
<span class="cp">#define IO7__PO7_UGBGE_SYM__VALID		(1UL &lt;&lt; 63)</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ugbge_sym</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_UGBGE_SYM__VALID</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">switch</span><span class="p">(</span><span class="n">EXTRACT</span><span class="p">(</span><span class="n">ugbge_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UGBGE_SYM__UPH_OPCODE</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x51</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">opcode_str</span><span class="p">,</span> <span class="s">&quot;Wr32&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x50</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">opcode_str</span><span class="p">,</span> <span class="s">&quot;WrQW&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x54</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">opcode_str</span><span class="p">,</span> <span class="s">&quot;WrIPR&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0xD8</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">opcode_str</span><span class="p">,</span> <span class="s">&quot;Victim&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0xC5</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">opcode_str</span><span class="p">,</span> <span class="s">&quot;BlkIO&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">sprintf</span><span class="p">(</span><span class="n">opcode_str</span><span class="p">,</span> <span class="s">&quot;0x%llx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">EXTRACT</span><span class="p">(</span><span class="n">ugbge_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UGBGE_SYM__UPH_OPCODE</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s      Up Hose Garbage Symptom:</span><span class="se">\n</span><span class="s">&quot;</span>
	       <span class="s">&quot;%s        Source Port: %lld - Dest PID: %lld - OpCode: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span> 
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">ugbge_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UGBGE_SYM__UPH_SRC_PORT</span><span class="p">),</span>
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">ugbge_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UGBGE_SYM__UPH_DEST_PID</span><span class="p">),</span>
	       <span class="n">opcode_str</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="mh">0xC5</span> <span class="o">!=</span> <span class="n">EXTRACT</span><span class="p">(</span><span class="n">ugbge_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UGBGE_SYM__UPH_OPCODE</span><span class="p">))</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s        Packet Offset 0x%08llx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">,</span>
		       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">ugbge_sym</span><span class="p">,</span> <span class="n">IO7__PO7_UGBGE_SYM__UPH_PKT_OFF</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">marvel_print_po7_err_sum</span><span class="p">(</span><span class="k">struct</span> <span class="n">ev7_pal_io_subpacket</span> <span class="o">*</span><span class="n">io</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u64</span>	<span class="n">uncrr_sym_valid</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cp">#define IO7__PO7_ERRSUM__CR_SBE		(1UL &lt;&lt; 32)</span>
<span class="cp">#define IO7__PO7_ERRSUM__CR_SBE2	(1UL &lt;&lt; 33)</span>
<span class="cp">#define IO7__PO7_ERRSUM__CR_PIO_WBYTE	(1UL &lt;&lt; 34)</span>
<span class="cp">#define IO7__PO7_ERRSUM__CR_CSR_NXM	(1UL &lt;&lt; 35)</span>
<span class="cp">#define IO7__PO7_ERRSUM__CR_RPID_ACV	(1UL &lt;&lt; 36)</span>
<span class="cp">#define IO7__PO7_ERRSUM__CR_RSP_NXM	(1UL &lt;&lt; 37)</span>
<span class="cp">#define IO7__PO7_ERRSUM__CR_ERR_RESP	(1UL &lt;&lt; 38)</span>
<span class="cp">#define IO7__PO7_ERRSUM__CR_CLK_DERR	(1UL &lt;&lt; 39)</span>
<span class="cp">#define IO7__PO7_ERRSUM__CR_DAT_DBE	(1UL &lt;&lt; 40)</span>
<span class="cp">#define IO7__PO7_ERRSUM__CR_DAT_GRBG	(1UL &lt;&lt; 41)</span>
<span class="cp">#define IO7__PO7_ERRSUM__MAF_TO		(1UL &lt;&lt; 42)</span>
<span class="cp">#define IO7__PO7_ERRSUM__UGBGE		(1UL &lt;&lt; 43)</span>
<span class="cp">#define IO7__PO7_ERRSUM__UN_MAF_LOST	(1UL &lt;&lt; 44)</span>
<span class="cp">#define IO7__PO7_ERRSUM__UN_PKT_OVF	(1UL &lt;&lt; 45)</span>
<span class="cp">#define IO7__PO7_ERRSUM__UN_CDT_OVF	(1UL &lt;&lt; 46)</span>
<span class="cp">#define IO7__PO7_ERRSUM__UN_DEALLOC	(1UL &lt;&lt; 47)</span>
<span class="cp">#define IO7__PO7_ERRSUM__BH_CDT_TO	(1UL &lt;&lt; 51)</span>
<span class="cp">#define IO7__PO7_ERRSUM__BH_CLK_HDR	(1UL &lt;&lt; 52)</span>
<span class="cp">#define IO7__PO7_ERRSUM__BH_DBE_HDR	(1UL &lt;&lt; 53)</span>
<span class="cp">#define IO7__PO7_ERRSUM__BH_GBG_HDR	(1UL &lt;&lt; 54)</span>
<span class="cp">#define IO7__PO7_ERRSUM__BH_BAD_CMD	(1UL &lt;&lt; 55)</span>
<span class="cp">#define IO7__PO7_ERRSUM__HLT_INT	(1UL &lt;&lt; 56)</span>
<span class="cp">#define IO7__PO7_ERRSUM__HP_INT		(1UL &lt;&lt; 57)</span>
<span class="cp">#define IO7__PO7_ERRSUM__CRD_INT	(1UL &lt;&lt; 58)</span>
<span class="cp">#define IO7__PO7_ERRSUM__STV_INT	(1UL &lt;&lt; 59)</span>
<span class="cp">#define IO7__PO7_ERRSUM__HRD_INT	(1UL &lt;&lt; 60)</span>
<span class="cp">#define IO7__PO7_ERRSUM__BH_SUM		(1UL &lt;&lt; 61)</span>
<span class="cp">#define IO7__PO7_ERRSUM__ERR_LST	(1UL &lt;&lt; 62)</span>
<span class="cp">#define IO7__PO7_ERRSUM__ERR_VALID	(1UL &lt;&lt; 63)</span>

<span class="cp">#define IO7__PO7_ERRSUM__ERR_MASK	(IO7__PO7_ERRSUM__ERR_VALID |	\</span>
<span class="cp">					 IO7__PO7_ERRSUM__CR_SBE)</span>

	<span class="cm">/*</span>
<span class="cm">	 * Single bit errors aren&#39;t covered by ERR_VALID.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CR_SBE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    %sSingle Bit Error(s) detected/corrected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">,</span>
		       <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CR_SBE2</span><span class="p">)</span> 
		       <span class="o">?</span> <span class="s">&quot;Multiple &quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
		<span class="n">marvel_print_po7_crrct_sym</span><span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_crrct_sym</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * Neither are the interrupt status bits</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__HLT_INT</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Halt Interrupt posted&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__HP_INT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Hot Plug Event Interrupt posted&quot;</span><span class="p">,</span> 
		       <span class="n">err_print_prefix</span><span class="p">);</span>
		<span class="n">uncrr_sym_valid</span> <span class="o">|=</span> <span class="n">GEN_MASK</span><span class="p">(</span><span class="n">IO7__PO7_UNCRR_SYM__DETECT_SP</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CRD_INT</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Correctable Error Interrupt posted&quot;</span><span class="p">,</span> 
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__STV_INT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Starvation Interrupt posted&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
		<span class="n">uncrr_sym_valid</span> <span class="o">|=</span> <span class="n">GEN_MASK</span><span class="p">(</span><span class="n">IO7__PO7_UNCRR_SYM__STRV_VTR</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__HRD_INT</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Hard Error Interrupt posted&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
		<span class="n">uncrr_sym_valid</span> <span class="o">|=</span> <span class="n">GEN_MASK</span><span class="p">(</span><span class="n">IO7__PO7_UNCRR_SYM__DETECT_SP</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * Everything else is valid only with ERR_VALID, so skip to the end</span>
<span class="cm">	 * (uncrr_sym check) unless ERR_VALID is set.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__ERR_VALID</span><span class="p">))</span> 
		<span class="k">goto</span> <span class="n">check_uncrr_sym</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Since ERR_VALID is set, VICTIM_SP in uncrr_sym is valid.</span>
<span class="cm">	 * For bits [29:0] to also be valid, the following bits must</span>
<span class="cm">	 * not be set:</span>
<span class="cm">	 *	CR_PIO_WBYTE	CR_CSR_NXM	CR_RSP_NXM</span>
<span class="cm">	 *	CR_ERR_RESP	MAF_TO</span>
<span class="cm">	 */</span>
	<span class="n">uncrr_sym_valid</span> <span class="o">|=</span> <span class="n">GEN_MASK</span><span class="p">(</span><span class="n">IO7__PO7_UNCRR_SYM__VICTIM_SP</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">IO7__PO7_ERRSUM__CR_PIO_WBYTE</span> <span class="o">|</span>
				   <span class="n">IO7__PO7_ERRSUM__CR_CSR_NXM</span> <span class="o">|</span>
				   <span class="n">IO7__PO7_ERRSUM__CR_RSP_NXM</span> <span class="o">|</span>
				   <span class="n">IO7__PO7_ERRSUM__CR_ERR_RESP</span> <span class="o">|</span>
				   <span class="n">IO7__PO7_ERRSUM__MAF_TO</span><span class="p">)))</span>
		<span class="n">uncrr_sym_valid</span> <span class="o">|=</span> <span class="mh">0x3ffffffful</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CR_PIO_WBYTE</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Write byte into IO7 CSR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CR_CSR_NXM</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    PIO to non-existent CSR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CR_RPID_ACV</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Bus Requester PID (Access Violation)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CR_RSP_NXM</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Received NXM response from EV7</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CR_ERR_RESP</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Received ERROR RESPONSE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CR_CLK_DERR</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Clock error on data flit</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CR_DAT_DBE</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Double Bit Error Data Error Detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__CR_DAT_GRBG</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Garbage Encoding Detected on the data</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__UGBGE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Garbage Encoding sent up hose</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
		<span class="n">marvel_print_po7_ugbge_sym</span><span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_ugbge_sym</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__UN_MAF_LOST</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Orphan response (unexpected response)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__UN_PKT_OVF</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Down hose packet overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__UN_CDT_OVF</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Down hose credit overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__UN_DEALLOC</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Unexpected or bad dealloc field</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * The black hole events.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__MAF_TO</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    BLACK HOLE: Timeout for all responses</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__BH_CDT_TO</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    BLACK HOLE: Credit Timeout</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__BH_CLK_HDR</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    BLACK HOLE: Clock check on header</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> 
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__BH_DBE_HDR</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    BLACK HOLE: Uncorrectable Error on header</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__BH_GBG_HDR</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    BLACK HOLE: Garbage on header</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> 
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__BH_BAD_CMD</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    BLACK HOLE: Bad EV7 command</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> 
		       <span class="n">err_print_prefix</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__ERR_LST</span><span class="p">)</span> 
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Lost Error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Failing Packet:</span><span class="se">\n</span><span class="s">&quot;</span>
	       <span class="s">&quot;%s      Cycle 1: %016llx</span><span class="se">\n</span><span class="s">&quot;</span>
	       <span class="s">&quot;%s      Cycle 2: %016llx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_err_pkt0</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_err_pkt1</span><span class="p">);</span>
	<span class="cm">/*</span>
<span class="cm">	 * If there are any valid bits in UNCRR sym for this err, </span>
<span class="cm">	 * print UNCRR_SYM as well.</span>
<span class="cm">	 */</span>
<span class="nl">check_uncrr_sym:</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">uncrr_sym_valid</span><span class="p">)</span>
		<span class="n">marvel_print_po7_uncrr_sym</span><span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_uncrr_sym</span><span class="p">,</span> <span class="n">uncrr_sym_valid</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">marvel_print_pox_tlb_err</span><span class="p">(</span><span class="n">u64</span> <span class="n">tlb_err</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tlb_errors</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;No Error&quot;</span><span class="p">,</span>
		<span class="s">&quot;North Port Signaled Error fetching TLB entry&quot;</span><span class="p">,</span>
		<span class="s">&quot;PTE invalid or UCC or GBG error on this entry&quot;</span><span class="p">,</span>
		<span class="s">&quot;Address did not hit any DMA window&quot;</span>
	<span class="p">};</span>

<span class="cp">#define IO7__POX_TLBERR__ERR_VALID		(1UL &lt;&lt; 63)</span>
<span class="cp">#define IO7__POX_TLBERR__ERRCODE__S		(0)</span>
<span class="cp">#define IO7__POX_TLBERR__ERRCODE__M		(0x3)</span>
<span class="cp">#define IO7__POX_TLBERR__ERR_TLB_PTR__S		(3)</span>
<span class="cp">#define IO7__POX_TLBERR__ERR_TLB_PTR__M		(0x7)</span>
<span class="cp">#define IO7__POX_TLBERR__FADDR__S		(6)</span>
<span class="cp">#define IO7__POX_TLBERR__FADDR__M		(0x3fffffffffful)</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">tlb_err</span> <span class="o">&amp;</span> <span class="n">IO7__POX_TLBERR__ERR_VALID</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s      TLB Error on index 0x%llx:</span><span class="se">\n</span><span class="s">&quot;</span>
	       <span class="s">&quot;%s        - %s</span><span class="se">\n</span><span class="s">&quot;</span>
	       <span class="s">&quot;%s        - Addr: 0x%016llx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">tlb_err</span><span class="p">,</span> <span class="n">IO7__POX_TLBERR__ERR_TLB_PTR</span><span class="p">),</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="n">tlb_errors</span><span class="p">[</span><span class="n">EXTRACT</span><span class="p">(</span><span class="n">tlb_err</span><span class="p">,</span> <span class="n">IO7__POX_TLBERR__ERRCODE</span><span class="p">)],</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">tlb_err</span><span class="p">,</span> <span class="n">IO7__POX_TLBERR__FADDR</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span>  <span class="kt">void</span>
<span class="nf">marvel_print_pox_spl_cmplt</span><span class="p">(</span><span class="n">u64</span> <span class="n">spl_cmplt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">message</span><span class="p">[</span><span class="mi">80</span><span class="p">];</span>

<span class="cp">#define IO7__POX_SPLCMPLT__MESSAGE__S		(0)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__MESSAGE__M		(0x0fffffffful)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__SOURCE_BUS__S	(40)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__SOURCE_BUS__M	(0xfful)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__SOURCE_DEV__S	(35)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__SOURCE_DEV__M	(0x1ful)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__SOURCE_FUNC__S	(32)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__SOURCE_FUNC__M	(0x07ul)</span>

<span class="cp">#define IO7__POX_SPLCMPLT__MSG_CLASS__S		(28)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__MSG_CLASS__M		(0xf)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__MSG_INDEX__S		(20)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__MSG_INDEX__M		(0xff)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__MSG_CLASSINDEX__S	(20)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__MSG_CLASSINDEX__M    (0xfff)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__REM_LOWER_ADDR__S	(12)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__REM_LOWER_ADDR__M	(0x7f)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__REM_BYTE_COUNT__S	(0)</span>
<span class="cp">#define IO7__POX_SPLCMPLT__REM_BYTE_COUNT__M	(0xfff)</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s      Split Completion Error:</span><span class="se">\n</span><span class="s">&quot;</span>	
	       <span class="s">&quot;%s         Source (Bus:Dev:Func): %lld:%lld:%lld</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">spl_cmplt</span><span class="p">,</span> <span class="n">IO7__POX_SPLCMPLT__SOURCE_BUS</span><span class="p">),</span>
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">spl_cmplt</span><span class="p">,</span> <span class="n">IO7__POX_SPLCMPLT__SOURCE_DEV</span><span class="p">),</span>
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">spl_cmplt</span><span class="p">,</span> <span class="n">IO7__POX_SPLCMPLT__SOURCE_FUNC</span><span class="p">));</span>

	<span class="k">switch</span><span class="p">(</span><span class="n">EXTRACT</span><span class="p">(</span><span class="n">spl_cmplt</span><span class="p">,</span> <span class="n">IO7__POX_SPLCMPLT__MSG_CLASSINDEX</span><span class="p">))</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x000</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;Normal completion&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x100</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;Bridge - Master Abort&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x101</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;Bridge - Target Abort&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x102</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;Bridge - Uncorrectable Write Data Error&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x200</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;Byte Count Out of Range&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x201</span>:
		<span class="n">sprintf</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;Uncorrectable Split Write Data Error&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">sprintf</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s">&quot;%08llx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">EXTRACT</span><span class="p">(</span><span class="n">spl_cmplt</span><span class="p">,</span> <span class="n">IO7__POX_SPLCMPLT__MESSAGE</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s	   Message: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">message</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">marvel_print_pox_trans_sum</span><span class="p">(</span><span class="n">u64</span> <span class="n">trans_sum</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">pcix_cmd</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Interrupt Acknowledge&quot;</span><span class="p">,</span>
		<span class="s">&quot;Special Cycle&quot;</span><span class="p">,</span>
		<span class="s">&quot;I/O Read&quot;</span><span class="p">,</span>
		<span class="s">&quot;I/O Write&quot;</span><span class="p">,</span>
		<span class="s">&quot;Reserved&quot;</span><span class="p">,</span>
		<span class="s">&quot;Reserved / Device ID Message&quot;</span><span class="p">,</span>
		<span class="s">&quot;Memory Read&quot;</span><span class="p">,</span>
		<span class="s">&quot;Memory Write&quot;</span><span class="p">,</span>
		<span class="s">&quot;Reserved / Alias to Memory Read Block&quot;</span><span class="p">,</span>
		<span class="s">&quot;Reserved / Alias to Memory Write Block&quot;</span><span class="p">,</span>
		<span class="s">&quot;Configuration Read&quot;</span><span class="p">,</span>
		<span class="s">&quot;Configuration Write&quot;</span><span class="p">,</span>
		<span class="s">&quot;Memory Read Multiple / Split Completion&quot;</span><span class="p">,</span>
		<span class="s">&quot;Dual Address Cycle&quot;</span><span class="p">,</span>
		<span class="s">&quot;Memory Read Line / Memory Read Block&quot;</span><span class="p">,</span>
		<span class="s">&quot;Memory Write and Invalidate / Memory Write Block&quot;</span>
	<span class="p">};</span>

<span class="cp">#define IO7__POX_TRANSUM__PCI_ADDR__S		(0)</span>
<span class="cp">#define IO7__POX_TRANSUM__PCI_ADDR__M		(0x3fffffffffffful)</span>
<span class="cp">#define IO7__POX_TRANSUM__DAC			(1UL &lt;&lt; 50)</span>
<span class="cp">#define IO7__POX_TRANSUM__PCIX_MASTER_SLOT__S	(52)</span>
<span class="cp">#define IO7__POX_TRANSUM__PCIX_MASTER_SLOT__M	(0xf)</span>
<span class="cp">#define IO7__POX_TRANSUM__PCIX_CMD__S		(56)</span>
<span class="cp">#define IO7__POX_TRANSUM__PCIX_CMD__M		(0xf)</span>
<span class="cp">#define IO7__POX_TRANSUM__ERR_VALID		(1UL &lt;&lt; 63)</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">trans_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_TRANSUM__ERR_VALID</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s      Transaction Summary:</span><span class="se">\n</span><span class="s">&quot;</span>
	       <span class="s">&quot;%s        Command: 0x%llx - %s</span><span class="se">\n</span><span class="s">&quot;</span>
	       <span class="s">&quot;%s        Address: 0x%016llx%s</span><span class="se">\n</span><span class="s">&quot;</span>
	       <span class="s">&quot;%s        PCI-X Master Slot: 0x%llx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span> 
	       <span class="n">err_print_prefix</span><span class="p">,</span> 
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">trans_sum</span><span class="p">,</span> <span class="n">IO7__POX_TRANSUM__PCIX_CMD</span><span class="p">),</span>
	       <span class="n">pcix_cmd</span><span class="p">[</span><span class="n">EXTRACT</span><span class="p">(</span><span class="n">trans_sum</span><span class="p">,</span> <span class="n">IO7__POX_TRANSUM__PCIX_CMD</span><span class="p">)],</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">trans_sum</span><span class="p">,</span> <span class="n">IO7__POX_TRANSUM__PCI_ADDR</span><span class="p">),</span>
	       <span class="p">(</span><span class="n">trans_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_TRANSUM__DAC</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; (DAC)&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
	       <span class="n">err_print_prefix</span><span class="p">,</span>
	       <span class="n">EXTRACT</span><span class="p">(</span><span class="n">trans_sum</span><span class="p">,</span> <span class="n">IO7__POX_TRANSUM__PCIX_MASTER_SLOT</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">marvel_print_pox_err</span><span class="p">(</span><span class="n">u64</span> <span class="n">err_sum</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ev7_pal_io_one_port</span> <span class="o">*</span><span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define IO7__POX_ERRSUM__AGP_REQQ_OVFL    (1UL &lt;&lt;  4)</span>
<span class="cp">#define IO7__POX_ERRSUM__AGP_SYNC_ERR     (1UL &lt;&lt;  5)</span>
<span class="cp">#define IO7__POX_ERRSUM__MRETRY_TO        (1UL &lt;&lt;  6)</span>
<span class="cp">#define IO7__POX_ERRSUM__PCIX_UX_SPL      (1UL &lt;&lt;  7)</span>
<span class="cp">#define IO7__POX_ERRSUM__PCIX_SPLIT_TO    (1UL &lt;&lt;  8)</span>
<span class="cp">#define IO7__POX_ERRSUM__PCIX_DISCARD_SPL (1UL &lt;&lt;  9)</span>
<span class="cp">#define IO7__POX_ERRSUM__DMA_RD_TO        (1UL &lt;&lt; 10)</span>
<span class="cp">#define IO7__POX_ERRSUM__CSR_NXM_RD       (1UL &lt;&lt; 11)</span>
<span class="cp">#define IO7__POX_ERRSUM__CSR_NXM_WR       (1UL &lt;&lt; 12)</span>
<span class="cp">#define IO7__POX_ERRSUM__DMA_TO           (1UL &lt;&lt; 13)</span>
<span class="cp">#define IO7__POX_ERRSUM__ALL_MABORTS      (1UL &lt;&lt; 14)</span>
<span class="cp">#define IO7__POX_ERRSUM__MABORT		  (1UL &lt;&lt; 15)</span>
<span class="cp">#define IO7__POX_ERRSUM__MABORT_MASK	  (IO7__POX_ERRSUM__ALL_MABORTS|\</span>
<span class="cp">					   IO7__POX_ERRSUM__MABORT)</span>
<span class="cp">#define IO7__POX_ERRSUM__PT_TABORT        (1UL &lt;&lt; 16)</span>
<span class="cp">#define IO7__POX_ERRSUM__PM_TABORT        (1UL &lt;&lt; 17)</span>
<span class="cp">#define IO7__POX_ERRSUM__TABORT_MASK      (IO7__POX_ERRSUM__PT_TABORT | \</span>
<span class="cp">                                           IO7__POX_ERRSUM__PM_TABORT)</span>
<span class="cp">#define IO7__POX_ERRSUM__SERR             (1UL &lt;&lt; 18)</span>
<span class="cp">#define IO7__POX_ERRSUM__ADDRERR_STB      (1UL &lt;&lt; 19)</span>
<span class="cp">#define IO7__POX_ERRSUM__DETECTED_SERR    (1UL &lt;&lt; 20)</span>
<span class="cp">#define IO7__POX_ERRSUM__PERR             (1UL &lt;&lt; 21)</span>
<span class="cp">#define IO7__POX_ERRSUM__DATAERR_STB_NIOW (1UL &lt;&lt; 22)</span>
<span class="cp">#define IO7__POX_ERRSUM__DETECTED_PERR    (1UL &lt;&lt; 23)</span>
<span class="cp">#define IO7__POX_ERRSUM__PM_PERR          (1UL &lt;&lt; 24)</span>
<span class="cp">#define IO7__POX_ERRSUM__PT_SCERROR       (1UL &lt;&lt; 26)</span>
<span class="cp">#define IO7__POX_ERRSUM__HUNG_BUS         (1UL &lt;&lt; 28)</span>
<span class="cp">#define IO7__POX_ERRSUM__UPE_ERROR__S     (51)</span>
<span class="cp">#define IO7__POX_ERRSUM__UPE_ERROR__M     (0xffUL)</span>
<span class="cp">#define IO7__POX_ERRSUM__UPE_ERROR        GEN_MASK(IO7__POX_ERRSUM__UPE_ERROR)</span>
<span class="cp">#define IO7__POX_ERRSUM__TLB_ERR          (1UL &lt;&lt; 59)</span>
<span class="cp">#define IO7__POX_ERRSUM__ERR_VALID        (1UL &lt;&lt; 63)</span>

<span class="cp">#define IO7__POX_ERRSUM__TRANS_SUM__MASK  (IO7__POX_ERRSUM__MRETRY_TO |       \</span>
<span class="cp">					   IO7__POX_ERRSUM__PCIX_UX_SPL |     \</span>
<span class="cp">					   IO7__POX_ERRSUM__PCIX_SPLIT_TO |   \</span>
<span class="cp">					   IO7__POX_ERRSUM__DMA_TO |          \</span>
<span class="cp">					   IO7__POX_ERRSUM__MABORT_MASK |     \</span>
<span class="cp">					   IO7__POX_ERRSUM__TABORT_MASK |     \</span>
<span class="cp">					   IO7__POX_ERRSUM__SERR |            \</span>
<span class="cp">					   IO7__POX_ERRSUM__ADDRERR_STB |     \</span>
<span class="cp">					   IO7__POX_ERRSUM__PERR |            \</span>
<span class="cp">					   IO7__POX_ERRSUM__DATAERR_STB_NIOW |\</span>
<span class="cp">					   IO7__POX_ERRSUM__DETECTED_PERR |   \</span>
<span class="cp">					   IO7__POX_ERRSUM__PM_PERR |         \</span>
<span class="cp">					   IO7__POX_ERRSUM__PT_SCERROR |      \</span>
<span class="cp">					   IO7__POX_ERRSUM__UPE_ERROR)</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__ERR_VALID</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * First the transaction summary errors</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__MRETRY_TO</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    IO7 Master Retry Timeout expired</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__PCIX_UX_SPL</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Unexpected Split Completion</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__PCIX_SPLIT_TO</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    IO7 Split Completion Timeout expired</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__DMA_TO</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Hung bus during DMA transaction</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__MABORT_MASK</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Master Abort</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__PT_TABORT</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    IO7 Asserted Target Abort</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__PM_TABORT</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    IO7 Received Target Abort</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__ADDRERR_STB</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Address or PCI-X Attribute Parity Error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> 
		       <span class="n">err_print_prefix</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__SERR</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s     IO7 Asserted SERR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__PERR</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__DATAERR_STB_NIOW</span><span class="p">)</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    IO7 Detected Data Parity Error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">err_print_prefix</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Split Completion Response with &quot;</span>
			       <span class="s">&quot;Parity Error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__DETECTED_PERR</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    PERR detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__PM_PERR</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    PERR while IO7 is master</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__PT_SCERROR</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    IO7 Received Split Completion Error message</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">);</span>
		<span class="n">marvel_print_pox_spl_cmplt</span><span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">pox_spl_cmplt</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__UPE_ERROR</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">upe_error</span> <span class="o">=</span> <span class="n">EXTRACT</span><span class="p">(</span><span class="n">err_sum</span><span class="p">,</span>
						 <span class="n">IO7__POX_ERRSUM__UPE_ERROR</span><span class="p">);</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">upe_errors</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="s">&quot;Parity Error on MSI write data&quot;</span><span class="p">,</span>
			<span class="s">&quot;MSI read (MSI window is write only&quot;</span><span class="p">,</span>
			<span class="s">&quot;TLB - Invalid WR transaction&quot;</span><span class="p">,</span>
			<span class="s">&quot;TLB - Invalid RD transaction&quot;</span><span class="p">,</span>
			<span class="s">&quot;DMA - WR error (see north port)&quot;</span><span class="p">,</span>
			<span class="s">&quot;DMA - RD error (see north port)&quot;</span><span class="p">,</span>
			<span class="s">&quot;PPR - WR error (see north port)&quot;</span><span class="p">,</span>
			<span class="s">&quot;PPR - RD error (see north port)&quot;</span>
		<span class="p">};</span>

		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    UPE Error:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">upe_error</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s      %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">,</span>
				       <span class="n">upe_errors</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * POx_TRANS_SUM, if appropriate.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__TRANS_SUM__MASK</span><span class="p">)</span> 
		<span class="n">marvel_print_pox_trans_sum</span><span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">pox_trans_sum</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Then TLB_ERR.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__TLB_ERR</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    TLB ERROR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
		<span class="n">marvel_print_pox_tlb_err</span><span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">pox_tlb_err</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * And the single bit status errors.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__AGP_REQQ_OVFL</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    AGP Request Queue Overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__AGP_SYNC_ERR</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    AGP Sync Error</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__PCIX_DISCARD_SPL</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    Discarded split completion</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__DMA_RD_TO</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    DMA Read Timeout</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__CSR_NXM_RD</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    CSR NXM READ</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__CSR_NXM_WR</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    CSR NXM WRITE</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__DETECTED_SERR</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    SERR detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="n">IO7__POX_ERRSUM__HUNG_BUS</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s    HUNG BUS detected</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err_print_prefix</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#endif </span><span class="cm">/* CONFIG_VERBOSE_MCHECK */</span><span class="cp"></span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">ev7_pal_io_subpacket</span> <span class="o">*</span>
<span class="nf">marvel_find_io7_with_error</span><span class="p">(</span><span class="k">struct</span> <span class="n">ev7_lf_subpackets</span> <span class="o">*</span><span class="n">lf_subpackets</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ev7_pal_io_subpacket</span> <span class="o">*</span><span class="n">io</span> <span class="o">=</span> <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">io7</span> <span class="o">*</span><span class="n">io7</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Caller must provide the packet to fill</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Fill the subpacket with the console&#39;s standard fill pattern</span>
<span class="cm">	 */</span>
	<span class="n">memset</span><span class="p">(</span><span class="n">io</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">io</span><span class="p">));</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">io7</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="nb">NULL</span> <span class="o">!=</span> <span class="p">(</span><span class="n">io7</span> <span class="o">=</span> <span class="n">marvel_next_io7</span><span class="p">(</span><span class="n">io7</span><span class="p">));</span> <span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">err_sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

		<span class="n">err_sum</span> <span class="o">|=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">PO7_ERROR_SUM</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IO7_NUM_PORTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io7</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enabled</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="n">err_sum</span> <span class="o">|=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_ERR_SUM</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="cm">/*</span>
<span class="cm">		 * Is there at least one error? </span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err_sum</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1UL</span> <span class="o">&lt;&lt;</span> <span class="mi">63</span><span class="p">))</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * Did we find an IO7 with an error?</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io7</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * We have an IO7 with an error. </span>
<span class="cm">	 *</span>
<span class="cm">	 * Fill in the IO subpacket.</span>
<span class="cm">	 */</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">io_asic_rev</span>   <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">IO_ASIC_REV</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">io_sys_rev</span>    <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">IO_SYS_REV</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">io7_uph</span>       <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">IO7_UPH</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">hpi_ctl</span>       <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">HPI_CTL</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">crd_ctl</span>       <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">CRD_CTL</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">hei_ctl</span>       <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">HEI_CTL</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">PO7_ERROR_SUM</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_uncrr_sym</span> <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">PO7_UNCRR_SYM</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_crrct_sym</span> <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">PO7_CRRCT_SYM</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_ugbge_sym</span> <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">PO7_UGBGE_SYM</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_err_pkt0</span>  <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">PO7_ERR_PKT</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">csr</span><span class="p">;</span>
	<span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_err_pkt1</span>  <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">PO7_ERR_PKT</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">csr</span><span class="p">;</span>
	
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IO7_NUM_PORTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">io7_ioport_csrs</span> <span class="o">*</span><span class="n">csrs</span> <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">csrs</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">io7</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">enabled</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_err_sum</span>   <span class="o">=</span> <span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_ERR_SUM</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_tlb_err</span>   <span class="o">=</span> <span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_TLB_ERR</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_spl_cmplt</span> <span class="o">=</span> <span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_SPL_COMPLT</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_trans_sum</span> <span class="o">=</span> <span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_TRANS_SUM</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_first_err</span> <span class="o">=</span> <span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_FIRST_ERR</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_mult_err</span>  <span class="o">=</span> <span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_MULT_ERR</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_dm_source</span> <span class="o">=</span> <span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_DM_SOURCE</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_dm_dest</span>   <span class="o">=</span> <span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_DM_DEST</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_dm_size</span>   <span class="o">=</span> <span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_DM_SIZE</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
		<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_dm_ctrl</span>   <span class="o">=</span> <span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_DM_CTRL</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>

		<span class="cm">/*</span>
<span class="cm">		 * Ack this port&#39;s errors, if any. POx_ERR_SUM must be last.</span>
<span class="cm">		 *</span>
<span class="cm">		 * Most of the error registers get cleared and unlocked when</span>
<span class="cm">		 * the associated bits in POx_ERR_SUM are cleared (by writing</span>
<span class="cm">		 * 1). POx_TLB_ERR is an exception and must be explicitly </span>
<span class="cm">		 * cleared.</span>
<span class="cm">		 */</span>
		<span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_TLB_ERR</span><span class="p">.</span><span class="n">csr</span> <span class="o">=</span> <span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_tlb_err</span><span class="p">;</span>
		<span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_ERR_SUM</span><span class="p">.</span><span class="n">csr</span> <span class="o">=</span>	<span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_err_sum</span><span class="p">;</span>
		<span class="n">mb</span><span class="p">();</span>
		<span class="n">csrs</span><span class="o">-&gt;</span><span class="n">POx_ERR_SUM</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>		
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * Ack any port 7 error(s).</span>
<span class="cm">	 */</span>
	<span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">PO7_ERROR_SUM</span><span class="p">.</span><span class="n">csr</span> <span class="o">=</span> <span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span><span class="p">;</span>
	<span class="n">mb</span><span class="p">();</span>
	<span class="n">io7</span><span class="o">-&gt;</span><span class="n">csrs</span><span class="o">-&gt;</span><span class="n">PO7_ERROR_SUM</span><span class="p">.</span><span class="n">csr</span><span class="p">;</span>
	
	<span class="cm">/*</span>
<span class="cm">	 * Correct the io7_pid.</span>
<span class="cm">	 */</span>
	<span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io_pid</span> <span class="o">=</span> <span class="n">io7</span><span class="o">-&gt;</span><span class="n">pe</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">io</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">marvel_process_io_error</span><span class="p">(</span><span class="k">struct</span> <span class="n">ev7_lf_subpackets</span> <span class="o">*</span><span class="n">lf_subpackets</span><span class="p">,</span> <span class="kt">int</span> <span class="n">print</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">MCHK_DISPOSITION_UNKNOWN_ERROR</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_VERBOSE_MCHECK</span>
	<span class="k">struct</span> <span class="n">ev7_pal_io_subpacket</span> <span class="o">*</span><span class="n">io</span> <span class="o">=</span> <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_VERBOSE_MCHECK */</span><span class="cp"></span>

<span class="cp">#define MARVEL_IO_ERR_VALID(x)  ((x) &amp; (1UL &lt;&lt; 63))</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">logout</span> <span class="o">||</span> <span class="o">!</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * The PALcode only builds an IO subpacket if there is a </span>
<span class="cm">	 * locally connected IO7. In the cases of</span>
<span class="cm">	 *	1) a uniprocessor kernel</span>
<span class="cm">	 *	2) an mp kernel before the local secondary has called in</span>
<span class="cm">	 * error interrupts are all directed to the primary processor.</span>
<span class="cm">	 * In that case, we may not have an IO subpacket at all and, event</span>
<span class="cm">	 * if we do, it may not be the right now. </span>
<span class="cm">	 *</span>
<span class="cm">	 * If the RBOX indicates an I/O error interrupt, make sure we have</span>
<span class="cm">	 * the correct IO7 information. If we don&#39;t have an IO subpacket</span>
<span class="cm">	 * or it&#39;s the wrong one, try to find the right one.</span>
<span class="cm">	 *</span>
<span class="cm">	 * RBOX I/O error interrupts are indicated by RBOX_INT&lt;29&gt; and</span>
<span class="cm">	 * RBOX_INT&lt;10&gt;.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1UL</span> <span class="o">&lt;&lt;</span> <span class="mi">32</span><span class="p">))</span> <span class="o">||</span>
	    <span class="p">((</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span>        <span class="o">|</span>
	      <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">pox_err_sum</span> <span class="o">|</span>
	      <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">pox_err_sum</span> <span class="o">|</span>
	      <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">pox_err_sum</span> <span class="o">|</span>
	      <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">pox_err_sum</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1UL</span> <span class="o">&lt;&lt;</span> <span class="mi">63</span><span class="p">)))</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * Either we have no IO subpacket or no error is</span>
<span class="cm">		 * indicated in the one we do have. Try find the</span>
<span class="cm">		 * one with the error.</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">marvel_find_io7_with_error</span><span class="p">(</span><span class="n">lf_subpackets</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * We have an IO7 indicating an error - we&#39;re going to report it</span>
<span class="cm">	 */</span>
	<span class="n">status</span> <span class="o">=</span> <span class="n">MCHK_DISPOSITION_REPORT</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_VERBOSE_MCHECK</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">print</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">status</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s*Error occurred on IO7 at PID %u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> 
	       <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io_pid</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Check port 7 first</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">po7_error_sum</span> <span class="o">&amp;</span> <span class="n">IO7__PO7_ERRSUM__ERR_MASK</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">marvel_print_po7_err_sum</span><span class="p">(</span><span class="n">io</span><span class="p">);</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">		printk(&quot;%s  PORT 7 ERROR:\n&quot;</span>
<span class="c">		       &quot;%s    PO7_ERROR_SUM: %016llx\n&quot;</span>
<span class="c">		       &quot;%s    PO7_UNCRR_SYM: %016llx\n&quot;</span>
<span class="c">		       &quot;%s    PO7_CRRCT_SYM: %016llx\n&quot;</span>
<span class="c">		       &quot;%s    PO7_UGBGE_SYM: %016llx\n&quot;</span>
<span class="c">		       &quot;%s    PO7_ERR_PKT0:  %016llx\n&quot;</span>
<span class="c">		       &quot;%s    PO7_ERR_PKT1:  %016llx\n&quot;,</span>
<span class="c">		       err_print_prefix,</span>
<span class="c">		       err_print_prefix, io-&gt;po7_error_sum,</span>
<span class="c">		       err_print_prefix, io-&gt;po7_uncrr_sym,</span>
<span class="c">		       err_print_prefix, io-&gt;po7_crrct_sym,</span>
<span class="c">		       err_print_prefix, io-&gt;po7_ugbge_sym,</span>
<span class="c">		       err_print_prefix, io-&gt;po7_err_pkt0,</span>
<span class="c">		       err_print_prefix, io-&gt;po7_err_pkt1);</span>
<span class="cp">#endif</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * Then loop through the ports</span>
<span class="cm">	 */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">IO7_NUM_PORTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">MARVEL_IO_ERR_VALID</span><span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_err_sum</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s  PID %u PORT %d POx_ERR_SUM: %016llx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">,</span> 
		       <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io_pid</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_err_sum</span><span class="p">);</span>
		<span class="n">marvel_print_pox_err</span><span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_err_sum</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s  [ POx_FIRST_ERR: %016llx ]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_first_err</span><span class="p">);</span>
		<span class="n">marvel_print_pox_err</span><span class="p">(</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">pox_first_err</span><span class="p">,</span> 
				     <span class="o">&amp;</span><span class="n">io</span><span class="o">-&gt;</span><span class="n">ports</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

	<span class="p">}</span>


<span class="cp">#endif </span><span class="cm">/* CONFIG_VERBOSE_MCHECK */</span><span class="cp"></span>

	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span>
<span class="nf">marvel_process_logout_frame</span><span class="p">(</span><span class="k">struct</span> <span class="n">ev7_lf_subpackets</span> <span class="o">*</span><span class="n">lf_subpackets</span><span class="p">,</span> <span class="kt">int</span> <span class="n">print</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">MCHK_DISPOSITION_UNKNOWN_ERROR</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * I/O error? </span>
<span class="cm">	 */</span>
<span class="cp">#define EV7__RBOX_INT__IO_ERROR__MASK 0x20000400ul</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">logout</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">logout</span><span class="o">-&gt;</span><span class="n">rbox_int</span> <span class="o">&amp;</span> <span class="mh">0x20000400ul</span><span class="p">))</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">marvel_process_io_error</span><span class="p">(</span><span class="n">lf_subpackets</span><span class="p">,</span> <span class="n">print</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * Probing behind PCI-X bridges can cause machine checks on</span>
<span class="cm">	 * Marvel when the probe is handled by the bridge as a split</span>
<span class="cm">	 * completion transaction. The symptom is an ERROR_RESPONSE </span>
<span class="cm">	 * to a CONFIG address. Since these errors will happen in</span>
<span class="cm">	 * normal operation, dismiss them.</span>
<span class="cm">	 *</span>
<span class="cm">	 * Dismiss if:</span>
<span class="cm">	 *	C_STAT		= 0x14 		(Error Response)</span>
<span class="cm">	 *	C_STS&lt;3&gt;	= 0    		(C_ADDR valid)</span>
<span class="cm">	 *	C_ADDR&lt;42&gt;	= 1    		(I/O)</span>
<span class="cm">	 *	C_ADDR&lt;31:22&gt;	= 111110xxb	(PCI Config space)</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">ev7</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">ev7</span><span class="o">-&gt;</span><span class="n">c_stat</span> <span class="o">==</span> <span class="mh">0x14</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="o">!</span><span class="p">(</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">ev7</span><span class="o">-&gt;</span><span class="n">c_sts</span> <span class="o">&amp;</span> <span class="mh">0x8</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">((</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">ev7</span><span class="o">-&gt;</span><span class="n">c_addr</span> <span class="o">&amp;</span> <span class="mh">0x400ff000000ul</span><span class="p">)</span> 
	     <span class="o">==</span> <span class="mh">0x400fe000000ul</span><span class="p">))</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">MCHK_DISPOSITION_DISMISS</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">marvel_machine_check</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">vector</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">la_ptr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">el_subpacket</span> <span class="o">*</span><span class="n">el_ptr</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">el_subpacket</span> <span class="o">*</span><span class="p">)</span><span class="n">la_ptr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">process_frame</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ev7_lf_subpackets</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ev7_lf_subpackets</span> <span class="n">subpacket_collection</span> <span class="o">=</span> <span class="p">{</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">};</span>
	<span class="k">struct</span> <span class="n">ev7_pal_io_subpacket</span> <span class="n">scratch_io_packet</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="p">};</span>
	<span class="k">struct</span> <span class="n">ev7_lf_subpackets</span> <span class="o">*</span><span class="n">lf_subpackets</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">disposition</span> <span class="o">=</span> <span class="n">MCHK_DISPOSITION_UNKNOWN_ERROR</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">saved_err_prefix</span> <span class="o">=</span> <span class="n">err_print_prefix</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">error_type</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Sync the processor</span>
<span class="cm">	 */</span>
	<span class="n">mb</span><span class="p">();</span>
	<span class="n">draina</span><span class="p">();</span>

	<span class="k">switch</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SCB_Q_SYSEVENT</span>:
		<span class="n">process_frame</span> <span class="o">=</span> <span class="n">marvel_process_680_frame</span><span class="p">;</span>
		<span class="n">error_type</span> <span class="o">=</span> <span class="s">&quot;System Event&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SCB_Q_SYSMCHK</span>:
		<span class="n">process_frame</span> <span class="o">=</span> <span class="n">marvel_process_logout_frame</span><span class="p">;</span>
		<span class="n">error_type</span> <span class="o">=</span> <span class="s">&quot;System Uncorrectable Error&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SCB_Q_SYSERR</span>:
		<span class="n">process_frame</span> <span class="o">=</span> <span class="n">marvel_process_logout_frame</span><span class="p">;</span>
		<span class="n">error_type</span> <span class="o">=</span> <span class="s">&quot;System Correctable Error&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="cm">/* Don&#39;t know it - pass it up.  */</span>
		<span class="n">ev7_machine_check</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">la_ptr</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>	

	<span class="cm">/*</span>
<span class="cm">	 * A system event or error has occurred, handle it here.</span>
<span class="cm">	 *</span>
<span class="cm">	 * Any errors in the logout frame have already been cleared by the</span>
<span class="cm">	 * PALcode, so just parse it.</span>
<span class="cm">	 */</span>
	<span class="n">err_print_prefix</span> <span class="o">=</span> <span class="n">KERN_CRIT</span><span class="p">;</span>

	<span class="cm">/* </span>
<span class="cm">	 * Parse the logout frame without printing first. If the only error(s)</span>
<span class="cm">	 * found are classified as &quot;dismissable&quot;, then just dismiss them and</span>
<span class="cm">	 * don&#39;t print any message</span>
<span class="cm">	 */</span>
	<span class="n">lf_subpackets</span> <span class="o">=</span> 
		<span class="n">ev7_collect_logout_frame_subpackets</span><span class="p">(</span><span class="n">el_ptr</span><span class="p">,</span>
						    <span class="o">&amp;</span><span class="n">subpacket_collection</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">process_frame</span> <span class="o">&amp;&amp;</span> <span class="n">lf_subpackets</span> <span class="o">&amp;&amp;</span> <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">logout</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * We might not have the correct (or any) I/O subpacket.</span>
<span class="cm">		 * [ See marvel_process_io_error() for explanation. ]</span>
<span class="cm">		 * If we don&#39;t have one, point the io subpacket in</span>
<span class="cm">		 * lf_subpackets at scratch_io_packet so that </span>
<span class="cm">		 * marvel_find_io7_with_error() will have someplace to</span>
<span class="cm">		 * store the info.</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span><span class="p">)</span>
			<span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">scratch_io_packet</span><span class="p">;</span>

		<span class="cm">/*</span>
<span class="cm">		 * Default io_pid to the processor reporting the error</span>
<span class="cm">		 * [this will get changed in marvel_find_io7_with_error()</span>
<span class="cm">		 * if a different one is needed]</span>
<span class="cm">		 */</span>
		<span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">io_pid</span> <span class="o">=</span> <span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">logout</span><span class="o">-&gt;</span><span class="n">whami</span><span class="p">;</span>

		<span class="cm">/*</span>
<span class="cm">		 * Evaluate the frames.</span>
<span class="cm">		 */</span>
		<span class="n">disposition</span> <span class="o">=</span> <span class="n">process_frame</span><span class="p">(</span><span class="n">lf_subpackets</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">switch</span><span class="p">(</span><span class="n">disposition</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">MCHK_DISPOSITION_DISMISS</span>:
		<span class="cm">/* Nothing to do. */</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">MCHK_DISPOSITION_REPORT</span>:
		<span class="cm">/* Recognized error, report it. */</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s*%s (Vector 0x%x) reported on CPU %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">error_type</span><span class="p">,</span>
		       <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">vector</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">smp_processor_id</span><span class="p">());</span>
		<span class="n">el_print_timestamp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lf_subpackets</span><span class="o">-&gt;</span><span class="n">logout</span><span class="o">-&gt;</span><span class="n">timestamp</span><span class="p">);</span>
		<span class="n">process_frame</span><span class="p">(</span><span class="n">lf_subpackets</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="cm">/* Unknown - dump the annotated subpackets. */</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s*%s (Vector 0x%x) reported on CPU %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">err_print_prefix</span><span class="p">,</span> <span class="n">error_type</span><span class="p">,</span>
		       <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">vector</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">smp_processor_id</span><span class="p">());</span>
		<span class="n">el_process_subpacket</span><span class="p">(</span><span class="n">el_ptr</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="n">err_print_prefix</span> <span class="o">=</span> <span class="n">saved_err_prefix</span><span class="p">;</span>

        <span class="cm">/* Release the logout frame.  */</span>
	<span class="n">wrmces</span><span class="p">(</span><span class="mh">0x7</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">__init</span>
<span class="nf">marvel_register_error_handlers</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ev7_register_error_handlers</span><span class="p">();</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
