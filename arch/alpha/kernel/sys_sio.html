<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › alpha › kernel › sys_sio.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>sys_sio.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *	linux/arch/alpha/kernel/sys_sio.c</span>
<span class="cm"> *</span>
<span class="cm"> *	Copyright (C) 1995 David A Rusling</span>
<span class="cm"> *	Copyright (C) 1996 Jay A Estabrook</span>
<span class="cm"> *	Copyright (C) 1998, 1999 Richard Henderson</span>
<span class="cm"> *</span>
<span class="cm"> * Code for all boards that route the PCI interrupts through the SIO</span>
<span class="cm"> * PCI/ISA bridge.  This includes Noname (AXPpci33), Multia (UDB),</span>
<span class="cm"> * Kenetics&#39;s Platform 2000, Avanti (AlphaStation), XL, and AlphaBook1.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/screen_info.h&gt;</span>

<span class="cp">#include &lt;asm/compiler.h&gt;</span>
<span class="cp">#include &lt;asm/ptrace.h&gt;</span>
<span class="cp">#include &lt;asm/dma.h&gt;</span>
<span class="cp">#include &lt;asm/irq.h&gt;</span>
<span class="cp">#include &lt;asm/mmu_context.h&gt;</span>
<span class="cp">#include &lt;asm/io.h&gt;</span>
<span class="cp">#include &lt;asm/pgtable.h&gt;</span>
<span class="cp">#include &lt;asm/core_apecs.h&gt;</span>
<span class="cp">#include &lt;asm/core_lca.h&gt;</span>
<span class="cp">#include &lt;asm/tlbflush.h&gt;</span>

<span class="cp">#include &quot;proto.h&quot;</span>
<span class="cp">#include &quot;irq_impl.h&quot;</span>
<span class="cp">#include &quot;pci_impl.h&quot;</span>
<span class="cp">#include &quot;machvec_impl.h&quot;</span>
<span class="cp">#include &quot;pc873xx.h&quot;</span>

<span class="cp">#if defined(ALPHA_RESTORE_SRM_SETUP)</span>
<span class="cm">/* Save LCA configuration data as the console had it set up.  */</span>
<span class="k">struct</span> 
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">orig_route_tab</span><span class="p">;</span> <span class="cm">/* for SAVE/RESTORE */</span>
<span class="p">}</span> <span class="n">saved_config</span> <span class="n">__attribute</span><span class="p">((</span><span class="n">common</span><span class="p">));</span>
<span class="cp">#endif</span>


<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span>
<span class="nf">sio_init_irq</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">alpha_using_srm</span><span class="p">)</span>
		<span class="n">alpha_mv</span><span class="p">.</span><span class="n">device_interrupt</span> <span class="o">=</span> <span class="n">srm_device_interrupt</span><span class="p">;</span>

	<span class="n">init_i8259a_irqs</span><span class="p">();</span>
	<span class="n">common_init_isa_dma</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__init</span>
<span class="nf">alphabook1_init_arch</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* The AlphaBook1 has LCD video fixed at 800x600,</span>
<span class="cm">	   37 rows and 100 cols. */</span>
	<span class="n">screen_info</span><span class="p">.</span><span class="n">orig_y</span> <span class="o">=</span> <span class="mi">37</span><span class="p">;</span>
	<span class="n">screen_info</span><span class="p">.</span><span class="n">orig_video_cols</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
	<span class="n">screen_info</span><span class="p">.</span><span class="n">orig_video_lines</span> <span class="o">=</span> <span class="mi">37</span><span class="p">;</span>

	<span class="n">lca_init_arch</span><span class="p">();</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * sio_route_tab selects irq routing in PCI/ISA bridge so that:</span>
<span class="cm"> *		PIRQ0 -&gt; irq 15</span>
<span class="cm"> *		PIRQ1 -&gt; irq  9</span>
<span class="cm"> *		PIRQ2 -&gt; irq 10</span>
<span class="cm"> *		PIRQ3 -&gt; irq 11</span>
<span class="cm"> *</span>
<span class="cm"> * This probably ought to be configurable via MILO.  For</span>
<span class="cm"> * example, sound boards seem to like using IRQ 9.</span>
<span class="cm"> *</span>
<span class="cm"> * This is NOT how we should do it. PIRQ0-X should have</span>
<span class="cm"> * their own IRQs, the way intel uses the IO-APIC IRQs.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span>
<span class="nf">sio_pci_route</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">orig_route_tab</span><span class="p">;</span>

	<span class="cm">/* First, ALWAYS read and print the original setting. */</span>
	<span class="n">pci_bus_read_config_dword</span><span class="p">(</span><span class="n">pci_isa_hose</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">,</span> <span class="n">PCI_DEVFN</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mh">0x60</span><span class="p">,</span>
				  <span class="o">&amp;</span><span class="n">orig_route_tab</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;%s: PIRQ original 0x%x new 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
	       <span class="n">orig_route_tab</span><span class="p">,</span> <span class="n">alpha_mv</span><span class="p">.</span><span class="n">sys</span><span class="p">.</span><span class="n">sio</span><span class="p">.</span><span class="n">route_tab</span><span class="p">);</span>

<span class="cp">#if defined(ALPHA_RESTORE_SRM_SETUP)</span>
	<span class="n">saved_config</span><span class="p">.</span><span class="n">orig_route_tab</span> <span class="o">=</span> <span class="n">orig_route_tab</span><span class="p">;</span>
<span class="cp">#endif</span>

	<span class="cm">/* Now override with desired setting. */</span>
	<span class="n">pci_bus_write_config_dword</span><span class="p">(</span><span class="n">pci_isa_hose</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">,</span> <span class="n">PCI_DEVFN</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mh">0x60</span><span class="p">,</span>
				   <span class="n">alpha_mv</span><span class="p">.</span><span class="n">sys</span><span class="p">.</span><span class="n">sio</span><span class="p">.</span><span class="n">route_tab</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">__init</span>
<span class="nf">sio_collect_irq_levels</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">level_bits</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="cm">/* Iterate through the devices, collecting IRQ levels.  */</span>
	<span class="n">for_each_pci_dev</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">class</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span> <span class="o">==</span> <span class="n">PCI_BASE_CLASS_BRIDGE</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">class</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span> <span class="o">!=</span> <span class="n">PCI_CLASS_BRIDGE_PCMCIA</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">)</span>
			<span class="n">level_bits</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">irq</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">level_bits</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span>
<span class="nf">sio_fixup_irq_levels</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">level_bits</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">old_level_bits</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Now, make all PCI interrupts level sensitive.  Notice:</span>
<span class="cm">	 * these registers must be accessed byte-wise.  inw()/outw()</span>
<span class="cm">	 * don&#39;t work.</span>
<span class="cm">	 *</span>
<span class="cm">	 * Make sure to turn off any level bits set for IRQs 9,10,11,15,</span>
<span class="cm">	 *  so that the only bits getting set are for devices actually found.</span>
<span class="cm">	 * Note that we do preserve the remainder of the bits, which we hope</span>
<span class="cm">	 *  will be set correctly by ARC/SRM.</span>
<span class="cm">	 *</span>
<span class="cm">	 * Note: we at least preserve any level-set bits on AlphaBook1</span>
<span class="cm">	 */</span>
	<span class="n">old_level_bits</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="mh">0x4d0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">inb</span><span class="p">(</span><span class="mh">0x4d1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>

	<span class="n">level_bits</span> <span class="o">|=</span> <span class="p">(</span><span class="n">old_level_bits</span> <span class="o">&amp;</span> <span class="mh">0x71ff</span><span class="p">);</span>

	<span class="n">outb</span><span class="p">((</span><span class="n">level_bits</span> <span class="o">&gt;&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x4d0</span><span class="p">);</span>
	<span class="n">outb</span><span class="p">((</span><span class="n">level_bits</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x4d1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">__init</span>
<span class="nf">noname_map_irq</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">slot</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pin</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * The Noname board has 5 PCI slots with each of the 4</span>
<span class="cm">	 * interrupt pins routed to different pins on the PCI/ISA</span>
<span class="cm">	 * bridge (PIRQ0-PIRQ3).  The table below is based on</span>
<span class="cm">	 * information available at:</span>
<span class="cm">	 *</span>
<span class="cm">	 *   http://ftp.digital.com/pub/DEC/axppci/ref_interrupts.txt</span>
<span class="cm">	 *</span>
<span class="cm">	 * I have no information on the Avanti interrupt routing, but</span>
<span class="cm">	 * the routing seems to be identical to the Noname except</span>
<span class="cm">	 * that the Avanti has an additional slot whose routing I&#39;m</span>
<span class="cm">	 * unsure of.</span>
<span class="cm">	 *</span>
<span class="cm">	 * pirq_tab[0] is a fake entry to deal with old PCI boards</span>
<span class="cm">	 * that have the interrupt pin number hardwired to 0 (meaning</span>
<span class="cm">	 * that they use the default INTA line, if they are interrupt</span>
<span class="cm">	 * driven at all).</span>
<span class="cm">	 */</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="n">irq_tab</span><span class="p">[][</span><span class="mi">5</span><span class="p">]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/*INT A   B   C   D */</span>
		<span class="p">{</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">},</span> <span class="cm">/* idsel  6 (53c810) */</span> 
		<span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel  7 (SIO: PCI/ISA bridge) */</span>
		<span class="p">{</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel  8 (Hack: slot closest ISA) */</span>
		<span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel  9 (unused) */</span>
		<span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel 10 (unused) */</span>
		<span class="p">{</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">},</span> <span class="cm">/* idsel 11 KN25_PCI_SLOT0 */</span>
		<span class="p">{</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel 12 KN25_PCI_SLOT1 */</span>
		<span class="p">{</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">2</span><span class="p">},</span> <span class="cm">/* idsel 13 KN25_PCI_SLOT2 */</span>
		<span class="p">{</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">},</span> <span class="cm">/* idsel 14 AS255 TULIP */</span>
	<span class="p">};</span>
	<span class="k">const</span> <span class="kt">long</span> <span class="n">min_idsel</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">max_idsel</span> <span class="o">=</span> <span class="mi">14</span><span class="p">,</span> <span class="n">irqs_per_slot</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq</span> <span class="o">=</span> <span class="n">COMMON_TABLE_LOOKUP</span><span class="p">,</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">__kernel_extbl</span><span class="p">(</span><span class="n">alpha_mv</span><span class="p">.</span><span class="n">sys</span><span class="p">.</span><span class="n">sio</span><span class="p">.</span><span class="n">route_tab</span><span class="p">,</span> <span class="n">irq</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">irq</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">tmp</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">__init</span>
<span class="nf">p2k_map_irq</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">slot</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pin</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="n">irq_tab</span><span class="p">[][</span><span class="mi">5</span><span class="p">]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/*INT A   B   C   D */</span>
		<span class="p">{</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel  6 (53c810) */</span>
		<span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel  7 (SIO: PCI/ISA bridge) */</span>
		<span class="p">{</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">0</span><span class="p">},</span> <span class="cm">/* idsel  8 (slot A) */</span>
		<span class="p">{</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel  9 (slot B) */</span>
		<span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel 10 (unused) */</span>
		<span class="p">{</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel 11 (unused) */</span>
		<span class="p">{</span> <span class="mi">3</span><span class="p">,</span>  <span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="cm">/* idsel 12 (CMD0646) */</span>
	<span class="p">};</span>
	<span class="k">const</span> <span class="kt">long</span> <span class="n">min_idsel</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">max_idsel</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">irqs_per_slot</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq</span> <span class="o">=</span> <span class="n">COMMON_TABLE_LOOKUP</span><span class="p">,</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">__kernel_extbl</span><span class="p">(</span><span class="n">alpha_mv</span><span class="p">.</span><span class="n">sys</span><span class="p">.</span><span class="n">sio</span><span class="p">.</span><span class="n">route_tab</span><span class="p">,</span> <span class="n">irq</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">irq</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">tmp</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__init</span>
<span class="nf">noname_init_pci</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">common_init_pci</span><span class="p">();</span>
	<span class="n">sio_pci_route</span><span class="p">();</span>
	<span class="n">sio_fixup_irq_levels</span><span class="p">(</span><span class="n">sio_collect_irq_levels</span><span class="p">());</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pc873xx_probe</span><span class="p">()</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Probing for PC873xx Super IO chip failed.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;Found %s Super IO chip at 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">pc873xx_get_model</span><span class="p">(),</span> <span class="n">pc873xx_get_base</span><span class="p">());</span>

		<span class="cm">/* Enabling things in the Super IO chip doesn&#39;t actually</span>
<span class="cm">		 * configure and enable things, the legacy drivers still</span>
<span class="cm">		 * need to do the actual configuration and enabling.</span>
<span class="cm">		 * This only unblocks them.</span>
<span class="cm">		 */</span>

<span class="cp">#if !defined(CONFIG_ALPHA_AVANTI)</span>
		<span class="cm">/* Don&#39;t bother on the Avanti family.</span>
<span class="cm">		 * None of them had on-board IDE.</span>
<span class="cm">		 */</span>
		<span class="n">pc873xx_enable_ide</span><span class="p">();</span>
<span class="cp">#endif</span>
		<span class="n">pc873xx_enable_epp19</span><span class="p">();</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__init</span>
<span class="nf">alphabook1_init_pci</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">orig</span><span class="p">,</span> <span class="n">config</span><span class="p">;</span>

	<span class="n">common_init_pci</span><span class="p">();</span>
	<span class="n">sio_pci_route</span><span class="p">();</span>

	<span class="cm">/*</span>
<span class="cm">	 * On the AlphaBook1, the PCMCIA chip (Cirrus 6729)</span>
<span class="cm">	 * is sensitive to PCI bus bursts, so we must DISABLE</span>
<span class="cm">	 * burst mode for the NCR 8xx SCSI... :-(</span>
<span class="cm">	 *</span>
<span class="cm">	 * Note that the NCR810 SCSI driver must preserve the</span>
<span class="cm">	 * setting of the bit in order for this to work.  At the</span>
<span class="cm">	 * moment (2.0.29), ncr53c8xx.c does NOT do this, but</span>
<span class="cm">	 * 53c7,8xx.c DOES.</span>
<span class="cm">	 */</span>

	<span class="n">dev</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">((</span><span class="n">dev</span> <span class="o">=</span> <span class="n">pci_get_device</span><span class="p">(</span><span class="n">PCI_VENDOR_ID_NCR</span><span class="p">,</span> <span class="n">PCI_ANY_ID</span><span class="p">,</span> <span class="n">dev</span><span class="p">)))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">device</span> <span class="o">==</span> <span class="n">PCI_DEVICE_ID_NCR_53C810</span>
		    <span class="o">||</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">device</span> <span class="o">==</span> <span class="n">PCI_DEVICE_ID_NCR_53C815</span>
		    <span class="o">||</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">device</span> <span class="o">==</span> <span class="n">PCI_DEVICE_ID_NCR_53C820</span>
		    <span class="o">||</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">device</span> <span class="o">==</span> <span class="n">PCI_DEVICE_ID_NCR_53C825</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">io_port</span><span class="p">;</span>
			<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">ctest4</span><span class="p">;</span>

			<span class="n">io_port</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">resource</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">start</span><span class="p">;</span>
			<span class="n">ctest4</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="n">io_port</span><span class="o">+</span><span class="mh">0x21</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">ctest4</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="s">&quot;AlphaBook1 NCR init: setting&quot;</span>
				       <span class="s">&quot; burst disable</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">outb</span><span class="p">(</span><span class="n">ctest4</span> <span class="o">|</span> <span class="mh">0x80</span><span class="p">,</span> <span class="n">io_port</span><span class="o">+</span><span class="mh">0x21</span><span class="p">);</span>
			<span class="p">}</span>
                <span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* Do not set *ANY* level triggers for AlphaBook1. */</span>
	<span class="n">sio_fixup_irq_levels</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* Make sure that register PR1 indicates 1Mb mem */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x3ce</span><span class="p">);</span> <span class="n">orig</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="mh">0x3cf</span><span class="p">);</span>   <span class="cm">/* read PR5  */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x3ce</span><span class="p">);</span> <span class="n">outb</span><span class="p">(</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x3cf</span><span class="p">);</span>   <span class="cm">/* unlock PR0-4 */</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x3ce</span><span class="p">);</span> <span class="n">config</span> <span class="o">=</span> <span class="n">inb</span><span class="p">(</span><span class="mh">0x3cf</span><span class="p">);</span> <span class="cm">/* read PR1 */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">config</span> <span class="o">&amp;</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;AlphaBook1 VGA init: setting 1Mb memory</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">config</span> <span class="o">|=</span> <span class="mh">0xc0</span><span class="p">;</span>
		<span class="n">outb</span><span class="p">(</span><span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x3ce</span><span class="p">);</span> <span class="n">outb</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="mh">0x3cf</span><span class="p">);</span> <span class="cm">/* write PR1 */</span>
	<span class="p">}</span>
	<span class="n">outb</span><span class="p">(</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x3ce</span><span class="p">);</span> <span class="n">outb</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="mh">0x3cf</span><span class="p">);</span> <span class="cm">/* (re)lock PR0-4 */</span>
<span class="p">}</span>

<span class="kt">void</span>
<span class="nf">sio_kill_arch</span><span class="p">(</span><span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#if defined(ALPHA_RESTORE_SRM_SETUP)</span>
	<span class="cm">/* Since we cannot read the PCI DMA Window CSRs, we</span>
<span class="cm">	 * cannot restore them here.</span>
<span class="cm">	 *</span>
<span class="cm">	 * However, we CAN read the PIRQ route register, so restore it</span>
<span class="cm">	 * now...</span>
<span class="cm">	 */</span>
 	<span class="n">pci_bus_write_config_dword</span><span class="p">(</span><span class="n">pci_isa_hose</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">,</span> <span class="n">PCI_DEVFN</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mh">0x60</span><span class="p">,</span>
				   <span class="n">saved_config</span><span class="p">.</span><span class="n">orig_route_tab</span><span class="p">);</span>
<span class="cp">#endif</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * The System Vectors</span>
<span class="cm"> */</span>

<span class="cp">#if defined(CONFIG_ALPHA_GENERIC) || defined(CONFIG_ALPHA_BOOK1)</span>
<span class="k">struct</span> <span class="n">alpha_machine_vector</span> <span class="n">alphabook1_mv</span> <span class="n">__initmv</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">vector_name</span>		<span class="o">=</span> <span class="s">&quot;AlphaBook1&quot;</span><span class="p">,</span>
	<span class="n">DO_EV4_MMU</span><span class="p">,</span>
	<span class="n">DO_DEFAULT_RTC</span><span class="p">,</span>
	<span class="n">DO_LCA_IO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">machine_check</span>		<span class="o">=</span> <span class="n">lca_machine_check</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_isa_dma_address</span>	<span class="o">=</span> <span class="n">ALPHA_MAX_ISA_DMA_ADDRESS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_io_address</span>		<span class="o">=</span> <span class="n">DEFAULT_IO_BASE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_mem_address</span>	<span class="o">=</span> <span class="n">APECS_AND_LCA_DEFAULT_MEM_BASE</span><span class="p">,</span>

	<span class="p">.</span><span class="n">nr_irqs</span>		<span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">device_interrupt</span>	<span class="o">=</span> <span class="n">isa_device_interrupt</span><span class="p">,</span>

	<span class="p">.</span><span class="n">init_arch</span>		<span class="o">=</span> <span class="n">alphabook1_init_arch</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>		<span class="o">=</span> <span class="n">sio_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_rtc</span>		<span class="o">=</span> <span class="n">common_init_rtc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_pci</span>		<span class="o">=</span> <span class="n">alphabook1_init_pci</span><span class="p">,</span>
	<span class="p">.</span><span class="n">kill_arch</span>		<span class="o">=</span> <span class="n">sio_kill_arch</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pci_map_irq</span>		<span class="o">=</span> <span class="n">noname_map_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pci_swizzle</span>		<span class="o">=</span> <span class="n">common_swizzle</span><span class="p">,</span>

	<span class="p">.</span><span class="n">sys</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">sio</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* NCR810 SCSI is 14, PCMCIA controller is 15.  */</span>
		<span class="p">.</span><span class="n">route_tab</span>	<span class="o">=</span> <span class="mh">0x0e0f0a0a</span><span class="p">,</span>
	<span class="p">}}</span>
<span class="p">};</span>
<span class="n">ALIAS_MV</span><span class="p">(</span><span class="n">alphabook1</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_ALPHA_GENERIC) || defined(CONFIG_ALPHA_AVANTI)</span>
<span class="k">struct</span> <span class="n">alpha_machine_vector</span> <span class="n">avanti_mv</span> <span class="n">__initmv</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">vector_name</span>		<span class="o">=</span> <span class="s">&quot;Avanti&quot;</span><span class="p">,</span>
	<span class="n">DO_EV4_MMU</span><span class="p">,</span>
	<span class="n">DO_DEFAULT_RTC</span><span class="p">,</span>
	<span class="n">DO_APECS_IO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">machine_check</span>		<span class="o">=</span> <span class="n">apecs_machine_check</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_isa_dma_address</span>	<span class="o">=</span> <span class="n">ALPHA_MAX_ISA_DMA_ADDRESS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_io_address</span>		<span class="o">=</span> <span class="n">DEFAULT_IO_BASE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_mem_address</span>	<span class="o">=</span> <span class="n">APECS_AND_LCA_DEFAULT_MEM_BASE</span><span class="p">,</span>

	<span class="p">.</span><span class="n">nr_irqs</span>		<span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">device_interrupt</span>	<span class="o">=</span> <span class="n">isa_device_interrupt</span><span class="p">,</span>

	<span class="p">.</span><span class="n">init_arch</span>		<span class="o">=</span> <span class="n">apecs_init_arch</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>		<span class="o">=</span> <span class="n">sio_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_rtc</span>		<span class="o">=</span> <span class="n">common_init_rtc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_pci</span>		<span class="o">=</span> <span class="n">noname_init_pci</span><span class="p">,</span>
	<span class="p">.</span><span class="n">kill_arch</span>		<span class="o">=</span> <span class="n">sio_kill_arch</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pci_map_irq</span>		<span class="o">=</span> <span class="n">noname_map_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pci_swizzle</span>		<span class="o">=</span> <span class="n">common_swizzle</span><span class="p">,</span>

	<span class="p">.</span><span class="n">sys</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">sio</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">route_tab</span>	<span class="o">=</span> <span class="mh">0x0b0a050f</span><span class="p">,</span> <span class="cm">/* leave 14 for IDE, 9 for SND */</span>
	<span class="p">}}</span>
<span class="p">};</span>
<span class="n">ALIAS_MV</span><span class="p">(</span><span class="n">avanti</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_ALPHA_GENERIC) || defined(CONFIG_ALPHA_NONAME)</span>
<span class="k">struct</span> <span class="n">alpha_machine_vector</span> <span class="n">noname_mv</span> <span class="n">__initmv</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">vector_name</span>		<span class="o">=</span> <span class="s">&quot;Noname&quot;</span><span class="p">,</span>
	<span class="n">DO_EV4_MMU</span><span class="p">,</span>
	<span class="n">DO_DEFAULT_RTC</span><span class="p">,</span>
	<span class="n">DO_LCA_IO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">machine_check</span>		<span class="o">=</span> <span class="n">lca_machine_check</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_isa_dma_address</span>	<span class="o">=</span> <span class="n">ALPHA_MAX_ISA_DMA_ADDRESS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_io_address</span>		<span class="o">=</span> <span class="n">DEFAULT_IO_BASE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_mem_address</span>	<span class="o">=</span> <span class="n">APECS_AND_LCA_DEFAULT_MEM_BASE</span><span class="p">,</span>

	<span class="p">.</span><span class="n">nr_irqs</span>		<span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">device_interrupt</span>	<span class="o">=</span> <span class="n">srm_device_interrupt</span><span class="p">,</span>

	<span class="p">.</span><span class="n">init_arch</span>		<span class="o">=</span> <span class="n">lca_init_arch</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>		<span class="o">=</span> <span class="n">sio_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_rtc</span>		<span class="o">=</span> <span class="n">common_init_rtc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_pci</span>		<span class="o">=</span> <span class="n">noname_init_pci</span><span class="p">,</span>
	<span class="p">.</span><span class="n">kill_arch</span>		<span class="o">=</span> <span class="n">sio_kill_arch</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pci_map_irq</span>		<span class="o">=</span> <span class="n">noname_map_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pci_swizzle</span>		<span class="o">=</span> <span class="n">common_swizzle</span><span class="p">,</span>

	<span class="p">.</span><span class="n">sys</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">sio</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/* For UDB, the only available PCI slot must not map to IRQ 9,</span>
<span class="cm">		   since that&#39;s the builtin MSS sound chip. That PCI slot</span>
<span class="cm">		   will map to PIRQ1 (for INTA at least), so we give it IRQ 15</span>
<span class="cm">		   instead.</span>

<span class="cm">		   Unfortunately we have to do this for NONAME as well, since</span>
<span class="cm">		   they are co-indicated when the platform type &quot;Noname&quot; is</span>
<span class="cm">		   selected... :-(  */</span>

		<span class="p">.</span><span class="n">route_tab</span>	<span class="o">=</span> <span class="mh">0x0b0a0f0d</span><span class="p">,</span>
	<span class="p">}}</span>
<span class="p">};</span>
<span class="n">ALIAS_MV</span><span class="p">(</span><span class="n">noname</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_ALPHA_GENERIC) || defined(CONFIG_ALPHA_P2K)</span>
<span class="k">struct</span> <span class="n">alpha_machine_vector</span> <span class="n">p2k_mv</span> <span class="n">__initmv</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">vector_name</span>		<span class="o">=</span> <span class="s">&quot;Platform2000&quot;</span><span class="p">,</span>
	<span class="n">DO_EV4_MMU</span><span class="p">,</span>
	<span class="n">DO_DEFAULT_RTC</span><span class="p">,</span>
	<span class="n">DO_LCA_IO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">machine_check</span>		<span class="o">=</span> <span class="n">lca_machine_check</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_isa_dma_address</span>	<span class="o">=</span> <span class="n">ALPHA_MAX_ISA_DMA_ADDRESS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_io_address</span>		<span class="o">=</span> <span class="n">DEFAULT_IO_BASE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_mem_address</span>	<span class="o">=</span> <span class="n">APECS_AND_LCA_DEFAULT_MEM_BASE</span><span class="p">,</span>

	<span class="p">.</span><span class="n">nr_irqs</span>		<span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">device_interrupt</span>	<span class="o">=</span> <span class="n">srm_device_interrupt</span><span class="p">,</span>

	<span class="p">.</span><span class="n">init_arch</span>		<span class="o">=</span> <span class="n">lca_init_arch</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>		<span class="o">=</span> <span class="n">sio_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_rtc</span>		<span class="o">=</span> <span class="n">common_init_rtc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_pci</span>		<span class="o">=</span> <span class="n">noname_init_pci</span><span class="p">,</span>
	<span class="p">.</span><span class="n">kill_arch</span>		<span class="o">=</span> <span class="n">sio_kill_arch</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pci_map_irq</span>		<span class="o">=</span> <span class="n">p2k_map_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pci_swizzle</span>		<span class="o">=</span> <span class="n">common_swizzle</span><span class="p">,</span>

	<span class="p">.</span><span class="n">sys</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">sio</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">route_tab</span>	<span class="o">=</span> <span class="mh">0x0b0a090f</span><span class="p">,</span>
	<span class="p">}}</span>
<span class="p">};</span>
<span class="n">ALIAS_MV</span><span class="p">(</span><span class="n">p2k</span><span class="p">)</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_ALPHA_GENERIC) || defined(CONFIG_ALPHA_XL)</span>
<span class="k">struct</span> <span class="n">alpha_machine_vector</span> <span class="n">xl_mv</span> <span class="n">__initmv</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">vector_name</span>		<span class="o">=</span> <span class="s">&quot;XL&quot;</span><span class="p">,</span>
	<span class="n">DO_EV4_MMU</span><span class="p">,</span>
	<span class="n">DO_DEFAULT_RTC</span><span class="p">,</span>
	<span class="n">DO_APECS_IO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">machine_check</span>		<span class="o">=</span> <span class="n">apecs_machine_check</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_isa_dma_address</span>	<span class="o">=</span> <span class="n">ALPHA_XL_MAX_ISA_DMA_ADDRESS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_io_address</span>		<span class="o">=</span> <span class="n">DEFAULT_IO_BASE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_mem_address</span>	<span class="o">=</span> <span class="n">XL_DEFAULT_MEM_BASE</span><span class="p">,</span>

	<span class="p">.</span><span class="n">nr_irqs</span>		<span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">device_interrupt</span>	<span class="o">=</span> <span class="n">isa_device_interrupt</span><span class="p">,</span>

	<span class="p">.</span><span class="n">init_arch</span>		<span class="o">=</span> <span class="n">apecs_init_arch</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>		<span class="o">=</span> <span class="n">sio_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_rtc</span>		<span class="o">=</span> <span class="n">common_init_rtc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_pci</span>		<span class="o">=</span> <span class="n">noname_init_pci</span><span class="p">,</span>
	<span class="p">.</span><span class="n">kill_arch</span>		<span class="o">=</span> <span class="n">sio_kill_arch</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pci_map_irq</span>		<span class="o">=</span> <span class="n">noname_map_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pci_swizzle</span>		<span class="o">=</span> <span class="n">common_swizzle</span><span class="p">,</span>

	<span class="p">.</span><span class="n">sys</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">sio</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">route_tab</span>	<span class="o">=</span> <span class="mh">0x0b0a090f</span><span class="p">,</span>
	<span class="p">}}</span>
<span class="p">};</span>
<span class="n">ALIAS_MV</span><span class="p">(</span><span class="n">xl</span><span class="p">)</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
