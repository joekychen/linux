<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › alpha › include › asm › core_apecs.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>core_apecs.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __ALPHA_APECS__H__</span>
<span class="cp">#define __ALPHA_APECS__H__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;asm/compiler.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * APECS is the internal name for the 2107x chipset which provides</span>
<span class="cm"> * memory controller and PCI access for the 21064 chip based systems.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is based on:</span>
<span class="cm"> *</span>
<span class="cm"> * DECchip 21071-AA and DECchip 21072-AA Core Logic Chipsets</span>
<span class="cm"> * Data Sheet</span>
<span class="cm"> *</span>
<span class="cm"> * EC-N0648-72</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * david.rusling@reo.mts.dec.com Initial Version.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm">   An AVANTI *might* be an XL, and an XL has only 27 bits of ISA address</span>
<span class="cm">   that get passed through the PCI&lt;-&gt;ISA bridge chip. So we&#39;ve gotta use</span>
<span class="cm">   both windows to max out the physical memory we can DMA to. Sigh...</span>

<span class="cm">   If we try a window at 0 for 1GB as a work-around, we run into conflicts</span>
<span class="cm">   with ISA/PCI bus memory which can&#39;t be relocated, like VGA aperture and</span>
<span class="cm">   BIOS ROMs. So we must put the windows high enough to avoid these areas.</span>

<span class="cm">   We put window 1 at BUS 64Mb for 64Mb, mapping physical 0 to 64Mb-1,</span>
<span class="cm">   and window 2 at BUS 1Gb for 1Gb, mapping physical 0 to 1Gb-1.</span>
<span class="cm">   Yes, this does map 0 to 64Mb-1 twice, but only window 1 will actually</span>
<span class="cm">   be used for that range (via virt_to_bus()).</span>

<span class="cm">   Note that we actually fudge the window 1 maximum as 48Mb instead of 64Mb,</span>
<span class="cm">   to keep virt_to_bus() from returning an address in the first window, for</span>
<span class="cm">   a data area that goes beyond the 64Mb first DMA window.  Sigh...</span>
<span class="cm">   The fudge factor MUST match with &lt;asm/dma.h&gt; MAX_DMA_ADDRESS, but</span>
<span class="cm">   we can&#39;t just use that here, because of header file looping... :-(</span>

<span class="cm">   Window 1 will be used for all DMA from the ISA bus; yes, that does</span>
<span class="cm">   limit what memory an ISA floppy or sound card or Ethernet can touch, but</span>
<span class="cm">   it&#39;s also a known limitation on other platforms as well. We use the</span>
<span class="cm">   same technique that is used on INTEL platforms with similar limitation:</span>
<span class="cm">   set MAX_DMA_ADDRESS and clear some pages&#39; DMAable flags during mem_init().</span>
<span class="cm">   We trust that any ISA bus device drivers will *always* ask for DMAable</span>
<span class="cm">   memory explicitly via kmalloc()/get_free_pages() flags arguments.</span>

<span class="cm">   Note that most PCI bus devices&#39; drivers do *not* explicitly ask for</span>
<span class="cm">   DMAable memory; they count on being able to DMA to any memory they</span>
<span class="cm">   get from kmalloc()/get_free_pages(). They will also use window 1 for</span>
<span class="cm">   any physical memory accesses below 64Mb; the rest will be handled by</span>
<span class="cm">   window 2, maxing out at 1Gb of memory. I trust this is enough... :-)</span>

<span class="cm">   We hope that the area before the first window is large enough so that</span>
<span class="cm">   there will be no overlap at the top end (64Mb). We *must* locate the</span>
<span class="cm">   PCI cards&#39; memory just below window 1, so that there&#39;s still the</span>
<span class="cm">   possibility of being able to access it via SPARSE space. This is</span>
<span class="cm">   important for cards such as the Matrox Millennium, whose Xserver</span>
<span class="cm">   wants to access memory-mapped registers in byte and short lengths.</span>

<span class="cm">   Note that the XL is treated differently from the AVANTI, even though</span>
<span class="cm">   for most other things they are identical. It didn&#39;t seem reasonable to</span>
<span class="cm">   make the AVANTI support pay for the limitations of the XL. It is true,</span>
<span class="cm">   however, that an XL kernel will run on an AVANTI without problems.</span>

<span class="cm">   %%% All of this should be obviated by the ability to route</span>
<span class="cm">   everything through the iommu.</span>
<span class="cm">*/</span>

<span class="cm">/*</span>
<span class="cm"> * 21071-DA Control and Status registers.</span>
<span class="cm"> * These are used for PCI memory access.</span>
<span class="cm"> */</span>
<span class="cp">#define APECS_IOC_DCSR                  (IDENT_ADDR + 0x1A0000000UL)</span>
<span class="cp">#define APECS_IOC_PEAR                  (IDENT_ADDR + 0x1A0000020UL)</span>
<span class="cp">#define APECS_IOC_SEAR                  (IDENT_ADDR + 0x1A0000040UL)</span>
<span class="cp">#define APECS_IOC_DR1                   (IDENT_ADDR + 0x1A0000060UL)</span>
<span class="cp">#define APECS_IOC_DR2                   (IDENT_ADDR + 0x1A0000080UL)</span>
<span class="cp">#define APECS_IOC_DR3                   (IDENT_ADDR + 0x1A00000A0UL)</span>

<span class="cp">#define APECS_IOC_TB1R                  (IDENT_ADDR + 0x1A00000C0UL)</span>
<span class="cp">#define APECS_IOC_TB2R                  (IDENT_ADDR + 0x1A00000E0UL)</span>

<span class="cp">#define APECS_IOC_PB1R                  (IDENT_ADDR + 0x1A0000100UL)</span>
<span class="cp">#define APECS_IOC_PB2R                  (IDENT_ADDR + 0x1A0000120UL)</span>

<span class="cp">#define APECS_IOC_PM1R                  (IDENT_ADDR + 0x1A0000140UL)</span>
<span class="cp">#define APECS_IOC_PM2R                  (IDENT_ADDR + 0x1A0000160UL)</span>

<span class="cp">#define APECS_IOC_HAXR0                 (IDENT_ADDR + 0x1A0000180UL)</span>
<span class="cp">#define APECS_IOC_HAXR1                 (IDENT_ADDR + 0x1A00001A0UL)</span>
<span class="cp">#define APECS_IOC_HAXR2                 (IDENT_ADDR + 0x1A00001C0UL)</span>

<span class="cp">#define APECS_IOC_PMLT                  (IDENT_ADDR + 0x1A00001E0UL)</span>

<span class="cp">#define APECS_IOC_TLBTAG0               (IDENT_ADDR + 0x1A0000200UL)</span>
<span class="cp">#define APECS_IOC_TLBTAG1               (IDENT_ADDR + 0x1A0000220UL)</span>
<span class="cp">#define APECS_IOC_TLBTAG2               (IDENT_ADDR + 0x1A0000240UL)</span>
<span class="cp">#define APECS_IOC_TLBTAG3               (IDENT_ADDR + 0x1A0000260UL)</span>
<span class="cp">#define APECS_IOC_TLBTAG4               (IDENT_ADDR + 0x1A0000280UL)</span>
<span class="cp">#define APECS_IOC_TLBTAG5               (IDENT_ADDR + 0x1A00002A0UL)</span>
<span class="cp">#define APECS_IOC_TLBTAG6               (IDENT_ADDR + 0x1A00002C0UL)</span>
<span class="cp">#define APECS_IOC_TLBTAG7               (IDENT_ADDR + 0x1A00002E0UL)</span>

<span class="cp">#define APECS_IOC_TLBDATA0              (IDENT_ADDR + 0x1A0000300UL)</span>
<span class="cp">#define APECS_IOC_TLBDATA1              (IDENT_ADDR + 0x1A0000320UL)</span>
<span class="cp">#define APECS_IOC_TLBDATA2              (IDENT_ADDR + 0x1A0000340UL)</span>
<span class="cp">#define APECS_IOC_TLBDATA3              (IDENT_ADDR + 0x1A0000360UL)</span>
<span class="cp">#define APECS_IOC_TLBDATA4              (IDENT_ADDR + 0x1A0000380UL)</span>
<span class="cp">#define APECS_IOC_TLBDATA5              (IDENT_ADDR + 0x1A00003A0UL)</span>
<span class="cp">#define APECS_IOC_TLBDATA6              (IDENT_ADDR + 0x1A00003C0UL)</span>
<span class="cp">#define APECS_IOC_TLBDATA7              (IDENT_ADDR + 0x1A00003E0UL)</span>

<span class="cp">#define APECS_IOC_TBIA                  (IDENT_ADDR + 0x1A0000400UL)</span>


<span class="cm">/*</span>
<span class="cm"> * 21071-CA Control and Status registers.</span>
<span class="cm"> * These are used to program memory timing,</span>
<span class="cm"> *  configure memory and initialise the B-Cache.</span>
<span class="cm"> */</span>
<span class="cp">#define APECS_MEM_GCR		        (IDENT_ADDR + 0x180000000UL)</span>
<span class="cp">#define APECS_MEM_EDSR		        (IDENT_ADDR + 0x180000040UL)</span>
<span class="cp">#define APECS_MEM_TAR  		        (IDENT_ADDR + 0x180000060UL)</span>
<span class="cp">#define APECS_MEM_ELAR		        (IDENT_ADDR + 0x180000080UL)</span>
<span class="cp">#define APECS_MEM_EHAR  		(IDENT_ADDR + 0x1800000a0UL)</span>
<span class="cp">#define APECS_MEM_SFT_RST		(IDENT_ADDR + 0x1800000c0UL)</span>
<span class="cp">#define APECS_MEM_LDxLAR 		(IDENT_ADDR + 0x1800000e0UL)</span>
<span class="cp">#define APECS_MEM_LDxHAR 		(IDENT_ADDR + 0x180000100UL)</span>
<span class="cp">#define APECS_MEM_GTR    		(IDENT_ADDR + 0x180000200UL)</span>
<span class="cp">#define APECS_MEM_RTR    		(IDENT_ADDR + 0x180000220UL)</span>
<span class="cp">#define APECS_MEM_VFPR   		(IDENT_ADDR + 0x180000240UL)</span>
<span class="cp">#define APECS_MEM_PDLDR  		(IDENT_ADDR + 0x180000260UL)</span>
<span class="cp">#define APECS_MEM_PDhDR  		(IDENT_ADDR + 0x180000280UL)</span>

<span class="cm">/* Bank x Base Address Register */</span>
<span class="cp">#define APECS_MEM_B0BAR  		(IDENT_ADDR + 0x180000800UL)</span>
<span class="cp">#define APECS_MEM_B1BAR  		(IDENT_ADDR + 0x180000820UL)</span>
<span class="cp">#define APECS_MEM_B2BAR  		(IDENT_ADDR + 0x180000840UL)</span>
<span class="cp">#define APECS_MEM_B3BAR  		(IDENT_ADDR + 0x180000860UL)</span>
<span class="cp">#define APECS_MEM_B4BAR  		(IDENT_ADDR + 0x180000880UL)</span>
<span class="cp">#define APECS_MEM_B5BAR  		(IDENT_ADDR + 0x1800008A0UL)</span>
<span class="cp">#define APECS_MEM_B6BAR  		(IDENT_ADDR + 0x1800008C0UL)</span>
<span class="cp">#define APECS_MEM_B7BAR  		(IDENT_ADDR + 0x1800008E0UL)</span>
<span class="cp">#define APECS_MEM_B8BAR  		(IDENT_ADDR + 0x180000900UL)</span>

<span class="cm">/* Bank x Configuration Register */</span>
<span class="cp">#define APECS_MEM_B0BCR  		(IDENT_ADDR + 0x180000A00UL)</span>
<span class="cp">#define APECS_MEM_B1BCR  		(IDENT_ADDR + 0x180000A20UL)</span>
<span class="cp">#define APECS_MEM_B2BCR  		(IDENT_ADDR + 0x180000A40UL)</span>
<span class="cp">#define APECS_MEM_B3BCR  		(IDENT_ADDR + 0x180000A60UL)</span>
<span class="cp">#define APECS_MEM_B4BCR  		(IDENT_ADDR + 0x180000A80UL)</span>
<span class="cp">#define APECS_MEM_B5BCR  		(IDENT_ADDR + 0x180000AA0UL)</span>
<span class="cp">#define APECS_MEM_B6BCR  		(IDENT_ADDR + 0x180000AC0UL)</span>
<span class="cp">#define APECS_MEM_B7BCR  		(IDENT_ADDR + 0x180000AE0UL)</span>
<span class="cp">#define APECS_MEM_B8BCR  		(IDENT_ADDR + 0x180000B00UL)</span>

<span class="cm">/* Bank x Timing Register A */</span>
<span class="cp">#define APECS_MEM_B0TRA  		(IDENT_ADDR + 0x180000C00UL)</span>
<span class="cp">#define APECS_MEM_B1TRA  		(IDENT_ADDR + 0x180000C20UL)</span>
<span class="cp">#define APECS_MEM_B2TRA  		(IDENT_ADDR + 0x180000C40UL)</span>
<span class="cp">#define APECS_MEM_B3TRA  		(IDENT_ADDR + 0x180000C60UL)</span>
<span class="cp">#define APECS_MEM_B4TRA  		(IDENT_ADDR + 0x180000C80UL)</span>
<span class="cp">#define APECS_MEM_B5TRA  		(IDENT_ADDR + 0x180000CA0UL)</span>
<span class="cp">#define APECS_MEM_B6TRA  		(IDENT_ADDR + 0x180000CC0UL)</span>
<span class="cp">#define APECS_MEM_B7TRA  		(IDENT_ADDR + 0x180000CE0UL)</span>
<span class="cp">#define APECS_MEM_B8TRA  		(IDENT_ADDR + 0x180000D00UL)</span>

<span class="cm">/* Bank x Timing Register B */</span>
<span class="cp">#define APECS_MEM_B0TRB                 (IDENT_ADDR + 0x180000E00UL)</span>
<span class="cp">#define APECS_MEM_B1TRB  		(IDENT_ADDR + 0x180000E20UL)</span>
<span class="cp">#define APECS_MEM_B2TRB  		(IDENT_ADDR + 0x180000E40UL)</span>
<span class="cp">#define APECS_MEM_B3TRB  		(IDENT_ADDR + 0x180000E60UL)</span>
<span class="cp">#define APECS_MEM_B4TRB  		(IDENT_ADDR + 0x180000E80UL)</span>
<span class="cp">#define APECS_MEM_B5TRB  		(IDENT_ADDR + 0x180000EA0UL)</span>
<span class="cp">#define APECS_MEM_B6TRB  		(IDENT_ADDR + 0x180000EC0UL)</span>
<span class="cp">#define APECS_MEM_B7TRB  		(IDENT_ADDR + 0x180000EE0UL)</span>
<span class="cp">#define APECS_MEM_B8TRB  		(IDENT_ADDR + 0x180000F00UL)</span>


<span class="cm">/*</span>
<span class="cm"> * Memory spaces:</span>
<span class="cm"> */</span>
<span class="cp">#define APECS_IACK_SC		        (IDENT_ADDR + 0x1b0000000UL)</span>
<span class="cp">#define APECS_CONF		        (IDENT_ADDR + 0x1e0000000UL)</span>
<span class="cp">#define APECS_IO			(IDENT_ADDR + 0x1c0000000UL)</span>
<span class="cp">#define APECS_SPARSE_MEM		(IDENT_ADDR + 0x200000000UL)</span>
<span class="cp">#define APECS_DENSE_MEM		        (IDENT_ADDR + 0x300000000UL)</span>


<span class="cm">/*</span>
<span class="cm"> * Bit definitions for I/O Controller status register 0:</span>
<span class="cm"> */</span>
<span class="cp">#define APECS_IOC_STAT0_CMD		0xf</span>
<span class="cp">#define APECS_IOC_STAT0_ERR		(1&lt;&lt;4)</span>
<span class="cp">#define APECS_IOC_STAT0_LOST		(1&lt;&lt;5)</span>
<span class="cp">#define APECS_IOC_STAT0_THIT		(1&lt;&lt;6)</span>
<span class="cp">#define APECS_IOC_STAT0_TREF		(1&lt;&lt;7)</span>
<span class="cp">#define APECS_IOC_STAT0_CODE_SHIFT	8</span>
<span class="cp">#define APECS_IOC_STAT0_CODE_MASK	0x7</span>
<span class="cp">#define APECS_IOC_STAT0_P_NBR_SHIFT	13</span>
<span class="cp">#define APECS_IOC_STAT0_P_NBR_MASK	0x7ffff</span>

<span class="cp">#define APECS_HAE_ADDRESS		APECS_IOC_HAXR1</span>


<span class="cm">/*</span>
<span class="cm"> * Data structure for handling APECS machine checks:</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">el_apecs_mikasa_sysdata_mcheck</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_gcr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_edsr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_ter</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_elar</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_ehar</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_ldlr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_ldhr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_base0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_base1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_base2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_base3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_cnfg0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_cnfg1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_cnfg2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_cnfg3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_dcsr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pear</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_sear</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tbr1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tbr2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pbr1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pbr2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pmr1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pmr2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_harx1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_harx2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pmlt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag4</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag5</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag6</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag7</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data4</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data5</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data6</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data7</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pceb_vid</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pceb_did</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pceb_revision</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pceb_command</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pceb_status</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pceb_latency</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pceb_control</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pceb_arbcon</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pceb_arbpri</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">esc_id</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">esc_revision</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">esc_int0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">esc_int1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">esc_elcr0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">esc_elcr1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">esc_last_eisa</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">esc_nmi_stat</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pci_ir</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pci_imr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">svr_mgr</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* This for the normal APECS machines.  */</span>
<span class="k">struct</span> <span class="n">el_apecs_sysdata_mcheck</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_gcr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_edsr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_ter</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_elar</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_ehar</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_ldlr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_ldhr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_base0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_base1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_base2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_cnfg0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_cnfg1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">coma_cnfg2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_dcsr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pear</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_sear</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tbr1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tbr2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pbr1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pbr2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pmr1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pmr2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_harx1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_harx2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_pmlt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag4</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag5</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag6</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_tag7</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data4</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data5</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data6</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">epic_data7</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">el_apecs_procdata</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">paltemp</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>  <span class="cm">/* PAL TEMP REGS. */</span>
	<span class="cm">/* EV4-specific fields */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">exc_addr</span><span class="p">;</span>     <span class="cm">/* Address of excepting instruction. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">exc_sum</span><span class="p">;</span>      <span class="cm">/* Summary of arithmetic traps. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">exc_mask</span><span class="p">;</span>     <span class="cm">/* Exception mask (from exc_sum). */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">iccsr</span><span class="p">;</span>        <span class="cm">/* IBox hardware enables. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">pal_base</span><span class="p">;</span>     <span class="cm">/* Base address for PALcode. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">hier</span><span class="p">;</span>         <span class="cm">/* Hardware Interrupt Enable. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">hirr</span><span class="p">;</span>         <span class="cm">/* Hardware Interrupt Request. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">csr</span><span class="p">;</span>          <span class="cm">/* D-stream fault info. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dc_stat</span><span class="p">;</span>      <span class="cm">/* D-cache status (ECC/Parity Err). */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dc_addr</span><span class="p">;</span>      <span class="cm">/* EV3 Phys Addr for ECC/DPERR. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">abox_ctl</span><span class="p">;</span>     <span class="cm">/* ABox Control Register. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">biu_stat</span><span class="p">;</span>     <span class="cm">/* BIU Status. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">biu_addr</span><span class="p">;</span>     <span class="cm">/* BUI Address. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">biu_ctl</span><span class="p">;</span>      <span class="cm">/* BIU Control. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">fill_syndrome</span><span class="p">;</span><span class="cm">/* For correcting ECC errors. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">fill_addr</span><span class="p">;</span>    <span class="cm">/* Cache block which was being read */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">va</span><span class="p">;</span>           <span class="cm">/* Effective VA of fault or miss. */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bc_tag</span><span class="p">;</span>       <span class="cm">/* Backup Cache Tag Probe Results.*/</span>
<span class="p">};</span>


<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#ifndef __EXTERN_INLINE</span>
<span class="cp">#define __EXTERN_INLINE extern inline</span>
<span class="cp">#define __IO_EXTERN_INLINE</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * I/O functions:</span>
<span class="cm"> *</span>
<span class="cm"> * Unlike Jensen, the APECS machines have no concept of local</span>
<span class="cm"> * I/O---everything goes over the PCI bus.</span>
<span class="cm"> *</span>
<span class="cm"> * There is plenty room for optimization here.  In particular,</span>
<span class="cm"> * the Alpha&#39;s insb/insw/extb/extw should be useful in moving</span>
<span class="cm"> * data to/from the right byte-lanes.</span>
<span class="cm"> */</span>

<span class="cp">#define vip	volatile int __force *</span>
<span class="cp">#define vuip	volatile unsigned int __force *</span>
<span class="cp">#define vulp	volatile unsigned long __force *</span>

<span class="cp">#define APECS_SET_HAE						\</span>
<span class="cp">	do {							\</span>
<span class="cp">		if (addr &gt;= (1UL &lt;&lt; 24)) {			\</span>
<span class="cp">			unsigned long msb = addr &amp; 0xf8000000;	\</span>
<span class="cp">			addr -= msb;				\</span>
<span class="cp">			set_hae(msb);				\</span>
<span class="cp">		}						\</span>
<span class="cp">	} while (0)</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">apecs_ioread8</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">result</span><span class="p">,</span> <span class="n">base_and_type</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">APECS_DENSE_MEM</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">addr</span> <span class="o">-=</span> <span class="n">APECS_DENSE_MEM</span><span class="p">;</span>
		<span class="n">APECS_SET_HAE</span><span class="p">;</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">APECS_SPARSE_MEM</span> <span class="o">+</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">addr</span> <span class="o">-=</span> <span class="n">APECS_IO</span><span class="p">;</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">APECS_IO</span> <span class="o">+</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">result</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">vip</span><span class="p">)</span> <span class="p">((</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">base_and_type</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">__kernel_extbl</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">addr</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="nf">apecs_iowrite8</span><span class="p">(</span><span class="n">u8</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">w</span><span class="p">,</span> <span class="n">base_and_type</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">APECS_DENSE_MEM</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">addr</span> <span class="o">-=</span> <span class="n">APECS_DENSE_MEM</span><span class="p">;</span>
		<span class="n">APECS_SET_HAE</span><span class="p">;</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">APECS_SPARSE_MEM</span> <span class="o">+</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">addr</span> <span class="o">-=</span> <span class="n">APECS_IO</span><span class="p">;</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">APECS_IO</span> <span class="o">+</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">w</span> <span class="o">=</span> <span class="n">__kernel_insbl</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="o">*</span><span class="p">(</span><span class="n">vuip</span><span class="p">)</span> <span class="p">((</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">base_and_type</span><span class="p">)</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">apecs_ioread16</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">result</span><span class="p">,</span> <span class="n">base_and_type</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">APECS_DENSE_MEM</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">addr</span> <span class="o">-=</span> <span class="n">APECS_DENSE_MEM</span><span class="p">;</span>
		<span class="n">APECS_SET_HAE</span><span class="p">;</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">APECS_SPARSE_MEM</span> <span class="o">+</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">addr</span> <span class="o">-=</span> <span class="n">APECS_IO</span><span class="p">;</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">APECS_IO</span> <span class="o">+</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">result</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">vip</span><span class="p">)</span> <span class="p">((</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">base_and_type</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">__kernel_extwl</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">addr</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="nf">apecs_iowrite16</span><span class="p">(</span><span class="n">u16</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">w</span><span class="p">,</span> <span class="n">base_and_type</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">APECS_DENSE_MEM</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">addr</span> <span class="o">-=</span> <span class="n">APECS_DENSE_MEM</span><span class="p">;</span>
		<span class="n">APECS_SET_HAE</span><span class="p">;</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">APECS_SPARSE_MEM</span> <span class="o">+</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">addr</span> <span class="o">-=</span> <span class="n">APECS_IO</span><span class="p">;</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">APECS_IO</span> <span class="o">+</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">w</span> <span class="o">=</span> <span class="n">__kernel_inswl</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="o">*</span><span class="p">(</span><span class="n">vuip</span><span class="p">)</span> <span class="p">((</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">base_and_type</span><span class="p">)</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">apecs_ioread32</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&lt;</span> <span class="n">APECS_DENSE_MEM</span><span class="p">)</span>
		<span class="n">addr</span> <span class="o">=</span> <span class="p">((</span><span class="n">addr</span> <span class="o">-</span> <span class="n">APECS_IO</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">APECS_IO</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">vuip</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="nf">apecs_iowrite32</span><span class="p">(</span><span class="n">u32</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&lt;</span> <span class="n">APECS_DENSE_MEM</span><span class="p">)</span>
		<span class="n">addr</span> <span class="o">=</span> <span class="p">((</span><span class="n">addr</span> <span class="o">-</span> <span class="n">APECS_IO</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">APECS_IO</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="o">*</span><span class="p">(</span><span class="n">vuip</span><span class="p">)</span><span class="n">addr</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">apecs_ioportmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)(</span><span class="n">addr</span> <span class="o">+</span> <span class="n">APECS_IO</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">apecs_ioremap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span>
					    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)(</span><span class="n">addr</span> <span class="o">+</span> <span class="n">APECS_DENSE_MEM</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">int</span> <span class="nf">apecs_is_ioaddr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">IDENT_ADDR</span> <span class="o">+</span> <span class="mh">0x180000000UL</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">int</span> <span class="nf">apecs_is_mmio</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">APECS_DENSE_MEM</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#undef APECS_SET_HAE</span>

<span class="cp">#undef vip</span>
<span class="cp">#undef vuip</span>
<span class="cp">#undef vulp</span>

<span class="cp">#undef __IO_PREFIX</span>
<span class="cp">#define __IO_PREFIX		apecs</span>
<span class="cp">#define apecs_trivial_io_bw	0</span>
<span class="cp">#define apecs_trivial_io_lq	0</span>
<span class="cp">#define apecs_trivial_rw_bw	2</span>
<span class="cp">#define apecs_trivial_rw_lq	1</span>
<span class="cp">#define apecs_trivial_iounmap	1</span>
<span class="cp">#include &lt;asm/io_trivial.h&gt;</span>

<span class="cp">#ifdef __IO_EXTERN_INLINE</span>
<span class="cp">#undef __EXTERN_INLINE</span>
<span class="cp">#undef __IO_EXTERN_INLINE</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ALPHA_APECS__H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
