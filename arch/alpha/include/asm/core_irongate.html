<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › alpha › include › asm › core_irongate.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>core_irongate.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __ALPHA_IRONGATE__H__</span>
<span class="cp">#define __ALPHA_IRONGATE__H__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;asm/compiler.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * IRONGATE is the internal name for the AMD-751 K7 core logic chipset</span>
<span class="cm"> * which provides memory controller and PCI access for NAUTILUS-based</span>
<span class="cm"> * EV6 (21264) systems.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is based on:</span>
<span class="cm"> *</span>
<span class="cm"> * IronGate management library, (c) 1999 Alpha Processor, Inc.</span>
<span class="cm"> * Copyright (C) 1999 Alpha Processor, Inc.,</span>
<span class="cm"> *	(David Daniel, Stig Telfer, Soohoon Lee)</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * The 21264 supports, and internally recognizes, a 44-bit physical</span>
<span class="cm"> * address space that is divided equally between memory address space</span>
<span class="cm"> * and I/O address space. Memory address space resides in the lower</span>
<span class="cm"> * half of the physical address space (PA[43]=0) and I/O address space</span>
<span class="cm"> * resides in the upper half of the physical address space (PA[43]=1).</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Irongate CSR map.  Some of the CSRs are 8 or 16 bits, but all access</span>
<span class="cm"> * through the routines given is 32-bit.</span>
<span class="cm"> *</span>
<span class="cm"> * The first 0x40 bytes are standard as per the PCI spec.</span>
<span class="cm"> */</span>

<span class="k">typedef</span> <span class="k">volatile</span> <span class="n">__u32</span>	<span class="n">igcsr32</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">igcsr32</span> <span class="n">dev_vendor</span><span class="p">;</span>		<span class="cm">/* 0x00 - device ID, vendor ID */</span>
	<span class="n">igcsr32</span> <span class="n">stat_cmd</span><span class="p">;</span>		<span class="cm">/* 0x04 - status, command */</span>
	<span class="n">igcsr32</span> <span class="n">class</span><span class="p">;</span>			<span class="cm">/* 0x08 - class code, rev ID */</span>
	<span class="n">igcsr32</span> <span class="n">latency</span><span class="p">;</span>		<span class="cm">/* 0x0C - header type, PCI latency */</span>
	<span class="n">igcsr32</span> <span class="n">bar0</span><span class="p">;</span>			<span class="cm">/* 0x10 - BAR0 - AGP */</span>
	<span class="n">igcsr32</span> <span class="n">bar1</span><span class="p">;</span>			<span class="cm">/* 0x14 - BAR1 - GART */</span>
	<span class="n">igcsr32</span> <span class="n">bar2</span><span class="p">;</span>			<span class="cm">/* 0x18 - Power Management reg block */</span>

	<span class="n">igcsr32</span> <span class="n">rsrvd0</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>		<span class="cm">/* 0x1C-0x33 reserved */</span>

	<span class="n">igcsr32</span> <span class="n">capptr</span><span class="p">;</span>			<span class="cm">/* 0x34 - Capabilities pointer */</span>

	<span class="n">igcsr32</span> <span class="n">rsrvd1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>		<span class="cm">/* 0x38-0x3F reserved */</span>

	<span class="n">igcsr32</span> <span class="n">bacsr10</span><span class="p">;</span>		<span class="cm">/* 0x40 - base address chip selects */</span>
	<span class="n">igcsr32</span> <span class="n">bacsr32</span><span class="p">;</span>		<span class="cm">/* 0x44 - base address chip selects */</span>
	<span class="n">igcsr32</span> <span class="n">bacsr54_eccms761</span><span class="p">;</span>	<span class="cm">/* 0x48 - 751: base addr. chip selects</span>
<span class="cm">						  761: ECC, mode/status */</span>

	<span class="n">igcsr32</span> <span class="n">rsrvd2</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>		<span class="cm">/* 0x4C-0x4F reserved */</span>

	<span class="n">igcsr32</span> <span class="n">drammap</span><span class="p">;</span>		<span class="cm">/* 0x50 - address mapping control */</span>
	<span class="n">igcsr32</span> <span class="n">dramtm</span><span class="p">;</span>			<span class="cm">/* 0x54 - timing, driver strength */</span>
	<span class="n">igcsr32</span> <span class="n">dramms</span><span class="p">;</span>			<span class="cm">/* 0x58 - DRAM mode/status */</span>

	<span class="n">igcsr32</span> <span class="n">rsrvd3</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>		<span class="cm">/* 0x5C-0x5F reserved */</span>

	<span class="n">igcsr32</span> <span class="n">biu0</span><span class="p">;</span>			<span class="cm">/* 0x60 - bus interface unit */</span>
	<span class="n">igcsr32</span> <span class="n">biusip</span><span class="p">;</span>			<span class="cm">/* 0x64 - Serial initialisation pkt */</span>

	<span class="n">igcsr32</span> <span class="n">rsrvd4</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>		<span class="cm">/* 0x68-0x6F reserved */</span>

	<span class="n">igcsr32</span> <span class="n">mro</span><span class="p">;</span>			<span class="cm">/* 0x70 - memory request optimiser */</span>

	<span class="n">igcsr32</span> <span class="n">rsrvd5</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>		<span class="cm">/* 0x74-0x7F reserved */</span>

	<span class="n">igcsr32</span> <span class="n">whami</span><span class="p">;</span>			<span class="cm">/* 0x80 - who am I */</span>
	<span class="n">igcsr32</span> <span class="n">pciarb</span><span class="p">;</span>			<span class="cm">/* 0x84 - PCI arbitration control */</span>
	<span class="n">igcsr32</span> <span class="n">pcicfg</span><span class="p">;</span>			<span class="cm">/* 0x88 - PCI config status */</span>

	<span class="n">igcsr32</span> <span class="n">rsrvd6</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* 0x8C-0x9B reserved */</span>

	<span class="n">igcsr32</span> <span class="n">pci_mem</span><span class="p">;</span>		<span class="cm">/* 0x9C - PCI top of memory,</span>
<span class="cm">						  761 only */</span>

	<span class="cm">/* AGP (bus 1) control registers */</span>
	<span class="n">igcsr32</span> <span class="n">agpcap</span><span class="p">;</span>			<span class="cm">/* 0xA0 - AGP Capability Identifier */</span>
	<span class="n">igcsr32</span> <span class="n">agpstat</span><span class="p">;</span>		<span class="cm">/* 0xA4 - AGP status register */</span>
	<span class="n">igcsr32</span> <span class="n">agpcmd</span><span class="p">;</span>			<span class="cm">/* 0xA8 - AGP control register */</span>
	<span class="n">igcsr32</span> <span class="n">agpva</span><span class="p">;</span>			<span class="cm">/* 0xAC - AGP Virtual Address Space */</span>
	<span class="n">igcsr32</span> <span class="n">agpmode</span><span class="p">;</span>		<span class="cm">/* 0xB0 - AGP/GART mode control */</span>
<span class="p">}</span> <span class="n">Irongate0</span><span class="p">;</span>


<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>

	<span class="n">igcsr32</span> <span class="n">dev_vendor</span><span class="p">;</span>		<span class="cm">/* 0x00 - Device and Vendor IDs */</span>
	<span class="n">igcsr32</span> <span class="n">stat_cmd</span><span class="p">;</span>		<span class="cm">/* 0x04 - Status and Command regs */</span>
	<span class="n">igcsr32</span> <span class="n">class</span><span class="p">;</span>			<span class="cm">/* 0x08 - subclass, baseclass etc */</span>
	<span class="n">igcsr32</span> <span class="n">htype</span><span class="p">;</span>			<span class="cm">/* 0x0C - header type (at 0x0E) */</span>
	<span class="n">igcsr32</span> <span class="n">rsrvd0</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>		<span class="cm">/* 0x10-0x17 reserved */</span>
	<span class="n">igcsr32</span> <span class="n">busnos</span><span class="p">;</span>			<span class="cm">/* 0x18 - Primary, secondary bus nos */</span>
	<span class="n">igcsr32</span> <span class="n">io_baselim_regs</span><span class="p">;</span>	<span class="cm">/* 0x1C - IO base, IO lim, AGP status */</span>
	<span class="n">igcsr32</span>	<span class="n">mem_baselim</span><span class="p">;</span>		<span class="cm">/* 0x20 - memory base, memory lim */</span>
	<span class="n">igcsr32</span> <span class="n">pfmem_baselim</span><span class="p">;</span>		<span class="cm">/* 0x24 - prefetchable base, lim */</span>
	<span class="n">igcsr32</span> <span class="n">rsrvd1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>		<span class="cm">/* 0x28-0x2F reserved */</span>
	<span class="n">igcsr32</span> <span class="n">io_baselim</span><span class="p">;</span>		<span class="cm">/* 0x30 - IO base, IO limit */</span>
	<span class="n">igcsr32</span> <span class="n">rsrvd2</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>		<span class="cm">/* 0x34-0x3B - reserved */</span>
	<span class="n">igcsr32</span> <span class="n">interrupt</span><span class="p">;</span>		<span class="cm">/* 0x3C - interrupt, PCI bridge ctrl */</span>

<span class="p">}</span> <span class="n">Irongate1</span><span class="p">;</span>

<span class="k">extern</span> <span class="n">igcsr32</span> <span class="o">*</span><span class="n">IronECC</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * Memory spaces:</span>
<span class="cm"> */</span>

<span class="cm">/* Irongate is consistent with a subset of the Tsunami memory map */</span>
<span class="cp">#ifdef USE_48_BIT_KSEG</span>
<span class="cp">#define IRONGATE_BIAS 0x80000000000UL</span>
<span class="cp">#else</span>
<span class="cp">#define IRONGATE_BIAS 0x10000000000UL</span>
<span class="cp">#endif</span>


<span class="cp">#define IRONGATE_MEM		(IDENT_ADDR | IRONGATE_BIAS | 0x000000000UL)</span>
<span class="cp">#define IRONGATE_IACK_SC	(IDENT_ADDR | IRONGATE_BIAS | 0x1F8000000UL)</span>
<span class="cp">#define IRONGATE_IO		(IDENT_ADDR | IRONGATE_BIAS | 0x1FC000000UL)</span>
<span class="cp">#define IRONGATE_CONF		(IDENT_ADDR | IRONGATE_BIAS | 0x1FE000000UL)</span>

<span class="cm">/*</span>
<span class="cm"> * PCI Configuration space accesses are formed like so:</span>
<span class="cm"> *</span>
<span class="cm"> * 0x1FE &lt;&lt; 24 |  : 2 2 2 2 1 1 1 1 : 1 1 1 1 1 1 0 0 : 0 0 0 0 0 0 0 0 :</span>
<span class="cm"> *                : 3 2 1 0 9 8 7 6 : 5 4 3 2 1 0 9 8 : 7 6 5 4 3 2 1 0 :</span>
<span class="cm"> *                  ---bus numer---   -device-- -fun-   ---register----</span>
<span class="cm"> */</span>

<span class="cp">#define IGCSR(dev,fun,reg)	( IRONGATE_CONF | \</span>
<span class="cp">				((dev)&lt;&lt;11) | \</span>
<span class="cp">				((fun)&lt;&lt;8) | \</span>
<span class="cp">				(reg) )</span>

<span class="cp">#define IRONGATE0		((Irongate0 *) IGCSR(0, 0, 0))</span>
<span class="cp">#define IRONGATE1		((Irongate1 *) IGCSR(1, 0, 0))</span>

<span class="cm">/*</span>
<span class="cm"> * Data structure for handling IRONGATE machine checks:</span>
<span class="cm"> * This is the standard OSF logout frame</span>
<span class="cm"> */</span>

<span class="cp">#define SCB_Q_SYSERR	0x620			</span><span class="cm">/* OSF definitions */</span><span class="cp"></span>
<span class="cp">#define SCB_Q_PROCERR	0x630</span>
<span class="cp">#define SCB_Q_SYSMCHK	0x660</span>
<span class="cp">#define SCB_Q_PROCMCHK	0x670</span>

<span class="k">struct</span> <span class="n">el_IRONGATE_sysdata_mcheck</span> <span class="p">{</span>
	<span class="n">__u32</span> <span class="n">FrameSize</span><span class="p">;</span>                 <span class="cm">/* Bytes, including this field */</span>
	<span class="n">__u32</span> <span class="n">FrameFlags</span><span class="p">;</span>                <span class="cm">/* &lt;31&gt; = Retry, &lt;30&gt; = Second Error */</span>
	<span class="n">__u32</span> <span class="n">CpuOffset</span><span class="p">;</span>                 <span class="cm">/* Offset to CPU-specific into */</span>
	<span class="n">__u32</span> <span class="n">SystemOffset</span><span class="p">;</span>              <span class="cm">/* Offset to system-specific info */</span>
	<span class="n">__u32</span> <span class="n">MCHK_Code</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">MCHK_Frame_Rev</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">I_STAT</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">DC_STAT</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">C_ADDR</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">DC1_SYNDROME</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">DC0_SYNDROME</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">C_STAT</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">C_STS</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">RESERVED0</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">EXC_ADDR</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">IER_CM</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">ISUM</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">MM_STAT</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">PAL_BASE</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">I_CTL</span><span class="p">;</span>
	<span class="n">__u64</span> <span class="n">PCTX</span><span class="p">;</span>
<span class="p">};</span>


<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#ifndef __EXTERN_INLINE</span>
<span class="cp">#define __EXTERN_INLINE extern inline</span>
<span class="cp">#define __IO_EXTERN_INLINE</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * I/O functions:</span>
<span class="cm"> *</span>
<span class="cm"> * IRONGATE (AMD-751) PCI/memory support chip for the EV6 (21264) and</span>
<span class="cm"> * K7 can only use linear accesses to get at PCI memory and I/O spaces.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Memory functions.  All accesses are done through linear space.</span>
<span class="cm"> */</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">irongate_ioportmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)(</span><span class="n">addr</span> <span class="o">+</span> <span class="n">IRONGATE_IO</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">irongate_ioremap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">irongate_iounmap</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">int</span> <span class="nf">irongate_is_ioaddr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">IRONGATE_MEM</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">int</span> <span class="nf">irongate_is_mmio</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">xaddr</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">addr</span> <span class="o">&lt;</span> <span class="n">IRONGATE_IO</span> <span class="o">||</span> <span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">IRONGATE_CONF</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#undef __IO_PREFIX</span>
<span class="cp">#define __IO_PREFIX			irongate</span>
<span class="cp">#define irongate_trivial_rw_bw		1</span>
<span class="cp">#define irongate_trivial_rw_lq		1</span>
<span class="cp">#define irongate_trivial_io_bw		1</span>
<span class="cp">#define irongate_trivial_io_lq		1</span>
<span class="cp">#define irongate_trivial_iounmap	0</span>
<span class="cp">#include &lt;asm/io_trivial.h&gt;</span>

<span class="cp">#ifdef __IO_EXTERN_INLINE</span>
<span class="cp">#undef __EXTERN_INLINE</span>
<span class="cp">#undef __IO_EXTERN_INLINE</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ALPHA_IRONGATE__H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
