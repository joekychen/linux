<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › alpha › include › asm › compiler.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>compiler.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __ALPHA_COMPILER_H</span>
<span class="cp">#define __ALPHA_COMPILER_H</span>

<span class="cm">/* </span>
<span class="cm"> * Herein are macros we use when describing various patterns we want to GCC.</span>
<span class="cm"> * In all cases we can get better schedules out of the compiler if we hide</span>
<span class="cm"> * as little as possible inside inline assembly.  However, we want to be</span>
<span class="cm"> * able to know what we&#39;ll get out before giving up inline assembly.  Thus</span>
<span class="cm"> * these tests and macros.</span>
<span class="cm"> */</span>

<span class="cp">#if __GNUC__ == 3 &amp;&amp; __GNUC_MINOR__ &gt;= 4 || __GNUC__ &gt; 3</span>
<span class="cp"># define __kernel_insbl(val, shift)	__builtin_alpha_insbl(val, shift)</span>
<span class="cp"># define __kernel_inswl(val, shift)	__builtin_alpha_inswl(val, shift)</span>
<span class="cp"># define __kernel_insql(val, shift)	__builtin_alpha_insql(val, shift)</span>
<span class="cp"># define __kernel_inslh(val, shift)	__builtin_alpha_inslh(val, shift)</span>
<span class="cp"># define __kernel_extbl(val, shift)	__builtin_alpha_extbl(val, shift)</span>
<span class="cp"># define __kernel_extwl(val, shift)	__builtin_alpha_extwl(val, shift)</span>
<span class="cp"># define __kernel_cmpbge(a, b)		__builtin_alpha_cmpbge(a, b)</span>
<span class="cp">#else</span>
<span class="cp"># define __kernel_insbl(val, shift)					\</span>
<span class="cp">  ({ unsigned long __kir;						\</span>
<span class="cp">     __asm__(&quot;insbl %2,%1,%0&quot; : &quot;=r&quot;(__kir) : &quot;rI&quot;(shift), &quot;r&quot;(val));	\</span>
<span class="cp">     __kir; })</span>
<span class="cp"># define __kernel_inswl(val, shift)					\</span>
<span class="cp">  ({ unsigned long __kir;						\</span>
<span class="cp">     __asm__(&quot;inswl %2,%1,%0&quot; : &quot;=r&quot;(__kir) : &quot;rI&quot;(shift), &quot;r&quot;(val));	\</span>
<span class="cp">     __kir; })</span>
<span class="cp"># define __kernel_insql(val, shift)					\</span>
<span class="cp">  ({ unsigned long __kir;						\</span>
<span class="cp">     __asm__(&quot;insql %2,%1,%0&quot; : &quot;=r&quot;(__kir) : &quot;rI&quot;(shift), &quot;r&quot;(val));	\</span>
<span class="cp">     __kir; })</span>
<span class="cp"># define __kernel_inslh(val, shift)					\</span>
<span class="cp">  ({ unsigned long __kir;						\</span>
<span class="cp">     __asm__(&quot;inslh %2,%1,%0&quot; : &quot;=r&quot;(__kir) : &quot;rI&quot;(shift), &quot;r&quot;(val));	\</span>
<span class="cp">     __kir; })</span>
<span class="cp"># define __kernel_extbl(val, shift)					\</span>
<span class="cp">  ({ unsigned long __kir;						\</span>
<span class="cp">     __asm__(&quot;extbl %2,%1,%0&quot; : &quot;=r&quot;(__kir) : &quot;rI&quot;(shift), &quot;r&quot;(val));	\</span>
<span class="cp">     __kir; })</span>
<span class="cp"># define __kernel_extwl(val, shift)					\</span>
<span class="cp">  ({ unsigned long __kir;						\</span>
<span class="cp">     __asm__(&quot;extwl %2,%1,%0&quot; : &quot;=r&quot;(__kir) : &quot;rI&quot;(shift), &quot;r&quot;(val));	\</span>
<span class="cp">     __kir; })</span>
<span class="cp"># define __kernel_cmpbge(a, b)						\</span>
<span class="cp">  ({ unsigned long __kir;						\</span>
<span class="cp">     __asm__(&quot;cmpbge %r2,%1,%0&quot; : &quot;=r&quot;(__kir) : &quot;rI&quot;(b), &quot;rJ&quot;(a));	\</span>
<span class="cp">     __kir; })</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef __alpha_cix__</span>
<span class="cp"># if __GNUC__ == 3 &amp;&amp; __GNUC_MINOR__ &gt;= 4 || __GNUC__ &gt; 3</span>
<span class="cp">#  define __kernel_cttz(x)		__builtin_ctzl(x)</span>
<span class="cp">#  define __kernel_ctlz(x)		__builtin_clzl(x)</span>
<span class="cp">#  define __kernel_ctpop(x)		__builtin_popcountl(x)</span>
<span class="cp"># else</span>
<span class="cp">#  define __kernel_cttz(x)						\</span>
<span class="cp">   ({ unsigned long __kir;						\</span>
<span class="cp">      __asm__(&quot;cttz %1,%0&quot; : &quot;=r&quot;(__kir) : &quot;r&quot;(x));			\</span>
<span class="cp">      __kir; })</span>
<span class="cp">#  define __kernel_ctlz(x)						\</span>
<span class="cp">   ({ unsigned long __kir;						\</span>
<span class="cp">      __asm__(&quot;ctlz %1,%0&quot; : &quot;=r&quot;(__kir) : &quot;r&quot;(x));			\</span>
<span class="cp">      __kir; })</span>
<span class="cp">#  define __kernel_ctpop(x)						\</span>
<span class="cp">   ({ unsigned long __kir;						\</span>
<span class="cp">      __asm__(&quot;ctpop %1,%0&quot; : &quot;=r&quot;(__kir) : &quot;r&quot;(x));			\</span>
<span class="cp">      __kir; })</span>
<span class="cp"># endif</span>
<span class="cp">#else</span>
<span class="cp"># define __kernel_cttz(x)						\</span>
<span class="cp">  ({ unsigned long __kir;						\</span>
<span class="cp">     __asm__(&quot;.arch ev67; cttz %1,%0&quot; : &quot;=r&quot;(__kir) : &quot;r&quot;(x));		\</span>
<span class="cp">     __kir; })</span>
<span class="cp"># define __kernel_ctlz(x)						\</span>
<span class="cp">  ({ unsigned long __kir;						\</span>
<span class="cp">     __asm__(&quot;.arch ev67; ctlz %1,%0&quot; : &quot;=r&quot;(__kir) : &quot;r&quot;(x));		\</span>
<span class="cp">     __kir; })</span>
<span class="cp"># define __kernel_ctpop(x)						\</span>
<span class="cp">  ({ unsigned long __kir;						\</span>
<span class="cp">     __asm__(&quot;.arch ev67; ctpop %1,%0&quot; : &quot;=r&quot;(__kir) : &quot;r&quot;(x));		\</span>
<span class="cp">     __kir; })</span>
<span class="cp">#endif</span>


<span class="cm">/* </span>
<span class="cm"> * Beginning with EGCS 1.1, GCC defines __alpha_bwx__ when the BWX </span>
<span class="cm"> * extension is enabled.  Previous versions did not define anything</span>
<span class="cm"> * we could test during compilation -- too bad, so sad.</span>
<span class="cm"> */</span>

<span class="cp">#if defined(__alpha_bwx__)</span>
<span class="cp">#define __kernel_ldbu(mem)	(mem)</span>
<span class="cp">#define __kernel_ldwu(mem)	(mem)</span>
<span class="cp">#define __kernel_stb(val,mem)	((mem) = (val))</span>
<span class="cp">#define __kernel_stw(val,mem)	((mem) = (val))</span>
<span class="cp">#else</span>
<span class="cp">#define __kernel_ldbu(mem)				\</span>
<span class="cp">  ({ unsigned char __kir;				\</span>
<span class="cp">     __asm__(&quot;.arch ev56;				\</span>
<span class="cp">	      ldbu %0,%1&quot; : &quot;=r&quot;(__kir) : &quot;m&quot;(mem));	\</span>
<span class="cp">     __kir; })</span>
<span class="cp">#define __kernel_ldwu(mem)				\</span>
<span class="cp">  ({ unsigned short __kir;				\</span>
<span class="cp">     __asm__(&quot;.arch ev56;				\</span>
<span class="cp">	      ldwu %0,%1&quot; : &quot;=r&quot;(__kir) : &quot;m&quot;(mem));	\</span>
<span class="cp">     __kir; })</span>
<span class="cp">#define __kernel_stb(val,mem)				\</span>
<span class="cp">  __asm__(&quot;.arch ev56;					\</span>
<span class="cp">	   stb %1,%0&quot; : &quot;=m&quot;(mem) : &quot;r&quot;(val))</span>
<span class="cp">#define __kernel_stw(val,mem)				\</span>
<span class="cp">  __asm__(&quot;.arch ev56;					\</span>
<span class="cp">	   stw %1,%0&quot; : &quot;=m&quot;(mem) : &quot;r&quot;(val))</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cm">/* Some idiots over in &lt;linux/compiler.h&gt; thought inline should imply</span>
<span class="cm">   always_inline.  This breaks stuff.  We&#39;ll include this file whenever</span>
<span class="cm">   we run into such problems.  */</span>

<span class="cp">#include &lt;linux/compiler.h&gt;</span>
<span class="cp">#undef inline</span>
<span class="cp">#undef __inline__</span>
<span class="cp">#undef __inline</span>
<span class="cp">#undef __always_inline</span>
<span class="cp">#define __always_inline		inline __attribute__((always_inline))</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ALPHA_COMPILER_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
