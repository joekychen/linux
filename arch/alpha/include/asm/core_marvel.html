<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › alpha › include › asm › core_marvel.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>core_marvel.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Marvel systems use the IO7 I/O chip provides PCI/PCIX/AGP access</span>
<span class="cm"> *</span>
<span class="cm"> * This file is based on:</span>
<span class="cm"> *</span>
<span class="cm"> * Marvel / EV7 System Programmer&#39;s Manual</span>
<span class="cm"> * Revision 1.00</span>
<span class="cm"> * 14 May 2001</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __ALPHA_MARVEL__H__</span>
<span class="cp">#define __ALPHA_MARVEL__H__</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>

<span class="cp">#include &lt;asm/compiler.h&gt;</span>

<span class="cp">#define MARVEL_MAX_PIDS		 32 </span><span class="cm">/* as long as we rely on 43-bit superpage */</span><span class="cp"></span>
<span class="cp">#define MARVEL_IRQ_VEC_PE_SHIFT	(10)</span>
<span class="cp">#define MARVEL_IRQ_VEC_IRQ_MASK	((1 &lt;&lt; MARVEL_IRQ_VEC_PE_SHIFT) - 1)</span>
<span class="cp">#define MARVEL_NR_IRQS		\</span>
<span class="cp">	(16 + (MARVEL_MAX_PIDS * (1 &lt;&lt; MARVEL_IRQ_VEC_PE_SHIFT)))</span>

<span class="cm">/*</span>
<span class="cm"> * EV7 RBOX Registers</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">csr</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">16</span><span class="p">)));</span>
<span class="p">}</span> <span class="n">ev7_csr</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_CFG</span><span class="p">;</span>		<span class="cm">/* 0x0000 */</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_NSVC</span><span class="p">;</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_EWVC</span><span class="p">;</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_WHAMI</span><span class="p">;</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_TCTL</span><span class="p">;</span>		<span class="cm">/* 0x0040 */</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_INT</span><span class="p">;</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_IMASK</span><span class="p">;</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_IREQ</span><span class="p">;</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_INTQ</span><span class="p">;</span>		<span class="cm">/* 0x0080 */</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_INTA</span><span class="p">;</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_IT</span><span class="p">;</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_SCRATCH1</span><span class="p">;</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_SCRATCH2</span><span class="p">;</span>		<span class="cm">/* 0x00c0 */</span>
	<span class="n">ev7_csr</span>	<span class="n">RBOX_L_ERR</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ev7_csrs</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * EV7 CSR addressing macros</span>
<span class="cm"> */</span>
<span class="cp">#define EV7_MASK40(addr)        ((addr) &amp; ((1UL &lt;&lt; 41) - 1))</span>
<span class="cp">#define EV7_KERN_ADDR(addr)	((void *)(IDENT_ADDR | EV7_MASK40(addr)))</span>

<span class="cp">#define EV7_PE_MASK		0x1ffUL </span><span class="cm">/* 9 bits ( 256 + mem/io ) */</span><span class="cp"></span>
<span class="cp">#define EV7_IPE(pe)		((~((long)(pe)) &amp; EV7_PE_MASK) &lt;&lt; 35)</span>

<span class="cp">#define EV7_CSR_PHYS(pe, off)	(EV7_IPE(pe) | (0x7FFCUL &lt;&lt; 20) | (off))</span>
<span class="cp">#define EV7_CSRS_PHYS(pe)	(EV7_CSR_PHYS(pe, 0UL))</span>

<span class="cp">#define EV7_CSR_KERN(pe, off)	(EV7_KERN_ADDR(EV7_CSR_PHYS(pe, off)))</span>
<span class="cp">#define EV7_CSRS_KERN(pe)	(EV7_KERN_ADDR(EV7_CSRS_PHYS(pe)))</span>

<span class="cp">#define EV7_CSR_OFFSET(name)	((unsigned long)&amp;((ev7_csrs *)NULL)-&gt;name.csr)</span>

<span class="cm">/*</span>
<span class="cm"> * IO7 registers</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="k">volatile</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">csr</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">aligned</span><span class="p">(</span><span class="mi">64</span><span class="p">)));</span>
<span class="p">}</span> <span class="n">io7_csr</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="cm">/* I/O Port Control Registers */</span>
	<span class="n">io7_csr</span>	<span class="n">POx_CTRL</span><span class="p">;</span>	       	<span class="cm">/* 0x0000 */</span>
	<span class="n">io7_csr</span>	<span class="n">POx_CACHE_CTL</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_TIMER</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_IO_ADR_EXT</span><span class="p">;</span>
	<span class="n">io7_csr</span>	<span class="n">POx_MEM_ADR_EXT</span><span class="p">;</span>	<span class="cm">/* 0x0100 */</span>
	<span class="n">io7_csr</span> <span class="n">POx_XCAL_CTRL</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">rsvd1</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>	<span class="cm">/* ?? spec doesn&#39;t show 0x180 */</span>
	<span class="n">io7_csr</span> <span class="n">POx_DM_SOURCE</span><span class="p">;</span>		<span class="cm">/* 0x0200 */</span>
	<span class="n">io7_csr</span> <span class="n">POx_DM_DEST</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_DM_SIZE</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_DM_CTRL</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">rsvd2</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* 0x0300 */</span>

	<span class="cm">/* AGP Control Registers -- port 3 only */</span>
	<span class="n">io7_csr</span> <span class="n">AGP_CAP_ID</span><span class="p">;</span>		<span class="cm">/* 0x0400 */</span>
	<span class="n">io7_csr</span> <span class="n">AGP_STAT</span><span class="p">;</span>
	<span class="n">io7_csr</span>	<span class="n">AGP_CMD</span><span class="p">;</span>
	<span class="n">io7_csr</span>	<span class="n">rsvd3</span><span class="p">;</span>

	<span class="cm">/* I/O Port Monitor Registers */</span>
	<span class="n">io7_csr</span>	<span class="n">POx_MONCTL</span><span class="p">;</span>		<span class="cm">/* 0x0500 */</span>
	<span class="n">io7_csr</span> <span class="n">POx_CTRA</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_CTRB</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_CTR56</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_SCRATCH</span><span class="p">;</span>		<span class="cm">/* 0x0600 */</span>
	<span class="n">io7_csr</span> <span class="n">POx_XTRA_A</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_XTRA_TS</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_XTRA_Z</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">rsvd4</span><span class="p">;</span>			<span class="cm">/* 0x0700 */</span>
	<span class="n">io7_csr</span> <span class="n">POx_THRESHA</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_THRESHB</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">rsvd5</span><span class="p">[</span><span class="mi">33</span><span class="p">];</span>

	<span class="cm">/* System Address Space Window Control Registers */</span>

	<span class="n">io7_csr</span> <span class="n">POx_WBASE</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>		<span class="cm">/* 0x1000 */</span>
	<span class="n">io7_csr</span> <span class="n">POx_WMASK</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">POx_TBASE</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">POx_SG_TBIA</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_MSI_WBASE</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">rsvd6</span><span class="p">[</span><span class="mi">50</span><span class="p">];</span>

	<span class="cm">/* I/O Port Error Registers */</span>
	<span class="n">io7_csr</span> <span class="n">POx_ERR_SUM</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_FIRST_ERR</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_MSK_HEI</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_TLB_ERR</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_SPL_COMPLT</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_TRANS_SUM</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_FRC_PCI_ERR</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">POx_MULT_ERR</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">rsvd7</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>

	<span class="cm">/* I/O Port End of Interrupt Registers */</span>
	<span class="n">io7_csr</span> <span class="n">EOI_DAT</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">rsvd8</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">POx_IACK_SPECIAL</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">rsvd9</span><span class="p">[</span><span class="mi">103</span><span class="p">];</span>
<span class="p">}</span> <span class="n">io7_ioport_csrs</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">io7_csr</span> <span class="n">IO_ASIC_REV</span><span class="p">;</span>		<span class="cm">/* 0x30.0000 */</span>
	<span class="n">io7_csr</span> <span class="n">IO_SYS_REV</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">SER_CHAIN3</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_RST1</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_RST2</span><span class="p">;</span>		<span class="cm">/* 0x30.0100 */</span>
	<span class="n">io7_csr</span> <span class="n">POx_RST</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">IO7_DWNH</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">IO7_MAF</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">IO7_MAF_TO</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">IO7_ACC_CLUMP</span><span class="p">;</span>		<span class="cm">/* 0x30.0300 */</span>
	<span class="n">io7_csr</span> <span class="n">IO7_PMASK</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">IO7_IOMASK</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">IO7_UPH</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">IO7_UPH_TO</span><span class="p">;</span>		<span class="cm">/* 0x30.0400 */</span>
	<span class="n">io7_csr</span> <span class="n">RBX_IREQ_OFF</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">RBX_INTA_OFF</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">INT_RTY</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_MONCTL</span><span class="p">;</span>		<span class="cm">/* 0x30.0500 */</span>
	<span class="n">io7_csr</span> <span class="n">PO7_CTRA</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_CTRB</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_CTR56</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_SCRATCH</span><span class="p">;</span>		<span class="cm">/* 0x30.0600 */</span>
	<span class="n">io7_csr</span> <span class="n">PO7_XTRA_A</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_XTRA_TS</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_XTRA_Z</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_PMASK</span><span class="p">;</span>		<span class="cm">/* 0x30.0700 */</span>
	<span class="n">io7_csr</span> <span class="n">PO7_THRESHA</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_THRESHB</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">rsvd1</span><span class="p">[</span><span class="mi">97</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">PO7_ERROR_SUM</span><span class="p">;</span>		<span class="cm">/* 0x30.2000 */</span>
	<span class="n">io7_csr</span> <span class="n">PO7_BHOLE_MASK</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_HEI_MSK</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_CRD_MSK</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_UNCRR_SYM</span><span class="p">;</span>		<span class="cm">/* 0x30.2100 */</span>
	<span class="n">io7_csr</span> <span class="n">PO7_CRRCT_SYM</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_ERR_PKT</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">PO7_UGBGE_SYM</span><span class="p">;</span>		<span class="cm">/* 0x30.2200 */</span>
	<span class="n">io7_csr</span> <span class="n">rsbv2</span><span class="p">[</span><span class="mi">887</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">PO7_LSI_CTL</span><span class="p">[</span><span class="mi">128</span><span class="p">];</span>	<span class="cm">/* 0x31.0000 */</span>
	<span class="n">io7_csr</span> <span class="n">rsvd3</span><span class="p">[</span><span class="mi">123</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">HLT_CTL</span><span class="p">;</span>		<span class="cm">/* 0x31.3ec0 */</span>
	<span class="n">io7_csr</span> <span class="n">HPI_CTL</span><span class="p">;</span>		<span class="cm">/* 0x31.3f00 */</span>
	<span class="n">io7_csr</span> <span class="n">CRD_CTL</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">STV_CTL</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">HEI_CTL</span><span class="p">;</span>
	<span class="n">io7_csr</span> <span class="n">PO7_MSI_CTL</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>	<span class="cm">/* 0x31.4000 */</span>
	<span class="n">io7_csr</span> <span class="n">rsvd4</span><span class="p">[</span><span class="mi">240</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * Interrupt Diagnostic / Test</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">io7_csr</span> <span class="n">INT_PND</span><span class="p">;</span>
		<span class="n">io7_csr</span> <span class="n">INT_CLR</span><span class="p">;</span>
		<span class="n">io7_csr</span> <span class="n">INT_EOI</span><span class="p">;</span>
		<span class="n">io7_csr</span> <span class="n">rsvd</span><span class="p">[</span><span class="mi">29</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">INT_DIAG</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">rsvd5</span><span class="p">[</span><span class="mi">125</span><span class="p">];</span>	    	<span class="cm">/* 0x31.a000 */</span>
	<span class="n">io7_csr</span> <span class="n">MISC_PND</span><span class="p">;</span>		<span class="cm">/* 0x31.b800 */</span>
	<span class="n">io7_csr</span> <span class="n">rsvd6</span><span class="p">[</span><span class="mi">31</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">MSI_PND</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>		<span class="cm">/* 0x31.c000 */</span>
	<span class="n">io7_csr</span> <span class="n">rsvd7</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="n">io7_csr</span> <span class="n">MSI_CLR</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>		<span class="cm">/* 0x31.c800 */</span>
<span class="p">}</span> <span class="n">io7_port7_csrs</span><span class="p">;</span>

<span class="cm">/* </span>
<span class="cm"> * IO7 DMA Window Base register (POx_WBASEx)</span>
<span class="cm"> */</span>
<span class="cp">#define wbase_m_ena  0x1</span>
<span class="cp">#define wbase_m_sg   0x2</span>
<span class="cp">#define wbase_m_dac  0x4</span>
<span class="cp">#define wbase_m_addr 0xFFF00000</span>
<span class="k">union</span> <span class="n">IO7_POx_WBASE</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="n">ena</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* &lt;0&gt;			*/</span>
		<span class="kt">unsigned</span> <span class="n">sg</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* &lt;1&gt;			*/</span>
		<span class="kt">unsigned</span> <span class="n">dac</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* &lt;2&gt; -- window 3 only */</span>
		<span class="kt">unsigned</span> <span class="n">rsvd1</span> <span class="o">:</span> <span class="mi">17</span><span class="p">;</span> 
		<span class="kt">unsigned</span> <span class="n">addr</span> <span class="o">:</span> <span class="mi">12</span><span class="p">;</span>	<span class="cm">/* &lt;31:20&gt;		*/</span>
		<span class="kt">unsigned</span> <span class="n">rsvd2</span> <span class="o">:</span> <span class="mi">32</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">bits</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">as_long</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="n">as_quad</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * IO7 IID (Interrupt IDentifier) format</span>
<span class="cm"> *</span>
<span class="cm"> * For level-sensative interrupts, int_num is encoded as:</span>
<span class="cm"> *</span>
<span class="cm"> *	bus/port	slot/device	INTx</span>
<span class="cm"> *	&lt;7:5&gt;		&lt;4:2&gt;		&lt;1:0&gt;</span>
<span class="cm"> */</span>
<span class="k">union</span> <span class="n">IO7_IID</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="n">int_num</span> <span class="o">:</span> <span class="mi">9</span><span class="p">;</span>		<span class="cm">/* &lt;8:0&gt;    	*/</span>
		<span class="kt">unsigned</span> <span class="n">tpu_mask</span> <span class="o">:</span> <span class="mi">4</span><span class="p">;</span>		<span class="cm">/* &lt;12:9&gt; rsvd	*/</span>
		<span class="kt">unsigned</span> <span class="n">msi</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>		<span class="cm">/* 13		*/</span>
		<span class="kt">unsigned</span> <span class="n">ipe</span> <span class="o">:</span> <span class="mi">10</span><span class="p">;</span>		<span class="cm">/* &lt;23:14&gt;	*/</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rsvd</span> <span class="o">:</span> <span class="mi">40</span><span class="p">;</span>		
	<span class="p">}</span> <span class="n">bits</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">as_long</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">as_quad</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * IO7 addressing macros</span>
<span class="cm"> */</span>
<span class="cp">#define IO7_KERN_ADDR(addr)	(EV7_KERN_ADDR(addr))</span>

<span class="cp">#define IO7_PORT_MASK	   	0x07UL	</span><span class="cm">/* 3 bits of port 	   */</span><span class="cp"></span>

<span class="cp">#define IO7_IPE(pe)		(EV7_IPE(pe))</span>
<span class="cp">#define IO7_IPORT(port)		((~((long)(port)) &amp; IO7_PORT_MASK) &lt;&lt; 32)</span>

<span class="cp">#define IO7_HOSE(pe, port)	(IO7_IPE(pe) | IO7_IPORT(port))</span>

<span class="cp">#define IO7_MEM_PHYS(pe, port)	(IO7_HOSE(pe, port) | 0x00000000UL)</span>
<span class="cp">#define IO7_CONF_PHYS(pe, port)	(IO7_HOSE(pe, port) | 0xFE000000UL)</span>
<span class="cp">#define IO7_IO_PHYS(pe, port)	(IO7_HOSE(pe, port) | 0xFF000000UL)</span>
<span class="cp">#define IO7_CSR_PHYS(pe, port, off) \</span>
<span class="cp">                                (IO7_HOSE(pe, port) | 0xFF800000UL | (off))</span>
<span class="cp">#define IO7_CSRS_PHYS(pe, port)	(IO7_CSR_PHYS(pe, port, 0UL))</span>
<span class="cp">#define IO7_PORT7_CSRS_PHYS(pe) (IO7_CSR_PHYS(pe, 7, 0x300000UL))</span>

<span class="cp">#define IO7_MEM_KERN(pe, port)      (IO7_KERN_ADDR(IO7_MEM_PHYS(pe, port)))</span>
<span class="cp">#define IO7_CONF_KERN(pe, port)     (IO7_KERN_ADDR(IO7_CONF_PHYS(pe, port)))</span>
<span class="cp">#define IO7_IO_KERN(pe, port)       (IO7_KERN_ADDR(IO7_IO_PHYS(pe, port)))</span>
<span class="cp">#define IO7_CSR_KERN(pe, port, off) (IO7_KERN_ADDR(IO7_CSR_PHYS(pe,port,off)))</span>
<span class="cp">#define IO7_CSRS_KERN(pe, port)     (IO7_KERN_ADDR(IO7_CSRS_PHYS(pe, port)))</span>
<span class="cp">#define IO7_PORT7_CSRS_KERN(pe)	    (IO7_KERN_ADDR(IO7_PORT7_CSRS_PHYS(pe)))</span>

<span class="cp">#define IO7_PLL_RNGA(pll)	(((pll) &gt;&gt; 3) &amp; 0x7)</span>
<span class="cp">#define IO7_PLL_RNGB(pll)	(((pll) &gt;&gt; 6) &amp; 0x7)</span>

<span class="cp">#define IO7_MEM_SPACE		(2UL * 1024 * 1024 * 1024)	</span><span class="cm">/* 2GB MEM */</span><span class="cp"></span>
<span class="cp">#define IO7_IO_SPACE		(8UL * 1024 * 1024)		</span><span class="cm">/* 8MB I/O */</span><span class="cp"></span>

 
<span class="cm">/* </span>
<span class="cm"> * Offset between ram physical addresses and pci64 DAC addresses</span>
<span class="cm"> */</span>
<span class="cp">#define IO7_DAC_OFFSET		(1UL &lt;&lt; 49)</span>

<span class="cm">/*</span>
<span class="cm"> * This is needed to satisify the IO() macro used in initializing the machvec</span>
<span class="cm"> */</span>
<span class="cp">#define MARVEL_IACK_SC 							\</span>
<span class="cp">        ((unsigned long)						\</span>
<span class="cp">	 (&amp;(((io7_ioport_csrs *)IO7_CSRS_KERN(0, 0))-&gt;POx_IACK_SPECIAL)))</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/*</span>
<span class="cm"> * IO7 structs</span>
<span class="cm"> */</span>
<span class="cp">#define IO7_NUM_PORTS 4</span>
<span class="cp">#define IO7_AGP_PORT  3</span>

<span class="k">struct</span> <span class="n">io7_port</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">io7</span> <span class="o">*</span><span class="n">io7</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_controller</span> <span class="o">*</span><span class="n">hose</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">enabled</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">port</span><span class="p">;</span>
	<span class="n">io7_ioport_csrs</span> <span class="o">*</span><span class="n">csrs</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">saved_wbase</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">saved_wmask</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">saved_tbase</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">io7</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">io7</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pe</span><span class="p">;</span>
	<span class="n">io7_port7_csrs</span> <span class="o">*</span><span class="n">csrs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">io7_port</span> <span class="n">ports</span><span class="p">[</span><span class="n">IO7_NUM_PORTS</span><span class="p">];</span>

	<span class="n">spinlock_t</span> <span class="n">irq_lock</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#ifndef __EXTERN_INLINE</span>
<span class="cp"># define __EXTERN_INLINE extern inline</span>
<span class="cp"># define __IO_EXTERN_INLINE</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * I/O functions. All access through linear space.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Memory functions.  All accesses through linear space.</span>
<span class="cm"> */</span>

<span class="cp">#define vucp	volatile unsigned char __force *</span>
<span class="cp">#define vusp	volatile unsigned short __force *</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">marvel_ioread8</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">marvel_iowrite8</span><span class="p">(</span><span class="n">u8</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">);</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">marvel_ioread16</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">__kernel_ldwu</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">vusp</span><span class="p">)</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="nf">marvel_iowrite16</span><span class="p">(</span><span class="n">u16</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__kernel_stw</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="n">vusp</span><span class="p">)</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">marvel_ioremap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">marvel_iounmap</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">marvel_ioportmap</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">);</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">int</span> <span class="nf">marvel_is_ioaddr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;&gt;</span> <span class="mi">40</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">marvel_is_mmio</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">);</span>

<span class="cp">#undef vucp</span>
<span class="cp">#undef vusp</span>

<span class="cp">#undef __IO_PREFIX</span>
<span class="cp">#define __IO_PREFIX		marvel</span>
<span class="cp">#define marvel_trivial_rw_bw	1</span>
<span class="cp">#define marvel_trivial_rw_lq	1</span>
<span class="cp">#define marvel_trivial_io_bw	0</span>
<span class="cp">#define marvel_trivial_io_lq	1</span>
<span class="cp">#define marvel_trivial_iounmap	0</span>
<span class="cp">#include &lt;asm/io_trivial.h&gt;</span>

<span class="cp">#ifdef __IO_EXTERN_INLINE</span>
<span class="cp"># undef __EXTERN_INLINE</span>
<span class="cp"># undef __IO_EXTERN_INLINE</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ALPHA_MARVEL__H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
