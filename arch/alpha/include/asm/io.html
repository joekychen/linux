<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › alpha › include › asm › io.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>io.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __ALPHA_IO_H</span>
<span class="cp">#define __ALPHA_IO_H</span>

<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;asm/compiler.h&gt;</span>
<span class="cp">#include &lt;asm/pgtable.h&gt;</span>
<span class="cp">#include &lt;asm/machvec.h&gt;</span>
<span class="cp">#include &lt;asm/hwrpb.h&gt;</span>

<span class="cm">/* The generic header contains only prototypes.  Including it ensures that</span>
<span class="cm">   the implementation we have here matches that interface.  */</span>
<span class="cp">#include &lt;asm-generic/iomap.h&gt;</span>

<span class="cm">/* We don&#39;t use IO slowdowns on the Alpha, but.. */</span>
<span class="cp">#define __SLOW_DOWN_IO	do { } while (0)</span>
<span class="cp">#define SLOW_DOWN_IO	do { } while (0)</span>

<span class="cm">/*</span>
<span class="cm"> * Virtual -&gt; physical identity mapping starts at this offset</span>
<span class="cm"> */</span>
<span class="cp">#ifdef USE_48_BIT_KSEG</span>
<span class="cp">#define IDENT_ADDR     0xffff800000000000UL</span>
<span class="cp">#else</span>
<span class="cp">#define IDENT_ADDR     0xfffffc0000000000UL</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * We try to avoid hae updates (thus the cache), but when we</span>
<span class="cm"> * do need to update the hae, we need to do it atomically, so</span>
<span class="cm"> * that any interrupts wouldn&#39;t get confused with the hae</span>
<span class="cm"> * register not being up-to-date with respect to the hardware</span>
<span class="cm"> * value.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__set_hae</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">new_hae</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">swpipl</span><span class="p">(</span><span class="n">IPL_MAX</span><span class="p">);</span>

	<span class="n">barrier</span><span class="p">();</span>

	<span class="n">alpha_mv</span><span class="p">.</span><span class="n">hae_cache</span> <span class="o">=</span> <span class="n">new_hae</span><span class="p">;</span>
	<span class="o">*</span><span class="n">alpha_mv</span><span class="p">.</span><span class="n">hae_register</span> <span class="o">=</span> <span class="n">new_hae</span><span class="p">;</span>
	<span class="n">mb</span><span class="p">();</span>
	<span class="cm">/* Re-read to make sure it was written.  */</span>
	<span class="n">new_hae</span> <span class="o">=</span> <span class="o">*</span><span class="n">alpha_mv</span><span class="p">.</span><span class="n">hae_register</span><span class="p">;</span>

	<span class="n">setipl</span><span class="p">(</span><span class="n">flags</span><span class="p">);</span>
	<span class="n">barrier</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_hae</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">new_hae</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">new_hae</span> <span class="o">!=</span> <span class="n">alpha_mv</span><span class="p">.</span><span class="n">hae_cache</span><span class="p">)</span>
		<span class="n">__set_hae</span><span class="p">(</span><span class="n">new_hae</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Change virtual addresses to physical addresses and vv.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef USE_48_BIT_KSEG</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">virt_to_phys</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">address</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">address</span> <span class="o">-</span> <span class="n">IDENT_ADDR</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span> <span class="nf">phys_to_virt</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="p">(</span><span class="n">address</span> <span class="o">+</span> <span class="n">IDENT_ADDR</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="nf">virt_to_phys</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">address</span><span class="p">)</span>
<span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">address</span><span class="p">;</span>

	<span class="cm">/* Sign-extend from bit 41.  */</span>
	<span class="n">phys</span> <span class="o">&lt;&lt;=</span> <span class="p">(</span><span class="mi">64</span> <span class="o">-</span> <span class="mi">41</span><span class="p">);</span>
	<span class="n">phys</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">phys</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mi">64</span> <span class="o">-</span> <span class="mi">41</span><span class="p">);</span>

	<span class="cm">/* Crop to the physical address width of the processor.  */</span>
        <span class="n">phys</span> <span class="o">&amp;=</span> <span class="p">(</span><span class="mi">1ul</span> <span class="o">&lt;&lt;</span> <span class="n">hwrpb</span><span class="o">-&gt;</span><span class="n">pa_bits</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">phys</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span> <span class="nf">phys_to_virt</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">)</span>
<span class="p">{</span>
        <span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)(</span><span class="n">IDENT_ADDR</span> <span class="o">+</span> <span class="p">(</span><span class="n">address</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1ul</span> <span class="o">&lt;&lt;</span> <span class="mi">41</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)));</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#define page_to_phys(page)	page_to_pa(page)</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">dma_addr_t</span> <span class="n">__deprecated</span> <span class="nf">isa_page_to_bus</span><span class="p">(</span><span class="k">struct</span> <span class="n">page</span> <span class="o">*</span><span class="n">page</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">page_to_phys</span><span class="p">(</span><span class="n">page</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Maximum PIO space address supported?  */</span>
<span class="cp">#define IO_SPACE_LIMIT 0xffff</span>

<span class="cm">/*</span>
<span class="cm"> * Change addresses as seen by the kernel (virtual) to addresses as</span>
<span class="cm"> * seen by a device (bus), and vice versa.</span>
<span class="cm"> *</span>
<span class="cm"> * Note that this only works for a limited range of kernel addresses,</span>
<span class="cm"> * and very well may not span all memory.  Consider this interface </span>
<span class="cm"> * deprecated in favour of the DMA-mapping API.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__direct_map_base</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__direct_map_size</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">__deprecated</span> <span class="nf">virt_to_bus</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">address</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">phys</span> <span class="o">=</span> <span class="n">virt_to_phys</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">bus</span> <span class="o">=</span> <span class="n">phys</span> <span class="o">+</span> <span class="n">__direct_map_base</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">phys</span> <span class="o">&lt;=</span> <span class="n">__direct_map_size</span> <span class="o">?</span> <span class="n">bus</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#define isa_virt_to_bus virt_to_bus</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="o">*</span> <span class="n">__deprecated</span> <span class="nf">bus_to_virt</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">address</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">virt</span><span class="p">;</span>

	<span class="cm">/* This check is a sanity check but also ensures that bus address 0</span>
<span class="cm">	   maps to virtual address 0 which is useful to detect null pointers</span>
<span class="cm">	   (the NCR driver is much simpler if NULL pointers are preserved).  */</span>
	<span class="n">address</span> <span class="o">-=</span> <span class="n">__direct_map_base</span><span class="p">;</span>
	<span class="n">virt</span> <span class="o">=</span> <span class="n">phys_to_virt</span><span class="p">(</span><span class="n">address</span><span class="p">);</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">address</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="o">?</span> <span class="nb">NULL</span> <span class="o">:</span> <span class="n">virt</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#define isa_bus_to_virt bus_to_virt</span>

<span class="cm">/*</span>
<span class="cm"> * There are different chipsets to interface the Alpha CPUs to the world.</span>
<span class="cm"> */</span>

<span class="cp">#define IO_CONCAT(a,b)	_IO_CONCAT(a,b)</span>
<span class="cp">#define _IO_CONCAT(a,b)	a ## _ ## b</span>

<span class="cp">#ifdef CONFIG_ALPHA_GENERIC</span>

<span class="cm">/* In a generic kernel, we always go through the machine vector.  */</span>

<span class="cp">#define REMAP1(TYPE, NAME, QUAL)					\</span>
<span class="cp">static inline TYPE generic_##NAME(QUAL void __iomem *addr)		\</span>
<span class="cp">{									\</span>
<span class="cp">	return alpha_mv.mv_##NAME(addr);				\</span>
<span class="cp">}</span>

<span class="cp">#define REMAP2(TYPE, NAME, QUAL)					\</span>
<span class="cp">static inline void generic_##NAME(TYPE b, QUAL void __iomem *addr)	\</span>
<span class="cp">{									\</span>
<span class="cp">	alpha_mv.mv_##NAME(b, addr);					\</span>
<span class="cp">}</span>

<span class="n">REMAP1</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">ioread8</span><span class="p">,</span> <span class="cm">/**/</span><span class="p">)</span>
<span class="n">REMAP1</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">ioread16</span><span class="p">,</span> <span class="cm">/**/</span><span class="p">)</span>
<span class="n">REMAP1</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">,</span> <span class="n">ioread32</span><span class="p">,</span> <span class="cm">/**/</span><span class="p">)</span>
<span class="n">REMAP1</span><span class="p">(</span><span class="n">u8</span><span class="p">,</span> <span class="n">readb</span><span class="p">,</span> <span class="k">const</span> <span class="k">volatile</span><span class="p">)</span>
<span class="n">REMAP1</span><span class="p">(</span><span class="n">u16</span><span class="p">,</span> <span class="n">readw</span><span class="p">,</span> <span class="k">const</span> <span class="k">volatile</span><span class="p">)</span>
<span class="n">REMAP1</span><span class="p">(</span><span class="n">u32</span><span class="p">,</span> <span class="n">readl</span><span class="p">,</span> <span class="k">const</span> <span class="k">volatile</span><span class="p">)</span>
<span class="n">REMAP1</span><span class="p">(</span><span class="n">u64</span><span class="p">,</span> <span class="n">readq</span><span class="p">,</span> <span class="k">const</span> <span class="k">volatile</span><span class="p">)</span>

<span class="n">REMAP2</span><span class="p">(</span><span class="n">u8</span><span class="p">,</span> <span class="n">iowrite8</span><span class="p">,</span> <span class="cm">/**/</span><span class="p">)</span>
<span class="n">REMAP2</span><span class="p">(</span><span class="n">u16</span><span class="p">,</span> <span class="n">iowrite16</span><span class="p">,</span> <span class="cm">/**/</span><span class="p">)</span>
<span class="n">REMAP2</span><span class="p">(</span><span class="n">u32</span><span class="p">,</span> <span class="n">iowrite32</span><span class="p">,</span> <span class="cm">/**/</span><span class="p">)</span>
<span class="n">REMAP2</span><span class="p">(</span><span class="n">u8</span><span class="p">,</span> <span class="n">writeb</span><span class="p">,</span> <span class="k">volatile</span><span class="p">)</span>
<span class="n">REMAP2</span><span class="p">(</span><span class="n">u16</span><span class="p">,</span> <span class="n">writew</span><span class="p">,</span> <span class="k">volatile</span><span class="p">)</span>
<span class="n">REMAP2</span><span class="p">(</span><span class="n">u32</span><span class="p">,</span> <span class="n">writel</span><span class="p">,</span> <span class="k">volatile</span><span class="p">)</span>
<span class="n">REMAP2</span><span class="p">(</span><span class="n">u64</span><span class="p">,</span> <span class="n">writeq</span><span class="p">,</span> <span class="k">volatile</span><span class="p">)</span>

<span class="cp">#undef REMAP1</span>
<span class="cp">#undef REMAP2</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">generic_ioportmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">alpha_mv</span><span class="p">.</span><span class="n">mv_ioportmap</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">generic_ioremap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">a</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">alpha_mv</span><span class="p">.</span><span class="n">mv_ioremap</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">generic_iounmap</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">alpha_mv</span><span class="p">.</span><span class="n">mv_iounmap</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">generic_is_ioaddr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">alpha_mv</span><span class="p">.</span><span class="n">mv_is_ioaddr</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="n">generic_is_mmio</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">a</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">alpha_mv</span><span class="p">.</span><span class="n">mv_is_mmio</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define __IO_PREFIX		generic</span>
<span class="cp">#define generic_trivial_rw_bw	0</span>
<span class="cp">#define generic_trivial_rw_lq	0</span>
<span class="cp">#define generic_trivial_io_bw	0</span>
<span class="cp">#define generic_trivial_io_lq	0</span>
<span class="cp">#define generic_trivial_iounmap	0</span>

<span class="cp">#else</span>

<span class="cp">#if defined(CONFIG_ALPHA_APECS)</span>
<span class="cp"># include &lt;asm/core_apecs.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_CIA)</span>
<span class="cp"># include &lt;asm/core_cia.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_IRONGATE)</span>
<span class="cp"># include &lt;asm/core_irongate.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_JENSEN)</span>
<span class="cp"># include &lt;asm/jensen.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_LCA)</span>
<span class="cp"># include &lt;asm/core_lca.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_MARVEL)</span>
<span class="cp"># include &lt;asm/core_marvel.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_MCPCIA)</span>
<span class="cp"># include &lt;asm/core_mcpcia.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_POLARIS)</span>
<span class="cp"># include &lt;asm/core_polaris.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_T2)</span>
<span class="cp"># include &lt;asm/core_t2.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_TSUNAMI)</span>
<span class="cp"># include &lt;asm/core_tsunami.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_TITAN)</span>
<span class="cp"># include &lt;asm/core_titan.h&gt;</span>
<span class="cp">#elif defined(CONFIG_ALPHA_WILDFIRE)</span>
<span class="cp"># include &lt;asm/core_wildfire.h&gt;</span>
<span class="cp">#else</span>
<span class="cp">#error &quot;What system is this?&quot;</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* GENERIC */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * We always have external versions of these routines.</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="n">u8</span>		<span class="n">inb</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u16</span>		<span class="n">inw</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u32</span>		<span class="n">inl</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">outb</span><span class="p">(</span><span class="n">u8</span> <span class="n">b</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">outw</span><span class="p">(</span><span class="n">u16</span> <span class="n">b</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">outl</span><span class="p">(</span><span class="n">u32</span> <span class="n">b</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">u8</span>		<span class="n">readb</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u16</span>		<span class="n">readw</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u32</span>		<span class="n">readl</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u64</span>		<span class="n">readq</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">writeb</span><span class="p">(</span><span class="n">u8</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">writew</span><span class="p">(</span><span class="n">u16</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">writel</span><span class="p">(</span><span class="n">u32</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">writeq</span><span class="p">(</span><span class="n">u64</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">u8</span>		<span class="n">__raw_readb</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u16</span>		<span class="n">__raw_readw</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u32</span>		<span class="n">__raw_readl</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u64</span>		<span class="n">__raw_readq</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">__raw_writeb</span><span class="p">(</span><span class="n">u8</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">__raw_writew</span><span class="p">(</span><span class="n">u16</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">__raw_writel</span><span class="p">(</span><span class="n">u32</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>		<span class="n">__raw_writeq</span><span class="p">(</span><span class="n">u64</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Mapping from port numbers to __iomem space is pretty easy.</span>
<span class="cm"> */</span>

<span class="cm">/* These two have to be extern inline because of the extern prototype from</span>
<span class="cm">   &lt;asm-generic/iomap.h&gt;.  It is not legal to mix &quot;extern&quot; and &quot;static&quot; for</span>
<span class="cm">   the same declaration.  */</span>
<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">ioport_map</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">ioportmap</span><span class="p">)</span> <span class="p">(</span><span class="n">port</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ioport_unmap</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">ioremap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">ioremap</span><span class="p">)</span> <span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">__ioremap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">,</span>
				      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ioremap</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span> <span class="nf">ioremap_nocache</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset</span><span class="p">,</span>
					     <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ioremap</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
<span class="p">}</span> 

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">iounmap</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">iounmap</span><span class="p">)(</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">__is_ioaddr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">is_ioaddr</span><span class="p">)(</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#define __is_ioaddr(a)		__is_ioaddr((unsigned long)(a))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">__is_mmio</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">is_mmio</span><span class="p">)(</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/*</span>
<span class="cm"> * If the actual I/O bits are sufficiently trivial, then expand inline.</span>
<span class="cm"> */</span>

<span class="cp">#if IO_CONCAT(__IO_PREFIX,trivial_io_bw)</span>
<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ioread8</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">ioread8</span><span class="p">)(</span><span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ioread16</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">ioread16</span><span class="p">)(</span><span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">iowrite8</span><span class="p">(</span><span class="n">u8</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">iowrite8</span><span class="p">)(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">iowrite16</span><span class="p">(</span><span class="n">u16</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">iowrite16</span><span class="p">)(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">inb</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ioread8</span><span class="p">(</span><span class="n">ioport_map</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">inw</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ioread16</span><span class="p">(</span><span class="n">ioport_map</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">outb</span><span class="p">(</span><span class="n">u8</span> <span class="n">b</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iowrite8</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ioport_map</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">outw</span><span class="p">(</span><span class="n">u16</span> <span class="n">b</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iowrite16</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ioport_map</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#if IO_CONCAT(__IO_PREFIX,trivial_io_lq)</span>
<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">ioread32</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">ioread32</span><span class="p">)(</span><span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">iowrite32</span><span class="p">(</span><span class="n">u32</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">iowrite32</span><span class="p">)(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">inl</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ioread32</span><span class="p">(</span><span class="n">ioport_map</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">outl</span><span class="p">(</span><span class="n">u32</span> <span class="n">b</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">iowrite32</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ioport_map</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="mi">4</span><span class="p">));</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#if IO_CONCAT(__IO_PREFIX,trivial_rw_bw) == 1</span>
<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">__raw_readb</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">readb</span><span class="p">)(</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">__raw_readw</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">readw</span><span class="p">)(</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__raw_writeb</span><span class="p">(</span><span class="n">u8</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">writeb</span><span class="p">)(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__raw_writew</span><span class="p">(</span><span class="n">u16</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">writew</span><span class="p">)(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">readb</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">__raw_readb</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u16</span> <span class="nf">readw</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">__raw_readw</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">writeb</span><span class="p">(</span><span class="n">u8</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writeb</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">writew</span><span class="p">(</span><span class="n">u16</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writew</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#if IO_CONCAT(__IO_PREFIX,trivial_rw_lq) == 1</span>
<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">__raw_readl</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">readl</span><span class="p">)(</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u64</span> <span class="nf">__raw_readq</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">readq</span><span class="p">)(</span><span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__raw_writel</span><span class="p">(</span><span class="n">u32</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">writel</span><span class="p">)(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">__raw_writeq</span><span class="p">(</span><span class="n">u64</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">IO_CONCAT</span><span class="p">(</span><span class="n">__IO_PREFIX</span><span class="p">,</span><span class="n">writeq</span><span class="p">)(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u32</span> <span class="nf">readl</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">__raw_readl</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="n">u64</span> <span class="nf">readq</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u64</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">__raw_readq</span><span class="p">(</span><span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">writel</span><span class="p">(</span><span class="n">u32</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writel</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">extern</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">writeq</span><span class="p">(</span><span class="n">u64</span> <span class="n">b</span><span class="p">,</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__raw_writeq</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>
	<span class="n">mb</span><span class="p">();</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="cp">#define ioread16be(p) be16_to_cpu(ioread16(p))</span>
<span class="cp">#define ioread32be(p) be32_to_cpu(ioread32(p))</span>
<span class="cp">#define iowrite16be(v,p) iowrite16(cpu_to_be16(v), (p))</span>
<span class="cp">#define iowrite32be(v,p) iowrite32(cpu_to_be32(v), (p))</span>

<span class="cp">#define inb_p		inb</span>
<span class="cp">#define inw_p		inw</span>
<span class="cp">#define inl_p		inl</span>
<span class="cp">#define outb_p		outb</span>
<span class="cp">#define outw_p		outw</span>
<span class="cp">#define outl_p		outl</span>
<span class="cp">#define readb_relaxed(addr) __raw_readb(addr)</span>
<span class="cp">#define readw_relaxed(addr) __raw_readw(addr)</span>
<span class="cp">#define readl_relaxed(addr) __raw_readl(addr)</span>
<span class="cp">#define readq_relaxed(addr) __raw_readq(addr)</span>

<span class="cp">#define mmiowb()</span>

<span class="cm">/*</span>
<span class="cm"> * String version of IO memory access ops:</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">memcpy_fromio</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">,</span> <span class="kt">long</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">memcpy_toio</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">long</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">_memset_c_io</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span><span class="p">,</span> <span class="kt">long</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">memset_io</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u8</span> <span class="n">c</span><span class="p">,</span> <span class="kt">long</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">_memset_c_io</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mh">0x0101010101010101UL</span> <span class="o">*</span> <span class="n">c</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define __HAVE_ARCH_MEMSETW_IO</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">memsetw_io</span><span class="p">(</span><span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">c</span><span class="p">,</span> <span class="kt">long</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">_memset_c_io</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="mh">0x0001000100010001UL</span> <span class="o">*</span> <span class="n">c</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * String versions of in/out ops:</span>
<span class="cm"> */</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">insb</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">insw</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">insl</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">dst</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">outsb</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">outsw</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">outsl</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">,</span> <span class="k">const</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">count</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * The Alpha Jensen hardware for some rather strange reason puts</span>
<span class="cm"> * the RTC clock at 0x170 instead of 0x70. Probably due to some</span>
<span class="cm"> * misguided idea about using 0x70 for NMI stuff.</span>
<span class="cm"> *</span>
<span class="cm"> * These defines will override the defaults when doing RTC queries</span>
<span class="cm"> */</span>

<span class="cp">#ifdef CONFIG_ALPHA_GENERIC</span>
<span class="cp"># define RTC_PORT(x)	((x) + alpha_mv.rtc_port)</span>
<span class="cp">#else</span>
<span class="cp"># ifdef CONFIG_ALPHA_JENSEN</span>
<span class="cp">#  define RTC_PORT(x)	(0x170+(x))</span>
<span class="cp"># else</span>
<span class="cp">#  define RTC_PORT(x)	(0x70 + (x))</span>
<span class="cp"># endif</span>
<span class="cp">#endif</span>
<span class="cp">#define RTC_ALWAYS_BCD	0</span>

<span class="cm">/*</span>
<span class="cm"> * Some mucking forons use if[n]def writeq to check if platform has it.</span>
<span class="cm"> * It&#39;s a bloody bad idea and we probably want ARCH_HAS_WRITEQ for them</span>
<span class="cm"> * to play with; for now just use cpp anti-recursion logics and make sure</span>
<span class="cm"> * that damn thing is defined and expands to itself.</span>
<span class="cm"> */</span>

<span class="cp">#define writeq writeq</span>
<span class="cp">#define readq readq</span>

<span class="cm">/*</span>
<span class="cm"> * Convert a physical pointer to a virtual kernel pointer for /dev/mem</span>
<span class="cm"> * access</span>
<span class="cm"> */</span>
<span class="cp">#define xlate_dev_mem_ptr(p)	__va(p)</span>

<span class="cm">/*</span>
<span class="cm"> * Convert a virtual cached pointer to an uncached pointer</span>
<span class="cm"> */</span>
<span class="cp">#define xlate_dev_kmem_ptr(p)	p</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ALPHA_IO_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
