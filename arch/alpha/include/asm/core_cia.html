<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › alpha › include › asm › core_cia.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>core_cia.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __ALPHA_CIA__H__</span>
<span class="cp">#define __ALPHA_CIA__H__</span>

<span class="cm">/* Define to experiment with fitting everything into one 512MB HAE window.  */</span>
<span class="cp">#define CIA_ONE_HAE_WINDOW 1</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;asm/compiler.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * CIA is the internal name for the 21171 chipset which provides</span>
<span class="cm"> * memory controller and PCI access for the 21164 chip based systems.</span>
<span class="cm"> * Also supported here is the 21172 (CIA-2) and 21174 (PYXIS).</span>
<span class="cm"> *</span>
<span class="cm"> * The lineage is a bit confused, since the 21174 was reportedly started</span>
<span class="cm"> * from the 21171 Pass 1 mask, and so is missing bug fixes that appear</span>
<span class="cm"> * in 21171 Pass 2 and 21172, but it also contains additional features.</span>
<span class="cm"> *</span>
<span class="cm"> * This file is based on:</span>
<span class="cm"> *</span>
<span class="cm"> * DECchip 21171 Core Logic Chipset</span>
<span class="cm"> * Technical Reference Manual</span>
<span class="cm"> *</span>
<span class="cm"> * EC-QE18B-TE</span>
<span class="cm"> *</span>
<span class="cm"> * david.rusling@reo.mts.dec.com Initial Version.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * CIA ADDRESS BIT DEFINITIONS</span>
<span class="cm"> *</span>
<span class="cm"> *  3333 3333 3322 2222 2222 1111 1111 11</span>
<span class="cm"> *  9876 5432 1098 7654 3210 9876 5432 1098 7654 3210</span>
<span class="cm"> *  ---- ---- ---- ---- ---- ---- ---- ---- ---- ----</span>
<span class="cm"> *  1                                             000</span>
<span class="cm"> *  ---- ---- ---- ---- ---- ---- ---- ---- ---- ----</span>
<span class="cm"> *  |                                             |\|</span>
<span class="cm"> *  |                               Byte Enable --+ |</span>
<span class="cm"> *  |                             Transfer Length --+</span>
<span class="cm"> *  +-- IO space, not cached</span>
<span class="cm"> *</span>
<span class="cm"> *   Byte      Transfer</span>
<span class="cm"> *   Enable    Length    Transfer  Byte    Address</span>
<span class="cm"> *   adr&lt;6:5&gt;  adr&lt;4:3&gt;  Length    Enable  Adder</span>
<span class="cm"> *   ---------------------------------------------</span>
<span class="cm"> *      00        00      Byte      1110   0x000</span>
<span class="cm"> *      01        00      Byte      1101   0x020</span>
<span class="cm"> *      10        00      Byte      1011   0x040</span>
<span class="cm"> *      11        00      Byte      0111   0x060</span>
<span class="cm"> *</span>
<span class="cm"> *      00        01      Word      1100   0x008</span>
<span class="cm"> *      01        01      Word      1001   0x028 &lt;= Not supported in this code.</span>
<span class="cm"> *      10        01      Word      0011   0x048</span>
<span class="cm"> *</span>
<span class="cm"> *      00        10      Tribyte   1000   0x010</span>
<span class="cm"> *      01        10      Tribyte   0001   0x030</span>
<span class="cm"> *</span>
<span class="cm"> *      10        11      Longword  0000   0x058</span>
<span class="cm"> *</span>
<span class="cm"> *      Note that byte enables are asserted low.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#define CIA_MEM_R1_MASK 0x1fffffff  </span><span class="cm">/* SPARSE Mem region 1 mask is 29 bits */</span><span class="cp"></span>
<span class="cp">#define CIA_MEM_R2_MASK 0x07ffffff  </span><span class="cm">/* SPARSE Mem region 2 mask is 27 bits */</span><span class="cp"></span>
<span class="cp">#define CIA_MEM_R3_MASK 0x03ffffff  </span><span class="cm">/* SPARSE Mem region 3 mask is 26 bits */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * 21171-CA Control and Status Registers</span>
<span class="cm"> */</span>
<span class="cp">#define CIA_IOC_CIA_REV			(IDENT_ADDR + 0x8740000080UL)</span>
<span class="cp">#  define CIA_REV_MASK			0xff</span>
<span class="cp">#define CIA_IOC_PCI_LAT			(IDENT_ADDR + 0x87400000C0UL)</span>
<span class="cp">#define CIA_IOC_CIA_CTRL		(IDENT_ADDR + 0x8740000100UL)</span>
<span class="cp">#  define CIA_CTRL_PCI_EN		(1 &lt;&lt; 0)</span>
<span class="cp">#  define CIA_CTRL_PCI_LOCK_EN		(1 &lt;&lt; 1)</span>
<span class="cp">#  define CIA_CTRL_PCI_LOOP_EN		(1 &lt;&lt; 2)</span>
<span class="cp">#  define CIA_CTRL_FST_BB_EN		(1 &lt;&lt; 3)</span>
<span class="cp">#  define CIA_CTRL_PCI_MST_EN		(1 &lt;&lt; 4)</span>
<span class="cp">#  define CIA_CTRL_PCI_MEM_EN		(1 &lt;&lt; 5)</span>
<span class="cp">#  define CIA_CTRL_PCI_REQ64_EN		(1 &lt;&lt; 6)</span>
<span class="cp">#  define CIA_CTRL_PCI_ACK64_EN		(1 &lt;&lt; 7)</span>
<span class="cp">#  define CIA_CTRL_ADDR_PE_EN		(1 &lt;&lt; 8)</span>
<span class="cp">#  define CIA_CTRL_PERR_EN		(1 &lt;&lt; 9)</span>
<span class="cp">#  define CIA_CTRL_FILL_ERR_EN		(1 &lt;&lt; 10)</span>
<span class="cp">#  define CIA_CTRL_MCHK_ERR_EN		(1 &lt;&lt; 11)</span>
<span class="cp">#  define CIA_CTRL_ECC_CHK_EN		(1 &lt;&lt; 12)</span>
<span class="cp">#  define CIA_CTRL_ASSERT_IDLE_BC	(1 &lt;&lt; 13)</span>
<span class="cp">#  define CIA_CTRL_COM_IDLE_BC		(1 &lt;&lt; 14)</span>
<span class="cp">#  define CIA_CTRL_CSR_IOA_BYPASS	(1 &lt;&lt; 15)</span>
<span class="cp">#  define CIA_CTRL_IO_FLUSHREQ_EN	(1 &lt;&lt; 16)</span>
<span class="cp">#  define CIA_CTRL_CPU_FLUSHREQ_EN	(1 &lt;&lt; 17)</span>
<span class="cp">#  define CIA_CTRL_ARB_CPU_EN		(1 &lt;&lt; 18)</span>
<span class="cp">#  define CIA_CTRL_EN_ARB_LINK		(1 &lt;&lt; 19)</span>
<span class="cp">#  define CIA_CTRL_RD_TYPE_SHIFT	20</span>
<span class="cp">#  define CIA_CTRL_RL_TYPE_SHIFT	24</span>
<span class="cp">#  define CIA_CTRL_RM_TYPE_SHIFT	28</span>
<span class="cp">#  define CIA_CTRL_EN_DMA_RD_PERF	(1 &lt;&lt; 31)</span>
<span class="cp">#define CIA_IOC_CIA_CNFG		(IDENT_ADDR + 0x8740000140UL)</span>
<span class="cp">#  define CIA_CNFG_IOA_BWEN		(1 &lt;&lt; 0)</span>
<span class="cp">#  define CIA_CNFG_PCI_MWEN		(1 &lt;&lt; 4)</span>
<span class="cp">#  define CIA_CNFG_PCI_DWEN		(1 &lt;&lt; 5)</span>
<span class="cp">#  define CIA_CNFG_PCI_WLEN		(1 &lt;&lt; 8)</span>
<span class="cp">#define CIA_IOC_FLASH_CTRL		(IDENT_ADDR + 0x8740000200UL)</span>
<span class="cp">#define CIA_IOC_HAE_MEM			(IDENT_ADDR + 0x8740000400UL)</span>
<span class="cp">#define CIA_IOC_HAE_IO			(IDENT_ADDR + 0x8740000440UL)</span>
<span class="cp">#define CIA_IOC_CFG			(IDENT_ADDR + 0x8740000480UL)</span>
<span class="cp">#define CIA_IOC_CACK_EN			(IDENT_ADDR + 0x8740000600UL)</span>
<span class="cp">#  define CIA_CACK_EN_LOCK_EN		(1 &lt;&lt; 0)</span>
<span class="cp">#  define CIA_CACK_EN_MB_EN		(1 &lt;&lt; 1)</span>
<span class="cp">#  define CIA_CACK_EN_SET_DIRTY_EN	(1 &lt;&lt; 2)</span>
<span class="cp">#  define CIA_CACK_EN_BC_VICTIM_EN	(1 &lt;&lt; 3)</span>


<span class="cm">/*</span>
<span class="cm"> * 21171-CA Diagnostic Registers</span>
<span class="cm"> */</span>
<span class="cp">#define CIA_IOC_CIA_DIAG		(IDENT_ADDR + 0x8740002000UL)</span>
<span class="cp">#define CIA_IOC_DIAG_CHECK		(IDENT_ADDR + 0x8740003000UL)</span>

<span class="cm">/*</span>
<span class="cm"> * 21171-CA Performance Monitor registers</span>
<span class="cm"> */</span>
<span class="cp">#define CIA_IOC_PERF_MONITOR		(IDENT_ADDR + 0x8740004000UL)</span>
<span class="cp">#define CIA_IOC_PERF_CONTROL		(IDENT_ADDR + 0x8740004040UL)</span>

<span class="cm">/*</span>
<span class="cm"> * 21171-CA Error registers</span>
<span class="cm"> */</span>
<span class="cp">#define CIA_IOC_CPU_ERR0		(IDENT_ADDR + 0x8740008000UL)</span>
<span class="cp">#define CIA_IOC_CPU_ERR1		(IDENT_ADDR + 0x8740008040UL)</span>
<span class="cp">#define CIA_IOC_CIA_ERR			(IDENT_ADDR + 0x8740008200UL)</span>
<span class="cp">#  define CIA_ERR_COR_ERR		(1 &lt;&lt; 0)</span>
<span class="cp">#  define CIA_ERR_UN_COR_ERR		(1 &lt;&lt; 1)</span>
<span class="cp">#  define CIA_ERR_CPU_PE		(1 &lt;&lt; 2)</span>
<span class="cp">#  define CIA_ERR_MEM_NEM		(1 &lt;&lt; 3)</span>
<span class="cp">#  define CIA_ERR_PCI_SERR		(1 &lt;&lt; 4)</span>
<span class="cp">#  define CIA_ERR_PERR			(1 &lt;&lt; 5)</span>
<span class="cp">#  define CIA_ERR_PCI_ADDR_PE		(1 &lt;&lt; 6)</span>
<span class="cp">#  define CIA_ERR_RCVD_MAS_ABT		(1 &lt;&lt; 7)</span>
<span class="cp">#  define CIA_ERR_RCVD_TAR_ABT		(1 &lt;&lt; 8)</span>
<span class="cp">#  define CIA_ERR_PA_PTE_INV		(1 &lt;&lt; 9)</span>
<span class="cp">#  define CIA_ERR_FROM_WRT_ERR		(1 &lt;&lt; 10)</span>
<span class="cp">#  define CIA_ERR_IOA_TIMEOUT		(1 &lt;&lt; 11)</span>
<span class="cp">#  define CIA_ERR_LOST_CORR_ERR		(1 &lt;&lt; 16)</span>
<span class="cp">#  define CIA_ERR_LOST_UN_CORR_ERR	(1 &lt;&lt; 17)</span>
<span class="cp">#  define CIA_ERR_LOST_CPU_PE		(1 &lt;&lt; 18)</span>
<span class="cp">#  define CIA_ERR_LOST_MEM_NEM		(1 &lt;&lt; 19)</span>
<span class="cp">#  define CIA_ERR_LOST_PERR		(1 &lt;&lt; 21)</span>
<span class="cp">#  define CIA_ERR_LOST_PCI_ADDR_PE	(1 &lt;&lt; 22)</span>
<span class="cp">#  define CIA_ERR_LOST_RCVD_MAS_ABT	(1 &lt;&lt; 23)</span>
<span class="cp">#  define CIA_ERR_LOST_RCVD_TAR_ABT	(1 &lt;&lt; 24)</span>
<span class="cp">#  define CIA_ERR_LOST_PA_PTE_INV	(1 &lt;&lt; 25)</span>
<span class="cp">#  define CIA_ERR_LOST_FROM_WRT_ERR	(1 &lt;&lt; 26)</span>
<span class="cp">#  define CIA_ERR_LOST_IOA_TIMEOUT	(1 &lt;&lt; 27)</span>
<span class="cp">#  define CIA_ERR_VALID			(1 &lt;&lt; 31)</span>
<span class="cp">#define CIA_IOC_CIA_STAT		(IDENT_ADDR + 0x8740008240UL)</span>
<span class="cp">#define CIA_IOC_ERR_MASK		(IDENT_ADDR + 0x8740008280UL)</span>
<span class="cp">#define CIA_IOC_CIA_SYN			(IDENT_ADDR + 0x8740008300UL)</span>
<span class="cp">#define CIA_IOC_MEM_ERR0		(IDENT_ADDR + 0x8740008400UL)</span>
<span class="cp">#define CIA_IOC_MEM_ERR1		(IDENT_ADDR + 0x8740008440UL)</span>
<span class="cp">#define CIA_IOC_PCI_ERR0		(IDENT_ADDR + 0x8740008800UL)</span>
<span class="cp">#define CIA_IOC_PCI_ERR1		(IDENT_ADDR + 0x8740008840UL)</span>
<span class="cp">#define CIA_IOC_PCI_ERR3		(IDENT_ADDR + 0x8740008880UL)</span>

<span class="cm">/*</span>
<span class="cm"> * 21171-CA System configuration registers</span>
<span class="cm"> */</span>
<span class="cp">#define CIA_IOC_MCR			(IDENT_ADDR + 0x8750000000UL)</span>
<span class="cp">#define CIA_IOC_MBA0			(IDENT_ADDR + 0x8750000600UL)</span>
<span class="cp">#define CIA_IOC_MBA2			(IDENT_ADDR + 0x8750000680UL)</span>
<span class="cp">#define CIA_IOC_MBA4			(IDENT_ADDR + 0x8750000700UL)</span>
<span class="cp">#define CIA_IOC_MBA6			(IDENT_ADDR + 0x8750000780UL)</span>
<span class="cp">#define CIA_IOC_MBA8			(IDENT_ADDR + 0x8750000800UL)</span>
<span class="cp">#define CIA_IOC_MBAA			(IDENT_ADDR + 0x8750000880UL)</span>
<span class="cp">#define CIA_IOC_MBAC			(IDENT_ADDR + 0x8750000900UL)</span>
<span class="cp">#define CIA_IOC_MBAE			(IDENT_ADDR + 0x8750000980UL)</span>
<span class="cp">#define CIA_IOC_TMG0			(IDENT_ADDR + 0x8750000B00UL)</span>
<span class="cp">#define CIA_IOC_TMG1			(IDENT_ADDR + 0x8750000B40UL)</span>
<span class="cp">#define CIA_IOC_TMG2			(IDENT_ADDR + 0x8750000B80UL)</span>

<span class="cm">/*</span>
<span class="cm"> * 2117A-CA PCI Address and Scatter-Gather Registers.</span>
<span class="cm"> */</span>
<span class="cp">#define CIA_IOC_PCI_TBIA		(IDENT_ADDR + 0x8760000100UL)</span>

<span class="cp">#define CIA_IOC_PCI_W0_BASE		(IDENT_ADDR + 0x8760000400UL)</span>
<span class="cp">#define CIA_IOC_PCI_W0_MASK		(IDENT_ADDR + 0x8760000440UL)</span>
<span class="cp">#define CIA_IOC_PCI_T0_BASE		(IDENT_ADDR + 0x8760000480UL)</span>

<span class="cp">#define CIA_IOC_PCI_W1_BASE		(IDENT_ADDR + 0x8760000500UL)</span>
<span class="cp">#define CIA_IOC_PCI_W1_MASK		(IDENT_ADDR + 0x8760000540UL)</span>
<span class="cp">#define CIA_IOC_PCI_T1_BASE		(IDENT_ADDR + 0x8760000580UL)</span>

<span class="cp">#define CIA_IOC_PCI_W2_BASE		(IDENT_ADDR + 0x8760000600UL)</span>
<span class="cp">#define CIA_IOC_PCI_W2_MASK		(IDENT_ADDR + 0x8760000640UL)</span>
<span class="cp">#define CIA_IOC_PCI_T2_BASE		(IDENT_ADDR + 0x8760000680UL)</span>

<span class="cp">#define CIA_IOC_PCI_W3_BASE		(IDENT_ADDR + 0x8760000700UL)</span>
<span class="cp">#define CIA_IOC_PCI_W3_MASK		(IDENT_ADDR + 0x8760000740UL)</span>
<span class="cp">#define CIA_IOC_PCI_T3_BASE		(IDENT_ADDR + 0x8760000780UL)</span>

<span class="cp">#define CIA_IOC_PCI_Wn_BASE(N)	(IDENT_ADDR + 0x8760000400UL + (N)*0x100) </span>
<span class="cp">#define CIA_IOC_PCI_Wn_MASK(N)	(IDENT_ADDR + 0x8760000440UL + (N)*0x100) </span>
<span class="cp">#define CIA_IOC_PCI_Tn_BASE(N)	(IDENT_ADDR + 0x8760000480UL + (N)*0x100) </span>

<span class="cp">#define CIA_IOC_PCI_W_DAC		(IDENT_ADDR + 0x87600007C0UL)</span>

<span class="cm">/*</span>
<span class="cm"> * 2117A-CA Address Translation Registers.</span>
<span class="cm"> */</span>

<span class="cm">/* 8 tag registers, the first 4 of which are lockable.  */</span>
<span class="cp">#define CIA_IOC_TB_TAGn(n) \</span>
<span class="cp">	(IDENT_ADDR + 0x8760000800UL + (n)*0x40)</span>

<span class="cm">/* 4 page registers per tag register.  */</span>
<span class="cp">#define CIA_IOC_TBn_PAGEm(n,m) \</span>
<span class="cp">	(IDENT_ADDR + 0x8760001000UL + (n)*0x100 + (m)*0x40)</span>

<span class="cm">/*</span>
<span class="cm"> * Memory spaces:</span>
<span class="cm"> */</span>
<span class="cp">#define CIA_IACK_SC			(IDENT_ADDR + 0x8720000000UL)</span>
<span class="cp">#define CIA_CONF			(IDENT_ADDR + 0x8700000000UL)</span>
<span class="cp">#define CIA_IO				(IDENT_ADDR + 0x8580000000UL)</span>
<span class="cp">#define CIA_SPARSE_MEM			(IDENT_ADDR + 0x8000000000UL)</span>
<span class="cp">#define CIA_SPARSE_MEM_R2		(IDENT_ADDR + 0x8400000000UL)</span>
<span class="cp">#define CIA_SPARSE_MEM_R3		(IDENT_ADDR + 0x8500000000UL)</span>
<span class="cp">#define CIA_DENSE_MEM		        (IDENT_ADDR + 0x8600000000UL)</span>
<span class="cp">#define CIA_BW_MEM			(IDENT_ADDR + 0x8800000000UL)</span>
<span class="cp">#define CIA_BW_IO			(IDENT_ADDR + 0x8900000000UL)</span>
<span class="cp">#define CIA_BW_CFG_0			(IDENT_ADDR + 0x8a00000000UL)</span>
<span class="cp">#define CIA_BW_CFG_1			(IDENT_ADDR + 0x8b00000000UL)</span>

<span class="cm">/*</span>
<span class="cm"> * ALCOR&#39;s GRU ASIC registers</span>
<span class="cm"> */</span>
<span class="cp">#define GRU_INT_REQ			(IDENT_ADDR + 0x8780000000UL)</span>
<span class="cp">#define GRU_INT_MASK			(IDENT_ADDR + 0x8780000040UL)</span>
<span class="cp">#define GRU_INT_EDGE			(IDENT_ADDR + 0x8780000080UL)</span>
<span class="cp">#define GRU_INT_HILO			(IDENT_ADDR + 0x87800000C0UL)</span>
<span class="cp">#define GRU_INT_CLEAR			(IDENT_ADDR + 0x8780000100UL)</span>

<span class="cp">#define GRU_CACHE_CNFG			(IDENT_ADDR + 0x8780000200UL)</span>
<span class="cp">#define GRU_SCR				(IDENT_ADDR + 0x8780000300UL)</span>
<span class="cp">#define GRU_LED				(IDENT_ADDR + 0x8780000800UL)</span>
<span class="cp">#define GRU_RESET			(IDENT_ADDR + 0x8780000900UL)</span>

<span class="cp">#define ALCOR_GRU_INT_REQ_BITS		0x800fffffUL</span>
<span class="cp">#define XLT_GRU_INT_REQ_BITS		0x80003fffUL</span>
<span class="cp">#define GRU_INT_REQ_BITS		(alpha_mv.sys.cia.gru_int_req_bits+0)</span>

<span class="cm">/*</span>
<span class="cm"> * PYXIS interrupt control registers</span>
<span class="cm"> */</span>
<span class="cp">#define PYXIS_INT_REQ			(IDENT_ADDR + 0x87A0000000UL)</span>
<span class="cp">#define PYXIS_INT_MASK			(IDENT_ADDR + 0x87A0000040UL)</span>
<span class="cp">#define PYXIS_INT_HILO			(IDENT_ADDR + 0x87A00000C0UL)</span>
<span class="cp">#define PYXIS_INT_ROUTE			(IDENT_ADDR + 0x87A0000140UL)</span>
<span class="cp">#define PYXIS_GPO			(IDENT_ADDR + 0x87A0000180UL)</span>
<span class="cp">#define PYXIS_INT_CNFG			(IDENT_ADDR + 0x87A00001C0UL)</span>
<span class="cp">#define PYXIS_RT_COUNT			(IDENT_ADDR + 0x87A0000200UL)</span>
<span class="cp">#define PYXIS_INT_TIME			(IDENT_ADDR + 0x87A0000240UL)</span>
<span class="cp">#define PYXIS_IIC_CTRL			(IDENT_ADDR + 0x87A00002C0UL)</span>
<span class="cp">#define PYXIS_RESET			(IDENT_ADDR + 0x8780000900UL)</span>

<span class="cm">/* Offset between ram physical addresses and pci64 DAC bus addresses.  */</span>
<span class="cp">#define PYXIS_DAC_OFFSET		(1UL &lt;&lt; 40)</span>

<span class="cm">/*</span>
<span class="cm"> * Data structure for handling CIA machine checks.</span>
<span class="cm"> */</span>

<span class="cm">/* System-specific info.  */</span>
<span class="k">struct</span> <span class="n">el_CIA_sysdata_mcheck</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">cpu_err0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">cpu_err1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">cia_err</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">cia_stat</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">err_mask</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">cia_syn</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">mem_err0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">mem_err1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">pci_err0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">pci_err1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">pci_err2</span><span class="p">;</span>
<span class="p">};</span>


<span class="cp">#ifdef __KERNEL__</span>

<span class="cp">#ifndef __EXTERN_INLINE</span>
<span class="cm">/* Do not touch, this should *NOT* be static inline */</span>
<span class="cp">#define __EXTERN_INLINE extern inline</span>
<span class="cp">#define __IO_EXTERN_INLINE</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * I/O functions:</span>
<span class="cm"> *</span>
<span class="cm"> * CIA (the 2117x PCI/memory support chipset for the EV5 (21164)</span>
<span class="cm"> * series of processors uses a sparse address mapping scheme to</span>
<span class="cm"> * get at PCI memory and I/O.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Memory functions.  64-bit and 32-bit accesses are done through</span>
<span class="cm"> * dense memory space, everything else through sparse space.</span>
<span class="cm"> *</span>
<span class="cm"> * For reading and writing 8 and 16 bit quantities we need to</span>
<span class="cm"> * go through one of the three sparse address mapping regions</span>
<span class="cm"> * and use the HAE_MEM CSR to provide some bits of the address.</span>
<span class="cm"> * The following few routines use only sparse address region 1</span>
<span class="cm"> * which gives 1Gbyte of accessible space which relates exactly</span>
<span class="cm"> * to the amount of PCI memory mapping *into* system address space.</span>
<span class="cm"> * See p 6-17 of the specification but it looks something like this:</span>
<span class="cm"> *</span>
<span class="cm"> * 21164 Address:</span>
<span class="cm"> *</span>
<span class="cm"> *          3         2         1</span>
<span class="cm"> * 9876543210987654321098765432109876543210</span>
<span class="cm"> * 1ZZZZ0.PCI.QW.Address............BBLL</span>
<span class="cm"> *</span>
<span class="cm"> * ZZ = SBZ</span>
<span class="cm"> * BB = Byte offset</span>
<span class="cm"> * LL = Transfer length</span>
<span class="cm"> *</span>
<span class="cm"> * PCI Address:</span>
<span class="cm"> *</span>
<span class="cm"> * 3         2         1</span>
<span class="cm"> * 10987654321098765432109876543210</span>
<span class="cm"> * HHH....PCI.QW.Address........ 00</span>
<span class="cm"> *</span>
<span class="cm"> * HHH = 31:29 HAE_MEM CSR</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#define vip	volatile int __force *</span>
<span class="cp">#define vuip	volatile unsigned int __force *</span>
<span class="cp">#define vulp	volatile unsigned long __force *</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">cia_ioread8</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">result</span><span class="p">,</span> <span class="n">base_and_type</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">CIA_DENSE_MEM</span><span class="p">)</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">CIA_SPARSE_MEM</span> <span class="o">+</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">CIA_IO</span> <span class="o">+</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="cm">/* We can use CIA_MEM_R1_MASK for io ports too, since it is large</span>
<span class="cm">	   enough to cover all io ports, and smaller than CIA_IO.  */</span>
	<span class="n">addr</span> <span class="o">&amp;=</span> <span class="n">CIA_MEM_R1_MASK</span><span class="p">;</span>
	<span class="n">result</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">vip</span><span class="p">)</span> <span class="p">((</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">base_and_type</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">__kernel_extbl</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">addr</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="nf">cia_iowrite8</span><span class="p">(</span><span class="n">u8</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">w</span><span class="p">,</span> <span class="n">base_and_type</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">CIA_DENSE_MEM</span><span class="p">)</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">CIA_SPARSE_MEM</span> <span class="o">+</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">CIA_IO</span> <span class="o">+</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">addr</span> <span class="o">&amp;=</span> <span class="n">CIA_MEM_R1_MASK</span><span class="p">;</span>
	<span class="n">w</span> <span class="o">=</span> <span class="n">__kernel_insbl</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="o">*</span><span class="p">(</span><span class="n">vuip</span><span class="p">)</span> <span class="p">((</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">base_and_type</span><span class="p">)</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">cia_ioread16</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">result</span><span class="p">,</span> <span class="n">base_and_type</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">CIA_DENSE_MEM</span><span class="p">)</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">CIA_SPARSE_MEM</span> <span class="o">+</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">CIA_IO</span> <span class="o">+</span> <span class="mh">0x08</span><span class="p">;</span>

	<span class="n">addr</span> <span class="o">&amp;=</span> <span class="n">CIA_MEM_R1_MASK</span><span class="p">;</span>
	<span class="n">result</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="n">vip</span><span class="p">)</span> <span class="p">((</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">base_and_type</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">__kernel_extwl</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">addr</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="nf">cia_iowrite16</span><span class="p">(</span><span class="n">u16</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">w</span><span class="p">,</span> <span class="n">base_and_type</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">CIA_DENSE_MEM</span><span class="p">)</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">CIA_SPARSE_MEM</span> <span class="o">+</span> <span class="mh">0x08</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">base_and_type</span> <span class="o">=</span> <span class="n">CIA_IO</span> <span class="o">+</span> <span class="mh">0x08</span><span class="p">;</span>

	<span class="n">addr</span> <span class="o">&amp;=</span> <span class="n">CIA_MEM_R1_MASK</span><span class="p">;</span>
	<span class="n">w</span> <span class="o">=</span> <span class="n">__kernel_inswl</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">addr</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="o">*</span><span class="p">(</span><span class="n">vuip</span><span class="p">)</span> <span class="p">((</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">base_and_type</span><span class="p">)</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">cia_ioread32</span><span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&lt;</span> <span class="n">CIA_DENSE_MEM</span><span class="p">)</span>
		<span class="n">addr</span> <span class="o">=</span> <span class="p">((</span><span class="n">addr</span> <span class="o">-</span> <span class="n">CIA_IO</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">CIA_IO</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">vuip</span><span class="p">)</span><span class="n">addr</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="nf">cia_iowrite32</span><span class="p">(</span><span class="n">u32</span> <span class="n">b</span><span class="p">,</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">xaddr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span> <span class="n">xaddr</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&lt;</span> <span class="n">CIA_DENSE_MEM</span><span class="p">)</span>
		<span class="n">addr</span> <span class="o">=</span> <span class="p">((</span><span class="n">addr</span> <span class="o">-</span> <span class="n">CIA_IO</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="n">CIA_IO</span> <span class="o">+</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="o">*</span><span class="p">(</span><span class="n">vuip</span><span class="p">)</span><span class="n">addr</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">cia_ioportmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)(</span><span class="n">addr</span> <span class="o">+</span> <span class="n">CIA_IO</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">cia_ioremap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span>
					  <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)(</span><span class="n">addr</span> <span class="o">+</span> <span class="n">CIA_DENSE_MEM</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">int</span> <span class="nf">cia_is_ioaddr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">IDENT_ADDR</span> <span class="o">+</span> <span class="mh">0x8000000000UL</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">int</span> <span class="nf">cia_is_mmio</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">CIA_DENSE_MEM</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">cia_bwx_ioportmap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)(</span><span class="n">addr</span> <span class="o">+</span> <span class="n">CIA_BW_IO</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="nf">cia_bwx_ioremap</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">,</span>
					      <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)(</span><span class="n">addr</span> <span class="o">+</span> <span class="n">CIA_BW_MEM</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">int</span> <span class="nf">cia_bwx_is_ioaddr</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">addr</span> <span class="o">&gt;=</span> <span class="n">IDENT_ADDR</span> <span class="o">+</span> <span class="mh">0x8000000000UL</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">__EXTERN_INLINE</span> <span class="kt">int</span> <span class="nf">cia_bwx_is_mmio</span><span class="p">(</span><span class="k">const</span> <span class="k">volatile</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)</span><span class="n">addr</span> <span class="o">&lt;</span> <span class="n">CIA_BW_IO</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#undef vip</span>
<span class="cp">#undef vuip</span>
<span class="cp">#undef vulp</span>

<span class="cp">#undef __IO_PREFIX</span>
<span class="cp">#define __IO_PREFIX		cia</span>
<span class="cp">#define cia_trivial_rw_bw	2</span>
<span class="cp">#define cia_trivial_rw_lq	1</span>
<span class="cp">#define cia_trivial_io_bw	0</span>
<span class="cp">#define cia_trivial_io_lq	0</span>
<span class="cp">#define cia_trivial_iounmap	1</span>
<span class="cp">#include &lt;asm/io_trivial.h&gt;</span>

<span class="cp">#undef __IO_PREFIX</span>
<span class="cp">#define __IO_PREFIX		cia_bwx</span>
<span class="cp">#define cia_bwx_trivial_rw_bw	1</span>
<span class="cp">#define cia_bwx_trivial_rw_lq	1</span>
<span class="cp">#define cia_bwx_trivial_io_bw	1</span>
<span class="cp">#define cia_bwx_trivial_io_lq	1</span>
<span class="cp">#define cia_bwx_trivial_iounmap	1</span>
<span class="cp">#include &lt;asm/io_trivial.h&gt;</span>

<span class="cp">#undef __IO_PREFIX</span>
<span class="cp">#ifdef CONFIG_ALPHA_PYXIS</span>
<span class="cp">#define __IO_PREFIX		cia_bwx</span>
<span class="cp">#else</span>
<span class="cp">#define __IO_PREFIX		cia</span>
<span class="cp">#endif</span>

<span class="cp">#ifdef __IO_EXTERN_INLINE</span>
<span class="cp">#undef __EXTERN_INLINE</span>
<span class="cp">#undef __IO_EXTERN_INLINE</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* __ALPHA_CIA__H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
