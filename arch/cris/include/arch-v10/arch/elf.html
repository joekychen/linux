<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › cris › include › arch-v10 › arch › elf.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>elf.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef __ASMCRIS_ARCH_ELF_H</span>
<span class="cp">#define __ASMCRIS_ARCH_ELF_H</span>

<span class="cp">#include &lt;arch/system.h&gt;</span>

<span class="cp">#define ELF_MACH EF_CRIS_VARIANT_ANY_V0_V10</span>

<span class="cm">/*</span>
<span class="cm"> * This is used to ensure we don&#39;t load something for the wrong architecture.</span>
<span class="cm"> */</span>
<span class="cp">#define elf_check_arch(x)			\</span>
<span class="cp"> ((x)-&gt;e_machine == EM_CRIS			\</span>
<span class="cp">  &amp;&amp; ((((x)-&gt;e_flags &amp; EF_CRIS_VARIANT_MASK) == EF_CRIS_VARIANT_ANY_V0_V10	\</span>
<span class="cp">      || (((x)-&gt;e_flags &amp; EF_CRIS_VARIANT_MASK) == EF_CRIS_VARIANT_COMMON_V10_V32))))</span>

<span class="cm">/*</span>
<span class="cm"> * ELF register definitions..</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;asm/ptrace.h&gt;</span>

<span class="cm">/* SVR4/i386 ABI (pages 3-31, 3-32) says that when the program</span>
<span class="cm">   starts (a register; assume first param register for CRIS)</span>
<span class="cm">   contains a pointer to a function which might be</span>
<span class="cm">   registered using `atexit&#39;.  This provides a mean for the</span>
<span class="cm">   dynamic linker to call DT_FINI functions for shared libraries</span>
<span class="cm">   that have been loaded before the code runs.</span>

<span class="cm">   A value of 0 tells we have no such handler.  */</span>

<span class="cm">/* Explicitly set registers to 0 to increase determinism.  */</span>
<span class="cp">#define ELF_PLAT_INIT(_r, load_addr)	do { \</span>
<span class="cp">	(_r)-&gt;r13 = 0; (_r)-&gt;r12 = 0; (_r)-&gt;r11 = 0; (_r)-&gt;r10 = 0; \</span>
<span class="cp">	(_r)-&gt;r9 = 0;  (_r)-&gt;r8 = 0;  (_r)-&gt;r7 = 0;  (_r)-&gt;r6 = 0;  \</span>
<span class="cp">	(_r)-&gt;r5 = 0;  (_r)-&gt;r4 = 0;  (_r)-&gt;r3 = 0;  (_r)-&gt;r2 = 0;  \</span>
<span class="cp">	(_r)-&gt;r1 = 0;  (_r)-&gt;r0 = 0;  (_r)-&gt;mof = 0; (_r)-&gt;srp = 0; \</span>
<span class="cp">} while (0)</span>

<span class="cm">/* The additional layer below is because the stack pointer is missing in </span>
<span class="cm">   the pt_regs struct, but needed in a core dump. pr_reg is a elf_gregset_t,</span>
<span class="cm">   and should be filled in according to the layout of the user_regs_struct</span>
<span class="cm">   struct; regs is a pt_regs struct. We dump all registers, though several are</span>
<span class="cm">   obviously unnecessary. That way there&#39;s less need for intelligence at </span>
<span class="cm">   the receiving end (i.e. gdb). */</span>
<span class="cp">#define ELF_CORE_COPY_REGS(pr_reg, regs)                   \</span>
<span class="cp">	pr_reg[0] = regs-&gt;r0;                              \</span>
<span class="cp">	pr_reg[1] = regs-&gt;r1;                              \</span>
<span class="cp">	pr_reg[2] = regs-&gt;r2;                              \</span>
<span class="cp">	pr_reg[3] = regs-&gt;r3;                              \</span>
<span class="cp">	pr_reg[4] = regs-&gt;r4;                              \</span>
<span class="cp">	pr_reg[5] = regs-&gt;r5;                              \</span>
<span class="cp">	pr_reg[6] = regs-&gt;r6;                              \</span>
<span class="cp">	pr_reg[7] = regs-&gt;r7;                              \</span>
<span class="cp">	pr_reg[8] = regs-&gt;r8;                              \</span>
<span class="cp">	pr_reg[9] = regs-&gt;r9;                              \</span>
<span class="cp">	pr_reg[10] = regs-&gt;r10;                            \</span>
<span class="cp">	pr_reg[11] = regs-&gt;r11;                            \</span>
<span class="cp">	pr_reg[12] = regs-&gt;r12;                            \</span>
<span class="cp">	pr_reg[13] = regs-&gt;r13;                            \</span>
<span class="cp">	pr_reg[14] = rdusp();               </span><span class="cm">/* sp */</span><span class="cp">       \</span>
<span class="cp">	pr_reg[15] = regs-&gt;irp;             </span><span class="cm">/* pc */</span><span class="cp">       \</span>
<span class="cp">	pr_reg[16] = 0;                     </span><span class="cm">/* p0 */</span><span class="cp">       \</span>
<span class="cp">	pr_reg[17] = rdvr();                </span><span class="cm">/* vr */</span><span class="cp">       \</span>
<span class="cp">	pr_reg[18] = 0;                     </span><span class="cm">/* p2 */</span><span class="cp">       \</span>
<span class="cp">	pr_reg[19] = 0;                     </span><span class="cm">/* p3 */</span><span class="cp">       \</span>
<span class="cp">	pr_reg[20] = 0;                     </span><span class="cm">/* p4 */</span><span class="cp">       \</span>
<span class="cp">	pr_reg[21] = (regs-&gt;dccr &amp; 0xffff); </span><span class="cm">/* ccr */</span><span class="cp">      \</span>
<span class="cp">	pr_reg[22] = 0;                     </span><span class="cm">/* p6 */</span><span class="cp">       \</span>
<span class="cp">	pr_reg[23] = regs-&gt;mof;             </span><span class="cm">/* mof */</span><span class="cp">      \</span>
<span class="cp">	pr_reg[24] = 0;                     </span><span class="cm">/* p8 */</span><span class="cp">       \</span>
<span class="cp">	pr_reg[25] = 0;                     </span><span class="cm">/* ibr */</span><span class="cp">      \</span>
<span class="cp">	pr_reg[26] = 0;                     </span><span class="cm">/* irp */</span><span class="cp">      \</span>
<span class="cp">	pr_reg[27] = regs-&gt;srp;             </span><span class="cm">/* srp */</span><span class="cp">      \</span>
<span class="cp">	pr_reg[28] = 0;                     </span><span class="cm">/* bar */</span><span class="cp">      \</span>
<span class="cp">	pr_reg[29] = regs-&gt;dccr;            </span><span class="cm">/* dccr */</span><span class="cp">     \</span>
<span class="cp">	pr_reg[30] = 0;                     </span><span class="cm">/* brp */</span><span class="cp">      \</span>
<span class="cp">	pr_reg[31] = rdusp();               </span><span class="cm">/* usp */</span><span class="cp">      \</span>
<span class="cp">	pr_reg[32] = 0;                     </span><span class="cm">/* csrinstr */</span><span class="cp"> \</span>
<span class="cp">	pr_reg[33] = 0;                     </span><span class="cm">/* csraddr */</span><span class="cp">  \</span>
<span class="cp">	pr_reg[34] = 0;                     </span><span class="cm">/* csrdata */</span><span class="cp"></span>


<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
