<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › cris › include › arch-v32 › arch › cryptocop.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>cryptocop.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * The device /dev/cryptocop is accessible using this driver using</span>
<span class="cm"> * CRYPTOCOP_MAJOR (254) and minor number 0.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef CRYPTOCOP_H</span>
<span class="cp">#define CRYPTOCOP_H</span>

<span class="cp">#include &lt;linux/uio.h&gt;</span>


<span class="cp">#define CRYPTOCOP_SESSION_ID_NONE (0)</span>

<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">cryptocop_session_id</span><span class="p">;</span>

<span class="cm">/* cryptocop ioctls */</span>
<span class="cp">#define ETRAXCRYPTOCOP_IOCTYPE         (250)</span>

<span class="cp">#define CRYPTOCOP_IO_CREATE_SESSION    _IOWR(ETRAXCRYPTOCOP_IOCTYPE, 1, struct strcop_session_op)</span>
<span class="cp">#define CRYPTOCOP_IO_CLOSE_SESSION     _IOW(ETRAXCRYPTOCOP_IOCTYPE, 2, struct strcop_session_op)</span>
<span class="cp">#define CRYPTOCOP_IO_PROCESS_OP        _IOWR(ETRAXCRYPTOCOP_IOCTYPE, 3, struct strcop_crypto_op)</span>
<span class="cp">#define CRYPTOCOP_IO_MAXNR             (3)</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">cryptocop_cipher_des</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">cryptocop_cipher_3des</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">cryptocop_cipher_aes</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">cryptocop_cipher_m2m</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="cm">/* mem2mem is essentially a NULL cipher with blocklength=1 */</span>
	<span class="n">cryptocop_cipher_none</span>
<span class="p">}</span> <span class="n">cryptocop_cipher_type</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">cryptocop_digest_sha1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">cryptocop_digest_md5</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">cryptocop_digest_none</span>
<span class="p">}</span> <span class="n">cryptocop_digest_type</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">cryptocop_csum_le</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">cryptocop_csum_be</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">cryptocop_csum_none</span>
<span class="p">}</span> <span class="n">cryptocop_csum_type</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">cryptocop_cipher_mode_ecb</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">cryptocop_cipher_mode_cbc</span><span class="p">,</span>
	<span class="n">cryptocop_cipher_mode_none</span>
<span class="p">}</span> <span class="n">cryptocop_cipher_mode</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">cryptocop_3des_eee</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">cryptocop_3des_eed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">cryptocop_3des_ede</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">cryptocop_3des_edd</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">cryptocop_3des_dee</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
	<span class="n">cryptocop_3des_ded</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
	<span class="n">cryptocop_3des_dde</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="n">cryptocop_3des_ddd</span> <span class="o">=</span> <span class="mi">7</span>
<span class="p">}</span> <span class="n">cryptocop_3des_mode</span><span class="p">;</span>

<span class="cm">/* Usermode accessible (ioctl) operations. */</span>
<span class="k">struct</span> <span class="n">strcop_session_op</span><span class="p">{</span>
	<span class="n">cryptocop_session_id</span>    <span class="n">ses_id</span><span class="p">;</span>

	<span class="n">cryptocop_cipher_type</span>   <span class="n">cipher</span><span class="p">;</span> <span class="cm">/* AES, DES, 3DES, m2m, none */</span>

	<span class="n">cryptocop_cipher_mode</span>   <span class="n">cmode</span><span class="p">;</span> <span class="cm">/* ECB, CBC, none */</span>
	<span class="n">cryptocop_3des_mode</span>     <span class="n">des3_mode</span><span class="p">;</span>

	<span class="n">cryptocop_digest_type</span>   <span class="n">digest</span><span class="p">;</span> <span class="cm">/* MD5, SHA1, none */</span>

	<span class="n">cryptocop_csum_type</span>     <span class="n">csum</span><span class="p">;</span>   <span class="cm">/* BE, LE, none */</span>

	<span class="kt">unsigned</span> <span class="kt">char</span>           <span class="o">*</span><span class="n">key</span><span class="p">;</span>
	<span class="kt">size_t</span>                  <span class="n">keylen</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define CRYPTOCOP_CSUM_LENGTH         (2)</span>
<span class="cp">#define CRYPTOCOP_MAX_DIGEST_LENGTH   (20)  </span><span class="cm">/* SHA-1 20, MD5 16 */</span><span class="cp"></span>
<span class="cp">#define CRYPTOCOP_MAX_IV_LENGTH       (16)  </span><span class="cm">/* (3)DES==8, AES == 16 */</span><span class="cp"></span>
<span class="cp">#define CRYPTOCOP_MAX_KEY_LENGTH      (32)</span>

<span class="k">struct</span> <span class="n">strcop_crypto_op</span><span class="p">{</span>
	<span class="n">cryptocop_session_id</span> <span class="n">ses_id</span><span class="p">;</span>

	<span class="cm">/* Indata. */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>            <span class="o">*</span><span class="n">indata</span><span class="p">;</span>
	<span class="kt">size_t</span>                   <span class="n">inlen</span><span class="p">;</span> <span class="cm">/* Total indata length. */</span>

	<span class="cm">/* Cipher configuration. */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">do_cipher</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">decrypt</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* 1 == decrypt, 0 == encrypt */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">cipher_explicit</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">size_t</span>                   <span class="n">cipher_start</span><span class="p">;</span>
	<span class="kt">size_t</span>                   <span class="n">cipher_len</span><span class="p">;</span>
	<span class="cm">/* cipher_iv is used if do_cipher and cipher_explicit and the cipher</span>
<span class="cm">	   mode is CBC.  The length is controlled by the type of cipher,</span>
<span class="cm">	   e.g. DES/3DES 8 octets and AES 16 octets. */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">cipher_iv</span><span class="p">[</span><span class="n">CRYPTOCOP_MAX_IV_LENGTH</span><span class="p">];</span>
	<span class="cm">/* Outdata. */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>            <span class="o">*</span><span class="n">cipher_outdata</span><span class="p">;</span>
	<span class="kt">size_t</span>                   <span class="n">cipher_outlen</span><span class="p">;</span>

	<span class="cm">/* digest configuration. */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">do_digest</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">size_t</span>                   <span class="n">digest_start</span><span class="p">;</span>
	<span class="kt">size_t</span>                   <span class="n">digest_len</span><span class="p">;</span>
	<span class="cm">/* Outdata.  The actual length is determined by the type of the digest. */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">digest</span><span class="p">[</span><span class="n">CRYPTOCOP_MAX_DIGEST_LENGTH</span><span class="p">];</span>

	<span class="cm">/* Checksum configuration. */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">do_csum</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">size_t</span>                   <span class="n">csum_start</span><span class="p">;</span>
	<span class="kt">size_t</span>                   <span class="n">csum_len</span><span class="p">;</span>
	<span class="cm">/* Outdata. */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>            <span class="n">csum</span><span class="p">[</span><span class="n">CRYPTOCOP_CSUM_LENGTH</span><span class="p">];</span>
<span class="p">};</span>



<span class="cp">#ifdef __KERNEL__</span>

<span class="cm">/********** The API to use from inside the kernel. ************/</span>

<span class="cp">#include &lt;arch/hwregs/dma.h&gt;</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">cryptocop_alg_csum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">cryptocop_alg_mem2mem</span><span class="p">,</span>
	<span class="n">cryptocop_alg_md5</span><span class="p">,</span>
	<span class="n">cryptocop_alg_sha1</span><span class="p">,</span>
	<span class="n">cryptocop_alg_des</span><span class="p">,</span>
	<span class="n">cryptocop_alg_3des</span><span class="p">,</span>
	<span class="n">cryptocop_alg_aes</span><span class="p">,</span>
	<span class="n">cryptocop_no_alg</span><span class="p">,</span>
<span class="p">}</span> <span class="n">cryptocop_algorithm</span><span class="p">;</span>

<span class="k">typedef</span> <span class="n">u8</span> <span class="n">cryptocop_tfrm_id</span><span class="p">;</span>


<span class="k">struct</span> <span class="n">cryptocop_operation</span><span class="p">;</span>

<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="n">cryptocop_callback</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cryptocop_operation</span><span class="o">*</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">cryptocop_transform_init</span> <span class="p">{</span>
	<span class="n">cryptocop_algorithm</span>    <span class="n">alg</span><span class="p">;</span>
	<span class="cm">/* Keydata for ciphers. */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>          <span class="n">key</span><span class="p">[</span><span class="n">CRYPTOCOP_MAX_KEY_LENGTH</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>           <span class="n">keylen</span><span class="p">;</span>
	<span class="n">cryptocop_cipher_mode</span>  <span class="n">cipher_mode</span><span class="p">;</span>
	<span class="n">cryptocop_3des_mode</span>    <span class="n">tdes_mode</span><span class="p">;</span>
	<span class="n">cryptocop_csum_type</span>    <span class="n">csum_mode</span><span class="p">;</span> <span class="cm">/* cryptocop_csum_none is not allowed when alg==cryptocop_alg_csum */</span>

	<span class="n">cryptocop_tfrm_id</span> <span class="n">tid</span><span class="p">;</span> <span class="cm">/* Locally unique in session; assigned by user, checked by driver. */</span>
	<span class="k">struct</span> <span class="n">cryptocop_transform_init</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">cryptocop_source_dma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">cryptocop_source_des</span><span class="p">,</span>
	<span class="n">cryptocop_source_3des</span><span class="p">,</span>
	<span class="n">cryptocop_source_aes</span><span class="p">,</span>
	<span class="n">cryptocop_source_md5</span><span class="p">,</span>
	<span class="n">cryptocop_source_sha1</span><span class="p">,</span>
	<span class="n">cryptocop_source_csum</span><span class="p">,</span>
	<span class="n">cryptocop_source_none</span><span class="p">,</span>
<span class="p">}</span> <span class="n">cryptocop_source</span><span class="p">;</span>


<span class="k">struct</span> <span class="n">cryptocop_desc_cfg</span> <span class="p">{</span>
	<span class="n">cryptocop_tfrm_id</span> <span class="n">tid</span><span class="p">;</span>
	<span class="n">cryptocop_source</span> <span class="n">src</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">last</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* Last use of this transform in the operation.  Will push outdata when encountered. */</span>
	<span class="k">struct</span> <span class="n">cryptocop_desc_cfg</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cryptocop_desc</span> <span class="p">{</span>
	<span class="kt">size_t</span> <span class="n">length</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cryptocop_desc_cfg</span> <span class="o">*</span><span class="n">cfg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cryptocop_desc</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>


<span class="cm">/* Flags for cryptocop_tfrm_cfg */</span>
<span class="cp">#define CRYPTOCOP_NO_FLAG     (0x00)</span>
<span class="cp">#define CRYPTOCOP_ENCRYPT     (0x01)</span>
<span class="cp">#define CRYPTOCOP_DECRYPT     (0x02)</span>
<span class="cp">#define CRYPTOCOP_EXPLICIT_IV (0x04)</span>

<span class="k">struct</span> <span class="n">cryptocop_tfrm_cfg</span> <span class="p">{</span>
	<span class="n">cryptocop_tfrm_id</span> <span class="n">tid</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">;</span> <span class="cm">/* DECRYPT, ENCRYPT, EXPLICIT_IV */</span>

	<span class="cm">/* CBC initialisation vector for cihers. */</span>
	<span class="n">u8</span> <span class="n">iv</span><span class="p">[</span><span class="n">CRYPTOCOP_MAX_IV_LENGTH</span><span class="p">];</span>

	<span class="cm">/* The position in output where to write the transform output.  The order</span>
<span class="cm">	   in which the driver writes the output is unspecified, hence if several</span>
<span class="cm">	   transforms write on the same positions in the output the result is</span>
<span class="cm">	   unspecified. */</span>
	<span class="kt">size_t</span> <span class="n">inject_ix</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">cryptocop_tfrm_cfg</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>
<span class="p">};</span>



<span class="k">struct</span> <span class="n">cryptocop_dma_list_operation</span><span class="p">{</span>
	<span class="cm">/* The consumer can provide DMA lists to send to the co-processor.  &#39;use_dmalists&#39; in</span>
<span class="cm">	   struct cryptocop_operation must be set for the driver to use them.  outlist,</span>
<span class="cm">	   out_data_buf, inlist and in_data_buf must all be physical addresses since they will</span>
<span class="cm">	   be loaded to DMA . */</span>
	<span class="n">dma_descr_data</span> <span class="o">*</span><span class="n">outlist</span><span class="p">;</span> <span class="cm">/* Out from memory to the co-processor. */</span>
	<span class="kt">char</span>           <span class="o">*</span><span class="n">out_data_buf</span><span class="p">;</span>
	<span class="n">dma_descr_data</span> <span class="o">*</span><span class="n">inlist</span><span class="p">;</span> <span class="cm">/* In from the co-processor to memory. */</span>
	<span class="kt">char</span>           <span class="o">*</span><span class="n">in_data_buf</span><span class="p">;</span>

	<span class="n">cryptocop_3des_mode</span> <span class="n">tdes_mode</span><span class="p">;</span>
	<span class="n">cryptocop_csum_type</span> <span class="n">csum_mode</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">cryptocop_tfrm_operation</span><span class="p">{</span>
	<span class="cm">/* Operation configuration, if not &#39;use_dmalists&#39; is set. */</span>
	<span class="k">struct</span> <span class="n">cryptocop_tfrm_cfg</span> <span class="o">*</span><span class="n">tfrm_cfg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cryptocop_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">iovec</span> <span class="o">*</span><span class="n">indata</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">incount</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">inlen</span><span class="p">;</span> <span class="cm">/* Total inlength. */</span>

	<span class="k">struct</span> <span class="n">iovec</span> <span class="o">*</span><span class="n">outdata</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">outcount</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">outlen</span><span class="p">;</span> <span class="cm">/* Total outlength. */</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">cryptocop_operation</span> <span class="p">{</span>
	<span class="n">cryptocop_callback</span> <span class="o">*</span><span class="n">cb</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">cb_data</span><span class="p">;</span>

	<span class="n">cryptocop_session_id</span> <span class="n">sid</span><span class="p">;</span>

	<span class="cm">/* The status of the operation when returned to consumer. */</span>
	<span class="kt">int</span> <span class="n">operation_status</span><span class="p">;</span> <span class="cm">/* 0, -EAGAIN */</span>

	<span class="cm">/* Flags */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">use_dmalists</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>  <span class="cm">/* Use outlist and inlist instead of the desc/tfrm_cfg configuration. */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">in_interrupt</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>  <span class="cm">/* Set if inserting job from interrupt context. */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">fast_callback</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* Set if fast callback wanted, i.e. from interrupt context. */</span>

	<span class="k">union</span><span class="p">{</span>
		<span class="k">struct</span> <span class="n">cryptocop_dma_list_operation</span> <span class="n">list_op</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">cryptocop_tfrm_operation</span> <span class="n">tfrm_op</span><span class="p">;</span>
	<span class="p">};</span>
<span class="p">};</span>


<span class="kt">int</span> <span class="n">cryptocop_new_session</span><span class="p">(</span><span class="n">cryptocop_session_id</span> <span class="o">*</span><span class="n">sid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cryptocop_transform_init</span> <span class="o">*</span><span class="n">tinit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">alloc_flag</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cryptocop_free_session</span><span class="p">(</span><span class="n">cryptocop_session_id</span> <span class="n">sid</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">cryptocop_job_queue_insert_csum</span><span class="p">(</span><span class="k">struct</span> <span class="n">cryptocop_operation</span> <span class="o">*</span><span class="n">operation</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">cryptocop_job_queue_insert_crypto</span><span class="p">(</span><span class="k">struct</span> <span class="n">cryptocop_operation</span> <span class="o">*</span><span class="n">operation</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">cryptocop_job_queue_insert_user_job</span><span class="p">(</span><span class="k">struct</span> <span class="n">cryptocop_operation</span> <span class="o">*</span><span class="n">operation</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __KERNEL__ */</span><span class="cp"></span>

<span class="cp">#endif </span><span class="cm">/* CRYPTOCOP_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
