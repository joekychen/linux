<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › mn10300 › include › asm › elf.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>elf.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* MN10300 ELF constant and register definitions</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2007 Matsushita Electric Industrial Co., Ltd.</span>
<span class="cm"> * Copyright (C) 2007 Red Hat, Inc. All Rights Reserved.</span>
<span class="cm"> * Written by David Howells (dhowells@redhat.com)</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public Licence</span>
<span class="cm"> * as published by the Free Software Foundation; either version</span>
<span class="cm"> * 2 of the Licence, or (at your option) any later version.</span>
<span class="cm"> */</span>
<span class="cp">#ifndef _ASM_ELF_H</span>
<span class="cp">#define _ASM_ELF_H</span>

<span class="cp">#include &lt;linux/utsname.h&gt;</span>
<span class="cp">#include &lt;asm/ptrace.h&gt;</span>
<span class="cp">#include &lt;asm/user.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * AM33 relocations</span>
<span class="cm"> */</span>
<span class="cp">#define R_MN10300_NONE		0	</span><span class="cm">/* No reloc.  */</span><span class="cp"></span>
<span class="cp">#define R_MN10300_32		1	</span><span class="cm">/* Direct 32 bit.  */</span><span class="cp"></span>
<span class="cp">#define R_MN10300_16		2	</span><span class="cm">/* Direct 16 bit.  */</span><span class="cp"></span>
<span class="cp">#define R_MN10300_8		3	</span><span class="cm">/* Direct 8 bit.  */</span><span class="cp"></span>
<span class="cp">#define R_MN10300_PCREL32	4	</span><span class="cm">/* PC-relative 32-bit.  */</span><span class="cp"></span>
<span class="cp">#define R_MN10300_PCREL16	5	</span><span class="cm">/* PC-relative 16-bit signed.  */</span><span class="cp"></span>
<span class="cp">#define R_MN10300_PCREL8	6	</span><span class="cm">/* PC-relative 8-bit signed.  */</span><span class="cp"></span>
<span class="cp">#define R_MN10300_24		9	</span><span class="cm">/* Direct 24 bit.  */</span><span class="cp"></span>
<span class="cp">#define R_MN10300_RELATIVE	23	</span><span class="cm">/* Adjust by program base.  */</span><span class="cp"></span>
<span class="cp">#define R_MN10300_SYM_DIFF	33	</span><span class="cm">/* Adjustment when relaxing. */</span><span class="cp"></span>
<span class="cp">#define R_MN10300_ALIGN 	34	</span><span class="cm">/* Alignment requirement. */</span><span class="cp"></span>

<span class="cm">/*</span>
<span class="cm"> * AM33/AM34 HW Capabilities</span>
<span class="cm"> */</span>
<span class="cp">#define HWCAP_MN10300_ATOMIC_OP_UNIT	1	</span><span class="cm">/* Has AM34 Atomic Operations */</span><span class="cp"></span>


<span class="cm">/*</span>
<span class="cm"> * ELF register definitions..</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">elf_greg_t</span><span class="p">;</span>

<span class="cp">#define ELF_NGREG ((sizeof(struct pt_regs) / sizeof(elf_greg_t)) - 1)</span>
<span class="k">typedef</span> <span class="n">elf_greg_t</span> <span class="n">elf_gregset_t</span><span class="p">[</span><span class="n">ELF_NGREG</span><span class="p">];</span>

<span class="cp">#define ELF_NFPREG 32</span>
<span class="k">typedef</span> <span class="kt">float</span> <span class="n">elf_fpreg_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">elf_fpreg_t</span>	<span class="n">fpregs</span><span class="p">[</span><span class="n">ELF_NFPREG</span><span class="p">];</span>
	<span class="n">u_int32_t</span>	<span class="n">fpcr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">elf_fpregset_t</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * This is used to ensure we don&#39;t load something for the wrong architecture</span>
<span class="cm"> */</span>
<span class="cp">#define elf_check_arch(x) \</span>
<span class="cp">	(((x)-&gt;e_machine == EM_CYGNUS_MN10300) ||	\</span>
<span class="cp">	 ((x)-&gt;e_machine == EM_MN10300))</span>

<span class="cm">/*</span>
<span class="cm"> * These are used to set parameters in the core dumps.</span>
<span class="cm"> */</span>
<span class="cp">#define ELF_CLASS	ELFCLASS32</span>
<span class="cp">#define ELF_DATA	ELFDATA2LSB</span>
<span class="cp">#define ELF_ARCH	EM_MN10300</span>

<span class="cm">/*</span>
<span class="cm"> * ELF process initialiser</span>
<span class="cm"> */</span>
<span class="cp">#define ELF_PLAT_INIT(_r, load_addr)					\</span>
<span class="cp">do {									\</span>
<span class="cp">	struct pt_regs *_ur = current-&gt;thread.uregs;			\</span>
<span class="cp">	_ur-&gt;a3   = 0;	_ur-&gt;a2   = 0;	_ur-&gt;d3   = 0;	_ur-&gt;d2   = 0;	\</span>
<span class="cp">	_ur-&gt;mcvf = 0;	_ur-&gt;mcrl = 0;	_ur-&gt;mcrh = 0;	_ur-&gt;mdrq = 0;	\</span>
<span class="cp">	_ur-&gt;e1   = 0;	_ur-&gt;e0   = 0;	_ur-&gt;e7   = 0;	_ur-&gt;e6   = 0;	\</span>
<span class="cp">	_ur-&gt;e5   = 0;	_ur-&gt;e4   = 0;	_ur-&gt;e3   = 0;	_ur-&gt;e2   = 0;	\</span>
<span class="cp">	_ur-&gt;lar  = 0;	_ur-&gt;lir  = 0;	_ur-&gt;mdr  = 0;			\</span>
<span class="cp">	_ur-&gt;a1   = 0;	_ur-&gt;a0   = 0;	_ur-&gt;d1   = 0;	_ur-&gt;d0   = 0;	\</span>
<span class="cp">} while (0)</span>

<span class="cp">#define CORE_DUMP_USE_REGSET</span>
<span class="cp">#define ELF_EXEC_PAGESIZE	4096</span>

<span class="cm">/*</span>
<span class="cm"> * This is the location that an ET_DYN program is loaded if exec&#39;ed.  Typical</span>
<span class="cm"> * use of this is to invoke &quot;./ld.so someprog&quot; to test out a new version of</span>
<span class="cm"> * the loader.  We need to make sure that it is out of the way of the program</span>
<span class="cm"> * that it will &quot;exec&quot;, and that there is sufficient room for the brk.</span>
<span class="cm"> * - must clear the VMALLOC area</span>
<span class="cm"> */</span>
<span class="cp">#define ELF_ET_DYN_BASE         0x04000000</span>

<span class="cm">/*</span>
<span class="cm"> * regs is struct pt_regs, pr_reg is elf_gregset_t (which is</span>
<span class="cm"> * now struct user_regs, they are different)</span>
<span class="cm"> * - ELF_CORE_COPY_REGS has been guessed, and may be wrong</span>
<span class="cm"> */</span>
<span class="cp">#define ELF_CORE_COPY_REGS(pr_reg, regs)	\</span>
<span class="cp">do {						\</span>
<span class="cp">	pr_reg[0]	= regs-&gt;a3;		\</span>
<span class="cp">	pr_reg[1]	= regs-&gt;a2;		\</span>
<span class="cp">	pr_reg[2]	= regs-&gt;d3;		\</span>
<span class="cp">	pr_reg[3]	= regs-&gt;d2;		\</span>
<span class="cp">	pr_reg[4]	= regs-&gt;mcvf;		\</span>
<span class="cp">	pr_reg[5]	= regs-&gt;mcrl;		\</span>
<span class="cp">	pr_reg[6]	= regs-&gt;mcrh;		\</span>
<span class="cp">	pr_reg[7]	= regs-&gt;mdrq;		\</span>
<span class="cp">	pr_reg[8]	= regs-&gt;e1;		\</span>
<span class="cp">	pr_reg[9]	= regs-&gt;e0;		\</span>
<span class="cp">	pr_reg[10]	= regs-&gt;e7;		\</span>
<span class="cp">	pr_reg[11]	= regs-&gt;e6;		\</span>
<span class="cp">	pr_reg[12]	= regs-&gt;e5;		\</span>
<span class="cp">	pr_reg[13]	= regs-&gt;e4;		\</span>
<span class="cp">	pr_reg[14]	= regs-&gt;e3;		\</span>
<span class="cp">	pr_reg[15]	= regs-&gt;e2;		\</span>
<span class="cp">	pr_reg[16]	= regs-&gt;sp;		\</span>
<span class="cp">	pr_reg[17]	= regs-&gt;lar;		\</span>
<span class="cp">	pr_reg[18]	= regs-&gt;lir;		\</span>
<span class="cp">	pr_reg[19]	= regs-&gt;mdr;		\</span>
<span class="cp">	pr_reg[20]	= regs-&gt;a1;		\</span>
<span class="cp">	pr_reg[21]	= regs-&gt;a0;		\</span>
<span class="cp">	pr_reg[22]	= regs-&gt;d1;		\</span>
<span class="cp">	pr_reg[23]	= regs-&gt;d0;		\</span>
<span class="cp">	pr_reg[24]	= regs-&gt;orig_d0;	\</span>
<span class="cp">	pr_reg[25]	= regs-&gt;epsw;		\</span>
<span class="cp">	pr_reg[26]	= regs-&gt;pc;		\</span>
<span class="cp">} while (0);</span>

<span class="cm">/*</span>
<span class="cm"> * This yields a mask that user programs can use to figure out what</span>
<span class="cm"> * instruction set this CPU supports.  This could be done in user space,</span>
<span class="cm"> * but it&#39;s not easy, and we&#39;ve already done it here.</span>
<span class="cm"> */</span>
<span class="cp">#ifdef CONFIG_MN10300_HAS_ATOMIC_OPS_UNIT</span>
<span class="cp">#define ELF_HWCAP	(HWCAP_MN10300_ATOMIC_OP_UNIT)</span>
<span class="cp">#else</span>
<span class="cp">#define ELF_HWCAP	(0)</span>
<span class="cp">#endif</span>

<span class="cm">/*</span>
<span class="cm"> * This yields a string that ld.so will use to load implementation</span>
<span class="cm"> * specific libraries for optimization.  This is more specific in</span>
<span class="cm"> * intent than poking at uname or /proc/cpuinfo.</span>
<span class="cm"> *</span>
<span class="cm"> * For the moment, we have only optimizations for the Intel generations,</span>
<span class="cm"> * but that could change...</span>
<span class="cm"> */</span>
<span class="cp">#define ELF_PLATFORM  (NULL)</span>

<span class="cp">#ifdef __KERNEL__</span>
<span class="cp">#define SET_PERSONALITY(ex) set_personality(PER_LINUX)</span>
<span class="cp">#endif</span>

<span class="cp">#endif </span><span class="cm">/* _ASM_ELF_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
