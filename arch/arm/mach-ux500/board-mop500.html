<!DOCTYPE html>
<html><head><title>joekychen/linux » arch › arm › mach-ux500 › board-mop500.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>board-mop500.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (C) ST-Ericsson SA 2010</span>
<span class="cm"> *</span>
<span class="cm"> * License terms: GNU General Public License (GPL) version 2</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __BOARD_MOP500_H</span>
<span class="cp">#define __BOARD_MOP500_H</span>

<span class="cm">/* For NOMADIK_NR_GPIO */</span>
<span class="cp">#include &lt;mach/irqs.h&gt;</span>

<span class="cm">/* Snowball specific GPIO assignments, this board has no GPIO expander */</span>
<span class="cp">#define SNOWBALL_ACCEL_INT1_GPIO	163</span>
<span class="cp">#define SNOWBALL_ACCEL_INT2_GPIO	164</span>
<span class="cp">#define SNOWBALL_MAGNET_DRDY_GPIO	165</span>
<span class="cp">#define SNOWBALL_SDMMC_EN_GPIO		217</span>
<span class="cp">#define SNOWBALL_SDMMC_1V8_3V_GPIO	228</span>
<span class="cp">#define SNOWBALL_SDMMC_CD_GPIO		218</span>

<span class="cm">/* HREFv60-specific GPIO assignments, this board has no GPIO expander */</span>
<span class="cp">#define HREFV60_SDMMC_1V8_3V_GPIO	5</span>
<span class="cp">#define HREFV60_CAMERA_FLASH_ENABLE	21</span>
<span class="cp">#define HREFV60_MAGNET_DRDY_GPIO	32</span>
<span class="cp">#define HREFV60_DISP1_RST_GPIO		65</span>
<span class="cp">#define HREFV60_DISP2_RST_GPIO		66</span>
<span class="cp">#define HREFV60_ACCEL_INT1_GPIO		82</span>
<span class="cp">#define HREFV60_ACCEL_INT2_GPIO		83</span>
<span class="cp">#define HREFV60_SDMMC_CD_GPIO		95</span>
<span class="cp">#define HREFV60_XSHUTDOWN_SECONDARY_SENSOR 140</span>
<span class="cp">#define HREFV60_TOUCH_RST_GPIO		143</span>
<span class="cp">#define HREFV60_HAL_SW_GPIO		145</span>
<span class="cp">#define HREFV60_SDMMC_EN_GPIO		169</span>
<span class="cp">#define HREFV60_MMIO_XENON_CHARGE	170</span>
<span class="cp">#define HREFV60_PROX_SENSE_GPIO		217</span>

<span class="cm">/* MOP500 generic GPIOs */</span>
<span class="cp">#define CAMERA_FLASH_INT_PIN		7</span>
<span class="cp">#define CYPRESS_TOUCH_INT_PIN		84</span>
<span class="cp">#define XSHUTDOWN_PRIMARY_SENSOR	141</span>
<span class="cp">#define XSHUTDOWN_SECONDARY_SENSOR	142</span>
<span class="cp">#define CYPRESS_TOUCH_RST_GPIO		143</span>
<span class="cp">#define MOP500_HDMI_RST_GPIO		196</span>
<span class="cp">#define CYPRESS_SLAVE_SELECT_GPIO	216</span>

<span class="cm">/* GPIOs on the TC35892 expander */</span>
<span class="cp">#define MOP500_EGPIO(x)			(NOMADIK_NR_GPIO + (x))</span>
<span class="cp">#define GPIO_MAGNET_DRDY		MOP500_EGPIO(1)</span>
<span class="cp">#define GPIO_SDMMC_CD			MOP500_EGPIO(3)</span>
<span class="cp">#define GPIO_CAMERA_FLASH_ENABLE	MOP500_EGPIO(4)</span>
<span class="cp">#define GPIO_MMIO_XENON_CHARGE		MOP500_EGPIO(5)</span>
<span class="cp">#define GPIO_PROX_SENSOR		MOP500_EGPIO(7)</span>
<span class="cp">#define GPIO_HAL_SENSOR			MOP500_EGPIO(8)</span>
<span class="cp">#define GPIO_ACCEL_INT1			MOP500_EGPIO(10)</span>
<span class="cp">#define GPIO_ACCEL_INT2			MOP500_EGPIO(11)</span>
<span class="cp">#define GPIO_BU21013_CS			MOP500_EGPIO(13)</span>
<span class="cp">#define MOP500_DISP2_RST_GPIO		MOP500_EGPIO(14)</span>
<span class="cp">#define MOP500_DISP1_RST_GPIO		MOP500_EGPIO(15)</span>
<span class="cp">#define GPIO_SDMMC_EN			MOP500_EGPIO(17)</span>
<span class="cp">#define GPIO_SDMMC_1V8_3V_SEL		MOP500_EGPIO(18)</span>
<span class="cp">#define MOP500_EGPIO_END		MOP500_EGPIO(24)</span>

<span class="cm">/*</span>
<span class="cm"> * GPIOs on the AB8500 mixed-signals circuit</span>
<span class="cm"> * Notice that we subtract 1 from the number passed into the macro, this is</span>
<span class="cm"> * because the AB8500 GPIO pins are enumbered starting from 1, so the value in</span>
<span class="cm"> * parens matches the GPIO pin number in the data sheet.</span>
<span class="cm"> */</span>
<span class="cp">#define MOP500_AB8500_PIN_GPIO(x)	(MOP500_EGPIO_END + (x) - 1)</span>
<span class="cm">/*Snowball AB8500 GPIO */</span>
<span class="cp">#define SNOWBALL_VSMPS2_1V8_GPIO	MOP500_AB8500_PIN_GPIO(1)	</span><span class="cm">/* SYSCLKREQ2/GPIO1 */</span><span class="cp"></span>
<span class="cp">#define SNOWBALL_PM_GPIO1_GPIO		MOP500_AB8500_PIN_GPIO(2)	</span><span class="cm">/* SYSCLKREQ3/GPIO2 */</span><span class="cp"></span>
<span class="cp">#define SNOWBALL_WLAN_CLK_REQ_GPIO	MOP500_AB8500_PIN_GPIO(3)	</span><span class="cm">/* SYSCLKREQ4/GPIO3 */</span><span class="cp"></span>
<span class="cp">#define SNOWBALL_PM_GPIO4_GPIO		MOP500_AB8500_PIN_GPIO(4)	</span><span class="cm">/* SYSCLKREQ6/GPIO4 */</span><span class="cp"></span>
<span class="cp">#define SNOWBALL_EN_3V6_GPIO		MOP500_AB8500_PIN_GPIO(16)	</span><span class="cm">/* PWMOUT3/GPIO16 */</span><span class="cp"></span>
<span class="cp">#define SNOWBALL_PME_ETH_GPIO		MOP500_AB8500_PIN_GPIO(24)	</span><span class="cm">/* SYSCLKREQ7/GPIO24 */</span><span class="cp"></span>
<span class="cp">#define SNOWBALL_EN_3V3_ETH_GPIO	MOP500_AB8500_PIN_GPIO(26)	</span><span class="cm">/* GPIO26 */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">device</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">i2c_board_info</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">mop500_sdi_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">snowball_sdi_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">hrefv60_sdi_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mop500_sdi_tc35892_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="n">mop500_u8500uib_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="n">mop500_stuib_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="n">mop500_pinmaps_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="n">snowball_pinmaps_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__init</span> <span class="n">hrefv60_pinmaps_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">__init</span> <span class="n">mop500_uib_init</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">mop500_uib_i2c_add</span><span class="p">(</span><span class="kt">int</span> <span class="n">busnum</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="n">n</span><span class="p">);</span>

<span class="cm">/* TODO: Once all pieces are DT:ed, remove completely. */</span>
<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span> <span class="n">__init</span> <span class="n">u8500_of_init_devices</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
an>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>           <span class="o">=</span> <span class="mi">151</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>           <span class="o">=</span> <span class="n">EV_KEY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>           <span class="o">=</span> <span class="n">KEY_2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>           <span class="o">=</span> <span class="s">&quot;extkb1&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">debounce_interval</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wakeup</span>         <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>           <span class="o">=</span> <span class="mi">152</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>           <span class="o">=</span> <span class="n">EV_KEY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>           <span class="o">=</span> <span class="n">KEY_3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>           <span class="o">=</span> <span class="s">&quot;extkb2&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">debounce_interval</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wakeup</span>         <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>           <span class="o">=</span> <span class="mi">161</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>           <span class="o">=</span> <span class="n">EV_KEY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>           <span class="o">=</span> <span class="n">KEY_4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>           <span class="o">=</span> <span class="s">&quot;extkb3&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">debounce_interval</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wakeup</span>         <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">gpio</span>           <span class="o">=</span> <span class="mi">162</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>           <span class="o">=</span> <span class="n">EV_KEY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>           <span class="o">=</span> <span class="n">KEY_5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">desc</span>           <span class="o">=</span> <span class="s">&quot;extkb4&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">debounce_interval</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wakeup</span>         <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_platform_data</span> <span class="n">snowball_key_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">buttons</span>        <span class="o">=</span> <span class="n">snowball_key_array</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nbuttons</span>       <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snowball_key_array</span><span class="p">),</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">snowball_key_dev</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;gpio-keys&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>             <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>            <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">snowball_key_data</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">smsc911x_platform_config</span> <span class="n">snowball_sbnet_cfg</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">irq_polarity</span> <span class="o">=</span> <span class="n">SMSC911X_IRQ_POLARITY_ACTIVE_HIGH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_type</span> <span class="o">=</span> <span class="n">SMSC911X_IRQ_TYPE_PUSH_PULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">SMSC911X_USE_16BIT</span> <span class="o">|</span> <span class="n">SMSC911X_FORCE_INTERNAL_PHY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">shift</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">sbnet_res</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;smsc911x-memory&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x5000</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">),</span>
		<span class="p">.</span><span class="n">end</span>  <span class="o">=</span>  <span class="p">(</span><span class="mh">0x5000</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0xffff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_MEM</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">NOMADIK_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">140</span><span class="p">),</span>
		<span class="p">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">NOMADIK_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">140</span><span class="p">),</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span> <span class="o">|</span> <span class="n">IORESOURCE_IRQ_HIGHEDGE</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">snowball_sbnet_dev</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>           <span class="o">=</span> <span class="s">&quot;smsc911x&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_resources</span>  <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sbnet_res</span><span class="p">),</span>
	<span class="p">.</span><span class="n">resource</span>       <span class="o">=</span> <span class="n">sbnet_res</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>            <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">snowball_sbnet_cfg</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">ab8500_platform_data</span> <span class="n">ab8500_platdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">irq_base</span>	<span class="o">=</span> <span class="n">MOP500_AB8500_IRQ_BASE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">regulator_reg_init</span> <span class="o">=</span> <span class="n">ab8500_regulator_reg_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_regulator_reg_init</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ab8500_regulator_reg_init</span><span class="p">),</span>
	<span class="p">.</span><span class="n">regulator</span>	<span class="o">=</span> <span class="n">ab8500_regulators</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_regulator</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ab8500_regulators</span><span class="p">),</span>
	<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">ab8500_gpio_pdata</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">ab8500_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">start</span>	<span class="o">=</span> <span class="n">IRQ_DB8500_AB8500</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>	<span class="o">=</span> <span class="n">IRQ_DB8500_AB8500</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	<span class="o">=</span> <span class="n">IORESOURCE_IRQ</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">platform_device</span> <span class="n">ab8500_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ab8500-core&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ab8500_platdata</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">ab8500_resources</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * TPS61052</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tps6105x_platform_data</span> <span class="n">mop500_tps61052_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">TPS6105X_MODE_VOLTAGE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">regulator_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">tps61052_regulator</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * TC35892</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mop500_tc35892_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">tc3589x</span> <span class="o">*</span><span class="n">tc3589x</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">base</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	/* FIXME: Is the sdi actually part of tc3589x? */</span>
<span class="c">	parent = tc3589x-&gt;dev;</span>
<span class="cp">#endif</span>
	<span class="n">mop500_sdi_tc35892_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tc3589x_gpio_platform_data</span> <span class="n">mop500_tc35892_gpio_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">gpio_base</span>	<span class="o">=</span> <span class="n">MOP500_EGPIO</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
	<span class="p">.</span><span class="n">setup</span>		<span class="o">=</span> <span class="n">mop500_tc35892_init</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tc3589x_platform_data</span> <span class="n">mop500_tc35892_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">block</span>		<span class="o">=</span> <span class="n">TC3589x_BLOCK_GPIO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">mop500_tc35892_gpio_data</span><span class="p">,</span>
	<span class="p">.</span><span class="n">irq_base</span>	<span class="o">=</span> <span class="n">MOP500_EGPIO_IRQ_BASE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lp5521_led_config</span> <span class="n">lp5521_pri_led</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">chan_nr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">led_current</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">max_current</span> <span class="o">=</span> <span class="mh">0x5f</span><span class="p">,</span>
       <span class="p">},</span>
       <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">chan_nr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">led_current</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">max_current</span> <span class="o">=</span> <span class="mh">0x5f</span><span class="p">,</span>
       <span class="p">},</span>
       <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">chan_nr</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">led_current</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">max_current</span> <span class="o">=</span> <span class="mh">0x5f</span><span class="p">,</span>
       <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lp5521_platform_data</span> <span class="n">__initdata</span> <span class="n">lp5521_pri_data</span> <span class="o">=</span> <span class="p">{</span>
       <span class="p">.</span><span class="n">label</span> <span class="o">=</span> <span class="s">&quot;lp5521_pri&quot;</span><span class="p">,</span>
       <span class="p">.</span><span class="n">led_config</span>     <span class="o">=</span> <span class="o">&amp;</span><span class="n">lp5521_pri_led</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
       <span class="p">.</span><span class="n">num_channels</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
       <span class="p">.</span><span class="n">clock_mode</span>     <span class="o">=</span> <span class="n">LP5521_CLOCK_EXT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lp5521_led_config</span> <span class="n">lp5521_sec_led</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
       <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">chan_nr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">led_current</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">max_current</span> <span class="o">=</span> <span class="mh">0x5f</span><span class="p">,</span>
       <span class="p">},</span>
       <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">chan_nr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">led_current</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">max_current</span> <span class="o">=</span> <span class="mh">0x5f</span><span class="p">,</span>
       <span class="p">},</span>
       <span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	       <span class="p">.</span><span class="n">chan_nr</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">led_current</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">,</span>
	       <span class="p">.</span><span class="n">max_current</span> <span class="o">=</span> <span class="mh">0x5f</span><span class="p">,</span>
       <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lp5521_platform_data</span> <span class="n">__initdata</span> <span class="n">lp5521_sec_data</span> <span class="o">=</span> <span class="p">{</span>
       <span class="p">.</span><span class="n">label</span> <span class="o">=</span> <span class="s">&quot;lp5521_sec&quot;</span><span class="p">,</span>
       <span class="p">.</span><span class="n">led_config</span>     <span class="o">=</span> <span class="o">&amp;</span><span class="n">lp5521_sec_led</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
       <span class="p">.</span><span class="n">num_channels</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
       <span class="p">.</span><span class="n">clock_mode</span>     <span class="o">=</span> <span class="n">LP5521_CLOCK_EXT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">mop500_i2c0_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;tc3589x&quot;</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">),</span>
		<span class="p">.</span><span class="n">irq</span>		<span class="o">=</span> <span class="n">NOMADIK_GPIO_TO_IRQ</span><span class="p">(</span><span class="mi">217</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">mop500_tc35892_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/* I2C0 devices only available prior to HREFv60 */</span>
	<span class="p">{</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;tps61052&quot;</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">mop500_tps61052_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#define NUM_PRE_V60_I2C0_DEVICES 1</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_board_info</span> <span class="n">__initdata</span> <span class="n">mop500_i2c2_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="cm">/* lp5521 LED driver, 1st device */</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;lp5521&quot;</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">lp5521_pri_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* lp5521 LED driver, 2st device */</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;lp5521&quot;</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">),</span>
		<span class="p">.</span><span class="n">platform_data</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">lp5521_sec_data</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="cm">/* Light sensor Rohm BH1780GLI */</span>
		<span class="n">I2C_BOARD_INFO</span><span class="p">(</span><span class="s">&quot;bh1780&quot;</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">),</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cp">#define U8500_I2C_CONTROLLER(id, _slsu, _tft, _rft, clk, t_out, _sm)	\</span>
<span class="cp">static struct nmk_i2c_controller u8500_i2c##id##_data = { \</span>
<span class="cp">	</span><span class="cm">/*				\</span>
<span class="cm">	 * slave data setup time, which is	\</span>
<span class="cm">	 * 250 ns,100ns,10ns which is 14,6,2	\</span>
<span class="cm">	 * respectively for a 48 Mhz	\</span>
<span class="cm">	 * i2c clock			\</span>
<span class="cm">	 */</span><span class="cp">				\</span>
<span class="cp">	.slsu		= _slsu,	\</span>
<span class="cp">	</span><span class="cm">/* Tx FIFO threshold */</span><span class="cp">		\</span>
<span class="cp">	.tft		= _tft,		\</span>
<span class="cp">	</span><span class="cm">/* Rx FIFO threshold */</span><span class="cp">		\</span>
<span class="cp">	.rft		= _rft,		\</span>
<span class="cp">	</span><span class="cm">/* std. mode operation */</span><span class="cp">	\</span>
<span class="cp">	.clk_freq	= clk,		\</span>
<span class="cp">	</span><span class="cm">/* Slave response timeout(ms) */</span><span class="cp">\</span>
<span class="cp">	.timeout	= t_out,	\</span>
<span class="cp">	.sm		= _sm,		\</span>
<span class="cp">}</span>

<span class="cm">/*</span>
<span class="cm"> * The board uses 4 i2c controllers, initialize all of</span>
<span class="cm"> * them with slave data setup time of 250 ns,</span>
<span class="cm"> * Tx &amp; Rx FIFO threshold values as 8 and standard</span>
<span class="cm"> * mode of operation</span>
<span class="cm"> */</span>
<span class="n">U8500_I2C_CONTROLLER</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">I2C_FREQ_MODE_FAST</span><span class="p">);</span>
<span class="n">U8500_I2C_CONTROLLER</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mh">0xe</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">I2C_FREQ_MODE_FAST</span><span class="p">);</span>
<span class="n">U8500_I2C_CONTROLLER</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span>	<span class="mh">0xe</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">I2C_FREQ_MODE_FAST</span><span class="p">);</span>
<span class="n">U8500_I2C_CONTROLLER</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>	<span class="mh">0xe</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">I2C_FREQ_MODE_FAST</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mop500_i2c_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">db8500_add_i2c0</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u8500_i2c0_data</span><span class="p">);</span>
	<span class="n">db8500_add_i2c1</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u8500_i2c1_data</span><span class="p">);</span>
	<span class="n">db8500_add_i2c2</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u8500_i2c2_data</span><span class="p">);</span>
	<span class="n">db8500_add_i2c3</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u8500_i2c3_data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_button</span> <span class="n">mop500_gpio_keys</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">desc</span>			<span class="o">=</span> <span class="s">&quot;SFH7741 Proximity Sensor&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>			<span class="o">=</span> <span class="n">EV_SW</span><span class="p">,</span>
		<span class="p">.</span><span class="n">code</span>			<span class="o">=</span> <span class="n">SW_FRONT_PROXIMITY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">active_low</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">can_disable</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">regulator</span> <span class="o">*</span><span class="n">prox_regulator</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">mop500_prox_activate</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">mop500_prox_deactivate</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">gpio_keys_platform_data</span> <span class="n">mop500_gpio_keys_data</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">buttons</span>	<span class="o">=</span> <span class="n">mop500_gpio_keys</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nbuttons</span>	<span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_gpio_keys</span><span class="p">),</span>
	<span class="p">.</span><span class="n">enable</span>		<span class="o">=</span> <span class="n">mop500_prox_activate</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable</span>	<span class="o">=</span> <span class="n">mop500_prox_deactivate</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="n">mop500_gpio_keys_device</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;gpio-keys&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev</span>	<span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">platform_data</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">mop500_gpio_keys_data</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mop500_prox_activate</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">prox_regulator</span> <span class="o">=</span> <span class="n">regulator_get</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mop500_gpio_keys_device</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span>
						<span class="s">&quot;vcc&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">prox_regulator</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mop500_gpio_keys_device</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span>
			<span class="s">&quot;no regulator</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">PTR_ERR</span><span class="p">(</span><span class="n">prox_regulator</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">regulator_enable</span><span class="p">(</span><span class="n">prox_regulator</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mop500_prox_deactivate</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">regulator_disable</span><span class="p">(</span><span class="n">prox_regulator</span><span class="p">);</span>
	<span class="n">regulator_put</span><span class="p">(</span><span class="n">prox_regulator</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">cryp_platform_data</span> <span class="n">u8500_cryp1_platform_data</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">mem_to_engine</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_MEM_TO_PERIPH</span><span class="p">,</span>
				<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_SRC_MEMORY</span><span class="p">,</span>
				<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">DB8500_DMA_DEV48_CAC1_TX</span><span class="p">,</span>
				<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_WORD_WIDTH</span><span class="p">,</span>
				<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_WORD_WIDTH</span><span class="p">,</span>
				<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
				<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">psize</span> <span class="o">=</span> <span class="n">STEDMA40_PSIZE_LOG_4</span><span class="p">,</span>
				<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">psize</span> <span class="o">=</span> <span class="n">STEDMA40_PSIZE_LOG_4</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">engine_to_mem</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_PERIPH_TO_MEM</span><span class="p">,</span>
				<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span> <span class="n">DB8500_DMA_DEV48_CAC1_RX</span><span class="p">,</span>
				<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_DST_MEMORY</span><span class="p">,</span>
				<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_WORD_WIDTH</span><span class="p">,</span>
				<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_WORD_WIDTH</span><span class="p">,</span>
				<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
				<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">psize</span> <span class="o">=</span> <span class="n">STEDMA40_PSIZE_LOG_4</span><span class="p">,</span>
				<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">psize</span> <span class="o">=</span> <span class="n">STEDMA40_PSIZE_LOG_4</span><span class="p">,</span>
		<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stedma40_chan_cfg</span> <span class="n">u8500_hash_dma_cfg_tx</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_MEM_TO_PERIPH</span><span class="p">,</span>
		<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_SRC_MEMORY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">DB8500_DMA_DEV50_HAC1_TX</span><span class="p">,</span>
		<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_WORD_WIDTH</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_WORD_WIDTH</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">psize</span> <span class="o">=</span> <span class="n">STEDMA40_PSIZE_LOG_16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">psize</span> <span class="o">=</span> <span class="n">STEDMA40_PSIZE_LOG_16</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">hash_platform_data</span> <span class="n">u8500_hash1_platform_data</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">mem_to_engine</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">u8500_hash_dma_cfg_tx</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dma_filter</span> <span class="o">=</span> <span class="n">stedma40_filter</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* add any platform devices here - TODO */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">mop500_platform_devs</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">mop500_gpio_keys_device</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">ab8500_device</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_STE_DMA40</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">stedma40_chan_cfg</span> <span class="n">ssp0_dma_cfg_rx</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_PERIPH_TO_MEM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span>  <span class="n">DB8500_DMA_DEV8_SSP0_RX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_DST_MEMORY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stedma40_chan_cfg</span> <span class="n">ssp0_dma_cfg_tx</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_MEM_TO_PERIPH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_SRC_MEMORY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">DB8500_DMA_DEV8_SSP0_TX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">pl022_ssp_controller</span> <span class="n">ssp0_plat</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">bus_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_STE_DMA40</span>
	<span class="p">.</span><span class="n">enable_dma</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_filter</span> <span class="o">=</span> <span class="n">stedma40_filter</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_rx_param</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ssp0_dma_cfg_rx</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_tx_param</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ssp0_dma_cfg_tx</span><span class="p">,</span>
<span class="cp">#else</span>
	<span class="p">.</span><span class="n">enable_dma</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="cm">/* on this platform, gpio 31,142,144,214 &amp;</span>
<span class="cm">	 * 224 are connected as chip selects</span>
<span class="cm">	 */</span>
	<span class="p">.</span><span class="n">num_chipselect</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mop500_spi_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">db8500_add_ssp0</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ssp0_plat</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_STE_DMA40</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">stedma40_chan_cfg</span> <span class="n">uart0_dma_cfg_rx</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_PERIPH_TO_MEM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span>  <span class="n">DB8500_DMA_DEV13_UART0_RX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_DST_MEMORY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stedma40_chan_cfg</span> <span class="n">uart0_dma_cfg_tx</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_MEM_TO_PERIPH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_SRC_MEMORY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">DB8500_DMA_DEV13_UART0_TX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stedma40_chan_cfg</span> <span class="n">uart1_dma_cfg_rx</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_PERIPH_TO_MEM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span>  <span class="n">DB8500_DMA_DEV12_UART1_RX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_DST_MEMORY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stedma40_chan_cfg</span> <span class="n">uart1_dma_cfg_tx</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_MEM_TO_PERIPH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_SRC_MEMORY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">DB8500_DMA_DEV12_UART1_TX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stedma40_chan_cfg</span> <span class="n">uart2_dma_cfg_rx</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_PERIPH_TO_MEM</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span>  <span class="n">DB8500_DMA_DEV11_UART2_RX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_DST_MEMORY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stedma40_chan_cfg</span> <span class="n">uart2_dma_cfg_tx</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">STEDMA40_MODE_LOGICAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dir</span> <span class="o">=</span> <span class="n">STEDMA40_MEM_TO_PERIPH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_dev_type</span> <span class="o">=</span> <span class="n">STEDMA40_DEV_SRC_MEMORY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_dev_type</span> <span class="o">=</span> <span class="n">DB8500_DMA_DEV11_UART2_TX</span><span class="p">,</span>
	<span class="p">.</span><span class="n">src_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dst_info</span><span class="p">.</span><span class="n">data_width</span> <span class="o">=</span> <span class="n">STEDMA40_BYTE_WIDTH</span><span class="p">,</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="cp">#define PRCC_K_SOFTRST_SET      0x18</span>
<span class="cp">#define PRCC_K_SOFTRST_CLEAR    0x1C</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ux500_uart0_reset</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">prcc_rst_set</span><span class="p">,</span> <span class="o">*</span><span class="n">prcc_rst_clr</span><span class="p">;</span>

	<span class="n">prcc_rst_set</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)</span><span class="n">IO_ADDRESS</span><span class="p">(</span><span class="n">U8500_CLKRST1_BASE</span> <span class="o">+</span>
			<span class="n">PRCC_K_SOFTRST_SET</span><span class="p">);</span>
	<span class="n">prcc_rst_clr</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="p">)</span><span class="n">IO_ADDRESS</span><span class="p">(</span><span class="n">U8500_CLKRST1_BASE</span> <span class="o">+</span>
			<span class="n">PRCC_K_SOFTRST_CLEAR</span><span class="p">);</span>

	<span class="cm">/* Activate soft reset PRCC_K_SOFTRST_CLEAR */</span>
	<span class="n">writel</span><span class="p">((</span><span class="n">readl</span><span class="p">(</span><span class="n">prcc_rst_clr</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x1</span><span class="p">),</span> <span class="n">prcc_rst_clr</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Release soft reset PRCC_K_SOFTRST_SET */</span>
	<span class="n">writel</span><span class="p">((</span><span class="n">readl</span><span class="p">(</span><span class="n">prcc_rst_set</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x1</span><span class="p">),</span> <span class="n">prcc_rst_set</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">amba_pl011_data</span> <span class="n">uart0_plat</span> <span class="o">=</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_STE_DMA40</span>
	<span class="p">.</span><span class="n">dma_filter</span> <span class="o">=</span> <span class="n">stedma40_filter</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_rx_param</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">uart0_dma_cfg_rx</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_tx_param</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">uart0_dma_cfg_tx</span><span class="p">,</span>
<span class="cp">#endif</span>
	<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">ux500_uart0_reset</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">amba_pl011_data</span> <span class="n">uart1_plat</span> <span class="o">=</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_STE_DMA40</span>
	<span class="p">.</span><span class="n">dma_filter</span> <span class="o">=</span> <span class="n">stedma40_filter</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_rx_param</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">uart1_dma_cfg_rx</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_tx_param</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">uart1_dma_cfg_tx</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">amba_pl011_data</span> <span class="n">uart2_plat</span> <span class="o">=</span> <span class="p">{</span>
<span class="cp">#ifdef CONFIG_STE_DMA40</span>
	<span class="p">.</span><span class="n">dma_filter</span> <span class="o">=</span> <span class="n">stedma40_filter</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_rx_param</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">uart2_dma_cfg_rx</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dma_tx_param</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">uart2_dma_cfg_tx</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mop500_uart_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">db8500_add_uart0</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart0_plat</span><span class="p">);</span>
	<span class="n">db8500_add_uart1</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart1_plat</span><span class="p">);</span>
	<span class="n">db8500_add_uart2</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart2_plat</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">u8500_cryp1_hash1_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">db8500_add_cryp1</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u8500_cryp1_platform_data</span><span class="p">);</span>
	<span class="n">db8500_add_hash1</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">u8500_hash1_platform_data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">snowball_platform_devs</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">snowball_led_dev</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">snowball_key_dev</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">snowball_sbnet_dev</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">ab8500_device</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">snowball_of_platform_devs</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="o">&amp;</span><span class="n">snowball_led_dev</span><span class="p">,</span>
	<span class="o">&amp;</span><span class="n">snowball_key_dev</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">mop500_init_machine</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i2c0_devs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">mop500_gpio_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">gpio</span> <span class="o">=</span> <span class="n">GPIO_PROX_SENSOR</span><span class="p">;</span>

	<span class="n">mop500_pinmaps_init</span><span class="p">();</span>
	<span class="n">parent</span> <span class="o">=</span> <span class="n">u8500_init_devices</span><span class="p">();</span>

	<span class="cm">/* FIXME: parent of ab8500 should be prcmu */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">mop500_platform_devs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>

	<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">,</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">));</span>

	<span class="n">mop500_i2c_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">mop500_sdi_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">mop500_spi_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">mop500_msp_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">mop500_uart_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>

	<span class="n">u8500_cryp1_hash1_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>

	<span class="n">i2c0_devs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_i2c0_devices</span><span class="p">);</span>

	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mop500_i2c0_devices</span><span class="p">,</span> <span class="n">i2c0_devs</span><span class="p">);</span>
	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">mop500_i2c2_devices</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_i2c2_devices</span><span class="p">));</span>

	<span class="cm">/* This board has full regulator constraints */</span>
	<span class="n">regulator_has_full_constraints</span><span class="p">();</span>

	<span class="n">mop500_uib_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">snowball_init_machine</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">snowball_pinmaps_init</span><span class="p">();</span>
	<span class="n">parent</span> <span class="o">=</span> <span class="n">u8500_init_devices</span><span class="p">();</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snowball_platform_devs</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">snowball_platform_devs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>

	<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">snowball_platform_devs</span><span class="p">,</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snowball_platform_devs</span><span class="p">));</span>

	<span class="n">mop500_i2c_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">snowball_sdi_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">mop500_spi_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">mop500_msp_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">mop500_uart_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>

	<span class="cm">/* This board has full regulator constraints */</span>
	<span class="n">regulator_has_full_constraints</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">hrefv60_init_machine</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i2c0_devs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * The HREFv60 board removed a GPIO expander and routed</span>
<span class="cm">	 * all these GPIO pins to the internal GPIO controller</span>
<span class="cm">	 * instead.</span>
<span class="cm">	 */</span>
	<span class="n">mop500_gpio_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">gpio</span> <span class="o">=</span> <span class="n">HREFV60_PROX_SENSE_GPIO</span><span class="p">;</span>

	<span class="n">hrefv60_pinmaps_init</span><span class="p">();</span>
	<span class="n">parent</span> <span class="o">=</span> <span class="n">u8500_init_devices</span><span class="p">();</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">mop500_platform_devs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>

	<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">,</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">));</span>

	<span class="n">mop500_i2c_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">hrefv60_sdi_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">mop500_spi_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">mop500_msp_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="n">mop500_uart_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>

	<span class="n">i2c0_devs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_i2c0_devices</span><span class="p">);</span>

	<span class="n">i2c0_devs</span> <span class="o">-=</span> <span class="n">NUM_PRE_V60_I2C0_DEVICES</span><span class="p">;</span>

	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mop500_i2c0_devices</span><span class="p">,</span> <span class="n">i2c0_devs</span><span class="p">);</span>
	<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">mop500_i2c2_devices</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_i2c2_devices</span><span class="p">));</span>

	<span class="cm">/* This board has full regulator constraints */</span>
	<span class="n">regulator_has_full_constraints</span><span class="p">();</span>

	<span class="n">mop500_uib_init</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">MACHINE_START</span><span class="p">(</span><span class="n">U8500</span><span class="p">,</span> <span class="s">&quot;ST-Ericsson MOP500 platform&quot;</span><span class="p">)</span>
	<span class="cm">/* Maintainer: Srinidhi Kasagar &lt;srinidhi.kasagar@stericsson.com&gt; */</span>
	<span class="p">.</span><span class="n">atag_offset</span>	<span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">u8500_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>	<span class="o">=</span> <span class="n">ux500_init_irq</span><span class="p">,</span>
	<span class="cm">/* we re-use nomadik timer here */</span>
	<span class="p">.</span><span class="n">timer</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">ux500_timer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">handle_irq</span>	<span class="o">=</span> <span class="n">gic_handle_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">mop500_init_machine</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_late</span>	<span class="o">=</span> <span class="n">ux500_init_late</span><span class="p">,</span>
<span class="n">MACHINE_END</span>

<span class="n">MACHINE_START</span><span class="p">(</span><span class="n">HREFV60</span><span class="p">,</span> <span class="s">&quot;ST-Ericsson U8500 Platform HREFv60+&quot;</span><span class="p">)</span>
	<span class="p">.</span><span class="n">atag_offset</span>	<span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">u8500_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>	<span class="o">=</span> <span class="n">ux500_init_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timer</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">ux500_timer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">handle_irq</span>	<span class="o">=</span> <span class="n">gic_handle_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">hrefv60_init_machine</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_late</span>	<span class="o">=</span> <span class="n">ux500_init_late</span><span class="p">,</span>
<span class="n">MACHINE_END</span>

<span class="n">MACHINE_START</span><span class="p">(</span><span class="n">SNOWBALL</span><span class="p">,</span> <span class="s">&quot;Calao Systems Snowball platform&quot;</span><span class="p">)</span>
	<span class="p">.</span><span class="n">atag_offset</span>	<span class="o">=</span> <span class="mh">0x100</span><span class="p">,</span>
	<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">u8500_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>	<span class="o">=</span> <span class="n">ux500_init_irq</span><span class="p">,</span>
	<span class="cm">/* we re-use nomadik timer here */</span>
	<span class="p">.</span><span class="n">timer</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">ux500_timer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">handle_irq</span>	<span class="o">=</span> <span class="n">gic_handle_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">snowball_init_machine</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_late</span>	<span class="o">=</span> <span class="n">ux500_init_late</span><span class="p">,</span>
<span class="n">MACHINE_END</span>

<span class="cp">#ifdef CONFIG_MACH_UX500_DT</span>

<span class="k">struct</span> <span class="n">of_dev_auxdata</span> <span class="n">u8500_auxdata_lookup</span><span class="p">[]</span> <span class="n">__initdata</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* Requires DMA and call-back bindings. */</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;arm,pl011&quot;</span><span class="p">,</span> <span class="mh">0x80120000</span><span class="p">,</span> <span class="s">&quot;uart0&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart0_plat</span><span class="p">),</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;arm,pl011&quot;</span><span class="p">,</span> <span class="mh">0x80121000</span><span class="p">,</span> <span class="s">&quot;uart1&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart1_plat</span><span class="p">),</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;arm,pl011&quot;</span><span class="p">,</span> <span class="mh">0x80007000</span><span class="p">,</span> <span class="s">&quot;uart2&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uart2_plat</span><span class="p">),</span>
	<span class="cm">/* Requires DMA bindings. */</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;arm,pl022&quot;</span><span class="p">,</span> <span class="mh">0x80002000</span><span class="p">,</span> <span class="s">&quot;ssp0&quot;</span><span class="p">,</span>  <span class="o">&amp;</span><span class="n">ssp0_plat</span><span class="p">),</span>
	<span class="cm">/* Requires clock name bindings. */</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;st,nomadik-gpio&quot;</span><span class="p">,</span> <span class="mh">0x8012e000</span><span class="p">,</span> <span class="s">&quot;gpio.0&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;st,nomadik-gpio&quot;</span><span class="p">,</span> <span class="mh">0x8012e080</span><span class="p">,</span> <span class="s">&quot;gpio.1&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;st,nomadik-gpio&quot;</span><span class="p">,</span> <span class="mh">0x8000e000</span><span class="p">,</span> <span class="s">&quot;gpio.2&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;st,nomadik-gpio&quot;</span><span class="p">,</span> <span class="mh">0x8000e080</span><span class="p">,</span> <span class="s">&quot;gpio.3&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;st,nomadik-gpio&quot;</span><span class="p">,</span> <span class="mh">0x8000e100</span><span class="p">,</span> <span class="s">&quot;gpio.4&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;st,nomadik-gpio&quot;</span><span class="p">,</span> <span class="mh">0x8000e180</span><span class="p">,</span> <span class="s">&quot;gpio.5&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;st,nomadik-gpio&quot;</span><span class="p">,</span> <span class="mh">0x8011e000</span><span class="p">,</span> <span class="s">&quot;gpio.6&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;st,nomadik-gpio&quot;</span><span class="p">,</span> <span class="mh">0x8011e080</span><span class="p">,</span> <span class="s">&quot;gpio.7&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="n">OF_DEV_AUXDATA</span><span class="p">(</span><span class="s">&quot;st,nomadik-gpio&quot;</span><span class="p">,</span> <span class="mh">0xa03fe000</span><span class="p">,</span> <span class="s">&quot;gpio.8&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">),</span>
	<span class="p">{},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">of_device_id</span> <span class="n">u8500_local_bus_nodes</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* only create devices below soc node */</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">&quot;stericsson,db8500&quot;</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">&quot;stericsson,db8500-prcmu&quot;</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">&quot;stericsson,db8500-prcmu-regulator&quot;</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">&quot;stericsson,ab8500&quot;</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">&quot;stericsson,ab8500-regulator&quot;</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">&quot;simple-bus&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__init</span> <span class="nf">u8500_init_machine</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">parent</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i2c0_devs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/* Pinmaps must be in place before devices register */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">of_machine_is_compatible</span><span class="p">(</span><span class="s">&quot;st-ericsson,mop500&quot;</span><span class="p">))</span>
		<span class="n">mop500_pinmaps_init</span><span class="p">();</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">of_machine_is_compatible</span><span class="p">(</span><span class="s">&quot;calaosystems,snowball-a9500&quot;</span><span class="p">))</span>
		<span class="n">snowball_pinmaps_init</span><span class="p">();</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">of_machine_is_compatible</span><span class="p">(</span><span class="s">&quot;st-ericsson,hrefv60+&quot;</span><span class="p">))</span>
		<span class="n">hrefv60_pinmaps_init</span><span class="p">();</span>

	<span class="n">parent</span> <span class="o">=</span> <span class="n">u8500_of_init_devices</span><span class="p">();</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">mop500_platform_devs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snowball_platform_devs</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">snowball_platform_devs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span><span class="p">;</span>

	<span class="cm">/* automatically probe child nodes of db8500 device */</span>
	<span class="n">of_platform_populate</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">u8500_local_bus_nodes</span><span class="p">,</span> <span class="n">u8500_auxdata_lookup</span><span class="p">,</span> <span class="n">parent</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">of_machine_is_compatible</span><span class="p">(</span><span class="s">&quot;st-ericsson,mop500&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">mop500_gpio_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">gpio</span> <span class="o">=</span> <span class="n">GPIO_PROX_SENSOR</span><span class="p">;</span>

		<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">));</span>

		<span class="n">mop500_sdi_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
		<span class="n">i2c0_devs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_i2c0_devices</span><span class="p">);</span>
		<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mop500_i2c0_devices</span><span class="p">,</span> <span class="n">i2c0_devs</span><span class="p">);</span>
		<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">mop500_i2c2_devices</span><span class="p">,</span>
					<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_i2c2_devices</span><span class="p">));</span>

		<span class="n">mop500_uib_init</span><span class="p">();</span>

	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">of_machine_is_compatible</span><span class="p">(</span><span class="s">&quot;calaosystems,snowball-a9500&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * Devices to be DT:ed:</span>
<span class="cm">		 *   snowball_led_dev   = todo</span>
<span class="cm">		 *   snowball_key_dev   = todo</span>
<span class="cm">		 *   snowball_sbnet_dev = done</span>
<span class="cm">		 *   ab8500_device      = done</span>
<span class="cm">		 */</span>
		<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">snowball_of_platform_devs</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">snowball_of_platform_devs</span><span class="p">));</span>

		<span class="n">snowball_sdi_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">of_machine_is_compatible</span><span class="p">(</span><span class="s">&quot;st-ericsson,hrefv60+&quot;</span><span class="p">))</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * The HREFv60 board removed a GPIO expander and routed</span>
<span class="cm">		 * all these GPIO pins to the internal GPIO controller</span>
<span class="cm">		 * instead.</span>
<span class="cm">		 */</span>
		<span class="n">mop500_gpio_keys</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">gpio</span> <span class="o">=</span> <span class="n">HREFV60_PROX_SENSE_GPIO</span><span class="p">;</span>
		<span class="n">platform_add_devices</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_platform_devs</span><span class="p">));</span>

		<span class="n">hrefv60_sdi_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>

		<span class="n">i2c0_devs</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_i2c0_devices</span><span class="p">);</span>
		<span class="n">i2c0_devs</span> <span class="o">-=</span> <span class="n">NUM_PRE_V60_I2C0_DEVICES</span><span class="p">;</span>

		<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mop500_i2c0_devices</span><span class="p">,</span> <span class="n">i2c0_devs</span><span class="p">);</span>
		<span class="n">i2c_register_board_info</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">mop500_i2c2_devices</span><span class="p">,</span>
					<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mop500_i2c2_devices</span><span class="p">));</span>

		<span class="n">mop500_uib_init</span><span class="p">();</span>
	<span class="p">}</span>
	<span class="n">mop500_i2c_init</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>

	<span class="cm">/* This board has full regulator constraints */</span>
	<span class="n">regulator_has_full_constraints</span><span class="p">();</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">u8500_dt_board_compat</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;calaosystems,snowball-a9500&quot;</span><span class="p">,</span>
	<span class="s">&quot;st-ericsson,hrefv60+&quot;</span><span class="p">,</span>
	<span class="s">&quot;st-ericsson,u8500&quot;</span><span class="p">,</span>
	<span class="s">&quot;st-ericsson,mop500&quot;</span><span class="p">,</span>
	<span class="nb">NULL</span><span class="p">,</span>
<span class="p">};</span>


<span class="n">DT_MACHINE_START</span><span class="p">(</span><span class="n">U8500_DT</span><span class="p">,</span> <span class="s">&quot;ST-Ericsson U8500 platform (Device Tree Support)&quot;</span><span class="p">)</span>
	<span class="p">.</span><span class="n">map_io</span>		<span class="o">=</span> <span class="n">u8500_map_io</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_irq</span>	<span class="o">=</span> <span class="n">ux500_init_irq</span><span class="p">,</span>
	<span class="cm">/* we re-use nomadik timer here */</span>
	<span class="p">.</span><span class="n">timer</span>		<span class="o">=</span> <span class="o">&amp;</span><span class="n">ux500_timer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">handle_irq</span>	<span class="o">=</span> <span class="n">gic_handle_irq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_machine</span>	<span class="o">=</span> <span class="n">u8500_init_machine</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_late</span>	<span class="o">=</span> <span class="n">ux500_init_late</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dt_compat</span>      <span class="o">=</span> <span class="n">u8500_dt_board_compat</span><span class="p">,</span>
<span class="n">MACHINE_END</span>
<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
